Gebhard Böckle · Wolfram Decker
Gunter Malle    Editors 
Algorithmic and 
Experimental Methods 
in Algebra, Geometry, 
and Number Theory

Algorithmic and Experimental Methods in Algebra,
Geometry, and Number Theory

Gebhard BRockle • Wolfram Decker • Gunter Malle
Editors
Algorithmic and
Experimental Methods
in Algebra, Geometry,
and Number Theory
123

Editors
Gebhard BRockle
IWR
Heidelberg University
Heidelberg, Germany
Wolfram Decker
Department of Mathematics
Technische Universität Kaiserslautern
Kaiserslautern, Germany
Gunter Malle
Department of Mathematics
Technische Universität Kaiserslautern
Kaiserslautern, Germany
ISBN 978-3-319-70565-1
ISBN 978-3-319-70566-8
(eBook)
https://doi.org/10.1007/978-3-319-70566-8
Library of Congress Control Number: 2018932356
Mathematics Subject Classiﬁcation (2010): 06Bxx, 11Fxx, 11Gxx, 11G15, 13Pxx, 13P10, 14G05,
14H40, 14Qxx, 14Txx, 16Exx, 16Gxx, 20Cxx, 20C40, 20Exx, 51F15, 52Bxx
© Springer International Publishing AG, part of Springer Nature 2017
This work is subject to copyright. All rights are reserved by the Publisher, whether the whole or part of
the material is concerned, speciﬁcally the rights of translation, reprinting, reuse of illustrations, recitation,
broadcasting, reproduction on microﬁlms or in any other physical way, and transmission or information
storage and retrieval, electronic adaptation, computer software, or by similar or dissimilar methodology
now known or hereafter developed.
The use of general descriptive names, registered names, trademarks, service marks, etc. in this publication
does not imply, even in the absence of a speciﬁc statement, that such names are exempt from the relevant
protective laws and regulations and therefore free for general use.
The publisher, the authors and the editors are safe to assume that the advice and information in this book
are believed to be true and accurate at the date of publication. Neither the publisher nor the authors or
the editors give a warranty, express or implied, with respect to the material contained herein or for any
errors or omissions that may have been made. The publisher remains neutral with regard to jurisdictional
claims in published maps and institutional afﬁliations.
Printed on acid-free paper
This Springer imprint is published by the registered company Springer International Publishing AG part
of Springer Nature.
The registered company address is: Gewerbestrasse 11, 6330 Cham, Switzerland

Preface
Experiments based on calculating examples have always played a key role in mathe-
matical research. Today, modern computers paired with sophisticated mathematical
software tools allow for far-reaching experiments that were previously unimagin-
able. They enable mathematicians to test working hypotheses or conjectures in
a large number of instances, to ﬁnd counterexamples or sufﬁcient mathematical
evidence to reﬁne a conjecture, to arrive at new conjectures in the ﬁrst place, and
to verify theorems whose proofs have been reduced to handling a ﬁnite number of
special cases.
In the realm of algebra and its applications, where exact calculations are
essential, the desired software tools are implemented in computer algebra systems
that are large, complex pieces of software and contain and rely on a vast amount
of mathematical reasoning. Driven by intended applications, they are created by
collaborative efforts involving specialists in many different ﬁelds. Importantly, these
systems also allow non-experts to access and apply a virtual treasure trove of
mathematical knowledge.
Over the last few decades, computer algebra has evolved as a mathematical
discipline in its own right. Its algorithms have opened up new ways of accessing
some of the key disciplines of pure mathematics and are fundamental to the practical
applications of these disciplines. A decisive feature of current developments is
that more and more of the abstract concepts of pure mathematics are being made
constructive, with interdisciplinary methods playing a signiﬁcant role.
In this context, the German Research Foundation (DFG) established the Priority
Programme SPP 1489 on Algorithmic and Experimental Methods in Algebra,
Geometry, and Number Theory, which was running from July 2010 until June 2016.
The overall goal of the programme was to considerably advance the algorithmic and
experimental methods in these disciplines, to combine the different methods where
needed, and to apply them to central questions in theory and practice. In particular,
the programme was meant to support the further development of leading open-
source computer algebra systems based (to a large extent) within its boundaries,
and to interconnect these systems, supplemented by a number of smaller libraries
v

vi
Preface
and packages, in order to create cutting-edge software tools for interdisciplinary
research.
This proceedings volume reports on selected aspects of the work done during
the Priority Programme. It contains original research articles as well as survey
papers that reﬂect all levels of computer algebra—providing computational access
to mathematical concepts, designing algorithms, implementing the algorithms, and
applying them to profound mathematical questions. The mathematical themes are
taken from group and representation theory, algebraic geometry, polyhedral and
tropical geometry, and number theory. Speciﬁc topics include ﬁnite group theory,
reﬂection arrangements, associative algebras, algebraic curves, moduli spaces,
lattices, modular forms, Jacobians and Abelian varieties, rational points, and real
and complex multiplication.
The editors would like to take this opportunity to thank the DFG for its generous
support, which made considerable progress in the ﬁeld possible and helped launch
the careers of several young researchers, as witnessed by this proceedings volume.
Heidelberg, Germany
Gebhard Böckle
Kaiserslautern, Germany
Wolfram Decker
Kaiserslautern, Germany
Gunter Malle
September 2017

Contents
Algorithmic Aspects of Units in Group Rings ................................
1
Andreas Bächle, Wolfgang Kimmerle, and Leo Margolis
A Constructive Approach to the Module of Twisted Global Sections
on Relative Projective Spaces ...................................................
23
Mohamed Barakat and Markus Lange-Hegermann
Local to Global Algorithms for the Gorenstein Adjoint
Ideal of a Curve ..................................................................
51
Janko Böhm, Wolfram Decker, Santiago Laplagne, and Gerhard Pﬁster
Picard Curves with Small Conductor..........................................
97
Michel Börner, Irene I. Bouw, and Stefan Wewers
Normaliz 2013–2016 ............................................................. 123
Winfried Bruns, Richard Sieg, and Christof Söger
Integral Frobenius for Abelian Varieties with Real Multiplication......... 147
Tommaso Giorgio Centeleghe and Christian Theisen
Monodromy of the Multiplicative and the Additive Convolution........... 177
Michael Dettweiler and Mirjam Jöllenbeck
Constructing Groups of ‘Small’ Order: Recent Results and Open
Problems .......................................................................... 199
Bettina Eick, Max Horn, and Alexander Hulpke
Classifying Nilpotent Associative Algebras: Small Coclass
and Finite Fields.................................................................. 213
Bettina Eick and Tobias Moede
Desingularization of Arithmetic Surfaces: Algorithmic Aspects ........... 231
Anne Frühbis-Krüger and Stefan Wewers
Moduli Spaces of Curves in Tropical Varieties ............................... 253
Andreas Gathmann and Dennis Ochse
vii

viii
Contents
Tropical Moduli Spaces of Stable Maps to a Curve .......................... 287
Andreas Gathmann, Hannah Markwig, and Dennis Ochse
Invariant Bilinear Forms on W-Graph Representations and Linear
Algebra Over Integral Domains ................................................ 311
Meinolf Geck and Jürgen Müller
Tropical Computations in polymake ......................................... 361
Simon Hampe and Michael Joswig
Focal Schemes to Families of Secant Spaces to Canonical Curves.......... 387
Michael Hoff
Inductive and Recursive Freeness of Localizations
of Multiarrangements ........................................................... 403
Torsten Hoge, Gerhard Röhrle, and Anne Schauenburg
Toric Ext and Tor in polymake and Singular: The
Two-Dimensional Case and Beyond............................................ 423
Lars Kastner
The Differential Dimension Polynomial for Characterizable
Differential Ideals ................................................................ 443
Markus Lange-Hegermann
Factorization of Z-Homogeneous Polynomials
in the First q-Weyl Algebra ..................................................... 455
Albert Heinle and Viktor Levandovskyy
Complexity of Membership Problems of Different Types
of Polynomial Ideals ............................................................. 481
Ernst W. Mayr and Stefan Toman
Localizations of Inductively Factored Arrangements ........................ 495
Tilman Möller and Gerhard Röhrle
One Class Genera of Lattice Chains Over Number Fields .................. 503
Markus Kirschmer and Gabriele Nebe
polyDB: A Database for Polytopes and Related Objects ................... 533
Andreas Paffenholz
Construction of Neron Desingularization for Two Dimensional Rings..... 549
Gerhard Pﬁster and Dorin Popescu
A Framework for Computing Zeta Functions of Groups, Algebras,
and Modules ...................................................................... 561
Tobias Rossmann
On Decomposition Numbers of Diagram Algebras........................... 587
Armin Shalile

Contents
ix
Koblitz’s Conjecture for Abelian Varieties .................................... 611
Ute Spreckels and Andreas Stein
Chabauty Without the Mordell-Weil Group .................................. 623
Michael Stoll
An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus
Three .............................................................................. 665
Michael Stoll
Some Recent Developments in Spectrahedral Computation ................ 717
Thorsten Theobald
Topics on Modular Galois Representations Modulo Prime Powers ........ 741
Panagiotis Tsaknias and Gabor Wiese

Algorithmic Aspects of Units in Group
Rings
Andreas Bächle, Wolfgang Kimmerle, and Leo Margolis
Abstract We describe the main questions connected to torsion subgroups in the
unit group of integral group rings of ﬁnite groups and algorithmic methods to attack
these questions. We then prove the Zassenhaus Conjecture for Amitsur groups
and prove that any normalized torsion subgroup in the unit group of an integral
group of a Frobenius complement is isomorphic to a subgroup of the group base.
Moreover we study the orders of torsion units in integral group rings of ﬁnite almost
quasisimple groups and the existence of torsion-free normal subgroups of ﬁnite
index in the unit group.
Keywords Units • Integral group rings • Zassenhaus conjectures • Computa-
tional character methods
Subject Classiﬁcations 16S34, 16U60, 20C05, 20C40
The ﬁrst author is a postdoctoral researcher of the FWO (Research Foundation Flanders). The third
is supported by a Marie Skłodowska-Curie Individual Fellowship from EU project 705112-ZC.
A. Bächle
Vakgroep Wiskunde, Vrije Universiteit Brussel, Pleinlaan 2, 1050 Brussels, Belgium
e-mail: abachle@vub.ac.be
W. Kimmerle ()
Fachbereich Mathematik, IGT, Universität Stuttgart, Pfaffenwaldring 57, 70550 Stuttgart,
Germany
e-mail: kimmerle@mathematik.uni-stuttgart.de
L. Margolis
Departamento de matemáticas, Facultad de matemáticas, Universidad de Murcia, 30100 Murcia,
Spain
e-mail: leo.margolis@um.es
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_1
1

2
A. Bächle et al.
1
Introduction
The study of the units of an integral group ring ZG for a ﬁnite group G has begun
in Higman’s thesis [29]. Higman classiﬁed the ﬁnite groups G whose integral group
ring has only trivial units. The aim of this article is to present recent work on the
structure of torsion subgroups on the unit group of ZG which has been achieved
especially with the aid of algorithmic tools.
Denote by
" W ZG ! Z;
X
g2G
zgg 7!
X
g2G
zg
the augmentation map. Being a ring homomorphism, " maps units of ZG to units of
Z, so up to multiplication with 1 any unit in ZG has augmentation 1 and it sufﬁces
to study the units of augmentation 1 in ZG. The set of these so called normalized
units will be denoted by V.ZG/.
Although extensively studied, very few general theorems on the behaviour of
ﬁnite subgroups in V.ZG/ are available. It is known that the order of a ﬁnite
subgroup of V.ZG/ divides the order of G [62] and that the order of a torsion unit in
V.ZG/ divides the exponent of G [15]. But it is not even known, whether the orders
of torsion units in V.ZG/ coincide with the orders of elements in G. For a long
time the Isomorphism Problem, which asks whether a ring isomorphism ZG Š ZH
implies a group isomorphism G Š H, was the focus of attention in the area, see e.g.
[52]. A negative answer to this problem was ﬁnally given by Hertweck [21].
The main questions in the area of torsion units of integral group rings are given
and inspired by three conjectures of Zassenhaus. A subgroup U  V.ZG/ is called
rationally conjugate to a subgroup of G, if there exist a subgroup U0  G and a unit
x 2 QG such that x1Ux D U0. Let G be ﬁnite group. The conjectures put forward
by Zassenhaus [61] read as follows.
(ZC1)
Units of ﬁnite order of V.ZG/ are rationally conjugate to elements of G:
(ZC2)
Group bases, i.e. subgroups of V.ZG/ of the same order as G, are
rationally conjugate.
(ZC3)
A ﬁnite subgroup H of V.ZG/ is rationally conjugate to a subgroup of G:
Note that (ZC1) is still open. For (ZC2) and (ZC3) counterexamples are known
(not only by the counterexample to the Isomorphism Problem). However they hold
for important classes of ﬁnite groups, cf. Sect. 4.
In the last 10 years computational tools have been developed to attack these
questions. The fundamental tool is the HeLP method which is now available as
a GAP package [4]. This package makes use of two external solvers for integral
linear inequalities, namely 4ti2 [1] and normaliz [14] which substantially improved
the efﬁciency of HeLP. In Sect. 2 we describe the HeLP method as well as other
algorithmic methods which have been developed in the last years to handle cases
left open by HeLP. The remaining part of the article is organized as follows. In

Algorithmic Aspects of Units in Group Rings
3
Sect. 3 we prove (ZC1) for Amitsur groups. In the next section we survey recent
results circulating around the Zassenhaus conjectures and isomorphism questions.
We exhibit speciﬁcally those results which have been established with the help of
computational tools. We present the major research problems on torsion units of
integral group rings as well. In Sect. 5 we show that ﬁnite subgroups of V.ZG/
are isomorphic to a subgroup of G if G is a Frobenius complement. In the last
two sections further classes of ﬁnite groups (in particular almost simple groups) are
investigated especially with the help of character theory. For the question whether
the projection of V.ZG/ onto a faithful Wedderburn component (of QG or CG) has
a torsion free kernel, it becomes transparent that the use of generic characters and
generic character tables is extremely useful. This underlines the connection to other
topics of computational representation theory of ﬁnite groups which are in the focus
of recent research. It also shows that this is related with the construction of large
torsion free normal subgroups of V.ZG/: This connects the investigation of torsion
units of integral group rings with the other main topic in the area, the description
of the whole unit group of ZG in terms of generators and relations. This involves
questions on the generation of units of inﬁnite order, free non-abelian subgroups of
V.ZG/, generators of subgroups of ﬁnite index in V.ZG/ and others. For a recent
detailed monograph on the latter topics see [34, 35].
2
Tools and Available Algorithms
Important tools to study the questions mentioned above are so-called partial
augmentations. For an element u D P
g2G
ugg 2 ZG and a conjugacy class xG in
G the integer
"x.u/ D
X
g2xG
ug
is called the partial augmentation of u at the conjugacy class of x. Being class func-
tions of G, partial augmentations are a natural object to study using representation
theory. The connection between the questions mentioned in the introduction and
partial augmentations is established by the following result.
Proposition 2.1 (Marciniak et al. [46, Theorem 2.5]) A torsion unit u 2 V.ZG/
is rationally conjugate to a group element if and only if "x.ud/  0 for all divisors
d of o.u/ and all x 2 G.
Note that for u 2 V.ZG/ the condition "x.u/  0 for all x 2 G is equivalent to the
fact that one partial augmentation of u is 1 while all other partial augmentations are
0—a situation which clearly applies for an element g 2 G.

4
A. Bächle et al.
Thus it is of major interest to ﬁnd restrictions on the partial augmentations of
torsion units. For the orders of elements providing possibly non-vanishing partial
augmentations the following is known.
Proposition 2.2 Let u 2 V.ZG/ be a torsion unit of order n.
i) "1.u/ D 0, unless u D 1. (Berman-Higman Theorem [34, Proposition 1.5.1]).
ii) If "x.u/ ¤ 0 for some x 2 G then the order of x divides n [22, Theorem 2.3].
From the properties of the p-power map in group algebras of characteristic p
one can obtain more restrictions on the partial augmentations given in terms of
congruences modulo p.
Lemma 2.3 (cf. [4, Proposition 3.1] for a Proof) Let s be some element in G and
u 2 V.ZG/ a unit of order pj  m with p a prime and m 6D 1. Then
X
xG; xpjs
"x.u/  "s.upj/ mod p:
In some special situations there are more theoretical restrictions on the partial
augmentations of torsion units. We will only mention one of them which has not
been used frequently yet, but turns out to be quite useful for our results.
Proposition 2.4 ([23, Proposition 2]) Suppose that G has a normal p-subgroup N,
and that u is a torsion unit in V.ZG/ whose image under the natural homomorphism
ZG ! ZG=N has strictly smaller order than u. Then "g.u/ D 0 for every element g
of G whose p-part has strictly smaller order than the p-part of u.
Remark 2.5 An easy but often useful observation when working with quotient
groups is the following. Let N be a normal subgroup of G, and denote by ' W ZG !
ZG=N the linear extension of the natural projection from G to G=N. Then for an
element g 2 G and a unit u 2 V.ZG/ we have
"'.g/.'.u// D
X
xG;
'.x/'.g/
"x.u/
where the sum runs over the conjugacy classes of G.
2.1
HeLP
An idea to obtain more restrictions on the partial augmentations of torsion units in
V.ZG/ using the values of ordinary characters of G was introduced by Luthar and
Passi [44]. If  denotes an ordinary character of G and D a representation of G
realizing  then D can be linearly extended to the group ring ZG. This provides a
ring homomorphism from ZG to a matrix ring and thus units of ZG are mapped to

Algorithmic Aspects of Units in Group Rings
5
invertible matrices. Hence D extends to a representation of V.ZG/ and  extends to
a character of V.ZG/. Let x1; : : : ; xh be representatives of the conjugacy classes of
elements in G. Since  is a Z-linear function we obtain
.u/ D
h
X
iD1
"xi.u/.xi/ for u 2 V.ZG/:
Denote by 1; : : : ; h the irreducible complex characters of G and by X.G/ the
character table of G. So from the arguments above we see
0
BBB@
1.u/
2.u/
:::
h.u/
1
CCCA D
0
BBB@
1.x1/ 1.x2/ : : : 1.xh/
2.x1/ 2.x2/ : : : 2.xh/
:::
:::
:::
:::
h.x1/ h.x2/ : : : h.xh/
1
CCCA
0
BBB@
"x1.u/
"x2.u/
:::
"xh.u/
1
CCCA D X.G/
0
BBB@
"x1.u/
"x2.u/
:::
"xh.u/
1
CCCA :
(1)
Since the character table of a group is an invertible matrix, Eq. (1) provides
restrictions on the partial augmentations of u once we obtain restrictions on the
character values 1.u/; : : : ; h.u/.
For a unit u of ﬁnite order these restrictions follow from the fact that D.u/
is a matrix of order dividing the order of u. Thus D.u/ is diagonalizable and its
eigenvalues are o.u/-th roots of unity. So there are only ﬁnitely many possibilities
for the values of .u/. Hence going through these possibilities for all the irreducible
complex characters of G and applying Eq. (1), one obtains ﬁnitely many possibilities
for the partial augmentations of u. If we assume moreover that the partial augmenta-
tions of proper powers of u are known, say by induction, then the restrictions on the
eigenvalues of D.u/ can be signiﬁcantly strengthened since they may be obtained
as the pairwise product of the eigenvalues of D.ud/ and D.ue/ where d; e denote
integers not coprime with o.u/ such that d C e  1 mod o.u/.
Clearly if one assumes that K is an algebraically closed ﬁeld of characteristic
p not dividing o.u/ then the arguments of the last paragraph still apply. Fixing
a correspondence between the complex roots of unity of order not divisible by
p and the roots of unity in K, as it is custom in modular representation theory,
one can view the character  as a p-Brauer character having complex values.
It was shown by Hertweck [22, Section 3] that if one takes x1; : : : ; xh to be
only the representatives of p-regular conjugacy classes in G and 1; : : : ; h to be
the irreducible p-Brauer characters of G then Eq.(1) also applies. This modular
extension of the idea of Luthar and Passi is in particular useful for simple non-
abelian groups. It does however not provide new restrictions for solvable groups by
the Fong-Swan-Rukolaine Theorem [16, Theorem 22.1].
The method described above is nowadays referred to as HeLP method (the name
is an acronym of the names of the originators of the method: HertweckLutharPassi).
The HeLP method can be implemented into a computer program as it has been
done in the GAP package HeLP [4]. The HeLP method has been applied for single

6
A. Bächle et al.
groups, e.g. in the study of the Zassenhaus Conjecture for small groups as in [11, 31]
or [9] or to study non-solvable groups as e.g. in [12] or [42]. It might also be used
to study inﬁnite series of groups possessing generic character tables as it was done
in [7, 22] or [49]. In this paper we will apply the HeLP method in Sects. 6 and 7.
Note that when one knows the partial augmentations of a torsion unit u 2 V.ZG/
and all it powers, as e.g. after the application of the HeLP method, one may compute
the eigenvalues, with multiplicities, of D.u/ for any ordinary representation D of G.
This observation is often useful when combining the HeLP method with other ideas
described below.
2.2
Other Algorithmic Methods: Quotients, Partially Central
Units and the Lattice Method
An inductive approach to questions about torsion units in V.ZG/ may be taken
when one possesses information on the torsion units in V.ZG=N/ where N is
some normal subgroup in G, since a homomorphism from G to G=N naturally
extends to a homomorphism from V.ZG/ to V.ZG=N/. If one can control the fusion
of conjugacy classes in the projection from G to G=N then one can also obtain
restrictions on the partial augmentations of elements in V.ZG/ assuming some
knowledge about the partial augmentations of the units in V.ZG=N/, cf. Remark 2.5.
This approach was taken by many authors in particular when studying classes of
groups closed under quotients as e.g. in [24]. In this paper also quotients play a
signiﬁcant role in all our results.
Assume that some torsion unit u 2 V.ZG/ is central in some Wedderburn
component B of the complex group algebra CG, but its spectrum in this component
does not coincide with the spectrum of any element in G. An idea to disprove
the existence of such units was ﬁrst used manually by Höfert [30] and recently
developed as a GAP program by Herman and Singh [20]. This is sometimes called
the Partially Central Method and uses an explicit representation of G to show that
no element in CG having only integral coefﬁcients can realize the given central unit
in B. Since u has no other conjugates inside B, this also proves that u can not be
globally conjugate to an element in ZG. This method turns out to be useful for the
study of small groups as demonstrated in [9], but is also not always successful.
A further algorithmic method, particularly useful for the study of the Prime
Graph Question (cf. Problem 4.4 of Sect. 4), was introduced in [8] and is known
as the Lattice Method. Let p be a prime, .K; R; k/ be a p-modular system for G and
u 2 V.ZG/ a torsion unit of order divisible by p. The idea of the Lattice method is
that when B is a block of the modular group algebra kG, D an ordinary irreducible
representation of G belonging to B with corresponding RG-lattice L and S a simple
kG-composition factor of NL, where N denotes the projection from R onto k, then
the spectrum of D.u/ provides restrictions on the isomorphism type of L as Rhui-
lattice and thus on the isomorphism type of S as khNui-module. The use of other

Algorithmic Aspects of Units in Group Rings
7
RG-lattices whose reduction to kG involve S as a composition factor may ﬁnally
lead to a contradiction to the existence of u, since in some situations the restrictions
obtained on the isomorphism type of S as khNui-module may contradict each other.
The Lattice Method has successfully been applied in the study of the Prime Graph
Question and the Zassenhaus Conjecture for non-solvable groups in [6, 8]. We will
apply the Lattice Method in Sect. 6.
3
Amitsur Groups
Herstein pointed out that all ﬁnite subgroups of division rings in positive character-
istic p are cyclic p0-groups. In [2] Amitsur described the ﬁnite subgroups of division
algebras in characteristic 0; these groups are nowadays often called Amitsur groups.
Recall that a group is a Z-group if all its Sylow subgroups are cyclic. We will use a
weaker version of Amitsur’s classiﬁcation suitable for us.
Theorem 3.1 (Amitsur [55, Theorem 2.1.4]) If a ﬁnite group G is a subgroup of
a division algebra of characteristic 0 then
(Z) G is a Z-group
(NZ) or G is isomorphic to one of the following groups
a. O D hs; tj.st/2 D s3 D t4i (binary octahedral group),
b. SL.2; 5/,
c. SL.2; 3/  M, with M a group in (Z) of order coprime to 6 and 2 has odd
order modulo jMj,
d. Cm Ì Q, where m is odd, Q a quaternion group of order 2t such that an
element of order 2t1 centralizes Cm and an element of order 4 inverts Cm,
e. Q8M with M a group in (Z) of odd order and 2 has odd order modulo jMj.
In [18, Theorem 3.5] it was proved that for an Amitsur group G, the order of a
normalized torsion unit in ZG coincides with the order of an element in G. We now
verify that even the ﬁrst Zassenhaus Conjecture holds for these groups.
Theorem 3.2 Let G be a ﬁnite subgroup of a division ring, then (ZC1) holds for G.
Proof If G is a Z-group then it is either cyclic or metacyclic and hence (ZC1) holds
for G [24, Theorem 1.1]. The binary octahedral group was handled by Dokuchaev
and Juriaans [17, Proposition 4.2] and SL.2; 5/ by Juriaans and Polcino-Milies [36,
Proposition 4.2] (for those two groups even (ZC3) was veriﬁed). The groups in
(NZ)(d) have cyclic normal subgroups of order 2t1m with an abelian quotient of
order 2, so we can again apply [24, Theorem 1.1]. If G D Q8  M for some Z-
group M of odd order, then it is a direct product of a nilpotent group with a group
for which the Zassenhaus Conjecture is known with coprime orders and the claim
follows from [24, Proposition 8.1]. So we are left with the groups in (NZ)(c).
Assume from now on that G D SL.2; 3/  M, with M a group in (Z) of order
coprime to 6, and let u 2 V.ZG/ be a torsion unit. If the order of u is a divisor of

8
A. Bächle et al.
jMj, then .o.u/; j SL.2; 3/j/ D 1. Then we can consider the ring homomorphism
ZG ! ZG= SL.2; 3/ ' ZM induced by the projection G ! G= SL.2; 3/ to a
group ring of a group for which the Zassenhaus Conjecture is known and apply [17,
Theorem 2.2] to conclude that u is rationally conjugate to an element of G. If u has
an order a divisor of j SL.2; 3/j then a similar argument applies.
We now consider units having an order which has a common divisor with both,
6 and the order of M. Note that G has a normal Sylow 2-subgroup P. Denote by '
the natural ring homomorphism ZG ! ZG=P, which will also be denoted by N, i.e.
Nx D '.x/ for x 2 ZG.
Assume ﬁrst that u 2 V.ZG/ is of order 2m with 1 6D m a divisor of jMj. If
"x.u/ 6D 0, then o.x/ j 2m by Proposition 2.2. The image Nu has order a divisor
of m, in particular strictly smaller order than u. So by Proposition 2.4 the only
partial augmentations of u that are potentially non-zero are those at classes of
group elements of order 2m0 for m0 a divisor of m. Let w 2 G be an element
whose natural projection onto SL.2; 3/ is trivial. Then the conjugacy classes that
are mapped under ' onto the conjugacy class of Nw are exactly the classes of w, zw
and tw, where z and t denote elements of G of order 2 and 4, respectively. Hence
" Nw.Nu/ D "w.u/ C "zw.u/ C "tw.u/ D "zw.u/, since the order of w and tw is not of
the form 2m0. As the Zassenhaus Conjecture holds for the metacyclic group G=P we
conclude that u has exactly one non-vanishing partial augmentation and is rationally
conjugate to a group element by Proposition 2.1.
If u if of order 4m where 1 6D m is a divisor of jMj then analogues arguments as
in the case 2m show that u is rationally conjugate to an element of G. Now assume
that u 2 V.ZG/ is of order 3m with 1 6D m j jMj. Then Nu is conjugate within Q NG to
an element of NG. As .o.u/; jPj/ D 1 we can use [17, Theorem 2.2] to conclude that
u is rationally conjugate to an element of G.
Finally assume that o.u/ D 6m with 1 6D m a divisor of jMj. If "x.u/ 6D 0 for
some x 2 G, then o.x/ j 6m by Proposition 2.2. The image Nu has strictly smaller
order than u, so again by Proposition 2.4 the only partial augmentations of u that
are potentially non-zero are those at classes of group elements of order 2m0 for m0
a divisor of 3m. First consider an element w 2 G that projects to 1 when mapped
to SL.2; 3/. Then there are three conjugacy classes of G that are mapped on the
conjugacy class of Nw in NG, namely those of w, zw and tw, where z and t are elements
of G of order 2 and 4, respectively. Then " Nw.Nu/ D "w.u/C"zw.u/C"tw.u/ D "zw.u/.
Now assume that w 2 G maps to an element of order 3 in SL.2; 3/. Observe that
for each element s 2 P, ws is either conjugate to w or to zw. Hence exactly those
two conjugacy classes map to the conjugacy class of Nw. Thus " Nw.Nu/ D "w.u/ C
"zw.u/ D "zw.u/. As the Zassenhaus Conjecture holds for G=P we can conclude that
u has exactly one non-trivial partial augmentation. By Proposition 2.1, u is rationally
conjugate to an element of G. The theorem is proved.

Algorithmic Aspects of Units in Group Rings
9
4
From (IP) to (SIP) and (PQ)
From the point of view of the unit group V.ZG/ the counterexample to the
isomorphism problem (IP) simply shows that different group bases may be non-
isomorphic. Nevertheless a lot of positive results have been established and it is
justiﬁed to say that (IP) has almost a positive answer. Indeed for each ﬁnite group
G there is an abelian extension E WD A Ì G such that (ZC2), and so also (IP), has
a positive answer, i.e. different group bases of ZE are conjugate within QG: This
follows from the F-theorem which has been discovered by Roggenkamp and Scott
[53], [51, Theorem 19] and has now ﬁnally a published account [26, Theorem A
and p. 350], see also [27, p. 180]. With respect to semilocal coefﬁcient rings the
F-theorem (in its automorphism version) may be stated as follows.
F-Theorem Let G be a ﬁnite group. Denote by .G/ the set of primes dividing
the order of G. Let S be the semilocal ring Z.G/: Suppose that the generalized
Fitting subgroup F.G/ is a p-group and let ˛ be an S-algebra automorphism of SG
preserving augmentation. Then ˛ is given as the composition of an automorphism
induced from a group automorphism of G followed by a central automorphism (i.e.
given by conjugation with a unit of QG).
The assumption on G in the preceding theorem holds for all group bases of ZG
and for all group bases of Z.G  G/: Thus it follows for groups whose generalized
Fitting subgroup F.G/ is a p-group that group bases of ZG are rationally conjugate,
cf. [37, 5.3]. For a given group G let A be the additive group of FpG. Consider
the semidirect product E D A Ì G; where the action of G is just given by the
multiplication of G on A: Clearly CE.A/ D A and thus the F-theorem establishes
(ZC2) and therefore a strong answer to (IP) for ZE:
The preceding paragraph shows that (IP) has a positive solution for many
important classes of ﬁnite groups. Thus the following subgroup variation came in
the focus of research within the last years.
Problem 4.1 (Subgroup Isomorphism Problem (SIP)) Classify all ﬁnite groups
H such that whenever H occurs for a group G as subgroup of V.ZG/ then H is
isomorphic to a subgroup of G:
If H has this property we say that (SIP) holds for H:
(SIP) holds for the following groups:
4.1. cyclic groups of prime power order [15].
4.2. Cp  Cp, p a prime [25, 39].
4.3. C4  C2 [48].
This shows that with respect to general ﬁnite groups very limited general facts
are known about torsion units of the integral group ring. Much more is known on the
following related question. Let G be a speciﬁc ﬁnite group. Are all torsion subgroups
of V.ZG/ isomorphic to a subgroup of G? In Sect. 5 we settle this question for all
groups occurring as Frobenius complements.

10
A. Bächle et al.
Whether (SIP) holds for ﬁnite p-groups is certainly one of the major open
questions. Clearly this leads to Sylow like theorems for ZG: Even for conjugacy
of ﬁnite p-groups within QG no counterexample is known.
Problem 4.2 ([17, p-ZC3, p. 1170]) Is a Sylow like theorem (SLT) valid in
V.ZG/, i.e. is each p-subgroup of V.ZG/ rationally conjugate to a subgroup of G?
We say that (SLT) holds for a given group G if in V.ZG/ Problem 4.2 has an
afﬁrmative answer for all primes p and that .SLT/p holds if this is the case for a
speciﬁc prime p: If each subgroup of V.ZG/ of prime power order is isomorphic to
a subgroup of G we speak of a weak Sylow like theorem (WSLT) and use the notion
.WSLT/p if this holds for a speciﬁc prime p:
Denote by Gp a Sylow p-subgroup of G. Summary of known results on (SLT).
4.4. .SLT/p holds when Gp is normal [42, 43, 54].
4.5. (SLT) holds when G is nilpotent-by-nilpotent [17].
4.6. .SLT/p holds when Gp is abelian and G is p-constrained [3, Proposition 3.2].
4.7. (SLT) holds for PSL.2; pf / where p denotes a prime [47] if f D 1 or p D 2.
It also holds for PSL.2; p2/ if p  5 [43]. Moreover (WSLT) holds if f  3
[5, 28].
4.8. .SLT/2 is valid if jG2j  8, unless G Š A7 [48]. .WSLT/p is valid if Gp is
cyclic [25, 39] and .WSLT/2 is proved if G2 is generalized quaternion [40,
Theorem 4.1] or a dihedral group [48].
For Frobenius groups we refer to the next section. The following two further
special cases of (SIP) have been studied extensively in the last decade.
Problem 4.3 ((SIP-C), Problem 8 in [54]) Let G be a ﬁnite group. Is each cyclic
subgroup of V.ZG/ isomorphic to a subgroup of G?
Problem 4.4 (Prime Graph Question (PQ)) Let G be a ﬁnite group. Do G and
V.ZG/ have the same prime graphs? Equivalently, is (SIP) valid for cyclic groups
of order p  q; where p and q are different primes?
We say that (SIP-C) or (PQ) holds for a group G if Problem 4.3 or Problem 4.4
respectively has a positive answer for G: Note that (ZC1) implies (SIP-C) and this
in turn implies (PQ) . So both problems may be also considered as test problems for
the ﬁrst Zassenhaus conjecture.
Summary of known results on (SIP-C) and (PQ).
4.9. (SIP-C) holds for soluble groups [23]. Moreover (SIP-C) is valid for any
soluble extension of a group Q for which each torsion unit of order n has
non-vanishing partial augmentations on a class of elements of Q of order n,
cf. Lemma 6.3. This is the case when (ZC1) holds for ZQ:
(PQ) is valid for any soluble extension of a group Q for which (PQ) holds.
[38, Proposition 4.3].
4.10. (SIP-C) holds for Frobenius groups [42, Corollary 2.5].
4.11. (PQ) holds for all simple groups PSL.2; p/, for p a prime [22].
(PQ) also holds for any almost simple group with socle isomorphic to
PSL.2; p/ or PSL.2; p2/ [7].

Algorithmic Aspects of Units in Group Rings
11
4.12. If each almost simple image of the group G has an order divisible by three
primes then (PQ) has an afﬁrmative answer [42, Theorem 3.1], [8].
4.13. (PQ) holds for many almost simple groups whose socle has an order divisible
by at most 4 different primes [6].
We like to point out that the computational tools explained in Sect. 2 play a
prominent role in proving these results. A typical example for this is 4.12. By
theoretical arguments the proof is reduced to almost simple groups whose orders
are divisible by exactly three primes, cf. [41, §4]. CFSG shows that there are only
eight such simple groups with this property. Now a computer examination of the
almost simple groups arising from those simple groups yields successfully the result.
However, the HeLP method does not sufﬁce to deal with all cases. In the case of
automorphism groups of A6 the ﬁnal piece is obtained by the Lattice method.
For further results on almost simple groups of small order see Sect. 6.
5
Frobenius Groups and Complements
The torsion units of the integral group rings of Frobenius groups were considered
in [10, 18, 36, 38, 43]. In particular (SLT) holds (cf. [43]) and (PQ) is known
[38] for Frobenius groups. However, none of the Zassenhaus conjectures has been
established completely. For many speciﬁc Frobenius groups (ZC1) and (ZC3) are
known. The following Theorem 5.1 should be seen as a ﬁrst important step towards
(ZC3) for Frobenius groups. By the notation
G D Q
N
we indicate that G has a normal subgroup N such that G=N is isomorphic to Q.
Theorem 5.1 Let G be a Frobenius complement. Then each torsion subgroup of
V.ZG/ is isomorphic to a subgroup of G.
Proof By Passman [50, §18] the structure of Frobenius complements G is as
follows.
Denote by W the Fitting subgroup of G.
(1) If G2 is cyclic then G is a Z-group.
(2a) Suppose that W2 is cyclic. Then G is metabelian.
(2b) Suppose that W2 Š Q8. Then
.i/ G D
C2
SL.2; 3/  M or .ii/ G D SL.2; 3/  M
or .iii/ G D Q8  M ;

12
A. Bächle et al.
where M is a metacyclic Z-group of odd order coprime to the order of SL.2; 3/
and Q8 respectively.
(2c) Suppose that W2 Š Q2n with n  4: Then
G D
C2
C2n1  M
where M is a metacyclic Z-group of odd order and G2 Š Q2n: So G Š W2M:
(3) If G is insoluble then
.i/ G D
C2
SL.2; 5/  M or .ii/ G D SL.2; 5/  M ;
where M is a metacyclic Z-group of odd order coprime to the order of SL.2; 5/.
The following results settle several of these cases immediately.
(5.1) If G is a direct product of two groups H1 and H2 of coprime order then each
torsion subgroup of V.ZG/ is isomorphic to a subgroup of G if and only if
the same holds in V.ZH1/ and V.ZH2/:
(5.2) For Z-groups (ZC3) is valid [59].
(5.3) If G has an abelian normal subgroup A such that G=A is abelian then each
torsion subgroup of V.ZG/ is isomorphic to a subgroup of G: This follows
from the small group ring sequence
0 ! A Š ZG  I.A/=I.G/  I.A/ ! ZG=I.G/  I.A/ ! ZG=A ! 0
together with the well known facts that torsion subgroups of V.ZG/ are trivial
provided G is an abelian torsion group and that by Marciniak and Sehgal [45]
V.ZG/ \ .1 C I.A/I.G//
is torsion-free.
So Case 1 follows from 5.2, Cases 2a and 2b(iii) from 5.3. Moreover (ZC3) is valid
for SL.2; 3/, SL.2; 5/ [18, Theorem 4.3] and for p-groups [58, 60]. Thus applying
5.1 and 5.2 we see that the theorem is valid in the Cases 2b(ii), 2c, 3(ii) rsp.
Case 3(i) We ﬁrst consider subgroups of V.ZG/ whose order divide 240: Then
factoring out the normal metacyclic group M these subgroups are subgroups of
V.ZG=M/. Then G1 D G=M is the double cover of the S5 occurring as Frobenius
complement. (ZC1) holds for V.ZG1/ [10], (SIP-C) holds for G by Kimmerle and
Konovalov [42, Corollary 2.5] and a Sylow like theorem by Kimmerle and Margolis
[43]. Thus because the order of a torsion subgroup H of V.ZG1/ has to divide
jG1j D 240 the remaining orders of subgroups of V.ZG1/ are:
240; 120; 80; 60; 48; 40; 30; 24; 20; 15; 12; 10 and 6:

Algorithmic Aspects of Units in Group Rings
13
If jHj D 240 then H is a group basis. So we have to show that (IP) holds for G1:
This may be easily seen looking at the ordinary character table of G1: The normal
subgroup correspondence shows that ZG1 Š ZH implies that H has to be as well
a double cover of S5: But the character tables of the two double covers of S5 are
different. Thus H Š G1: Each subgroup of even order of V.ZG1/ contains the
centre Z of G1 which is isomorphic to C2: Thus subgroups of order 10 and 6 have
to be cyclic. Factoring out Z we see that a subgroup H of order 120 has to map onto
a subgroup NH of V.ZS5/ of order 60: Because (ZC3) holds for S5 by Dokuchaev
and Juriaans [17] we see that NH Š A5: There are only two insoluble groups of order
120 which map onto A5: The group C2  A5 has more than one involution. Thus it
follows that H Š SL.2; 5/:
Also there are no subgroups of order 80; 60; 30; 15 rsp. because G1=Z D S5 has
no subgroups of order 40; 30; 15 rsp.
Assume now that jHj D 40: Because a Sylow like theorem is valid in ZG1 we
know that H has a Sylow 2-subgroup H2 isomorphic to Q8 or to C8: Suppose that
H2 Š Q8: Then H2=Z Š C2  C2: But S5 has no subgroup of type C5  C2  C2:
Thus H2 Š C8: Assume that H is isomorphic to a dihedral group of order 40. Then
H=Z Š D10: But H=Z has to be a Frobenius group of order 20 we conclude that
H Š C5WC8 which is indeed isomorphic a subgroup of G1: Similarly one sees that
subgroups of order 20 are isomorphic to C5WC4, a subgroup of index 2 in C5WC8:
Let jHj D 48: Then we know that H=Z Š S4: Moreover Q16 Š H2: Suppose that
H Š Q16 C3: Then H=Z Š D4 C3 6Š S4: Clearly H must have a normal subgroup
of order 8 and contains a non-split central extension of A4 of order 24: This must be
the binary tetrahedral group. Hence an examination of the groups of order 48 (e.g.
with GAP [56]) shows that H is a binary octahedral group of order 48:
Similarly one sees that subgroups of order 24 are binary tetrahedral groups or
C3WQ8 which maps onto a subgroup of S5 isomorphic to S3  C2: Both occur as
subgroups of G1:
If H has order 12, H2 Š C4: Thus H Š C12 which must occur in G1 because
(SIP-C) holds.
Now let H be a subgroup of V.ZG/ whose order is not divisible by 2; 3 or 5:
Then by reduction modulo SL.2; 5/ we get that H is isomorphic to a subgroup of
Z.G= SL.2; 5//: But NG D G= SL.2; 5/ is a Z-group. Thus (ZC3) holds for NG and H
is isomorphic to a subgroup of M:
Finally, if H is a subgroup such that H maps onto a subgroup NH of V.Z NG/ (with
NG D G= SL.2; 5/) of even order m > 2: Then as before NH is isomorphic to a
subgroup of NG: Let K be the image of H under the map onto ZG1 and MH the kernel
of H under this map. Clearly MH is isomorphic to the subgroup of index 2 of NH:
H is a semidirect product of the form MH Ì K: The action of K on MH is
determined modulo K=CK.MH/ and therefore given by NH: Thus its isomorphism
type is given by NH and MH:
Case 2b(i) (ZC3) holds for the binary octahedral group by Dokuchaev and Juriaans
[17, Theorem 4.7]. Now we can argue as in the case before and the proof is complete.

14
A. Bächle et al.
6
(SIP-C) for Almost Quasisimple Groups
In this section we will consider non-solvable groups and analyse how much the
known methods can provide for our problems. We will focus on automorphic and
central non-split extensions of non-abelian simple groups. Recall that a group G
is called almost simple if there is a simple non-abelian group S such that G is
isomorphic to a subgroup of the automorphism group of S containing the inner
automorphisms of S, i.e. S Š Inn.S/  G  Aut.S/. Moreover a group is called
quasisimple if it is a central non-split extension of a non-abelian simple group S.
We will call a group almost quasisimple if it is a central non-split extension of an
almost simple group.
Example 6.1 One of the smallest almost quasisimple groups for which the Zassen-
haus Conjecture is open is the symmetric group of degree 6. The other group of the
same size for which the Zassenhaus Conjecture is also open is the Mathieu group
of degree 10. In this example we will concentrate on the example of a possible
involution in V.ZS6/ which is of particular interest since its existence would also
provide a counterexample to the Torsionfree Kernels Question, cf. Problem 7.1 in
Sect. 7, and even more so since the involution would lie in the kernel of the most
natural representation of the group—the permutation representation on six points.
Let G be the symmetric group of degree 6. Denote by 2a the conjugacy
class of involutions in G which have no ﬁxed points in the natural action, i.e.
elements of cycle type .2; 2; 2/, by 2b the class of involutions of cycle type
.2; 2; 1; 1/ and by 2c the conjugacy class of involutions of cycle type .2; 1; 1; 1; 1/.
The HeLP method is not sufﬁcient to exclude the existence of an involution
u 2 V.ZG/ satisfying ."2a; "2b; "2c/ D .1; 1; 1/. Moreover the GAP function
HeLP_Multiplicities OfEigenvalues provided by the HeLP package
allows to construct an element of QG having the partial augmentations of u. Thus
to show that u does not exist in ZG it must be shown that the conjugacy class of
this element in QG has trivial intersection with the Z-order ZG in QG. We give this
element explicitly. For that let
QG Š Q  Q  Q55  Q55  Q55  Q55
 Q99  Q99  Q1010  Q1010  Q1616
be the Wedderburn decomposition of QG. Here the ﬁrst factor of the form Q55 is
understood to correspond to the representation of G obtained by cancelling out the
trivial module from the 6-dimensional natural permutation module of G. Moreover
the fourth factor of the form Q55 corresponds to the representation obtained from
cancelling out the trivial module from the permutation module obtained by the
other 6-transitive action of G (i.e. the one corresponding to the other conjugacy
class of subgroups isomorphic to S5 in G) and tensoring this module with the
signum representation. Moreover the ﬁrst factor of the form Q1010 is understood
to correspond to an irreducible representation of G which has character values 2

Algorithmic Aspects of Units in Group Rings
15
on the class 2a. In this setting a representative of the conjugacy class of u in QG is
given by the following element:
..1/; .1/;
diag.1; 1; 1; 1; 1/; diag.1; -1; -1; -1; -1/; diag.1; -1; -1; -1; -1/; diag.1; 1; 1; 1; 1/;
diag.1; 1; 1; 1; 1; -1; -1; -1; -1/; diag.1; 1; 1; 1; 1; -1; -1; -1; -1/;
diag.1; 1; 1; 1; 1; 1; -1; -1; -1; -1/; diag.1; 1; -1; -1; -1; -1; -1; -1; -1; -1/;
diag.1; 1; 1; 1; 1; 1; 1; 1; -1; -1; -1; -1; -1; -1; -1; -1//:
Regarding (SIP-C) more can be achieved for almost quasisimple groups.
Theorem 6.2 Let G be a almost quasisimple group and let S be the only non-
abelian composition factor of G. If S has smaller order than PSL.3; 3/ then (SIP-C)
holds for G.
To prove Theorem 6.2 we will use the HeLP and the lattice methods. For some
of the groups we study, we will use the following result.
Lemma 6.3 Let G and H be groups such that G contains a normal p-subgroup N
and G=N Š H. Assume moreover that when u 2 V.ZH/ is a torsion unit of order
k then there exists an element h 2 H of order k such that "h.u/ ¤ 0. Then (SIP-C)
holds for G.
Proof The proof follows the line of the proof of [23, Theorem]. Denote by ' W
ZG ! ZG=N Š ZH the linear extension of the natural homomorphism from G to
G=N; as is common, it will also be denoted by N. We will apply the bar-convention
to this ring homomorphism. So let u 2 V.ZG/ be a torsion unit. If Nu has the same
order as u then u has the same order as an element in G as by assumption Nu has
the same order as an element in H. Assume on the other hand that Nu has strictly
smaller order than the order of u. By assumption there is an element h 2 H such
that "h.Nu/ ¤ 0 and h has the same order as Nu. So there is g 2 G with Ng D h
and "g.u/ ¤ 0. Then the p0-part of the order of g and the p0-part of the order of u
coincide. But by Proposition 2.4 the p-parts of the order of g and the order of u also
coincide and so g has the same order as u.
Proof (of Theorem 6.2) There are ten non-abelian simple groups of order smaller
than the order of PSL.3; 3/ which give rise to 50 almost quasisimple groups. All of
these groups are listed in the ATLAS and all their character and Brauer tables are
available in the GAP character table library [13]. So in principle we can apply the
HeLP package to all these groups. However it turns out that for central extension
of the alternating and symmetric group of degree 7 these computations do not ﬁnish
in a day, while ﬁnishing in a few minutes for all other groups. Among the groups
not having A7 as a composition factor it turns out that HeLP is sufﬁcient to prove
(SIP-C) for all groups except groups containing A6 as a normal subgroup of index 2,
the groups PSL.2; 16/ and a group containing PSL.2; 16/ as a normal subgroup of
index 2. We handle these cases separately.

16
A. Bächle et al.
The two groups containing A6 as a normal subgroup of index 2 for which the
HeLP method is not sufﬁcient to prove (SIP-C) are PGL.2; 9/ and the Mathieu group
of degree 10. For both these groups it remains to rule out the existence of units of
order 6 in their normalized unit group of the integral group ring. This has been
already done in [8] using the lattice method. For the group G D PSL.2; 16/ it
remains to rule out the existence of units if order 6 in V.ZG/ and this has been also
achieved using the lattice method in [6, Theorem C].
Next let G be a group of automorphisms of PSL.2; 16/ in which the group of
inner automorphisms of PSL.2; 16/ has index 2. To prove (SIP-C) for G it remains
to show that there are no torsion units of order 12 in V.ZG/. HeLP provides us with
two possibilities for the partial augmentations of a unit u 2 V.ZG/ of order 12,
both of which have the same partial augmentations on u2. So ruling out the latter
partial augmentations for units of order 6 will prove (SIP-C) for G. We will use
the lattice method to do so. Denote by 2a the conjugacy class of involutions in G
which lies in PSL.2; 16/ and by 3a the conjugacy class of elements of order 3 in G.
The critical unit u of order 6 has partial augmentations equal to 0 on all conjugacy
classes except 2a and 3a and furthermore ."2a.u/; "3a.u// D .4; 3/ and the only
class on which the partial augmentation of u3 does not vanish is 2a. For an ordinary
character  of G denote by 0 it’s 3-modular reduction. Denote by 1 the trivial
character of G. There are irreducible complex characters  (a constituent of the lift
of the Steinberg character of PSL.2; 16/ and  of degree 16 and 17 respectively
such that 0 is also irreducible as a 3-modular Brauer character and  0 D 10 C 0.
Both characters  and  only take integral values. Thus by a theorem of Fong
[33, Corollary 10.13] there exists a 3-adically complete discrete valuation ring R
unramiﬁed over the 3-adic integers such that there are R-representations D and
D of G realizing  and  respectively. The partial augmentations of u and its
powers allow us to compute the eigenvalues of u under these representations, e.g.
using the GAP command HeLP_MultiplicitiesOfEigenvalues from the
HeLP package. Denote by  a primitive 3rd root of unity. Then
D.u/  diag.1; 1; ; ; ; 2; 2; 2; 1; 1; 1; 1; ; ; 2; 2/;
D .u/  diag.1; 1; 1; 1; 1; ; ; 2; 2; ; ; ; ; 2; 2; 2; 2/:
Denote by L and L full RG-lattices corresponding to D and D respectively.
When an RG-lattices L is considered as an Rhui-lattices it decomposes into a
direct sum L Š LC ˚ L such that all direct summands of LC as Rhu3i-module
are trivial while all direct summands of L as Rhu3i-module are non-trivial by
Bächle and Margolis [8, Proposition 1.3]. Denote by N the reduction modulo the
maximal ideal of R, also with respect to modules, and let k be the ﬁeld obtained
by factoring out the maximal ideal from R. Then from the eigenvalues given above
and [8, Proposition 1.4] we obtain that NL
 has exactly two indecomposable direct
summands of k-dimension at least 2 while NL
 has four such summands. But from
 0 D 10 C 0 we know that NL
 and NL
 must be isomorphic, since if S denotes a
simple kG-module corresponding to 0 then both these modules are isomorphic to

Algorithmic Aspects of Units in Group Rings
17
S, i.e. the direct summand of S as khNui-module consisting of the non-trivial direct
summands of S as khNu3i-module. This provides a ﬁnal contradiction to the existence
of u.
It remains to show (SIP-C) for non-split central extensions of the alternating
and symmetric group of degree 7. Denote by 2a the conjugacy class of double
transpositions in A7 and S7, i.e. elements of cycle type .2; 2; 1; 1; 1/ and by 3a and 3b
the conjugacy classes of elements of order 3 where the latter is of cycle type .3; 3; 1/.
Note that all these three classes are the same in A7 and S7. The Schur multiplier of
both groups is cyclic of order 6, i.e. the maximal cyclic non-split extension is by a
cyclic group of order 6. Thus by Lemma 6.3 it will be enough to show that when
u 2 V.ZA7/ or u 2 V.ZS7/ is a unit of order k then there exists a g 2 A7 or g 2 S7
respectively such that "g.u/ ¤ 0 and g is of order k. Applying HeLP to A7 and S7
one ﬁnds that if u is a unit not satisfying this condition then u is of order 6. Moreover
u satisﬁes
."2a.u/; "3a.u/; "3b.u// 2 f.2; 2; 1/; .2; 1; 2/g;
the partial augmentations of u at all other elements vanish and u3 is rationally
conjugate to an element of 2a while u2 is rationally conjugate to a 3-element in the
conjugacy class C of G such that "C.u/ D 1. In particular we obtain that showing
the non-existence of such a unit in V.ZS7/ implies the non-existence of such a unit
in V.ZA7/.
So assume that G D S7 and assume that u is a unit of order 6 in V.ZG/ as
described in the last paragraph. Again we will use the lattice method to show that u
does not exist. The case when "3a.u/ D 2 will be called Case (i) and the case that
"3b.u/ D 2 will be called (ii). Denote by sig the character of G corresponding to
the signum representation. For an ordinary characters  denote once more by 0 the
corresponding 3-Brauer character. G possesses an irreducible 3-Brauer character '
of degree 13 and two irreducible characters  and  of degree 14 such that
0 D 10 C ' and  0 D sig0 C':
Let again D and D be R-representations of G corresponding to  and  
respectively where R is a 3-adically complete discrete valuation ring unramiﬁed
over the 3-adic integers. From the given partial augmentations of u and its powers
we can compute the eigenvalues of u under these representations. Denote by  a
primitive 3rd root of unity.
In case (i) the eigenvalues of u under the representations of interest are:
D.u/  diag.1; 1; ; ; ; 2; 2; 2; 1; 1; ; ; 2; 2/;
D .u/  diag.1; 1; ; ; ; 2; 2; 2; 1; 1; 1; 1; ; 2/:

18
A. Bächle et al.
While in case (ii) the eigenvalues of u are:
D.u/  diag.1; 1; ; ; ; 2; 2; 2; 1; 1; 1; 1; ; 2/;
D .u/  diag.1; 1; ; ; ; 2; 2; 2; 1; 1; ; ; 2; 2/:
And moreover in both cases sig.u/ D 1. Let L and L be full RG-lattices
corresponding to  and  respectively and denote by N the reduction modulo the
maximal ideal of R. Let k be the quotient of R by its maximal ideal and let S be a
simple kG-module corresponding to '. When viewed as khNui-module S decomposes
into a direct sum S Š SC ˚ S such that S contains all direct summands of S
as khNu3i-module which are not trivial. An analogues decomposition applies for NL
and NL . Then from [8, Propositions 1.3], the 3-modular decomposition behaviour
and the eigenvalues of u under 1 and sig we conclude that NL
 Š S Š NL
 .
However from [8, Proposition 1.4] we know that in Case (i) NL
 has exactly
two indecomposable summands of degree at least 2 while NL
 has only one such
summand and in Case (ii) NL
 has exactly one indecomposable summands of degree
at least 2 while NL
 has two such summands. This contradicts the existence of u and
ﬁnishes the proof.
7
On Large Normal Subgroups
The following question has not yet been systematically studied, but it appears
naturally in the questions mentioned above and might be of independent interest.
Problem 7.1 (Torsionfree Kernel Question (TKQ)) Let K be a ﬁeld of charac-
teristic zero and G a ﬁnite group. Let B be a faithful block of KG and  be the
projection from the units of KG onto B. Is Ker  \ V.ZG/ torsion free?
We remark that a big area in the study of units in integral group rings of
ﬁnite groups is devoted to the study of “large subgroups” of V.ZG/. This involves
questions on the generation of units of inﬁnite order, free non-abelian subgroups
of V.ZG/, generators of subgroups of ﬁnite index in V.ZG/ and others. For more
details we refer to recent monograph on these topics [34, 35].
In this section we present a little idea how torsion units may be used to ﬁnd such
large normal subgroups which are torsion free and of ﬁnite index. We also make
transparent how HeLP and its companions may be used to answer (TKQ). A related
question on the existence of a torsion free complement has been studied extensively
in the 1980s.
Note that the hypothesis of the next lemma is valid if (ZC1) holds for ZG:
Lemma 7.2 Let G be a ﬁnite group. Suppose that elements of prime order of V.ZG/
are rationally conjugate to elements of G:

Algorithmic Aspects of Units in Group Rings
19
Let R be a ﬁeld of characteristic zero. Suppose that G is a subgroup of GL.n; R/
and let  W QG ! Mn.R/ be the ring homomorphism which is the unique extension
of a given injective group homomorphism G ! GL.n; R/: Let K be the kernel of
the group homomorphism  jU.QG/W U.QG/ ! GL.n; R/. Then K\V.ZG/ is torsion
free.
Proof By assumption Mn.R/ is a Q-vector space. Thus  extends uniquely. If K is
not torsion free then it has an element u of prime order p: By assumption there is a
unit v 2 QG such that v1uv D g 2 G: But then .u/ D 1 ¤ .g/.
Example 7.3 Let G D PSL.3; 3/. It can be checked using the GAP package HeLP
that normalized units of V.ZG/ of order a prime r are rationally conjugate to
elements of G, except possibly for r D 3. However in this situation the command
HeLP_MultiplicitiesOfEigenvalues can be used to see that no torsion
unit of order 3 is contained in the kernel of any irreducible representation of G of
degree larger than 1. Hence the previous lemma can be applied with any irreducible
representation of G different from the principal one and (TKQ) has a positive answer
for each block of CG, while (ZC1) is unknown for this group.
Proposition 7.4 Let G be a ﬁnite group. Let B Š Mn.Q/ be a faithful block of the
Wedderburn decomposition of QG. Assume that either
i) p is an odd prime or p D 4 or
ii) p D 2 and jGj is odd.
Let  be the projection of U.QG/ onto B. Then
.Ker  \ V.ZG//  ..1 C pZG/ \ V.ZG//
is a torsion free normal subgroup of V.ZG/ of ﬁnite index.
Proof We may choose an integral representation of G; i.e.  maps ZG into
GL.n; Z/: Consider the reduction  W GL.n; Z/ ! GL.n; Z=pZ/: By a classical
result of Minkowski [19, Lemma 9] the map  is injective on torsion elements
if p ¤ 2: For p D 2 the kernel is an elementary-abelian 2-group. Thus under
the assumptions each torsion element of V.ZG/ injects into the ﬁnite group
GL.n; Z=pZ/: This ﬁnishes the proof.
The preceding construction may be applied especially in the situation of symmet-
ric groups (with respect to almost each non-trivial block) because Q is a splitting
ﬁeld for Sn and only few blocks are not faithful.
Proposition 7.5 Let G be a minimal simple group. Then V.ZG/ has a torsion-free
normal subgroup of ﬁnite index constructed as in Proposition 7.4.
Proof In [57], Thompson proved that a minimal simple group is isomorphic to
PSL.2; q/, Sz.q/ or PSL.3; 3/. For the two series generic character tables are known,
cf. e.g. [32, XI, §5]. Let G be one of these groups and let  be the Steinberg
character. The character  takes the same value t on all elements of order a ﬁxed

20
A. Bächle et al.
prime r. Let x1; : : : ; xs be representatives of the conjugacy classes of G of elements
of order r and let u 2 V.ZG/ be a torsion unit of order r. Then
.u/ D
s
X
jD1
"xj.u/.xj/ D t 6D .1/:
Hence u is not in the kernel of a representation D affording . D can be realized over
the rationals, hence by Proposition 7.4 we obtain a torsion-free normal subgroup of
V.ZG/ of ﬁnite index.
In case G D PSL.3; 3/ Example 7.3 can be used to ﬁnd a suitable block.
References
1. 4ti2 team. 4ti2—a software package for algebraic, geometric and combinatorial problems on
linear spaces. Available at www.4ti2.de (2015). Version 1.6.7
2. S.A. Amitsur, Finite subgroups of division rings. Trans. Am. Math. Soc. 80, 361–386 (1955)
3. A. Bächle, W. Kimmerle, On torsion subgroups in integral group rings of ﬁnite groups. J.
Algebra 326, 34–46 (2011)
4. A. Bächle, L. Margolis, HeLP – a GAP package for torsion units in integral group rings, 6 pp.
(2015, submitted). arXiv:1507.08174[math.RT]
5. A. Bächle, L. Margolis, Torsion subgroups in the units of the integral group ring of PSL(2, p3).
Arch. Math. (Basel) 105(1), 1–11 (2015)
6. A. Bächle, L. Margolis, On the prime graph question for integral group rings of 4-primary
groups II. 17 pp. (2016, submitted). arXiv:1606.01506[math.RT]
7. A. Bächle, L. Margolis, On the prime graph question for integral group rings of 4-primary
groups I. Int. J. Algebra Comput. 27(6), 731–767 (2017)
8. A. Bächle, L. Margolis, Rational conjugacy of torsion units in integral group rings of non-
solvable groups. Proc. Edinb. Math. Soc. (2) 60(4), 813–830 (2017)
9. A. Bächle, A. Herman, A. Konovalov, L. Margolis, G. Singh, The status of the Zassenhaus
conjecture for small groups. Exp. Math. 6 pp. (2017). https://dx.doi.org/10.1080/10586458.
2017.1306814
10. V.A. Bovdi, M. Hertweck, Zassenhaus conjecture for central extensions of S5. J. Group Theory
11(1), 63–74 (2008)
11. V. Bovdi, C. Höfert, W. Kimmerle, On the ﬁrst Zassenhaus conjecture for integral group rings.
Publ. Math. Debr. 65(3–4), 291–303 (2004)
12. V.A. Bovdi, A.B. Konovalov, S. Linton, Torsion units in integral group ring of the Mathieu
simple group M22. LMS J. Comput. Math. 11, 28–39 (2008)
13. T. Breuer,
The GAP character table library, version 1.2.1 (2012).
http://www.math.rwth-
aachen.de/~Thomas.Breuer/ctbllib. GAP package
14. W. Bruns, B. Ichim, C. Söger, The power of pyramid decomposition in Normaliz. J. Symb.
Comput. 74, 513–536 (2016)
15. J.A. Cohn, D. Livingstone, On the structure of group algebras. I. Can. J. Math. 17, 583–593
(1965)
16. C.W. Curtis, I. Reiner, Methods of Representation Theory, vol. I. Wiley Classics Library
(Wiley, New York, 1990). With applications to ﬁnite groups and orders, Reprint of the 1981
original, A Wiley-Interscience Publication
17. M.A. Dokuchaev, S.O. Juriaans, Finite subgroups in integral group rings. Can. J. Math. 48(6),
1170–1179 (1996)

Algorithmic Aspects of Units in Group Rings
21
18. M.A. Dokuchaev, S.O. Juriaans, C. Polcino Milies, Integral group rings of Frobenius groups
and the conjectures of H. J. Zassenhaus. Commun. Algebra 25(7), 2311–2325 (1997)
19. R.M. Guralnick, M. Lorenz,
Orders of ﬁnite groups of matrices,
in Groups, Rings and
Algebras. Contemporary Mathematics, vol. 420 (American Mathematical Society, Providence,
RI, 2006), pp. 141–161
20. A. Herman, G. Singh, Revisiting the Zassenhaus conjecture on torsion units for the integral
group rings of small groups. Proc. Indian Acad. Sci. Math. Sci. 125(2), 167–172 (2015)
21. M. Hertweck, A counterexample to the isomorphism problem for integral group rings. Ann.
Math. (2) 154(1), 115–138 (2001)
22. M. Hertweck, Partial augmentations and Brauer character values of torsion units in group
rings. Manuscript, 16 pp. (2007). arXiv:math.RA/0612429v2[math.RA]
23. M. Hertweck, The orders of torsion units in integral group rings of ﬁnite solvable groups.
Commun. Algebra 36(10), 3585–3588 (2008)
24. M. Hertweck, Torsion units in integral group rings of certain metabelian groups. Proc. Edinb.
Math. Soc. (2) 51(2), 363–385 (2008)
25. M. Hertweck, Unit groups of integral ﬁnite group rings with no noncyclic Abelian ﬁnite p-
subgroups. Commun. Algebra 36(9), 3224–3229 (2008)
26. M. Hertweck, Units of p-power order in principal p-blocks of p-constrained groups. J. Algebra
464, 348–356 (2016)
27. M. Hertweck, W. Kimmerle, On principal blocks of p-constrained groups. Proc. Lond. Math.
Soc. (3) 84(1), 179–193 (2002)
28. M. Hertweck, C.R. Höfert, W. Kimmerle, Finite groups of units and their composition factors
in the integral group rings of the group PSL.2; q/. J. Group Theory 12(6), 873–882 (2009)
29. G. Higman, Units in group rings. D. Phil. thesis, Oxford University (1940)
30. C. Höfert, Die erste Vermutung von Zassenhaus für Gruppen kleiner Ordnung. Diplomarbeit,
Universität Stuttgart (2004)
31. C. Höfert, W. Kimmerle, On torsion units of integral group rings of groups of small order,
in Groups, Rings and Group Rings. Lecture Notes in Pure and Applied Mathematics, vol. 248
(Chapman & Hall/CRC, Boca Raton, FL, 2006), pp. 243–252
32. B. Huppert, N. Blackburn,
Finite Groups. III, Grundlehren der Mathematischen Wis-
senschaften [Fundamental Principles of Mathematical Sciences], vol. 243 (Springer, Berlin-
New York, 1982)
33. I.M. Isaacs,
Character Theory of Finite Groups. Pure and Applied Mathematics, vol. 69
(Academic [Harcourt Brace Jovanovich, Publishers], New York-London, 1976)
34. E. Jespers, Á. del Río, Group Ring Groups. Volume 1: Orders and Generic Constructions of
Units (De Gruyter, Berlin, 2016)
35. E. Jespers, Á. del Río, Group Ring Groups. Volume 2: Structure Theorems of Unit Groups (De
Gruyter, Berlin, 2016)
36. S.O. Juriaans, C. Polcino Milies, Units of integral group rings of Frobenius groups. J. Group
Theory 3(3), 277–284 (2000)
37. W. Kimmerle, Beiträge zur ganzzahligen Darstellungstheorie endlicher Gruppen. Bayreuth.
Math. Schr. 36, 139 (1991)
38. W. Kimmerle, On the prime graph of the unit group of integral group rings of ﬁnite groups, in
Groups, Rings and Algebras. Contemporary Mathematics, vol. 420 (American Mathematical
Society, Providence, RI, 2006), pp. 215–228
39. W. Kimmerle, Torsion units in integral group rings of ﬁnite insoluble groups. Oberwolfach
Rep. 4(4), 3229–3230 (2007).
Abstracts from the mini-workshop held November 25–
December 1, 2007, organized by Eric Jespers, Zbigniew Marciniak, Gabriele Nebe, and
Wolfgang Kimmerle
40. W. Kimmerle, Sylow like theorems for V.ZG/. Int. J. Group Theory 4(4), 49–59 (2015)
41. W. Kimmerle, A.B. Konovalov, Recent advances on torsion subgroups of integral group rings,
in Groups St. Andrews 2013. London Mathematical Society Lecture Note Series, vol. 422
(Cambridge University Press, Cambridge, 2015), pp. 331–347

22
A. Bächle et al.
42. W. Kimmerle, A.B. Konovalov, On the Gruenberg - Kegel graph of integral group rings of
ﬁnite groups. Int. J. Algebra Comput. 27(6), 619–631 (2017)
43. W. Kimmerle, L. Margolis, p-Subgroups of units in ZG, in Groups, Rings, Group Rings.
Contemporary Mathematics, vol. 688 (American Mathematical Society, Providence, RI, 2017),
pp. 169–179
44. I.S. Luthar, I.B.S. Passi, Zassenhaus conjecture for A5. Proc. Indian Acad. Sci. Math. Sci.
99(1), 1–5 (1989)
45. Z. Marciniak, S.K. Sehgal, The unit group of 1 C .G/.A/ is torsion free. J. Group Theory
6(2), 223–228 (1987)
46. Z. Marciniak, J. Ritter, S.K. Sehgal, A. Weiss, Torsion units in integral group rings of some
metabelian groups. II. J. Number Theory 25(3), 340–352 (1987)
47. L. Margolis, A Sylow theorem for the integral group ring of PSL.2; q/. J. Algebra 445, 295–
306 (2016)
48. L. Margolis, Subgroup isomorphism problem for units of integral group rings. J. Group Theory
20(2), 289–307 (2017)
49. L. Margolis, M. Serrano, Á. del Río, Zassenhaus conjecture on torsion units holds for PSL.2; p/
with p a Fermat or Mersenne prime. Preprint, 32 pp. (2016). arXiv:1608.05797[math.RA]
50. D.S. Passman, Permutation Groups (W. A. Benjamin, New York-Amsterdam, 1968)
51. K.W. Roggenkamp,
The isomorphism problem for integral group rings of ﬁnite groups,
in Proceedings of the International Congress of Mathematicians, Vol. I, II (Kyoto, 1990)
(Mathematical Society of Japan, Tokyo, 1991), pp. 369–380
52. K.W. Roggenkamp, L.L. Scott, Isomorphisms of p-adic group rings. Ann. Math. (2) 126(3),
593–647 (1987)
53. L.L. Scott,
Recent progress on the isomorphism problem,
in The Arcata Conference on
Representations of Finite Groups (Arcata, CA, 1986). Proceedings of Symposia in Pure
Mathematics, vol. 47 (American Mathematical Society, Providence, RI, 1987), pp. 259–273
54. S.K. Sehgal, Units in Integral Group Rings. Pitman Monographs and Surveys in Pure and
Applied Mathematics, vol. 69 (Longman Scientiﬁc & Technical, Harlow, 1993)
55. M. Shirvani, B.A.F. Wehrfritz, Skew Linear Groups. London Mathematical Society Lecture
Note Series, vol. 118 (Cambridge University Press, Cambridge, 1986)
56. The GAP Group. GAP – Groups, Algorithms, and Programming, Version 4.8.5 (2016). http://
www.gap-system.org
57. J.G. Thompson, Nonsolvable ﬁnite groups all of whose local subgroups are solvable. Bull.
Am. Math. Soc. 74, 383–437 (1968)
58. G. Thompson, Subgroup rigidity in ﬁnite - dimensional group algebras over p-groups. Trans.
Am. Math. Soc. 341, 423–447 (1994)
59. A. Valenti, Torsion units in integral group rings. Proc. Am. Math. Soc. 120(1), 1–4 (1994)
60. A. Weiss, Rigidity of p-adic p-torsion. Ann. Math. (2) 127(2), 317–332 (1988)
61. H.J. Zassenhaus, On the torsion units of ﬁnite group rings, in Studies in Mathematics (In
Honor of A. Almeida Costa) (Instituto de Alta Cultura, Lisbon, 1974), pp. 119–126
62. È.M. Žmud, G. ˇC. Kurenno˘ı, The ﬁnite groups of units of an integral group ring. Vestnik
Har’kov. Gos. Univ. 1967(26), 20–26 (1967)

A Constructive Approach to the Module
of Twisted Global Sections on Relative
Projective Spaces
Mohamed Barakat and Markus Lange-Hegermann
Abstract The ideal transform of a graded module M is known to compute the
module of twisted global sections of the sheaﬁﬁcation of M over a relative
projective space. We introduce a second description motivated by the relative BGG-
correspondence. However, our approach avoids the full BGG-correspondence by
replacing the Tate resolution with the computationally more efﬁcient purely linear
saturation and the Castelnuovo-Mumford regularity with the often enough much
smaller linear regularity. This paper provides elementary, constructive, and uniﬁed
proofs that these two descriptions compute the (truncated) modules of twisted global
sections. The main argument relies on an established characterization of Gabriel
monads.
Keywords Serre quotient category • Reﬂective localization of Abelian cate-
gories • Gabriel monad • (Truncated) Module of twisted global sections • Direct
image functor • Linear regularity • Gröbner bases • Saturation
Subject Classiﬁcations
13D02, 13D07, 13D45, 13P10, 13P20, 18E10, 18E35,
18A40, 68W30, 14Q99
1
Introduction
We consider coherent sheaves over the projective space Pn
B for a suitable ring B. Any
such coherent sheaf F can be described by a graded module over the polynomial
ring S WD BŒx0; : : : ; xn. Even though this representation is not unique, among the
M. Barakat ()
University of Siegen, 57068 Siegen, Germany
e-mail: mohamed.barakat@uni-siegen.de
M. Lange-Hegermann
Lehrstuhl B für Mathematik, RWTH Aachen University, Aachen, Germany
e-mail: markus.lange.hegermann@rwth-aachen.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_2
23

24
M. Barakat and M. Lange-Hegermann
different graded S-modules representing F there is the distinguished representative
H0
.F/ WD L
p2Z H0.Pn
B; F.p//, the module of twisted global sections. In general
the module of twisted global sections is not ﬁnitely generated, but any of its
truncations H0
d.F/ is.
In this paper we treat the functor H0
d constructively. It is well-known that the
ideal transform functor computes H0
d, which we state as Theorem 4.6. Furthermore,
in Theorem 6.7 we present a new recursive algorithm, inspired by [10, 11], to
compute H0
d. The Tate resolution in loc. cit. incorporates all higher cohomologies,1
whereas our new algorithm introduces a smaller complex, called the purely linear
saturation, which is tailored to H0
 and computationally more efﬁcient as it discards
all higher cohomologies. This paper presents a categorical setup which yields
uniﬁed elementary proofs of both theorems.
A central notion in this paper is that of the linear regularity. We use it in
Corollary 4.7 for the convergence analysis of the inductive limit deﬁning the
ideal transform and in Corollary 6.8 to give the number of recursion steps in
our new algorithm. Like the Tate resolution, the Castelnuovo-Mumford regularity
incorporates all higher cohomologies. And again, the linear regularity is an adaption
to H0
 which discards all higher cohomologies. It follows that the linear regularity
is smaller or at most equal to the Castelnuovo-Mumford regularity. This provides
another reason why computing the purely linear saturation is more efﬁcient than
computing the Tate resolution.
One application is the computation of global sections. More precisely, let F
be a coherent sheaf on Pn
B and  W Pn
B ! Spec B the natural projection.2 The direct
image sheaf H0.F/ WD F over Spec B is the degree zero part (cf. Algorithm 3.1)
of H0
0.F/. For example, if OX 	 OPn
B denotes the structure sheaf of a subscheme
X 	 Pn
B, then computing OX is the geometric form of eliminating all n C 1
homogeneous coordinates x0; : : : ; xn from the deﬁning equations of X 	 Pn
B.
A computer model of the Abelian category Coh PB of coherent sheaves on Pn
B
must incorporate the objects and the morphisms.3 We represent an object F 2
Coh Pn
B by a ﬁnitely presented graded S-modules M, such that F WD e
M is the
sheaﬁﬁcation of M.
The ideal transform is deﬁned to be the inductive limit Dm.M/ of the graded
modules Hom.m`; M/, where m D hx0; : : : ; xni C S is the irrelevant ideal. The
equivalence H0
 .e / ' lim
!` Hom

m`; 

, reproved elementarily as Theorem 4.6,
implies that Hq
 .e / '
lim
!` Extq


m`; 

for the higher derived cohomology
functors [8, 20.4.4].
1See the introduction to Sect. 6 and Remark 7.4.
2The base Spec B might even serve as the ambient space of a geometric quotient, e.g., if B is the
Cox ring of a toric variety.
3The more involved modeling of the morphisms is of no relevance for this paper (cf. [5]).

A Constructive Approach to the Module of Twisted Global Sections
25
Another description of the cohomology functors Hq
 arose from the BGG-corres-
pondence [7]. It is a triangle equivalence between the bounded derived category of
Coh Pn
B (originally over a base ﬁeld B) and the stable category of ﬁnitely generated
graded E-modules over the exterior algebra E, the Koszul dual B-algebra of S. Since
E is a Frobenius algebra, this stable category is easily seen to be triangle equivalent
to the homotopy category of so-called Tate complexes. A constructive description
of the composition of these two triangle equivalences was given in [9, 11]. The
treatment of the relative BGG-correspondence in [10] does not only describe the
coherent sheaf cohomologies Hq.e
M/ D Rqe
M as B-modules, but also provides a
concrete realization of the direct image complex Re
M. However, in this approach
even the computation of global sections H0.e
M/ in the relative case relies a priori on
the entire Tate resolution.
The bottom complex Ed;0
1

Td.M/

on the ﬁrst page of the spectral sequence of
the Tate resolution Td.M/ is a linear complex which corresponds to H0
d.e
M/. We
deﬁne a new so-called purely linear saturation functor Sd, which is computation-
ally far more economic than the Tate functor Td. In Theorem 6.7, Proposition 7.2,
and Corollary 7.3 we prove that Sd computes H0
d.e
M/, and hence Ed;0
1

Td.M/

.
The point is that we can compute Sd without computing Td. This statement is not
obvious in the relative case (cf. Remark 7.4). Furthermore, the linear regularity of
M gives the precise number of recursion steps needed to achieve saturation. Since
computing Sd relies on Gröbner bases over the exterior algebra E of ﬁnite rank over
B the involved algorithms are, for many examples, faster than the ones for the ideal
transform. The latter involve Gröbner bases over the polynomial ring S of inﬁnite
rank over B.
In order to develop a uniﬁed proof that both functors Dm;d and Sd compute
H0
d.e / we need an appropriate categorical setup. Abstractly, the category Coh Pn
B
of coherent sheaves on Pn
B is equivalent to the Serre quotient category A =C of
the Abelian category A of ﬁnitely presented graded S-modules modulo a certain
subcategory C . The necessary categorical language is summarized in Sect. 2. In
Sect. 7 we show that the categories A and C can be replaced by their respective
full subcategories of modules which vanish in degrees < d for an arbitrary but ﬁxed
d 2 Z (cf. Proposition 7.1). The A -endofunctor M 7! H0
d.e
M/ is a special case
of what we call a Gabriel monad, which we characterized in [3] by a short set of
properties. By verifying this short list of properties for the two functors Dm;d and
Sd we prove that they compute H0
d.e /.
Two further applications rely on constructivity of the Gabriel monad, and now
become algorithmically accessible for the category Coh Pn
B: First, the Serre quotient
category A =C becomes constructively Abelian once A is constructively Abelian
[5, Appendix D].4 Second, the computability of the bivariate Hom and Exti functors
in A =C now reduces to the computability of Hom and Exti in A (modulo a directed
colimit process if i > 0) [6].
4However, the approach using Gabriel morphisms in [5] seems computationally faster.

26
M. Barakat and M. Lange-Hegermann
2
Preliminaries on Serre Quotient Categories
A non-empty full subcategory C of an Abelian category A is called thick if it is
closed under passing to subobjects, factor objects, and extensions. In this case the
Serre quotient category A =C is a category with the same objects as A and Hom-
groups deﬁned by the directed colimit
HomA =C .M; N/ WD
lim
!
M0M;N0N;
M=M0;N02C
HomA .M0; N=N0/.
The canonical functor Q W A ! A =C is deﬁned to be the identity on objects
and maps a morphism ' 2 HomA .M; N/ to its class in the directed colimit
HomA =C .M; N/. The category A =C is Abelian and the canonical functor Q W
A ! A =C is exact. An object M 2 A is called C -saturated if Ext0
A .C; M/ Š
Ext1
A .C; M/ Š 0 for all C 2 C , i.e., M has no nonzero subobjects in C and every
extension of an object C 2 C by M is trivial. Denote by SatC .A / 	 A the full
subcategory of C -saturated objects and by 	 W SatC .A / ,! A its full embedding.
A complex F in SatC .A / is exact if and only if 	.F/ has homology in C .
A thick subcategory C
	 A is called localizing if the canonical functor
Q W A ! A =C admits a right adjoint S W A =C ! A , called the section
functor of Q. In this case, the image of S is contained in SatC .A / and A =C
S
!
S .A =C / ,! SatC .A / are equivalences of categories. The Hom-adjunction
HomA =C .Q.M/; Q.N// Š HomA .M; .S ı Q/.N//
allows to compute Hom-groups in A =C if they are computable in A and the monad
S ıQ is computable. In particular, this avoids computing the directed colimit in the
deﬁnition of HomA =C . We call any monad equivalent to S ı Q a Gabriel monad
(of A w.r.t. C ). The following theorem characterizes Gabriel monads.
Theorem 2.1 ([3, Thm. 3.6]5) Let C 	 A be a localizing subcategory of the
Abelian category A and 	 W SatC .A / ,! A the full embedding. An endofunctor
W W A ! A together with a natural transformation 
 W IdA ! W is a Gabriel
monad (of A w.r.t. C ) if and only if the following ﬁve conditions hold:
1. C 	 ker W ,
2. W .A / 	 SatC .A /,
3. the corestriction co-resSatC .A / W of W to SatC .A / is exact,
4. 
W D W 
 W W ! W 2, and
5. 
	 W 	 ! W 	 is a natural isomorphism.
5Thm. 4.6 in arXiv version.

A Constructive Approach to the Module of Twisted Global Sections
27
In Sects. 4 and 6 we utilize this theorem to prove that certain functors are Gabriel
monads of the category of coherent sheaves on the relative projective space Pn
B,
and thus compute the (truncated) module of twisted global sections. However, this
theorem, abstract as it is, can be applied to categories of coherent sheaves of more
general schemes.
3
Graded Modules over the Free Polynomial Ring
For the rest of the paper let B denote a Noetherian commutative ring with 1, V a free
B-module of rank n C 1, W WD V D HomB.V; B/ its B-dual, and x0; : : : ; xn a free
generating set of the B-module W. Set
S WD SymB.W/ D BŒV D BŒx0; : : : ; xn
to be the free polynomial ring over B in the n C 1 indeterminates x0; : : : ; xn. Setting
deg.xj/ D 1 turns S into a positively graded ring S D L
i0 Si where Si is the set of
homogeneous polynomials of degree i in S. Deﬁne the irrelevant ideal
m WD S>0 D hx0; : : : ; xni C S.
The isomorphism B D S0 Š S=m endows B with a natural graded S-module
structure.
To make the statements of this paper constructive, the ring S needs to have a
Gröbner bases algorithm. This is the case if B has effective coset representatives [1,
§4.3], i.e., for every ideal I 	 B we can determine a set T of coset representatives of
B=I, such that for every b 2 B we can compute a unique t 2 T with b C I D t C I.
We denote by S-mod the category of (non-graded) ﬁnitely presented S-modules
and by S-grmod the category of ﬁnitely presented graded S-modules. Further we
denote by
S-grmodd 	 S-grmod
the full subcategory of all modules M with M D Md. Deﬁne the shift autoequiva-
lence on S-grmod by M.i/j WD MiCj for all i 2 Z; it induces an endofunctor on the
subcategory S-grmodd for i  0.
Algorithm 3.1 We brieﬂy describe how to compute the i-th homogeneous part of
an M 2 S-grmod: Such a module is realized on the computer as the cokernel of a
graded free S-presentation
M


M
k
S.gk/
m 
M
`
S.r`/.

28
M. Barakat and M. Lange-Hegermann
The image of the graded submodule L
k;iCgk0 SiCgk.gk/  L
k S.gk/ under 
is the graded submodule hMii  M, which we compute as the kernel of the
cokernel of the restricted map M  L
k;iCgk0 SiCgk.gk/. Computing a free
S-presentation hMii  L
k S.i/
mi L
` S.r0
`/ of hMii thus involves two successive
syzygy computations as explained in [2, (10) in the proof of Theorem 3.4]. To get
a free B-presentation of Mi we just need to tensor the last exact sequence with
B D S=m over S, which corresponds to extracting the degree 0 relations in the
reduced Gröbner basis of the S-matrix of relations mi.
3.1
Internal and External Hom Functors
Let M; N 2 S-grmod. Then the Hom-group HomS-mod.M; N/ of their underlying
modules in S-mod is again naturally graded. This induces internal Hom functors
Hom W S-grmodop  S-grmod ! S-grmod
in the category S-grmod and
Homd W S-grmodop
d  S-grmodd ! S-grmodd
in S-grmodd. These internal Hom functors are algorithmically computable if B has
effective coset representatives (cf., e.g., [1, §4.3] and [2, §3.3]).
The (external) Hom-groups of the category S-grmod are ﬁnitely generated
B-modules. They can be recovered as the graded part of degree 0 of the correspond-
ing internal Hom’s:
Hom.M; N/ WD HomS-grmod.M; N/ Š Hom.M; N/0,
HomS-grmodd.M; N/ Š Homd.M; N/0
for d  0:
In particular, HomS-grmod.S; M/ Š M0 and HomS-grmodd.S; M/ Š M0 for d  0.
Dealing with d > 0 would enforce further case distinctions. For example, B Š
S=m lies in S-grmodd only if d  0.
Till the end of Sect. 4 we assume that d  0.
Remark 3.2 Applying Hom.; M/ to the short exact sequence S=m`  S  - m`
yields
Hom.S=m`; M/ ,! M

`
M
! Hom.m`; M/  Ext1
.S=m`; M/
(
`
M)

A Constructive Approach to the Module of Twisted Global Sections
29
as part of the long exact contravariant Ext-sequence. We will repeatedly refer to
this exact sequence as well as to the ` D 1 case
Hom.B; M/ ,! M

1
M
! Hom.m; M/  Ext1
.B; M/.
(
1
M)
3.2
Quasi-Zero Modules
Let S-grmod0 denote the thick subcategory of quasi-zero modules, i.e., those with
M` D 0 for ` large enough. Analogously, we denote by S-grmod0
d the localizing
(cf. Theorem 4.6) subcategory of quasi-zero modules in S-grmodd.
Remark 3.3 For M 2 S-grmod. Then for all `  0
1. TorS
i .S=m`; M/ 2 S-grmod0 for all i  0.
2. Ext j
.S=m`; M/ 2 S-grmod0 for all j  0.
3. Ext j
.m`; M/ 2 S-grmod0 for all j  1.
Proof The existence of a ﬁnitely generated free resolution of the ﬁrst argument
S=m` (and hence of m`) implies that all the above derived modules lie in S-grmod.
By applying S=m` ˝S  to a projective resolution of M and Hom.S=m`; / to an
injective resolution of M shows that the ideal m` C S annihilates TorS
i .S=m`; M/
and Ext j
.S=m`; M/, which implies that they are also ﬁnitely generated S=m`-
modules, proving (1) and (2). The existence of the connecting isomorphisms
Ext j
.m`; M/ Š ExtjC1

.S=m`; M/ (j  1) ﬁnally implies (3).
ut
Remark 3.4 The use of the nonconstructive injective resolution in the previous
proof is an example of an admissible use of nonconstructive arguments in an
otherwise constructive setup to prove statements which neither involve existential
quantiﬁers nor disjunctions (so-called negative formulae): Ext.S=m`; M/ has two
descriptions. The nonconstructive one in the proof and the constructive one in which
Hom.; M/ is applied to a ﬁnite free resolution of S=m`. Although the isomorphism
between the two descriptions is not constructive it is “good enough” for transferring
the property we want to establish.
3.3
Regularity, Linear Regularity, and Relation to Tor and Ext
For convenience of the reader we recall the deﬁnition of the Castelnuovo-Mumford
regularity in the relative case from [10, §2]. For any quasi-zero graded S-module N
deﬁne
reg N WD maxfd 2 Z j Nd ¤ 0g.

30
M. Barakat and M. Lange-Hegermann
The regularity of the zero module is set to 1. Then, for M 2 S-grmod the
S-module TorS
i .B; M/ is quasi-zero and
reg M WD maxfreg TorS
i .B; M/  i j i D 0; : : : ; n C 1g.
Equivalently, one can deﬁne
reg M WD maxfreg Hj
m.M/ C j j j D 0; : : : ; n C 1g
using the local cohomology modules Hj
m.M/ D lim
!` Ext j
.S=m`; M/ (cf., e.g., [10,
Prop. 2.1]).6 In fact only ` D 1 in this sequential colimit is relevant for us. To see this
we need the following result, which we also use in the proof of our key Lemma 5.4.
Lemma 3.5 There exists a natural isomorphism
TorS
i .B; M/ Š ExtnC1i

.^nC1V; M/.
Proof The Tor-Ext spectral sequence
TorS
p.Extq
.^nC1V; S/; M/ ) ExtpCq

.^nC1V; M/
collapses since Extq
.^nC1V; S/ D 0 for q 6D n C 1 and ExtnC1

.^nC1V; S/ D B.
ut
When B D k is a ﬁeld this Lemma becomes the intrinsic and rather generalizable
form of the equality between the graded Betti numbers ˇij WD dimk TorS
i .B; M/j and
the graded Bass numbers:
nC1i;jn1 WD dimk ExtnC1i

.^nC1V; M/j.
Remark 3.6 Lemma 3.5 and the noncanonical isomorphism ^nC1V Š B.n C 1/
yield
reg M D maxfreg Ext j
.B; M/ C j j j D 0; : : : ; n C 1g.
The value of the following deﬁnition will start to become obvious in Proposi-
tion 3.9 in the next subsection.
Deﬁnition 3.7 Deﬁne the linear regularity of M 2 S-grmod to be
linreg M D maxfreg Ext j
.B; M/ j j D 0; 1g 2 Z [ f1g.
6This deﬁnition clariﬁes the relation to two other regularity notions: The geometric regularity
is deﬁned by g-reg M WD maxfreg Hj
m.M/ C j j j D 1; : : : ; n C 1g and the regularity of the
sheaﬁﬁcation reg e
M WD maxfreg Hj
m.M/ C j j j D 2; : : : ; n C 1g.

A Constructive Approach to the Module of Twisted Global Sections
31
Analogously, the d-th truncated linear regularity of M 2 S-grmodd is deﬁned
by
linregd M D maxfreg Ext j
d.B; M/ j j D 0; 1g 2 Zd [ f1g,
for d  0 where Ext j
d WD Ext j
S-grmodd ' .Ext j
/d.
Note that linreg D reg on S-grmod0 and linreg  reg on S-grmod.
Example 3.8 linreg S=m`C1 D reg S=m`C1 D ` D linreg m`C1 < reg m`C1 D
` C 1.
The motivation behind introducing linreg is that it offers an upper bound in the
saturation algorithms discussed below, where the use of the (often enough much
larger) regularity would be a waste of computational resources.
3.4
Saturated Modules
The equivalent conditions (4) and (5) in the following proposition are computation-
ally effective characterizations of saturated modules.
Proposition 3.9 For M 2 S-grmod the following are equivalent:
1. M is saturated w.r.t. S-grmod0;
2. Ext0
.S=m`; M/ D 0 and Ext1
.S=m`; M/ D 0 for all `  0;
3. The natural map 
`
M WD Hom.S  - m`; M/ W M ! Hom.m`; M/ is an
isomorphism for all `  0;
4. Ext0
.B; M/ D 0 and Ext1
.B; M/ D 07;
5. The natural map 
1
M WD Hom.S  - m; M/ W M ! Hom.m; M/ is an
isomorphism;
6. TorS
nC1.B; M/ D 0 and TorS
n.B; M/ D 0;
7. linreg M D 1.
And if the base ring B is a ﬁeld the above is also equivalent to:
8. The projective dimension pd M  n  1.
In the proof of this proposition, we use the following simple remark.
Remark 3.10 The kernel K of the epimorphism m`  ˝`m is concentrated in
degree `. To see this note that any homogeneous element in ˝`m of degree m > `
7Conditions (4) and (5) are in their use of Gröbner bases algorithmically equivalent. Computing
them only involves the ﬁrst two morphisms in the Koszul resolution of B (and then tensoring
their duals with M). One might be tempted to expect that (4) is always algorithmically superior to
condition (6), which seem to involve an n C 1-term resolution of either B or of M. However, one
can easily construct examples of M 2 S-grmod, where condition (6) is algorithmically superior,
e.g., if the resolution of M terminates after few steps, long before reaching step n.

32
M. Barakat and M. Lange-Hegermann
which is the tensor product of monomials can be brought to the normal form xi1 ˝B
  ˝B xi`1 ˝B x with i1      im1  minfi j i ¤ 0g and jj D m`C1. This
kernel K is free over B of rank .n C 1/` 
nC`
n

as the kernel of the B-epimorphism
Sym` W  ˝`W.
Proof (of Proposition 3.9)
(2) , (3): The claim is obvious from the (
`
M)-sequence in Remark 3.2.
(4) , (5): This is a special case of the equivalence (2) , (3) for ` D 1.
(4) , (6): This is the statement of Lemma 3.5 for i D n C 1 and i D n.
(4) , (7): By deﬁnition of linreg.
(1) ) (4): This follows directly
from the
deﬁnition of saturated objects
(cf. Sect. 2), as B 2 C D S-grmod0.
(5) ) (3): Applying the `-th power of Hom.S  - m; / to M and taking the
diagonal in the `-dimensional cube yields the isomorphism
' WD M

! Hom.˝`m; M/
by the adjunction between ˝ and Hom. This isomorphism can be
written as the composition
Hom.S  - m`  ˝`m; M/ D

M
 ! Hom.m`; M/
! Hom.˝`m; M/

.
The homomorphism  is a monomorphism since Hom is left exact
and an epimorphism since  ı  D ' is an isomorphism. Hence, 
is isomorphism and thus  is an isomorphism.
(2) ) (1): Clearly, any N 2 S-grmod0 is an epimorphic image of L
i2I.S=mai/.bi/
for a ﬁnite set I and suitable ai and bi. Denote the kernel of
N

L
i.S=mai/.bi/ by K. Applying Hom.; M/ to N

L
i.S=mai/.bi/  - K yields as parts of the long exact sequence
Hom.N; M/ ,! Hom
 M
i
.S=mai/.bi/; M
!
„
ƒ‚
…
Š0
,
and
Hom.K; M/ ! Ext1
.N; M/ ! Ext1

 M
i
.S=mai/.bi/; M
!
„
ƒ‚
…
Š0
.
The ﬁrst part implies Hom.; M/ D 0 on S-grmod0. In particular,
Hom.K; M/ D 0 since K 2 S-grmod0. Combining this and the second
part implies that Ext1
.; M/ vanishes on S-grmod0.

A Constructive Approach to the Module of Twisted Global Sections
33
(6) , (8): If B is a ﬁeld then there exists a ﬁnite free (and not merely relatively
free) presentation M  F with TorS
i .B; M/ isomorphic to the head of
Fi.
ut
Corollary 3.11 For M 2 S-grmodd the following are equivalent (recall, d  0):
1. M is saturated w.r.t. S-grmod0
d;
2. Ext0
d.S=m`; M/ D 0 and Ext1
d.S=m`; M/ D 0 for all `  0;
3. The natural map 
`
M WD Homd

S  - m`; M

W M ! Homd.m`; M/ is an
isomorphism for all `  0;
4. Ext0
d.B; M/ D 0 and Ext1
d.B; M/ D 0;
5. The natural map 
1
M WD Homd .S  - m; M/ W M ! Homd.m; M/ is an
isomorphism;
6. TorS
nC1.B.n C 1/; M/d D 0 and TorS
n.B.n C 1/; M/d D 0;
7. linregd M D 1.
4
Ideal Transforms
Recall, the m-transform of M 2 S-grmod is the (not necessarily ﬁnitely generated)
graded S-module deﬁned by the sequential colimit
Dm WD lim
!
`
Hom.m`; / W S-grmod ! S-grMod:
On S-grmodd the d-truncated m-transform (recall, d  0)
Dm;d WD lim
!
`
Homd.m`; / W S-grmodd ! S-grmodd
is an endofunctor. This is a simple corollary of the Lemma 4.2 below.
Deﬁnition 4.1 We deﬁne the saturation interval of M 2 S-grmodd to be
Id.M/ WD Œı0
M;d; ı1
M;d \ Z 	 Z0,
where ı0
M;d WD maxfreg Homd.B; M/  d C 1; 0g and ı1
M;d WD maxflinregd d C
1; 0g.
The saturation interval plays a role in the following convergence analysis and the
deﬁnition of its upper bound is a further motivation for the linear regularity.
Lemma 4.2 For each M
2
S-grmodd the sequential colimit deﬁning the
m-transform is ﬁnite. More precisely, there exists a nonnegative integer ıM;d 2
Id.M/ such that the induced maps Homd.m`; M/ ! Homd.m`C1; M/ are

34
M. Barakat and M. Lange-Hegermann
isomorphisms for all `  t iff t  ıM;d. In particular, the natural map
Homd.m`; M/ ! Dm;d.M/
is an isomorphism iff `  ıM;d.
Proof The short exact sequence B.`/˚‹ Š m`=m`C1  m`  - m`C1 induces for
M 2 S-grmod the exact contravariant Ext-sequence of which the ﬁrst four terms
are
Hom.B; M/˚‹.`/ ,! Hom.m`; M/ ! Hom.m`C1; M/ ! Ext1
.B; M/˚‹.`/.
By Remark 3.3.(2) both Hom.B; M/ and Ext.B; M/ are quasi-zero. Hence, there
exists a ıM;d 2 Id.M/ such that the truncated morphisms
Homd.m`; M/ ! Homd.m`C1; M/
become isomorphisms in S-grmodd for `  t iff t  ıM;d.
ut
In particular, once B has effective coset representatives, Dm;d is algorithmically
computable on objects and morphisms, since the internal Hom functor Homd is.
Deﬁnition 4.3 We call ıM;d 2 Id.M/ from Lemma 4.2 the defect of saturation
of M.
Example 4.4 Note that 1 D ım.t/;0 2 I0.m.t// D Œ0; linreg0 m.t/ C 1 D
Œ0; tC1 for all t 2 Z0. In other words, the maximum of Id.M/ can be an arbitrarily
bad upper bound for ıM;d.
Example 4.5 For M D S ˚B.t/ and t  0 we compute Hom.B; M/ D B.t/ and
Ext1
.B; M/ D B.t C 1/nC1 (for n > 0). Hence ı0
M;0 D t C 1 D ı1
M;0 D ıM;0 is the
defect of saturation. Thus, for certain examples factoring out the S-grmod0
d-torsion
part of M a priori could be beneﬁcial.
The natural transformation

M WD lim
!
`


`
M W M ! Homd.m`; M/

W M ! Dm;d.M/
is induced by applying Homd.; M/ to the embeddings .S  - m`/d.
Now we reprove that the ideal transform computes the module of twisted global
sections (cf., e.g., [14, §C.3]).
Theorem 4.6 The d-truncated m-transform Dm;d together with the natural trans-
formation 
 W IdA
! Dm;d is a Gabriel monad of A
D S-grmodd w.r.t.
C WD S-grmod0
d.
In fact, the theorem holds for all d 2 Z. The proof below assumes d  0 to avoid
case distinctions.

A Constructive Approach to the Module of Twisted Global Sections
35
Corollary 4.7 Homd.m`; M/ is S-grmod0
d-saturated iff `  ıM;d.
Before proving the theorem we state some simple facts about ideal transforms.
Remark 4.8
1. Any N 2 S-grmod0 vanishes in degrees greater than reg N. Thus,
Hom.L`; N/reg NC1` D 0
for all ` 2 Z and L 2 S-grmod.
2. The embedding Mt ,! M 2 S-grmodd induces (by simple degree considera-
tions) an isomorphism
Homd.L`; Mt/

! Homd.L`; M/
for all d  t  ` C d.
In particular, Dm;d.M/ Š Dm;d.Mt/ for any t  d and we are allowed to
replace M by any of its truncations.
3. For M 2 S-grmodd take t  d large enough such that the submodule Mt has
no S-grmod0
d-torsion. Then
Homd.m`; M/ Š Homd.m`; Mt/ Š Homd.˝`m; Mt/
for all `  t  d by (2) and Remark 3.10. An admissible choice is t WD
linregd M C 1, then `  t  d  ıM;d (cf. Lemma 4.2). In particular, after
replacing M by a high enough truncation we can assume that Homd.m`; M/ Š
Homd.˝`m; M/.
4. Since the shift functor .1/ W S-grmodd ! S-grmoddC1; M 7! M.1/; ' 7!
'.1/ is (quasi-)inverse to the shift functor .1/ W S-grmoddC1 ! S-grmodd
and Dm;d ı .1/ D .1/ ı Dm;dC1 we can restrict the following proofs to
Dm;0.
Proof (of Theorem 4.6) We use Theorem 2.1. Due to Remark 4.8.(4) we only need
to consider the case d D 0.
2.1.(1) C 	 ker Dm;0:
Applying Remark 4.8.(1) with L D S (and LL D S` D m`/ we
conclude that Dm vanishes8 on S-grmod0 and Dm;0 on S-grmod0
0.
2.1.(2) Dm;0.A / 	 SatC .A /:
For any M 2 A , the map
Hom0 .S  - m; Dm;0.M// D Hom0
S  - m; Hom0.mıM;0; M/
D Hom0
S  - m; Hom0.˝ıM;0m; M/
8For N 2 C all modules in the sequential colimit deﬁning Dm;0.N/ vanish for `  ıN;0 < 1.

36
M. Barakat and M. Lange-Hegermann
D Hom0

˝ıM;0m  - ˝ıM;0C1m; M

D Hom0
˝ıM;0m; M ! Hom0

˝ıM;0C1m; M

D Hom0
mıM;0; M ! Hom0

mıM;0C1; M

is an isomorphism by Lemma 4.2 proving statement (5) of Corollary 3.11.
We have repeatedly used Remark 4.8.(3) and the adjunction between ˝ and
Hom0.
2.1.(3) G WD co-resSatC .A / Dm;0 is exact:
Applying Hom0.m`; / to the short exact sequence L ,! M  N in
S-grmod0 yields the exact sequence
Hom0.m`; L/ ,! Hom0.m`; M/ ! Hom0.m`; N/ ! Ext1
0.m`; L/
as part of the long exact covariant Ext0-sequence. Since Ext1
0.m`; L/
is quasi-zero by Remark 3.3.(3) the sequence is exact up to defects in
S-grmod0
0.
2.1.(4) 
Dm;0 D Dm;0
:
We repeatedly use the adjunction between ˝ and Hom0 and Lemma 4.2
to interchange the involved sequential colimits over `0 and `00 by a common
`  `0; `00, high enough to stabilize both colimits:

Dm;0.M/ D lim
!
`0
Hom0.S  - m`0; lim
!
`00
Hom0.m`00; M//
D Hom0.S  - m`; Hom0.m`; M//
D Hom0..S  - m`/ ˝S m`; M/
D Hom0.m`; Hom0.S  - m`; M//
D lim
!
`00
Hom0.m`00; lim
!
`0
Hom0.S  - m`0; M//
D Dm;0.
M/.
The proof implicitly uses commuting diagrams of morphisms in S-grmod0
to justify the equality signs.9
2.1.(5) 
	 is a natural isomorphism:
9We could have used the fact that Dm;0 D lim
!` Hom0.m`; / commutes with directed colimits.
However, the general form of the second statement is not quite trivial [8, Coro. 3.4.11] (the directed
colimit is called direct limit in [8, Terminology 3.4.1]). Note that although the ideal transform
commutes with directed colimits, it does not generally commute with arbitrary ﬁnite colimits, for
otherwise it would be right exact and hence exact.

A Constructive Approach to the Module of Twisted Global Sections
37
Let M
2
S-grmod0 be saturated w.r.t. S-grmod0
0. Applying
Hom0.; M/ to the short exact sequence S=m`  S  - m` yields
Hom0.S=m`; M/
„
ƒ‚
…
Š0
,! M

`
M
! Hom0.m`; M/  Ext1
0.S=m`; M/
„
ƒ‚
…
Š0
since S=m` 2 S-grmod0
0. In other words, 
`
M is an isomorphism for all `.ut
Remark 4.9 The saturation process of M 2 S-grmod conducted by Dm brings linreg
to 1, whereas reg is only brought down to the regularity of the sheaﬁﬁcation.
Since the Frobenius powers mŒ` WD hx`
0; : : : ; x`
ni satisfy m`  mŒ`  m.nC1/` we
can use them instead of m` them in the above sequential colimits. They are com-
putationally superior since their number of generators does not increase with `. In
other words, the module Homd.mŒıM;d; M/ is S-grmod0
d-saturated. Alternatively,
one could iteratively (ıM;d times) apply Homd.m; / to (the S-grmod0
d-torsion-
free factor of) M. It depends on the example which algorithm is faster.
5
Graded S-Modules and Linear E-Complexes
In this section we describe how to translate the module structure of M 2 S-grmod
into the structure of a linear complex R.M/ over the exterior algebra E WD ^V,
which is Koszul dual to S D Sym V. This translation turns out to be functorial,
algorithmic, and an adjoint equivalence of categories. We denote the category of
ﬁnitely generated graded E-modules by E-grmod.
Let e0; : : : ; en denote a B-basis V of which the indeterminates x0; : : : ; xn of S
form the dual B-basis of W D V D HomB.V; B/. We set deg.ei/ D 1 for all
i D 0; : : : ; n.
5.1
The Functor R
The B-linear maps
i.xj/ W Mi ! MiC1; m 7! xjm;
for j D 0; : : : ; n; and i 2 Z
induced by the indeterminates xj encode the graded S-module structure of an M 2
S-grmod (cf. Algorithm 3.1 for an algorithm to compute Mi).

38
M. Barakat and M. Lange-Hegermann
Example 5.1 For S WD BŒx0; x1 consider the free S-module M WD S D S.0/ of rank
1. Each graded part Mi is a free B-module for which we ﬁx a basis of monomials,
e.g., M0 D h1iB, M1 D hx0; x1iB, M2 D hx2
0; x0x1; x2
1iB. Then the matrices
0 W
0.x0/ D . 1 0 / , 0.x1/ D . 0 1 / ;
1 W
1.x0/ D
 1 0 0
0 1 0

, 1.x1/ D
 0 1 0
0 0 1

;
:::
represent the maps i.xj/.
Using the B-basis .e0; : : : ; en/ of V deﬁne for each i 2 Z the map i as the
composition
i W
 Mi ! EndB.V/ ˝B Mi ! V ˝B MiC1;
m 7!
idV ˝m
7! Pn
iD0 ej ˝ xjm .
By the natural isomorphism HomB.Mi; V˝BMiC1/ Š HomE-grmod.E˝BMi; E˝B
MiC1/ each i can equally be understood as a map of graded E-modules
i W E ˝B Mi ! E ˝B MiC1,
where the B-module Mj is considered as a graded B-module concentrated in degree
j and, therefore, E ˝B Mj is generated by (a generating set of) Mj in degree j.
For a better functorial behavior we replace E by its B-dual [12, §16C]
!E WD HomB.E; B/ Š ^W Š ^nC1W ˝B E
in the above maps.10 In particular, !E lives in the degree interval 0; : : : ; n C 1 and
its socle .!E/0, which is naturally isomorphic to B, is concentrated in degree 0. We
denote the distinguished generator of the socle corresponding to 1B by 1!E.
This change of language is justiﬁed by reinterpreting i W Mi ! V ˝B MiC1 as a
map i W W ˝B Mi ! MiC1 using the adjunction
HomB.W ˝B X; Y/ Š HomB.X; HomB.W; Y// Š HomB.X; W ˝B Y/.
The graded E-module !E ˝B Mj has (compared with E ˝B Mj) the advantage of
having the B-module Mj as its socle interpreted as a graded E-module concentrated
in degree j.
10It is again a free graded E-module which is nonnaturally isomorphic to E.n  1/.

A Constructive Approach to the Module of Twisted Global Sections
39
The commutativity of S implies that the composed map iC1 ı i W !E ˝B Mi !
!E ˝B MiC2 is zero. Thus, the sequence of i’s yields the so-called R-complex
(cf. [11, §2] and [10, §2])
R.M/ W    ! !E ˝B Mi
i
! !E ˝B MiC1
iC1
! !E ˝B MiC2 !   
Example 5.2 (Example 5.1 Continued) For M D S.0/ we obtain the R-complex
0
!E.0/1. e0 e1 /
!E.1/2 . e0 e1 	
	 e0 e1 /
!E.2/3
 e0 e1 	
	
	 e0 e1 	
	
	 e0 e1

!E.3/4
  
Lemma 5.3 ([11, Prop. 2.3]) There exists a natural isomorphism
Ha.R.M//aCi Š TorS
i .B; M/aCi.
Proof The idea is to interpret the bigraded differential module !E ˝B M either as
R.M/ or as the Koszul resolution of B tensored with M over S.
ut
Lemmas 5.3 and 3.5 imply the following lemma, an important technical insight
for the rest of this paper.
Lemma 5.4 (Key Lemma) There exists a natural isomorphism
Ha.R.M//aCi Š ExtnC1i

.^nC1V; M/aCi.
Hence, there is a noncanonical isomorphism Ha.R.M//aCnC1j Š Ext j
.B; M/aj.
Let A be either S or E. An epimorphism in A-grmod is said to be B-split if it
splits as a morphism over B. A graded module P 2 A-grmod is said to be relatively
projective (with respect to B) if HomS.P; / sends B-split epis to surjections. Any
module of the form A ˝B M, where M is a B-module, is called relatively free (with
respect to B). By Eisenbud and Schreyer [10, Proposition 1.1], an N 2 A-grmod is
relatively projective if and only if it is relatively free.
A complex C D C of graded E-modules is called linear if each Ci is relatively
free (with respect to B) with socle concentrated in degree i.11 The regularity of a
linear complex C is deﬁned as
reg C WD supfa 2 Z j Ha.C/ ¤ 0g 2 Z [ f1; 1g.
Lemma 5.3 or 5.4 connects the regularity of a graded module with that of its
R-complex.
Corollary 5.5 For M 2 S-grmod the equality reg M D reg R.M/ holds.
These deﬁnitions allow us to describe the image of R.
11And hence Ci is generated in degree i C n C 1.

40
M. Barakat and M. Lange-Hegermann
Deﬁnition 5.6 We denote by E- grlin the full subcategory of complexes C of graded
E-modules satisfying
1. C is linear;
2. each Ci is ﬁnitely generated;
3. C is left bounded;
4. reg C < 1.
By E- grlin0 we denote the thick subcategory of bounded complexes.
Finally, for any d 2 Z, denote by E- grlind the full subcategory of complexes in
E- grlin with C<d D 0 and by E- grlind;0 WD E- grlind \ E- grlin0.
Remark 5.7 An object C 2 E- grlind can be represented on a computer by the
ﬁnite complex Cd ! CdC1 ! : : : ! Cj1 ! Cj provided that j > reg C. The
part C>j of C can be recovered by an injective resolution of coker.Cj1 ! Cj/. This
relatively injective resolution is isomorphic to Hom.; E/ applied to a relatively
projective resolution of Hom.coker.Cj1 ! Cj/; E/. A morphisms in E- grlin
can be represented on the computer by a chain morphism between two such ﬁnite
complexes, one only needs to extend these complexes to equal cohomological
degrees. Again, the part of the morphism in higher cohomological degrees can be
computed by an injective resolution.
Proposition 5.8 The construction R induces two fully faithful functors R
W
S-grmod ! E- grlin and Rd W S-grmodd ! E- grlind for all d 2 Z.
Proof As M 2 S-grmod is ﬁnitely generated, R.M/ is left bounded. By deﬁnition,
each R.M/i D !E ˝B Mi is a ﬁnitely generated graded relatively free module
with socle Mi concentrated in degree i. Furthermore reg R.M/ D reg M < 1 by
Corollary 5.5.
A graded morphism ' W M ! N induces morphisms 'i W Mi ! Ni for all i 2 Z.
Tensoring with !E yields morphisms R.'/i W R.M/i ! R.N/i. These morphisms
are chain morphisms, as xj ı 'i D 'iC1 ı xj and the i are induced by the xj for all
i 2 Z and all 0  j  n.
Restricting R to S-grmodd corestricts to E- grlind by construction. These
functors are obviously faithful. The fullness R and Rd follows directly from the
below Proposition 5.9 and Corollary 5.10, respectively.
ut
5.2
The Functor R Induces an Equivalence
The functor R is an equivalence S-grmod

! E- grlin by Eisenbud et al. [11,
Prop. 2.1]. In this section we explicitly construct the left adjoint quasi-inverse M
of R and thus show constructively that R is an adjoint equivalence.
Proposition 5.9 There exists a functor M W E- grlin ! S-grmod such that M a R
is an adjoint equivalence of categories which sends S-grmod0 to E- grlin0.

A Constructive Approach to the Module of Twisted Global Sections
41
Proof Let .C; / 2 E- grlin.
For a preparatory step, assume that
Hr.C/ is the only nonvanishing cohomology (this implies that C<r D 0/:
(A)
Consider r W W ˝B Cr
r ! CrC1
rC1 and extend ker.r/
! W ˝B Cr
r to a map S ˝B
ker.r/ ! S ˝B Cr
r. Deﬁne M.C/ as its cokernel (with relatively free presentation
r W S ˝B Cr
r  M.C/).
To justify the correctness of this preparatory step let M 2 S-grmod with M<r D 0
and such that R.M/ satisﬁes assumption (A). The natural isomorphismeı1 W Mr

!
M.R.M//r W m 7! 1S ˝B 1!E ˝B m identiﬁes a minimal set of generators M with
one of M.R.M//. The assumption (A) for R.M/ is equivalent, by Lemma 5.3, to
M being generated in degree r and having a relatively free resolution which is
linear in the xi. In particular, the only relations involving the indeterminates xi of
the ﬁnite set of generators of M in Mr are linear relations. All these linear relations
are encoded in the map R.M/r ! R.M/rC1. The construction of M above just
imposes these linear relations of the generators of M to the generators of M.R.M//.
In particular,eı induces an isomorphism ıM W M.R.M// ! M. Similarly, there exists
an isomorphism 
C W C ! R.M.C// for any C 2 E- grlin satisfying assumption (A).
For a general .C; / 2 E- grlin, there is a bound r (e.g., any r > reg.C/) such
that the preparatory step applies to .Cr; r/. Then, we inductively deﬁne M.C/
by decreasing the cohomological degree d. Let .C; / 2 E- grlin be a complex and
d < r such that M.CdC1/ is deﬁned by the induction hypothesis with relatively free
presentation dC1 W S ˝B .CdC1
dC1 ˚: : : ˚Cr
r/  M.CdC1/. We deﬁne M.Cd/ as a
pushout of the span of ˇ and  deﬁned as follows: Let ˛ W S˝BW ! S W p˝xi ! xip
and 	 W CdC1
dC1 ,! CdC1
dC1 ˚ : : : ˚ Cr
r be the embedding in the direct sum. Now set
ˇ WD ˛ ˝B Cd
d and  WD dC1 ı .S ˝B .	 ı d// with common source S ˝B W ˝ Cd
d
(recall, d W W ˝B Cd
d ! CdC1
dC1). This inductive step of the construction of M is the
reverse construction of R.
To apply M to a morphism ' W C ! D in E- grlin we use the identiﬁcation of
M.C/i with Ci
i, map Ci
i using 'i to Di
i, which we ﬁnally identify with M.D/i.
This equivalence of categories is an adjoint equivalence. We already have
constructed the unit 
 and counit ı as natural isomorphisms in the preparatory step.
This unit and counit naturally extends into lower cohomological degrees using the
natural B-isomorphisms Ci
i

! M.C/i W c 7! 1S ˝B c and Mi

! R.M/i
i W m 7!
1!E ˝B m. The triangle identities are easily veriﬁed.
ut
Corollary 5.10 The restriction-corestriction Md W E- grlind ! S-grmodd of
M and the functor Rd form an adjoint equivalence Md a Rd, which sends
S-grmod0
d to E- grlind;0.

42
M. Barakat and M. Lange-Hegermann
5.3
Saturated Linear Complexes
We now give a characterization of saturated linear complexes corresponding to the
one we gave for graded modules.
Deﬁnition 5.11 The linear regularity of a linear complex C
2
E- grlin is
deﬁned as
linreg C WD maxfa 2 Z j Ha.C/aCnC1 ¤ 0 or Ha.C/aCn ¤ 0g 2 Z [ f1g.
We get a further characterization of E- grlin0-saturated linear complexes.
Corollary 5.12 A complex C 2 E- grlin is E- grlin0-saturated iff linreg C D 1.
Proof The module M.C/ is S-grmod0-saturated if Ext j
.B; M.C// D 0 for j 2 f0; 1g
by Proposition 3.9. This is equivalent to Ha.R.M.C///aCnC1j D 0 for j 2 f0; 1g
by the key Lemma 5.4. The claim follows from C Š R.M.C//.
ut
The key Lemma 5.4 also implies:
Corollary 5.13 linreg C D linreg M.C/ for all C 2 E- grlin.
The localizing subcategory S-grmod0
d of S-grmodd corresponds via the adjoint
equivalence M a R to the full localizing subcategory E- grlind;0 of right bounded
complexes in E- grlind, i.e., of those complexes C 2 E- grlind with C` D 0
for ` large enough. A module M 2 S-grmodd is then S-grmod0
d-saturated if
and only if R.M/ is E- grlind;0-saturated, i.e., the adjoint equivalence Md a
.Rd W S-grmodd ! E- grlind/ restricts to an adjoint equivalence between the
full subcategories of S-grmod0
d-saturated resp. E- grlind;0-saturated objects.
The deﬁnition of the linear regularity of complexes in E- grlind and the char-
acterization of E- grlind;0-saturated linear complexes is a little bit more subtle and
is therefore deferred to the next section. The reason is that the lowest cohomology
Hd.C/ has to be treated separately.
6
Saturation of Linear Complexes
The ideal transform in Sect. 4 leads to an algorithm for the saturation of graded
S-modules. In this section, we present an algorithm to saturate linear complexes. The
adjoint equivalence M a R translates this to a second algorithm for the saturation
of graded S-modules.
Corollary 5.12 indicates that one has to modify a linear complex C until the
conditions Ha.C/aCnC1 D 0 and Ha.C/aCn D 0 hold. Our purely linear saturation
is similar to that of the Tate resolution in that one truncates C in cohomological
degree high enough and then computes a suitable part in lower cohomological
degrees. In contrast to the Tate resolution, our approach remains in the category

A Constructive Approach to the Module of Twisted Global Sections
43
of linear complexes, as we do not take free presentations of kernels to compute
the part of lower cohomological degree, but so-called purely linear kernels. We
can also truncate above the linear regularity, a lower bound of the Castelnuovo-
Mumford regularity. For the relation between the purely linear saturation and the
Tate resolution see Remark 7.4.
6.1
Purely Linear Kernels
Let Ci; CiC1 2 E-grmod be relatively free with socle concentrated in degree i and
i C 1, respectively.12 We call a morphism 'i W Ci ! CiC1 purely linear (of degree
i) if its kernel vanishes in the top degree i C n C 1.
Deﬁnition 6.1 Let 'i W Ci ! CiC1 be purely linear of degree i. A purely linear
morphism  W Ki1 ! Ci of degree i  1 with 'i ı  D 0 is called purely linear
kernel if for any purely linear  W Li1 ! Ci of degree i  1 with 'i ı  D 0 there
exists a unique morphism  W Li1 ! Ki1 with  ı  D .
Lemma 6.2 Each purely linear morphism has a purely linear kernel, which, by the
universal property, is unique up to a unique isomorphism.
Proof We denote the restriction of any morphism ˇ to the graded part of degree
i C n by ˇiCn.
Let 'i W Mi ! MiC1 be purely linear of degree i and  W Ni1 ,! Mi be its
kernel. Denote by Ki1 WD Ni1
iCn ˝B E and by  W Ki1 ! Ni1 the map induced by
the identity on Ni1
iCn. We show that  WD  ı  W Ki1 ! Mi is a purely linear kernel
of 'i.
By deﬁnition, Ki1 and Mi are relatively free generated in degree iCn and degree
i C n C 1, respectively. As 'i is purely linear, Ni1 lives in the degree interval
i; : : : ; iCn. In particular, iCn is a kernel of 'i
iCn. By deﬁnition, iCn W Ki1
iCn ! Ni1
iCn
is an isomorphism and thus also iCn is a kernel of 'i
iCn. In particular, the kernel of
 lives in the degree interval i  1; : : : ; i C n  1. Thus,  is purely linear of degree
i  1.
The composition 'i ı  is zero and  factors over  by construction. Thus, 'i ı
 D 0.
12Or, equivalently, freely generated in degree i C n C 1 and i C n C 2, respectively.

44
M. Barakat and M. Lange-Hegermann
To show the universal property of  let 'i1 W Mi1 ! Mi be purely linear with
'i ı 'i1 D 0. From the universal property of iCn as a kernel, there exists a unique
 iCn W Mi1
iCn ! Ki1
iCn with iCn ı  iCn D 'i1
iCn, since 'i1
iCn ı 'i
iCn D 0. We deﬁne
 WD  iCn ˝B E W Mi1 Š Mi1
iCn ˝B E ! Ki1 Š Ki1
iCn ˝B E,
which extends  iCn to a morphism of graded E-modules. Finally, 'i1 D  ı  
since iCn ı  iCn D 'i1
iCn and 'i1 is uniquely determined by 'i1
iCn.
ut
Note that all steps in the proof of this last lemma are constructive.
We can now state the deﬁnition of linear regularity for complexes in E- grlind.
Deﬁnition 6.3 Deﬁne for any d

0 the d-th truncated linear regularity
linregd C of C 2 E- grlind as an element of Zd [ f1g as follows:
If there exists an a 2 Z>d such that Ha.C/aCnC1 ¤ 0 or Ha.C/aCn ¤ 0 then
linregd C WD maxfa 2 Z>d j Ha.C/aCnC1 ¤ 0 or Ha.C/aCn ¤ 0g 2 Z>d.
Otherwise, if the lowest morphism Cd ! CdC1 is a purely linear kernel (of CdC1 !
CdC2) then linregd C WD 1 else linregd C WD d.
Corollary 6.4 C 2 E- grlind is E- grlind;0-saturated iff linregd C D 1.
Proof The claim follows from Corollaries 5.12 and 3.11 (by Remark 4.8.(4) we
only need to consider the case d D 0).
ut
Corollary 6.5 linregd C D linregd Md.C/ for all C 2 E- grlind.
Proposition 6.6 A .C; / 2 E- grlind, is E- grlind;0-saturated if and only if i is
the purely linear kernel of iC1 for all i  d.
Proof By the proof of Lemma 6.2, a morphism  W Ki1 ! Mi is a purely linear
kernel of a purely linear morphism 'i W Mi ! MiC1 of degree i if and only if it is
purely linear and Ki1
! Mi 'i
! MiC1 is a complex which is exact in degrees i C n
and i C n C 1. Now, the claim follows from the characterizations of saturated linear
complexes in Corollary 6.4.
ut

A Constructive Approach to the Module of Twisted Global Sections
45
6.2
Saturation of a Linear Complex
In this subsection we algorithmically saturate linear complexes by iteratively
computing purely linear kernels.
Let .C; / 2 E- grlind with regularity r 2 Z. Deﬁne the purely linear
saturation (truncated in degree d) functor Sd W E- grlind ! E- grlind as
follows. The idea is to truncate the complex above the linear regularity and then to
“saturate” it recursively by purely linear kernels, more precisely: For cohomological
degrees greater than the linear regularity r D linregd C deﬁne SrC1 by setting
SrC1.C; / WD .CrC1; rC1/. Assume that .Di; i/ D Si.C; / is deﬁned
for some i > d. Let i1 W Di1 ! Di be the purely linear kernel of i. Deﬁne
Si1.C; / by adding i1 to .Di; i/ in cohomological degree i  1.
The morphism part Sd.'/ for ' W .C; C/ ! .C0; C0/ in E- grlind is induced
by the identity in high degrees. The universal property of the purely linear kernels
implies a unique completion of the square and thus iteratively constructs the chain
morphisms in lower degrees.
Theorem 6.7 Let A D E- grlind and C WD E- grlind;0. There exists a natural
transformation 
 W IdA ! Sd such that the purely linear saturation Sd truncated
in degree d together with this natural transformation 
 is a Gabriel monad of A
w.r.t. C .
Again, the statement of the theorem is valid for all d 2 Z. The statement of the
following immediate corollary and the proof the theorem assume d  0.
Corollary 6.8 The nonnegative integer maxflinregd C  d C 1; 0g is the precise
count of recursion steps needed to achieve saturation.
Thus, the linear regularity yields a better bound for computing zeroth cohomolo-
gies and saturation than the Castelnuovo-Mumford regularity does. However, the
data structure for E- grlind suggested in Remark 5.7 still requires the Castelnuovo-
Mumford regularity.
Proof (of Theorem 6.7) First, we construct the natural transformation 
C for the
complex .C; / 2 E- grlind. Consider the cochain-isomorphism 
C W Cr !
Sr.C/ induced by the identity for r > linregd C. Assume that 
C is lifted to a
cochain morphism C`C1 ! S`C1.C/. The universal property of the purely linear
kernels implies a completion of the square by a morphism 
`
C W C` ! Sd.C/`.
Iteratively, we get the cochain-morphism 
C W C ! Sd.C/.

46
M. Barakat and M. Lange-Hegermann
Now, we use Theorem 2.1 to show that Sd together with 
 is a Gabriel monad.
2.1.(1) C 	 ker Sd:
As 
C is an isomorphism in high cohomological degrees, its kernel is
contained in C .
2.1.(2) Sd.A / 	 SatC .A /:
Sd.C/ has only trivial cohomologies above the regularity of C. Below
the regularity we use Proposition 6.6.
2.1.(3) G WD co-resSatC .A / Sd is exact:
As Sd is the identity on objects and morphism in high cohomological
degree, applying it to a short exact sequence in A yields a new sequence
with A -defects, which are bounded by the maximum of the regularities
of said short exact sequence. Thus, the A -defects are contained in C . In
particular, this sequence is exact when considered in SatA .C /.
2.1.(4) 
Sd D Sd
:
Truncated at cohomological degree ` above the regularity this is clear,
since both natural transformations are induced by the identity. For lower
degrees, this follows from the uniqueness of the universal morphism  in
the deﬁnition of purely linear kernels.
2.1.(5) 
	 is a natural isomorphism:
Let C 2 A be C -saturated. We need to show that 
C is a cochain
isomorphism. This is clear in high cohomological degrees, as Sd is the
identity on objects and morphism there. Assume that 
C restricted to
C`C1 ! S`C1.C/ for some ` 2 Z is a cochain isomorphism. Then, the
morphism 
`
C from the completion of the square is an isomorphism, since
both C and Sd.C/ are saturated and, by Proposition 6.6 C` and Sd.C/` are
purely linear kernels of `C1 and the morphism in cohomological degree
` C 1 of Sd.C/, respectively. The uniqueness of purely linear kernels
implies that 
C restricted to C` ! S`.C/ is a cochain isomorphism, and
so is 
C by induction.
ut
We stress that the above functors M, Md, R, Rd, and Sd are constructive
functors between constructively Abelian categories. We furthermore note that
computing the natural transformation 
 is constructive.

A Constructive Approach to the Module of Twisted Global Sections
47
7
The Gabriel Monad of the Category of Coherent Sheaves
In this section we prove that the quotient category S-grmodd=S-grmod0
d is
equivalent to the category Coh Pn
B for any d 2 Z and that the corresponding Gabriel
monad computes the (truncated) module of twisted global sections.
Proposition 7.1 Coh Pn
B ' S-grmodd=S-grmod0
d for all d 2 Z.
Proof The deﬁnitions directly imply S-grmod0 \ S-grmodd D S-grmod0
d. Now,
a preimage of M 2 S-grmod=S-grmod0 under S-grmodd ! S-grmod=S-grmod0
is given by Md, since M Š Md in S-grmod=S-grmod0. Hence, the second
isomorphism theorem for Abelian categories [4, Prop. 3.2] implies the equivalence
S-grmodd=S-grmod0
d ' S-grmod=S-grmod0.
The latter category is equivalent to Coh Pn
B by Barakat and Lange-Hegermann [4,
Coro. 4.2].
ut
A graded S-modules M is called quasi ﬁnitely generated if each truncation Md
is ﬁnitely generated. We denote by S-qfgrmod 	 S-grMod the full subcategory of
such modules. The functor
H0
 W Coh Pn
B ! S-qfgrmod W F 7!
M
p2Z
H0.Pn
B; F.p//
computing the module of twisted global sections is right adjoint to the sheaﬁﬁcation
functor Sh W S-qfgrmod ! Coh Pn
B; M 7! e
M. This was proved by Serre in the
absolute case [13, 59] and later by Grothendieck for the relative case.
Denote by Shd W S-grmodd ! Coh Pn
B the restriction of Sh to S-grmodd and
by
H0
d W Coh Pn
B ! S-grmodd W F 7!
M
p2Zd
H0.Pn
B; F.p//
the functor computing the truncated module of twisted global sections. It follows
that H0
d is the right adjoint of Shd.
Proposition 7.2 The monad H0
d.e / D H0
d ı Shd is a Gabriel monad of
S-grmodd w.r.t. the localizing subcategory S-grmod0
d. In particular, any Gabriel
monad computes the truncated module of twisted global sections.
Proof Let Qd W S-grmodd ! S-grmodd=S-grmod0
d be the canonical functor.
The equivalence in Proposition 7.1 is constructed as a functor
˛d W S-grmodd=S-grmod0
d ! Coh Pn
B

48
M. Barakat and M. Lange-Hegermann
with ˛d ı Qd ' Shd. An easy calculation shows that a right adjoint of Qd
is given by Sd WD H0
d ı ˛d. In particular, Sd ı Qd is a Gabriel monad of
S-grmodd w.r.t. S-grmod0
d by Barakat and Lange-Hegermann [3, Lemma 4.3].
Now the claim follows, as SdıQd D H0
dı˛dıQd ' H0
dıShd D H0
d.e /.
ut
Corollary 7.3 There exist natural isomorphisms
H0
d.e
M/ Š Dm;d.M/
and
R

H0
d.e
M/

Š Sd.R.M//,
in particular for i  d
H0.e
M.i// Š .Dm;d.M//i Š

Sd.R.M//
i
i .
Remark 7.4 In the absolute case, i.e., when B D k is a ﬁeld, the (objects of
the truncated) Tate resolution Td.M/ relate to the higher cohomology modules
Hq
d.e
M/ by Eisenbud et al. [11]
Td.M/i D
minfn;idg
M
qD0
!E ˝k Hq e
M.i  q/

,
(*)
while the (truncated) purely linear saturation directly extracts H0:
Sd.R.M//i D !E ˝B H0 e
M.i/

.
In the relative case the analogue of (*) is more subtle: The Tate resolution
Td.M/ is by its bi-graded structure in fact a multi-complex Td;.M/. Since
each multi-complex is a ﬁltered complex and hence induces a spectral sequence13
Ep;q.Td;.M// H) 0, where for each row-complex on the ﬁrst page the following
isomorphism holds
Ed;q
1

Td;.M/

Š R

Hq
d.e
M/

.
This is implicit in [10], see also [11, Corollary 3.6]. Thus, the relation between the
purely linear saturation and the Tate resolution is given by
Ed;0
1

Td;.M/

Š Sd.R.M// Š R

H0
d.e
M/

.
13The vertical morphisms of this multi-complex are the morphisms between the graded summands
represented by scalar matrices (i.e., degree zero in E). This differs from the MACAULAY2
convention used in [10], where these morphisms are arranged “diagonally up and to the right”
(cf. [10, Chapter 3]). Hence, we do not arrange the direct summands of the modules in the Tate
resolution vertically, but diagonally up and to the left.

A Constructive Approach to the Module of Twisted Global Sections
49
The ﬁrst isomorphism is not a priori obvious in the relative case and gives a direct
way to compute R

H0
d.e
M/

via Sd.R.M// without computing (most of) the Tate
resolution.14
References
1. W.W. Adams, P. Loustaunau, An Introduction to Gröbner Bases. Graduate Studies in
Mathematics, vol. 3 (American Mathematical Society, Providence, RI, 1994). MR 1287608
(95g:13025)
2. M. Barakat, M. Lange-Hegermann, An axiomatic setup for algorithmic homological alge-
bra and an alternative approach to localization. J. Algebra Appl. 10(2), 269–293 (2011).
arXiv:1003.1943. MR 2795737 (2012f:18022)
3. M. Barakat, M. Lange-Hegermann, On monads of exact reﬂective localizations of Abelian cat-
egories. Homology Homotopy Appl. 15(2), 145–151 (2013). arXiv:1202.3337. MR 3138372
4. M. Barakat, M. Lange-Hegermann, Characterizing Serre quotients with no section functor and
applications to coherent sheaves. Appl. Categ. Struct. 22(3), 457–466 (2014). arXiv:1210.1425.
MR 3200455
5. M. Barakat, M. Lange-Hegermann, Gabriel morphisms and the computability of Serre
quotients with applications to coherent sheaves (2014). arXiv:1409.2028
6. M. Barakat, M. Lange-Hegermann, On the Ext-computability of Serre quotient categories.
J. Algebra 420, 333–349 (2014). arXiv:1212.4068. MR 3261464
7. I.N. Bernšte˘ın, I.M. Gel’fand, S.I. Gel’fand, Algebraic vector bundles on Pn and problems of
linear algebra. Funktsional. Anal. i Prilozhen. 12(3), 66–67 (1978). MR 509387 (80c:14010a)
8. M.P. Brodmann, R.Y. Sharp, Local Cohomology: An Algebraic Introduction with Geometric
Applications. Cambridge Studies in Advanced Mathematics, vol. 60 (Cambridge University
Press, Cambridge, 1998). MR 1613627 (99h:13020)
9. W. Decker, D. Eisenbud, Sheaf algorithms using the exterior algebra, in Computations in
Algebraic Geometry with Macaulay 2. Algorithms and Computation in Mathematics, vol. 8
(Springer, Berlin, 2002), pp. 215–249. MR 1949553
10. D. Eisenbud, F.-O. Schreyer, Relative Beilinson monad and direct image for families of
coherent sheaves. Trans. Am. Math. Soc. 360(10), 5367–5396 (2008). arXiv:math/0506391.
MR 2415078 (2009f:14030)
11. D. Eisenbud, G. Fløystad, F.-O. Schreyer, Sheaf cohomology and free resolutions over exterior
algebras. Trans. Am. Math. Soc. 355(11), 4397–4426 (2003). (electronic). MR 1990756
(2004f:14031)
12. T.Y. Lam, Lectures on Modules and Rings. Graduate Texts in Mathematics, vol. 189 (Springer,
New York, 1999). MR 1653294 (99i:16001)
13. J.-P. Serre, Faisceaux algébriques cohérents. Ann. Math. (2) 61, 197–278 (1955). MR 0068874
(16,953c)
14. W.V. Vasconcelos, Computational Methods in Commutative Algebra and Algebraic Geometry.
Algorithms and Computation in Mathematics, vol. 2 (Springer, Berlin, 1998). With chapters
by David Eisenbud, Daniel R. Grayson, Jürgen Herzog and Michael Stillman. MR 1484973
(99c:13048)
14In absolute case B D k the isomorphism easily follows from the fact that the bottom complex
Ed;0
1

Td;.M/

of the ﬁrst spectral sequence is already the subcomplex of the Tate resolution
consisting of those direct summands of the objects in Td.M/ where the degree of the socle equals
the cohomological degree.

Local to Global Algorithms for the
Gorenstein Adjoint Ideal of a Curve
Janko Böhm, Wolfram Decker, Santiago Laplagne, and Gerhard Pﬁster
Abstract We present new algorithms for computing adjoint ideals of curves and
thus, in the planar case, adjoint curves. With regard to terminology, we follow
Gorenstein who states the adjoint condition in terms of conductors. Our main
algorithm yields the Gorenstein adjoint ideal G of a given curve as the intersection of
what we call local Gorenstein adjoint ideals. Since the respective local computations
do not depend on each other, our approach is inherently parallel. Over the rationals,
further parallelization is achieved by a modular version of the algorithm which ﬁrst
computes a number of the characteristic p counterparts of G and then lifts these to
characteristic zero. As a key ingredient, we establish an efﬁcient criterion to verify
the correctness of the lift. Well-known applications are the computation of Riemann-
Roch spaces, the construction of points in moduli spaces, and the parametrization of
rational curves. We have implemented different variants of our algorithms together
with Mnuk’s approach in the computer algebra system SINGULAR and give timings
to compare the performance.
Keywords Adjoint ideals • Singularities • Algebraic curves
2010 Mathematics Subject Classiﬁcation
Primary 14Q05; Secondary 14H20,
14H50, 68W10
J. Böhm () • W. Decker • G. Pﬁster
Fachbereich Mathematik, Technische Universität Kaiserslautern, Postfach 3049, 67653
Kaiserslautern, Germany
e-mail: boehm@mathematik.uni-kl.de; decker@mathematik.uni-kl.de;
pﬁster@mathematik.uni-kl.de
S. Laplagne
Departamento de Matemática, Facultad de Ciencias Exactas y Naturales, Ciudad Universitaria,
1428 Pabellón I, Buenos Aires, Argentina
e-mail: slaplagn@dm.uba.ar
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_3
51

52
J. Böhm et al.
1
Introduction
In classical algebraic geometry, starting from Riemann’s paper on abelian functions
[53], the adjoint curves of an irreducible plane curve  have been used as an
essential tool in the study of the geometry of  . The deﬁning property of an adjoint
curve is that it passes with “sufﬁciently high” multiplicity through the singularities
of  . There are several ways of making this precise, developed in classical papers
by Brill and Noether [14], Castelnuovo [16, 17], and Petri [52], and in more recent
work by Gröbner [36], Gorenstein [27] and van der Waerden [59], Keller [42]. We
refer to [29, 30, 41], and [19] for results comparing the different notions: whereas
the adjoint condition given by Brill and Noether is more restrictive, the notions of
adjoint curves given by the other authors above coincide.
In this paper, we always consider adjoint curves in the less restrictive sense. In
fact, we rely on Gorenstein’s algebraic deﬁnition which states the adjoint condition
at a singular point P 2  by considering the conductor of the local ring O;P in its
normalization. It is a well-known consequence of Max Noether’s Fundamentalsatz
that the adjoint curves of any given degree m cut out, residual to a ﬁxed divisor
supported on the singular locus of  , a complete linear series. Of fundamental
importance is the case m D deg   3 which, as shown by Gorenstein, yields the
canonical series.
The ideal generated by the deﬁning forms of the adjoint curves of  is called the
adjoint ideal of  . In [1], the concept of adjoint ideals is extended to the non-planar
case: consider a non-degenerate integral curve  	 Pr
k D Proj.S/, and let I be a
saturated homogeneous ideal of S properly containing the ideal of  . Then I is an
adjoint ideal of  if its homogeneous elements of degree m 
 0 cut out, residual to
a ﬁxed divisor whose support contains the singular locus, a complete linear series.
As pointed out in [1], the existence of adjoint ideals is implicit in classical papers:
examples are the Castelnuovo adjoint ideal and the Petri adjoint ideal. In [19],
it is shown that Gorenstein’s condition leads to the largest possible adjoint ideal,
supported on the singular locus and containing all other adjoint ideals, and referred
to as the Gorenstein adjoint ideal G D G. /. See [19] for some remarks on how
the different concepts of adjoint ideals compare in the non-planar case.
With regard to practical applications, adjoint curves enter center stage in the
classical Brill-Noether algorithm for computing Riemann-Roch spaces, which in
turn can be used to construct Goppa codes (see [43]). Furthermore, linear series
cut out by adjoint curves allow us to construct explicit examples of smooth curves
via singular plane models; a typical application is the experimental study of moduli
spaces of curves. If the geometric genus of a plane curve  is zero, then the adjoint
curves of degree deg  2 specify a birational map to a rational normal curve. Based
on this, we can ﬁnd an explicit parametrization of  over its ﬁeld of deﬁnition,
starting either from the projective line or a conic. See [5] and the implementation in
the SINGULAR library [8]. Algorithms for parametrization, in turn, have applications
in computer aided design, for example, to compute intersections of curves with other
algebraic varieties. See also [55].

Algorithms for the Gorenstein Adjoint Ideal of a Curve
53
A well-known algorithm for computing the Gorenstein adjoint ideal G D G. /
in the planar case is due to Mnuk [50]. This algorithm makes use of linear algebra to
obtain G from an integral basis for the normalization kŒC, where C is an afﬁne part
of  containing all singularities of  . Efﬁcient ways of ﬁnding integral bases rely
on Puiseux series techniques (see [10, 60]). This somewhat limits Mnuk’s approach
to characteristic zero. The same applies to the algorithm of El Kahoui and Moussa
[26], which also computes the Gorenstein adjoint ideal of a plane curve from an
integral basis of kŒC. The approach of Orecchia and Ramella [51], on the other
hand, is limited to curves with ordinary multiple points only.
In this paper, we present a new algorithm for computing G. This algorithm is
highly efﬁcient and not restricted to the planar case, special types of singularities,
or to characteristic zero. The basic idea is to compute G as the intersection of “local
Gorenstein ideals”, one for each singular point of  . Each local ideal is obtained
via Gröbner bases, starting from a “local contribution” to the normalization kŒC at
the respective singular point. To ﬁnd these contributions, we use the algorithm from
[6] which is a local variant of the normalization algorithm designed in [34, 35].
Our approach is already faster per se. In addition, it can take advantage of
handling special classes of singularities in an ad hoc way. Above all, it is inherently
parallel. For input over the rationals, further parallelization is achieved by a
modular version of the algorithm which ﬁrst computes a number of characteristic
p counterparts of G and then lifts these to characteristic zero. This allows us, in
addition, to avoid intermediate coefﬁcient growth over the rationals. To apply the
general rational reconstruction scheme from [11], we prove an efﬁcient criterion
to verify the correctness of the lift. Note that the local-to-global approach is
particularly useful when combined with modular methods: By Chebotarev’s density
theorem [58], the primes p for which the singular locus decomposes over Fp have
positive density among all primes, provided the singular locus is decomposable
over Q.
Our paper is organized as follows: In Sect. 2, we discuss algorithmic normal-
ization. In Sect. 3, we review the deﬁnition of adjoint ideals and some related
facts. In Sect. 4, we describe global algorithmic approaches to obtain G. We ﬁrst
discuss Mnuk’s approach. Then we describe a global approach which relies on
normalization and Gröbner bases. In Sects. 5 and 6, we present our local to global
algorithm for ﬁnding G via normalization and Gröbner bases. Section 7 pays
particular attention to the planar case, commenting on the direct treatment of special
types of singularities. In Sects. 8 and 9, we discuss the modular version of our algo-
rithm. Finally, in Sect. 10, we compare the performance of the different approaches,
relying on our implementations in the computer algebra system SINGULAR [21],
and running various examples coming from algebraic geometry.

54
J. Böhm et al.
2
Algorithms for Normalization
We begin with some general remarks on normalization and the role played by the
conductor. For these, let A be any reduced Noetherian ring, and let Q.A/ be its total
ring of fractions. Then Q.A/ is again a reduced Noetherian ring. We write
Spec.A/ D fP 	 A j P prime idealg
for the spectrum of A. The vanishing locus of an ideal J of A is the set V.J/ D fP 2
Spec.A/ j P  Jg.
The normalization of A, written A, is the integral closure of A in Q.A/. We call A
normalization-ﬁnite if A is a ﬁnite A-module, and we call A normal if A D A.
We denote by
N.A/ D fP 2 Spec.A/ j AP is not normalg
the non-normal locus of A, and by
Sing.A/ D fP 2 Spec.A/ j AP is not regularg
the singular locus of A.
Remark 2.1 Note that N.A/ 	 Sing.A/. Equality holds if A is of pure dimension
one. Indeed, a Noetherian local ring of dimension one is normal iff it is regular (see
[23, Thm. 4.4.9]).
Deﬁnition 2.2 If R 	 S is an extension of rings, the conductor of A in B is
CS=R D AnnR.S=R/ D fr 2 R j rS 	 Rg :
Note that CS=R is the largest ideal of R which is also an ideal of S.
Remark 2.3 Specializing to the normalization, we write
CA D CA=A D AnnA.A=A/ D fa 2 A j aA 	 Ag.
Note that CA can be naturally identiﬁed with HomA.A; A/ (see [57, Lemma 2.4.2]).
Lemma 2.4 We have N.A/ 	 V.CA/. Furthermore, A is normalization-ﬁnite iff CA
contains a non-zerodivisor of A. In this case, N.A/ D V.CA/.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
55
Proof See [32, Lemmas 3.6.1, 3.6.3].
Remark 2.5 (Splitting of Normalization) Finding the normalization can be reduced
to the case of integral domains: If P1 : : : ; Ps are the minimal primes of A, then
A Š A=P1      A=Ps
(see [23, Thm. 1.5.20]).
Remark 2.6 Let k be a ﬁeld. An afﬁne k-domain is a ﬁnitely generated k-algebra
which is an integral domain. By Emmy Noether’s ﬁniteness theorem (see [25,
Cor. 13.13]), any such domain is normalization-ﬁnite, and its normalization is an
afﬁne k-domain as well. Geometrically, by gluing, this implies that any integral
algebraic variety X over k admits a (unique) normalization map  W X ! X, where
 is a ﬁnite morphism and, hence, the normal scheme X is an algebraic variety over
k as well (see, for example, [45, Sec. 4.1.2]). Speciﬁcally, by Remark 2.1, if  is an
integral algebraic curve over k, we get the nonsingular model  W  !  .
Deﬁnition 2.7 A homomorphism A ! B of reduced Noetherian rings is called
normal if it is ﬂat and if for every P 2 Spec.A/ and every ﬁeld extension L of
AP=PAP, the ring B ˝A L is normal.
Remark 2.8 (Base Change) Let ` 	 k be a separable ﬁeld extension, and let A be a
ﬁnitely generated reduced `-algebra. Then A ! A˝` k is a normal homomorphism,
so that A ˝` k is a normal ring (see [57, Propositions 19.1.1, 19.1.2, Thm. 19.4.2]).
On the other hand, by Swanson and Huneke [57, Thm. 19.5.1], we may identify
A ˝` k with the integral closure of A ˝` k in Q.A/ ˝` k. In turn, since every non-
zerodivisor of A is a non-zerodivisor of A˝`k, we may regard Q.A/˝`k as a subring
of Q.A˝` k/, and thus A˝` k as a subring of A ˝` k. Since A˝` k is already normal,
we conclude that A ˝` k D A ˝` k. In particular,
CA˝`k Š HomA˝`k.A ˝` k; A ˝` k/ D HomA˝`k.A ˝` k; A ˝` k/
D HomA˝`k.A ˝A .A ˝` k/; A ˝A .A ˝` k// Š HomA.A; A/ ˝` k
Š CA ˝` k
(see [25, Prop. 2.10] for the second to last identity).
Now, we brieﬂy discuss algorithmic normalization. We begin by recalling the
normalization algorithm of Greuel et al. [34], which is an improvement of de Jong’s
algorithm (see [20, 22]). This algorithm, to which we refer as the GLS Algorithm,
is based on the normality criterion of Grauert and Remmert. To state this criterion,
we need:

56
J. Böhm et al.
Lemma 2.9 Let A be a reduced Noetherian ring, and let J 	 A be an ideal which
contains a non-zerodivisor g of A. Then:
1. If ' 2 HomA.J; J/, the fraction '.g/=g 2 A is independent of the choice of g,
and ' is multiplication by '.g/=g.
2. There are natural inclusions of rings
A 	 HomA.J; J/ Š 1
g.gJ WA J/ 	 A 	 Q.A/; a 7! 'a; ' 7! '.g/
g
;
where 'a is multiplication by a.
Proof See [32, Lemmas 3.6.1, 3.6.3].
Proposition 2.10 (Grauert and Remmert Criterion)
Let A be a reduced Noethe-
rian ring, and let J 	 A be a radical ideal which contains a non-zerodivisor g of
A and satisﬁes V.CA/ 	 V.J/. Then A is normal iff A Š HomA.J; J/ via the map
which sends a to multiplication by a.
Proof See [28], [32, Prop. 3.6.5].
Deﬁnition 2.11 A pair .J; g/ as in the proposition is called a test pair for A, and J
is called a test ideal for A.
If k is a ﬁeld and A is an afﬁne k-domain, then test pairs exist by Lemma 2.4
and Emmy Noether’s ﬁniteness theorem. If, in addition, k is perfect, an explicit test
pair can be found by applying the Jacobian criterion (see [25, Thm. 16.19] for this
criterion). In fact, in this case, we may choose the radical of the Jacobian ideal M
together with any non-zero element g of M as a test pair. Given a test pair .J; g/, the
basic idea of ﬁnding A is to enlarge A by a sequence of ﬁnite extensions of afﬁne
k-domains
AiC1 D HomAi.Ji; Ji/ Š 1
g.gJi WAi Ji/ 	 A 	 Q.A/;
with A0 D A and test ideals Ji D pJAi, until the Grauert and Remmert criterion
allows one to stop. According to [34], each Ai can be represented as a quotient
1
di Ui 	 Q.A/, where Ui 	 A is an ideal and di 2 Ui is non-zero. In this way, all
computations except those of the radicals Ji may be carried through in A.
Example 2.12 For
A D CŒx; y D CŒX; Y=hX5  Y2 .Y  1/3i,
the radical of the Jacobian ideal is
J WD hx; y .y  1/iA ,

Algorithms for the Gorenstein Adjoint Ideal of a Curve
57
so that we can take .J; x/ as a test pair. Then, in its ﬁrst step, the normalization
algorithm yields
A1 D 1
x U1 D 1
x
˝
x; y.y  1/2˛
A .
In the next steps, we get
A2 D 1
x2 U2 D 1
x2
˝
x2; xy.y  1/; y.y  1/2˛
A
and
A3 D 1
x3 U3 D 1
x3
˝
x3; x2y.y  1/; xy.y  1/2; y2.y  1/2˛
A .
In the ﬁnal step, we ﬁnd that A3 is normal and, hence, equal to A.
Next, we describe the local to global variant of the GLS algorithm given in
[6]. This variant is a considerable enhancement of the algorithm which serves as a
motivation for our local to global approach to compute the Gorenstein adjoint ideal.
It is based on the following two observations from [6]: First, the normalization A
can be computed as the sum of local contributions A 	 A.i/ 	 A, and second, local
contributions can be obtained efﬁciently by a local variant of the GLS algorithm.
For our purposes, it is enough to present the relevant results in a special case. Here,
as usual, if P is a prime of a ring R, and M is an R-module, we write MP for the
localization of M at R n P.
Proposition 2.13 Let A be an afﬁne domain of dimension one over a ﬁeld k, and let
Sing.A/ D fP1; : : : ; Psg be its singular locus. For i D 1; : : : ; s, let an intermediate
ring A 	 A.i/ 	 A be given such that A.i/
Pi D APi. Then
s
X
iD1
A.i/ D A.
Proof See [6, Prop. 15].
Deﬁnition 2.14 A ring A.i/ as above is called a local contribution to A at Pi. It is
called a minimal local contribution if A.i/
Pj D APj for j ¤ i.
The computation of local contributions is based on the modiﬁed version of the
Grauert and Remmert criterion below:
Proposition 2.15 Let A be an afﬁne domain of dimension one over a ﬁeld k, let
A 	 A0 be a ﬁnite ring extension, let P 2 Sing.A/, and let J0 D
p
PA0. If
A0 Š HomA0.J0; J0/
via the map which sends a0 to multiplication by a0, then A0
P is normal.

58
J. Böhm et al.
Proof See [6, Prop. 16].
Considering an afﬁne domain A of dimension one over a perfect ﬁeld k, let P 2
Sing.A/. Choose P together with a non-zero element g 2 P instead of a test pair as
in Deﬁnition 2.11. Then, proceeding as before, we get a chain of afﬁne k-domains
A 	 A1 	    	 Am 	 A
such that Am is a local contribution to A at P.
Remark 2.16 Given A as above, a ﬁnite ring extension A 	 A0, and a prime P 2
Sing.A/, let Q 2 Sing.A/ be a prime different from P, and let J0 D
p
PA0. Then
HomA0.J0; J0/Q Š HomA0
Q.J0
Q; J0
Q/
Š HomA0
Q.A0
Q; A0
Q/ Š A0
Q
(see [25, Proposition 2.10] for the ﬁrst identity). Inductively, this shows that the
algorithm outlined above computes a minimal local contribution to A at P. Note that
such a contribution is uniquely determined since, by deﬁnition, its localization at
each Q 2 Spec.A/ is determined.
Example 2.17 In Example 2.12, there are two singularities, namely P1 D hx; yi and
P2 D hx; y  1i. Geometrically, these are a singularity of type A4 at .0; 0/ and a
threefold point of type E8 at .0; 1/. For P1, the local normalization algorithm yields
AP1 D . 1
d1 U1/P1, where
d1 D x2 and U1 D
˝
x2; y.y  1/3˛
A .
For P2, we get AP2 D . 1
d2 U2/P2, where
d2 D x3 and U2 D
D
x3; x2y2 .y  1/ ; y2 .y  1/2E
A .
Combining the local contributions, we get
1
dU D 1
d1
U1 C 1
d2
U2;
with d D x3 and
U D
D
x3; xy.y  1/3; x2y2 .y  1/ ; y2 .y  1/2E
A .
Note that U coincides with the ideal U3 computed in Example 2.12.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
59
In the following sections we will use the notation below:
Notation 2.18 Given an afﬁne algebraic curve C 	 Ar
k over a ﬁeld k with vanishing
ideal I.C/ and a point1 P 2 C, if I 	 kŒX1; : : : ; Xr is an ideal properly containing
I.C/, we will write IP D IOC;P for the local ideal of I at P. Similarly for a projective
algebraic curve  	 Pr
k and a homogeneous ideal I 	 kŒX0; : : : ; Xr.
3
Adjoint Ideals
Let k be a ﬁeld, and let  	 Pr
k be an integral non-degenerate projective algebraic
curve. Write S D kŒX0; : : : ; Xr for the homogeneous coordinate ring of Pr
k, I. / 	
S for the homogeneous vanishing ideal of  , kŒ  D S=I. / for the homogeneous
coordinate ring of  , and Sing. / for the singular locus of  .
Let  W  !  be the normalization map, let P be a point of  , and let O;P be
the local ring of  at P. Then the normalization O;P is a semi-local ring whose
maximal ideals correspond to the points of  lying over P. Furthermore, O;P
is ﬁnite over O;P, so that O;P=O;P is a ﬁnite-dimensional k-vector space. The
dimension
ıP. / D ı.O;P/ D dimk O;P=O;P
is called the delta invariant of  at P. The arithmetic genus of  is pa. / D
1  P .0/, where P is the Hilbert polynomial of kŒ . Making use of the (global)
delta invariant
ı. / D P
P2Sing. /ıP. /
of  , the geometric genus p. / of  is given by
p. / D p. / D pa. /  ı. /
(see [39]). If  is a plane curve of degree n, we have pa. / D
n1
2

.
Following the presentation in [18], we now recall the deﬁnition and characteri-
zation of adjoint ideals due to [1] and [19]. Let I D L
m0 Im 	 S D kŒX0; : : : ; Xr
be a saturated homogeneous ideal properly containing I. /. Pulling back Proj.S=I/
via , we get an effective divisor .I/ on  . Let H be a divisor on  given as
the pullback of a hyperplane in Pr
k. Then, since any divisor on  cut out by a
homogeneous polynomial in I is of the form D C .I/ for some effective divisor D,
1The term point will always refer to a closed point.

60
J. Böhm et al.
we have natural linear maps
%m W Im ! H0 
 ; O .mH  .I//

;
for all m  0.
Remark 3.1 Consider the exact sequence
0 !eIO ! .eIO / ! F ! 0;
whereeI is the ideal sheaf on Pr
k associated to I, and F is the cokernel. Twisting by
m 
 0 and taking global sections, we get the exact sequence
0 ! H0
;eIO .m/

! H0
 ;eIO .mH/

! H0 .; F/ ! 0:
Indeed, F has ﬁnite support and, since the normalization map  is ﬁnite, we have
H0
 ;eIO .mH/

Š H0
; .eIO /.m/

. SinceeIO .mH/ D O

mH.I/

and,
for m 
 0, H0
;eIO .m/

D Im=I. /m, we get, for m 
 0, the exact sequence
0 ! Im=I. /m
%m
! H0 
 ; O .mH  .I//

! H0 .; F/ ! 0:
In particular, for m 
 0,
ker.%m/ D I. /m:
Deﬁnition 3.2 With notation and assumptions as above, the ideal I is called an
adjoint ideal of  if the maps
%m W Im ! H0 
 ; O .mH  .I//

are surjective for m 
 0.
As already remarked in the introduction, the existence of adjoint ideals is
classical. Locally, adjoint ideals are characterized by the following criterion:
Theorem 3.3 The ideal I is an adjoint ideal of  iff IP D IPO;P for all P 2
Sing. /.
Proof Using the notation from Remark 3.1, we have, for m 
 0,
dimk coker%m D h0 .; F/ D
X
P2Sing. /
`.IPO;P=IP/.
Hence, %m is surjective iff IPO;P D IP for all P 2 Sing. /.
Corollary 3.4 If I is an adjoint ideal of  and P 2 Sing. /, then IP ¤ O;P.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
61
Proof Suppose IP D O;P. Then IP ¤ IPO;P, a contradiction to Theorem 3.3.
Corollary 3.5 The support of Proj.S=I/ contains Sing. /.
Proof Follows immediately from Corollary 3.4.
Theorem 3.6 There is a unique largest homogeneous ideal G 	 S which satisﬁes
GP D CO;P for all P 2 Sing. /:
The ideal G is an adjoint ideal of  containing all other adjoint ideals of  . In
particular, G is saturated and Proj.S=G/ is supported on Sing. /.
Proof For the conductor ideal sheaf C D AnnO .O =O / on  , we have CP D
CO;P for all P 2  . If j W  ! Pr
k is the inclusion, then the graded S-module
G D L
n2ZH0.Pr
k; jC .n// associated to jC is the unique largest homogeneous
ideal with GP D CO;P for all P 2 Sing. /. By Theorem 3.3 and the properties of
the conductor, G is an adjoint ideal. Moreover, if I is any other adjoint ideal, then
IP 	 GP for all P 2  , hence I 	 G.
Deﬁnition 3.7 With notation as in Theorem 3.6, the ideal G is called the Gorenstein
adjoint ideal of  . We also write G. / D G.
For repeated subsequent use, we introduce the following notation:
Notation 3.8 Given an integral non-degenerate projective algebraic curve  	 Pr
k,
let C be the afﬁne part of  with respect to the chart
Ar
k ,! Pr
k, .X1; : : : ; Xr/ 7! .1 W X1 W    W Xr/ :
Let I.C/ 	 k ŒX1; : : : ; Xr be the vanishing ideal of C, let
kŒC D kŒx1; : : : ; xr D kŒX1; : : : ; Xr=I.C/
be its coordinate ring, and let Sing.C/ be the set of singular points of C.
Proposition 3.9 Let C be the afﬁne part of  in the chart X0 ¤ 0 as in Notation 3.8,
and let G be the ideal of kŒC obtained by dehomogenizing G with respect to X0
and mapping the result to kŒC. Then
G D CkŒC.
If  has no singularities at inﬁnity and CkŒC D hgi.x1; : : : ; xr/ j i D 1; : : : ; mikŒC,
with polynomials gi 2 kŒX1; : : : ; Xr, then G is the homogenization of the ideal
hgi.X1; : : : ; Xr/ j i D 1; : : : ; mikŒX1;:::;Xr C I.C/
with respect to X0.

62
J. Böhm et al.
Proof The ﬁrst assertion is obtained by localizing at the points of C:
GP D COC;P D .CkŒC/P for each P 2 C.
Here, the ﬁrst equality is clear from the deﬁnition of G (see Theorem 3.6). The
second equality holds since forming the conductor commutes with localization since
kŒC is normalization-ﬁnite (see [61, Ch. V, § 5]).
The second assertion follows from the ﬁrst one since there are no singularities at
inﬁnity, G is saturated, and the support of G is contained in C.
Remark 3.10 (Base Change) Suppose that  is deﬁned over a subﬁeld ` of k such
that ` 	 k is separable, and let  .`/ 	 Pr
` be the set of `-rational points of  . Then
it follows from Remark 2.8 and Proposition 3.9 that
ı. .`// D ı. / and G. .`//kŒX0; : : : ; Xn D G. /:
We now take a moment to specialize to plane curves.
Remark 3.11 Assume  is a plane curve. Then, by Max Noether’s Fundamental-
satz, the maps %m W Gm ! H0 
 ; O .mH  .G//

are surjective for all m.
Referring to each homogeneous polynomial in G not contained in I. / as an adjoint
curve to  , this means that residual to .G/, the adjoint curves of any degree m cut
out the complete linear series Am D jmH  .G/j. See [59, § 49].
Theorem 3.12 Assume  is a plane curve of degree n. Then, residual to .G/, the
elements of Gn3 cut out the complete canonical linear series. Equivalently,
deg .G/ D 2ı. /:
(1)
Proof See [27, Thm. 9].
Recall that the dimension of the canonical linear series is dim An3 D p. /  1.
Remark 3.13 Assume  is a plane curve of degree n. If p. / D 0, that is,  is
rational, then dim An2 D deg An2 D n  2, and the image of  under An2 is
a rational normal curve n2 	 Pn2
k
of degree n  2. Via the birational morphism
n2 !  , the problem of parametrizing  is reduced to parametrizing the smooth
curve n2. For the latter, we may successively decrease the degree of the rational
normal curve by 2 via the anti-canonical linear series. This yields an isomorphism
from n2 either to P1 or to a plane conic, depending on whether n is odd or even.
We will now return to the general case and discuss a version of Eq. (1) which is
also valid if  is not necessarily planar. In fact, this equation characterizes adjoint
ideals. We use the following notation: If I 	 S is a homogeneousideal, write deg I D
deg Proj.S=I/. That is, degI is .dim I1/Š times the leading coefﬁcient of the Hilbert
polynomial of S=I.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
63
Lemma 3.14 Let I 	 S be a saturated homogeneous ideal with I. / ¤ I. Then
deg .I/  deg I C ı. /;
and I is an adjoint ideal of  iff
deg .I/ D deg I C ı. /.
Proof Let P .t/ D .deg  /  t  pa. / C 1 be the Hilbert polynomial of kŒ .
Denote by I the image of I in kŒ . Then, for m 
 0,
deg I D dimk.Sm=Im/ D dimk.kŒ m=.I /m/ D P .m/  dimk.I /m.
Moreover, by Remark 3.1 and with notation as in that remark,
h0 
 ; O .mH  .I//

D dimk.I /m C h0 .; F/  dimk.I /m
for m 
 0. Hence, by Riemann-Roch, we have
.deg  /  m  deg .I/ D deg jmH  .I/j D dim jmH  .I/j C p. /
 dimk.I /m  1 C p. /
D P .m/  deg I  1 C p. /
D .deg  /  m  ı. /  deg I
for m 
 0 since jmH  .I/j is non-special for large m by reason of its degree. For
such m, equality holds iff %m is surjective.
Remark 3.15 In the case where  is a plane curve and I D G is its Gorenstein
adjoint ideal, Lemma 3.14 shows that Eq. (1) may be rewritten as
deg G D ı. /.
(2)
Note that (1) and (2) may not hold in the non-planar case:
Example 3.16 ([23, Example 5.2.5]) Let  	 P3
C be the image of the parametriza-
tion
P1
C ! P3
C, .s W t/ 7! .s5 W t3s2 W t4s W t5/:
Then  has exactly one singularity at .1 W 0 W 0 W 0/. Furthermore, p. / D 0 and
pa. / D 2, hence ı. / D 2. However, G D hX1; X2; X3i 	 CŒX0; : : : ; X3, hence
deg G D 1.

64
J. Böhm et al.
Remark 3.17 If  	 Pr
k is any curve as in Notation 3.8, with afﬁne part C and no
singularities at inﬁnity, then it follows from Proposition 3.9 that
deg G D dimk

kŒC=CkŒC

D P
P2Sing.C/ dimk.OC;P=COC;P/:
Lemma 3.18 If char k D 0, then dimk.O;P=CO;P/  ıP. / for any point P 2  .
Proof This follows from the case k D C proved in [31, 2.4] by base change (see
Remark 2.8).
Now recall that a point P 2 Sing. / is called a Gorenstein singularity if
dimk.O;P=CO;P/ D ıP. /.
Example 3.19 Plane curve singularities are Gorenstein (see, for example, [23,
Corollary 5.2.9]).
Corollary 3.20 We have:
1. If char k D 0, then deg G  ı. /.
2. If  has only Gorenstein singularities, then
deg G D ı. / and deg .G/ D 2ı. /:
Proof This is clear from the discussion above.
We now begin with the discussion of how to compute the Gorenstein adjoint
ideal. One possible way of ﬁnding G is to apply the global algorithms presented in
Sect. 4.2 below, starting from the normalization kŒC, and relying on Proposition 3.9.
To compute kŒC, in turn, we may use the local to global approach outlined in Sect. 2.
As we will see, however, it is more efﬁcient to directly proceed with a local to global
approach for ﬁnding G, computing local Gorenstein adjoint ideals at the singular
points, and obtaining G as their intersection. This will be the theme of Sects. 5 and 6,
while in Sect. 7, focusing on the case of plane curves, we will write down explicit
generators for the local Gorenstein adjoint ideals at various types of singularities.
Remark 3.21 With regard to implementing Proposition 3.9 as a part of the global
algorithms, we note that if k is inﬁnite, then the assumption on the singularities can
always be achieved by a projective change of coordinates deﬁned over k. If k is
ﬁnite, however, we may have to replace k by an algebraic extension ﬁeld of k. Our
local to global algorithm, on the other hand, does not require a coordinate change.
If  is deﬁned over a subﬁeld ` of k such that ` 	 k is separable, then it follows
from Remark 3.10 that we may ﬁnd the Gorenstein ideal by computations over `.
If  is deﬁned over Q, we will use the equality
deg G D deg .G/  ı. /

Algorithms for the Gorenstein Adjoint Ideal of a Curve
65
from Lemma 3.14 to compute degG without actually knowing G, and apply this in
the ﬁnal veriﬁcation step of our modularized adjoint ideal algorithm (see Sects. 8
and 9). In fact, we will present a modular approach to computing deg .G/, and
we will use standard techniques to compute ı. /. For the latter, ﬁrst note that the
delta invariant of  differs from that of a plane model of  by the quantity pa. /
deg  1
2

. The delta invariant of a plane curve, in turn, can be computed locally at
the singular points, either from the semigroups of values of the analytic branches of
the singularity (see [23, 33]), or from a formula relating the local delta invariant to
the Milnor number (see Remark 7.3 in Sect. 7).
Remark 3.22 Let  	 Pr
k be a curve with afﬁne part C as in Notation 3.8 and
no singularities at inﬁnity. Then computing deg .G/ also means to compute the
dimension dimk

kŒC=CkŒC

:
deg .G/ D ı. / C deg G
D dimk

kŒC=kŒC

C dimk

kŒC=CkŒC

D dimk

kŒC=CkŒC

:
4
Global Approaches
4.1
Computing the Conductor via the Trace Matrix
We will require some facts from classical ideal theory (see [61, Ch. V] for details
and proofs): Let R be an integral domain, and let K D Q .R/ be its quotient ﬁeld.
A fractionary ideal of R is an R-submodule b of K admitting a common denomina-
tor: there is an element 0 ¤ d 2 R such that db 	 R.
Example 4.1 The extensions Ai computed by the normalization algorithms from
Sect. 2 are fractionary ideals of the given afﬁne domain A.
If b; b0 are two fractionary ideals of R, with b0 non-zero, then b W b0 D fz 2 K j
z b0 	 bg is a fractionary ideal of R as well. A fractionary ideal b of R is invertible
if there is a fractionary ideal b0 of R such that b  b0 D R. In this case, b0 is uniquely
determined and equal to R W b.
Suppose in addition that R is normal. Let K0 be a ﬁnite separable extension of K,
and let R0 be an integral extension of R such that K0 D Q .R0/. Moreover, let
TrK0=K W K0 ! K, z 7!
X
g2Gal.K0=K/
g.z/,
be the corresponding trace map. Then the complementary module
CR0=R WD
˚
z 2 K0 j TrK0=K

zR0
	 R
	

66
J. Böhm et al.
of R0 with respect to R is a fractionary ideal of R0 containing R0. Hence, the different
DR0=R D R0 W CR0=R D
˚
z 2 K0 j zCR0=R 	 R0	
D
˚
z 2 K0 j zx 2 R0 for all x 2 K0 with TrK0=K

xR0
	 R
	
of R0 over R is a non-zero ideal of R0.
Now, keeping our assumptions, we focus on the case where R is a Dedekind
domain, and where R0 is the integral closure of R in K0. Then R0 is a Dedekind
domain as well, which implies that every non-zero fractionary ideal of R0 is
invertible. On the other hand, by the primitive element theorem, there is an element
y 2 R0 with K0 D K.y/. Denote by f.Y/ 2 KŒY the minimal polynomial of y over
K. Then, as shown in [61, Ch. V],
f 0.y/R0 D CR0=RŒyDR0=R,
hence
CR0=RŒy D f 0.y/CR0=R:
(3)
We now ﬁx the following setup:
Notation 4.2 Let k be a ﬁeld, and let  	 P2
k be a plane curve of degree n deﬁned
by an irreducible polynomial F 2 kŒX; Y; Z. Suppose that the equation f 2 kŒX; Y
of the afﬁne part C of  in the chart
A2
k ,! P2
k, .X; Y/ 7! .1 W X W Y/ ;
is monic in Y.
Write kŒC D kŒx; y D kŒX; Y=h f.X; Y/i for the afﬁne coordinate ring of C and
k.C/ D k.x; y/ D k.X/ŒY=h f.X; Y/i
for its function ﬁeld. Then x is a separating transcendence basis of k.C/ over k, and y
is integral over kŒx, with integral equation f.x; y/ D 0. In particular, kŒC is integral
over kŒx, which implies that kŒC coincides with the integral closure kŒx of kŒx in
k.C/. Furthermore, kŒC is a free kŒx-module of rank
n WD degy. f/ D Œk.C/ W k.x/.
Deﬁnition 4.3 An integral basis for kŒC is a set b0; : : : ; bn1 of free generators for
kŒC over kŒx:
kŒC D kŒxb0 ˚    ˚ kŒxbn1.
Remark 4.4 Since k.C/ D k.x; y/ D k.X/ŒY=h fi, any element ˛ 2 k.C/ can be
represented as a polynomial in k.X/ŒY of degree less than n D deg f. Hence, we

Algorithms for the Gorenstein Adjoint Ideal of a Curve
67
may associate to ˛ a well-deﬁned degree degy .˛/ in y and a smallest common
denominator in kŒx of the coefﬁcients of ˛. In particular, kŒC has an integral
basis .bi/ in triangular form, that is, with degy.bi/ D i, for i D 0; : : : ; n  1
(see [10, Remark 1.4]). If not stated otherwise, all integral bases considered here
will be of this form. In principle, such a basis can be found by applying one of
the normalization algorithms discussed earlier (see [10, Remark 1.5]). However,
in the characteristic zero case, methods relying on Puiseux series techniques are
much more efﬁcient (see [10] and [60]). Note that when using these methods, we
temporarily may have to pass to an algebraic extension ﬁeld of k.
Example 4.5 An integral basis for the curve considered in Examples 2.12, 2.17 is
given below:
1; y; y.y  1/
x
; y.y  1/2
x2
; y2.y  1/2
x3
.
Using Proposition 3.9 and Eq.(3), with R D kŒx, R0 D kŒC, K D k.x/, and
K0 D k.C/, we get Algorithm 1.
Algorithm 1 Gorenstein adjoint ideal via linear algebra (see Mnuk [50])
Input: A plane curve  over a perfect ﬁeld k with afﬁne part C as in Notation 4.2
and no singularities at inﬁnity.
Output: The Gorenstein adjoint ideal G of  .
1: Compute an integral basis .bi/iD0;:::;n1 for kŒC.
2: Compute the (symmetric and invertible) trace matrix
T D

Trk.C/=k.x/

bibj

i;jD0;:::;n1 2 k.x/nn:
3: Compute a decomposition L  R D P  T, where L is left triangular matrix
with diagonal entries equal to one, R is a right triangular matrix, and P is a
permutation matrix.
4: For j D 0; : : : ; n  1, use forward and backward substitution to compute

j D
n1
X
iD0
sijbi;
where

sij

D T1. The 
j are kŒx-module generators for CkŒC=kŒx. By Eq. (3),
CkŒC D h @f
@Y .x; y/ 
j j j D 0; : : : ; n  1i.
5: Let C be the ideal of kŒX; Y generated by representatives of minimal y-degree
of the @f
@Y .x; y/ 
j, j D 0; : : : ; n  1.
6: return the homogenization of C with respect to X0.

68
J. Böhm et al.
Example 4.6 Let  	 P2
C be the projective closure of the curve C with afﬁne
equation
X5  Y2 .1  Y/3 D 0
as in Examples 2.12, 2.17, and 4.5. From the integral basis
1; y; y.y  1/
x
; y.y  1/2
x2
; y2.y  1/2
x3
.
given in Example 4.5, we compute the trace matrix
T D
0
BBBBB@
5
3
0
0
0
3
3
0
0
5x2
0
0
0
5x2 3x
0
0
5x2 3x
0
0 5x2 3x
0
0
1
CCCCCA
;
which yields by forward and backward substitution
CCŒC D
D
x3; x2 .y  1/ ; xy .x  1/ ; y .y  1/2E
CŒC .
Homogenization gives the Gorenstein ideal G which can be decomposed using
primary decomposition:
G D ˝X2; Y˛ \
D
X3; X .Y  Z/ ; .Y  Z/2E
.
Note the two ideals on the right hand side correspond to the two singularities of C.
This somewhat motivates the local to global algorithm discussed in Sects. 5 and 6
below, where G will be found as the intersection of local Gorenstein ideals.
4.2
Computing the Adjoint Ideal via Ideal Quotients
The algorithm presented in what follows relies on normalization and ideal quotients.
It is not limited to plane curves.
Proposition 4.7 Let  	 Pr
k be a curve with afﬁne part C as in Notation 3.8.
Write kŒC D
1
dU, where U 	 kŒC is an ideal and d 2 U is non-zero. Then the
conductor is
CkŒC D hdikŒC W U.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
69
Algorithm 2 Gorenstein adjoint ideal via ideal quotients
Input: A curve  	 Pr
k over a perfect ﬁeld k with afﬁne part C as in Notation 3.8
and no singularities at inﬁnity.
Output: The Gorenstein adjoint ideal G of  .
1: Normalization: Compute polynomials d; a0; : : : ; as 2 kŒX1; : : : ; Xr such that
the fractions ai.x1;:::;xr/
d.x1;:::;xr/ generate kŒC as a kŒC-module.
2: Compute the ideal quotient
C D .hdi C I.C// W .ha0; : : : ; asi C I.C// 	 kŒX1; : : : ; Xr:
3: return the homogenization of C with respect to X0.
Proof By deﬁnition,
CkŒC D
n
s 2 kŒC j s  kŒC 	 kŒC
o
D
˚
s 2 kŒC j s  g 2 hdikŒC for all g 2 U
	
D hdikŒC W U:
Using once more Proposition 3.9, we get Algorithm 2.
Example 4.8 In Example 4.6,
a0 D X3; a1 D X2Y.Y  1/; a2 D XY.Y  1/2; a3 D Y2.Y  1/2;
and d D X3. Hence,
hd; fi W ha0; : : : ; a3; fi D
D
X3; X2 .Y  1/ ; XY .Y  1/ ; Y .Y  1/2E
:
5
A Local to Global Approach
In this section, motivated by the local to global approach for normalization, we
introduce local Gorenstein adjoint ideals of a given curve  and show how to ﬁnd
the Gorenstein adjoint ideal G of  as their intersection. Together with the algorithm
presented in the next section, which computes the local ideals, this yields a local to
global approach for ﬁnding G. As we will see in Sect. 10, this approach is per se
faster than the algorithms discussed so far. In addition, it is well-suited for parallel
computations.

70
J. Böhm et al.
We consider a curve  	 Pr
k as in Notation 3.8.
Deﬁnition 5.1 Let W 	 Sing. / be any set of singular points of  . The local
Gorenstein adjoint ideal of  at W is deﬁned to be the largest homogeneous ideal
G.W/ 	 S which satisﬁes
G.W/P D CO;P for all P 2 W:
(4)
For a single point P 2 Sing. /, we write G.P/ WD G.fPg/.
Remark 5.2 Since G.W/ is the largest homogeneous ideal satisfying (4), it is
saturated and Proj.S=G.W// is supported on W.
Proposition 5.3 Let W 	 Sing. /. Then
G.W/ D T
P2WG.P/.
Proof This is immediate from the deﬁnition: If G0 WD T
P2WG.P/, then Proj.S=G0/
and Proj.S=G.W// have the same support W, and
G0
Q D G.Q/Q D CO;Q D G.W/Q
for all Q 2 W, hence G.W/ D G0.
Proposition 5.3 yields Algorithm 3.
Remark 5.4 It is clear from Proposition 5.3 that we may choose any partition
Sing. / D Ss
iD1Wi of Sing. / and have
G D Ts
iD1G.Wi/.
This is useful in that for some subsets Wi, specialized approaches or a priori know-
ledge may ease the computation of G.Wi/. In Sect. 7, focusing on plane curves, we
will present some ideas in this direction.
Algorithm 3 Gorenstein adjoint ideal, local to global
Input: A curve  	 Pr
k over a perfect ﬁeld k as in Notation 3.8.
Output: The Gorenstein adjoint ideal G of  .
1: Compute Sing. / D fP1; : : : ; Psg.
2: Apply Algorithm 4 in Sect. 6 below to compute G .Pi/ for all i.
3: return Ts
iD1G .Pi/.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
71
6
Computing Local Adjoint Ideals
In this section, we modify Algorithm 2 so that it computes the local Gorenstein
adjoint ideal of  at a point P from a minimal local contribution to kŒC at P via
ideal quotients.
Fix a curve  	 Pr
k as in Notation 3.8, a point P 2 Sing. /, and an afﬁne chart
containing P. For simplicity of the presentation, we stick with the chart X0 ¤ 0, and
let C be the afﬁne part of  as before. Consider an ideal U 	 kŒC and a non-zero
element d 2 U such that 1
dU is the minimal local contribution to kŒC at P.
Proposition 6.1 With notation as above, and given Q 2 C, we have
.hdikŒC W U/Q D
 COC;Q if Q D P;
OC;Q if Q ¤ P:
Proof By the minimality assumption, we have
1
d U

Q
D
 OC;Q if Q D P;
OC;Q if Q ¤ P:
The claim follows since localization commutes with forming the conductor:

hdikŒC W U

Q D

C. 1
d U/ = kŒC

Q D C. 1
d U/Q = kŒCQ.
Now, we argue as in the proof of Proposition 3.9: From Proposition 6.1 and
Remark 5.2, it follows that hdikŒC W U coincides with the ideal obtained by
dehomogenizing G.P/ with respect to X0 and mapping the result to kŒC. Hence,
since G.P/ is saturated, Algorithm 4 below indeed computes G.P/.
Algorithm 4 Local Gorenstein adjoint ideal from a local contribution
Input: A curve  	 Pr
k over a perfect ﬁeld k with afﬁne part C as in Notation 3.8
and a point P 2 Sing.C/ 	 Sing. /.
Output: The local Gorenstein adjoint ideal G.P/ of  .
1: Compute polynomials d; a0; : : : ; as 2 k ŒX1; : : : ; Xr such that the fractions
ai.x1;:::;xr/
d.x1;:::;xr/ generate the minimal local contribution to k ŒC at P as a k ŒC-module.
2: Compute the ideal quotient
C D .hdi C I .C// W .ha0; : : : ; asi C I .C// 	 k ŒX1; : : : ; Xr :
3: return the homogenization of C with respect to X0.

72
J. Böhm et al.
Example 6.2 Let  	 P2
C be the projective closure of the curve C with afﬁne
equation
X5  Y2 .1  Y/3 D 0
as in Examples 2.12, 2.17, 4.5, and 4.8. We compute the local Gorenstein adjoint
ideals. For the A4-singularity P1, we know from Example 2.17 that
d1 D x2 and U1 D
˝
x2; y.y  1/3˛
CŒC ,
so that
G.P1/ D
˝
X2; Y
˛
.
For the E8 singularity P2, in turn, we have
d2 D x3 and U2 D
D
x3; x2y2 .y  1/ ; y2 .y  1/2E
CŒC ,
leading to
G.P2/ D
˝
X3; X.Y  Z/; .Y  Z/2˛
.
Note that G.P1/ and G.P2/ are the ideals already obtained in Example 4.6.
7
Improvements to the Local Strategy for Plane Curves
In this section, we focus on the case of a plane curve  with afﬁne part C D V. f/
and Sing. / D Sing.C/ as in Notation 4.2. For simplicity of the presentation, we
suppose throughout the section that our ground ﬁeld k D C.
As explained in Sect. 5, the Gorenstein adjoint ideal G can be computed as the
intersection of local Gorenstein ideals via a partition of Sing.C/. To begin with,
consider the following partition:
Sing.C/ D W2 [ W3 [    [ Wr [ W0;
(5)
where, for each i, Wi denotes the locus of ordinary i-fold points (ordinary multiple
points of multiplicity i)2 and where W0 collects the remaining singularities of C. In
particular, W2 is the set of nodes of C. Note that in many practical examples W0 D ;.
2Recall that an ordinary multiple point of multiplicity i is a singularity where the lowest non-
vanishing jet of f factors into i distinct linear factors.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
73
Lemma 7.1 Let P 2 Sing.C/, and let mP 	 kŒX; Y be the corresponding maximal
ideal. If P is an ordinary i-fold point of C, then
G.P/ D mi1
P .
Proof Since C is a plane curve and P is an ordinary i-fold point of C, the conductor
COC;P D mi1
C;P, where mC;P is the maximal ideal of OC;P (see [29, 47]). The result
follows from the very deﬁnition of G.P/.
Applying the lemma to the partition (5), we get the intersection of ideals
G D I .W2/ \ I .W3/2 \    \ I .Wr/r \ G.W0/.
(6)
Hence, in the case where  is known to have ordinary multiple points as singular-
ities only (that is, W0 D ;), we can compute G in a very efﬁcient way by using
Algorithm 5 below (see [5]).
In the general case, Eq. (6) allows us to reduce the computation of G to the less
involved task of computing G.W0/ as soon as we have detected the ordinary i-fold
points. To begin with treating these, here is how to ﬁnd the nodes:
Remark 7.2 We know how to ﬁnd all singularities: Sing.C/ is given by the ideal
J D

f; @f
@X ; @f
@Y

:
Now consider the Hessian matrix Hess. f/ formed by the second partial derivatives
of f. By the Morse lemma (see [49]), a point P 2 Sing.C/ is a node iff Hess. f/ is
Algorithm 5 Gorenstein adjoint ideal, ordinary multiple points only
Input: A plane curve  of degree n with deﬁning polynomial F as in Notation 4.2
with only ordinary multiple points as singularities.
Output: The Gorenstein adjoint ideal G of  .
1: J1 D
˝ @F
@X ; @F
@Y ; @F
@Z
˛
(the ideal deﬁning Sing. /)
2: i D 1
3: while (Ji W hX; Y; Zi1/ ¤ h1i do
4:
i D i C 1
5:
Ji D
D
@jClCmF
@Xj@Yl@Zm j j C l C m D i; j; l; m 2 N
E
6: B D hX; Y; Zini
7: while i > 0 do
8:
Ii D .Ji1 W B1/
(the ideal of the i-fold points of  )
9:
B D ..B \ Ii1
i
/ W hX; Y; Zi1/
10:
i D i  1
11: return B

74
J. Böhm et al.
non-degenerate at P. That is, P is a node iff
I.P/ C hdet.Hess. f//i D kŒX; Y.
This gives us a fast way of computing W2.
Carrying our efforts one step further, we discuss the local analysis of the
singularities via invariants. This yields an efﬁcient method not only for ﬁnding the
delta invariant, but also for detecting the ordinary i-fold points, for each i:
Remark 7.3 Let P 2 Sing.C/. After a translation, we may assume that P D .0; 0/
is the origin. Write mP for the multiplicity and
P D dimk

k ŒŒX; Y
. 
 @f
@X ; @f
@Y

for the Milnor number of C at P. Then mP D deg hp, where hP is the lowest degree
homogeneous summand of the Taylor expansion of f at P. Recall that P can be
computed via standard bases (see [32]). Furthermore, if the Newton polygon of f is
non-degenerate (otherwise, successively blow up), the number rP of branches of f
at P can be computed as
rP D
Xs1
jD1 gcd

V. jC1/
X
 V. j/
X ; V. jC1/
Y
 V. j/
Y

;
where V.1/; : : : ; V.s/ are the (ordered) vertices of the Newton polygon (and X and
Y refer to their respective coordinates). This is immediate from [13, Section 8.4,
Lemma 3]. The delta invariant of C at P is then obtained as
ıP D 1
2.P C rP  1/
(see, for example, [33, Chapter 1, Proposition 3.34]). Furthermore, P is an ordinary
i-fold point iff hP is square-free and mP D i. Equivalently,
.mP; rP; ıP/ D
 
i; i;
 
i
2
!!
.
See [33, Chapter 1, Proposition 3.33].
The local analysis of the singularities may be used to further reﬁne our partition
of Sing.C/. For example, singularities of type ADE can be identiﬁed as follows:
Remark 7.4 With notation as in Remark 7.3, the point P D .0; 0/ 2 Sing.C/ is
1. of type An, n  2, iff hP D l2
1, with l1 2 kŒX; Y linear, and P D n,
2. of type Dn, n  4, iff hP D l1l2l3 or hP D l2
1l2, with pairwise different linear
polynomials lj 2 kŒX; Y, and P D n, and

Algorithms for the Gorenstein Adjoint Ideal of a Curve
75
3. of type En, n D 6; 7; 8, iff hP D l3
1, with l1 2 kŒX; Y linear, and P D n.
Here, in (2), hP splits into three different linear factors iff P is of type D4. See,
for example, [33, Chapter 1, Theorems 2.48, 2.51, 2.54].
To describe the local Gorenstein adjoint ideal at a singularity of type A, D, or E,
we use the following notation:
Notation 7.5 For any element g 2 kŒŒX; Y, let gj D taylor .g; j/ 2 kŒX; Y be the
Taylor expansion of g at P D .0; 0/ modulo O. j C 1/.3
If C has a singularity of type An at P D .0; 0/, we may write f in the form
f D T2 C WnC1, where T; W 2 kŒŒX; Y is a regular system of parameters. Let
s D
 nC1
2
˘
(the meaning of s will become clear in the proof of Lemma 7.6). We
may compute the Taylor expansion Ts1 2 kŒX; Y as follows. If n and thus s is
equal to 1, set T0 D 0. Otherwise, inductively solve f for T: Start by choosing a
linear form T1 2 kŒX; Y such that taylor. f; 2/ D T2
1. Supposing that 1 < j < s  1
and Tj D T C O. j C 1/ has already been computed, write
taylor. f  T2
j ; j C 2/ D 2T1  m;
with m 2 kŒX; Y homogeneous of degree j C 1, and set TjC1 D Tj C m.
Lemma 7.6 Let C have a singularity of type An, n  1, at P D .0; 0/. Set s D
 nC1
2
˘
, and let Ts1 be deﬁned as above. Then G.P/ is the homogenization of
hXs; Ts1; Ysi 	 kŒX; Y
with respect to Z.
Proof The case n D 1 is clear, so we may suppose n  2. If G0 D hXs; Ts1; Ysi 	
kŒX; Y, then G0
Q D OC;Q for all Q 2 C n fPg, so it sufﬁces to show that G0
P D CB,
where B D OC;P. For this, we pass to the completion
bB D kŒŒx; y D kŒŒX; Y=h f.X; Y/i;
and consider the isomorphism
A D kŒŒt; w D kŒŒT; W= ˝T2 C WnC1˛ ! bB, t 7! T.x; y/,w 7! W.x; y/:
An analysis of the normalization algorithm applied to A shows that
A D
ns
X
iD0
kŒŒt  wi C
n
X
iDnsC1
kŒŒt  wi
t ,
3The notation O.m/ stands for terms of degree  m.

76
J. Böhm et al.
and that it takes s D
 nC1
2
˘
steps to reach A (see [9, Sect. 4]). Hence,
CA D ht; wsiA , so that COB D hT.x; y/; W.x; y/siOB:
Working in kŒŒX; Y, we write
T D aX C bY and W D cX C dY;
where a; b; c; d 2 kŒŒX; Y are such that ad bc is a unit in kŒŒX; Y. Since hX; Yi D
hT; Wi, it follows that hX; Yis D hT; Wis 	 hT; Wsi. Since hX; Yi D hX; Ti or
hX; Yi D hT; Yi, we have Ws 2 hX; Yis 	 hXs; T; Ysi. We conclude that
hXs; T; Ysi D hT; Wsi .
If s > 1, then hX; Yi D hX; Ts1i or hX; Yi D hTs1; Yi. Hence, for any s, we
have hX; Yis 	 hXs; Ts1; Ysi. We conclude that
hXs; Ts1; Ysi D hXs; T; Ysi .
Now recall that B is an excellent ring, which implies that bB D bB (see, for example,
[9, Sect. 1]). It follows that
Cb
B D HomOB

bB; B

D HomB

B; B

˝B bB D CB ˝B bB.
(7)
Since completion is faithfully ﬂat in the case considered here, we conclude that
CB D hxs; Ts1.x; y/; ysiB .
Remark 7.7 In particular, if P is a cusp, then G.P/ D hX; Yi. So in Eq.(6), nodes
and cusps may be treated simultaneously.
If C has a singularity of type Dn at P D .0; 0/, we may write f in the form
f D W 

T2 C Wn2
, where T; W 2 kŒŒX; Y is a regular system of parameters.
Let s D
 n
2
˘
. We may compute the Taylor expansion Ts2 2 kŒX; Y as follows.
If n D 4, set T0 D 0. If n  5, choose linear forms T1; W1 2 kŒX; Y such that
taylor. f; 3/ D T2
1  W1. For j  s  2, determine Wj D W C O. j C 1/ as the Puiseux
expansion up to order j of f corresponding to W1. Supposing that 1 < j < s  2 and
Tj D T C O. j C 1/ has already been computed, write
taylor. f  T2
j  WjC1; j C 3/ D 2Z1  W1  m;
with m 2 kŒX; Y homogeneous of degree j C 1, and set TjC1 D Tj C m.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
77
Lemma 7.8 Let C have a singularity of type Dn, n  4, at P D .0; 0/. Set s D
 n
2
˘
,
and let Ts2 be deﬁned as above. Then G.P/ is the homogenization of
hX; Yi 
˝
Xs1; Ts2; Ys1˛
	 kŒX; Y
with respect to Z.
Proof We have an isomorphism
A ! bB, q 7! T.x; y/, w 7! W.x; y/,
where B D OC;P and
A D kŒŒt; w D kŒŒT; W=
˝
W 

T2 C Wn2˛
:
This time, the normalization is
A D
n2s
X
iD0
kŒŒt  wi C
n3
X
iDn1s
kŒŒt  wi
t C kŒŒt  wn2
t2
;
and it takes s D
 n
2
˘
steps to reach A (see again [9, Sect. 4]). Hence,
CA D
˝
t2; tw; ws˛
.
Write
T D aX C bY and W D cX C dY;
where a; b; c; d 2 kŒŒX; Y are such that ad bc is a unit in kŒŒX; Y. Since hX; Yi D
hT; Wi, we have hXT; YTi D
˝
T2; TW
˛
and hX; Yis D hT; Wis 	
˝
T2; TW; Ws˛
.
Hence,
hX; Yi 
˝
Xs1; T; Ys1˛
	
˝
T2; TW; Ws˛
.
For the other inclusion, observe that hX; Yi D hX; Ti or hX; Yi D hT; Yi, so that
hX; Yis1 	
˝
Xs1; T; Ys1˛
. Hence,
Ws 2 hX; Yis 	 hX; Yi 
˝
Xs1; T; Ys1˛
.
If s > 2, then hX; Yi D hX; Ts2i or hX; Yi D hTs2; Yi. Hence, for any s, we
have hX; Yis1 	
˝
Xs1; Ts2; Ys1˛
. We conclude that
˝
Xs1; Ts2; Ys1˛
D
˝
Xs1; T; Ys1˛
.

78
J. Böhm et al.
To summarize,
˝
T2; TW; Ws˛
D hX; Yi 
˝
Xs1; T; Ys1˛
D hX; Yi 
˝
Xs1; Ts2; Ys1˛
,
so that
COB D hx; yi 
˝
xs1; Ts2.x; y/; ys1˛
	 bB.
Then the claim follows as before.
Lemma 7.9 Let C have a singularity of type En, n D 6; 7; 8, at P D .0; 0/. Set
s D
 n1
2
˘
, and let l1 be as in Remark 7.4. Then G.P/ is the homogenization of
hX; Yi 
˝
Xs1; l1; Ys1˛
	 kŒX; Y
with respect to Z.
Proof Depending on n 2 f6; 7; 8g, we have an isomorphism
A ! bB, q 7! T.x; y/, w 7! W.x; y/,
where B D OC;P and
A D kŒŒt; w D kŒŒT; W=
˝
T3 C W4˛
or
A D kŒŒt; w D kŒŒT; W=
˝
T

T2 C W3˛
or
A D kŒŒt; w D kŒŒT; W=
˝
T3 C W5˛
.
In each case, by Böhm et al. [9, Sect. 4],
A D kŒŒw  1 C kŒŒw  t
w C kŒŒw  t2
ws ,
which implies that
CA D ˝t2; tw; ws˛ .
The same argument as in the proof of Lemma 7.8 shows that
Cb
B D hx; yi 
˝
xs1; Ts2.x; y/; ys1˛
	 bB,
and the claim follows as before. Note that Ts2 D 0 if s D 2, and Ts2 D l1 if s D 3.
In principle, we could pursue a similar strategy for all singularities classiﬁed
by Arnold in [4]. However, in [10], we give an algorithm which, for plane curves in
characteristic zero, allows us to compute the local contributions to the normalization

Algorithms for the Gorenstein Adjoint Ideal of a Curve
79
for a broad class of singularities in a direct way. Combining the approach of Sect. 6
with this algorithm or with modular techniques and normalization as described in
Sect. 8 below, we already get a very efﬁcient algorithm for computing G.
8
Parallel Computation Using Modular Techniques
Algorithm 3 is parallel in nature since the computations of the local adjoint ideals do
not depend on each other. In this section, in the case where the given curve is deﬁned
over Q, we describe a modular way of parallelizing Algorithm 3 even further. One
possible approach is to replace the computations of the Gröbner bases involved,
the computation of the (minimal) associated primes in the singular locus, and the
computations yielding the normalizations by their modular variants as introduced
in [3, 40], and [6]. These variants are either probabilistic or require expensive
tests to verify the results at the end. To reduce the number and complexity of the
veriﬁcation tests, we provide a direct modularization for the adjoint ideal algorithm.
The approach we propose requires only the veriﬁcation of the ﬁnal result: In the
next section, we give efﬁcient conditions for checking whether the result obtained
is indeed the Gorenstein adjoint ideal.
Our approach relies on the general scheme for modular computations presented
in Böhm et al. [11] and provided, in fact, motivation for developing the scheme.
This is based on error tolerant rational reconstruction (a short account of which will
be given in Remark 8.8 below) and can handle bad primes,4 provided there are only
ﬁnitely many such primes. Referring to [11] for details, we will now outline the
main ideas behind the scheme.
Fix a global monomial ordering > on the monoid of monomials in the variables
X D fX0; : : : ; Xrg. Consider the polynomial rings R D QŒX and, given an integer
N  2, RN D .Z=NZ/ŒX. If H 	 R or H 	 RN is a set of polynomials, then denote
by LM.H/ WD fLM.h/ j h 2 Hg its set of leading monomials.
If a
b 2 Q with gcd.a; b/ D 1 and gcd.b; N/ D 1, set
 a
b

N WD .a C NZ/
.b C NZ/1 2 Z=NZ. If f 2 R is a polynomial such that N is coprime to any
denominator of a coefﬁcient of f, then its reduction modulo N is the polynomial
fN 2 RN obtained by mapping each coefﬁcient c of f to cN. If H D fh1; : : : ; hsg 	 R
is a set of polynomials such that N is coprime to any denominator of a coefﬁcient of
any hi, set HN D f.h1/N; : : : ; .hs/Ng. If J 	 R is an ideal, we write
J0 D J \ ZŒX and JN D h fN j f 2 J0i 	 RN,
and call JN the reduction of J modulo N. We also write .R=J/N D RN=JN.
4In our context, a prime p is bad if Algorithm 3, applied to the modulo p values of the input over
the rationals, does not return the reduction of the characteristic zero result.

80
J. Böhm et al.
As a ﬁrst step towards the modular algorithm, we explain how to compute the
reduction of a given ideal J 	 R modulo a prime, supposing that a Gröbner basis
for J is already known.
Lemma 8.1 With notation as above, let J 	 R be an ideal, let H D fh1; : : : ; hsg be
a Gröbner basis for J with elements hi 2 ZŒX, and let p be a prime not dividing
any of the leading coefﬁcients LC.hi/. Then for every f 2 J \ ZŒX, there exists an
integer d 2 Z not divisible by p, and such that df 2 hHiZŒX.
Proof Let f 2 J \ ZŒX. Then, since H is a Gröbner basis for J, there exists an
hi 2 H such that LM. f/ is divisible by LM.hi/. We hence have a representation
LC.hi/  f D m  hi C f .1/ with f .1/ 2 J \ ZŒX, and such that LM. f/ > LM. f .1//.
Proceeding with f .1/ instead of f and continuing that way, we get an integer d 2 Z
and a representation df D Ps
iD1 ihi as desired.
Corollary 8.2 If J; H, and p are as above, then Jp D hHpiFpŒX.
Proof Given f 2 J \ ZŒX, let df D Ps
iD1 ihi be a representation as above. Then
dpfp D Ps
iD1.i/p.hi/p. We conclude that fp 2 hHpiFpŒX.
Corollary 8.3 With J and H as above, let p be a prime such that Hp is a Gröbner
basis with LM.H/ D LM.Hp/. Then Jp D hHpiFpŒX.
We now ﬁx the following setup for the rest of this section:
Notation 8.4 Let  	 Pr
Q be an integral non-degenerateprojective algebraic curve,
let I. / be the ideal of  in R, and let G.0/ 	 R be the reduced Gröbner basis of
G. /. If p is a prime such that LM.I. // D LM.I. /p/, and I. /p is radical and
deﬁnes an integral non-degenerate projective algebraic curve in Pr
Fp, then write p
for this curve and G.p/ 	 Rp for the reduced Gröbner basis of G.p/.
Remark 8.5 There are only ﬁnitely many primes p for which the desired conditions
on I. /p in Notation 8.4 are not satisﬁed. Since these conditions can be checked
using Gröbner bases and square-free decomposition, we may reject such a prime
if we encounter it in the modular algorithm. In the following discussion, we will
ignore these bad primes for simplicity of the presentation. In particular, we will
assume that the Gröbner bases G.p/ are deﬁned for all primes p.
The basic idea of the modular adjoint ideal algorithm can now be described as
follows: First, choose a set of primes P and compute G.p/ for each p 2 P. Second,
lift the G.p/ coefﬁcientwise to a set of polynomials G 	 R. Provided that G. /p D
G.p/ for each p 2 P, we then expect that G is a Gröbner basis which coincides
with our target Gröbner basis G.0/.
The lifting process consists of two steps. First, use Chinese remaindering to lift
the G.p/ 	 Rp to a set of polynomials G.N/ 	 RN, with N WD Q
p2P p . Second,
compute a set of polynomials G 	 R by lifting the coefﬁcients occurring in G.N/
to rational coefﬁcients. Here, to identify Gröbner basis elements corresponding to
each other, we require that LM.G.p// D LM.G.q// for all p; q 2 P. This leads to

Algorithms for the Gorenstein Adjoint Ideal of a Curve
81
condition (L2) in the deﬁnition below:
Deﬁnition 8.6 With notation as above, a prime p is called lucky if
(L1) G. /p D G.p/ and
(L2) LM.G.0// D LM.G.p//.
Otherwise p is called unlucky.
Lemma 8.7 All but ﬁnitely many primes are lucky.
Proof As is clear from the proof of [11, Lemma 5.5], it is enough to show that
condition (L1) is true for all but ﬁnitely many primes. For this, we may assume that
 does not have singularities at X0 D 0. Then for all but ﬁnitely many primes p, the
curve p does not have singularities at X0 D 0.
Let C be the afﬁne part of  in the chart X0 6D 0. Write A D QŒX1; : : : ; Xr=I.C/.
Using a Gröbner basis argument as summarized in [11, Remark 5.3], it is shown
in [6, Section 4] that .A/p D Ap for all but ﬁnitely many primes p. So if we write
A D 1
dU, with an ideal U 	 A and an element 0 ¤ d 2 A, and Ap D
1
d.p/U.p/, with
an ideal U.p/ 	 Ap and an element 0 ¤ d.p/ 2 Ap, then
.dp W Up/ D .d.p/ W U.p//
for all but ﬁnitely many primes p.
Computing an ideal quotient amounts to another Gröbner basis computation.
Hence, we may again apply [11, Remark 5.3] to conclude that
.d W U/p D .dp W Up/
for all but ﬁnitely many primes p.
Summing up, the result follows from Propositions 3.9 and 4.7.
When performing the modular algorithm, condition (L1) can only be checked a
posteriori: We compute G.p/ and, thus, G.p/ on our way, but G. /p is only known
to us after G.0/ and, thus, G. / has been computed. This is not a problem, however,
since the ﬁnitely many primes where G. /p 6D G.p/ will not inﬂuence the ﬁnal
result if we apply error tolerant rational reconstruction as discussed now.
Remark 8.8 Let N0 and M be integers with gcd.N0; M/ D 1, let N D N0  M, and let
a
b 2 Q with gcd.a; b/ D gcd.N0; b/ D 1. Set r1 WD
 a
b

N0 2 Z=N0Z, let r2 2 Z=MZ
be arbitrary, and denote by r, with 0  r  N  1, the image of .r1; r2/ under the
isomorphism
Z=N0Z  Z=MZ ! Z=NZ.
Lifting r to a rational number by Gaussian reduction, starting from .a0; b0/ D
.N0M; 0/ and .a1; b1/ D .r; 1/, we create the sequence .ai; bi/ obtained by
.aiC2; biC2/ D .ai; bi/  qi.aiC1; biC1/,

82
J. Böhm et al.
with
qi D
h.ai; bi/; .aiC1; biC1/i
k.aiC1; biC1/k2

:
Computing this sequence until k.aiC2; biC2/k  k.aiC1; biC1/k, we return false
if k.aiC1; biC1/k2  N, and aiC1
biC1 , otherwise. By Böhm et al. [11, Lemma 4.3], this
algorithm will return aiC1
biC1 D a
b, provided that N is large enough and M  N0. More
precisely, we ask that N0 > .a2 C b2/  M.
Deﬁnition 8.9 If P is a ﬁnite set of primes, set
N0 D
Y
p2P lucky
p
and
M D
Y
p2P unlucky
p.
Then P is called sufﬁciently large if
N0 > .a2 C b2/  M
for any coefﬁcient a
b of any polynomial in G.0/ (assume gcd.a; b/ D 1).
Lemma 8.10 If P is a sufﬁciently large set of primes satisfying condition (L2),
then the reduced Gröbner bases G.p/, p 2 P, lift via Chinese remaindering and
error tolerant rational reconstruction to the reduced Gröbner basis G.0/.
Proof By Lemma 8.7, condition (L1) holds for all but ﬁnitely many primes p.
Hence, since P is sufﬁciently large, the result follows as in the proof of [11,
Lemma 5.6] from [11, Lemma 4.3].
Lemma 8.7 guarantees, in particular, that a sufﬁciently large set P of primes
satisfying condition (L2) exists. So from a theoretical point of view, the idea of
ﬁnding G.0/ is now as follows: Consider such a set P, compute the reduced
Gröbner bases G.p/, p 2 P, and lift the results to G.0/.
From a practical point of view, however, we face the problem that condition (L2)
can only be checked a posteriori. On the other hand, as already pointed out, we
need that the G.p/, p 2 P, have the same set of leading monomials in order to
identify corresponding Gröbner basis elements in the lifting process. To remedy
this situation, we suggest to proceed in a randomized way: First, ﬁx an integer t  1
and choose a set of t primes P at random. Second, compute G D fG.p/ j p 2 Pg,
and use a majority vote on the set of lead monomials to choose a subset of G such
that all Gröbner bases in the subset have the same set of lead monomials:
DELETEBYMAJORITYVOTE: Deﬁne an equivalence relation on P by setting
p  q W” LM.G.p// D LM.G.q//: Then replace P by the equivalence class of
largest cardinality,5 and change G accordingly.
5We have to use a weighted cardinality count: when enlarging P, the total weight of the elements
already present must be strictly smaller than the total weight of the new elements. Otherwise,
though highly unlikely in practical terms, it may happen that only unlucky primes are accumulated.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
83
Now, all G.p/, p 2 P, have the same set of leading monomials. Hence, we can
apply the error tolerant lifting algorithm to the coefﬁcients of the Gröbner bases in
G . If this algorithm returns false at some point, we enlarge the set P by t primes
not used so far, and repeat the whole process. Otherwise, the lifting yields a set of
polynomials G 	 R. Furthermore, if P is sufﬁciently large, all primes in P satisfy
condition (L2). Since we cannot check, however, whether P is sufﬁciently large,
a ﬁnal veriﬁcation step over Q is required. We will establish such a test in Sect. 9
below. Since this test is particularly expensive if G ¤ G.0/, we ﬁrst perform a test
in positive characteristic in order to increase our chances that the two sets are equal:
PTEST: Randomly choose a prime p … P which does neither divide the
numerator nor the denominator of any coefﬁcient occurring in any polynomial in
G. Return true if Gp D G.p/, and false otherwise.
If PTEST returns false, then P is not sufﬁciently large (or the extra prime
chosen in PTEST is bad). In this case, we enlarge P as above and repeat the process.
If PTEST returns true, however, then most likely G D G.0/. Only now, we verify
the result over Q. If the veriﬁcation fails, we again enlarge P and repeat the process.
9
Veriﬁcation
Throughout this section, we consider a curve  	 Pr
Q with Gorenstein adjoint ideal
G D G. / 	 R D QŒX as in Notation 8.4. Our goal is to derive a criterion which,
in combination with the procedure PTEST from the previous section, provides an
effective way of checking whether the result of our modular algorithm is correct.
The veriﬁcation is based on the following observation obtained from Lemma 3.14:
If I 	 R is a homogeneous ideal, then I D G iff the following hold:
1. I is saturated and I. / ¤ I,
2. deg .I/ D deg I C ı. /, and
3. deg I D deg G.
To turn this into an algorithmic criterion, we need some preparations. If A is any
reduced Noetherian algebra over a ﬁeld k, then, as a direct generalization of the
deﬁnition from Sect. 3, we can associate to A the delta invariant
ık.A/ D dimk A=A:
Proposition 9.1 Let B ! A be a homomorphism of reduced Noetherian rings.
Suppose:
1. .B; m/ is a normal local domain with perfect residue class ﬁeld k;
2. the natural homomorphism B ! bB from B to its completion bB is normal;

84
J. Böhm et al.
3. A is a formally equidimensional Nagata ring;
4. A is a ﬂat B-algebra, mA is contained in every maximal ideal of A, the ring A=mA
is reduced, and ık.A=mA/ < 1;
5. A=A is a ﬁnite B-module;
6. the unique map
A=mA ! A=mA which factorizes the normalization map
A=mA ! A=mA as
A=mA ! A=mA ! A=mA
is injective.
Then
ıQ.B/.A ˝B Q.B//  ık.A=mA/:
Proof See [44, Prop. 2.1.1(i)] for the factorization in (6) and [44, Prop. 3.3] for the
proof of the proposition.
Corollary 9.2 (see also [15]) With notation as above, let p be a prime such that
I. /p is radical and deﬁnes an integral non-degenerate curve p 	 Pr
Fp. Then
ı. /  ı.p/:
Proof Write X0 D fX1; : : : ; Xrg. We may assume that  has no singularities at
X0 D 0. Let C be the afﬁne part of  in the chart X0 6D 0 as before. Write
J D I.C/ \ ZŒX0 and I.C/p D
˝
fp j f 2 J
˛
	 FpŒX0.
Then J is a prime ideal of height r  1, hp; Ji is a prime ideal, and J \ Z D
h0i. The claim follows by applying Proposition 9.1 to .B; m/ D .Zhpi; hpi/ and
A D ZhpiŒX0=J ZhpiŒX0 since, in this case, A ˝B Q.B/ D QŒX0=I.C/, A=mA D
FpŒX0=I.C/p, and conditions (1) through (6) of the proposition are satisﬁed. Indeed,
this is clear for (1), while (2) holds since B is excellent. We have (3) since A is
of ﬁnite type over B and J ZhpiŒX0 is a prime ideal. Moreover, (4) is satisﬁed
since A is a torsion-free B-module, hp; Ji is a prime ideal, and Spec.A=mA/ is
a curve. We get (5) since A=CA is a ﬁnite B-module and A=CA is a ﬁnite A=CA-
module. Finally, condition (6) holds by Lemma 9.4 below: Taking into account that
Q.A/ D Q.ZŒX0=J/, the lemma gives us a canonical map
A ! A=mA, ˛ D a
b
7! a modhp; Ji
b modhp; Ji;
where a; b 2 ZŒX0, with b … hp; Ji, and where a; b denote the images of a; b in A.
Since ˛ D
a
b is in the kernel of this map iff a 2 hp; Ji, we get an injective map
A=mA ! A=mA which factorizes the normalization map as desired.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
85
Before deriving Lemma 9.4, we illustrate condition (6) by an example.
Example 9.3 Let .B; m/ D .Zh3i; h3i/ and A D Zh3iŒX; Y=
˝
X3 C Y3 C Y5˛
. Then
A=mA D
D
1; x
y; .xCy/2
y3
E
A=mA and A D
D
1; x
y; x2
y2
E
A. We compute ıQ.A ˝B Q/ D 3 and
ıF3.A=mA/ D 4, and ﬁnd that
A=mA D

1; x
y; x2
y2

A=mA
¤

1; x
y; .x C y/2
y3

A=mA
D A=mA.
Lemma 9.4 With notation as in the proof of Corollary 9.2, for any ˛ 2 A, there
exist a; b 2 ZŒX0 with b … hp; Ji and ˛ D a
b 2 Q.A/ D Q.ZŒX0=J/.
Proof For ˛ 2 A, there are a; b 2 ZŒX0 with b … J and ˛ D a mod J
b mod J, and there are
a0; : : : ; am1 2 ZŒX0 and d 2 Z with p −d and
˛m C am1 mod J
d
˛m1 C : : : C a0 mod J
d
D 0.
Then d  am C am1  bam1 C : : : C a0  bm 2 J.
If b0 D b 2 hp; Ji, then d  am 2 hp; Ji. Hence, since .p; J/ is prime, a 2 hp; Ji.
Then a D pa1 C c1 and b D pb1 C d1 for some a1; b1 2 ZŒX0 and some c1; d1 2 J.
If b1 2 hp; Ji, we can iterate the process. Inductively, as long as bs1 2 hp; Ji, we
obtain as; bs 2 ZŒX0 and cs; ds 2 J with a D psas C cs and b D psbs C ds. If bs were
in hp; Ji for all s, then b 2 T
s hps; Ji D J, contradicting our assumption on b. Thus,
there is an s with bs … hp; Ji. Then
˛ D a mod J
b mod J D psas mod J
psbs mod J D as mod J
bs mod J .
Notation 9.5 Let I 	 R be a saturated homogeneous ideal such that I. / ¤ I, let m
be an integer, and let g 2 I be a homogeneous polynomial of degree m not contained
in I. /. Let div.g/ be the divisor cut out by g on  , let D.g/ D div.g/  .I/ be
the corresponding divisor in jmH  .I/j, and let d.g/ D deg D.g/. Furthermore,
writeed.g/ for the degree of the part of D.g/ away from Sing. /.
Given a prime p, use the same notation for p and gp if these are deﬁned.
Note that deg div.g/ D m  deg  and ed.g/  d.g/.
Theorem 9.6 Let I 	 R be a saturated homogeneous ideal such that I. / ¤ I, let
m be an integer, let g 2 I be a homogeneous polynomial of degree m not contained
in I. /, and let p be a prime. With notation as above, suppose:
1. I. /p is radical and deﬁnes an integral non-degenerate curve p 	 Pr
Fp;
2. gp is deﬁned and non-zero;
3.  and p have the same Hilbert polynomial;
4. Ip is an adjoint ideal of p;

86
J. Böhm et al.
5. deg I D deg Ip;
6. m is large enough to ensure that
ˇˇmHp  .Ip/
ˇˇ is nonspecial;
7. ed.gp/ D .deg  /  m  deg Ip  ı. /.
Then
ı. / D ı.p/; ed.g/ D d.g/; and deg .I/ D deg .Ip/:
Moreover, I is an adjoint ideal of  , and we have
deg .I/ D .deg  /  m ed.gp/.
Proof By (3), we have
deg. / D deg.p/ and pa. / D pa.p/:
(8)
Moreover, since (1) holds, it follows from Corollary 9.2 that ı. /  ı.p/. Hence,
taking (4) and Lemma 3.14 into account, we get
ed.gp/  d.gp/ D .deg p/  m  deg .Ip/
D .deg  /  m  deg Ip  ı.p/
 .deg  /  m  deg Ip  ı. /:
By (6), this chain of inequalities is an equality, so that
ed.gp/ D d.gp/ D .deg p/  m  deg .Ip/
(9)
and
ı. / D ı.p/.
(10)
Together with Lemma 3.14 and conditions (4) and (5), this implies that
deg .Ip/ D deg Ip C ı.p/ D deg I C ı. /  deg .I/,
(11)
or equivalently that
d.gp/  d.g/.
(12)
Next, in the main part of the proof, we show equality in (12). For this, we consider
the closed subscheme
X D V.I. /0/ 	 Pr
Z
˘
! Spec Z

Algorithms for the Gorenstein Adjoint Ideal of a Curve
87
with projection ˘ and ﬁbers Xq D X Spec Z Spec .hqi/. Then the ﬁber over the
generic point h0i 2 Spec Z is X0 D  , while over hpi we have Xp D p. Since
 and p have the same Hilbert polynomial by (3), there is a Zariski open subset
V 	 Spec Z containing p and such that the Hilbert polynomial is constant on V. It
follows that the restriction map ˘V W XV D ˘ 1.V/ ! V constitutes a ﬂat family
(see [37, Ch. III, Thm. 9.9]).
Since ı.p/ D ı. /, the ı-constant criterion for simultaneous normalization
(see [44, Cor. 3.3.1]) implies that there is a Zariski open subset U 	 V 	 Spec Z
containing p and such that U W XU D ˘ 1.U/ ! U is equinormalizable. That is,
there is a ﬁnite map  W X ! XU such that ˘ WD ˘U ı  is ﬂat with non-empty
geometrically normal ﬁbers, and such that for each hqi 2 U the induced map of
ﬁbers q W Xq ! Xq is the normalization map.
By construction of I, the family of sheaves deﬁned by I0 D I \ ZŒX is ﬂat over
a Zariski open subset of U containing both h0i and hpi. Hence, the semi-continuity
theorem (see, for example, [45, Ch. 5, Thm. 3.20]) implies that the dimensions of
the linear series induced by I on  and Ip on  p satisfy
h0 
 p; O p.mHp  .Ip//

 h0 
 ; O .mH  .I//

.
Hence d.gp/  d.g/ by condition (7) and Riemann-Roch, and since p.p/ D p. /
by (8) and (10). Taking (9) and (12) into account, it follows that
ed.gp/ D d.gp/ D d.g/:
The second equality translates into deg.Ip/ D deg .I/, so that I is an adjoint
ideal by Lemma 3.14 and (11). Finally,
.deg  /  m  deg .I/ D .deg p/  m  deg .Ip/ D ed.gp/.
Corollary 9.7 In the situation of Theorem 9.6, suppose that all assumptions of the
theorem are satisﬁed. Suppose in addition that Ip is the Gorenstein adjoint ideal of
p. Then I is the Gorenstein adjoint ideal of  .
Proof Theorem 9.6 already tells us that I is an adjoint ideal of  . In particular,
I 	 G and, thus, degI  deg G. This implies that
deg .G/ D deg G C ı. /  deg I C ı. / D deg .I/ D deg .Ip/,
(13)
where the last equality holds by the theorem. On the other hand, since we suppose
that Ip is the Gorenstein adjoint ideal of p, we have
dim
ˇˇmHp  .Ip/
ˇˇ  dim jmH  .G/j

88
J. Böhm et al.
for m large enough by semi-continuity. Hence, by Riemann-Roch and since ı.p/ D
ı. / by the theorem, we have
deg .Ip/  deg .G/
(see Lemma 3.14 and its proof). This shows that (13) is an equality. In particular,
deg I D deg G.
We conclude that I D G.
Remark 9.8 In the ﬁnal veriﬁcation step of our modular algorithm for computing
G, if G denotes the result of the lifting process as in the previous section, we
randomly choose one of the primes p 2 P already used in the lifting process,
and apply Theorem 9.6 to the ideal I D hGi. For this, we need to know whether
the assumptions of the theorem hold. Checking condition (2) is trivial, while
conditions (1) and (3) are fulﬁlled by construction (see Remark 8.5 and step 6 of
Algorithm 6 below, where we in particular check that LM.I. // D LM.I. /p/).
Similarly conditions (4) and (5) are fulﬁlled since by construction Gp D G.p/ and
thus Ip D G.p/. With respect to condition (6), we will comment on how to choose
m in Lemma 9.9 below. Finally, since we know how to compute ı. /, we can also
check condition (7) (see step 18 of Algorithm 6).
In the situation above, if all assumptions of Theorem 9.6 are fulﬁlled, then by the
assertions of the theorem, we may rewrite the formula in condition (7) as
ed.g/ D deg. /  m  deg .G/:
(14)
So in order to expect that condition (7) holds for a given m and randomly chosen
g 2 Im and p 2 P, the degree m needs to be large enough so that Eq.(14) is satisﬁed.
The following lemma speciﬁes an appropriate bound for m, which is also sufﬁcient
to guarantee that condition (6) is fulﬁlled.
Lemma 9.9 Consider an integer m such that P .m/1  pa. /, and suppose that
g 2 Gm is generic. Then (14) is satisﬁed, and jmH  .G/j is nonspecial.
Proof By assumption and since P .m/ D .deg  /  m  pa. / C 1, we have
.deg  /  m  2pa. /:
On the other hand, by Lemma 3.14 and Corollary 3.20,
deg .G/  2ı. /:
Putting these inequalities together, we get
.deg  /  m  deg .G/  2pa. /  2ı. / D 2p. /:

Algorithms for the Gorenstein Adjoint Ideal of a Curve
89
Algorithm 6 Modular adjoint ideal
Input: A curve  	 Pr
Q satisfying the conditions of Notation 8.4.
Output: The Gorenstein adjoint ideal G. /.
1: choose an integer t  1
2: P D G D ;
3: loop
4:
choose a list Q of t random primes not used so far
5:
for all p 2 Q do
6:
if I. /p satisﬁes the conditions of Notation 8.4 then
7:
compute the reduced Gröbner basis G.p/ of G.p/ 	 Rp (via Alg. 3)
8:
P D P [ fpg, G D G [ fG.p/g
9:
.G ; P/ D DELETEBYMAJORITYVOTE.G ; P/
10:
lift .G ; P/ to a set of polynomials G 	 R via the Chinese remainder theorem
and Gaussian reduction
11:
if the lifting succeeds and PTEST.I. /; G; P/ then
12:
if G is a Gröbner basis and hGi is saturated then
13:
choose m such that P .m/  1  pa. /
14:
choose g 2 hGim at random
15:
choose a prime p 2 P
16:
if gp is deﬁned and non-zero then
17:
Mp = Jacobian ideal of I. /p
18:
computeed.gp/ D deg

.I.p/ C
˝
gp
˛
/ W M1
p

19:
compute ı. /
20:
ifed.gp/ D deg. /  m  deg hG.p/i  ı. / then
21:
return hGi
In particular, jmH  .G/j is base-point free, which implies that d.g/ D ed.g/ since
g is generic. Furthermore, by reason of its degree, jmH  .G/j is nonspecial.
Remark 9.10 For a plane curve  of degree n the condition P .m/  1  pa. /
means that n  m  .n  1/.n  2/, which is satisﬁed for m  n  2.
We summarize our approach in Algorithm 6.
Remark 9.11 In Algorithm 6, the G.p/, p 2 P, can be computed in parallel. Each
individual computation, in turn, can be parallelized by partitioning the singular loci.
Remark 9.12 The most expensive step of the veriﬁcation is the computation of
ı. /. If we skip the veriﬁcation, the algorithm will become probabilistic. That is, the
output can only be expected to be the Gorenstein adjoint ideal, with high probability.
Skipping the veriﬁcation usually accelerates the algorithm considerably. This gives
us, in particular, a fast probabilistic way to compute both the geometric genus p. /
and deg .G/ D dimQ

QŒC=CQŒC

.

90
J. Böhm et al.
10
Timings
The algorithms for adjoint ideals presented in this paper are implemented in
the SINGULAR library adjointideal.lib (see [12]). They make use of the
normalization algorithm of Sect. 2 either in its local or local to global vari-
ant, as appropriate. These variants, in turn, are part of the SINGULAR library
locnormal.lib (see [7]).
In this section, we compare the performance of the different algorithms. Speciﬁ-
cally, we consider
LA
Mnuk’s global linear algebra approach (Algorithm 1),
IQ
the global ideal quotient approach (Algorithm 2),
locIQ
the local ideal quotient approach (Algorithm 3 using Algorithm 4),
locIQP2
the local ideal quotient approach for plane curves with the
improvements of Sect. 7 concerning ordinary multiple
points and singularities of type ADE, and
modLocIQ
the modular local ideal quotient strategy (Algorithm 6).
For the modular approach, we do not make use of a local analysis of the singular
locus except for computing the invariants needed in the veriﬁcation step.
To quantify the improvement in computation time obtained by omitting the
veriﬁcation step in the modular approach, we give timings for the resulting, now
probabilistic, version of Algorithm 6 (denoted by modLocIQ’ in the tables). Note
that in all examples where we could check the output of the modular algorithm by
computing the desired Gröbner basis also directly over Q, the result was indeed
correct.
To quantify the contributions of the different normalization algorithms and
to provide a lower bound for any adjoint ideal algorithm using them, we also
specify the computation times for the normalization step in SINGULAR via the
local to global approach outlined in Sect. 2 (denoted by locNormal), and for
ﬁnding an integral basis in MAPLE [46] via the algorithm of van Hoeij (denoted
by Maple-IB). Once being fully implemented in SINGULAR, we expect further
improvements of the performance by computing the local contribution or just
an integral basis of the local ring by the algorithm discussed in [10]. Since
this algorithm and van Hoeij’s algorithm rely on Puiseux series, they work in
characteristic zero only.
All timings are in seconds on an AMD Opteron 6174 machine with 48 cores,
2:2 GHz, and 128 GB of RAM running a Linux operating system. A dash indicates
that the computation did not ﬁnish within 10;000 s. The timings for parallel
computations are marked by the symbol * and the maximum number of cores used
in parallel is indicated in brackets.
Remark 10.1 All examples are deﬁned over the ﬁeld of rationals. For locIQ,
the number of cores used corresponds to the number of components of the

Algorithms for the Gorenstein Adjoint Ideal of a Curve
91
decomposition of the singular locus over Q. For modLocIQ, the number of cores
used in a given iteration of the algorithm is obtained by summing up the number of
components modulo p over all primes p 2 Q chosen in Step 4 of Algorithm 6.
To show the power of the modular algorithm, we give simulated parallel
timings even if the number of processes exceeds the number of cores available
on our machine (which is a valid approach since the algorithm has basically zero
communication overhead). For the single-core timings of modLocIQ, we indicate
in square brackets the number of primes used by the algorithm.
Now we turn to explicit examples. First we consider rational plane curves
deﬁned by a random parametrization of degree n. These curves have
n1
2

ordi-
nary double points. Their deﬁning equations f1;n were generated by the function
randomRatCurve from the SINGULAR library paraplanecurves.lib (see
[8]), using the random seed 1 and a random parametrization with coefﬁcients of
bitlength 15. For the resulting timings, see Table 1.
We observe that the detection of special types of singularities is fast and yields
the best performance among the non-probabilistic algorithms, while the modular
local strategy provides a very fast probabilistic algorithm.
To compare the algorithms at a single singularity, we consider plane curves with
exactly one An respectively Dn singularity at the origin of the afﬁne chart fZ ¤ 0g
(ignoring singularities at inﬁnity). For the modular approach, we omit veriﬁcation
since this step relies on global properties of the curve. The curves with afﬁne
equation f2;n;d D Y2 C XnC1 C Yd, n  1, d  3, have precisely one singularity
of type An at the origin. The curves with afﬁne equation f3;n;d D X.Xn1 CY2/CYd,
n  2, d  3, have exactly one singularity of type Dn at the origin. For timings, see
Tables 2 and 3, respectively.
In both examples, the best strategy is IQ since we consider only one singularity
and since no coefﬁcients of large bitlength occur.
Table 1 Timings for curves
given by a random
parametrization
f1;5
f1;6
f1;7
deg
5
6
7
locNormal
2.1
56
–
Maple-IB
5.1
47
318
LA
98
4400
–
IQ
2.1
56
–
locIQ
1.3
54
3800
locIQ
1.3 (1)
54 (1)
3800 (1)
locIQP2
0.18
1.2
49
locIQP2
0.18 (1)
1.2 (1)
49 (1)
modLocIQ
6.4 [33]
19 [53]
150 [75]
modLocIQ’
6.2 [33]
18 [53]
104 [75]
modLocIQ
0.36 (74)
1.6(153)
51(230)
modLocIQ’
0.21 (74)
0.48(153)
5.2 (230)

92
J. Böhm et al.
Table 2 Timings for curves with one singularity of type An
f2;5;10
f2;5;100
f2;5;500
f2;50;100
f2;50;500
f2;400;500
deg
10
100
500
100
500
500
locNormal
0.12
0.12
0.12
0.51
0.51
3.6
Maple-IB
0.08
1.5
96
4.7
150
630
LA
0.18
140
–
150
–
–
IQ
0.12
0.12
0.12
0.51
0.51
3.6
modLocIQ’
0.20 [2]
0.22 [2]
0.96 [2]
1.1 [2]
2.0 [2]
11 [2]
modLocIQ’
0.10 (2)
0.13 (2)
0.48 (2)
0.54 (2)
1.2 (2)
5.8 (2)
Table 3 Timings for curves with one singularity of type Dn
f3;5;10
f3;5;100
f3;5;500
f3;50;100
f3;50;500
f3;400;500
deg
10
100
500
100
50
500
locNormal
0.15
0.15
0.15
0.67
0.67
4.9
Maple-IB
0.05
1.7
100
34
1830
–
LA
0.20
140
–
140
–
–
IQ
0.15
0.15
0.15
0.67
0.67
5.0
modLocIQ’
0.22 [2]
0.23 [2]
0.23 [2]
1.5 [2]
1.5 [2]
24 [2]
modLocIQ’
0.09 (2)
0.10 (2)
0.10 (2)
0.74 (2)
0.77 (2)
17 (2)
Table 4 Timings for curves
with many An-singularities
f4;4
f4;6
f4;8
deg
10
14
18
locNormal
1.6
–
–
Maple-IB
2.2
14
70
LA
89
–
–
IQ
2.5
–
–
locIQ
0.96
–
–
locIQ
0.36 (6)
–
–
locIQP2
1.0
–
–
locIQP2
0.38 (6)
–
–
modLocIQ
3.7 [3]
23 [4]
190 [4]
modLocIQ’
3.3 [3]
20 [4]
170 [4]
modLocIQ
0.63 (27)
4.4 (48)
50 (48)
modLocIQ’
0.38 (27)
2.2 (48)
30 (48)
The plane curves with deﬁning equations
f4;n D

XnC1 C YnC1 C ZnC12  4

XnC1YnC1 C YnC1ZnC1 C ZnC1XnC1
were given in [38] and have 3 .n C 1/ singularities of type An if n is even. To ensure
that all singularities of the curves are in the afﬁne chart fZ ¤ 0g, we substitute
Z D 2X  3Y C 1. For timings, see Table 4.

Algorithms for the Gorenstein Adjoint Ideal of a Curve
93
Table 5 Timings for
non-planar curves
L25
L50
I4
I6
deg
25
50
20
28
locNormal
3.9
84
21
–
IQ
3.9
84
30
–
locIQ
3.9
84
18
–
locIQ
3.9 (1)
84 (1)
7.5 (6)
–
modLocIQ’
6.5 [2]
220 [2]
74 [5]
2600 [5]
modLocIQ’
3.3 (2)
140 (2)
4.0 (45)
59 (69)
To conclude this section, we present examples of curves in higher-dimensional
projective space. As above, we ﬁrst consider curves with only one singularity in a
given afﬁne chart: let Ln be the ideal of the image of
A1 ! A3, t 7! .tn2; tn1; tn/.
Second, denote by In the ideal of the image in P5 under the degree-2 Veronese
embedding of the curve ff4;n D 0g. For the resulting timings, see Table 5.
To summarize, we observe that the ideal quotient approach is faster than the
linear algebra one. To some extent, this is due to the lack of efﬁciency of the rational
function arithmetic in SINGULAR. The local strategy is faster than the global one if
there is more than one component in the decomposition of the singular locus over
Q. In addition, the local algorithm can be run in parallel and is, then, even faster.
In most examples, especially when the coefﬁcients have large bitlength, the fastest
approach is the modular local strategy, which parallelizes in a twofold way, via
localization and modularization. Note that, even if the singular locus of the curve is
irreducible over the rationals, by Chebotarev’s density theorem the singular locus is
likely to decompose when passing to a ﬁnite ﬁeld (see, for example, f1;7). In contrast
to other modular algorithms (such as modular normalization), the veriﬁcation step
is usually very fast.
Acknowledgements We would like to thank Gert-Martin Greuel, Christoph Lossen, Thomas
Markwig, Mathias Schulze, and Frank Seelisch for helpful discussions.
References
1. E. Arbarello, C. Ciliberto, Adjoint hypersurfaces to curves in Pr following Petri, in Commu-
tative Algebra. Lecture Notes in Pure and Applied Mathematics, vol. 84 (Dekker, New York,
1983), pp. 1–21
2. E. Arbarello, M. Cornalba, P.A. Grifﬁths, J. Harris, Geometry of Algebraic Curves, vol. I
(Springer, Berlin, 1985)
3. E.A. Arnold, Modular algorithms for computing Gröbner bases. J. Symb. Comput. 35, 403–419
(2003)

94
J. Böhm et al.
4. V.I. Arnold, S.M. Gusein-Zade, A.N. Varchenko, Singularities of Differential Maps, vol. I
(Birkhäuser, Basel, 1995)
5. J. Böhm, Parametrisierung rationaler Kurven. Diploma thesis, Institut für Mathematik und
Physik der Universität Bayreuth, 1999
6. J. Böhm, W. Decker, S. Laplagne, G. Pﬁster, A. Steenpaß, S. Steidel, Parallel algorithms for
normalization. J. Symb. Comput. 51, 99–114 (2013)
7. J. Böhm, W. Decker, S. Laplagne, G. Pﬁster, A. Steenpaß, S. Steidel, locnormal.lib - a
SINGULAR 4-1-0 library for computing integral bases of algebraic function ﬁelds. SINGULAR
distribution. http://www.singular.uni-kl.de
8. J. Böhm, W. Decker, S. Laplagne, F. Seelisch, paraplanecurves.lib - a SINGULAR 4-
1-0 library for computing parametrizations of rational curves. SINGULAR distribution.
http://www.singular.uni-kl.de
9. J. Böhm, W. Decker, M. Schulze, Local analysis of Grauert-Remmert-type normalization
algorithms. Int. J. Algebra Comput. 24(1), 69–94 (2014)
10. J. Böhm, W. Decker, S. Laplagne, G. Pﬁster, Computing integral bases via localization and
Hensel lifting (2015). http://arxiv.org/abs/1505.05054
11. J. Böhm, W. Decker, C. Fieker, G. Pﬁster, The use of bad primes in rational reconstruction.
Math. Comput. 84, 3013–3027 (2015)
12. J. Böhm, W. Decker, S. Laplagne, F. Seelisch, adjointideal.lib - a SINGULAR 4-1-0 library for
computing adjoint ideals of curves. SINGULAR distribution. http://www.singular.uni-kl.de
13. N. Brieskorn, Plane Algebraic Curves (Birkhäuser, Basel, 1986)
14. A. Brill, M. Noether, Über die algebraischen Functionen und ihre Anwendung in der
Geometrie. Math. Ann. 7, 269–310 (1874)
15. R. Buchweitz, G.-M. Greuel, The Milnor number and deformations of complex curve
singularities. Invent. Math. 58, 241–281 (1980)
16. G. Castelnuovo, Massima dimensione dei sistemi lineari di curve piane di dato genere. Ann.
Mat. (2) 18, 119–128 (1890)
17. G. Castelnuovo, Sui multipli di una serie lineare di gruppi di punti appartenenti ad una curva
algebrica. Rend. Circ. Mat. Palermo 7, 89–110 (1893)
18. N. Chiarli, Deﬁciency of linear series on the normalization of a space curve. Commun. Algebra
12, 2231–2242 (1984)
19. C. Ciliberto, F. Orecchia, Adjoint ideals to projective curves are locally extended ideals.
Bollettino U.M.I. (6) 3-B, 39–52 (1984)
20. W. Decker, G.-M. Greuel, G. Pﬁster, T. de Jong, The normalization: a new algorithm,
implementation and comparisons, in Computational Methods for Representations of Groups
and Algebras (Essen, 1997) (Birkhäuser, Basel, 1999)
21. W. Decker, G.-M. Greuel, G. Pﬁster, H. Schönemann, SINGULAR 4-1-0 — a computer algebra
system for polynomial computations. http://www.singular.uni-kl.de
22. T. De Jong, An algorithm for computing the integral closure. J. Symb. Comput. 26, 273–277
(1998)
23. T. De Jong, G. Pﬁster, Local Analytic Geometry (Vieweg, Braunschweig, 2000)
24. J. Dieudonne, Topics in Local Algebra. Notre Dame Mathematical Lectures (University of
Notre Dame Press, Notre Dame, 1967)
25. D. Eisenbud, Commutative Algebra with a View Toward Algebraic Geometry (Springer, Berlin,
1995)
26. M. El Kahoui, Z.Y. Moussa, An algorithm to compute the adjoint ideal of an afﬁne plane curve.
Math. Comput. Sci. 8, 289–298 (2014)
27. D. Gorenstein, An arithmetic theory of adjoint plane curves. Trans. Am. Math. Soc. 72, 414–
436 (1952)
28. H. Grauert, R. Remmert, Analytische Stellenalgebren. Unter Mitarbeit von O. Riemenschnei-
der, Die Grundlehren der mathematischen Wissenschaften, Band 176 (Springer, Berlin, 1971)
29. S. Greco, P. Valabrega, On the theory of adjoints, in Algebraic Geometry. Lecture Notes in
Mathematics, vol. 732 (Springer, Berlin, 1979), pp. 99–123

Algorithms for the Gorenstein Adjoint Ideal of a Curve
95
30. S. Greco, P. Valabrega, On the theory of adjoints II. Rendiconti del Circolo Matematico di
Palermo, Serie II, Tomo XXXI, 5–15 (1982)
31. G.-M. Greuel, On Deformations of Curves and a Formula of Deligne. Algebraic Geometry (La
Rábida 1981). Lecture Notes in Mathematics, vol. 961 (Springer, Berlin, 1982)
32. G.-M. Greuel, G. Pﬁster, A Singular Introduction to Commutative Algebra (Springer, Berlin,
2008)
33. G.-M. Greuel, C. Lossen, E. Shustin, Introduction to Singularities and Deformations (Springer,
Berlin, 2007)
34. G.-M. Greuel, S. Laplagne, F. Seelisch, Normalization of rings. J. Symb. Comput. 45(9), 887–
901 (2010)
35. G.-M. Greuel, S. Laplagne, G. Pﬁster, normal.lib – a SINGULAR library for computing the
normalization of afﬁne rings. SINGULAR distribution, http://www.singular.uni-kl.de
36. W. Gröbner, Idealtheoretischer Aufbau der algebraischen Geometrie, Teil I (Teubner, Leipzig,
1941)
37. R. Hartshorne, Algebraic Geometry (Springer, Berlin, 1977)
38. A. Hirano, Construction of plane curves with cusps. Saitama Math. J. 10, 21–24 (1992)
39. H. Hironaka, On the arithmetic genera and the effective genera of algebraic curves. Mem.
College Sci. Univ. Kyoto Ser. A Math. 30(2), 177–195 (1957)
40. N. Idrees, G. Pﬁster, S. Steidel, Parallelization of modular algorithms. J. Symb. Comput. 46,
672–684 (2011)
41. O. Keller, Die verschiedenen Deﬁnitionen des adjungierten Ideals einer ebenen algebraischen
Kurve. Math. Ann. 159, 130–144 (1965)
42. O. Keller, Vorlesungen über algebraische Geometrie (Akademische Verlagsgesellschaft,
Leipzig, 1974)
43. D. Le Brigand, J.J. Risler, Algorithme de Brill-Nother et codes de Goppa. Bulletin de la S. M.
F. 116, 231–253 (1988)
44. J. Lipman, A numerical criterion for simultaneous normalization. Duke Math. J. 133(2), 347–
390 (2006)
45. Q. Liu, Algebraic Geometry and Arithmetic Curves (Oxford University Press, Oxford, 2002)
46. MAPLE (Waterloo MAPLE Inc.), MAPLE (2012). http://www.maplesoft.com/
47. E. Matlis, 1-Dimensional Cohen-Macaulay Rings. Lecture Notes in Mathematics, vol. 327
(Springer, Berlin, 1970)
48. J.S. Milne, Étale Cohomology (Princeton University Press, Princeton, NJ, 1980)
49. T. Milnor, Singular Points of Complex Hypersurfaces. Annals of Mathematics Studies, vol. 61
(Princeton University Press, Princeton, NJ, 1968)
50. M. Mnuk, An algebraic approach to computing adjoint curves. J. Symb. Comput. 23(2–3),
229–240 (1997)
51. F. Orecchia, I. Ramella, On the computation of the adjoint ideal of curves with ordinary
singularities. Appl. Math. Sci. 8(136), 6805–6812 (2014)
52. K. Petri, Über Spezialkurven I. Math. Ann. 93, 182–209 (1924)
53. R. Riemann, Theorie der Abel’schen Functionen. J. Reine Angew. Math. 54(14), 115–155
(1857)
54. J.R. Sendra, F. Winkler, Parametrization of algebraic curves over optimal ﬁeld extensions.
Parametric algebraic curves and applications (Albuquerque, NM, 1995). J. Symb. Comput.
23(2–3), 191–207 (1997)
55. J.R. Sendra, F. Winkler, S. Perez-Diaz, Rational Algebraic Curves. Algorithms and Computa-
tion in Mathematics, vol. 22 (Springer, Berlin, 2008)
56. I.R. Shafarevich, Algebraic Geometry I (Springer, Berlin, 1994)
57. I. Swanson, C. Huneke, Integral Closure of Ideals, Rings, and Modules (Cambridge University
Press, Cambridge, 2006)
58. N. Tschebotareff (Chebotarev), Die Bestimmung der Dichtigkeit einer Menge von Primzahlen,
welche zu einer gegebenen Substitutionsklasse gehören. Math. Ann. 95, 191–228 (1925)
59. B.L. van der Waerden, Einführung in die algebraische Geometrie. Die Grundlehren der
Mathematischen Wissenschaften (Vieweg, Braunschweig, 1939)

96
J. Böhm et al.
60. M. van Hoeij, An algorithm for computing an integral basis in an algebraic function ﬁeld.
J. Symb. Comput. 18(4), 353–363 (1994)
61. O. Zariski, P. Samuel, Commutative Algebra I (Springer, Berlin, 1975)

Picard Curves with Small Conductor
Michel Börner, Irene I. Bouw, and Stefan Wewers
Abstract We study the conductor of Picard curves over Q, which is a product
of local factors. Our results are based on previous results on stable reduction of
superelliptic curves that allow one to compute the conductor exponent fp at the
primes p of bad reduction. A careful analysis of the possibilities of the stable
reduction at p yields restrictions on the conductor exponent fp. We prove that Picard
curves over Q always have bad reduction at p D 3, with f3  4. As an application
we discuss the question of ﬁnding Picard curves with small conductor.
Keywords Picard curves • Conductor • Semistable reduction
Subject Classiﬁcations Primary 14H25. Secondary: 11G30, 14H45
1
Introduction
Let Y be a smooth projective curve of genus g over a number ﬁeld K. To simplify
the exposition, let us assume that K D Q. With Y we can associate an L-function
L.Y; s/ and a conductor NY 2 N. Conjecturally, the L-function satisﬁes a functional
equation of the form
.Y; s/ D ˙.Y; 2  s/;
where
.Y; s/ WD
p
NY
s  .2/gs   .s/g  L.Y; s/:
M. Börner • I.I. Bouw • S. Wewers ()
Institut für Reine Mathematik, Universität Ulm, Germany
e-mail: irene.bouw@uni-ulm.de; stefan.wewers@uni-ulm.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_4
97

98
M. Börner et al.
By deﬁnition, both L.Y; s/ and NY are a product of local factors. In this paper we
are really only concerned with the conductor, which can be written as
NY D
Y
p
p fp:
The exponent fp is called the conductor exponent of Y at p. It is known that fp only
depends on the ramiﬁcation of the local Galois representation associated with Y. In
particular, if Y has good reduction at p then fp D 0. If Y has bad reduction at p then
the computation of fp can be quite difﬁcult. Until recently, an effective method for
computing fp was only known for elliptic curves [23, §IV.10] and for genus 2 curves
if p ¤ 2 [10].
It was shown in [3] that fp can effectively be computed from the stable reduction
of Y at p. Moreover, for certain families of curves (the superelliptic curves) we gave
a rather simple recipe for computing the stable reduction. The latter result needed
the assumption that p does not divide the degree n. In [18] this restriction is removed
for superelliptic curves of prime degree.
In the present paper we systematically study the case of Picard curves. These are
superelliptic curves of genus 3 and degree 3, given by an equation of the form
Y W y3 D f.x/ D x4 C a3x3 C a2x2 C a1x C a0;
with f 2 QŒx separable. Picard curves form in some sense the next family of curves
to study after hyperelliptic curves. They are interesting for many reasons and have
been intensively studied, see e.g. [8, 9, 13, 15].
Our main results classify all possible conﬁgurations for the stable reduction of
a Picard curve at a prime p, and use this to determine restrictions on the conductor
exponents. For instance, we prove the following.
Theorem 1.1 Let Y be a Picard curve over Q.
(a) Then Y has bad reduction at p D 3, and f3  4.
(b) For p D 2 we have f2 ¤ 1.
(c) For p  5 we have fp 2 f0; 2; 4; 6g.
Theorem 3.6 is a somewhat stronger version of the ﬁrst statement. Theorem 4.4
contains the last two statements. We also give explicit examples, showing that at
least part of our results are sharp. Our result can be seen as a complement, for
Picard curves, to a result of Brumer–Kramer [4, Theorem 6.2], who prove an upper
bound for fp for abelian varieties of ﬁxed dimension. Since the conductor of a curve
coincides with that of its Jacobian, the result applies to our situation, as well. A more
careful case-by-case analysis, combined with ideas from [4], could probably be used
to obtain a more precise list of possible values for the conductor exponent at p D
2; 3, as well.
In the last section we discuss the problem of constructing Picard curves with
small conductor. As a consequence of the Shafarevich conjecture (aka Faltings’

Picard Curves with Small Conductor
99
Theorem), there are at most a ﬁnite number of nonisomorphic curves of given genus
and of bounded conductor. But except in very special cases, no effective proof of
this theorem is known.
In his recent PhD thesis, the ﬁrst named author has made an extensive search for
Picard curves with good reduction outside a small set of small primes, and computed
their conductor. The Picard curve with the smallest conductor that was found is the
curve
Y W y3 D x4  1;
which has conductor
NY D 2636 D 46656:
We propose as a subject for further research to either prove that the above example
is the Picard curve over Q with the smallest possible conductor, or to ﬁnd (one or
all) counterexamples. We believe that the methods presented in this paper may be
very helpful to achieve this goal.
2
Semistable Reduction
We ﬁrst introduce the general setup concerning the stable reduction and the con-
ductor exponents of Picard curves. As explained in the introduction, the conductor
exponent is a local invariant, encoding information about the ramiﬁcation of the
local Galois representation associated with the curve. Therefore, we may replace
the number ﬁeld K by its strict henselization. In other words, we may work from the
start over a henselian ﬁeld of mixed characteristic with algebraically closed residue
ﬁeld.
2.1
Setup and Notation
Throughout Sects. 2–4 the letter K will denote a ﬁeld of characteristic zero that is
henselian with respect to a discrete valuation. We denote the valuation ring by OK,
the maximal ideal of OK by p and the residue ﬁeld by k D OK=p. We assume that k
is algebraically closed of characteristic p > 0. The most important example for us is
when K D Qnr
p is the maximally unramiﬁed extension of the p-adic numbers. Then
p D . p/ and k D NFp.
Let Y=K be a Picard curve, given by the equation
Y W y3 D f.x/;
(1)

100
M. Börner et al.
where f 2 KŒx is a separable polynomial of degree 4. We set X WD P1
K and
interpret (1) as a ﬁnite cover  W Y ! X; .x; y/ 7! x; of degree 3.
By the Semistable Reduction Theorem (see [5]), there exists a ﬁnite extension
L=K such that the curve YL WD Y ˝K L has semistable reduction. Since g.Y/ D
3  2, there even exists a (unique) distinguished semistable model Y ! SpecOL
of YL, the stable model [5, Corollary 2.7]. The special ﬁber NY WD Ys of Y is called
the stable reduction of Y. It is a stable curve over k [5, § 1], and it only depends on
Y, up to unique isomorphism.
It is no restriction to assume that the extension L=K is Galois and contains a third
root of unity 3 2 L. Then the cover L W YL ! XL (the base change of  to L) is
a Galois cover. Its Galois group G is cyclic of order 3, generated by the element 
which is determined by
.y/ D 3y:
Let  WD Gal.L=K/ denote the Galois group of the extension L=K. The group 
acts faithfully and in a natural way on the scheme YL D Y ˝K L. We denote by QG
the subgroup of Aut.YL/ generated by G and the image of  . By deﬁnition, QG is a
semidirect product,
QG D G Ì :
The action of  on G via conjugation is determined by the following formula: for 
in  we have
1 D
(

if .3/ D 3;
2
if .3/ D 2
3:
(2)
Because of the uniqueness properties of the stable model, the action of QG on YL
extends to an action on Y . By restriction, we see that QG has a natural, k-linear
action1 on NY. This action will play a decisive role in our analysis of the stable
reduction NY. For the rest of this subsection we focus on the action of the subgroup
G 	 QG. The role of the subgroup  	 QG will become important later.
Remark 2.1
(a) The quotient scheme X
WD Y =G is a semistable model of XL D P1
L, see
e.g. [16, Cor. 1.3.3.i]. Since the map Y ! X is ﬁnite and Y is normal, Y
is the normalization of X in the function ﬁeld of YL. This means that Y is
uniquely determined by the cover Y ! X and a suitable semistable model X
of XL.
1By k-linear action we mean that the action is compatible with the structure of NY as a k-scheme.

Picard Curves with Small Conductor
101
(b) Let NX WD X ˝ k denote the special ﬁber of X and N W NY ! NX the induced
map. We note that N is a ﬁnite G-invariant map. It is not true in general that
NY=G D NX. However, the natural map NY=G ! NX is radical and in particular a
homeomorphism (see e.g. [16, p. 101]).
(c) Every irreducible component W
	
NY is smooth. To see this note that
the quotient of W by its stabilizer in G is homeomorphic to an irreducible
component Z 	 NX, which is a smooth curve of genus 0. If W has a singular
point, then  acts on W and permutes the two branches of W passing through
this point. But since  has order 3, this is impossible.
Let NY denote the component graph of NY: the vertices are the irreducible compo-
nents of NY and the edges correspond to the singular points. The stability condition
for NY means that an irreducible component of genus 0 corresponds to a vertex of NY
of degree 3. The number of loops of NY is given by the well known formula
.NY/ WD dimQ H1.NY; Q/ D r  s C 1;
(3)
where r is the number of edges and s the number vertices of NY.
The curve NX is also semistable, but in general not stable. Since NX has arithmetic
genus 0, the component graph NX is a tree, and every vertex corresponds to a smooth
curve of genus 0. It follows from Remark 2.1 that NX D NY=G.
Lemma 2.2 If W 	 NY is an irreducible component, then .W/ D W.
Proof To derive a contradiction, we assume that W1; W2; W3 	 NY are three distinct
components that form a single G-orbit. Then Wi

! Z WD N.Wi/. Since Z is a
component of NX, we conclude that g.Wi/ D 0, for i D 1; 2; 3. The stability condition
on NY implies that each Wi contains at least three singular points of NY. Hence Z also
contains at least three singular points of NX.
Let NY ! NY0 denote the unique morphism which contracts all components of NY
except the Wi and which is an isomorphism on the intersection of [iWi with the
smooth locus of NY. Similarly, let NX ! NX0 be the map contracting all components of
NX except Z. These maps ﬁt into a commutative diagram
where the vertical arrows are quotient maps by the group G (at least for the
underlying topological spaces). Also, NX0 Š Z.
Let Nx 2 Z be one of the singular points of NX lying on Z, and let T 	 NX be
the closed subset which is contracted to Nx 2 Z D NX0. Then T is a nonempty and
connected union of irreducible components of NX and hence a semistable curve of
genus 0. In particular, the component graph of T is a tree. Let Z0 	 T be a tail

102
M. Börner et al.
component. As a component of NX, Z0 intersects the rest of NX in at most two points.
Let W0 	 NY be an irreducible component lying above Z0. The stability of NY implies
that .W0/ D W0 and that the action of  on W0 is nontrivial. (Otherwise W0 would
be homeomorphicto Z0, and hence W0 would be a component of genus 0 intersecting
the rest of NY in at most two points.) It follows that the inverse image S 	 NY of T is
connected. Note that S meets the component Wi in the unique point on Wi above Nx.
Since S is connected, it follows that the map NY ! NY0 contracts S to a single point.
We conclude that the curve NY0 has at least three distinct singular points where all
three components Wi meet. Equation (3) implies that .NY0/ is at least 1. It follows
that the arithmetic genus of NY0 is  4, and hence g.NY/  4 as well. This is a
contradiction, and the lemma follows.
ut
2.2
The Conductor Exponent
Let cp be the conductor of the Gal. NK=K/-representation H1
et.Y NK; Q`/, see [21]. By
deﬁnition, this is an ideal of OK of the form
cp D pfp;
with fp  0. The integer fp is called the conductor exponent of Y=K.2
We recall from [3] an explicit formula for fp, in terms of the action of  D
Gal.L=K/ on NY. For this we let  u 	  , for u  0, denote the uth higher
ramiﬁcation group (in the upper numbering). We set NYu WD NY= u. Note that NYu
is a semistable curve for all u. Note also that  D  0 because the residue ﬁeld k is
assumed to be algebraically closed.
Proposition 2.3 The conductor exponent of the curve Y=K is given by
fp D  C ı;
(4)
where
 WD 6  dim H1
et.NY0; Q`/
(5)
and
ı WD
Z 1
0

6  2g.NYu/

du:
(6)
Proof See [3, Theorem 2.9] and [2, Corollary 2.14].
ut
2When working in a local context, fp is often simply called the conductor of Y.

Picard Curves with Small Conductor
103
The étale cohomology group H1
et.NYu; Q`/ decomposes as
H1
et.NYu; Q`/ D ˚WH1
et.W; Q`/ ˚ H1.NYu; Q`/;
where the ﬁrst sum runs over the set of irreducible components W of the normal-
ization of NYu and NYu is the graph of components of NYu. (See [3, Lemma 2.7.(1)].)
Therefore, the second term in (5) can be written as
dim H1
et.NY0; Q`/ D
X
W
dim H1
et.W; Q`/ C dim H1.NY0/:
(7)
The arithmetic genus of NYu, which occurs in (6), is given by the formula
g.NYu/ D
X
W
g.W/ C dim H1.NYu/:
(8)
For future reference we note that dim H1
et.W; Q`/ D 2g.W/. The integer .NY0/ WD
dim H1.NY0/ can be interpreted as the number of loops of the graph NY0. It is
bounded by g.NY0/, and hence by g.Y/ D 3.
Lemma 2.4 The following statements are equivalent.
(a) ı D 0.
(b)  u acts trivially on NY, for all u > 0.
(c) The curve Y has semistable reduction over a tamely ramiﬁed extension of K.
Proof Assume that ı D 0. By (6) this means that 3 D g.NY/ D g.NYu/ for all u > 0.
Using (8) one easily shows that this means that  u acts trivially on the component
graph NY of NY. Moreover, for every component W 	 NY we have g.W/ D g.W= u/.
It follows that  u acts trivially on NY. We have proved the implication (a))(b). The
implication (b))(c) follows from [11, Theorem 4.44]. The implication (c))(a)
follows immediately from the deﬁnition of ı.
ut
3
The Wild Case: p D 3
In this section we assume that p D 3. We ﬁrst analyze the special ﬁber of the stable
model of YL, and show that there are essentially ﬁve reduction types. From Sect. 3.2
we consider the case where K is absolutely unramiﬁed, and derive a lower bound
for the conductor exponent f3.

104
M. Börner et al.
3.1
The Stable Model
We keep all the notation introduced in Sect. 2. In addition, we assume that p D 3.
By Lemma 2.2 every irreducible component of NY is ﬁxed by the generator  of G.
Therefore, irreducible components of NY fall into two different classes.
Deﬁnition 3.1 An irreducible component W 	 NY is called étale if the restriction
jW 2 Autk.W/ is nontrivial. If jW is the identity, then W is called an inseparable
component.
Let W 	 NY be an irreducible component, and let Z WD
N.W/ 	 NX be its
image. Then Z is an irreducible component of NX and hence a smooth curve of
genus 0. Lemma 2.2 shows that .W/ D W. It follows that W=G ! Z is a
homeomorphism. If W is an inseparable component, then W ! Z is a purely
inseparable homeomorphism (since W ! Z has degree 3, this can only happen
when p D 3). It follows that every inseparable component has genus zero.
If W is an étale component, then Z Š W=G, and W ! Z is a G-Galois cover. For
future reference we recall that the Riemann–Hurwitz formula for wildly ramiﬁed
Galois covers of curves yields
2g.W/  2 D 2  3 C
X
z
2.hz C 1/;
(9)
where the sum runs over the branch points of W ! Z and hz is the (unique) jump
in the ﬁltration of the higher ramiﬁcation groups in the lower numbering. We have
that hz  1 is prime to p [20, § IV.2, Cor. 2 to Prop. 9].
Theorem 3.2 We are in exactly one of the following ﬁve cases.
(a) The curve NY is smooth and irreducible.
(b) The curve NY has exactly two components W1; W2. Both of them are étale, they
meet in a single point, and have genus g.W1/ D 2, g.W2/ D 1.
(c) There are three étale components W1; W2; W3, all of genus one, and one
inseparable component W0, which has genus zero. For i D 1; 2; 3, Wi intersects
W0 in a unique point, and these intersection points are precisely the singular
points of NY.
(d) There are two components W1; W2, all of which are étale. Their genus is
g.W1/ D 1 and g.W2/ D 0. There are exactly three singular points, which
form an orbit under the action of G, and where W1 and W2 meet.
(e) There are three components W1; W2; W3, all of which are étale, Their genus is
g.W1/ D g.W2/ D 0 and g.W3/ D 1. Furthermore, there are four singular
points. Three of the singular points are points of intersection of W1 and W2, and
form an orbit under the action of G. The fourth singular point is the point of
intersection of W2 and W3.
Proof Let r1 (resp. s1) be the number of singular points (resp. irreducible compo-
nents) of NY which are ﬁxed by , and let r2 (resp. s2) be the number of orbits of

Picard Curves with Small Conductor
105
singular point (resp. irreducible components) of NY of length 3. Lemma 2.2 states
that s2 D 0. Therefore, (3) becomes
.NY/ D r  s C 1 D r1 C 3r2  s C 1:
(10)
Because NX D NY=G is a tree, we have
. NX/ WD dim H1.NX/ D r1 C r2  s C 1 D 0:
(11)
Combining (10) and (11) we obtain
.NY/ D 2r2:
(12)
Since 0  .NY/  3, we conclude that .NY/ 2 f0; 2g and r2 2 f0; 1g.
Case 1 r2 D 0 and .NY/ D 0.
In this case NY is a tree, and the sum of the genera of all irreducible components
is 3. In particular, there are at most three components of genus > 0. Moreover, the
stability condition implies that every component of genus zero contains at least three
singular points of NY. It is an easy combinatorial exercise to see that this leaves us
with exactly four possibilities for the tree NY. Going through these four cases we
will see that one of them is excluded, while the remaining three correspond to Cases
(a)–(c) of Theorem 3.2.
The ﬁrst case is when NY has a unique irreducible component. Then NY is smooth.
This is Case (a) of the lemma. Secondly, there may be two irreducible components,
of genus 1 and 2, and a unique singular point. This corresponds to Case (b).
Thirdly, there may be three irreducible components, each of genus 1, and two
singular points. We claim that this case cannot occur. Indeed, one of the three
components would contain two singular points, and each of these two points must
be a ﬁxed point of . It follows that the G-cover W ! Z D W=G is ramiﬁed in
at least two points. The Riemann–Hurwitz formula (9) implies that g.W/  2. This
yields a contradiction, and we conclude that this case does not occur.
Finally, in the last case, there are four singular points and four irreducible
components. Three of them have genus 1 and one has genus zero. The component
of genus zero necessarily contains all three singular points. A similar argument
as in the previous case shows that the genus-0 component cannot be étale. This
corresponds to Case (c).
Case 2 .NY/ D 2 and r2 D 1.
In this case the sum of the genera of all components is equal to 1. Therefore, there
must be a unique component of genus 1, and all other components have genus 0. Let
W1 and W2 be two components which meet in a singular point Ny such that .Ny/ ¤ Ny.
Since .Wi/ D Wi for i D 1; 2 (Lemma 2.2), W1 and W2 are étale components and
intersect each other in exactly three points (the G-orbit of Ny).

106
M. Börner et al.
If there are no further components, we are in Case (d). Assume that there exists
a third component W3. Let T 	 NY be the maximal connected union of components
which contains W3 but neither W1 nor W2. Then T contains a unique component
W0 which meets either W1 or W2 in a singular point. The component graph of
T is a tree, and we consider W0 as its root. By the stability condition, every tail
component of T must have positive genus, so T has a unique tail. If W0 is not this
tail, it has genus 0 and intersects the rest of NY in exactly 2 points. This contradicts
the stability condition. We conclude that NY has exactly three components, of genus
g.W1/ D g.W2/ D 0 and g.W3/ D 1. This is Case (e) of the lemma. Now the proof
is complete.
ut
3.2
A Lower Bound for f3
We continue with the assumptions from the previous subsection. In addition, we
assume that K is absolutely unramiﬁed. By this we mean that p D .3/. Under this
assumption, we prove a lower bound for the conductor exponent f3 WD fp. In fact,
we will give a lower bound for , where f3 D  C ı is the decomposition from
Proposition 2.3. If L=K is at most tamely ramiﬁed, then ı D 0 (Lemma 2.4). In this
case, our bounds are sharp.
Since K is absolutely unramiﬁed, the third root of unity 3 2 L is not contained
in K. Therefore, there exists an element  2  D Gal.L=K/ such that .3/ D 2
3.
Let m be the order of . After replacing  by a suitable odd power of itself we may
assume that m is a power of 2. We keep this notation ﬁxed for the rest of this paper.
Recall that the semidirect product QG D G Ì  acts on NY in a natural way.
The following observation is crucial for our analysis of the conductor exponent.
Lemma 3.3 Let W 	 NY be an étale component such that .W/ D W. Then inside
the automorphism group of W we have
 ı  ı 1 D 2 ¤ :
(13)
In particular, jW is nontrivial.
Proof The statement follows immediately from Eq. (2) and Deﬁnition 3.1.
ut
Despite its simplicity, Lemma 3.3 has the following striking consequence. Note
that we consider potentially good but not good reduction as bad reduction in this
paper.
Proposition 3.4 Assume that p D .3/. Then every Picard curve Y over K has bad
reduction.
Proof Lemma 3.3 implies that Y acquires semistable reduction only after passing
to a ramiﬁed extension L 3 3. Therefore Y=K does not have good reduction. The

Picard Curves with Small Conductor
107
fact that f3 ¤ 0 follows from Proposition 2.3, together with the fact that  acts
nontrivially on each irreducible component of NY (Lemma 3.3).
ut
In order to prove more precise lower bounds for f3, we need to analyze the action
of  and  on NY in more detail.
Lemma 3.5 Let W 	 NY be an étale component. Then one of the following cases
occurs:
g.W/ r
h
g.W= 0/
0
1
1
0
1
1
2
0
2
2 .1; 1/
1
3
1
4
0
Here r is the number of ramiﬁcation points of the G-cover W ! Z WD W=G and h
lists the set of lower jumps. The fourth column gives an upper bound for the genus
of W= 0.
Proof Recall that we have assumed that the order m of  is a power of 2.
The Riemann–Hurwitz formula (9) immediately yields the cases for g.W/; r, and
h stated in the lemma, together with one additional possibility: the curve W has
genus 3 and  W W ! Z Š P1 is branched at two points, with lower jump 1 and 2,
respectively. We claim that this case does not occur.
Assume that W is an étale component of NY such that  W W ! Z is branched at 2
points. Lemma 3.3 implies that  acts nontrivially on W. Since  normalizes  and
the two ramiﬁcation points have different lower jumps, it follows that  ﬁxes both
ramiﬁcation points wi of . We conclude that H WD h; i acts on W as a nonabelian
group of order 6 ﬁxing the vi.
We write hi for lower jump of wi. Lemma 2.6 of [14] implies that gcd.hi; m/ is the
order of the prime-to-3 part of the centralizer of H. Since gcd.h1; m/ ¤ gcd.h2; m/
we obtain a contradiction, and conclude that this case does not occur.
We compute an upper bound for the genus of W=hi in each of the remaining
cases. This is also an upper bound for g.W= 0/.
In the case that g.W/ D 0 there is nothing to prove. In the case that g.W/ D 1,
the automorphism  ﬁxes the unique ramiﬁcation point of , hence g.W= 0/ D 0:
Assume that g.W/ D 2. The Riemann–Hurwitz formula immediately implies
that g.W=hi/  1.
Finally, we consider the case that g.W/ D 3, i.e. Y has potentially good reduction.
As before, we have that  ﬁxes the unique ﬁxed point of . Put H D h; i.
Lemma 3.3 together with the assumption that the order m of  is a power of 2
implies that the order of the prime-to-p centralizer of H is gcd.h D 4; m/ D m=2.
It follows that m D 8. Since  has at least one ﬁxed point on W, namely the unique
ﬁxed point of , the Riemann–Hurwitz formula implies that g.W=hi/ D 0. This
ﬁnishes the proof of the lemma.
ut

108
M. Börner et al.
We have now all the necessary tools to prove our main theorem.
Theorem 3.6 Assume p D .3/, and let Y be a Picard curve over K. The conductor
exponent f3 of Y=K satisﬁes
f3  4:
Moreover:
(a) If f3  6 then Y achieves semistable reduction over a tamely ramiﬁed extension
L=K.
(b) If f3 D 4 then we are in Case (b) or Case (c) from Theorem 3.2.
(c) If f3 D 5 then we are in Case (d) or in Case (e) of Theorem 3.2.
Proof We use the assumptions and notations from the beginning of Sect. 3.2. Recall
that the inertia subgroup  0 	  WD Gal.L=K/ acts on the geometric special ﬁber
NY of the stable model of YL and that .the quotient NY0 D NY= 0 is again a semistable
curve.
Claim We have that
dim H1
et.NY0; Q`/  2:
(14)
Note that (14), together with (4) and (5), immediately implies the ﬁrst statement
f3  4 of the theorem.
Recall from (8) and (3) that the contribution of a smooth component W of NY0 to
dim H1
et.NY0; Q`/ is 2g.W/. The contribution of H1.NY/ to dim H1
et.NY0; Q`/ is .NY0/,
which is less than or equal to g.NY0/.
Let W 	 NY be an irreducible component, and denote by W0 	 NY0 its image in
NY0. Clearly, g.W0/  g.W/. Moreover, if .W/ D W then Lemma 3.5 shows that
g.W0/  1.
Let us consider each case of Theorem 3.2 separately. In Case (a), NY is smooth
and irreducible of genus 3. Then NY0 is also smooth and irreducible, and Lemma 3.5
shows that g.NY0/ D 0. So in Case (a) we have proved dim H1
et.NY0; Q`/ D 0,
which is strictly stronger than (14). Similarly, in Case (b) Lemma 3.5 shows that
NY0 consists of two irreducible components which meet in a single point. One of
these components has genus zero, the other one has genus  1. Therefore, (14)
holds in Case (b).
Assume that we are in Case (c). Let W1; W2; W3 denote the three components of
genus 1, and W0
i , i D 1; 2; 3, their images in NY0. Since the order of  is a power
of two,  ﬁxes exactly one of these components (say W1), or all three. In the ﬁrst
case, g.W0
1/ D 0 by Lemma 3.5, and W0
2 D W0
3. Therefore, dim H1
et.NY0; Q`/ D 1.
In the second case, g.W0
i / D 0 for i D 1; 2; 3, and dim H1
et.NY0; Q`/ D 0. In both
cases, (14) holds.
Now assume that we are in Case (d). The action of  0 must ﬁx both components
W1; W2, since g.W1/ ¤ g.W2/. Lemma 3.5 shows that g.Wi= 0/ D 0, for i D

Picard Curves with Small Conductor
109
1; 2. Also,  permutes the three singular points of NY. But these points form one
orbit under the action of G. Hence it follows from (13) that  ﬁxes exactly one
singular point and permutes the other two. We conclude that the curve NY0 has two
smooth components of genus 0 which meet in at most two points. We conclude that
dim H1
et.NY0; Q`/  1. A similar analysis shows that the same conclusion holds in
Case (e). This proves the claim (14).
While proving the claim, we have shown the following stronger conclusion:
dim H1
et.NY0; Q`/ 2
8
ˆˆ<
ˆˆ:
f0g;
Case (a),
f0; 2g;
Case (b), (c),
f0; 1g;
Case (d), (e).
(15)
It follows that  D 6 in Case (a),  2 f4; 6g in the Cases (b) and (c), and  2 f5; 6g
in the Cases (d) and (e).
The remaining statement that Y acquires stable reduction over a tamely ramiﬁed
extension L of K in the case that f3  6 follows from Lemma 2.4.
ut
Corollary 3.7 If p D .3/ and Y has potentially good reduction, then f3  6.
3.3
Examples
In this section we discuss two explicit examples of Picard curves over Qnr
3 in some
detail. These examples show, among other things, that the lower bounds for f3 given
by Theorem 3.6 are sharp.
Let us ﬁx some notation. We set K WD Qnr
3 . Given a suitable ﬁnite extension
L=K, we denote by vL the unique extension of the 3-adic valuation to L (which
is normalized such that vL.3/ D 1). We let F.XL/ denote the function ﬁeld of
XL WD P1
L, and identify F.XL/ with the rational function ﬁeld L.x/. For a Picard
curve Y over K given by y3 D f.x/ for a quartic polynomial f 2 KŒx the function
ﬁeld F.YL/ of YL is the degree-3 extension of F.XL/ obtained by adjoining the
function y.
Let X be a semistable model of XL, and let Z1; : : : ; Zn 	 NX WD X ˝ FL denote
the irreducible components of the special ﬁber. Since each Zi is a prime divisor
on X , it gives rise to a discrete valuation vi on F.XL/, extending vL. It has the
property that the residue ﬁeld of vi can be naturally identiﬁed with the function
ﬁeld of Zi. Since XL is simply a projective line and X is a semistable model, the
valuations vi have a simple description, as follows. For all i, there exists a coordinate
xi 2 F.XL/ such that vi is the Gauss valuation on F.XL/ D L.xi/ with respect to xi.
The coordinate xi is related to x by a fractional linear transformation
x D aixi C bi
cixi C di
;

110
M. Börner et al.
with aidi  bici ¤ 0. It can be shown that the model X is uniquely determined by
the set fv1; : : : ; vng, see [3] or [17].
Let Y denote the normalization of X inside the function ﬁeld F.YL/. Then Y
is a normal integral model of YL. In general, Y has no reason to be semistable, and
it is not clear in general how to describe its special ﬁber NY WD Y ˝ k. However,
each irreducible component W 	 NY corresponds again to a discrete valuation w on
F.YL/ extending vL, such that the residue ﬁeld of w is the function ﬁeld of W. It can
be shown that this gives a bijection between the irreducible components of NY and
the set of discrete valuations on F.YL/ extending one of the valuations vi (see e.g.
[17, § 3]). In many situations, the knowledge of all extensions of the vi to F.YL/
will give enough information to decide whether the model Y is semistable and to
describe its special ﬁber.
We need one more piece of notation. For m > 1 prime to 3 we set
Lm WD K./=K
where m D 3. Then Lm=K is a tamely ramiﬁed Galois extension of degree m. The
Galois group  WD Gal.Lm=K/ is cyclic and generated by the element  2 m WD
Gal.Lm=K/ determined by
./ D m;
where m 2 K is a primitive mth root of unity (which exists because k is algebraically
closed). Note also that Lm contains the third root of unity
3 WD 1 C m=2
2
:
We remark that the choice of  and m agrees with the notation chosen in Sect. 3.2
Example 3.8 Let Y be the Picard curve over K given by the equation
y3 D x4 C 1:
(16)
We claim that Y has potentially good reduction, which is attained over the tame
extension L WD L8 D K./=K, with 8 D 3.
To prove this, we apply the coordinate changes
x D 3x1;
y D 1 C 4y1
to (16). After a brief calculation, we obtain the new equation
y3
1  4y2
1  y1 D x4
1:
(17)

Picard Curves with Small Conductor
111
Equation (17) is equivalent to (16) in the sense that it deﬁnes a curve over K which
is isomorphic to Y. Also, (17) deﬁnes an integral model Y of YL. Its special ﬁber is
the curve over k D NF3 given by the (afﬁne) equation
NY W y3
1  y1 D x4
1:
This is a smooth curve of genus 3. It follows that Y has good reduction over L, as
claimed.
Since Y acquires stable reduction over a tame extension L=K, Lemma 2.4 implies
that f3 D . Equations (5) and (15) imply that f3 D 6.
For completeness, we compute the action of  0 D hi on NY explicitly. We
consider  as an automorphism of the structure sheaf of Y . By deﬁnition, we have
./ D 8;
.x/ D x;
.y/ D y:
It follows that
.x1/ D 5
8x1;
.y1/ D y1:
This describes jNY as an automorphism of NY of order 8, as expected from the proof
of Lemma 3.5.
Example 3.9 Let Y=K be the Picard curve
Y W y3 D f.x/ WD 3x4 C x3  54:
(18)
We claim that Y has semistable reduction over the tame extension L WD L4=K.
Moreover, the stable reduction NY is as in Case (b) of Theorem 3.2, and f3 D 4.
First we deﬁne a semistable model X of XL WD P1
L by specifying two discrete
valuations v1; v2 on F.XL/ which extend vL. By construction, the special ﬁber Xs of
X consists of two irreducible components NX1; NX2 which correspond to v1; v2. We
then show that the normalization Y of X in F.YL/ is the stable model of YL, and
determine its special ﬁber NY and the action of the inertia group of L=K on NY.
The valuation v1 is deﬁned as the Gauss valuation on F.XL/ D F.x1/ with respect
to the coordinate x1, which is related to x by
x D 2x1:
(19)
We claim that v1 has a unique extension w1 to F.YL/ that is unramiﬁed. To show
this, we need a so-called p-approximation of f with respect to v1, see [18]. In fact,
we can write
f D 6
x3
1 C 6.2  x4
1/

:

112
M. Börner et al.
Here we have used the relation 4 D 3. This suggests the coordinate change
y D 2.x1 C 2y1/:
(20)
After a short calculation we obtain a new equation for YL:
y3
1  2x1y2
1  x2
1y1 D 2  x4
1:
(21)
If we consider (21) as deﬁning an afﬁne curve over OL, its special ﬁber is the afﬁne
curve over k with equation
Ny3
1  Nx2
1Ny1 D 1  Nx4
1:
(22)
In fact, (22) deﬁnes an irreducible afﬁne curve with a cusp singularity in .Nx1; Ny1/ D
.0; 1/. It follows that the inverse image in NY of NX1 is an irreducible component W1
of multiplicity one birationally equivalent to the curve given by (22). To compute
the geometric genus of W1 we substitute Ny1 D 1 C Nx1Nz1 into (22) and obtain the
Artin–Schreier equation
Nz3
1  Nz1 D Nx1
1
 Nx1:
(23)
Using the Riemann–Hurwitz formula, one sees that W1 has geometric genus 2.
We now consider the second valuation v2 of F.XL/, deﬁned as the Gauss
valuation with respect to the coordinate x2 given by
x D 3.1 C x2/:
(24)
After a short calculation we can write
f D 33
.1 C x2/3  26x2
2 C 32.: : :/

:
(25)
This suggests to deﬁne a new function y2 2 F.YL/ via the change of coordinate
y D 3

.1 C x2/ C 2y2

:
(26)
Plugging in (26) into (18) and using (25) we arrive at the equation
y3
2 C 2.1 C x2/y2
2  .1 C x2/2y2 D 2x2
2 C 2.: : :/:
(27)
Reducing (27) modulo  we obtain the irreducible equation
Ny3
2  Ny2 D Nx2
2;
(28)
which deﬁnes a curve of genus 1. It follows that the inverse image of NX2 in NY is an
irreducible projective curve W2 of geometric genus 1.

Picard Curves with Small Conductor
113
So NY consists of two irreducible components W1 and W2 of geometric genus 2
and 1. On the other hand, Ys is known to have arithmetic genus 3. By a standard
argument (involving the computation of the arithmetic genus of a generically
reduced, singular curve) we can conclude that W1, W2 are smooth and meet
transversely in a single point. This shows that Y has semistable reduction over the
tame extension L4=K, with a stable model of type (b).
Let us try to analyze the action of  D  0 D hi on NY. By deﬁnition, ./ D
4, .x/ D x and .y/ D y. From (19) and (20) we deduce that jW1 is given by
.Nx1/ D Nx1;
.Ny1/ D Ny1;
.Nz1/ D Nz1:
From (24) and (26) we see that
.Nx2/ D 3
4 Nx2;
.Ny2/ D Ny2:
It follows that the curve NY0 WD NY= 0 has two irreducible smooth components,
W0
1 D W1= 0 and W0
2 D W2= 0, meeting in a single point. An easy calculation
(compare with the proof of Lemma 3.5) shows that g.W0
1/ D 1 and g.W0
2/ D 0. It
follows that g.NY0/ D 1 and dim H1.NY0/ D 0 and hence f3 D 6  2 D 4.
Remark 3.10 The two examples discussed above are quite special. Typically, the
extension L=K needs to be wildly ramiﬁed, and have rather large degree. It is then
hard (and often practically impossible) to do computations as above by hand. Most
of the examples in [1] and this paper have been computed with the help of (earlier
versions of) Julian Rüth’s Sage packages mac lane and completion (available
at https://github.com/saraedum), and the algorithms from [3] and [18].
4
The Tame Case: p ¤ 3
In this section we assume that the residue characteristic p of our ground ﬁeld K is
different from 3. In this case it is much easier to analyze the semistable reduction
of Picard curves and to compute the conductor exponent fp than for p D 3. The
theoretical background for this are the admissible covers, see [7, 11, § 10.4.3],
or [26]. In the case of superelliptic curves the computation of fp has already been
described in detail in [3], hence we can be much briefer than in the previous section.
4.1
The Stable Model
Let K be as in Sect. 2.1, with p ¤ 3. Let Y=K be a Picard curve, given by an equation
Y W y3 D f.x/;

114
M. Börner et al.
where f 2 KŒx is a separable polynomial of degree 4. Let L0=K denote the splitting
ﬁeld of f. Let L=L0 be a ﬁnite extension with ramiﬁcation index 3 such that L=K
is a Galois extension. Then [3], Corollary 4.6 implies that Y acquires semistable
reduction over L.
We note in passing that L=K is tamely ramiﬁed unless p D 2. This follows from
the deﬁnition of the Galois extension L0=K, whose degree divides 4Š D 24.
A semistable model Y of YL may be constructed as follows, see [3, § 4]. Let
D 	 X D P1
K denote the branch divisor of the cover  W Y ! X, consisting of the set
of zeros of f and 1. Since L contains the splitting ﬁeld of f, the pullback DL 	 YL
consists of 5 distinct L-rational points. Let .X ; D/ denote the stably marked model
of .XL; DL/. By this we mean that X is the minimal semistable model of XL with
the property that the schematic closure D 	 X of DL is étale over SpecOL and
contained inside the smooth locus of X ! SpecOL. Let NX WD X ˝ FL denote the
special ﬁber of X and ND D D \ NX the specialization of DL. Then . NX; ND/ is a stable
5-marked curve of genus zero. This means that NX is a tree of projective lines, where
every irreducible component has at least three points which are either marked (i.e.
lie in the support of ND) or are singular points of NX.
Let Y denote the normalization of X with respect to the cover YL ! XL.
Theorem 3.4 from [3] shows that Y is a quasi-stable model of YL. A priori, it is
not clear whether Y is the stable model of Y. The following case-by-case analysis
will show that it is.
We will use the fact that the natural map Y ! X is an admissible cover with
branch locus D. In particular, the induced map
N W NY ! NX
between the special ﬁber of Y and of X is generically étale and identiﬁes NX with
the quotient scheme NY=G.
We describe the restriction of the map N to an irreducible component NXi of NX.
Without loss of generality we may assume that K (and hence L) contains a primitive
third root of unity 3, which we ﬁx. For each branch point  of NjNXi the canonical
generator of inertia g 2 G is characterized by gu  3u .mod u2/, where u is a
local parameter at Nj1
NXi .i/. A branch point of NjNXi is either the specialization of a
branch point of  or a singular point of NX.
Assume that  is the specialization of a branch point. An elementary calculation
shows that the canonical generator of inertia is equal to  if  is the specialization
of 1 and is equal to 2 otherwise. Now let  be a singularity of NX, and denote
the irreducible components intersecting in  by NX1 and NX2. Then the canonical
generators gi of the restrictions NjNXi at  satisfy
g1 D g1
2 :
(This last condition says that N is an admissible cover.)

Picard Curves with Small Conductor
115
The upshot is that the map N W NY ! NX is completely determined and easily
described by the stably marked curve . NX; ND/.
The following lemma lists the 5 possibilities for NX. Note that we need to
distinguish between 1 and the other 4 branch points. The proof is elementary, and
therefore omitted.
Lemma 4.1 With assumptions and notations as in the beginning of the section, we
have the following ﬁve possibilities for NX.
(a) The curve NX is irreducible.
(b) The curve NX consists of two irreducible components NX1 and NX2. Three of the
branch points of  including 1 specialize to NX1, the other two to NX2.
(c) The curve NX consists of three irreducible components NX1, NX2, and NX3, where NX1
and NX3 intersect NX2. The branch point 1 specializes to NX2, two other branch
points specialize to NX1, and two to NX3.
(d) The curve NX consists of two irreducible components NX1 and NX2. Three of the
branch points of  different from 1 specialize to NX1, the other two to NX2.
(e) The curve NX consists of three irreducible components NX1, NX2, and NX3, where NX1
and NX3 intersect NX2. Two branch points including 1 specialize to NX1, two other
branch points specialize to NX3, and the last one to NX2.
The following result immediately follows from the possibilities for NX, together
with the fact that N is an admissible cover.
Theorem 4.2 Let K be as in Sect. 2.1, with p ¤ 3. Let Y be a Picard curve over K,
L=K a ﬁnite Galois extension over which Y has semistable reduction. Let Y denote
the stable model of YL over OL and NY WD Y ˝ k the special ﬁber. Then NY is as in
one of the following ﬁve cases.
(a) The curve NY is smooth.
(b) The curve NY consists of two irreducible components, of genus 2 and 1, which
intersect in a unique singular point.
(c) The curve NY has three irreducible components W1; W2; W3 which are each
smooth of genus 1. There are two singular points where W1 (resp. W3) intersects
W2.
(d) There are two irreducible components W1; W2 of genus 0 and 1, respectively,
and three singular points where W1 and W2 intersect.
(e) There are three irreducible components W1; W2; W3, of genus 0, 0 and 1,
respectively, and 4 singular points. The components W1, W2 meet in three of
these singular points, while W2 and W3 meet in the fourth.
4.2
The Conductor Exponent in the Tame Case
In the tame case, there are no useful lower bounds for the conductor exponent.
In particular, Y may have good reduction in which case we have fp D 0. Also,

116
M. Börner et al.
unlike for p D 3, nothing is gained by assuming that the ground ﬁeld K is totally
unramiﬁed. Still, some useful restrictions on fp can be proved (see Theorem 4.4
below).
We start by recalling a well known criterion for good reduction, see e.g. [8, § 7].
Let
Y W y3 D f.x/ D a4x4 C a3x3 C a2x2 C a1x C a0
be a Picard curve over K. Replacing .x; y/ by .a1
4 x; a1
4 / and multiplying both sides
of the deﬁning equation by a3
4, we may assume that a4 D 1. Let . f/ 2 K denote
the discriminant of f. (Since we assume that f is separable, we have . f/ ¤ 0.)
After replacing .x; y/ by .u3x; u4y/ and multiplying by u12 on both sides, for a
suitable u 2 K, we may further assume that all coefﬁcients ai 2 OK are integral.
In particular, it follows that . f/ 2 OK. Since
.u12f.u3x// D u36. f/;
by the right choice of u, we may assume that
0  ordp.. f// < 36:
(29)
Lemma 4.3 Assume that the Picard curve Y is given by a minimal equation over
OK, as above. Then Y has good reduction if and only if . f/ 2 O
K .
Proof See [8, Lemma 7.13].
ut
Note that the forwards direction of Lemma 4.3 also follows from Theorem 4.2.
Here is what we can say in general about the conductor exponent.
Theorem 4.4 Let K be as before, with p ¤ 3, and Y a Picard curve over K. Let fp
denote the conductor exponent for Y, relative to the prime ideal p of OK. Then the
following holds.
(a) If fp D 0 then the stable reduction of Y is as in Case (a), (b), or (c) of
Theorem 4.2. Furthermore, the splitting ﬁeld L0=K of f is unramiﬁed at p.
(b) If p D 2 then fp ¤ 1.
(c) If p  5 then fp 2 f0; 2; 4; 6g.
Proof We start be proving Statement (a). Note that fp D 0 if and only if ı D 0
and dim H1
et.NY0; Q`/ D 6. The second condition, together with the discussion after
Proposition 2.3, implies that .NY0/. Statement (a) now follows immediately from
Theorem 4.4.
Claim The integer , deﬁned in Proposition 2.3, is even. The discussion following
Proposition 2.3 implies that fp is odd if and only if dim H1.NY0/ is odd. The case
distinction in Theorem 4.2 implies that dim H1.NY0/ is at most 2. Therefore to prove
the claim, it sufﬁces to show that .NY0/ D dim H1.NY0/ ¤ 1: We prove this in the

Picard Curves with Small Conductor
117
case that NY is as in (d) of Theorem 4.2. The argument in the case that NY is as in (e)
is very similar. In the other cases there is nothing to prove.
Assume that NY is as in (d) of Theorem 4.2. Then NX is as (d) of Lemma 4.1 and N
maps Wi to NXi. Since 1 is K-rational, the monodromy group  ﬁxes it. It follows
that  acts on the component NX2 to which 1 specializes. (This is similar to the
argument in the proof of [3, Lemma 5.4].) Since there is exactly one other branch
point specializing to NX2, this point is ﬁxed by  , as well. Similarly,  ﬁxes the
unique singularity. Since  ﬁxes at least 3 points on the genus-0 curve NX2, it acts
trivially on NX2. Equation (2) implies that the action of  on NY descends to NX. It
follows that  acts on W2 via a subgroup of G. We conclude that  either ﬁxes the
three singularities of NY or cyclically permutes them. It follows that .NY0/ is 2 or 0.
This proves the claim.
Assume that p D 2. Using Eq. (6) one shows that if ı ¤ 0 then ı  2. Therefore
Statement (b) follows from the claim.
For Statement (c) recall that L=K is at most tamely ramiﬁed for p  5. It follows
that ı D 0, and hence that fp D  is bounded by 2g.Y/ D 6. Statement (c) now
follows from the claim.
ut
Remark 4.5
(a) The condition fp D 0 in Theorem 4.4(a) is equivalent to the condition that the
Jacobian variety of Y has good reduction over K. This is the case if and only
if Y has stable reduction already over K, and the graph of components NY is a
tree. This observation is similar to the statement of Lemma 2.4.
(b) For p D 2 the conductor exponent f2 may be odd. An example can be found in
Example 5.5.
(c) The bound on fp for p D 5; 7 in Theorem 4.4.(c) is slightly sharper than the
bound for fp for general abelian varieties of dimension 3 from [4, Thm. 6.2].
The reason is that Brumer and Kramer obtain an upper bound for ı. For Picard
curves and p D 5; 7 we have ı D 0, whereas this is not necessarily the case for
general curves of genus 3.
For p D 2 the result of [4] yields the upper bound fp  28. Distinguishing the
possibilities for the stable reduction and combining our arguments with those of
[4] it might be possible to improve the bound in this case.
Example 4.6 Consider the Picard curve
Y W y3 D f.x/ D x4 C 14x2 C 72x  41
over K WD Qnr
5 . We claim that Y has semistable reduction over K, and that the
reduction type is as in Case (b) of Theorem 4.2. Therefore, f5 D 0.
We will argue in a similar way as in Sect. 3.3, see in particular Example 3.9, see
also [3, § 6 and § 7]. The ﬁrst observation is that
f D x4 C 14x2 C 72x  41  .x C 3/2.x2 C 4x C 1/ .mod 5/:
(30)

118
M. Börner et al.
By Hensel’s Lemma, f has two distinct roots ˛1; ˛2 2 OK with ˛2
i C 4˛i C 1  0
.mod 5/. The other two roots of f are congruent to 3 .mod 5/. Substituting x D
58 C 53x1 into f, we see that
f  56.3x2
1 C 4x1 C 2/ .mod 57/:
(31)
It follows that f has two more roots ˛3; ˛4 2 K of the form ˛i D 58 C 53ˇi, with
ˇi 2 OK and 3ˇ2
i C 4ˇi C 2  0 .mod 5/. So f splits over K.
Let .X ; D/ be the stably marked model of .X; D/, where X D P1
K and D D
f1; ˛1; : : : ; ˛4g. The calculation of the ˛i above shows that X is the OK-model
of X corresponding to the set of valuations fv0; v1g, where v0 (resp. v1) is the
Gauss valuation on K.x/ with respect to the parameter x (resp. to x1). Let Y be
the normalization of X in the function ﬁeld of Y. We claim that the special ﬁber NY
of Y consists of two irreducible components W0; W1 of geometric genus 2 and 1,
respectively. By the same argument as in Example 3.9, this already implies that Y
is semistable and that the special ﬁber is as in Case (b) of Theorem 4.2.
To prove the claim it sufﬁces to ﬁnd generic equations for W0 and W1. For W0
we just have to reduce the original equation for Y modulo 5. By (30) we obtain
W0 W Ny3 D .Nx C 3/2.Nx2 C 4Nx C 1/;
which shows that g.W0/ D 2. For W1 we write f as a polynomial in x1, substitute
y D 52w, divide by 56 and reduce modulo 5. By (31) we obtain
W1 W Nw3 D 3Nx2
1 C 4Nx1 C 2;
which shows that g.W1/ D 1. Now everything is proved.
ut
Remark 4.7 The example above is again rather special, since f5 D 0 even though Y
has bad reduction at p D 5. (See also Deﬁnition 5.4.)
5
Searching for Picard Curves over Q with Small Conductor
In this last section we brieﬂy address the problem of constructing Picard curves
with small conductor. We think this is an interesting problem which deserves further
investigation. The main background result here is the Shafarevich conjecture (which
is a theorem due to Faltings). We use this theorem via the following corollary.
Theorem 5.1 (Faltings) Fix a number ﬁeld K and an integer g  2.
(a) For any ﬁnite set S of ﬁnite places of K there exist at most a ﬁnite number of
isomorphism classes of smooth projective curves of genus g over K with good
reduction outside S.

Picard Curves with Small Conductor
119
(b) For any constant N > 0 there exists at most a ﬁnite number of isomorphism
classes of curves of genus g over K with conductor  N.
Proof Satz 6 in [6] states that there are at most a ﬁnite number of d-polarized abelian
varieties of dimension g over K with good reduction outside S, for ﬁxed K, g, d and
S. Statements (a) and (b) follow from this. For (a), one simply uses Torelli’s theorem
(see [6, p. 365, Korollar 1]). To deduce (b) we use that the conductor of a curve Y is
the same as the conductor of its Jacobian, and that an abelian variety over K has bad
reduction at a ﬁnite place p of K if and only if fp > 0 (see e.g. [22, Theorem 1]).
ut
Unfortunately, no effective proof of Theorem 5.1 is known in general.3 However,
for some special classes of curves effective proofs are known, see e.g. [25].
The problem we wish to discuss here is whether the statement of Theorem 5.1 can
be made computable in the case of Picard curves. More precisely: given a ﬁnite set S
of rational primes (or a bound N > 0), can we compute the ﬁnite set of curves with
good reduction outside S (resp. with conductor  N)? Note that this is not equivalent
to (and may be much easier than) having an effective proof of Theorem 5.1 for
Picard curves. For the ﬁrst problem, the answer is known to be afﬁrmative:
Proposition 5.2 There exists an algorithm which, given as input a number ﬁeld K
and ﬁnite set S of ﬁnite places of K, computes the set of isomorphism classes of all
Picard curves Y=K with good reduction outside S.
Proof This is the main result of [12]. The algorithm is an adaption to Picard curves
of the algorithm given by Smart for hyperelliptic curves, see [24]. The idea is that it
sufﬁces to determine the ﬁnite set of equivalence classes of binary forms of degree
4 over K whose discriminant is an S-unit (corresponding to the polynomial f.x/).
The latter problem can be reduced to solving an S-unit equation, for which effective
algorithms are known.
ut
Example 5.3 Let K D Q and S D f3g. Then there are precisely 63 isomorphism
classes of Picard curves over Q with good reduction outside S. See [12].
For example, the curve
Y W y3 D f.x/ D x4  3x3  24x2  x
has good reduction outside S D f3g (the discriminant of f is . f/ D 310). The
stable reduction NY of Y at p D 3 is as in Case (c) of Theorem 3.2, the exponent
conductor is f3 D 10 (see [1, Appendix A1.1]). This is the lowest value for the
conductor which occurs for the curves in the list of [12]. The conductor exponents
of all 63 Picard curves from [12] have been computed in [1], Appendix A1.2. From
this calculation it follows that the conductor exponent f3 only takes the values f3 D
10; 11; 12; 13; 15; 17; 19; 21.
3The precise meaning of an effective proof is that it provides an explicitly computable bound on
the height of the curve or abelian variety in question.

120
M. Börner et al.
The upper bound on the conductor exponent from abelian varieties of genus 3
from [4], Theorem 6.2 yields f3  21. The result stated above therefore implies that
this bound is also obtained for Picard curves.
Unfortunately we do not know any algorithm for solving (b), i.e. for ﬁnding all
Picard curves with bounded conductor. The reason that the method for (a) does not
solve (b) is the existence of exceptional primes.
Deﬁnition 5.4 Let Y be a Picard curve over Q and p a prime number. Then p is
called exceptional with respect to Y if Y has bad reduction at p and fp D 0 (the latter
means that the Jacobian of Y has good reduction at p).
Exceptional primes are rather rare. It can easily be shown, using the arguments
from this paper, that if p is an exceptional prime for Y then the splitting ﬁeld of the
polynomial f is unramiﬁed at p, and
ordp.. f// 2 f6; 12g:
Example 5.5 We consider the Picard curve over Q
Y W y3 D f.x/ D x4 C 14x2 C 72x  41:
The discriminant of f is . f/ D 2103456. So Y has good reduction outside S D
f2; 3; 5g. We have shown in Example 4.6 that f5 D 0, i.e. that 5 is an exceptional
prime. Using the methods of [3] and [18] one can prove that f2 D 19 and f3 D 13
(see e.g. this SageMathCloud worksheet: http://tinyurl.com/hp3qzmo, [19]). All in
all, the conductor of Y is
NY D 219313 D 835884417024:
Although S is small and p D 5 is an exceptional prime, NY is relatively large. We
have tried but were not able to ﬁnd a similar example with exceptional primes and a
signiﬁcantly smaller conductor. Nevertheless, the fact that exceptional primes exist
means that we cannot easily bound the size of the set S while searching for Picard
curves with bounded conductor.
Here is an example of a Picard curve with a relatively small conductor.
Example 5.6 Consider the Picard curve
Y=Q W y3 D f.x/ D x4  1:
The discriminant of f is . f/ D 256 D 28. It follows that Y has good reduction
outside S D f2; 3g. By [1, § 5.1.3], we have f2 D 6 and f3 D 6. Therefore,
NY D 2636 D 46656:

Picard Curves with Small Conductor
121
The ﬁrst named author has made an extensive search for Picard curves over Q
with small conductor [1, § 5.3]. Among all computed examples, the curve Y was the
one with the smallest conductor.
A remarkable property of the curve Y is that for every (rational) prime p it admits
a map to P1 of order prime to p, which becomes Galois over an extension: besides
the degree-3 map  given by .x; y/ 7! x, we have the map .x; y/ 7! y, which has
degree 4. In fact, the full automorphism group of Y has order 48, and is maximal in
the sense that Y= AutC.Y/ is a projective line, and the natural cover is branched at
three points.
It is instructive to compare the above example with the curve
Y0 W y3 D x4 C 1:
This is a twist of Y. The curve Y and Y0 become isomorphic over QŒi, yet have
different conductors. In fact,
NY0 D 21636;
see [1, § 5.1.2].
We propose to study the following problem.
Problem 5.7 Prove that the curve from Example 5.6 is the only Picard curve (up to
isomorphism) with conductor NY  46;656, or ﬁnd explicit counterexamples.
Proposition 5.2 and our main results (Theorems 3.6 and 4.4) suggest the
following strategy for construction Picard curves with small conductor and thereby
ﬁnding counterexamples. If we ignore the possibility of exceptional primes, a Picard
curve with conductor  2636 must have good reduction outside S, where S is one of
the following sets:
•
f2; 3; pg,
p  13,
•
f3; pg,
p  23.
To ﬁnd all such curves looks challenging but within reach. It should also be very
useful to take into account the local restrictions on the polynomial f imposed by our
results on curves with a speciﬁc value for fp. On the other hand, without an effective
proof of Theorem 5.1(b) for Picard curves, it is not clear at the moment how one
could actually prove that the curve from Example 5.6 (or any other curve we may
ﬁnd) has minimal conductor.

122
M. Börner et al.
References
1. M. Börner, L-functions of curves of genus  3. Ph.D. thesis, Universität Ulm, 2016, http://dx.
doi.org/10.18725/OPARU-4137
2. I.I. Bouw, S. Wewers, Semistable reduction of curves and computation of bad Euler factors
of L-functions. Notes for a minicourse at ICERM (2015), https://www.uni-ulm.de/ﬁleadmin/
website_uni_ulm/mawi.inst.100/mitarbeiter/wewers/course_notes.pdf
3. I.I. Bouw, S. Wewers, Computing L-functions and semistable reduction of superelliptic curves.
Glasg. Math. J. 59, 77–108 (2017)
4. A. Brumer, K. Kramer, The conductor of an abelian variety. Compos. Math. 92(2), 227–248
(1994)
5. P. Deligne, D. Mumford, The irreducibility of the space of curves of given genus. Publ. Math.
IHES 36, 75–109 (1969)
6. G. Faltings, Endlichkeitssätze für abelsche Varietäten über Zahlkörpern.
Invent. Math. 73,
349–366 (1983)
7. J. Harris, D. Mumford, On the Kodaira dimension of the moduli space of curves. Invent. Math.
67, 23–86 (1982)
8. R.P. Holzapfel, The Ball and Some Hilbert Problems (Birkhäuser, Basel, 1995)
9. K. Koike, A. Weng, Construction of CM Picard curves. Math. Comput. 74(249), 499–518
(2005)
10. Q. Liu, Conducteur et discriminant minimal de courbes de genre 2. Compos. Math. 94(1),
51–79 (1994)
11. Q. Liu, Algebraic Geometry and Arithmetic Curves (Oxford University Press, Oxford, 2006)
12. B. Malmskog, C. Rasmussen, Picard curves over Q with good reduction away from 3. LMS
Comput. (2016). arXiv:1407.7892
13. E. Picard, Sur des fonctions de deux variables indépendantes analogues aux fonctions
modulaires. Acta Math. 2(1), 114–135 (1883)
14. R. Pries, Wildly ramiﬁed covers with large genus. J. Number Theory 119(2), 194–209 (2006)
15. J.R. Quine, Jacobian of the Picard curve, in Extremal Riemann Surfaces (San Francisco, CA,
1995). Contemporary Mathematics, vol. 201 (American Mathematical Society, Providence, RI,
1997), pp. 33–41
16. M. Raynaud, Spécialisation des revêtements en caractéristique p > 0. Ann. Sci. Éc. Norm.
Supér. 32(1), 87–126 (1999)
17. J. Rüth, Models of curves and valuations. Ph.D. thesis, Universität Ulm, 2014, http://dx.doi.
org/10.18725/OPARU-3275
18. J. Rüth, S. Wewers, Semistable reduction of superelliptic curves of degree p (in preparation)
19. I. SageMath, SageMathCloud Online Computational Mathematics (2016), https://cloud.
sagemath.com/
20. J.P. Serre, Corps Locaux, Troisième édition (Hermann, Paris, 1968). Publications de
l’Université de Nancago, No. VIII
21. J.P. Serre, Facteurs locaux des fonctions zêta des variétés algébriques (déﬁnitions et conjec-
tures). Séminaire Delange-Pisot-Poitou (Théorie des Nombres) 19(2), 1–15 (1969)
22. J.P. Serre, J. Tate, Good reduction of abelian varieties. Ann. Math. 88(3), 492–517 (1968)
23. J.H. Silverman, Advanced Topics in the Arithmetic of Elliptic Curves.
Graduate Text in
Mathematics, vol. 151 (Springer, New York, 1994)
24. N.P. Smart, S-unit equations, binary forms and curves of genus 2. Proc. Lond. Math. Soc.
75(2), 271–307 (1997)
25. R. von Känel, An effective proof of the hyperelliptic Shafarevich conjecture. J. Théor. Nombres
Bordeaux 26(2), 507–530 (2014)
26. S. Wewers, Deformation of tame admissible covers of curves, in Aspects of Galois Theory, ed.
by H. Völklein. LMS Lecture Note Series, vol. 256 (Cambridge University Press, Cambridge,
1999), pp. 239–282

Normaliz 2013–2016
Winfried Bruns, Richard Sieg, and Christof Söger
Abstract In this article we describe mathematically relevant extensions to Nor-
maliz that were added to it during the support by the DFG SPP “Algorithmische und
Experimentelle Methoden in Algebra, Geometrie und Zahlentheorie”: nonpointed
cones, rational polyhedra, homogeneous systems of parameters, bottom decompo-
sition, class groups and systems of module generators of integral closures.
Keywords Hilbert basis • Hilbert series • Rational cone • Rational polyhedron •
Bottom decomposition • Class group • Triangulation • Linear diophantine system
Subject Classiﬁcations 52B20, 13F20, 14M25, 91B12
1
Introduction
The software package Normaliz [13] has been developed by the algebra and discrete
mathematics group at Osnabrück since 1998. It is a tool for the computation of
lattice points in rational polyhedra. Meanwhile it has been cited about 130 times in
the literature (see [13]) with applications to algebraic geometry, commutative alge-
bra, polytope theory, integer programming, combinatorial topology, group theory,
theoretical physics and other areas. There exist interfaces to the major computer
algebra systems CoCoA [1, 2], GAP [19], Macaulay2 [18] and Singular [17] and to
polymake [20], a comprehensive tool for the computation of polytopes. Normaliz
is used by other packages, notably by Regina [16], a tool for the exploration of
3-manifolds, and by SecDec [6] in the computation of multiscale integrals.
W. Bruns () • R. Sieg
Universität Osnabrück, Institut für Mathematik, 49069 Osnabrück, Germany
e-mail: wbruns@uos.de; richard.sieg@uos.de
C. Söger
Alter Mühlenweg 1, 49504 Lotte, Germany
e-mail: csoeger@uos.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_5
123

124
W. Bruns et al.
During the second half of the SPP 1489 “Algorithmische und Experimentelle
Methoden in Algebra, Geometrie und Zahlentheorie” Normaliz was supported
by the SPP. In this article we want to give an overview of those developments
during the period of support that concern important mathematical aspects. For the
mathematical background and unexplained terminology we refer the reader to Bruns
and Gubeladze [7].
The main algorithms of Normaliz have been documented in the papers by Bruns
with Koch [10], Ichim [9], Hemmecke, Ichim, Köppe and Söger [12], Söger [11]
and Ichim and Söger [14]. See [14] for the performance of Normaliz on its main
tasks.
Let A be a e  d matrix with integer entries, and a 2 Ze. Then the set
P D fx 2 RdI Ax  ag
(1)
is called a rational polyhedron. Moreover, let B be a f d matrix of integers, b 2 Zf ,
C be a g  d matrix of integers and c; m 2 Zg. Then
L D fx 2 Zd W Bx D b; Cx  c.m/g
(2)
is an afﬁne sublattice in Rd, and it is the task of Normaliz to “compute”’ the set
P\L (Fig. 1). So Normaliz can be considered as a tool for solving linear diophantine
systems of inequalities, equations and congruences. Rational polyhedra and afﬁne
lattices can also be, and often are, described in terms of parametrizations or
generators, and the conversion between the two descriptions for P and L separately
is a basic task prior to the computation of P \ L.
Fig. 1 Lattice points in a
polyhedron

Normaliz 2013–2016
125
The main computation goals of Normaliz are
Generation: ﬁnd a (ﬁnite) system of generators of N D P \ L;
Enumeration: Compute the Hilbert series
HN.t/ D
X
x2N
tdeg x
with respect to a grading on Zd.
Of course, Generation must be explained, and Enumeration must even be modiﬁed
somewhat to make sense in the general case.
The core case for Normaliz computations is the homogeneous one, in which the
vectors a; b; c in (1) and (2) are 0, under the additional assumption that P, which in
the homogeneous case is a cone C, is pointed, i.e. it does not contain a nontrivial
linear subspace. The afﬁne lattice L is then a subgroup of Zd, and for Generation
Normaliz must compute a Hilbert basis of the monoid M D C \ L, i.e., a minimal
system of generators of the monoid M.
For a long time Normaliz could only handle homogeneous systems in the pointed
case. These restrictions have been removed in two steps: version 2.11.0 (April
2014) introduced inhomogeneous systems and version 3.1.0 (February 2016) ﬁnally
removed the condition that P has a vertex. These extensions will be discussed in
Sects. 3 and 4, where also Generation and Enumeration will be made precise.
The Hilbert series is (the Laurent series expansion of) a rational function of type
HN.t/ D
Q.t/
.1  tg1/    .1  tgr/
with a Laurent polynomial Q.t/ 2 ZŒt; t1. In the general case there is no canonical
choice for the exponents g1; : : : ; gr in the denominator. One good possibility is to
take them as the degrees of, in the language of commutative algebra, a homogeneous
system of parameters (hsop). Such degrees can be found if one analyzes the face
lattice of the recession cone of the system (1) and (2); the cone of solutions of the
associated homogeneous system. This approach will be developed in Sect. 7. The
option to use an hsop was introduced in version 3.1.2 (September 2016).
The primal algorithm of Normaliz is based on triangulations. A critical magni-
tude for the algorithm is the sum of the determinants of the simplicial cones in the
triangulation. Since version 3.0.0 (September 2015) this determinant sum can be
optimized by using a bottom decomposition. In Sect. 5 we explain how a bottom
decomposition can be computed.
A normal afﬁne monoid M has a well-deﬁned class group. By a theorem of
Chouinard (see [7, 4.F]) it coincides with the class group of the monoid algebra
KŒM for an arbitrary ﬁeld K. Since version 3.0.0 Normaliz computes the class
group, as explained in Sect. 8.
The primal algorithm of Normaliz ﬁnds the Hilbert basis by ﬁrst computing
a system of generators of M as a module (in a natural way) over an input (or
precomputed) monoid M0. Therefore it can be used to ﬁnd a minimal system of
module generators of M over M0. In more picturesque language these generators are

126
W. Bruns et al.
called “fundamental holes” of M0. See Kohl et al. [22] for a package making use of
this Normaliz feature.
There are several other extensions and options that have been introduced during
the support of the Normaliz project by the SPP:
1. new input format (with backward compatibility),
2. standard sorting of vector lists in the output,
3. completely revised linear algebra with permanent overﬂow check,
4. automatic choice of integer type (64 bit or inﬁnite precision),
5. computation of integer hulls as an option,
6. reﬁnement of the triangulation to a disjoint decomposition,
7. subdivision of “ large” simplicial cones by using SCIP [3] or approximation
methods (see Bruns et al. [15]),
8. a normality test that avoids the computation of the full Hilbert basis,
9. improvement of the Fourier-Motzkin algorithm in connection with pyramid
decomposition (see [14]),
10. revision of the dual algorithm,
11. various improvements in the algorithms that save memory and computation
time,
12. improvements in NmzIntegrate (see Bruns and Söger [11]).
The ﬁle CHANGELOG in the Normaliz distribution gives an overview of the
evolution.
The package HeLP [5] is an example for the application of Normaliz in another
project of the SPP.
2
The Normaliz Primal Algorithm
The heart of Normaliz are two algorithms. The primal algorithm can be applied
both to Generation and Enumeration. Among the two it is the considerably more
complicated one. The dual algorithm can only be used for Generation. We refer the
reader to Bruns and Ichim [9] for its description.
Since some details of the primal algorithm play a role in the following, we
include a brief outline. The primal algorithm starts from a pointed rational cone
C 	 Rd given by a system of generators x1; : : : ; xn and a sublattice L 	 Zd that
contains x1; : : : ; xn. (Other types of input data are ﬁrst transformed into this format.)
The algorithm is composed as follows:
1. Initial coordinate transformation to E D L \ .Rx1 C    C Rxn/;
2. Fourier-Motzkin elimination computing the support hyperplanes of C;
3. pyramid decomposition and computation of the lexicographic triangulation ;
4. evaluation of the simplicial cones in the triangulation:
(a) enumeration of the set of lattice points E in the fundamental domain of a
simplicial subcone ,
(b) reduction of E to the Hilbert basis Hilb./,

Normaliz 2013–2016
127
(c) Stanley decomposition for the Hilbert series of 0 \ L where 0 is a suitable
translate of ;
5. Collection of the local data:
(a) reduction of S
2 Hilb./ to Hilb.C \ L/,
(b) accumulation of the Hilbert series of the intersections 0 \ L;
6. reverse coordinate transformation to Zd.
The algorithm does not strictly follow this chronological order, but interleaves
steps 2–5 in an intricate way to ensure low memory usage and efﬁcient paralleliza-
tion. The steps 2 and 5 are treated in [9]. Steps 3 and 4 are described in [14]; the
translates 0 in 4c are chosen in such a way that C \ L is the disjoint union of their
lattice points.
In view of the initial and ﬁnal coordinate transformations 1 and 6 it is no essential
restriction to assume that dim C D d and L D Zd, as we will often do in the
following.
3
Nonpointed Cones and Nonpositive Monoids
In this section we discuss only the homogeneous situation in which the polyhedron
P 	 Rd is a cone C and the afﬁne lattice L is a subgroup of Rd. Since [7] contains
an extensive treatment of the mathematical background, we content ourselves with
a brief sketch and references to [7].
The basic ﬁniteness result in polyhedral convex geometry is the theorem of
Minkowski-Weyl [7, 1.15]. It shows that one can equivalently describe cones by
generators or by inequalities.
Theorem 3.1 The following conditions are equivalent for a subset C of Rd:
1. there exist (integer) vectors x1; : : : ; xn such that C D RCx1 C    C RCxn;
2. there exist linear forms (with integer coefﬁcients) 1; : : : ; s on Rd such that C D
fx 2 Rd W i.x/  0; i D 1; : : : ; sg.
With the additional requirement of integrality in the theorem, C is called a
rational cone. If dim RC D d and the number of linear forms is chosen to be
minimal, the i in the theorem are uniquely determined up to positive scalars, and
they are even unique if we additionally require that the coefﬁcients are coprime
integers. In this case we call 1; : : : ; s the support forms of C. The map  W Rd !
Rs; .x/ D .1.x/; : : : ; s.x//; is called the standard map of C. Clearly,  maps Zd
to Zs in the rational case.
The conversion from generators to inequalities in the description of cones is
usually called convex hull computation and the converse transformation is vertex
enumeration. These two transformations are two sides of the same coin and
algorithmically completely identical since they amount to the dualization of a cone.

128
W. Bruns et al.
While this is not the main task of Normaliz, it often outperforms dedicated packages.
See the recent benchmarks by Assarf et al. [4] and Köppe and Zhou [21].
In view of the remarks in Sect. 2 we can assume that dim C D d and that the
subgroup L 	 Zd is Zd itself. Thus the task is to compute the monoid M D C \ Zd.
The basic ﬁniteness result for such monoids is Gordan’s lemma [7, 2.9]:
Theorem 3.2 There exist x1; : : : ; xn 2 Rd such that M D ZCx1 C    C ZCxn.
At this point it is useful to borrow some terminology from number theory. We
call U.M/ D fx 2 M W x 2 Mg the unit group of M. Clearly, U.M/ D fx 2 M W
.x/ D 0g. The unit group is the maximal subgroup of Zd that is contained in M.
One calls M positive if U.M/ D 0. Similarly, the maximal linear subspace of C
is U.C/ D Ker . It is not hard to see that the positivity of M is equivalent to the
pointedness of C: one has U.C/ D RU.M/, and therefore U.M/ D 0 if and only if
U.C/ D 0.
An element x 2 MnU.M/ is called irreducible if a decomposition x D yCz with
y; z 2 M is only possible with y 2 U.M/ or z 2 U.M/. The role of the irreducible
elements in the generation of M is illuminated by the following theorem [7, 2.14
and 2.26].
Theorem 3.3 Let M D C \ Zd. Then the following hold:
1. every element x of M can be written in the form x D u C y1 C    C ym where u
is a unit and y1; : : : ; ym are irreducible;
2. up to differences by units, there exist only ﬁnitely many irreducibles in M;
3. let H 	 M; then the following are equivalent:
a. M D U.M/ C ZCH and H is minimal with this property;
b. H contains exactly one element of each residue class of irreducibles modulo
U.M/.
4. M Š U.M/ ˚ .M/.
If H satisﬁes the equivalent conditions in statement 3 we call it a Hilbert basis of
M. Clearly, together with a basis of the free abelian group U.M/ the Hilbert basis
gives a minimal ﬁnite description of M. Statement 4 shows that U.M/ and .M/
are independent of each other. Moreover, the submonoid of M generated by H is
isomorphic to .M/.
Note that H is uniquely determined if M is positive, so that we can denote it
by Hilb.M/. In the general case H is a Hilbert basis of M if and only if .H/ D
Hilb..M//. Therefore Generation can be split into two subtasks: (i) ﬁnd U.M/, the
kernel of the Z-linear map jZd and (ii) ﬁnd the Hilbert basis of the positive monoid
.M/. The ﬁrst task is a matter of solving a homogeneous diophantine system of
linear equations, and the second is what Normaliz has done from its very beginnings.
The theory above can be developed for arbitrary afﬁne monoids; see [7, Ch. 2].
However, the direct sum decomposition M Š U.M/ ˚ .M/ is not always possible.
What we have described for Hilbert bases, applies similarly to extreme rays of
cones. These are only deﬁned modulo U.C/ in the general case.

Normaliz 2013–2016
129
Fig. 2 A nonpointed cone
Normaliz’ dual algorithm for the computation of Hilbert bases effectively does
all its computations in the pointed cone .C/; see [9]. Nevertheless, versions before
2.11.0 did not output the results if the cone was not pointed.
The primal algorithm could have been modiﬁed for Hilbert basis computations
of nonpointed cones, but we do not see a way for the computation of Hilbert series
in the nonpointed case. Moreover, the passage to the quotient modulo the maximal
linear subspace reduces the dimension and therefore speeds up the computation. Let
us look at a simple example (Fig. 2). The output shows:
1 Hilbert basis elements of degree 1:
0 1
0 further Hilbert basis elements of higher degree:
1 extreme rays:
0 1
1 basis elements of maximal subspace:
1 -2
Since in the vast majority of cases Normaliz is applied to positive monoids,
Normaliz does not (always) try to compute U.M/ beforehand—very likely it is 0.
The computation of  requires the computation of the support hyperplanes of C.
Eventually these will be known, but their computation is inevitably intertwined with
the computation of the triangulation, and would essentially have to be done twice.
Therefore Normaliz takes the following “bold” approach in the primal algorithm:
1. Start the computation and proceed under the assumption that C is pointed.
2. As soon as the support hyperplanes have been computed, decide positivity.

130
W. Bruns et al.
3. If it should fail, throw an exception, perform the coordinate transformation to the
pointed quotient, and restart the computation.
After Generation let us discuss Enumeration. A linear form deg W Zd ! Z is
called a grading on M if deg x  0 for all x 2 M and deg x > 0 for x 2 M n U.M/.
The Hilbert series of M with respect to deg is the formal power series
HM.t/ D
X
x2M
tdeg x:
If M is positive there exist only ﬁnitely many elements in each degree, and the
deﬁnition of HM.t/ makes sense. This is not the case if U.M/ ¤ 0—there exist
already inﬁnitely many elements of degree 0. Hence, if M is not positive, the only
Hilbert series that we can associate to it, is that of .M/. In fact, since deg.x/ D 0
for x 2 U.M/, deg induces a grading on .M/: if .x/ D .y/, then x  y 2 U.M/,
and so deg x D deg y. Therefore Normaliz (always) computes H.M/.t/, and the
invariants that depend on the Hilbert series are also computed for .M/.
4
Inhomogeneous Systems
In algebraic geometry one passes from an afﬁne variety to a projective one by
homogenization, and the same technique is used in discrete convex geometry to
reduce algorithms for polyhedra to algorithms for cones. Let P 	 Rd be an arbitrary
polyhedron. Then the cone over P is the closed set
C.P/ D RC.P  f1g/ 	 RdC1:
This amounts to passing from an inhomogeneous system to a homogeneous one
by introducing a homogenizing variable, the .d C 1/th coordinate. Setting the
homogenizing variable equal to 1, we get the inhomogeneous system back. In fact, it
is not hard to see that one obtains a system of inequalities for C.P/ by homogenizing
such a system for P and adding the inequality xdC1  0.
If we set the homogenizing variable equal to 0 we obtain the associated
homogeneous system, and its solution set is called the recession cone in our case:
rec.P/ D fx 2 Rd W .x; 0/ 2 C.P/g:
It is useful to introduce the level of a point x 2 RdC1,
lev.x/ D xdC1:
By (de)homogenizing the Minkowski-Weyl theorem 3.1 one arrives at Motzkin’s
theorem; see [7, 1.27]:

Normaliz 2013–2016
131
Theorem 4.1 Let P be a nonempty subset of Rd. Then the following are equiva-
lent:
1. P is a polyhedron;
2. there exist a nonempty polytope Q and a cone C such that P D Q C C.
A polytope is a bounded polyhedron; a special case of Theorem 4.1 is Minkow-
ski’s theorem: P is a polytope if and only if P is the convex hull of ﬁnitely many
points.
For the cone C in the theorem one has no choice: C D rec.P/. The polytope P
is unique only if it is chosen minimal and rec.P/ is pointed. In this case it must be
the convex hull of the vertices of P. In the general case the vertices, like the extreme
rays of cones, are only deﬁned modulo the maximal linear subspace U.rec.P//.
One can interpret Theorem 4.1 as saying that polyhedra are ﬁnitely generated: Q
is the convex hull of ﬁnitely many points, and the cone C is ﬁnitely generated. Finite
generation holds also for lattice points, as we will see now.
In the same way as polyhedra, one homogenizes an afﬁne lattice: from L 	 Zd
one passes to the subgroup L of ZdC1 generated by L  f1g. Normaliz goes this
way, and then reduces the situation to the case L D ZdC1 by preliminary coordinate
transformations. For simplicity we will therefore assume that L D ZdC1.
We want to compute the set N D P\Zd. The homogenization of N is the monoid
M D C.P/ \ ZdC1. By analogy with rec.P/ we deﬁne the recession monoid
rec.N/ D fx 2 Zd W .x; 0/ 2 Mg:
Theorem 4.2 Suppose that N ¤ ;.
1. Then there exist ﬁnitely many lattice points y1; : : : ; ym 2 N such that
N D
m
[
iD1
xi C rec.N/:
2. The number m is minimal if and only if there exists a Hilbert basis H of M such
that
fy1; : : : ; ymg D fy 2 Zd W .y; 1/ 2 Hg:
3. If H is a Hilbert basis of M, then fx 2 Zd W .x; 0/ 2 Hg is a Hilbert basis of
rec.N/.
Part 1 is [7, 2.12], and the statements about Hilbert bases are easy to prove.
The theorem entitles us to call N a ﬁnitely generated module over rec.N/. The
computation goal Generation can now be made precise in the inhomogeneous case
as well: compute a Hilbert basis of rec.N/ and a system of module generators
fy1; : : : ; ymg. By the theorem it is enough to compute a Hilbert basis of M. However,
it would be foolish to overlook the shortcut that is possible: all candidates x 2 M

132
W. Bruns et al.
Fig. 3 A polyhedron in R2
with lev.x/ > 1 can be immediately discarded. This holds both for the primal and
the dual algorithm of Normaliz. (The primal algorithm does only produce elements
x with lev.x/  0. For the dual algorithm that processes the inequalities deﬁning
C.P/ one must start with the inequality lev.x/  0.)
As a simple example we consider the polyhedron in Fig. 3.
Normaliz writes the results in homogenized coordinates:
2 module generators:
-1 0 1
0 1 1
1 Hilbert basis elements of recession monoid:
1 0 0
The result can be checked by inspection.
The set N has a disjoint decomposition into residue classes mod G D gp.rec.N//
(where gp.M/ is the group generated by M):
N D
r[
iD1
Ni;
Ni ¤ ;;
Ni \ Nj D ; if i ¤ j;
x  y mod G for all x; y 2 Ni:
If y1; : : : ; ym is a system of module generators of N as an rec.N/-module, then
obviously r  m; in particular, r is ﬁnite. It is justiﬁed to call r the module rank
of N over rec.N/ because of the following functorial process. Let K be a ﬁeld and
let R D KŒrec.N/ be the monoid K-algebra deﬁned by rec.N/. Let KŒN be the
K-vector space with basis N. The “multiplication” rec.N/  N ! N, .x; y/ 7! x C y
makes KŒN a module over R [7, p. 51]. Since R is an integral domain, KŒN has
a well-deﬁned rank, which is exactly r, as one sees by passage to the ﬁeld of
fractions of R. An intermediate step of this passage is the Laurent polynomial ring
L D KŒG, and we can get KŒN ˝R L by introducing K-coefﬁcients to N C G. This
set decomposes into the subsets Ni C G, and one has Ni C G D x C G for every
x 2 Ni. Therefore KŒN ˝R L is the direct sum of r free L-modules of rank 1. In the
example above, the module rank is 2.
If y1; : : : ; ym have been computed, then it is very easy to ﬁnd the module rank
r: we simply count their pairwise different residue classes modulo G. But we can
also compute r as the number of lattice points in a polytope, and Normaliz resorts

Normaliz 2013–2016
133
to this approach if a system of module generators is unknown. The polytope is a
cross-section of P with a complement of rec.P/:
Theorem 4.3 Let z1; : : : ; zs be a Z-basis of G D gp.rec.N//. There exist zsC1; : : : ;
zd 2 Zd such that z1; : : : ; zd is a Z-basis of Zd. Set H D ZzsC1 C    C Zzd, and let
 W Rd ! RH denote the projection deﬁned by jG D 0 and jH D idH.
Then .P/ is a (rational) polytope, and the module rank r is the number of lattice
points in .P/.
Proof The ﬁrst statement amounts to the existence of a complement H of G in Zd,
i.e., a subgroup H with Zd D G C H and G \ H D 0. Such a complement exists if
and only if Zd=G is torsionfree. Let z 2 Zd such that kz 2 G for some k 2 Z, k > 0.
Since G D R rec.P/ \ Zd, we must have x 2 G.
The polyhedron P is the Minkowski sum Q C rec.P/ with a polytope Q. Since
rec.P/ 	 RG, we have .P/ D .Q/, and therefore .P/ is a polytope. Clearly, the
lattice points in P are mapped to lattice points in .P/, and two such points have the
same image if and only they differ by an element in G.
The only critical question is whether every lattice point in .P/ is hit by a lattice
point in P by the application of . There is nothing to show if G D 0 since  is
the identity on Rd then. So assume that G ¤ 0. Let p 2 .P/ be a lattice point,
p D .q/ with q 2 P. One has .p  q/ D 0, and therefore p  q 2 RG. Note that
RG D R rec.P/. In other words, rec.P/ is a fulldimensional cone in RG. It contains
a lattice point x in its (relative) interior. Thus .pq/Ckx 2 rec.P/ for k 2 Z, k 
 0,
and q C .p  q/ C kx 2 Zd is a preimage of p in P for k 
 0.
Let us now discuss Enumeration in the inhomogeneous case. As in the homo-
geneous case, we can only compute the Hilbert series of N
D
P \ ZdC1
modulo U.rec.N//. Therefore it is enough to discuss the case in which rec.P/ or,
equivalently, C.P/ is pointed.
Normaliz computes the Hilbert series via a Stanley decomposition. This is a
disjoint decomposition of the set of lattice points P \ Zd into subsets of the form
D D u C
r
X
iD1
ZCvi
where r varies between 0 and dim P and v1; : : : ; vr are linearly independent.
Provided deg vi > 0 for i D 1; : : : ; r, the Hilbert series of D is given by
HD.t/ D
tdeg u
.1  tdegv1/    .1  tdeg vr/:
(3)
In order to get the Hilbert series of P \ Zd, it only remains to sum the Hilbert series
of the components of the Stanley decomposition.
In[14] the computation of the Stanley decomposition in the homogeneous
case is described in detail. Therefore we only discuss how to derive the Stanley
decomposition of P \ Zd from a Stanley decomposition of C.P/ \ ZdC1. We must

134
W. Bruns et al.
intersect all components of the Stanley decomposition of C.P/ \ ZdC1 with the
hyperplane L1 of level 1 points. Since the levels of all participating vectors are
integral and 0, in a sum of level 1 exactly one summand must have level 1 and
the others must have level 0.
Proposition 4.4 Suppose that C.P/ is pointed, and that D is a component in the
Stanley decomposition of C.P/. Let v1; : : : ; ve be the vectors of level 1 among
v1; : : : ; vr, and veC1; : : : ; vf those of level 0. Then the following hold:
1. if lev.u/ D 1, then D \ L1 D u C Pf
iDeC1 ZCvi.
2. If lev.u/ D 0, then D\L1 is the disjoint union of the sets u Cvj CPf
iDeC1 ZCvi,
j D 1; : : : ; e (and thus empty if e D 0).
3. if lev.u/ > 1, then D \ L1 D ;.
Note that f  e  dim P if D \ L1 ¤ ;. The proposition shows that the
computation of a Stanley decomposition of P \ Zd is as easy (or difﬁcult) as the
computation for C.P/ \ ZdC1.
In the homogeneous case all degrees are nonnegative. In the inhomogeneous
case this requirement would be an unnecessary restriction. Normaliz takes care of
this aspect by computing a shift. For our simple example above we obtain with
deg.x1; x2/ D x1
Hilbert series:
1 1
denominator with 1 factors:
1: 1
shift = -1
Thus the Hilbert series is
t1 1 C t
1  t D t1 C 1
1  t :
Normaliz lets the user specify a linear form ı that plays the role of the
dehomogenization. This is already useful for compatibility with the input formats
of other packages: often the ﬁrst coordinate is used for (de)homogenization.
Remark 4.5 Inhomogeneous systems are often created by strict linear inequalities
.x/ > 0 where  is linear (in addition to non-strict ones). These can be treated as
inhomogeneous systems, but Normaliz also offers a variant called “excluded faces”.
Then homogenization (with its increase in dimension) is avoided at the expense of
an inclusion-exclusion approach. This variant can also be used by NmzIntegrate.

Normaliz 2013–2016
135
5
Bottom Decomposition
As mentioned above, Normaliz computes a triangulation of the cone C whose rays
are given by the input (or precomputed) system of generators, a partial triangulation
for Hilbert bases and a full one for Hilbert series.
The complexity of the Normaliz algorithm depends mainly on two parameters.
The ﬁrst is the size of the triangulation. The second is the determinant sum (or
normalized volume) that determines the time needed for the evaluation of the
simplicial cones in the triangulation. In the following vol denotes the Zd-normalized
volume in Rd. It is the Euclidean volume multiplied by dŠ.
Let  be a simplicial cone generated by linearly independent vectors v1; : : : ; vd.
Then the normalized volume of the basic simplex spanned by 0 and v1; : : : ; vd is the
absolute value of the determinant of the dd-matrix with rows v1; : : : ; vd. Therefore
we call it the determinant det  of . It is also the number of lattice points in the
semi-open parallelotope
par.v1; : : : ; vd/ D
˚
a1v1 C    C advd W 0  ai < 1; i D 1; : : : ; d
	
;
which is also referred as the fundamental domain of . Normaliz must generate
these points when evaluating  for the Hilbert basis or Hilbert series. Therefore the
determinant sum detsum ˙ D P
2˙ det  of ˙ is a critical complexity parameter.
In the following we explain how to optimize it.
Deﬁnition 5.1 Let G 	 Zd be a ﬁnite set. We call the polyhedron conv^.G/ D
fx 2 Rd W x D P
g2G agg; ag  0; P
g2G ag  1g the upper convex hull of G. The
bottom B.G/ of G is the polyhedral complex of the compact facets of conv^.G/ (or
just their union).
Let C be the cone generated by G. Then conv^.G/ D conv.G/ C C, and B.G/
is nonempty if and only if C is pointed, or, equivalently, conv^.G/ has a vertex. In
this case the bottom is indeed a set of polytopes of dimension dim C  1 since their
union is in bijective correspondence with a cross-section of C. Figure 4 illustrates
the notion of bottom.
Fig. 4 The bottom
C

136
W. Bruns et al.
As usual, we assume from now on that C 	 Rd is pointed and of dimension d,
and that the monoid M D C \ Zd is to be computed.
Deﬁnition 5.2 The cones RCF where F runs through the facets in B.G/ form the
bottom decomposition of C with respect to G.
A triangulation ˙ of C is a bottom triangulation with respect to G if every
simplicial cone  2 ˙ is generated by elements of G \ F where F is a facet of
B.G/.
Bottom triangulations are optimal with respect to determinant sum:
Proposition 5.3 Let ˙ be a bottom triangulation of C with respect to G. Then
detsum.˙/  detsum./ for all triangulations  with rays in G.
Proof The union of the basic simplices of ˙ is the union of the polytopes conv.0; F/
where F runs through the facets of B.G/ (see Fig. 4). Therefore its determinant sum
is the volume of the union D of these polytopes. But D is contained in the union
of the basic simplices of the simplicial cones in , and therefore the volume of D
bounds detsum  from below.
Evidently, if the points of G lie in one hyperplane, all triangulations of C with
rays through G have the same determinant sum, namely the normalized volume
of the polytope conv.G; 0/. However, in general the determinant sums can differ
widely. Therefore it makes sense to compute a bottom triangulation. First we
determine the compact facets of conv^.G/. As usual, let us say that the facet F
of the d-dimensional polyhedron Q 	 Rd is visible from x 2 Rd if .x/ < 0 for the
afﬁne-linear form  deﬁning the hyperplane through F (normed such that .y/  0
for y 2 Q.)
Proposition 5.4 Let F be a facet of conv^.G/. Then the following are equivalent:
1. F belongs to B.G/;
2. F is visible from 0.
Proof We choose  as an afﬁne-linear form deﬁning F and a point x of F. Let H be
the hyperplane spanned by F. Suppose ﬁrst that .0/ D 0. Then  vanishes on the
whole ray from 0 through x, and since this ray belongs to conv^.G/ from x on, it is
impossible that H \ conv^.G/ is compact. The assumption that .x/ > 0 implies
that  has negative values on this ray in points beyond x, and this is impossible as
well. This proves 1 H) 2.
Conversely assume that F is visible from 0, but not compact. Then it is not
contained in the compact polytope P D conv.G/. Let y be a point in F n P,
y D P
g2G agg with a D P ag  1, all ag  0. Then y=a 2 P, and since .y/ D 0
and .y=a/  0, it follows that .0/  0 since y=a lies between 0 and y. This is a
contradiction.
Normaliz uses lexicographic triangulations (see [14]). These are uniquely deter-
mined by the order in which the elements are successively added in building the
cone. Therefore we can triangulate RCF separately for all bottom facets F using

Normaliz 2013–2016
137
Table 1 Effect of bottom decomposition
Input
Triangulation size
Determinant sum
Computation time
Inequalities
347,225,775,338
4,111,428,313,448
112:43:17 h
Inequalities, -b
288,509,390,884
1,509,605,641,358
84:26:19 h
Hilbert basis, -b
335,331,680,623
1,433,431,230,802
97:50:05 h
only points in G\F. These triangulations coincide on the intersections of the cones
RCF and can be patched to a triangulation of RCC.
Normaliz does not blindly compute triangulations, taking the set G in the order
in which it is given. In the presence of a grading it ﬁrst orders the generating set
by increasing degree, and this has already a strong effect on the determinant sum.
Nevertheless, bottom decomposition can often improve the situation further.
If the Hilbert basis of C\Zd can be computed quickly by the dual algorithm, one
can use it as input for a second run that computes the Hilbert series. (Since version
3.2.0, Normaliz tries to guess whether the primal or the dual algorithm is better
for the given input, but the algorithm can also be chosen by the user.) It is clear
that bottom decomposition with G being the Hilbert basis, produces the smallest
determinant sum of any triangulation of C with rays through integer points. But the
Hilbert basis has often many more elements than the set of extreme rays, and this
can lead to a triangulation with a much larger number of simplicial cones. Despite
of reducing the determinant sum, it may have a negative effect on computation time.
The following example, a Hilbert series computation in social choice theory (input
ﬁle CondEffPlur.in of the Normaliz distribution; see [9, 14] or Schürmann
[23]), demonstrates the effect; see Table 1. With the input “inequalities”, Normaliz
ﬁrst computes the extreme rays and then applies the primal algorithm to compute
the Hilbert series. The option -b forces bottom decomposition. The computation
times were taken on a system equipped with 4 Xeon E5-2660 at 2.20 GHz, using 30
parallel threads.
At present Normaliz computes the bottom facets as suggested by Proposition 5.4.
Since we must homogenize the polyhedron conv^.G/, this amounts to doubling the
set G to G  f0g [ G  f1g 2 RdC1. The advantage of this approach is that one
simultaneously computes the facets of C and the bottom facets. Nevertheless, the
time spent on this computation can outweigh the saving by a smaller determinant
sum. Therefore Normaliz only applies bottom decomposition if asked for by the
user or if the bottom is very “rough”. Roughness is measured by the ratio of the
largest degree of a generator and the smallest. At present bottom decomposition is
activated if the roughness is 10.
We will try to improve the efﬁciency of bottom decomposition by speeding up
its computation. The following proposition suggests a potential approach:
Proposition 5.5 With the notation introduced above, let z 2 C. Then the following
are equivalent for a set F 	 Rd:
1. F is a facet of B.G/;
2. F is a facet of conv.G/ C RCz that is visible from 0;

138
W. Bruns et al.
The easy proof is left to the reader. If one chooses z D 0 in Proposition 5.5, then
one must compute all facets of the polytope conv.G/, not only those in the bottom,
but also those in the “roof’. Choosing z ¤ 0, for example in the interior of C, “blows
the roof off”, and it may be the better choice.
6
Integral Closure as a Module
Let M 	 Zd be a positive afﬁne monoid, L  gp.M/ a subgroup of Zd, and C the
cone generated by M. Then ML D C \ L is the integral closure of M. It is not only a
ﬁnitely generated monoid itself, but also a ﬁnitely generated M-module: there exist
y1; : : : ; ym 2 ML such that ML D Sm
iD1 yi C M. If M (and therefore ML) is positive,
then the set fy1; : : : ; ymg is unique once it is chosen minimal. It contains 0 since
M 	 ML D C \ L.
Geometrically one can interpret the difference ML D C \ L n M as the set of
“gaps” or “holes” of M in ML D C\L, and the nonzero elements of fy1; : : : ; ymg are
the “fundamental holes” in the terminology of [22]. Since version 3.0.0 Normaliz
computes the set fy1; : : : ; ymg, and therefore the fundamental holes.
In the following we assume L D Zd, and set e
M D MZd. (In [7] M is reserved
for the normalization Mgp.M/.) Evidently the Hilbert basis elements of e
M outside M
belong to fy1; : : : ; ymg, but in general this set is much larger than the Hilbert basis.
Let M be the monoid generated by linearly independent vectors v1; : : : ; vd. Then
the lattice points in par.v1; : : : ; vd/ form a system of module generators of e
M, but in
general they do not all belong to the Hilbert basis; see Fig. 5 where C is generated
by .2; 1/ and .1; 3/. The Hilbert basis elements inside G are only .1; 1/ and .1; 2/.
Since Normaliz computes the sets par.v1; : : : ; vd/ for the simplicial cones
RCv1 C    C RCvd in a triangulation of C with rays in a given generating set
of M, it is only a matter of restricting the “reducers” in the “global” reduction to
elements of G.
Proposition 6.1 Let G 	 Zd generate the positive afﬁne monoid M 	 Zd, and let
˙ be a triangulation of C with rays in G. Then the union H of the sets par./ \ Zd,
 2 ˙ generates the module e
M over M.
An element y 2 H belongs to the minimal generating set of e
M if and only if
y  x … C, for all x 2 G, x ¤ 0.
Proof Only the second statement may need a justiﬁcation. We can of course assume
that 0 … G. Suppose ﬁrst that z D y  x 2 C for some x 2 G. Then z 2 e
M and
y C M 	 z C M so that y does not belong to the minimal generating set.
Conversely, if y  x … C for all x 2 G, then there is no element z 2 e
M, z ¤ y,
such that y 2 Z C M, and so y belongs to the minimal generating set.
Normaliz computes minimal sets of module generators not only in the discussed
homogeneous case, but also in the inhomogeneous case in which the module is the
set of lattice points in a polyhedron P and G generates rec.P/ (since version 3.1.0).

Normaliz 2013–2016
139
Fig. 5 Module generators of
integral closure
0
7
Homogeneous Systems of Parameters
As above, we consider monoids M D C\L where C 	 Rd is a rational pointed cone
and L 	 Zd is a subgroup. We may right away assume that d D dim C and L D Zd.
Since we want to discuss Hilbert series, we need a grading deg W Zd ! Z such that
deg.x/ > 0 for x 2 M, x ¤ 0. Additionally we assume that deg takes the value 1
on gp.M/, a standardization that Normaliz always performs. The following classical
theorem shows that the Hilbert series can be expressed as a rational function.
Theorem 7.1 (Ehrhart, Stanley, Hilbert-Serre)
1. The Hilbert series HM.t/ D P
x2M tdeg.x/ is (the power series expansion of) a
rational function that can be written in the form
HM.t/ D
Q.t/
.1  t`/d
(4)
where Q.t/ D 1 C h1t C    C hsts is a polynomial of degree s < d` with
nonnegative integer coefﬁcients hi, and ` is the least common multiple of the
degrees of the extreme integral generators of C.
2. There exists a (unique) quasipolynomialqM.k/ of degree d1 and period dividing
` such that #fx 2 M W deg.x/ D kg D qM.k/ for all k > s  d`.
It is not difﬁcult to derive the ﬁrst claim from the existence of a Stanley
decomposition so that HM.t/ is a sum of terms given by (3). This explains that all
coefﬁcients of the numerator polynomial are nonnegative. There is also an access
via commutative algebra which we will explain below.

140
W. Bruns et al.
A quasipolynomial of period  > 0 and degree g is a function q W Z ! C that
can be represented in the form
q.k/ D q.k/
0 C q.k/
1 k C    C q.k/
g kg
with q.k/
i
D q.j/
i
for all i whenever j  k ./; moreover, one has q.k/
g
¤ 0 for at least
one k and  is chosen as small as possible. The quasipolynomial in Theorem 7.1 is
called the Hilbert quasipolynomial of M.
We use the terms “Hilbert series” and “Hilbert quasipolynomial”. One could
equally well name these objects after Ehrhart. In fact, the Hilbert series of M is
nothing but the Ehrhart series of the polytope that one obtains by intersecting C
with the hyperplane of degree 1 elements in R.
While Theorem 7.1 gives a representation of HM.t/ in which all parameters
have a natural combinatorial description, it is not completely satisfactory since the
denominator often has a very large degree and one can do better. It is our goal to
ﬁnd a representation of HM.t/ as a fraction whose
1. denominator is of the form .1tg1/    .1tgd/ and of small degree g1 C  Cgd
and such that
2. the coefﬁcients of the numerator polynomial are nonnegative integers and have a
combinatorial interpretation.
We will give an example showing that in general there is no canonical choice of the
denominator. Nevertheless it makes sense to search for a good choice. Of course, if
all extreme generators have degree 1, then the denominator of (4) is .1  t/d, and
there is nothing to discuss.
By default Normaliz proceeds as follows: It reduces the fraction (4) to lowest
terms and obtains a representation
HM.t/ D
eQ.t/
e1
q1    eu
qu
with cyclotomic polynomials k, 1 D q1 < q2 <    < qu. Then it takes gd
as the lcm of all qi, replaces their product by .1  tgd/ and proceeds with then
remaining cyclotomic factors etc. In this way the gk express the periods of the
coefﬁcients in the Hilbert quasipolynomial: gi is the lcm of the periods of the
coefﬁcients qd; : : : ; qdiC1. We will refer to the denominator of this representation
as standard denominator. This choice is easy to compute and natural in its way, but
not satisfactory if one wants a combinatorial interpretation of the coefﬁcients in the
numerator, as the following example shows.

Normaliz 2013–2016
141
Consider the cone C D RC.1; 2/CRC.2; 1/ with the grading deg.x1; x2/ D x1C
x2 (known as the total grading). Then Hilbert series with standard denominator is:
HM.t/ D
1  t C t2
.1  t/.1  t3/;
with coprime numerator and denominator, and the denominator even has the desired
form .1  tg1/.1  tg2/. However, the numerator has a negative coefﬁcient.
Commutative algebra suggests us to choose g1; : : : ; gd as the degrees of the
elements in a homogeneous system of parameters (hsop for short). Since version
3.1.2 Normaliz can compute such degrees. However, one must use this option with
care since it requires the analysis of the face lattice of C, an impossible task if C has
a large number of facets.
Let R D L1
iD0 Ri be a ﬁnitely generated Z-graded algebra over some inﬁnite
ﬁeld K D R0 of Krull dimension dim R D d. Its graded maximal ideal is given by
m D L
i>0 Ri. In our case, R is the monoid algebra KŒM which is Cohen-Macaulay
by a theorem of Hochster’s, since M is normal, see [7, Theorem 6.10].
We call homogeneous elements 1; : : : ; d
2 m a homogeneous system of
parameters if m D Rad.1; : : : ; d/ or, equivalently, dim R= D 0, where  D
.1; : : : ; d/.
The existence of such a system is guaranteed in the Z-graded case by the prime
avoidance lemma, see [7, Lemma 6.2]:
Lemma 7.2 Let R be a Z-graded ring and I 	 R an ideal generated in positive
degree. Let p1; : : : ; pr be prime ideals such that I 6	 pi for i D 1; : : : ; r. Then there
exists a homogeneous element x 2 I with x … p1 [    [ pr.
For any ideal I in R generated in positive degree of height ht.I/ D h, the lemma
provides the existence of elements 1; : : : ; h such that ht.1; : : : ; i/ D i for all
i D 1; : : : ; h.
If 1; : : : ; d is an hsop for KŒM, the Hilbert series can be written in the form
HM.t/ D h0 C h1t C : : : C hmtm
.1  tg1/    .1  tgd/ ;
where gj D deg j. Furthermore hi counts the number of elements of degree i in a
homogeneous basis of KŒM over KŒ1; : : : ; d and in particular hi is non-negative
(see [7, Theorem 6.40]).
To reach our mentioned goal of ﬁnding a nice representation of the Hilbert series,
we therefore compute (the degrees of) an hsop for the monoid algebra KŒM.
Our main idea for the construction of an hsop is generating elements i with
ht.1; : : : ; i/ D i from the extreme integral generators of the cone C. We denote
them by x1; : : : ; xn 2 Zn and note that ht.x1; : : : ; xn/ D d, where x1; : : : ; xn are seen
as monomials in KŒM. This claim will be justiﬁed below.
We successively insert the monomials xj into a monomial ideal and compute its
height. Note that in each step the height of this ideal can only increase by at most

142
W. Bruns et al.
one via Krull’s principal ideal theorem, see [8, Theorem A.1]. If
ht.x1; : : : ; xj/ D i > i  1 D ht.x1; : : : ; xj1/;
we let
i WD 1xa1
1 C : : : C jx
aj
j ;
where k 2 K are generic coefﬁcients and the exponents ak are chosen in such a
way that i is homogeneous of degree lcm.deg.x1/; : : : ; deg.xj//. We point out that
the height does not change if we replace the xi by powers of them. Furthermore, all
current monomials x1; : : : ; xj are needed in general to ensure that ht.1; : : : ; i/ D i.
We are left with the task to compute ht.x1; : : : ; xj/. The minimal prime ideals of
a monomial ideal I in the monoid algebra KŒM are of the form pF D KfM n Fg,
where F runs through all faces of C which are maximal with respect to disjointness
to I. Furthermore the height of a prime ideal is given by the codimension of its
respective face, i.e. ht.pF/ D d  dim.F/ (see for instance [7, Corollary 4.35 and
Proposition 4.36]). (In particular, the ideal generated by the monomials x1; : : : ; xn
has height d: the only face disjoint to them is f0g.) In conclusion
ht.x1; : : : ; xj/ D min
F face
˚
codim.F/I F \ .x1; : : : ; xj/ D ;
	
:
These considerations lead to a step-by-step algorithm to compute the heights
vector h 2 Zn
C with hj D ht.x1; : : : ; xj/, see Algorithm 1.
Algorithm 1 Heights
1: h0  1
2: G  facets of C
3: m  d
4: for j D 1; : : : ; n do
5:
G1  fGk 2 G I xj … Gkg
6:
G2  fGk 2 G I xj 2 Gkg
7:
if G1 ¤ ; then
8:
if maxGk2G1fdim.Gk/g < m then m  m  1I hj D hj1 C 1
9:
else hj D hj1
10:
else hj D hj1 C 1
11:
for all facets F` with xj … F` do
12:
for all Gk 2 G2 do
13:
Gk;`  Gk \ F`
14:
G  G1 [ fmaximal faces from Gk;`g

Normaliz 2013–2016
143
Some of the facets can be neglected in the process of taking intersections with
the faces in step j due to the following criteria:
1. The facet contains the current generator xj;
2. The facet only involves generators appearing in faces in G1 or x1; : : : ; xj1;
3. Facets only involving the generators x1; : : : ; xj can be ignored for all following
iterations.
Once the heights vector h is computed, the degrees of the corresponding hsop
can be determined as mentioned before, although not all initial generators need to
appear in the lcm to compute the homogeneous degree. More precisely, let ` denote
the smallest index such that h` D h`C1. Since ht.x1; : : : ; xj; xjC1/ D hjC1 D hjC1 D
ht.x1; : : : ; xj/ C 1 for j D 1; : : : ; `  1 we have
deg.i/ D
(
deg.xi/;
if i  `;
lcm.deg.x`C1/; : : : ; deg.xi//;
if i > `:
We ﬁnally calculate the numerator of the new representation of the Hilbert series,
by multiplying the form with cyclotomic polynomials in the denominator with the
product .1  tg1/ : : : .1  tgd/; where gj D deg.j/.
We note that for the simplicial case the extreme integral generators x1; : : : ; xd
already form an hsop. Therefore the choice of their degrees in the denominator of
the Hilbert series can be considered a canonical. In the above simplicial example
C D RCx1 C RCx2 with x1 D .1; 2/ and x2 D .2; 1/ the series can be expressed as:
HM.t/ D 1 C t2 C t4
.1  t3/2 ;
where the degrees appearing in the denominator come from the extreme integral
generators of C. The numerator has non-negativecoefﬁcients and counts the number
of homogeneous basis elements of KŒM as a KŒx1; x2-module per degree, in this
case .0; 0/; .1; 1/ and .2; 2/ of degree 0; 2 and 4 respectively. This example also
shows that using the Hilbert basis instead of the extreme integral generators as a
generating system for M sometimes yield smaller exponents in the denominator,
namely .1t2/.1t3/. However, using the Hilbert basis for the algorithm increases
the complexity of taking intersections remarkably, which is the most expensive step.
As an example, let C D Q  f1g be the cone over a square Q, see Fig. 6. The
degree is given by deg.xi/ D i for i D 1; : : : ; 4. (This choice is eligible since the
only condition for this conﬁguration is that the two sums of the degrees of antipodal
points agree.) We get the following sequence of heights, which is also illustrated in
Fig. 6 where dotted lines indicate the maximal disjoint faces:
h1 D ht.x1/ D 1; h2 D ht.x1; x2/ D 1; h3 D ht.x1; x2; x3/ D 2;
h4 D ht.x1; x2; x3; x4/ D 3:

144
W. Bruns et al.
h1 = 1
h2 = 1
h3 = 2
x1
x2
x3
x4
x1
x2
x3
x4
x1
x2
x3
x4
h4 = 3
x1
x2
x3
x4
Fig. 6 Sequence of heights for a cone over a square
The degrees for the corresponding hsop are given by deg.1/ D 1; deg.2/ D 6
and deg.3/ D 12 and the Hilbert series has the form
HM.t/ D 1 C t2 C t3 C 2t4 C 2t6 C t7 C 2t8 C 2t10 C t11 C t12 C t14
.1  t/.1  t6/.1  t12/
:
The heights vector and the degrees of the corresponding hsop can also be seen
on the terminal if Normaliz is run with the verbosity option:
Heights vector: 1 1 2 3
Degrees of HSOP: 1 6 12
The Hilbert series with standard denominator for this cone is
HM.t/ D 1 C t3 C t4  t5 C t6 C t7 C t10
.1  t/.1  t2/.1  t12/
;
which again has a negative coefﬁcients in the numerator.
If the order of the generators would be x2; x3; x1; x4 the degrees and hence the
exponents in the denominator of the Hilbert series are smaller, namely deg.1/ D
2; deg.2/ D 3; deg.3/ D 4 and
HM.t/ D
1 C t C t2 C t3 C t4
.1  t2/.1  t3/.1  t4/:
However, considerations about the best possible order of generators would
involve knowledge about the algebraic structure and deﬁning equations (in this case
x1x4 D x2x3) of the input data, which are not accessible in Normaliz. Moreover,
there is no clear answer to the question what an optimal choice for the exponents
in the denominator should look like. Nevertheless, a possibility to improve the
current representation would be a dynamic choice of the generators, where the next
generator is chosen to lie in as many faces as possible, e.g. x1; x4; x2; x3 in the above
example. Future versions of Normaliz may contain this choice.

Normaliz 2013–2016
145
8
Class Group
The monoids M D C \ L where C 	 Rd is a rational cone and L a subgroup of
Zd are exactly the normal afﬁne monoids. For such a monoid M and a ﬁeld K the
monoid algebra KŒM is a normal Noetherian domain, which has a divisor class
group Cl.KŒM/, the group of isomorphism classes of divisorial ideals. It is not hard
to prove that every isomorphism class is represented by a monomial divisorial ideal,
and if one analyzes which monomial ideals are divisorial and when two such ideals
are isomorphic modules, then one obtains Chouinard’s theorem, see [7, Corollary
4.56]:
Theorem 8.1 Let  W gp.M/ ! Zs be the standard map. Then the divisor class
group Cl.KŒM/ (identical to the divisor class group Cl.M/ of M) is given by
Zs=.gp.M//.
If dim C D d and L D Zd, one has gp.M/ D Zd. Therefore Cl.M/ D Zs=.Zd/.
Since  is known, the computation of the divisor class group is a cheap by-product.
Let A be the matrix whose columns are the support forms with coordinates in the
dual basis to the unit vectors in Zd. Then the rows generate .Zd/ 	 Zs, and it is
only a matter of computing the Smith normal form of A. It immediately yields a
decomposition Cl.M/ D Zr ˚ .Z=c1Z/e1 ˚    ˚ .Z=cuZ/eu such that c1 j    j cu.
Acknowledgements The second author was partially supported by the German Research Council
DFG-GRK 1916 and a doctoral fellowship of the German Academic Exchange Service.
References
1. J. Abbott, A.M. Bigatti, C. Söger, Integration of libnormaliz in CoCoALib and CoCoA 5, in
Mathematical Software – ICMS 2014. 4th International Congress, Seoul, August 5–9, 2014.
Proceedings (Springer, Berlin, 2014), pp. 647–653
2. J. Abbott, A.M. Bigatti, G. Lagorio, CoCoA-5: a system for doing Computations in Commu-
tative Algebra. Available at http://cocoa.dima.unige.it
3. T. Achterberg, SCIP: solving constraint integer programs. Math. Program. Comput. 1, 1–41
(2009). Available from http://mpc.zib.de/index.php/MPC/article/view/4
4. B. Assarf et al., Computing convex hulls and counting integer points with polymake. Preprint
(2015). arXiv:1408.4653
5. A. Bächle, L. Margolis, HeLP – a GAP-package for torsion units in integral group rings.
Preprint (2016). arXiv:1507.08174.
6. S. Borowka et al., SecDec – a program to evaluate dimensionally regulated parameter integrals
numerically. Available from https://secdec.hepforge.org/
7. W. Bruns, J. Gubeladze, Polytopes, Rings and K-theory (Springer, Berlin, 2009)
8. W. Bruns, J. Herzog, Cohen-Macaulay Rings (Cambridge University Press, Cambridge, 1998)
9. W. Bruns, B. Ichim, Normaliz: algorithms for afﬁne monoids and rational cones. J. Algebra
324, 1098–1113 (2010)
10. W. Bruns, R. Koch, Computing the integral closure of an afﬁne semigroup. Univ. Iagel. Acta
Math. 39, 59–70 (2001)

146
W. Bruns et al.
11. W. Bruns, C. Söger, Generalized Ehrhart series and integration in Normaliz. J. Symb. Comput.
68, 75–86 (2015)
12. W. Bruns, R. Hemmecke, B. Ichim, M. Köppe, C. Söger. Challenging computations of Hilbert
bases of cones associated with algebraic statistics. Exp. Math. 20, 25–33 (2011)
13. W. Bruns, B. Ichim, T. Römer, R. Sieg, C. Söger, Normaliz. Algorithms for rational cones and
afﬁne monoids. Available at http://normaliz.uos.de
14. W. Bruns, B. Ichim, C. Söger, The power of pyramid decomposition in Normaliz. J. Symb.
Comput. 74, 513–536 (2016)
15. W. Bruns, R. Sieg, C. Söger, The subdivision of large simplicial cones in Normaliz, in
MathematicalSoftware – ICMS 2016. 5th International Conference Berlin, July 11–14, 2016.
Proceedings (Springer, Berlin, 2016), p. 1026
16. B.A. Burton, Regina: software for 3-manifold theory and normal surfaces. Available from
http://regina.sourceforge.net/
17. W. Decker, G.-M. Greuel, G. Pﬁster, H. Schönemann, Singular 4-0-2 — a computer algebra
system for polynomial computations. Available at http://www.singular.uni-kl.de
18. D.R. Grayson, M.E. Stillman, Macaulay2, a software system for research in algebraic
geometry. Available at http://www.math.uiuc.edu/Macaulay2/
19. S. Gutsche, M. Horn, C. Söger, NormalizInterface for GAP. Available at https://github.com/
gap-packages/NormalizInterface
20. M. Joswig, B. Müller, A. Paffenholz, Polymake and lattice polytopes, in DMTCS proc. AK, ed.
by C. Krattenthaler et al., Proceedings of FPSAC 2009, pp. 491–502
21. M. Köppe, Y. Zhou, New computer-based search strategies for extreme functions of the
Gomory–Johnson inﬁnite group problem. Preprint (2016). arXiv:1506.00017v3
22. F. Kohl, Y. Li, J. Rauh, R. Yoshida, Semigroups – a computational approach. Preprint (2017).
arXiv:1608.03297
23. A. Schürmann, Exploiting polyhedral symmetries in social choice. Soc. Choice Welf. 40,
1097–1110 (2013)

Integral Frobenius for Abelian Varieties
with Real Multiplication
Tommaso Giorgio Centeleghe and Christian Theisen
Abstract In this paper we introduce the concept of integral Frobenius to formulate
an integral analogue of the classical compatibility condition linking the collection
of rational Tate modules V.A/ arising from abelian varieties over number ﬁelds
with real multiplication. Our main result gives a recipe for constructing an integral
Frobenius when the real multiplication ﬁeld has class number one. By exploiting
algorithms already existing in the literature, we investigate this construction for
three modular abelian surfaces over Q.
Keywords Integral Tate module • Abelian variety • Real multiplication
Subject Classiﬁcations 11G10 Abelian varieties of dimension > 1
1
Introduction
Let K be a number ﬁeld, and A an abelian variety over K with real multiplication.
By this we shall mean throughout that it is given a totally real number ﬁeld E of
degree ŒE W Q D dim.A/ together with an embedding
	 W OE ,! EndK.A/
(1)
of its ring of integers OE in the ring of K-endomorphisms of A. To simplify our
notation we will omit the reference to 	, and regard OE as a given subring of the
endomorphism ring of A.
T.G. Centeleghe () • C. Theisen
IWR Universität Heidelberg, Im Neuenheimer Feld 205, 69120 Heidelberg, Germany
e-mail: tommaso.centeleghe@gmail.com; christian.theisen90@web.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_6
147

148
T.G. Centeleghe and C. Theisen
Let  be any ﬁnite prime of E, denote by E the completion of E at , and by
O 	 E the corresponding valuation ring. Consider the -adic Tate module
T.A/ D lim
 
n
AŒn;
and its rational version
V.A/ D T.A/ ˝ Q:
From the embedding OE  EndK.A/ one deduces a structure of O-module on
T.A/ and a structure of E-vector space on V.A/. The module T.A/ is free of
rank two over O, and V.A/ is two-dimensional over E (see [9, Prop. 2.2.1]).
These structures are compatible with the action of the absolute Galois group GK D
Gal. NK=K/, where NK is a ﬁxed algebraic closure of K. Thus we have two Galois
representations:
 W GK ! GLO.T.A// ' GL2.O/;
0
 W GK ! GLE.V.A// ' GL2.E/:
Let now p be a ﬁnite prime of K where A has good reduction Ap. Denote by kp be
the residue ﬁeld of p, by q its cardinality and by p its characteristic. Let Frobp 2 GK
be an arithmetic Frobenius element at p. As it is well known, the representations
f0
g−p
are all unramiﬁed at p and satisfy a compatibility condition that can be formulated
as follows.
There exists a semi-simple conjugacy class ˙0
p 	 GL2.E/ such that for every
 −p the image of ˙0
p in GL2.E/ deﬁnes the conjugacy class of 0
.Frobp/.
Moreover, the characteristic polynomial of ˙0
p has coefﬁcients in OE, and can be
computed from the Frobenius isogeny p of Ap (see Sect. 3).
We ﬁnd it natural to investigate an integral analogue of the property above. To
this purpose we raise the following questions.
1. Is there a conjugacy class
˙p 	 GL2.OEŒ1=p/
such that for any  −p the action of Frobp on T.A/ is described by the conjugacy
class of GL2.O/ containing the image of ˙p?
2. If such a ˙p exists, how can we describe it?
Deﬁnition 1.1 A conjugacy class ˙p satisfying the requirement of question 1 will
be called an integral Frobenius of A at p.

Integral Frobenius for Abelian Varieties with Real Multiplication
149
In this paper, in the case where E has class number one, we construct an explicit
matrix p 2 GL2.OEŒ1=p/ with entries in OE and show that its conjugacy class is
an integral Frobenius of A at p. Our main result generalizes a theorem of Duke and
Tòth (see [4, Theorem 2.1]) who treated the case of elliptic curves using a different
technique. We remark that the integral questions raised above can be considered for
more general compatible systems of Galois representations arising from geometry.
2
The Main Result
In this section we keep the notation of the introduction and further assume that E
has class number one.
The injectivity of the reduction map (see [3, § 1.4.4])
rp W EndK.A/ ! Endkp.Ap/
will be used throughout to identify the ring OE  EndK.A/ with a subring of
Endkp.Ap/. In particular, if  is a prime of E not dividing p, we can make sense
of the Tate modules T.Ap/ and V.Ap/, deﬁned as in the characteristic zero case.
The ring Endkp.Ap/ has two distinguished elements (not necessarily distinct)
given by the Frobenius isogeny p W Ap ! Ap relative to kp and the corresponding
Verschiebung q=p W Ap ! Ap. The existence of the embedding OE  Endkp.Ap/
implies that Ap is kp-isogenous to a power of a kp-simple abelian variety over kp
(see Proposition 3.1). Hence the Q-subalgebra
Q.p/  Endkp.Ap/ ˝ Q
generated by p is a number ﬁeld, and p a Weil q-number of it.
The element p plays a central role in the problem formulated in the introduction,
in that, by means of the natural identiﬁcation
T.Ap/ D T.A/;
the action induced by p on T.Ap/ corresponds to the Galois action of the
arithmetic Frobenius Frobp on T.A/. The semi-simplicity of p acting on V.Ap/
(see [13, p. 138]) can then be used to deduce that of Frobp acting on V.A/. The
characteristic polynomial of these E-linear actions, denoted by
hp.x/ D x2  apx C sp;
is independent of  and has coefﬁcients in OE (see Proposition 3.2).
After having recalled these basic facts, we give a recipe to construct an integral
Frobenius p 2 GL2.OEŒ1=p/. The construction is divided in two cases, according
to whether the discriminant of hp.x/ is zero or not.

150
T.G. Centeleghe and C. Theisen
•
a2
p  4sp D 0. This condition is equivalent to p 2 OE (see Proposition 3.2), and
in this case the problem is trivial: since p acts on T.A/ via scalar multiplication,
the matrix
p D
p 0
0 p

(2)
gives an integral Frobenius of A at p. Since E is totally real, the Weil number p
is square root of q and
hp.x/ D .x  p/2 D x2  2px C q:
•
a2
p  4sp ¤ 0. This is the interesting case of the problem, and the deﬁnition of
p is more involved. For more details we refer to Sect. 4. The E-algebra L D
EŒp  Endkp.Ap/ ˝ Q is semi-simple and has dimension two over E. Inside L
there is a chain of OE-orders given by
OEŒp  Sp  OL;
where OL denotes the integral closure of OEŒp in L, and Sp is deﬁned as
Sp D EŒp \ Endkp.Ap/;
the intersection being taken in Endkp.Ap/ ˝ Q. The OE-discriminant of OEŒp
is the principal ideal .a2
p  4sp/, which can be written as
.a2
p  4sp/ D ıOL  b2
OL;
where ıOL is the OE-discriminant of OL, and bOL is the OE-conductor of OEŒp
in OL. Let bp  OE be the divisor of bOL corresponding to the intermediate order
Sp (see Proposition 4.2), and choose a generator bp 2 bp. Let up 2 OE be any
element such that the ratio .p  up/=bp belongs to Sp (see Proposition 4.3). The
matrix p is deﬁned by the formula
p D
0
@up 
u2
p  apup C sp
bp
bp
ap  up
1
A ;
(3)
from which it is easily checked that its characteristic polynomial is hp.x/.
Our main result says:
Theorem 2.1 The matrix p has coefﬁcients in OE and deﬁnes an integral Frobe-
nius ˙p of A at p.

Integral Frobenius for Abelian Varieties with Real Multiplication
151
In more concrete terms, the theorem says that for any ﬁnite prime  of E not
dividing p, the Tate module T.A/ admits an O-basis such that the action of Frobp
on T.A/ in the coordinates of this basis is given by p. In particular we deduce:
Corollary 2.2 For any ideal n  OE relatively prime to p, the matrix p describes
the action of Frobp on the n-torsion points AŒn of A, in the coordinates of a suitable
OE=n-basis.
The corollary, which is essentially a reformulation of the main result, emphasises a
connection of our work to [4].
In the non-trivial case a2
p  4sp ¤ 0, write
p D
up 0
0 up

C bp
0
BB@
0 
u2
p  apup C sp
b2
p
1
2up  ap
bp
1
CCA :
(4)
From the construction of p it follows that the matrix .p  up/=bp appearing in
the right hand side of (4) has coefﬁcients in OE (see Proposition 4.3). Thus from
Theorem 2.1 we deduce the following interesting property of the ideal bp. For any
prime-to-p ideal n  OE we have:
Frobp acts on AŒn as scalar
multiplication by an element in OE=n
” n divides bp:
This equivalence can be linked to prime splitting phenomena in Galois extensions of
number ﬁelds. Extend the deﬁnition of bp by setting it equal to zero when a2
p4sp D
0. Let n be a nonzero ideal of OE, and consider the projective Galois representation
P. Nn/ W GK ! PAutOE=n.AŒn/ ' PGL2.OE=n/
obtained from the n-torsion of A. Let K.PAŒn/=K be the Galois extension of K
corresponding to the kernel of P. Nn/.
Corollary 2.3 Let p a prime of K where A has good reduction, and let n  OE an
ideal relatively prime to p. Then p splits completely in K.PAŒn/=K if and only if n
divides bp.
In the case a2
p  4sp ¤ 0, the matrix p, whose deﬁnition might appear
quite mysterious, represents the multiplication action of p on the ring Sp in
the coordinates of a suitable OE-basis (see Sect. 4, Remark 4.4). The main result
relies on the key observation that the `-adic Tate module T`.A/ is free of rank
one over Sp ˝ Z`. In Sect. 3 we prove some basic facts on reduction in positive
characteristic of abelian varieties with real multiplication. In Sect. 4 we discuss
orders in quadratic extensions of number ﬁelds useful to understand the details
of the construction of p. In Sect. 5 we give the proof of Theorem 2.1. Lastly, in

152
T.G. Centeleghe and C. Theisen
Sects. 6 and 7 we exploit algorithms already existing in the literature (see [1] and [5])
to make computational investigations with three modular abelian surfaces over Q.
This article is a development of the Master Thesis of the second author at the
University of Heidelberg.
3
Reduction of Abelian Varieties with Real Multiplication
We keep the notation and assumptions of the ﬁrst two sections, so that A is an abelian
variety over a number ﬁeld K with real multiplication by E, and p is a place of K
where A has good reduction Ap. We denote by kp the residue ﬁeld of K at p, by p
its characteristic, and by q D pa its cardinality, where a D Œkp W Fp. As before,
p W Ap ! Ap denotes the Frobenius isogeny relative to kp. The reduction of the
real multiplication on A gives inclusion
OE  Endkp.Ap/:
(5)
The existence of this subring has the following consequence.1
Proposition 3.1 The abelian variety Ap is isotypical, i.e., it is kp-isogenous to Bn,
where B is a kp-simple abelian variety and n is an integer > 0.
Proof Consider a kp-isogeny
f W Ap !
Y
1ih
Bni
i
from Ap into the product of powers of kp-simple, pairwise non-kp-isogenous abelian
varieties Bi, with ni > 0. We clearly have ŒE W Q D dim.Ap/ D P
i ni dim.Bi/. To
prove the lemma we have to show that h D 1.
The isogeny f induces an identiﬁcation
Endkp.A/ ˝ Q '
Y
1ih
Mni.Di/;
(6)
where Mni.Di/ is the ring of ni-by-ni matrices with coefﬁcients in the division ring
Di D Endkp.Bi/ ˝ Q.
Let i 2 Di be the Frobenius isogeny of Bi relative to kp. The subﬁeld Q.i/  Di
is the center of Di (see [13, Theorem 2 (a)]), and a standard formula from Honda-
Tate theory says that
2 dim.Bi/ D siŒQ.i/ W Q;
(7)
where si is the index of Di, i.e., the square root of the degree ŒDi W Q.i/.
1The fact that the variety Ap arises as reduction from characteristic zero plays no role in
Propositions 3.1 and 3.2.

Integral Frobenius for Abelian Varieties with Real Multiplication
153
The inclusion E  Endkp.A/ ˝ Q projects into each factor of the decomposi-
tion (6) and gives, for any i, an embedding
i W E ! Mni.Di/:
(8)
We ﬁrst complete the proof of the proposition assuming that there exist an index i0
such that i0 is not a real Weil q-number.
Under this assumption we see that the compositum Li0 D i0.E/Q.i0/ inside
Mni0.Di0/ is a semi-simple commutative subalgebra of Mni0.Di0/ containing the
center Q.i0/ and strictly containing the ﬁeld i0.E/ ' E. Since the degree over
Q.i0/ of any commutative semi-simple subalgebra L  Mni0.Di0/ is bounded by
ni0si0, we conclude from (7) that
2ŒE W Q  ŒLi0 W Q  ni02 dim.Bi0/;
which readily implies that h D 1, given that ŒE W Q D P
i ni dim.Bi/.
We are left with proving the proposition in the case where all Frobenius isogenies
i deﬁne real Weil q-numbers. If a is odd the proposition holds simply because there
is only one real Weil q-number, up to conjugation, namely that given by pq, a real
quadratic algebraic integer.
If a is even there are precisely two distinct conjugacy classes of real Weil q-
numbers, given by the integers qa=2 and qa=2, and the isogeny f above has the
form
f W A ! Bn1
1  Bn2
2 ;
for some n1; n2  0, where the Frobenius isogenies 1 and 2 are given by
multiplication by qa=2 and qa=2, respectively. As it turns out, both B1 and B2 are
supersingular elliptic curves (which are not kp-isogenous to each other) with all
geometric endomorphisms deﬁned over kp. Their endomorphism algebra D1 and
D2 are both isomorphic to the deﬁnite Q-quaternion D ramiﬁed at p, and we have
ŒE W Q D n1 C n2.
Arguing by contradiction, assume that both n1 and n2 are > 0, and consider as
above the two embeddings
i W E ! Mni.D/;
for i D 1; 2. Since 2ni is the degree over Q of any commutative semi-simple
subalgebra Li  Mni.D/, we easily see that n1 D n2 and that i.E/ is maximal
commutative subﬁeld of Mni.D/. It follows that 1.E/ is a splitting ﬁeld for Mn1.D/
and hence it is also a splitting ﬁeld for D. This is a contradiction since 1.E/ is
totally real, whereas every splitting ﬁeld of the deﬁnite quaternion D cannot have a
real place. This completes the proof of the proposition.
ut
Proposition 3.1 is equivalent to the statement that Q.p/ is a ﬁeld (and not just
a product of ﬁelds). In this way we see that p deﬁnes a Weil q-number of the

154
T.G. Centeleghe and C. Theisen
number ﬁeld Q.p/. The complex conjugate of p, with respect to any embedding
Q.p/ 	 C, is the Verschiebung isogeny q=p of Ap.
Consider now the commutative subalgebra EŒp  Endkp.Ap/˝Q, and let gp.x/
be the minimal polynomial of p over E. Since Q.p/ is semi-simple, so is EŒp
and gp.x/ has non-zero discriminant. Moreover, the degree ŒEŒp W E is either 1
or 2, according to whether p belongs to OE or not, respectively. This can be seen
using (7) and reasoning as in the proof of Proposition 3.1. Set now
hp.x/ D
(
g2
p.x/; if p 2 OE
gp.x/; if p 62 OE
:
Since p is an algebraic integer, the polynomials hp.x/ and gp.x/ have coefﬁcients
in OE. Moreover notice that p 2 OE if and only if p 2 E.
Proposition 3.2 Let  be a prime of E not dividing p. The polynomial hp.x/ is
the characteristic polynomial of the E-linear action induced by p on V.A/. Its
discriminant is zero if and only if p 2 OE.
Proof If E 2 OE, then V.p/ is given by scalar multiplication by p itself. We
have gp.x/ D .x  p/ and hp.x/ D g2
p.x/. If E 62 OE, then gp.x/ has degree two
and thus we must have hp.x/ D gp.x/. The last statement of the proposition follows
from the fact that gp.x/ has distinct roots.
ut
Remark 3.3 Let ap and sp respectively denote the trace and the determinant of the
E-linear action induced by p on V.Ap/, so that we have
hp.x/ D x2  apx C sp:
The following can be said about the coefﬁcients of hp.x/. If p 2 OE, then p is a
real Weil q-number, hence its square is equal to q. In this case we have ap D 2p
and sp D q. If p 62 OE and p is not real, then hp.x/ is irreducible in EŒx, and we
have ap D p C q=p and sp D q. Finally, if p 62 OE and p is real, then ap D 0
and sp D q. This last case can only occur if a is odd, and hp.x/ is reducible if and
only if OE contains a square root of q.
We conclude the section with the following observation.
Proposition 3.4 Assume that there is a place p of K of good reduction for A such
that Endkp.Ap/ is commutative. Then E is the unique subﬁeld of EndK.A/˝Q which
is totally real and has degree dim.A/.
Proof Let E0  EndK.A/˝Q be a totally real number ﬁeld with ŒE0 W Q D dim.A/.
We shall show that the image of E0 in Endkp.Ap/˝Q under the reduction map (also
denoted by E0) is equal to the number ﬁeld Q.p C q=p/, which depends only on
the reduction of A modulo p, and not on the choice of E0 inside EndK.A/ ˝ Q.
The assumption on the place p is equivalent to ask that Ap be kp-simple, and that
its endomorphism ring tensored with Q be given by Q.p/, for some non-real Weil
q-number p. Formula (7) from Honda-Tate theory applied to the kp-simple variety

Integral Frobenius for Abelian Varieties with Real Multiplication
155
Ap implies that
dim.Ap/ D ŒQ.p/ W Q=2 D ŒQ.tp/ W Q;
where tp D p C q=p.
Arguing once again as in the proof of Proposition 3.1, one can show that E0 
Endkp.Ap/ ˝ Q must contain tp. Since E0 and Q.tp/ have the same degree over Q
they coincide, and the proposition follows.
ut
4
Quadratic Orders
In this section we clarify some aspects of the recipe given in Sect. 2 for the
construction of the integral Frobenius p in the non-trivial case where p 62 OE.
Denote by L the subalgebra EŒp  Endkp.Ap/ ˝ Q generated by E and p.
In our notation for L, for simplicity, we dropped any reference to the prime p.
Hopefully, this will not lead to any confusion.
Thanks to the assumption p 62 OE, the polynomial hp.x/ has distinct roots (see
Proposition 3.2), and there is an isomorphism of E-algebras
L ' EŒx=.hp.x//:
Thus L is either a quadratic ﬁeld extension of E or it is isomorphic to E2, respectively
according to whether hp.x/ is irreducible or not in EŒx.
In what follows by an OE-order S of L, or simply an order of L, we shall mean a
subring S 	 L containing OE and deﬁning an OE-lattice of L. Any such order S is
locally free of rank two over the localizations .OE/ of OE at each nonzero prime
ideal . There is a notion of OE-discriminant ıS of an order S 	 L (see [10, III §2]).
Without entering in the details here, we recall that ıS is an ideal of OE which, locally
at any nonzero prime , is computed as the determinant of the usual bilinear pairing
given by the E-linear trace map
.x; y/ 7! Tr.xy/:
The OE-discriminant of OEŒp is generated by the discriminant a2
p  4sp of hp.x/.
If OL denotes the integral closure of OE in L, we have a chain of inclusions of
orders
OEŒp  Sp  OL;
(9)
where
Sp D L \ Endkp.Ap/

156
T.G. Centeleghe and C. Theisen
is the order appearing in Sect. 2 in the deﬁnition of p. We observe that OL is the
ring of integers of L when hp.x/ is irreducible, and it is isomorphic to O2
E otherwise.
Let now S 	 L be an order containing p, and bS  OE the nonzero ideal given
by the annihilator of the torsion module S=OEŒp.
Proposition 4.1 For any OE-order S 	 L containing p we have
OEŒp D OE C bSS
and
ıOEŒp D ıS  b2
S
The ideal bS will be called the OE-conductor of OEŒp in S.
Proof Both equalities of the proposition can be proved after localization at each
nonzero prime ideal  	 OE, where the statements becomes easy to verify since the
localizations .OEŒp/ and S are free of rank two over the discrete valuation ring
.OE/.
ut
The OE-conductor of the order Sp entered in the recipe of the integral Frobenius
from Sect. 2, where it was denoted by bp. If S; S0 	 L are orders containing p then
from Proposition 4.1 we deduce that S 	 S0 if and only if bSjbS0. In particular, we
have that bSjbOL for any S. The next proposition shows that the invariant bS sufﬁces
to determine the order S.
Proposition 4.2 The map  sending an OE-order S 	 L containing p to the
conductor bS gives a bijection
 W
( OE-orders S 	 L
containing p
)

!
( ideals b  OE
dividing bOL:
)
Proof Let S 	 L be an OE-order containing p. Consider the short exact sequence
of OE-modules
0 ! OEŒp ! L
r
! E=OE ˚ .E=OE/  Np ! 0;
where Np denotes the image of p in L=E. The quotient S=OEŒp is a submodule
of the right term of the sequence which intersects the ﬁrst summand trivially. Since
there are isomorphisms of OE-modules
.E=OE/  Np ' E=OE ' lim
!
0¤n
OE=n;
where the direct limit is taken over all nonzero ideals of OE, we see that for any
nonzero ideal b 	 OE there is a unique submodule Mb 	 .E=OE/  Np whose
annihilator is b. We conclude that
S D r1.0 ˚ MbS/;
and hence S is uniquely determined by bS and  is injective.

Integral Frobenius for Abelian Varieties with Real Multiplication
157
If b  OE is an ideal dividing bOL, then
OE C bOL
b OL
is an OE-order of L in which OEŒp sits with conductor b. This shows that  is
surjective and completes the proof of the proposition.
ut
We assume for the rest of the section that E has class number one. This
assumption, besides the principality of any ideal of OE, ensures that any OE-order
S 	 L is free of rank two as an OE-module (see [8, Theorem 1.32]).
Proposition 4.3 Assume that E has class number one, and let b  OE be a nonzero
ideal. Then b divides bOL if and only if there exists u 2 OE such that the following
conditions are satisﬁed:
1. h0
p.u/ D 2u  ap 2 bI
2. hp.u/ D u2  apu C sp 2 b2:
Under these conditions, the reduction of u modulo b is uniquely determined, and if
b is a generator of b the pair
.1; .p  u/=b/
(10)
is an OE-basis of the order S 	 L with bS D b.
Proof Reasoning as in the proof of Proposition 4.2, we see that the ideal b divides
bOL if and only if there exists u 2 OE such that the ratio .p  u/=b belongs to
OL, where b is a generator of b. This is to say that b divides bOL if and only if the
minimal, monic polynomial of .p  u/=b over E has coefﬁcients in OE. Since this
polynomial is given by
x2 C 2u  ap
b
x C u2  apu C sp
b2
;
the ﬁrst part of the proposition follows. This also shows that the pair (10) is a
basis of the order corresponding to bS under the bijection  from Proposition 4.2.
From this it is easy to see that u is uniquely determined modulo b. The proposition
follows.
ut
Remark 4.4 The matrix p constructed in Sect. 2 represents the multiplication
action of p on Sp on the coordinates induced by an OE-basis of the form
.1; .p  up/=bp/, where bp is a generator of bp and up is an element of OE chosen
to satisfy the two congruences of Proposition 4.3.
We point out the following corollary of Proposition 4.3.
Corollary 4.5 Let b  OE an ideal which is relatively prime to .2/. Then b divides
bOL if and only if b2 divides the discriminant a2
p  4sp.

158
T.G. Centeleghe and C. Theisen
Proof The “only if” part is clear from the relationship between discriminant and
conductor. To see the if part, assume that b2 divides .a2
p  4sp/ and let u 2 OE be an
element such that the ﬁrst condition of the proposition is satisﬁed, i.e.,
2u  ap mod b:
Such a u exists since b and .2/ are relatively prime. Then
4hp.u/ D .2u  ap/2  .a2
p  4sp/
is divisible by b2, since so are both summand. Since b and .2/ are relatively prime,
we conclude that b2 divides hp.u/ and the second condition of the proposition is
also satisﬁed. Thus b divides bOL.
ut
We conclude the section with an observation that will be useful in our computa-
tions. Choose a generator bOL of bOL and an element up such that the pair
.1; p  up
bOL
/
is an OE-basis of OL, and set e2 D .p  up/=bOL. From Propositions 4.2 and 4.3
we deduce the following corollary.
Corollary 4.6 Let S 	 L an OE-order containing p, let bS the OE-conductor of
OEŒp in S, and let bS a generator of bS. The pair
.1; bOL
bS
 e2/ D .1; p  up
bS
/
(11)
is an OE-basis of S.
As bS varies through the divisors of bOL, formula (11) parametrizes all OE-orders
S 	 L containing p, by exhibiting OE-basis of them.
5
Proof of the Main Result
We ﬁrst prove an abstract lemma that will be the key to our proof of Theorem 2.1.
Let R be a ring isomorphic to a ﬁnite product Q Ri of discrete valuation rings Ri,
with total ring of fractions M. Consider the free module R2 of rank two, and assume
that we are given an R-linear map F W R2 ! R2 such that the R-subring RŒF 	
EndR.R2/ generated by F is free of rank two as an R-module.
The map F is given by a collection of Ri-linear maps Fi W R2
i ! R2
i , and the above
requirement is equivalent to ask that Fi is not given by multiplication by an element
of Ri, for every index i. The ring
S D EndRŒF.R2/

Integral Frobenius for Abelian Varieties with Real Multiplication
159
of R-linear endomorphisms of R2 commuting with F is an order of RŒF ˝R M
containing RŒF and which acts on R2 in the obvious way.
Lemma 5.1 R2 is a free S-module of rank one.
Proof The ring S decomposes as the product Q Si, where Si D EndRiŒFi.R2
i /.
Therefore the general form of the lemma follows from the special case where R
is a discrete valuation ring, which we treat next. Denote by m the maximal ideal of
R, choose a uniformizer !, and let k be the residue ﬁeld.
The R-order S of the M-algebra RŒF ˝R M is free of rank two over R, and
therefore
S D R ˚ R  F0;
for some F0 2 S which does not belong to the subring R 	 S. We claim that the
morphism
F0 mod m W R2=mR2 ! R2=mR2
is not given by multiplication by any element of k. For otherwise there exists  2 R
such that F0 sends R2 to mR2. This implies that .F0/=! 2 S, which contradicts
the fact that .1; F0/ is an R-basis of S.
The claim says precisely that there exists r 2 R2 n mR2 such that
F0.r/ 62 R  r C mR2:
From Nakayama’s Lemma we deduce that .r; F0.r// is an R-basis of R2, since the
reductions of its elements generate R2=mR2. From this it readily follows that the
map
S 3 s 7! s.r/ 2 R2
is an isomorphism of S-modules. This completes the proof of the lemma.
ut
We now give the proof of Theorem 2.1, the main result of the paper.
Proof The result is trivial if p 2 E, therefore we continue assuming p 62 E. Let `
be a prime different from p, the residual characteristic of p. By a well known result
of Tate (see [13]), there is a natural isomorphism
r0
` W End0
kp.Ap/ ˝ Q`

! EndQ`Œp.V`.A//:
Since p 62 E, the subalgebra L D EŒp  End0
kp.Ap/ is a maximal commutative
semi-simple subring, and hence it coincides with its own commutator. This implies
that the restriction of r0
` to L ˝ Q` induces an isomorphism
s0
` W L ˝ Q`

! EndL˝Q`.V`.Ap/:
(12)

160
T.G. Centeleghe and C. Theisen
Now, the integral version of r0
`, which is given by
r` W Endkp.Ap/ ˝ Z`

! EndZ`Œp.T`.A//;
(13)
is also an isomorphism. From (12) and (13) we conclude that the map
s` W Sp ˝ Z` ! EndSp˝Z`.T`.Ap//
arising as the restriction of r` to Sp ˝ Z` is also an isomorphism. Since T`.Ap/ is
free of rank two over OE ˝ Z` and p 62 OE, Lemma 5.1 gives that T`.Ap/ is a free
Sp ˝ Z`-module of rank one,2 and hence
T.Ap/ is a free Sp ˝OE O-module of rank one.
(14)
Theorem 2.1 now follows from the fact that the matrix p describes, by construction,
the multiplication action of p on Sp in a suitable basis.
ut
6
Computations
Our aim in the remaining part of the paper is to explain how two algorithms already
present in the literature (see [5] and [1]) can be used to compute the integral
Frobenius at several primes of good reduction for certain modular abelian surfaces
over Q. We are grateful to the authors of these algorithms for providing us with the
nice opportunity to make experimental tests. All our auxiliary computations, like
those in [5] and [1], have been performed using Magma (see [2]).
6.1
The Main Algorithms
The ﬁrst algorithm is the result of joint work of González-Jimenéz et al. (see [5]).
The input from which they start is a cuspidal, normalized eigenform f D P anqn 2
S2.0.N// of weight 2, trivial nebentype and conductor N such that its Fourier
coefﬁcient ﬁeld Ef is a (real) quadratic extension of Q. The modular abelian surface
Af attached to f via the classical Shimura construction (see [12]) is a Q-subvariety
of the Jacobian JacX0.N/ of the modular curve X0.N/, and has good reduction away
from N. The Hecke action induces an inclusion
Of  EndQ.Af/;
(15)
where Of D ZŒ.ap/p−N is the order of Ef generated by the Fourier coefﬁcients of f
indexed by primes not dividing N.
2More generally, this freeness holds if Sp ˝ Z` is a Gorenstein ring (see [11, Remark, p. 502]).

Integral Frobenius for Abelian Varieties with Real Multiplication
161
Assuming that the canonical polarization on Af coming from that of the Jacobian
of the modular curve X0.N/ is a power of a principal one, the three authors compute
a hyperelliptic, genus two equation
y2 D F.x/;
where F.x/ 2 ZŒx has degree 5 or 6, whose desingularization deﬁnes a curve Cf
over Q such that there is an isomorphism
Jac.Cf / ' Af
(16)
of principally polarized abelian varieties over Q. In table at the end of their paper
they list the hyperelliptic equations that they obtained for the 75 modular abelian
surfaces of conductor 500 whose canonical polarization satisﬁes the required
condition. We remark that their output, and hence also ours, is correct only up to
numerical approximation. However, several tests in favour of its correctness are
performed by the authors.
Notice that if (15) extends to the whole ring of integers OEf 	 Ef , then Af is an
abelian surface with real multiplication by Ef , according to the deﬁnition we gave
in Sect. 1. Furthermore, if Ef has class number one then it makes sense to try and
compute the integral Frobenius of Af at primes p −N.
The second algorithm on which our computations depend is due to Bisson (see
[1]). The input is a smooth genus two curve C over a ﬁnite ﬁeld F with q elements
such that its Jacobian Jac.C/ is an absolutely simple, ordinary abelian surface over
F. The curve is assumed to be represented by a hyperelliptic equation y2 D NF.x/,
for a suitable polynomial NF.x/ 2 FŒx of degree 5 or 6. Under these assumptions, the
algorithm returns the endomorphismring of the principally polarized abelian surface
given by Jac.C/, which is an order of the quartic number ﬁeld Q./ generated by
the Frobenius isogeny  of Jac.C/ relative to F.
6.2
Synthesis of the Algorithms
The strategy we suggest for computing the integral Frobenius at primes of good
reduction for a modular abelian surface Af over Q consists of the following steps.
1. Start from a cuspidal, normalized eigenform f 2 S2.0.N// whose coefﬁcient
ﬁeld Ef is quadratic. The ﬁrst goal is to use [5] to ﬁnd a hyperelliptic equation of
a genus two curve Cf over Q such that the isomorphism (16) holds.
There are 465 modular surfaces of conductor 500. In the 75 cases where the
canonical polarization is a power of a principal one, [5] provides the hyperelliptic
equations of the corresponding curves Cf . In the remaining cases, one can still try to
use the same algorithm to solve (16) in Cf by constructing a principal polarization

162
T.G. Centeleghe and C. Theisen
on Af . In [6] this problem in carefully analyzed and sufﬁcient conditions for the
existence of Cf are given.
We continue assuming that step 1 was successful, and perform now two checks.
2. Check that the inclusion (15) extends to the ring of integers OEf .
This maximality condition is often satisﬁed in practice. With the help of Magma we
veriﬁed that for 428 modular surfaces of conductor 500 the order Of is already
the maximal order of Ef . Moreover, using [1], we veriﬁed that for only two of the
surfaces Af considered in [5] the ring EndQ.Af/ fails to be the maximal order. These
surfaces are those with conductor 224, where EndQ.Af / sits in OEf with index two.
3. Check that the class number of Ef is one.
This condition is required by our method for constructing integral Frobenia. Among
surfaces of conductor 500 the condition fails only once in conductor 276.
Assuming that the three steps above are successfully completed, we enter now the
second part of the strategy. Let p be a prime −N, denote by Af;p the reduction of
Af at p, and by p the Frobenius isogeny of Af;p relative to its base ﬁeld Fp. By the
Eichler-Shimura relation, we have
p C p=p D ap 2 OEf ;
where ap is the pth Hecke eigenvalue of f, and hence the characteristic polynomial
of p is given by
hp.x/ D x2  apx C p:
(17)
If a2
p  4p D 0, then
p 2 OEf  EndFp.Af;p/;
and the integral Frobenius p is the scalar matrix given by multiplication by p. We
remark that in the computation we performed we never run in such an example.
We therefore continue assuming a2
p  4p ¤ 0, which also implies that p is not
a real Weil p-number, for otherwise we would have hp.x/ D x2  p (see Sect. 3,
Remark 3.3), a contradiction to (17).
4. Consider the quadratic Ef-algebra
L D EfŒp  EndFp.Af;p/ ˝ Q;
and compute the ideal bOL given by the OEf -conductor of OEf Œp in its integral
closure OL 	 L. Compute further a generator bOL of bOL and an element up 2 OEf
such that the element
e2 D p  up
bOL
completes 1 2 OEf to an OEf -basis of OL.

Integral Frobenius for Abelian Varieties with Real Multiplication
163
Using Propositions 4.1, 4.3 and Corollary 4.5, the required computation can be
carried out using basic Magma functions on the arithmetic of real quadratic ﬁelds.
Notice that the OEf -basis .1; e2/ of OL satisﬁes the useful property of Corollary 4.6.
The crucial information that we need to compute for the recipe of the integral
Frobenius is the ideal bp given by the OEf -conductor of OEf Œp inside Sp, where
Sp is the order L \ EndFp.Af;p/. If the conductor bOL is the trivial ideal OEf , then the
chain (9) becomes
OEf Œp D Sp D OL;
and hence the ideal bp is trivial, and the integral Frobenius is simply given by the
companion matrix
p D
0 p
1 ap

:
(18)
We then continue assuming that the ideal bOL is a proper ideal of OE. In this case
there is more than one possibility for the order Sp, and to decide which one occurs
we want to use Bisson’s algorithm to compute the ring EndFp.Af;p/. In order to do
so we ﬁrst have to make sure that the assumptions of his algorithm are satisﬁed.
We discuss these in the next three steps. If one of these assumptions fails, then our
strategy will not lead to the computations of the integral Frobenius of Af at p.
5. In the case where a2
p  4p ¤ 0 and the ideal bOL is proper, check whether the
afﬁne model ZŒx; y=.y2  F.x// of Cf has good reduction at the prime p.
It can happen that the model of Cf coming from the algorithm in [5] has singular
reduction at a prime p −N. In our computations this never occurred in a case where
a2
p  4p ¤ 0 and bOL ¨ OEf .
6. In the case where a2
p  4p ¤ 0 and the ideal bOL is proper, check whether the
abelian surface Af;p is ordinary.
Recall that a Weil p-number is ordinary if and only if the algebraic integer Cp=
is a p-adic unit. In our case this amounts to check if ap is relatively prime to p in
OEf , which can easily be done in Magma.
7. In the case where a2
p  4p ¤ 0 and the ideal bOL is proper, check whether the
abelian surface Af;p is absolutely irreducible.
The abelian surface Af;p is either Fp-isogenous to the square of an elliptic curve or
it is Fp-simple (see Proposition 3.1). Since our base ﬁeld is Fp and the Weil number
p is not real, we know from Honda-Tate theory (see [14]) that
Af;p is Fp-simple ” p C p=p D ap 62 Z ” ŒQ./ W Q D 4:

164
T.G. Centeleghe and C. Theisen
In order to proceed we then must require ap 62 Z and still have to check whether Af;p
is absolutely simple or not. This amounts to verify the equality of number ﬁelds
Q.N
p / D Q./
(19)
for any integer N  2. Since Q./ is a CM quartic extension of Q it sufﬁces to
check (19) for all integers N  2 such that '.N/  4, where ' denotes the Euler
'-function. These values are 2; 3; 4; 5; 6; 10 and 12, and (19) can be veriﬁed using
Magma.
8. In the case where a2
p4p ¤ 0 and the ideal bOL is proper, assuming that the afﬁne
model of Cf has good reduction at p and the abelian surface Af;p is absolutely
irreducible and ordinary, use [1] to compute EndFp.Af;p/. Then extract from it
the information of the ideal bp.
Since Af;p is Fp-simple and p is not real, we have that the CM quartic ﬁeld Q.p/
coincides with the algebra EndFp.Af;p/ ˝ Q. So that the ring of Fp-endomorphisms
of Af;p is an order of Q.p/. Notice that we also have
L D Q./ and Sp D EndFp.Af;p/:
The output of Bisson’s algorithm is a Z-basis of the Z-order EndFp.Af;p/ 	 Q.p/,
expressed in terms of the basis .1; p; 2
p; 3
p/ of Q.p/. We are left with converting
this output in an “OEf -linear” format, suitable for our purposes. To do this we use
the equality p C p=p D ap to embed the totally real ﬁeld Ef in the number ﬁeld
Q.p/. In this way, using step 4 and Corollary 4.6, we can control all OEf -orders S
containing OEf Œp by exhibiting for each of them an OEf -basis of the form
.1; bOL
bS
 e2/
(20)
inside the number ﬁeld Q./ where Bisson’s output lives. Letting bS vary through a
set of generators of all divisors of bOL, we can then easily determine the unique
element for which the OEf -span of the pair (20) gives the lattice from Bisson’s
algorithm. This element is the generator bp of the ideal bp we were after.
7
Tables of Results
We applied the strategy explained in the previous section to three modular abelian
surfaces Af over Q. The goal is to compute as many integral Frobenia as possible
at primes p of good reduction in the range 2; : : : ; 1997. The three Hecke cuspidal
newforms f we chose have conductor N D 23; 125 and 133. They all lie in
the ﬁrst Galois orbit of the corresponding space S2.0.N//, according to Magma

Integral Frobenius for Abelian Varieties with Real Multiplication
165
enumeration. The hyperelliptic equations we used for the genus two curves Cf are
those appearing in [5].
The heading of the six columns of each table follows the notations of the paper.
The ﬁrst column consists of primes p. The second, third and fourth columns (ap,
up and bp) contain the elements of OEf needed to construct the integral Frobenius
p, they are expressed with respect to the Q-basis .1; a/ of Ef used by Magma to
parametrize the coefﬁcient ﬁeld Ef. The ﬁfth and sixth columns respectively give
the prime factorizations of the ideals bp and bOL in OEf .3 If ` is a rational prime
which is does not split in Ef , then the corresponding prime of OEf is denoted by .`/
or `, according to whether ` is inert or ramiﬁes, respectively. If ` is split, then the
corresponding primes are denoted by `;1 and `;2.
In every table we listed all primes p  1997 where the given surface has good
reduction and such that the order OEf Œp is not the maximal order of L D EŒp.
When we were not able to apply Bisson’s algorithm (or when the algorithm did not
terminate), a dash (–) appears in place of the entries up and bp. In certain cases we
did obtain an output from Bisson’s algorithm even though its basic assumptions on
the input surface Af;p were not satisﬁed. These primes appear marked in the tables:
the symbol ./ indicates that Af;p is not ordinary, and the symbol ./ denotes that
it is not absolutely simple, but just Fp-simple.
Finally, in every example considered, the coefﬁcient ﬁeld Ef is the real quadratic
ﬁeld Q.
p
5/ of discriminant 5, and the order Of is the maximal order. In the last two
examples, the Galois representation on the 2-torsion AfŒ2 deﬁnes two extensions
of Q with Galois group isomorphic to A5, the alternating group in ﬁve letters. The
computation of the integral Frobenius, when successful, reveal the primes that are
completely split in these extensions.
7.1
First Example
Let f 2 S2.0.23// be the unique normalized cusp form of weight 2 and level 23.
The element a 2 Ef used by Magma to parametrize Ef has minimal polynomial
x2 C x  1. The ﬁrst few coefﬁcients of the Fourier expansion of f are
f D q C aq2  .2a C 1/q3  .a C 1/q4 C 2aq5 C : : :
In Table 1 we can experimentally observe a reducibility phenomenon predicted by a
famous result of Mazur (see [7]): since the prime 11 divides N  1, Mazur predicts
the existence of a prime  of Ef lying above 11 such that
N ' 1 ˚ 11;
3These ideals are always deﬁned in our computations as we never found a prime p for which
a2
p  4p D 0.

166
T.G. Centeleghe and C. Theisen
Table 1 Integral Frobenius for Af , where f 2 S2.0.23//
p
ap
up
bp
Fac.bp/
Fac.bOL/
19
2



.3/
43
0



.2/
53
2 C 4a
0
1
.1/
.2/
59
4 C 4a
1
2
.2/
.2/
61
2  8a
0
1
.1/
.2/
67
4 C 2a
9 C a
2 C 3a
11;1
11;1
89
8  4a
7 C 9a
2 C 3a
11;1
11;1
101./
2 C 4a
1
2
.2/
.2/
149
14 C 16a
0
1
.1/
.2/
167
4  4a
1
2
.2/
.2/
173
18 C 8a
1
2
.2/
.2/
199
16 C 6a
3 C 3a
2 C 3a
11;1
11;1
211
16  12a
1
2
.2/
.2/
223
4



.2/
233
9 C 4a
0
1
.1/
31;2
271
8



.2/
307
12  4a
1
2
.2/
.2/
311
7 C 10a
0
1
.1/
5
317
18 C 12a
1
2
.2/
.2/
331
11  14a
4a
2 C 3a
11;1
11;1
347
16a
1
2
.2/
.2/
353
3 C 20a
4 C 10a
2 C 3a
11;1
11;1
379
12 C 20a
0
1
.1/
.2/
383
12  8a
0
1
.1/
.2/
397
17  12a
8 C 5a
2 C 3a
11;1
11;1
401
8  10a
0
1
.1/
5
409
9 C 20a
0
1
.1/
5
419
12 C 12a
10 C 8a
2 C 3a
11;1
.2/11;1
431
20 C 4a
0
1
.1/
.2/
449
10  8a
1
2
.2/
.2/
463
20



.2/11;211;1
563
28  8a
0
1
.1/
.2/
569
16  10a
0
1
.1/
5
593
2  8a
1
2
.2/
.2/
599
24 C 16a
1
2
.2/
.2/
607
24 C 4a
1
2
.2/
.2/
617
10 C 4a
8 C 5a
2 C 3a
11;1
.2/11;1
619
12 C 12a
0
1
.1/
.2/
631
20a
0
1
.1/
.2/
661
18  8a
5 C 6a
2 C 3a
11;1
.2/11;1
677
18



.2/
683
13 C 22a
1
2 C 3a
11;1
11;1
(continued)

Integral Frobenius for Abelian Varieties with Real Multiplication
167
Table 1 (continued)
p
ap
up
bp
Fac.bp/
Fac.bOL/
691
12  8a
1
2
.2/
.2/
719
8 C 8a
1
2
.2/
.2/11;2
727
24  6a
10 C 8a
2 C 3a
11;1
11;1
751
12 C 20a
0
1
.1/
.2/5
787
32  12a
0
1
.1/
.2/
797
22  20a
0
1
.1/
.2/
809./
22  16a
1
2
.2/
.2/
821
34  8a
1
2
.2/
.2/2
827
4  4a
0
1
.1/
.2/
829
18 C 36a
1
2
.2/
.2/
853
18 C 12a
1
2
.2/
.2/
859
13  6a
10 C 8a
2 C 3a
11;1
11;1
877
34  4a
1
2
.2/
.2/
881
38 C 10a
8 C 5a
2 C 3a
11;1
511;1
883
4



.2/
911./
14 C 28a
1 C 2a
3
.3/
.3/
941
2 C 14a
0
1
.1/
.3/
947
17 C 10a
8 C 5a
2 C 3a
11;1
11;1
953
18 C 4a
0
1
.1/
.2/
991
24



.2/11;211;1
997
2 C 24a
1
2
.2/
.2/
1009./
6 C 12a
0
1
.1/
.2/
1013
29  8a
2 C 7a
2 C 3a
11;1
11;1
1069
26 C 18a
0
1
.1/
.3/
1091
4 C 40a
0
1
.1/
.2/
1097
18  24a
1
2
.2/
.2/
1117
14  28a
1
2
.2/
.2/
1123
34 C 12a
5 C 6a
2 C 3a
11;1
11;1
1151./
24  48a
1
2
.2/
.2/
1163
8  20a
1
2
.2/
.2/
1171
16  18a
0
1
.1/
.3/
1181
2  16a
1
2
.2/
.2/
1213
28 C 36a
0
1
.1/
.3/
1217
4  28a
0
1
.1/
.3/
1231
16  24a
1
2
.2/
.2/
1259
24  12a
0
1
.1/
.2/
1277
7  8a
2 C 7a
2 C 3a
11;1
11;1
1279
24  42a
10 C a
1 C 3a
11;2
11;2
1301
47 C 4a
0
1
.1/
.3/
1303
12 C 20a
0
1
.1/
.2/
1319
4  16a
1
2
.2/
.2/
(continued)

168
T.G. Centeleghe and C. Theisen
Table 1 (continued)
p
ap
up
bp
Fac.bp/
Fac.bOL/
1321
8  24a
4 C 10a
2 C 3a
11;1
11;1
1409
31  44a
1
2 C 3a
11;1
11;1
1451
8 C 32a
1
2
.2/
.2/
1453
2



.2/11;211;1
1459
66 C 10a
0
1
.1/
5
1481
6 C 8a
1
2
.2/
.2/
1483
36 C 8a
0
1
.1/
.2/
1489
4 C 36a
0
1
.1/
.3/
1499
13 C 2a
0
1
.1/
11;2
1523
24  56a
0
1
.1/
.2/
1543
41  18a
2
3
.3/
.3/
1549
43



.3/
1553
6  8a
1
2
.2/
.2/
1559
39  10a
0
1
.1/
5
1607
46  28a
10 C 8a
2 C 3a
11;1
11;1
1613
18 C 48a
1
2
.2/
.2/
1663
8  44a
0
1
.1/
.2/
1667
36  48a
0
1
.1/
.2/
1669
38  32a
3
4
.2/2
.2/
1697
38  8a
1
2
.2/
.2/
1721./
4 C 8a
0
1
.1/
.3/2
1733
47  4a
0
1
.1/
.3/
1783
57  6a
10 C 8a
2 C 3a
11;1
11;1
1787
40  4a
1
2
.2/
.2/
1789
18 C 16a
1
2
.2/
.2/
1811
28 C 52a
0
1
.1/
.2/
1831
52  10a
0
1
.1/
5
1861
30  44a
0
1
.1/
.2/
1867
20 C 44a
1
2
.2/
.2/
1871
12 C 12a
21 C 8a
4 C 6a
.2/11;1
.2/11;1
1873
38  8a
0
1
.1/
.2/
1877
22 C 32a
0
1
.1/
.2/2
1879
20  12a
1
2
.2/
.2/
1889
2  44a
1
2
.2/
.2/
1901
14 C 8a
2 C a
3
.3/
.2/.3/
1913
62  16a
1
2
.2/
.2/
1931
2 C 20a
0
1
.1/
5
1949
58  20a
0
1
.1/
.2/
1997
46  8a
0
1
.1/
.2/

Integral Frobenius for Abelian Varieties with Real Multiplication
169
where N is the residual Galois representation of , 11 is the mod 11 cyclotomic
character, and 1 is the trivial character. The consequence of this result relevant for
our computation is that for every prime p ¤ 23 with p  1 mod 23 the ideal bp
appearing in the deﬁnition of the integral Frobenius is divisible by . Such ideal 
is denoted by 11;1 in the table.
7.2
Second Example
Let now f 2 S2.0.125// be the normalized cusp form of weight 2 and level 125
lying in the ﬁrst Galois orbit of eigenforms. The element a 2 Ef has also in this case
minimal polynomial x2 C x  1. The ﬁrst few coefﬁcients of the Fourier expansion
of f are
f D q C aq2  .a C 2/q3  .a C 1/q4  .a C 1/q6 C : : :
Consider the Galois representation
N.2/ W GQ ! AutOEf =.2/.AfŒ2/ ' GL2.OEf =.2//:
(21)
deﬁned by the 2-torsion AfŒ2 of Af . The rational prime 2 is inert in Ef ' Q.
p
5/,
denote by F4 its residue ﬁeld. Since N.2/ has trivial determinant we see that N.2/ is
valued in the special linear group SL2.F/, which is isomorphic to A5, the alternating
group in ﬁve letters.
After analyzing the reduction modulo 2 of the ﬁrst few Hecke eigenvalues of f,
and using elementary group theory, one can deduce that
Im. N.2// ' SL2.F/;
(22)
i.e., N.2/ deﬁnes an A5-extension K=Q. According to Corollary 2.3, a rational prime
p −2  5 splits completely in K if and only if .2/ divides bp, which, by Chebotarev,
happens for a set of primes of density 1=60  0:017. In Table 2 we observe this
splitting phenomenon for p D 887; 1657 and 1699.
Lastly, notice that for every prime p  1 mod 5 for which we were able to
compute p, we have that the unique prime of Ef lying above 5 divides bp. Reasoning
as in the ﬁrst example, this suggests that there is a decomposition
N5 ' 1 ˚ 5;
where 5 denotes the mod 5 cyclotomic character. However, with our methods we
are not able to prove this.

170
T.G. Centeleghe and C. Theisen
Table 2 Integral Frobenius for Af , where f lies in the ﬁrst Galois orbit of S2.0.125//
p
ap
up
bp
Fac.bp/
Fac.bOL/
11
3



5
31./
3  5a
1
1 C 2a
5
5
41
3



5
61
2 C 5a



519;1
71
3



2
5
89./
6 C 12a
0
1
.1/
.2/
101
3



5
131
12 C 15a
1
1 C 2a
5
5
137
4  a
2 C a
3
.3/
.3/
151
13 C 5a
1
1 C 2a
5
5
173
13  8a
1 C 2a
3
.3/
.3/
181
2  10a
1
1 C 2a
5
5
191
12



.2/5
211
12 C 10a
1
1 C 2a
5
5
229
3  a
0
1
.1/
11;1
233
1 C 16a
1 C 2a
3
.3/
.3/
241
3 C 10a
1
1 C 2a
5
5
251
18  15a
1
1 C 2a
5
5
271
12  5a
1
1 C 2a
5
5
281
12



5.7/
311
3  15a
1
1 C 2a
5
5
313
12a
0
1
.1/
11;1
317
14 C 8a
2 C a
3
.3/
.2/.3/
331
13 C 5a
1
1 C 2a
5
5
353
22  16a
0
1
.1/
.2/
379
7 C 9a
2
3
.3/
.3/
401
12



5
421
17 C 5a
1
1 C 2a
5
5
431
12 C 15a
1
1 C 2a
5
5
439
1  18a
2
3
.3/
.3/
457
18



.2/2
461
12  15a
1
1 C 2a
5
5
491
12  15a
1
1 C 2a
5
5
503
8  11a
1 C 2a
3
.3/
.3/
509./
6  12a
0
1
.1/
.2/
521
18  15a
1
1 C 2a
5
5
541
18 C 10a
1
1 C 2a
5
5
547
27  3a



59;1
557
8 C 20a
2 C a
3
.3/
.3/
563
20 C 8a
0
1
.1/
.2/
571
13



5.3/
(continued)

Integral Frobenius for Abelian Varieties with Real Multiplication
171
Table 2 (continued)
p
ap
up
bp
Fac.bp/
Fac.bOL/
587
4 C 4a
0
1
.1/
.2/
601
33  20a
1
1 C 2a
5
5
631
2



5.3/
641
33  15a
1
1 C 2a
5
5
647
17 C 2a
2 C a
3
.3/
.3/
661
18  20a
2 C 2a
1 C 2a
5
.2/5
677
30 C 16a
0
1
.1/
.2/
691
42 C 10a
1
1 C 2a
5
5
701
27 C 15a
1
1 C 2a
5
5
727
24a
0
1
.1/
.2/
743
34  5a
1 C 2a
3
.3/
.3/
751
17 C 20a
1
1 C 2a
5
5
757
27



11;211;1
761
18



.2/35
811
28  10a
1
1 C 2a
5
5
821
3  15a
1
1 C 2a
5
5
859
4 C 18a
2
3
.3/
.3/
863
10  2a
1 C 2a
3
.3/
.3/
881
3  30a
1
1 C 2a
5
5
887
36 C 4a
1
2
.2/
.2/
911
12 C 30a
1
1 C 2a
5
5
941
3 C 15a
1
1 C 2a
5
5
971
3 C 30a
1
1 C 2a
5
5
991
43  10a
1
1 C 2a
5
5
1021
17 C 20a
1
1 C 2a
5
5
1031
3  30a
1
1 C 2a
5
5
1051
28  45a
1
3 C 6a
5.3/
5.3/
1061
27 C 30a
1
1 C 2a
5
5
1091
3  30a
1
1 C 2a
5
5
1097
17 C 2a
2 C a
3
.3/
.3/
1151
12 C 45a
1
1 C 2a
5
5
1171
3 C 25a
1
1 C 2a
5
2
5
1181
18  15a
1
1 C 2a
5
5
1193
24 C 20a
0
1
.1/
11;1
1201
3  5a
1
1 C 2a
5
5
1231
18  5a
1
1 C 2a
5
5
1291
2 C 20a
1
1 C 2a
5
5
1301
18 C 30a
1
1 C 2a
5
5
1321
2  40a
2 C 2a
1 C 2a
5
.2/5
1361
42



.2/5
1367
1  7a
2 C a
3
.3/
.3/
1381
27 C 25a
1
1 C 2a
5
5
(continued)

172
T.G. Centeleghe and C. Theisen
Table 2 (continued)
p
ap
up
bp
Fac.bp/
Fac.bOL/
1399
50



.3/
1433
14  4a
0
1
.1/
.2/
1451
12



.2/5
1471
18  20a
1
1 C 2a
5
5
1481
48  15a
1
1 C 2a
5
5
1511
3 C 30a
1
1 C 2a
5
5
1531
2



5.3/
1549
20  45a
2
3
.3/
.3/
1571
18 C 30a
1
1 C 2a
5
5
1583
1 C 16a
1 C 2a
3
.3/
.3/
1601
3 C 15a
1
1 C 2a
5
5
1607
48  20a
0
1
.1/
.2/
1621
47 C 45a
1
3 C 6a
5.3/
5.3/
1657
42 C 60a
1
2
.2/
.2/
1663
60  12a
0
1
.1/
.2/
1669
32  9a
2
3
.3/
.3/
1699
40 C 40a
1
2
.2/
.2/
1721
3  30a
1
1 C 2a
5
5
1741
13 C 20a
1
1 C 2a
5
5
1777
30  24a
0
1
.1/
.2/
1789
1  18a
2
3
.3/
.3/
1801
2  10a
1
1 C 2a
5
5
1811
63



2
5
1823
43  23a



.3/
1831
12  35a
1
1 C 2a
5
5
1861
17 C 45a
1
3 C 6a
5.3/
5.3/
1871
27



5
1901
27 C 30a
1
1 C 2a
5
5
1931
27 C 45a
1
1 C 2a
5
5
1951
33  20a
1
1 C 2a
5
5
7.3
Third Example
In our last example we consider a normalized cuspidal f 2 S2.0.133// of weight
2 and conductor 133 lying in the ﬁrst Galois orbit of eigenforms. The ﬁrst few
coefﬁcients of the Fourier expansion of f are
f D q C aq2 C aq3  3.a C 1/q4  .2a C 3/q5  .3a C 1/q6 C : : :
where a 2 Ef has minimal polynomial x2 C 3x C 1. The same argument used in the
second example shows that N.2/ deﬁnes an A5-extension K=Q. Looking at Table 3,
we observe that the primes 839; 941; 1663; 1783and 1789 are completely split in K.

Integral Frobenius for Abelian Varieties with Real Multiplication
173
Table 3 Integral Frobenius for Af , where f lies in the ﬁrst Galois orbit of S2.0.133//
p
ap
up
bp
Fac.bp/
Fac.bOL/
5
3  2a



5
11
3 C a
0
1
.1/
.3/
29
3 C a
0
1
.1/
.3/
47./
15  10a
a
3
.3/
.3/
59
15  6a
0
1
.1/
11;1
79
10



.3/
131
3  5a
0
1
.1/
5.3/
137
6  4a
0
1
.1/
.2/
173
6 C 10a
0
1
.1/
.3/
181
25  9a
0
1
.1/
.3/
193
5  9a
2
3
.3/
.3/
229
14  12a
0
1
.1/
.2/
239
15 C 4a
2a
3
.3/
.3/
251
3  11a
0
1
.1/
.3/
311
3  5a
4
3 C 2a
5
5
317
30 C 12a
0
1
.1/
.2/
389
15 C 11a
0
1
.1/
19;2
431./
30  20a
0
1
.1/
.3/
439
8



.2/.3/
443
12 C a
2a
3
.3/
.3/
449
12 C 7a
2a
3
.3/
.3/
457
28 C 9a
0
1
.1/
.3/
479
51 C 25a
0
1
.1/
5
491
12  4a
0
1
.1/
.2/
503./
24 C 16a
0
1
.1/
.2/.3/
509
30



.2/
541./
18 C 12a
0
1
.1/
.2/
571
23  18a
0
1
.1/
.3/
599
6  5a
2
3 C 2a
5
511;1
619
10  9a
0
1
.1/
.3/
631
1 C 6a
0
1
.1/
11;1
661
26  24a
0
1
.1/
.2/
677
42  19a
0
1
.1/
.3/
719
12 C 16a
0
1
.1/
.2/
757
10 C 12a
0
1
.1/
.2/
787
20 C 12a
0
1
.1/
.2/
839
24 C 20a
1
2
.2/
.2/5
857
69  37a
a
3
.3/
.3/
911
6 C 8a
a
3
.3/
.3/
941
6  20a
1
2
.2/
.2/
971
33  10a
0
1
.1/
5
977
10a



89;1
(continued)

174
T.G. Centeleghe and C. Theisen
Table 3 (continued)
p
ap
up
bp
Fac.bp/
Fac.bOL/
983
57  26a
2a
3
.3/
.3/
1051
38 C 15a
0
1
.1/
5
1061./
3 C 2a
a
3
.3/
.3/
1087
37 C 27a
2
3
.3/
.3/
1109
6  4a
0
1
.1/
.2/
1117
7 C 18a
0
1
.1/
.3/
1217
33  8a
2a
3
.3/
.3/
1231
46  27a
0
1
.1/
.3/
1249
44  18a
2
3
.3/
.3/
1259
21 C 25a
3
3 C 2a
5
5
1303
54  30a
0
1
.1/
11;1
1361
6  20a
0
1
.1/
.2/
1367
36  8a
0
1
.1/
.2/
1409
66 C 32a
0
1
.1/
.2/.3/
1447
56  48a
0
1
.1/
.2/
1451
33  37a



.3/
1483
62 C 45a
1
3
.3/
.3/
1487
84  53a



.3/
1493
54  28a
0
1
.1/
.2/
1531
43



2
5.3/
1553
75  a
0
1
.1/
.7/
1567
38  18a
0
1
.1/
.3/11;2
1609
17 C 15a



109;1
1663
44 C 24a
1
2
.2/
.2/
1669
49 C 18a
2
3
.3/
.3/
1723
56 C 24a
0
1
.1/
.2/
1733
24  13a
0
1
.1/
.3/
1741
7 C 15a
0
1
.1/
5
1753
10 C 27a
1
3
.3/
.3/
1759
14  9a
0
1
.1/
.3/
1783
32 C 12a
1
2
.2/
.2/
1789
6  12a
1
2
.2/
.2/
1823
84  23a



.3/
1847./
48  32a
1
2
.2/
.2/
1871
24



.2/
1873
43  18a
0
1
.1/
.3/
1879
35



.3/
1889
105  52a



.3/
1907
60  7a
0
1
.1/
.3/
1933
10  9a
0
1
.1/
.3/
1973
6  16a
0
1
.1/
.2/
1987
10  27a
1
3
.3/
.3/

Integral Frobenius for Abelian Varieties with Real Multiplication
175
Acknowledgements We wish to thank Gebhard Böckle for all the useful discussions we had on
this project. We thank Gaetan Bisson for an intense email correspondence where he helped us
understanding better his work. The ﬁrst author thanks Jordi Guàrdia and Josep Gonzàlez for the
warm hospitality he received during his visit to Universitat Politècnica de Catalunya in July 2015.
This work was supported by the DFG Priority Program SPP 1489 and the Luxembourg FNR.
References
1. G. Bisson, Computing endomorphism rings of abelian varieties of dimension two. Math.
Comput. 84, 1977–1989 (2015)
2. W. Bosma, J. Cannon, C. Playoust, The Magma algebra system. I. The user language. J. Symb.
Comput. 24, 235–265 (1997)
3. C.-L. Chai, B. Conrad, F. Oort, Complex Multiplication and Lifting Problems. Mathematical
Surveys and Monographs, vol. 195 (American Mathematical Society, Providence, RI, 2014)
4. W. Duke, Á. Tóth, The splitting of primes in division ﬁelds of elliptic curves. Exp. Math. 11(4),
555–565 (2002)
5. E. González-Jiménez, J. González, J. Guàrdia, Computations on modular Jacobian surfaces,
in Algorithmic Number Theory (Sidney 2002). Lecture Notes in Computer Science, vol. 2369
(Springer, Berlin, 2002), pp. 189–197
6. J. González, J. Guàrdia, V. Rotger, Abelian surfaces of GL2-type as Jacobians of curves. Acta
Arith. 116(3), 263–287 (2005)
7. B. Mazur, Modular curves and the Eisenstein ideal. Inst. Hautes Études Sci. Publ. Math. 47,
33–186 (1977)
8. W. Narkiewicz, Elementary and Analytic Theory of Algebraic Numbers, 3rd edn. (Springer,
Berlin, 2004)
9. K. Ribet, Galois action on division points of abelian varieties with real multiplications. Am. J.
Math. 98(3), 751–804 (1976)
10. J.-P. Serre, Corps Locaux, Quatrième édition, corrigée (Hermann, Paris, 2004)
11. J.-P. Serre, J. Tate, Good reduction of abelian varieties, Ann. Math. 88(3), 492–517 (1968)
12. G. Shimura, Introduction to the arithmetic theory of automorphic forms, Publications of the
Mathematical Society of Japan, vol. 11. Kanô Memorial Lectures, 1 (Princeton University
Press, Princeton, NJ, 1994)
13. J. Tate, Endomorphisms of abelian varieties over ﬁnite ﬁelds. Invent. math. 2, 134–144 (1966)
14. J. Tate, Classes d’isogénie des variétés abéliennes sur un corps ﬁni, Sém. Bourbaki 21e année,
no. 352 (1968/69)

Monodromy of the Multiplicative
and the Additive Convolution
Michael Dettweiler and Mirjam Jöllenbeck
Abstract We give an algorithmic approach for the computation of the monodromy
of the additive and the multiplicative convolution in terms of singular cohomology.
Keywords Convolution • Monodromy
Subject Classiﬁcations 14D05, 32S40
1
Introduction
Convolution integrals of the form
f  g .y/ WD
Z
f.x/g.y  x/dx
(additive convolution)
or
f ? g .y/ WD
Z
f.x/g
y
x

dx
(multiplicative convolution)
play an important role in many areas of mathematics and physics, see e.g. [15] and
[18].
M. Dettweiler ()
University of Bayreuth, Bayreuth, Germany
e-mail: michael.dettweiler@uni-bayreuth.de; michael.dettweiler@unibayreuth.de
M. Jöllenbeck
e-mail: joellenbeck.mirjam@gmail.com
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_7
177

178
M. Dettweiler and M. Jöllenbeck
It is often important to know the analytic continuation of the functions f  g
and f ? g (i.e., their monodromy) if f and g are complex-valued analytic functions
with regular singularities. It is the aim of this article to provide a general method to
compute the monodromy of additive and multiplicative convolutions in a systematic
and algorithmic way. In this way, we e.g. obtain explicit monodromy tuples of the
motivic local systems with G2-monodromy, considered in [5, Cor. 2.4.2]:
0
BBBBBBBBB@
1 0 0 2
2
0
0
0 1 0 2 0
2
0
0 0 1 2
2
2
2
0 0 0 1 0
0
0
0 0 0 0 1 0
0
0 0 0 0
0 1 0
0 0 0 0
0
0 1
1
CCCCCCCCCA
;
0
BBBBBBBBB@
1 0 0 0 0 0 0
0 1 0 0 0 2 0
0 0 1 0 0 0 0
2 0 0 1 0 0 0
0 2 0 0 1 0 0
0 0 2 0 0 1 0
0 0 0 2 4 4 1
1
CCCCCCCCCA
;
0
BBBBBBBBB@
5
4
0
2
2
0
0
4 1
4 2 0
2
0
4
4
5
6 10 10 2
2 0
0 1 0
0
0
0 2 0
0 1 0
0
0
0 2 0
0 1 0
0
0
0 2 4 4 1
1
CCCCCCCCCA
:
The knowledge of such matrices is especially important for reﬁned considerations
of monodromy groups in terms of ﬁnite, arithmetic or thin subgroups of linear
algebraic groups, cf. [12].
Using a shearing transformation .x; y/ 7! .x; y C x/ (resp. .x; y/ 7! .x; xy/) the
convolution integrals f  g or f ? g can be seen as local sections of a sheaf theoretic
higher direct image
R1Š.V1  V2/
where  is either the addition map on A1 (if f  g is considered) or  denotes the
multiplication map on Gm (if f ? g is considered). Because we are mainly interested
in irreducible objects, we study middle (or intermediate) convolutions V1  V2 or
V1 ? V2 of the form
im.R1Š.V1  V2/ ! R1.V1  V2//;
which, by shearing back, can be interpreted as suitable variations of parabolic
cohomology groups, cf. Eq. (10) and Sects. 3.1 and 4.1.
The monodromy representation of V1  V2 or V1 ? V2 in dependence of the
monodromy representations of the initial local systems V1 and V2 is then determined
using the unifying theory of braid groups and the parabolic cohomology of
variations of local systems, developed in [10].
This article complements a series of articles on the convolutions worked out
within the realm of the SPP 1489:
•
Classiﬁcation of orthogonally rigid local systems with G2-monodromy using
middle convolution [6].
•
Motives for rigid G2-local systems [9].
•
Classiﬁcation of irregular rigid D-modules whose differential Galois group is
equal to G2 [13].

Monodromy of the Multiplicative and the Additive Convolution
179
•
Hodge theoretical description of the additive middle convolution with Kummer
sheaves [8].
•
The global and local Hodge data for general additive and multiplicative convolu-
tions are worked out in [7] (building up on [8]).
An associated program [14] for the computation of variations of parabolic
cohomology and especially both types of convolutions will appear on the homepage
of one of the authors.
2
Preliminary Results
2.1
Group Theoretical Deﬁnitions and Tensor Product
of Representations
Throughout the article, R denotes an integral domain with fraction ﬁeld K: If V is a
free R-module, then GL.V/ denotes the R-linear isomorphisms of V: As usual, the
group of R-linear isomorphisms of Rn is denoted by GLn.R/: Linear automorphisms
act from the right, i.e., if A 2 GL.V/ and v 2 V; then vA denotes the image of v
under A:
A Jordan block of eigenvalue ˛ 2 R and of length l is denoted by J.˛; l/: We
write
J.˛1; n1/ ˚    ˚ J.˛k; nk/
for a block matrix in GLn1C			Cnk.R/ which is in Jordan normal form and whose
Jordan blocks are J.˛1; n1/; : : : ; J.˛k; nk/: Let V1; : : : ; Vt be free R-modules having
rank n1; : : : ; nt (respectively). Set n WD Qt
iD1 ni and V WD V1 ˝    ˝ Vt: For gi 2
GL.Vi/; deﬁne the elements g1 ˝    ˝ gt 2 GL.V/ by setting
.v1 ˝    ˝ vt/.g1 ˝    ˝ gt/ WD v1g1 ˝    ˝ vtgt :
This tensor product of matrices is also called the Kronecker product. Let 1 W H1 !
GL.V1/ and 2 W H2 ! GL.V2/ be two representations, then the tensor product
deﬁnes a representation
1 ˝ 2 W H1  H2 ! GL.V1 ˝ V2/; .h1; h2/ 7! h1 ˝ h2 :
It is often important to compute the Jordan normal form of the tensor product A ˝ B
of two matrices A 2 GLn.K/ and B 2 GLm.K/: In characteristic 0 this can be done
using the following well known lemma (cf. [17, Table 5, Case A1 on p. 300]):
Lemma 2.1.1 Let K be an algebraically closed ﬁeld of characteristic zero, let
˛; ˇ 2 K; and let n1  n2: Let J.˛; n1/ 2 GLn1.K/ and J.ˇ; n2/ 2 GLn2.K/ be

180
M. Dettweiler and M. Jöllenbeck
two Jordan blocks. Then the Jordan normal form of J.˛; n1/ ˝ J.ˇ; n2/ is given by
n11
M
iD0
J.˛ˇ; n1 C n2  1  2i/ :
2.2
Braid Groups and Afﬁne Fibrations
We will write A1; P1; : : : instead of A1.C/; P1.C/; : : : and view these objects
equipped with their associated topological and complex analytic structures. Let
X be a connected topological manifold and let 1.X; x0/ denote the fundamental
group of X with base point x0: The product of two elements ˛; ˇ 2 1.X; x0/
is given by (the homotopy class of) ˛ˇ; where the path product ˛ˇ is given by
ﬁrst walking through ˛ and then through ˇ. Let r 2 N with r  2 and let
U0 D A1 n u; where u WD fu1; : : : ; urg is a ﬁnite subset of A1: We will identify
U0 with P1 n .u [ f1g/ in the obvious way. Using a suitable homeomorphism
 W P1 ! P1; (called a marking in [10, Section 1.2]) and the conventions of loc.
cit., Section 2.3, one obtains generators ˛1; : : : ; ˛rC1 of 1.U0; u0/ which satisfy
the product relation ˛1    ˛rC1 D 1: If u D fu1; : : : ; ur; urC1 D 1g is elementwise
real then ˛i approaches ui in the upper half plane (i D 1; : : : ; r) and then moves
counterclockwise around ui once and goes back to u0 in the upper half plane. Let
Or WD fu  A1 j juj D rg
and
Or;1 WD f.u; x/ 2 Or  P1 j x … ug :
The sets Or and Or;1 are connected topological manifolds in a natural way and
we set Ar WD 1.Or; u/ and Ar;1 WD 1.Or;1; .u; u0//: Then, the marking on U0
also deﬁnes standard generators ˇ1; : : : ; ˇr1 of Ar which satisfy the usual relations
of the standard generators of the Artin braid groups. If u is elementwise real with
u1 <    < ur; then ˇi ﬁxes all uj with j ¤ i; i C 1 and interchanges ui and uiC1
via a braid by moving ui to uiC1 along the real axis and moving uiC1 to ui in the
upper half plane (except for the initial and the end point). One obtains a split exact
sequence
1 ! 1.U0; u0/ ! Ar;1 ! Ar ! 1
(1)
such that the following equations holds (cf. [1, L. 1.8.2 and Cor. 1.8.3]):
ˇ1
i
˛jˇi D
8
ˆˆ<
ˆˆ:
˛i˛iC1˛1
i
;
for j D i;
˛i;
for j D i C 1;
˛j;
otherwise.
(2)

Monodromy of the Multiplicative and the Additive Convolution
181
As usual, one sees that Ar acts (product preserving) as follows on Gr; where G
is any group:
.g1; : : : ; gr/ˇi D
.g1; : : : ; gi1; giC1; g1
iC1gigiC1; giC2; : : : ; gr/; 8 .g1; : : : ; gr/ 2 Gr:
(3)
Let
Or WD f.v1; : : : ; vr/ 2 Cr j vi 6D vj
for
i 6D jg :
Let Ar WD 1.Or; .u1; : : : ; ur// be the pure braid group. The map
Or ! Or; .v1; : : : ; vr/ 7! fv1; : : : ; vrg
is a unramiﬁed covering map. Thus (via the lifting of paths) Ar can be seen as a
subgroup of Ar: It is well known, that Ar as such is generated by the following
braids (cf. [16]):
ˇi;j WD .ˇ2
i /ˇ1
iC1			ˇ1
j1 D .ˇ2
j1/ˇj2			ˇi;
(4)
where 1  i < j  r:
Let S be a smooth connected complex manifold, let X WD P1
S D P1  S; and let
d  X be a smooth relative divisor of degree r C1 over S which contains the section
f1g  S: Let U WD X n d; let j W U ! X the natural inclusion, let N W X ! S be the
projection onto S, and let  W U ! S be the restriction of N to U: Let further s0 2 S
and let U0 WD 1.s0/: One has a continuous map
S ! Or; s 7! 0. N1.s/ \ d/ n 1 ;
where 0 denotes the projection of X onto P1: This map induces a homomorphism
of fundamental groups  W 1.S; s0/ ! Ar: Similarly, the map
U ! Or;1; .u; s/ 7! .0. N1.s/ \ d/ n 1; 0.u// ;
gives rise to a homomorphism Q W 1.U; .u0; s0// ! Ar;1:
In [10] it is shown how to obtain a commuting diagram whose rows are split
exact sequences:
(5)

182
M. Dettweiler and M. Jöllenbeck
Let 	1 W 1.S; s0/ ! 1.U; .u0; s0// denote the splitting of the upper row coming
from the 1-section, and let 	2 W Ar ! Ar;1 be the splitting of the lower row induced
from the section D 2 Or;1 7! .D; 1/: Then
Q ı 	1 D 	2 ı 
(6)
(see loc. cit., Section 2.3 and Rem. 2.6).
2.3
Local Systems and Representations of Fundamental
Groups
Let X be a connected topological manifold. A local system of R-modules is a sheaf
V 2 ShR.X/ for which there exists an n 2 N such that V is locally isomorphic to Rn:
The number n is called the rank of V and is denoted by rk.V/: Let LSR.X/ denote the
category of local systems of R-modules on X: Any local system V 2 LSR.X/ gives
rise to its monodromy representation V W 1.X; x0/
!
GL.V/: (We always
let 1.X; x0/ act from the right on V:) Let RepR.1.X; x0// denote the category of
representations 1.X; x0/ ! GL.V/; where V ' Rn for some n 2 N: One has an
equivalence of categories: LSR.X/ Š RepR.1.X; x0// with V corresponding to V :
Let U0 WD A1 n u; u 2 Or; and ﬁx generators ˛1; : : : ; ˛rC1 of 1.U0; u0/ as in
Sect. 2.2. If V is a given local system on U0; then
V 2 LSR.U0/  ! V 2 RepR.1.U0; u0//
 ! TV WD .T1 WD V.˛1/; : : : ; TrC1 WD V.˛rC1//
2 GL.V/rC1; T1    TrC1 D 1 :
We call TV the monodromy tuple of V: The equivalence class of Ti under GL-
conjugation is called local monodromy at xi:
2.4
Cohomology of Local Systems on U0
The results of this section can be found in [10]. Let U0 D A1 n u be as in Sect. 2.2.
Let V0 2 LSR.U0/ and let
T WD TV0 D .T1; : : : ; TrC1/ 2 GL.V/rC1
denote its monodromy tuple. It is shown in [10] that the group H1.U0; V0/ is
isomorphic to HT=ET; where
HT WD f.v1; : : : ; vrC1/ 2 VrC1 j v1.T2    TrC1/Cv2.T3    TrC1/C  CvrC1 D 0g
(7)

Monodromy of the Multiplicative and the Additive Convolution
183
and
ET WD f.v.T1  1/; : : : ; v.TrC1  1// j v 2 Vg :
(8)
The isomorphism is given as the composition of the natural isomorphism
H1.U0; V0/ ! H1.1.U0; x0/; V/
with the evaluation map, which associates to the equivalence class of a crossed
homomorphism Œı 2 H1.1.U0; x0/; V/ the corresponding equivalence class of
Œ.ı.˛1/; : : : ; ı.˛rC1// in VrC1=ET:
Let j W U0 ! P1 be the natural inclusion. It is shown in loc. cit. that the parabolic
cohomology group H1
p.U0; V0/ WD H1.P1; j.V0// is isomorphic to UT=ET; where
UT WD f.v1; : : : ; vrC1/ 2 HT j vi 2 im.Ti  1/; i D 1; : : : ; r C 1g :
(9)
Here, the additional relations arise from the natural isomorphism
H1
p.U0; V0/ ' im

H1
c.U0; V0/ ! H1.U0; V0/

:
(10)
2.5
Variation of Parabolic Cohomology
Recall the basic setting of [10]: Let S be a smooth connected complex manifold, let
X WD P1
S D P1  S; and let d  X be a smooth relative divisor of degree r C 1
over S which contains the section f1g  S: Let U WD X n d; let j W U ! X be the
natural inclusion, let N W X ! S be the projection onto S, and let  W U ! S be the
restriction of N to U: Let further s0 2 S and let U0 WD 1.s0/:
A local system V 2 LSR.U/ is called a variation of V0 2 LSR.U0/ over S; if V0 D
VjU0: Under the isomorphism 1.U/ ' 1.U0/ Ì 1.S/ (cf. (5)), V corresponds to
 W 1.U/ ! GL.V/; ı 7! 0./  .ı/;
(11)
where 0 is the restriction of  to 1.U0/ and  is the restriction of  to 1.S/ 
1.U/: The parabolic cohomology of this variation is by deﬁnition the ﬁrst higher
direct image W WD R1 N. jV/: It is a local system on S whose stalk Ws0 is
canonically isomorphic to the parabolic cohomology group H1
p.U0; V0/ (see loc.
cit). Thus W corresponds to its monodromy representation
W W 1.S; s0/ ! GL.H1
p.U0; V0// Š GL.UT=ET/ ;
where T WD TV0 is the associated tuple of V0 and UT and ET are as in the last section.
We want to determine the representation W: For this, let ˇ1; : : : ; ˇr1 denote
the generators of Ar: Consider linear automorphisms ˚.T; ˇi/ of VrC1 which are

184
M. Dettweiler and M. Jöllenbeck
deﬁned as follows:
.v1; : : : ; vrC1/˚.T;ˇi/
D .v1; : : : ; vi1; viC1; viC1.1  T1
iC1TiTiC1/ C viTiC1
„
ƒ‚
…
.iC1/th entry
; viC2; : : : ; vrC1/ :
(12)
These automorphisms multiply by the following rule:
˚.T; ˇ/  ˚.Tˇ; ˇ0/ D ˚.T; ˇˇ0/ :
(13)
It is easy to see, that the spaces UT and ET under
˚.T; .//;
 2 1.S; s0/ ;
are mapped isomorphically to the spaces UT./; resp. ET./ (where ./ is as in
Sect. 2.2 and acts as in (3) on GL.VrC1/r). Let
N˚.T; .// W UT=ET ! UT./=ET./
be the isomorphism induced by ˚.T; .//:
For T 2 GL.V/rC1 as above and h 2 GL.V/ we similarly obtain a linear map
.T; h/ W HT ! HTh; .v1; : : : ; vrC1/ 7! .v1h; : : : ; vrC1h/;
descending to an isomorphism N.T; h/ W HT=ET
! HTh=ETh ; where Th arises
from T by elementwise conjugation by h:
Proposition 2.5.1
(i)
W./ D N˚.T; .// ı N.T; .//;
8 2 1.S; s0/ :
(ii) (Ogg-Shafarevich) Suppose that R D K is a ﬁeld and that the stabilizer V1.U0/
is trivial. Then
rk.W/ D dimK H1
p.U0; V0/ D .r  1/ dimK V 
rC1
X
iD1
dimK Ker.Ti  1/ ;
where T D .T1; : : : ; TrC1/ is the monodromy tuple of V0:
(iii) (Poincaré Duality) Let V ˝ V ! R be a non-degenerate symmetric (resp.
alternating) bilinear pairing of sheaves. Then the cup product deﬁnes a non-
degenerate alternating (resp. symmetric) bilinear pairing of sheaves W ˝
W ! R:

Monodromy of the Multiplicative and the Additive Convolution
185
Proof Claim (i) follows immediately from [10, Thm. 2.5] (using the above Dia-
gram (5) and (6)), (ii) is [10, Rem. 1.3]. See [11] for (iii).
ut
3
Multiplicative Convolution
3.1
Deﬁnition of the Multiplicative Convolution
For u WD f0; x1; : : : ; xpg 2 OpC1 and v WD f0; y1; : : : ; yqg 2 OqC1 deﬁne
u  v WD fxiyj j i D 1; : : : ; p; j D 1; : : : qg [ f0g:
We call u  v generic, if the cardinality of u  v is equal to pq C 1: Let U1 WD
A1 n u; U2 WD A1 n v and S WD A1 n u  v: Set
Qf.x; y/ WD xy
p
Y
iD1
.x  xi/
q
Y
j1
.y  yjx/
Y
i;j
.y  xiyj/;
let f.x; y/ denote the associated reduced polynomial, let Qw WD f.x; y/ 2 A2 j
f.x; y/ D 0g; and let U WD A2 n Qw:
We have the quotient map q W U ! U2; .x; y/ 7! y=x and the partial completion
j W U ! P1  S DW X; .x; y/ 7! .Œx; 1; y/: Deﬁne w WD X n U: Then we are in the

186
M. Dettweiler and M. Jöllenbeck
situation of Sect. 2.5 with r D p C q C 1 and  WD pr2 W U ! S; .x; y/ 7! y: Let
pr2 W X ! S be the second projection and for s0 2 S let U0 WD pr1.s0/ (note that
U0 can be identiﬁed with A1 n .u [ fs0=y1; : : : ; s0=yqg/ via the projection pr1 to the
x-coordinate.
Let Vi 2 LSR.Ui/ .i D 1; 2/ be irreducible and nonconstant. We further assume
that V1 has nontrivial local monodromy at at least two different points xi1; xi2 ¤
1: The multiplicative middle convolution (or middle Hadamard product) is then
deﬁned as a variation of parabolic cohomology groups
V1 ? V2 WD R1pr2. j.pr
1V1 ˝ qV2// 2 LS.S/:
In the following we assume that the coefﬁcient domain R is a ﬁeld K:
3.2
Monodromy of the Multiplicative Middle Convolution
Choose homotopy generators 0; : : : ; pCq of 1.U0; x0/ as in Sect. 2.2, where we
identify U0 with A1
xn.u[fs0=yq; : : : ; s0=y1g/ via pr1 (note that s0=yq < : : : < s0=y1).
Let .A0; A1; : : : ; Ap; A1/ 2 GL.V1/pC2 be the monodromy tuple of V1 (w.r. to the
pr1.i/ .i D 0; : : : ; p/ and let
B1 WD V2.q.0//; Bq WD V2.q.pC1//; : : : ; B1 WD V2.q.pCq//
and B0 WD .B0    Bq/1: Since the map qjU0 is given by x 7! s0=x; it inter-
changes 0 and 1 and maps pC1; : : : pCq to simple closed loops approaching
yq D q.s0=yq/; : : : ; y1 (in this order) using a path in the lower half plane. Let
˛0; : : : ; ˛q; ˛1 be a standard generating system of 1.A1 nfy1; : : : ; yqg; y0 D s0=x0/
as in Sect. 2.2, where ˛i approaches yi inside the upper half plane, before encircling
it. Then the following holds:
q.pC1/ D ˛q;
q.pC2/ D ˛
˛q
q1; : : : ;
q.pCq/ D ˛
˛2			˛q
1
;
q.0/ D ˛1
and
q.1/ D ˛
˛1			˛q
0
:
Let .C0; : : : ; CqC1 D C1/ 2 GL.V2/ is the monodromy tuple w.r. to ˛0; : : : ; ˛1:
Then we can express the Bi’s in terms of the Ci’s as follows:
B1 D C1; B1 D C
C2			Cq
1
; B2 D C
C3			Cq
2
; : : : ; Bq D Cq; B0 D C
C1			Cq
0
:
(14)

Monodromy of the Multiplicative and the Additive Convolution
187
Then the monodromy tuple of pr
1V2 ˝ qV2/jU0 with respect to .0; : : : ; pCq; 1/
is as follows:
.A0 ˝ B1; A1 ˝ 1V2; : : : ; Ap ˝ 1V2; 1V1 ˝ Bq; : : : ; 1V1 ˝ B1; A1 ˝ B0/:
(15)
Therefore Proposition 2.5.1 (ii) implies the following (cf. Proposition 2.1.1 for the
computation of expressions like dim.ker.A0 ˝ C1  1V1˝V2//):
Proposition 3.2.1
rk.V1 ? V2/ D .p C q/rk.V1/rk.V2/  rk.V2/
p
X
iD1
dim ker.Ai  1V1/
rk.V1/
q
X
jD1
dim ker.Cj  1V2/
 dim ker.A0 ˝ C1  1V1˝V2/  dim ker.A1 ˝ C0  1V1˝V2/:
ut
In the following we assume that u  v is generic. Using a suitable deformation
argument involving a marking (cf. Schoenﬂies’ theorem) we can assume that the
elements in u  v are real-valued and that
0 < x1y1 < : : : < xpy1 < : : : < x1yq < : : : < xpyq < s0 :
Choose a homotopy base of 1.S; s0/ as follows:
For u D f0; x1; : : : ; xpg and v D f0; y1; : : : ; yqg as above deﬁne x0 WD 0 and
xpC1 WD s0=yq; : : : ; xpCq WD s0=y1; so that U0 is identiﬁed with A1 n fx0; : : : ; xpCqg
via the ﬁrst projection. Consider the braid group
ApCqC1 WD 1.OpCqC1; fx0; : : : ; xpCqg/ D hˇ0; : : : ˇpCq1i;

188
M. Dettweiler and M. Jöllenbeck
where the ˇi’s are similar as in Sect. 2.2, i.e., the braid ˇi ﬁxes all elements
fx0; : : : ; xpCqg n fxi; xiC1g and interchanges xi; xiC1 using a counterclockwise rota-
tion.
Proposition 3.2.2 Let  W 1.S; s0/ ! ApCqC1 be as in Sect. 2.2. Then the
following holds:
(i)
.ı.q1/pCi/ D ˇi;pC1;
i D 1; : : : ; p;
and
.ı.j1/pCi/ D ˇ
ˇpC1			ˇpCqj
i;pC1
;
i D 1; : : : ; p; j D 1; : : : ; q  1;
where ˇk;l WD .ˇ2
k/ˇ1
kC1			ˇ1
l1;
for
1  k < l  p C q C 1:
(ii) For ı0 as above
.ı0/ D

ˇ2
0  .ˇ1ˇ2
0ˇ1/  .ˇ2ˇ1ˇ2
0ˇ1ˇ2/   .ˇq1    ˇ1ˇ2
0ˇ1    ˇq1/
ˇ1
;
where
ˇ WD .ˇp    ˇ1/.ˇpC1    ˇ2/    .ˇpCq    ˇqC1/:
Proof As explained in [3, Section 1], the expression of the various .ıj/’s depends
on the intersection-data of w; cf. [2]. Here, crossing an exceptional value which
involves just one simple crossing amounts to conjugation by the inverse of a ˇk (if
the kth and the k C 1th line meet when ordered locally by their real values). Turning
around an intersection point which involves just one simple crossing amounts to a
ˇ2
k. This leads to the expression of ıi for i ¤ 0 in a straightforward manner. (Let us
indicate a direct method to obtain the expression of .ı. j1/pCi/ in terms of the ˇi’s.
It is immediate from the structure of w (cf. to the image in Sect. 3) that .ı.j1/pCi/ is
of the following form: The points x0; : : : ; xp are ﬁxed whereas xpC1; : : : ; xpCq move
in the upper half plane to the real axis with xj moving counterclockwise around xi
and the other points of the set fxpC1; : : : ; xpCqg moving around a closed disc, i.e.,
none of the points x0; : : : ; xp. This braid is then homotopic to a braid which ﬁxes all
points fx0; : : : ; xpCqg n xj with xj crossing the points xpC1; : : : ; xj1 in the lower half
plane, then crossing the real axis, then crossing the points xiC1; : : : ; xp in the upper
half plane before encircling xi and moving the same way back. The expression of
the braid is then visibly ˇ
ˇpC1			ˇpCqj
i;pC1
, cf. [16, Section III.1.2].)

Monodromy of the Multiplicative and the Additive Convolution
189
For ı0 we argue as follows: First we write ı0 as a product Qı0 QQı0 Qı1
0
as follows:
Then, viewing  as a homomorphism of fundamental groupoids, the braid .QQı0/
is as follows:
Since the paths

yq
e2it;

yq1
e2it;
: : :
;

y1
e2it
occurring in the above expression of .QQı0/ are pairwise disjoint, they commute.
They contribute a factor of .QQı0/ as follows (in the same ordering):
ˇ2
0;
ˇ1ˇ2
0ˇ1;
: : :
;
ˇq1    ˇ1ˇ2
0ˇ1    ˇq1;
cf. [16, Figure 1.4 in Section III.1.2]. Here we have identiﬁed the initial base point
P1 WD fx0; : : : ; xpCqg of OpCqC1 with
P0 WD f0; 
yq
; : : : ; 
y1
; x1; : : : ; xpg
by inserting a null-homotopic path P1
t
 Pt in between .Qı0/ and .QQı0/ with
Pt WD f0; .1  t/ 
yq
C tx1; : : : ; .1  t/xp C txpCqg:

190
M. Dettweiler and M. Jöllenbeck
Finally, by a similar argument as above, involving the intersection data of w; one
sees that the formal conjugation by .Qı0/1 amounts to conjugation with ˇ1:
ut
Proposition 3.2.3 Let  W 1.S; s0/ ! GL.V1 ˝ V2/ denote the homomorphism
from Eq. (11) in the situation of the multiplicative convolution. Then .ı0/ D 1V1 ˝
B0 and .ık/ D 1 for k D 1; : : : ; pq:
Proof The local system pr
1V1 clearly has no monodromy in pr2-direction as well
as the local system qV2; away from 0: By construction of qV2 one has .ı0/ D
1V1 ˝ B0:
ut
Summarizing, we obtain:
Theorem 3.2.4 Let V1; V2 and
g WD .A0 ˝B1; A1 ˝1V2; : : : ; Ap ˝1V2; 1V1 ˝Bq; : : : ; 1V1 ˝B1; A1 ˝B0/ 2 GL.V1 ˝V2/
be as above. Let
V1?V2 W 1.S; s0/ D hı0; : : : ; ıpqi ! GL.Hg=Eg/
be the monodromy representation of the multiplicative middle convolution V1 ? V2:
Then
V1?V2.ıi/ D N˚.g; .ıi//  N.g; .ıi//
i D 0; : : : ; pq;
where N˚; N are as in Sect. 2.5 and where .ıi/; .ıi/ are as in Propositions 3.2.2
and 3.2.3.
Remark 3.2.5 In the non-generic case, we can assume (again using a suitable
deformation argument involving Schoenﬂies’ theorem) that consecutive real-valued
exceptional values sk < skC1 < : : : < skCd 2 Qu  Qv of a small deformation QV1 ? QV2 of
V1 ? V2 collapse to a single exceptional value sk 2 u  v: Then
 QV1? QV2.ık/    QV1? QV2.ıkCd/ D V1?V2.ık/
4
Additive Convolution
4.1
The Deﬁnition of the Additive Middle Convolution
For u WD fx1; : : : ; xpg 2 Op and v WD .y1; : : : ; yqg 2 Oq set
u  v WD fxi C yj j i D 1; : : : ; p; j D 1; : : : ; qg :

Monodromy of the Multiplicative and the Additive Convolution
191
Let U1 WD A1 n u; U2 WD A1 n v and S WD A1 n u  v: Set
Qf .x; y/ WD
p
Y
iD1
.x  xi/
q
Y
jD1
.y  x  yj/
Y
i;j
.y  .xi C yj//
and let f 2 CŒx; y be the associated reduced polynomial. One has Qf D f if and only
if ju  vj D i  j; in which case we call u  v generic. Let
Qw WD f.x; y/ 2 A2 j f.x; y/ D 0g
and let U WD A2 n Qw: The set U is equipped with three maps:
pr1 W U ! U1;
.x; y/ 7! x;
pr2 W U ! S;
.x; y/ 7! y ;
and the subtraction map
d W U ! U2;
.x; y/ 7! y  x :
x
x
x
y
y
1
2
p
x1
x + y
+ y
1
x
y
pr
pr
2
1
1
q
x p+y
q
q
1
d
Let
j W U ! X WD P1
S;
.x; y/ 7! .Œx; 1; y/
and let w WD X n U: Since w is a smooth relative divisor over S; we are in the
situation of Sect. 2.5 with r  p C q and  D pr2: The second projection P1
S ! S is
denoted by pr2: The ﬁbre pr1
2 .y0/ is denoted by U0: The ﬁrst projection yields an

192
M. Dettweiler and M. Jöllenbeck
identiﬁcation of U0 with A1 n .u [ .y0  v//; where
u [ .y0  v/ WD u [ fy0  y1; : : : ; y0  yqg 2 OpCq :
Let Vi 2 LSR.Ui/ .i D 1; 2/ be irreducible and nonconstant. We further assume
that V1 has nontrivial local monodromy at at least two different points xi1; xi2 ¤ 1:
The local system V1  V2 WD pr
1V1 ˝ dV2 is a local system on U which is a
variation of V1  V2jU0 over S: The additive middle convolution of V1 2 LSR.U1/
and V2 2 LSR.U2/ is the local system
V1  V2 WD R1.pr2/. j.V1  V2// 2 LSR.S/ :
Remark 4.1.1
(i) In [15], Katz gives a similar construction in a more general category of
complexes of sheaves, which is (under [15, Prop. 2.8.4], and our assumptions on
V1 and V2) equivalent to our construction. Explicit matrices for the monodromy
in this case are given in [4].
(ii) An important case of the middle convolution is Katz’ middle convolution
functor MC; see [15]: Let  be a character of 1.Gm/; Gm D A1 n f0g; and let
V 2 LSR.Gm/ be the associated local system. We call V the Kummer sheaf
associated to : Then one obtains a functor
LSR.U1/ ! LSR.U1/; V 7! MC.V/ WD V  V :
4.2
Monodromy of the Additive Middle Convolution
Let in this section R D K be a ﬁeld. Throughout this section we assume that Vi 2
LSR.Ui/ .i D 1; 2/ is irreducible and nonconstant, where U1 D A1 n u and U2 D
A1 n v such that u  v is generic. We further assume that V1 has nontrivial local
monodromy at at least two different points xi1; xi2 ¤ 1: Let us ﬁx a basepoint
.x0; y0/ in U: This induces basepoints x0 D pr1.x0; y0/; y0  x0 D d.x0; y0/; y0 D
pr2.x0; y0/ of U1; U2 and S D A1 n u  v: Let V1 denote the stalk of V1 at x0 and let
V2 denote the stalk of V2 at y0  x0: Let also
U0 D pr1
2 .y0/ D A1 n u [ .y0  v/
be as in the last section.
The representation V1V2jU0 W 1.U0; .x0; y0// ! GL.V1 ˝ V2/ factors as
V1V2jU0 D .V1 ˝ V2/ ı .pr1  d/ ;
(16)

Monodromy of the Multiplicative and the Additive Convolution
193
where
.pr1  d/ W 1.U0; .x0; y0// ! 1.U1; x0/  1.U2; y0  x0/
is the map which is induced by pr1jU0  djU0: Let ˛1; : : : ; ˛pCqC1 be generators of
1.U0; .x0; y0// which are chosen as in the ﬁgure below. Let
.1 WD pr1.˛1/ ; : : : ; p WD pr1.˛p//
be the induced generators of 1.U1; x0/ and let
.
1 WD d.˛pC1/ ; : : : ; 
q WD d.˛pCq//
be those of 1.U2; y0  x0/: With respect to these generators, let
TV1 D .A1; : : : ; ApC1/ 2 GL.V1/pC1
and
TV2 D .B1; : : : ; BqC1/ 2 GL.V2/qC1
be the associated tuples. It follows from our choice of homotopy generators and (16)
that
TV1V2jU0 D .C1 WD A1 ˝ 1V2 ; : : : ; Cp WD Ap ˝ 1V2 ;
CpC1 WD 1V1 ˝ B1 ; : : : ; CpCq WD 1V1 ˝ Bq ; ApC1 ˝ BqC1/ :
(17)
Proposition 4.2.1 Let dimK Vi D ni: Then
rk.V1  V2/ D .p C q  1/n1n2 
p
X
iD1
n2 dimK ker.Ai  1V1/

q
X
jD1
n1 dimK ker.Bj  1V2/  dimK ker.ApC1 ˝ BqC1  1V1˝V2/ :
(18)
Proof It follows from (17) and the properties of the tensor product that
dimK ker.Ci  1V1˝V2/ D n2 dimK ker.Ai  1V1/; i D 1; : : : p
and
dimK ker.Ci  1V1˝V2/ D n1 dimK ker.Bi  1V2/; i D p C 1; : : : p C q :
The claim follows now from Proposition 2.5.1 (ii).
ut
Remark 4.2.2 The dimension dimK ker.ApC1 ˝ BqC1  1V1˝V2/ can be easily
computed using Lemma 2.1.1.

194
M. Dettweiler and M. Jöllenbeck
We want to describe the monodromy of V1  V2: We can assume (using a
suitable marking as in [10]) that we are in the following situation: The sets u D
fx1; : : : ; xpg; v D fy1; : : : ; yqg; fy0g are elementwise real and one has
x1 < x2 < : : : < xp < y0  y1 < y0  y2 < : : : < y0  yq :
Moreover, we can assume that
jxp  x1j < jyiC1  yij
for
i D 1; : : : ; q  1:
(19)
Let us ﬁx a basepoint .x0; y0/ of U0 and of U: We assume that the imaginary part of
x0 to is large enough, i.e., larger than the maximal imaginary part of ıi;j.t/; where
ıi;j is as shown below. One obtains basepoints
x0 D pr1.x0; y0/;
y0  x0 D d.y0; x0/;
y0 D pr2.x0; y0/
on
U1; U2
and
S
(respectively). We
choose
generators
˛1; : : : ; ˛pCq
of
1.U0; .x0; y0// as follows:
x
x
x
y
y
y
0
0
0
1
2
p
−
−
−
y
y
y
1
2
q
x0
α
α
α
1
2
p
p+1
α
p+2
α
p+q
α
Next we choose generators ˇ1; : : : ; ˇpCq1 of
ApCq D 1.OpCq; u [ fy0  y1; : : : ; y0  yqg/
as follows:
x
y
y
y
0
0
0
p
−
−
−
y
y
y
1
2
y0−y
p+q−1
p+q
x1
x2
βp
βp+1
βp+q−1
β1
βp−1

Monodromy of the Multiplicative and the Additive Convolution
195
Then we choose generators ıi;j; i D 1; : : : ; p; j D 1; : : : ; q of 1.S; y0/ as
follows:
x1+yq x2+yq
xp+yq
x1+y1 x2+y1
xp+y1
y0
1,q
δ
2,q
δ
δp,q
1,1
δ
Proposition 4.2.3 Let
 W 1.S; y0/ ! ApCq D 1.OpCq; u [ .y0  v//
be as in Sect. 2.2. Then
.ıi;1/ D ˇi;pC1; i D 1; : : : ; p ;
(20)
and
.ıi;j/ D ˇ
ˇpC1			ˇpCj1
i;pC1
; i D 1; : : : ; p; j D 2; : : : ; q ;
(21)
where
ˇi;j D .ˇ2
i /ˇ1
iC1			ˇ1
j1 :
Proof Using (19) and the methods of [3] involving the intersection behaviour of w;
it is easy to see that
.ıi;1/ D ˇi;pC1
and
.ıi;j/ D .ˇiCj1;pCj/.ˇ1
j1			 ˇ1
pCj2/ 			 .ˇ1
2
			ˇ1
pC1/ .ˇ1
1
			ˇ1
p
/ ;
j D 2; : : : ; q :
Using a suitable homotopy argument in OpCq (deform the paths with initial points
y0  y1; : : : ; y0  ypCj1 to paths with constant real part and large enough imaginary
part), one can see that for j  2 these braids coincide with ˇ
ˇpC1			ˇpCj1
i;pC1
:
ut

196
M. Dettweiler and M. Jöllenbeck
Using the choice of our setup, one obtains a diagram
(22)
such that the rows are split exact sequences and such that the vertical arrows are
compatible with the splittings of the rows (see (6)).
Proposition 4.2.4 The monodromy of V1  V2 is given by
V1V2./ D N˚.TV1V2jU0 ; .//
8 2 1.S; y0/ ;
where TV1V2jU0 D .C1; : : : ; CpCqC1/ is as in (17) and N˚ is as in Sect.2.5.
Proof By the properties of the tensor product, the commutators
ŒCi D Ai ˝ 1V2; CpCj D 1V1 ˝ Bj;
i D 1; : : : ; p; j D 1; : : : ; q ;
vanish. It follows from the construction of V1  V2 D pr
1 ˝ dV2 that
V1V2j1.S;y0/ D  D 1 :
By the above discussion, Eq. (6) can be assumed to hold for (22). Thus, Proposi-
tion 2.5.1 gives the claim.
ut
Remark 4.2.5 In the non-generic case, a deformation argument shows that one
obtains the associated tuple TV1V2 from the generic case, by multiplying the
monodromy generators of the generic case suitably: We can assume (again using
a suitable deformation argument involving Schoenﬂies’ theorem) that consecutive
real-valued exceptional values sk < skC1 < : : : < skCd 2 Qu  Qv of a small
deformation QV1  QV2 of V1  V2 collapse to a single exceptional value sk 2 u  v:
Then
 QV1 QV2.ık/     QV1 QV2.ıkCd/ D V1V2.ık/
Acknowledgements The authors thank the referee for valuable comments. Michael Dettweiler
gratefully acknowledges ﬁnancial support within the DFG-Schwerpunkt SPP 1489.

Monodromy of the Multiplicative and the Additive Convolution
197
References
1. J.S. Birman, Braids, Links and Mapping Class Groups. Annals of Mathematics Studies, vol.
82 (Princeton University Press, Princeton, 1974)
2. D. Cohen, A. Suciu,
The braid monodromy of plane algebraic curves and hyperplane
arrangements. Comment. Math. Helvetici 72, 285–315 (1997)
3. M. Dettweiler, Plane curve complements and curves on Hurwitz spaces. J. Reine Angew.
Math. 573, 19–43 (2004)
4. M. Dettweiler, S. Reiter, Middle convolution of Fuchsian systems and the construction of rigid
differential systems. J. Algebra 318, 1–24 (2007)
5. M. Dettweiler, S. Reiter, Rigid local systems and motives of type G2. Compos. Math. 146,
929–963 (2010)
6. M. Dettweiler, S. Reiter, The classiﬁcation of orthogonally rigid G2-local systems and related
differential operators. Trans. Am. Math. Soc. 366, 5821–5851 (2014)
7. M. Dettweiler, S. Reiter, On the Hodge theory of the additive and the multiplicative convolution
(in preparation, 2017)
8. M. Dettweiler, C. Sabbah, Hodge theory of the middle convolution. Publ. Math. RIMS 49,
761–800 (2013)
9. M. Dettweiler, J. Schmidt, Rigid G2-representations and motives of type G2. Isr. J. Math. 212,
81–106 (2016)
10. M. Dettweiler, S. Wewers, Variation of local systems and parabolic cohomology. Isr. J. Math.
156, 157–185 (2006)
11. M. Dettweiler, S. Wewers, Variation of parabolic cohomology and Poincare duality, in Groupes
de Galois Arithmetiques et Differentiels, ed. by D. Bertrand, P. Debes, Seminaires et Congres,
vol. 13 (Société Mathématique de France, Paris, 2006), pp. 145–164
12. E. Fuchs, C. Meiri, P. Sarnak, Hyperbolic monodromy groups for the hypergeometric equation
and Cartan involutions. J. Eur. Math. Soc. 16, 1617–1671 (2014)
13. K. Jakob, The classiﬁcation of rigid irregular G2-connections (2016). arXiv:1609.03292
14. M. Jöllenbeck, VarParCohom.m. Available at http://zahlentheorie.uni-bayreuth.de
15. N.M. Katz,
Rigid Local Systems.
Annals of Mathematics Studies, vol. 139 (Princeton
University Press, Princeton, 1996)
16. G. Malle, B.H. Matzat, Inverse Galois Theory. Monographs in Mathematics (Springer, Berlin,
1999)
17. A.L. Onishchik, E.B. Vinberg, Lie Groups and Algebraic Groups (Springer, Berlin, 1990)
18. L. Schwartz,
Mathematische Methoden der Physik (Bibliographisches Institut, Mannheim,
1974)

Constructing Groups of ‘Small’ Order:
Recent Results and Open Problems
Bettina Eick, Max Horn, and Alexander Hulpke
Abstract We investigate the state of the art in the computational determination and
enumeration of the groups of small order. This includes a survey of the available
algorithms and a discussion of their recent improvements. We then show how these
algorithms can be used to determine or enumerate the groups of order at most
20;000 with few exceptions and we discuss the orders in this range which remain as
challenging open problems.
Keywords Enumeration • Determination • Small groups • Algorithms
Subject Classiﬁcations 20D45, 20E22, 20-04
1
Introduction
The determination of the groups of a given order n up to isomorphism is one of the
central problems in ﬁnite group theory. The aim is to determine a list Ln of groups of
order n so that every group of order n is isomorphic to exactly one group in the list
Ln. A slightly weaker but also interesting goal is to enumerate the isomorphism
types of groups of a given order. The aim is to determine the cardinality jLnj,
possibly without explicitly listing all groups in Ln. There are asymptotic estimates
B. Eick ()
TU Braunschweig, Pockelsstraße 14, 38106 Braunschweig, Germany
e-mail: beick@tu-bs.de; b.eick@tu-braunschweig.de
M. Horn
Justus-Liebig-Universität Gießen, Arndtstraße 2, 35392 Gießen, Germany
e-mail: max.horn@math.uni-giessen.de
A. Hulpke
Colorado State University, Fort Collins, CO 80523-1874, USA
e-mail: hulpke@colostate.edu
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_8
199

200
B. Eick et al.
known for jLnj, see Pyber [23] for a survey, but no closed formula for jLnj is
known. See also [11] for a discussion of properties of jLnj as a function in n.
The history of this group construction or enumeration problem goes back to the
beginnings of abstract group theory: Cayley [10] introduced the abstract deﬁnition
of groups and determined the groups of order at most 6. Many other group
constructions and enumerations followed the work of Cayley. We refer to Besche
et al. [6] for a history of group constructions and to Blackburn et al. [8] for details
on enumerations of groups.
Senior and Lunn [25, 26] determined all groups of order at most 200 except 128
and 192. It is quite remarkable that they did this by hand and got it right! A natural
question is: why did they omit 128 and 192? Nowadays it is known that these two
orders yield by far the most groups in the range of orders at most 200: using the
SmallGroups library [7] one observes that there are 2328 groups of order 128 and
1543 of order 192, while the maximum is 267 for every other order at most 200.
There are 6065 groups of order at most 200 in total.
Why are there many groups for some orders and very few for others? For
example, the SmallGroups library [7] asserts that there are 49;487;365;422 groups
of order 1024 and only 4 groups of order 1025. The asymptotic results on jLnj
as reported in [23] as well as the known values for jLnj in the SmallGroups library
suggest that the largest multiplicity of a prime dividing an order n plays a major role;
that is, if n D pe1
1    perr for different primes p1; : : : ; pr, then e D maxfe1; : : : ; erg
has a major impact on the number of groups of order n. Note that 1024 D 210, while
1025 D 52  41.
Besche et al. [5, 6] determined the groups of order at most 2000 except 1024
and Eick and O’Brien [13] enumerated the groups of order 1024. The results are
available in the SmallGroups library [7]. This group determination and enumeration
was obtained with the massive help of computers and methods from computational
group theory. The use of computers is essential due to the large numbers of groups.
For example, there are eight orders in the range of orders at most 2000 with more
than 100;000 groups.
Since then, computer technology and also the methods from computational group
theory have improved signiﬁcantly. For example, a new isomorphism test and
automorphism group algorithm has been developed by Cannon and Holt [9] and
a new method to construct ﬁnite solvable groups has been introduced by Eick and
Horn [12]. Further, many of the methods in the computer algebra system GAP [29]
have been improved; in particular, the machinery to construct subdirect products has
been signiﬁcantly updated by the third author. The combination of these advances
permits us to extend signiﬁcantly the range of orders n for which Ln or at least jLnj
is computable.
It is the aim of this paper to report on the available group construction and
enumeration methods in GAP [29] and its packages and their application to the
determination or enumeration of groups of order at most 20;000. There are currently
39 orders in the range at most 20;000 for which the number of groups of these
orders are unknown. We list these orders and discuss the difﬁculty that they impose

Constructing Groups of ‘Small’ Order: Recent Results and Open Problems
201
on the group construction and enumeration methods. Thus we highlight the most
challenging problems in the enumeration of ﬁnite groups of small orders.
The known numbers of groups jLnj for 1  n  20;000 can be obtained at a
web-page prepared by the second author:
http://groups.quendi.de.
Among these orders with known numbers, there are 56 orders with more than
one million groups. For example, each of the orders of the form 29 p with p a prime
yields more than 400 million groups. And the order 210 yields more than one billion
groups.
2
Algorithms to Construct Finite Groups
In this section we give a brief overview of the available methods to construct ﬁnite
groups. These methods fall into three different categories: methods to construct
nilpotent groups, methods to construct solvable (non-nilpotent) groups and methods
to construct non-solvable groups.
2.1
Construction of Nilpotent Groups
A ﬁnite nilpotent group is a direct product of its Sylow subgroups. Hence the
construction of nilpotent groups directly translates to the construction of p-groups.
For this purpose there is a well-established method available: the p-group generation
method of O’Brien [21]. The basic approach of this method is to use induction along
the lower exponent-p central series. An implementation of this method is available
in the GAP package [20].
2.2
Construction of Solvable (Non-nilpotent) Groups
2.2.1
The Frattini Extension Method
The Frattini extension method by Besche and Eick [2] is a widely used method for
the construction of ﬁnite solvable groups. Recall that the Frattini subgroup ˚.G/
of a ﬁnite group G is the intersection of all maximal subgroups of G. The basic
approach of this method is to determine up to isomorphism a list of candidates
for the Frattini factors of the groups of order n and then, for each candidate F,
determine up to isomorphism all groups G of order n with G=˚.G/ Š F. The ﬁrst
step of this approach is usually comparatively fast and yields a comparatively short
list of groups. It relies heavily on an effective determination of subdirect products.
The second step is often more involved and requires the reduction of a given list of

202
B. Eick et al.
groups to isomorphism type representatives. A ﬁrst reduction can often be achieved
by using the highly effective random isomorphism test of [2]. A ﬁnal reduction is
then obtained by general isomorphism testing methods such as those described in [9,
27]. The Frattini extension method allows us readily to restrict to the construction of
non-nilpotent groups or those with certain normal or non-normal Sylow subgroups.
An implementation of this method is available in the GAP package [3].
2.2.2
Solvable Group Construction
Eick and Horn [12] present an alternative method to construct the solvable groups
of a given order. This is a direct generalisation of the p-group generation method.
It is often slower than the Frattini extension method, but in some cases it was
able to determine the groups of a given order where the Frattini extension method
failed. Further, it is very useful in verifying the results of the Frattini extension
method. Also this method restricts readily to construct non-nilpotent groups only.
An implementation of this method in GAP exists and will be made available as a
GAP package [17].
2.3
Construction of Non-solvable Groups
2.3.1
The Cyclic Extensions Method
Besche and Eick [2] outlined a rather crude approach towards constructing non-
solvable groups. It starts from the library of perfect groups [16]; we refer to the work
by Holt and Plesken [16] for this. It then iteratively constructs cyclic extensions of
groups. The extensions obtained then must be reduced to isomorphism types. This
requires an effective isomorphism test for non-solvable groups. Nowadays we use
the method by Cannon and Holt [9] for this purpose whose implementation in GAP
will be made available as part of GAP 4.9.
2.3.2
Archer’s Methods: Supplements and Z
Archer [1] described two effective methods to construct the non-solvable groups
of a given order n. Both approaches require that the perfect groups of all orders m
dividing n are determined up to isomorphism; see [16].
The supplement method additionally requires that the solvable groups of order
n=m are classiﬁed. For a given perfect group H of order m and a given solvable
group G of order n=m, it determines up to isomorphism all groups E having a normal
subgroup M E E with M Š H and E=M Š G.
The Z method additionally requires that all solvable groups of the orders kn=m
are known, where k ranges over the sizes of the centers of the perfect groups of

Constructing Groups of ‘Small’ Order: Recent Results and Open Problems
203
order m. For a given perfect group H of order m with center Z D Z.H/ of order k,
it considers all solvable groups G of order kn=m extending Z and it determines up
to isomorphism all groups E having a normal subgroup M E E with M Š H and
E=M Š G=Z. Note that the Z method does not apply in all cases on H; we refer
to [1, p. 75] for details. Note also that [1, Section 5.1] contains a limited version
of the Z method. This applies only if jZ.H/j  2 and, if jZ.H/j D 2, then if
gcd.jOut.H/j; jGj/  2. While this is a signiﬁcant restriction, it still applies to
many of the cases that we need to consider.
Archer neither published the results of his enumeration, nor his implementations
of the algorithms. We have implemented in GAP the limited version of the Z
method. This does not apply to all cases, but it allows readily to be combined
with the cyclic extension method. We are using this combination as an alternative
approach to construct non-solvable groups. If the limited Z method applies, then it
is usually more effective than the cyclic extension method. Our implementation of
the limited Z method will be made available as a package for GAP.
As part of the applications of our implementation, we recomputed and extended
the table on p. 64 in [1]. We noted that the rows for jSj 2 f128; 256g in this table
were incorrect. The correct values, as well as the additional value for jSj D 384, are
as follows:
jSj
grps
OK
OZ
OZ;K
128
2328
16;996
8308
72;010
256
56;092
1;027;380
337;956
6;856;498
384
20;169
206;463
82;035
938;587
3
A Symbolic Enumeration Algorithm
Suppose that m 2 N is given and that the groups of order m are available; that is, Lm
is known. In this section we describe an effective algorithm to enumerate the groups
of order m  p for all primes p coprime to m. Our approach is based on a theorem by
Taunt [28] and it extends the cyclic split extension method described in [2] and the
ideas in [4].
For a group G of order m and l j m let Ol denote a set of representatives of the
Aut.G/-classes of normal subgroups K in G with G=K cyclic of order l. For K 2
Ol let AutK.G/ denote the stabilizer of K in Aut.G/, let AutK.G/ be the subgroup
of Aut.G=K/ induced by the natural action of AutK.G/ on G=K and let indK WD
ŒAut.G=K/ W AutK.G/.
Let .d1; : : : ; dk/ be the list of all divisors of m, with d1 D 1. We set
w.G/ WD .wd1.G/; : : : ; wdk.G//;
where
wdi.G/ WD
X
K2Odi
indK

204
B. Eick et al.
and we denote
w.m/ WD .wd1.m/; : : : ; wdk.m//;
where
wdi.m/ WD
X
G2Lm
wdi.G/:
Theorem 3.1 Let m 2 N and  the set of those prime divisors of .d21/    .dk1/
that do not divide m.
a) Let p be a prime with p −m. If there exists a group of order mp without normal
Sylow p-subgroup, then p 2 .
b) Let p be a prime with p −m. The number of isomorphism types of groups of order
m  p having a normal Sylow p-subgroup is
X
i2f1;:::;kg
with dij. p1/
wdi.m/:
Proof
a) By Sylow’s theorems the number of Sylow p-subgroups in a group of order mp
is congruent to 1 modulo p and it divides m. Thus if there exists a group of order
mp without normal Sylow p-subgroup, then p j .di  1/ for some i 2 f2; : : : ; kg.
b) Suppose that H is group of order mp with normal Sylow p-subgroup. By the
Schur-Zassenhaus theorem, H Š Cp Ì' G for a group G of order m and some
homomorphism ' W G ! Aut.Cp/ Š Cp1. Taunt [28] proved that two split
extensions Cp Ì'1 G and Cp Ì'2 G are isomorphic if and only if there exist ˛ 2
Aut.G/ and ˇ 2 Aut.Cp/ so that '1.˛.g// D ˇ1'2.g/ˇ in Aut.Cp/ for each
g 2 G. As Aut.Cp/ is abelian, this reduces to '1.˛.g// D '2.g/ for all g 2 G and
thus is independent of ˇ. Based on this, one can readily observe that the different
isomorphism types of split extensions CpÌ' G with K D ker.'/ correspond one-
to-one to the elements of a transversal of AutK.G/ in Aut.G=K/ and this yields
the desired result.
Theorem 3.1 translates to an effective method to enumerate the groups of order
mp for ﬁxed m and arbitrary prime p −m:
(1) Let D D .d1; : : : ; dk/ be the list of divisors of m, with d1 D 1.
(2) For all groups G in Lm determine w.G/ with respect to D.
(3) Using the values in (2), determine wd1.m/; : : : ; wdk.m/.
(4) Determine the (ﬁnite) set  of those prime divisors of .d2  1/    .dk  1/ that
do not divide m.
(5) For each p 2  determine the number ap of groups of order mp without normal
Sylow p-subgroups (for example, using the Frattini extension method and the
construction of non-solvable groups).
(6) Deﬁne ap D 0 if p 62 .

Constructing Groups of ‘Small’ Order: Recent Results and Open Problems
205
(7) Given an arbitrary prime p with p −m, it now follows that
jLmpj D ap C
X
i2f1;:::;kg
with dij. p1/
wdi.m/:
Note that this method can be adapted readily to count solvable and non-solvable
groups separately and we use this frequently in applications.
4
Recent Improvements to Implementations in GAP
Many of the above algorithms rely on effective methods to determine automorphism
groups and to decide isomorphism. Here we exhibit various improvements to the
existing methods for these purposes. We discuss automorphisms and isomorphisms
in the following two subsections and we note that all exhibited improvements will
be made public with GAP 4.9.
4.1
Automorphism Groups
There are various methods known to determine automorphism groups. For ﬁnite
p-groups we use the method by Eick et al. [15] as implemented in the GAP package
[14], for ﬁnite solvable groups we use the method by Smith [27], and for ﬁnite
non-solvable groups we use the method by Cannon and Holt [9]. Smith’s method is
implemented in the GAP library. This implementation has recently been improved
by the third author and it has been combined with an implementation of the method
by Cannon and Holt [9].
In the remainder of this subsection, we discuss the recent improvements to the
GAP implementation of Smith’s method. Let G be a ﬁnite solvable group. Smith’s
method uses induction along a characteristic series of G with elementary abelian
factors. Let M by a characteristic elementary abelian subgroup of G of order pd, say.
Then there is a natural homomorphism
' W Aut.G/ ! Aut.G=M/  Aut.M/:
By induction, we assume that Aut.G=M/ is given. Note that Aut.M/ Š GL.d; p/.
The principal idea of Smith’s method is to determine Aut.G/ via determining the
kernel and image of '. The kernel of ' is naturally isomorphic to Z1.G=M; M/ and
can be determined readily. The image of ' can be described by certain stabilizer
calculations; these stabilizer calculations are the main bottlenecks of the method.
One idea towards reducing the bottlenecks is the following. Instead of starting
a stabilizer computation with the full direct product Aut.G=M/  Aut.M/, we

206
B. Eick et al.
determine a priori a subgroup D  Aut.G=M/  Aut.M/ with im.'/  D and then
use D instead of Aut.G=M/Aut.M/. For example, a subgroup D can be determined
as the stabilizer of each group in a collection of characteristic subgroups of G. This
often breaks a single stabilizer calculation into a sequence of smaller calculations
and thus reduces the bottleneck of the overall method.
Using characteristic subgroups is particularly helpful to reduce Aut.M/. In this
case the stabilizer of each group in a collection of characteristic subgroups of M
in Aut.M/ translates to the stabilizer of a collection of invariant subspaces of Fd
p in
GL.d; p/. This can be determined readily via the method described by Schwingel
[24]. We implemented this in GAP and use it in combination with Smith’s method.
We exhibit a second idea towards reducing bottlenecks. Let D  Aut.G=M/ 
Aut.M/ with im.'/  D. Then D acts naturally on the set of homomorphism
G=M ! M. Let  denote the homomorphism arising from the conjugation action
of G=M on M. One step in Smith’s method is to determine the stabilizer in D of
. We ﬁrst determine a permutation representation of D related to the action on
homomorphisms and then use the highly effective permutation group machinery of
GAP to determine the desired stabilizer.
4.2
Isomorphisms
In this section we discuss the GAP implementation of the method of Cannon and
Holt [9] to decide if two ﬁnite groups G and H are isomorphic. We ﬁrst determine
various invariants of G and H to have a fast initial check for non-isomorphism.
The method of Cannon and Holt uses induction along a fully invariant series
through G and H. In each induction step it decides isomorphism and computes the
automorphism group of the considered quotient.
Two groups G and H are isomorphic if and only if there exists ˛ 2 Aut.G 
H/ with G˛ D H. This translates an isomorphism test to an automorphism group
calculation. Note that it is not necessary for this approach to determine the full
automorphism group of GH: if G and H are isomorphic, then Aut.GH/ contains
a subgroup W Š Aut.G/ o C2 and G and H are conjugate in W.
Further, with this method it is frequently useful to determine a collection of fully
invariant subgroups of G and H a priori and to use these subgroups to reduce the
calculation, since a fully invariant subgroup of G (such as, for example, G0, Fit.G/
or Z.G/) has to map onto the corresponding subgroup of H and thus our aim is to
determine ˛ 2 W that maps these pairs of subgroups onto each other.
5
The Groups of Order at most 20;000
In this section we describe how we enumerated or constructed the groups of order
at most 20;000 with few exceptions.

Constructing Groups of ‘Small’ Order: Recent Results and Open Problems
207
Nilpotent Groups We have constructed these as direct products of p-groups. The
groups of order dividing p7 have been determined by Newman et al. [18, 22].
The groups of order dividing 29 have been constructed by Eick and O’Brien
[13, 19] who also enumerated the groups of order 210. The groups of order 38
have been determined by Vaughan-Lee [30]. Hence the nilpotent groups of order
n are available for all n 2 f1; : : : ; 20;000g except for those n divisible by 210 or 39;
and the nilpotent groups of order divisible by 210, but not divisible by 211, can be
enumerated.
Solvable, Non-nilpotent Groups We have used the Frattini extension method or
the solvable group construction to determine these groups. The Frattini extension
method in combination with an improved isomorphism test for solvable groups
has been used for the vast majority of orders in the range up to 20;000. The only
exception are the groups of order 28  32 D 2304 which were constructed with
the solvable group construction method. Further, we used the method of Sect. 3 to
enumerate groups of certain orders. Among the orders n in the range at most 20;000
there are 19;733 orders of the form m  p with p a prime that does not divide m. We
applied the method of Sect. 3 to a signiﬁcant range of these orders. In particular, we
enumerated the groups of order 29  p for p an odd prime with this approach.
Non-solvable Groups We have used the combination of the cyclic extension
method with the limited version of Archer’s Z method to construct these groups.
We note that there are 448 orders in the range of orders at most 20;000 for which
non-solvable groups exist. For example, we determined 99;926 non-solvable groups
of order 7680 D 29  3  5, and counted that there are more than 8;279;000 non-
solvable groups of order 15;360 D 210  3  5.
6
Open Cases and Challenges
We ﬁrst discuss enumerations of groups before we consider explicit constructions.
6.1
Enumeration
There are 39 orders in the range at most 20;000 for which we have not (yet?)
enumerated the groups of these orders. Note that in all but one case, order 15;360 D
211  3  5, the non-solvable groups have been enumerated successfully. Thus, the
following discussion is primarily concerned with solvable groups.
First Case Let E1 D fn 2 f1; : : : ; 20;000g j 210 j n or 39 j ng. Then E1
contains 20 orders. For these 20, the nilpotent groups of each order are not explicitly
constructed, let alone the non-nilpotent groups. Using the methods in [13], one
can determine that there are 4;896;600;938 groups of order 39 and exponent-3

208
B. Eick et al.
class 2. Further, it is known that there are 49;487;365;422 groups of order 210.
These numbers of groups are so large, that the enumeration of groups of orders in E1
appears to be infeasible. Just to give an idea of the problems that will arise in trying
to address this case, we note that the methods of [13] can be used to determine that
there are 1;774;274;116;992;170 groups of order 211 and exponent-2 class 2. These
methods are available as part of the GAP package [14].
Second Case Let E2 the set of those n 2 f1; : : : ; 20;000g satisfying that 29  p is a
proper divisor of n for some p 2 f3; 5; 7g. There are 18 orders in E2. There are over
400;000;000 groups for each of the orders 29  p with p 2 f3; 5; 7g. Hence, again,
these numbers are so large, that the enumeration of groups of orders in E2 appears
to be infeasible.
Third Case Let E3 D fn 2 f1; : : : ; 20;000g j .28  p2/ j n for some p 2 f3; 5; 7gg.
There are 12 orders in E3. These orders are difﬁcult cases for the construction
of solvable groups via the Frattini extension method. We have determined the
15;756;130 groups of order 28  32 using the solvable group construction. This order
is an exception in the set E3.
Exceptional Cases Six orders remain which are not in E1 [ E2 [ E3 and the
construction of the groups of these orders is an open problem. We list these orders
in the following table. The nilpotent groups of each of these orders are determined.
Where known, we exhibit in the table the numbers of nilpotent, solvable and non-
solvable groups.
n
# nilpotent
# solvable
# non-solvable
8748 D 22 	 37
18,620
Not known
0
10;368 D 27 	 34
34,920
Not known
0
13;122 D 2 	 38
1,396,077
Not known
0
16;000 D 27 	 53
11,640
Not known
0
17;496 D 23 	 37
46,550
Not known
0
18;816 D 27 	 3 	 72
4656
Not known
387
6.2
Construction
As observed in the previous paragraph, for all but 39 orders at most 20;000 we
have enumerated the numbers of groups of these orders. For the vast majority of
these orders we have also determined isomorphism type representatives explicitly:
more precisely, there are 34 orders for which we have enumerated the corresponding
groups only, but did not construct them. This includes the order 210 for which the
groups have been enumerated using the methods in [13].

Constructing Groups of ‘Small’ Order: Recent Results and Open Problems
209
For another 32 of these orders, we have used the approach exhibited in Sect. 3 to
enumerate the groups of these orders. These orders are of the form 29p for p an odd
prime, of the form 28pq for p 2 f3; 5; 7g and q a prime different from 2 and p, of the
form 2732p for p a prime different from 2 and 3, and the orders
8640 D 26  33  5;
9600 D 27  3  52;
13;440 D 27  3  5  7;
16;320 D 26  3  5  17;
17;280 D 27  33  5;
19;440 D 24  35  5:
Finally, we counted the groups of order 12;500 D 22  55 using a modiﬁed version
of the method described in Sect. 3, by exploiting that these groups always admit a
normal Sylow 5-subgroup.
For all other 19;927 orders in the range of orders at most 20;000, we have
explicitly determined the groups of the corresponding orders, unless they are already
available in the SmallGroups library [7]. The resulting groups will be made available
as a package for GAP.
7
Reliability of the Data
It is important to cross-check the computed data for group constructions and
enumerations. One very useful way for doing this is to determine or enumerate the
groups of a certain order in two different ways. We have done this in many cases. In
all of them the results of the different methods agree with each other.
We computed non-solvable groups using both the cyclic extension method and
the limited version of Archer’s Z method whenever Archer’s method applies.
Additionally, we used the method of Sect. 3 to obtain an independent enumeration
of the groups whenever the order is of the type mp with p prime and m coprime to
p and we used different types of such factorisations of the order when possible. Out
of the 447 orders admitting non-solvable groups, we enumerated 441 with at least
two different methods. This leaves only six cases which were not cross-checked.
For the solvable groups, we employed two methods: the Frattini extension
method, as well as the enumeration approach from Sect. 3. In the range of order
at most 20;000, the SmallGroups library [7] already covers 17;903 orders. Of the
remaining 2097 orders, we enumerated 1875 orders with both methods, 183 orders
with only one method, and 39 orders remain open, see Sect. 6.
Acknowledgements We thank Eamonn O’Brien for comments on drafts of this work. The second
author was supported by the DFG Schwerpunkt SPP 1489. The third author was supported by
Simons Foundation Collaboration Grant 244502.

210
B. Eick et al.
References
1. C. Archer,
The extension problem and classiﬁcation of nonsolvable groups.
PhD Thesis,
Université Libre de Bruxelles, 1998
2. H.U. Besche, B. Eick, Construction of ﬁnite groups. J. Symb. Comput. 27, 387–404 (1999)
3. H.U. Besche, B. Eick, GrpConst - Construction of ﬁnite groups (1999). A refereed GAP 4
package, see [29]
4. H.U. Besche, B. Eick, The groups of order qn 	 p. Commun. Algebra 29(4), 1759–1772 (2001)
5. H.U. Besche, B. Eick, E.A. O’Brien,
The groups of order at most 2000.
Electron. Res.
Announc. Am. Math. Soc. 7, 1–4 (2001)
6. H.U. Besche, B. Eick, E.A. O’Brien, A millennium project: constructing small groups. Int. J.
Algebra Comput. 12, 623–644 (2002)
7. H.U. Besche, B. Eick, E. O’Brien, SmallGroups - a library of groups of small order (2005).
A GAP 4 package; Webpage available at www.icm.tu-bs.de/ag_algebra/software/small/small.
html
8. S. Blackburn, P. Neumann, G. Venkataraman,
Enumeration of Finite Groups (Cambridge
University Press, Cambridge, 2007)
9. J.J. Cannon, D.F. Holt, Automorphism group computation and isomorphism testing in ﬁnite
groups. J. Symb. Comput. 35, 241–267 (2003)
10. A. Cayley, On the theory of groups, as depending on the symbolic equation n D 1. Philos.
Mag. 4(7), 40–47 (1854)
11. J. Conway, H. Dietrich, E. O’Brien, Counting groups: Gnus, Moas and other exotica. Math.
Intell. 30, 6–15 (2008)
12. B. Eick, M. Horn, The construction of ﬁnite solvable groups revisited. J. Algebra 408, 166–182
(2014)
13. B. Eick, E.A. O’Brien, Enumerating p-groups. J. Aust. Math. Soc. 67, 191–205 (1999)
14. B. Eick, E. O’Brien, AutPGrp - computing the automorphism group of a p -group, Version 1.8
(2016). A refereed GAP 4 package, see [29]
15. B. Eick, C.R. Leedham-Green, E.A. O’Brien, Constructing automorphism groups of p-groups.
Commun. Algebra 30, 2271–2295 (2002)
16. D. Holt, W. Plesken, Perfect Groups (Clarendon Press, Oxford, 1989)
17. M. Horn, B. Eick, GroupExt - Constructing ﬁnite groups (2013). A GAP 4 package, see [29]
18. M.F. Newman, E.A. O’Brien, M.R. Vaughan-Lee, Groups and nilpotent Lie rings whose order
is the sixth power of a prime. J. Algebra 278, 383–401 (2003)
19. E.A. O’Brien, The groups of order dividing 256. PhD thesis, Australian National University,
Canberra, 1988
20. E. O’Brien, ANUPQ - the ANU p-Quotient algorithm (1990). Also available in MAGMA and
as GAP package
21. E.A. O’Brien, The p-group generation algorithm. J. Symb. Comput. 9, 677–698 (1990)
22. E.A. O’Brien, M.R. Vaughan-Lee, The groups with order p7 for odd prime p. J. Algebra
292(1), 243–258 (2005)
23. L. Pyber, Group enumeration and where it leads us, in European Congress of Mathematics,
Volume II (Budapest, 1996), Progress in Mathematics, vol. 169 (Birkhäuser, Basel, 1998), pp.
187–199
24. R. Schwingel, Two matrix group algorithms with applications to computing the automorphism
group of a ﬁnite p-group. PhD Thesis, QMW, University of London, 2000
25. J.K. Senior, A.C. Lunn, Determination of the groups of orders 101–161, omitting order 128.
Am. J. Math. 56(1–4), 328–338 (1934)
26. J.K. Senior, A.C. Lunn, Determination of the groups of orders 162–215 omitting order 192.
Am. J. Math. 57(2), 254–260 (1935)
27. M.J. Smith,
Computing automorphisms of ﬁnite soluble groups.
PhD thesis, Australian
National University, Canberra, 1995

Constructing Groups of ‘Small’ Order: Recent Results and Open Problems
211
28. D. Taunt, Remarks on the isomorphism problem in theories of construction of ﬁnite groups.
Proc. Camb. Philos. Soc. 51, 16–24 (1955)
29. The GAP Group, GAP – groups, algorithms and programming, Version 4.4. Available from
http://www.gap-system.org (2005)
30. M. Vaughan-Lee, B. Eick, SglPPow – Database of certain p-groups (2016). A GAP 4 package,
see [29]

Classifying Nilpotent Associative
Algebras: Small Coclass and Finite Fields
Bettina Eick and Tobias Moede
Abstract We survey the state of the art in the classiﬁcation of nilpotent associative
F-algebras by coclass using their associated coclass graphs GF.r/. For arbitrary
ﬁelds F, we determine up to isomorphism the nilpotent associative F-algebras of
coclass 1 and their coclass graphs GF.1/. For ﬁnite ﬁelds F and arbitrary r, we
propose a conjecture on the structure of the coclass graph GF.r/; this conjecture
is based on computational investigations. We further show how computational
methods apply in an enumeration of the isomorphism types of nilpotent associative
F-algebras of small dimensions over small ﬁnite ﬁelds F.
Keywords Coclass theory • Nilpotent associative algebras • p-groups
Subject Classiﬁcations 16N40, 16W99, 16Z05, 20D15
1
Introduction
Let F be an arbitrary ﬁeld. An associative F-algebra A is called nilpotent of class
cl.A/ if every product of cl.A/ C 1 elements of A is zero and there exist cl.A/
elements in A whose product is non-zero. Note that a nilpotent associative F-algebra
does not contain an identity element. The coclass of a nilpotent associative
F-algebra A is deﬁned as
cc.A/ D dim.A/  cl.A/:
B. Eick
Institut Computational Mathematics, TU Braunschweig, Pockelsstraße 14,
38106 Braunschweig, Germany
e-mail: beick@tu-bs.de
T. Moede ()
School of Mathematical Sciences, Monash University, Clayton, VIC 3800, Australia
e-mail: tobias.moede@monash.edu; t.moede@tu-braunschweig.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_9
213

214
B. Eick and T. Moede
For each ﬁeld F and each r 2 N0 one can visualize the nilpotent associative
F-algebras of coclass r in a graph GF.r/: The vertices of this graph correspond
one-to-one to the isomorphism types of nilpotent associative F-algebras of coclass
r and there is an edge A ! B if cl.B/ D cl.A/ C 1 and B=Bcl.B/ Š A holds, where
Bcl.B/ is the ideal of B spanned by all products of cl.B/ elements in B.
The coclass of a nilpotent associative F-algebra is a non-negativeinteger and thus
each nilpotent associative F-algebra is contained in one of the graphs GF.r/. Hence
the classiﬁcation up to isomorphism of nilpotent associative F-algebras translates to
an investigation of the coclass graphs GF.r/ for each r 2 N0. This provides a new
approach towards a classiﬁcation of nilpotent associative F-algebras.
We consider the graphs GF.r/ in more detail. By construction, each connected
component of the graph GF.r/ is a tree which we call a maximal descendant tree.
The roots of these trees are the roots of the graph GF.r/. An inﬁnite path in GF.r/ is
called maximal if it is not properly contained in another inﬁnite path of GF.r/.
Theorem 1.1 ([5, Theorem 3] and [6, Theorem 1]) Let F be an arbitrary ﬁeld
and r 2 N0.
a) The roots of GF.r/ have dimension at most 2r.
b) The graph GF.r/ has ﬁnitely many maximal inﬁnite paths if and only if r  1 or
F is a ﬁnite ﬁeld.
Theorem 1.1 b) suggests that the cases of algebras of coclass at most 1 and
algebras over ﬁnite ﬁelds provide two promising areas for further investigations.
We consider these in more detail in the following.
1.1
Coclass at most 1
It is not difﬁcult to show that GF.0/ consists of a single inﬁnite path. In [5] it is
shown that GF.1/ consists of a single inﬁnite tree having one inﬁnite path starting at
its root and there is an experimental investigation of GF.1/ exhibited for some ﬁnite
ﬁelds F.
Our ﬁrst aim here is a complete classiﬁcation up to isomorphism of the nilpotent
associative F-algebras of coclass 1 for all ﬁelds F. We include a brief summary of
this result here and refer to Sect. 3 for details.
For an arbitrary ﬁeld F and i  2 let Ui D .F/i1 denote the group of .i  1/-th
powers and S D .F/2 the group of squares in the multiplicative group F. Further,
if there is an edge A ! B in a coclass graph, then we say that B is an immediate
descendant of A.

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
215
Theorem 1.2 (See Sect. 3 for a Proof) Let F be an arbitrary ﬁeld and let A1 !
A2 ! : : : denote the inﬁnite path in GF.1/ starting at its root.
a) Each vertex in GF.1/ has distance at most 1 from the inﬁnite path.
b) The algebra A1 has ŒF W S C jFj C 3 immediate descendants and, for i  2,
the algebra Ai has ŒF W SUi C ŒF W Ui C 2 immediate descendants.
Theorem 1.2 fully describes GF.1/. We visualize this graph in Fig. 1 in compact
notation: a number n on an edge means that this edge exists n times.
We note the following immediate consequence of Theorem 1.2.
Corollary 1.3 Using the notation of Theorem 1.2, let ai denote the number of
immediate descendants of Ai in GF.1/.
•
If F is a ﬁnite ﬁeld of size q, then ai D aiC.q1/ for each i  2.
•
If F is algebraically closed, then ai D 4 for each i  2.
•
If F D R and i  2, then ai D 6 if i is even, and ai D 4 if i is odd.
•
If F D Q, then ai D 1 for all i  1.
•
Let P be a set of primes, let F be the closure of Q under taking p-th roots for all
p 2 P and let i  2. Then ai D 4 if and only if all prime factors of i  1 lie in P.
Fig. 1 The coclass graph
GF.1/
dim 2
[F∗: S] + |F∗| + 2
[F∗: SU2] + [F∗: U2] + 1
[F∗: SU3] + [F∗: U3] + 1

216
B. Eick and T. Moede
1.2
Finite Fields
We call a subtree of GF.r/ a coclass tree if it contains exactly one inﬁnite path
starting at its root. A coclass tree is called maximal if it is not properly contained in
another coclass tree. Coclass trees play a crucial role in the study of GF.r/ for ﬁnite
ﬁelds. We recall the following main result on coclass graphs for ﬁnite ﬁelds.
Theorem 1.4 ([6, Corollary 2] and [6, Theorem 3]) Let F be a ﬁnite ﬁeld and
r 2 N0.
a) GF.r/ consists of ﬁnitely many maximal descendant trees.
b) GF.r/ consists of ﬁnitely many maximal coclass trees and ﬁnitely many other
vertices.
Theorem 1.4 reduces the investigation of coclass graphs over ﬁnite ﬁelds to an
investigation of their maximal coclass trees. We introduce some further notation to
discuss this in more detail. Given a vertex A in GF.r/, we say that B is a descendant
of A if there is a path from A to B in GF.r/. We denote with TA the full subtree of
GF.r/ consisting of all descendants of A.
Let T be a maximal coclass tree in GF.r/ with root A and denote its maximal
inﬁnite path by A D A1 ! A2 ! : : :. Then the depth dep.T / of T is the maximal
distance of a vertex in T to its inﬁnite path. The rank rk.T / is the dimension of
A=A2. Further, we say that T is virtually periodic with period d if TAl and TAlCd
are isomorphic as directed trees.
In [6] we proposed a conjecture on the periodic patterns in the maximal coclass
trees of GF.r/ for each ﬁnite ﬁeld F and each r 2 N0. Here we propose the following
stronger and more detailed version of this conjecture.
Conjecture (Stronger Version of [6, Conjecture 6]) Let F be a ﬁnite ﬁeld of size q
and characteristic p and let r 2 N0. Let T be a maximal coclass tree of GF.r/ of
depth d and rank e. Then:
a) The depth of T is bounded by d  r  e C 2.
b) The tree T is virtually periodic with period dividing pd1.q  1/.
This conjecture holds trivially for r D 0. Theorem 1.2 proves that it holds for
r D 1. It thus remains to investigate the conjecture for r  2. In [6] we exhibited
various experimental data for graphs GF.2/ and we note that these experiments
support the conjecture. Our aim here is to exhibit further experimental support for
the conjecture, see Sect. 4. We use the algorithm of [6] for this purpose.

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
217
class 2
class ≥3
dim 3
dim 4
dim 5
dim 6
dim 3
dim 4
dim 5
dim 6
F2
5
21
354
42319
1
5
49
729
F3
7
29
1703
3328650
1
5
54
F4
7
31
6684
105547591
1
5
59
F5
9
39
22052
1685636086
1
5
64
F7
11
49
144894
118539109666
1
5
72
F8
11
51
311520
651101343361
1
5
F9
13
59
616331
2940062651968
1
5
Fig. 2 Numbers of nilpotent associative algebras over small ﬁnite ﬁelds. Empty entries indicate
that the precise number is not known
1.3
Enumeration of Algebras
The classiﬁcation by coclass is a new approach towards a detailed investigation of
nilpotent associative F-algebras. More classical is to use the dimension as primary
invariant. We consider this here brieﬂy.
In [7] there is an effective method introduced to count the number of isomor-
phism types of the ﬁnite p-groups of given order and exponent-p class 2. A variation
of this method allows to count the isomorphism types of nilpotent associative
F-algebras of a given dimension and class 2 for a ﬁnite ﬁeld F.
Further, using the algorithm of [6] and combining it with the Burnside-Lemma
to count numbers of orbits it is possible to count the isomorphism types of nilpotent
associative F-algebras of a given dimension. We exhibit our results on enumerations
of algebras in Fig. 2.
These numbers coincide with the classiﬁcations in [2, 8] for dimension at most
3 and with [1] for dimension at most 5 over F2. The fast growing numbers even for
class 2 algebras indicate the difﬁculty of a classiﬁcation by dimension only.
2
The Construction of Coclass Graphs
In this section we recall the main ideas used in the investigation of coclass graphs
as far as we need them later.
2.1
Constructing Immediate Descendants
Let A be a ﬁnite-dimensional nilpotent F-algebra for an arbitrary ﬁeld F and write
e D dimF.A=A2/. Note that e is the minimal generator number of A. Let F be the
non-unital free associative F-algebra on e generators and let R E F with A Š F=R.

218
B. Eick and T. Moede
Then the covering algebra A of A is given by
A Š F=.FR [ RF/;
where .FR [ RF/ is the ideal generated by FR [ RF in F. The covering algebra was
introduced in [3]. It was shown that A is ﬁnite-dimensional and nilpotent of class
cl.A/ or cl.A/ C 1. Let
' W A ! A
be the natural epimorphism. Then the kernel of ' is called the multiplicator of A
and is denoted with M.A/. By construction, M.A/A D AM.A/ D f0g holds. We
call N.A/ D .A/cl.A/C1 the nucleus of A.
Theorem 2.1 ([3, Theorem 7]) Let A be a ﬁnite-dimensional nilpotent F-algebra
over an arbitrary ﬁeld F.
a) For each immediate descendant B of A there exists one (or several) proper
subspaces U < M.A/ with U C N.A/ D M.A/ so that A=U Š B.
b) If U is a proper subspace of M.A/ with codimension 1 and U C N.A/ D M.A/,
then A=U is an immediate descendant of A.
This theorem shows that immediate descendants can be associated with supple-
ments of N.A/ of codimension 1 in M.A/. It remains to solve the isomorphism
problem for immediate descendants. For this purpose we note that each automor-
phism of A extends to an automorphism of A. This extended automorphism of A
is not necessarily unique, but its action on M.A/ is. Hence Aut.A/ acts on M.A/ and
also on the set of proper supplements of N.A/ in M.A/.
Theorem 2.2 ([3, Theorem 10]) Let A be a ﬁnite-dimensional nilpotent F-algebra
over an arbitrary ﬁeld F. Let B1; B2 be two immediate descendants of A and suppose
that Bi D A=Ui for i D 1; 2 and two supplements U1; U2 to N.A/ in M.A/. Then
B1 Š B2 if and only if there exists an automorphism ˛ 2 Aut.A/ with U˛
1 D U2.
Theorems 2.1 and 2.2 translate readily to a method to determine isomorphism
type representatives of immediate descendants. This method requires the determina-
tion of the Aut.A/-orbits of proper supplements to N.A/ in M.A/. If F is a ﬁnite ﬁeld,
then this is always a ﬁnite calculation and translates to an implementable algorithm,
see [6, Algorithm 13] for details. A GAP [9] implementation of this algorithm is
available in the package ccalgs, see [4].
2.2
Exploring Coclass Graphs
The algorithm of Sect. 2.1 can be used to explore coclass graphs. Note that if A ! B
is an edge in a coclass graph, then A and B have the same coclass and their class

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
219
differs by one. Thus dim.B/ D dim.A/ C 1, and B corresponds to a supplement U
to N.A/ in M.A/ of codimension 1.
If F is a ﬁnite ﬁeld and r 2 N0, then all algebras in a coclass graph GF.r/ up to
some ﬁxed dimension d can be computed. For this purpose we ﬁrst determine the
roots of the graph with the method exhibited in [6] and then we iteratively determine
immediate descendants with the approach of Sect. 2.1.
3
Coclass 1
Let F be an arbitrary ﬁeld. The aim of this section is to determine up to isomorphism
the nilpotent associative F-algebras of coclass 1 and thus to prove Theorem 1.2. It
follows from [5, Corollary 11] that the algebras Ai on the inﬁnite path A1 ! A2 !
: : : starting at the root of GF.1/ can be described as Ai D ht; a j a2; at; ta; tiC1i.
Using the notation of Theorem 1.2, we proceed in the following steps:
•
Step 1: Determine the immediate descendants of A1.
•
Step 2: Determine the immediate descendants of Ai for i  2.
•
Step 3: Summarize the resulting classiﬁcations of immediate descendants.
•
Step 4: Show that each of the determined immediate descendants except the Ai’s
does not have any further immediate descendants.
3.1
Step 1
We use the general approach exhibited in Sect. 2.1 to prove Step 1. Recall that A1 D
ht; a j a2; at; ta; t2i. Then a straightforward calculation shows that
•
A
1 D ht; a j all products of length 3i,
•
M.A1/ D ha2; at; ta; t2i, and
•
N.A1/ D M.A1/.
By construction, Aut.A1/ Š GL.2; F/. Let V D F2 denote the natural module
for GL.2; F/. Then Aut.A1/ acts on M.A1/ with respect to the basis fa2; at; ta; t2g,
as GL.2; F/ acts on T WD V ˝F V. Theorems 2.1 and 2.2 now assert that the
isomorphism types of immediate descendants of A1 in GF.1/ correspond one-to-one
to the GL.2; F/-orbits of subspaces of codimension 1 in M.A1/.
Let  denote the map that maps each subspace C of M.A1/ to its orthogonal
complement C with respect to the standard scalar product. Then  is compatible
with the action of GL.2; F/. It follows that the GL.2; F/-orbits of subspaces of
codimension 1 in M.A1/ correspond one-to-one to the GL.2; F/-orbits of subspaces
of dimension 1 in M.A1/.

220
B. Eick and T. Moede
Let ' be a transversal function for S D fx2 j x 2 Fg in the multiplicative group
F and let U denote the subgroup of upper triangular matrices in GL.2; F/; that is,
U D f
 x y
0 z

j x; z 2 F; y 2 Fg:
As a ﬁrst step, we describe the U-orbits of 1-dimensional subspaces of T in the
following Lemma.
Lemma 3.1 Let w2; w3; w4 2 F.
(a) The U-orbit of h.1; w2; w3; w4/i has the representative
– h.1; 0; 0; 0/i if w2 D w3 and w4 D w2
3,
– h.1; 0; 0; '.w4  w2
3//i if w2 D w3 and w4 ¤ w2
3,
– h.1; 0; 1; .w4  w2w3/=.w3  w2/2/i if w2 ¤ w3.
(b) The U-orbit of h.0; 1; w3; w4/i has the representative
– h.0; 1; 1; 1/i if w3 D 1 and w4 ¤ 0,
– h.0; 1; w3; 0/i otherwise.
(c) The U-orbit of h.0; 0; 1; w4/i has the representative h.0; 0; 1; 0/i.
(d) The U-orbit of h.0; 0; 0; 1/i consists of this element only.
Proof Note that each 1-dimensional subspace contains a unique normed vector; that
is, a vector whose ﬁrst non-zero entry equals 1. We use normed vectors to represent
1-dimensional subspaces throughout the proof.
For x; z 2 F and y 2 F write
a D
 x y
0 z

:
Then a describes a generic element in U and it acts on the tensor product T via
a ˝ a D
0
BB@
x2 xy xy y2
0 xz 0 yz
0 0 xz yz
0 0 0 z2
1
CCA :
Write s D zx1.
(a) The normed vector associated with .1; w2; w3; w4/.a˝a/ is the vector .1; .zw2C
y/x1; .zw3 C y/x1; .yzw2 C yzw3 C z2w4 C y2/x2/. Choosing y D zw2
translates this to .1; 0; .w3  w2/zx1; .w4  w2w3/.zx1/2/ D .1; 0; .w3 
w2/s; .w4  w2w3/s2/. If w3 D w2, then this yields the stated result. If w3 ¤ w2,
then choosing s D .w3  w2/1 yields the stated result.

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
221
(b) The normed vector associated with .0; 1; w3; w4/.a ˝ a/ is .0; 1; w3; .y.w3 C
1/ C zw4/x1/. If w3 D 1 and w4 ¤ 0, then choosing s D w1
4
yields the
stated result. Otherwise we choose y D zw4=.w3 C 1/ if w3 ¤ 1 or y D 0 if
w4 D 0 to obtain the stated result.
(c) Determining .0; 0; 1; w4/.a ˝ a/ and norming the result yields .0; 0; 1; .zw4 C
y/x1/. Choosing y D zw4 yields the stated result.
(d) Determining .0; 0; 0; 1/.a ˝ a/ and norming the resulting vector yields
.0; 0; 0; 1/ as claimed.
Based on Lemma 3.1 we determine the orbits of GL.2; F/ on the 1-dimensional
subspaces in T as follows.
Theorem 3.2 Orbit representatives for the GL.2; F/-orbits on the 1-dimensional
subspaces of T are
•
h.0; 0; 0; 1/i,
•
h.0; 0; 1; 0/i,
•
h.0; 1; 1; 0/i,
•
h.1; 0; 0; u/i, with u in a transversal of S in F, and
•
h.1; 0; 1; v/i, with v 2 F.
Proof Again, let U denote the group of upper triangular matrices and note that
GL.2; F/ D ht; Ui with
t D
 0 1
1 0

:
The element t acts on T as
t ˝ t D
0
BB@
0 0 0 1
0 0 1 0
0 1 0 0
1 0 0 0
1
CCA :
As in the proof of Lemma 3.1, we use normed vectors to represent 1-dimensional
subspaces. We obtain the GL.2; F/-orbits of normed vectors in T by closing the
U-orbits under the action of .t ˝ t/. We now proceed in two steps.
Step 1:
We show that the list in Theorem 3.2 is complete. For this purpose we
observe that each of the orbit representatives of Lemma 3.1 can be mapped to
one of the representatives in Theorem 3.2.
•
Consider the representatives of U-orbits for the normed vectors of the form
.1; w2; w3; w4/ with w2; w3; w4 2 F. Let u be in a transversal of S in F and
v 2 F.

222
B. Eick and T. Moede
.1; 0; 0; 0/
t˝t
! .0; 0; 0; 1/;
.1; 0; 0; u/ with u in a transversal of S in F remains ﬁxed,
.1; 0; 1; v/ with v in F remains ﬁxed,
.1; 0; 1; 0/
t˝t
! .0; 1; 0; 1/
U! .0; 1; 0; 0/
t˝t
! .0; 0; 1; 0/:
•
Consider the representatives of U-orbits for the normed vectors .0; 1; w3; w4/
with w3; w4 2 F. If w4 ¤ 0, then .0; 1; w3; w4/.t ˝ t/ D .1; w3w1
4 ; w1
4 ; 0/ and
such normed vectors have been considered above. If w4 D 0 and w3 D 1 then
the result is trivial. If w4 D 0 and w3 ¤ 1, then U maps this vector to the
normed vector .0; 1; w3; .w3 C 1/yx1/ and thus for y ¤ 0 to an element with
last entry non-zero; these have been considered above. Finally, .0; 1; 0; 0/ maps
under .t ˝ t/ to .0; 0; 1; 0/.
•
Consider the representatives of U-orbits for the normed vectors of the form
.0; 0; 1; w4/ with w4 2 F. These map under U to .0; 0; 1; 0/ and thus are included.
•
Finally, the vector .0; 0; 0; 1/ is included.
Step 2:
We show that the list in Theorem 3.2 is irredundant. As a ﬁrst example,
consider the vector .0; 0; 0; 1/ of the list. Suppose that there exists
g D
 x y
w z

2 GL.2; F/
so that g maps this vector onto another representative in the list. Note that
.0; 0; 0; 1/.g ˝ g/ D .w2; wz; wz; z2/:
If w D 0, then this yields the normed vector .0; 0; 0; 1/ and thus the vector itself.
If w ¤ 0, then this yields the normed vector .1; zw1; zw1; .zw1/2/. It is easy
to see that this is not a representative in the list of Theorem 3.2.
As a second example, consider the vector .1; 0; 1; v/ with v 2 F of the list. Note
that
.1; 0; 1; v/.g ˝g/ D .w2v Cx2 Cxw; zwv CxyCyw; zwv CxyCxz; z2v Cy2 Cyz/:
We denote .w1; w2; w3; w4/ D .w2v Cx2 Cxw; zwv CxyCyw; zwv CxyCxz; z2v C
y2 C yz/. Then the normed vector obtained from .w1; w2; w3; w4/ is not among the
ﬁrst three representatives in the above list. If it would be of the form .1; 0; 0; u/ with
u in a transversal of S in F, then it follows that
zwv C xy C yw D 0
and
zwv C xy C xz D 0:

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
223
This implies det.g/ D xzyw D 0 which contradicts g 2 GL.2; F/. Finally, suppose
that the normed vector obtained from .w1; w2; w3; w4/ is of the form .1; 0; 1; v0/ with
v0 2 F. Then the following equations hold:
.1/ w1 ¤ 0;
.2/ w2 D 0;
.3/ w3  w1 D 0;
.4/ w4  w1v0 D 0; and
.5/ xz  wy ¤ 0:
Using equations (2) and (3), it follows that w1 D xz  wy. Write d D xz  wy and
replace w1 by d in the equations. Then the ideal generated by equations (2), (3), (4)
and d D xz  wy has a reduced Groebner basis containing the equation vd2  v0d2.
As d ¤ 0, it follows that v D v0 holds.
Similar calculations prove the claim for the other entries in the list of
Theorem 3.2.
3.2
Step 2
Again we use the general approach of Sect. 2.1 to prove Step 2. Recall that Ai D
ht; a j a2; at; ta; tiC1i for i  2. Then a straightforward calculation shows that
•
A
i D ht; a j a3; a2t; at2; ata; tat; t2a; ta2; tiC2i, and
•
M.Ai/ D ha2; at; ta; tiC1i, and
•
N.Ai/ D htiC1i.
First, we determine Aut.Ai/. Note that Ai has two Aut.Ai/-invariant series: the upper
annihilator series and the series of power ideals. The upper annihilator series has
the ideals Ann0.Ai/ D f0g and Annj.Ai/ D htijC1; tijC2; : : : ; ti; ai for 1  j  i
with Anni.Ai/ D Ai. The series of power ideals has the ideals A1
i D Ai and Aj
i D
htj; tjC1; : : : ; tii for 2  j  i with AiC1 D f0g.
Lemma 3.3 Each automorphism ˛ 2 Aut.Ai/ has the form
˛.t/ D xt C ua C b
with
x 2 F; u 2 F; b 2 A2
i ;
˛.a/ D ya C vti
with
y 2 F; v 2 F:
Proof Each element of Ai can be written as xt C ua C b with x; u 2 F and b 2 A2.
As ˛ is surjective, it follows that the image of ˛ has to cover A=Anni1.Ai/ and thus
x 2 F follows.

224
B. Eick and T. Moede
The image of a under ˛ has to be an element of Ann1.Ai/ D ha; tii. Thus ˛.a/ D
ya C vti for y; v 2 F. Again, as ˛ is surjective, and the subgroup generated by ˛.t/
avoids hai, it follows that y 2 F.
Next, we determine the action of Aut.Ai/ on M.Ai/.
Lemma 3.4 Let ˛ 2 Aut.Ai/ as in Lemma 3.3 depending on the parameters x; y 2
F and u; v 2 F. Then with respect to the basis fa2; at; ta; tiC1g of M.Ai/, it follows
that ˛ acts as
0
BB@
y2 0 0
0
yu yx 0
vx
yu 0 yx vx
0 0 0 xiC1
1
CCA :
Proof This follows by a direct calculation.
˛.a2/ D ˛.a/2 D .ya C vti/.ya C vti/
D y2a2 C vytia C yvati C v2t2i
D y2a2;
since i  2 and thus tia D ati D t2i D 0 in A
i .
˛.at/ D ˛.a/˛.t/ D .ya C vti/.xt C ua C b/
D yxat C yua2 C yab C vxtiC1 C vutia C vtib
D yxat C yua2 C vxtiC1; and similarly
˛.ta/ D yxta C yua2 C vxtiC1;
since b 2 A2
i and thus ab D tib D 0 and also tia D 0 as above. With the same
arguments it follows that
˛.tiC1/ D ˛.t/˛.ti/ D .xt C ua C b/.xiti/
D xiC1tiC1:
Using Theorem 2.2, it follows that the central aim of this section translates to a
determination of the Aut.Ai/-orbits of complements to N.Ai/ in M.Ai/. Note that the
action of Aut.Ai/ on the vector space M.Ai/ is compatible with the standard scalar
product of the vector space. Hence the Aut.Ai/-orbits of complements to N.Ai/ in
M.Ai/ correspond one-to-one to the Aut.Ai/-orbits of the spaces orthogonal to these
complements.

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
225
Lemma 3.5 Identify M.Ai/ Š F4 with respect to the basis fa2; at; ta; tiC1g. Then
for each complement C to N.Ai/ in M.Ai/ there exist w1; w2; w3 2 F with C D
hc1; c2; c3i, where c1 D .1; 0; 0; w1/, c2 D .0; 1; 0; w2/, c3 D .0; 0; 1; w3/. This
implies that the orthogonal space C then has the form C D h.w1; w2; w3; 1/Ti.
Proof This follows, since
0
@
1 0 0 w1
0 1 0 w2
0 0 1 w3
1
A
0
BB@
w1
w2
w3
1
1
CCA D 0:
Thus it now remains to determine the Aut.Ai/-orbits of vectors .w1; w2; w3; 1/T
where the vectors have to remain normed from the right. The following is straight-
forward.
Lemma 3.6 Let ˛ 2 Aut.Ai/ as in Lemma 3.3 depending on the parameters x; y 2
F and u; v 2 F. Write s D yxi and t D .yuw1 C vx/x.iC1/. Then ˛ maps the
normed vector .w1; w2; w3; 1/T to
.w1; w2; w3; 1/T
˛! .y2w1; yuw1 C yxw2 C vx; yuw1 C yxw3 C vx; xiC1/T
norm
! .s2x2i.iC1/w1; sw2 C t; sw3 C t; 1/T
If v ranges over F, then t also ranges over F. Further if y ranges over F, then s
ranges over F. This allows to determine the following orbit representatives for the
action of Aut.Ai/ on right-normed vectors.
Theorem 3.7 Orbit representatives for the Aut.Ai/-action on the spaces orthogo-
nal to a complement to N.Ai/ in M.Ai/ are
h.0; 1; 0; 1/Ti;
h.0; 0; 0; 1/Ti;
h.v; 1; 0; 1/Ti;
where v lies in a transversal of Ui in F;
h.w; 0; 0; 1/Ti;
where w lies in a transversal of SUi in F:
Proof Consider the action on right-normed vectors .w1; w2; w3; 1/T
as in
Lemma 3.6. As t 2 F is arbitrary, we can choose w3 D 0. As s 2 F is arbitrary, we
can choose w2 2 f0; 1g. Suppose that w2 D 0. Then s remains arbitrary and we can
choose w1 in a transversal of SUi in F or w1 D 0. Suppose that w2 D 1. Then s is
ﬁxed and we can choose w1 in a transversal of Ui in F or w1 D 0.

226
B. Eick and T. Moede
3.3
Step 3
Steps 1 and 2 can now be used to determine the following classiﬁcation of
isomorphism types algebras of distance 1 from the inﬁnite path in GF.1/.
Theorem 3.8 Let F be an arbitrary ﬁeld. Then the nilpotent associative F-algebras
of distance 1 to the inﬁnite path in GF.1/, i.e. the immediate descendants of Ai that
are not isomorphic to AiC1, can be described by the following set of parametrized
presentations.
a/For the algebra A1:
ht; a j a2; at; t2i;
ht; a j a2; at C ta; t2i;
ht; a j ua2  t2; at; tai;
with u in a transversal of S in F;
ht; a j a2  ta; at; vta  t2i;
with v 2 F:
b/For the algebras Ai with i  2:
ht; a j a2; at  tiC1; ta; tiC2i;
ht; a j a2  vtiC1; at  tiC1; ta; tiC2i;
with v in a transversal of Ui in F;
ht; a j a2  wtiC1; at; ta; tiC2i;
with w in a transversal of SUi in F:
Proof
a) The orbit representatives determined in Theorem 3.2 translate to subspaces
of codimension 1 in M.A1/. Taking quotients of A
1 by these subspaces (and
possibly removing redundant relators) gives algebras with the presentations
claimed. Note that the quotient by the subspace corresponding to the orbit
representative h.0; 0; 0; 1/i is isomorphic to the mainline algebra A2 and thus
is not listed. (Up to isomorphism this agrees with the algebras one can obtain
by restricting to the coclass 1 algebras in the general classiﬁcation of three-
dimensional nilpotent-associative F-algebras; see [2] or [8].)
b) The orbit representatives determined in Theorem 3.7 yield complements of N.Ai/
in M.Ai/ as indicated in Lemma 3.5. Taking quotients of the covering algebra A
i
by these complements yields algebras with the claimed presentations.

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
227
3.4
Step 4
It remains to show that the algebras determined in Theorem 3.8 do not have
immediate descendants. We consider the case i  2 as a ﬁrst step. Note that for
each of the algebras in Theorem 3.8 b) there exists x; y; z 2 F so that the algebra has
a presentation of the form
BiC1.x; y; z/ WD ht; a j a2  xtiC1; at  ytiC1; ta  ztiC1; tiC2i:
First note that AiC1 Š BiC1.0; w; w/ for each w 2 F via the isomorphism deﬁned by
t 7! t; a 7! awti. We show that BiC1.x; y; z/ does not have immediate descendants
in all other cases, that is, if y ¤ z or x ¤ 0. To shorten notation we write B D
BiC1.x; y; z/.
First suppose that y ¤ z. Write B D F=R and thus B D F=.FR [ RF/ for F free
non-unital on 2 generators. Then N.B/  htiC2i and ytiC2 D tat D ztiC2. As y ¤ z
it follows that tiC2 D 0 in B. Thus N.B/ D f0g and B does not have immediate
descendants by Theorem 2.1.
Now suppose that x ¤ 0. Again write B D F=R and B D F=.FR [ RF/ as
above. Then xtiC2 D ta2 D ztiC1a D ztita D z2t2iC1 D 0, since 2i C 1  i C 2 for
i  2 and tiC2 D 0. As x ¤ 0 it follows that tiC2 D 0 in B and hence N.B/ is zero.
Thus B cannot have any immediate descendants.
The case i D 1 can be veriﬁed with similar calculations in the respective covering
algebras, again showing that the nucleus is trivial in all cases.
4
Experiments for Larger Coclasses
In this section we discuss our computer experiments for the coclass graphs GF.r/
with r  2 and small ﬁnite ﬁelds F.
Coclass 2
In [5, Lemma 13] we showed that the number of maximal coclass trees in GF.2/
is jFj C 4. We extended this to a very detailed conjecture containing the depth and
(minimal) periods of the maximal coclass trees; see [6, Conjecture 5]. Note that
coclass 2 is the ﬁrst coclass for which ﬁnite connected components arise.
Coclass 3
A full conjectural description of GF2.3/ can be found at the website [4]. In Fig. 3 we
give a brief overview of the conjectured features of the graphs GF2.2/ (39 maximal
coclass trees), GF3.2/ (49 maximal coclass trees) and GF4.2/ (55 maximal coclass
trees). The table contains ranks, depths and periods of the maximal coclass trees
contained in these graphs.

228
B. Eick and T. Moede
rank
depth
period
#trees
2
1
1
10
2
2
1
1
2
2
2
2
2
3
1
1
2
3
2
3
3
1
1
19
3
2
1
1
3
2
2
1
4
1
1
1
rank
depth
period
#trees
2
1
1
5
2
1
2
6
2
2
2
2
2
2
3
1
2
2
6
2
2
3
2
1
2
3
3
1
2
3
6
2
3
1
2
25
3
2
2
1
3
2
6
2
4
1
2
1
rank
depth
period
#trees
2
1
1
3
2
1
3
11
2
2
3
1
2
2
6
4
2
3
2
2
2
3
3
1
2
3
12
1
3
1
3
29
3
2
3
1
3
2
6
1
4
1
3
1
Fig. 3 Conjectured features of the maximal coclass trees in GF2.3/, GF3.3/ and GF4.3/
dim 6
4
2
2
2
2
2
dim 5
2
16
7
Fig. 4 Left: A maximal descendant tree in GF2.3/ containing two maximal coclass trees. Right:
A maximal coclass tree in GF2.3/, where the depth in the conjectured periodic part is different
from the depth in the non-periodic part. The two circles indicate the conjectured periodicity, i.e.
the segment between the two circles is repeated inﬁnitely often
Experimentally, as illustrated in Fig. 4, two new phenomena arise in coclass 3:
•
There are maximal descendant trees that contain more than one maximal coclass
tree. For an explicit example see [6, Section 4].
•
There are maximal coclass trees for which the depth in the conjectured periodic
part is different from the depth in the non-periodic part at the top.

Classifying Nilpotent Associative Algebras: Small Coclass and Finite Fields
229
Fig. 5 Conjectured features
of the maximal coclass trees
in GF2.4/
rank
depth
period
#trees
2
1
1
35
2
2
1
7
2
2
2
16
2
3
2
9
2
4
2
4
2
4
4
6
3
1
1
461
rank
depth
period
#trees
3
2
1
50
3
2
2
45
3
3
2
5
4
1
1
69
4
2
1
1
4
2
2
1
5
1
1
1
Coclass 4
The coclass graph GF2.4/ conjecturally contains 710 maximal coclass trees. We
collect its conjectured features in Fig. 5.
References
1. C. Bertram,
Ein Algorithmus zur Klassiﬁkation nilpotenter Algebren.
Master’s thesis, TU
Braunschweig, 2011
2. W.A. de Graaf,
Classiﬁcation of nilpotent associative algebras of small dimension.
arXiv:1009.5339 (2010)
3. B. Eick, Computing automorphism groups and testing isomorphism for modular group algebras.
J. Algebra 320(11), 3895–3910 (2008)
4. B. Eick, T. Moede, ccalgs version 1.0 - a GAP4 package (2015). http://www.icm.tu-bs.de/~
tobmoede/ccalgs/
5. B. Eick, T. Moede, Nilpotent associative algebras and coclass theory. J. Algebra 434, 249–260
(2015)
6. B. Eick, T. Moede,
Coclass theory for ﬁnite nilpotent associative algebras: algorithms and
a periodicity conjecture.
Exp. Math. 26 (2016). http://dx.doi.org/10.1080/10586458.2016.
1162229
7. B. Eick, E.A. O’Brien, Enumerating p-groups.
J. Aust. Math. Soc. Ser. A 67(2), 191–205
(1999). Group theory
8. R. Kruse, D. Price, Nilpotent Rings (Gordon and Break, New York, 1969)
9. The GAP Group, GAP – Groups, Algorithms, and Programming, Version 4.7.9 (2015)

Desingularization of Arithmetic Surfaces:
Algorithmic Aspects
Anne Frühbis-Krüger and Stefan Wewers
Abstract The quest for regular models of arithmetic surfaces allows different
viewpoints and approaches: using valuations or a covering by charts. In this
article, we sketch both approaches and then show in a concrete example, how
surprisingly beneﬁcial it can be to exploit properties and techniques from both
worlds simultaneously.
Keywords Arithmetic surfaces • Regular models • Valuations • Desingulariza-
tion
Subject Classiﬁcations Primary: 14E15
1
Introduction
Resolution of singularities in dimension 2 was ﬁrst proved by Jung in 1908 [18],
but it was not until Hironaka’s work in 1964 [17] that this could also be mastered
in dimensions beyond 3. However, Hironaka’s result only applies to characteristic
zero, but not to positive or mixed characteristic. There the general question is still
wide open with partial results for low dimensions. In particular, Lipman gave a
construction for 2-dimensional schemes in full generality in [19].
Lipman’s result includes the case of an arithmetic surface, i.e. integral models
of curves over number ﬁelds. In fact, the existence of (minimal) regular models of
curves over number ﬁelds is a cornerstone of modern arithmetic geometry. Important
A. Frühbis-Krüger ()
Institut für Algebraische Geometrie, Leibniz Universität Hannover, Hannover, Germany
e-mail: anne@math.uni-hannover.de
S. Wewers
Institut für Reine Mathematik, Universität Ulm, Ulm, Germany
e-mail: stefan.wewers@uni-ulm.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_10
231

232
A. Frühbis-Krüger and S. Wewers
early results are for instance the existence of a minimal regular model of an elliptic
curve by Néron [25] and Tate’s algorithm [32] for computing it explicitly.
In this paper we study a particular series of examples of surface singularities
which is a special case of a construction due to Lorenzini [21, 22]. The singularity
in question is a wild quotient singularity. By this we mean the following: the singular
point lies on an arithmetic surface of mixed characteristic .0; p/ which is the quotient
of a regular surface by a cyclic group of prime order p, such that the group action has
isolated ﬁxed points. We prove that in our example one obtains a series of rational
determinantal singularities of multiplicity p, and we are able to write down explicit
equations for these (see Proposition 3.4).
Determinantal rings (of expected codimension) are well-studied objects in
commutative algebra: the free resolution is the Eagon-Northcott complex and hence
many invariants of the ring such as projective dimension, depth, Castelnuovo-
Mumford regularity, etc. are known (see e.g. [5, 10]). Beyond that, such singularities
(in the geometric case) are an active area of current research in singularity
theory studying e.g. classiﬁcation questions, invariants, notions of equivalence and
topological properties, see e.g. [12, 26, 34]. We show, by a direct computation, that
the resolution in our arithmetic setting is completely analogous to the geometric
case.
Both for deriving the equations of our singularities and for resolving them, we
employ and mix two rather different approaches to represent and to compute with
arithmetic surfaces. The ﬁrst approach is more standard and consists in representing
a surfaces as a ﬁnite union of afﬁne charts, and the coordinate ring of each afﬁne
chart as a ﬁnitely generated algebra over the ground ring. From this point of view,
computations with arithmetic surfaces can be performed with standard tools from
computer algebra, like standard bases (e.g. in SINGULAR [8]). However, these
techniques are not yet as mature in the arithmetic case as they are in the geometric
case.
The second approach uses valuations as its main tool. We work over a discrete
valuation ring R. An arithmetic surface X over Spec R is considered as an R-model
of its generic ﬁber XK (a smooth curve over K D Frac.R/). Then any (normal)
R-model X of XK is determined by a ﬁnite set V.X/ of discrete valuations on the
function ﬁeld of XK corresponding to the irreducible components of the special ﬁber
of X. A priori, it is not clear how to extract useful information about the model X
from the set V.X/. Nevertheless, in joint work with J. Rüth the second named author
has used this technique successfully for computing semistable reduction of curves
(see e.g. [30]).
The paper is structured as follows. In Sect. 2 we give some general deﬁnitions
concerning arithmetic surfaces, and we present our two approaches for representing
them explicitly. Section 3 then presents our series of wild quotient singularities.
In the ﬁnal section, we compute, in one concrete example of our wild quotient
singularities, an explicit desingularization.
We thank Tudor Micu and the referee for careful reading of a previous version
and for numerous comments which helped us to improve the article.

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
233
2
Arithmetic Surfaces and Models of Curves
2.1
General Deﬁnitions
Deﬁnition 2.1 By a surface we mean an integral and noetherian scheme X of
dimension 2. An arithmetic surface is a surface X together with a faithfully ﬂat
morphism f W X ! S D Spec.R/ of ﬁnite type, where R is a Dedekind domain. To
avoid technicalities, we always assume that R (and hence X) is excellent. Moreover,
we will assume in addition that X is normal, unless we explicitly say otherwise.
A common situation where arithmetic surfaces occur is the following. Let R be a
Dedekind domain, K D Frac.R/ and XK a smooth and projective curve over K. An
R-model of XK is an arithmetic surface X ! Spec.R/, together with an identiﬁcation
of XK with the generic ﬁber of X, i.e. XK D X ˝R K.
For the following discussion we ﬁx an arithmetic surface X ! Spec.R/. We
write Xsing for the subset of points whose local ring is not regular. Since we assume
that X is normal, Xsing is closed of codimension 2 and hence consists of a ﬁnite set
of closed points of X. A point  2 Xsing is called a singularity of X. (If we drop the
normality condition, then Xsing may also have components of codimension 1.)
By a modiﬁcation of X we mean a proper birational map f W X0 ! X. A
modiﬁcation is an isomorphism outside a ﬁnite set of closed points. If f is an
isomorphism away from a single point  2 X, then  is called the center of the
modiﬁcation and E WD f 1./ 	 X0 the exceptional ﬁber or exceptional locus (we
endow E with the reduced subscheme structure). Note that E is a connected scheme
of dimension one. We will use the notation
E D [n
iD1Ci;
where the Ci are the irreducible components. Each of them is a projective curve over
the residue ﬁeld k D k./. If the modiﬁcation changes more than a single point, we
will still denote the exceptional locus by E, but E obviously does not need to be
connected any more.
Deﬁnition 2.2 Let p W X ! S be an arithmetic surface and  2 Xsing a singularity.
A desingularization of  2 X is a modiﬁcation f W X0 ! X with center  and
exceptional ﬁber E D f 1./ such that every point 0 2 E is a regular point of X0. A
desingularization of X is a modiﬁcation consisting of desingularizations at all points
of Xsing.
By a theorem of Lipman [19], a desingularization of X always exists by means
of a sequence of normalizations and blow-ups. Depending on the situation we often
want f to satisfy further conditions. We list some of them:
(a) The exceptional divisor E is a normal crossing divisor of X0.
(b) Let s WD p.x/. Then the ﬁber X0
s of X0 over s is a normal crossing divisor on X0
(when endowed with the reduced subscheme structure).

234
A. Frühbis-Krüger and S. Wewers
(c) The desingularization f W X0 ! X is minimal (among all desingularizations of
 2 X).
(d) f W X0 ! X is minimal among all desingularizations satisfying (a) (resp. (b)).
Choosing a different approach than Lipman and avoiding normalizations
completely, Cossart, Janssen and Saito proved a desingularization algorithm
relying only on blow-ups at regular centers in [7], see also [6]. The approach
allows us to additionally satisfy yet another rather common condition:
(e) If X 	 W for some regular scheme,1 then desingularization of X can be achieved
by modiﬁcations of W which are isomorphisms outside Xsing.
2.2
Presentation by Afﬁne Charts
We are interested in the problem of computing a desingularization f W X0 ! X of
a given singularity  2 X on an arithmetic surface explicitly. Before we can even
state this problem precisely, we have to say something about the way in which the
surface X is represented.
The most obvious way2 to present X is to write it as a union of afﬁne charts,
X D [r
jD1Uj;
Uj D Spec Aj:
Here each Aj is a ﬁnitely generated R-algebra whose fraction ﬁeld is the function
ﬁeld F.X/ of X. After choosing a set of generators of Aj=R, we can obtain a
presentation ‘by generators and relations’. This means that
Aj D RŒx=Ij;
where x D .x1; : : : ; xnj/ is a set of indeterminates and Ij C RŒx is an ideal. Choosing
a list of generators of Ij, we obtain a presentation
RŒxmj ! RŒx ! Aj ! 0:
Taking into account the relations among the generators of the ideal Ij this presenta-
tion extends to
RŒxnj ! RŒxmj ! RŒx ! Aj ! 0;
where the matrix describing the left-most map is usually referred to as the ﬁrst
syzygy matrix of Ij or Aj respectively. Iteratively forming higher syzygies, this leads
to free resolutions, i.e. exact sequences of free RŒx-modules. As RŒx is a polynomial
1As before W should be excellent, noetherian, integral.
2Thanks to Grothendieck.

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
235
ring over a Dedekind domain, it has global dimension njC1 and hence Aj possesses a
free resolution of length at most njC1. Working locally at a maximal ideal m 	 RŒx,
this allows e.g. the calculation of the m-depth of Aj by the Auslander-Buchsbaum
formula.
In the subsequent sections, we shall encounter examples placing us in a particular
situation, for which free resolutions are well understood: determinantal varieties
corresponding to maximal minors. For these, Ij is generated by the maximal minors
of an m  n matrix deﬁning a variety of codimension .m  t C 1/.n  t C 1/, where
t D minfm; ng. Most prominently, the Hilbert-Burch theorem (see for instance [10])
relates Cohen-Macaulay codimension 2 varieties to the t-minors of their ﬁrst syzygy
matrix, which is of size t  .t C 1/, and ensures the map given by this matrix to be
injective.
2.3
Presentation Using Valuations
An alternative way3 to present an arithmetic surface is the following. To describe it
is convenient to assume that R is a local ring. Then R is actually the valuation ring
of a discrete valuation vK W K ! Q of its fraction ﬁeld K D Frac.R/. We choose a
uniformizer  of vK (i.e. a generator of the maximal ideal p C R) and normalize vK
such that vK./ D 1. We denote the residue ﬁeld of vK by k. In addition we make
the following assumption4:
Assumption 2.3 The valuation vK is either Henselian, or its residue ﬁeld k is
algebraic over a ﬁnite ﬁeld.
We ﬁx a smooth projective curve XK over K. Note that XK is uniquely determined
by its function ﬁeld FX, and conversely every ﬁnitely generated ﬁeld extension F=K
of transcendence degree 1 is the function ﬁeld of a smooth projective curve XK.
Let X be an R-model of XK, Xs its special ﬁber and
Xs D [i NXi
its decomposition into irreducible components. Then each component NXi is a prime
divisor on the surface X. Because X is normal, NXi gives rise to a discrete valuation
vi on FX such that vi./ > 0. We normalize vi such that vi./ D 1, i.e. such
that vijK D vK. By deﬁnition, the residue ﬁeld k.vi/ of vi is the function ﬁeld of
the component NXi. In particular, k.vi/ is a function ﬁeld over k of transcendence
degree 1.
A discrete valuation v on the function ﬁeld Fx is called geometric if vjK D vK
and the residue ﬁeld k.v/ is a ﬁnitely generated extension of k of transcendence
3Historically, this was actually the ﬁrst method, pioneered by Deuring [9] more than 10 years
before the invention of schemes.
4More generally, we could have assumed that .K; vK/ satisﬁes the local Skolem property, see [15].

236
A. Frühbis-Krüger and S. Wewers
degree 1. Let V.FX/ denote the set of geometric valuations. Given a model X of XK,
we write
V.X/ WD fv1; : : : ; vrg 	 V.FX/
for the set of geometric valuations corresponding to the components of the special
ﬁber of X.
Theorem 2.4 The map
X 7! V.X/
is a bijection between the set of isomorphism classes of R-models of XK and the set
of ﬁnite nonempty subsets of V.FX/.
Furthermore, given two models X; X0 of XK, there exists a map X0 ! X which
is the identity on XK (and which is then automatically a modiﬁcation) if and only if
V.X/ 	 V.X0/.
Proof See [14] or [28].
ut
By the above theorem models of a given smooth projective curve XK over a
valued ﬁeld .K; vK/ can be deﬁned simply by specifying a ﬁnite list of valuations.
An obvious drawback of this approach is that it is not obvious how to extract detailed
information on the model X from the set V.X/. A priori, V.X/ only gives ‘birational’
information on the special ﬁber Xs. For instance, it is not immediate to see whether
the model X is regular.
So far, the above approach based on valuations has proved to be very useful
for the computation of semistable models (see [30]). We intend to extend it to
other problems in the future. In Sect. 4.2 we will see a ﬁrst attempt to use it for
desingularization.
2.4
Computational Tools
In this section we report on some ongoing work to implement computational tools
for dealing with arithmetic surfaces and their desingularization.
2.4.1
Valuation Based Approach
As we have explained in Sect. 2.3, it is in principle possible to describe arithmetic
surfaces over a local ﬁeld purely in terms of valuations. In order to use this approach
for explicit computations, one needs a way to write down, manipulate and compute
with geometric valuations. Fortunately, such methods are available (but maybe not
as widely known as they should). Our approach goes back to work of MacLane

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
237
[23, 24]. In the present context (i.e. for describing models of curves over local ﬁelds)
it has been developed systematically in Julian Rüth’s PhD thesis [28].
We will not go into details, but for later use we need to introduce the notion of
an inductive valuation. Let K be a ﬁeld with a discrete valuation vK and valuation
ring R as before. Let v be an extension of vK to a geometric valuation on the rational
function ﬁeld K.x/. We assume in addition that v.x/  0 (i.e. that RŒx is contained
in the valuation ring of v). Let  2 RŒx be a monic integral polynomial, and let
 2 Q be a rational number satisfying  > v./. If  satisﬁes a technical condition
with respect to v (being a key polynomial, see [28, Deﬁnition 4.7]) then we can
deﬁne a new geometric valuation v0 (called an augmentation of v) with the property
that
v0./ D ;
v0. f/ D v. f/ for f 2 KŒx with deg. f/ < deg./:
The deﬁnition of v0 is easy and explicit: for an arbitrary polynomial f 2 KŒx we
compute its -development
f D f0 C f1 C : : : C fmm;
where deg. fi/ < deg./. Then
v0. f/ WD min
i
v. fi/ C i  :
For a rational function f=g 2 K.x/ we set v0. f=g/ WD v0. f/  v0.g/. The condition
that  is a key polynomial for v then implies that the map v0 W K.x/ ! Q [ f1g
deﬁned above is indeed a valuation. See [28, §4], for more details. We write
v0 D Œv; v0./ D :
The process of augmenting a given geometric valuation can be iterated. A
geometric valuation v on K.x/ which is obtained by a sequence of augmentations,
starting from the Gauss valuation with respect to x, is called an inductive valuation.
It can be written as
v D vn D Œv0; v1.1/ D 1; : : : ; vn.n/ D n:
(1)
Here v0 is the Gauss valuation, i 2 Q and i 2 RŒx is monic. Furthermore,
i is a key polynomial for vi1 and i > vi1.i/. By Rüth [28, Theorem 4.31],
every geometric valuation v on K.x/ with v.x/  0 can be written as an inductive
valuation.
The notion of inductive valuation can be extended in several ways. Firstly, by
replacing x with x1 if necessary, we can drop the condition v.x/  0, Hence we
can write every geometric valuation on K.x/ as an inductive valuation. Secondly,
for the last augmentation step in (1) we can allow the value n D 1. The resulting

238
A. Frühbis-Krüger and S. Wewers
vn is then only a pseudo-valuation and induces a true valuation on the quotient
ring L WD KŒx=.n/ (which is a ﬁeld because key polynomials are irreducible).
Thirdly, given an arbitrary ﬁnite extension L=K, we can compute the (ﬁnite) set
of extensions w of vK to L as follows. We write L D KŒx=. f/ for an irreducible
polynomial f 2 KŒx. If f is irreducible over the completion OK of K with respect
to vK, then there exists a unique extension w of v to L which can be written as an
inductive pseudo-valuation on KŒx (with n D f). In general, let f D Q
i fi be the
factorization into irreducibles over OK. Then each factor fi gives rise to an extension
wi of v to L. Considering wi as a pseudo-valuation on KŒx, MacLane shows that wi
can be written as a limit valuation of a chain of inductive valuations vn. By this we
mean that vn is an augmentation of vn1, and for every ˛ D .g.x/ mod . f// 2 L
there exists n  0 such that wi.˛/ D vn.g/ D vnC1.g/ D : : :.
MacLane’s theory is constructive and can be used to implement algorithms
for dealing with discrete valuations on a fairly large class of ﬁelds. A Sage
package written by Julian Rüth called mac_lane [29] is available under
github.com/saraedum/mac_lane. It can be used to deﬁne and compute with discrete
valuations of the following kind:
•
p-adic valuations on number ﬁelds.
•
Geometric valuations v on function ﬁelds F=K (of dimension 1) whose restriction
to K is either trivial, or can be deﬁned by this package.
Given a valuation v on a ﬁeld K of the above kind and a ﬁnite separable extension
L=K, it is possible to compute the set of all extension of v to L.
These algorithms are used in a crucial way in [3, 30] and [4].
2.4.2
Chart Based Approach
On the other hand, a description by afﬁne charts as in Sect. 2.2 not only emphasizes
the similarity to the geometric setting, it also allows the use of computational
techniques such as standard bases (whenever a suitably powerful arithmetic for
computations in R is available). This, in turn, opens up a whole portfolio of algo-
rithms ranging from basic functionality like elimination or ideal quotients to more
sophisticated algorithms such as blowing up and normalization, which eventually
permit to practically implement the above mentioned algorithms of Lipman and of
Cossart-Janssen-Saito for desingularization of 2-dimensional schemes. Note at this
point that neither of the two algorithms imposes the condition of normality on the
surfaces to be resolved.
In a nutshell, the desingularization problem for 2-dimensional schemes is
the problem of ﬁnding suitable centers which improve the singularity without
introducing new complications. In this context, 0-dimensional centers for blow-
ups usually do not pose any major problems: such blow-ups at different centers
may be interchanged, as they are isomorphisms outside their respective centers and
hence do not interact. However, even resolving a 0-dimensional singular point in the

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
239
geometric case may already require the use of 1-dimensional centers to achieve a
regular model and normal crossing divisors. These curves can exhibit signiﬁcantly
more structure than sets of points, e.g. they can possess intersecting components
or non-regular branches. So the central problems in resolving the singularities of
2-dimensional schemes are ensuring improvement in each step and treating 1-
dimensional loci which need to be improved. In particular for the latter, the two
aforementioned approaches differ signiﬁcantly.
The key idea behind Lipman’s algorithm [19] is that normal varieties are
regular in codimension 1, i.e. that their singular locus is 0-dimensional. Thus a
normalization step can always ensure that only sets of points will be required for
subsequent blowing up:
Theorem 2.5 ([19]) Let X be an excellent, noetherian, reduced scheme of dimen-
sion 2, then X possesses a desingularization by a ﬁnite sequence of birational
morphisms of the form
Xr
rınr
!   
2ın2
! X1
1ın1
! X0 D X;
where i denotes a blow up at a ﬁnite number of points, ni a normalization and Xr
is regular.
While blowing up is algorithmically straightforward e.g. using an elimination
(see e.g. [11]), the hard step is the normalization. Although there has been signiﬁcant
improvement in the efﬁciency of Grauert-Remmert style normalization algorithms
in the last decade (see e.g. [2, 16]), this is still a bottleneck when working over
a Dedekind domain R instead of a ﬁeld. The crucial step here is the choice of a
suitable test ideal, i.e. a radical ideal contained in the ideal of the non-normal locus
and containing a non-zerodivisor. In the geometric case, the ideal of the singular
locus—generated by the original set of generators and the appropriate minors of
the Jacobian matrix—is well-suited for this task, but in the current setting it also
sees ﬁbre singularities which do not contribute to the non-regular locus. Hence
the approximation of the non-normal locus by this test ideal is rather coarse and
signiﬁcantly impedes efﬁciency. In practice, a better approximation of the non-
normal locus is achieved by constructing a test ideal following an idea of Hironaka’s
termination criterion: we use the locus where Hironaka’s invariant , i.e. the tuple
of orders (in the sense of orders of power series) of the elements of a local standard
basis, sorted by increasing order, is lexicographically greater than a tuple of ones.
The approach of Cossart-Janssen-Saito [7] (CJS for short) on the other hand,
avoids normalization completely and allows well-chosen 1-dimensional centers,
whenever necessary; when choosing centers, it takes into account the full history
of blowing ups leading to the current situation. In contrast to Lipman’s approach,
this algorithm yields an embedded desingularization. Nevertheless, a key step is
again the use of the locus where  lexicographically exceeds a tuple of ones.
But then, no normalization follows, instead the singularities of this locus are ﬁrst
resolved before it is itself used as a 1-dimensional center. Each arising exceptional
curve in this process remembers when it was created and whether its center was

240
A. Frühbis-Krüger and S. Wewers
of dimension 0 or 1, because this information is crucial in the choice of center for
ensuring improvement as well as normal crossing of exceptional curves.
A beta version of the ﬁrst algorithm is available as SINGULAR-library reslip-
man.lib and is planned to become part of the distribution in the near future.
A prototype implementation of the CJS-algorithm has been implemented and is
closely related to an ongoing PhD-project on a parallel approach to resolution of
singularities using the gpi-space parallelization environment (for recent progress
along this train of thought see [1, 27]).
3
Explicit Construction of Wild Quotient Singularities
In this section we describe a series of examples for arithmetic surfaces with
interesting singularities. The general construction is due to Lorenzini (see [21] and
[22]). Our contribution is to explicitly describe the (local) ring of the singularity by
generators and relations. In the next section we also describe the desingularization
in an equally explicit way.
Let R be a discrete valuation ring, with maximal ideal p, residue ﬁeld k D R=p
and fraction ﬁeld K. Let vK denote the corresponding discrete valuation on K. We
assume that k has positive characteristic p and that vK is Henselian (in particular,
Assumption 2.3 holds).
Let XK be a smooth, projective and absolutely irreducible curve over K, of genus
g. We assume that XK has potentially good reduction with respect to vK. This means
that there exists a ﬁnite extension L=K and a smooth model Y of XL WD XK ˝K L
over the integral closure RL of R in L. Note that RL is a discrete valuation ring
corresponding to the unique extension vL of vK to L. We assume in addition that
L=K is a Galois extension, and that the natural action of G WD Gal.L=K/ on XL
extends to an action on Y. Under this assumption, we can form the quotient scheme
XY=G. It is an R-model of XK.
The model Y is regular because Y
! Spec.R/ is smooth by assumption.
However, the quotient scheme X D Y=G may have singularities. In fact, let  2 Xs
be a closed point on the special ﬁber of X, and let 
 2 Ys be a point above . Let
I
 	 G denote the inertia subgroup of 
 in G. If I
 D 1 then the map Y ! X is étale
in 
. It follows that X is regular in  because Y is regular in 
.
In general, the locus of points with I
 ¤ 1 may consist of the entire closed
ﬁber Ys and hence be a subset of codimension 1 on Y. To obtain isolated quotient
singularities we impose the following condition:
Assumption 3.1 The action of G on the special ﬁber Ys is generically free.
Under this assumption, there are at most a ﬁnite number of points 
 2 Ys with
nontrivial inertia I
 ¤ 1. Let 1; : : : ; r 2 Xs be the images of the points 
 2 Ys with
I
 ¤ 1. Then 1; : : : ; r are precisely the singularities of the model X.

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
241
Remark 3.2 In Lorenzini’s original setting, Assumption 3.1 holds automatically
because the curve Y has genus g.Y/  2. In our series of examples we have
g.Y/ D 0, but the assumption holds nevertheless.
3.1
An Explicit Example
Let p be a prime number and K a number ﬁeld. We denote by OK the ring of integers
of K and ﬁx a prime ideal p C OK lying over p (i.e. such that p 2 p). Let vK
denote the discrete valuation on K corresponding to p and R the valuation ring of
vK. Let L=K be a Galois extension of degree p which is totally ramiﬁed at p. This
means that vK has a unique extension vL to L. Let  be a generator of the cyclic
group G D Gal.L=K/. Let L be a uniformizer for vL. We normalize vL such that
vL.L/ D 1=p. Then vLjK D vK. Set
m WD p  vL..L/  L/:
Then m  2 is the ﬁrst and only break in the ﬁltration of G by higher ramiﬁcation
groups. We let u 2 k denote the image of the element ..L/  L/=m
L 2 R.
Let XK WD P1
K be the projective line over K. We identify the function ﬁeld FX with
the rational function ﬁeld K.x/ in the indeterminate x. Then L.x/ is the function ﬁeld
of XL D P1
L. We deﬁne an element
y WD x  L
m
L
2 L.x/:
Clearly, L.x/ D L.y/, and so y, considered as a rational function on XL, gives rise
to an isomorphism XL Š P1
L. We let Y denote the smooth RL-model of XL such
that y extends to an isomorphism Y Š P1
RL. By an easy calculation we see that
.y/ D ay C b, with a 2 R
L and b 2 RL. Furthermore,
.y/  y C u .mod L/:
In geometric terms this means that the action of G on XL extends to the smooth
model Y, and that the restriction of this action to the special ﬁber Ys Š P1
k is
generically free (and hence Assumption 3.1 holds). In fact, the action of G is ﬁx
point free on the afﬁne line Spec kŒ y, and if 
 2 Ys denotes the point corresponding
to y D 1 then I
 D G.
Let  2 Xs denote the image of 
. By construction,  is a wild quotient singularity
(see the introduction, p. 232), and it is the only singular point on X. Our goal is to
write down explicitly an afﬁne chart U D Spec A 	 X containing .

242
A. Frühbis-Krüger and S. Wewers
To state our result we need some more notation. Let  2 KŒx denote the minimal
polynomial of L over K. Then
 D xp C
p1
X
iD0
aixi D
p1
Y
kD0
.x  k.L//;
where a0; : : : ; ap1 2 p. The constant coefﬁcient
K WD a0 D NL=K.L/
is actually a prime element of R, i.e.  is an Eisenstein polynomial.
The following lemma gives a characterization of the model X in terms of the set
V.X/ of valuations corresponding to the irreducible components of the special ﬁber
(as in Theorem 2.4).
Lemma 3.3 We have
V.X/ D fvg
where v is the inductive valuation on K.x/ extending vK given by
v WD Œv0; v1.x/ D 1=p; v2./ D m:
(See Sect. 2.3 and (1) for the relevant notation.)
Proof It is clear that V.Y/ D fwg, where w is the Gauss valuation on F.XL/ D L.y/
with respect to the parameter y and the valuation vL. Since Y ! X D Y=G is
a ﬁnite morphism between (normal) models of their respective generic ﬁbers, we
have V.X/ D fvg, where v is the restriction of w to the subﬁeld F.XK/ D K.x/ 	
F.XL/ D L.y/. It remains to identify v with the inductive valuation given in the
statement of the lemma.
We will use the characterization of an inductive valuation which is implicit in
[28, §4.4]. Let v0 be a valuation on K.x/ which extends vK and satisﬁes
v0.x/  0;
v0./  m:
Then we claim that v. f/  v0. f/ for all f 2 KŒx. By Rüth [28, Theorem 4.56], the
claim implies that
v D Œv0; v1.x/ D 1=p; v2./ D m:
To prove the claim, we choose an extension w0 of v0 to the overﬁeld L.y/. Then
m  v0./ D
p1
X
iD0
w0.x  i.L// D
p1
X
iD0
w0.m
L y C L  i.L//:
(2)

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
243
By deﬁnition we have
w0.L/ D vL.L/ D 1=p;
w0.L  i.L// D vL.L  i.L//  m=p:
(3)
Combining (2), (3) and the strong triangle inequality we conclude that w0.y/  0.
The valuation w being the Gauss valuation with respect to y and vL this implies
w. f/  w0. f/ for all f 2 LŒ y. But KŒx 	 LŒ y, and therefore v. f/  v0. f/ for all
f 2 KŒx. This proves the claim and also the lemma.
ut
Let DK 	 XK be the divisor of zeroes of , and let D 	 X be the closure of DK.
Let U WD X  D denote the complement.
Proposition 3.4
1. We have U D Spec A, where A 	 FX D K.x/ is the sub-R-algebra generated by
the elements x0; : : : ; xp1, where
xi WD m
K xi1;
i D 0; : : : ; p  1:
The point  lies on U and corresponds to the maximal ideal
m WD .K; x0; : : : ; xp1/ C A:
2. The ideal of relations between the generators x0; : : : ; xp1 is generated by the
2  2 minors of the matrix
M WD
0
BBBBB@
x0
x1
x1
x2
:::
:::
xp2 xp1
xp1
z
1
CCCCCA
;
with z WD m
K 
p1
X
iD0
aixi:
Proof It follows from [20, Corollary 5.3.24], that the divisor D 	 X is ample, and
hence U WD X  D D Spec.A/ is afﬁne. Since X is normal, the ring A consists
precisely of all rational functions f 2 K.x/ with ordZ. f/  0, for any prime divisor
Z 	 X distinct from D.
A prime divisor Z 	 X is either horizontal (i.e. the closure of a closed point
on XK) or equal to Xs. By Lemma 3.3, Xs is a prime divisor with corresponding
valuation v on K.x/. It follows that
A D f f 2 AK j v. f/  0g;
where
AK D KŒ1; x1; : : : ; xp11:

244
A. Frühbis-Krüger and S. Wewers
In order to make the condition v. f/  0 more explicit, we write f 2 AK in the form
f D c0 C
r1
X
iD0
p1
X
jD0
ci;jxjir;
with c0; ci;j 2 K. Then Lemma 3.3 shows that
v. f/ D minfvK.c0/; vK.ci;j/ C j=p  m.r  i/g:
So the condition v. f/  0 is equivalent to
vK.ci;j/ C j=p  m.r  i/;
for i D 0; : : : ; r  1 and j D 0; : : : ; p  1. It follows that
A D RŒx0; : : : ; xp1;
where xj WD m
K xj1:
This is the ﬁrst part of Statement (i); the second part is obvious.
To prove Statement (ii) we let I be the ideal in the polynomial ring RŒx D
RŒx0; : : : ; xp1 generated by the 2  2-minors of the matrix M. It is easy to check
that the generators of A satisfy these relations. Therefore, we have a surjective map
A0 WD RŒx0; : : : ; xp1=I ! A. We want to prove that A0 D A.
Let A00 WD A0Œx1
0  and consider the matrix M with entries in A00. By deﬁnition we
have rkM  1, and the upper left entry x0 is a unit. An elementary argument shows
that there exists t 2 A00 such that
x0.t/ D m
K ;
xi D tix0;
i D 1; : : : ; p  1:
It follows that
A00 D RŒx0; x1
0 ; t j x0.t/ D m
K :
In particular A00=RŒx0; x1
0  is a ﬁnite ﬂat and generically étale extension of degree p.
We deduce that A00 is an integral domain of dimension 2. Looking at the equations
deﬁning A0, it is easy to see that
.x0/rad D .x0; : : : ; xp1/
and that A0=.x0/rad Š R has dimension 1. Together with dim A00 D 2 this implies
that dim A0 D 2. Therefore, A0 is a determinantal ring of the ‘expected’ codimension
. p  2 C 1/.2  2 C 1/ D p  1. Now a theorem of Eagon and Hoechster shows that
A0 is Cohen-Macaulay (see [10, Theorem 18.18] for a textbook reference). Every
associated prime of a Cohen-Macaulay ring is minimal [10, Corollary 18.10]. Since
A00 D A0Œx1
0  is an integral domain, it follows that A0 is an integral domain as well.

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
245
The analysis of A00 from above also shows that
A00
K D A0
KŒx1
0  D AKŒx1
0  D KŒx; 1:
It follows that J D ker.A0 ! A/ is an ideal of codimension  1. But A; A0 have the
same dimension, so J consists of zero divisors. On the other hand, we have shown
above that A0 is an integral domain. Hence J D 0. This completes the proof of
Proposition 3.4.
ut
Example 3.5 The simplest special case of Proposition 3.4 where the resulting
singularity is not a complete intersection is for p D 3. To make this even more
explicit, we set K WD Q and let vK denote the 3-adic valuation on K and R WD Z.3/
the valuation ring (the localization of Z at 3). Moreover, we set
 WD x3  3x2 C 3:
The splitting ﬁeld L=K of  is a Galois extension of degree 3 which is totally
ramiﬁed at p D 3. Indeed, we can factor  as
 D .x  /.x  .//.x  2.// D .x  /.x    2 C 3/.x   C 2  3/;
where  is prime elements for the unique extension vL of vK to L. We see that
m WD 3  vL.  .// D 2:
The resulting singularity  of the model X of XK D P1
K constructed above is a
rational triple point.
Remark 3.6 The generic ﬁber XK of our model X is a curve of genus zero and so
is not, strictly speaking, an example of the situation studied by Lorenzini. But we
can easily modify our construction to get examples with arbitrary high genus. For
instance, choose m > 1, p −m and consider the Kummer cover YK ! XK of smooth
projective curves with generic equation
YK W ym D .x/:
Then g.YK/  2 (except for p D 3 and m D 2 when g.YK/ D 1). Let Y denote the
normalization of the R-model X inside the function ﬁeld of YK. Then Y is a (normal)
R-model of YK. It can easily be shown that Y has a unique singular point 
 (which
is the unique point in the inverse image of  2 X), and that 
 2 Y is a wild quotient
singularity in the sense of [22]. We intend to study this situation in a subsequent
paper.

246
A. Frühbis-Krüger and S. Wewers
4
An Explicit Resolution
To keep the construction of a desingularization in an explicit example as concise as
possible we now focus on the speciﬁc Example 3.5. This case already illustrates the
general situation quite well, but is still sufﬁciently small to avoid lengthy explicit
computations.
Set K WD Q and let vK denote the 3-adic valuation on K and R WD Z.3/ the
valuation ring (the localization of Z at 3). Let v0 denote the Gauss valuation on
K.x/ with respect to x. We deﬁne an inductive valuation v on K.x/ as follows:
v WD Œv0; v.x/ D 1=3; v.x3  3x2 C 3/ D 2:
Let X be the model of XK WD P1
K with V.X/ D fvg. We have shown in the preceding
section that X has a unique singularity  with an afﬁne open neighborhood U D
Spec A, where
A D RŒx; y; z=I;
and where I is the ideal generated by the 2-minors of the matrix
M D
0
@
x
y
y
z
z 3x  3z  9
1
A :
The singular point  corresponds to the maximal ideal m D .3; x; y; z/ C A.
4.1
Explicit Blowups and Tjurina Modiﬁcations
Our goal is to construct explicitly a desingularization f W X0 ! X of . For ease of
notation we replace the projective scheme X by the afﬁne open subset U D Spec A.
We not only know that A is Cohen-Macaulay of codimension 2, we are in an even
better setting, the situation of the Hilbert-Burch theorem, which then implies that a
free resolution of A is of the form
0 ! RŒx; y; z2
M
! RŒx; y; z3 ! RŒx; y; z ! A ! 0;
i.e. the Eagon-Northcott complex of M.
At ﬁrst glance this seems to be unrelated to our task of desingularizing A.
However, these structural observations point us to well known results in the complex
geometric case: In the late 1960s, Galina Tjurina classiﬁed the rational triple point
singularities over the complex numbers in [33] and constructed minimal desingu-
larizations thereof in a direct way. Our given matrix M structurally corresponds to a

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
247
singularity of type H5 in Tjurina’s article, which we will refer to as Y here and for
which a presentation matrix (over CŒx; y; z; w) is of the form
N D
0
@
x
y
y
z
z wx  w2
1
A :
The last entry can be replaced by wx  wz  w2 without changing the analytic
type of the singularity as is shown in the classiﬁcation of simple Cohen-Macaulay
codimension 2 singularities in [12]. This similarity suggests to try and mimic the
philosophy of Tjurina’s choice of centers for the desingularization of X.
Tjurina’sﬁrst step towards a resolution of singularities is nowadays called a
Tjurina modiﬁcation and is based on the observation that at each point of Y except
the origin the row space of the presentation matrix deﬁnes a unique direction in C2
and hence a point in the Grassmanian of lines in 2-space. Resolving indeterminacies
of this rational map into the Grassmanian then yields the Tjurina transform which
can then be described by the equations
N 
s
t

D
0
@
0
0
0
1
A :
(For a more detailed treatment of Tjurina modiﬁcations see the ﬁrst section of [13].)
Three further blow-ups, each at the (0-dimensional) singular locus, which happens
to be the non-normal crossing locus of the exceptional curves in the second and
third blow-up, then lead Tjurina to a desingularization. The exceptional locus of this
sequence of blow-ups consists of six curves of genus zero, where the one originating
from the Tjurina modiﬁcation is the only one with self-intersection 3; all others
have self-intersection 2. The dual graph of the resolution is of the form (Fig. 1):
Fig. 1 Tjurina’s intersection
graph H5
−2
−2
−2
−2
−2
−3
Returning to our setting, we can mimic these steps, obtaining the following as
ideal of the Tjurina transform:
IX1 D hsx  ty; sy  tz; sz  t.3z  3x  9/i
By direct computation, it is easy to see that X1 is regular except above 3 and that
above 3 the non-regular locus is contained in the chart t ¤ 0. The exceptional
curve C0 which arose in this blow-up is a P1 and corresponds to the ideal hx; y; z; 3i.

248
A. Frühbis-Krüger and S. Wewers
Passing to the chart t ¤ 0, we can harmlessly eliminate the variables y and
z according to the ﬁrst two generators. This essentially leaves a hypersurface
described by the ideal
IX1;new D hs3x  3s2x C 3x C 9i 	 RŒx; s
and an exceptional curve IC0 D hx; 3i. The non-regular locus of this hypersurface
corresponds to hx; s; 3i as a direct computation shows; this is the center of the
upcoming blow-up, which leads to three charts, two of which only contain regular
points and only see normal crossing divisors. In the remaining chart (y1 ¤ 0), the
strict transform is given by
IX2 D h3  y2s; s2y0  s2y0y2 C y0y2 C y2
2i;
the strict transform of the exceptional curve C0 by h3; y0; y2i and the two compo-
nents C1 and C2 of the new exceptional curve E2 by h3; s; y2.y0 C y2/i. As the
non-regular locus is given by h3; s; y0; y2i and the non-normal crossing locus of the
exceptional curves is the same point, analogous to Tjurina’s setting, this point has
to be chosen as upcoming center. After blowing up this point of X2, we see in one
chart that each of the two components C1 and C2 of the preceding exceptional curve
E2 meets one component of the new exceptional curve E3; more precisely, C1 meets
C3 and C2 meets C4. In another chart, we see that the transform of C0 meets both
C3 and C4 at the origin, which is also the only singular point. Blowing up this point
then introduces yet another exceptional curve C5 meeting C0, C3 and C4; at this
stage, the strict transform is regular and the exceptional divisor is normal crossing.
All exceptional curves are 2-curves except the 3-curve C0. Hence we obtained
the dual graph:
Fig. 2 The intersection graph
of the desingularization of X
C1
C3
C5
C4
C2
C0
An explicit comparison of the computations of Tjurina and of the one presented
in our setting shows that all computational steps as well as the ﬁnal result are anal-
ogous in both cases. This certainly raises the question whether other singularities
from Tjurina’s list also have an analogue arising from the construction of Sect. 3
and what geometric properties the singularities corresponding to the matrices of the
previous section might exhibit.
Remark 4.1
1. In the above calculation, we saw that we could safely replace the matrix N, which
is the normal form in the classiﬁcation of simple Cohen-Macaulay codimension

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
249
2 singularities [12], by a matrix say N0 which directly corresponds to the
original matrix M, differing only by using a variable w instead of k D 3.
The isomorphism of the local rings of the singularities represented by N and
N0 does not involve any change of w, whence we could hope for an equivalent
isomorphism for M. This, however, does not exist, as the isomorphism over C
involves the multiplicative inverse of 3.
2. As in the explicit example here, all the determinantal singularities from Propo-
sition 3.4 allow a Tjurina modiﬁcation at the origin of the respective chart at
the beginning of the desingularization; this provides an exceptional curve C0.
After this step, we see only one singular point, an Apm1 singularity. This latter
singularity is well known to have a dual graph of resolution which is a chain
with pm  1 vertices and pm  2 edges, where the middle vertex corresponds
to the youngest exceptional curve. At this middle vertex we additionally ﬁnd the
connecting edge to the vertex C0 originating from the Tjurina transform.
4.2
A Posteriori Description via Valuations
We return to our original notation, i.e. X denotes the R-model of XK D P1
K with
V.X/ D fvg (and not its afﬁne subset Spec A). Also, x again denotes the original
coordinate function on XK.
The computation of the previous section shows that there exists a desingulariza-
tion f W X0 ! X of  such that the exceptional ﬁber E WD f 1./ is a normal crossing
divisor and consists of 6 smooth rational curves, with an intersection graph given in
Fig. 2. The arithmetic surface X0 is itself an R-model of XK and is hence completely
determined by the set V.X0/ of geometric valuations of K.x/ corresponding to the
irreducible components of the special ﬁber X0
s. But X0
s consists precisely of the
strict transform C6 of Xs (which corresponds to the valuation v6 WD v) and the 6
components C0; : : : ; C5 of the exceptional divisor.
The obvious question is: what are the valuations corresponding to the compo-
nents Ci, i D 0; : : : ; 5?
Proposition 4.2 Let vi denote the valuation on K.x/ corresponding to the com-
ponent Ci, for i D 0; : : : ; 5. We normalize vi such that vi.3/ D 1 (i.e. such that
vijK D vK). Then v0 is the Gauss valuation with respect to the coordinate x. For
i D 1; 3; 5,
vi D Œv0; vi.x/ D ri;
ri D
8
ˆˆ<
ˆˆ:
1=3;
i D 5;
1=2;
i D 3;
1;
i D 1:

250
A. Frühbis-Krüger and S. Wewers
For i D 2; 4 we have
vi D Œv0; vi.x/ D 1=3; vi./ D si;
si D
(
4=3;
i D 4;
5=3;
i D 2:
Proof This can be checked by a direct (but somewhat involved) computation, using
the explicit description of the desingularization by afﬁne charts in Sect. 4.1. As an
illustration of the general method let us convince ourselves that the Gauss valuation
v0 corresponds to the component C0.
It sufﬁces to consider the ﬁrst step of the desingularization, the Tyurina modiﬁ-
cation X1 ! X. We use the notation from p. 247. The afﬁne chart of X1 deﬁned by
t ¤ 0 has the form
Spec RŒx0; s j s3x0  3s2x0 C 3x0 C 9 D 0
and the exceptional divisor E1 	 X1 is given on this chart by IE1 D .x0; 3/. So
Spec F3Œs is an afﬁne open of E1, and hence E1 is a projective line. We claim that
E1, as a prime divisor on X, gives rise to the valuation v0 (the Gauss valuation with
respect to x).
We write x0; s as rational functions in x:
x0 D 91;
s D x1
x0
D x:
Now we see that the generators of the ideal IE1 have positive valuation (v0.3/ D 1,
v0.x0/ D 2) and s is a v0-unit and is a generator of its residue ﬁeld. This shows
that the prime divisor E1 	 X1 corresponds to the valuation v0. As the component
C0 of the desingularization X0 ! X is simply the strict transform of E1 under the
map X0 ! X1, we have proved the proposition for i D 0. For i D 1; : : : ; 5 one can
proceed in a similar way.
ut
Remark 4.3
1. We have found the set V.X0/ D fv0; : : : ; v6g after computing the desingulariza-
tion X0 ! X. By Theorem 2.4, X0 is determined by V.X0/. Could we have found
V.X0/ by some other method, and would this give an alternative way to compute
desingularization? In this simple case it is indeed possible to check the regularity
of X0 (and the fact that X0
s is a normal crossing divisor) purely in terms of the set
of valuations fv0; : : : ; v6g.
2. If we accept that X0 is regular and X0
s is a normal crossing divisor, it is easy
to compute the self intersection numbers of the irreducible components Ci, as
follows. Let
QE WD .3/ D
6
X
iD0
miCi 2 Div.X/

Desingularization of Arithmetic Surfaces: Algorithmic Aspects
251
be the principal divisor of the prime 3. For each i the integer mi (the multiplicity
of the component Ci) is equal to the ramiﬁcation index of the extension K.x/=K
with respect to vi. It is easy to read off mi from the explicit description of the vi
in Proposition 4.2:
m0 D 1; m1 D 1; m2 D 3; m3 D 2; m4 D 3; m5 D 3; m6 D 3:
Since QE is a principal divisor, we have
0 D .Ci:QE/ D
6
X
jD0
mj.Ci:Cj/;
for i D 0; : : : ; 6, see e.g. [31, §IV.7]. The component graph from Fig. 2 tells us
what .Ci:Cj/ is for i ¤ j (either 1 or 0). Now the self intersection numbers .Ci; Ci/
can be computed easily. We ﬁnd that
.Ci:Ci/ D
8
ˆˆ<
ˆˆ:
3;
i D 0;
2;
i D 1; : : : ; 5;
1;
i D 6:
References
1. J. Böhm, A. Frühbis-Krüger, A smoothness test for higher codimension. J. Symb. Comput. 86,
153–165 (2018)
2. J. Böhm, W. Decker, S. Laplagne, G. Pﬁster, A. Steenpaß, S. Steidel, Parallel algorithms for
normalization. J. Symbolic Comput. 51, 99–114 (2013)
3. M. Börner, I. Bouw, S. Wewers, The functional equation for l-functions of hyperelliptic curves.
Exp. Math. 1–16 (2016). http://dx.doi.org/10.1080/10586458.2016.1189860
4. M. Börner, I. Bouw, S. Wewers, Picard curves with small conductor (2017).
Preprint,
arXiv:1701.01986
5. W. Bruns, U. Vetter, Determinantal Rings. Lecture Notes in Mathematics, vol. 1327 (Springer,
New York, 1988)
6. V. Cossart, B. Schober, A strictly decreasing invariant for resolution of singularities in
dimension two. Preprint, arXiv:1411.4452
7. V. Cossart, U. Jannsen, S. Saito, Canonical embedded and non-embedded resolution of
singularities for excellent two-dimensional schemes (2009). Preprint, arXiv:0905.2191
8. W. Decker, G.M. Greuel, G. Pﬁster, H. Schönemann, SINGULAR 4-1-0 — A computer algebra
system for polynomial computations (2016). http://www.singular.uni-kl.de
9. M. Deuring, Reduktion algebraischer Funktionenkörper nach Primdivisoren des Konstan-
tenkörpers. Math. Z. 47(1), 643–654 (1942)
10. D. Eisenbud, Commutative Algebra with a View Towards Algebraic Geometry (Springer, New
York, 1995)
11. A. Frühbis-Krüger, Computational aspects of singularities,
in Singularities in Geometry
and Topology, ed. by J. Brasselet, J. Damon (World Scientiﬁc Publishing, Singapore, 2007),
pp. 253–327

252
A. Frühbis-Krüger and S. Wewers
12. A. Frühbis-Krüger, A. Neumer, Simple Cohen-Macaulay codimension 2 singularities. Com-
mun. Algebra 38(2), 454–495 (2010)
13. A. Frühbis-Krüger, M. Zach, On the vanishing topology of isolated Cohen-Macaulay codimen-
sion 2 singularities (2015). arXiv:1501.01915
14. B. Green, On curves over valuation rings and morphisms to P1. J. Number Theory 59(2),
262–290 (1996)
15. B. Green, M. Matignon, F. Pop, On the local Skolem property. J. Reine Angew. Math. 458,
183–200 (1995)
16. G.M. Greuel, C. Lossen, F. Seelisch, Normalization of rings. J. Symb. Comput. 45, 887–901
(2010)
17. H. Hironaka, Resolution of singularities of an algebraic variety over a ﬁeld of characteristic
zero: Ii. Ann. Math. 79(2), 205–326 (1964)
18. H.W. Jung, Darstellung der Funktionen eines algebraischen Körpers zweier unabhängigen
Veränderlichen x, y in der Umgebung einer Stelle x D a, y D b. J. Reine Angew. Math.
133, 289–314 (1908)
19. J. Lipman, Desingularization of two-dimensional schemes. Ann. Math. (2) 107(1), 151–207
(1978)
20. Q. Liu, Algebraic Geometry and Arithmetic Curves (Oxford University Press, Oxford, 2002)
21. D. Lorenzini, Models of curves and wild ramiﬁcation. Pure Appl. Math. Q 6(1), 41–82 (2010)
22. D. Lorenzini, Wild models of curves. Algebra Number Theory 8(2), 331–367 (2014)
23. S. MacLane, A construction for absolute values in polynomial rings. Trans. Am. Math. Soc.
40(3), 363–395 (1936)
24. S. MacLane, A construction for prime ideals as absolute values of an algebraic ﬁeld. Duke
Math. J. 2(3), 492–510 (1936)
25. A. Néron, Modèles minimaux des variétés abéliennes sur les corps locaux et globaux. Publ.
Math. IHES 21, 5–128 (1964)
26. J. Nuno-Ballesteros, B. Oréﬁce-Okamoto, J. Tomazella, The vanishing euler characteristic of
an isolated determinantal singularity. Isr. J. Math. 197, 475–495 (2013)
27. F.J. Pfreundt, M.E.A. Rahn, Gpi-space. Technical Report, Fraunhofer ITWM Kaiserslautern
(2014). http://www.gpi-space.de/
28. J. Rüth, Models of curves and valuations. Ph.D. Thesis, Universität Ulm, 2014
29. J. Rüth, Mac Lane infrastructure for discrete valuations in Sage. https://github.com/saraedum/
mac_lane
30. J. Rüth, S. Wewers, Semistable reduction of superelliptic curves of degree p (in preparation)
31. J. Silverman, Advanced Topics in the Arithmetic of Elliptic Curves (Springer, New York, 1994)
32. J. Tate, Algorithm for determining the type of a singular ﬁber in an elliptic pencil, in
Modular Functions of One Variable IV: Proceedings of the International Summer School,
University of Antwerp, RUCA, July 17 – August 3, 1972, ed. by B.J. Birch, W. Kuyk (Springer,
Berlin/Heidelberg, 1975), pp. 33–52
33. G. Tjurina, Absolute isolatedness of rational singularities and triple rational points. Func. Anal.
Appl. 2, 324–333 (1968)
34. M. Zach, Vanishing cycles of smoothable isolated Cohen-Macaulay codimension 2 singulari-
ties of type 2. Preprint, arXiv:1607.07527

Moduli Spaces of Curves in Tropical
Varieties
Andreas Gathmann and Dennis Ochse
Abstract We describe a framework to construct tropical moduli spaces of rational
stable maps to a smooth tropical hypersurface or curve. These moduli spaces will
be tropical cycles of the expected dimension, corresponding to virtual fundamental
classes in algebraic geometry. As we focus on the combinatorial aspect, we take
the weights on certain basic 0-dimensional local combinatorial curve types as input
data, and give a compatibility condition in dimension 1 to ensure that this input
data glues to a global well-deﬁned tropical cycle. As an application, we construct
such moduli spaces for the case of lines in surfaces, and in a subsequent paper for
stable maps to a curve [Gathmann et al., Tropical moduli spaces of stable maps
to a curve, in Algorithmic and Experimental Methods in Algebra, Geometry, and
Number Theory, ed. by G. Böckle, W. Decker, G. Malle (Springer, Heidelberg,
2018). https://doi.org/10.1007/978-3-319-70566-8_12].
Keywords Tropical geometry • Enumerative geometry • Gromov-Witten theory
Subject Classiﬁcations 14T05, 14N35, 51M20
1
Introduction
Moduli spaces of stable maps to a smooth projective variety are one of the most
important tools in modern enumerative geometry [5, 15]. Intersection theory on
these spaces has been used successfully to solve many enumerative problems, such
as e.g., determining the numbers of plane curves of ﬁxed genus and degree through
given points, or the numbers of rational curves of ﬁxed degree in a general quintic
threefold [9, 20].
In recent times, tropical geometry has also been proven to be very useful for
attacking enumerative problems, starting with Mikhalkin’s famous Correspondence
A. Gathmann () • D. Ochse
Fachbereich Mathematik, Technische Universität Kaiserslautern, Postfach 3049, 67653
Kaiserslautern, Germany
e-mail: andreas@mathematik.uni-kl.de; ochse@mathematik.uni-kl.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_11
253

254
A. Gathmann and D. Ochse
Theorem that provided the ﬁrst link between such problems in algebraic and tropical
geometry [21]. Accordingly, it is an important goal in tropical enumerative geometry
to construct tropical analogues of moduli spaces of stable maps, i.e., tropical cycles
whose points parametrize curves with certain properties in a given tropical variety.
This has been achieved for rational curves in toric varieties (corresponding to
tropical curves in a real vector space) in [16, 22], and (tropical) intersection theory
on these spaces has been used in many cases to attack and solve enumerative
problems from a purely combinatorial point of view.
Of course, it would be very desirable to have such moduli spaces of tropical
stable maps also for other target varieties. However, there is currently no general
known method to construct such spaces, mainly for the following two reasons:
(a) Already in algebraic geometry, the moduli spaces of stable maps may have
bigger dimension than expected from deformation theory. One can solve this
problem by introducing virtual fundamental classes, i.e., cycle classes in the
moduli spaces which are of the expected dimension and replace the ordinary
fundamental classes for intersection-theoretic purposes [3, 4]. These classes can
usually be constructed as certain Chern classes of vector bundles. However,
there is no corresponding counterpart of this theory in tropical geometry yet.
(b) Tropical curves (in the sense of: metric graphs of the given degree and genus)
in the given tropical variety might not be tropicalizations of actual algebraic
curves inside the algebraic variety. Consequently, the naive tropical moduli
space may not capture the situation from algebraic geometry appropriately, and
it might have too big dimension even if the algebraic moduli space does not.
This already happens for lines in cubic surfaces: Whereas each smooth algebraic
cubic contains exactly 27 lines, there are smooth tropical cubics with inﬁnitely
many lines on them [31]. In general, already this question whether a tropical
curve is realizable by an algebraic one inside the given ambient variety is an
unsolved problem. It is known that the space of realizable tropical curves is a
polyhedral set [32], but there is currently no explicit way to describe it.
In this paper, we will therefore study these tropical moduli spaces from an
axiomatic and purely combinatorial point of view. Given a smooth tropical hypersur-
face or curve X, we will describe a set of (essentially 0-dimensional) input data and
(essentially 1-dimensional) compatibility conditions that allow to construct from
them tropical moduli spaces M0.X; ˙/ of rational curves in X that are cycles of the
expected dimension (where the subscript 0 denotes the genus and ˙ the degree of
the curves). We can therefore consider such cycles as tropical analogues of both the
algebraic moduli spaces of stable maps and their virtual fundamental classes.
A central concept for this construction is the resolution dimension rdim.V/ of
a vertex V of a curve in X. It is an integer determined by the local combinatorial
type of the curve and X at V that describes the expected dimension of the moduli
space of such local curves when the vertex of the curve is resolved, modulo the local
lineality space of X. For example, a 4-valent vertex in the plane R2 has resolution
dimension 1, since it can be resolved to two 3-valent vertices in a 1-dimensional

Moduli Spaces of Curves in Tropical Varieties
255
family (modulo translations in R2). The origin of the curve in the following picture
has resolution dimension 0 since this curve piece cannot be resolved or moved in X.
X
X
glue
split
As a ﬁrst rule, vertices of negative resolution dimension are not allowed in our
moduli spaces—in the case of target curves this is known as the Riemann-Hurwitz
condition [6, 7]. To construct the maximal cells of M0.X; ˙/ together with their
weights, the general idea is then that splitting and gluing of the curves allows to
reduce this question to vertices of resolution dimension 0. For example, the picture
above on the left shows a line in a plane in R3, which can vary in a 2-dimensional
moduli space by moving its two vertices along the direction of its bounded edge.
We can split the curve in three pieces as in the picture on the right, all of which have
resolution dimension 0. If we have weights for the moduli spaces for these three
local pieces, we can glue them back together using tropical intersection theory to
obtain a moduli space for our original situation on the left. Technically, this means
that we consider the curve pieces to have bounded ends, and that we impose the
intersection-theoretic condition that corresponding endpoints map to the same point
in X by suitable evaluation maps.
In this way, we can make M0.X; ˙/ into a weighted polyhedral complex of the
expected dimension by just giving weights for vertices of resolution dimension 0
as input data (we will refer to them as moduli data in Deﬁnition 3.9). However, as
this input data can a priori be arbitrary, we need a certain compatibility condition
for the resulting polyhedral complex to be balanced. A central result of our paper is
that checking this condition in resolution dimension 1 is enough to ensure that the
gluing process then works for all dimensions of the moduli spaces (Corollaries 3.17
and 3.18).
We check this condition for the moduli spaces of lines in surfaces in R3, leading
e.g., to a well-deﬁned 0-dimensional moduli cycle of lines on an arbitrary smooth
tropical cubic surface, even if the actual number of such lines is inﬁnite. In a
particular example from [31] of such a cubic with inﬁnitely many lines, we verify
that this 0-cycle still has degree 27 as expected. In a subsequent paper, we use
our methods to obtain well-deﬁned moduli spaces of rational stable maps (of any
degree) to an arbitrary target curve [17]. In any case, the initial 0-dimensional input
data is obtained by tropicalization from the algebraic situation. For example, for the
vertex in the origin in the picture above the weight is just the number of lines in P3
through L1 \ L2 and L3 \ L4 for any four general lines L1; L2; L3; L4 	 P3, which
is 1.

256
A. Gathmann and D. Ochse
The organization of this paper is as follows. In Sect. 2 we give the necessary
background from tropical geometry. While most of this material is well-known,
there are three techniques that go beyond the usual theory: partially open versions
of tropical varieties in Sect. 2.1, quotient maps (and their intersection-theoretic
properties) in Sect. 2.2, and pull-backs of diagonals of smooth varieties in Appendix.
Section 3 then describes the gluing process for curves and constructs the tropical
moduli spaces from the given input data. Finally, in Sect. 4 we study the case of
lines in surfaces.
This paper is based on parts of the Ph.D. thesis of the second author [24]. It
would not have been possible without extensive computations of examples which
enabled us to establish and prove conjectures about polyhedra and their weights in
our moduli spaces. For this we used the polymake extension a-tint [18, 19] and GAP
[29]. We thank an anonymous referee for useful suggestions on the exposition. The
work of the ﬁrst author was partially funded by the DFG grant GA 636/4-2, as part
of the Priority Program 1489.
2
Preliminaries
2.1
Partially Open Tropical Varieties
Although most of the spaces occurring in this paper will be tropical varieties, some
of our intermediate constructions also involve “partially open” versions of them. In
these more general spaces the boundary faces of some polyhedra can be missing, and
thus the balancing condition is required to hold at fewer places. The constructions
in this introductory chapter are adapted to this setting and thus sometimes slightly
more general than usual. However, since all constructions relevant to us are local,
the required changes are minimal and straightforward.
For more details on the notions of tropical cycles and fans, see e.g., [2, 16].
Notation 2.1 (Polyhedra) Let  denote a lattice isomorphic to ZN for some N 
0, and let V WD  ˝Z R be the corresponding real vector space. A partially open
(rational) polyhedron in V is a subset  	 V that is the intersection of ﬁnitely many
open or closed half-spaces fx 2 V W f.x/ < cg resp. fx 2 V W f.x/  cg for c 2 R
and f in _, the dual of . We call  a (closed) polyhedron if it can be written in
this way with only closed half-spaces.
The (relative) interior ı of a partially open polyhedron is the topological
interior of  in its afﬁne span. We denote by V 	 V the linear space which is
the shift of the afﬁne span of  to the origin, and set  WD V \ . The dimension
of  is deﬁned to be the dimension of V.
A face  of a partially open polyhedron  is a non-empty subset of  that can be
obtained by changing some of the non-strict inequalities f.x/  c deﬁning  into
equalities. We write this as   , or  <  if in addition  ¤ . If dim  D
dim   1 we call  a facet of . In this case we denote by u= 2 = the

Moduli Spaces of Curves in Tropical Varieties
257
primitive normal vector of  relative to , i.e., the unique generator of = lying
in the half-line of  in V=V Š R.
Deﬁnition 2.2 (Polyhedral Complexes and Tropical Varieties) A partially open
polyhedral complex in V is a collection X of partially open polyhedra in a vector
space V D  ˝Z R, also called cells, such that
(a) if  2 X and  is a face of  then  2 X; and
(b) if 1; 2 2 X then 1 \ 2 is empty or a face of both 1 and 2.
It is called pure-dimensional if each inclusion-maximal cell has the same dimension.
The support of X, denoted by jXj, is the union of all  2 X in V.
A weighted partially open polyhedral complex is a pair .X; !X/, where X
is a purely k-dimensional partially open polyhedral complex, and !X is a map
associating a weight !X./ 2 Z to each k-dimensional cell  2 X. If there is no
risk of confusion we will write !X as !, and .X; !X/ just as X. A partially open
tropical cycle X in V is a weighted polyhedral complex such that for each cell  of
dimension k  1 the balancing condition
X
W>
!./  u= D 0
2 V=V
holds. It is called a partially open tropical variety if all weights are non-negative.
If all polyhedra in X are closed, we omit the attribute “partially open” and speak
e.g., of tropical cycles and tropical varieties. A tropical fan is a tropical variety all
of whose polyhedra are cones.
Often, the exact polyhedral complex structure of our cycles is not important. We
call two (partially open) cycles equivalent if they allow a common reﬁnement (where
a reﬁnement is required to respect the weights, and every polyhedron of a reﬁnement
must be closed in its corresponding cell of the original cycle). By abuse of notation,
the corresponding equivalence classes will again be called (partially open) tropical
cycles.
A morphism f W X ! Y between (partially open) tropical cycles X and Y is
a locally afﬁne linear map f W jXj ! jYj, with the linear part induced by a map
between the underlying lattices. It is called an isomorphism if it has a two-sided
inverse (up to reﬁnements) and respects the weights.
Example 2.3 (Linear Spaces) Let V D Rk, denote by ei for i D 1; : : : ; k the
negatives of the vectors of the standard basis, and set e0 D e1      ek. For
r < k we denote by Lk
r the tropical fan whose simplicial cones are indexed by
subsets I 	 f0; : : : ; kg with at most r elements and given by the cones generated
by all ei with i 2 I. The weights of the top-dimensional cones, corresponding
to subsets of size r, are all set to 1. This is the tropicalization of a general r-
dimensional linear space over the Puiseux series with constant coefﬁcient equations
[11, Proposition 2.5 and Theorem 4.1].
The following pictures illustrate these spaces, where all displayed cones are
thought to be extending to inﬁnity. If instead we interpret the pictures as bounded

258
A. Gathmann and D. Ochse
spaces they represent partially open tropical varieties obtained by intersecting Lk
r
with an open bounded polyhedron.
L2
1
L3
2
L3
1
Remark 2.4 In our Deﬁnition 2.2 it is allowed that two partially open polyhedra in
a complex do not intersect although their closures do. For example, in the pictures
above we could replace all polyhedra by their relative interiors. This would give us
weighted partially open polyhedral complexes with the same support, and whose
face relations and balancing conditions are trivial. However, spaces of this type will
not occur in our constructions in this paper—we will always have partially open
polyhedral complexes X such that  \  D ; for given ;  2 X implies  \  D ;.
Deﬁnition 2.5 (Smooth Varieties) For simplicity, in this paper we will follow [1]
and call a tropical variety X smooth if it is locally isomorphic to some Lk
rRm around
0 at each point (where r C m D dim X is ﬁxed, but otherwise k; r; m may depend on
the chosen point). This is more special than the usual deﬁnition of smoothness which
allows any polyhedral complex locally isomorphic to a matroid fan as in Appendix.
We expect that our results would hold in this more general setting as well.
For a smooth variety X, following [22, Section 5.3] the canonical divisor KX
of X is deﬁned to be the weighted polyhedral complex given by the codimension-
1 skeleton of X, where the weight of a codimension-1 cell of X is the number of
adjacent maximal cells minus 2.
Example 2.6 (Smooth Curves and Hypersurfaces) In this paper, the following two
cases of smooth varieties will be of particular importance.
(a) Consider a connected 1-dimensional tropical variety X in RN which is a tree—
we will refer to such a space as a rational curve. The smoothness condition then
means that for any vertex of X the primitive integer vectors in the directions of
the adjacent edges can be mapped to e0; : : : ; ek in Rk for some k  N by a
Z-linear map, and that all edges have weight 1. Such a vertex occurs in the
canonical divisor KX with weight k  1.
(b) Consider a hypersurface X in RN, i.e., a tropical variety given by a tropical
polynomial in N variables [25]. The coefﬁcients of this polynomial determine
a subdivision of its Newton polytope, and the weighted polyhedral complex
structure of X is induced by this subdivision. Smoothness then means that this

Moduli Spaces of Curves in Tropical Varieties
259
subdivision is unimodular [21, Proposition 3.11], and hence KX contains each
codimension-1 cell of X with weight 1. Most important for us will be the case
of a cubic surface in R3, i.e., of X being dual to a unimodular subdivision of the
lattice polytope in Z3 with vertices .0; 0; 0/, .3; 0; 0/, .0; 3; 0/, and .0; 0; 3/.
(a) a smooth curve in R3
with a line on it
(b) a cubic surface in R3
2.2
Tropical Quotients
In this section we will deﬁne quotients of partially open tropical cycles by vector
spaces in certain cases.
Deﬁnition 2.7 (Lineality Space) Let X be a partially open polyhedral complex in
a vector space V D  ˝Z R, and let L 	 V be a vector subspace deﬁned over Q.
We say that L is a lineality space for X if, for a suitable complex structure of X, for
all  2 X and x 2  the intersection  \ .x C L/ is open in x C L and equal to
jXj \ .x C L/.
Remark 2.8 If X is a tropical variety, i.e.,  is closed in V for all  2 X, then
 \ .x C L/ can only be open and non-empty if it is all of x C L. So in this case
we arrive at the usual notion of lineality space found in the literature (although note
that most authors only call a maximal subspace with this property a lineality space).
Lemma 2.9 Let X be a partially open polyhedral complex in V with a lineality
space L. Denote by q W V ! V=L the quotient map, where V=L is considered to
have the underlying lattice =. \ L/. Then for all ;  2 X we have:
(a) q./ is a partially open polyhedron of dimension dim q./ D dim   dim L.
(b) If    then q./  q./.
(c) q. \ / D q./ \ q./.
(b) If q./ D q./ then  D .
(d) q./ D =. \ L/; and if  is a facet of  then uq./=q./ D u= with this
identiﬁcation.

260
A. Gathmann and D. Ochse
Proof By induction it sufﬁces to prove the statements for dim L D 1. We choose
coordinates .x; y/ 2 Rdim V1  R Š V such that L D f.x; y/ W x D 0g, and consider
x as coordinates on V=L.
(a) In the deﬁning inequalities for  we may assume that all of them that contain
y are strict: if one of the non-strict deﬁning inequalities f.x; y/  c containing
y was satisﬁed as an equality at a point .x0; y0/ 2  it could not be satisﬁed in
a neighborhood of y0 2 R, contradicting the openness of  \ ..x0; y0/ C L/.
Hence  can be written as
 D q1.0/ \ f.x; y/ W y > fi.x/ C ai and y < gj.x/ C bj for all i; jg
(1)
for some linear forms fi; gj, constants ai; bj, and a partially open polyhedron 0
given by the deﬁning inequalities of  that do not contain y. But then
q./ D 0 \ fx W fi.x/ C ai < gj.x/ C bj for all i; jg;
(2)
since for x satisfying these conditions we can always ﬁnd y 2 R with fi.x/Cai <
y < gj.x/ C bj for all i; j. Hence q./ is a partially open polyhedron. Moreover,
the openness of  \ ..x; y/ C L/ means that all non-empty ﬁbers of qj have
dimension dim L, so that dim q./ D dim   dim L.
(b) If    is obtained from  by changing some non-strict inequalities to
equalities this means that  can be written as in .1/ for some 0  0 and
with the same fi; gj. Then .2/ holds for  and 0 as well, and we conclude that
q./ is a face of q./.
(c) The inclusion “	” is obvious. Conversely, if x 2 q./ \ q./ then there are
y; y0 2 R with .x; y/ 2  and .x; y0/ 2 . Hence
.x; y/ 2  \ ..x; y0/ C L/ 	 jXj \ ..x; y0/ C L/;
which implies .x; y/ 2  \ ..x; y0/ C L/ by deﬁnition of a lineality space. Hence
.x; y/ 2  \ , i.e., x D q.x; y/ 2 q. \ /.
(d) By (c), the equality q./ D q./ implies q. \/ D q./. In particular,  \ ¤
;. Hence  \  is a face of , which by the dimension statement of (a) must be
of the same dimension as . But this means that  \  D , and by symmetry
thus also  \  D .
(e) From the deﬁnition of a lineality space it follows that L 	 V; hence Vq./ D
V=L and thus q./ D =. \ L/. In particular, for  a facet of  we have
= D q./=q./ (with the isomorphism given by taking quotients by
 \ L), from which the statement about the primitive normal vector follows.
ut
Corollary 2.10 (Quotients) Let X be an n-dimensional partially open tropical
variety in V D  ˝Z R with a lineality space L, and let q W V ! V=L be the
quotient morphism. Then
X=L WD fq./ W  2 Xg

Moduli Spaces of Curves in Tropical Varieties
261
together with the weights !X=L.q.// WD !X./ is a partially open tropical variety
of dimension ndimL in the vector space V=L with lattice =.\L/. We will also
denote it by q.X/.
Proof By Lemma 2.9 (a) we see that X=L is a collection of partially open polyhedra
which by (d) are in bijection to the polyhedra in X. The statements (b) and (c)
of the lemma now imply that X=L is a partially open polyhedral complex as in
Deﬁnition 2.2. Moreover, the dimension statement of part (a) of the lemma means
that X=L is of pure dimension n  dim L, and that !X=L.q.// WD !X./ deﬁnes
a weight function on the top-dimensional cones. Finally, part (e) of the lemma
shows that the images of the balancing conditions for X in V give us the balancing
conditions for X=L in V=L.
ut
Our main examples for this quotient construction are (cycles in) the moduli
spaces of tropical curves, which we introduce in Sect. 2.4.
2.3
Tropical Intersection Theory
We now briefly recall some constructions and results of tropical intersection theory.
For a detailed introduction we refer to [2, 26, 27]. Although the theory is only
developed for closed tropical cycles there, the extension to the case of partially open
tropical cycles stated below follows immediately since all constructions involved are
local.
Construction 2.11 (Rational Functions and Divisors) For a partially open pure-
dimensional tropical cycle X, a (non-zero) rational function on X is a continuous
function ' W jXj ! R that is afﬁne linear on each cell (for a suitable polyhedral
complex structure), with linear part given by an element of _. We can associate to
such a rational function ' a (Weil) divisor, denoted by '  X. It is a partially open
tropical subcycle of X (i.e. a partially open cycle whose support is a subset of jXj)
of codimension 1. Its support is contained in the subset of jXj where ' is not locally
afﬁne linear [2, Construction 3.3].
Two important examples for rational functions and divisors in this paper are:
(a) On X D RN, a tropical polynomial ' deﬁnes a rational function, and its divisor
is just the tropical hypersurface deﬁned by '.
(b) If X is one-dimensional, the divisor '  X consists of ﬁnitely many points. We
deﬁne its degree of to be the sum of the weights of the points in '  X. By abuse
of notation, we sometimes write this degree as '  X as well.
Multiple intersection products '1      'r  X are commutative by Allermann and
Rau [2, Proposition 3.7].
Remark 2.12 (Pull-Backs and Push-Forwards) Rational functions on a (partially
open) tropical cycle Y 	 0 ˝Z R can be pulled back along a morphism f W X ! Y
to rational functions f ' D ' ı f on X. Also, we can push forward subcycles Z of X

262
A. Gathmann and D. Ochse
to subcycles fZ of Y of the same dimension [2, Proposition 4.6 and Corollary 7.4],
where in the partially open case we will always restrict ourselves to injective maps
f so that no problems can arise from two partially open polyhedra with different
boundary behavior that are mapped by f to an overlapping image. In any case,
by picking a suitable reﬁnement of X we can ensure that the partially open image
polyhedra f./ for  2 X form a partially open polyhedral complex fZ. For a
top-dimensional cell 0 2 fZ its weight !fZ.0/ is given by
!fZ.0/ WD
X

!X./  j0
0=f./j;
where the sum goes over all top-dimensional cells  2 Z with f./ D 0. Of
course, in the partially open case, there will be at most one such  in each sum since
f is assumed to be injective. As expected, push-forwards and pull-backs satisfy the
projection formula [2, Proposition 4.8 and Corollary 7.7].
Construction 2.13 (Pull-Backs Along Quotient Maps) Let X be a partially open
tropical variety with a lineality space L, so that there is a quotient variety X=L
as in Corollary 2.10 with quotient map q W X ! X=L. Moreover, let Z be a
partially open subcycle of X=L. Then the collection of polyhedra q1./ for  2 Z,
together with the weight function !.q1.// D !Z./, is a partially open subcycle
of X of dimension dim Z C dim L (in fact, the balancing conditions follows from
Lemma 2.9 (e)). We denote it by qZ.
We conclude this short excursion into tropical intersection theory with two com-
patibility statements between the quotient construction and pull-backs of rational
functions resp. push-forward of cycles.
Lemma 2.14 Let X be a partially open tropical cycle with lineality space L and
quotient map q W X ! X=L. Then for any rational function ' on X=L we have
.q'  X/=L D '  .X=L/:
Proof This is obvious from the deﬁnitions.
ut
Lemma 2.15 Let f W X ! Y be a morphism between partially open tropical cycles.
Assume that X and Y have lineality spaces L and L0, respectively, and that the linear
part of f on each cell maps X \ L isomorphically to Y \ L0. If g W X=L ! Y=L0
is the morphism giving a commutative diagram
then f.X/=L0 D g.X=L/:

Moduli Spaces of Curves in Tropical Varieties
263
Proof Assume that the polyhedral complex structure of all cycles is sufﬁciently ﬁne
to be compatible with all of the morphisms. Let  be a maximal cell in X, and set
 D f./ and  D q0./. Applying a suitable translation, we may assume that f
(and thus also g) is linear on .
If dim  < dim   dim L then  does not contribute to either cycle in the
statement of the lemma. Otherwise, the assumption implies that f maps X \L, and
hence every saturated sublattice of X \ L such as  \ L, to a saturated sublattice
of Y. Hence, in the inclusion
f. \ L/ 	 f./ \ f.L/ D f./ \ L0 	  \ L0
we must have equality since both sides are saturated lattices in Y of the same
rank. By the last equality in this chain it then follows from the weight formulas of
Corollary 2.10 and Remark 2.12 that the contribution of  to the cell  in the two
cycles of the lemma is
!f.X/=L0./ D !X./  j=f./j
D !X./  j.=. \ L0// = . f./=. f./ \ L0//j
D !X./  jq0./=q0. f.//j
D !X./  jq0./=g.q.//j
D !g.X=L/./:
ut
2.4
Tropical Moduli Spaces of Curves
We will now come to the construction of the moduli spaces M0.RN; ˙/ of tropical
curves in RN. Analogously to the algebraic case, elements of these spaces will be
given by a rational n-marked abstract tropical curve, together with a map to RN
whose image is a (not necessarily smooth) tropical curve in RN as in Sect. 2.1, with
unbounded directions as determined by ˙.
For later purposes we will also need a version M 0
0.RN; ˙/ of these spaces where
the ends xi have bounded lengths. In contrast to the original spaces M0.RN; ˙/ they
will only be partially open tropical varieties since there is no limit curve when the
length of such a bounded end approaches zero.
Let us start with the discussion of abstract tropical curves.
Construction 2.16 (Abstract Curves) A (rational) abstract tropical curve [16,
Deﬁnition 3.2] is a metric tree graph  with all vertices of valence at least 3.
Unbounded ends (with no vertex there) are allowed and labeled by x1; : : : ; xn. The
tuple .; x1; : : : ; xn/ will be referred to as an n-marked abstract tropical curve. Two
such curves are called isomorphic (and will from now on be identiﬁed) if there is an
isometry between them that respects the markings. The set of all n-marked abstract
tropical curves (modulo isomorphisms) is denoted M0;n.

264
A. Gathmann and D. Ochse
For n

3 it follows from [28, Theorem 3.4], [23, Section 2], or [16,
Theorem 3.7] that M0;n can be given the structure of a tropical fan as follows:
Consider the map
d W M0;n ! R.n
2/; .; x1; : : : ; xn/ 7! .dist .xi; xj//i<j
where dist .xi; xj/ denotes the distance between the two marked ends xi and xj in
the metric graph  . Moreover, consider the linear map
' W Rn ! R.n
2/; .ai/i 7! .ai C aj/i;j;
let ui D '.ei/ be the images of the unit vectors, let Un WD '.Rn/ D hu1; : : : ; uni,
and
qn W R.n
2/ ! Qn WD R.n
2/=Un
be the quotient map. For a subset I 	 Œn with 2  jIj  n  2 deﬁne vI to be the
image under qn ı d W M0;n ! Qn of a tree  with exactly one bounded edge of
length one, the marked leaves xi with i 2 I on one side and the leaves xi for i … I
on the other. Let n WD hvIiZ 	 Qn be the lattice in Qn generated by the vectors
vI. By Speyer and Sturmfels [28, Theorem 4.2] the map qn ı d W M0;n ! Qn is
injective, and its image is a purely .n  3/-dimensional simplicial tropical fan in
Qn D n ˝Z R, with all top-dimensional cones having weight 1. In the following
we will always consider M0;n with this structure of a tropical fan.
The cones of M0;n are labeled by the combinatorial types of marked curves, i.e.,
by the homeomorphism classes of the curves relative to their ends. The vectors vI
generate the rays of M0;n.
Construction 2.17 (Abstract Curves with Bounded Ends) We will now adapt
Construction 2.16 to the case when the ends also have bounded lengths. So we say
that an n-marked abstract tropical curve with bounded ends is a metric tree graph as
above with the unbounded ends replaced by bounded intervals, i.e., a metric graph 
without 2-valent vertices, and the 1-valent vertices labeled by x1; : : : ; xn. The notions
of isomorphisms and combinatorial types carry over from the case with unbounded
ends. The set of all n-marked curves (modulo isomorphisms) with bounded ends is
denoted M 0
0;n.
To make M 0
0;n for n  3 into a partially open tropical variety we consider the
distance map d W M 0
0;n ! R.n
2/ as above, which in this case however includes the
lengths of the bounded ends. Then d is injective: the vectors ui D '.ei/ 2 Qn in the
notation of Construction 2.16 correspond exactly to a change of the length of the
bounded edge at xi—so by Construction 2.16 the image point under qn ıd W M 0
0;n !
Qn allows to reconstruct the combinatorial type of the graph as well as the lengths
of all edges not adjacent to the markings, whereas the full vector in R.n
2/ then allows
to reconstruct the lengths of the ends as well.
Note that the combinatorial types of these curves with bounded ends are in one-
to-one correspondence with the types of curves with unbounded ends, and that d
maps M 0
0;n to a partially open polyhedral complex (with cones in bijection to the

Moduli Spaces of Curves in Tropical Varieties
265
combinatorial types), which by abuse of notation we will also denote by M 0
0;n.
Taking again the lattice in R.n
2/ generated by all graphs with integer lengths, and
giving all cells of M 0
0;n weight 1, we get in fact a partially open tropical variety in
R.n
2/ of dimension 2n  3. It has lineality space Qn in the sense of Deﬁnition 2.7,
and we have M 0
0;n=Qn D M0;n as in Corollary 2.10.
Construction 2.18 (Parametrized Curves in RN) A (rational, parametrized)
curve in RN [16, Deﬁnition 4.1] is a tuple .; x1; : : : ; xn; h/, with .; x1; : : : ; xn/
a rational n-marked abstract tropical curve and h W  ! RN a continuous map
satisfying:
(a) On each edge e of  , with metric coordinate t, the map h is of the form h.t/ D
a C t  v for some a 2 RN and v 2 ZN. If V 2 e is a vertex and we choose t
positive on e, the vector v will be denoted v.e; V/ and called the direction of e
(at V). If e is an end and t pointing in its direction, we write v as v.e/.
(b) For every vertex V of  we have the balancing condition
X
eWV2e
v.e; V/ D 0:
Two such curves in RN are called isomorphic (and will be identiﬁed) if there is an
isomorphism of the underlying abstract n-marked curves commuting with the maps
to RN.
The degree of a curve .; x1; : : : ; xn; h/ in RN as above is the n-tuple ˙ D
.v.x1/; : : : ; v.xn// 2 .ZN/n of directions of its ends. We denote the space of all
curves in RN of a given degree ˙ by M0.RN; ˙/.
Note that ˙ may contain zero vectors, corresponding to contracted ends that can
be thought of as marked points in the algebraic setting (see Construction 2.19).
If n  3 and there is at least one end xi with v.xi/ D 0 we can use the bijection
M0.RN; ˙/ ! M0;n  RN;
.; x1; : : : ; xn; h/ 7! ..; x1; : : : ; xn/; h.xi//
(which forgets h except for its image on xi) to give it the structure of a tropical
variety [16, Proposition 4.7].
Construction 2.19 (Evaluation Maps) For each i with v.xi/ D 0 there is an
evaluation map
evi W M0.RN; ˙/ ! RN
assigning to a tropical curve .; x1; : : : ; xn; h/ the position h.xi/ of its i-th marked
end (note that this is well-deﬁned since the marked end xi is contracted to a point).
By Gathmann et al. [16, Proposition 4.8], these maps are morphisms of tropical fans.
Construction 2.20 (Parametrized Curves in RN with Bounded Ends) Construc-
tions 2.17 and 2.18 can obviously be combined to obtain moduli spaces M 0
0.RN; ˙/

266
A. Gathmann and D. Ochse
of curves in RN with bounded ends, as pull-backs under the quotient maps that
forget the lengths of the bounded ends. They are partially open tropical varieties
and admit evaluation maps to RN as in Construction 2.19 at all ends (i.e., not just at
the contracted ones).
Remark 2.21 (Parametrized Curves in RN with Few Markings) In the follow-
ing, we will also need the moduli spaces M0.RN; ˙/ of parametrized curves
.; x1; : : : ; xn; h/ for the special cases when n < 3 or there is no xi with v.xi/ D 0,
so that the above bijection with M0;n  RN is not available. In order to overcome
this technical problem and still give M0.RN; ˙/ the structure of a tropical variety,
there are two possibilities:
(a) One can use barycentric coordinates, taking a certain weighted average of the
vertices of the curve.
(b) One can combine evaluation maps at several non-contracted ends, where at each
such end the evaluations are only taken modulo the direction of the edge to make
them well-deﬁned.
Details on these alternative construction can be found in [24, Section 1.2]. In the
following, we will just assume that M0.RN; ˙/ has the structure of a tropical variety
in any case.
Remark 2.22 (Degree of the Canonical Divisor on Curves) As in Example 2.6, let
X 	 RN be a smooth rational curve or a smooth hypersurface. Consider an n-marked
curve .; x1; : : : ; xn; h/ 2 M0.RN; ˙/ with h. / 	 X, so that h can also be viewed
as a morphism from the (abstract) tropical curve  to X.
We can then consider KX as a divisor on X as in Construction 2.11 and compute
its pull-back hKX according to Remark 2.12. Its degree (as in Construction 2.11 (b))
depends only on X and ˙, and not on h:
(a) If X is a rational curve note that any two points in X are rationally equivalent
divisors in the sense of [2]. Hence the degree of the divisor hP for a point
P 2 X does not depend on P; for a general point P it is just the sum of the
weights of the direction vectors for all edges of  that map some point to P
under h. In particular, taking for P a point far out on an unbounded edge of X,
we see that this degree depends only on ˙ and not on h. It will be called the
degree deg h of h and is the tropical counterpart of the notion of degree of a
morphism between smooth curves in algebraic geometry. The degree of hKX
is now just deg h  deg KX; in particular by the above it depends only on ˙ and
not on h.
(b) If X is a hypersurface in RN a local computation shows that KX D X  X, and
hence by the projection formula the degree of hKX on  is the same as the
degree of h  X on RN. But the 1-cycle h in RN is rationally equivalent to
its so-called recession fan, i.e., the fan obtained by shrinking all bounded edges
to zero length. As this fan is determined by ˙ it follows also in this case that
the degree of hKX depends only on ˙ and not on h.
We will therefore denote the degree of hKX also by KX  ˙.

Moduli Spaces of Curves in Tropical Varieties
267
3
Gluing Moduli Spaces
Throughout this section, let X 	 RN be a smooth rational curve or a smooth
hypersurface as in Example 2.6. Aiming at enumerative applications, we want to
construct tropical analogues of the algebraic moduli spaces of stable maps to a
variety, or in other words generalizations of the tropical moduli spaces M0.RN; ˙/
of Construction 2.18 to other target spaces than RN. The naive approach would
simply be to use the subset
Q
M0.X; ˙/ WD f.; x1; : : : ; xn; h/ 2 M0.RN; ˙/ W h. / 	 Xg
of tropical curves mapping to X. As KX ˙ is independent of the curves in this space
by Remark 2.22, the algebro-geometric analogue tells us that we expect
Q
M0.X; ˙/
to be of dimension dim X Cj˙j3KX ˙ (in fact, this independence is the reason
why we restrict to the curve and hypersurface cases in this paper). However, just
as in the algebraic case, the actual dimension of this space might be bigger, as the
following example shows.
Example 3.1 Let X D L2
1 be the tropical line in R2 as in Example 2.3, and consider
degree-2 covers of X, i.e., ˙ D .e0; e0; e1; e1; e2; e2/. The following pictures show
combinatorial types of tropical curves in
Q
M0.X; ˙/. Edges are labeled with their
weight if it is not 1, and their directions in the picture indicate which cell of X they
are mapped to. The edge drawn with a dashed line is contracted to a point.
Note that in ˛1 and ˛4 the lengths of the bounded edges are not independent, since
in both cases the two horizontal bounded edges adjacent to the origin must have the
same length. Hence the types ˛1, ˛2, and ˛4 are described by 2-dimensional cells

268
A. Gathmann and D. Ochse
in the moduli spaces, whereas ˛3 is 3-dimensional (with ˛2 as one of its faces).
As we expect our tropical moduli space to have dimension 2 (equal to the space of
algebraic degree-2 covers of P1), we see that
Q
M0.X; ˙/ has too big dimension.
Our ﬁrst aim is therefore to deﬁne a suitable subset M0.X; ˙/ of
Q
M0.X; ˙/ of
the expected dimension. We ﬁx the polyhedral complex structure on X to be the
unique coarsest one (which exists since X is smooth), and choose the polyhedral
complex structure on
Q
M0.X; ˙/ as follows.
Notation 3.2 (Curves in X) Let .; x1; : : : ; xn; h/ 2
Q
M0.X; ˙/. In the following,
all isolated points of h1./ for a cell  2 X will be considered as (possibly
additional 2-valent) vertices of  . The interior of every edge of  then maps to
the relative interior of a unique cell of X, and we include this information in the
combinatorial type of a curve in X.
For such a combinatorial type ˛, we denote the set of all curves in
Q
M0.X; ˙/ of
this type by M .˛/. These are partially open polyhedra, and their closures M .˛/
give
Q
M0.X; ˙/ the structure of a polyhedral complex. We write ˇ  ˛ for two
combinatorial types with M .ˇ/  M .˛/, and say in this case that ˛ is a face of ˇ.
If in addition ˇ ¤ ˛ we call ˇ a resolution of ˛.
Notation 3.3 (Local Curves) Let C D .; x1; : : : ; xn; h/ 2
Q
M0.X; ˙/ be a tropical
curve in X, and ﬁx a vertex V of  . We can restrict C to the local situation around
V and obtain the following data, all written with an index V:
(a) The collection of all vectors v.e; V/ for e 3 V as in Construction 2.18 is called
the local degree ˙V of the curve at V.
(b) The star of X at h.V/ will be denoted XV; it is a shifted tropical fan.
(c) By our assumption on X, we know that XV is isomorphic to LkV
rV RmV for unique
kV; rV; mV (where 0 < rV < kV unless .kV; rV/ D .0; 0/). Note that the degree
of the canonical divisor as in Remark 2.22 then splits up as
KX  ˙ D
X
V
KXV  ˙V;
with the sum taken over all vertices of  .
(d) Let CV 2
Q
M0.XV; ˙V/ be the curve in XV with one vertex mapping to h.V/,
and unbounded ends of directions ˙V. We refer to CV as a local curve. Its
combinatorial type ˛V will be called the trivial combinatorial type of V in
Q
M0.XV; ˙V/. We will refer to a resolution of ˛V also as a resolution of V.
Deﬁnition 3.4 Let V 2  be a vertex of a curve .; x1; : : : ; xn; h/ 2
Q
M0.X; ˙/.
Using Notation 3.3, we deﬁne
(a) the virtual dimension of V as vdim.V/ D val.V/  KXV  ˙V C dim X  3,
(b) the resolution dimension of V as rdim.V/ D val.V/  KXV  ˙V C rV  3,
(c) the classiﬁcation number of V as cV D val.V/ C rV.
Example 3.5 Let X D L4
3, and consider the combinatorial types ˛ > ˇ of curves in
X as shown in the picture below. In the type ˇ, the vertex V is mapped to the origin,
and the unbounded ends have directions e0 C e1 C e2 (with weight 6), and twice e3

Moduli Spaces of Curves in Tropical Varieties
269
and e4 (with weight 3). The type ˛ has the same directions of the ends, V1 and V2
map to the origin, and consequently V0 to a positive multiple of e0 C e1 C e2.
We then have vdim.V/ D rdim.V/ D 1, vdim.V1/ D rdim.V1/ D vdim.V2/ D
rdim.V2/ D 0, vdim.V0/ D 3, and rdim.V0/ D 0. Moreover, cV D 8, cV1 D cV2 D
6, and cV0 D 3.
The virtual dimension of a vertex V can be thought of as the expected dimension
of the moduli space of curves in XV Š LkV
rV  RmV of degree ˙V. It includes the
dimension of a lineality space coming from translations in RmV, which is subtracted
from the virtual dimension to obtain the resolution dimension (as can be seen in
the example above for V0, which can locally be moved in its 3-dimensional cell
spanned by e0; e1; e2). The classiﬁcation number of Deﬁnition 3.4 (c) is a useful
number for inductive proofs because it is always non-negative and becomes smaller
in resolutions, as the following lemma shows.
Lemma 3.6 Let ˛ be a resolution of a vertex V of a curve in X. Then the
classiﬁcation number of every vertex W of ˛ is smaller than cV.
Proof Note ﬁrst that cW
 cV since both summands in the deﬁnition of the
classiﬁcation number cannot get bigger when passing from V to W:
(a) As ˛ is a tree, shrinking an edge to zero length will merge two vertices into one,
whose valence is the sum of the original valences minus 2. In particular, since
the trivial combinatorial type of V is obtained from ˛ by a sequence of such
processes, we conclude that val.V/  val.W/, with equality if and only if all
vertices of ˛ except W have valence 2.
(b) If W is mapped to the relative interior of a cone W, we have rW D dim X 
dim W. The analogous statement holds for V, and hence
rV D dim X  dim V  dim X  dim W D rW
since V is a face of W.
If we had equality for both numbers, all vertices W0 of ˛ except W must have valence
2 by (a). Moreover, W and V have to lie in the same cell by (b). Hence ˛ is the same
combinatorial type as the trivial type V after removing all 2-valent vertices W0. But
this means that all two-valent vertices lie in the interior of an edge that is completely

270
A. Gathmann and D. Ochse
mapped to one cell of X. As this is excluded by deﬁnition, there can actually be no 2-
valent vertices. Hence ˛ is the trivial type V, in contradiction to ˛ being a resolution
of V.
ut
The idea to construct the desired moduli spaces of curves in X is now as
follows.
(a) Vertices of negative resolution dimension should not be admitted, since they
correspond (locally, and modulo their lineality space) to an algebraic moduli
space of curves of negative virtual dimension. We will exclude them in
Deﬁnition 3.8. For the case of curves, this corresponds to the Riemann-Hurwitz
condition as e.g., in [6–8, 10].
(b) Vertices of resolution dimension 0 correspond (again locally and modulo their
lineality space) to a 0-dimensional algebraic moduli space. Hence the curves in
the corresponding tropical moduli spaces should not allow any resolutions, i.e.,
these moduli spaces will consist of only one cell, whose weight is the degree of
the algebraic moduli space.
In this paper, we will only consider the tropical situation. The weights of the
cells for vertices of resolution dimension 0 are therefore considered as initial
input data for our constructions, as in Deﬁnition 3.9 below.
(c) Vertices of positive resolution dimension will lead to curves that allow res-
olutions, and whose moduli spaces therefore consider of several cells. These
spaces can be obtained recursively by gluing from the initial ones of (b) using
Construction 3.12, so that no additional input data is required for these cases.
However, as for this paper the initial weights of (b) are arbitrary numbers a
priori, they need to satisfy some compatibility conditions in order for the gluing
process to lead to a well-deﬁned space. These conditions are encoded in the
notion of a good vertex in Deﬁnition 3.11. They are originally formulated in
every resolution dimension; we will see in Corollary 3.18 however that only the
conditions in resolution dimension 1 are relevant since the others follow from
them.
In this recursive construction of the moduli spaces, the following example
shows that the resolution dimension is not necessarily strictly increasing. We
will therefore use the classiﬁcation number for these purposes.
Example 3.7 Consider again two combinatorial types ˛ > ˇ as in Example 3.5,
however in X D L3
2 and with directions as indicated in the following picture.

Moduli Spaces of Curves in Tropical Varieties
271
Then rdim.V/ D rdim.V0/ D rdim.V1/ D 1 and rdim.V2/ D 0, i.e., all
resolution dimensions are non-negative and hence will be admitted. The weight
for the type ˛ will be deﬁned by a gluing procedure over its three vertices in
Construction 3.12. However, V1 has the same resolution dimension as V, so that
a recursive construction over the resolution dimension would not work.
Deﬁnition 3.8 (The Moduli Space M0.X; ˙/ as a Polyhedral Complex)
(a) An admissible combinatorial type of a curve in X is a combinatorial type ˛ such
that for all vertices V in ˛ we have rdim.V/  0.
(b) We denote by M0.X; ˙/ the polyhedral subcomplex of
Q
M0.X; ˙/ consisting of
all closed cells M .˛/ such that ˛ and all its faces are admissible, and
dim M .˛/ D vdimM0.X; ˙/ WD j˙j  KX  ˙ C dim X  3:
Note that this dimension is just vdim.V/ if ˛ is a combinatorial type with just
one vertex V.
(c) The neighborhood of a combinatorial type ˛ in M0.X; ˙/ is deﬁned as
N .˛/ WD
[
ˇ˛
M .ˇ/;
where the union is taken over all combinatorial types ˇ  ˛ in M0.X; ˙/.
In the following, we will apply this deﬁnition also to the case of local curves as in
Notation 3.3, in order to obtain moduli spaces M0.XV; ˙V/.
Example 3.5 shows that faces of admissible types need not be admissible again,
so that the condition of all faces of ˛ being admissible in Deﬁnition 3.8 (b) is not
vacuous.
Deﬁnition 3.9 (Moduli Data) Moduli data for a smooth variety X are a collection
.!V/V of weights in Q for every vertex V of a curve in X with rdim.V/ D 0. All
subsequent constructions and results in this section will depend on the choice of
such moduli data.
Construction 3.10 (Vertices of Resolution Dimension 0) Let V be a vertex of a
local curve in M0.XV; ˙V/. As XV Š LkV
rV  RmV, the trivial combinatorial type
of V in M0.XV; ˙V/ has dimension mV, corresponding to a translation along RmV.
But vdim.V/ D rdim.V/CmV, and thus the trivial combinatorial type is maximal in
M0.XV; ˙V/ if and only if rdim.V/ D 0. In this case, the moduli space M0.XV; ˙V/
consists of only one cell, and we equip it with the weight !V from our moduli data.
To deﬁne the weights on M0.X; ˙/ in general we need Deﬁnition 3.11 and
Construction 3.12, which depend on each other and work in a combined recursion
on the classiﬁcation number of vertices. The following deﬁnition of a good vertex
of a certain classiﬁcation number thus assumes that good vertices of smaller
classiﬁcation number have already been deﬁned. Moreover, for every combinatorial
type ˛ in a local moduli space M0.XV; ˙V/ all of whose vertices have smaller

272
A. Gathmann and D. Ochse
classiﬁcation number and are good it assumes from Construction 3.12 below that
there is a gluing cycle Z .˛/ on the neighborhood N .˛/.
Deﬁnition 3.11 (Good Vertices) Let V be a vertex of a (local) curve in
M0.XV; ˙V/, of classiﬁcation number cV. By recursion on cV, we deﬁne V to
be a good vertex if the following three conditions hold.
(a) Every vertex of every resolution ˛ of V in M0.XV; ˙V/ (which has classiﬁcation
number smaller than cV by Lemma 3.6) is good. (There is then a gluing cycle
Z .˛/ on N .˛/ by Construction 3.12).
(b) M0.XV; ˙V/ is a tropical cycle with the following weights:
•
If rdim.V/ D 0 we equip the unique cell of M0.XV; ˙V/ with the weight
from the moduli data as in Construction 3.10.
•
If rdim.V/ > 0 the maximal types ˛ in M0.XV; ˙V/ are not the trivial
one, i.e., they are resolutions of V. The weights on the corresponding cells
M .˛/ D N .˛/ are then the ones of the gluing cycles Z .˛/ as in (a).
(c) For every resolution ˛ of V in M0.XV; ˙V/ and every maximal type ˇ  ˛ in
M0.XV; ˙V/ (which is then also a resolution of V), the weight of the cell M .ˇ/
is the same in the gluing cycles Z .˛/ and Z .ˇ/.
Construction 3.12 (The Gluing Cycle Z .˛/) Fix a (not necessarily maximal)
combinatorial type ˛ in a moduli space M0.X; ˙/ as in the picture below on the
left, and assume that all its vertices are good. We will now construct a cycle Z .˛/
of dimension vdimM0.X; ˙/ on the neighborhood N .˛/. An important example
of this is when ˛ is a resolution of a vertex in a local moduli space. More technical
details on this construction can be found in [24, Construction 1.5.13].
For each vertex V of ˛ let ı
V be the open cell of X in which V lies, and let
X.V/ D S

V ı 	 X; it is an open neighborhood of V. Similarly, for each edge
e of ˛ let ı
e be the open cell of X in which e lies, and set X.e/ D S

e ı.
First we will construct local moduli spaces MV for each vertex V of ˛. As V is
good the local moduli space M0.XV; ˙V/ is a tropical cycle by Deﬁnition 3.11 (b).
Let M 0
0.XV; ˙V/ be the corresponding moduli cycle of curves with bounded ends,

Moduli Spaces of Curves in Tropical Varieties
273
i.e., the pull-back of M0.XV; ˙V/ under the quotient map that forgets the lengths of
the ends as in Construction 2.20. We denote by
MV D f.; x1; : : : ; xn; h/ 2 M 0
0.XV; ˙V/ W h. / 	 X.V/g
its partially open polyhedral subcomplex of all curves with bounded ends that
lie entirely in X.V/. A typical element of MV is a curve piece as shown in the
picture above on the right. (Note that these pieces might also be resolutions of the
corresponding vertices.)
Now we glue these pieces MV together. For each bounded edge e of ˛, joining
two vertices V1 and V2 (as in the picture), there are corresponding bounded ends in
MV1 and MV2. Let
eve W
Y
V
MV ! X.e/  X.e/
be the evaluation map at these two ends, where the product is taken over all vertices
V of ˛. The product
Y
e
ev
e X.e/
over all pull-backs of the diagonals X.e/ along these evaluation maps as in
Appendix can also be written as the product Q
e ev
e X along the extended
evaluation maps to XX by Remark 4.11. We will therefore abbreviate it by ev X;
it is a cocycle on Q
V MV. The support of the cycle ev X  Q
V MV then consists
of points corresponding to curve pieces that can be glued together to a curve in X,
i.e., so that e.g., the positions of the dots in the picture above coincide.
However, these curve pieces still carry the information about the position of
the gluing points. In order to forget these positions, we take a quotient as follows.
For each bounded edge e of ˛ between two vertices V1 and V2 as above, there are
two vectors uV1 and uV2 in the lineality spaces of MV1 and MV2, respectively, that
parametrize the lengths of these ends as in Constructions 2.16 and 2.17. The vector
ue WD uV1  uV2 is then in the lineality space of Q
V MV, and we denote by L˛ the
vector space spanned by the vectors ue for all bounded edges e of ˛. Let q be the
quotient map by L˛; the quotient q

ev X  Q
V MV

then does not contain the
information about the gluing points any more.
From this cycle we now obtain an injective morphism that considers the curve
pieces as a glued curve in X. It can be deﬁned as
f W q

ev X 
Y
V
MV

! M 0
0;n.RN; ˙/

.di;j/fi;jg2RV; aV
V 7!
 
X
fk;lg2Ri;j
dk;l

fi;jg2R
; aV0
!
;

274
A. Gathmann and D. Ochse
where
•
aV denotes the coordinates of the root vertex in the local moduli space MV for
V, of which we choose V0 as the root vertex in M 0
0;n.RN; ˙/;
•
di;j denotes the distance coordinates on the moduli spaces, with RV and R the
index sets of all pairs of ends in the local moduli spaces MV and the full moduli
space M 0
0;n.RN; ˙/, respectively;
•
Ri;j 	 S
V RV for fi; jg 2 R is the set of all pairs of ends of the local curves in the
moduli spaces MV that lie on the unique path between the ends xi and xj.
The push-forward cycle
Z 0.˛/ WD fq

ev X 
Y
V
MV

WD f
 
q

ev X 
Y
V
MV
!
in M 0
0;n.RN; ˙/ will be called the gluing cycle (with bounded ends) for ˛. Finally,
taking the quotient by the lineality space corresponding to the ends of ˛, we obtain
a gluing cycle Z .˛/ (with unbounded ends) in M0;n.RN; ˙/. The cells of maximal
dimension come with a natural weight in this construction, which we will call the
gluing weight. It is not clear a priori that this weight is independent of the choice of
˛, but it will turn out to be so in Theorem 3.16.
Lemma 3.13 Assume that all vertices occurring in a combinatorial type ˛ in
M0.X; ˙/ are good. Then
dim Z .˛/ D dim X C j˙j  3  KX  ˙:
Proof By deﬁnition we have
Z 0.˛/ D fq

ev X 
Y
V
MV

:
Let s denote the number of vertices V in ˛, so that s  1 is the number of bounded
edges. As the push-forward preserves dimensions, we only have to compute the
dimension of q ev X  Q
V MV
. We have that
dim
Y
V
MV D
X
V
.2 val.V/  KXV  ˙V C dim X  3/
D s dim X  KX  ˙ C
X
V
.val.V/  3/ C
X
V
val.V/
D s dim X  KX  ˙ C 2j˙j  4 C s;
where we used that for a tree the number of vertices equals j˙j2P
V.val.V/3/.
The cycle ev.X/ Q
V MV has codimension .s1/ dim X, and taking the quotient

Moduli Spaces of Curves in Tropical Varieties
275
q eliminates another s  1 dimensions. Passing from Z 0.˛/ to Z .˛/ reduces the
dimension by j˙j, so in total we get
dim Z .˛/ D s dim X  KX  ˙ C 2j˙j  4 C s  .s  1/ dimX  .s  1/  j˙j
D dim X C j˙j  3  KX  ˙:
ut
Lemma 3.14 Assume that all vertices occurring in a combinatorial type ˛ in
M0.X; ˙/ are good. If the gluing cycle Z .˛/ is not zero, the support of Z .˛/
contains M .˛/ and is contained in N .˛/ (so in particular also in M0.X; ˙/).
Proof In the notation of Construction 3.12, consider the set q1. f 1.Z 0.˛// of all
curve pieces that glue to the combinatorial type ˛. Under each evaluation map eve,
this set maps to the lineality space of X.e/ in X.e/  X.e/. The functions used for
cutting out the diagonal in Construction 4.8 all contain this lineality space in their
own lineality space, so their pull-backs are linear on the above set and hence do not
subdivide it. These properties are preserved under push-forward with f and taking
the quotient q, and thus Z .˛/ contains all of M .˛/ if it is non-zero.
By construction, the other points in the gluing cycle Z .˛/ correspond to curves
obtained by resolving each vertex of ˛, and thus to resolutions of ˛. Hence, Z .˛/
is contained in the union of all neighboring cells of M .˛/, and thus by Lemma 3.13
in N .˛/.
ut
Deﬁnition 3.15 (The Moduli Space M0.X; ˙/ as a Weighted Polyhedral Com-
plex) Assume that all vertices occurring in curves in M0.X; ˙/ are good. By
Lemmas 3.13 and 3.14, each maximal cell ˛ of M0.X; ˙/ is also a maximal cell
in the gluing cycle Z .˛/. We deﬁne the weight of this cell of M0.X; ˙/ to be the
corresponding gluing weight of Construction 3.12.
The aim of this section is to show that these weights make M0.X; ˙/ into a
tropical variety, i.e., balanced, if all vertices of resolution dimension 1 are good.
Examples can be found in Sect. 4 and [17].
Theorem 3.16 Assume that all vertices in a combinatorial type ˛ in M0.X; ˙/ are
good. If ˇ is a resolution of ˛ in M0.X; ˙/ (so that in particular N .ˇ/ 	 N .˛/)
then the weight of every maximal cell in the gluing cycle Z .ˇ/ in N .ˇ/ agrees
with the weight of the same cell in Z .˛/ in N .˛/.
In particular, if ˛ is of virtual codimension 1 then the cycle M0.X; ˙/ with the
weights of Deﬁnition 3.15 is balanced at ˛.
Proof This is basically a straight-forward reduction proof; however, we have to pay
attention to several intersection-theoretical details. We start by describing the gluing
cycle Z 0.ˇ/ as in Construction 3.12. For every vertex V of ˛, let JV be the set of
vertices of ˇ that degenerate to V in ˛, so that [VJV is the set of all vertices of
ˇ. We denote by EV X the product over all pull-backs of the diagonals along
evaluation maps belonging to the edges of ˇ, by Q the quotient map on EV X 
Q
V
Q
W2JV MW forgetting the gluing points along the bounded edges, and by F the

276
A. Gathmann and D. Ochse
morphism embedding the resulting cycle to M 0
0.X; ˙/. Then by Construction 3.12
the gluing cycle Z 0.ˇ/ is given by
Z 0.ˇ/ D FQ

EV X 
Y
V
Y
W2JV
MW

;
where the ﬁrst product is taken over all vertices V of ˛. We will now decompose
the maps Q, F, and EV into contributions coming from the vertices of ˛ as follows.
For each vertex V of ˛, let IV be the set of bounded edges of ˇ contracting to V in
˛. We denote by qV the quotient map that forgets the gluing points on these edges,
and by fV the morphism that embeds the cycle Q
g2IV ev
g X  Q
W2JV MW in the
local moduli space M 0
0.XV; ˙V/. Furthermore, denote by q and f the quotient and
embedding maps for the gluing cycle for ˛, respectively. With Qq D Q
V qV and
Qf D Q
V fV we can then write
Z 0.ˇ/ D fq

QfQq
 Y
e
ev
e X 
Y
V
Y
g2IV
ev
g X 
Y
V
Y
W2JV
MW

;
by Lemma 2.15, with the product over e running over all edges of ˛. By the
compatibility of push-forwards and quotient maps with diagonal pull-backs (see
Lemma 4.9), we may rewrite this as
Z 0.ˇ/ D fq
 Y
e
ev
e X  QfQq
 Y
V
Y
f2IV
ev
f X 
Y
V
Y
W2JV
MW

D fq

ev X 
Y
V
fVqV
 Y
f2IV
ev
f X 
Y
W2JV
MW

„
ƒ‚
…
DW
Q
MV

;
()
where ev X is the product over all pull-backs of the diagonals along evaluation
maps belonging to edges of ˛. But now all vertices V of ˛ are good by assumption,
and therefore by Deﬁnition 3.11 the weights of all maximal cells in the gluing cycle
Q
MV agree with those of MV. Hence
Q
MV is an open subcycle of MV, and as () is
just the gluing construction for ˛ we conclude that every maximal cell of Z 0.ˇ/
has the same weight in Z 0.˛/. Of course, this property is preserved when passing
to unbounded ends in Z .ˇ/ and Z .˛/.
In particular, if ˛ is of virtual codimension 1 and thus ˇ of virtual codimension
0 in M0.X; ˙/, we see that the cycle M0.X; ˙/ is locally around ˛ given by the
cycle Z .˛/, and thus balanced.
ut
Corollary 3.17 If all vertices that can appear in combinatorial types in M0.X; ˙/
are good, then M0.X; ˙/ is a tropical variety of dimension
dim M0.X; ˙/ D dim X C j˙j  3  KX  ˙
with the weights of Deﬁnition 3.15.

Moduli Spaces of Curves in Tropical Varieties
277
Proof Apply Theorem 3.16 to all combinatorial types of codimension 1.
ut
So in order to obtain a tropical variety M0.X; ˙/ from gluing we will have to
show that all vertices are good with respect to our given moduli data. The following
result tells us that we only have to do this in resolution dimension 1.
Corollary 3.18 If all vertices V with rdim.V/ D 1 in a given moduli space are
good, then all vertices are good.
Proof Let V be a vertex in a given moduli space, with XV Š LkV
rV  RmV. We will
prove the statement of the lemma by induction on the classiﬁcation number cV.
If rdim.V/ D 0 then V does not admit any resolution in M0.X; ˙/ by Construc-
tion 3.10, and hence V is good. If rdim.V/ D 1 then V is good by assumption.
We can therefore assume that rdim.V/ > 1. By Deﬁnition 3.4 this means that
vdim.V/ is at least by 2 bigger than the dimension mV of the lineality space in
M0.XV; ˙V/ coming from translations, and hence all combinatorial types ˛ of
virtual codimension 1 in M0.XV; ˙V/ correspond to (non-trivial) resolutions of V.
Condition (a) of Deﬁnition 3.11 of a good vertex now follows by induction on
cV, condition (b) by Theorem 3.16 applied to all these cells of virtual codimension
1, and condition (c) by Theorem 3.16 applied to all resolutions ˛ and maximal cells
ˇ>˛.
ut
Taking Corollaries 3.17 and 3.18 together, we thus see that in order to obtain
a well-deﬁned moduli space M0.X; ˙/ we only have to check that all vertices of
resolution dimension 1 are good.
4
Moduli Spaces of Lines in Surfaces
In this section we want to construct the moduli spaces M0.X; 1/ of lines in a surface
X 	 R3. By Corollary 3.17, the dimension of these spaces is the same as in the
classical case, namely 3degX. So it is empty for deg X > 3, and we obtain a ﬁnite
number of lines counted with multiplicities for deg X D 3.
Let us consider all possible local situations in such a surface. We want to use
decorations on the graph of the line to describe the vertices, as introduced in [30]: A
bold dot indicates that the line passes through a vertex of X and a bold line indicates
that the line passes through an edge of X. This leads to the following combinatorial
possibilities.
Here the difference between the last two decorations is that either one edge of
the line lies on the edge of X (which is indicated by the dashed line in the last
picture), or all edges of the line point into maximal cells of X (which is indicated by
the second picture from the right). Note that the pictures above do not specify the

278
A. Gathmann and D. Ochse
combinatorial type completely, as there are in general several possibilities for the
directions of the ends.
Remark 4.1 (Local Degrees) If d D deg X then KX  ˙ D d for the degree ˙
of a line. This means that every local degree KXV  ˙V at a vertex V can be at
most d  3. Moreover, as V has to be admissible, i.e., must satisfy rdim.V/  0,
Deﬁnition 3.4 (b) implies that val.V/  KXV ˙V C1 for the bold dot decorations and
val.V/  KXV ˙VC2 for the bold line decorations. This leaves us with the following
table, which lists the resolution dimensions of the possible types, and a name of the
type in brackets. Impossible types are marked with “X”. (The case above type (H)
is excluded since there would have to be a maximal cell of X containing two of the
four edges, and hence KXV  ˙V cannot be 1.)
Construction 4.2 (Moduli Data for Resolution Dimension 0) For the vertices
V of resolution dimension 0 in Remark 4.1, we have to deﬁne moduli data as in
Deﬁnition 3.9. We will ﬁx this according to the situation in algebraic geometry as
follows. Assume ﬁrst that V lies on a vertex of X, so that XV Š L3
2 after an integer
linear isomorphism. Let ˙ D .P3
iD0 ˛ j
i ei/jD1;:::;n with ˛ j
i  0 be the degree of ˙,
where n D val.V/.
We then consider four planes H0; H1; H2; H3 in P3 in general position and
count rational algebraic stable maps .C; x1; : : : ; xn; f/ relative to these planes with
intersection proﬁles .˛ j
i /jD1;:::;n at Hi for all i. Their (ﬁnite) number will be the
weight that we assign to the vertex V. In more complicated cases when this
number is inﬁnite, we expect that the corresponding (virtual) relative Gromov-
Witten invariant would be the correct choice here, but for our situation at hand this
problem does not occur.
If V lies on an edge of X, we assign a weight to V analogously after projecting
XV Š L2
1  R to L2
1.
Here are two examples:
(a) For type (A) in the table above the only possible degree is ˙ D .e0 C e1; e2 C
e3/ up to permutations, corresponding to lines in P3 passing to the two points
H0 \ H1 and H2 \ H3. As there is exactly one such line, we assign to (A) the
weight 1.
(b) For type (G) there are several possible degrees; as an example we will consider
˙ D .3e0C2e1; e1Ce2; e2Ce3; e2C2e3/, and thus count maps with f H0 D 3x1,
f H1 D 2x1 C x2, f H2 D x2 C x3 C x4, f H3 D x3 C 2x4 (in the Chow groups
of the corresponding f 1.Hi/). Such a map would have to send x1 to H0 \ H1,

Moduli Spaces of Curves in Tropical Varieties
279
and x3 and x4 to H2 \ H3. As f H0 only contains x1 and f H3 only contains x3
and x4, the curve would have to lie completely over the line through those two
points. But then x2 would have to map to both of these points simultaneously,
which is impossible. Hence we assign the weight 0 to this type.
Remark 4.3 (Conditions in Resolution Dimension 1) As the next step, we have to
verify that, with the given moduli data, all vertices of resolution dimension 1 are
good. To show the general procedure will sketch this here for type (F), more details
and the other cases can be found in [24, Section 3.3].
Note that the rays in this type must satisfy exactly the same linear relation as the
rays of a tropical line. Also, none of the three possible resolutions is allowed to have
a bounded edge of higher weight, as this does not occur for lines. It is checked imme-
diately that this leaves only the degree ˙ D .2e0Ce1; e1Ce3; e2; e2Ce3/, up to iso-
morphism. It is shown in the picture below, together with its three resolutions in X.
In order to embed the local moduli space into M0;4R3, we evaluate the position
of x3 in R2 Š R3=he2i with coordinate directions e1 and e3, and the position of x2
in R Š R3=he1; e3i with coordinate direction e2 (see Remark 2.21). Then the rays
of the local moduli space are spanned by the vectors vf1;3g C e1  e3, vf1;4g C e3,
and vf1;2g  e1 (in the notation of Construction 2.16) for the three resolutions below,
respectively. This is balanced with weights one, which are actually the gluing
weights.

280
A. Gathmann and D. Ochse
From Corollaries 3.17 and 3.18 we therefore conclude:
Corollary 4.4 With the moduli data of Construction 4.2, the moduli space
M0.X; 1/ of lines in a tropical surface X 	 R3 is a tropical variety of dimension
dim M0.X; 1/ D 3  deg X
(and empty if deg X > 3). In particular, this moduli space consists of ﬁnitely many
(weighted) points if deg X D 3.
Example 4.5 (Inﬁnitely Many Lines in a Tropical Cubic Surface [31]) Consider a
ﬂoor-decomposed generic cubic surface where the three walls (represented by a line,
a conic and a cubic) have the following relative position to each other, projected in
the e3-direction:
Such a cubic surface contains exactly 27 isolated lines that count with multiplic-
ity 1. In addition, it has a 1-dimensional family of lines not containing any of the
others. All lines in this family have a vertex mapping to the point V shown above,
while the rest of them is mapped to maximal cells of X. General lines in this family
are therefore decorated as in the following picture.
If the vertex mapped to V is 3-valent, it has to be of resolution dimension 1.
Therefore the only admissible line in this family, i.e., the only line in the family
actually in M0.X; 1/, is the one with no bounded edge, i.e., with a 4-valent vertex
mapping to V. This vertex is then of resolution dimension 0. To determine its type,
we map the four rays of the cubic at V, which are e1 Ce3, e1 2e3, e2 2e3, and

Moduli Spaces of Curves in Tropical Varieties
281
e2 C 3e3, by an integer linear isomorphism to the four unit vectors. This maps the
rays of the line to the degree ˙ D .3e0 C2e1; e1 Ce2; e2 Ce3; e2 C2e3/. As this line
has weight 0 by Construction 4.2 (b), we conclude that the whole family does not
contribute to the virtual number, and the degree of the 0-cycle M0.X; 1/ is again 27.
We therefore conjecture:
Conjecture 4.6 For every smooth cubic surface X 	 R3 the 0-cycle M0.X; 1/ has
degree 27.
Appendix: Pulling Back the Diagonal of a Smooth Variety
Let X be a partially open tropical cycle, and let Y be a smooth tropical variety. In
order to glue moduli spaces in Sect. 3 we need the pull-back of the diagonal Y of
Y by some morphism f W X ! Y  Y. But although the diagonal is locally a product
of Cartier divisors in this case, tropical intersection theory unfortunately does not
yet provide a well deﬁned pull-back for it. This appendix therefore contains the
technical details necessary to construct a well-deﬁned pull-back cycle f Y.
First we briefly review some facts about matroids and matroid fans from [14].
Let M be a matroid of rank r on a ﬁnite ground set E. To every ﬂat F of M we
associate a vector eF WD P
i2F ei 2 RE, where the ei are the negative standard basis
vectors. Correspondingly, to every chain of ﬂats ; ¨ F1 ¨    ¨ Fs D E we assign
a cone, spanned by eF1; : : : ; eFs, and eFs. Let B.M/ denote the collection of all
these cones, where the maximal ones are equipped with weight 1. This simplicial
fan deﬁnes a tropical variety B.M/ whose dimension is the rank of M. We call it the
matroid fan associated to M.
Of special interest to us is the uniform matroid Ur;k on a ground set E of
cardinality k, with rank function r.A/ D min.jAj; r/. Its associated matroid fan is
B.Ur;k/ Š Lk1
r1  R.
Construction 4.7 By François and Rau [14, Section 4] the diagonal B.M/ in
B.M/  B.M/ can be cut out by a product of rational functions: we have B.M/ D
'1     'r .B.M/B.M// for the rational functions 'i linear on the cones of B.M/
determined by
'i.eA; eB/ D
 1 if rM.A/ C rM.B/  rM.A [ B/  i;
0 else
for ﬂats A; B of M, where rM is the rank function of M. Moreover, recursively
intersecting with the 'i yields a matroid fan in each intermediate step, hence a
locally irreducible tropical variety; this will be important in the construction. If we
want to specify the matroid M in the notation, we will write 'i also as 'M
i .
We can now give the construction to pull back the diagonal from a smooth
tropical fan.

282
A. Gathmann and D. Ochse
Construction 4.8 Consider a morphism f W X ! Y  Y where Y Š Lk1
r1  Rm.
Then there is a (non-canonical) isomorphism  W Y  R ! B.M/  Rm, where
M D Ur;k, and  maps the additional factor R onto the lineality space of the matroid
fan. Associated to f we denote by Qf the composition map
X  R2
fid
!
Y  Y  R2
Š
.Y  R/  .Y  R/

!
B.M/2  .Rm/2:
Let  1; : : : ;  m denote functions which cut out the diagonal Rm, and consider the
cocycle
˚Y WD '1      'r   1       m
on B.M/2  .Rm/2;
where 'i are the functions on B.M/2 from Construction 4.7 above. One veriﬁes
immediately that the pull-back Qf ˚Y.XR2/ has the lineality space LX WD 0R in
XR2. So we can take the quotient by LX and use the projection pX W .XR2/=L !
X to deﬁne
f Y WD f Y  X WD pX

.Qf ˚Y  .X  R2//=LX

:
As the intermediate steps in Construction 4.7 are locally irreducible, it follows from
[12, Lemma 3.8.13] that the support of Qf ˚Y  .X  R2/ lies over the diagonal of
R in R2 (so that pX is injective on .Qf ˚Y  .X  R2//=LX, in accordance with our
convention in Remark 2.12), and that the support of f Y lies in f 1.Y/.
Moreover, it can be shown that this deﬁnition depends neither on the choice
of  1; : : : ;  m [13, Theorem 2.25] nor on the choice of isomorphism  [24,
Lemma 1.4.3]. However, it is not known whether it depends on the choice of the
rational functions '1; : : : ; 'r cutting out the diagonal of B.M/.
Let us briefly state the main properties of this deﬁnition that follow from the
compatibilities between the various intersection-theoretic constructions.
Lemma 4.9
(a) (Projection formula) For two morphisms Z
g
! X
f
! Y  Y, where g is
injective and Y a smooth fan, we have
g

. f ı g/Y  Z

D f Y  gZ:
(b) (Quotients) Let X be a partially open tropical variety with lineality space L and
quotient map q W X ! X=L, and let f W X=L ! Y  Y be a morphism for a
smooth fan Y. Then
q

. f ı q/Y  X

D f Y  .X=L/:

Moduli Spaces of Curves in Tropical Varieties
283
(c) (Commutativity) For two morphisms f W X ! Y  Y and g W X ! Z  Z to
smooth fans Y and Z we have
f Y 

gZ  X

D gZ 

f Y  X

:
(d) (Projections) Let X and Z be partially open tropical varieties, and denote by
p W X  Z ! X the projection. For any morphism f W X ! Y  Y for a smooth
fan Y we have
. f ı p/Y  .X  Z/ D . f Y  X/  Z:
(e) (Products) Let f W X ! Y  Y and f 0 W X0 ! Rk  Rk be two morphisms, for a
smooth fan Y. Then
. f  f 0/YRk  .X  X0/ D . f Y  X/  . f 0Rk  X0/:
Proof All these statements can be checked immediately, see [24, Section 1.4] for
details. As an example, we show part (a): We have
g Œ. f ı g/Y 	 Z D gpZ
he
f ı g
˚Y 	 .Z  R2/

=LZ
i
D pX.g  id/

.g  id/Qf ˚Y 	 .Z  R2/

=LZ

(functoriality)
D pX

.g  id/.g  id/Qf ˚Y 	 .Z  R2/

=LX

(Lemma 2.15)
D pX
 Qf ˚Y 	 .g.Z/  R2/

=LX

(projection formula)
D f Y 	 g.Z/;
where we have used the projection formula for cocycles as in [13, Proposition 2.24
(3)].
ut
So far Y Š Lk1
r1  Rm was assumed to be a smooth fan. In order to generalize
this to smooth varieties we need the following compatibility statement. Let  be a
cell of Y in the coarsest subdivision, with relative interior ı. We consider both 
and ı as subsets of the diagonal Y 	 Y  Y. Let Y./ be the union of all open
cells in the matroid subdivision of Y  Y whose closure intersects ı, which is then
an open neighborhood of ı in Y  Y. It is also contained in Y  Y, where Y is
the star of Y at . As Y is again a smooth fan, we can regard the restriction of f to
X WD f 1.Y.// also as a morphism f W X ! Y Y, and apply Construction 4.8
to this map. As expected, we will now show that over the cell  this gives the same
result as for f W X ! Y  Y.
Lemma 4.10 (Compatibility) Let f W X ! Y  Y be a morphism, with Y a smooth
fan. Moreover, let  be a cell in the coarsest subdivision of Y. With notations as
above, the weights of f Y  X and f 
 Y  X then agree on all cells of X whose
interior is mapped by f to the cell ı in the diagonal Y.

284
A. Gathmann and D. Ochse
Proof Let Y Š Lk1
r1  Rm, and let M D Ur;k be the corresponding uniform matroid
on E D f1; : : : ; kg, so that Y  R Š B.M/  Rm. The cell  then corresponds to
a subset S 	 E, i.e., it consists of all cells in the matroid subdivision for chains of
ﬂats in S. If dim  D s then Y Š Lks1
rs1  RmCs, or more precisely Y  R Š
B.MS/  Rs  Rm, where MS is the uniform matroid of rank r  s on EnS.
As Construction 4.8 is local, it sufﬁces to show that the rational functions cutting
out the diagonal in this construction are the same for the spaces Y  Y  R2 Š
B.M/2  .Rm/2 and Y  Y  R2 Š B.MS/2  .Rs/2  .Rm/2 when restricted to
the common open neighborhood Y./  R2 of the cell ı  R in the diagonal. For
this we need to prove that these rational functions agree on all rays of Y./. As
.eS; eS/ is the only interior ray of ı  R, the maximal cells of Y./ correspond to
maximal chains of ﬂats in M ˚ M containing .S; S/, and hence we have to compare
the rational functions of Constructions 4.7 and 4.8 on all rays .eA; eB/ for ﬂats A; B
of M with A; B 	 S or A; B  S.
The functions cutting out the diagonal of Rm can obviously be chosen to be the
same in both cases. By Construction 4.7, the others are 'M
1 ; : : : ; 'M
k for B.M/2, and
'MS
1 ; : : : ; 'MS
ks and 'S
1; : : : ; 'S
s for B.MS/2  .Rs/2 (where S stands for the uniform
matroid of full rank on S, so that 'S
1; : : : ; 'S
s can be used to cut out the diagonal of
Rs). Now, on the rays .eA; eB/ mentioned above ...
•
'M
i agrees with 'MS
is for i D s C 1; : : : ; k:
If A; B 	 S then both rM.A/ C rM.B/  rM.A [ B/  i and rMS.AnS/ C
rMS.BnS/  rMS..A [ B/nS/  i  s are never satisﬁed.
If A; B  S then rM.A/ D rMS.AnS/ C s, and similarly for B and A [ B. Hence
rM.A/CrM.B/rM.A[B/  i is equivalent to rMS.AnS/CrMS.BnS/rMS..A[
B/nS/  i  s.
•
'M
i agrees with 'S
i for i D 1; : : : ; s:
If A; B 	 S then rM.A/ C rM.B/  rM.A [ B/  i is equivalent to rS.A \ S/ C
rS.B \ S/  rS..A [ B/ \ S/  i.
If A; B  S then both rM.A/ C rM.B/  rM.A [ B/  i and rS.A \ S/ C rS.B \
S/  rS..A [ B/ \ S/  i are always satisﬁed.
ut
Remark 4.11 (Pullbacks of Diagonals of Smooth Varieties) Lemma 4.10 implies
that we cannot only pull back diagonals of smooth fans, but also of smooth varieties:
Let f W X ! Y  Y be a morphism from a partially open tropical cycle to a smooth
tropical variety.
To assign a weight to a cell  of dimension dim X  dim Y over the diagonal Y,
let  be the cell in Y Š Y so that the relative interior of  maps to the relative
interior of . Choose any face 0 of  (which might be  itself), replace Y by the
star Y0 at this face and X by the open subcycle of X consisting of all points mapping
to 0 or any of its adjacent open cells in both components of Y  Y, and assign to 
its weight in the cycle f 
0Y0  X0. By Lemma 4.10 the result does not depend on
the choice of 0.
Using the same local procedure for a cell  of dimension dim X  dim Y  1, we
obtain a balanced cycle f 
0Y0 X0 including all adjacent cells of dimension dim X
dim Y. Hence our local construction glues to give a well-deﬁned cycle f Y  X.

Moduli Spaces of Curves in Tropical Varieties
285
References
1. L. Allermann, Tropical intersection products on smooth varieties. J. Eur. Math. Soc. 14(1),
107–126 (2012)
2. L. Allermann, J. Rau, First steps in tropical intersection theory. Math. Z. 264(3), 633–670
(2010)
3. K. Behrend, Gromov-Witten invariants in algebraic geometry. Invent. Math. 127(3), 601–617
(1997)
4. K. Behrend, B. Fantechi, The intrinsic normal cone. Invent. Math. 128, 45–88 (1997)
5. K. Behrend, Y. Manin, Stacks of stable maps and Gromov-Witten invariants. Duke Math. J.
85(1), 1–60 (1996)
6. B. Bertrand, E. Brugallé, G. Mikhalkin, Tropical open Hurwitz numbers. Rend. Semin. Math.
Univ. Padova 125, 157–171 (2011)
7. E. Brugallé, H. Markwig, Deformation of tropical Hirzebruch surfaces and enumerative
geometry. J. Algebraic Geom. 25(4), 633–702 (2016)
8. L. Caporaso, Gonality of algebraic curves and graphs. Springer Proc. Math. Stat. 71, 77–108
(2014)
9. L. Caporaso, J. Harris, Counting plane curves of any genus. Invent. Math. 131, 345–392 (1998)
10. R. Cavalieri, H. Markwig, D. Ranganathan, Tropicalizing the space of admissible covers. Math.
Ann. 364, 1275–1313 (2016)
11. E.M. Feichtner, B. Sturmfels, Matroid polytopes, nested sets and Bergman fans. Port. Math.
62, 437–468 (2005)
12. G. François, Tropical intersection products and families of tropical curves. Ph.D. Thesis, TU
Kaiserslautern, 2012
13. G. François, Cocycles on tropical varieties via piecewise polynomials. Proc. Am. Math. Soc.
141, 481–497 (2013)
14. G. François, J. Rau, The diagonal of tropical matroid varieties and cycle intersections. Collect.
Math. 64(2), 185–210 (2013)
15. W. Fulton, R. Pandharipande, Notes on stable maps and quantum cohomology, in Algebraic
Geometry, Santa Cruz 1995, ed. by J.K. et al. Proceedings of Symposia in Pure Mathematics,
vol. 62 (American Mathematical Society, Providence, 1997), pp. 45–96
16. A. Gathmann, M. Kerber, H. Markwig, Tropical fans and the moduli space of rational tropical
curves. Compos. Math. 145(1), 173–195 (2009)
17. A. Gathmann, H. Markwig, D. Ochse, Tropical moduli spaces of stable maps to a curve, in
Algorithmic and Experimental Methods in Algebra, Geometry, and Number Theory, ed. by G.
Böckle, W. Decker, G. Malle (Springer, Heidelberg, 2018). https://doi.org/10.1007/978-3-319-
70566-8_12
18. E. Gawrilow, M. Joswig, polymake: a framework for analyzing convex polytopes, in Polytopes:
Combinatorics and Computation, ed. by G. Kalai, G.M. Ziegler (Birkhäuser, Basel, 2000),
pp. 43–74
19. S. Hampe, A-tint: a polymake extension for algorithmic tropical intersection theory. Eur. J.
Comb. 36C, 579–607 (2014)
20. M. Kontsevich, Enumeration of rational curves via torus actions,
in The Moduli Space of
Curves (Texel Island 1994) (Birkhäuser, Basel, 1995), pp. 335–368
21. G. Mikhalkin, Enumerative tropical geometry in R2. J. Am. Math. Soc. 18, 313–377 (2005)
22. G. Mikhalkin, Tropical geometry and its applications, in International Congress of Mathemati-
cians, vol. II (European Mathematical Society, Zürich, 2006), pp. 827–852
23. G. Mikhalkin, Moduli spaces of rational tropical curves, in Proceedings of Gökova Geometry-
Topology Conference (GGT) 2006 (2007), pp. 39–51
24. D. Ochse, Moduli spaces of rational tropical stable maps into smooth tropical varieties. Ph.D.
Thesis, TU Kaiserslautern, 2013
25. J. Richter-Gebert, B. Sturmfels, T. Theobald, First steps in tropical geometry, in Idempotent
Mathematics and Mathematical Physics, Proceedings Vienna (2003)

286
A. Gathmann and D. Ochse
26. K. Shaw, Tropical intersection theory and surfaces. Ph.D. Thesis, Université de Genève, 2011
27. K. Shaw, A tropical intersection product in matroidal fans. SIAM J. Discrete Math. 27(1),
459–491 (2013)
28. D. Speyer, B. Sturmfels, The tropical Grassmannian. Adv. Geom. 4, 389–411 (2004)
29. The GAP Group, GAP – Groups, Algorithms, and Programming, Version 4.8.6 (2016). http://
www.gap-system.org
30. M. Vigeland, Tropical lines on smooth tropical surfaces (2007). ArXiv: 0708.3847
31. M.D. Vigeland, Smooth tropical surfaces with inﬁnitely many tropical lines. Ark. Mat. 48(1),
177–206 (2010)
32. T.Y. Yu, Tropicalization of the moduli space of stable maps. Math. Z. 281(3), 1035–1059
(2015)

Tropical Moduli Spaces of Stable Maps
to a Curve
Andreas Gathmann, Hannah Markwig, and Dennis Ochse
Abstract We construct moduli spaces of rational covers of an arbitrary smooth
tropical curve in Rr as tropical varieties. They are contained in the balanced fan
parametrizing tropical stable maps of the appropriate degree to Rr. The weights of
the top-dimensional polyhedra are given in terms of certain lattice indices and local
Hurwitz numbers.
Keywords Tropical geometry • Enumerative geometry • Gromov-Witten theory
Subject Classiﬁcations 14T05, 14N35, 51M20
1
Introduction
Tropical enumerative geometry has developed from interesting applications fol-
lowing so-called correspondence theorems which settle the equality of certain
enumerative numbers in algebraic geometry to their tropical counterparts [22].
There is an ongoing effort to put the striking similarities between algebro-geometric
and tropical enumerative geometry onto a more solid ground.
Modern enumerative algebraic geometry is based on the moduli spaces
Mg;n.X; ˇ/ of n-pointed stable maps of genus g and class ˇ to a smooth projective
variety X [15], together with their virtual fundamental classes [3, 4] that resolve
the issues arising when these spaces are not of the expected dimension. Hence a
key ingredient for the further development of tropical enumerative geometry is the
A. Gathmann • D. Ochse
Fachbereich Mathematik, Technische Universität Kaiserslautern, Postfach 3049,
67653 Kaiserslautern, Germany
e-mail: andreas@mathematik.uni-kl.de; ochse@mathematik.uni-kl.de
H. Markwig ()
Fachbereich Mathematik, Eberhard Karls Universität Tübingen, Auf der Morgenstelle 10,
72076 Tübingen, Germany
e-mail: hannah@math.uni-tuebingen.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_12
287

288
A. Gathmann et al.
construction of tropical analogues of these concepts. If g D 0 and X is a toric
variety, corresponding to rational tropical curves in Rr, such tropical spaces have
been constructed as balanced fans in [17]. In this case, ideas relating to virtual
fundamental classes are not needed, and the intersection theory of the resulting
spaces recovers the correspondence theorems for rational tropical curves in Rr [19].
For more general target spaces, we run into the same problems as in algebraic
geometry: the naively deﬁned spaces of tropical curves in a tropical variety are
usually not of the expected dimension, maybe not even pure-dimensional. However,
as there is no general theory of virtual fundamental classes in tropical geometry
yet, the tropical approach to this problem is different: right from the start we have
to construct the moduli spaces as balanced polyhedral complexes of the expected
dimension—which necessarily means that they are not just the spaces of maps from
a tropical curve to the given target. From an algebro-geometric point of view, one
could say that this constructs the moduli space and its virtual fundamental class
at the same time, with the additional beneﬁt that (in accordance with the general
philosophy of tropical intersection theory) we actually obtain a virtual cycle and not
just a cycle class.
A general approach how this idea might be realized has been presented in [16].
Here, we will restrict ourselves to the case when g D 0 and the target is a smooth
(rational) tropical curve L in Rr. The resulting moduli spaces M0;n.L; ˙/ (where ˙
is a degree of tropical curves as in Deﬁnition 2.4) then describe rational covers of a
rational smooth tropical curve.
Tropical covers and tropical Hurwitz numbers (i.e. enumerative numbers count-
ing covers with prescribed properties [5, 10]) are useful e.g. for the study of the
structural behavior of Hurwitz numbers [11] and in the tropical enumeration of
Zeuthen numbers [6]. Spaces of tropical (admissible) covers have been studied
in [12] as tropicalizations of corresponding algebro-geometric spaces, in terms
of a tropicalization map on the Berkovich analytiﬁcation. The space of tropical
covers of R has been described in [13] as tropicalization of the open part of a
suitable space of relative stable maps (whose compactiﬁcation is then realized as
a tropical compactiﬁcation deﬁned by the tropical moduli space). The present work
complements this point of view by ﬁxing a rational smooth tropical curve L 	 Rr,
restricting to genus 0 covers, and embedding the abstract polyhedral subcomplex of
the abstract cone complex described in [12] as a balanced polyhedral subcomplex.
In this way, we make these moduli spaces accessible to the current state of the art of
tropical intersection theory.
As mentioned above, to construct the moduli spaces M0;n.L; ˙/ we cannot just
take the subset of M0;n.Rr; ˙/ consisting of all stable maps whose image lies in
L, as this would yield a non-pure subcomplex with strata of too big dimension.
Instead, we have to incorporate the so-called Riemann-Hurwitz condition (see
Deﬁnition 3.2), which implies the algebraic realizability of the corresponding
maps. For an example, let L 	 R2 be the standard tropical line, let ˙ be the
degree consisting of the directions .1; 0/; .1; 0/; .0; 1/; .0; 1/; .2; 2/, and set
n D 0. A fan curve in L of this degree—in fact representing the origin of the fan
M0;0.L; ˙/—is shown in picture (a) below. It is given by a map from an abstract

Tropical Moduli Spaces of Stable Maps to a Curve
289
star curve with 5 ends to L, with the directions and weights on the ends as indicated
in the picture.
2
1
1
1
1
2
1
1
2
2
1
1
2
1
1
2
1
1
2
1
1
1
1
(d)
(a)
(b)
(c)
1
1
Possible resolutions of this curve in L are shown in (b), (c), and (d). However,
case (b) is excluded in M0;0.L; ˙/ as its central vertex violates the Riemann-
Hurwitz condition: it would correspond to an algebraic degree-2 cover of the
projective line by itself with three ramiﬁcation points of order 2, which does not
exist. In contrast, the combinatorial types (c) and (d) are allowed, and represent two
rays in M0;0.L; ˙/ since they describe 1-dimensional families of curves. They both
have a similar type obtained by symmetry: in (c) the bounded weight-2 edge could
also be on the horizontal edge of L, and in (d) there are two choices how to group the
weight-1 ends. In total, this means that M0;0.L; ˙/ is a 1-dimensional fan with four
rays. The weights that we will construct on these rays incorporate the triple Hurwitz
numbers corresponding to the local degrees of the maps at each point mapping to
the vertex of L; they all turn out to be 1 here. In this example, it is then easy to
check explicitly that M0;0.L; ˙/ 	 M0;0.R2; ˙/ Š M0;5  R2 is indeed balanced.
Our main result on the moduli spaces M0;n.L; ˙/ is that this construction works in
general:
Theorem 1.1 Let L be a smooth tropical curve in Rr and ˙ a degree of tropical
stable maps to L (see Deﬁnitions 2.4 and 3.3). Then the space M0;n.L; ˙/
(with weights deﬁned in terms of local Hurwitz numbers) is a balanced weighted
polyhedral subcomplex of M0;n.Rr; ˙/ of pure dimension
j˙j  deg.˙/ 
 X
W2L
.val.W/  2/

 2:
We expect that M0;n.L; ˙/ is in fact the tropicalization of (relevant parts) of the
corresponding algebro-geometric moduli space.
Theorem 1.1 is proved in two major steps: the ﬁrst being the treatment of
1-dimensional moduli spaces of the form above (see Theorem 4.3), and the
second the generalization to arbitrary dimension. For the generalization to arbitrary
dimension, we use a general gluing construction for tropical moduli spaces which
was developed by the ﬁrst and last author in [16] and has further applications to
other target spaces.
This paper is organized as follows. In Sect. 2 we review the necessary prelim-
inaries. The tropical moduli spaces M0;n.L; ˙/ are then deﬁned in Sect. 3. More

290
A. Gathmann et al.
precisely, we deﬁne their structure as a polyhedral subcomplex of M0;n.Rr; ˙/
in Sect. 3.1, and the weights of their maximal cells in Sect. 3.2. The deﬁnition of
the weights relies on the gluing construction of [16], which we therefore review in
Sect. 3.2, together with the main result of [16] allowing a gluing construction of
tropical moduli spaces under some requirements. In our case, these requirements
are satisﬁed if all one-dimensional tropical moduli spaces M0;n.L; ˙/ are balanced
fans. We prove this fact in Sect. 4 (see Theorem 4.3). Theorem 1.1 is then an
immediate consequence of the foundational work on the gluing construction in [16].
2
Preliminaries
2.1
Background on Tropical Varieties and Intersection Theory
To ﬁx notation, we quickly review notions of tropical intersection theory. Some of
our constructions involve partially open versions of tropical varieties, i.e. varieties
containing polyhedra that are open at some faces. We adapt the usual conventions
to this situation. For a more detailed survey of the relevant preliminaries, see [16,
section 2.1].
We let  be a lattice in an r-dimensional real vector space V. A (partially open)
(rational) polyhedron in V is a ﬁnite intersection of (open or) closed afﬁne half-
spaces given by (strict or) non-strict inequalities whose linear parts are given by
elements in the dual of . We denote by V the linear space obtained by shifting the
afﬁne span of  to the origin and deﬁne  WD V \ . A face    (also written
as  <  if it is proper) is a non-empty subset of  that can be obtained by changing
some of the deﬁning non-strict inequalities into equalities. If dim  D dim   1
we call  a facet of . In this case we denote by u= 2 = the primitive
normal vector of  relative to , i.e. the unique generator of = lying in the half-
line of  in V=V Š R. The well-known notion of a (pure-dimensional) weighted
polyhedral complex X (formed by cells  as above, and with integer weights on
maximal cells), its dimension and support are easily adapted to the case of partially
open polyhedral complexes. Such a (partially open) weighted polyhedral complex
.X; !/ is called a (partially open) tropical variety (or cycle, if negative weights
occur) if it satisﬁes the balancing condition, i.e. for each cell  of codimension 1
we have
X
W>
!./  u= D 0
2 V=V:
For intersection-theoretic purposes, the exact polyhedral complex structure is often
not important, and we ﬁx it only up to reﬁnements respecting the weights.
Example 2.1 (Smooth Curves) Let V D Rq. We let Lq
1 denote the 1-dimensional
tropical variety containing the origin and rays spanned by ei (where ei denotes

Tropical Moduli Spaces of Stable Maps to a Curve
291
the canonical basis vectors) and e0 WD P ei, with all weights one. This is the
tropicalization of a general line over the Puiseux series with constant coefﬁcient
equations [14, proposition 2.5 and theorem 4.1]. A one-dimensional tropical variety
L 	 Rr with all weights one is called a rational smooth curve if its underlying
polyhedral complex is rational (i.e. combinatorially a tree), and if it locally at each
vertex equals Lq
1 up to a unimodular transformation, i.e. up to an isomorphism of
vector spaces which is also an isomorphism of the underlying lattices [1].
Some of our constructions involve quotients X=W of partially open tropical
varieties X by a lineality space W. We say that a vector subspace W of V is a
lineality space for X if for all  2 X and x 2  the intersection  \ .x C L/ is open
in x C L and equal to jXj \ .x C L/. Note that for the case of a closed polyhedral
complex this generalizes the usual notion of a lineality space (which is commonly
the maximal subspace with this property). For more details on such quotients, see
[16, section 2.2].
A morphism between (partially open) tropical cycles X and Y is a map f W jXj !
jYj which is locally afﬁne linear, with the linear part induced by a map between the
underlying lattices [2, deﬁnition 7.1]. A rational function on a tropical variety X is
a continuous function ' W jXj ! R that is afﬁne linear on each cell, and whose
linear part is integer, i.e. in the dual of the lattice. We associate a divisor '  X to a
rational function; a cycle of codimension 1 in X support on the cells at which ' is
not locally linear [2, construction 3.3]. Multiple intersection products '1     'mX
are commutative by Allermann and Rau [2, proposition 3.7].
Remark 2.2 (Weights of Intersections as Lattice Indices) Often, the weight of a cell
of a multiple intersection product can be computed locally in terms of a lattice index.
To do this, we write locally 'i D maxfhi; 0g for linearly independent integer linear
functions h1; : : : ; hm, and let H be a matrix representing the integer linear map  !
Zm W x 7! .h1.x/; : : : ; hm.x//. Then the local weight of '1  : : :  'm  X equals the
greatest common divisor of the maximal minors of H [21, lemma 5.1].
Rational functions can be pulled back along a morphism f W X ! Y to rational
functions f .'/ D ' ı f on X. We can push forward a subvariety Z of X to a
subvariety f.Z/ of Y 	 0 ˝Z R [2, proposition 4.6 and corollary 7.4]: For suitable
reﬁnements of the polyhedral structures of X and Y, we obtain f./ 2 Y for all
 2 X, and deﬁne the weight of the push-forward to be
!f.Z/.0/ WD
X

!X./  j0
0=f./j;
where the sum goes over all top-dimensional cells  2 Z with f./ D 0. In the
partially open case, we will restrict ourselves to injective morphisms in order to
avoid problems with overlapping cells with different boundary behavior.

292
A. Gathmann et al.
2.2
Tropical Moduli Spaces of Curves
An (abstract) N-marked rational tropical curve is a tuple .; x1; : : : ; xN/, where 
is a metric tree with N unbounded edges labeled x1; : : : ; xN (also called marked
ends) that have inﬁnite length, and such that the valence of each vertex is at least
3. The set of all N-marked tropical curves is denoted M0;N. It follows from [25,
theorem 3.4], [23, section 2], or [17, theorem 3.7] that M0;N can be embedded as
a tropical variety via the distance map, more precisely, as a balanced, simplicial,
.N  3/-dimensional fan whose top-dimensional cones all have weight one. The
distance map sends a tropical curve to the vector of distances of its ends in R.N
2/.
We mod out an N-dimensional lineality space UN, identifying vectors corresponding
to trees whose metrics only differ on the ends. For a tree with only one bounded edge
of length one, the ends with markings I 	 f1; : : : ; Ng, 1 < jIj < N  1, on one side
and the ends with markings Ic on the other, we denote the equivalence class of its
image under the distance map in R.N
2/=UN by vI. The vectors vI generate the rays of
M0;N and the lattice we ﬁx for R.N
2/=UN.
For local computations, we sometimes use a ﬁnite index set I instead of
f1; : : : ; Ng as labels for the markings, and denote the corresponding moduli spaces
by M0;I. Also, we can modify the deﬁnition above by assigning bounded lengths
in R>0 to the ends, corresponding to not taking the quotient by UN. In this case we
obtain a partially open moduli space which we will denote by M 0
0;N. There is then
a map M 0
0;N ! M0;N forgetting the lengths of the bounded ends, which is just the
quotient by UN.
For every subset I 	 f1; : : : ; Ng of cardinality at least three, there is a forgetful
map ftI W M0;N ! M0;jIj which maps .; x1; : : : ; xN/ to the tree where we remove
all ends xi with labels i … I (and possibly straighten 2-valent vertices). Forgetful
maps are morphisms by Gathmann et al. [17, proposition 3.9]. In coordinates, we
project to distances of ends in I.
Lemma 2.3 A vector x in R.N
2/=UN is zero if and only if ftI.x/ D 0 for all I 	
f1; : : : ; Ng with jIj D 4.
Proof As ftI is linear, the “only if” direction is obvious. For the other direction,
denote the standard basis vectors of R.N
2/ by eij for i < j. Let Qx D P
i<j ijeij 2 R.N
2/
be a representative of x. For any I with jIj D 4, the assumption ftI.x/ D 0 means
that the projection P
i;j2IIi<j ijeij is in U4. By deﬁnition of U4, it follows that there
is a vector  2 RI such that ij D i C j for all i < j in I, and thus that ik C jl D
ij C kl if I D fi; j; k; lg.
But this means that for all i D 1; : : : ; N the assignment
i WD 1
2.ij C ik  jk/
for arbitrary j; k ¤ i

Tropical Moduli Spaces of Stable Maps to a Curve
293
is well-deﬁned, because if m is another index we have
1
2.ij C ik  jk/ D 1
2.im C ik  mk/ C 1
2.ij  im C mk  jk/
D 1
2.im C ik  mk/:
As the deﬁnition of i also implies that ij D i C j for all i < j, we conclude that
Qx 2 UN, and hence x D 0.
Deﬁnition 2.4 (Tropical Stable Maps) Let n 2 N and N  n. Consider a tuple
.; x1; : : : ; xN; h/, where .; x1; : : : ; xN/ is an N-marked abstract rational tropical
curve and h W  ! Rr is a continuous map that is integer linear on each edge.
For an edge e starting at a vertex V of  , we denote the tangent vector of hje at
V by v.e; V/ 2 Zr and call it the direction of e at V. If e is an end and V its only
neighboring vertex we write v.e; V/ also as v.e/ for simplicity.
We say that .; x1; : : : ; xN; h/ is an n-marked (rational) tropical stable map to
Rr, also called a (parameterized) n-marked curve in Rr [17, deﬁnition 4.1], if
•
h satisﬁes the balancing condition P
e3V v.e; V/ D 0 at each vertex V of  ;
•
v.xi/ D 0 for i D 1; : : : ; n (i.e. each of the ﬁrst n ends is contracted by h),
whereas v.xi/ ¤ 0 for i > n (i.e. the remaining N  n ends are “non-contracted
ends”).
Two n-marked tropical stable maps .; x1; : : : ; xN; h/ and . Q ; Qx1; : : : ; QxN; Qh/ in Rr
are isomorphic (and will from now on be identiﬁed) if there is an isomorphism ' of
the underlying N-marked abstract curves such that Qh ı ' D h.
The degree of an n-marked tropical stable map is the N-tuple
˙ D .v.x1/; : : : ; v.xN// 2 .Zr/N
of directions of its ends, including the zero directions at the ﬁrst n ends. Its
combinatorial type is given by the data of the combinatorial type of the underlying
abstract marked tropical curve .; x1; : : : ; xN/ (i.e. where we drop the metrization
data) together with the directions of all its edges.
The space of all n-marked rational tropical stable maps of a given degree ˙ in
Rr is denoted by M0;n.Rr; ˙/.
Since n equals the number of zero-entries in ˙ and thus can be deduced from ˙,
we sometimes drop the subscript and write only M0.Rr; ˙/. While all N ends come
with markings x1; : : : ; xN, only the ends with markings x1; : : : ; xn are contracted (i.e.
have zero direction) and are thus highlighted in the notation.
Remark 2.5 (M0;n.Rr; ˙/ as a Tropical Variety) We assume n  1. Then by
Gathmann et al. [17, proposition 4.7], M0;n.Rr; ˙/ is a tropical variety, identiﬁed
with M0;N  Rr via the map
M0;n.Rr; ˙/ ! M0;N  Rr;
.; x1; : : : ; xN; h/ 7! ..; x1; : : : ; xN/; h.x1//

294
A. Gathmann et al.
which forgets h, but records the image h.x1/ of a root vertex. It thus inherits the fan
structure of M0;N. In particular, it can be embedded via this map into R.N
2/=UN Rr.
When we work with an element of M0;n.Rr; ˙/ in coordinates, we usually give its
coordinates in R.N
2/Rr, i.e. its image under the distance map and the position of the
root vertex. If n D 0 it is still possible to ﬁnd suitable coordinates for M0;n.Rr; ˙/
as M0;N  Rr, not by evaluating a marked end but by evaluating for example a
barycenter [24, construction 1.2.21].
For each i D 1; : : : ; n, we have the evaluation map
evi W M0;n.Rr; ˙/ ! Rr
assigning to a tropical stable map .; x1; : : : ; xn; h/ the position h.xi/ of its i-th
marked end. It is shown in [17, proposition 4.8] that these maps are morphisms
of tropical fans.
As above, we will also allow curves in Rr where some of the non-contracted ends
are bounded, and write the corresponding moduli spaces as M 0
0;n.Rr; ˙/.
In the following, we will compute several intersection products in cells of tropical
moduli spaces. Since we are often interested in a local situation, we can restrict to
curves of a given combinatorial type ˛. Local coordinates for the cell of curves
of type ˛ are given by the coordinates of the root vertex and the lengths of each
bounded edge. The map sending a unit vector in these local coordinates to a vector
vI as above is a unimodular transformation to the vector space spanned by the
corresponding cell in the moduli space. Therefore we can compute lattice indices
also in these local coordinates.
3
The Polyhedral Complex M0;n.L; ˙/ and Its Gluing
Weights
For the whole section, let L 	 Rr be a smooth tropical curve as in Example 2.1, and
let ˙ be the degree of a tropical n-marked stable map to Rr. We want to deﬁne a
moduli space M0;n.L; ˙/ of tropical n-marked stable maps to L as a tropical variety.
Let us ﬁrst construct this space as a polyhedral complex, and then deﬁne its weights
in the next subsection.
3.1
The Polyhedral Complex M0;n.L; ˙/
We have already mentioned that not all stable maps with image in L will be allowed
in M0;n.L; ˙/. Instead, we have to impose the so-called Riemann-Hurwitz condition
that we introduce now. As we will see in Construction 3.11, it corresponds to a local
realizability condition.

Tropical Moduli Spaces of Stable Maps to a Curve
295
Notation 3.1 (Covering Degrees) Let .; x1; : : : ; xN; h/ 2 M0;n.Rr; ˙/ satisfy
h. / 	 L as sets. As L is irreducible we have h. / D d  L for some integer
d (which depends only on ˙). We call d the covering degree of the stable map and
denote it by deg.˙/.
For a vertex V of  , the local degree ˙V at V is the collection of the directions
of its adjacent edges, labeled in an arbitrary way starting with the zero directions.
We let NV D j˙Vj and nV the number of zero directions in ˙V (which may come
from marked ends or contracted bounded edges). The local covering degree will be
denoted dV D deg.˙V/.
Deﬁnition 3.2 (Riemann-Hurwitz Number) Let .; x1; : : : ; xN; h/ 2 M0;n.Rr;
˙/ satisfy h. / 	 L. We deﬁne the Riemann-Hurwitz number of a vertex V of
 with image W D h.V/ as
RH.V/ D NV  nV  dV  .val.W/  2/  2
(where val W D 2 if W lies in the interior of an edge of L). Note that it depends only
on the combinatorial type of the stable map.
The Riemann-Hurwitz number gives a realizability condition for tropical stable
maps to smooth curves. It appears e.g. in [5, deﬁnition 2.2], [9, proposition 2.4],
[12, section 3.2.2], and [7, deﬁnition 3.11].
Deﬁnition 3.3 (M0;n.L; ˙/ as a Polyhedral Complex) Let ˛ be a combinatorial
type of tropical stable maps in M0;n.Rr; ˙/. We denote the subset of maps
.; x1 : : : ; xN; h/ of type ˛ and satisfying h. / 	 L by M .˛/; this is easily seen to
be a partially open polyhedron. Let M0;n.L; ˙/ be the set of all such cells M .˛/
with RH.V/  0 for all vertices V in ˛; this is a polyhedral complex [8].
Note that this deﬁnition of M0;n.L; ˙/ formally differs from the one used in
[16] in order to make it compatible with the literature mentioned above. In [16,
deﬁnition 3.8], more cells are included a priori, but they obtain weight zero in the
gluing construction of Sect. 3.2.
Remark 3.4 (Dimension
of
M0;n.L; ˙/) By
an
easy
generalization
of
[8,
lemma 2.14], it follows that M0;n.L; ˙/ is pure of dimension j˙j  deg.˙/ 
P
W2L.val.W/  2/  2. The maximal cells correspond to combinatorial types such
that
•
each vertex mapping to a vertex of L satisﬁes RH.V/ D 0,
•
each vertex mapping to an edge of L is 3-valent, and
•
no edge is contracted to a vertex.
More precisely, we have:
Lemma 3.5 (Dimension of Cells of M0;n.L; ˙/) Let ˛ be a combinatorial type
in M0;n.L; ˙/. The dimension of the corresponding cell M .˛/ equals the number
of vertices mapping to edges of L plus the number of bounded edges mapping to
vertices of L.

296
A. Gathmann et al.
Intuitively, this holds true since we can independently vary the length of each
bounded edge mapping to a vertex without leaving the cell of a combinatorial type,
as well as the lengths of edges adjacent to a vertex mapping to an edge, in the
appropriate way that “moves” the vertex along the edge.
3.2
The Gluing Construction for Moduli Spaces
In this section, we want to equip M0;n.L; ˙/ with weights satisfying the balancing
condition, to make it a tropical variety. To do this, we review the general technique
developed in [16], adapted to the case when the target of the stable maps is a smooth
curve. The idea is to construct the tropical moduli spaces by a gluing procedure from
local moduli spaces for the vertices. This construction depends on a condition: all
vertices appearing in a combinatorial type of the moduli space are required to be
“good”. We start by repeating the relevant deﬁnitions in the case of smooth curves.
Notation 3.6 (Links of Vertices) Let .; x1; : : : ; xn; h/ 2 M0;n.L; ˙/, and let V be
a vertex of  . We denote by LV the link of L around h.V/. Generalizing the notation
of Example 2.1, we denote a point by L0
0, so that LV is (an afﬁne shift of a unimodular
transformation of) Lq
r  Rs, where r C s D 1 and q D 0 if r D 0. Hence we have
.r; s/ D .1; 0/ if V maps to a vertex of L (of valence q C 1), and .r; s/ D .0; 1/ if V
maps to an edge. Note that there is an associated local moduli space M0.LV; ˙V/.
Deﬁnition 3.7 (Resolution Dimension) For a tropical stable map .; x1; : : : ; xn; h/
2 M0;n.L; ˙/, let V be a vertex of  with image W D h.V/ 2 L. As in Notation 3.6,
we have LV Š Lq
r  Rs with r C s D 1 and q D 0 if r D 0. Treating again a point on
an edge of L as a 2-valent vertex, we deﬁne the resolution dimension of V as
rdim.V/ D NV  dV  .val.W/  2/ C r  3
and the classiﬁcation number as
cV D NV C r
2 N:
Remark 3.8 (Dimension of Local Moduli Spaces) By the dimension formula, we
see that the local moduli space at V has dimension dim M0.LV; ˙V/ D rdim.V/Cs,
where again LV Š Lq
r Rs. As this moduli space has an s-dimensional lineality space
coming from shifting the curves along Rs, the resolution dimension of V is just the
dimension of the local moduli space at V modulo its lineality space.
Remark 3.9 (Dimension of M0;n.L; ˙/ in Terms of Resolution Dimensions) Let ˛
be a combinatorial type in M0;n.L; ˙/, and assume that ˛ has s vertices mapping to
an edge in L (i.e. so that the corresponding link is L0
0  R). Adding up the resolution
dimensions of all vertices in ˛, we obtain by Remark 3.4
X
V
rdim.V/ C s D dim M0;n.L; ˙/:

Tropical Moduli Spaces of Stable Maps to a Curve
297
Remark 3.10 Note that rdim.V/ and RH.V/ are very similar: in fact, rdim.V/ is just
RH.V/ with additional contributions
(a) nV of the number of contracted edges at V, and
(b) 1 if V maps to an edge of L.
In particular, the condition RH.V/  0 of Deﬁnition 3.3 also implies rdim.V/  0
(otherwise we would have RH.V/ D 0 and rdim.V/ D 1, i.e. V maps to an edge,
NV D 2, and nV D 0, which is a contradiction since we do not allow 2-valent
vertices).
The reason to introduce the numbers of Deﬁnition 3.7 is that they are used in the
recursive deﬁnition of good vertices and the weights of M0;n.L; ˙/ below. For this
construction we start with the case of resolution dimension 0 and pass to the general
case by gluing. The initial case is obtained by passing to the corresponding situation
in algebraic geometry and considering (algebraic) Hurwitz numbers.
Construction 3.11 (Algebraic Moduli Spaces for a Vertex) Let V be a vertex
of a combinatorial type in M0;n.L; ˙/ such that LV Š Lq
1. Up to unimodular
transformation, ˙V D .ı1; : : : ; ıNV/ is a degree of tropical stable maps to Rq with
ends in the directions of Lq
1. We decompose f1; : : : ; NVg into a partition 
0; : : : ; 
q
and 
, where

i D f jjıj D mjei for some mj 2 N>0g
and 
 D f jjıj D 0g. This also uniquely deﬁnes the values mj as the weights of the
edges adjacent to V.
To construct an algebraic moduli space for V, ﬁx q C 1 distinct points
P0; : : : ; Pq on the complex projective line P1. Inside the well-known moduli stack
M0;NV.P1; dV/ of NV-marked degree-dV rational stable maps to P1, consider the
substack M.˙V/ of all smooth stable maps C D .C; x1; : : : ; xNV; / such that
Pi D P
j2
i mjxj for all i D 0; : : : ; q, i.e. such that the ramiﬁcation proﬁle of 
over P0; : : : ; Pq is as speciﬁed by ˙V. We denote its closure inside M0;NV.P1; dV/
by M.˙V/, and its boundary by @M.˙V/ D M.˙V/ n M.˙V/. Its dimension is
dim M.˙V/ D 2dV  2 C NV  dV  .q C 1/ D rdim.V/:
Construction 3.12 (The Case of Resolution Dimension 0) Let V be a vertex of
a combinatorial type in M0;n.L; ˙/ with rdim.V/ D 0, where LV Š Lq
r  Rs as
above. Then dim M0.LV; ˙V/ Š Rs by Remark 3.8, i.e. the local moduli space at V
consists of only one cell. We make it into a tropical variety by giving it the following
local weight !V, depending on whether V maps to a vertex or to an edge of L.
(a) If LV Š Lq
1, the algebraic moduli space M.˙V/ of Construction 3.11 has
dimension zero. We deﬁne the local weight of V to be !V WD deg M.˙V/;
i.e. the number of points in M.˙V/, counted with weight j Aut./j1 as we
work with a stack. This number is also called the (marked) Hurwitz number and
denoted H.˙V/.

298
A. Gathmann et al.
(b) If LV Š L0
0  R, the dimension condition implies NV D 3. In this case, we set
!V WD 1.
In fact, the second case could be treated similarly to the ﬁrst one by introducing
a rubber variant of the moduli space M.˙V/. We avoid this formulation for the sake
of simplicity.
Let us now describe the gluing construction that gives the local moduli space
M0.LV; ˙V/ of a vertex V the structure of a tropical variety if rdim.V/ > 0. In
the following, any combinatorial type occurring in M0.LV; ˙V/ will be called a
resolution of V. For a combinatorial type ˛ occurring in a moduli space we denote
by N .˛/ the “neighborhood of ˛”, i.e. the union of all cells M .ˇ/ whose closure
intersects M .˛/.
Deﬁnition 3.13 of a good vertex and the following gluing Construction 3.14
depend on each other and work in a combined recursion on the classiﬁcation number
of vertices. The following deﬁnition of a good vertex thus assumes that good vertices
of lower classiﬁcation number are already deﬁned recursively. Moreover, for every
combinatorial type ˛ in a local moduli space M0.LV; ˙V/ all of whose vertices have
smaller classiﬁcation number and are good it assumes that there is a gluing cycle in
the neighborhood N .˛/ from Construction 3.14.
Deﬁnition 3.13 (Good Vertices [16, deﬁnition 3.13])
Let V be a vertex of a (local) tropical stable map in M0.LV; ˙V/, so that in
particular rdim.V/  0. The vertex V is called good if the following holds:
(a) Every vertex of every resolution ˛ of V in M0.LV; ˙V/ (which has classiﬁcation
number smaller than cV by Gathmann and Ochse [16, lemma 3.6]) is good (so
that a gluing cycle is deﬁned on N .˛/ by Construction 3.14).
(b) If rdim.V/ > 0 the maximal types in M0.LV; ˙V/ are resolutions of V. We
let M0.LV; ˙V/ be a weighted polyhedral complex by deﬁning the weights
on maximal cells M .˛/ D N .˛/ using the gluing Construction 3.14. If
rdim.V/ D 0, we equip the unique cell of M0.LV; ˙V/ with the weight of
Construction 3.12. We require that the space M0.LV; ˙V/ is a tropical cycle
with these weights.
(c) For every resolution ˛ of V in M0.LV; ˙V/ and every maximal type ˇ such that
M .ˇ/ contains M .˛/ in M0.LV; ˙V/ (ˇ is then also a resolution of V), the
weight of ˇ is the same in the gluing cycles N .˛/ and N .ˇ/.
In the following review of the gluing construction from [16, construction 3.12],
we omit some of the technical details for the sake of clarity.
Construction 3.14 (The Gluing Construction for a Combinatorial Type ˛) Fix
a (not necessarily maximal) combinatorial type ˛ of curves in M0;n.L; ˙/ and
assume that all its vertices are good. We will construct weights on the maximal
cells of the neighborhood N .˛/ such that this partially open polyhedral complex
becomes a tropical cycle. In particular, if ˛ is already maximal this deﬁnes a weight
on M .˛/ D N .˛/.
We cut each bounded edge of ˛ at some point in its interior, and in addition
introduce lengths for all ends. This yields a set of connected components ˛V, each

Tropical Moduli Spaces of Stable Maps to a Curve
299
containing only one vertex V, edges of directions ˙V, and (now bounded) ends
labeled by an index set IV.
For every such vertex V, consider the local moduli space M0.LV; ˙V/, which is
a tropical variety since V is good. We introduce lengths on all ends of ˙V, obtaining
a moduli space M 0
0.LV; ˙V/ (of which M0.LV; ˙V/ is a quotient) as in Sect. 2.2.
Each bounded end i 2 IV is mapped to an edge or vertex of L that we denote by
i. We consider the open subcomplex of M 0
0.LV; ˙V/ of all curves for which the
evaluation at i still lies in i, i.e. the partially open tropical subvariety
MV WD
\
i2IV
ev1
i .i/
of M 0
0.LV; ˙V/.
Now we want to glue these pieces MV back together. Consider a bounded edge
e of ˛ adjacent to two vertices V1.e/ and V2.e/, and denote the two bounded ends
produced by cutting e by i1.e/ 2 IV1.e/ and i2.e/ 2 IV2.e/, where i1.e/ D i2.e/ DW e.
There is a corresponding evaluation map
eve WD .evi1.e/  evi2.e// W
Y
V
MV ! e  e
at the endpoints of these two bounded ends in the factors for V1 and V2. To impose
the condition that these ends ﬁt together to form the edge e we need to pull back the
diagonal e via eve [16, appendix]. We abbreviate all these pull-backs by
ev.L/ 
Y
V
MV WD
Y
e
ev
e e 
Y
V
MV;
where e runs over all bounded edges e of ˛. By construction, this cycle consists of
stable map pieces that glue back to a stable map in M0;n.L; ˙/. However, it also
carries the superﬂuous information on the position of the gluing points. To get rid of
this we apply the quotient map q by the lineality space generated by the appropriate
differences of vectors taking care of the lengths of the bounded ends, and by the
vectors taking care of ends which should be unbounded. We ﬁnally use a morphism
f identifying a stable map glued from pieces with the corresponding element in
M0;n.L; ˙/, where we use the distance and barycentric coordinates mentioned in
Remark 2.5. Hence we get a partially open tropical cycle
fq
"
ev.L/ 
Y
V
MV
#
in
M0;n.L; ˙/:
Its weights on the maximal cells of M0;n.L; ˙/ will be called the gluing weights. It is
easy to see that the gluing morphism f is unimodular and induces a bijection of cells.
In particular, the weight of a maximal cell in fq

ev.L/  Q
V MV

is equal to the

300
A. Gathmann et al.
weight of ev.L/Q
V MV in the corresponding cell of Q
V MV. By Remark 2.2, it
can be computed as the greatest common divisor of the maximal minors of a matrix
whose rows represent the differences evi1.e/  evi2.e/ in local coordinates.
Example 3.15 Let L D L2
1 be a tropical line in R2 and let ˛ be a combinatorial type
of degree-˙ curves in L2
1 as shown below on the left (where the directions of the
edges indicate their images in R2). Then rdim.V0/ D 0. We assume in addition that
rdim.V1/ D 0.
We cut the unique bounded edge e of weight d1, obtaining two bounded ends
that we denote f and f 0. By the assumption on the resolution dimension, the
local moduli spaces for V0 and V1 consist of only one cell each, and we can
explicitly describe isomorphisms to open polyhedra in some Rk as follows. The
space MV0 is isomorphic to R2
>0, where one coordinate that we denote by lf
corresponds to the length of the bounded end, and the other that we call xV0 to
the position of the image of V0 on the corresponding ray of L. The space MV1
is R>0 with coordinate lf 0 corresponding to the length of its bounded end. By
Construction 3.12, the weight of MV1 is the Hurwitz number !V1 D H.˙V1/,
whereas MV0 has weight 1. Using these coordinates, we can pull back the diagonal
of L as ev
e maxfx  y; 0g D maxfevf  evf 0; 0g, where x; y are the coordinates of
L2 on the left ray. By Remark 2.2, the weight of ev L  .MV0  MV1/ equals the
weight of MV0  MV1 times the greatest common divisor of the maximal minors of
the matrix
xV0
lf
lf 0
evf  evf 0
1 d1 d1;
which is 1. Hence the cell corresponding to ˛ in M0.L; ˙/ has weight !˛ D
H.˙V1/. The analogous result holds for L D Lq
1 for all q.
Example 3.16 Let L D L2
1 be a tropical line in R2 again, and let ˛ be the
combinatorial type of degree-˙ curves mapping to L2
1 depicted below, with V1 and
V2 mapping to the vertex of L. As above, we then have rdim.V0/ D 0, and assume
in addition that rdim.V1/ D rdim.V2/ D 0.
We cut the two edges e1 of weight d1 and e2 of weight d2, obtaining four new
bounded ends that we denote by fi and f 0
i for i D 1; 2. As before, each local

Tropical Moduli Spaces of Stable Maps to a Curve
301
moduli space consists of only one cell. The space MV0 is isomorphic to R3
>0,
where two coordinates (lf1 and lf2) correspond to the lengths of the bounded ends
and one (xV0) to the position of the image of V0 on the corresponding ray of L.
By Construction 3.12, it is equipped with weight !V0 D 1. Similarly, MVi for
i D 1; 2 is isomorphic to R>0, where the coordinate lf 0
i is given by the length of
the bounded end, and equipped with the appropriate Hurwitz number !Vi D H.˙Vi/
as weight. As in the previous example, pulling back the diagonal of L2 twice and
using Remark 2.2, we deduce that the weight of ev L .MV0 MV1 MV2/ equals
the weight of MV0  MV1  MV2 times the greatest common divisor of the maximal
minors of the matrix
xV0 lf1
lf2
lf 0
1
lf 0
2
evf1  evf 0
1
1 d1
0
d1
0
evf2  evf 0
2
1
0
d2
0
d2;
which is gcd.d1; d2/. Thus the weight of the cell corresponding to ˛ in M0.L; ˙/
equals
!˛ D gcd.d1; d2/ !V0!V1!V2 D gcd.d1; d2/  H.˙V1/  H.˙V2/:
As in Example 3.15, the same result holds for L D Lq
1 for all q.
We end this section by stating the main result of [16], together with a lemma
that provides a major simpliﬁcation for checking the requirements of the following
theorem:
Theorem 3.17 (The Gluing Theorem [16, corollary 3.17]) Assume that all ver-
tices V that can possibly occur in combinatorial types of the moduli space
M0;n.L; ˙/ are good. Then the gluing construction is well-deﬁned for all these
combinatorial types. In particular, M0;n.L; ˙/ is a tropical variety.
Lemma 3.18 (Restriction to Resolution Dimension One [16, corollary 3.18]) If
all vertices V of combinatorial types of M0;n.L; ˙/ with rdim.V/ D 1 are good,
then all vertices are good.

302
A. Gathmann et al.
4
One-Dimensional Moduli Spaces of Rational Covers
of Smooth Tropical Curves
Throughout this section, let V be a vertex of a combinatorial type in M0;n.L; ˙/
with rdim.V/ D 1. Our aim is to show that V is good, so that we can apply
Lemma 3.18 and the gluing Theorem 3.17 to deduce Theorem 1.1. We continue
to use the notation of Sect. 3. Moreover, let IV be the set of labels of the ends in
the local moduli space M0.LV; ˙V/, so that M0.LV; ˙V/ D M0;IV.LV; ˙V/. As in
Construction 3.11, let mj 2 N>0 be the weight of the end j 2 IV.
To prove that V is good, we have to show by Deﬁnition 3.13 that
(1) every vertex appearing in a non-trivial resolution in M0.LV; ˙V/ is good;
(2) M0.LV; ˙V/ is a tropical variety with the gluing weights; and
(3) for every non-trivial resolution ˛ of V, the weight of each maximal cell in the
neighborhood N .˛/ is the same no matter if we apply the gluing construction
for ˛ or just for this maximal cell.
Assume ﬁrst that V maps to an edge of L, so that LV Š L0
0  R. Then rdim.V/ D 1
implies NV D 4, hence the possible resolutions are just the usual resolutions of a
4-valent vertex. Also, any gluing weight is just 1, and the balancing condition is
satisﬁed—this is just the usual balancing condition of M0;4. It follows that V is
good.
We can thus assume now that V maps to a vertex of L, so that LV Š Lq
1. By
Remark 3.8, this means that dim M0.LV; ˙V/ D 1. In particular, every resolution of
V corresponds already to a maximal cell of the local moduli space, which implies
that condition (3) above is trivially satisﬁed. Moreover, Lemma 3.5 implies that
every non-trivial resolution of V has at least one vertex mapping to an edge of L, or a
bounded edge contracted to a vertex. In the former case, Remark 3.9 then shows that
all vertices in this resolution must have resolution dimension 0 and are thus good,
and the latter case is an immediate contradiction to Remark 3.4. Hence condition (1)
is always satisﬁed as well, and it only remains to check the balancing condition (2).
Next, since 1  nV D rdim.V/  nV D RH.V/  0, we can either have nV D 1
and RH.V/ D 0, or nV D 0 and RH.V/ D 1. In the ﬁrst case, there is one contracted
end, say with the marking 1, adjacent to the vertex. In the possible resolutions, this
contracted end is adjacent to any other of the non-contracted ends, leading to a
generating vector of the form vf1;ig for the corresponding ray in M0.LV; ˙V/. As
in Example 3.15, we can see that any gluing weight equals H.˙V n f0g/. We have
PNV
iD2 vf1;ig D 0 in M0.Rq; ˙V/, and hence the balancing condition is satisﬁed in
this case.
So the only thing left to be done is to study the remaining case, where we have a
vertex V mapping to a vertex of L, without contracted ends and having rdim.V/ D 1,
and to prove the balancing condition (2) for the 1-dimensional local moduli space
M0;n.L; ˙/ in this situation. We start by listing the possible resolutions of such a
vertex, i.e. the maximal cones of M0;n.L; ˙/.

Tropical Moduli Spaces of Stable Maps to a Curve
303
Construction 4.1 (Resolutions of a Vertex with rdim.V/ D 1) Let V be a vertex
of a combinatorial type in M0;n.L; ˙/. Assume that V maps to LV Š Lq
1 and satisﬁes
rdim.V/ D 1 and nV D 0.
As dim M0.LV; ˙V/ D 1, it follows from Remark 3.4 and Lemma 3.5 that in
each (necessarily maximal) resolution of V, there is one (necessarily 3-valent) vertex
V0 mapping to an edge of Lq
1. This vertex can either join two ends or split an end, so
that we obtain the following two types of resolutions:
(I) There is exactly one vertex V1 mapping to the vertex of LV. The vertex V0 is
adjacent to two ends i; j 2 IV and a bounded edge of weight d1 D mi C mj
connecting V0 to V1. The ends in I1 WD IVnfi; jg are adjacent to V1.
Such a type exists for all choices of ends i and j of the same (primitive)
direction.
(II) There are exactly two vertices V1; V2 mapping to the vertex of LV. The vertex
V0 is adjacent to an end i 2 IV and two bounded edges of weights d1; d2 with
d1 Cd2 D mi connecting V0 to V1 and V2, respectively. The two vertices V1 and
V2 are adjacent to ends in I1 and I2, respectively, where I1 [ I2 [ fig D IV.
Such a type exists for all choices of i and all partitions of IVnfig into I1 and
I2 for which there is a stable map with the above conditions.
With the notations of Sect. 2, these types correspond to rays of M0.LV; ˙V/
generated by the vectors vfi;jg for type I and d2vI1 C d1vI2 for type II (where the
latter does not need to be primitive).
Let us now consider the corresponding algebraic situation, i.e. the 1-dimensional
algebraic moduli space M.˙V/ of Construction 3.11. By the Riemann-Hurwitz
condition, a point in the open part M.˙V/ corresponds to a cover with precisely
one simple ramiﬁcation which is not marked, and whose image does not coincide
with one of the points P0; : : : ; Pq at which we ﬁxed the ramiﬁcation imposed by
˙V. The boundary points correspond to degenerate covers that we obtain when the
additional branch point runs into a point Ps for s 2 f0; : : : ; qg.
As deformations of covers are always local around special ﬁbers [27, propo-
sition 1.1], we see that a cover in @M.˙V/ must have exactly one collapsed
component, which then has exactly three special points. So we have the following

304
A. Gathmann et al.
two types for the curves in the boundary @M.˙V/, which are exactly dual to the
tropical picture above (see [8, proposition 3.12] for a related statement):
Here, C0 is the collapsed component, and Ck for k 2 f1; 2g denotes the at most
two non-collapsed irreducible components. In the type I case, the map jC1 has
order d1 WD mi C mj at the singular point of C. In the type II case, the orders d1 and
d2 of jC1 and jC2 at the singular points of C add up to mi.
To check the balancing condition in the 1-dimensional fan M0.LV; ˙V/, it
sufﬁces by Lemma 2.3 to consider the situation after applying the various forgetful
maps to M0;4. We will do this ﬁrst in the algebraic and then in the tropical case.
Lemma 4.2 (The Pull-Back of the Forgetful Map) Let C 2 @M.˙V/ be a stable
map in the boundary of the local moduli space of a vertex V as in Construction 4.1.
Consider the forgetful map ftI W M.˙V/ ! M0;I Š P1 for a choice of four-element
subset I D fi; j; k; lg 	 IV. Then the multiplicity ordC ft
I .ijjkl/ of the pullback of the
divisor .ijjkl/ on M0;I at C equals
(a) 1 if C is of type I, with xi; xj 2 C0 and xk; xl 2 C1 or vice versa;
(b) d1 if C is of type II, with xi 2 C0, and xj 2 C1 and xk; xl 2 C2 or vice versa;
(c) d1 C d2 if C is of type II, with xi; xj 2 C1 and xk; xl 2 C2 or vice versa.
These are all cases in which we have a non-zero multiplicity.

Tropical Moduli Spaces of Stable Maps to a Curve
305
Proof Since xi; xj and xk; xl must lie on different components after applying the
forgetful map and C has at least two and at most three components, it is obvious
that we can only have the three cases stated in the lemma. We want to determine
the multiplicity of C in ft
I .ijjkl/ for each case. By Vakil [27, proposition 1.1], we
may replace our family M.˙V/ of curves around C by another family M of curves
étale locally isomorphic to the original ones around the collapsed component. The
following picture illustrates the new curve C after this replacement in each case; the
corresponding families are described below.
Case (a) Let M be the moduli space of all smooth covers .C; xi; xj; xk; xl; / of P1
of degree d1 D mi C mj satisfying
0 D mjxj C mixi; 1 D d1xk; and .xl/ D 1:
On the source curve C Š P1, we set xi D 0, xj D 1, xk D 1, and xl D .1 W w/ with
w 2 C n f1g. Then every element in M can be written as
.z0 W z1/ D ..z0  z1/d1 W z
mj
0 zmi
1 /
for  2 C satisfying wmi D .1  w/d1. Thus, the 1-dimensional space M is
parameterized by those .; w/ 2 C  .C n f1g/ with wmi D .1  w/d1. The non-
marked branch point of  can be computed to be at P D .dd1
1 W .1/mim
mj
j mmi
i
 /,
since the equation .z0 W z1/ D P has a double root at .mj W mi/.
Hence, in this family the singular curve C in the picture above corresponds to
the coordinates .; w/ D .0; 1/. After inserting this point into the family, we obtain
M Š C via .; w/ 7! w. The divisor ft
I .ijjkl/ is given by the function w1, which
vanishes to order 1 at C . As C has no automorphisms due to the marked point xl,
we obtain ordC ft
I .ijjkl/ D 1 as claimed.
Case (b) Now let M be the space of those smooth covers .C; xi; xj; xk; xl; / of P1
of degree d D mi such that
0 D d1xj C d2xk; 1 D dxi; and .xl/ D 1

306
A. Gathmann et al.
for ﬁxed d1; d2 with d1 C d2 D d. We set xk D 1, xi D 1, xj D 0, and xl D .1 W w/,
where w 2 C n f1g. Then every element of M can be written as
.z0 W z1/ D .zd
0 W .z0  z1/d2zd1
1 /;
where  2 C satisﬁes  D .1  w/d1wd2. The non-marked branch point of a cover
 can be computed to be at P D .  dd W dd1
1 dd2
2 /, since the equation .z0 W z1/ D P
has a double root at .d W d1/.
Again, as in the picture above we want to insert the special ﬁber C over .; w/ D
.0; 1/ to obtain the space M. As before, M Š C via .; w/ 7! w, and the divisor
ft
I .ijjkl/ is given by the function w  1, which vanishes to order 1 at C . Since C
has d1 automorphisms on C1 (which is totally ramiﬁed over 0 and 1), we obtain
ordC ft
I .ijjkl/ D d1.
Case (c) In this case, we use the previous computations and the WDVV equations.
Denote by xp the marked point of C on the collapsed component. We consider the
moduli space M which is the closure of all smooth .C; xi; xj; xk; xl; xp; / of degree
d D mp such that
0 D d1xi C d2xl; 1 D dxp; and .xj/ D .xk/ D 1
for ﬁxed d1; d2 with d1 C d2 D d. Again, by the Riemann-Hurwitz formula this
is a 1-dimensional space, with one non-marked ramiﬁcation for a smooth curve in
M. By letting the additional branch point run into 0, 1 and 1, we can see that @M
contains the following reducible curves:
(1) a degree-d1 component with xi; xj connected to a degree-d2 component with
xk; xl via a collapsed component over 1 with xp (this is the curve in the picture
above);
(2) a degree-d1 component with xi; xk connected to a degree-d2 component with
xj; xl via a collapsed component over 1 with xp;
(3) one collapsed component over 0 with xi; xl and one degree-d component with
xj; xk; xp;
(4) one collapsed component over 1 with xj; xk and one degree-d component with
xi; xl; xp.
The non-collapsed components in types (1)–(3) are all completely ramiﬁed over
two points. In types (1) and (2), exactly one point with no ramiﬁcation is marked,
killing the automorphisms. Hence, for each of these types (1) and (2) we have
one corresponding boundary point in M. In type (3), the point xj ﬁxes the
automorphisms, but then we have a choice to mark any preimage of 1 but xj to
be xk. Hence there are d  1 boundary points corresponding to a cover of type (3).
For type (4), a computation of the corresponding Hurwitz number shows that there
is a unique such cover, so that we have one such boundary point in M.
By the WDVV equations for ftI W M ! M0;4, we have ft
I .ijjkl/ D ft
I .iljkj/. The
left side of this equation is obviously supported on the boundary point of type (1)

Tropical Moduli Spaces of Stable Maps to a Curve
307
that we are interested in, whereas the right side is supported on all boundary points
of type (3) or (4). The multiplicity of ft
I .iljkj/ is 1 at each such boundary point by
our former computation. As there are d such boundary points, in total we obtain
ordC ft
I .ijjkl/ D d.
Theorem 4.3 (One-Dimensional Moduli Spaces M0.LV; ˙V/) Let V be a vertex
as in Construction 4.1: mapping to LV Š Lq
1 and satisfying rdim.V/ D 1 and nV D
0. Then M0.LV; ˙V/ with the weights obtained from the gluing Construction 3.14
is a one-dimensional balanced fan. In particular, V is good.
Proof The rays of M0.LV; ˙V/ are given by the combinatorial types ˛ of Construc-
tion 4.1. With the notation used there, we can take as spanning vectors for these
rays u˛ D vfi;jg in a type I case and u˛ D d2vI1 C d1vI2 in a type II case. As
the integer length of these vectors is 1 and gcd.d1; d2/, respectively, it follows from
Examples 3.15 and 3.16 that the gluing weight times the primitive vector in direction
of the ray corresponding to ˛ equals H˛ u˛, where H˛ denotes the Hurwitz number
of V1 for type I, and the product of the Hurwitz numbers of V1 and V2 for type II.
Hence we have to show that P
˛ H˛ u˛ D 0.
By Lemma 2.3, it sufﬁces to prove that P
˛ H˛ ftI.u˛/ D 0 for all four-element
subsets I D fi; j; k; lg of IV. The combinatorial types ˛ for which ftI.u˛/ is a multiple
of vfi;jg are exactly the ones corresponding to the three cases in Lemma 4.2. Due to
the deﬁnition of u˛, this multiple is 1, d1, and d1Cd2, respectively, and hence always
equal to ordC ft
I .ijjkl/ for a stable map C of this type. As the number of such stable
maps is exactly H˛, it follows that P
˛ H˛ ftI.u˛/ contains the vector vfi;jg with a
factor of deg ft
I .ijjkl/. But the same holds for the other two splittings of I, and thus
we conclude as desired that
X
˛
H˛ ftI.u˛/ D deg ft
I .ijjkl/ vfi;jg C deg ft
I .ikjjl/ vfi;kg C deg ft
I .iljjk/ vfi;lg D 0
since these three divisors are linearly equivalent and vfi;jg C vfi;kg C vfi;lg D 0 in
M0;I.
Proof (Proof of Theorem 1.1) Theorem 4.3 together with the arguments at the
beginning of Sect. 4 shows that all vertices V of combinatorial types of M0;n.L; ˙/
with rdim.V/ D 1 are good. By Lemma 3.18 we conclude that all vertices are good.
Hence M0;n.L; ˙/ is a tropical variety by Theorem 3.17, with the weights given in
Constructions 3.12 and 3.14. The claim about the dimension follows from Sect. 3.1.
Remark 4.4 By Lemma 3.18, the case of one-dimensional moduli spaces of tropical
stable maps to a curve represents a main building block for the proof of Theorem 1.1
stating that arbitrary-dimensional moduli spaces of tropical stable maps to a curve
are balanced. It was also a natural starting point for the investigation of the
balancing condition for tropical moduli spaces of stable maps to a curve. In
collaboration with Simon Hampe, the polymake extension a-tint [18, 20] was used
to compute—for a large series of relevant examples—the generating vectors of
rays for such one-dimensional moduli spaces. GAP [26] was used to compute

308
A. Gathmann et al.
conjectural local weights in terms of Hurwitz numbers, and to check the balancing
condition. These experiments with one-dimensional moduli spaces helped us to
form a precise conjecture for the weights. Finally, the computation of a series of
one-dimensional balanced examples led to the proof of the balancing condition in
the one-dimensional case, and thus also in the general case. This work thus heavily
relies on the examples computed with the help of a-tint and GAP.
Acknowledgements We would like to thank Erwan Brugallé, Renzo Cavalieri, Simon Hampe,
and Diane Maclagan for helpful discussions.
This work would not have been possible without extensive computations of example classes
which enabled us to establish and prove conjectures about polyhedra and their weights in our
moduli spaces. We used the polymake-extension a-tint [18, 20] and GAP [26].
Part of this work was accomplished at the Mittag-Lefﬂer Institute in Stockholm, during the
semester program in spring 2011 on Algebraic Geometry with a View towards Applications. The
authors would like to thank the institute for hospitality.
The ﬁrst and second author were partially funded by DFG grant GA 636/4-2 resp.
MA 4797/3-2, as part of the DFG Priority Program 1489.
We thank an anonymous referee for helpful comments on an earlier version of this paper.
References
1. L. Allermann, Tropical intersection products on smooth varieties. J. Eur. Math. Soc. 14(1),
107–126 (2012)
2. L. Allermann, J. Rau, First steps in tropical intersection theory. Math. Z. 264(3), 633–670
(2010). arXiv:0709.3705
3. K. Behrend, Gromov-Witten invariants in algebraic geometry. Invent. Math. 127(3), 601–617
(1997)
4. K. Behrend, B. Fantechi, The intrinsic normal cone. Invent. Math. 128, 45–88 (1997)
5. B. Bertrand, E. Brugallé, G. Mikhalkin, Tropical open Hurwitz numbers. Rend. Semin. Mat.
Univ. Padova 125, 157–171 (2011)
6. B. Bertrand, E. Brugallé, G. Mikhalkin, Genus 0 characteristic numbers of tropical projective
plane. Compos. Math. 150(1), 46–104 (2014). arXiv:1105.2004
7. E. Brugallé, H. Markwig, Deformation of tropical Hirzebruch surfaces and enumerative
geometry. J. Algebraic Geom. (2013, preprint). arXiv:1303.1340
8. A. Buchholz, H. Markwig, Tropical covers of curves and their moduli spaces.
Commun.
Contemp. Math. (2013). https://doi.org/10.1142/S0219199713500454
9. L. Caporaso, Gonality of algebraic curves and graphs. Springer Proc. Math. Stat. 71, 77–108
(2014)
10. R. Cavalieri, P. Johnson, H. Markwig, Tropical Hurwitz numbers. J. Algebr. Comb. 32(2),
241–265 (2010). arXiv:0804.0579. https://doi.org/10.1007/s10801-009-0213-0
11. R. Cavalieri, P. Johnson, H. Markwig, Wall crossings for double Hurwitz numbers. Adv. Math.
228(4), 1894–1937 (2011). arXiv:1003.1805
12. R. Cavalieri, H. Markwig, D. Ranganathan, Tropicalizing the space of admissible covers. Math.
Ann. (2014, preprint). arXiv:1401.4626
13. R. Cavalieri, H. Markwig, D. Ranganathan, Tropical compactiﬁcation and the Gromov–Witten
theory of P1. Sel. Math. 1(34) (2016). arXiv:1410.2837. https://doi.org/10.1007/s00029-016-
0265-7
14. E.M. Feichtner, B. Sturmfels, Matroid polytopes, nested sets and Bergman fans. Port. Math.
62, 437–468 (2005). arXiv:math.CO:0411260

Tropical Moduli Spaces of Stable Maps to a Curve
309
15. W. Fulton, R. Pandharipande, Notes on stable maps and quantum cohomology, in Algebraic
Geometry: Santa Cruz 1995, ed. by J. Kollár et al. Proceedings of Symposia in Pure
Mathematics, vol. 62(2) (American Mathematical Society, Providence, RI, 1997), pp. 45–96
16. A. Gathmann, D. Ochse, Moduli spaces of curves in tropical varieties, in Algorithmic
and Experimental Methods in Algebra Geometry, and Number Theory, ed. by G. Böckle,
W. Decker, G. Malle (Springer, Heidelberg, 2018). https://doi.org/10.1007/978-3-319-70566-
8_11
17. A. Gathmann, M. Kerber, H. Markwig, Tropical fans and the moduli space of rational tropical
curves. Compos. Math. 145(1), 173–195 (2009). arXiv:0708.2268
18. E. Gawrilow, M. Joswig, Polymake: a framework for analyzing convex polytopes, in Polytopes
– Combinatorics and Computation, ed. by G. Kalai, G.M. Ziegler (Birkhäuser, Boston, 2000),
pp. 43–74
19. A. Gross, Correspondence theorems via tropicalizations of moduli spaces. Commun. Contemp.
Math. (2014, to appear). arXiv:1406.1999
20. S. Hampe, a-tint: a polymake extension for algorithmic tropical intersection theory. Eur. J.
Comb. 36C, 579–607 (2014). arXiv:1208.4248
21. H. Markwig, J. Rau, Tropical descendant Gromov-Witten invariants.
Manuscripta Math.
129(3), 293–335 (2009). arXiv:0809.1102. https://doi.org/10.1007/s00229-009-0256-5
22. G. Mikhalkin, Enumerative tropical geometry in R2. J. Am. Math. Soc. 18, 313–377 (2005).
arXiv:math.AG/0312530
23. G. Mikhalkin, Moduli spaces of rational tropical curves, in Proceedings of Gökova Geometry-
Topology Conference GGT 2006, pp. 39–51 (2007). arXiv:0704.0839
24. D. Ochse, Moduli spaces of rational tropical stable maps into smooth tropical varieties. Ph.D.
thesis, TU Kaiserslautern (2013)
25. D. Speyer, B. Sturmfels, The tropical Grassmannian. Adv. Geom. 4, 389–411 (2004)
26. The GAP Group: GAP – Groups, Algorithms, and Programming, Version 4.8.6 (2016). http://
www.gap-system.org
27. R. Vakil, The enumerative geometry of rational and elliptic curves in projective space. J. Reine
Angew. Math. (Crelle’s Journal) 529, 101–153 (2000)

Invariant Bilinear Forms on W-Graph
Representations and Linear Algebra
Over Integral Domains
Meinolf Geck and Jürgen Müller
Abstract Lie-theoretic structures of type E8 (e.g., Lie groups and algebras,
Iwahori–Hecke algebras and Kazhdan–Lusztig cells, : : :) are considered to serve as
a “gold standard” when it comes to judging the effectiveness of a general algorithm
for solving a computational problem in this area. Here, we address a problem
that occurred in our previous work on decomposition numbers of Iwahori–Hecke
algebras, namely, the computation of invariant bilinear forms on so-called W-graph
representations. We present a new algorithmic solution which makes it possible to
produce and effectively use the main results in further applications.
Keywords Iwahori-Hecke algebras • Balanced representations • W-graph rep-
resentations • Invariant forms • Integral linear algebra • Linear algebra over
polynomial rings • MeatAxe philosophy
Subject Classiﬁcations 20C08, 20C40
1
Introduction
This paper is concerned with the representation theory of Iwahori–Hecke algebras.
Such an algebra H is a certain deformation of the group algebra of a ﬁnite Coxeter
group W. In [6], the notion of “balanced representations” of H was introduced,
which has turned out to be useful in several applications. We mention here the
construction of cellular structures on H (see, e.g., [8, Chap. 2]), the determination
M. Geck ()
IAZ-Lehrstuhl für Algebra, Universität Stuttgart, Pfaffenwaldring 57, 70569 Stuttgart, Germany
e-mail: meinolf.geck@mathematik.uni-stuttgart.de
J. Müller
Arbeitsgruppe Algebra und Zahlentheorie, Bergische Universität Wuppertal, Gauß-Straße 20,
42119 Wuppertal, Germany
e-mail: juergen.mueller@math.uni-wuppertal.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_13
311

312
M. Geck and J. Müller
of decomposition numbers of H
(see [9]), and the computation of Lusztig’s
function aW W ! Z (see [7, §4]). To check whether a given representation of H
is balanced or not is a computationally hard problem; it involves the construction
of a certain invariant bilinear form on the underlying H -module. It has been
conjectured in [6] that so-called “W-graph representations” of H
are always
balanced. But even if such a theoretical result were known to be true, certain
applications (e.g., the determination of decomposition numbers) would still require
the explicit knowledge of the Gram matrices of the invariant bilinear forms. In this
paper, we discuss algorithms for the construction of these Gram matrices for W of
exceptional type. The biggest challenge—by far—is the case where W is of type E8.
(The distinguished role of E8 when it comes to performing explicit computations is
highlighted in various recent survey articles; see, e.g., Garibaldi [5], Lusztig [18],
Vogan [25].)
In the situations of interest to us, the algebra H is deﬁned over the ﬁeld of
rational functions K D Q.v/ (where v is an indeterminate); it has a natural basis
fTw j w 2 Wg. Explicit models for the irreducible representations of H are known
by the work of Naruse [22], Howlett and Yin [14, 15]. Now let us ﬁx an irreducible
matrix representation XW H ! Kdd. In order to show that X is balanced, one needs
to determine a non-zero symmetric matrix P 2 Kdd such that
P X.Tw/ D X.Tw1/tr P
for all w 2 WI
this matrix P then has to satisfy certain additional properties. Thus, the computation
of P essentially amounts to solving a system of linear equations; for theoretical
reasons, we know that this system has a unique solution up to multiplication by a
scalar. Rescaling a given solution by a suitable non-zero polynomial in QŒv, we can
assume that all entries of P are in ZŒv and that their greatest common divisor is ˙1;
then P is unique up to sign and is called a “primitive Gram matrix”. The general
theory also shows that a particular solution is given by
P0 D
X
w2W
X.Tw/tr X.Tw/ 2 Kdd:
Thus, if the matrices X.Tw/ (w 2 W) are known and if jWj is not too large, then
we can simply perform the above summation and obtain P0; rescaling P0 yields a
primitive Gram matrix P. This procedure works for types F4, E6, for example (and
this is easily implemented in CHEVIE [11]).
Already for type E7, one needs to use a more sophisticated approach as described
in [9, §4.3], based on Parker’s “standard basis algorithm” [23], in combination with
interpolation and modular techniques. This also works for type E8, but it is efﬁcient
only for irreducible representations of dimension up to about 2500. In our previous
work on decomposition numbers, this was sufﬁcient to obtain the desired results for
type E8; see [9, Remark 4.10]. In principle, one could have run the above procedure
on all irreducible representations of type E8, but experiments showed that this would
have needed a total of nearly 1 year of CPU time. On the other hand, from a strictly

Invariant Bilinear Forms
313
logical point of view, one does not need to know exactly how the Gram matrices
have been obtained, because as an independent veriﬁcation one can simply check
that they form a solution to the above system of linear equations. However, to store
the various primitive Gram matrices requires about 28 GB of disk space, and even
the veriﬁcation alone is a major task as it involves the computation of products of
(large) matrices with polynomial entries. In any case, this raises a serious issue of
making sure that our results are reliable and reproducible.
In our view, the solution to deal with this issue is to develop better mathematical
tools which make it possible to reproduce the results efﬁciently as needed, and this
is what we will do in this paper. Indeed, for example, in order to deal with the
irreducible representation of largest dimension for type E8 (which is 7168), the old
approach would have needed roughly 7 weeks of CPU time, while the one described
here requires only about 20 h, which amounts to a factor of almost 60. (See Sect. 9.1
for more details.) In view of the complexity of the task, and the experiences made
elsewhere with explicit computations in type E8 (see the references cited above),
it was clear that developing efﬁcient methods would not be a standard, let alone
press-button application of existing tools from computer algebra. Maier et al. [19]
proposed an approach based on parallel techniques, but type E8 still seems to be a
major challenge there. Hence one of the purposes of this paper is to give a systematic
description of the (serial) methods we have used for the computation of Gram
matrices of invariant bilinear forms for Iwahori–Hecke algebras.
The basic strategy in our approach is to reduce computational linear algebra over
the Laurent polynomial ring QŒv; v1 to linear algebra over the integers. Thus,
generally speaking, we are faced with the problem of devising efﬁcient tools to do
computational linear algebra over integral domains, not just over ﬁelds. In order to
do so, we build on general ideas from computational representation theory, more
precisely on the celebrated so-called MeatAxe philosophy [23], which comprises
of specially tailored, highly efﬁcient techniques for computational linear algebra
over (small) ﬁnite ﬁelds. Attempts to generalize these ideas to linear algebra over
the (inﬁnite) ﬁeld of rational numbers, and further to linear algebra over the integers
have been coined the IntegralMeatAxe [24]. The last word on this has not been said
yet, and in this paper we are trying to contribute here as well. (As future work, we
are planning to develop a full IntegralMeatAxe package along the present lines.)
But we are additionally going one step further by setting out to extend these ideas to
linear algebra over the univariate polynomial rings over the rationals or the integers.
To do so, the basic idea is to reduce to linear algebra over the integers by
evaluating polynomials with rational coefﬁcients at integral places, where we are
using as few “small” places as possible, and to recover the polynomials in question
by a Chinese remainder technique. Hence this strategy, ﬁtting nicely into the
IntegralMeatAxe philosophy, differs from those known to the literature, inasmuch
we are neither using modular methods (which would mean to go over to polynomial
rings over ﬁnite ﬁelds), nor are we in a position to use interpolation (which would
mean to use lots of places to evaluate at). Thus another purpose of this paper is to
give a detailed description of the new computational tasks arising in pursuing this
strategy, and how we have accomplished them. Although the choice of the material

314
M. Geck and J. Müller
presented is governed by our application to Iwahori–Hecke algebras, it is exhibited
with a view towards general applicability.
Here is an outline of the paper: In Sect. 2 we recall some basic facts about
representations of ﬁnite Coxeter groups and Iwahori–Hecke algebras, in particular
the notions of W-graphs, balancedness, and invariant bilinear forms. We conclude
with Theorem 2.5 saying that for the representations afforded by the W-graphs given
by Naruse [22], Howlett and Yin [14, 15] are actually balanced, and in Tables 1 and 2
we list some numerical data associated with their primitive Gram matrices.
In the subsequent sections we describe our general approach towards linear
algebra over integral domains, which consists of a cascade of steps: In Sect. 3 we
ﬁrst deal with linear algebra over Z. We discuss the key tasks of rational number
recovery and of ﬁnding integral linear dependencies. Both tasks are known to
the literature, but for the former we provide a variant containing a new feature,
while for the latter we proceed along another strategy, within the IntegralMeatAxe
philosophy. Subsequently, we apply this to computing nullspaces, inverses, and the
so-called “exponents” of matrices over Z. In Sect. 4 we then describe our general
approach to deal with polynomials, in view of our aim to do linear algebra over
polynomial rings. The key task is to recover a polynomial with rational coefﬁcients
from some of its evaluations at integral places. Here, we are aiming at using as few
“small” places as possible, whence we are not in a position to apply interpolation,
but we are using a Chinese remainder technique instead. Moreover, we devise a
method to recover a polynomial from some of its evaluations where the latter are
“rescaled” by unknown scalars; the necessity of being able to solve this task is
closely related to our use of the IntegralMeatAxe, hence to our knowledge this
method is new as well. In Sect. 5 we proceed to show how linear algebra over Z
and polynomial recovery, as discussed in earlier sections, can now be combined
to do linear algebra over ZŒX and QŒX, by devising methods to computing
nullspaces, inverses, exponents and products of matrices using this new approach.
In Sect. 6 we ﬁnally recall the “standard basis algorithm” originally developed in
[23] for computations over ﬁnite ﬁelds. We present a general variant for absolutely
irreducible matrix representations over an arbitrary ﬁeld, show how this can be used
to compute homomorphisms between such representations, and discuss how the
necessary computations are facilitated over the ﬁelds Q and Q.X/, using the tools
we have developed.
Having the general tools in place, in Sect. 7 we return to our particular application
of computing Gram matrices of invariant bilinear forms for W-graph representations
X of Iwahori–Hecke algebras. We proceed along the strategy which has already
been indicated in [9, Section 4.3], where here we take the opportunity to provide
full details. We begin by computing standard bases for the representations X and X0,
where the latter is given by X0.Tw/ WD X.Tw1/tr, for w 2 W. In order to ﬁnd suitable
seed vectors to start with, we use an observation on restrictions of representations of
Iwahori–Hecke algebras to parabolic subalgebras, which naturally leads to certain
distinguished elements of H having actions of co-rank one on X and X0. To actually
run the standard basis algorithm subsequently, we again revert to a specialization
technique. In Sect. 8 we proceed by collecting a few observations on the standard

Invariant Bilinear Forms
315
bases B and B0 of the representations X and X0 thus obtained. Indeed, the matrix
entries occurring seem to be much less arbitrary than expected from general
principles, but this has only been veriﬁed experimentally for the representations
under consideration here, while a priori proofs are largely missing (so far). The ﬁnal
computational step then essentially is to determine the product B1  B0, which up to
rescaling is a Gram matrix as desired. To do this efﬁciently, apart from the general
tools developed above, we make heavy use of the special form of the matrix entries
of B1  B0 just mentioned. In the concluding Sect. 9 we provide running times and
workspace requirements for our computations in types E7 and E8, and present an
explicit (tiny) example for type E6.
It should be clear from the above description that to pursue our novel approach
we had to solve quite a few tasks for which there was no pre-existing implemen-
tation, let alone in one and the same computer algebra system. To develop the
necessary new code, as our computational platform we have chosen the computer
algebra system GAP [4]. This system provides efﬁcient arithmetics for the various
basic objects we need: (1) rational integers and rational numbers, which in turn are
handled by the GMP library [12]; (2) row vectors and matrices over the integers, the
rationals or (small) ﬁnite ﬁelds, where in this context the entries of row vectors are
actually treated as immediate objects; (3) ﬂoating point numbers, where the limited
built-in facilities are sufﬁcient for our purposes. Moreover, the necessary input data
on Iwahori–Hecke algebras and their representations is provided by the computer
algebra system CHEVIE [20], which conveniently is a branch of GAP.
2
Iwahori–Hecke Algebras and Balanced Representations
We begin by recalling some basic facts about representations of ﬁnite Coxeter
groups and Iwahori–Hecke algebras; see [8, 10, 17] for further details.
2.1
Iwahori-Hecke Algebras
We ﬁx a ﬁnite Coxeter group W with set of simple reﬂections S; for w 2 W, we
denote by l.w/ the length of w with respect to S. Let LW W ! Z be a weight function
as in [17], that is, we have L.ww0/ D L.w/ C L.w0/ whenever w; w0 2 W satisfy
l.ww0/ D l.w/ C l.w0/. Such a weight function is uniquely determined by its values
L.s/ for s 2 S. We will assume throughout that
L.s/ > 0
for all s 2 S:
Let R  C be a subring and A D RŒv; v1 be the ring of Laurent polynomials
over R in the indeterminate v. Let H D HA.W; L/ be the corresponding generic
Iwahori–Hecke algebra. Thus, H is an associative A-algebra which is free over A

316
M. Geck and J. Müller
with a basis fTw j w 2 Wg; the multiplication is given by the following rule, where
s 2 S and w 2 W:
TsTw D

Tsw
if l.sw/ D l.w/ C 1;
Tsw C .vL.s/  vL.s//Ts
if l.sw/ D l.w/  1:
2.2
Modules for Iwahori-Hecke Algebras
Let F  C be the ﬁeld of fractions of R and assume that F is a splitting ﬁeld for W.
(For example, we could take R D F D R since R is known to be a splitting ﬁeld for
W.) Let Irr.W/ be the set of simple FŒW-modules (up to isomorphism); we shall
use the following notation:
Irr.W/ D fE j  2 g
and
d D dim E . 2 /;
where  is a ﬁnite index set. Let K D F.v/ be the ﬁeld of fractions of A and HK D
K ˝A H be the K-algebra obtained by extension of scalars from A to K. Then HK
is a split semisimple algebra and there is a bijection between Irr.W/ and Irr.HK/,
the set of simple HK-modules (up to isomorphism). Given  2 , we denote by E
v
a simple HK-module corresponding to E. Then E
v is uniquely determined (up to
isomorphism) by the following property. For w 2 W, we have
trace.Tw; E
v/ 2 FŒv; v1
and
trace.w; E/ D trace.Tw; E
v/jv7!1:
2.3
Iwahori-Hecke Algebras as Symmetric Algebras
The algebra HK is symmetric, with trace form W HK ! K given by .T1/ D 1
and .Tw/ D 0 for 1 ¤ w 2 W. The basis dual to fTw j w 2 Wg is given by
fTw1 j w 2 Wg. By the general theory of symmetric algebras, there are well-deﬁned
elements 0 ¤ c 2 A ( 2 / such that the following orthogonality relations hold
for ;  2 :
X
w2W
trace.Tw; E
v/trace.Tw1; E
v / D
 dc
if  D ;
0
if  ¤ :
As observed by Lusztig, we can write each c uniquely in the form
c D fv2a C linear combination of larger powers of v;

Invariant Bilinear Forms
317
where f is a strictly positive real number and a is a non-negative integer. The
“a-invariants” a will play a major role in the sequel; these numbers are explicitly
known for all types of W and all choices of L (see [8, §1.3], [17, Chap. 22]).
Alternatively, a can be characterized as follows:
a D minfi > 0 j vitrace.Tw; E
v/ 2 FŒv for all w 2 Wg:
2.4
Balanced Representations
Let O  K be the localization of FŒv in the prime ideal .v/, that is, O consists of
all fractions of the form f=g 2 K where f; g 2 FŒv and g.0/ ¤ 0. Let XW HK !
Kdd be a matrix representation afforded by E
v. Following [6], we say that X is
balanced if
vaX.Tw/ 2 Odd
for all w 2 W:
This concept plays a crucial role in the study of “cellular structures” on H (see [6])
and the determination of Kazhdan–Lusztig cells (see [7, §4]). It is known that every
E
v affords a balanced representation. Note that, given some matrix representation
afforded by E
v, the above condition is hard to verify since it involves representing
matrices for all w 2 W. Much better for practical purposes is the following
condition.
Proposition 2.1 (See [6, Prop. 4.3, Remark 4.4]) Assume that F  R. Let  2
 and XW HK ! Kdd be a matrix representation afforded by E
v. Then X is
balanced if and only if there exists a symmetric matrix ˝ 2 GLd.O/ such that
˝ X.Ts/ D X.Ts/tr ˝
for all s 2 S:
()
Remark 2.2 Note that, if a matrix ˝ satisﬁes (), then it immediately follows that
˝ X.Tw1/ D X.Tw/tr ˝
for all w 2 W:
Thus, ˝ is the Gram matrix of a symmetric bilinear form h ; iW E
v  E
v ! K
which is HK-invariant in the sense that
hTw:e; e0i D he; Tw1:e0i
for all e; e0 2 E
v and w 2 W:
Remark 2.3 Assume that F  R. Let  2  and XW HK ! Kdd be a matrix
representation afforded by E
v. Let E .X/ be the set of all P 2 Kdd such that
P X.Ts/ D X.Ts/tr P for s 2 S. Since X is irreducible, Schur’s Lemma implies
that all matrices in E .X/ are scalar multiples of each other. By Geck and Jacon

318
M. Geck and J. Müller
[8, Remark 1.4.9], there is a speciﬁc element P0 2 E .X/ given by
P0 WD
X
w2W
X.Tw/tr X.Tw/ 2 KddI
furthermore, we have det.P0/ ¤ 0. By the Schur Relations (see [10, 7.2.1]), we have
X
w2W
X.Tw1/P1
0 X.Tw/ D trace.P1
0 /cId:
Using the relation P0 X.Tw1/ D X.Tw/tr P0 for all w 2 W, we deduce that
trace.P1
0 /c D 1:
This provides a direct criterion for checking if a given matrix P 2 E .X/ equals P0.
Furthermore, if P ¤ 0 is an element of E .X/, then P D cP0 for some 0 ¤ c 2 K
and so ctrace.P1/P D ctrace.P1
0 /P0 D P0.
The following concept was introduced by Kazhdan–Lusztig [16] in the equal
parameter case (where L.s/ D 1 for all s 2 S); for the general case see [8, §1.4].
Deﬁnition 2.4 Let V be an HK-module with d WD dim V < 1. We say that V is
afforded by a W-graph if there exist
•
a basis fe1; : : : ; edg of V,
•
subsets Ii  S for 1 6 i 6 d,
•
and elements ms
ij 2 A, where 1 6 i; j 6 d and s 2 Ii n Ij,
such that the following hold. First, we require that
vL.s/ms
ij 2 vRŒv
and
ms
ij D ms
ijjv7!v1
for all 1 6 i; j 6 d; s 2 Ii n Ij:
Furthermore, for s 2 S, the action of Ts on V is given by
Ts:ej D
8
ˆ<
ˆ:
vL.s/ ej C
X
16i6dW s2Ii
ms
ij ei
if s 62 Ij;
vL.s/ ej
if s 2 Ij:
Thus, if V is afforded by a W-graph representation, then the action of Ts on V is
given by matrices of a particularly simple form.
It has been conjectured in [6] (see also [8, 1.4.14]) that, if the simple HK-
module E
v is afforded by a W-graph, then the corresponding matrix representation
is balanced. We now turn to the problem of explicitly verifying if a given irreducible
matrix representation of HK is balanced or not.

Invariant Bilinear Forms
319
2.5
Explicit Results
We shall assume from now that W is a ﬁnite Weyl group and that we are in the
equal parameter case where L.s/ D 1 for all s 2 S; we may take R D Z,
F D Q in the above discussion. (The remaining cases have been dealt with in [6,
Examples 4.5, 4.6].) It is known that every simple HK-module E
v is afforded by a
W-graph; see [8, Theorem 2.7.2] and the references there. As far as W of exceptional
type is concerned, such W-graphs have been determined explicitly, by Naruse [22],
Howlett and Yin [14, 15]. They are available in electronic form through Michel’s
development version of the CHEVIE system; see [20]. Now let us ﬁx  2  and
assume that XW HK ! Kdd is a corresponding representation afforded by a
W-graph. Concretely, this will mean that we are given the collection of matrices
fXs WD X.Ts/ j s 2 Sg. Our aim is to ﬁnd a matrix P D .pij/16i;j6d such that
PXs D Xtr
s P
for all s 2 S:
()
This is a system of jSjd2
 homogeneous linear equations for the d.d C 1/=2
unknown entries of P. (Recall that P is symmetric.) We know that P is uniquely
determined up to scalar multiples. Rescaling a given solution by a suitable non-zero
polynomial in QŒv, we can assume that all entries of P are in ZŒv and that their
greatest common divisor is ˙1; then P is unique up to a sign. Such a solution P will
be called a primitive Gram matrix for X. As in Remark 2.3, a speciﬁc solution P0
can be singled out by the condition that trace.P1
0 /c D 1. We claim that
•
the matrix P0
0 WD v2l.w0/P0 has entries in ZŒv, and
•
the non-zero entries of P0
0 have degree at most 2l.w0/.
Here, w0 denotes the longest element of W. Indeed, since all the entries of the
matrices Xs (s 2 S) are in ZŒv; v1, the same will be true for P0 as well. The
formulae in Deﬁnition 2.4 show that each matrix vXs (s 2 S) has entries in ZŒv.
Hence, all matrices vl.w0/X.Tw/ have entries in ZŒv and so P0
0 has entries in ZŒv.
Furthermore, the non-zero entries of each matrix vXs have degree 0, 1 or 2. This
yields the degree bound for the entries of P0
0.
Since the entries of P0
0 are integer polynomials of bounded degree, we can deter-
mine P0
0 by interpolation and modular techniques (Chinese remainder). Combining
this with the techniques described in [9, §4.3], one obtains an algorithm which
can be implemented in GAP in a straightforward way. Rescaling these matrices
by suitable non-zero polynomials in QŒv, we obtain primitive Gram matrices as
solutions of (). This approach readily produces primitive Gram matrices for W of
type F4, E6 and E7 in a few hours of computing time. As was already advertised in
Sect. 1, we also succeeded in obtaining primitive Gram matrices for type E8, where
it is one of the purposes of this paper to describe the methods involved.

320
M. Geck and J. Müller
Tables 1 and 2 contain some information about these primitive Gram matrices P:
1st column:
usual names of the irreducible representations.
2nd column:
maximum degree of a non-zero entry of P.
3rd column:
maximum absolute value of a coefﬁcient of an entry of P.
4th column:
is the specialized matrix Pjv!0 diagonal?
5th column:
prime divisors of the determinant of Pjv!0.
(No entry means that this determinant is ˙1.)
We note that the primes in the 5th column are so-called “bad primes” for W (as
in [8, 1.5.11]). In particular, the fact that Pjv!0 always has a non-zero determinant
means that det.P/ 2 O (see Proposition 2.1). Thus, we can conclude:
Table 1 Information on primitive Gram matrices for type F4, E6, E7; cf. 2.5
F4 Deg.
Abs.
val.
Diag. Det E6
Deg.
Abs.
val.
Diag. Det E7
Deg.
Abs.
val.
Diag. Det E7
Deg.
Abs.
val.
Diag. Det
11
0
1
y
1p
0
1
y
1a
0
1 y
168a 10
35 y
12
0
1
y
10
p
0
1
y
10
a
0
1 y
1680
a 26
2193 y
13
0
1
y
10s
6
3
y
7a
12
6 y
189a 12
56 y
14
0
1
y
6p
2
1
y
70
a
2
1 y
1890
a 16
112 y
21
2
1
y
60
p
10
5
y
15a
8
8 y
189b 28
7498 y
22
2
1
y
20s
6
3
y
150
a
6
3 y
1890
b 10
42 y
23
2
1
y
15p
4
2
y
21a
4
2 y
189c 22
454 y
24
2
1
y
150
p
8
4
y
210
a
10
7 y
1890
c 10
38 y
4
4
2
y
15q
6
3
y
21b
16
19 y
210a 10
35 y
91
4
2
y
150
q
8
8
y
210
b
4
2 y
2100
a 22
973 y
92
6
8
y
2
20p
4
2
y
27a
4
2 y
210b 14
253 y
93
6
12
y
2
200
p 22
61
y
270
a
32
164 y
2100
b 16
468 y
94 10
6
y
24p
6
5
y
35a
8
6 y
216a 22
1596 y
61
4
2
y
240
p 12
20
y
350
a
6
3 y
2160
a 14
227 y
62
4
4
y
2
30p
6
6
y
2
35b
6
3 y
280a 22
1836 n
3
12
8
54
y
2,3 300
p 18
304
y
2
350
b
22
144 y
2800
a 12
58 n
3
41
2
2
y
2
60s 10
26
y
56a
26
1082 y
2
280b 14
241 y
42
2
1
y
80s 14
711
y
2,3 560
a
6
6 y
2
2800
b 20
2368 y
43
2
1
y
90s 12
58
n
3
70a
12
56 y
315a 26
47;277 y
2,3
44
6
4
y
2
60p 10
21
y
700
a
10
26 y
3150
a 14
4122 y
2,3
81
4
2
y
600
p 12
44
y
84a
10
26 y
336a 20
892 y
82
6
3
y
64p
8
12
y
840
a
16
148 y
3360
a 14
175 y
83
4
2
y
640
p 20
192
y
105a 22
377 y
378a 24
7310 y
84
6
3
y
81p 10
24
y
1050
a
8
12 y
3780
a 14
453 y
16
8
16
y
2
810
p 12
32
y
105b 10
21 y
405a 14
637 y
2
1050
b 20
504 y
4050
a 26
46;878 y
2
105c 12
38 y
420a 16
1332 y
2
1050
c 12
44 y
4200
a 20
4148 y
2
120a
8
24 y
2
512a 20
6036 y
1200
a 30
7516 y
2
5120
a 20
6036 y

Invariant Bilinear Forms
321
Table 2 Information on primitive Gram matrices for type E8; cf. 2.5
Repr.
Deg.
Abs. val.
Diag.
Det
Repr.
Deg.
Abs. val.
Diag.
Det
Repr.
Deg.
Abs. val.
Diag.
Det
Repr.
Deg.
Abs. val.
Diag.
Det
1x
0
1
y
700x
12
538
y
2
2835x
24
1;344;484
y
8400
z
26
8048
y
10
x
0
1
y
7000
x
54
16;489;188
y
2
28350
x
32
5;391;418
y
1008z
12
156
n
3
28x
4
2
y
1400y
22
22;286
n
2,3
5670y
30
10;762;741
n
2,3,5
10080
z
40
66;780
n
3
280
x
12
10
y
840x
16
6044
y
3200x
24
266;284
y
2016w
28
797;422
y
35x
4
2
y
8400
x
26
37;603
y
32000
x
30
587;345
y
1296z
14
345
y
350
x
38
377
y
1680y
22
3447
n
2,5
4096x
22
531;634
y
12960
z
34
23;195
y
70y
8
6
y
972x
16
2098
y
40960
x
44
234;956;568
y
1400zz
16
10;042
y
50x
8
6
y
9720
x
36
185;342
y
4200x
24
5;413;484
y
2
14000
zz
34
358;379
y
500
x
22
257
y
1050x
16
3792
y
42000
x
36
129;331;224
y
2
1400z
14
8148
y
2,3
84x
6
3
y
10500
x
34
390;765
y
6075x
26
894;864
y
14000
z
50
60;122;676
y
2,3
840
x
38
675
y
2100y
22
5561
y
60750
x
34
10;488;013
y
2400z
22
6380
y
168y
16
340
y
1344x
14
1140
y
8z
2
1
y
24000
z
28
55;922
y
175x
12
52
y
13440
x
40
381;082
y
80
z
14
6
y
2800z
20
38;038
y
2
1750
x
20
992
y
2688y
24
169;180
y
56z
6
3
y
28000
z
30
882;222
y
2
210x
8
24
y
2
1400x
16
41;820
y
2,3
560
z
10
7
y
5600w
26
372;230
n
3
2100
x
42
95;780
y
2
14000
x
48
763;453;596
y
2,3
112z
6
6
y
2
3240z
16
25;586
y
420y
16
1432
y
1575x
14
783
n
3
1120
z
54
20;790
y
2
32400
z
48
33;653;538
y
300x
10
41
y
15750
x
44
850;956
n
3
160z
8
12
y
3360z
20
29;722
y
3000
x
40
12;710
y
3150y
26
6;166;994
y
2
1600
z
32
400
y
33600
z
32
775;084
y
350x
12
56
y
2100x
20
3514
y
448w
16
128
y
7168w
32
1;190;470;476
y
2,3
3500
x
20
290
y
21000
x
26
12;511
y
400z
12
132
y
4096z
22
531;634
y
525x
12
76
y
4200y
28
58;249;760
n
2
4000
z
38
58;368
y
40960
z
44
234;956;568
y
5250
x
24
1946
y
2240x
20
1;878;156
y
2
448z
12
290
y
4200z
26
728;053
y
567x
10
54
y
22400
x
42
60;390;945
y
2
4480
z
32
17;290
y
42000
z
28
1;298;612
y
5670
x
42
57;812
y
4480y
32
85;556;320;920
y
2,3,5
560z
10
73
y
4536z
24
2;728;756
y
1134y
22
8739
y
2268x
16
5948
y
2
5600
z
46
408;409
y
45360
z
38
50;779;421
y
700xx
18
1399
y
22680
x
40
6;442;224
y
2
1344w
24
177;956
y
5600z
26
3;115;126
y
2
7000
xx
20
5982
y
4536y
28
3;887;856
n
2
840z
14
643
y
56000
z
30
3;848;044
y
2

322
M. Geck and J. Müller
Theorem 2.5 Let W be of type F4, E6, E7 or E8 and L.s/ D 1 for all s 2 S. Then the
W-graph representations of Naruse [22], Howlett and Yin [14, 15] are balanced.
3
Linear Algebra Over the Integers
As was already mentioned in Sect. 1, the basic strategy of our approach to determine
Gram matrices of invariant bilinear forms for representations of Iwahori–Hecke
algebras is to reduce computational linear algebra over the polynomial rings ZŒX
or QŒX, where from now on X denotes our favorite indeterminate, to computational
linear algebra over the integers Z. Thus in this section we begin by describing how
we deal with matrices over Z, where we restrict ourselves to the aspects needed for
our present application.
Let us ﬁx the following convention: For x; y 2 Z, not both zero, let gcd.x; y/ 2 Z
denote the positive greatest common divisor of x and y. A vector 0 ¤ v 2 Qm,
where m 2 N, is called primitive, if actually v 2 Zm, and for the greatest common
divisor gcd.v/ of its entries we have gcd.v/ D 1. Clearly greatest common divisor
computations in Z yield a Q-multiple of v which is primitive. Similarly, a matrix
0 ¤ A 2 Zmn, where m; n 2 N, is called primitive, if actually A 2 Zmn, and for
the greatest common divisor gcd.A/ of its entries we have gcd.A/ D 1.
3.1
Continued Fractions and the Euclidean Algorithm
The ﬁrst computational task we are going to discuss, in Sect. 3.2 below, is rational
number recovery. This has been discussed in the literature at various places, see
for example [3, 21, 24] or [26, Section 5.10]. (We also gratefully acknowledge
additional private discussions with R. Parker on this topic.) Although the ideas
pursued in these references are closely related to ours, none of them completely
coincides with our approach, and proofs (if given at all) are not too elucidating.
Hence we present our approach in detail, for which we need a few preparations
ﬁrst:
Continued Fraction Expansions We recall a few notions from the theory of con-
tinued fraction expansions; as a general reference see for example [13, Chapter 10]:
Given  2 R such that  > 0, let
cfŒq1; q2; : : : D q1 C
1
q2 C
1
:::
be its (regular) continued fraction expansion, where q1 2 N0 and qi 2 N for i > 2.
This is obtained by letting q1 WD bc, and, as long as  ¤ q1, proceeding recursively
with
1
q1 instead of . This process terminates, after l > 1 steps say, if and only

Invariant Bilinear Forms
323
if  2 Q; otherwise we let l WD 1. Truncating at i 6 l yields the i-th convergent
i WD cfŒq1; : : : ; qi 2 Q of , hence we may write i WD i
i , where i; i 2 N0 such
that i > 1 and gcd.i; i/ D 1. Letting additionally 1 WD 0 and 1 WD 1, as well
as 0 WD 1 and 0 WD 0, for i > 1 we get by induction
i D qii1 C i2
and
i D qii1 C i2:
Hence the sequences Œ1; 2; : : : ; l and Œ2; 3; : : : ; l are strongly increasing.
Now let  D a
b 2 Q, where a; b 2 N. Then the continued fraction expansion of 
can be computed by the extended Euclidean algorithm, see [1, Algorithm 1.3.6], as
follows: Setting r0 WD a and r1 WD b, for 1 6 i 6 l let recursively qi 2 N0 and
riC1 WD ri1  qiri 2 N0
such that
riC1 < ri;
where l > 1 is deﬁned by rl > 0 but rlC1 D 0; actually we have qi > 1 for i > 2,
and of course rl D gcd.a; b/. Hence the sequence Œr1; : : : ; rlC1 has non-negative
entries and is strongly decreasing. Moreover, setting s0 WD 1 and t0 WD 0, as well as
s1 WD 0 and t1 WD 1, and for 1 6 i 6 l letting recursively
siC1 WD si1  qisi
and
tiC1 WD ti1  qiti;
we get ri D sia C tib. Then it is immediate by induction that i D .1/i  tiC1 and
i D .1/iC1  siC1, for i > 1, and hence
i D  tiC1
siC1
;
where
gcd.siC1; tiC1/ D 1;
for
1 6 i 6 l:
Hence the sequences Œs3; s4; s5 : : : ; ˙slC1 and Œt2; t3; t4 : : : ; ˙tlC1 have
positive entries and are strongly increasing. Finally, a direct computation yields
  i D a
b  i
i
D ia  ib
ib
D siC1a C tiC1b
siC1b
D riC1
bsiC1
;
for
1 6 i 6 l:
Another View on the Euclidean Algorithm For a; b 2 N we consider the Z-lattice
La;b WD hŒ1; a; Œ0; biZ  Z2:
Then we have j det.La;b/j D b, and it is immediate that Œx; y 2 Z2 is an element of
La;b if and only if y  ax .mod b/. Note that if 0 ¤ Œx; y 2 La;b is primitive, then we
necessarily have gcd.x; b/ D 1. Moreover, the extended Euclidean algorithm shows
that La;b D hŒsi; ri; ŒsiC1; riC1iZ, for all 0 6 i 6 l. We collect a few properties of
La;b:
Lemma 3.1
(a) For all 0 6 i 6 l C 1 we have hŒsi; riiQ \ La;b D hŒsi; riiZ.
(b) We have hŒsi; riiQ D hŒsj; rjiQ, where 1 6 i; j 6 l C 1, if and only if i D j.

324
M. Geck and J. Müller
Proof We ﬁrst show that whenever Œx; y 2 La;b such that 0 < jyj < ri, for some
0 6 i 6 l, then jxj > jsiC1j: We may assume that i > 2. Let c; d 2 Z such that
Œx; y D Œc; d 
 si
ri
siC1 riC1

;
where we may assume that c ¤ 0, which entails d ¤ 0 as well. Since ri > riC1 > 0,
this implies c  d < 0. Since the sequence Œs2; s3; s4; s5 : : : ; ˙slC1 has positive
entries, we get jxj D jcsi C dsiC1j D jcj  jsij C jdj  jsiC1j > jsiC1j, as asserted.
(a) We may assume that i > 2. Moreover, for i D l C 1 letting Œx; 0 2 La;b, it is
immediate from ax  0 .mod b/ that jslC1j D
b
rl D
b
gcd.a;b/ divides x. Hence
we may assume i 6 l, too. Then let d ¤ 1 be a divisor of gcd.si; ri/ such
that 1
d  Œsi; ri 2 La;b. Then we have 0 < j ri
d j < ri and j si
d j < jsij 6 jsiC1j,
contradicting the statement above.
(b) It follows from (a) that there are c; d 2 Z such that Œsj; rj D c  Œsi; ri and
Œsi; ri D d  Œsj; rj. Hence we get cd D 1, and since the sequence Œr1; : : : ; rlC1
has non-negative entries and is strongly decreasing, we infer ri D rj and i D j.
ut
Note that the statement in (b) is trivial if Œsi; ri is primitive, that is gcd.si; ri/ D 1.
But this is not always fulﬁlled, as the example in [26, Example 5.27] shows.
Proposition 3.2
(a) Let Œx; y 2 La;b such that x ¤ 0 and jxjjyj 6 b
2. Then we have Œx; y 2 hŒsi; riiZ,
for a unique 2 6 i 6 l C 1. In particular, if Œx; y is primitive then we have
Œx; y D Œsi; ri or Œx; y D Œsi; ri.
(b) Assume there is 0 ¤ Œx; y 2 La;b such that kŒx; yk WD
p
x2 C y2 <
p
b. Then
there is a unique 2 6 i 6 l C 1 such that kŒsi; rik <
p
b, and the shortest
non-zero elements of La;b are precisely Œsi; ri and Œsi; ri.
Proof
(a) Since Œx; y 2 La;b there is z 2 Z such that y D xa  zb. Then we have
ˇˇˇa
b  z
x
ˇˇˇ D
jyj
b  jxj D jxj  jyj
b  jxj2 6
1
2  jxj2 :
Thus by Legendre’s Theorem, see [13, Section 10.15, Theorem 184], we infer
that z
x occurs as a convergent in the continued fraction expansion of  D a
b, that
is, there is 2 6 i 6 l C 1 such that z
x D i1. This yields
y
x D xa  zb
x
D a  zb
x D a  bi1 D b.  i1/ D ri
si
:
Hence we have Œx; y 2 hŒsi; riiQ, and thus from Lemma 3.1 we get Œx; y 2
hŒsi; riiZ, together with the uniqueness statement.

Invariant Bilinear Forms
325
(b) Assume ﬁrst that x D 0, then by Lemma 3.1 we infer that b divides y, and hence
kŒx; yk > b >
p
b, a contradiction. Hence we have x ¤ 0. Moreover, from
.x y/2 D x2 Cy2 2xy > 0 we get 2  jxjjyj 6 x2 Cy2 D kŒx; yk2 < b, hence
from (a) we see that there is 2 6 i 6 l C 1 such that Œx; y D hŒsi; riiZ. Thus in
particular we have kŒsi; rik <
p
b.
In order to show uniqueness, and the statement on shortest elements, let 0 ¤
Œx0; y0 2 La;b such that kŒx0; y0k <
p
b. Then, as above, there is 2 6 i 6 l C 1
such that Œx0; y0 D hŒsj; rjiZ, hence in particular we have kŒsj; rjk <
p
b. Then
Hadamard’s inequality, see [26, Theorem 16.6], implies that
det
 si ri
sj rj
 
6 kŒsi; rik  kŒsj; rjk < b:
Since j det.La;b/j D b divides det
 si ri
sj rj
 
this entails hŒsi; riiQ D hŒsj; rjiQ, and
hence i D j by Lemma 3.1.
ut
A comparison of the above treatment with the references already mentioned
seems to be in order: The statement of Proposition 3.2(a) is roughly equivalent to [3,
Theorem] and [21, Theorem 1], respectively. Alone, the proof given in [3] appears
to be too concise, and provides a slightly worse bound for b to be large enough. And
[21, Theorem 1] is attributed in turn to [2], while for a proof the reader is referred
to [26]. Unfortunately, [26, Theorem 5.26] is not immediately conclusive for the
statements under consideration here.
The main difference between the above-mentioned approaches and ours is the
break condition used to actually determine the index i referred to in Proposi-
tion 3.2(a): In [2, 3, 26] a bound on the residues ri is used, while in [21, Section 3] the
quotients qi are considered instead (yielding a randomized algorithm). In contrast, in
our decisive Proposition 3.2(b) we are using the minimum of the lattice La;b, which
hence treats both the ri and si (in other words the unknown numbers y and x) on a
“symmetric” footing. To our knowledge, this point of view is new, its algorithmic
relevance being explained below.
3.2
Recovering Rational Numbers
We are now prepared to describe our ﬁrst computational task, which will appear both
in computations over Z in Sect. 3.3, and over the polynomial ring QŒX in Sect. 4.2:
Let x 2 N and 0 ¤ y 2 Z such that gcd.x; y/ D 1. Assume we are given a; b 2 N
such that gcd.x; b/ D 1 and y  ax .mod b/; note that since x is invertible modulo b
we may write y
x  a .mod b/ instead, which we will feel free to do if convenient.
Now, if b is large enough compared to x and jyj, the task is to recover y
x 2 Q from
its congruence class a .mod b/.

326
M. Geck and J. Müller
In view of Proposition 3.2(b), this is straightforward: Assuming that x2 C y2 <
b, the Z-lattice La;b D hŒ1; a; Œ0; biZ  Z2 has precisely two shortest non-zero
elements, namely the primitive elements ˙Œx; y. In other words, the rational number
y
x 2 Q can be found by computing a shortest non-zero element of La;b. This in turn
can be done algorithmically by the Gauß reduction algorithm for Z-lattices of rank 2,
see [1, Algorithm 1.3.14]. Moreover, compared to the general case, for the particular
lattice La;b we have a better break condition: We may stop early as soon as we have
found an element Œx; y 2 La;b such that x2 C y2 < b. If then Œx; y is primitive,
the rational number y
x fulﬁlls all assumptions made, where of course its correctness
has to be veriﬁed independently. Otherwise, if Œx; y is not primitive, or the shortest
element Œx0; y0 2 La;b found fulﬁlls x02 C y02 > b, then we report failure. Thus, in
practice, we choose b small, and rerun the above algorithm with b increasing, until
we ﬁnd a valid candidate passing independent veriﬁcation.
At this stage, we should point out the algorithmic advantage of our approach,
compared to the other ones mentioned: The latter refer to the convergents of
continued fraction expansions, and thus to the full sequence of non-negativeresidues
of the extended Euclidean algorithm. In contrast, the Gauß reduction algorithm to
ﬁnd a lattice minimum proceeds by iterated pair reduction, starting with the pair
Œ0; b and Œ1; a. Although this is essentially equivalent to running the extended
Euclidean algorithm on a and b, here we are allowed to use best approximation. This
amounts to using numerically smallest residues, instead of non-negative ones as was
necessary in the context of continued fraction expansions. Although we have not
carried out a detailed comparison, it is well-known that this saves a non-negligible
amount of quotient and remainder steps.
3.3
Finding Linear Combinations
We are now going to describe the basic task we are faced with in order to be able
to do computational linear algebra over Z. To do so, we of course avoid the Gauß
algorithm over Q, but we also do not refer to pure “lattice algorithms”, as they are
called in [1, Section 2.1], for example those to compute Hermite normal forms or
reduced lattice bases described in [1, Sections 2.4–2.7]. Instead, we use a modular
technique, which is a keystone to make use of the ideas of the MeatAxe in the
framework of the IntegralMeatAxe. To our knowledge, this has only been discussed
very brieﬂy in the literature, for example in [3, 24]. Moreover, our approach differs
from those cited, at least in detail; in particular, [3] only allows for regular square
matrices.
To describe the computational task, we again need some preparations ﬁrst: Given
a (rectangular) matrix A 2 Zmn, with Q-linearly independent rows w1; : : : ; wm 2
Zn, where m; n 2 N, let
L WD hw1; : : : ; wmiZ 6 Zn

Invariant Bilinear Forms
327
be the Z-lattice spanned by the rows of A, and let L 6 bL 6 Zn be its pure closure
in Zn, that is the smallest pure Z-sublattice of Zn containing L. Then the index
det.L/ WD ŒbLW L is ﬁnite; of course, if m D n then we have det.L/ D j det.A/j. Thus
for any vector v 2 Zn, we have v 2 bL if and only of there is a 2 N such that av 2 L;
in this case, if a is chosen minimal then it divides det.L/.
Now, given v 2 Zn, the task is to decide whether or not v 2 bL, and if this is the
case to compute a1; : : : ; am 2 Z and a 2 N such that gcd.a; a1; : : : ; am/ D 1 and
v D 1
a 
m
X
jD1
ajwj D 1
a  Œa1; : : : ; am  AI
in this case a and the ai are uniquely determined.
The p-Adic Decomposition Algorithm To do so, we choose a (large) prime p.
Then reduction modulo p yields the matrix A 2 Fmn
p
over the prime ﬁeld Fp. We
assume that the rows w1; : : : ; wm 2 Fn
p of A are Fp-linearly independent as well;
otherwise we choose another prime p. By the structure theory of ﬁnitely generated
modules over principal ideal domains, this condition is equivalent to sayingbL D L,
which in turn is equivalent to p not dividing det.L/. In particular, the independence
condition on w1; : : : ; wm 2 Fn
p is fulﬁlled for all but ﬁnitely many primes p.
Thus we have v 2 bL if and only if v 2 L D hw1; : : : ; wmiFp, solving the
decision problem. Furthermore, if v 2 bL then set v0 WD v, and for d 2 N0 proceed
successively as follows: Since vd 2 bL, there are Œad;1; : : : ; ad;m 2 Zm such that
 p
2 < ad;j 6 p
2 for all 1 6 j 6 m, and
vd D
m
X
jD1
ad;1wj D Œad;1; : : : ; ad;m  A 2 Fn
p:
Then we let
vdC1 WD 1
p 

vd  Œad;1; : : : ; ad;m  A

2 Zn:
Hence we have vdC1 2 bL as well, and we may recurse. This yields
v 

d
X
iD0
pi  Œai;1; : : : ; ai;m

 A 
h
d
X
iD0
piai;1; : : : ;
d
X
iD0
piai;m
i
 A .mod pdC1Zn/;
or equivalently
aj
a 
d
X
iD0
piai;j .mod pdC1/;
for all
1 6 j 6 m:

328
M. Geck and J. Müller
Thus, if v 2 L, or equivalently a D 1, then since  pdC1
2
< Pd
iD0 piai;j 6 pdC1
2
there is some d 2 N0 such that vdC1 D 0, implying that aj D Pd
iD0 piai;j, for
all 1 6 j 6 m, without further independent veriﬁcation necessary. Otherwise, if
v 2 bLnL, then applying rational number recovery for some d 2 N0 large enough, see
Sect. 3.2, reveals the vector 1
a  Œa1; : : : ; am 2 Qm; note that under the assumptions
made p does not divide a. In the latter case correctness is independently veriﬁed by
computing Œa1; : : : ; am  A 2 Zn and checking whether it equals av 2 Zn.
Modular Computations In practice, to check w1; : : : ; wm 2 Fn
p for Fp-linear
independence, and to compute the vectors Œad;1; : : : ; ad;m 2 Fm
p we use ideas taken
from the MeatAxe. In particular, in order to keep the depth d needed smallish, but
still to be able to make efﬁcient use of fast arithmetic over small ﬁnite prime ﬁelds,
we choose the prime p amongst the largest primes smaller than 28 D 256. (In our
application we for example use p D 251 as the default prime.)
3.4
Nullspace
In the framework of the IntegralMeatAxe there is a general method to compute a
Z-basis of the row kernel of a matrix with entries in Z, see [24]. But in view of the
application to row kernels of matrices over QŒX in Sect. 5.1, here we only deal with
the following restricted nullspace problem:
Given a matrix A 2 Qmn, where m; n 2 N, such that dimQ.ker.A// D 1, where
ker.A/ denotes the row kernel of A, compute a primitive vector v 2 Zm such that
ker.A/ D hviQ; then v is unique up to sign.
To do so, by going over to a suitable Q-multiple we may assume that A 2 Zmn.
Let w1; : : : ; wm 2 Zn be the rows of A. We may assume that w1 ¤ 0, since otherwise
we trivially set v WD Œ1; 0; : : : ; 0 2 Zm. Then for 2 6 i 6 m we successively
check, using the p-adic decomposition algorithm in Sect. 3.3, whether or not wi 2
hw1; : : : ; wi1iQ. If this is not the case, that is fw1 : : : ; wig is Q-linearly independent,
then if w1; : : : ; wi 2 Fn
p turns out to be Fp-linearly independent we increment i, while
otherwise we return failure in order to choose another prime p. If fw1 : : : ; wig is
Q-linearly dependent, then the p-adic decomposition algorithm returns a1; : : : ; ai1
2 Z and a 2 N such that gcd.a; a1; : : : ; ai1/ D 1 and wi D 1
a  Pi1
jD1 ajwj. Thus
v WD Œa1; : : : ; ai1; a; 0; : : : ; 0 2 ker.A/ 6 Zm is primitive.
3.5
Inverse
Matrix inversion over Q, from the point of view of reducing to computations over Z
as much as possible, can be formulated as the following task:

Invariant Bilinear Forms
329
Given a matrix A 2 Qnn, where n 2 N, such that det.A/ ¤ 0, compute B 2
Znn and c 2 N, such that A1 D 1
c  B 2 Qnn and the overall greatest common
divisor gcd.B; c/ of the entries of B and c equals gcd.B; c/ D 1; then .B; c/ is
unique.
To do so, by going over to a suitable Q-multiple we may assume that A 2 Znn.
Then the equation BA D c  En, where En denotes the identity matrix, implies that
gcd.B/ divides c, and hence B is necessarily primitive. Solving the equations X A D
En, for the unknown matrix X 2 Qnn, amounts to writing the rows of the identity
matrix as Q-linear combinations of the rows of A, which is done using the p-adic
decomposition algorithm in Sect. 3.3; recall that the rows of A indeed are assumed
to be Q-linearly independent.
3.6
The Exponent of a Matrix
Given a square matrix A 2 Znn such that det.A/ ¤ 0 as above, the number c 2 N
found in the expression A1 D 1
c B, where B 2 Znn is chosen to be primitive, turns
out to have another interpretation:
Let im.A/ 6 Zn be the Z-span of the rows of A. By the structure theory
of ﬁnitely generated modules over principal ideal domains, the annihilator of the
Z-module Zn=im.A/ is a non-zero ideal of Z, the positive generator exp.A/ of which
is called the exponent of A. Moreover, exp.A/ divides det.A/, which in turn divides
some power of exp.A/. Thus the prime divisors of exp.A/ are precisely the primes
p 2 Z such that A 2 Fnn
p
is not invertible.
Now, actually exp.A/ and c coincide: From BA D c  En we conclude that
.cZ/n 6 im.A/, hence exp.A/ divides c; conversely, since .exp.A/  Z/n 6 im.A/
there is B0 2 Znn such that B0A D exp.A/  En, implying that exp.A/  B D
c  B0, which by the primitivity of B shows that c divides exp.A/. In other words,
computing the inverse of A as described in Sect. 3.5 also yields a method to compute
exp.A/.
4
Computing with Polynomials
Having the necessary pieces of linear algebra over the integers in place, in this
section we describe computational aspects of single polynomials, before we turn
to linear algebra over polynomials rings in Sect. 5.

330
M. Geck and J. Müller
4.1
Polynomial Arithmetic
As our general strategy is to use linear algebra over Z or Q to do linear algebra
over ZŒX or QŒX, for all arithmetically heavy computations we recurse to Z or Q.
Consequently, for the remaining pieces of explicit computation in ZŒX or QŒX we
may use a simple straightforward approach:
We use our own standard arithmetic for polynomials over Z or Q, where a
polynomial 0 ¤ f D Pd
iD0 ziXi 2 QŒX is just represented by its coefﬁcient list
Œz0; : : : ; zd 2 QdC1 of length d C 1, where d D deg. f/. Thus we avoid structural
overhead as much as possible, and may use directly the facilities to handle row
vectors provided by GAP. But we would like to stress that this is just tailored
for our aim of doing linear algebra over polynomial rings, and not intended to
become a new general-purpose polynomial arithmetic. For example, we are not
providing asymptotically fast multiplication, as is for example described in [26,
Section 8.3].
In particular, we only rarely need to compute polynomial greatest common
divisors. Hence we avoid sophisticated (modular) techniques, as are for example
described and compared in [26, Chapter 6], but we are content with a simple variant
of the Euclidean algorithm: Assuming that the operands have integral coefﬁcients,
by going over to Q-multiples if necessary, in order to avoid coefﬁcient explosion
we just use denominator-free pseudo-division as described in [1, Algorithm 3.1.2],
and Collins’s sub-resultant algorithm given in [1, Algorithm 3.3.1], albeit the latter
without intermediate primitivisation.
On the other hand, we very often have to evaluate polynomials at various places,
where our strategy is to use as few of these specializations as possible, so that
evaluation at distinct places is done step by step. Thus we are not in a position
to use multi-point evaluation techniques, as are for example described in [26,
Section 10.1]. Hence we are just using the Horner scheme, which under these
circumstances is well-known to need the optimal number of multiplications.
We now describe the special tasks needed to be solved in our approach:
4.2
Recovering Polynomials
The aim is to recover a polynomial with rational coefﬁcients, which we are able to
evaluate at arbitrary integral places, from as few such evaluations (at “small” places)
as possible. More precisely:
Let 0 ¤ f WD Pd
iD0 ziXi 2 QŒX be a polynomial of degree d D deg. f/ 2 N0,
having coefﬁcients zi D yi
xi 2 Q, where xi 2 N and yi 2 Z such that gcd.xi; yi/ D 1.
Then the task is to ﬁnd pairwise coprime places b1; : : : ; bk 2 Z n f0; ˙1g, for some
(small) k 2 N, such that the degree d and the coefﬁcients z0; : : : ; zd of f can be
computed from the values f.b1/; : : : ; f.bk/ 2 Q alone. Note that, in particular, we do
not assume that k > d, so that polynomial interpolation is not applicable. (Actually,

Invariant Bilinear Forms
331
in our application we often enough have k  d, where for example k  5, but
d . 200.)
To this end, let b WD Qk
jD1 jbjj 2 N, and assume that we have gcd.xi; b/ D 1 and
x2
i C y2
i < b for all 0 6 i 6 d. Hence the congruence classes zi  yi
xi .mod bj/ and
f.bj/ .mod bj/ are well-deﬁned, and for the constant coefﬁcient of f we get
z0 
d
X
iD0
zibi
j  f.bj/ .mod bj/;
for
1 6 j 6 k:
Thus by the Chinese Remainder Theorem, see for example [1, Theorem 1.3.9], there
is a unique congruence class a .mod b/, where a 2 Z, such that a  z0 .mod b/.
To compute a 2 Z, we let aj 2 Z such that
f.bj/  aj .mod bj/;
for
1 6 j 6 k:
An application of Chinese remainder lifting in Z to the congruence classes a1
.mod b1/; : : : ; ak .mod bk/ yields the congruence class a .mod b/, and by our
choice of b applying rational number recovery as described in Sect. 3.2 reveals
z0 2 Q. Now we recurse to ef WD
fz0
X
2 QŒX, whose value at the place bj can
of course be determined directly from f.bj/ asef.bj/ D f.bj/z0
bj
2 Q.
Chinese Remainder Lifting Hence, apart from rational number recovery, the key
computational task to be solved is to perform Chinese remainder lifting in Z:
We are using the straightforward approach based on the extended Euclidean
algorithm, as is described in [1, Section 1.3.3]. Since we are computing many
lifts with respect to the same places b1; : : : ; bk, we make use of a precomputation
step, as in [1, Algorithm 1.3.11]. But, since again for reasons of time and memory
efﬁciency we are choosing small places bj, the specially tailored approach in
[1, Algorithm 1.3.11] to keep the intermediate numbers occurring small, at the
expense of needing more multiplications, does not pay off as experiments show.
Moreover, as we are computing the values f.bj/ for 1 6 j 6 k step by step, where
even the number k of places is not determined in advance, we cannot take advantage
of fast Chinese remainder lifting techniques, as are described for example in [26,
Section 10.3], either.
Our strategy is to rerun the above algorithm with k increasing, choosing small
integral 2 6 b1 < b2 <    < bk, and to discard quickly erroneous guesses by an
independent veriﬁcation, until the correct answer passing the veriﬁcation is found.
By the above discussion, this happens after ﬁnitely many iterations. Before that, if
b D j Qk
jD1 bjj is too small, or not coprime to all the denominators xi, the Chinese
remainder lifting process does not terminate, or it terminates with a wrong guess.
To catch the ﬁrst case, we impose a degree bound, and stop the lifting process with
a failure message if it is exceeded, in order to increment k. (In our application, 200
turned out to be a suitable degree bound in all cases.)

332
M. Geck and J. Müller
To catch the second case, we only allow for denominators xi dividing an imposed
bound. This is justiﬁed, since rational number recovery as described in Sect. 3.2
is a trade-off between ﬁnding the numerator y and the denominator x of the
rational number y
x to be reconstructed: In practice, we typically encounter small
denominators x and large numerators y, which escape the Gauß reduction algorithm
if b is chosen too small, since then the latter tends to return a larger denominator
x0 > x and a smaller numerator jy0j < jyj. (In our application, denominator bounds
such as small 2-powers, or 12, or 20 turned out to be sufﬁcient in all cases.)
4.3
Degree Detection
We keep the setting of Sect. 4.2. The technique to be described now has arisen
out of an attempt to determine the degree of f without determining its coefﬁcients.
Actually, it deals with the following more general situation (whose relevance for our
computations will be explained in Sect. 4.5 below):
Assume that instead of the values f.b1/; : : : ; f.bk/ we are only able to compute
“rescaled values” a1f.b1/; : : : ; akf.bk/ 2 Q, with scalar factors aj 2 Q such that
aj > 0, which are only known to come from a ﬁnite pool R of positive rational
numbers associated with f. Thus the task now becomes to ﬁnd k 2 N and coprime
places b1; : : : ; bk 2 Znf0; ˙1g as above, allowing to determine f up to some positive
rational scalar multiple, that is to ﬁnd af 2 QŒX, for some a 2 Q such that a > 0;
note that this also determines all the quotients aj
a .
To this end, we let ˛1; : : : ; ˛d 2 C be the complex roots of f, and set  WD
maxf0; j˛1j; : : : ; j˛djg. Moreover, since R is a ﬁnite set, we have
ı WD minfj ln.a0/  ln.a/j 2 RI a; a0 2 R; a ¤ a0g > 0:
Now, let k > 2, and for the places b1; : : : ; bk we additionally assume that
.1 C 2d/   < b1 <    < bk
and
ln.bk/  ln.b1/ < ıI
hence, in particular, the f.bj/ are non-zero and have the same sign. The necessity of
these choices will become clear below. But this forces us to show that for all k > 2
and all x > 0 and ı > 0 there actually exist pairwise coprime integers b1 <    < bk
such that x < b1 and ln
 bk
b1

< ı. Indeed, we are going to show that the latter
can always be chosen to be primes (where the mere existence proof to follow is
impractical, but in practice considering small primes works well, see Example 4.4):
Let p0 < p1 <    be the sequence of all primes exceeding x, and assume to the
contrary that for all k-subsets thereof, q1 <    < qk say, we have ln
 qk
q1

> ı. Then
we have pk1 > eı  p0, and thus pj.k1/ > ejı  p0, for all j 2 N. Using the prime

Invariant Bilinear Forms
333
number function .x/ WD jfp 2 NI pprime; p 6 xgj this implies
.ejı  p0/ 6 . p0/ C j.k  1/:
From this we get
lim
j!1
.ejı  p0/  ln.ejı  p0/
ejı  p0
6 lim
j!1

. p0/ C j.k  1/



jı C ln. p0/

ejı  p0
D 0;
contradicting the Prime Number Theorem, see [13, Section 1.8, Theorem 6], saying
that limx!1
.x/	ln.x/
x
D 1.
Growth Behavior of Polynomials We now consider the growth behavior of the
polynomial f. For x >  we have
@
@x

f.x/

D zd  @
@x

d
Y
rD1
.x  ˛r/

D f.x/ 
d
X
rD1
1
x  ˛r
;
implying
@
@x

ln. f.x//

D @
@x

f.x/


1
f.x/ D
d
X
rD1
1
x  ˛r
:
Thus, for 1 6 i < j 6 k, by the mean value theorem for derivatives there is bi <
ˇ < bj such that
ln. f.bj//  ln. f.bi//
ln.bj/  ln.bi/
D
d
X
rD1
ˇ
ˇ  ˛r
:
Since by assumption bi > .1 C 2d/   > .1 C 2d/  j˛rj, we have
ˇˇˇ
ˇ
ˇ  ˛r
 1
ˇˇˇ D
ˇˇˇ
˛r
ˇ  ˛r
ˇˇˇ 6
j˛rj
ˇ  j˛rj <
j˛rj
.1 C 2d/  j˛rj  j˛rj 6 1
2d
for all 1 6 r 6 d. All differences ˇ  ˛r 2 C having positive real parts, we get
d < ln. f.bj//  ln. f.bi//
ln.bj/  ln.bi/
< d C 1
2:
Moreover, by assumption we have 0 < ln.bj/ln.bi/ < ı 6 j ln.aj/ln.ai/j, hence
ˇˇˇln.aj/  ln.ai/
ln.bj/  ln.bi/
ˇˇˇ > 1:

334
M. Geck and J. Müller
Now, letting bxe WD bx C 1
2c 2 Z denote the integer nearest to x 2 R, we set
dij WD
jln.ajf.bj//  ln.aif.bi//
ln.bj/  ln.bi/
m
D
jln. f.bj//  ln. f.bi//
ln.bj/  ln.bi/
C ln.aj/  ln.ai/
ln.bj/  ln.bi/
m
for all 1 6 i; j 6 k such that i ¤ j; note that dij D dji. Hence from the above
estimates we infer that dij D d if and only if ai D aj. In particular, all these
numbers dij coincide if and only if a1 D    D ak, hence in this case immediately
determining d.
Combinatorial Translation Thus our task can now be rephrased in combinatorial
terms as follows: For c 2 Z let dCc be the undirected graph on the vertex set
f1; : : : ; kg, whose edges are the 2-subsets fi; jg  f1; : : : ; kg such that dij D d C c.
Then by the above discussion the connected components of d are complete
graphs, whose vertex sets coincide with the sets of j 2 f1; : : : ; kg such that the
associated scalars aj assume one and the same value. On the other hand, if dCc,
for some c ¤ 0, has a complete connected component with r > 2 vertices
bj1 <    < bjr, then for all i; j 2 fj1; : : : ; jrg such that i < j we have
c  1 <
ˇˇˇln.aj/  ln.ai/
ln.bj/  ln.bi/
ˇˇˇ < c C 1
2:
Thus we infer that the sequence aj1; : : : ; ajr is strictly increasing if c > 0, and strictly
decreasing if c < 0. In particular this implies that r 6 jRj. In other words, as soon
as we ﬁnd a complete connected component of a graph dCc having more than jRj
elements, then we may conclude that c D 0, and we have determined d. Moreover,
if k > jRj2 than this case actually happens.
Our algorithm to determine the degree d of f, and af for some a > 0, is now
straightforward: Again our strategy is to increase k step by step, and to choose
places 2 6 b1 < b2 <    < bk such that b1 is growing and ln.bk/  ln.b1/
tends to zero. Having made a choice, we compute the numbers dij 2 Z for all
1 6 i < j 6 k; note that here we do not see a way to avoid using non-exact ﬂoating
point arithmetic (to evaluate logarithms), while everywhere else we are computing
exactly. For all numbers d0 2 Z thus occurring we then determine the graph d0.
Amongst all the graphs found we choose one, again d0 say, having a complete
connected component of maximal cardinality, with vertex set J  f1; : : : ; kg say.
Then we run polynomial recovery, see Sect. 4.2, using the places fbjI j 2 J g and
the values fajf.bj/I j 2 J g, with degree bound d0.
4.4
An Example
Here is an example to illustrate the above process. (It is a modiﬁed version of an
example which actually occurred in our application.) Assume as places bj, for 1 6

Invariant Bilinear Forms
335
Table 3 An example for
degree detection
j
bj
aj f.bj/
aj
1
29
471132000262895400
1
25
2
31
5556161802048405504
1
5
3
37
271378870503231142344
1
4
41
203982274364082601464
1
5
5
43
1885780898401789278912
1
6
47
5946135224244400779264
1
7
53
28077873950889396256392
1
8
59
4493456499569142283200
1
25
9
61
34577756822169042208584
1
5
10
67
581970465933078043504704
1
11
71
246522309921169431519744
1
5
12
73
1766015503219395154436952
1
13
79
196427398952317706342400
1
25
j 6 k D 13, we have chosen the rational primes between 29 and 79, and evaluating
the unknown polynomial f has resulted in the list of values ajf.bj/ given in Table 3;
the scalars aj are of course not known either.
Then it turns out that the numbers d0 2 Z, where 1 6 i < j 6 13, come from an
34-element subset of f27; : : : ; 71g. For seven of them the associated graph d0 has
a connected component with at least three vertices, but only for two of them we ﬁnd
a complete connected component amongst them: The graph 7 has a complete con-
nected component consisting of the vertices B0 WD f47; 61; 79g, while the graph 13
consists of three connected components, which all are complete, having the vertices
B1 WD f37; 43; 47; 53; 67; 73g;
B2 WD f31; 41; 61; 71g;
B3 WD f29; 59; 79g:
Running polynomial recovery, see Sect. 4.2, using the places B0 fails by exceeding
the degree bound. But running it using B1 yields af D P13
iD0 ziXi 2 ZŒX, where
Œz0; : : : ; z13 D Œ1; 4; 8; 11; 12; 12; 12; 12; 12; 12; 11; 8; 4; 1;
while running it using B2 and B3 yields 1
5  af 2 QŒX and
1
25  af 2 QŒX,
respectively. Thus we indeed have d D deg. f/ D 13, and assuming that a D 1
we have determined the scalars aj, for 1 6 j 6 13, as well. Note that the bounds
assumed in Sect. 4.2 are fulﬁlled; and the roots of f turning out to be complex roots
of unity, implying  D 1, the bounds assumed in Sect. 4.3 are fulﬁlled as well.
It should be noted that for the preceding discussion we have chosen k large
enough to exhibit the occurrence of the erroneous set B0, for which we indeed
observe that the associated scalars aj are pairwise distinct. But this also reveals
another practical observation, at least for polynomials occurring in the applications

336
M. Geck and J. Müller
in Sect. 5: The scalars aj, here coming from the three-element set R D f1; 1
5; 1
25g,
typically are not uniformly distributed throughout R, but the scalar aj D 1 occurs
much more frequently than the other ones.
As was already mentioned, in practice we instead increase k step by step. Then
for the smallest k > 3 such that the graph 13 has a complete connected component
with at least three vertices, that is for k D 6, we ﬁnd the set B WD f37; 43; 47g of
places, indeed being associated to the case aj D 1. Now polynomial recovery using
B readily returns f; note that the bounds assumed in Sect. 4.2 are still fulﬁlled.
4.5
Catching Projectivities
We now have to explain where the conditions imposed in Sect. 4.3 come from:
Typically, for example for the tasks described in Sects. 5.1 and 5.2, our aim is to
determine a matrix over ZŒX or QŒX by computing various specializations ﬁrst,
that is evaluating at certain places b1; : : : ; bk, performing some linear algebra over Z
or Q, as described in Sect. 3, for each of the specializations, and then lifting back to
polynomials as explained in Sect. 4.2. But the linear algebra step in between might
only be unique up to a scalar in Q, which additionally depends on the particular
specialization considered. On the other hand, the matrix we are looking for might
also only be unique up to a scalar in Q.X/.
Let us now, again, agree on the following convention: Given f; g 2 ZŒX, not
both zero, let gcd.f; g/ 2 ZŒX denote the polynomial greatest common divisor of f
and g with positive leading coefﬁcient. A vector 0 ¤ v 2 QŒXm, where m 2 N, is
called primitive, if actually v 2 ZŒXm, and for the greatest common divisor gcd.v/
of its entries we have gcd.v/ D 1. Clearly greatest common divisor computations
in Z and in ZŒX yield a Q.X/-multiple of v which is primitive. Similarly, a matrix
A 2 QŒXmn, where m; n 2 N, is called primitive, if actually A 2 ZŒXmn, and for
the greatest common divisor gcd.A/ of its entries we have gcd.A/ D 1.
Specializing Primitive Vectors Hence, in the above context the task is to recover
a primitive vector Œf1; : : : ; fm 2 ZŒXm not from specializations Œf1.bj/; : : : ; fm.bj/ 2
Zm, for 1 6 j 6 k, but from “rescaled” versions Œajf1.bj/; : : : ; ajfm.bj/ 2 Qm
instead. This places us in the setting of Sect. 4.3, but it remains to justify the
assumption that the scalars aj 2 Q involved indeed come from a ﬁnite pool:
Proposition 4.1 Let f1; : : : ; fm 2 ZŒX, where m 2 N, such that gcd. f1; : : : ; fm/ D
1 2 ZŒX. Then there is a ﬁnite set P  N such that for all b 2 Z we have
gcd. f1.b/; : : : ; fm.b// 2 P:
Proof Note ﬁrst that by assumption f1; : : : ; fm do not have any common zeroes,
so that gcd. f1.b/; : : : ; fm.b// 2 N is well-deﬁned for any b 2 Z. We proceed by
induction on m 2 N. For m D 1 we have f1 D ˙1, and we may let P WD f˙1g.

Invariant Bilinear Forms
337
Hence let m > 2, where we may assume that all the fi, for 1 6 i 6 m, are non-
constant. Letting g WD gcd. f1; : : : ; fm1/ 2 ZŒX we have gcd.g; fm/ D 1 Letting
gi WD fi=g 2 ZŒX for 1 6 i 6 m  1, we have gcd.g1; : : : ; gm1/ D 1, thus by
induction let Q  N be a set as asserted associated with g1; : : : ; gm1. Now, given
b 2 Z, we may write
x WD gcd. f1.b/; : : : ; fm.b// D gcd.g.b/g1.b/; : : : ; g.b/gm1.b/; fm.b//
as x D yz, where y D gcd.g.b/; fm.b//, and z divides gcd.g1.b/; : : : ; gm1.b/; fm.b//.
Hence z divides gcd.g1.b/; : : : ; gm1.b//, and thus divides an element of Q.
Moreover, from gcd.g; fm/ D 1 we infer that the resultant  WD res.g; fm/ 2 Z
is different from zero, see [26, Corollary 6.20], which by von zur Gathen and
Gerhard [26, Corollary 6.21] implies that y D gcd.g.b/; fm.b// divides . Thus the
set P of all positive divisors of the elements of Q WD fr 2 NI r 2 Qg is as
desired.
ut
5
Linear Algebra Over Polynomial Rings
As was already mentioned, our general strategy to determine matrices over ZŒX or
QŒX is to specialize ﬁrst at integral places, to apply linear algebra techniques as
described in Sect. 3 to the matrices over Z or Q thus obtained, and subsequently
to recover the polynomial entries in question by the Chinese remainder lifting
technique described in Sect. 4.2, applying degree detection as described in Sect. 4.3
if necessary. In this section we describe how we can do linear algebra over ZŒX or
QŒX using this approach.
Since we are faced with both sparse and dense matrices, we keep two correspond-
ing formats for matrices over polynomial rings. (In our application, representing
matrices for W-graph representations, see Deﬁnition 2.4, are extremely sparse, while
Gram matrices for them, see Remark 2.2, typically are dense; see also Example 9.2.)
We have conversion and multiplication routines between them, but whenever it
comes to linear algebra computations we always use the dense matrix format.
From the arithmetical side, we are only using standard matrix multiplication, but no
asymptotically faster methods, as are for example indicated in [26, Section 12.1].
5.1
Nullspace
We have developed a solution to the following restricted nullspace problem only
(which is sufﬁcient for our application):
Given a matrix A 2 QŒXmn, where m; n 2 N, such that rkQŒX.ker.A// D 1, the
task is to determine a primitive vector v 2 ZŒXm such that ker.A/ D hviQŒX; then
the vector v is unique up to sign.

338
M. Geck and J. Müller
To do so, by going over to a suitable Q.X/-multiple we may assume that
A 2 ZŒXmn is primitive. Then we specialize the matrix A successively at integral
places b1; : : : ; bk, yielding matrices A.bj/ 2 Zmn. Since the rank condition on A
is equivalent to saying that det.A0/ D 0 for all .m  m/-submatrices A0 of A, while
there is an ..m  1/  .m  1//-submatrix A00 of A such that det.A00/ ¤ 0, we have
rkZ.ker.A.b/// > 1 for any b 2 Z, and for all but ﬁnitely many such b we indeed
have rkZ.ker.A.b/// D 1. Thus we may assume that all the chosen specializations
A.bj/ also fulﬁll rkZ.ker.A.bj/// D 1. Note that this provides an implicit check
whether the rank condition on A indeed holds.
Hence we are in a position to compute the row kernels ker.A.bj// D hvjiZ 6 Zm
as described in Sect. 3.4, where the vj 2 Zm are primitive, for all 1 6 j 6 k. Thus
the latter are of the form vj D 1
aj  v.bj/, where aj D gcd.v.bj// 2 N, and v 2 ZŒXm
is the desired primitive solution vector from above. By Proposition 4.1 we conclude
that the scalars aj involved indeed come from a ﬁnite pool only depending on v.
Now applying degree detection, see Sect. 4.3, and polynomial recovery, see
Sect. 4.2, yields candidate vectors 0 ¤ ev 2 QŒXm, which by going over to a
suitable Q-multiple can be assumed to be primitive. Then the correctness of ev can
be independently veriﬁed by explicitly computing evA and checking whether this is
zero.
5.2
Inverse
Given a matrix A 2 QŒXnn, where n 2 N, such that det.A/ ¤ 0, the task is to ﬁnd
B 2 ZŒXnn and c 2 ZŒX, such that A1 D 1
c B 2 Q.X/nn and the overall greatest
common divisor gcd.B; c/ 2 ZŒX of the entries of B and c equals gcd.B; c/ D 1;
then the pair .B; c/ is unique up to sign.
To do so, by going over to a suitable Q-multiple we may assume that A 2
ZŒXnn. Thus the equation BA D cEn implies that gcd.B/ divides c, and hence B is
primitive. Then we specialize the matrix A successively at integral places b1; : : : ; bk,
yielding matrices A.bj/ 2 Znn. Since for all but ﬁnitely many b 2 Z we have
det.A.b// ¤ 0, we may assume that all the chosen specializations A.bj/ indeed
also fulﬁll det.A.bj// ¤ 0. Note that this provides an implicit check whether the
invertibility condition on A indeed holds.
Hence we are in a position to compute the inverses A.bj/1 2 Qnn as described
in Sect. 3.5, yielding Bj 2 Znn and cj 2 Z, such that Bj is primitive and A.bj/1 D
1
cj  Bj, for all 1 6 j 6 k. Thus, if B 2 ZŒXnn and c 2 ZŒX are the desired solutions
from above, we infer
Bj D 1
aj
 B.bj/
and
cj D 1
aj
 c.bj/;
where
aj WD gcd.B.bj/; c.bj// 2 N:
By Proposition 4.1 we conclude that the scalars aj involved indeed come from a
ﬁnite pool only depending on B and c.

Invariant Bilinear Forms
339
Now applying degree detection, see Sect. 4.3, and polynomial recovery, see
Sect. 4.2, yields candidate solutionseB 2 QŒXnn andec 2 QŒXn, for which by going
over to a suitable Q-multiple we may assume that ec 2 ZŒXn and eB 2 ZŒXnn is
primitive. Then the correctness of .eB;ec/ can be independently veriﬁed by explicitly
computing AeB and checking whether it equalsec  En.
5.3
The Exponent of a Matrix
In view of the discussion in Sect. 3.6, and noting that QŒX is a principal ideal
domain as well, we pursue the analogy between matrix inverses over Z and over
QŒX still a little further. Indeed, given a square matrix A 2 ZŒXnn such that
det.A/ ¤ 0 as above, the polynomial c 2 ZŒX in the expression A1 D
1
c  B,
where B 2 ZŒXnn is chosen primitive, again has another interpretation:
Let the exponent exp.A/ 2 ZŒX of A be a primitive generator of the annihilator
of the QŒX-module QŒXn=im.A/, where im.A/ 6 QŒXn is the QŒX-span of the
rows of A; then exp.A/ is unique up to sign. Then, similar to Sect. 3.6, we conclude
that exp.A/ and c are associated in QŒX, and thus the primitivity of exp.A/ yields
c D gcd.c/  exp.A/ 2 ZŒX:
In other words, computing the inverse of A as described in Sect. 5.2 also yields
a method to compute the exponent of A as exp.A/ D
1
gcd.c/  c. Moreover, c governs
modular invertibility of A as follows:
Proposition 5.1 We keep the notation of Sect. 5.3. Let f0g ¤ p C ZŒX be a prime
ideal, let Qp WD Quot.ZŒX=p/ be the ﬁeld of fractions of the integral domain
ZŒX=p, and let Ap 2 .ZŒX=p/nn be the matrix obtained from A by reduction
modulo p. Then Ap is invertible in Qnn
p
if and only if c 62 p.
Proof The prime ideals of ZŒX being well-understood, we are in precisely one of
the following cases: (i) We have p D . p/, where p 2 Z is a prime; then we have
Qp Š Quot.FpŒX/ D Fp.X/, a rational function ﬁeld; (ii) we have p D . f/, where
f 2 ZŒX is non-constant and irreducible, hence in particular is primitive; then we
have Qp Š QŒX=.f/, an algebraic number ﬁeld; (iii) we have p D . p; f/, where p
and f are as above; then we have Qp D ZŒX=p Š FpŒX=. f/, a ﬁnite ﬁeld.
Now Ap is non-invertible in Qnn
p
if and only if det.A/ 2 p, which holds if and
only if there is an irreducible divisor of det.A/ being contained in p. Thus is sufﬁces
to determine (i) the primes p 2 Z, and (ii) the non-constant irreducible polynomials
f 2 ZŒX dividing det.A/ in ZŒX.
(i) From A1 D
1
det.A/  adj.A/ 2 Q.X/nn, where adj.A/ 2 ZŒXnn is the adjoint
matrix of A, we infer that c divides det.A/ in ZŒX. Hence any prime p 2 Z
dividing gcd.c/ also divides det.A/ in ZŒX. Conversely, if p does not divide
gcd.c/, then p-modular reduction yields AB D cEn ¤ 0 2 FpŒXnn, hence

340
M. Geck and J. Müller
det.A/ ¤ 0 2 FpŒX. Hence the primes p 2 Z we are looking for are precisely
the prime divisors of gcd.c/.
(ii) This is equivalent to ﬁnding the irreducible polynomials in QŒX dividing det.A/
in QŒX. Again similar to Sect. 3.6 we conclude that the latter are precisely the
irreducible polynomials dividing exp.A/. Hence the polynomials f 2 ZŒX we
are looking for are precisely the non-constant irreducible divisors of
1
gcd.c/  c.
ut
5.4
Product
Given matrices A 2 QŒXlm and B 2 QŒXmn, where l; m; n 2 N, the task is to
compute their product AB 2 QŒXln.
This is straightforwardly done: Again, by going over to suitable Q-multiples we
may assume that A 2 ZŒXlm and B 2 ZŒXmn. Then we specialize the matrices
A and B successively at integral places b1; : : : ; bk, yielding matrices A.bj/ 2 Zlm
and B.bj/ 2 Zmn, whose products A.bj/B.bj/ 2 Zln we compute. Now applying
polynomial recovery, see Sect. 4.2, yields candidate solutions eC 2 QŒXln. (Note
that since no “rescaling” takes place here it is not necessary to apply degree
detection.)
As for correctness, there are a few necessary conditions which can be used as
break conditions in polynomial recovery: All entries of eC must be polynomials with
integer coefﬁcients, and the degrees of the entries of the input matrices yield bounds
on the degrees of those of eC. But these conditions are far from being sufﬁcient, so
that, in contrast to the tasks in Sects. 5.1 and 5.2, here we do not have a general way
of independently verifying correctness. (In our application, as a very efﬁcient break
condition we have used the fact that the entries of eC have to be of a particular form,
see Sect. 8.3.)
5.5
An Alternative Approach
The idea of our approach is, essentially, to reduce computations over QŒX to
computations over Z, where lifting back to polynomials is done in one step by
combining specialization and Chinese remainder lifting. In consequence, we almost
entirely use arithmetic in characteristic zero (except the use of a large prime ﬁeld
in the p-adic decomposition algorithm in Sect. 3.3). But it seems to be worth-while
to say a few more words on the following “two-step” approach, which was already
mentioned brieﬂy in Sects. 1 and 2.5:
Assume our aim is to determine a matrix 0 ¤ A 2 QŒXmn, where m; n 2 N. To
this end, we choose pairwise distinct places b1; : : : ; bk 2 Z, for some k 2 N such
that k > d, where d 2 N0 is the maximum of the degrees of the non-zero entries of

Invariant Bilinear Forms
341
A. Thus, if we are able to compute the specializations A.bj/ 2 Qnn, for 1 6 j 6 k,
we may recover the entries of A by polynomial interpolation, as for example is
described in [26, Section 10.2]. In turn, to ﬁnd the specializations A.bj/ we choose
pairwise distinct primes p1; : : : ; pl 2 N, for some l 2 N, such that the denominators
of all the entries of A.bj/ are coprime to pi, for all 1 6 j 6 k and 1 6 i 6 l.
Then reduction modulo the chosen primes yields matrices Api.bj/ 2 Fmn
pi
. Hence, if
Ql
iD1 pi is large enough, and we are able to compute the modular reductions Api.bj/,
for 1 6 i 6 l, then rational number recovery, see Sect. 3.2, reveals the entries of
A.bj/. Hence this reduces ﬁnding the matrix A to ﬁnding the matrices Api.bj/ over
prime ﬁelds, for which we in turn may use techniques of the MeatAxe.
Thus here specialization and Chinese remainder lifting are done in two separate
steps, aiming at taking advantage of the efﬁciency of computations in prime
characteristic. But the “two-step” approach has severe disadvantages: The number
k of places to specialize at is at least as large as the degree of the polynomials in
question, hence many more and larger bj than in our approach are needed, increasing
time and memory requirements, presumably drastically. (In our application this
means k . 200.) Moreover, in order to use rational number recovery, the number
l of primes used for modular reduction must not be too small, at the expense of
possibly loosing the very fast arithmetic over small ﬁnite ﬁelds, which otherwise is
a major advantage of the MeatAxe.
Actually, apart from our own experiences, this kind of approach is pursued in
[19], and the ﬁgures on timings and memory consumption given there seem to
support the above comments. But it should be stressed that the emphasis of [19]
is on parallelizing this kind of computations, which we here do not consider at all.
6
Computing with Representations
As was already mentioned in Sect. 1, in our application we will make use of a
suitable variant of the “standard basis algorithm”, which was originally used in [23]
for computations over ﬁnite ﬁelds. In this section we present the necessary ideas
from computational representation theory, which can be formulated in terms of the
following general setting:
6.1
Standard Bases
Let A be a K-algebra, where K is a ﬁeld, being generated by the (ordered) set
A1; : : : ; Ar, where r 2 N0. Moreover, let XW A ! Knn be an absolutely irreducible
matrix representation of A , where n 2 N. Then the task is to ﬁnd a “canonical”
K-basis of the row space Kn with respect to the representation X, where we consider
right actions, as is common in the computational world.

342
M. Geck and J. Müller
To this end, let A0 2 A such that dimK.ker.X.A0/// D 1; note that whenever
X is irreducible such an element A0 exists if and only if X is absolutely irreducible.
This leads to the following breadth-ﬁrst search algorithm; see also [23]: Choose a
seed vector 0 ¤ u 2 ker.X.A0//, let B WD Œu and T WD ŒŒ0; 0, and set i WD 1. As
long as i does not exceed the cardinality of B, let v be the i-th element of B. Then
for 1 6 j 6 r let successively w WD v  X.Aj/, and check whether or not w 2 hBiK.
If so, then discard w; if not, then append w to B, and append Œi; j to T. Having done
this for all j, increment i and recurse.
Since the growing set B is K-linearly independent throughout, this algorithms
terminates after at most n loops. After termination, hBiK is a non-zero submodule
of the irreducible A -module Kn, and thus B indeed is a K-basis. (Of course, we
may terminate early, without any further checking, as soon as the cardinality of
B equals n, since from this point on B would not change anymore anyway.) The
(ordered) set B is called a standard basis of Kn with respect to the representation X,
the generators A1; : : : ; Ar, and the distinguished element A0, and the “bookkeeping
list” T is called the associated Schreier tree.
Strictly speaking, B also depends on the chosen seed vector, but it is essentially
unique in the following sense: If 0 ¤ eu 2 ker.X.A0// gives rise to the standard
basis e
B with Schreier tree eT, then we haveeu D c  u, for some 0 ¤ c 2 K, and thus
e
B D c  B and eT D T. Moreover, using the Schreier tree T D ŒŒi1; jj; : : : ; Œin; jn,
we may recover B D Œu1; : : : ; un, up to a scalar, without any searching as follows:
Choose 0 ¤ u1 2 ker.X.A0//, and for 2 6 k 6 n let successively uk WD uik  X.Ajk/.
In Practice We are able to run the above standard basis algorithm in the following
particular cases: If K is a (small) ﬁnite ﬁeld, then this can of course be done using
ideas from the MeatAxe, as is already described in [23].
More important from our point of view is the case K D Q. Then we may assume
that u 2 Zn, and if additionally X.Ai/ 2 Znn, for all 1 6 i 6 r, then we have B 
Zn, hence the key step in the above algorithm, to decide whether or not w 2 hBiQ,
can be done using the p-adic decomposition algorithm in Sect. 3.3, where whenever
B is enlarged we also check whether its p-modular reduction B  Fn
p is Fp-linearly
independent; if not, then we return failure in order to choose another prime p. (Note
that this is reminiscent of the strategy in Sect. 3.4.)
6.2
Computing Homomorphisms
We return to the general setting in Sect. 6.1, and let X0W A ! Knn be a matrix
representation of A , which is equivalent to X. Then a standard basis B0 D
Œv0
1; : : : ; v0
n of Kn with respect to the representation X0 is found by choosing
0 ¤ v0
1 2 ker.X0.A0// and just applying the Schreier tree T D ŒŒi1; jj; : : : ; Œin; jn
already known from the standard basis computation for X by letting successively
v0
k WD v0
ik  X0.Ajk/, for 2 6 k 6 n; note that by assumption we indeed have
dimK.ker.X0.A0/// D 1.

Invariant Bilinear Forms
343
Now let 0 ¤ C 2 Knn be an A -homomorphism from X to X0, that is we have
X.A/  C D C  X0.A/
for all
A 2 A I
of course, it sufﬁces to require this condition for the generators A1; : : : ; Ar only.
Since X is absolutely irreducible, it follows that C 2 GLn.K/ and is unique up to
a scalar. Moreover, we have ker.X.A0//  C D ker.X0.A0//, and thus going over
from the standard bases B and B0 with respect to X and X0, respectively, to the
associated invertible matrices B and B0 with rows v1; : : : ; vn 2 Kn and v0
1; : : : ; v0
n 2
Kn, respectively, we get B  C D B0, or equivalently
C D B1  B0 2 GLn.K/:
Thus to determine C we have to perform the following steps: ﬁnd A0 2 A such
that dimK.ker.X.A0/// D 1; compute ker.X.A0// 6 Kn and ker.X0.A0// 6 Kn;
compute a Schreier tree T with respect to X Š X0 and A0; apply the Schreier
tree T in order to compute standard bases B and B0 of Kn with respect to X and
X0, respectively; going over to matrices, compute the inverse B1 2 GLn.K/; and
compute the product C D B1  B0 2 GLn.K/.
In Practice If K D Q.X/, the nullspaces required can be found as described in
Sect. 5.1, where we may assume that v1 and v0
1 are primitive. Moreover, computing
matrix inverses and matrix products can be done as described in Sects. 5.2 and 5.4,
respectively; by multiplying with a suitable element of K we may assume that C is
primitive as well, then C is unique up to sign. Hence for our application it remains
to describe how a distinguished element and a Schreier tree can be found, and we
have to give an efﬁcient break condition for the algorithm in Sect. 5.4.
7
Finding Standard Bases for W-Graph Representations
We have now described the necessary infrastructure from linear algebra over integral
domains, and some relevant general ideas how to compute with representations, to
proceed to the explicit determination of Gram matrices of invariant bilinear forms
for balanced representations of Iwahori–Hecke algebras. We recall the setting of
Sect. 2.5, which we keep from now on:
Let .W; S/ be a ﬁnite Coxeter group, and let HA  HK be the associated generic
Iwahori–Hecke algebras with equal parameters over the ring A D ZŒv; v1 and
the ﬁeld K D Q.v/, respectively, being generated by fTsI s 2 Sg. Moreover, let
XW HK ! Knn, where n D d, be a W-graph representation associated with
 2 , and let
.X/0W HK ! KnnW Tw 7! X.Tw1/tr
for all
w 2 W:

344
M. Geck and J. Müller
As far as computer implementations are concerned, it is more convenient and
more efﬁcient to work with row vectors instead of column vectors. Therefore, we
will now work throughout with right actions rather than left actions as in Sect. 2.
Our aim is to ﬁnd a primitive Gram matrix P 2 ZŒvnn for X, that is, using the
language of right actions, a primitive matrix such that
X.Tw/  P D P  .X/0.Tw/
for all
w 2 W:
Thus the task is to ﬁnd a non-zero HK-homomorphism from X to .X/0. In order
to use the approach described in Sect. 6.2, we proceed as follows, where the basic
idea of this strategy has already been indicated in [9, Section 4.3]:
7.1
Finding Seed Vectors
To ﬁnd a suitable seed vector u1 2 Kn for the standard basis algorithm with respect
to X, we proceed as follows:
Specializing v 7! 1 we from HA recover the group algebra QŒW, and X
corresponds to an irreducible representation YW QŒW ! Qnn. In particular, the
index and sign representations of HK, given by indH W Ts 7! v and sgnH W Ts 7!
v1, respectively, for all s 2 S, correspond to the trivial and sign representations
of QŒW, given by 1WW s 7! 1 and sgnWW s 7! 1, respectively.
As was observed by Benson and Curtis (see [10, Section 6.3] and the references
there), there is a subset J  S (depending on , and in general not being unique),
such that the restriction of Y to the parabolic subgroup e
W WD WJ 6 W associated
with J fulﬁlls
dimQ
HomQŒe
W.sgne
W; Y/ D 1:
Note that J D ; and J D S if and only if Y equals 1W and sgnW, respectively.
Letting f
H K  HK be the parabolic subalgebra associated with J, this implies
dimK
Home
H K.sgne
H ; X/ D 1:
In other words, we equivalently have
dimK
 \
s2J
ker

X.Ts C v1/

D 1:
Now we are going to use the fact that X is a W-graph representation: Using the
I-sets associated with X, see Deﬁnition 2.4, we conclude that ker.X.Ts Cv1// D

Invariant Bilinear Forms
345
heiI s 2 IiiK for all s 2 S, where ei 2 Kn denotes the i-th “unit” vector. This implies
\
s2J
ker

X.Ts C v1/

D heiI J  IiiK:
Hence we may let u1 WD ei, where 1 6 i 6 n is the unique index such that J  Ii.
Note that this conversely also yields a way to ﬁnd all subsets of S fulﬁlling the
Benson–Curtis condition: We run through all subsets J  S, and just check whether
there is precisely one index 1 6 i 6 n such that J  Ii.
7.2
Finding a Distinguished Element
The above immediate approach strongly uses the fact that X is a W-graph
representation. Thus, in order to ﬁnd a suitable seed vector u0
1 2 Kn for the standard
basis algorithm with respect to .X/0 we specify a distinguished element T 2 HK
such that dimK.ker.X.T/// D 1. Let
T WD
 X
s2J
Ts

C v1  jJj 2 HA  HK:
Hence we have T
s2J ker.X.Ts Cv1// 6 ker.X.T//, and it remains to be shown
that dimK.ker.X.T/// D 1:
Assume to the contrary that dimK.ker

X.T/// > 2. Then letting
J WD 1
jJj 
X
s2J
s 2 QŒe
W;
specializing v 7! 1 shows that dimQ.ker.Y.1 C J/// > 2 as well. Since for
any vector u 2 ker.Y.1 C J// we have u  Y.k
J / D .1/k  u, for all k 2 N0,
Lemma 7.1 proven below implies that huiQ 6 Kn is QŒe
W-invariant and carries the
sign representation. Thus we have dimQ.HomQŒe
W.sgne
W; Y// > 2, a contradiction.
Lemma 7.1 For  2 f0; 1g let W WD fw 2 WI sgn.w/ D .1/g. Moreover, let
S WD 1
jSj 
X
s2S
s 2 QŒW:
Then, with respect to the natural topology on QŒW Š QjWj, we have
lim
k!1 2kC
S
D
1
jWj 
X
w2W
w 2 QŒW:

346
M. Geck and J. Müller
Proof We consider the Markov chain with (ﬁnite) state space W D W0
:
[ W1,
and transition matrix M D regW.S/ 2 QjWjjWj, where regWW QŒW ! QjWjjWj
denotes the regular matrix representation of QŒW. In other words, the matrix entry
Mw;w0, where w; w0 2 W, is given as
Mw;w0 WD
(
1
jSj;
if
w0 D ws
for some
s 2 S;
0;
otherwise:
Now, since sgn.ws/ D  sgn.w/ for all w 2 W and s 2 S, we conclude that
M2 D regW.2
S / induces Markov chains on both W0 and W1. Moreover, since any
element of W can be written as a word of length at most l.w0/ in the generators S,
we infer that M2l.w0/ has positive entries in both the block submatrices belonging
to W0 and W1, respectively. Hence the induced Markov chains are both irreducible
and aperiodic. They thus converge towards stationary distributions, which since M
is doubly-stochastic are both equal to the respective uniform distributions. Thus, in
particular, the initial state 
S 2 hWiQ yields
lim
k!1 2kC
S
D 
S 

lim
k!1.M2/k
D
1
jWj 
X
w2W
w:
ut
7.3
Finding Standard Bases
The distinguished element T can now be used to ﬁnd a primitive vector u0
1 2
ker..X/0.T//. Next, having both seed vectors u1 and u0
1 in place, we aim at
computing the associated standard bases B with respect to X, and B0 with respect
to .X/0, for the A-algebra generated by fvTsI s 2 Sg. But since we do not have a
standard basis algorithm available for representations over the ﬁeld K, we again use
suitable specializations:
Given a place 0 ¤ b 2 Z, let Y
bW HQ ! Qnn be the representation of HQ
obtained by specializing v 7! b, that is, considering HQ as the Q-algebra generated
by fbTsI s 2 Sg we have
Y
bW bTs 7!

X.vTs/

.b/ WD X.vTs/jv7!b 2 ZnnI
thus in particular for b D 1, identifying HQ with QŒW, we recover Y
1 D Y.
Now we compare a putative run of the standard basis algorithm, as described in
Sect. 6.1, with respect to the seed vector u1 2 ZŒvn and the generators fX.vTs/ 2
ZŒvnnI s 2 Sg, with a run with respect to the specialized seed vector u1.b/ 2 Zn
and the generators fY
b.bTs/ 2 ZnnI s 2 Sg. These successively produce standard
bases B  ZŒvn and C  Zn, respectively. We show by induction on the cardinality

Invariant Bilinear Forms
347
0 6 m 6 n of the intermediate sets B, that for all but ﬁnitely many b the set C is
obtained by specializing B, and that the Schreier trees found in both runs coincide:
Indeed, the key steps are to decide for some w WD u  X.vTs/ 2 ZŒvn whether
or not w 2 hBiK, and similarly for its specialization w.b/ WD u.b/  Y
b.bTs/ 2 Zn
whether or not w.b/ 2 hCiQ. Identifying B and C with matrices B 2 ZŒvmn
and C 2 Zmn, respectively, we have C D B.b/. Considering the matrix Bw 2
ZŒv.mC1/n obtained by concatenating B and w, we have w 62 hBiK if and only if
there is an ..mC1/.mC1//-submatrix B0 of Bw such that det.B0
w/ ¤ 0. Similarly,
we have w.b/ 62 hCiQ if and only if there is an ..m C 1/  .m C 1//-submatrix C0
of Cw.b/ D Bw.b/ 2 Z.mC1/n such that det.C0/ ¤ 0. Hence, whenever w.b/ 62 hCiQ
we also have w 62 hBiK, and conversely for all but ﬁnitely many b from w 62 hBiK
we may conclude that w.b/ 62 hCiQ. (We have used a similar argument in Sect. 5.1.)
Thus assuming that 0 ¤ b 2 Z is suitably chosen, we may just run the standard
basis algorithm for the seed vector u1.b/ D u1 D ei 2 Zn, the i-th “unit” vector,
and the generators Y
b.bTs/ 2 Znn, as described in Sect. 6.1, yielding a Schreier
tree T. Letting w1 WD 1 2 W, and wi WD wj  s 2 W, if Œj; s is the i-th entry in
T, for 2 6 i 6 n, we thus obtain reduced expressions of the elements wi 2 W,
and hence the number of steps needed to ﬁnd the i-th element of C equals the length
l.wi/ 2 N0. (In practice, it turns out that choosing either b D 1 or b D 2 is sufﬁcient,
where actually almost always b D 1 works.)
Applying the Schreier tree T to u1 and fX.vTs/I s 2 Sg this yields a standard
basis B  ZŒvn of Kn. Similarly, applying T to u0
1 2 ZŒvn and f.X/0.vTs/ 2
ZŒvnnI s 2 Sg we get a standard basis B0  ZŒvn of Kn. But note that this does
not ensure that the A-lattices hBiA and hB0iA are invariant under the A-algebras
generated by fX.vTs/I s 2 Sg and f.X/0.vTs/I s 2 Sg, respectively. (In practice
they are not, typically.)
8
Finding Gram Matrices for W-Graph Representations
We keep the setting of Sect. 7; in particular X still is a W-graph representation.
Having found standard bases B and B0 for X and .X/0, respectively, we proceed
by writing them as matrices B 2 ZŒvnn and B0 2 ZŒvnn, respectively, where
by construction both B and B0 are primitive. In order to complete the ﬁnal task of
computing the product B1  B0 2 ZŒvnn efﬁciently, we need a few preparations.
8.1
Palindromicity
Let W K ! K be the involutory ﬁeld automorphism given by W v 7! v1.
Hence A is -invariant, and by entry-wise application we get involutory module
automorphisms on Kn and An, and algebra automorphisms on Knn and Ann, all of
which will also be denoted by .

348
M. Geck and J. Müller
A polynomial 0 ¤ f 2 ZŒv is called (k-)palindromic, for some k 2 N0, if
vk  f  D f 2 A, and f is called (k-)skew-palindromic if vk  f  D f 2 A. In
these cases, letting ı. f/ 2 N0 be the maximum power of v dividing f in ZŒv,
we have k D ı. f/ C deg. f/. Hence f is palindromic or skew-palindromic if
and only if f 2 ZŒv and f  2 ZŒv1 are associated in A. Moreover, if f is k-
skew-palindromic, then specializing v 7! 1 we get f.1/ D f.1/, implying that
v  1 divides f in ZŒv; similarly, if f is k-palindromic, then specializing v 7! 1
we get .1/k  f.1/ D f.1/, implying that k is even, or v C 1 divides f in
ZŒv.
Proposition 8.1
(a) Let P 2 ZŒvnn be a primitive Gram matrix for X. Then we have vm  P D P,
where m D mP 2 N is even and coincides with the maximum of the degrees of
the non-zero entries of P.
(b) For the primitive seed vector u0
1 2 ZŒvn we have vm  .u0
1/ D u0
1, where
m D mu0
1 2 N0 is even and coincides with the maximum of the degrees of the
non-zero entries of u0
1. (Trivially, the analogous statement holds for u1 2 ZŒvn
with mu1 D 0.)
Proof Letting En 2 Ann be the identity matrix, by Deﬁnition 2.4 for s 2 S we have
X.Ts/ D X.Ts/  .v  v1/  En D X
Ts  .v  v1/

:
In particular, this yields
X.Ts Cv1/ D X.Ts/ Cv  En D X
Ts .v v1/

Cv  En D X.Ts Cv1/:
(a) We consider the matrix P 2 ZŒv1nn: For all s 2 S we have
X.Ts/  P D

XTs  .v  v1/  P

D

P  XTs  .v  v1/tr
D

P  X.Ts/ tr
D

P  X.Ts/tr 
D P  X.Ts/tr:
Now m D mP 2 N as above is minimal such that vmP 2 ZŒvnn, hence
we infer that vmP is a primitive Gram matrix for X as well, and thus we
have vmP D P or vmP D P. Assume the latter case holds, then all non-
zero entries of P are m-skew-palindromic, implying that v  1 divides gcd.P/,
contradicting the primitivity of P. Hence we have vmP D P, that is all non-
zero entries of P are m-palindromic. Assume that m is odd, then we infer that
v C 1 divides gcd.P/, again contradicting the primitivity of P. Hence m is
even.

Invariant Bilinear Forms
349
(b) We consider the vector .u0
1/ 2 ZŒv1n: We have
.u0
1/  .X/0.T/ D

u0
1  .X/0.T/
D

u0
1 
 X
s2J
X.Ts C v1/
tr 
D

u0
1 
 X
s2J
X.Ts C v1/
tr
D

u0
1  .X/0.T/

D 0:
Now m D mu0
1 2 N0 as above is minimal such that vm  .u0
1/ 2 ZŒvn, hence
we infer that vm  .u0
1/ is primitive. Thus from dimK.ker..X/0.T/// D 1 we
conclude that vm  .u0
1/ D u0
1 or vm  .u0
1/ D u0
1. Now we argue as above.
ut
8.2
Properties of the Standard Bases
We have a closer look at the standard bases B and B0, and the associated matrices
B and B0, where we assume B to be chosen according to Sect. 7.3. The facts
collected are largely due to experimental observation, and will be helpful in the
ﬁnal computational steps in Sect. 8.3. Still, these properties seem to be stronger than
expected from general principles, and it should be worth-while to try and prove the
particular observations speciﬁed below. (In particular, we have checked the standard
bases associated with all subsets J  S fulﬁlling the Benson–Curtis condition, see
Sect. 7.1, for the types E6, E7 and E8.)
Recall that for all s 2 S we have
.vTs/1 D v1  Ts  .v  v1/ D v2  vTs  .v2  1/;
hence by the proof of Proposition 8.1 we get
X.vTs/ D v1  X
Ts  .v  v1/

D v2  X
vTs  .v2  1/

D X
.vTs/1
:
The Elements of B For any ui 2 B, where 2 6 i 6 n, we have ui D uj  X.vTs/,
for some 1 6 j < i and s 2 S. This yields
v2  uj D v2  ui  X
.vTs/1
D ui  X
vTs  .v2  1/

:
We conclude that gcd.ui/ 2 ZŒv and gcd.uj/ 2 ZŒv are associated in A. Hence
by recursion, since u1 is primitive, we infer that gcd.ui/ D vdi 2 ZŒv for some
di 2 N0.
Moreover, we have dj 6 di 6 dj C 2. Since d1 D 0 D l.w1/, this implies
di 6 2l.wi/ for all 1 6 i 6 n, where wi 2 W is as in Sect. 7.3. (Experiments show
that all three cases di 2 fdj; dj C 1; dj C 2g actually occur.) But the growth behavior

350
M. Geck and J. Müller
of the di seems to be more restricted than given by these bounds: Considering the
case l.wi/ D 1, we have wi D s for some s 2 S such that the “unit” vector u1
is not an eigenvector of Ts, hence using the shape of X.vTs/ we conclude that
di D 1 D l.wi/.
Now, experimentally, we have made the following
Observation 8.1 We have di 6 l.wi/ C 1, for all 1 6 i 6 n.
(Actually, almost always we have got di 6 l.wi/, for all 1 6 i 6 n, where
often we have even seen equality throughout; the only cases found where actually
di D l.wi/ C 1, for some i, are for type E8, the representation labeled by 3200x, and
two out of the twelve Benson–Curtis subsets of generators.)
The Matrix B Letting 1 6 j < i 6 n and s 2 S be as above, we get
v2  u
i D v2  u
j  X.vTs/ D u
j  X
vTs  .v2  1/

:
Since the standard basis algorithm is a breadth-ﬁrst search, from u
1 D u1 we
conclude that there is lower unitriangular matrix U 2 Knn and a diagonal matrix
D D diagŒv2l.w1/; : : : ; v2l.wn/ 2 ZŒvnn, such that
D  B D U  B:
(Note that if the A-lattice hBiA was invariant under the A-algebra generated by
fX.vTs/I s 2 Sg, then we even had U 2 Ann.)
In particular, letting l WD Pn
iD1 l.wi/ 2 N0, we infer that
det.B/ D v2l  det.B/;
hence det.B/ 2 ZŒv is palindromic. Letting exp.B/ 2 ZŒv denote the exponent
of B in the sense of Sect. 5.3, it follows from Proposition 5.1 that the non-constant
irreducible polynomials dividing det.B/ are precisely those dividing exp.B/. Now,
experimentally, we have made the following
Observation 8.2 Any irreducible divisor of exp.B/ in ZŒv is monic and palin-
dromic.
(Actually, in general the entries of the matrix B are neither palindromic nor skew-
palindromic; moreover, quite often exp.B/ is a product of cyclotomic polynomials,
but this does not always happen.)
In particular, if butr
k 2 ZŒv1n denotes the k-th column of B, for 1 6 k 6 n, then
gcd.buk/ 2 ZŒv divides det.B/, hence gcd.buk/ is palindromic as well. (Actually,
contrary to gcd.uk/ D vdk, in general the gcd.buk/ are not just powers of v.)
The Elements of B0 The recursion used in the standard basis algorithm only
depends on the Schreier tree T, but is independent of the representation considered.
Hence for u0
i 2 B0, where 1 6 i 6 n, and u0
1 is primitive, we get gcd.u0
i/ D vd0
i 2
ZŒv for some d0
i 2 N0. Moreover, if 1 6 j < i 6 n and s 2 S are as above, we get

Invariant Bilinear Forms
351
d0
j 6 d0
i 6 d0
j C 2 and d0
i 6 2l.wi/. Actually, the d0
i seem to be closely related to the
di from above, inasmuch experimentally we have made the following
Observation 8.3 We have d0
i D di, for all 1 6 i 6 n.
The Matrix B0 Again by the fact that the recursion used in the standard basis
algorithm only depends on T, and using vm  .u0
1/ D u0
1, where m D mu0
1 2 N0
is as in Proposition 8.1, we get
vm  D  .B0/ D U  B0;
for the same matrices U and D. In particular, it follows that det.B0/ is palindromic.
(In general neither det.B0/ and det.B/, nor exp.B0/ and exp.B/ are associated in A,
so that hBiA and hB0iA are inequivalent A-sublattices of An, which typically are not
included in each other.) Again, experimentally we have made the following
Observation 8.4 Any irreducible divisor of exp.B0/ in ZŒv is monic and palin-
dromic.
In particular, similarly, if bu0 tr
k
2 ZŒv1n denotes the k-th column of B0, for 1 6
k 6 n, then gcd.bu0
k/ 2 ZŒv is palindromic.
The Product B1  B0 In combination the above yields
vm  .B1  B0/ D vm  .B/1  .B0/ D .D1  U  B/1  .D1  U  B0/ D B1  B0:
Hence the non-zero entries of B1  B0 are palindromic.
Letting 0 ¤ b 2 Z and bB 2 ZŒvnn primitive such that B1 D
1
b	exp.B/ bB, we get
b  exp.B/  B1  B0 D bB  B0 D c  P;
where P 2 ZŒvnn is a primitive Gram matrix, and 0 ¤ c 2 ZŒv. In particular,
since by Observation 8.2 the exponent exp.B/ is palindromic, we conclude that the
non-zero entries of bB  B0 are palindromic as well.
Moreover, letting em D mexp.B/ 2 N0 such that ve
m  exp.B/ D exp.B/, we get
vmCe
m  .b  exp.B/  B1  B0/ D b  exp.B/  B1  B0 2 ZŒvnn:
Hence from vmP  P D P, where mP 2 N0 is as in Proposition 8.1, we get
mP 6 m C em D mu0
1 C mexp.B/;
providing an upper bound on the degrees of the non-zero entries of P.

352
M. Geck and J. Müller
8.3
The Final Product
We are now prepared to do the last computational steps. To do so, we could quite
straightforwardly compute ﬁrst the inverse B1, that is essentially bB, and then the
product bB  B0. But it will substantially add to the efﬁciency if we keep the degrees
of the non-zero entries of the matrices involved as small as possible. Now we have
already observed above that the rows of B and B0 are far from being primitive, and
it turns out in practice that this also holds for their columns. We take advantage of
this as follows:
Keeping the notation of Sect. 8.2, let R WD diagŒvd1; : : : ; vdn 2 ZŒvnn. Then
the rows of R1  B 2 ZŒvnn are primitive. As for its columns, lettingeutr
k 2 ZŒv1n
denote the k-th column of R1  B, for 1 6 k 6 n, let
C WD diagŒgcd.eu1/; : : : ; gcd.eun/ 2 ZŒvnn:
Since by Observation 8.2 the polynomial gcd.buk/ is palindromic, using the particular
form of R, we conclude that the gcd.euk/ are palindromic as well. We let 0 ¤
bc 2 ZŒv and bC 2 ZŒvnn be primitive such that C1 D 1
bc  bC. The latter are of
course straightforwardly computed, where bothbc and the diagonal entries of bC are
palindromic.
Then we geteB 2 ZŒvnn such that B D ReBC, where now all the rows and all the
columns of eB are primitive. We use the algorithm in Sect. 5.2 to compute 0 ¤ bb 2
ZŒv and bB 2 ZŒvnn primitive such that eB1 D 1
bb bB, Since by Observation 8.2 the
exponent exp.B/ is palindromic, using the particular form of R and C, we conclude
thatbb is palindromic as well. Thus altogether we have
B1 D
1
bb bc
 bC  bB  R1:
Similarly, let R0 WD diagŒvd0
1; : : : ; vd0
n 2 ZŒvnn and
C0 WD diagŒgcd.eu 0
1/; : : : ; gcd.eu 0
n/ 2 ZŒvnn;
where eu0 tr
k
2 ZŒv1n denotes the k-th column of .R0/1  B0, for 1 6 k 6 n. As
above, using Observation 8.4 implying the palindromicity of gcd.bu0
k/, we conclude
that the diagonal entries of C0 are palindromic as well, and thus those of .C0/1 are
too. Then we get eB0 2 ZŒvnn such that B0 D R0  eB0  C0, where now all the rows
and all the columns of eB are primitive.
In combination this yields
Q WD bb bc  B1  B0 D bC  bB  R1  R0  eB0  C0:
By the above considerations we conclude that the non-zero entries of Q are
palindromic, which entails that those of bB  R1  R0  eB0 are as well. Now by

Invariant Bilinear Forms
353
Observation 8.3 we have R0 D R, hence this simpliﬁes to
Q D bC  .bB  eB0/  C0 2 ZŒvnn;
where the non-zero entries of bB  eB0 2 ZŒvnn are palindromic.
In Practice To ﬁnd Q, ﬁnally, we apply the matrix multiplication algorithm in
Sect. 5.4 to compute the product bB  eB0. As was already mentioned, in order to
apply it efﬁciently we need good break conditions to discard erroneous guesses
quickly: Apart from requiring that rational number recovery, see Sect. 3.2, returns
only integral coefﬁcients but not rational ones, it turns out that checking for
palindromicity is highly effective in this respect.
Having found a good candidate forbBeB0 2 ZŒvnn, multiplying with the diagonal
matrices bC 2 ZŒvnn and C0 2 ZŒvnn is straightforward. Note that, since the result
is expected to be a symmetric matrix, it is sufﬁcient to compute only the lower
triangular half of the product. Thus we get a candidate for a primitive Gram matrix
P from Q D gcd.Q/  P 2 ZŒvnn. (In many cases Q already is primitive, but this
does not happen always, in which cases gcd.Q/ typically has a smallish degree.)
As independent veriﬁcation we of course just explicitly check whether the
candidate P fulﬁlls the condition
X.vTs/  P D P  X.vTs/tr 2 ZŒvnn
for all
s 2 S:
9
Timings
We conclude by providing running times and workspace requirements for our
computations in types E7 and E8, and by presenting an explicit example for
type E6.
9.1
Timings
In Table 4, we give the running time (on a single processor running at a clock speed
of 3:5 GHz) and GAP workspace requirements needed to compute primitive Gram
matrices for types E7 and E8, and the irreducible W-graph representations of HK
given in [14, 15]. The ﬁgures for E7 should be compared with those given in Sect. 2.5
for the approach used there. Recalling that in [9, Remark 4.10] degree 2500 was the
limit of feasibility, in Table 5 we present the resources now needed for the individual
representations of degree at least 2500, where for comparison we repeat the ﬁrst
three columns of the relevant part of Table 2.

354
M. Geck and J. Müller
Table 4 Time and space
consumption
Degree
No. repr.
Time
Workspace
E7
All
60
4 min
0.2 GB
E8
6 1000
50
30 min
0.7 GB
1000–2000
20
137 min
2.2 GB
2000–2500
10
329 min
4.3 GB
2500–3000
5
350 min
5.9 GB
3000–4000
7
874 min
11.6 GB
4000–5000
13
3175 min
16.3 GB
5000–7000
6
2784 min
23.2 GB
>7000
1
1183 min
31.5 GB
Table 5 Time and space
consumption for degree
> 2500
E8
mP
Abs.val.
Time
Workspace
2688y
24
169;180
39 min
3.9 GB
2800z
20
38;038
61 min
3.7 GB
28000
z
30
882;222
116 min
5.9 GB
2835x
24
1;344;484
52 min
3.1 GB
28350
x
32
5;391;418
82 min
5.3 GB
3150y
26
6;166;994
72 min
5.8 GB
3200x
24
266;284
79 min
4.9 GB
32000
x
30
587;345
104 min
6.1 GB
3240z
16
25;586
60 min
4.0 GB
32400
z
48
33;653;538
326 min
11.6 GB
3360z
20
29;722
74 min
5.1 GB
33600
z
32
775;084
159 min
8.1 GB
4096x
22
531;634
156 min
8.0 GB
40960
x
44
234;956;568
392 min
16.0 GB
4096z
22
531;634
143 min
8.1 GB
40960
z
44
234;956;568
428 min
16.1 GB
4200y
28
58;249;760
171 min
10.1 GB
4200x
24
5;413;484
171 min
9.8 GB
42000
x
36
129;331;224
277 min
13.3 GB
4200z
26
728;053
183 min
10.4 GB
42000
z
28
1;298;612
199 min
10.3 GB
4480y
32
85;556;320;920
239 min
13.9 GB
4536y
28
3;887;856
180 min
11.7 GB
4536z
24
2;728;756
217 min
11.4 GB
45360
z
38
50;779;421
419 min
16.3 GB
5600w
26
372;230
331 min
16.6 GB
5600z
26
3;115;126
335 min
15.4 GB
56000
z
30
3;848;044
473 min
17.5 GB
5670y
30
10;762;741
351 min
21.7 GB
6075x
26
894;864
542 min
19.5 GB
6075x
34
10;488;013
752 min
23.2 GB
7168w
32
1;190;470;476
1183 min
31.5 GB

Invariant Bilinear Forms
355
Table 6 Time and space
consumption for 7168w
7168w
Time
Workspace
Space
Disc
T
9 min
0.6 GB
u0
1
5 min
1.3 GB
bB
925 min
7.6 GB
1.7 GB
0.3 GB
eB0
29 min
17.5 GB
12.6 GB
4.7 GB
bB 	eB0
207 min
31.5 GB
5.8 GB
2.4 GB
P
8 min
7.9 GB
5.8 GB
2.5 GB
Finally, in Table 6 we give some details about the various steps in the computation
for the unique representation of largest degree, which is labeled by 7168w. In the
two last columns we indicate the actual size of the object under consideration in
the GAP workspace, and the disc space needed to store it (as an uncompressed
text ﬁle), respectively; the difference is accounted for by the space consumption
of the data structure we are using within GAP, where matrices with polynomial
entries are kept as lists of lists of (short) lists of (small long) integers. In particular,
in the workspace needed to compute the product, next to the matrices bB and
eB0 and (the lower triangular half of) the product bB  eB0, we also keep various
specializations of the right hand factor eB0, which have a cumulative size of 7:1 GB.
Hence to compute a primitive Gram matrix for the representation labeled by
7168w we need a running time of 1183 min  20h and a workspace of size
31:5 GB.
9.2
An Explicit Example
We conclude by revisiting the (tiny) example already presented in [9, Example 4.9]
(which of course in practice runs in a fraction of a second): Let W be of type E6
with Dynkin diagram
s1
s3
s4
s2
s5
s6
We consider the irreducible W-graph representation of HK, see [22], labeled by
the representation 10s of QŒW, which is the unique one of degree 10, see Table 1.
The W-graph in question is depicted in [9, Example 4.9], hence we do not repeat it
here. But to illustrate the shape, and in particular the sparseness of the representing

356
M. Geck and J. Müller
matrices for the generators vTs1; : : : ; vTs6 we present a few of them:
vT1 7!
2
6666666666666664
v2 :
:
v
:
:
:
:
v
:
: v2
:
v
:
:
:
:
:
v
:
: 1
:
:
:
:
:
:
:
:
:
:
1
:
:
:
:
:
:
:
:
:
:
1 :
:
:
:
:
:
:
v
:
:
v2 :
:
:
:
:
:
:
:
:
: v2 :
v
v
:
:
:
:
v
:
: v2
:
:
:
:
:
:
:
:
:
: 1
:
:
:
:
:
:
:
:
:
:
1
3
7777777777777775
vT6 7!
2
6666666666666664
v2 :
:
:
:
:
:
v
v
:
: v2 :
:
:
:
:
v
:
v
:
: v2 :
:
:
:
:
v
v
:
:
: v2 v
:
:
:
:
:
:
:
:
: 1 :
:
:
:
:
:
:
:
:
:
v2 v
:
:
:
:
:
:
:
:
: 1
:
:
:
:
:
:
:
:
:
:
1
:
:
:
:
:
:
:
:
:
:
1
:
:
:
:
:
:
:
:
:
:
1
3
7777777777777775
As it turns out, there are 22 possible choices of a distinguished subset J  S.
We choose J WD fs1; s2; s3; s5; s6g, in accordance with [10, Table C.4]. Then
associated primitive seed vectors u1 and u0
1 are as given below, in the ﬁrst row of
the matrices B and eB0, respectively. Running the standard basis algorithm on the
specialization of the above W-graph representation with respect to v 7! 1 yields the
following Schreier tree T, which we depict as an oriented graph, whose vertices
1; : : : ; 10 correspond to the vectors in the (ordered) standard bases, and where
an arrow from vertex j to vertex i with label sk says that Œj; sk is the i-th entry
of T:
1
s4
2
s2
5
s5
4
s3
8
s5
3
s3
7
s5
6
s5
9
s4
10
We ﬁnd the standard basis B with associated matrix B as shown below. (It
is not always the case that the entries of B are only monomials.) Hence we
have R D diagŒvd1; : : : ; vd10, where Œd1; : : : ; d10 D Œ0; 1; 2; 2; 2; 3; 3; 3; 4; 5 D
Œl.w1/; : : : ; l.w10/, and C is the identity matrix. Thus we get the matrix eB, and from
thatbb D 1 and the matrix bB as also shown below. Note that the entries of bB are not
necessarily palindromic or skew-palindromic, and that the maximum degree of the

Invariant Bilinear Forms
357
non-zero entries of B, eB and bB equals 8, 3 and 5, respectively:
B D
2
6666666666666664
:
:
:
:
:
:
:
:
:
1
:
:
:
:
v
:
:
:
: v2
:
:
:
: v3 :
:
: v2 :
:
:
:
: v3 :
: v2 :
:
:
:
: v2 v3 :
:
:
:
:
:
:
:
: v5 : v3 v4 v4 v4
:
: v3 v4 v5 :
:
: v4 v4
: v3 : v4 v5 :
: v4 : v4
: v5 v5 v6 v7 v4 v5 v6 v6 v6
v5 v7 v7 v6 : v6 v7 v6 v6 v8
3
7777777777777775
eB D
2
6666666666666664
:
:
:
:
:
:
:
:
:
1
:
:
:
:
1 :
:
:
:
v
:
:
:
:
v :
:
:
1
:
:
:
:
:
v :
:
1
:
:
:
:
:
1 v :
:
:
:
:
:
:
:
: v2 : 1 v v
v
:
:
1 v v2 :
:
:
v
v
: 1
:
v v2 :
:
v
:
v
: v v v2 v3 1 v v2 v2 v2
1 v2 v2 v
: v v2 v v v3
3
7777777777777775
bB D
2
6666666666666664
2v5  3v3 2v4 C 3v2 v3  v v3  v v3  v
:
:
:
v 1
v3  v
v2
:
v
v
:
:
1
:
:
v3  v
v2
v
:
v
:
1
:
:
:
v2
v
:
:
1
:
:
:
:
:
v
1
:
:
:
:
:
:
:
:
v4 C 2v2
v3
v2
v2
v2
v v v
1
:
v3  v
v2
v
v
:
1
:
:
:
:
v2
v
:
1
:
:
:
:
:
:
v2
v
1
:
:
:
:
:
:
:
1
:
:
:
:
:
:
:
:
:
3
7777777777777775
Similarly, we ﬁnd the standard basis B0 with associated matrix B0. As it turns
out we indeed have R0 D R, and C0 is the identity matrix. This yields the matrix
eB0 as shown below. Note that the entries of eB0 are not necessarily palindromic
or skew-palindromic, and that the maximum degree of the non-zero entries of eB0
is 9:
eB0 D
2
6666666666666664
2v3
v5 C 2v3 C v v5 C 2v3 C v v4  v2
v5 C 2v3 C v
2v2
v6  v2
v6  v2
v3 C v
v4  2v2  1
v5 C v
2v5
v5 C v
v6 C v4
v7  2v5  v3
v5 C v
v5 C v
2v5
v6 C v4
v7  2v5  v3
v5 C v
v5 C v
v5 C v
v2  1
v7  2v5  v3
2v4
2v4
2v4
v7  v5
v8 C v4
2v4
2v4
v4  1
v5  v3
v8 C v4
2v4
v4  1
2v4
v5  v3
v8 C v4
v7 C v5  v3 C v
2v3
2v3
v6 C v4 v9 C v7  v5  v3
v6  v4 C v2  1
2v6
2v6
v5  v3
v8  v6 C v4 C v2

358
M. Geck and J. Müller
v4  v2 v5 C 2v3 C v v4  v2 v4  v2 v6  2v4  2v2  1
v5 C v3
v6  v2
v3 C v
v3 C v
v7  v5
v4  v2
v5 C v
v6 C v4
v2  1
v6 C v4
v4  v2
v5 C v
v2  1
v6 C v4
v6 C v4
v4  v2
2v5
v6 C v4
v6 C v4
v6 C v4
v3 C v
v4  1
v5  v3 v5  v3
v5  v3
v3 C v
2v4
v7  v5
v5  v3
v5  v3
v3 C v
2v4
v5  v3
v7  v5
v5  v3
v2  1
2v3
v6 C v4 v6 C v4
v4 C v2
v7 C v5
2v6
v5  v3
v5  v3
v9 C v7
3
7777777777777775
From this we get Q D bB  eB0. As it turns out we already have gcd.Q/ D 1, thus
we may let P D Q be as shown below. Indeed, independent veriﬁcation shows
that P is a primitive Gram matrix as desired, coinciding with the one already given
in [9, Example 4.9]. Note that indeed P is a completely dense matrix, all of whose
entries are 6-palindromic, where the maximum degree occurring is 6, and that in
accordance with Table 1 the largest coefﬁcient occurring has absolute value 3, and
that the specialization v 7! 0 yields the identity matrix:
2
666666666666666666666664
v6 C 3v4 C 3v2 C 1
2v4 C 2v2
2v4 C 2v2
v5  2v3  v
2v4 C 2v2
2v4 C 2v2
v6 C 3v4 C 3v2 C 1
2v4 C 2v2
v5  2v3  v
2v4 C 2v2
2v4 C 2v2
2v4 C 2v2
v6 C 3v4 C 3v2 C 1
v5  2v3  v
2v4 C 2v2
v5  2v3  v
v5  2v3  v
v5  2v3  v
v6 C 2v4 C 2v2 C 1
v5  2v3  v
2v4 C 2v2
2v4 C 2v2
2v4 C 2v2
v5  2v3  v
v6 C 3v4 C 3v2 C 1
v5  2v3  v
v5  2v3  v
v5  2v3  v
v4 C v2
2v3
2v4 C 2v2
2v4 C 2v2
2v4 C 2v2
2v3
2v4 C 2v2
v5  2v3  v
v5  2v3  v
2v3
v4 C v2
v5  2v3  v
v5  2v3  v
2v3
v5  2v3  v
v4 C v2
v5  2v3  v
2v3
v5  2v3  v
v5  2v3  v
v4 C v2
v5  2v3  v
v5  2v3  v
2v4 C 2v2
v5  2v3  v
v5  2v3  v
2v3
v5  2v3  v
2v4 C 2v2
v5  2v3  v
2v3
v5  2v3  v
v5  2v3  v
2v4 C 2v2
2v3
v5  2v3  v
v5  2v3  v
v4 C v2
2v3
v4 C v2
v4 C v2
v4 C v2
2v3
2v4 C 2v2
v5  2v3  v
v5  2v3  v
v5  2v3  v
v6 C 2v4 C 2v2 C 1
v5  2v3  v
v4 C v2
v4 C v2
v4 C v2
v5  2v3  v
v6 C 3v4 C 3v2 C 1
v5  2v3  v
v5  2v3  v
v5  2v3  v
v4 C v2
v5  2v3  v
v6 C 2v4 C 2v2 C 1
v4 C v2
v4 C v2
v4 C v2
v5  2v3  v
v4 C v2
v6 C 2v4 C 2v2 C 1
v4 C v2
v4 C v2
v5  2v3  v
v4 C v2
v4 C v2
v6 C 2v4 C 2v2 C 1
3
777777777777777777777775

Invariant Bilinear Forms
359
References
1. H. Cohen, A course in computational algebraic number theory, in Graduate Texts in Mathe-
matics, vol. 138 (Springer, New York, 1993)
2. J. Davenport, M. Guy, P. Wang, P-adic reconstruction of rational numbers. SIGSAM Bull.
16(2), 2–33 (1982)
3. J. Dixon, Exact solution of linear equations using p-adic expansions. Numer. Math. 40, 137–
141 (1982)
4. The GAP Group: GAP — Groups, Algorithms, Programming — A System for Computational
Discrete Algebra. Version 4.8.5 (2016). http://www.gap-system.org
5. S. Garibaldi, E8, the most exceptional group. Bull. Am. Math. Soc. 53, 643–671 (2016)
6. M. Geck, Leading coefﬁcients and cellular bases of Hecke algebras. Proc. Edinb. Math. Soc.
52, 653–677 (2009)
7. M. Geck, A. Halls, On the Kazhdan–Lusztig cells in type E8. Math. Comp. 84, 3029–3049
(2015)
8. M. Geck, N. Jacon, Representations of Hecke algebras at roots of unity, in Algebra and
Applications, vol. 15 (Springer, New York, 2011)
9. M. Geck, J. Müller, James’ conjecture for Hecke algebras of exceptional type I. J. Algebra 321,
3274–3298 (2009)
10. M. Geck, G. Pfeiffer, Characters of Finite Coxeter Groups and Iwahori–Hecke Algebras.
London Mathematical Society Monographs, New Series, vol. 21 (Oxford University Press,
Oxford, 2000)
11. M. Geck, G. Hiß, F. Lübeck, G. Malle, G. Pfeiffer, CHEVIE-a system for computing and
processing generic character tables for ﬁnite groups of Lie type, Weyl groups and Hecke
algebras. Appl. Algebra Eng. Commun. Comput. 7, 175–210 (1996)
12. The GMP Development Team: GMP — The GNU Multiple Precision Arithmetic Library.
Version 6.1.1 (2016). http://www.gmp-lib.org
13. G. Hardy, E. Wright, An Introduction to the Theory of Numbers, 6th edn. (Oxford University
Press, Oxford, 2008)
14. R.B. Howlett, W-graphs for the irreducible representations of the Hecke algebra of type E8.
Private communication with J. Michel (December 2003)
15. R.B. Howlett, Y. Yin, Computational construction of irreducible W-graphs for types E6 and E7.
J. Algebra 321, 2055–2067 (2009)
16. D.A. Kazhdan, G. Lusztig, Representations of Coxeter groups and Hecke algebras. Invent.
Math. 53, 165–184 (1979)
17. G. Lusztig, Hecke Algebras with Unequal Parameters. CRM Monographs Series, vol. 18
(American Mathematical Society, American Mathematical Society, 2003). Enlarged and
updated version at arXiv:0208154v2
18. G. Lusztig, Algebraic and geometric methods in representation theory (September 2014).
arxiv:1409.8003
19. P. Maier, D. Livesey, H.-W. Loidl, P. Trinder, High-performance computer algebra: a Hecke
algebra case study, ed. by F. Silva, I. Dutra, V. Santos Costa, in Euro-Par 2014 Parallel
Processing: 20th International Conference, Porto (August 2014). Lecture Notes in Computer
Science, vol. 8632, pp. 415–426 (2014)
20. J. Michel, The development version of the CHEVIE package of GAP3. J. Algebra 435, 308–
336 (2015); see also http://www.math.rwth-aachen.de/~CHEVIE/
21. M. Monagan, Maximal quotient rational reconstruction: an almost optimal algorithm for
rational reconstruction, in Proceedings of ISSAC ’04 (ACM Press, New York, 2004), pp. 243–
249
22. H. Naruse, W-graphs for the irreducible representations of the Iwahori–Hecke algebras of type
F4 and E6. Private communication with M. Geck (January and July, 1998)

360
M. Geck and J. Müller
23. R.A. Parker, The computer calculation of modular characters (the Meat-Axe), in Computa-
tional Group Theory, Durham (1982), ed. by M.D. Atkinson (Academic Press, Cambridge,
1984), pp. 267–274.
24. R.A. Parker, An integral meataxe, in The Atlas of Finite Groups: Ten Years On, Birmingham
(1995). London Mathematical Society. Lecture Note Series, vol. 249. (Cambridge University
Press, Cambridge, 1998), pp. 215–228
25. D.A. Vogan, The character table of E8. Not. Am. Math. Soc. 9, 1022–1034 (2007); see also
http://atlas.math.umd.edu/AIM_E8/technicaldetails.html
26. J. von zur Gathen, J. Gerhard, Modern Computer Algebra, 3rd edn. (Cambridge University
Press, Cambridge, 2013)

Tropical Computations in polymake
Simon Hampe and Michael Joswig
Abstract We give an overview of recently implemented polymake features
for computations in tropical geometry. The main focus is on explicit examples
rather than technical explanations. Our computations employ tropical hypersurfaces,
moduli of tropical plane curves, tropical linear spaces and Grassmannians, lines on
tropical cubic surfaces as well as intersection rings of matroids.
Keywords Mathematical software • Tropical hypersurfaces • Tropical linear
spaces
Subject Classiﬁcations 14-04 (14T05, 14Q99, 52-04)
1
Introduction
Many avenues lead to tropical geometry as we know it today. One motivation
comes from studying algebraic varieties (over some ﬁeld with a non-Archimedean
valuation) via their piecewise-linear images (under the valuation map). This is
useful since many interesting properties are preserved, and they often become
algorithmically accessible via tools from polyhedral geometry [39].
Many of these methods are actually implemented, and we start out with giving
a brief overview. The standard software to compute tropical varieties with constant
coefﬁcients is Jensen’s Gfan [30]. Its main function is to traverse the dual graph
of the Gröbner fan of an ideal and to construct the associated tropical variety as a
subfan. The Singular [12] library tropical.lib [32] by Jensen, Markwig,
Markwig and Ren interfaces to Gfan and implements extra functionality on top.
The most recent version also covers Ren’s implementation of tropical varieties
S. Hampe • M. Joswig ()
Institut für Mathematik, Technische Universität Berlin, Sekretariat MA 6-2, Straß des 17. Juni
136, 10623 Berlin, Germany
e-mail: hampe@math.tu-berlin.de; joswig@math.tu-berlin.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_14
361

362
S. Hampe and M. Joswig
with arbitrary coefﬁcients [43]. Rincón’s program TropLi computes tropical linear
spaces from matrix input [45], whereas the Tropical Polyhedra Library
by Allamigeon allows to manipulate tropical polyhedra [1]. The polymake
system is a comprehensive system for polyhedral geometry and adjacent areas of
discrete mathematics. Basic support for computations with tropical hypersurfaces
and tropical polytopes goes back as far as version 2.0 from 2004. A much more
substantial contribution to polymake was the extension a-tint for tropical
intersection theory [26].
In this paper we report on the recent rewrite of all functionality related to tropical
geometry in polymake. This largely builds on a-tint, which is now a bundled
extension and which itself has undergone a massive refactoring. Here we refer to
the current version 3.0 of polymake from 2016.
Our paper is organized as follows. We start out with the basics of tropical
arithmetic and tropical matrix operations. This topic connects tropical geometry
to combinatorial optimization [46]. The most basic geometric objects in our
investigation are tropical hypersurfaces. These are the vanishing loci of tropical
polynomials. Since the latter are equivalent to ﬁnite point sets in Zd, equipped with
real-valued lifting functions, their study is closely related to regular subdivisions
[11]. An interesting new vein in tropical geometry are applications to economics.
As an example, we look at arrangements of tropical hypersurfaces as they occur
in the product-mix auctions of Baldwin and Klemperer [4, 36, 37]. For a regular
subdivision ˙ of a point conﬁguration P, the secondary cone comprises all lifting
functions, which induce ˙. That cone forms a stratum in the moduli space of
tropical hypersurfaces with support set P. We exhibit an example computation
concerning moduli of tropical plane curves of genus three [8].
Going from hypersurfaces to more general tropical varieties is a major step.
Historically, the ﬁrst explicit computations dealt with the tropicalization of the
Grassmannians [49]. The classical Grassmannians are the moduli spaces of linear
subspaces in a complex vector space. Their tropical analogues parametrize those
tropical linear spaces which arise as tropicalizations. We explore the combinatorics
of one tropical linear space. Employing the polymake interface to Singular,
we verify that it is realizable. Tropical linear spaces are interesting in their own
right for their connection with matroid theory [35, 48]. We brieﬂy compare several
polyhedral structures on the Bergman fan of a matroid.
A famous classical result of Cayley and Salmon states that every smooth cubic
surface in P3 over an algebraically closed ﬁeld contains exactly 27 lines. Vigeland
studied the question, whether a similar result holds in the tropical setting [53].
A counterexample was given by Maclagan and Sturmfels in [39, Theorem 4.5.8].
Based on a polymake computation with a-tint’s specialized algorithms for
tropical intersection theory, we exhibit a generic tropical cubic surface, V, which
does not match any of the types listed by Vigeland. The surface V contains 26 iso-
lated lines and three inﬁnite families. Cohomological methods are an indispensable
tool in modern algebraic geometry. Tropical intersection theory is a ﬁrst step towards
a similar approach to tropical varieties [2, 40]. Interestingly, tropical intersection
theory is also useful in combinatorics, if applied to tropical linear spaces associated

Tropical Computations in polymake
363
with matroids. Our ﬁnal example computation shows how the Tutte polynomial of
a matroid can be computed from the nested components [27].
In addition to the features presented here, polymake also provides functions for
computing with Puiseux fractions [34], tropical polytopes [13, 33], general tropical
cycles, tropical morphisms and rational functions [26].
2
Arithmetic and Linear Algebra
The tropical semiring T is the set R [ f1g equipped with ˚ WD min as the tropical
addition and ˇ WD C as the tropical multiplication. Clearly one could also use
max instead of min, but here we will stick to ˚ D min. In polymake there is a
corresponding data type, which allows to compute in Q [ f1g, e.g., the following.
polytope > application "tropical";
tropical > $a = new TropicalNumber<Min>(3);
tropical > $b = new TropicalNumber<Min>(5);
tropical > $c = new TropicalNumber<Min>(8);
tropical > print $a*$c, ", ", $b*$c;
11, 13
tropical > print (($a + $b) * $c);
11
tropical > print $a * (new TropicalNumber<Min>("inf"));
inf
Listing 1 Adding and multiplying tropically
Note that polymake is organized into several applications, which serve to separate
the various functionalities. Most of our computations take place in the application
tropical, but we will occasionally make use of other types of objects, such
as matroids, fans and ideals. One can either switch to an application as shown
in Listing 1 or preﬁx the corresponding types and commands with the name
of the application and two colons, such as matroid::. We will see examples
below. The software system polymake is a hybrid design, written in C++ and
Perl. In the polymake shell the user’s commands are interpreted in an enriched
dialect of Perl. Note that here the usual operators “+” and “*” are overloaded, i.e.,
they are interpreted as tropical matrix addition and tropical matrix multiplication,
respectively. It is always necessary to explicitly specify the tropical addition via
the template parameter Min or Max. Mixing expressions with Min and Max is not
deﬁned and results in an error. Templates are not part of standard Perl but rather part
of polymake’s Perl enrichment.
The type TropicalNumber may be used for coefﬁcients of vectors, matrices
and polynomials. Matrix addition and multiplication are deﬁned—and interpreted
tropically. Here is a basic application of tropical matrix computations: Let A D
.aij/ 2 Rdd be a square matrix encoding edge lengths on the complete directed
graph Kd. If there are no directed cycles of negative length then there is a well
deﬁned shortest path between any two nodes, which may be of inﬁnite length. These

364
S. Hampe and M. Joswig
shortest path lengths are given by the so-called Kleene star
A WD I ˚ A ˚ .A ˇ A/ ˚ .A ˇ A ˇ A/ ˚ : : : ;
(1)
where I is the tropical identity matrix, which has zeros on the diagonal and inﬁnity as
a coefﬁcient otherwise. The assumption that there are no directed cycles of negative
length makes the above tropical sum of tropical matrix powers stabilize after ﬁnitely
many steps. The direct evaluation of (1) is precisely the Floyd–Warshall-Algorithm,
for computing all shortest paths, known from combinatorial optimization [46, §8.4].
In Listing 2 below we compute the Kleene star of a 33-matrix, called A. Here we
verify that I ˚ A D I ˚ A ˚ .A ˇ A/, which implies A D I ˚ A, i.e., all shortest
paths are direct.
tropical > $A = new Matrix<TropicalNumber<Min>>(
[[1,2,3],[1,2,4],[1,0,1]]);
tropical > $I = new Matrix<TropicalNumber<Min>>(
[[0,"inf","inf"],["inf",0,"inf"],["inf","inf",0]]);
tropical > print $I + $A;
0 2 3
1 0 4
1 0 0
tropical > print $I + $A + $A*$A;
0 2 3
1 0 4
1 0 0
Listing 2 Adding and multiplying matrices tropically to obtain the Kleene star A
The tropical determinant of A is deﬁned as
tdet A WD
M
2Sym.d/
a1;.1/ ˇ    ˇ ad;.d/
D min
˚
a1;.1/ C    C ad;.d/
ˇˇ  2 Sym.d/
	
;
where Sym.d/ denotes the symmetric group of degree d. This arises from tropi-
calizing Leibniz’ formula for the classical determinant. Notice that evaluating the
tropical determinant is tantamount to solving a linear assignment problem from
combinatorial optimization. Via the Hungarian method this can be performed in
O.d3/ time; see [46, §17.3]. This is implemented in polymake and can be used as
shown in Listing 3.
tropical > print tdet($A);
4
tropical > print tdet_and_perm($A);
4 <0 1 2>
tropical > print $A->elem(0,0) * $A->elem(1,1) * $A->elem(2,2);
4
Listing 3 Computing a tropical determinant

Tropical Computations in polymake
365
The user can choose to only compute the value of tdet A or also one optimal
permutation. In the example from Listing 3 that would be the identity permutation.
3
Hypersurfaces
A polyhedral complex is weighted, if it is equipped with a function !, assigning
integers to its maximal cells. A tropical cycle is a weighted pure rational poly-
hedral complex C, such that each cell C of codimension one satisﬁes a certain
balancing condition. The interested reader is referred to [39, 41]. Note that the
latter only considers varieties, which are cycles with strictly positive weights.
Tropical hypersurfaces and linear spaces are special cases of tropical varieties and
our examples involve only these. We mention tropical cycles since the polymake
implementation is based on this concept. Moreover, the tropical intersection theory,
which we consider in Sect. 6, makes more sense in this general setting.
3.1
Tropical Hypersurfaces and Dual Subdivisions
Let
F WD
M
a2A
ca ˇ xˇa 2 TŒx˙
0 ; : : : ; x˙
n  ;
be a tropical (Laurent) polynomial with support A 	 ZnC1, i.e., the coefﬁcients ca
are real numbers and A is ﬁnite. The tropical hypersurface of F is the set
T.F/ WD
˚
p 2 RnC1 j the minimum in F. p/ is attained at least twice
	
:
Often we will assume that, for some ı 2 N, we have a0 C a1 C    C an D ı
for all a 2 A. This means that the tropical polynomial F is homogeneous (of degree
ı). In this case for each point p 2 T.F/ we have p C R1  T.F/. Thus we usually
consider the tropical hypersurface of a homogeneous polynomial as a subset of the
quotient RnC1=R1, which is called the tropical projective n-torus. Note that one
could also consider hypersurfaces in tropical projective space .Tnnf.1/ng/=R1.
However, from a computational point of view this incurs several challenges. In
polymake’s implementation all tropical cycles live in the tropical projective torus
and we will thus also adopt this viewpoint mathematically.
The dual subdivision .F/ induced by F is the collection of sets
p WD
˚
arg mina2Afca ˇ pˇag
	
 A ;

366
S. Hampe and M. Joswig
where p ranges over all points in RnC1=R1. Instead of .F/ we also write T.F/.
Notice that, by deﬁnition .F/ is a set of subsets of A whose union is A. More
precisely, .F/ is the combinatorial description of the regular subdivision of the
support of F induced by the coefﬁcients. We say that T.F/ is smooth if the dual
subdivision .F/ is unimodular, i.e., every maximal p is the vertex set of a
unimodular simplex.
The tropical hypersurface of F is the codimension one skeleton of the following
subdivision of RnC1=R1: We deﬁne two elements p; p0 2 RnC1=R1 to be equivalent,
if p D p0. The equivalence classes are open polyhedral cones and their closures
form a complete polyhedral complex, the normal complex D.F/.
As an example we consider the cubic polynomial
F WD12xˇ3
0
˚ .131/xˇ2
0 x1 ˚ .67/xˇ2
0 x2 ˚ .9/xˇ2
0 x3 ˚ .131/x0xˇ2
1
˚ .129/x0x1x2 ˚ .131/x0x1x3 ˚ .116/x0xˇ2
2
˚ .76/x0x2x3
˚ .24/x0xˇ2
3
˚ .95/xˇ3
1
˚ .108/xˇ2
1 x2 ˚ .92/xˇ2
1 x3
˚ .115/x1xˇ2
2
˚ .117/x1x2x3 ˚ .83/x1xˇ2
3
˚ .119/xˇ3
2
˚ .119/xˇ2
2 x3 ˚ .82/x2xˇ2
3
˚ .36/xˇ3
3
(2)
in four variables, i.e., the tropical hypersurface V WD T.F/ is a cubic surface in
R4=R1. This is constructed in Listing 4 along with the dual subdivision V D .F/.
tropical > $F = toTropicalPolynomial("min(12+3*x0,-131+2*x0+x1,
-67+2*x0+x2,-9+2*x0+x3,-131+x0+2*x1,-129+x0+x1+x2,
-131+x0+x1+x3,-116+x0+2*x2,-76+x0+x2+x3,-24+x0+2*x3,-95+3*x1,
-108+2*x1+x2,-92+2*x1+x3,-115+x1+2*x2,-117+x1+x2+x3,
-83+x1+2*x3,-119+3*x2,-119+2*x2+x3,-82+x2+2*x3,-36+3*x3)");
tropical > $V = new Hypersurface<Min>(POLYNOMIAL=>$F);
tropical > print $V->DEGREE;
3
tropical > print $V->dual_subdivision()->N_MAXIMAL_CELLS;
27
Listing 4 Computing a tropical cubic surface
The computation shows that V is smooth. Indeed, the support of F are the lattice
points of the scaled 3-dimensional simplex 33, whose normalized volume equals
27. Since there are exactly 27 maximal cells, every single one must have volume 1
(and thus has to be a simplex as well). We will come back to this example later to
see that V has some interesting enumerative properties.
While the entire design of the polymake system follows the paradigm of object
orientation there is a fundamental difference between an object of type Matrix, as
in Listing 2, and an object of type Hypersurface, as in Listing 4. Matrices form
an example of a small object class, while tropical hypersurfaces are big objects.
To understand the difference it is important to know that, by design, polymake
employs both Perl and C++ as main programming languages. Essentially, the C++

Tropical Computations in polymake
367
code deals with the computations for which speed matters. The small objects belong
to container classes which entirely live in the C++ world. On the Perl side this
occurs as a mere reference, which is opaque. Calling a member function on a small
object from within the polymake shell is always deferred to a corresponding C++
function. If new template instantiations occur for the ﬁrst time this triggers just-in-
time compilation. The user experiences this as an occasional short time lag. The
newly compiled instantiation is kept in the polymake folder in the user’s home
directory, such that it does not need to be compiled again.
Big objects are very different. Technically, they entirely live in the Perl world.
More importantly, the user should think of them as technical realizations of actual
mathematical objects, such as a tropical hypersurface. For each big object class
there is a certain number of properties of which some subset is known at any
given point in time. In Listing 4 the variable $V is initialized as an object of type
Hypersurface<Min> with the single property POLYNOMIAL, which is clearly
enough to deﬁne a unique hypersurface. The subsequent command prints a new
property, the DEGREE, which is automatically derived from the input. The essential
idea is that this (and other properties computed on the way) will be kept and stored
with the big object. In this way it is avoided to repeat costly computations. More
details on polymake’s big object concept are found in [21].
3.2
Product-Mix Auctions
A fascinating connection between tropical geometry and economics was discovered
by Baldwin and Klemperer [4]. They showed that the mechanics of many product-
mix auctions [36, 37] can be modeled using tropical hypersurfaces. Further analysis
was given by Tran and Yu [52], whose notation we mostly adopt.
In a product-mix auction, several bidders (“agents”) compete for combinations of
several goods. For example, one of the original motivations for this approach was,
when the Bank of England wanted to auction off loans of funds during the ﬁnancial
crisis in 2007. These loans could be secured—in various combinations—against
either weak or strong collateral. These two types of loans would be the goods in this
case.
For our example, we will assume that there are two types of goods, sold in
discrete quantities, and only two agents. Every agent now provides a valuation
uj W Aj ! R; j D 1; 2, where Aj  N2 is the set of bundles of goods the agent is
interested in. Negative quantities could also be allowed, thus expressing an interest
in selling the corresponding quantity. The valuation measures how valuable a bundle
is to the agent. Now, if the auctioneer ﬁxes a price p D . p1; p2/, the agent will
naturally be interested in the bundles which maximize her proﬁt. These bundles
form the demand set
Du j. p/ WD arg maxa2Ajfu j.a/  p  ag ;

368
S. Hampe and M. Joswig
which depends not only on the price, but also on the choice of the valuation. The
aggregate demand for the combined valuations U D .u1; u2/ is
DU. p/ WD
˚
a1 C a2 j a j 2 Du j. p/
	
 A1 C A2 :
Given an actual supply of a 2 N2, the auctioneer will be interested in whether there
exists a price such that all of the supply can be split between the agents such that
every agent obtains a bundle which maximizes their proﬁt, i.e., if there is a p such
that a 2 DU. p/. In this case, we say that competitive equilibrium exists at a.
In tropical language, every agent deﬁnes a hypersurface, corresponding to (the
homogenization of) the tropical polynomial
Fj WD
M
a2Aj
.u j.a// ˇ xˇa :
In this formulation, we see that Fj. p/ is the maximal proﬁt of agent j at price p.
The tropical hypersurface T.Fj/ is the set of prices where the agent is indifferent
between at least two bundles.
Let f WD f1 ˇ f2 be the product of the two polynomials and A WD A1 C A2 its
support. Now, competitive equilibrium exists at a point a 2 A, if and only if for
some price vector p the point a is contained in the cell p of the dual subdivision
.F/.
To illustrate, we compute Example 2 from [52]. In Listing 5 we deﬁne one
hypersurface for each agent and a third one, H, which is the union.
tropical > $H1 = new Hypersurface<Min>(
MONOMIALS=>[[3,0,0],[2,0,1],[1,0,2],[0,1,2]],
COEFFICIENTS=>[0,-3,-5,-9]);
tropical > $H2 = new Hypersurface<Min>(
MONOMIALS=>[[1,0,0],[0,1,0],[0,0,1]],
COEFFICIENTS=>[0,-1,-1]);
tropical > $H = new Hypersurface<Min>(POLYNOMIAL=>
$H1->POLYNOMIAL * $H2->POLYNOMIAL);
Listing 5 Constructing a tropical hypersurface from a product of polynomials
We need to homogenize the polynomial, so every bundle of goods has an additional
coordinate in front. Our goal is to determine the competitive equilibria. Note that,
since H is a union of two tropical hypersurfaces, the dual subdivision H is the
common reﬁnement of the dual subdivisions of the factors.
tropical > $ds = $H->dual_subdivision();
tropical > $dehomog = $ds->POINTS->minor(All,~[0,1]);
tropical > $cells = transpose($ds->MAXIMAL_CELLS);
Listing 6 The dual subdivision
The monomials of the tropical polynomial deﬁning H arise as the vertices of the
cells of H. To reinterpret them as bundles we dehomogenize, i.e., we strip the ﬁrst
two coordinates; the ﬁrst one equals one (since ordinary points are homogenized),

Tropical Computations in polymake
369
while the second one equals zero (due to the tropical homogenization). For each
bundle or monomial we can now print the number of cells containing it.
tropical > for (my $i=0; $i<$ds->N_POINTS; ++$i) {
print $dehomog->row($i), ": ", $cells->row($i)->size(), "\n" }
0 0: 2
1 0: 1
1 3: 2
0 1: 2
1 1: 0
0 2: 2
1 2: 5
2 2: 2
0 3: 1
Listing 7 Checking all bundles
Indeed, we see that every bundle, except for .1; 1/, is in at least one cell of the dual
subdivision. That is, competitive equilibrium exists precisely at the nine remaining
bundles.
4
Moduli of Tropical Plane Curves
So far we investigated individual examples of tropical hypersurfaces. Now we will
look into families which are obtained by varying the coefﬁcients. To this end we start
out with a point conﬁguration and a given subdivision ˙. The goal is to determine
all possible tropical polynomials F with .F/ D ˙. Our example computation will
deal with a planar point conﬁguration, and hence the tropical hypersurfaces T.F/
will be tropical plane curves. These objects stood at the cradle of tropical geometry;
see, in particular, Mikhalkin [40]. Yet the study of their moduli spaces is more recent
[8], and this is the direction where we are heading here; see also [5].
The Listing 8 shows polymake code to visualize a triangulation of 15 points
in the afﬁne hyperplane P xi D 4 in R3; see Fig. 1. For technical reasons the set of
points is converted into a matrix with leading ones. We start out by switching the
application.
tropical > application "fan";
fan > $points = [ [0,0,4],[1,0,3],[0,1,3],[2,0,2],[1,1,2],
[0,2,2], [3,0,1],[2,1,1],[1,2,1], [0,3,1],[4,0,0],[3,1,0],
[2,2,0],[1,3,0],[0,4,0] ];
fan > $triangulation = [[0,1,2],[9,11,12],[9,12,13],
[9,13,14],[1,2,5],[6,10,11],[3,6,11],[1,5,9],[1,3,11],
[8,9,11],[1,4,9],[1,7,11],[7,8,11],[4,8,9],[1,4,7],[4,7,8]];
fan > $pointMatrix =
(ones_vector<Rational>(15)) | (new Matrix<Rational>($points));
fan > $Sigma = new SubdivisionOfPoints(
POINTS=>$pointMatrix, MAXIMAL_CELLS=>$triangulation);
fan > $Sigma->VISUAL;
Listing 8 Constructing and visualizing a triangulation

370
S. Hampe and M. Joswig
Fig. 1 Unimodular
triangulation of 42
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
Let P be a ﬁnite set of points in Rd, and let ˙ be a (polytopal) subdivision of
P, i.e., ˙ is a polytopal complex whose vertices form a subset of P and which
covers the convex hull of P. The secondary cone seccone ˙ is the topological
closure of the set of lifting functions on the set P which induce ˙. Scaling any
lifting function in seccone˙ by a positive number does not lead outside, and neither
does adding two such lifting functions. We infer that seccone˙, indeed, is a cone.
Each cell of codimension one in ˙ yields one linear inequality, and these give an
exterior description of the secondary cone. This means that the secondary cone is
polyhedral. It is of interest to determine the rays of seccone ˙. For our example this
is accomplished in Listing 9.
fan > $sc=$Sigma->secondary_cone();
fan > print $sc->N_RAYS;
12
fan > for (my $i=0; $i<$sc->N_RAYS; ++$i) {
my $c=new SubdivisionOfPoints(
POINTS=>$pointMatrix,WEIGHTS=>$sc->RAYS->[$i]);
print $i, ":", $c->N_MAXIMAL_CELLS, " ";
}
0:2 1:2 2:2 3:2 4:2 5:2 6:2 7:2 8:2 9:3 10:3 11:3
Listing 9 Analyzing the secondary cone
The rays of seccone ˙ induce those coarsest subdivisions of the point set P from
which ˙ arises as their common reﬁnement. In our example the secondary cone
has 12 rays, which come in no particular order. In Listing 9 we list the index of
each ray (from 0 to 11) with the number of maximal cells in the corresponding
coarsest subdivision. Throughout these numbers are either two or three, from which
one can tell right away that the former are 2-splits, while the latter are 3-splits;
see Herrmann [28]. The 12 rays come in four orbits, with respect to the symmetry
group of P which ﬁxes ˙. The order of that group is three. There are three orbits
of 2-splits, represented by 0, 2 and 8, and one orbit of 3-splits, represented by 11.
These are shown in Fig. 2.

Tropical Computations in polymake
371
Fig. 2 The coarsest subdivisions of the rays labeled 0, 2, 8 and 11
One speciﬁc lifting function on the 15 points which yields our example triangu-
lation, ˙, is shown in Listing 10. We use it as the coefﬁcient vector of a tropical
polynomial, and this deﬁnes a tropical hypersurface, which we call C, To verify that
this vector, indeed, lies in the relative interior of the secondary cone of ˙ we can
compute the scalar products with all facet normal vectors.
fan > application "tropical";
tropical > $C = new Hypersurface<Min>(MONOMIALS=>$points,
COEFFICIENTS=>[6, 0,3, 1,-1/3,1, 3,-1/3,-1/3,0, 6,0,1,3,6]);
tropical > $ratCoeff = new Vector<Rational>($C->COEFFICIENTS);
tropical > print $sc->FACETS * $ratCoeff;
4 4 8/3 4 4 4 4 8/3 8/3 4/3 4/3 4/3
tropical > print $sc->LINEAR_SPAN * $ratCoeff;
Listing 10 A tropical plane curve
The fact that all these numbers are positive serves as a certiﬁcate for strict con-
tainment; the actual values do not matter. For a general subdivision, which is not a
triangulation, there are additional linear equations to be checked which describe the
linear span. There are no such equations in this case, which is why the last command
has no output. Note that prior to computing the scalar products it is necessary to
explicitly convert the lifting function into a vector with rational coefﬁcients. This
is unavoidable since we want to use the ordinary scalar multiplication here, not the
tropical one.
The curve C deﬁned in Listing 10 and shown in Fig. 3 is a tropical plane quartic
of genus three: the Newton polytope is the dilated standard simplex 42, and this
has exactly three interior lattice points, all of which are used in the triangulation ˙.
tropical > print $C->DEGREE;
4
tropical > print $C->GENUS;
3
Listing 11 Degree and genus of a tropical plane curve
In the sequel we want to locate C in the moduli space of tropical plane curves
of genus three. This will go hand in hand with our initial goal to determine all
such curves which ﬁt the initial triangulation ˙ of 42. To this end we determine
the (lattice) length of each edge of C, considered as a one-dimensional ordinary
polytopal complex. The integer lattice Z3 induces sublattices on the line spanned

372
S. Hampe and M. Joswig
Fig. 3 Tropical plane quartic
of genus three
by any edge of ˙. Since each edge of C is dual to an edge of ˙ we can measure
its length with respect to that sublattice. The result is shown in Listing 12. The 30
edges are labeled from 0 through 29; again they do not come in any particular order.
tropical > print labeled($C->CURVE_EDGE_LENGTHS);
0:inf 1:inf 2:1 3:inf 4:1 5:1 6:inf 7:inf 8:1/3 9:1/3 10:1/3
11:1/3 12:2/3 13:1/3 14:inf 15:1 16:inf 17:2/3 18:1 19:1 20:1
21:1/3 22:2/3 23:inf 24:1 25:inf 26:1 27:inf 28:inf 29:inf
tropical > $C->VISUAL(LengthLabels=>"show");
Listing 12 Moduli of a tropical plane curve
As a generic curve of degree four, the curve C has four edges of inﬁnite length in
each of the three coordinate directions. Contracting these inﬁnite edges including the
edges of ﬁnite length which “lead” to them yields the “essential part” of C. A picture
of this with the remaining edge lengths is given in Fig. 4 (left), the remaining vertices
are labeled with the corresponding triangles of ˙. In the essential part of C we have
vertices of degree two or three. Joining edges by omitting those of degree two gives
the combinatorial skeleton of C, which is a planar graph with 2g  2 vertices and
3g  3 edges, where g is the genus, i.e., g D 3 in our case. The name comes about
from its (loose) connection to the Berkovich skeleton of the analytiﬁcation of a
smooth complete curve; see [25]. The joined edges receive the sum of the lengths of
the original edges of the curve, and this way we arrive at a metric graph. The lengths
of the skeleton edges are the moduli of C. In this case the skeleton is the honeycomb
graph of genus three, denoted as “.000/” in [8]. Figure 4 (right) shows the skeleton

Tropical Computations in polymake
373
4 7 8
1 4 7
1 7 11
7 8 11
8 9 11
4 8 9
1 4 9
1/3
1/3
1/3
1/3
1
1/3
1
1/3
1
y
x
z
u
v
w
Fig. 4 Essential part of a tropical plane quartic (with edge lengths) and skeleton (with edge labels)
of C with the edge labels as in [8, Fig. 4]; the moduli are
u D v D w D 1 C 1
3 D 4
3
and
x D y D z D 1
3 ;
and this agrees with [8, Thm. 5.1].
Without going through all the remaining computations explicitly we now want
to sketch how the secondary cone of ˙ contributes to the moduli space of tropical
plane curves of genus three. Via measuring lattice lengths of edges and properly
attributing their contributions to the 3g3 edges of a ﬁxed skeleton curve, seccone ˙
is linearly mapped to a cone in R3g3; see [8, pp. 3ff] for the details. We apply this
procedure to the 12 rays computed in Listing 9 and visualized in Fig. 2. Comparing
the dual pair of pictures in Figs. 1 and 3 we can see that the three orbits of 2-splits do
not contribute anything to essential part of the curve. This means they are mapped to
zero in the moduli cone. On the other hand, e.g., the 3-split corresponding to ray 11
corresponds to a curve with moduli v D 1, x D z D 1
3 and u D w D y D 0. The
three rays in this orbit (with labels 9, 10 and 11) span a 3-dimensional cone in the
moduli space, and this is the image of seccone ˙ under the linear map described
above. The coefﬁcient vector which deﬁnes the curve is, up to scaling, the sum of
those three rays. That is, it sits right in the center of that moduli cone.
The moduli space of tropical plane curves of genus 3 is generated from the
secondary cones of all 1278 unimodular triangulations (up to symmetry) of the

374
S. Hampe and M. Joswig
dilated triangle 42, plus an additional contribution from hyperelliptic curves.
The dimension of the entire moduli space is six. Each of the 1278 triangulations
contributes a moduli cone whose dimension lies between three and six; see [8,
Table 1]. For higher genus it is necessary to consider several polygons; see [10].
Since that moduli space describes isomorphism classes of tropical curves it is
necessary to take symmetries (of the triangulations and the skeleta) into account.
This entails that the global structure is not a polyhedral fan but rather a quotient
structure called stacky fan; see [7].
5
Grassmannians, Linear Spaces and Matroids
There are many equivalent ways to deﬁne matroids, and we recommend that the
interested reader look at [42, 54]. For our purposes the following criterion [15, 22]
is the most convenient: Let M 
Œn
k

be a set of subsets of Œn D f1; 2; : : : ; ng of
size k. To this collection we can associate a polytope
PM WD convfvB WD
X
i2B
ei j B 2 Mg ;
where ei is a standard basis vector. If M D
Œn
k

consists of all k-sets, we call PM DW
.k; n/ a hypersimplex. We say that M is a matroid of rank k on Œn, if every edge
of PM is parallel to ei  ej for some i ¤ j. We call PM the matroid (basis) polytope
of M and the elements of M its bases. We say that M is loopfree, if every element of
Œn is contained in some basis.
5.1
The Tropical Grassmannian
The tropical Grassmannian TGr.k; n/ was ﬁrst studied in detail by Speyer and
Sturmfels [49]. It is the tropicalization of the (complex) Grassmannian Gr.k; n/,
intersected with the torus. It also parametrizes tropicalizations of uniform linear
spaces. This can be seen in the following fashion: Every element of TGr.k; n/ is a
tropical Plücker vector p 2 R.n
k/. Equivalently, we can view it as a height function
on the hypersimplex .k; n/  Rn. The set of all tropical Plücker vectors is the
Dressian Dr.k; n/. In general, TGr.k; n/ is a proper subset of Dr.k; n/. Throughout
the following we assume that k  n.
This height function thus induces a regular subdivision of .k; n/. The fact that
p is a Plücker vector implies (but is generally not equivalent) that this subdivision
is matroidal, i.e., every cell is again a matroid basis polytope. That is, if the set
fvB1; : : : ; vBkg comprises the vertices of a cell, then fB1; : : : ; Bkg is the set of bases
of a matroid.

Tropical Computations in polymake
375
The combinatorics of TGr.3; 6/ were studied in detail in [29]. The authors
compute that there are seven combinatorial types of generic uniform linear spaces,
basically encoded in their bounded complexes. As an example, we want to consider
a particular vector p 2 R.6
3/. We start out with analyzing the combinatorics, and we
turn to algebraic computations later.
tropical > $Delta=polytope::hypersimplex(3,6);
tropical > $p=new Vector<Int>(
[0,0,3,1,2,1,0,1,0,2,2,0,3,0,4,1,2,2,0,0]);
tropical > $tlinear=new fan::SubdivisionOfPoints(
POINTS=>$Delta->VERTICES, WEIGHTS=>$p);
tropical > print $tlinear->TIGHT_SPAN->MAXIMAL_POLYTOPES;
{0 4}
{1 5}
{1 2 3 4}
tropical > $bases = new IncidenceMatrix(
matroid::uniform_matroid(3,6)->BASES);
tropical > @subdiv_bases = map {
new Array<Set>(rows($bases->minor($_,All)))
} @{$tlinear->MAXIMAL_CELLS};
tropical > print join(",", map {
matroid::check_basis_exchange_axiom($_) } @subdiv_bases );
1,1,1,1,1,1
Listing 13 Computing the tight span of a tropical Plücker vector
Now we want to verify that the vector p, indeed, lies in TGr.3; 6/. It is known
that for .k; n/ D .3; 6/ the tropical Grassmannian and the Dressian agree as sets.
However, in general, this does not hold. We employ polymake’s interface to
Singular, and we switch to the application ideal.
tropical > application "ideal";
ideal > $I=pluecker_ideal(3,6);
ideal > $pp=new Vector<Int>(5*ones_vector(20)-$p);
ideal > $J=new Ideal(GENERATORS=>
$I->GROEBNER(ORDER_VECTOR=>$pp)->INITIAL_FORMS);
ideal > print $J->contains_monomial();
0
Listing 14 Computing a generalized initial ideal of the Plücker ideal
A few explanations are in order. The Plücker ideal I.k; n/ describes the algebraic
relations among the kk-minors of a general kn-matrix. This is an ideal in the
polynomial ring over the integers with
n
k

indeterminates, each of which encodes
a choice of k columns to specify one such minor. There is a purely combinatorial
description of the reverse lex Gröbner basis of I.k; n/, and this is what is computed
by polymake directly; see [50, Chapter 3]. This function is also implemented in
Macaulay2 [24]. The tropical variety TGr.k; n/ arises as a subfan of the Gröbner
fan of I.k; n/. Yet it is common that the interpretation of the vectors in the Gröbner
fan refer to maximization, while our choice for regular subdivisions relies on
minimization. This entails that we need to swap from the tropical Plücker vector

376
S. Hampe and M. Joswig
p to its negative. For technical reasons Singular requires such weight vectors to
be positive, which is why we consider p0 D 5  1  p; notice that
6
3

D 20. The
condition for p0 to lie in TGr.3; 6/ is that the ideal which is generated by the leading
forms of I.3; 6/ with respect to p0 does not contain any monomial.
Remark 5.1 Our choice for p or rather p0 corresponds to a generic tropical 2-plane
in 5-space of type EEFG in the notation of [49].
5.2
Tropical Linear Spaces
So far, we have only considered special Plücker vectors—in the sense that the
underlying matroid is a uniform matroid. There is a general theory of valuated
matroids, originally developed by Dress and Wenzel [14].
Deﬁnition 5.2 A valuated matroid .M; v/ is a matroid M together with a function v
from the set of its bases to the real numbers such that the induced regular subdivision
on the matroid basis polytope of M is matroidal, i.e., every cell is a matroid polytope
again.
We denote the regular subdivision by .M; v/. It has a normal complex
D.M; v/; see Sect. 3.1. The tropical linear space B.M; v/ associated to .M; v/ is
the subcomplex of D.M; v/ consisting of all faces whose corresponding dual cell if
the basis polytope of a loopfree matroid.
If the matroid is the uniform matroid Uk;n, then v is an element in the Dressian
Dr.k; n/. If, moreover, it is realizable, then v lies in the tropical Grassmannian
TGr.k; n/. Tropical linear spaces play an important role in tropical geometry. They
are exactly the tropical varieties of degree 1 [16]. If the valuation v  0 is trivial,
the tropical linear space is a fan, also called the Bergman fan B.M/. These fans are
the basic building blocks for smooth tropical varieties; see the discussion in Sect. 6.
Also, the tropical homology of a Bergman fan encodes the Orlik-Solomon algebra
of the matroid [55].
The deﬁnition itself already suggests an algorithm to compute a tropical linear
space: Find all cells of the matroidal subdivision corresponding to a loopfree
matroid and compute its cell in the normal complex. For this, polymake uses a
variant of Ganter’s algorithm [19, 20], which computes, in fact, the full face lattice
of the tropical linear space.
As an example, we want to compute the tropical linear space associated to the
(uniform) Plücker vector we considered in Listing 13. We then compute the complex
of its bounded faces to conﬁrm that its combinatorics matches the one in Fig. 5. In
this example, the bounded faces are identiﬁed as those, which do not contain any
rays. The latter are stored in the property FAR_VERTICES.

Tropical Computations in polymake
377
Fig. 5 The combinatorial
type of the tropical linear
space computed in Listing 15
3
1
4
2
5
0
ideal > application "tropical";
tropical > $mat = new matroid::ValuatedMatroid<Min>(
BASES=>\@{rows($bases)}, VALUATION_ON_BASES=>$tlinear->WEIGHTS,
N_ELEMENTS=>6);
tropical > $tl= linear_space($mat);
tropical > @bounded = map {
grep { ($_ * $tl->FAR_VERTICES)->size == 0} @{rows($_)}
} @{$tl->CONES};
tropical > print join(",",@bounded);
{0},{1},{2},{3},{4},{5},{0 4},{1 4},{2 4},{1 3},{2 3},{1 5},
{1 2 3 4}
Listing 15 Computing a tropical linear space
In the case of Bergman fans there are two more methods to compute the space:
5.2.1
Cyclic Fan Structure
Rincón studies the cyclic Bergman fan of a matroid [45], which is a reﬁnement of
the polyhedral structure we have considered so far. It relies heavily on computing
fundamental circuits and is particularly fast in the case of matrix matroids, where
these computations can be carried out by standard linear algebra methods.
5.2.2
Order Complex of the Lattice of Flats
Ardila and Klivans [3] proved that the order complex of the lattice of ﬂats of a
matroid M can be realized as a fan which is supported on B.M/. That is, we obtain
a reﬁnement of B.M/, such that every ray corresponds to a ﬂat and every cone to
a chain of ﬂats. Due to the potentially large number of ﬂats, this is naturally not a
very efﬁcient method to compute a tropical linear space. Nevertheless, this is still
feasible for small matroids and this particular subdivision is often useful.
In Listing 16, we compute both these fans for the Fano matroid, plus the linear
space of its trivial valuation. We see that in this particular case, all these fans are
actually the same.

378
S. Hampe and M. Joswig
tropical > $fano = matroid::fano_matroid();
tropical > $cyclic = matroid_fan<Min>($fano);
tropical > $linear = linear_space(
matroid::trivial_valuation<Min>($fano));
tropical > $order = matroid_fan_from_flats<Min>($fano);
tropical > print join(",", map {
$_->N_MAXIMAL_POLYTOPES } ($cyclic,$linear,$order));
21,21,21
Listing 16 Computing a Bergman fan in various ways
6
Intersection Theory
The basics for a tropical intersection theory were already laid out in [40]. They
are closely related to the fan displacement rule by Fulton and Sturmfels [18]. The
upshot is that, to intersect two tropical cycles in RnC1=R1, one of them is shifted in
a generic direction until they intersect transversely. The actual intersection product
is the limit of the transversal product when shifting back.
This deﬁnition is of course hardly suitable for computations. Instead, a-tint
uses the criterion by Jensen and Yu [31] for computations. This is a local criterion,
which states that a point in the set-theoretic intersection of two cycles X and Y is
also in the intersection product, if and only if the Minkowski sum of the local fans
at this point is full-dimensional (a more detailed account of various deﬁnitions of
the intersection product in the tropical torus can be found in [26]).
The situation becomes more difﬁcult when the ambient variety is not the whole
projective torus. As in the algebraic case, even the theory is only fully understood
in the case of smooth varieties. This is a tropical cycle with positive weights,
which is everywhere locally isomorphic to the Bergman fan of a matroid (where
an isomorphism of fans is a map in GLn.Z/ respecting weights). Every tropical
linear space is smooth by deﬁnition. For hypersurfaces, this deﬁnition of smoothness
coincides with the one given in Sect. 3.1.
Since intersection products should be local, it is enough to understand how to
compute them in Bergman fans of matroids. In this case, there are two equivalent
deﬁnitions by Shaw [47] and François and Rau [17]. In general, both are not very
computation-friendly. The ﬁrst is a recursive procedure using projections and pull-
backs. The second employs the idea of “cutting out the diagonal”, i.e., writing down
rational functions whose consecutive application gives the diagonal of B.M/B.M/.
Due to the large dimension and the quadratic increase in the number of cones, this
method does not perform well.
However, Shaw’s method does simplify nicely in the case of surfaces (i.e.,
matroids of rank 3), where the intersection product can be computed in a nice
combinatorial manner [47, Section 4]. Using a smoothness detection algorithm,
which was implemented in a-tint by Dennis Diefenbach, this enabled us to write
a procedure which computes intersection products of cycles in smooth surfaces. The

Tropical Computations in polymake
379
upshot of the detection algorithm is that in the case of surfaces, one can basically do
a brute force search over all possible ways to assign ﬂats to the rays of the fan.
As a demonstration of both intersection in the tropical torus and in a smooth
surface, we will consider the hypersurface deﬁned by the polynomial (2) in Sect. 3.1.
The reader will have to believe (or verify) that this hypersurface contains the
standard tropical line with apex .0; 0; 0; 0/ or, in other words, the Bergman fan B
of U2;4. We want to compute the self-intersection of B in V. Also, we will calculate
the threefold intersection of V in the torus. We already know from the Tropical
Bernstein Theorem [39, Theorem 4.6.8] that this is the lattice volume of 33.
tropical > print intersect(intersect($V,$V),$V)->DEGREE;
27
tropical > $B = matroid_fan<Min>(matroid::uniform_matroid(2,4));
tropical > print intersect_in_smooth_surface($V,$B,$B)->DEGREE;
-1
Listing 17 Self-intersection in a smooth surface
This seems to tie in nicely with the classic fact that a line in a smooth cubic has
self-intersection 1. Hence we want to take a closer look at that situation.
6.1
Lines in Tropical Cubics
In algebraic geometry it is a well-known fact that any smooth cubic surface in P3
contains exactly 27 lines. It is known that the incidence structure arising from the
27 lines and their 45 points of intersection is the unique generalized quadrangle of
order .4; 2/; see [51, §3] for details and related constructions. For instance, it is
known that any line intersects exactly ten other lines, and for any two disjoint lines
there are ﬁve lines that intersect both of them. Furthermore, as mentioned before,
they all have self-intersection 1.
In tropical geometry, the situation is much more complicated—or, possibly, much
more interesting, depending on your point of view. First of all, we need to establish
what a tropical line is:
Deﬁnition 6.1 A tropical line in RnC1=R1 is the tropical linear space of a valuation
on U2;nC1.
Now the peculiarities begin with the fact that a smooth tropical cubic surface may
actually contain families of tropical lines. A ﬁrst systematic study of this problem
was undertaken by Vigeland in [53]. He provided an example of a secondary cone
of 33, such that any general element of that cone deﬁnes a tropical cubic which
contains exactly 27 lines. He also gave a list of possible combinatorial types, which
describe how a line can lie in a tropical surface. Our example, which does not occur
in Vigeland’s list, was found via a systematic search through the secondary fan of
33. Here we just show our example, while its complete analysis is beyond the
scope of the present paper.

380
S. Hampe and M. Joswig
Other approaches focused on counting the lines “in the correct manner”, e.g.,
by showing that certain lines could not be realized as tropicalizations of lines in a
cubic surface [6, 9]. The paper [44] ﬁnds the 27 lines as trees in the boundary of
the tropicalization. The interest in this particular problem stems from the fact that
it provides a nontrivial, yet computationally feasible testing ground for studying the
problem of (relative) realizability. It may also serve as an indicator of what possible
additional structure should be associated to a tropical variety, i.e., in bold terms,
what a tropical scheme theory could be; see for example [23, 38].
6.2
Vigeland’s Missing Type
We will reconsider the polynomial (2) from Sect. 3.1. We compute the list of lines
(and families thereof) in the tropical hypersurface corresponding to f:
tropical > $L = lines_in_cubic($F);
[Output omitted]
tropical > print $L->N_ISOLATED,", ",$L->N_FAMILIES,"\n";
26, 3
Listing 18 Computing lines in a tropical cubic surface
This demonstrates that there are in fact 26 isolated lines and three different
families of lines in the tropical hypersurface V deﬁned by f. It can be shown that
small random changes to the coefﬁcients do not affect the combinatorics of the lines
in the corresponding cubic. In particular, this contradicts Conjecture 1 in [53] that a
general cubic contains exactly 27 lines. In Vigeland’s terminology, a general cubic
with a ﬁxed dual subdivision corresponds to a dense open subset in the euclidean
topology in the secondary cone. A formal proof is beyond the scope of this paper; a
different counterexample can be found in [39, Theorem 4.5.8].
Now we want to take a closer look at the families. One can ask polymake for a
picture of the families using
tropical > @rp = map { $_->representative() } $L->all_families;
tropical > visualize_in_surface($V, @rp);
Listing 19 Visualizing families in the cubic
This produces a (more or less generic) representative of each family and
visualizes them together in the hypersurface.
We see that the ﬁrst two families have the same combinatorial type: One of the
vertices lies on a vertex of the surface, while the other one is allowed to move on a
halﬂine; see Fig. 6(left). These lines can in fact be explained away using an argument
from [9]: They are not relatively realizable.
The third and last family, however, is somewhat bafﬂing: One of the vertices lies
on an edge of the surface, while the other one can move (see Fig. 6, right hand side).
In fact, this combinatorial type is missing from the table provided by Vigeland in

Tropical Computations in polymake
381
Fig. 6 Local pictures of representatives of families in the cubic and their combinatorial type in
Vigeland’s notation
[53, Table 2]. There is currently no known obstruction (i.e., non-realizability result)
for any of the lines in this family. In fact, we will shortly see that even in terms of
intersection combinatorics, any one of them—even the degenerate one—would ﬁt
the bill. Note that the vertex on the edge has coordinates .0; 0; 0; 0/, so if we shrink
the bounded edge to length 0, the line is actually the Bergman fan of U2;4; see also
Listing 17.
6.3
Intersection Products in Smooth Surfaces
We want to apply the algorithm we saw in Listing 17 to the case of lines in a cubic
surface and check that the 26 lines, together with a representative of the “odd”
family we found above, fulﬁll the following criteria (we denote by V the intersection
product in the surface V):
1. For any line L, there are exactly 10 other lines L0, such that L V L0 D 1. Also,
L V L00 D 0 for all other lines L00.
2. L V L D 1 for all lines L.
In fact, to save space we will only verify this here for the representative of the last
family and leave it to the interested reader to complete the computation for all lines.

382
S. Hampe and M. Joswig
tropical > $family_line = $rp[2];
tropical > @products = map {
intersect_in_smooth_surface($V,$family_line, $_)->DEGREE }
$L->all_isolated();
tropical > print join(",",@products);
0,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,0,1,1,0
tropical > print intersect_in_smooth_surface(
$V,$family_line,$family_line)->DEGREE;
-1
Listing 20 Intersecting lines in a smooth surface
One can also check that any two disjoint lines (by which we mean lines with
intersection product 0) intersect ﬁve other lines and that changing the representative
of the family does not affect any of the intersection multiplicities. In fact, we already
saw in Listing 17 that the degenerate representative of the last family has self-
intersection -1.
6.4
Rings of Matroids
Arbitrary intersections of tropical cycles are generally costly to compute, since they
involve numerous convex hull computations. It is therefore desirable to make use of
additional information whenever possible. One such case is the stable intersection
of two tropical linear spaces. Speyer described this in purely combinatorial terms
using the underlying valuated matroids [48]. In the case of trivial valuation, i.e.,
when intersecting two Bergman fans, this corresponds to the operation of matroid
intersection. In [27], the tropical cycle ring Mn generated by Bergman fans of
loopfree matroids on n elements is studied in detail. It is shown that nested matroids
form a basis for this space and that it is, in fact, the cohomology ring of a toric
variety.
Theorem 6.4 The ring Mn is isomorphic to the cohomology ring A.X.Permn// of
the toric variety corresponding to the normal fan of the permutahedron of order n.
Using the explicit representation in terms of nested matroids, one can much more
easily compute sums and products of cycles lying in this ring. Various properties
can also be read off of this data—such as the degree, which is simply the sum of the
coefﬁcients. It was also shown in [27], that various matroid invariants, such as the
Tutte polynomial, are linear maps on Mn.
In the example in Listing 21, we consider the direct sum of two uniform matroids
U1;2. In M4, it is the sum of three nested matroids and we compute both its Tutte
polynomial and the corresponding linear combination of the Tutte polynomials of
the nested matroids to see that they are equal.

Tropical Computations in polymake
383
tropical > $u = matroid::uniform_matroid(1,2);
tropical > $m = matroid::direct_sum($u,$u);
tropical > print $m->TUTTE_POLYNOMIAL;
x^2 + 2*x*y + y^2
tropical > $r = matroid_ring_cycle<Min>($m);
tropical > print $r->NESTED_COEFFICIENTS;
-1 1 1
tropical > @n = $r->nested_matroids();
tropical > print - $n[0]->TUTTE_POLYNOMIAL
+ $n[1]->TUTTE_POLYNOMIAL + $n[2]->TUTTE_POLYNOMIAL ;
x^2 + 2*x*y + y^2
Listing 21 Computing the Tutte polynomial of a direct sum of matroids
Acknowledgements We would like to thank Elizabeth Baldwin and Diane Maclagan for many
helpful suggestions on improving this paper.
References
1. X. Allamigeon, TPLib (Tropical Polyhedra Library) (2013), http://www.cmap.polytechnique.
fr/~allamigeon/software/
2. L. Allermann, J. Rau, First steps in tropical intersection theory. Math. Z. 264(3), 633–670
(2010)
3. F. Ardila, C.J. Klivans, The Bergman complex of a matroid and phylogenetic trees. J. Combin.
Theory Ser. B 96(1), 38–49 (2006)
4. E. Baldwin, P. Klemperer, Understanding preferences: “Demand Types”, and the existence of
equilibrium with indivisibilities, Nufﬁeld College, Working Paper (2015)
5. A.L. Birkmeyer, A. Gathmann, Realizability of tropical curves in a plane in the non-constant
coefﬁcient case (2014, Preprint), arXiv:1412.3035
6. T. Bogart, E. Katz, Obstructions to lifting tropical curves in surfaces in 3-space. SIAM J.
Discret. Math. 26(3), 1050–1067 (2012)
7. S. Brannetti, M. Melo, F. Viviani, On the tropical Torelli map. Adv. Math. 226(3), 2546–2586
(2011)
8. S. Brodsky, M. Joswig, R. Morrison, B. Sturmfels, Moduli of tropical plane curves. Res. Math.
Sci. 2(4), 1–31 (2015)
9. E. Brugallé, K. Shaw, Obstructions to approximating tropical curves in surfaces via intersection
theory. Canad. J. Math. 67(3), 527–572 (2015)
10. W. Castryck, J. Voight, On nondegeneracy of curves. Algebra Number Theory 3(3), 255–281
(2009)
11. J.A. De Loera, J. Rambau, F. Santos, Triangulations. Structures for Algorithms and Applica-
tions. Algorithms and Computation in Mathematics, vol. 25 (Springer, Berlin, 2010)
12. W. Decker, G.-M. Greuel, G. Pﬁster, H. Schönemann, Singular 4-1-0 – A computer algebra
system for polynomial computations (2016), http://www.singular.uni-kl.de
13. M. Develin, B. Sturmfels, Tropical convexity. Doc. Math. 9, 1–27 (electronic) (2004).
Correction: ibid., pp. 205–206
14. A.W.M. Dress, W. Wenzel, Valuated matroids. Adv. Math. 93(2), 214–250 (1992)
15. J. Edmonds, Submodular functions, matroids, and certain polyhedra, in Combinatorial Struc-
tures and Their Applications (Proc. Calgary Internat. Conf., Calgary, Alta., 1969) (Gordon
and Breach, New York, 1970), pp. 69–87

384
S. Hampe and M. Joswig
16. A. Fink, Tropical cycles and chow polytopes. Beiträge zur Algebra und Geometrie/Contribu-
tions to Algebra and Geometry 54(1), 13–40 (2013)
17. G. François, J. Rau, The diagonal of tropical matroid varieties and cycle intersections. Collect.
Math. 64(2), 185–210 (2013)
18. W. Fulton, B. Sturmfels, Intersection theory on toric varieties. Topology 36(2), 335–353 (1997)
19. B. Ganter, Algorithmen zur formalen Begriffsanalyse, ed. by B. Ganter, R. Wille, K.E. Wolff.
Beiträge zur Begriffsanalyse (Bibliographisches Institut, Mannheim, 1987), pp. 241–254
20. B. Ganter, K. Reuter, Finding all closed sets: a general approach. Order 8(3), 283–290 (1991)
21. E. Gawrilow, M. Joswig, Flexible object hierarchies in polymake, in Proceedings of the 2nd
International Congress of Mathematical Software, Castro Urdiales, Spanien, 1–3 Sept 2006,
ed. by A. Igelesias, N. Takayama (2006), pp. 219–221
22. I.M. Gel’fand, M. Goresky, R.D. MacPherson, V.V. Serganova, Combinatorial geometries,
convex polyhedra, and Schubert cells. Adv. Math. 63(3), 301–316 (1987)
23. J. Giansiracusa, N. Giansiracusa, Equations of tropical varieties. Duke Math. J. 165(18),
3379–3433 (2016)
24. D.R. Grayson, M.E. Stillman, Macaulay2, a software system for research in algebraic geometry
(2017), available at http://www.math.uiuc.edu/Macaulay2/
25. W. Gubler, J. Rabinoff, A. Werner, Tropical skeletons (2015, preprint), arXiv:1508.01179
26. S. Hampe, a-tint: a polymake extension for algorithmic tropical intersection theory. Eur. J.
Combin. 36, 579–607 (2014)
27. S. Hampe, The intersection ring of matroids. J. Comb. Theory Ser. B 122, 578–614 (2017)
28. S. Herrmann, On the facets of the secondary polytope. J. Comb. Theory Ser. A 118(2), 425–447
(2011)
29. S. Herrmann, A. Jensen, M. Joswig, B. Sturmfels, How to draw tropical planes. Electron. J.
Comb. 16(2), Special volume in honor of Anders Björner, Research Paper 6, 26 (2009)
30. A.N. Jensen, Gfan, a software system for Gröbner fans and tropical varieties, version 0.6,
available at http://home.imf.au.dk/jensen/software/gfan/gfan.html (2017)
31. A. Jensen, J. Yu, Stable intersections of tropical varieties. J. Algebraic Comb. 43(1), 101–128
(2016)
32. A.N. Jensen, H. Markwig, T. Markwig, Y. Ren, tropical.lib. a Singular 4-1-0 library for
computations in tropical goemetry, Tech. report (2016)
33. M. Joswig, Tropical convex hull computations, in Tropical and Idempotent Mathematics, ed.
by G.L. Litvinov, S.N. Sergeev. Contemporary Mathematics, vol. 495 (American Mathematical
Society, Providence, RI, 2009)
34. M. Joswig, G. Loho, B. Lorenz, B. Schröter, Linear programs and convex hulls over ﬁelds
of Puiseux fractions, in Proceedings of MACIS 2015, LNCS 9582, Berlin, 11–13 Nov 2015
(2016), pp. 429–445
35. M.M. Kapranov, Chow Quotients of Grassmannians. I, ed. by I.M. Gel’ fand Seminar.
Advances in Soviet Mathematics, vol. 16 (American Mathematical Society, Providence, RI,
1993), pp. 29–110
36. P. Klemperer, A new auction for substitutes: central bank liquidity auctions, the U.S. TARP,
and variable product-mix auctions, University of Oxford, Working Paper (2008)
37. P. Klemperer, The product-mix auction: a new auction design for differentiated goods. J. Eur.
Econ. Assoc. 8, 526–536 (2010)
38. D. Maclagan, F. Rincón, Tropical schemes, tropical cycles, and valuated matroids (2014,
preprint), arXiv:1401.4654
39. D. Maclagan, B. Sturmfels, Introduction to Tropical Geometry. Graduate Studies in Mathemat-
ics, vol. 161 (American Mathematical Society, Providence, RI, 2015)
40. G. Mikhalkin, Enumerative tropical algebraic geometry in R2. J. Am. Math. Soc. 18(2),
313–377 (2005)
41. G. Mikhalkin, J. Rau, Tropical geometry, work in progress, available at https://www.math.uni-
tuebingen.de/user/jora/downloads/main.pdf (2015)
42. J. Oxley, Matroid Theory. Oxford Graduate Texts in Mathematics, vol. 21, 2nd edn. (Oxford
University Press, Oxford, 2011)

Tropical Computations in polymake
385
43. Y. Ren, Computing tropical varieties over ﬁelds with valuation using classical standard basis
techniques. ACM Commun. Comput. Algebra 49(4), 127–129 (2015)
44. Q. Ren, K. Shaw, B. Sturmfels, Tropicalization of del Pezzo surfaces. Adv. Math. 300, 156–189
(2016)
45. F. Rincón, Computing tropical linear spaces. J. Symb. Comput. 51, 86–98 (2013)
46. A. Schrijver, Combinatorial Optimization. Polyhedra and Efﬁciency. Vol. A. Algorithms and
Combinatorics, vol. 24 (Springer, Berlin, 2003). Paths, ﬂows, matchings, Chapters 1–38
47. K.M. Shaw, A tropical intersection product in matroidal fans. SIAM J. Discret. Math. 27(1),
459–491 (2013)
48. D.E. Speyer, Tropical linear spaces. SIAM J. Discret. Math. 22(4), 1527–1558 (2008)
49. D. Speyer, B. Sturmfels, The tropical Grassmannian. Adv. Geom. 4(3), 389–411 (2004)
50. B. Sturmfels, Algorithms in Invariant Theory. Texts and Monographs in Symbolic Computa-
tion, 2nd edn. (Springer, New York, 2008)
51. J.A. Thas, H. Van Maldeghem, Embeddings of small generalized polygons. Finite Fields Appl.
12(4), 565–594 (2006)
52. N.M.
Tran,
J.
Yu,
Product-mix
auctions
and
tropical
geometry
(2015,
preprint),
arXiv:1505.05737
53. M.D. Vigeland, Tropical lines on smooth tropical surfaces (2007, preprint), arXiv:0708.3847
54. N. White (ed.), Theory of Matroids. Encyclopedia of Mathematics and Its Applications, vol. 26
(Cambridge University Press, Cambridge, 1986)
55. I. Zharkov, The Orlik-Solomon algebra and the Bergman fan of a matroid. J. Gökova Geom.
Topol. GGT 7, 25–31 (2013)

Focal Schemes to Families of Secant
Spaces to Canonical Curves
Michael Hoff
Abstract For a general canonically embedded curve C of genus g  5, let d  g1
be an integer such that the Brill–Noether number .g; d; 1/ D g 2.g d C1/  1.
We study the family of d-secant Pd2’s to C induced by the smooth locus of the
Brill–Noether locus W1
d.C/. Using the theory of foci and a structure theorem for the
rank one locus of special 1-generic matrices by Eisenbud and Harris, we prove a
Torelli-type theorem for general curves by reconstructing the curve from its Brill–
Noether loci W1
d.C/ of dimension at least 1.
Keywords Focal scheme • Brill-Noether locus • Torelli-type theorem
Subject Classiﬁcations 14H51, 14M12, 14C34
1
Introduction and Motivation
For a general canonically embedded curve C of genus g  5 over C, we study the
local structure of the Brill–Noether locus W1
d.C/ for an integer d gC3
2 e  d  g  1.
Our main object of interest is the focal scheme associated to the family of d-secant
Pd2’s to C. The focal scheme arises in a natural way as the degeneracy locus of
a map of locally free sheaves associated to a family of secant spaces to a curve.
In other words, the focal scheme (or the scheme of ﬁrst-order foci) consists of all
points where a secant intersects its inﬁnitesimal ﬁrst-order deformation.
In [5] and [6], Ciliberto and Sernesi studied the geometry of the focal scheme
associated to the family of .g  1/-secant Pg3’s induced by the singular locus
W1
g1.C/ of the theta divisor, and they gave a conceptual new proof of Torelli’s
theorem. Using higher-order focal schemes for general canonical curves of genus
g D 2m C 1, they showed in [7] that the family of .m C 2/-secants induced by
M. Hoff ()
Universität des Saarlandes, Campus E2 4, 66123 Saarbrücken, Germany
e-mail: hahn@math.uni-sb.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_15
387

388
M. Hoff
W1
mC2.C/ also determines the curve. These are the extremal cases, that is, the degree
d is maximal or minimal with respect to the genus g (in symbols d D g  1 or
d D gC3
2
and g odd). The article [2] of Bajravani can be seen as a ﬁrst extension of
the previous results to another Brill–Noether locus (g D 8 and d D 6 D d gC3
2 e).
Combining methods of [6, 7] and [8], we will give a uniﬁed proof which shows
that the canonical curve is contained in the focal schemes parametrised by the
smooth locus of any W1
d.C/ if d  g  1 and .g; d; 1/ D g  2.g  d C 1/  1.
Moreover, we have the following Torelli-type theorem (see also Corollary 3.13).
Theorem 1.1 A general canonically embedded curve of genus g can be recon-
structed from its Brill–Noether locus W1
d.C/ if d gC3
2 e  d  g  1.
In [12], Pirola and Teixidor i Bigas proved a generic Torelli-type theorem for
Wr
d.C/ if .g; d; r/  2, or .g; d; r/ D 1 and r D 1. Whereas they used the global
geometry of the Brill–Noether locus to recover the curve, our theorem is based on
the local structure around a smooth point of W1
d.C/ 	 Wd.C/. Only ﬁrst-order
deformations are needed.
Our proof follows [7]. We show that the ﬁrst-order focal map is in general
1-generic and apply a result of Eisenbud and Harris [10] in order to describe the rank
one locus of the focal matrix. Two cases are possible. The rank one locus of the focal
matrix consists either of the support of a divisor D of degree d corresponding to a
line bundle OC.D/ 2 W1
d.C/ or of a rational normal curve. Even if we are not able
to decide which case should occur on a general curve (see Sect. 4 for a discussion),
we ﬁnish our proof by studying focal schemes to a family of rational normal curves
induced by the ﬁrst-order focal map.
In Sect. 2, we recall the deﬁnition of focal schemes as well as general facts and
known results about focal schemes. Section 3 is devoted to prove the generalisation
of the main theorem of [7] to arbitrary positive dimensional Brill–Noether loci.
2
The Theory of Foci
We recall the deﬁnition as well as the construction of the family of d-secant Pd2’s
induced by an open dense subset of C1
d. Afterwards we introduce the characteristic
or focal map and deﬁne the scheme of ﬁrst-order foci of rank k associated to the
above family. We give a slightly generalised deﬁnition of the scheme of ﬁrst- and
second-order foci compared to [6]. In Sect. 2.2, we recall the basic properties of the
scheme of ﬁrst-order foci. Our approach follows [8].
2.1
Deﬁnition of the Scheme of First-Order Foci
Let C be a Brill–Noether general canonically embedded curve of genus g  5, and
let d  g  1 be an integer such that the Brill–Noether number  WD .g; d; 1/ D

Focal Schemes to Families of Secant Spaces to Canonical Curves
389
g  2.g  d C 1/  1. Let C1
d be the variety parametrising effective divisors of
degree d on C moving in a linear system of dimension at least 1 (see [1, IV, §1]).
Let ˙ 	 W1
d.C/ be the smooth locus of W1
d.C/. Furthermore, let ˛d W C1
d ! W1
d.C/
be the Abel-Jacobi map (see [1, I, §3]) and let S D ˛1
d .˙/. Then ˛ W S ! ˙ is a
P1-bundle, and in particular S is smooth of pure dimension  C 1. For every s 2 S,
we denote by Ds the divisor of degree d on C deﬁned by s and s D Ds 	 Pg1 its
linear span, which is a d-secant Pd2 to C. We get a . C 1/-dimensional family of
d-secant Pd2’s parametrised by S:
We denote by f W  ! Pg1 the induced map.
Construction 1 (Of the Family ) Let Dd 	 Cd  C be the universal divisor of
degree d and let DS 	 S  C be its restriction to S  C. We denote by  W S  C ! S
the projection. We consider the short exact sequence
0 ! OSC ! OSC.DS/ ! ODS.DS/ ! 0:
By Grauert’s Theorem, the higher direct image R1.ODS.DS/ D 0 vanishes and
we get a map of locally free sheaves on S
R1.OSC/ ! R1.OSC.DS// ! 0
whose kernel is a locally free sheaf F 	 R1.OSC/ Š OS ˝ H1.C; OC/ of rank
d  1 D g  .g  d C 1/. The family  is the associated projective bundle
 D P.F/ 	 S  Pg1:
Remark 2.1 We can also construct the family  from the Brill–Noether locus
Wd.C/ and its singular locus W1
d.C/. At a singular point L 2 W1
d.C/nW2
d.C/, the
projectivised tangent cone to Wd.C/ at L in the canonical space Pg1 coincides with
the scroll
XL D
[
D2jLj
D
swept out by the pencil g1
d D jLj. Hence, the ruling of XL is the one-dimensional
family of secants induced by jLj. Varying the point L yields the family . See also
[6, Theorem 1.2]. We conclude that the family  is determined by Wd.C/ and its
singular locus W1
d.C/.

390
M. Hoff
In order to deﬁne the ﬁrst-order focal map of the family , we make a short
digression. We consider a ﬂat family F of closed subschemes of a projective scheme
X over a base B, that is,
Let T.1/jF WD 
1 .TB/jF be the tangent sheaf along the ﬁbers of 2 restricted to
the family F and let NF=BX be the normal sheaf of F 	 B  X. There is a map
 W T.1/jF ! NF=BX
called the global characteristic map of the family F which is deﬁned by the
following exact and commutative diagram:
For every b 2 B the homomorphism  induces a homomorphism
 b W TB;b ˝ O1
1
.b/ ! N1
1
.b/=X
called the (local) characteristic map of the family F at a point b. Since F is a ﬂat
family, we get a classifying morphism
' W B ! HilbY
by the universal property of the Hilbert scheme HilbY. The linear map induced by
the characteristic map
H0. b/ W TB;b ! H0.N1
1
.b/=X/

Focal Schemes to Families of Secant Spaces to Canonical Curves
391
is the differential d'b at the point b (see also [11, p. 198 f]). Assuming that B, Y and
the family F are smooth, all sheaves in the above diagram are locally free and by
diagram-chasing, it follows that
ker.d.2jF// D ker. /
and
dim.2.F// D dim.F/  rk.ker. //:
We come back to the smooth family  and ﬁx some notation for the rest of
the article. Let N WD N=SPg1 be the normal bundle of  in S  Pg1 and let
T.p/j WD p.TS/j be the restriction of the tangent bundle along the ﬁbers of q to
. Let
 W T.p/j ! N
be the global characteristic map deﬁned as above. For every s 2 S the homomor-
phism  induces a homomorphism
s W TS;s ˝ Os ! Ns=Pg1
also called the characteristic map or ﬁrst-order focal map of the family  at a
point s.
Remark 2.2 Fix an s 2 S. We have s D P.U/, where U 	 V D H1.C; OC/ is a
vector subspace of dimension d  1. The normal bundle of s in Pg1 is given by
Ns=Pg1 D V=U ˝ Os.1/
and
H0.s; Ns=Pg1/ D Hom.U; V=U/:
The characteristic map is of the form
s W TS;s ˝ Os ! V=U ˝ Os.1/:
Hence, it is given by a matrix of linear form on s.
We deﬁne the ﬁrst- and the second-order foci (of rank k) of a family .

392
M. Hoff
Deﬁnition 2.3
(a) Let V./k be the closed subscheme of  deﬁned by
V./k D fp 2 j rk..p//  kg:
Then, V./k is the scheme of ﬁrst-order foci of rank k and the ﬁber of V./k
over a point s 2 S
.V./k/s D V.s/k 	 s
is the scheme of ﬁrst-order foci of rank k at s.
(b) Assume that V./k induces a family of rational normal curves  , that is, for
a general s 2 S the ﬁber s D V.s/k is a rational normal curve. Let  be
the global characteristic map of  . We call the ﬁrst-order foci of rank k of the
family  , that is,
V. /k D fp 2  j rk. .p//  kg
the second-order foci of rank k of the family .
Remark 2.4 Our deﬁnition of scheme of ﬁrst-order foci is a slight generalisation of
the deﬁnition given in [5, 6]. Note that if
k D minfrk.T.p/j/; rk.N /g  1 D minfcodimS; codimSPg1./g  1;
we get the classical deﬁnition of ﬁrst-order foci. Furthermore, our deﬁnition of the
second-order foci of rank k is inspired by the deﬁnition of higher-order foci of [8].
Remark 2.5
(a) The equality V./s D V.s/ is shown in [4, Proposition 14].
(b) If  has maximal rank, that is, if  is either injective or has torsion cokernel, then
V./k is a proper closed subscheme of  for k  minfrk.T.p/j/; rk.N /g  1.
(c) In Sect. 3 we study the scheme of ﬁrst-order foci of rank 1 of the family .
2.2
Properties of the Scheme of First-Order Foci
We assume in this section that C is a Brill–Noether general curve. The following
proposition is proven in [6] which can be easily generalised to the case of divisors
of degree d < g  1.
Proposition 2.6 For s 2 S, we have
Ds 	 V.s/1:
In particular, the canonical curve C is contained in the scheme of ﬁrst-order foci.

Focal Schemes to Families of Secant Spaces to Canonical Curves
393
Proof Let p 2 Supp.Ds/. Then there exists a codimension 1 family of effective divi-
sors and hence d-secants containing the point p. Therefore, there is a codimension
1 subspace T 	 TS;s such that the map s.p/jT is zero. We conclude that the focal
map s has rank at most 1 in points of Supp.Ds/.
ut
An important step in the proof of our main theorem is to show that the ﬁrst-order
focal map s is 1-generic. The general deﬁnition of 1-genericity can be found in [9].
In our case, a reformulation of the deﬁnition is the following.
Proposition 2.7 The matrix s is 1-generic if and only if for each nonzero element
v 2 TS;s, the homomorphism
H0.s/.v/ 2 Hom.U; V=U/
is surjective.
We recall what is known about the 1-genericity of the matrix s.
Proposition 2.8 ([6, Theorem 2.5], [7, Theorem 2], [2]) Let s 2 S be a general
point.
(a) If Ds is a divisor of degree g  1 cut on C by s, then the matrix s is 1-generic
(equivalently, V.s/1 is a rational normal curve) if and only if the pencil jDsj is
base point free.
(b) If  D .g; d; 1/ D 1, then the matrix s is 1-generic (equivalently, V.s/1 is a
rational normal curve).
(c) If g D 8 and d D 6, then the matrix s is 1-generic.
Remark 2.9 ([13, p. 253]) Another fact related to the 1-genericity of s is the
following: Let
be the ﬁrst order deformation of s deﬁned by H0.s/.v/ for a vector v 2 TS;s. Then,
H0.s/.v/ is surjective if and only if q."/ 	 Pg1 is not contained in a hyperplane.
Furthermore, the deﬁnition of the ﬁrst-order foci at a point s 2 S depends only on
the geometry of the family  in a neighbourhood of s. A point in V.s/k is a point
where the ﬁber s intersects a codimension k family of its inﬁnitesimally near ones.
3
Proof of the Main Theorem
The strategy of the proof is the same as in [7]. We assume that the canonically
embedded curve C is a Brill–Noether general curve. Recall that g and d are chosen

394
M. Hoff
such that the Brill–Noether number  WD .g; d; 1/  1. We begin by showing
some standard properties of a line bundle over a Brill–Noether general curve which
we will use later on. Then we prove that the matrix s is 1-generic for general s 2 S
and study the rank one locus of s which will be the divisor Ds or a rational normal
curve. In the second case, we study the second-order focal locus. In both cases we
can recover the canonical curve.
Lemma 3.1 Let C be a Brill–Noether general curve and let L 2 W1
d.C/ be a smooth
point. Then jLj is base point free, H1.C; L2/ D 0 and gC2
2d
D jL2j maps C birational
to its image (it is not composed with an involution).
Proof All of our claims follow directly from the generality assumption. We just
mention that the map induced by jL2j cannot be composed with an irrational
involution. Hence, if the map is not birational, it is composed with a g1
d0 for d0 
2d
C2
which is impossible for a Brill–Noether general curve.
ut
Corollary 3.2 Let C be a Brill–Noether general curve and let L 2 W1
d.C/ be a
smooth point. For i  1 and p1; : : : ; pi 2 Supp.D/ for D 2 jLj general, we have
h0.C; L2.p1      pi// D 2d  i C 1  g:
In particular, H0.C; L2.p1      pC1// D H0.C; L/ and H1.C; L2.p1     
pi// D 0 for i D 1; : : : ;  C 1.
Proof H0.C; L2.p1   pi// D H0.C; L2.p1   piC1// if the images under
jL2j of the two points pi and piC1 are the same point. Since jL2j maps C birational
to its image, this does not happen for a general choice.
ut
Using Lemma 3.1 and Corollary 3.2, our proof of the following lemma is
identical to [7, Theorem 2]. We clarify and generalise the arguments given in [7,
Theorem 2].
Lemma 3.3 With the assumptions of Lemma 3.1, the focal matrix s W TS;s˝Os !
Ns=Pg1 is 1-generic for a sufﬁciently general s 2 S.
Proof By Proposition 2.7, the matrix s is 1-generic if and only if for each nonzero
element v 2 TS;s, the homomorphism H0.s/.v/ 2 Hom.U; V=U/ is surjective.
We consider the ﬁrst order deformation " 	 Spec.kŒ"/  Pg1 deﬁned by
H0.s/./ for a nonzero vector  2 TS;s. Note that H0.s/./ is surjective if
and only if the image q."/ 	 Pg1 is not contained in a hyperplane. Let D" 	
Spec.kŒ"/Pg1 be the ﬁrst order deformation of the divisor Ds deﬁned by  2 TS;s.
Then
q."/  q.D"/
and the curvilinear scheme q.D"/ corresponding to a divisor on C satisﬁes
Ds  q.D"/  2Ds:
We show for all possible cases that q.D"/ is not contained in a hyperplane.

Focal Schemes to Families of Secant Spaces to Canonical Curves
395
Case 1:
The vector  is tangent to ˛1
d .L/, equivalently the family D" deforms the
divisor Ds in the linear pencil jLj. Let 'L be the morphism deﬁned by the pencil.
Then we get
q.D"/ D '
L ./;
where we identify  with a curvilinear scheme of P1 supported at the point
s 2 P1. Since jLj is base point free, we have q.D"/ D 2Ds. Therefore, the
curvilinear scheme q.D"/ is not contained in a hyperplane since H0.C; KC 
2Ds/ D H1.C; 2Ds/ D H1.C; L2/ D 0. We are done in this case.
Case 2:
We assume that  2 TS;snf0g is not tangent to ˛1
d .L/ at s. Let
q.D"/ D p1 C    C pk C 2.pkC1 C    C pd/
where Ds D p1 C    C pd and k  0.
Case 2 (a):
We assume k  . We have
H0.C; KC  q.D"// D H1.C; p1 C    C pk C 2.pkC1 C    C pd//
D H1.C; 2Ds  p1      pk/
D H1.C; L2.p1      pk// D 0
by Corollary 3.2. Hence, the curvilinear scheme q.D"/ is not contained in a
hyperplane and H0.s/./ is surjective.
Case 2 (b):
We assume k   C 1. In the following, we will show that this case
cannot occur. The vector  is also tangent to p1 C    C pk C Cdk. We denote by
Es the divisor Es D pkC1C  Cpd. Then the tangent space to p1C  CpkCCdk
is given by H0.Es; OEs.Ds// which is a subspace of H0.Ds; ODs.Ds//. The short
exact sequence
0 ! OC ! L ! ODs.Ds/ ! 0
induces a linear map
H0.Ds; ODs.Ds//
ı
! H1.C; OC/
which we identify with the differential of ˛d at s (see [1, IV, §2, Lemma 2.3]).
The image of  2 H0.Es; OEs.Ds// is therefore contained in the linear span of
Es. After projectivising, we get
Œı./ 2 Es D pkC1 C    C pd 	 s 	 Pg1:
Since  is not tangent to ˛1
d .L/, the vector  is also tangent to W1
d.C/ and
therefore the image point Œı./ is contained in the vertex V D TL.W1
d.C// of

396
M. Hoff
XL, the scroll swept out by the linear pencil jLj. Hence, for every sufﬁciently
general D 2 jLj, there is an effective divisor E of degree d    1 such that
D D ECp1C  CpC1 and V \E ¤ ;. Hence, dim.Ds C E/  d2Cd1
and equivalently,
h0.C; Ds C E/ D deg.Ds C E/ C dim.Ds C E/ C 1  3:
But by Corollary 3.2, H0.C; L2.p1      pC1// D H0.C; L/, a contradiction.
ut
Note that
s W TS;s ˝ Os ! Ns=Pg1
is a map between rank  C 1 and n D h1.C; L/ vector bundles of linear forms in
Pd2 D s. Since d D  C 1 C n and s is 1-generic by Lemma 3.3, we may apply
the following theorem due to Eisenbud and Harris.
Theorem 3.4 ([10, Proposition 5.1]) Let M be an .aC1/.bC1/ 1-generic matrix
of linear forms on PaCb. If D1.M/ D fx 2 PaCb j rk.M.x//  1g contains a ﬁnite
scheme  of length  a C b C 3, then D1.M/ is the unique rational normal curve
through  and M is equivalent to the catalecticant matrix.
We get the following corollary.
Corollary 3.5 For s 2 S sufﬁciently general, the rank one locus V.s/1 is either Ds
or a rational normal curve through Ds.
Proof By Lemma 3.3, we may apply Theorem 3.4. Note that Ds 	 V.s/1 (there
exists a codimension 1 family in S of s containing a point of the support of Ds).
ut
Remark 3.6
(a) The scheme of ﬁrst-order foci at s 2 S of the family  is a secant variety to
V.s/1.
(b) If d D g  1 or  D 1, the focal matrix s is a 2  .g  3/ or n  2-matrix,
respectively. Hence, the rank one locus is the scheme of ﬁrst-order foci, which
is a rational normal curve in s. We recover the cases of [6] and [7].
Corollary 3.7 Let C be a Brill–Noether general canonically embedded curve. If
V.s/1 D Ds for sufﬁciently general s 2 S, the family  determines the canonical
curve C.
For the rest of this section, we assume that  s D V.s/1 is a rational normal
curve for s 2 S sufﬁciently general.
Let ˙ be the smooth locus of W1
d.C/ and L 2 ˙. Let U 	 ˛1
d .L// be a Zariski
open dense set such that s D V.s/1 for all s 2 U. We deﬁne the surface
L D
[
s2U
s

Focal Schemes to Families of Secant Spaces to Canonical Curves
397
and
Pg1 D
[
L2˙
FL:
Let
be the family induced by all rational normal curves, that is, for s 2 S0 	 S, s D
V.s/1 is a rational normal curve. The family  is the rank one locus of the global
characteristic map  and the variety Pg1 is the image of the family  under the
second projection q.
Remark 3.8 In the cases d D g  1 or  D 1 the rational surface L is birational to
P1  P1 	 P3 or a quadric cone in P3, respectively. This can be explained in terms
of the curve C and the line bundle L:
For d D g1 we consider the birational image C0 of C
jLjj!C˝L1j
!
P1 P1 given
by the line bundle L and its Serre dual !C ˝ L1. Then the rational surface L is the
image of the blow up of P1  P1 along the singular points of C0 under the adjoint
morphism.
For  D 1 we consider the birational image C0 of the curve C in the quadric cone
Q in P3 induced by the line bundle L2. Note that H0.C; L2/ is four-dimensional and
the multiplication map H0.C; L/ ˝ H0.C; L/ ! H0.C; L2/ has a one-dimensional
kernel. Then the rational surface L is again the image of the blow up of Q along
the singular points of C0 under the adjoint morphism.
We have not found a similar geometrical meaning of the surface L in the other
cases (see also Question 4.1).
Lemma 3.9 The variety Pg1 has dimension at least 3.
Proof Note that there is a map L ! P1 D ˛1
d .L/ such that the general ﬁber
is a rational curve. Hence, the surface L is rational. Assume that L D L0 for
all L0 2 ˙. Since the scrolls XL0 are algebraically equivalent to each other, the
rulings on them cut out a . C 1/-dimensional family of algebraically equivalent
rational curves on L, the focal curves. (We can also argue that all d-secant to C are
algebraically equivalent, thus the intersection with L yields a . C 1/-dimensional
family of algebraically equivalent focal curves.) On the desingularization of L, all
of them are linear equivalent since L is regular (H1.L; OL/ D 0). This implies
that all g1
d’s on C are linear equivalent, hence C has a gC1
d
. A contradiction to the
generality assumption on C.
ut
For the convenience of the reader, we recall the deﬁnition of the second-order
foci of the family  (see also Deﬁnition 2.3). We apply the theory of foci to the

398
M. Hoff
family  	 S0  Pg1 and get the characteristic map
 W T.p/j ! N =S0Pg1
of vector bundles of rank C1 and g2, respectively. For s 2 S0, we call the closed
subscheme of s deﬁned by rank. s/  k the scheme of second-order foci of rank k
at s (of the family ).
We will show that the scheme of second-order foci of rank 1 at s 2 S0 of the
family  is a ﬁnite scheme containing the divisor Ds and compute its degree.
Lemma 3.10 Let  s W TS0;s˝Os ! Ns=Pg1 be the characteristic map for general
s 2 S0. Then the rank of  s at a general point of s is at least 2.
Proof We recall the connection of the rank and the dimension of Pg1 as in [8, page
6]. Since dim.Pg1/ D  C 2  rank.ker. //, the rank of  s at the general point
p 2 s is
rank. s.p// D dim.T.p/j /  rank.ker. //
D  C 1  rank ker. //
D dim.Pg1/  1:
The lemma follows from Lemma 3.9. This fact is also shown in [4, page 98].
ut
We now consider for a general s 2 S0 the rank one locus of  s which is a proper
subset of s by Proposition 3.10.
Lemma 3.11 The degree of V. s/1 	 s D V.s/1 is at most d C .
Proof We imitate the proof of [7, Theorem 3]. Let s 2 S0 	 be a general point and
let s 	 Pd2 D s be the rank 1 locus of the map
s W TS0;s ˝ Os ! Ns=Pg1:
Note that the normal bundle of s splits
Ns=Pg1 D .Ns=Pg1 ˝ Os/ ˚ Ns=s D Os.d  2/˚n ˚ Os.d/˚d3:
Hence, the map  s is given by a matrix
 s D
A
B

where A is a n  . C 1/-matrix and B is a .d  3/  . C 1/-matrix. The matrix A
represents the map .s W TS;s ˝ Os ! Ns=Pg1/js and therefore has rank 1 and
is equivalent to a catalecticant matrix. Let fs; tg be a basis of H0.s; Os.1//. In an

Focal Schemes to Families of Secant Spaces to Canonical Curves
399
appropriate basis, the matrix A is of the following form
A D
0
BBBB@
td2
td3s
  
td2s
td3s
:::
td21sC1
:::
:::
td2nC1sn1 td2nsn   
sd2
1
CCCCA
D
tn1
tn1s
:::
sn1
0
BBBB@
t t1s    s
t
:::
s
:::
:::
t t1s    s
1
CCCCA
:
We see that the rank 1 locus of  s is the rank 1 locus of the following matrix
N D
t t1s    s
B

:
Since V. s/1 ¤ s by Lemma 3.10, we have
deg.V. s/1/ D deg.D1.N//  minfdegree of elements of I22.N/g   C d:
ut
Proposition 3.12 Let s 2 L be a sufﬁciently general point. Then, V. s/1 is the
union of Ds and  points which are the intersection of s D V.s/1, and the vertex
V of the scroll XL swept out by the pencil jLj.
Proof As in the proof of Proposition 2.6, one can show that the points in the support
of Ds are contained in V. s/1.
Next, we show that the vertex in s is given by a column of the matrix s. Again,
we imitate the proof of [6, Proposition 4.2]. Each column of the n  . C 1/-matrix
s is a section of the rank n vector bundle V=U ˝ Os.1/ (where U 	 V is the
afﬁne subspace representing s) corresponding to an inﬁnitesimal deformation of
s. Each section vanishes in a 1 D .d2n/-subspace of s which is a -secant
of s. Since s is 1-generic, we get a . C 1/-dimensional family of inﬁnitesimal
deformations of s induced by all columns. Hence, one column corresponds to the
deformation in the scroll XL. The corresponding section vanishes at the vertex.
ut
As in the case V.s/1 D Ds, we get the following Torelli-type theorem using
Remark 2.1.
Corollary 3.13 A Brill–Noether general canonically embedded curve C is uniquely
determined by the family . More precise, the canonical curve C is a component
of the scheme of ﬁrst- or second-order foci of the family  induced by the Brill–
Noether locus Wd.C/ and (the smooth locus of) its singular locus W1
d.C/ of
dimension at least one (equivalently d gC3
2 e  d  g  1).

400
M. Hoff
4
The First-Order Focal Map
For a general curve C and a sufﬁciently general point s 2 S, the rank one locus of
the focal map s at s is either d points or a rational normal curve. In the second case,
the focal matrix at s is catalecticant (see Corollary 3.5).
As mentioned above, the articles [6] and [7] of Ciliberto and Sernesi are the
extremal cases (d D g  1 and  D 1, respectively), where the rank one locus is
always a rational normal curve. We propose the following question.
Question 4.1 When is the focal matrix s catalecticant for a general curve C and a
sufﬁciently general point s 2 S?
We conjecture that only in the extremal cases d D g  1 and  D 1 the rank
one locus of s is a rational normal curve for a general curve C and a general point
s 2 S. For the rest of this section we explain the reason for our conjecture.
Let C 	 Pg1 be a canonically embedded curve of genus g and let L 2 W1
d.C/ be
a smooth point such that the rank one locus of the focal matrix s W TS;s ˝ Os !
Ns=Pg1 is a rational normal curve s in Pd2 for s 2 jLj sufﬁciently general. Let
XL D S
s2jLj Ds be the scroll swept out by the pencil jLj. We get a rational surface
L D
[
s2jLj gen
s 	 XL
deﬁned as in the previous section. The rational normal curve s intersects the vertex
V of XL in  D .g; d; 1/ points by Proposition 3.12. Note that the scroll XL is a
cone over P1  Ph1.C;L/1 with vertex V. Hence, projection from the vertex V yields
a rational surface in P1  Ph1.C;L/1 whose general ﬁber in Ph1.C;L/1 is again a
rational normal curve. We have shown the following proposition.
Proposition 4.2 Let C 	 Pg1 be a canonically embedded curve of genus g and
let L 2 W1
d.C/ be a smooth point such that the rank one locus of the focal matrix
s is a rational normal for s 2 jLj sufﬁciently general. Then, the image of C in
P1  Ph1.C;L/1 given by jLj  j!C ˝ L1j lies on a rational surface of bidegree
.d0; h1.C; L/  1/ for some d0.
Proof The proposition follows from the preceding discussion. We only note that the
map given by jLjj!C ˝L1j is the same as the projection of Pg1 along the vertex
V of the canonically embedded C.
ut
Example 4.3 We explain the above circumstance for a curve C of genus 8 with
a line bundle L 2 W1
6.C/. The residual line bundle !C ˝ L1 has degree 8 and
H0.C; !C ˝L1/ is three-dimensional. Let C0 be the image of C in P1 P2 given by
jLj  j!C ˝ L1j. We think of C0 ! P1 as a one-dimensional family of six points in
the plane. If our assumption of Proposition 4.2 is true, the six points lie on a conic
in every ﬁber over P1. Computing a curve of genus 8 with a g1
6 in Macaulay2
shows that these conics do not exist. Hence, our assumption of Proposition 4.2, that

Focal Schemes to Families of Secant Spaces to Canonical Curves
401
is, the rank one locus of the focal matrix s is a rational normal curve for s 2 jLj
sufﬁciently general, does not hold for a general curve.
If .g; d; 1/ D 2d  g  2  2 and d < g  1, we do not expect the existence of
such a rational surface for a curve of genus g and a line bundle of degree d as above.
Indeed, m general points in Pr do not lie on a rational normal curve if m > r C 3.
But the inequality .g; d; 1/ D 2dg2  2 implies d > .h1.C; L/1/C3. Using
our Macaulay2 package (see [3]), we could show in several examples (.g; d/ D
.8; 6/; .9; 7/; .10; 8/; .9; 6/) that the rational surface of bidegree .d0; h1.C; L/  1/
of Proposition 4.2 does not exist. This conﬁrms our conjectural behaviour of the
ﬁrst-order focal map.
Acknowledgements I would like to thank Edoardo Sernesi for sharing his knowledge about focal
schemes and for valuable and enjoyable discussions while my visit at the university Roma Tre. The
author was partially supported by the DFG-Grant SPP 1489 Schr. 307/5-2. I also thank George H.
Hitching for useful questions regarding the geometry of focal schemes.
References
1. E. Arbarello, M. Cornalba, P.A. Grifﬁths, J. Harris, Geometry of Algebraic Curves. Vol. I.
Grundlehren der Mathematischen Wissenschaften [Fundamental Principles of Mathematical
Sciences], vol. 267 (Springer, New York, 1985)
2. A. Bajravani, Focal varieties of curves of genus 6 and 8. Rend. Circ. Mat. Palermo (2) 59(1),
127–135 (2010)
3. C. Bopp, M. Hoff,
RelativeCanonicalResolution.m2 – construction of relative canonical
resolutions and Eagon-Northcott type complexes, a Macaulay2 package (2015). Available
at http://www.math.uni-sb.de/ag-schreyer/index.php/people/researchers/75-christian-bopp
4. L. Chiantini, C. Ciliberto, A few remarks on the lifting problem. Astérisque 218, 95–109
(1993). Journées de Géométrie Algébrique d’Orsay (Orsay, 1992)
5. C. Ciliberto, E. Sernesi, Singularities of the theta divisor and congruences of planes. J. Algebr.
Geom. 1(2), 231–250 (1992)
6. C. Ciliberto, E. Sernesi, Singularities of the theta divisor and families of secant spaces to a
canonical curve. J. Algebra 171(3), 867–893 (1995)
7. C. Ciliberto, E. Sernesi, On the geometry of canonical curves of odd genus. Commun. Algebra
28(12), 5993–6001 (2000). Special issue in honor of Robin Hartshorne
8. C. Ciliberto, E. Sernesi, Projective geometry related to the singularities of theta divisors of
Jacobians. Boll. Unione Mat. Ital. (9) 3(1), 93–109 (2010)
9. D. Eisenbud, Linear sections of determinantal varieties. Am. J. Math. 110(3), 541–575 (1988)
10. D. Eisenbud, J. Harris, An intersection bound for rank 1 loci, with applications to Castelnuovo
and Clifford theory. J. Algebr. Geom. 1(1), 31–59 (1992)
11. W. Fulton, Intersection Theory. Ergebnisse der Mathematik und ihrer Grenzgebiete (3) [Results
in Mathematics and Related Areas (3)], vol. 2 (Springer, Berlin, 1984)
12. G.P. Pirola, M. Teixidor i Bigas, Generic Torelli for Wr
d. Math. Z. 209(1), 53–54 (1992)
13. E. Sernesi,
Deformations of Algebraic Schemes. Grundlehren der Mathematischen Wis-
senschaften [Fundamental Principles of Mathematical Sciences], vol. 334 (Springer, Berlin,
2006)

Inductive and Recursive Freeness
of Localizations of Multiarrangements
Torsten Hoge, Gerhard Röhrle, and Anne Schauenburg
Abstract The class of free multiarrangements is known to be closed under taking
localizations. We extend this result to the stronger notions of inductive and recursive
freeness. As an application, we prove that recursively free (multi)arrangements are
compatible with the product construction for (multi)arrangements. In addition, we
show how our results can be used to derive that some canonical classes of free
multiarrangements are not inductively free.
Keywords Multiarrangement • Free arrangement • Inductively free arrange-
ment • Recursively free arrangement • Localization of an arrangement
Subject Classiﬁcations Primary 52C35, 14N20; Secondary 51D20
1
Introduction
The class of free arrangements plays a pivotal role in the study of hyperplane
arrangements. While an arbitrary subarrangement of a free arrangement need
not be free, freeness is retained by special types of subarrangements, so called
localizations, [14], [10, Thm. 4.37]. It is natural to investigate this property for other
classes of free arrangements.
For that purpose, let F, IF, RF and HIF denote the classes of free,
inductively free, recursively free and hereditarily inductively free hyperplane
arrangements, respectively (see [10, Defs. 4.53, 4.60]). Note that we have proper
T. Hoge
Institut für Algebra, Zahlentheorie und Diskrete Mathematik, Fakultät für Mathematik und
Physik, Leibniz Universität Hannover, Welfengarten 1, 30167 Hannover, Germany
e-mail: hoge@math.uni-hannover.de
G. Röhrle () • A. Schauenburg
Fakultät für Mathematik, Ruhr-Universität Bochum, 44780 Bochum, Germany
e-mail: gerhard.roehrle@rub.de; anne.schauenburg@rub.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_16
403

404
T. Hoge et al.
inclusions throughout HIF ¨ IF ¨ RF ¨ F, see [7, Ex. 2.16], [10,
Ex. 4.56], and [6, Rem. 3.7], respectively. Our ﬁrst result shows that localization
preserves each of these stronger notions of freeness.
Theorem 1.1 Each of the classes IF, RF and HIF is closed under taking
localizations.
Moreover, freeness is compatible with the product construction for arrangements
[10, Prop. 4.28]. It was shown in [7, Prop. 2.10, Cor. 2.12] that this property also
holds for both IF and HIF. Our second main result extends this property to the
class RF.
Theorem 1.2 A product of arrangements belongs to RF if and only if each factor
belongs to RF.
It can be a rather complicated affair to show that a given arrangement is induc-
tively free, see for instance [5, §5.2], [4, Lem. 4.2], and [7, Lem. 3.5]. In principle,
one might have to search through all possible chains of free subarrangements. The
notion of recursive freeness is even more elusive. In that sense, Theorem 1.1 serves
to be a very useful tool in deciding that a given arrangement is not inductively or
recursively free by exhibiting a localization which is known to lack this property.
In his seminal work [18], Ziegler introduced the notion of multiarrangements
and initiated the study of their freeness. In their ground breaking work [2,
Thm. 0.8], Abe, Terao and Wakeﬁeld proved the Addition Deletion Theorem for
multiarrangements.
The class of free multiarrangements is known to be closed under taking localiza-
tions, see Theorem 2.7. Our third main result shows that localization also preserves
the notions of inductive and recursive freeness in the setting of multiarrangements.
For this purpose, let IFM and RFM denote the classes of inductively free and
recursively free multiarrangements, see Deﬁnitions 2.18 and 2.21.
Theorem 1.3 The classes IFM and RFM are closed under taking localiza-
tions.
Theorem 1.1 follows for IF and RF from Theorem 1.3 as a special case,
cf. Remark 2.19.
It follows from [2, Lem. 1.3] that a product of multiarrangements is free if and
only if each factor is free. Armed with Theorem 1.3, we can readily extend this
further to the classes IFM and RFM .
Theorem 1.4 A product of multiarrangements belongs to IFM (resp. RFM ) if
and only if each factor belongs to IFM (resp. RFM ).
Theorem 1.2 follows from Theorem 1.4 for RFM as a special case.
In Sect. 4 we further demonstrate the versatility of Theorem 1.3 by showing
that certain multiarrangements stemming from complex reﬂection groups are not
inductively free. Among them are multiarrangements of a restricted arrangement
equipped with Ziegler’s natural multiplicity on the restriction to a hyperplane, see
Deﬁnition 2.9.

Inductive and Recursive Freeness of Localizations of Multiarrangements
405
For applications of Theorems 1.1 and 1.2 in the context of the classiﬁcation of
recursively free reﬂection arrangements, see [8, §3, Lem. 3.2].
2
Recollections and Preliminaries
2.1
Hyperplane Arrangements
Let V D K` be an `-dimensional K-vector space. A hyperplane arrangement is a
pair .A ; V/, where A is a ﬁnite collection of hyperplanes in V. Usually, we simply
write A in place of .A ; V/. Sometimes we also call A an `-arrangement if we
want to emphasize the dimension of the ambient vector space. We write jA j for the
number of hyperplanes in A . The empty arrangement in V is denoted by ˚`.
The lattice L.A / of A is the set of subspaces of V of the form H1\  \Hi where
fH1; : : : ; Hig is a subset of A . For X 2 L.A /, we have two associated arrangements,
ﬁrstly AX WD fH 2 A j X  Hg  A , the localization of A at X, and secondly,
the restriction of A to X, .A X; X/, where A X WD fX \H j H 2 A nAXg. Note that
V belongs to L.A / as the intersection of the empty collection of hyperplanes and
A V D A . The lattice L.A / is a partially ordered set by reverse inclusion: X  Y
provided Y  X for X; Y 2 L.A /.
If 0 2 H for each H in A , then A is called central. If A is central, then the
center TA WD \H2A H of A is the unique maximal element in L.A / with respect
to the partial order. We have a rank function on L.A /: r.X/ WD codimV.X/. The
rank r WD r.A / of A is the rank of a maximal element in L.A /. The `-arrangement
A is essential provided r.A / D `. If A is central and essential, then TA D f0g.
Throughout this article, we only consider central arrangements.
More generally, for U an arbitrary subspace of V, deﬁne the localization of A
at U by AU WD fH 2 A j U  Hg  A , and A U WD fU \ H j H 2 A n
AUg, a subarrangement in U. The following observations are immediate from the
deﬁnitions, cf. [10, §2].
Lemma 2.1 Let B  A be a subarrangement and Y  X in L.A /. Then we
have
(i) B \ AX D BX; and
(ii) .BX/Y D .BY/X.
Note that X and Y need not be members of L.B/.
2.2
Free Hyperplane Arrangements
Let S D S.V/ be the symmetric algebra of the dual space V of V. If x1; : : : ; x` is
a basis of V, then we identify S with the polynomial ring KŒx1; : : : ; x`. Letting Sp

406
T. Hoge et al.
denote the K-subspace of S consisting of the homogeneous polynomials of degree
p (along with 0), S is naturally Z-graded: S D ˚p2ZSp, where Sp D 0 in case p < 0.
Let Der.S/ be the S-module of algebraic K-derivations of S. Using the Z-grading
on S, Der.S/ becomes a graded S-module. For i D 1; : : : ; `, let Di WD @=@xi be
the usual derivation of S. Then D1; : : : ; D` is an S-basis of Der.S/. We say that
 2 Der.S/ is homogeneous of polynomial degree p provided  D P`
iD1 fiDi, where
fi is either 0 or homogeneous of degree p for each 1  i  `. In this case we write
pdeg  D p.
Let A be a central arrangement in V. Then for H 2 A we ﬁx ˛H 2 V with H D
ker.˛H/. The deﬁning polynomial Q.A / of A is given by Q.A / WD Q
H2A ˛H 2 S.
The module of A -derivations of A is deﬁned by
D.A / WD f 2 Der.S/ j .˛H/ 2 ˛HS 8 H 2 A g:
We say that A is free if the module of A -derivations D.A / is a free S-module.
With the Z-grading of Der.S/, also D.A / becomes a graded S-module, [10,
Prop. 4.10]. If A is a free arrangement, then the S-module D.A / admits a basis of
` homogeneous derivations, say 1; : : : ; `, [10, Prop. 4.18]. While the i’s are not
unique, their polynomial degrees pdeg i are unique (up to ordering). This multiset
is the set of exponents of the free arrangement A and is denoted by exp A .
The fundamental Addition Deletion Theorem due to Terao [12] plays a pivotal
role in the study of free arrangements, [10, Thm. 4.51].
Theorem 2.2 Suppose A ¤ ˚`. Let H0 2 A . Set A 0 D A nfH0g and A 00 D A H0.
Then any two of the following statements imply the third:
(i) A is free with exp A D fb1; : : : ; b`1; b`g;
(ii) A 0 is free with exp A 0 D fb1; : : : ; b`1; b`  1g;
(iii) A 00 is free with exp A 00 D fb1; : : : ; b`1g.
Theorem 2.2 motivates the notion of inductive freeness, cf. [10, Def. 4.53]:
Deﬁnition 2.3 The class IF of inductively free arrangements is the smallest class
of arrangements subject to
(i) ˚` 2 IF for each `  0;
(ii) if there exists a hyperplane H0 2 A such that both A 0 and A 00 belong to IF,
and expA 00  exp A 0, then A also belongs to IF.
There is an even stronger notion of freeness, cf. [10, §6.4, p. 253].
Deﬁnition 2.4 The arrangement A is called hereditarily inductively free provided
A X is inductively free for each X 2 L.A /. We abbreviate this class by HIF.
As V 2 L.A / and A V D A , A is inductively free, if it is hereditarily
inductively free. Also, HIF is a proper subclass of IF, see [7, Ex. 2.16].
Let U  V be a subspace of V. Thanks to work of Terao, [13, Prop. 5.5], [14,
Prop. 2], AU is free whenever A is, cf. [19, Thm. 1.7(i)], [10, Thm. 4.37], or [17,
Prop. 1.15].

Inductive and Recursive Freeness of Localizations of Multiarrangements
407
2.3
Multiarrangements
A multiarrangement is a pair .A ; / consisting of a hyperplane arrangement A and
a multiplicity function  W A ! Z0 associating to each hyperplane H in A a non-
negative integer .H/. Alternately, the multiarrangement .A ; / can also be thought
of as the multiset of hyperplanes
.A ; / D fH.H/ j H 2 A g:
The order of the multiarrangement .A ; / is the cardinality of the multiset
.A ; /; we write jj WD j.A ; /j D P
H2A .H/. For a multiarrangement
.A ; /, the underlying arrangement A is sometimes called the associated simple
arrangement, and so .A ; / itself is simple if and only if .H/ D 1 for each H 2 A .
Deﬁnition 2.5 Let i be a multiplicity of Ai for i D 1; 2. When viewed as
multisets, suppose that .A1; 1/ is a subset of .A2; 2/. Then we say that .A1; 1/
is a submultiarrangement of .A2; 2/ and write .A1; 1/  .A2; 2/, i.e. we have
1.H/  2.H/ for each H 2 A1.
Deﬁnition 2.6 Let .A ; / be a multiarrangement in V and let U  V be a subspace
of V. The localization of .A ; / at U is .AU; U/, where U D jAU. Note that for
X D \H2AUH, we have AX D AU and X belongs to the intersection lattice of A .
2.4
Freeness of Multiarrangements
Following Ziegler [18], we extend the notion of freeness to multiarrangements as
follows. The deﬁning polynomial of the multiarrangement .A ; / is given by
Q.A ; / WD
Y
H2A
˛.H/
H
;
a polynomial of degree jj in S.
The module of A -derivations of .A ; / is deﬁned by
D.A ; / WD f 2 Der.S/ j .˛H/ 2 ˛.H/
H
S 8 H 2 A g:
We say that .A ; / is free if D.A ; / is a free S-module, [18, Def. 6].
As in the case of simple arrangements, D.A ; / is a Z-graded S-module and thus,
if .A ; / is free, there is a homogeneous basis 1; : : : ; ` of D.A ; /. The multiset
of the unique polynomial degrees pdeg i forms the set of exponents of the free
multiarrangement .A ; / and is denoted by exp.A ; /. It follows from Ziegler’s

408
T. Hoge et al.
analogue of Saito’s criterion [18, Thm. 8] that
X
pdeg i D deg Q.A ; / D jj:
Freeness for multiarrangements is preserved under localizations. The argument
in the proof of [10, Thm. 4.37] readily extends to this more general setting.
Theorem 2.7 ([1, Prop. 1.7]) For U  V a subspace, the localization .AU; U/ of
.A ; / at U is free provided .A ; / is free.
Though constructive, the proof of Theorem 2.7 does not shed any light on the
exponents of .AU; U/ in relation to the exponents of .A ; /. We do however have
the following elementary observation.
Remark 2.8 Let .A1; 1/  .A2; 2/ be free multiarrangements with ordered sets
of exponents exp.Ai; i/ D fai;1  : : :  ai;`g for i D 1; 2. Then a1;j  a2;j
for each 1  j  `. For, let fi;1; : : : ; i;`g be a homogeneous S-basis of the free
S-module D.Ai; i/ for i D 1; 2. For a contradiction, suppose that k is the smallest
index such that a1;k > a2;k. Then the grading of both S-modules and the fact that
D.A2; 2/  D.A1; 1/ imply that 2;1; : : : ; 2;k 2 S1;1 C : : : C S1;k1. But this
shows that f2;1; : : : ; 2;`g is not algebraically independent over S, a contradiction.
We recall a fundamental construction due to Ziegler, [18, Ex. 2].
Deﬁnition 2.9 (Ziegler Restriction) Let A be a simple arrangement. Fix H0 2 A
and consider the restriction A 00 with respect to H0. Deﬁne the canonical multiplicity
 on A 00 as follows. For Y 2 A 00 set
.Y/ WD jAYj  1;
i.e., .Y/ is the number of hyperplanes in A n fH0g lying above Y. Ziegler showed
that freeness of A implies freeness of .A 00; / as follows.
Theorem 2.10 ([18, Thm. 11]) Let A be a free arrangement with exponents
exp A D f1; e2; : : : ; e`g. Let H0 2 A and consider the restriction A 00 with respect
to H0. Then the multiarrangement .A 00; / is free with exponents exp.A 00; / D
fe2; : : : ; e`g.
Note that the converse of Theorem 2.10 is false. For example, let A be a non-free
3-arrangement,cf. [10, Ex. 4.34]. Since A 00 is of rank 2, .A 00; / is free, [18, Cor. 7].
Nevertheless, Ziegler’s construction and in particular the question of a converse
of Theorem 2.10 under suitable additional hypotheses play an important role in
the study of free simple arrangements, e.g. see [15, Thm. 2.1, Thm. 2.2], [16], [3,
Cor. 4.2], [11, Thm. 2] and [17, Cor. 1.35].

Inductive and Recursive Freeness of Localizations of Multiarrangements
409
2.5
The Addition Deletion Theorem for Multiarrangements
We recall the construction from [2].
Deﬁnition 2.11 Let .A ; / ¤ ˚` be a multiarrangement. Fix H0 in A . We deﬁne
the deletion .A 0; 0/ and restriction .A 00; / of .A ; / with respect to H0 as
follows. If .H0/ D 1, then set A 0 D A n fH0g and deﬁne 0.H/ D .H/ for
all H 2 A 0. If .H0/ > 1, then set A 0 D A and deﬁne 0.H0/ D .H0/  1 and
0.H/ D .H/ for all H ¤ H0.
Let A 00 D fH \H0 j H 2 A nfH0g g. The Euler multiplicity  of A 00 is deﬁned
as follows. Let Y 2 A 00. Since the localization AY is of rank 2, the multiarrangement
.AY; Y/ is free, [18, Cor. 7]. According to [2, Prop. 2.1], the module of derivations
D.AY; Y/ admits a particular homogeneous basis fY;  Y; D3; : : : ; D`g, where Y
is identiﬁed by the property that Y … ˛0Der.S/ and  Y by the property that  Y 2
˛0Der.S/, where H0 D ker ˛0. Then the Euler multiplicity  is deﬁned on Y as
.Y/ D pdeg Y. Crucial for our purpose is the fact that the value .Y/ only
depends on the S-module D.AY; Y/.
Frequently, .A ; /; .A 0; 0/ and .A 00; / is referred to as the triple of multiar-
rangements with respect to H0.
Theorem 2.12 ([2, Thm. 0.8] Addition Deletion Theorem for Multiarrange-
ments) Suppose that .A ; / ¤ ˚`. Fix H0 in A and let .A ; /; .A 0; 0/ and
.A 00; / be the triple with respect to H0. Then any two of the following statements
imply the third:
(i) .A ; / is free with exp.A ; / D fb1; : : : ; b`1; b`g;
(ii) .A 0; 0/ is free with exp.A 0; 0/ D fb1; : : : ; b`1; b`  1g;
(iii) .A 00; / is free with exp.A 00; / D fb1; : : : ; b`1g.
Remark 2.13 We require a slightly stronger version of the restriction part of The-
orem 2.12, where we do not prescribe the exponents a priori. Let .A ; /; .A 0; 0/
and .A 00; / be the triple with respect to a ﬁxed hyperplane. It follows from [2,
Thm. 0.4] that if both .A ; / and .A 0; 0/ are free, then their exponents are as
given by parts (i) and (ii) in Theorem 2.12 (i.e., the exponents differing by 1 in one
term is automatic, cf. [10, Thm. 4.46]). It then follows from the restriction part of
Theorem 2.12 that .A 00; / is also free with exponents as in part (iii).
Next we observe that localization is compatible with both deletion and restriction
for multiarrangements.
Lemma 2.14 Let .A ; / be a multiarrangement, X 2 L.A /, and H 2 AX. Let
.A ; /, .A 0; 0/ and .A 00; / be the triple with respect to H. Then we have
(i) ..AX/0; .X/0/ D ..A 0/X; .0/X/; and
(ii) ..AX/00; .X// D ..AX/H; .X// D ..A H/X; ./X/ D ..A 00/X; ./X/.
Proof (i) The proof follows easily from Deﬁnitions 2.6 and 2.11.

410
T. Hoge et al.
(ii) Thanks to Lemma 2.1(ii), we have .AX/H D .A H/X. By deﬁnition, ./X D
 on .A H/X. So it sufﬁces to show that .X/ D  on .AX/H. Let Y 2 .AX/H.
Then Y D H \ H0 for some H0 2 AX n fHg. Consequently, .AX/Y D AY and
.X/Y D Y. Therefore, D..AX/Y; .X/Y/ D D.AY; Y/ and so by deﬁnition of the
Euler multiplicity .X/ D , as desired.
We recast Lemma 2.14 in terms of triples as follows.
Corollary 2.15 Let .A ; / be a multiarrangement, X 2 L.A /, and H 2 AX.
Let .A ; /, .A 0; 0/ and .A 00; / be the triple of .A ; / with respect to H. Then
.AX; X/, ..A 0/X; .0/X/ and ..A 00/X; ./X/ is the triple of .AX; X/ with respect
to H.
In general, for A a free hyperplane arrangement, .A ; / does not need to be
free for an arbitrary multiplicity , e.g. see [18, Ex. 14]. However, for the following
special class of multiarrangements this is always the case, [2, Prop. 5.2].
Deﬁnition 2.16 Let A be a simple arrangement. Fix H0 2 A and m0 2 Z>1 and
deﬁne the multiplicity ı concentrated at H0 by
ı.H/ WD ıH0;m0.H/ WD
(
m0
if H D H0;
1
else:
The following combines [2, Prop. 5.2], parts of its proof and Theorem 2.10.
Recall the deﬁnition of Ziegler’s multiplicity  from Deﬁnition 2.9. The proof of
Proposition 2.17(i) given in [2] depends on Theorem 2.12. We present an elementary
explicit construction for a homogeneous S-basis of D.A ; ı/.
Proposition 2.17 Let A
be a free simple arrangement with
exp A
D
f1; e2; : : : ; e`g. Fix H0 2 A , m0 2 Z>1 and let ı D ıH0;m0 be as in Deﬁnition 2.16.
Let .A 00; ı/ be the restriction of .A ; ı/ with respect to H0. Then we have
(i) .A ; ı/ is free with exponents exp.A ; ı/ D fm0; e2; : : : ; e`g;
(ii) .A 00; ı/ D .A 00; / is free with exponents exp.A 00; / D fe2; : : : ; e`g.
Proof (i) We utilize the construction from the proof of [10, Prop. 4.27]. Let ˛0 2 V
with H0 D ker ˛0 and let Ann.H0/ D f 2 D.A / j .˛0/ D 0g be the annihilator
of H0 in D.A /. Let E be the Euler derivation in Der.S/ [10, Def. 4.7]. Then
D.A / D SE ˚ Ann.H0/
is a direct sum of S-modules. Let f2; : : : ; `g be a homogeneous S-basis of
Ann.H0/. Then fE; 2; : : : ; `g is a homogeneous S-basis of D.A /. We thus
conclude that f˛m01
0
E; 2; : : : ; `g is a homogeneous S-basis of D.A ; ı/.
(ii) The equality .A 00; ı/ D .A 00; / is derived as in the proof of [2, Prop. 5.2].
The remaining statements then follow from Theorem 2.10.

Inductive and Recursive Freeness of Localizations of Multiarrangements
411
2.6
Inductive and Recursive Freeness for Multiarrangements
As in the simple case, Theorem 2.12 motivates the notion of inductive freeness.
Deﬁnition 2.18 ([2, Def. 0.9]) The class IFM of inductively free multiarrange-
ments is the smallest class of arrangements subject to
(i) ˚` 2 IFM for each `  0;
(ii) for a multiarrangement .A ; /, if there exists a hyperplane H0 2 A such that
both .A 0; 0/ and .A 00; / belong to IFM , and exp.A 00; /  exp.A 0; 0/,
then .A ; / also belongs to IFM .
Remark 2.19 ([2, Rem. 0.10]) The intersection of IFM with the class of simple
arrangements is IF.
As for simple arrangements, multiarrangements of rank at most 2 are inductively
free. For, it follows from [18, Cor. 7] that every such multiarrangement is free. We
can pick any chain of free subarrangements for such a multiarrangement starting
with ˚2. By Theorem 2.12, for any member .A ; / of such a chain, we have
exp.A 00; /  exp.A 0; 0/, so that Deﬁnition 2.18(ii) is satisﬁed and so the claim
follows by induction on jj.
Remark 2.20 Suppose that .A ; / 2 IFM . Then by Deﬁnition 2.18 there
exists a chain of inductively free submultiarrangements, starting with the empty
arrangement
˚`  .A1; 1/  .A2; 2/  : : :  .An; n/ D .A ; /
such that each consecutive pair obeys Deﬁnition 2.18(ii). In particular, jij D i for
each 1  i  n and so jj D n. Letting Hi be the hyperplane in the ith inductive
step, we have .A 00
i ; 
i / D .A Hi
i ; 
i /. In particular, .A ; / D fH1; : : : ; Hng as a
multiset. So a ﬁxed hyperplane may occur as one of the Hi for different indices i.
We frequently refer to a sequence as above as an inductive chain of .A ; /.
As in the simple case, Theorem 2.12 also motivates the notion of recursive
freeness for multiarrangements, cf. [10, Def. 4.60].
Deﬁnition 2.21 The class RFM of recursively free multiarrangements is the
smallest class of arrangements subject to
(i) ˚` 2 RFM for each `  0;
(ii) for a multiarrangement .A ; /, if there exists a hyperplane H0 2 A such
that both .A 0; 0/ and .A 00; / belong to RFM , and exp.A 00; / 
exp.A 0; 0/, then .A ; / also belongs to RFM ;
(iii) for a multiarrangement .A ; /, if there exists a hyperplane H0 2 A such that
both .A ; / and .A 00; / belong to RFM , and exp.A 00; /  exp.A ; /,
then .A 0; 0/ also belongs to RFM .
By Deﬁnitions 2.18 and 2.21, IFM  RFM .

412
T. Hoge et al.
Remark 2.22 Suppose that .A ; / 2 RFM . It follows from Deﬁnition 2.21 that
there exists a chain of recursively free submultiarrangements, starting with the
empty arrangement
˚`  .A1; 1/  .A2; 2/ : : : .An; n/ D .A ; /
such that each consecutive pair obeys Deﬁnition 2.21. In particular, jij D ji1j˙1
for each 1  i  n and jj D n. We also refer to a sequence as above as a recursive
chain of .A ; /.
2.7
Hereditary Inductive Freeness for Multiarrangements
It is tempting to deﬁne the notion of a hereditarily inductively free multiarrangement
simply by iterating the construction of the Euler multiplicity from Deﬁnition 2.11.
However, the following two examples demonstrate that the resulting multiplicity
on the restriction depends on the order in which the iteration is taking place. The
ﬁrst is an instance of a constant multiplicity while the second is an example of a
multiplicity concentrated at a single hyperplane, cf. Deﬁnition 2.16. Thus, such a
notion is only well-deﬁned with respect to a ﬁxed total order on A . We introduce
such a notion in Deﬁnition 2.25 below without further pursuing it seriously, because
of its lack of uniqueness.
Example 2.23 Deﬁne the rank 3 multiarrangement .A ; / by
Q..A ; // D x2y2.x C y/2.x C z/2.y C z/2:
Let H1
WD
ker x, H2
WD
ker.y C z/ and Y
WD
H1 \ H2. Then we have
.A H1; 1/ D
.A H1; .3; 2; 2// and .A H2; 2/ D .A H2; .2; 2; 2; 2//, by [2,
Prop. 4.1(6)]. Moreover, we have

A H1H1\H2 ; .1/12

D

A Y; .3/

6D

A Y; .4/

D

A H2H1\H2 ; .2/12

;
according to [2, Prop. 4.1(7), (6)].
Example 2.24 Let A D A .G.3; 3; 3// be the reﬂection arrangement of the unitary
reﬂection group G.3; 3; 3/ with deﬁning polynomial
Q.A .G.3; 3; 3/// D .x3  y3/.x3  z3/.y3  z3/:
Fix H1 WD ker.x  y/ 2 A , m1 2 Z>1 and let ı D ıH1;m1 be as in Deﬁnition 2.16.
Let H2 WD ker.x  z/ and Y WD H1 \ H2. Then .A H1; ı1/ D .A H1; .2; 2; 2; 2//,
owing to [2, Prop. 4.1(2)], and ..A H1/H1\H2; .ı1/12/ D .A Y; .4//, thanks to
[2, Prop. 4.1(6)]. On the other hand we have .A H2; ı2/ D .A H2; .m1; 1; 1; 1//,

Inductive and Recursive Freeness of Localizations of Multiarrangements
413
by [2, Prop. 4.1(3)] and ..A H2/H1\H2; .ı2/12/ D .A Y; .3// for m1  3, by [2,
Prop. 4.1(2)], and for m1 D 2 by [2, Prop. 4.1(4)]. Therefore,

A H1H1\H2 ;

ı112
D

A Y; .4/

6D

A Y; .3/

D

A H2H1\H2 ;

ı212
:
In view of these examples, we extend the construction of a restriction of a
multiarrangement to a hyperplane from Deﬁnition 2.11 to restrictions of arbitrary
members of L.A / as follows.
Deﬁnition 2.25 Fix a total order  on A . Let Y 2 L.A / be of rank m. Then 
descends to give a total order on AY. Then pick H1  : : :  Hm in AY minimally
with respect to  such that Y D H1 \ : : : \ Hm. One readily checks that
A Y D

: : :

.A H1/H1\H2
: : :
H1\:::\Hm :
(1)
Note that this is independent of the chosen order on fH1; : : : ; Hmg. Because
of (1), if  is a multiplicity on A , we can iterate the Euler multiplicity on
consecutive restrictions in (1) to obtain the restricted multiarrangement on A Y with
corresponding Euler multiplicity which we denote again just by  for simplicity
.A Y; / WD

: : :

.A H1/H1\H2
: : :
H1\:::\Hm ;

: : : ./ : : :

:
As demonstrated in Examples 2.23 and 2.24, the construction of .A Y; / in
Deﬁnition 2.25 depends on the chosen order of the iterated Euler multiplicities.
Nevertheless, using Lemma 2.14(ii) repeatedly, we get compatibility of restricted
multiarrangements with taking localizations.
Corollary 2.26 Fix an order on A . Let .A ; / be a multiarrangement, X 2 L.A /
and Y 2 L.AX/. Then with the notation as in Deﬁnition 2.25, we have
..AX/Y; .X// D ..A Y/X; ./X/:
Deﬁnition 2.27 Fix an order on A . The multiarrangement .A ; / is called hered-
itarily inductively free (with respect to the order on A ) provided .A Y; / is
inductively free for every Y 2 L.A /. We abbreviate this class by HIFM .
Clearly, HIFM  IFM . With the aid of Corollary 2.26 and Theorem 1.3 for
IFM , one can extend the latter to the class HIFM . Also, using Theorem 1.4,
one readily obtains the compatibility of HIFM with the product construction for
multiarrangements. We leave the details to the interested reader.

414
T. Hoge et al.
3
Proofs of Theorems 1.3 and 1.4
3.1
Inductive and Recursive Freeness of Localizations
of Multiarrangements
The following is a reformulation of Theorem 1.3.
Theorem 3.1 Let U  V be a subspace and let .A ; / be a multiarrangement
in V.
(i) If .A ; / is inductively free, then so is the localization .AU; U/.
(ii) If .A ; / is recursively free, then so is the localization .AU; U/.
Proof We readily reduce to the case where we localize with respect to a space X
belonging to the intersection lattice of A . For, letting X D \H2AUH 2 L.A /, we
have AX D AU.
(i) We argue by induction on the rank r.A /. If r.A /  3, then r.AX/  2 for
X ¤ TA , so the result follows thanks to [18, Cor. 7].
So suppose .A ; / is inductively free of rank r > 3 and that the statement holds
for all inductively free multiarrangements of rank less than r.
Since .A ; / is inductively free, there is an inductive chain .Ai; i/ of .A ; /,
where jij D i, for i D 1; : : : ; n D jj, see Remark 2.20. Then thanks to
Lemma 2.1(i), we have
AX \ Ai D .Ai/X:
(2)
For H 2 AX \ Ai, we have H  X, and so by (2) and Lemma 2.1(ii),
.AX \ Ai/H D ..Ai/X/H D

A H
i

X :
(3)
Consequently, localizing each member of the sequence .Ai; i/ at X, removing
redundant terms if necessary and reindexing the resulting distinct multiarrange-
ments, we obtain the following sequence of submultiarrangements of .AX; X/,
.A1;X; 1;X/ ¨ .A2;X; 2;X/ ¨ : : : ¨ .Am;X; m;X/ D .AX; X/;
(4)
where Ai;X is short for .Ai/X and i;X for ij.Ai/X. In particular, ji;Xj D i and
m D jXj. We claim that (4) is an inductive chain of .AX; X/.
Now let Hi 2 AX \ Ai D Ai;X be the relevant hyperplane in the ith step in the
sequence (4). Let .Ai;X; i;X/, .A 0
i;X; 0
i;X/ and .A 00
i;X; 
i;X/ be the triple with respect
to Hi.
Note that, since .Ai1;X; i1;X/ ¨ .Ai;X; i;X/, it follows from Deﬁnitions 2.5
and 2.11 that .Ai; i/, .A 0
i ; 0
i/ D .Ai1; i1/ and .A 00
i ; 
i / is the triple with respect

Inductive and Recursive Freeness of Localizations of Multiarrangements
415
to Hi. Therefore, by the construction of the chain in (4) and Lemma 2.14(i), we have

.Ai;X/0 ; 0
i;X

D

.A 0
i /X; .0
i/X

D .Ai1;X; i1;X/ :
(5)
Since .Ai; i/ is free by assumption, it follows from Theorem 2.7 that .Ai;X; i;X/
is free for each i. Consequently, it follows from Remark 2.13 and (5) that also
each restriction ..Ai;X/Hi; 
i;X/ D .A 00
i;X; 
i;X/ is free with exponents given by
Theorem 2.12(iii).
Since .A Hi
i ; 
i / D .A 00
i ; 
i / is inductively free by assumption and r.A 00
i / < r,
it follows from our induction hypothesis that the localization ..A 00
i /X; .
i /X/ is also
inductively free for each i. Thus, thanks to (3) and Lemma 2.14(ii),
.A 00
i;X; 
i;X/ D ..Ai;X/00; .i;X// D ..A 00
i /X; .
i /X/
is inductively free for each i.
Since the rank of A1;X is 1, .A1;X; 1;X/ is inductively free. Together with the fact
that each of the restrictions .A 00
i;X; 
i;X/ is also inductively free for each i, a repeated
application of the addition part of Theorem 2.12 then shows that the sequence (4) is
an inductive chain of .AX; X/, satisfying Deﬁnition 2.18, as claimed.
(ii) The argument is very similar to the one above. We argue again by induction
on the rank r.A /. If r.A /  3, then r.AX/  2 for X ¤ TA , so the result follows
by [18, Cor. 7].
So suppose .A ; / is recursively free of rank r > 3 and that the statement holds
for all recursively free multiarrangements of rank less than r.
Since .A ; / is recursively free, there is a recursive chain .Ai; i/ of .A ; /,
where jij D ji1j ˙ 1 for i D 1; : : : ; n, and .An; n/ D .A ; /, see Remark 2.22.
Since X is a subspace in V, as above, we can consider the localization .Ai;X; i;X/
of each member of the recursive chain, where again Ai;X is short for .Ai/X and i;X
for ij.Ai/X, cf. (2).
Then removing redundant terms and reindexing the resulting distinct multiar-
rangements if needed, we obtain a sequence of multiarrangements starting with the
empty arrangement
˚` ¤ .A1;X; 1;X/ ¨ .A2;X; 2;X/ ¨ : : : .Am;X; m;X/ D .AX; X/ ;
(6)
where by construction, at each stage we either increase or decrease the multiplicity
of a single hyperplane by 1.
Since .Ai; i/ is free by assumption, it follows from Theorem 2.7 that .Ai;X; i;X/
is free for each i, and so (6) is a chain of free submultiarrangements of .AX; X/.
Now ﬁx i and let H be the relevant hyperplane in the ith step in the sequence (6)
above, i.e., the multiplicity of H is either increased or decreased in this step. In
the ﬁrst instance, letting .Ai;X; i;X/, .A 0
i;X; 0
i;X/ D .Ai1;X; i1;X/, and .A 00
i;X; 
i;X/
be the triple with respect to H, we are in the situation of (5) above. On the other
hand, if the multiplicity of H is decreased in this step, then let .Ai1;X; i1;X/,

416
T. Hoge et al.
.A 0
i1;X; 0
i1;X/ D .Ai;X; i;X/, and .A 00
i1;X; 
i1;X/ be the triple with respect to H.
In the ﬁrst instance we argue as in (i) above to see that ..Ai;X/H; 
i;X/ D .A 00
i;X; 
i;X/
is free with exponents given by Theorem 2.12(iii). In the second case we argue
in just the same way to get that ..Ai1;X/H; 
i1;X/ D .A 00
i1;X; 
i1;X/ is free with
exponents given by Theorem 2.12(iii).
If .AX; X/ is inductively free, then it is recursively free and we are done. So we
may assume that .AX; X/ is not inductively free. Then in particular, the sequence (6)
is not an inductive chain. We claim that (6) is a recursive chain of .AX; X/.
Clearly, the initial part of this sequence is necessarily a chain of inductively free
arrangements (one needs to add hyperplanes ﬁrst before one can start removing
them again). Let k be maximal so that
˚` ¤ .A1;X; 1;X/ ¨ .A2;X; 2;X/ ¨ : : : ¨ .Ak;X; k;X/
(7)
is a sequence of inductively free terms in the chain (6). Then in particular,
.Ak;X; k;X/ is inductively free, hence recursively free.
Since .A 00
i ; 
i / is recursively free by assumption and r.A 00
i / < r, it follows from
our induction hypothesis that the localization ..A 00
i /X; .
i /X/ is also recursively free
for each i. Thus, thanks to Lemma 2.14(ii), ..Ai/X/00; 
i;X/ D ..A 00
i /X; .
i /X/ is
recursively free for each i.
In particular, returning to the sequence (7) and the .k C 1/-st step, where we
reduce a multiplicity for the ﬁrst time in the chain in (6), it follows from the
argument above that
exp..Ak;X/HkC1; 
k;X/  exp.Ak;X; k;X/:
Therefore, applying the deletion part of Theorem 2.12 and using Lemma 2.14(i), it
follows that

..Ak;X/0 ; .k;X/0
D

.A 0
k /X; .0
k/X

D .AkC1;X; kC1;X/
is recursively free, where the deletion is with respect to HkC1. Now iterate this
process.
The special case when   1 in Theorem 3.1 gives Theorem 1.1 for the classes
IF and RF. Armed with Theorem 1.1 for IF, we obtain the statement of
Theorem 1.1 for the class HIF.
Corollary 3.2 Let U  V be a subspace and let A be an arrangement in V. If A
is hereditarily inductively free, then so is the localization AU.
Proof As before, for X D \H2AUH, we have AX D AU and X 2 L.A /. Let
Y 2 L.AX/. Then Y  X in L.A /. Since A is hereditarily inductively free, A Y
is inductively free. So by Theorem 1.1 and Lemma 2.1(ii), we get that .AX/Y D
.A Y/X is inductively free.
Theorem 1.1 thus follows from Theorem 3.1 and Corollary 3.2.

Inductive and Recursive Freeness of Localizations of Multiarrangements
417
Remark 3.3 It is worth noting that the proof of Theorem 3.1 shows that any given
inductive (resp. recursive) chain of the ambient multiarrangement descends to give
an inductive (resp. recursive) chain of any localization.
3.2
Products of Inductively Free and Recursively Free
Arrangements
Thanks to [10, Prop. 4.28], the product of two arrangements is free if and only
if each factor is free. In [7, Prop. 2.10], the ﬁrst two authors showed that this
factorization property descends to the class of inductively free arrangements.
Let .Ai; i/ be a multiarrangement in Vi for i D 1; 2. We consider the product
.A WD A1  A2; / which is a multiarrangement in V D V1 ˚ V2 with multiplicity
 WD 1  2, see [2].
The following is just a reformulation of Theorem 1.4.
Theorem 3.4 Let .Ai; i/ be a multiarrangement in Vi for i D 1; 2. Then the
product .A ; / is inductively free (resp. recursively free) if and only if each factor
.Ai; i/ is inductively free (resp. recursively free).
Proof We just give the argument for the case of recursive freeness, the argument for
inductive freeness is identical.
The reverse implication is straightforward, cf. [7, Prop. 2.10]. For the forward
implication, assume that .A ; / is recursively free. Set X1 WD TA1 ˚ V2 and
X2 WD V1 ˚ TA2. Then both X1 and X2 belong to the intersection lattice of A , [10,
Prop. 2.14]. Note that AX1 D fH1 ˚ V2 j H1 2 A1g Š A1 and AX2 D fV1 ˚ H2 j
H2 2 A2g Š A2. It thus follows from Theorem 1.3 that both .AX1; X1/ D .A1; 1/
and .AX2; X2/ D .A2; 2/ are recursively free.
The special case of Theorem 3.4 for RFM when i  1 gives Theorem 1.2.
4
Applications to Reﬂection Arrangements
4.1
Inductive Freeness of Reﬂection Arrangements
In this section we demonstrate how Theorem 1.1 can be used to show that certain
arrangements are not inductively free.
Let W be one of the exceptional complex reﬂection groups G29, G33, or G34.
Then by [10, Tables C.10, C.14, C.15], W admits a parabolic subgroup WX of
type G.4; 4; 3/, G.3; 3; 4/, or G.3; 3; 5/, respectively. Thanks to [7, Prop. 3.2], the
reﬂection arrangement of G.r; r; `/ is not inductively free for r; `  3. By [10,
Cor. 6.28], we have A .WX/ D A .W/X and so it follows from Theorem 1.1, that

418
T. Hoge et al.
A .W/ is not inductively free in each of the three instances. This was proved in [7,
§3.1.4] by different means.
4.2
Inductive Freeness of Ziegler’s Canonical Multiplicity for
Monomial Groups
Theorem 1.3 is very useful in showing that a given multiarrangement is not
inductively free by exhibiting a suitable localization which is known to not be
inductively free. We demonstrate this in the following results.
Let A D A .W/ be the reﬂection arrangement of the complex reﬂection group
W WD G.r; r; `/ for r; `  3. Let Hi;j./ WD ker.xi  xj/ 2 A , where 1  i < j  `
and  is an rth root of unity and let Hi WD ker xi be the ith coordinate hyperplane for
1  i  `, [10, §6.4].
Using results from [7] and Theorem 1.3, we show that .A 00; / fails to be
inductively free for `  5, where  is Ziegler’s canonical multiplicity from
Deﬁnition 2.9.
In view of Proposition 2.17, we also consider a concentrated multiplicity on A .
Fix H0 2 A , m0 2 Z>1 and let ı D ıH0;m0 be as in Deﬁnition 2.16. Then, since A
is free (cf. [10, §6.3]) so is .A ; ı/, by Proposition 2.17(i). Let A 00 be the restriction
of A with respect to H0.
Proposition 4.1 Let A D A .W/ be the reﬂection arrangement of W D G.r; r; `/
for r  3; `  5. Then both .A 00; / and .A ; ı/ are not inductively free.
Proof Since W is transitive on A , without loss, we may choose H0 WD H1;2.1/ D
ker.x1  x2/. Deﬁne
X WD
\
3i<j`
Hi;j./ D
\
3i`
Hi:
Then X is of rank `  2 in L.A /.
Set Yi;j./ WD H0 \ Hi;j./ 2 A 00. Then one readily checks that for Y 2 A 00, we
have
.Y/ D
8
ˆˆ<
ˆˆ:
r  1
for Y D Y1;2./;
2
for Y D Y1;i./; Y2;i./ and 3  i  `;
1
for Y D Yi;j./ and 3  i < j  `:
(8)
According to (8), the multiplicity X of the localization ..A 00/X; X/ satisﬁes
X  1. Thus, ..A 00/X; X/ is isomorphic to the simple reﬂection arrangement
A .G.r; r; `  2//. According to [7, Prop. 3.2], the latter is not inductively free,
as `  5. Therefore, .A 00; /, is not inductively free either, thanks to Theorem 1.3.

Inductive and Recursive Freeness of Localizations of Multiarrangements
419
By deﬁnition of .A ; ı/ and [10, Cor. 6.28], we have A .WX/ D A .W/X Š
A .G.r; r; `  2// and ıX  1. Consequently, .AX; ıX/ is also isomorphic to the
simple reﬂection arrangement A .G.r; r; `2//. Again, thanks to [7, Prop. 3.2], the
latter is not inductively free, as `  5. Therefore, .A ; ı/ is not inductively free,
owing to Theorem 1.3.
Proposition 4.1 generalizes to a larger class of multiarrangements stemming from
complex reﬂection groups. Orlik and Solomon deﬁned complex `-arrangements
A k
` .r/ in [9, §2] (cf. [10, §6.4]) which interpolate between the reﬂection arrange-
ments of the complex reﬂection groups G.r; r; `/ and G.r; 1; `/. For r; `  3 and
0  k  ` the deﬁning polynomial of A k
` .r/ is given by
Q.A k
` .r// D x1    xk
Y
1i<j`
.xr
i  xr
j /;
so that A `
` .r/ D A .G.r; 1; `// and A 0
` .r/ D A .G.r; r; `//.
Again ﬁx H0 2 A , m0 2 Z>1 and let ı D ıH0;m0 be as in Deﬁnition 2.16. Then,
since A is free (cf. [10, Prop. 6.85]), so is .A ; ı/, by Proposition 2.17(i). Let A 00
be the restriction of A with respect to H0. Then .A 00; ı/ D .A 00; / is free, thanks
to Proposition 2.17(ii).
Combining results from [7] with Theorem 1.3, we show that also for these more
general arrangements .A 00; / fails to be inductively free provided `  5, 0  k 
`  3 and H0 is of the form Hi;j./.
Proposition 4.2 Let A D A k
` .r/ for r  3; `  5 and 0  k  `  3. Fix
H0 D Hi;j./ 2 A . Then both .A 00; / and .A ; ı/ are not inductively free.
Proof For k D 0, this is just Proposition 4.1. So we may assume that 1  k  `3.
We may suppose without loss that H0 WD H1;2.1/ D ker.x1  x2/. Set Yi;j./ WD
H0 \ Hi;j./ and Yi WD H0 \ Hi in A 00. Then one readily checks that for Y 2 A 00,
we have
.Y/ D
8
ˆˆˆˆ<
ˆˆˆˆ:
r C 1 .resp. r/
for Y D Y1;2./ and k  2 .resp. k D 1/;
2
for Y D Y1;i./; Y2;i./ and 3  i  `;
1
for Y D Yi;j./ and 3  i < j  `;
1
for Y D Yi and 3  i  k;
(9)
where the value of .Y/ in the ﬁrst case depends on k and the last instance only
occurs if k  3.
Deﬁne
Z WD
\
`2i<j`
Hi;j./ D
\
`2i`
Hi;

420
T. Hoge et al.
which is of rank 3 in L.A / and
X WD H0 \ Z D H0 \
0
@
\
`2i`
Hi
1
A ;
which is of rank 3 in L.A 00/. According to (9), the multiplicity X of the localization
..A 00/X; X/ satisﬁes X  1. Thus, it follows from the construction and the
hypotheses `  5 and 0  k  `3 that the localization ..A 00/X; X/ is isomorphic
to the simple reﬂection arrangementA .G.r; r; 3//. Owing to [7, Prop. 3.2], the latter
is not inductively free. Therefore, .A 00; / is not inductively free, by Theorem 1.3.
By the deﬁnition of .A ; ı/ and the fact that `  5 and 0  k  `  3, we
have ıZ  1, and so .AZ; ıZ/ is isomorphic to the simple reﬂection arrangement
A .G.r; r; 3//. So again by [7, Prop. 3.2], the latter is not inductively free. Therefore,
.A ; ı/ is not inductively free either, thanks to Theorem 1.3.
Acknowledgements We acknowledge support from the DFG-priority program SPP1489 “Algo-
rithmic and Experimental Methods in Algebra, Geometry, and Number Theory”.
References
1. T. Abe, K. Nuida, Y. Numata, Signed-eliminable graphs and free multiplicities on the braid
arrangement. J. Lond. Math. Soc. (2) 80(1), 121–134 (2009)
2. T. Abe, H. Terao, M. Wakeﬁeld, The Euler multiplicity and addition-deletion theorems for
multiarrangements. J. Lond. Math. Soc. (2) 77(2), 335–348 (2008)
3. T. Abe, M. Yoshinaga, Free arrangements and coefﬁcients of characteristic polynomials. Math.
Z. 275(3–4), 911–919 (2013)
4. N. Amend, T. Hoge, G. Röhrle,On inductively free restrictions of reﬂection arrangements.
J. Algebra 418, 197–212 (2014)
5. M. Barakat, M. Cuntz, Coxeter and crystallographic arrangements are inductively free. Adv.
Math. 229, 691–709 (2012)
6. M. Cuntz, T. Hoge, Free but not recursively free arrangements. Proc. Am. Math. Soc. 143,
35–40 (2015)
7. T. Hoge, G. Röhrle, On inductively free reﬂection arrangements. J. Reine Angew. Math. 701,
205–220 (2015)
8. P. Mücksch, On recursively free reﬂection arrangements. J. Algebra 474, 24–48 (2017)
9. P. Orlik, L. Solomon, Arrangements deﬁned by unitary reﬂection groups. Math. Ann. 261,
339–357 (1982)
10. P. Orlik, H. Terao, Arrangements of Hyperplanes (Springer, Berlin, 1992)
11. M. Schulze, Freeness and multirestriction of hyperplane arrangements. Compos. Math. 148(3),
799–806 (2012)
12. H. Terao, Arrangements of hyperplanes and their freeness I, II. J. Fac. Sci. Univ. Tokyo 27,
293–320 (1980)
13. H. Terao, Generalized exponents of a free arrangement of hyperplanes and Shepherd-Todd-
Brieskorn formula. Invent. Math. 63(1), 159–179 (1981)
14. H. Terao, Free arrangements of hyperplanes over an arbitrary ﬁeld. Proc. Jpn. Acad. Ser.
A Math. Sci. 59(7), 301–303 (1983)

Inductive and Recursive Freeness of Localizations of Multiarrangements
421
15. M. Yoshinaga, Characterization of a free arrangement and conjecture of Edelman and Reiner.
Invent. Math. 157(2), 449–454 (2004)
16. M. Yoshinaga, On the freeness of 3-arrangements. Bull. Lond. Math. Soc. 37(1), 126–134
(2005)
17. M. Yoshinaga, Freeness of hyperplane arrangements and related topics. Ann. Fac. Sci. Toulouse
Math. (6) 23(2), 483–512 (2014)
18. G. Ziegler, Multiarrangements of hyperplanes and their freeness, in Singularities (Iowa City,
IA, 1986). Contemporary Mathematics, vol. 90 (American Mathematical Society, Providence,
RI, 1989), pp. 345–359
19. G. Ziegler, Matriod representations and free arrangements. Trans. Am. Math. Soc. 320, 525–
541 (1990)

Toric Ext and Tor in polymake and
Singular: The Two-Dimensional Case and
Beyond
Lars Kastner
Abstract It is an open problem to describe the Ext and Tor groups for two torus-
invariant Weil divisors on a toric variety, using only the combinatorial data of the
underlying objects from toric geometry. We will give a survey on this description
for the case of two-dimensional cyclic quotient singularities, in particular how this
description is related with the continued fraction associated to a cyclic quotient
singularity. Furthermore, we will elaborate on the applications of these modules
and expectations of how to generalize the results to higher dimensions, highlighted
by examples.
Studying the above problems sparked software development in polymake
and Singular, heavily using the interface between the systems. Examples are
accompanied by code snippets to demonstrate the functionality added and to
illustrate how one may approach similar problems in toric geometry using these
software packages.
Keywords Toric geometry • Cyclic quotient singularities • Continued fractions •
Polymake • Singular
Subject Classiﬁcation 14M25
1
Introduction
Given an afﬁne toric variety X, it is an open question to determine all maximal
Cohen-Macaulay divisor classes in the class group Cl X from the combinatorics of
X. Choosing a torus-invariant representative D for a divisor class, we can consider
its polyhedron of global sections PD (see [9, (4.3.2)]). The torus invariant global
L. Kastner ()
Institut für Mathematik, Technische Universität Berlin, Str. des 17. Juni 136, 10623 Berlin,
Germany
e-mail: kastner@math.tu-berlin.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_17
423

424
L. Kastner
sections of O.D/ correspond to the lattice points of PD. The tail cone of PD is the
weight cone of X. Thus, it gives rise to a fractional ideal HD over the coordinate ring
R of X, which is isomorphic to the global sections of the coherent sheaf O.D/. The
divisor D being maximal Cohen-Macaulay is the same as HD being maximal Cohen-
Macaulay over R, which is a problem of multigraded or combinatorial commutative
algebra.
Instead of using the criterion for maximal Cohen-Macaulayness of a module in
terms of depth and dimension, we will use the following homological criterion of
Yoshino [27, Cor 1.13] as a deﬁnition:
Deﬁnition 1.1 A ﬁnitely generated R-module A, where R is a Cohen-Macaulay ring
with canonical module !R, is Maximal Cohen-Macaulay (MCM), if and only if
Exti.A; !R/ D 0 8i > 0:
In our setting, for R being the coordinate ring of a toric variety X, the module !R
arises from a certain torus invariant divisor K D KX, i.e. we have !R D HK. The
coordinate ring R itself is Cohen-Macaulay due to Hochster’s theorem.
The coordinate ring R of X has a grading by M, the character lattice of the torus
acting on X, corresponding to the torus action on X. The divisors K and D being
torus-invariant means that the modules HK and HD are M-graded as well. At this
point it is important to note that for any Weil divisor D, the module HD is ﬁnitely
generated. Hence, the functor HomR.HD; / maps M-graded modules to M-graded
modules, for torus-invariant D. Thus, the modules Exti
R.HD; HK/ are M-graded as
well.
There are two approaches for computing Ext.A; B/: We may resolve A projec-
tively, apply Hom.; B/ to the free resolution and then take cohomology. Or, we
resolve B injectively, apply Hom.A; / and take homology of the resulting complex.
Here, we will discuss the ﬁrst variant, for the following reasons: First, for the
M-graded module, we can assume its free resolution to be M-graded as well. In
particular, the kernel of every differential is itself isomorphic to a direct sum of other
divisorial M-graded ideals. For X being Gorenstein, Eisenbud [11] demonstrated
that the minimal free resolution of MCM modules over R becomes periodic of length
2. With the previous statement this implies a certain recursion of the Ext-modules.
Applying this to our situation it seems possible to check Theorem 1.1 in ﬁnite time,
at least in the Gorenstein setting.
In this article we will mainly deal with the ﬁrst class of afﬁne toric sin-
gularities, quotients of C2 by a ﬁnite group action, so-called cyclic quotient
singularities (CQS). Combinatorially these arise from two-dimensional cones in
two-dimensional space. Previous work by Wunram [25, 26] states a property for
a Weil divisor to be special MCM and gives a theorem for a divisor to satisfy this
condition. Recent work by Wemyss and Iyama gives a condition for a Weil divisor
(or module) to be special MCM in terms of Ext. The idea behind the special MCM
property in the setting of CQS is to extend the McKay correspondence to the non-
Gorenstein case [24].

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
425
We will survey the results of [18, 19], to give a combinatorial understanding
of the results of Wunram. On a CQS, every divisor is MCM, which reﬂects the
fact that every Weil divisor is Q-Cartier. The combinatorial construction for Ext
gives a new interpretation for this. Furthermore one can generalize the previously
mentioned periodicity observation of Eisenbud to the non-Gorenstein case. Using
this generalization one can extend the description of Buchweitz [7] of the Yoneda
product in the Ext-algebra of the MCM-modules to non-Gorenstein CQS. Many of
the results presented for CQS can be applied to afﬁne toric varieties that are products
of An with a CQS as well.
Cyclic quotient singularities have several properties that general afﬁne toric
varieties do not share. For example, their deﬁning cone is simplicial and the
singularity of the variety is isolated. Gorenstein CQS form a special subclass of
all CQS and we will elaborate on the implications of this property. In the end, we
will give two examples that elaborate on the pitfalls when trying to extend the results
to more general afﬁne toric varieties.
Special emphasis will be put on the accompanying software development in
polymake [14] and Singular [10]. One main goal of the priority program SPP1489
was to build interfaces between these software packages. It is this interface that
made the above research and discoveries possible. The general purpose portions of
the code have been migrated to the polymake core, the other methods can be found
in the appendix of [18].
The structure of the paper is as follows: We start by giving the general deﬁnitions
from the toric world needed to understand the computational problem. After
introducing cyclic quotient singularities, we give the full combinatorial description
of Exti and Tori of two torus-invariant Weil divisors on a CQS. The connection of
CQS with continued fractions gives a recursive algorithm for computing Ext1. This
is followed by a description of the involved software packages and an overview of
the implementation. We conclude by discussing two examples in dimension three, in
order to provide intuition for which results might generalize to higher dimensions.
2
Preliminaries
In this section we will revise the ingredients needed from toric geometry. We will
follow the notation of Cox et al. [9] closely.
Let N be a lattice and deﬁne M WD HomZ.N; Z/ to be the dual lattice. Then we
deﬁne the associated Q-vector space NQ to be N ˝Z Q. Analogously we deﬁne MQ.
We will denote the pairing between N and M by h; i. The extension of the pairing
to NQ and MQ will be denoted by the same symbols. We will denote elements of N
and NQ in round brackets .: : :/ and elements of M and MQ in square brackets Œ: : :.
Let   NQ be a convex polyhedral cone, then the associated semigroup ring
and toric variety are
R WD CŒ_ \ M and TV./ WD Spec R;

426
L. Kastner
where _ denotes the dual cone of , i.e.
_ WD fu 2 MQ j hu; vi  0 8v 2 g:
This means that the rays of _ are the inner facet normals of . Note that throughout
this paper, we assume  to be pointed and full-dimensional, implying the same
for _.
Example 2.1 Take for example the cone  generated by the four rays
.0; 0; 1/; .0; 1; 0/; .1; 0; 1/ and .1; 1; 0/:
Then the dual cone _ is generated by the following four rays
Œ1; 0; 0; Œ1; 1; 0; Œ1; 0; 1 and Œ1; 1; 1:
These four primitive ray generators also form the Hilbert basis of the cone _. If
we label them with the variable names w; x; y and z, then TV./ is the hypersurface
in A4 given by the equation wz  xy. It is the cone over P1  P1.
Due to the orbit-cone correspondence [9, 3.2], codimension c faces of 
correspond to dimension c orbits of TV./. Hence the rays of  give us exactly
the orbits of codimension 1. If  is given as a cone over the rays 0; : : : ; n, then a
torus-invariant Weil divisor D is a formal linear combination of the closures of the
orbits corresponding to these rays:
D D
n
X
iD0
ai  orb i; ai 2 Z:
To such a divisor we can associate its polyhedron of global sections:
PD WD fu 2 MQ j hu; ii  ai 8i D 1; : : : ; ng:
This is a polyhedron with tail cone _ and it gives rise to the R-module
HD WD
M
u2PD\M
C  u:
The R-module HD is M-graded and isomorphic to the global sections of O.D/.
Since we are working on an afﬁne variety and the sheaf associated to a Weil
divisor is coherent, computing Exti
TV./.O.D/; O.D0// is the same as computing
Exti
R.HD; HD0/. Thus, from now on we will write Exti.D; D0/. Note that sometimes
0 will appear as a divisor, meaning that H0 D R.
Most of the modules throughout this paper are completely determined through
their support, i.e. they are M-graded and determined by their non-zero degrees in M.

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
427
Hence we will use the following short-hand notation from [21]. Let P  MQ be a
subset, then we deﬁne
CfPg WD
M
u2P\M
C  u;
with the R-multiplication
xw  u WD
(
uCw
u C w 2 P
0
else
;
where w 2 _ \ M and xw denotes the corresponding monomial in R.
Note that additional conditions on P are necessary to make this a module, but
we will not go further into detail. Furthermore, note that P0 ¨ P  MQ does not
necessarily imply that CfP0g is a submodule of CfPg, due to CfP0g having torsion
elements that CfPg does not have.
2.1
Two-Dimensional Cyclic Quotient Singularities
Two-dimensional cyclic quotient singularities arise as quotients of C2 by a ﬁnite
cyclic group Z=nZ acting via
  0
0 q

;
where  is a primitive n-th root of unity and q is a positive integer which is coprime
to n. We observe that we may assume q < n.
Deﬁnition 2.2 As toric varieties, CQS arise from N D Z2, with the cones  and
_ given as
 D conef.1; 0/; .q; n/g and _ D conefŒ0; 1; Œn; qg:
Here we identify M D Z2 and pick the standard scalar product as the pairing of N
and M. The CQS X is then the toric variety TV./.
CQS are closely related to continued fraction expansions.
Deﬁnition 2.3 Let c1; : : : ; cn
2
Z>0, then the continued fraction expansion
Œc1; : : : ; cn is deﬁned as
Œc1; : : : ; cn WD c1  1=Œc2; : : : ; cn and Œcn WD cn:

428
L. Kastner
For a CQS, there are two relevant continued fractions, namely
a WD Œa1; : : : ; as D
n
n  q and c WD Œc1; : : : ; cr D n
q:
Continued fractions as a tool for studying cyclic quotient singularities were
introduced by Riemenschneider [22], in order to describe their equations. Work of
Christophersen [8] and Stevens [23] combinatorially describes the versal deforma-
tion of a CQS, based on continued fractions. This has in turn been used by Altmann
[2] to describe the so-called p-resolutions introduced by Kollár and Shepherd-
Barron [20] on a CQS and by Ilten [16] to compute Milnor number of a CQS.
Recent work by Altmann and Kollár [3] studies certain inﬁnitesimal deformations of
CQS, called qG-deformations, in terms of continued fractions, among other things,
with the aim to understand the inﬁnitesimal structures of different versions of their
moduli space.
We will mainly work with the cone _, which is connected to the continued
fraction a in the following way: Let b0; : : : ; brC1  _ \ M be the Hilbert basis of
the cone _, sorted with respect to the ﬁrst coordinate, then we have the following
equations:
bi1 C biC1 D ai  bi 8i D 1; : : : ; r:
(1)
As observed before, we have b0 D Œ0; 1 and brC1 D Œn; q. Together with the above
equations this already completely determines the Hilbert basis. Furthermore, since
we assume q < n, we have b1 D Œ1; 1.
Example 2.4 Pick n D 8 and q D 5, then we can access the continued fraction a
and the Hilbert basis of _ in polymake in the following way:
fulton > $cqs = new CyclicQuotient(N=>8, Q=>5);
fulton > print $cqs->DUAL_CONTINUED_FRACTION;
3 3
fulton > print $cqs->WEIGHT_CONE->HILBERT_BASIS;
8 5
0 1
3 2
1 1
One notes that the Hilbert basis is not yet sorted. After sorting it, we see the
equations coming from the continued fraction a.

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
429
The cone _ looks as in the following picture, where the dots indicate its Hilbert
basis:
.
The class group of a CQS X can be computed via the following exact sequence:
(2)
In particular, the class group is ﬁnite and hence, there are only ﬁnitely many
divisorial ideals in R up to isomorphism. In conjunction with the following theorem
this shows that we only need to describe Ext1.
Theorem 2.5 ([18, Thm 5.16]) Given a CQS X with class group Cl X Š Z=nZ and
two torus-invariant Weil divisors D and D0 on X, there is a quiver Q with vertices
in Cl X such that
ExtiC1
R
.D; D0/ Š
M
ŒG!D2Q
Exti
R.G; D0/ for all i  1:
In words, ExtiC1 can be computed from Exti by taking the sources of the incoming
arrows to D in the quiver Q. One needs to be a little careful, since this quiver actually
at ﬁrst has vertices all of the torus-invariant Weil divisors. If one identiﬁes divisors
via linear equivalence and instead adds labels on the arrows for the grading, one gets
the precise M-graded version of the above theorem.
If X is Gorenstein, i.e. a hypersurface, then the quiver consists of disjoint cycles
of length at most 2, resembling the previously mentioned 2-periodicity discovered
by Eisenbud. Thus the generalization of this discovery for CQS is the quiver Q. It
is not clear how to proceed in higher dimensions. First of all the class group may be
inﬁnite. Still one will obtain a quiver as the right object in some cases, for example
for the cone over P1  P1, see Sect. 5. This is the hypersurface case again, but the
quiver we describe in this case can deal with all torus-invariant divisors, instead of
just treating the MCM classes. The drawback is that it has inﬁnitely many vertices.
Considering examples like Sect. 6, a quiver does not sufﬁce.

430
L. Kastner
3
Ext1
As previously discussed, it is enough to combinatorially describe Ext1 on a CQS.
This section will give the combinatorial description together with its connection to
continued fractions. This connection combinatorially describes how Ext1 changes
along the ﬂat and proper maps of certain toric blow-ups. It has yet to be understood
in terms of algebraic geometry.
Let us start by giving the combinatorial description of Ext1. First we deﬁne
an invariant of a torus invariant divisor D, derived from its polyhedron of global
sections:
Deﬁnition 3.1 For a torus-invariant divisor D, denote by G.D/ the set of lattice
points associated to the minimal generators of HD and deﬁne
E.D/ WD int.PD/n
[
u2G.D/
u C int._/:
The set E.D/ consists of the interior of PD where we cut off the interior of _ shifted
to the generators of HD. By construction it contains all generators except the right-
and leftmost ones.
Example 3.2 We will illustrate what the sets E./ look like for two divisors from
our running example:
[4,3]
[8,5]
[3,2]
[8,5]
The ﬁrst divisor is 4  orb.0/ and the second is 3  orb.0/ where 0 D .1; 0/
denotes the zeroth ray of . The dashed line on the lower and leftmost boundary of
the sets indicate that these do not belong to the sets E./.
At this point it is necessary to note that every Weil divisor is Q-Cartier on a CQS.
For the torus invariant ones this means that their polyhedron of global sections is a
shift of _ by a rational vector which we will denote by the symbol ./, i.e. we have
the equation
PD D .D/ C _  MQ;

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
431
with the summation being the Minkowski sum of a rational vector and a cone.
A divisor is trivial if and only if its vertex ./ is in the lattice M.
This can then be used directly to compute Ext1.D; D0/ of two torus-invariant Weil
divisors D and D0 on X:
Theorem 3.3 ([18, Prop 6.8]) For two Weil divisors D and D0 deﬁne
ext.D; D0/ WD .E.D/  .D0//:
Then
Ext1.D; D0/ D Cfext.D; D0/g:
In general this can be used to compute Ext1 for non-torus-invariant Weil divisors as
well. In this case the resulting module will not necessarily be graded, so the result
is only unique up to non-canonical isomorphism.
Since the CQS X has an isolated singularity at the origin, the M-graded
R-modules Ext1
R.D; D0/ will actually be ﬁnite dimensional as C-vector spaces.
Choose the divisors
Ei WD i  orb.0/; i D 1; : : : ; n ;
where 0 D .1; 0/ denotes the zeroth ray of , as a system of representatives for
the class group Cl X of X. We deﬁne the following matrix E containing all possible
C-dimensions of Ext1:
E WD .eij D dimC Ext1
R.Ei; KX  Ej//i;jD1;:::;n:
Example 3.4 We can compute the matrix E from n and q in the following way with
polymake:
fulton > $cqs = new CyclicQuotient(N=>8, Q=>5);
fulton > print $cqs->EXT1_MATRIX;
2 2 1 2 2 1 1 0
2 2 1 2 2 1 1 0
1 1 1 1 1 0 0 0
2 2 1 3 2 1 1 0
2 2 1 2 2 1 1 0
1 1 0 1 1 0 0 0
1 1 0 1 1 0 1 0
0 0 0 0 0 0 0 0
One can already see that this matrix is very structured: It is symmetric and seems
to repeat itself.

432
L. Kastner
Before we discuss the recursive way to compute this matrix, let us have a look
at some other properties. First of all, it is symmetric and one can ask, whether this
is always the case. In particular, this may not only be a symmetry of E , but even an
isomorphism of Ext1-modules. Using the incidence matrix I of the quiver Q, one
can compute the dimensions of Extn taking I n1 E , using the recursive description
of Extn from Theorem 2.5. If we deﬁne the matrix T for Tor1 in almost the same
way
T
WD .tij D dimC TorR
1.Ei; Ej//i;jD1;:::;n;
we observe almost the same structure and arrive at the equation I 2  E D T .
Using the combinatorial description of Ext1 and polymake one then checks these
conjectures for 0 < q < n  100 and arrives at the following statements whose
proofs can be found in [18]:
Theorem 3.5 ([18, 6.2, 7.2]) For any two torus-invariant Weil-divisors D and D0
on a cyclic quotient singularity X one has
dimC Ext1.D; 0/ D #fminimal generators of HDg  2 for D 6D 0
Ext1.D; K  D0/ D Ext1.D0; K  D/
Ext3.D; K  D0/ D .Tor1.D; D0//_
Exti.D; K/ D 0 8i > 0;
where we assume D to be non-trivial for the ﬁrst equation, K denotes the
canonical divisor on X and ./_ denotes the Matlis dual, i.e. Hom.; E.C// the
homomorphisms into the injective hull of C over R.
The ﬁrst equation is exactly the desired reformulation of Wunram’s theorem. His
theorem classiﬁed the special MCM divisors as those with exactly two generators.
Using the criterion of Iyama and Wemyss that D is special MCM if and only if
Ext1.D; 0/ D Ext1.HD; R/ D 0;
we see that the ﬁrst equation connects these two statements. Furthermore, we
can observe, what happens in the Gorenstein case: Here, every non-trivial HD is
generated by exactly two elements, i.e. every divisor is special MCM. The special
MCM divisors correspond 1-1 to the exceptional curves in the minimal resolution
of the singularity [24–26].
The last equation states that all Weil divisors are MCM and combinatorially
reformulates a theorem of Bruns and Gubeladze that all Q-Cartier divisors are MCM
[5, Cor. 6.68].
Assume now that the cone _ has the Hilbert basis HB._/
b0 D Œ0; 1; b1 D Œ1; 1; : : : ; bs D ŒQn; Qq; bsC1 D Œn; q:

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
433
From this we build two other cones Q_ and _0 determined by their Hilbert bases
HB.Q_/ D fb0; b1; : : : ; bsg;
HB..0/_/ D fb0; b1; : : : ; bsC1  bsg:
That means we have the following chains of inclusions:
Q_  _  .0/_ and Q    0:
Looking at the Hilbert bases, we obtain the following two continued fractions
associated to the new CQS:
Qa WD Œa1; : : : ; as1 and a0 WD Œa1; : : : ; as  1:
Here we make the convention that
Œa1; : : : ; as; 1 D Œa1; : : : ; as  1;
i.e. if the last entry of a continued fraction is 1, we can compress this continued
fraction. Furthermore we say that
Œ D Œ1 D 0
and we say that this is the continued fraction associated to X D A2
C.
If we consider E as a function taking a continued fraction to a matrix, we can
state the following algorithmic theorem:
Theorem 3.6 ([18, Thm 6.26]) The matrix E .a/ is completely determined by the
matrices E .Qa/ and E .a0/. This yields a recursive algorithm for computing E .
We omit the details and illustrate this theorem for an example instead.
Example 3.7
0
BBBBBBBBBBB@
2 2 1 2 2 1 1 0
2 2 1 2 2 1 1 0
1 1 1 1 1 0 0 0
2 2 1 3 2 1 1 0
2 2 1 2 2 1 1 0
1 1 0 1 1 0 0 0
1 1 0 1 1 0 1 0
0 0 0 0 0 0 0 0
1
CCCCCCCCCCCA
D
0
BBBBBBBBBBB@
1 1 1 1 1 1 1 0
1 1 1 1 1 1 0 0
1 1 1 1 1 0 0 0
1 1 1 1 0 0 0 0
1 1 1 0 0 0 0 0
1 1 0 0 0 0 0 0
1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0
1
CCCCCCCCCCCA
C
0
BBBBBBBBBBB@
1 1 0 1 1 0 0 0
1 1 0 1 1 0 1 0
0 0 0 0 0 0 0 0
1 1 0 2 2 1 1 0
1 1 0 2 2 1 1 0
0 0 0 1 1 0 0 0
0 1 0 1 1 0 1 0
0 0 0 0 0 0 0 0
1
CCCCCCCCCCCA
:
The matrix on the left is E .Œ3; 3/. The upper left block in the right-most matrix
is E .Œ3/ and the lower right block is E .Œ3; 2/. One can already guess how the

434
L. Kastner
non quadratic blocks arise as submatrices of the bigger quadratic block. In general
the non-quadratic blocks are always determined by the bigger of the two quadratic
blocks. The smaller quadratic block determines a smaller part of the non-quadratic
blocks and on this part the two quadratic blocks have to agree.
This theorem is proven by choosing certain systems of representatives for the
class groups of all three involved CQS and then connecting the sets ext.; / \ M
for all three CQS. Thus there is actually a stronger version of this theorem that
recursively constructs the support ext.; / of the module Ext1.; /. The algebro-
geometric interpretation would be that these CQS are connected via blow-ups and
we have a combinatorial description on how Ext1 should behave on these blow-ups.
If we think of the divisors Ei previously introduced as a system of representatives
for the class group X, then one notes that the lattice points
.ext.Ej; E1/ \ M/ [ fŒn; qg; j D 1; : : : ; n;
corresponds exactly to the minimal homogeneous generators of HEj. This is a
generalization of the equations of Eq. (1) giving us similar relations for the
generators of a divisorial ideal.
4
polymake and Singular
For computations in toric geometry one needs software for both combinatorics and
algebraic geometry. Of course every problem can be formulated purely algebraic,
but then we would lose the advantage that the combinatorial nature of toric varieties
gives us. Not only does it vastly increase performance of algorithms, it also provides
us with a new understanding of our problem.
For example the algorithm for ﬁnding a Hilbert basis of a cone is the same
as computing the integral closure of a semigroup ring spanned by monomials
corresponding to the primitive ray generators of the cone in the polynomial ring.
Using Normaliz or 4ti2 we can ﬁnd Hilbert bases with several hundred elements.
On the algebraic side this corresponds to a ring that is the quotient of a polynomial
ring with the same amount of variables, i.e. several hundred, a setting which makes
computer algebra systems break instantly.
For the combinatorial side we chose the software framework polymake [14].
It already comes with a huge bulk of code for toric geometry in the application
fulton. Furthermore it has an interface to Singular, the computer algebra
system of our choice. In particular, it allows executing any Singular command via
the singular_eval method. Furthermore the method singular_get_var
allows us recovering certain kinds of variables, such as integers, vectors of integers
and matrices of integers.
This section will elaborate on how one can use these methods in a proof of
concept style for our particular problem of computing Ext and Tor of two Weil
divisors on a toric variety.

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
435
4.1
polymake
The software framework polymake focuses on combinatorial problems. The
objects of interest are matroids, graphs, cones and fans, polytopes and polyhedral
complexes. It provides a large pool of instruments for the combinatorial parts of
algebraic geometry, such as tropical geometry and toric geometry. The interpreter
language of polymake is perl. Optionally can write and attach C++ code, in order
to increase performance amongst other things.
Many computations are outsourced via interfaces to other software. For example
dualising cones is done via lrs or cdd [4, 12]. Computing the Hilbert basis is done
by 4ti2 or Normaliz [6, 28].
The main application for toric geometry is the application fulton named after
the famous book by Fulton on toric varieties [13]. Another application of interest
for us is the application ideal. This application comes to life when polymake
is build with the Singular library version. Then one can use the object ideal from
this application and all computations with ideals will be done in the background by
Singular.
4.2
Singular
Singular is one of the leading computer algebra systems. It allows custom
monomial orders when deﬁning a ring and even computes with local rings. This
makes it interesting for tropical geometry. Recently new interfaces to GFan [17]
for tropical geometry and to polymake have been developed by Yue Ren from
Kaiserslautern.
In our setting we will use Singular for the commutative algebra side of our
problem. Let us give an example code snippet:
LIB "homolog.lib";
ring r = 0,(w,x,y,z),dp;
ideal toric = wy-xz;
qring q = std(toric);
ideal d1 = w3, w2x, wx2, x3;
ideal d2 = x2, xy, y2;
module H = Ext(5,syz(d1), syz(d2));
H = std(H);
dim(H);
vdim(H);
Here, we ﬁrst load the Singular library homolog.lib for homological algebra
[15]. Then we create the toric ring of the hypersurface singularity of the cone over
P1  P1, deﬁne to divisorial ideals in it and ﬁnally compute Ext5 of these ideals.

436
L. Kastner
This is the kind of code snippets that polymake will automatically create and
run in the background. One advantage is that Singular will continue running in the
background, so the objects stay alive and e.g. the standard basis of the toric ideal
does not have to be recomputed every time we want to determine a dimension of an
Ext-module.
4.3
Interfacing polymake and Singular
At this point most objects from commutative algebra only make sense for Singular.
There is an “ideal” object in polymake, but quotient rings and modules only exist
on the Singular side. Since Singular will do the calculations, all polymake needs
to know are the names of the objects, so it can autogenerate the Singular code which
is then executed by the singular_eval command. Let us illustrate this in one
example:
object_specialization
NormalToricVariety::AffineNormalToricVariety {
property SINGULAR_TORIC_RING : String;
property DIVISOR {
property SINGULAR_IDEAL : String;
property SINGULAR_SYZYGIES : String;
}
}
Here we add properties to afﬁne normal toric varieties and divisors on these
in polymake. All of the properties are Strings representing the names of these
properties in Singular. The afﬁne toric variety now has the name of its quotient
ring in Singular and a divisor knows the name of its ideal and the syzygies thereof.
These properties are computed via relatively straight forward rules, for example 4ti2
can compute the binomial exponents of the toric ideal of a cone and turning these
into a string which is executed in Singular, we get SINGULAR_TORIC_RING.
Let us focus on the problem at hand and write a method computing the dimension
and vector space dimension of an arbitrary Exti-module as follows:
user_method
singular_exti_dimension( $ , TDivisor, TDivisor){
my $toric_variety = $_[0];
my $i = $_[1];
my $divisor1 = $_[2];
my $divisor2 = $_[3];
my $ringname = $toric_variety->SINGULAR_TORIC_RING;
my $syzygies1 = $divisor1->SINGULAR_SYZYGIES;

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
437
my $syzygies2 = $divisor2->SINGULAR_SYZYGIES;
singular_eval("setring r_".$ringname.";");
load_singular_library("homolog.lib");
singular_eval("module M =
Ext(".$i.", syz_".$syzygies1.",
syz_".$syzygies2.");");
singular_eval("M = std(M);");
singular_eval("int d = dim(M);");
singular_eval("int vd = vdim(M);");
return new Vector(singular_get_var("d"),
singular_get_var("vd"));
}
This method gets the integer i and two toric divisors as input. The ﬁrst seven
lines extract the necessary variables. Then we switch to Singular, make sure the
right ring is set and compute Exti. Afterwards we extract the dimension and vector
space dimension via singular_get_var.
5
Cone over P1  P1
This section continues the example introduced in Theorem 2.1. The cone  is
obtained as the cone over a square at height one (with a non-standard height
function). The resulting singularity X is Gorenstein and isolated. The class group
of this singularity is Z. We discuss this example to demonstrate why we hope for
similar structures in higher dimensions as in the CQS case.
The following code snippet sets up this example in polymake and returns some
Ext and Tor dimensions:
$c = new Cone(INPUT_RAYS=>[[1,0,0],[1,0,1],
[1,1,0],[1,1,1]]);
$dc = new Cone(INPUT_RAYS=>$c->FACETS);
$tv = new NormalToricVariety($dc);
print $tv->GORENSTEIN; # Is Gorenstein
$ccoeff = new Vector(-1,-1,-1,-1);
$div1Coeff = new Vector(7,-1,-1,-1);
$div1 = $tv->add("DIVISOR", COEFFICIENTS=>$div1Coeff);
$canonical = $tv->add("DIVISOR",
COEFFICIENTS=>$ccoeff);
$div2Coeff = new Vector(-5,0,0,0);
$div2 = $tv->add("DIVISOR", COEFFICIENTS=>$div2Coeff);
$kmd1 = $tv->add("DIVISOR",
COEFFICIENTS=>$ccoeff - $div1Coeff);
$kmd2 = $tv->add("DIVISOR",
COEFFICIENTS=>$ccoeff - $div2Coeff);
print $tv->singular_exti_dimension(2, $div1, $kmd2);
print $tv->singular_exti_dimension(2, $div2, $kmd1);
print $tv->singular_exti_dimension(3, $div2, $kmd1);

438
L. Kastner
print $tv->singular_exti_dimension(3, $div1, $kmd2);
print $tv->singular_exti_dimension(4, $div1, $kmd2);
print $tv->singular_exti_dimension(4, $div2, $kmd1);
print $tv->singular_tori_dimension(1, $div2, $div1);
One observes that the last three lines yield the same output. Just as the two pairs
of lines before these. This indicates a 2-periodicity for Ext, as well as the following
relation between Ext and Tor
dimC ExtiC3.D; K  D0/ D dimC Tori.D; D0/ for i > 0
in this case. Apparently one can connect ExtiCd and Tori in certain settings, where d
denotes the dimension of the toric variety. Using Singular, we realize that the only
two non-trivial MCM divisor classes are represented by
D1 WD Œ1; 0; 0; 0 and D2 WD Œ0; 1; 0; 0;
In the class group these correspond to ˙1. Using Singular to take a closer look at
the free resolutions of the divisorial ideals, we realize that for any D 2 Cl X there is
a short exact sequence
0 !
M
n<1
Di ! Rn ! HD ! 0;
where i is either 1 or 2 and R denotes the coordinate ring of X. In particular, the
syzygies of HD1 are HD2 and vice versa, once more demonstrating the 2-periodicity
observed by Eisenbud. In terms of Theorem 2.5, we see that all free resolutions are
encoded in an inﬁnite quiver with maximal cycle length 2.
6
Cone over a Trapezoid
In this example the cone _ is the cone over a trapezoid height one, yielding a
Hilbert basis of _ with ﬁve elements. The resulting singularity X is isolated, but
not Gorenstein. We will give a code snippet and discuss the output.
$c = new Cone(INPUT_RAYS=>[[1,0,1],[1,1,0],[1,2,0],
[1,1,1],[1,0,2]]);
$dc = new Cone(INPUT_RAYS=>$c->FACETS);
$tv = new NormalToricVariety($dc);
$ccoeff = new Vector(-1,-1,-1,-1);
$div1Coeff = new Vector(7,-1,-1,-1);
$div1 = $tv->add("DIVISOR", COEFFICIENTS=>$div1Coeff);
$canonical = $tv->add("DIVISOR", COEFFICIENTS=>$ccoeff);
$div2Coeff = new Vector(-5,0,0,0);
$div2 = $tv->add("DIVISOR", COEFFICIENTS=>$div2Coeff);

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
439
$kmd1 = $tv->add("DIVISOR",
COEFFICIENTS=>$ccoeff - $div1Coeff);
$kmd2 = $tv->add("DIVISOR",
COEFFICIENTS=>$ccoeff - $div2Coeff);
print $tv->singular_exti_dimension(2, $div1, $kmd2);
print $tv->singular_exti_dimension(2, $div2, $kmd1);
print $tv->singular_exti_dimension(3, $div2, $kmd1);
print $tv->singular_exti_dimension(3, $div1, $kmd2);
print $tv->singular_exti_dimension(4, $div1, $kmd2);
print $tv->singular_exti_dimension(4, $div2, $kmd1);
print $tv->singular_tori_dimension(1, $div2, $div1);
The output one gets, shows that the two Ext2 have different dimensions, a hint
that higher Ext might not be symmetric as well, thereby obliterating the hope for a
connection of Ext and Tor. This is made even clearer by the last three lines. Even
though one of the two Ext-modules has the same dimension as the Tor-module,
one cannot really hope for an isomorphism of modules, since Tor is symmetric and
would immediately imply a symmetry of Ext as well. This is interesting, since being
Gorenstein did not play a role for the connection of Ext and Tor in the CQS case.
7
Conclusion
We will conclude this survey with a code sample: Take the hexagon singularity,
which has been introduced and discussed exhaustively in [1]. The cone  is given
as the cone over a hexagon at height one. The Hilbert basis of the dual cone _ has
seven elements and the associated toric ideal has eleven generators.
We will take two arbitrary divisors and compare their pairwise Exti and Tori.
Since this singularity is isolated, both spaces will be ﬁnite dimensional C-vector
spaces, so it makes sense to start computing their dimensions. As discussed
previously, we expect Tor1 to be connected to Ext4. First we construct the toric
variety and the divisors D1, D2, KX and KX  Di in polymake. Then we use
Singular to compute Ext4 and Tor1.
$C = new Cone(INPUT_RAYS=>[[1,0,0],[1,1,0],[1,2,1],
[1,2,2],[1,1,2],[1,0,1]]);
$tv = new NormalToricVariety($C);
$ccoeff = new Vector<Integer>(-1,-1,-1,-1,-1,-1);
$canonical = $tv->add("DIVISOR",
COEFFICIENTS=>$ccoeff);
print $canonical->MODULE_GENERATORS;
$d1coeff = new Vector<Integer>(-3,0,0,0,0,0);
$d1 = $tv->add("DIVISOR", COEFFICIENTS=>$d1coeff);
$d2coeff = new Vector<Integer>(0,-4,0,0,0,0);
$d2 = $tv->add("DIVISOR", COEFFICIENTS=>$d2coeff);
$cmind2 = $tv->add("DIVISOR",

440
L. Kastner
COEFFICIENTS=>$ccoeff - $d2coeff);
$cmind1 = $tv->add("DIVISOR",
COEFFICIENTS=>$ccoeff - $d1coeff);
print $tv->singular_exti_dimension(4, $d1, $cmind2);
print $tv->singular_exti_dimension(4, $d2, $cmind1);
print $tv->singular_tori_dimension(1, $d1, $d2);
This code will fail with an error indicating that Singular cannot create a matrix
of the desired size. With help from the Singular team one can disable this error—
only to see all memory being consumed by the calculation. One can even observe
this phenomenon in the CQS case for large n. This demonstrates exactly why toric
methods are important: The combinatorial algorithms make solving such problems
feasible, thereby providing deeper understanding. Algebraic geometry in general
is connected with toric geometry in many ways, think of deformation theory, toric
degenerations and many more. Understanding this problem in the toric case provides
understanding for many general cases as well.
Acknowledgements The author is supported by the DFG (German research foundation) priority
program SPP 1489 ‘Computeralgebra’ and the thematic program ‘Combinatorial Algebraic
Geometry’ of The Fields Institute in Toronto.
References
1. K. Altmann, The versal deformation of an isolated toric Gorenstein singularity. Invent. Math.
128(3), 443–479 (1997) (English)
2. K. Altmann, P-resolutions of cyclic quotients from the toric viewpoint, in Singularities. The
Brieskorn Anniversary Volume. Proceedings of the Conference Dedicated to Egbert Brieskorn
on his 60th Birthday, Oberwolfach, July 1996 (Birkhäuser, Basel, 1998), pp. 241–250 (English)
3. K. Altmann, J. Kollár, The dualizing sheaf on ﬁrst-order deformations of toric surface
singularities (2016, to appear in Crelle). arXiv:1601.07805v2. https://doi.org/10.1515/crelle-
2016-0063
4. D. Avis, G. Roumanis, A portable parallel implementation of the lrs vertex enumeration code,
in Combinatorial Optimization and Applications (Springer, Heidelberg, 2013), pp. 414–429
5. W. Bruns, J. Gubeladze, Polytopes, Rings, and K-Theory (Springer, New York, NY, 2009)
(English)
6. W. Bruns, B. Ichim, T. Römer, R. Sieg, C. Söger, Normaliz. algorithms for rational cones and
afﬁne monoids. Available at https://www.normaliz.uni-osnabrueck.de
7. R.-O. Buchweitz, Maximal Cohen-Macaulay modules and Tate-cohomology over Gorenstein
rings.
8. J.A. Christophersen, On the components and discriminant of the versal base space of cyclic
quotient singularities., Symmetric Lagrangian singularities and Gauss maps of theta divisors
(1991), pp. 81–92 (English)
9. D.A. Cox, J.B. Little, H.K. Schenck, Toric Varieties (American Mathematical Society (AMS),
Providence, RI, 2011) (English)
10. W. Decker, G.-M. Greuel, G. Pﬁster, H. Schönemann, SINGULAR 4-0-2 – A computer algebra
system for polynomial computations (2015). http://www.singular.uni-kl.de
11. D. Eisenbud, Homological algebra on a complete intersection, with an application to group
representations. Trans. Am. Math. Soc. 260(1), 35–64 (1980)

Toric Ext and Tor in polymake and Singular: The Two-Dimensional Case...
441
12. K. Fukuda, The CDD Program. Available from World Wide Web (http://www.ifor.math.ethz.
ch/~fukuda/cdd_home/cdd.html) (2003)
13. W. Fulton, Introduction to Toric Varieties. The 1989 William H. Roever lectures in Geometry
(Princeton University Press, Princeton, NJ, 1993) (English)
14. E. Gawrilow, M. Joswig, polymake: a framework for analyzing convex polytopes, in Polytopes
– Combinatorics and Computation, ed. by G. Kalai, G.M. Ziegler (Birkhäuser, Basel, 2000),
pp. 43–74
15. G.-M. Greuel, B. Martin, C. Lossen, homolog.lib. a SINGULAR 4.0.3 library for procedures for
homological algebra
16. N.O. Ilten, Calculating Milnor numbers and versal component dimensions from p-resolution
fans (2008). arxiv preprint arXiv:0801.2900
17. A.N. Jensen, GFan, a software system for Gröbner fans and tropical varieties, version 0.5
(2011). Available at http://home.imf.au.dk/jensen/software/gfan/gfan.html
18. L. Kastner, Ext on afﬁne toric varieties, Ph.D. thesis. Freie Universität Berlin (2015). Available
at http://www.diss.fu-berlin.de/diss/receive/FUDISS_thesis_000000101520
19. L. Kastner, Ext and Tor on two-dimensional cyclic quotient singularities. ArXiv e-prints (2016)
20. J. Kollár, N.I. Shepherd-Barron, Threefolds and deformations of surface singularities. Invent.
Math. 91(2), 299–338 (1988) (English)
21. E. Miller, B. Sturmfels, Combinatorial Commutative Algebra (Springer, New York, NY, 2005)
(English)
22. O. Riemenschneider, Zweidimensionale Quotientensingularitaeten: Gleichungen und Syzy-
gien. Arch. Math. 37, 406–417 (1981) (German)
23. J. Stevens, On the versal deformation of cyclic quotient singularities. Symmetric Lagrangian
singularities and Gauss maps of theta divisors (1991), pp. 302–319 (English)
24. M. Wemyss, The GL.2; C) McKay correspondence. Math. Ann. 350(3), 631–659 (2011)
(English)
25. J. Wunram, Reﬂexive modules on cyclic quotient surface singularities, in Singularities,
Representation of Algebras, and Vector Bundles (Springer, Berlin, 1987), pp. 221–231
26. J. Wunram, Reﬂexive modules on quotient surface singularities. Math. Ann. 279(4), 583–598
(1988) (English)
27. Y. Yoshino, Maximal Cohen-Macaulay Modules Over Cohen-Macaulay Rings, vol. 146
(Cambridge University Press, Cambridge, 1990)
28. 4ti2 team, 4ti2—a software package for algebraic, geometric and combinatorial problems on
linear spaces. Available at www.4ti2.de

The Differential Dimension Polynomial
for Characterizable Differential Ideals
Markus Lange-Hegermann
Abstract We generalize the notion of a differential dimension polynomial of a
prime differential ideal to that of a characterizable differential ideal. Its computation
is algorithmic, its degree and leading coefﬁcient remain differential birational
invariants, and it decides equality of characterizable differential ideals contained
in each other.
Keywords Dimension polynomial • Characterizable ideal
Subject Classiﬁcations 12H05, 35A01, 35A10, 34G20
1
Introduction
Many systems of differential equations do not admit closed form solutions or
any other ﬁnite representation of all solutions. Hence, such systems cannot be
solved symbolically. Despite this, increasingly good and efﬁcient heuristics to ﬁnd
solutions symbolically have been developed and are implemented in computer
algebra systems [4, 5]. Of course, such algorithms can at best produce the subset
that admits a closed form of the full set of solutions. Given such a set of closed
form solutions returned by a computer algebra system, the natural question remains
whether this set is a complete solution set (cf. Example 5.4).
Classical measures, e.g. the Cartan characters [3] and Einstein’s strength [7],
describe the size of such solution sets. However, they have a drawback: one can
easily ﬁnd two systems S1 and S2 of differential equations such that the solution
set of S1 is a proper subset of the solution set of S2, but these two solution sets
have identical measures (cf. Example 5.3). In particular, if S1 is given by a solver of
M. Lange-Hegermann ()
Lehrstuhl B für Mathematik, RWTH Aachen University, 52062 Aachen, Germany
e-mail: markus.lange.hegermann@rwth-aachen.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_18
443

444
M. Lange-Hegermann
differential equations, these measures cannot detect whether this is the full set S2 of
solutions.
Kolchin introduced the differential dimension polynomial to solve this problem
for solution sets of systems of differential equations corresponding to prime
differential ideals [12–15]. This polynomial generalizes the Cartan characters and
strength by counting the number of freely choosable power series coefﬁcients
of an analytical solution. Recently, Levin generalized the differential dimension
polynomial to describe certain subsets of the full solution set of a prime differential
ideal [18].
Even though decomposing the radical differential ideal generated by a set of
differential equations into prime differential ideals is theoretically possible, it is
expensive in practice (cf. [2, §6.2]). Thus, there is a lack of practical methods which
decide whether a subset of the solution set of a system of differential equations is
a proper subset. This paper solves this problem for greater generality than solution
sets of prime differential ideals. It generalizes the differential dimension polynomial
to characterizable differential ideals and thereby gives a necessary condition for
completeness of solution sets. Such ideals can be described by differential regular
chains, and there exist reasonably fast algorithms that decompose a differential ideal
into such ideals [1, 2].
To formulate the main theorem, we give some preliminary deﬁnitions; the
missing deﬁnitions are given in Sect. 2. Denote by FfUg a differential polynomial
ring in m differential indeterminates for n commuting derivations over a differential
ﬁeld F of characteristic zero. For a differential ideal I in FfUg let I` WD I\FfUg`,
where FfUg` is the subring of FfUg of elements of order at most `. We deﬁne the
differential dimension function using the Krull dimension as
˝I W Z0 7! Z0 W ` 7! dim.FfUg`=I`/ .
By the following theorem, this function is eventually polynomial for large `
if I is characterizable. Such polynomials mapping Z to Z are called numerical
polynomials, and there exists a natural total order  on them.
Theorem 1.1 Let I 	 FfUg be a characterizable differential ideal.
1. There exists a unique numerical polynomial !I.`/ 2 QŒ`, called differential
dimension polynomial, with !I.`/ D ˝I.`/ for sufﬁciently big ` 2 Z0.
2. 0  !I.`/  m
`Cn
n

for all ` 2 Z0. In particular, dI WD deg`.!I/  n.
3. When writing !I.`/ D Pn
iD0 ai
`Ci
i

with ai 2 Z for all i 2 f0; : : : ; ng, the degree
dI and the coefﬁcients ai for i  dI are differential birational invariants, i.e., they
are well-deﬁned on the isomorphism class of total quotient ring of FfUg=I.
4. The coefﬁcient an is the differential dimension of FfUg=I, as deﬁned below.
Let I  J 	 FfUg be another characterizable differential ideal.
5. Then !J  !I.

Differential Dimension Polynomial
445
Assume !I D !J, and let S respectively S0 be differential regular chains with respect
to an orderly differential ranking < that describe I respectively J.
6. The sets of leaders of S and S0 coincide, and
7. I D J if and only if degx.Sx/ D degx.S0
x/ for all leaders x of S, where Sx is the
unique element in S of leader x.
This theorem can be slightly strengthened, as I  J and !I D !J already
imply degx.Sx/  degx.S0
x/ for all leader x of S (cf. Lemma 3.5). Thus I D J if
and only if Q
x degx.Sx/ D Q
x degx.S0
x/. It would be interesting to have a version
of Theorem 1.1, where this product is an intrinsic value, similar to the leading
differential degree [9].
The importance of characterisable differential ideals and their connection to
differential dimension polynomials appear in [6, §3.2], building on Lazard’s lemma
[2]. In particular, the invariance conditions were implicitly observed. To the best of
the author’s knowledge, testing equality by means of invariants does not appear in
the literature. Testing equality of differential ideals is connected to Ritt’s problem
of ﬁnding a minimal prime decomposition of differential ideals.1
Recently, the author introduced the differential counting polynomial [16, 17].
It gives a more detailed description of the set of solutions than the differential
dimension polynomial, in fact so detailed that it seems not to be computable
algorithmically. In particular, it provides a necessary criterion of completeness of
solution sets, whereas the differential counting polynomial only provides a sufﬁcient
criterion. The intention of this paper is a compromise of giving a description of the
size of the set of solutions that is detailed enough to be applicable to many problems,
but that is still algorithmically computable.
A more detailed description of the content of this paper in the language of simple
systems is a part of the author’s thesis [17].
Section 3 proves Theorem 1.1, Sect. 4 discusses the computation of the differen-
tial dimension polynomial, and Sect. 5 gives examples.
1It is easy to test equality of two prime differential ideals given by a characteristic set (cf. exercise
1 in [14, §IV.10]). However, the unsolved Ritt problem states that there is no algorithm known to
ﬁnd a minimal decomposition of a differential ideal given by a set of generators into prime ideals
given by characteristic sets [20], [14, §IV.9]. Under mild conditions, Ritt’s problem is equivalent
to several other problems, among them (1) deciding whether a differential ideal given by a set
of generators is prime, (2) ﬁnding a set of generators of a prime differential ideal given by a
characteristic set, and (3) given the characteristic sets of two prime differential ideals I1 and I2
determine whether I1  I2 [10].

446
M. Lange-Hegermann
2
Preliminaries
2.1
Squarefree Regular Chains
Let F be a ﬁeld of characteristic zero, F its algebraic closure, and R WD FŒy1; : : : ; yn
a polynomial ring. We ﬁx the total order, called ranking, y1 < y2 < : : : < yn on
fy1; : : : ; yng. The <-greatest variable ld.p/ occurring in p 2 R n F is called the
leader of p. The coefﬁcient ini.p/ of the highest power of ld.p/ in p is called the
initial of p. We denote the separant
@p
@ ld.p/ of p by sep.p/.
Let S 	 R n F be ﬁnite. Deﬁne ld.S/ WD fld.p/jp 2 Sg and similarly ini.S/
and sep.S/. The set S is called triangular if j ld.S/j D jSj; in this case denote by
Sx 2 S the unique polynomial with ld.Sx/ D x for x 2 ld.S/. We call the ideal
I .S/ WD hSi W ini.S/1  R the ideal associated to S. Let S<x WD fp 2 Sj ld.p/ < xg
for each x 2 fy1; : : : ; yng. The set S is called a squarefree regular chain if it is
triangular and neither ini.Sx/ is a zero divisor modulo I .S<x/ nor sep.Sx/ is a zero
divisor modulo I .S/ for each x 2 ld.S/.
Proposition 2.1 ([11, Prop. 5.8])) Let S be a squarefree regular chain in R and
1  i  n. Then I .S<yi/ \ FŒy1; : : : ; yi1 D I .S/ \ FŒy1; : : : ; yi1. Furthermore,
if p 2 FŒy1; : : : ; yi1 is not a zero-divisor modulo I .S<yi/, then p is not a zero-
divisor modulo I .S/.
Note that the last sentence follows easily using that the zero divisors (and zero)
are the union of the associated primed, cf. [8, Thm. 3.1].
Theorem 2.2 (Lazard’s lemma, [11, Thm. 4.4, Coro. 7.3, Thm. 7.5], [2, Thm. 1])
Let S be a squarefree regular chain in R. Then I .S/ is a radical ideal in R, and the
set fy1; : : : ; yng n ld.S/ forms a transcendence basis for every associated prime of
I .S/. Let such an associated prime I .S0/ be given by a squarefree regular chain
S0. Then ld.S/ D ld.S0/ and, in particular, R=I .S/ is equidimensional of dimension
n  jSj.
2.2
Differential Algebra
Let F be a differential ﬁeld of characteristic zero with pairwise commuting
derivations  D f@1; : : : ; @ng. Let U WD fu.1/; : : : ; u.m/g be a set of differential
indeterminates and deﬁne u.j/
 WD @u.j/ for @ WD @1
1 : : : @n
n ,  D .1; : : : ; n/ 2
.Z0/n. For any set S let fSg WD f@sjs 2 S;  2 .Z0/ng. The differential polyno-
mial ring FfUg is the inﬁnitely generated polynomial ring in the indeterminates
fUg. The derivations @i W F ! F extend to @i W FfUg ! FfUg by setting
@i@1
1 : : : @n
n u.j/ D @1
1 : : : @iC1
i
: : : @n
n u.j/ (1  i  n, 1  j  m) via additivity
and Leibniz rule. We denote the differential ideal generated by p1; : : : ; pt 2 FfUg
by hp1; : : : ; pti.

Differential Dimension Polynomial
447
A ranking of the differential polynomial ring FfUg is a total ordering < on the
set fUg satisfying additional properties (cf. e.g. [14, p. 75]). A ranking < is called
orderly if jj < j0j implies u.j/
 < u.j0/
0 , where jj WD 1 C : : : C n. In what
follows, we ﬁx an orderly ranking < on FfUg. The concepts of leader, initial and
separant carry over to elements in the polynomial ring FfUg.
Let R be a residue class ring of a differential polynomial ring by a differential
ideal. A differential transcendence basis fp1; : : : ; pdg 	 R is a maximal set such that
Sd
iD1fpig is algebraically independent over F. The differential dimension of R is
the corresponding cardinality d.
A ﬁnite set S 	 FfUg n F is called (weakly) triangular if ld.p/ is not a derivative
of ld.p/ for all p; q 2 S, p 6D q. Deﬁne S<x and Sx as in the algebraic case. We
call I .S/ WD hSi W .ini.S/ [ sep.S//1  FfUg the differential ideal associated
to S. The set S is called coherent if the -polynomials of S are reduced to zero
with respect to S [21], and it is called a differential regular chain if it is triangular,
coherent, and if neither ini.Sx/ is a zero divisor modulo I .S<x/ nor sep.Sx/ is a zero-
divisor module I .S/ for each x 2 ld.S/. An ideal I .S/ is called characterizable if
S is a differential regular chain.
Let S be a differential regular chain in FfUg, ` 2 Z0, and L WD f@yjy 2
ld.S/g \ FfUg` be the set of derivatives of leaders of elements in S of order
at most `. For each x 2 L there exists a Œx 2 Zn
0 and a pŒx 2 S such that
ld.@ŒxpŒx/ D x. Deﬁne an algebraic triangular set associated to S as S` WD
f@ŒxpŒxjx 2 Lg. Although S` depends on the choice of Œx and pŒx, it has
properties independent of the choice.
Lemma 2.3 (Rosenfeld’s Lemma) Let S be a differential regular chain in FfUg,
` 2 Z0, and < orderly. Then S` is a squarefree regular chain and IFfUg`.S`/ D
I .S/`.
The idea is due to [21]. For a detailed proof cf. [17, Lemma 1.93].
2.3
Numerical Polynomials
Numerical polynomials are elements in the free Z-module
n`Ck
k

2 QŒ`
ˇˇˇ
0  k  n
o
, i.e., rational polynomials that map an integer to an integer. They
are totally ordered by p  q if p.`/  q.`/ for all ` sufﬁciently large. Then p  q if
and only if either p D q or there is a j 2 f0; : : : ; dg such that ak D bk for all k > j
and aj < bj, where p D Pd
kD0 ak
`Ck
k

and q D Pd
kD0 bk
`Ck
k

.

448
M. Lange-Hegermann
3
Proofs
3.1
Proof of Existence and Elementary Properties
We prove Theorem 1.1.(1), (2), (4), and (5). Therefore, let I  J 	 FfUg be
characterizable differential ideals, S be a differential regular chain with respect to
an orderly differential ranking < with I .S/ D I, and ` 2 Z0 be sufﬁciently big.
Lemma 2.3 implies I` D I .S`/ and Theorem 2.2 states that the dimension
dim.FfUg`=I`/ can be read off from the number of polynomials in S`, which
only depends on ld.S/. Thus, to prove Theorem 1.1.(1) and 1.1.(2) we may assume
S D ld.S/. In this case I .S/ is a prime differential ideal, and hence the statements
follow from Kolchin’s original theorem [14, §II.12].
For the proof of Theorem 1.1.(4) note that the transcendence bases of all
associated primes of I .S/ are equal by Theorem 2.2, and for each of these
associated prime the claim follows from Kolchin’s original theorem.
To prove Theorem 1.1.(5) note that I  J implies I`  J` for all `  0.
In particular, the map from FfUg`=I` to FfUg`=J` is surjective and, thus,
dim.FfUg`=I`/  dim.FfUg`=J`/.

3.2
Invariance Proof
The differential polynomial ring FfUg is ﬁltered by the ﬁnitely generated F-algebras
FfUg`. This ﬁltration induces a ﬁltration on FfUg=I for a differential ideal I.
To prove the invariance statement in Theorem 1.1.(3) we show that this ﬁltration
extends to K.FfUg=I/ if I is characterizable, where K denotes the total quotient ring.
Thereby, standard techniques of ﬁltrations can be adapted from Kolchin’s proof.
Example 3.1 Consider  D f@tg, U D fu; vg, and I WD hu0  v1i. Then u0 is not
a zero-divisor in FfUg0=I0 Š FŒu0; v0, but u0  v1 D 0 in FfUg=I. So, even
though the inclusion ˛ W FfUg0=I0 ,! FfUg1=I1 is injective, the image of
this map under the total quotient ring functor K is no longer injective, as K.˛/ W
K.FfUg0=I0/ ! K.FfUg1=I1/ D K.FŒu0; v0; u1; v1=hu0  v1i/ maps u0 to
zero, as zero divisors become zero in the total quotient ring, cf. e.g. [8, Prop. 2.1].
Lemma 3.2 Let I  FfUg be a characterizable differential ideal and ` 2 Z0.
Then, FfUg`=I` ,! FfUg`C1=I`C1 induces an inclusion
K.FfUg`=I`/ ,! K.FfUg`C1=I`C1/ .
Proof Any non-zero-divisor in FfUg`=I` is a non-zero-divisor when considered
in FfUg`C1=I`C1 (cf. Proposition 2.1), and thus a unit in K.FfUg`C1=I`C1/.
Hence, FfUg`=I` ! K.FfUg`C1=I`C1/ factors over K.FfUg`=I`/ by the
universal property of localizations. This induces a map 	 W K.FfUg`=I`/ !

Differential Dimension Polynomial
449
K.FfUg`C1=I`C1/. Now, ker 	 \ .FfUg`=I`/ is zero, since it is the kernel of
the composition FfUg`=I` ,! FfUg`C1=I`C1 ,! K.FfUg`C1=I`C1/ of
monomorphisms. By [8, Prop. 2.2] there is an injection2 from the set of ideals in
K.FfUg`=I`/ into the set of ideals in FfUg`=I`. This implies ker 	 D 0.

This ﬁltration is well-behaved under differential isomorphisms.
Lemma 3.3 Let I  FfUg and J  FfVg be characterizable differential ideals. Let
' W K.FfUg=I/ ! K.FfVg=J/ be a differential isomorphism. Then there exists an
`0 2 Z0 such that
'.K.FfUg`=I`//  K.FfVg`C`0=J`C`0/ .
Proof FfUg=I is a (left) FŒ-module for every differential ideal I 	 FfUg, where
FŒ is the ring of linear differential operators with coefﬁcients in F. The ﬁltration of
FŒ by the linear differential operators FŒk of order  k is compatible with the
ﬁltration of FfUg in the sense that FŒk.FfUg`=I`/  FfUg`Ck=I`Ck. Note
that the canonical image of FŒ`.FfUg0=I0/ in FfUg`=I` generates the latter
as an F-algebra. Abusing notation, given any F-module M of an F-algebra, denote
by K.M/ the total quotient ring of the F-algebra generated by M. In particular,
K.FŒ`.FfUg0=I0// D K.FfUg`=I`/.
There exists an `0
2 Z0 with '.FfUg0=I0/  K.FfVg`0=J`0/, as
FfVg=J D S
`2Z0 FfVg`=J`. Now
'.K.FfUg`=I`// D '.K.FŒ`.FfUg0=I0///
D K.FŒ`'.FfUg0=I0//
 K.FŒ` K.FfVg`0=J`0//
 K.FfVg`C`0=J`C`0/

The Krull-dimension changes when passing to total quotient rings. Instead,
we use dimF.R/
WD
maxP2Ass.R/ trdegF.K.R=P// as notion of dimension for
F-algebras R. Then, dim.R/ D dimF.R/ D dimF.K.R// allows to prove the
invariance condition.
Proof of Theorem 1.1.(3) Let ' be as in Lemma 3.3. Then,
K.FfUg`=I`/ Š '.K.FfUg`=I`//  K.FfVg`C`0=J`C`0/
with the `0 2 Z0 from Lemma 3.3, and thus
dim.FfUg`=I`/ D dimF.K.FfUg`=I`//
 dimF.K.FfVg`C`0=J`C`0//
D dim.FfVg`C`0=J`C`0/ .
2The image consists of those ideals which do not contain any zero divisors.

450
M. Lange-Hegermann
Thus !I.`/  !J.`C`0/ and by symmetry !J.`/  !I.`C`0/. Now, an elementary
argument implies that the degrees and leading coefﬁcients of !I and !J are
the same.

3.3
Comparison Proof
The proof of Theorem 1.1.(6) and (7) uses two propositions, which relate ideals
and squarefree regular chains. The ﬁrst proposition is a direct corollary to Lazard’s
Lemma (Theorem 2.2).
Proposition 3.4 Let S; S0 be squarefree regular chains in FŒy1; : : : ; yn with
I .S/  I .S0/ and jSj D jS0j. Then ld.S/ D ld.S0/.
The following lemma is used to prove the second proposition. It captures an
obvious property of the pseudo reduction with respect to a squarefree regular chain
S: if a polynomial p can be reduced to zero by S, but ini.p/ cannot be reduced to
zero, then there must be a suitable element in S to reduce the highest power of ld.p/.
Lemma 3.5 Let S be a squarefree regular chain and p 2 FŒy1; : : : ; yn with ld.p/ D
x, p 2 I .S/, and ini.p/ 62 I .S/. Then S has an element of leader x and degx.Sx/ 
degx.p/.
Proposition 3.6 Let S and S0 be squarefree regular chains in R D FŒy1; : : : ; yn
with I .S/  I .S0/ and jSj D jS0j. Then, I .S/ D I .S0/ if and only if degx.Sx/ D
degx.S0
x/ for all x 2 ld.S/ D ld..S0//.
Proof Let degx.Sx/ D degx.S0
x/ for all x 2 ld.S/. We show I .S/  I .S0/ by a
Noetherian induction. The statement is clear for the principle ideals I .S<y2/ and
I .S0
<y2/. Let p 2 I .S0/ with ld.p/ D yi and degyi.p/ D j. Assume by induction
that q 2 I .S0/ implies q 2 I .S/ for all q with ld.q/ < yi or ld.q/ D yi and
degyi.q/ < j. Without loss of generality ini.p/ 62 I .S0/<yi D I .S/<yi, as otherwise
p has a lower degree in yi or a lower ranking leader when substituting ini.p/ by zero.
Now, Lemma 3.5 implies yi 2 ld.S/ and degyi.p/  degyi.Syi/. Then,
r WD ini.Syi/  p  ini.p/  y
degyi.p/degyi.Syi/
i
 Syi
is in I .S/ if and only if p 2 I .S/ is, but r is of lower degree or of lower ranking
leader than p. The claim follows by induction.
Let I .S/ D I .S0/ and x 2 ld.S/. This implies ini.Sx/ 62 I .S0/, and thus
degx.S0
x/  degx.Sx/ by Lemma 3.5. By symmetry degx.S0
x/  degx.Sx/, and thus
degx.Sx/ D degx.S0
x/.

Proof of Theorem 1.1.(6) and (7) Lemma 2.3 reduces the statements to the alge-
braic case. In this case, Proposition 3.4 implies Theorems 1.1, and 1.1 follows from
Proposition 3.6, because all polynomials in S` (` 2 Z0) of degree greater than
one in their respective leader already lie in S.


Differential Dimension Polynomial
451
4
Computation of the Differential Dimension Polynomial
To compute the differential dimension polynomial !I .S/ of a characterizable
differential ideal I .S/  FfUg for a differential regular chain S we may assume
S D ld.S/ (cf. Sect. 3.1). This assumption implies that I .S/ is a prime differential
ideal, and for this case there exist well-known combinatorial algorithms for !I .S/
[15].
Alternatively, the differential dimension polynomial !I .S/ can be read off the set
of equations S of a simple differential system [1]. Such a set S is almost a differential
regular chain, except that weak triangularity is replaced by the Janet decomposition,
which associates a subset of  of cardinality p to each p 2 S. Then, the differential
dimension polynomial is given by the closed formula
!I .S/.l/ D m
 
n C `
n
!

X
p2S
 
p C `  ord.ld.p//
p
!
,
involving only the cardinalities p and the orders ord.ld.p//.
5
Examples
For each prime differential ideal I there exists a differential regular chain S with
I D I .S/. Thus, the differential dimension polynomial deﬁned in Theorem 1.1
includes the version of Kolchin. However, the following example shows that
Theorem 1.1 is more general.
Example 5.1 Consider U D fu; vg,  D f@tg, p D u2
1  v, and q D v2
1  v.
The characterizable differential ideal I WD I .fp; qg/ is not prime, as p  q D
.u1  v1/.u1 C v1/.
Prime differential ideals I  J are equal if and only if !I D !J by Kolchin’s
theorem. By the following example, this is wrong for characterizable ideals and
any generalization to such ideals needs to consider the degrees of polynomials in a
differential regular chain.
Example 5.2 Consider hu2
0  u0i D I .fu2
0  u0g/ ¨ hu0i D I .fu0g in Ffug
for jj D 1. Both differential ideals are characterizable and have the differential
dimension polynomial 0. However, they are not equal.
The next example shows that the Cartan characters and other invariants do not
sufﬁce to prove that two solution sets are unequal.
Example 5.3 For  D f@x; @yg consider the regular chains S1 D fu1;0g and S2 D
fu2;0; u1;1g in Cfug. Then I .S2/  I .S1/. The strength and ﬁrst Cartan character
are one and the second Cartan character and differential dimension are zero for both

452
M. Lange-Hegermann
ideals (in any order high enough), i.e., these values are the same for both ideals.
However, I .S2/ 6D I .S1/, as !I .S1/.`/ D l C 1 6D l C 2 D !I .S2/.`/.
In the last example, the differential dimension polynomial proves that a symbolic
differential equation solver does not ﬁnd all solutions.
Example 5.4 Let U D fug and  D f @
@t; @
@xg. The viscous BURGERS’ equation
b D u0;2  u1;0  2u0;1  u0;0 has the differential dimension polynomial 2` C 1.
MAPLE’s pdsolve [19] ﬁnds the set
T WD
n
c1 tanh.c1x C c2t C c3/  c2
2c1
ˇˇˇc1; c2; c3 2 C; c1 6D 0
o
of solutions, which only depends on three parameters. The differential dimension
polynomial shows that the set of solutions is inﬁnite dimensional, and hence T is
only a small subset of all solutions.
Acknowledgements The author was partly supported
by Schwerpunkt
SPP 1489 and
Graduiertenkolleg Experimentelle und konstruktive Algebra of the DFG.
References
1. T. Bächler, V.P. Gerdt, M. Lange-Hegermann, D. Robertz, Algorithmic Thomas decompo-
sition of algebraic and differential systems.
J. Symb. Comput. 47(10), 1233–1266 (2012).
arXiv:1108.0817
2. F. Boulier, D. Lazard, F. Ollivier, M. Petitot, Computing representations for radicals of ﬁnitely
generated differential ideals. Appl. Algebra Eng. Commun. Comput. 20(1), 73–121 (2009)
3. É. Cartan, Sur la théorie des systèmes en involution et ses applications à la relativité. Bull.
Soc. Math. Fr. 59, 88–118 (1931)
4. E.S. Cheb-Terrab, A.D. Roche, Hypergeometric solutions for third order linear odes (2008).
arXiv:0803.3474
5. E.S. Cheb-Terrab, K. von Bülow, A computational approach for the analytical solving of partial
differential equations. Comput. Phys. Commun. 90(1), 102–116 (1995)
6. T. Cluzeau, E. Hubert, Resolvent representation for regular differential ideals. Appl. Algebra
Eng. Commun. Comput. 13(5), 395–425 (2003)
7. A. Einstein, Supplement to Appendix II of “The Meaning of Relativity, 4th ed.” (Princeton
University Press, Princeton, NJ, 1953)
8. D. Eisenbud, Commutative Algebra with a View Toward Algebraic Geometry. Graduate Texts
in Mathematics, vol. 150 (Springer, New York, 1995)
9. X.-S. Gao, W. Li, C.-M. Yuan, Intersection theory in differential algebraic geometry: generic
intersections and the differential Chow form. Trans. Am. Math. Soc. 365(9), 4575–4632 (2013)
10. O.D. Golubitsky, M.V. Kondratieva, A.I. Ovchinnikov, On the generalized Ritt problem as a
computational problem. Fundam. Prikl. Mat. 14(4), 109–120 (2008)
11. E. Hubert, Notes on triangular sets and triangulation-decomposition algorithms. I. Polynomial
systems.
In: Symbolic and Numerical Scientiﬁc Computation (Hagenberg, 2001). Lecture
Notes in Computer Science, vol. 2630 (Springer, Berlin, 2003), pp. 1–39
12. J. Johnson, Differential dimension polynomials and a fundamental theorem on differential
modules. Am. J. Math. 91, 239–248 (1969)

Differential Dimension Polynomial
453
13. E.R. Kolchin, The notion of dimension in the theory of algebraic differential equations. Bull.
Am. Math. Soc. 70, 570–573 (1964)
14. E.R. Kolchin, Differential Algebra and Algebraic Groups. Pure and Applied Mathematics, vol.
54 (Academic, New York, 1973).
15. M.V. Kondratieva, A.B. Levin, A.V. Mikhalev, E.V. Pankratiev, Differential and Difference
Dimension Polynomials. Mathematics and Its Applications, vol. 461
(Kluwer Academic
Publishers, Dordrecht, 1999)
16. M. Lange-Hegermann,
The differential counting polynomial.
Found. Comput. Math.
(accepted). arXiv:1407.5838
17. M. Lange-Hegermann,
Counting solutions of differential equations.
PhD thesis, RWTH
Aachen (2014).
Available at http://darwin.bth.rwth-aachen.de/opus3/frontdoor.php?source_
opus=4993
18. A. Levin, Dimension polynomials of intermediate ﬁelds and Krull-type dimension of ﬁnitely
generated differential ﬁeld extensions. Math. Comput. Sci. 4(2–3), 143–150 (2010)
19. Maple 17.00, Maplesoft, a division of Waterloo Maple Inc., Waterloo, Ontario
20. J.F. Ritt,
Differential Equations from the Algebraic Standpoint.
(American Mathematical
Society, Providence, 1932)
21. A. Rosenfeld, Specializations in differential algebra. Trans. Am. Math. Soc. 90, 394–407
(1959)

Factorization of Z-Homogeneous
Polynomials in the First q-Weyl Algebra
Albert Heinle and Viktor Levandovskyy
Abstract Factorization of elements of noncommutative rings is an important prob-
lem both in theory and applications. For the class of domains admitting nontrivial
grading, we have recently proposed an approach, which utilizes the grading in order
to factor general elements. This is heavily based on the factorization of graded
elements. In this paper, we present algorithms to factorize weighted homogeneous
(graded) elements in the polynomial ﬁrst q-Weyl and Weyl algebras, which are both
viewed as Z-graded rings. We show that graded polynomials have ﬁnite number
of factorizations. Moreover, the factorization of such can be almost completely
reduced to commutative univariate factorization over the same base ﬁeld with some
additional uncomplicated combinatorial steps. This allows to deduce the complexity
of our algorithms in detail, which we prove to be polynomial-time. Furthermore,
we show, that for a graded polynomial p, irreducibility of p in the polynomial
ﬁrst Weyl algebra implies its irreducibility in the localized (rational) Weyl algebra,
which is not true for general polynomials. We report on our implementation in
the computer algebra system SINGULAR. For graded polynomials, it outperforms
currently available implementations for factoring in the ﬁrst Weyl algebra—in speed
as well as in elegancy of the results.
Keywords Factorization • Noncommutative factorization • Weyl algebra •
q-Weyl algebra
Subject Classiﬁcations 68W30, 16Z05, 68-04, 68W40
A. Heinle
David R. Cheriton School of Computer Science, University of Waterloo, Waterloo,
ON N2L 3G1, Canada
e-mail: aheinle@uwaterloo.ca
V. Levandovskyy ()
Lehrstuhl B für Mathematik, RWTH Aachen University, 52064 Aachen, Germany
e-mail: viktor.levandovskyy@math.rwth-aachen.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_19
455

456
A. Heinle and V. Levandovskyy
1
Introduction
Factorization of polynomials in commutative rings is a classical and well-studied
topic, central to modern computer algebra and widely used in advanced applications.
1.1
Problems and Questions
When talking on the factorization of elements in noncommutative rings, a couple
of ambiguities are immediately present. Even by restricting our attention to linear
partial differential operators, by addressing the term “factorization”, one has to
specify at least two more pieces of information:
1. Since linear partial differential operators can be deﬁned over a general differen-
tial ring, one needs to say what is the ground ring. A very typical examples are
KŒx and K.x/, where K is a ﬁxed computable ﬁeld. Later on we will see, how
different are the properties of the corresponding algebras of operators.
2. Indeed, there are several notions of elements being associated and therefore
several notions of a factorization itself. It has an immediate impact on the number
of possible factorizations, which can be even inﬁnite.
Let us consider the latter question in detail. In classical ring theory (following,
for instance N. Jacobson and P. M. Cohn), two elements a; b from a ring R are called
left similar [4] and denoted by a  b, if R=Ra Š R=Rb as left R-modules. Then it
can be proved that some noncommutative domains are unique factorization domains
with respect to , i.e. if a1  : : :  as D b1  : : :  bt and ai; bj are non-units from a
domain R, which cannot be written as a product of two units, then s D t and there
exists a permutation  such that 8i ai  b.i/ holds. In particular, both the rational
ﬁrst Weyl algebra B1 (see Sect. 2.3) and the free associative algebra Khx1; : : : ; xni
enjoy this property, which we shortly denote as UFD.
On the contrary, more natural generalization of a commutative factorization,
which is mostly needed in practice, is given in Deﬁnition 1.10. Shortly, the
association relation there is stronger: a  b if and only if a differs from b by
a multiplication with a nonzero central invertible element. With this deﬁnition, a
single element might have several and even inﬁnitely many different factorizations.
Example 2.12 shows, that the rational ﬁrst Weyl algebra B1, which is an UFD,
admits inﬁnitely many different factorizations with respect to . At the same time,
the free associative algebra Khx1; : : : ; xni is another UFD; from [3] it follows,
that any element of it admits only ﬁnitely many factorizations with respect to .
However, it is not an UFD, as xyx  x D x  .yx  1/ D .xy  1/  x demonstrates.
So, a natural question arises in connection with it: given a K-algebra, is it a ﬁnite
factorization domain (FFD) with respect to ?

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
457
1.2
Our Methodology and Results
Recently, the two authors together with Bell [3] have answered previous question
for a vast family of noncommutative algebras, including polynomial (q-)Weyl and
(q-)shift algebras. Notably, in the current paper we prove the ﬁniteness of the
number N. p/ of factorizations of a graded polynomial p by elementary methods
and give a better upper bound for N. p/, compared to [3].
Moreover, in [10] the two authors together with Mark Giesbrecht have proposed
a novel method, having no analogon in the commutative case, to factorize a general
polynomial in a graded algebra by utilizing the factorization of graded polynomials.
The algorithms have been implemented for nth (q-)Weyl algebras [10] and, recently
[16], for a big family of G-algebras and demonstrated very good performance.
In this work we deal with the class of graded polynomials by describing our
methods in detail (for these methods are fundamental for a number of further
algorithms). Among other, this is needed for deriving a complexity estimate (which
was not investigated in the mentioned papers [10] and [16]) for the factorization by
using our method in the case, where the underlying ﬁeld is computable.
In the next section we report on existing algorithms and implementations for
factorizations, which are able to factorize a large number of polynomials. However,
as we will see in this paper, there exists a large class of polynomials that seem to
form the worst case for the mentioned algorithms. By using our approach one can
obtain a factorization of such polynomials very quickly.
We state another main result in Theorem 2.14. There, we prove that irreducible
graded polynomials in the polynomial ﬁrst Weyl algebra stay irreducible when
considering them as elements in the rational ﬁrst Weyl algebra. This is rather
unexpected, as this statement is not true for general inhomogeneous polynomials.
Moreover, the same statement holds true for the q-Weyl algebra.
Our algorithms are implemented in the computer algebra system
SINGULAR:PLURAL [6, 11, 12], and since version 3-1-3 they the belong to the
distribution of SINGULAR as the library ncfactor.lib. Since then, a number of
additions and enhancements has been done in this library.
1.3
Historical Developments
Algebras of linear partial functional operators, such as (q-)Weyl and (q-)shift alge-
bras are important objects in mathematics. In particular, they allow algebraization of
properties of the solution spaces of systems of equations in the mentioned operators.
Especially concerning the problem of ﬁnding the solutions of a linear ordinary
(q-)differential equation, the preconditioning step of factorizing this operator may
come in helpful.

458
A. Heinle and V. Levandovskyy
Often such algebras of operators are noncommutative polynomial rings, and a
factorization of an element in those algebras is neither unique in the classical sense
(i.e. unique up to multiplication by a unit), nor easy to compute at all in general.
Nevertheless, a lot has been done in this ﬁeld in the past. Tsarev has studied the
form, number and the properties of the factors of a linear differential operator in
[32] and [33], where he uses and extends the work presented in [21] and [22].
A very general approach to noncommutative algebras and their properties,
including factorization, is also done in [4]. The authors provide several algorithms
and introduce various points of views when dealing with noncommutative polyno-
mial algebras.
In his dissertation van Hoeij developed an algorithm to factorize a linear
differential operator [34]. There were several papers following that dissertation
using and extending those techniques (e.g. [35, 36] and [37]), and nowadays this
algorithm is implemented in the DETools package of MAPLE [25] as the standard
algorithm for factorization of those operators.
For the ﬁnite ﬁeld case, Giesbrecht and Zhang have developed a polynomial
time algorithm to factor polynomials in Fq.t/ŒDI ; ı [9]. This includes the
Weyl algebras with rational function coefﬁcients over a ﬁnite ﬁeld. The applied
methodology extends the results in [8].
From the more algebraic point of view and dealing only with strictly polynomial
noncommutative algebras, i.e. all units are in the center of the algebra, Melenk and
Apel developed a package for the computer algebra system REDUCE [24]. This
package provides tools to deal with noncommutative polynomial algebras and also
contains a factorization algorithm for the supported algebras.
In the computer algebra system ALLTYPES [28], which is based on REDUCE
and solely accessible as a web-service, Schwarz and Grigoriev have implemented
the algorithm for factoring differential operators they introduced in [14].
Beals and Kartashova [2] consider the problem of ﬁnding a ﬁrst-order left hand
factor of an element from the second Weyl algebra over a computable differential
ﬁeld, where they are able to deduce parametric factors. Similarly, Shemyakova
studied factorization properties of linear partial differential operators in [29, 30]
and [31]. Concerning special classes of polynomials in algebras of operators, the
paper [7] deals with factorization of fourth-order differential equations satisﬁed by
certain Laguerre-Hahn orthogonal polynomials [26].
1.4
Preliminaries
We will start by introducing the ﬁrst q-Weyl algebra and the ﬁrst Weyl algebra.
By K, we always denote an arbitrary ﬁeld. All algebras are unital associative
K-algebras. For the complexity discussions, we assume that
1. K is computable and its arithmetics have polynomial costs with respect to the
bit-size of the elements in K.

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
459
2. There exists a norm j  j W K ! R. The representation size in bits for an element
k 2 K is bounded by dlog jkje.
The role of the invertible parameter q can be different: from q 2 K to q being
transcendental over K. We use the uniﬁed notation K.q/ for all these cases.
Moreover, for m 2 N we denote by m the set f1; : : : ; mg.
Deﬁnition 1.1 The polynomial ﬁrst q-Weyl algebra Q1 is deﬁned as
Q1 WD K.q/hx; @j@x D qx@ C 1i:
For the special case where q D 1 we have the polynomial ﬁrst Weyl algebra A1.
Remark 1.2 The ﬁrst q-Weyl algebra can be viewed as an algebra associated to the
operator
@q W f.x/ 7! f.qx/  f.x/
.q  1/x
;
also known as the q-derivative, where f is a univariate function in x (cf. [17]).
For q D 1, the operator is still well deﬁned. This can be seen in the following
way. Let f D Pn
iD0 aixi, where n 2 N0 and ai 2 K. Then
f.qx/  f.x/ D
n
X
iD0
ai.qx/i 
n
X
iD0
aixi D
n
X
iD0
aixi.qi  1/:
The expression q  1 is clearly a divisor of qi  1 for all i  1, and we obtain
f.qx/  f.x/
.q  1/x
D
n
X
iD1
aixi1
0
@
i1
X
jD0
qj
1
A :
The ﬁrst (q-)Weyl algebra possesses a nontrivial Z-grading—utilized, in partic-
ular, by Kashiwara and Malgrange in a broader context of the so-called V-ﬁltration
[19, 23]—using the weight vector Œv; v for non-zero v 2 Z on the tuple Œx; @.
For simplicity, we will choose v WD 1. In what follows, deg denotes the total degree
induced by this weight vector. We will write degx and deg@ for the degree of a
polynomial in Q1 resp. A1 with respect to x and @. From now on, we mean by
homogeneous or graded a polynomial, which is homogeneous with respect to the
weight vector Œ1; 1.
Example 1.3 We have deg.@x/ D deg.x@ C 1/ D deg.x@/ D 0. Consider
p D x@2 C x4@5 C @ D .x@ C x4@4 C 1/@:
Then degx. p/ D 4, deg@. p/ D 5 and p is Œ1; 1-homogeneous of degree one.

460
A. Heinle and V. Levandovskyy
For n 2 Z, the nth graded part (cf. 2.2 for more detailed description) of Q1 and
analogously the nth graded part of A1 is given by
Q.n/
1
WD
8
<
:
X
jiDn
ri;jxi@jji; j 2 N0; ri;j 2 K
9
=
; :
Concerning this choice of degree, the so called Euler operator  WD x@, which
is homogeneous of degree 0, will play an important role as we will see soon.
First of all, let us investigate some commutation rules the Euler operator has with
x and @. For Q1, in order to abbreviate the size of our formulas, we introduce the so
called q-bracket.
Deﬁnition 1.4 For n 2 N, we deﬁne the q-bracket Œnq by
Œnq WD 1  qn
1  q D
n1
X
iD0
qi:
Lemma 1.5 (Compare with [27]) In A1, for n 2 N there are commutation rules
xn D xn. C n/;
@n D @n.  n/:
More generally, in Q1 the following commutation rules do hold for n 2 N:
xn D xn.qn C Œnq/;
@n D @n
q
  1
qn1  qnC2  q
1  q

:
Remark 1.6 If the characteristic of K is p > 0, the elements xap (resp. @ap) for all
a 2 N0 commute with  in A1.
For any K, suppose that q is an mth root of unity, then xam (resp. @am) for all
a 2 N0 commute with  in Q1.
Remark 1.7 With the help of the Lemma above one can also easily see that the
polynomial ﬁrst shift algebra
Khn; sjsn D .n C 1/si
is a subalgebra of the ﬁrst Weyl algebra A1. One of possible embeddings can be
realized via the homomorphism of K-algebras, n 7! , s 7! @.
Analogously, though less known, the polynomial ﬁrst q-shift algebra
Kha; bjba D q  abi

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
461
can be realized as a subalgebra of the ﬁrst q-Weyl algebra Q1 via the homomorphism
a 7! x, b 7! .q  1/x@ C 1.
Therefore, the factorization techniques developed here for the ﬁrst Weyl algebra
can also be applied to the ﬁrst shift und q-shift algebras.
The commutation rules in Lemma 1.5 extend to arbitrary polynomials in .
Corollary 1.8 Consider f./ WD f 2 KŒ;  WD x@. Then, in Q1, for all n 2 N
f./xn D xnf.qn C Œnq/;
f./@n D @nf
1
q
  1
qn1  qnC2  q
1  q

;
whereas in A1 we have
f./xn D xnf. C n/;
f./@n D @nf .  n/ :
Those are the basic tools we need to explain our approach for factoring
homogeneous polynomials in the ﬁrst Weyl and the ﬁrst q-Weyl algebra.
For the complexity discussion, let us deﬁne some constants we will utilize in
order to estimate the operations needed to perform our methods.
Deﬁnition 1.9 Let us denote by !q.n; c/, for n; c 2 N0, the number of bit operations
that an algorithm for factoring a polynomial of degree n in a univariate polynomial
ring over K.q/, where each coefﬁcient has at most bit-size c, needs to perform.
We denote for n; c 2 N0 by q.n; c/ the number of bit operations needed to
multiply two polynomials in a univariate polynomial ring over K.q/, where each
polynomial has degree at most n and where c is the maximal bit size of each
coefﬁcient in the two polynomials.
We will write Sq.n; k; c; /, n; c 2 N0; k 2 Z,  2 Aut.KŒx/, for the number of
bit operations needed for computing f.k.x// for a polynomial f in K.q/Œx of degree
n, where x is an indeterminate and transcendental over K.q/ and each coefﬁcient of
f has at most bit-size c.
If we deal with the case q D 1, we will omit writing the subscript.
For a detailed complexity discussion, we need to specify the expected output of
our factorization algorithms.
Deﬁnition 1.10 Let A be a polynomial algebra over a ﬁeld K and f 2 A n K
be a polynomial. For a ﬁxed totally ordered monomial K-basis of A, the leading
coefﬁcient lc. f/ of f is uniquely deﬁned. A nontrivial factorization of f is a tuple
.c; f1; : : : ; fm/, where c 2 K n f0g, f1; : : : ; fm 2 A n f1g are monic (i.e. they satisfy
lc. fi/ D 1) and f D c  f1 : : : fm:
By a slight abuse of notation, we may omit the ﬁrst element in the tuple if c D 1.
The following lemma provides a complexity estimate of the cost of testing
whether a polynomial in Q1 resp. A1 is homogeneous.

462
A. Heinle and V. Levandovskyy
Lemma 1.11 In order to determine whether a polynomial p 2 Q1 resp. p 2 A1 is
homogeneous, it requires #fTerms in pg integer additions and comparisons.
Proof A polynomial p is homogeneous with respect to our deﬁnition if and only if
in every term the difference between the degree in x and the degree in @ is the same.
Graded elements enjoy nice properties, in particular regarding factorizations.
Lemma 1.12 Let .; C/ be a monoid, totally ordered by <, such that a < b ) aC
c < bCc for all a; b; c 2  . Moreover, let D be a domain over a ﬁeld K, nontrivially
graded by  , that is D D ˚2 D for K-vector spaces D and 8˛; ˇ 2  one has
D˛  Dˇ  D˛Cˇ.
Consider d 2 D n f0g. If there is m  1 and di 2 D, such that d D d1  : : :  dm,
then d is  -graded if and only if d1; : : : ; dm are  -graded.
Proof The ( direction follows by the deﬁnition of grading, so it remains to prove
the ) direction. For an element f 2 D n f0g, let us denote by ˛. f/ 2  resp. by
!. f/ 2  the degree of the highest resp. the lowest nonzero graded part of f. Note,
that !. f/  ˛. f/. Thus f D f˛. f/ C : : : C f!. f/ and, moreover, f is graded if and
only if f D f˛. f/ D f!. f/.
Suppose d D bc, where b D b˛.b/ C : : : C b!.b/ and c D c˛.c/ C : : : C c!.c/.
Then bc D b˛.b/c˛.c/ C : : : C b!.b/c!.c/ is the graded decomposition of d D bc, and
.bc/˛.bc/ D .bc/˛.b/C˛.c/ D b˛.b/c˛.c/ since D is a domain. Analogously .bc/!.bc/ D
b!.b/c!.c/. Since d D bc is graded one has thus ˛.bc/ D !.bc/, that is ˛.b/C˛.c/ D
!.b/ C !.c/. Together with ˛.b/  !.b/; ˛.c/  !.c/ this delivers ˛.b/ D !.b/
and ˛.c/ D !.c/, proving the claim.
2
A New Approach for Factoring Homogeneous Polynomials
in the First (q-)Weyl Algebra
The main idea of our factorization technique lies in the reduction to a natural
commutative univariate polynomial subring of A1 resp. Q1, namely KŒ. We will
show that there are only two monic irreducible elements in KŒ, that are reducible
in A1 resp. Q1. Hence, factoring graded elements in A1 (which belong to ﬁn. gen.
KŒ-modules) can be reduced to factoring in KŒ, identifying these two elements
in a given list of factors, and interchanging using commutation rules.
We will start with discussing how to ﬁnd one factorization of a given homoge-
neous polynomial, which, in the process, also leads us to the answer of the question
how to ﬁnd all possible factorizations.

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
463
2.1
Factoring Homogeneous Polynomials of Degree Zero
Lemma 2.1 (Compare with [27], Lemma 1.3.1 for A1) In A1, we have the
following identity for n 2 N:
xn@n D
n1
Y
iD0
.  i/:
In Q1, one can rewrite xn@n as element in KŒ and it is equal to
1
qTn1
n1
Y
iD0
0
@ 
i1
X
jD0
qj
1
A D
1
qTn1
n1
Y
iD0

  Œiq

;
where Ti denotes the ith triangular number Pi
jD0 j D i.iC1/
2
for all i 2 N0.
Therefore the factorization of a homogeneous polynomial p of degree zero can
be done by rewriting p as element in KŒ and by factoring it in KŒ, which is
implemented in every computer algebra system for practical choices of K.
Of course, this does not already yield a complete factorization, since there are
still elements irreducible in KŒ, but reducible in Q1 resp. A1. An obvious example
is  D x@ itself. Fortunately, there are only two monic polynomials irreducible in
KŒ, but reducible in A1 resp. Q1. This is shown by Lemma 2.3, which requires the
following proposition for its proof.
Proposition 2.2 Q.0/
1 is a K-algebra, generated by the element  WD x@. The graded
direct summands Q.k/
1
are cyclic Q.0/
1 -bimodules, generated by the element xk, if
k < 0, or by @k, if k > 0. Literally the same holds, when Q1 is replaced by A1.
Proof The ﬁrst statement can be seen using Lemma 2.1, as we can identify Q.0/
1
resp. A.0/
1
with KŒ. For the second statement recall that being homogeneous of
degree k 2 Z for a polynomial p 2 Q.k/
1
resp. p 2 A.k/
1
means, that every monomial
is – for a certain n 2 N0 – of the form xn@nCk, if k  0, or of the form xnk@n, if
k < 0. Since we can transform xn@n into an expression in KŒ via Lemma 2.1 and
use the commutation rules in Lemma 1.5, we can move xk resp. @k to the right and
the left and hence obtain the desired bimodule structure.
Lemma 2.3 The polynomials  and  C 1
q are the only irreducible monic elements
in KŒ that are reducible in Q1. For A1, the polynomials  and  C 1 are the only
irreducible monic elements in KŒ that are reducible in A1.
Proof We will only consider the proof for Q1, as the proof for A1 is done in an
analogue way. Let f 2 KŒ be a monic polynomial. Assume that it is irreducible in
KŒ, but reducible in Q1. Let ';  be elements in Q1 with ' D f. Then ' and  
are homogeneous and ' 2 Q.k/
1
;  2 Q.k/
1 for a k 2 Z n f0g. As for the case where

464
A. Heinle and V. Levandovskyy
k is negative a similar argument is applicable, we assume without loss of generality
that k is positive.
Due to Proposition 2.2, we have for some Q'; Q 2 KŒ
' D Q'./xk;
 D Q ./@k:
Using Corollary 1.8, we obtain
f D Q'./xk Q ./@k D Q'./xk@k Q 
1
q
  1
qn1  qnC2  q
1  q

:
As we know from Lemma 1.5 the equation
xk@k D
1
qTk1
k1
Y
iD0

 
i1
X
jD0
qj
holds. Thus, because we assumed f to be irreducible in KŒ, we must have
Q'; Q 2 K and k D 1 due to Lemma 1.5. Because f is monic, we must also have
Q' D Q 1.
As a result, the only possible f is f D . If we originally had chosen k to be
negative, the only possibility for f would be f D  C 1
q. This completes the proof.
Therefore, we have a procedure for factoring a homogeneous polynomial p 2 A1
(resp. p 2 Q1) of degree zero in KŒ. It is done using the following steps.
1. Rewrite p as an element in KŒ;
2. Factorize p in KŒ using commutative methods, i.e. obtain a list Œc; p1; : : : ; p` 2
K  KŒ`, ` 2 N, where c  p1 : : : p` D p.
3. For every pj, j 2 ` which is equal to  or  C 1 (resp.  C 1
q), remove pj from the
list and insert into position j and j C 1 the elements xi; @i resp. @i; xi.
4. Replace for every element in the list from the previous step  by x  @. Return the
resulting list.
Let us consider the complexity of the above steps to factor a homogeneous
element of degree zero in A1.
Ad step 1: The polynomial p has, due to the assumption of being homogeneous
of degree zero, the form
p D
n
X
iD0
pixi@i; n 2 N; pi 2 K (resp. K.q/):
(1)
In order to transform it into an element in KŒ, we have to apply the rewriting rule
stated in Lemma 2.1 for every term xi@i in p. For that, one makes use of the identity
xnC1@nC1 D xn@n  .  n/:

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
465
Thus, in order to perform step 1, we need to perform for every i 2 n a
multiplication of a polynomial in KŒ of degree i with a polynomial of degree 1.
Ad step 2: Unfortunately, the factorization problem even in the univariate case
does not have polynomial complexity in general. One might face exponential
complexity with respect to the bit-length of the coefﬁcients in K or it might even be
undecidable, depending on the choice of K.
An example for a polynomial-time complexity with respect to the bit-length
of the coefﬁcients would be K D Q, due to the famous LLL algorithm by
Lenstra, Lenstra and Lovász developed in 1982 [20]. For certain classes of ﬁelds,
including algebraic ones, polynomial time algorithms have been discovered in [5]
and [13]. For further reading on the complexity of the factorization problem we also
recommend [18] and [38]. As in Deﬁnition 1.9, we simply write !.n/ resp. !q.n/
for the amount of bit operations needed for factoring a univariate polynomial of
degree n.
Ad step 3: In order to ﬁnd and identify the polynomials, it does not require any
operations on the polynomials other than comparisons.
Ad step 4: For each monomial in each factor that has degree zero, we need to
replace  by x  @ and bring it into the normal form, i.e. each monomial in the end
must have the form xi@i for i  n. This can be calculated, up to a constant factor,
with the same number of operations as performed for step 1, since we only need to
reverse the mapping outlined there.
Thus, we can formulate the following corollary.
Corollary 2.4 Given p as in (1), let b be the maximal coefﬁcient in p with respect
to its bit-size. In order to obtain one factorization of p over Q1, it requires
O n  q.n; dlog jnŠje/ C !q.n; dlog jb  nŠje/
(2)
bit operations.
Example 2.5 Let K WD Q and p WD x3@3 C 4x2@2 C 3x@ 2 A1. Clearly p is
homogeneous of degree zero; rewritten in KŒ, one obtains p D 3 C 2 C .
This polynomial factorizes in KŒ to   .2 C  C 1/, which further factorizes as 
is reducible to x@.2C C1/ 2 A1. To get more (in fact, as we will see in the next
subsection, all) possible factorizations of p, we apply the commutation rules with x
resp. @ and obtain the following factorizations:
x  @  .2 C  C 1/ D x  .2 C 3 C 3/  @ D .2 C  C 1/  x  @:
2.2
Factoring Homogeneous Polynomials of Arbitrary Degree
Fortunately, the hard work is already done and factoring of homogeneous polyno-
mials of arbitrary degree is just a small further step.

466
A. Heinle and V. Levandovskyy
The reason is Proposition 2.2, which leads to the following steps to obtain one
factorization of a homogeneous polynomial p 2 Q.k/
1
resp. p 2 A.k/
1
of degree
k 2 Z.
1. Represent p as Qpxk resp. Qp@k, where Qp in A.0/
1 , written as polynomial in KŒ. We
need O.d2  q.d; dlog jb  dŠje//, where d WD minfdegx. p/; deg@. p/g and b 2 K
denotes the maximal coefﬁcient in p with respect to the bit-size, operations to
obtain this Qp. Afterwards, if k < 0, one additional application of a k-shift to Qp is
required.
2. Factorize Qp (which is homogeneous of degree zero) by using the steps shown in
the previous subsection.
Now we have everything we need to formulate an algorithm to ﬁnd one
factorization of a homogeneous element in A1 resp. Q1, namely Algorithm 1
which can be found below. The next corollary states a complexity estimate of the
Algorithm 1.
Corollary 2.6 Let p 2 Q1 be homogeneous of degree k 2 Z, and let all the
coefﬁcients in p have bit size at most b 2 N0. Then, due to Proposition 2.2, p can
be written in the form p D p0'jkj, where p0 is a polynomial of degree n 2 N0 in
K.q/Œ and ' 2 fx; @g. Obtaining one factorization in Q1 of p requires
O

n  q.n; dlog jnŠje/ C !q.n; dlog jb  nŠj/ C Sq.n; k; dlog jb  nŠje; /

bit operations, where .x/ D x C 1 if q D 1, and .x/ D q  x C 1 otherwise.
We also would like to address the topic how to obtain all possible factorizations of
a homogeneous polynomial. As mentioned before, the factorization of a polynomial
in a noncommutative ring is generally not unique in the classical sense, i.e. up
to multiplication by units or up to interchanging factors. Thus several different
factorizations can occur. For the homogeneous case, they can fortunately be easily
characterized by the commutation rules from Lemma 1.5 and the identities from
Lemma 2.3. This is proven by the following Lemma.
Lemma 2.7 Let z 2 Z and p 2 A.z/
1 , resp. p 2 Q.z/
1 , is monic. Suppose, that one
factorization of p has been constructed following Proposition 2.2 and has the form
Q./  T./   jzj, where
•
T./ D .x@/t.@x/s, t; s 2 N0, is a product of irreducible factors in KŒ, which
are reducible in A1, resp. Q1,
•
Q./ is the product of irreducible factors in both KŒ and A1 (resp. Q1/, and
•
 D x, if z < 0, and  D @ otherwise.
Let p1  : : :  pm for m 2 N be another nontrivial factorization of p. Then
this factorization can be derived from Q./  T./   jzj by using two operations,
namely (i) “swapping”, that is interchanging two adjacent factors according to the
commutation rules and (ii) “rewriting” of occurring  resp.  C 1 ( C 1
q in the
q-Weyl case) by x  @ resp. @  x.

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
467
Algorithm 1 HomogFac: factorization of a homogeneous polynomial in the ﬁrst
(q-)Weyl algebra
Input: h 2 A.m/
1
(resp. h 2 Q.m/
1 /, where m 2 Z
Output: . f1; : : : ; fn/ 2 An
1 resp. . f1; : : : ; fn/ 2 Qn
1, such that f1 	 : : : 	 fn D h, n 2 N
Assumption: h is normalized, i.e. the leading coefﬁcient is 1.
1: if m ¤ 0 then
2:
if m < 0 then
3:
Determine Oh 2 A.0/
1
such that h D Ohxm
4:
factor WD .x; : : : ; x
„ ƒ‚ …
m times
/
5:
else
6:
Determine Oh such that h D Oh@m
7:
factor WD .@; : : : ; @
„ ƒ‚ …
m times
/
8:
end if
9: else
10:
Oh WD h
11:
factor WD 1
12: end if
13: .Of1; : : : ; Ofl/ WD Factorization of Oh as element in KŒ (l 2 N)
14: . OOf1; : : : ; OOfl/ WD Substitute  by x 	 @ in .Of1; : : : ; Ofn/
15: result WD ./
16: for i from 1 to l do
17:
if OOfi D x 	 @ then
18:
Append x and @ to result
19:
else
20:
if OOfi D @ 	 x then
21:
Append @ and x to result
22:
else
23:
Append OOfi to result
24:
end if
25:
end if
26: end for
27: Append each element in factor to result
28: return result
Proof Since p is homogeneous, all pi for i 2 m are homogeneous. Thus each of
them can be written in the form pi D Qpi./   ei, where ei 2 Z, and  ei D xei,
if ei < 0 and  ei D @ei otherwise. With respect to the commutation rules as stated
in Corollary 1.8, we can swap the Qpi./ to the left for any 2  i  m. Note that
it is possible for them to be transformed to the form  resp.  C 1 ( C 1
q in the
q-Weyl case), after performing these swapping steps. I.e., we have commuting
factors, both belonging to Q./, as well as to T./ at the left. Our resulting product
is thus QQ./QT./ Qm
jD1  ej, where the factors in QQ./, resp. QT./, contain a subset of
the factors of Q./ resp. T./. By our assumption of p having degree z, we are able
to swap  z to the right in F WD Qm
jD1  ej, i.e., F D QF z for QF 2 A.0/
1 . This step may
involve combining x and @ to  resp.  C 1 ( C 1
q in the q-Weyl case). Afterwards,

468
A. Heinle and V. Levandovskyy
this is also done to the remaining factors in QF that are not yet polynomials in KŒ
using the swapping operation. These polynomials are the remaining factors that
belong to Q./, resp. T./, and can be swapped commutatively to their respective
positions. Since reverse engineering of those steps is possible, we can derive the
factorization p1 : : : pm from Q./  T./   z as claimed.
With the help of the above lemma, we are also able to formulate an algorithm
to ﬁnd all factorizations of a given homogeneous polynomial in A1, namely
Algorithm 2 as stated below.
In order to discuss the complexity of ﬁnding all factorizations of a homogeneous
element in A1 resp. Q1, we need an upper bound on the number of possible
factorizations. With the lemma it becomes clear, that unlike the rational (q-)Weyl
algebras (see Example 2.12), homogeneous elements in A1 resp. Q1 always have a
ﬁnite number of factorizations.
Algorithm 2 HomogFacAll: all factorizations of a homogeneous polynomial in the
ﬁrst (q-)Weyl algebra
Input: h 2 A.m/
1
(resp. h 2 Q.m/
1 ), where m 2 Z
Output: f. f1; : : : ; fn/ 2 An
1 j f1 	 : : : 	 fn D h; n 2 Ng
Assumption: h is normalized, i.e. the leading coefﬁcient is 1.
1: . f1; : : : ; f; g; : : : ; g/ := HomogFac(h) without lines 16 – 26
{ 2 N0; g 2 fx; @g; fi 2 A.0/
1 }
2: Rewrite each fi as element in KŒ
3: result WD fPermutations of . f1; : : : ; f; g; : : : ; g/ with respect to the commutation rulesg
4: for .g1; : : : ; gn/ 2 result do
5:
for i from 1 to n do
6:
if gi D  then
7:
gi WD x; @
8:
leftpart WD f.g1; : : : ; gk; x; gkC1. C 1/; : : : ; gi1. C 1// j k  i  1; gj 2
A.0/
1
for all k < j  i  1g
9:
rightpart WD f.giC1. C 1/; : : : ; gk1. C 1/; @; gk; : : : ; gn/ j k  i C 1; gj 2
A.0/
1
for all i C 1  j < kg
10:
Append each element in f.l1; : : : ; lj; r1 : : : rk/ j .l1; : : : ; lj/ 2 leftpart; .r1; : : : ; rk/ 2
rightpart for j; k 2 Ng to result.
11:
end if
12:
if gi D  C 1 (resp. gi D  C 1
q) then
13:
gi WD @; x
14:
leftpart WD f.g1; : : : ; gk; @; gkC1.  1/; : : : ; gi1.  1// j k  i  1; gj 2
A.0/
1
for all k < j  i  1g
15:
rightpart WD f.giC1.  1/; : : : ; gk1.  1/; x; gk; : : : ; gn/ j k  i C 1; gj 2
A.0/
1
for all i C 1  j < kg
16:
Append each element in f.l1; : : : ; lj; r1 : : : rk/ j .l1; : : : ; lj/ 2 leftpart; .r1; : : : ; rk/ 2
rightpart for j; k 2 Ng to result.
17:
end if
18:
end for
19: end for
20: return result

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
469
Lemma 2.8 Let p D p0  'k be a homogeneous polynomial in A1 resp. Q1, where
k 2 N, p0 2 KŒ and ' 2 fx; @g. Furthermore let n WD deg. p0/. Then the number
of different factorizations of p is at most
jn
2
k
C 1
2
 nŠ 
 
n C k
k
!
:
Proof Let us assume that p0 decomposes in KŒ into Qn 2 N factors, where Qn  n.
As all of these factors commute, there are up to QnŠ different possibilities to rearrange
them. For every such arrangement of the factors of p0, we can place the k available
' at any position (with applied shift to the respective factors of p0), which leads
to
QnCk
k

possibilities each time. Finally, due to Lemma 2.3, the linear factors of
p0 might split into f1  f2, where . f1; f2/ 2 f.x; @/; .@; x/g. The element f1 can be
swapped into up to j  Qn C 1 positions to its left, and the element f2 can be swapped
into QnjC1 positions to its right. The possibilities maximize if j D
j
Qn
2
k
C1, which
we can consider as upper bound. Hence, this would add for each instance at most
 n
2
˘ C 12 new distinct factorizations. As p0 factors at most into linear factors, we
can assume Qn D n and obtain the stated upper bound.
Remark 2.9 In [3] we prove that in the case of the polynomial nth (q-)Weyl algebra,
a nonzero polynomial has only ﬁnitely many different factorizations. In yet another
recent paper [10] we have developed an algorithm for computing all factorizations
of a given polynomial in the nth (q-)Weyl algebra.
The termination of Algorithms 1 and 2 is clear, as we only iterate over ﬁnite sets.
The correctness follows by our preliminary work.
Corollary 2.10 With the notations as in Corollary 2.6, the number of different
factorizations of p by Lemma 2.8 is bounded by
jn
2
k
C 1
2
 nŠ 
 
n C jkj
jkj
!
:
In order to obtain all these different factorizations, it would require
O
 
n  q.n; dlog jnŠje/ C !q.n; b C dlog jnŠje/
C
 
n2 C .
jn
2
k
C 1/2  nŠ 
 
n C jkj
jkj
!!
Sq.n; 1; dlog jb  nŠje; /
!
bit operations, where .x/ D x C 1 if q D 1, and .x/ D q  x C 1 otherwise.

470
A. Heinle and V. Levandovskyy
2.3
Application to the Rational First Weyl Algebra
In practice, one is often interested in ordinary differential equations over the ﬁeld of
rational functions in the indeterminate x. We refer to the corresponding algebra of
operators as the ﬁrst rational Weyl algebra and denote it as B1. The commutation
rules over B1 are extended from those in A1, that is @g.x/ D g.x/@ C @g.x/
@x
for
g.x/ 2 K.x/. Unlike in the polynomial Weyl algebra, an inﬁnite number of nontrivial
factorizations of an element is possible. The easiest example is the polynomial @2 2
A1, having except @  @ a family of nontrivial factorizations .@ C
1
xCc/.@ 
1
xCc/ for
all c 2 K over B1; the only factorization in A1 is @  @. Thus, at ﬁrst glance, the
factorization problem in both the rational and the polynomial Weyl algebras seems
to be distinct in general. But there are still many things in common.
The formalism of the Ore localization of a ring (cf. e. g. [4]) can be brieﬂy
recalled as follows. Let R be a domain and f0g ¨ S 	 R be a multiplicatively
closed Ore set in R, i. e. the Ore condition holds for S and R (the condition will
appear below). Then there exists a localized ring, denoted by S1R together with
the classical embedding 	 W R ! S1R; r 7! 11r, such that 	.S/ 	 S1R becomes
invertible. Note, that the presentation of a left fraction s1r 2 S1R via the tuple
.s; r/ 2 S  R deﬁnes an equivalence class and is by no means unique.
Rational (q-)Weyl algebras can be recognized as Ore localizations of polynomial
(q-)Weyl algebras with respect to the multiplicatively closed set S WD KŒx n f0g,
which can be proven to be an Ore set both in A1 and in Q1. Let us clarify the
connection between factorizations in an algebra and in its Ore localization.
Lemma 2.11 Let R be a domain and S 	 R be an Ore set in R. Then for any m 2 N
and for any h1; : : : ; hm 2 S1R n f0g there exist q 2 S and Qh1; : : : ; Qhm 2 R n f0g such
that q  h1 : : : hm D Qh1 : : : Qhm.
Proof Suppose that h D h1h2 D .s1
1 r1/  .s1
2 r2/ for ri 2 R; si 2 S. Then by the Ore
condition 9Or1 2 R; Os2 2 S such that r1s1
2
D Os1
2 Or1. Thus h D s1
1 Os1
2 Or1r2 and for
q D Os2s1 2 S and Qh1 D Or1; Qh2 D r2 2 R one has qh D Qh1Qh2 2 R. The rest follows by
induction.
Thus we can lift any factorization from the ring S1R to a factorization in R by a
left multiplication with an element of S.
Example 2.12 As it was mentioned before, in the ﬁrst rational Weyl algebra one has
@2 D .@ C
1
xCc/.@ 
1
xCc/ for all c 2 K. Let us ﬁx c and analyze the lifting.
.@C.xCc/1/.@.xCc/1/ D .xCc/1 ..xCc/@C1/.xCc/1 ..xCc/@1/
Since @  .x C c/ D .x C c/@ C 1, one has ..x C c/@ C 1/  .x C c/1 D @ and thus
@2 D .x C c/1  @  ..x C c/@  1/;

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
471
from which we read off the corresponding factorization
.x C c/  @2 D @  ..x C c/@  1/
in the polynomial ﬁrst Weyl algebra. In the notation of the preceding Lemma q D
x C c; Qh1 D @; Qh2 D .x C c/@  1. In particular, the inﬁnite family of factorizations
we started with does not propagate to the polynomial case: as we see, the parameter
c is present in the lifted polynomial .x C c/@2. By our approach we can prove, that
for any c 2 K the only factorizations of x@2 C c@2 in A1 are
.x C c/  @2 D @  ..x C c/@  1/:
Proposition 2.13 Let U WD fr 2 R j 11r 2 S1R is invertible g 	 R. Then
1. r 2 U  R , 9w 2 R W wr 2 S.
2. Let R 2 fA1; Q1g and S D KŒx n f0g. Let h D h1 : : : hm be a factorization of a
fraction h 2 S1R n f0g. Then there exist q 2 S and an associated factorization
R 3 qh D Qh1 : : : Qhm, where Qhi 2 R n f0g and deg@ hi D deg@ Qhi holds.
3. Let r 2 R and 11r be an irreducible element in S1R. Then in any factorization
r D pq, where p; q 2 R n U.R/ one has p 2 U or q 2 U, i. e. r is not necessarily
irreducible in R.
4. If r 2 R is irreducible in R, then 11r is not necessarily irreducible in S1R.
Surprisingly, irreducible Œ1; 1-homogeneous polynomials remain irreducible in
the rational (q-)Weyl algebra, as the following Theorem shows.
Theorem 2.14 Let p be an irreducible Œ1; 1-homogeneous polynomial in A1.
Then, in the ﬁrst rational Weyl algebra B1, 11p is irreducible up to an invertible
multiple.
Proof The following monic homogeneous polynomials are irreducible in A1:
1. @, which is also irreducible over B1,
2. x, which is a unit in B1,
3. a monic irreducible p over KŒ, p … f;  C 1g.
Therefore, the only interesting case is the third one. Now let p be a monic irreducible
element in A.0/
1
n f;  C 1g. From now on we identify p with 11p 2 B1. Suppose,
that p is nontrivially reducible over B1, say p D p1  p2 for p1; p2 2 B1 n A1,
both non-invertible, thus deg@. p1/; deg@. p2/  1 and therefore deg@. p/  2. By
Lemma 2.11, there exist q 2 KŒx, Qp1; Qp2 2 A1 n KŒx, such that qp D Qp1Qp2.
Case 1 q D xk, k 2 N; q is homogeneous.
Then all possible factorizations of xk  p in A1 are due to Lemma 1.5 of the form
xk`p.  `/x`; ` 2 N0; `  k:

472
A. Heinle and V. Levandovskyy
As shifts of irreducible elements in a univariate commutative polynomial ring KŒ
are irreducible (see e.g. [1], Section 4.2) and deg@. p/  2, we see that Qp1 and Qp2 as
supposed above do not exist.
Case 2 q D Pn
iD0 qixi, n  1, qi 2 K, qn ¤ 0; q is not homogeneous.
Note, that the product qp in this case is not homogeneous with respect to the
Œ1; 1-grading. Let m 2 N; m < n be minimal, satisfying qm ¤ 0, then the sum in
qp D Pn
iDm qixip coincides with the graded decomposition of qp.
With notations from the proof of Lemma 1.12, suppose that ˛. Qp1/ D 
 2 Z and
˛. Qp2/ D  2 Z. Then
qmxmp D .qp/˛.qp/ D . Qp1Qp2/˛. Qp1Qp2/ D . Qp1/
. Qp2/:
Since qm ¤ 0, we can proceed like in Case 1, where two kinds of factorization are
possible. Let us ﬁrst write . Qp1/
 D xm`p.  `/ for some 0  `  m and . Qp2/ D
qmx`, then deg@. Qp1/  deg@. Qp1/
 D deg@. p/ D deg@.qp/ D deg@. Qp1Qp2/ D
deg@. Qp1/ C deg@. Qp2/, indicating that deg@. Qp2/ D 0 and deg@. Qp1/ D deg@. p/. That
is, Qp2 must be in KŒx and therefore cannot be as supposed above. The second case,
where deg@. Qp2/ D deg@. p/ is analogous and thus the proof is completed.
Analogously to the case of Wel algebra, it turns out that the set S D KŒx n f0g
is an Ore set in the ﬁrst polynomial q-Weyl algebra Q1. Therefore W1 WD S1Q1 is
called the ﬁrst rational q-Weyl algebra.
Corollary 2.15 Let p be an irreducible Œ1; 1-homogeneous polynomial in Q1.
Then, in the ﬁrst rational q-Weyl algebra W1, 11p is irreducible up to an invertible
multiple.
Proof By inspecting the proof of Theorem 2.14 above, we see that we only have
to replace  C 1 with  C q1 in the list of monic irreducible elements; the rest of
arguments hold verbatim.
3
Implementation and Benchmarking
We implemented the presented algorithms in SINGULAR:PLURAL, and since version
3-1-3 they are part of the distribution of SINGULAR. The following example shows
how to use the library containing them.
Example 3.1 Let K D Q and h 2 Q1 be the polynomial
h WD q25x10@10 C q16.q4 C q3 C q2 C q C 1/2x9@9
Cq9.q13 C 3q12 C 7q11 C 13q10 C 20q9 C 26q8
C30q7 C 31q6 C 26q5 C 20q4 C 13q3 C 7q2 C 3q C 1/x8@8

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
473
Cq4.q9 C 2q8 C 4q7 C 6q6 C 7q5 C 8q4 C 6q3 C 4q2 C 2q C 1/
.q4 C q3 C q2 C q C 1/.q2 C q C 1/x7@7
Cq.q2 C q C 1/.q5 C 2q4 C 2q3 C 3q2 C 2q C 1/
.q4 C q3 C q2 C q C 1/.q2 C 1/.q C 1/x6@6
C.q10 C 5q9 C 12q8 C 21q7 C 29q6 C 33q5
C31q4 C 24q3 C 15q2 C 7q C 12/x5@5 C 6x3@3 C 24:
We can use SINGULAR to obtain all of its factorizations in the following way.
LIB "ncfactor.lib";
ring R = (0,q),(x,d),dp;
def r = nc_algebra (q,1);
setring(r);
poly h = ... //See the polynomial defined above.
homogfacFirstQWeyl_all(h);
[1]:
[1]:
1
[2]:
x5d5+x3d3+4
[3]:
x5d5+6
[2]:
[1]:
1
[2]:
x5d5+6
[3]:
x5d5+x3d3+4
As one can see here, the output is a list containing lists containing elements in
Q1. Those elements in Q1 are factors of h, and each list represents one possible
factorization of h.
The command homogfacFirstQWeyl can be used if the user is interested in
just one factorization. The output is just one list containing elements in Q1.
The calculation was run on a computer with a 4-core Intel CPU (Intel R
CoreTMi7-3520M CPU with 2.90 GHz, two physical cores, two hardware threads,
32 K L1[i,d], 256 K L2, 4 MB L3 cache), 16 GB RAM and Ubuntu 12.04LTS as
operating system. The computation time was 0.62 s.
Remark 3.2 The factorization of products of homogeneous elements in A1 can be
observed to be faster than the factorization of the same products in Q1. The product
of factors in the example above, i.e. .x5@5 C 6/.x5@5 C x3@3 C 4/; viewed as an
element in A1, takes 0.08 s to factorize compared to 0.62 s in the q-Weyl case. This

474
A. Heinle and V. Levandovskyy
seems to be way slower considering that both algorithms have the same complexity.
But this slowdown is not due to more steps that need to be done in the algorithm for
the q-Weyl algebra, but due to the parameter q and the speed of calculating in Q.q/
as the baseﬁeld instead of just in Q.
In fact, there is no computer algebra system known to the authors that can factor
polynomials in the ﬁrst q-Weyl algebra Q1. Therefore, we cannot compare our
algorithms in this case to other implementations.
For the ﬁrst Weyl algebra A1, there exist other implementations. We can draw
a comparison to the DFactor method in the DETools package of MAPLE
and the nc_factorize_all method in the NCPoly library of REDUCE.
Furthermore, we were provided with a wrapper for the algorithm “Coprime Index 1
Factorizations” (CP1F) mentioned in [36] dealing with polynomials of the form
KŒxŒ in order to be able to compare it to the algorithm for this special case
explicitly. This guarantees a fair evaluation on a core level for an intersection
with homogeneous polynomials that does not invoke the complete factorization
machinery implemented in DFactor.
In the next subsection, we will only compare DFactor and nc_factorize_
all to our implementation. Later on, we will compare the wrapper of CP1F
implemented in MAPLE to our implementation, as we have to choose for the
comparison a special set of polynomials, namely the homogeneous ones supported
by CP1F.
3.1
Comparison to DFactor and nc_factorize_all
We used version 17 of MAPLE and version 3.8 of REDUCE. In order to make our
benchmarks reproducible, we utilized the SDEVAL framework presented in [15].
The sources and the results of the computations can be downloaded from
https://cs.uwaterloo.ca/~aheinle/software_projects.html.
Remark 3.3 As mentioned before, the algorithm DFactor implemented in MAPLE
factorizes over the rational Weyl algebra, i.e. the variable x is a rational argument
having adjusted commutation rules with @. This is a weaker assumption on the input
since the ring that is dealt with there is larger. The comparison is still valid, since
we have shown in Theorem 2.14 that a factorization of a homogeneous polynomial
into irreducible elements over A1 cannot be further reﬁned in the ﬁrst Weyl algebra
with rational coefﬁcients.
We will not go into detail about how the algorithm in MAPLE works. The
interested reader can ﬁnd details in [35]. It works with collections of exponential
parts and their multiplicities at all singularities of a given differential operator f and
subsequent calculation of left and right hand factors.
The algorithm implemented in REDUCE is also working with the polynomial
Weyl algebra. In fact, the algorithm written there can be applied to a broad class of
polynomial noncommutative rings.

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
475
Details about the functionality of the algorithm in REDUCE are unfortunately
not available. In order to understand these, we have analyzed the code that is given
open source. It makes an Ansatz for coefﬁcients of elements of smaller total degree,
obtains a system of commutative polynomial equations and, at the end, uses several
Gröbner basis computations in order to ﬁnd its solutions.
Example 3.4 Consider again (cf. Remark 3.2) the element
h WD .x5@5 C 6/  .x5@5 C x3@3 C 4/ 2 A1
in the expanded form.
•
SINGULAR: Found two factorizations in less than a second.
•
MAPLE: Found one factorization after 29 s; The factors are huge (size of the
output ﬁle is around 100 KB).
•
REDUCE: Did not terminate after 9 h of calculation.
Example 3.5 We experimented with other randomly generated products of two
homogeneous polynomials in the ﬁrst Weyl algebra. The following collection is
representative.
f0 D .x10@10 C 5x@ C 7/  x2  .x11@11 C 3x7@7 C x@ C 4/,
f1 D .x5@5 C 6/  .x5@5 C x3@3 C 4/  @10,
f2 D .5x10@10 C7x9@9 C8x8@8 C9x7@7 C6x6@6 C5x5@5 C8x4@4 C5x3@3 C9x2@2 C
9x@ C 6/  @20,
f3 D .7x15@15Cx13@13x12@123x10@10C2x9@9Cx8@8Cx7@7x5@59x4@4Cx@1/
.8x13@13C3x12@12Cx11@112x10@10C10x8@83x7@7C2x5@5Cx4@4C38x@C1/@6,
f4 D .x10@10 C23x9@9 C3x8@8 9x7@7 x5@5 C3x4@4 C6x3@3 C4x@C1/.x8@8 C
4x7@7  x6@6 C 4x5@5  5x4@4 C x2@2  7x@  10/  x10,
f5 D .2x24@24Cx23@23 C4x22@22 110x21@21 Cx20@20 Cx19@19Cx18@18 Cx17@17 C
5x16@16  7x15@15 C 4x14@14  x13@13 C x12@12  2x11@11 C x9@9 C 5x8@8 C x7@7 C
6x5@5 Cx4@4 C2x3@3 C219x2@2 Cx@1/.x25@25 Cx24@24 32x23@23 Cx22@22 C
7x21@21 C 61x20@20  2x18@18 C x16@16 C 2x15@15  2x14@14  x12@12  3x11@11 C
2x10@10 C 2x8@8  9x7@7  x6@6 C x5@5 C 4x3@3 C x2@2/,
f6 D .x10@10C13x9@9x8@8C4x7@7C13x6@63x5@537x4@4x3@3Cx2@2Cx@
1/.x10@1023x9@9C3x8@8Cx7@7x6@62x5@52x4@4C2x3@3x2@22x@2/,
f7 D .98x15@15 C40x14@14 C98x13@13 C44x12@12 C55x11@11 C96x10@10 C95x9@9 C
7x8@8 C 56x7@7 C 56x6@6 C 40x5@5 C 11x4@4 C 40x3@3 C 78x2@2 C 13x@ C 19/ 
.61x15@15 C 50x14@14 C 83x13@13 C 11x12@12 C 89x11@11 C 55x10@10 C 81x9@9 C
63x8@8 C 22x7@7 C 10x6@6 C 35x5@5 C 90x4@4 C 60x3@3 C 20x2@2 C 30x@ C 43/,
f8 D .85x20@20C80x19@19C27x18@18C74x17@17C49x16@16C95x15@15C96x14@14C
37x13@13 C26x12@12 C93x11@11 C39x10@10 C19x9@9 C48x8@8 C82x7@7 C26x6@6 C
26x5@5 C 7x4@4 C 61x3@3 C 8x2@2 C 81x@ C 88/2.

476
A. Heinle and V. Levandovskyy
The results concerning the factorization of fi are listed in the next table. An entry
labeled with “– NT –” stands for “no termination after 2 h”.
Polynomial
SINGULAR
MAPLE
REDUCE
f0
0.08 s; 12 factorizations
– NT –
SEGFAULT
f1
0.77 s; 132 factorizations
11.18 s; 1 factorization
– NT –
f2
0.18 s; 21 factorizations
– NT –
– NT –
f3
5.88 s; 504 factorizations
– NT –
– NT –
f4
0.76 s; 132 factorizations
– NT –
– NT –
f5
28.23 s; 230 factorizations
– NT –
– NT –
f6
0.06 s; 6 factorizations
– NT –
– NT –
f7
0.08 s; 2 factorizations
–NT –
– NT –
f8
0.08 s; 1 factorization
– NT –
– NT –
The conclusion we can draw at this point is: Even if homogeneous polynomials
seem to be easy objects to factorize according to the algorithm we propose, they
seem to form a worst case class for the implementations in REDUCE and MAPLE.
Therefore, with our algorithm we are now able to factorize more polynomials
using computer algebra systems: homogeneous polynomials in Q1 in general, and
for A1 we have broaden the range of polynomials that can be factorized in a feasible
amount of time or even sometimes at all.
Moreover, our approach can be used to enhance existing algorithms and their
implementations as follows. Namely, the check of a given polynomial for the
homogeneity is a very cheap procedure as we have seen in Lemma 1.11. Moreover,
for the case of a homogeneous polynomial our algorithm can be applied, hence
factoring homogeneous polynomials—appearing, for instance, as factors of a bigger
polynomial—can be eliminated from further computations.
3.2
Comparison to CP1F
As indicated before, we were provided a wrapper to the function implemented in
MAPLE that represents CP1F, whose supported input polynomials are of the form
KŒxŒ. Hence, there is a nontrivial intersection with homogeneous polynomials
in A1. Comparing it to the implementation of our Algorithm 1 on homogeneous
polynomials of -degree between 20 and 400, we obtain the following timings.

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
477
Example
Algorithm 1
CP1F
Degree 20
0.04 s
0.17 s
Degree 40
0.07 s
0.61 s
Degree 60
0.11 s
1.66 s
Degree 100
0.26 s
6.39 s
Degree 200
2.03 s
296.78 s
Degree 250
2.86 s
454.17 s
Degree 300
5.9 s
370.49 s
Degree 350
8.78 s
1741.53 s
Degree 400
14.62 s
4355.32 s
Fig. 1 Visualization of
asymptotic behaviour of
CP1F and Algorithm 1
0
40
80
120 160 200 240 280 320 360 400
0
1000
2000
3000
4000
5000
degree in q
time (in s.)
Algorithm 1
CP1F
We can derive from this table that for small degrees, the timings are close to each
other. With increasing degree though, the difference in performance becomes more
visible, and one observes also different asymptotic behaviours, as Fig. 1 visualizes.
4
Conclusion
With this paper, we contributed an algorithm for the factorization problem consider-
ing Œ1; 1-homogeneous polynomials in the ﬁrst q-Weyl algebra over an arbitrary
ﬁeld K. For computable ﬁelds, we discussed a complexity estimate for our approach.
Our approach is implemented as the library ncfactor.lib, which is distributed
with the computer algebra system SINGULAR:PLURAL since version 3-1-3, and
several improved and extended versions have been released since then.
Furthermore, we also considered the special case of the ﬁrst Weyl algebra and
showed that our algorithm beats for the large class of Œ1; 1- homogeneous polyno-
mials current implementations in terms of speed and elegancy of the solutions. Due
to Theorem 2.14, we can even state that the factorizations that our algorithm ﬁnds
cannot be further reﬁned when factoring over the rational Weyl algebra. This result

478
A. Heinle and V. Levandovskyy
is interesting by itself and could play a role for future research on the question how
to characterize arbitrary irreducible elements in the polynomial ﬁrst Weyl algebra,
that become reducible after localization.
We can construct a family of polynomials where the implementation in SIN-
GULAR:PLURAL is the only one that is able to factorize those elements in a
feasible amount of time and memory consumption. Since our techniques are easy to
implement, they can be used to extend existing implementations in order to broaden
the range of polynomials in the ﬁrst Weyl algebra that we are nowadays able to
factorize using a computer algebra system.
Acknowledgements We would like to thank to Dima Grigoriev for discussions on the subject, and
Mark van Hoeij for his expert opinion. Many thanks to Mark Giesbrecht for his helpful suggestions
and comments. We are grateful to Wolfram Koepf and Martin Lee for providing us with interesting
examples, and to Daniel Rettstadt and Johannes Hoffmann for stimulating exchange of opinions.
We acknowledge the helpful suggestions and comments of the anonymous referees.
References
1. J.A. Beachy, W.D. Blair, Abstract Algebra (Waveland Press, Long Grove, IL, 2006)
2. R. Beals, E. Kartashova, Constructively factoring linear partial differential operators in two
variables. Theor. Math. Phys. 145(2), 1511–1524 (2005). http://link.springer.com/article/10.
1007/s11232-005-0178-7
3. J.P. Bell, A. Heinle, V. Levandovskyy, On noncommutative ﬁnite factorization domains. Trans.
Am. Math. Soc. 369, 2675–2695 (2017). http://doi.org/10.1090/tran/6727
4. J. Bueso, J. Gómez-Torrecillas, A. Verschoren, Algorithmic Methods in Non-Commutative
Algebra. Applications to Quantum Groups (Kluwer Academic Publishers, Dordrecht, 2003)
5. A.L. Chistov, Algorithm of polynomial complexity for factoring polynomials and ﬁnding the
components of varieties in subexponential time. J. Sov. Math. 34(4), 1838–1882 (1986)
6. W. Decker, G.M. Greuel, G. Pﬁster, H. Schönemann, SINGULAR 4-1-0 – a computer algebra
system for polynomial computations (2016). http://www.singular.uni-kl.de
7. M. Foupouagnigni, W. Koepf, A. Ronveaux, Factorization of fourth-order differential equations
for perturbed classical orthogonal polynomials.
J. Comput. Appl. Math. 162(2), 299–326
(2004)
8. M. Giesbrecht, Factoring in skew-polynomial rings over ﬁnite ﬁelds. J. Symb. Comput. 26(4),
463–486 (1998)
9. M. Giesbrecht, Y. Zhang, Factoring and decomposing ore polynomials over fq(t),
in
Proceedings of the 2003 International Symposium on Symbolic and Algebraic Computation,
ISSAC ’03 (ACM, New York, NY, 2003), pp. 127–134. http://doi.acm.org/10.1145/860854.
860888
10. M. Giesbrecht, A. Heinle, V. Levandovskyy, Factoring linear differential operators in n
variables. J. Symb. Comput. 75, 127–148 (2016). http://dx.doi.org/10.1016/j.jsc.2015.11.011
11. G.M. Greuel, G. Pﬁster, A Singular Introduction to Commutative Algebra. With contributions
by O. Bachmann, C. Lossen, H. Schönemann, 2nd extended ed. (Springer, Berlin, 2007)
12. G.M. Greuel, V. Levandovskyy, A. Motsak, H. Schönemann, PLURAL. A SINGULAR
4-1-0 Subsystem for Computations with Non-commutative Polynomial Algebras (Centre for
Computer Algebra, TU Kaiserslautern, 2016). http://www.singular.uni-kl.de
13. D. Grigoriev, Factoring polynomials over a ﬁnite ﬁeld and solving systems of algebraic
equations. Zapiski Nauchnykh Seminarov POMI 137, 20–79 (1984)

Factorization of Z-Homogeneous Polynomials in the First q-Weyl Algebra
479
14. D. Grigoriev, F. Schwarz, Factoring and solving linear partial differential equations. Computing
73(2), 179–197 (2004). https://doi.org/10.1007/s00607-004-0073-3
15. A. Heinle, V. Levandovskyy, The SDEval benchmarking toolkit. ACM Commun. Comput.
Algebra 49(1), 1–9 (2015). http://doi.org/10.1145/2768577.2768578
16. A. Heinle, V. Levandovskyy, A factorization algorithm for G-algebras and applications,
in Proceedings of the International Symposium on Symbolic and Algebraic Computation
(ISSAC’16) (ACM, New York, NY, 2016). http://doi.org/10.1145/2930889.2930906
17. V. Kac, P. Cheung, Quantum Calculus (Springer, New York, NY, 2002)
18. E. Kaltofen, On the complexity of factoring polynomials with integer coefﬁcients. Ph.D. thesis,
Rensselaer Polytechnic Institute (1982)
19. M. Kashiwara, Vanishing cycle sheaves and holonomic systems of differential equations, in
Algebraic Geometry. Springer Lecture Notes in Mathematics, vol. 1016 (Springer, Berlin,
1983), pp. 134–142
20. A.K. Lenstra, H.W. Lenstra, L. Lovász, Factoring polynomials with rational coefﬁcients. Math.
Ann. 261(4), 515–534 (1982)
21. A. Loewy, Über reduzible lineare homogene Differentialgleichungen. Math. Ann. 56, 549–584
(1903). http://dx.doi.org/10.1007/BF01444307
22. A. Loewy, Über vollständig reduzible lineare homogene Differentialgleichungen. Math. Ann.
62, 89–117 (1906). http://dx.doi.org/10.1007/BF01448417
23. B. Malgrange, Polynômes de Bernstein-Sato et cohomologie evanescente. Astérisque 101–102,
243–267 (1983)
24. H. Melenk, J. Apel, REDUCE Package NCPOLY: Computation in Non-Commutative Polyno-
mial Ideals (Konrad-Zuse-Zentrum (ZIB), Berlin, 1994)
25. M.B. Monagan, K.O. Geddes, K.M. Heal, G. Labahn, S.M. Vorkoetter, J. McCarron,
P. DeMarco, Maple Introductory Programming Guide (Maplesoft, Waterloo, ON, 2008)
26. A.F. Nikiforov, V.B. Uvarov, Special Functions of Mathematical Physics: A Uniﬁed Introduc-
tion with Applications (Birkhäuser, Boston, MA, 1988)
27. M. Saito, B. Sturmfels, N. Takayama, Gröbner Deformations of Hypergeometric Differential
Equations (Springer, Berlin, 2000)
28. F. Schwarz, Alltypes in the web. ACM Commun. Comput. Algebra 42(3), 185–187 (2009).
http://doi.acm.org/10.1145/1504347.1504379
29. E. Shemyakova, Parametric factorizations of second-, third- and fourth-order linear partial
differential operators with a completely factorable symbol on the plane. Math. Comput. Sci.
1(2), 225–237 (2007). http://dx.doi.org/10.1007/s11786-007-0019-1
30. E. Shemyakova, Multiple factorizations of bivariate linear partial differential operators,
in
Proceedings of the CASC 2009 (Springer, Berlin, 2009), pp. 299–309
31. E. Shemyakova, Reﬁnement of two-factor factorizations of a linear partial differential operator
of arbitrary order and dimension. Math. Comput. Sci. 4, 223–230 (2010). http://dx.doi.org/10.
1007/s11786-010-0052-3
32. S.P. Tsarev, Problems that appear during factorization of ordinary linear differential operators.
Program. Comput. Softw. 20(1), 27–29 (1994)
33. S.P. Tsarev, An algorithm for complete enumeration of all factorizations of a linear ordinary
differential operator, in Proceedings of the 1996 International Symposium on Symbolic and
Algebraic Computation (ACM, New York, 1996), pp. 226–231
34. M. van Hoeij, Factorization of linear differential operators. Nijmegen (1996). http://books.
google.de/books?id=rEmjPgAACAAJ
35. M. van Hoeij, Factorization of differential operators with rational functions coefﬁcients.
J. Symb. Comput. 24(5), 537–561 (1997). http://dx.doi.org/10.1006/jsco.1997.0151
36. M. van Hoeij, Formal solutions and factorization of differential operators with power series
coefﬁcients. J. Symb. Comput. 24(1), 1–30 (1997). http://dx.doi.org/10.1006/jsco.1997.0110

480
A. Heinle and V. Levandovskyy
37. M. van Hoeij, Q. Yuan, Finding all Bessel type solutions for linear differential equations with
rational function coefﬁcients, in Proceedings of the 2010 International Symposium on Symbolic
and Algebraic Computation, ISSAC ’10 (ACM, New York, NY, 2010), pp. 37–44. http://doi.
acm.org/10.1145/1837934.1837948
38. J. von zur Gathen, J. Gerhard, Modern Computer Algebra
(Cambridge University Press,
Cambridge, 2013)

Complexity of Membership Problems
of Different Types of Polynomial Ideals
Ernst W. Mayr and Stefan Toman
Abstract We survey degree bounds and complexity classes of the word problem for
polynomial ideals and related problems. The word problem for general polynomial
ideals is known to be exponential space-complete, but there are several interesting
subclasses of polynomial ideals that allow for better bounds. We review complexity
results for polynomial ideals with low degree, toric ideals, binomial ideals, and
radical ideals. Previously known results as well as recent ﬁndings in our project
“Degree Bounds for Gröbner Bases of Important Classes of Polynomial Ideals and
Efﬁcient Algorithms” are presented.
Keywords Polynomial ideal • Binomial ideal • Gröbner basis • Degree bound •
Radical • Thue system • Cellular decomposition • Computational complexity
Subject Classiﬁcations 13P10, 14Q20, 03D40, 08A50, 03D03, 06B10
1
Introduction
Solving systems of polynomial equations is one of the most common problems in
mathematics. Objects are modelled as polynomial equations and the solutions of
these equations themselves or properties of them need to be found. These problems
turn out to be inherently hard and it is a common technique to ﬁrst deduce bases
with certain properties that make solving the problems easier. The goal of our
project “Degree Bounds for Gröbner Bases of Important Classes of Polynomial
Ideals and Efﬁcient Algorithms” in the priority program SPP 1489 “Algorithmic
E.W. Mayr • S. Toman ()
Institut für Informatik, TU München, München, Germany
e-mail: mayr@in.tum.de; toman@tum.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_20
481

482
E.W. Mayr and S. Toman
and Experimental Methods in Algebra, Geometry, and Number Theory” of Deutsche
Forschungsgemeinschaft (DFG) was to ﬁnd upper and lower complexity bounds for
solving different subclasses of polynomial equations. In this paper we report on
results that were previously known and the ones found during this project.
The special case of linear equations is well-understood. These systems can be
transformed to row-echelon form in polynomial time using the Gaussian algorithm.
Several problems like ﬁnding solutions of the system or the word problem can be
solved easily once the system is in row-echelon form. The corresponding problems
for non-linear systems of equations are inherently much harder. According to the
Abel-Rufﬁni theorem solutions of these systems cannot even be expressed in general
using simple formulas involving roots only [1]. Nevertheless, there is also a normal
form of these systems called Gröbner bases that allows for easier computations of
many problems.
2
General Polynomial Ideals
Gröbner bases were introduced in 1965 by Buchberger in his PhD thesis [4].
They can be employed to solve many problems in computer algebra, the most
immediate being the word problem for polynomial ideals. This problem is given
a list of multivariate polynomial equations to decide whether another polynomial
equation is contained in the ideal they span, i.e. whether the latter is already
implied by these equations. The word problem can be solved using Gröbner bases
and Buchberger also presented an algorithm for this problem using the so-called
Buchberger criterion.
At ﬁrst, it was only known that Buchberger’s algorithm runs in ﬁnite time without
having better space or runtime bounds. In 1982 Mayr and Meyer proved a lower
bound on the worst-case space usage of each algorithm solving the word problem
for polynomial ideals that is exponential in the number of variables appearing in the
equations [18].
Theorem 2.1 ([18]) There is a constant  2 Q with  > 0 such that any algorithm
which is able to decide the word problem for polynomial ideals contained in
QŒx1; : : : ; xn for some n 2 N>0 requires space exceeding 2n on inﬁnitely many
instances of this problem with different sizes.
Their result was slightly improved in 1991 by Yap who changed the constant in
the exponent [27].
The time and space requirements of algorithms computing Gröbner bases heavily
depend on the number of indeterminates of the polynomial ring. For this reason
it is important to have degree bounds, for instance the ones by Hermann [10]
and Dubé [6]. They found degree bounds double-exponential in the number of
indeterminates.

Complexity of Membership Problems of Different Types of Polynomial Ideals
483
Theorem 2.2 ([6]) Let f1; : : : ; fs 2 R Œx1; : : : ; xn be polynomials with deg.fi/  d
for all i 2 f1; : : : ; sg over a ring R for some d; s 2 N>0. Every reduced Gröbner basis
of hf1; : : : ; fsi consists of polynomials g1; : : : ; gr 2 R Œx1; : : : ; xn for some r 2 N>0
with
deg.gi/  2
d2
2 C d
2n1
for all i 2 f1; : : : ; rg.
Using those bounds, Kühnle and Mayr showed in 1996 that Gröbner bases can
indeed be computed using exponential space in the number of indeterminates [15].
Thus, the lower and upper bounds for the word problem for polynomial ideals
coincided and the problem was proven to be EXPSPACE-complete in the number
of indeterminates. There are several surveys on further complexity results for the
computation of Gröbner bases, for instance the one presented by Mayr [17].
Since the computation of Gröbner bases is that important and hard it is a natural
question to ask whether there are special subclasses of polynomial ideals that allow
for faster computations of them.
3
Polynomial Ideals with Low Dimension
One class of polynomial ideals that allows easier computations of their Gröbner
bases is the set of zero-dimensional polynomial ideals. The dimension of a
polynomial ideal is the maximum size of a set of indeterminates such that no leading
monomial of a polynomial contained in this ideal consists of these indeterminates
only. Equivalently, the dimension of a polynomial ideal is the size of the biggest
set of indeterminates that is unrelated modulo the ideal. This means that zero-
dimensional ideals have many relations between their indeterminates and there is
even a relation for each indeterminate alone. This additional structure may be used
to ﬁnd improved degree bounds.
In 1983 Faugère et al. presented an algorithm that is much faster in practice
for zero-dimensional polynomial ideals than Bucherberger’s algorithm [8]. It was
also proven that there is a single-exponential bound on the degree of Gröbner
basis elements for zero-dimensional polynomial ideals by Dickenstein et al. which
enables better algorithms [5].
Theorem 3.1 ([5]) Let f1; : : : ; fs 2 k Œx1; : : : ; xn be polynomials with deg.fi/  d
for all i 2 f1; : : : ; sg over a ﬁeld k for d; n; s 2 N>0 such that hf1; : : : ; fsi has
dimension 0 and let g 2 hf1; : : : ; fsi be a polynomial. There are polynomials
g1; : : : ; gs 2 k Œx1; : : : ; xn

484
E.W. Mayr and S. Toman
such that g D Ps
iD1 figi and
deg.figi/  nd2n C dn C d C deg.f/
for all i 2 f1; : : : ; sg.
Since the special case of zero-dimensional polynomial ideals is much easier than
the general problem one could expect polynomial ideals with low dimension to have
better algorithms, too.
All degree bounds given above are dependent on the number of indeterminates
as this turned out to be a very signiﬁcant parameter of polynomial ideals to
describe their inherent complexity. The following bound does not use the number
of indeterminates as a parameter but the degree of the polynomial ideal which may
result in better bounds for special subsets of polynomial ideals.
Using a new degree bound by Kratzer [14], Mayr and Ritscher were able to ﬁnd
an algorithm to compute Gröbner bases whose space is bounded exponentially in
the dimension of the polynomial ideal [19].
Theorem 3.2 ([19]) Let f1; : : : ; fs 2 k Œx1; : : : ; xn be polynomials with deg.fi/  d
for all i 2 f1; : : : ; sg over an inﬁnite ﬁeld k for d; n; s 2 N>0. Let m 2 N0 be the
dimension of hf1; : : : ; fsi. Every reduced Gröbner basis of hf1; : : : ; fsi with respect to
an admissible monomial ordering consists of polynomials g1; : : : ; gr 2 R Œx1; : : : ; xn
for some r 2 N>0 with
deg.gi/  2
1
2

d2.nm/2 C d
2m
for all i 2 f1; : : : ; rg.
This theorem is proven using an algorithm based on a cone decomposition of the
space of polynomials. The construction of this decomposition is based on a similar
decomposition presented by Dubé [6].
They also presented an incremental version of their algorithm that does not use
degree bounds. The space bound of this algorithm uses the degree of the actual
problem instance instead of a worst-case instance. Therefore, the algorithm does
not require the knowledge of any a-priori degree bounds.
Both ﬁndings improved the known space bounds for polynomial ideals with low
degree in comparison to the general bounds. Later, they also proved a matching
lower bound [20] which ﬁnished the complexity analysis of computing Gröbner
bases depending on the degree of the polynomial ideal.
4
Binomial Ideals
Another interesting subclass are binomial ideals and pure binomial ideals which are
polynomial ideals that can be generated by binomials respectively pure binomials
only. Binomials are polynomials with at most two terms while pure binomials

Complexity of Membership Problems of Different Types of Polynomial Ideals
485
Fig. 1 The equivalence
classes of monomials modulo
I D hx3
1  x2
1x2; x1x3
2  x5
2i.
Monomials are represented
by points. Two of them are in
the same equivalence class if
they are connected by a line
or both are in an area with
gray background color
x0
1
x0
2
x1
1
x1
2
x2
1
x2
2
x3
1
x3
2
x4
1
x4
2
x5
1
x5
2
x6
1
x6
2
···
...
are polynomials with exactly two terms and coefﬁcients 1 and 1, respectively.
Pure binomial ideals can be thought of a partition of the set of monomials into
equivalence classes. Two monomials are in the same equivalence class if and only if
a pure binomial in the ideal uses those monomials as terms. This means that each of
the monomials can be replaced by the other one modulo the ideal. A visualization
of these equivalence classes for an example is shown in Fig. 1.
The example Mayr and Meyer presented to prove the exponential space lower
bound on the word problem for general polynomial ideals consists of pure binomial
ideals only, which implies that the word problem for pure binomial ideals is as hard
as the word problem for general polynomial ideals.
Theorem 4.1 ([18]) The word problem for pure binomial ideals is EXPSPACE-
complete.
It is an interesting ﬁnding that binomial ideals do already contain the full
complexity of the general case whereas the word problem for monomial ideals is
solvable in polynomial time. An overview of the complexity of the word problem
for different classes of polynomial ideals is listed in Table 1.
An application from theoretical computer science where pure binomial ideals
occur are commutative Thue systems. These systems are term replacement systems
with the additional properties that the order of the characters may be changed at
every time and all replacements can also be executed backwards [23, 24].
Deﬁnition 4.2 ([23, 24]) A commutative Thue system consists of a ﬁnite set of
congruences P D
˚
˛i  ˇi j i 2 f1; : : : ; sg
	
for some s 2 N>0 between words over
a ﬁnite alphabet ˙. Two words ; ı 2 ˙ are equivalent modulo the commutative
Thue system P if and only if there are 1; : : : ; r 2 ˙ for some r 2 N>0 with
 D 1, ı D r and j can be transformed to jC1 for all j 2 f1; : : : ; r  1g by

486
E.W. Mayr and S. Toman
Table 1 Complexity classes known for the (radical) word problem of several classes of polyno-
mial ideals
Type of ideals
Word problem
Radical word problem
Polynomial ideals
EXPSPACE-complete
PSPACE
[18]
[3, 11]
Binomial ideals
EXPSPACE-complete
coNP-complete
[18]
[25]
Pure binomial ideals
EXPSPACE-complete
coNP-complete
[18]
[25]
Toric ideals
L
L
[22]
[22]
Monomial ideals
P
P
reordering letters or applying a congruence ˛i  ˇi for some i 2 f1; : : : ; sg, i.e.
replacing the subword ˛i by the subword ˇi or vice versa.
It turns out that there is a bijection from the set of pure binomial ideals to the set
of commutative Thue systems preserving the structure of these objects.
Deﬁnition 4.3 Let ˙ D f1; : : : ; ng be a ﬁnite set with n 2 N0 and let
P D
n
˛i  ˇiji 2 f1; : : : ; sg
o
be a commutative Thue system for s 2 N>0 and ˛i; ˇi 2 ˙ for i 2 f1; : : : ; sg. Let
˚ W ˙ ! Nn
0 be the Parikh mapping, i.e. the i-th entry of ˚./ is the number of
occurrences of i in  for all  2 ˙ and i 2 f1; : : : ; ng. For each ring R we deﬁne
the polynomial ideal
IR.P/ :D
˝
x˚.˛i/  x˚.ˇi/ji 2 f1; : : : ; sg
˛
E R Œx1; : : : ; xn
Each instance of the equivalence problem for commutative Thue systems can be
mapped to an instance of the word problem for pure binomial ideals and vice versa.
Theorem 4.4 ([18]) For all commutative Thue Systems P we have
x˚./  x˚.ı/ 2 IZ.P/ , x˚./  x˚.ı/ 2 IQ.P/ ,   ı.P/
for all ; ı 2 ˙.
The lower bound by Mayr and Meyer [18] was proven by giving a reduction
of the EXPSPACE-complete problem to decide whether three-counter machines
terminate with a computation bounded double-exponentially by the input size to the
equivalence problem of commutative Thue systems.

Complexity of Membership Problems of Different Types of Polynomial Ideals
487
5
Toric Ideals
Toric ideals are another important special case of polynomial ideals that often
occur in practice. They appear in particular as the kernel of maps from polynomial
rings to rings of Laurent polynomials. Toric ideals are the same as saturated pure
binomial ideals or the extension of pure binomial ideals into the ring of Laurent
polynomials [25]. Over algebraically closed coefﬁcient ﬁelds toric ideals are the
same as binomial prime ideals [7].
There is a polynomial time algorithm to solve the word problem for toric ideals
and binomials by using Gaussian elimination on the Macaulay matrix of the toric
ideal. This means that the inherent complexity of toric ideals is much lower than the
one of binomial ideals.
Theorem 5.1 Let f1; : : : ; fs 2 R Œx1; : : : ; xn be pure binomials over a ring R with
n; s 2 N>0 such that hf1; : : : ; fsi is a toric ideal. Let  be a map from the set of
pure binomials contained in R Œx1; : : : ; xn to the Z-vector space Zn deﬁned by
.x˛  xˇ/ :D ˛  ˇ for all ˛; ˇ 2 Nn
0. Then we have
g 2 hf1; : : : ; fsi E R Œx1; : : : ; xn , .g/ 2 span f.f1/; : : : ; .fs/g  Zn
for all pure binomials g 2 R Œx1; : : : ; xn.
Using this approach and a memory-efﬁcient algorithm for solving linear systems
of equations Ritscher proved an upper space bound for the membership problem for
toric ideals [22]. He was also able to extend the algorithm to test for the membership
of general polynomials instead of pure binomials in toric ideals.
Theorem 5.2 ([22]) Let f1; : : : ; fs 2 k Œx1; : : : ; xn be pure binomials over a well-
endowed ﬁeld k with n; s 2 N>0 such that hf1; : : : ; fsi is a toric ideal and let g 2
k Œx1; : : : ; xn be a polynomial with t 2 N>0 terms. Let q 2 N>0 be an upper bound
on the bitsize of all coefﬁcients and exponents of g and f1; : : : ; fs. The word problem
to check whether g 2 hf1; : : : ; fsi can be decided in space O

log2..n C s C t/q/

.
The word problem for toric ideals is therefore known to be contained in L, the
complexity class of all problems solvable in logarithmic space. L is known to be
contained in P, the class of all problems solvable in polynomial time, but it is
unknown whether both classes are actually the same.
6
Radical Ideals
The radical of a polynomial ideal is constructed by adding all polynomials to
the ideal such that a power of them is included in the original polynomial ideal.
Thus, the radical is a superset of the original polynomial ideal. Growing the
polynomial ideal in the described way does not change its variety, i.e. the set of

488
E.W. Mayr and S. Toman
common solutions of all polynomials contained in the polynomial ideal, but just the
multiplicities of the roots. The radical therefore contains all geometric information
about a polynomial ideal. In contrast to pure binomial ideals, the degree bounds for
radical ideals are better than the ones for the general case, although there are much
less results for radical ideals. Containing the full geometric information but having
better degree bounds makes radical ideals interesting objects to study.
Brownawell proved a single-exponential bound for the degrees of the coefﬁcients
of a polynomial’s representation contained in radical ideals [3]. Kollár improved this
bound 1 year later [11].
Theorem 6.1 ([11]) Let f1; : : : ; fs 2 k Œx1; : : : ; xn be polynomials with deg.fi/  d,
deg.fi/ ¤ 2 for all i 2 f1; : : : ; sg over a ﬁeld k for some d; n; s 2 N>0 and let
g 2
p
hf1; : : : ; fsi. There are r 2 N>0 and g1; : : : ; gs 2 k Œx1; : : : ; xn such that
gr D
s
X
iD1
figi
with s  dn and deg.figi/  .1 C deg.g//dn for all i 2 f1; : : : ; sg.
Using those degree bounds the word problem for radical ideals can be solved
in polynomial space and exponential time by enumerating all possible g1; : : : ; gs.
There are also several algorithms that compute the actual radical of a polynomial
ideal, for instance the one presented by Laplagne in 2006 [16], but all known
algorithms that compute radicals of all polynomial ideals need at least exponential
space and double-exponential time which are the same bounds as for Gröbner basis
computations and the word problem for general polynomial ideals.
7
Radical Binomial Ideals
The radical word problem is given a polynomial ideal and a polynomial to solve
the word problem for the radical of this ideal and the polynomial. This problem
is a generalization of the word problem for radical ideals. Algorithms solving the
radical word problem might be more efﬁcient than EXPSPACE which is needed to
compute the radical since they do not need to actually compute a basis of the radical
ideal. This problem is interesting because the result of the radical word problem is
true if and only if the given polynomial holds for all solutions of the polynomial
ideal, which means that using this problem one can deduce information about the
solutions of a system of equations without actually computing the full solution.
Radicals of (pure) binomial ideals and toric ideals have even more structure as
proven by Gilmer in 1984 [9] and Eisenbud and Sturmfels in 1996 [7].
Theorem 7.1 ([7, 9]) Let k be a ﬁeld and n 2 N>0. The radical of each binomial
ideal contained in k Œx1; : : : ; xn is a binomial ideal again. Similarly, the radical of
each pure binomial ideal contained in k Œx1; : : : ; xn is a pure binomial ideal again.

Complexity of Membership Problems of Different Types of Polynomial Ideals
489
Theorem 7.2 ([7]) Let k be an algebraically closed ﬁeld with char.k/ D 0 and
n 2 N>0 and let I E k Œx1; : : : ; xn be a toric ideal. I is a radical ideal.
This means the radical operation is closed under binomial ideals and pure
binomial ideals. For toric ideals computing the radical does not change the ideal
at all. It is therefore a common technique to reduce computations of radicals to toric
ideals which are already radical.
In the case of binomial ideals over ﬁelds with characteristic 0 there is a special
tool available to compute radicals doing this. In 1996 Eisenbud and Sturmfels
introduced the cellular decomposition of binomial ideals [7]. They suggested to
partition the variety of the binomial ideal into cells where points are in the same
cell if they have the same components being non-zero. The intersection of the ideals
corresponding to each cell is the radical of the original ideal.
Theorem 7.3 ([7]) Let k be a ﬁeld with char.k/ D 0, n 2 N0 and I E kŒx1; : : : ; xn
be a binomial ideal. Then
p
I D
\
fx1;:::;xng
I W
0
@Y
xi2
xi
1
A
1
C hfxi j xi 62 gi
where I is the image of I under the ring endomorphism on k Œx1; : : : ; xn deﬁned by
1 7! 1; xi 7!
(
xi
if xi 2 
0
else
for all i 2 f1; : : : ; ng and   fx1; : : : ; xng.
Even though the radical of a binomial ideal over a ﬁeld with characteristic 0
is binomial again, the intermediate results do not have to be binomial since the
intersection of two binomial ideals is not binomial in general. Nevertheless, in
1997 Becker, Grobe, and Niermann proved that the intersections of the cellular
decomposition can be executed in an order such that all intermediate results
are binomial [2]. This result implies that all intermediate results of the cellular
decomposition of pure binomial ideals can be interpreted as commutative Thue
systems, too.
Mayr and Toman presented an algorithm to solve the radical word problem
for pure binomial ideals in coNP [21]. They used the cellular decomposition of
binomial ideals and the polynomial time algorithm to solve the word problem for
toric ideals. They also showed how to encode the coefﬁcients of binomials to solve
the radical word problem for non-pure binomial ideals in the same complexity class.
Additionally, they proved a matching lower bound for the radical word problem of
pure binomial ideals by giving a reduction from the TAUTOLOGY problem. This
showed that the radical word problem for binomial ideals is coNP-complete.
It is interesting to note that this complexity class is characterized by the
time needed for running the machine instead of its space consumption. All other
complexity classes listed in Table 1 for general polynomial ideals or subclasses

490
E.W. Mayr and S. Toman
mentioned in this report use space bounds for the machines. It is known that coNP
is contained in PSPACE, which is the complexity of the radical word problem
for general polynomial ideals, but it is still unknown whether there are problems
contained in PSPACE but not in coNP.
We have seen that the bijection between pure binomial ideals and commutative
Thue systems provides versatile tools for systems of pure binomial ideals. Oper-
ations on pure binomial ideals like the sum, product, intersection, quotient, and
saturation each can be equivalently deﬁned in terms of commutative Thue systems.
As opposed to this, it is not possible to directly deﬁne radicals of commutative
Thue systems since this deﬁnition involves powers of pure binomials which are
no pure binomials anymore and therefore have no corresponding objects in terms
of commutative Thue systems. In his PhD thesis Toman suggests a deﬁnition of
radicals of commutative Thue systems not involving polynomial ideals [26].
To do this one needs a way to represent powers of binomials as binomials again.
Squares of binomials for instance can be split up to two different binomials.
Theorem 7.4 ([26]) Let I E k Œx1; : : : ; xn be a pure binomial ideal over a ﬁeld k
with char.k/ D 0 for some n 2 N>0. Let u; v 2 Nn
>0. We have
.xu  xv/2 2 I , x2u  xuCv 2 I; xuCv  x2v 2 I
For a binomial g this theorem implies that g2 is contained in the pure binomial
ideal I if and only if all monomials of g2 are equivalent modulo I. The latter
property can be easily expressed using commutative Thue systems whereas the
former involves polynomials that are no pure binomials and can therefore not be
expressed in terms of commutative Thue systems. A similar theorem is true for
higher powers of the binomial.
Theorem 7.5 ([26]) Let f1; : : : ; fs 2 R Œx1; : : : ; xn be pure binomials over a ring R
for some d; n; s 2 N>0. Let
g 2
p
hf1; : : : ; fsi E R Œx1; : : : ; xn
be a pure binomial. There is an r 2 N>0 such that all terms of gr are equivalent
modulo hf1; : : : ; fsi.
We were also able to ﬁnd a degree bound on the exponent r that makes all terms
of gr equivalent that is only slightly bigger than all known degree bounds on the
exponent t such that gt 2 hf1; : : : ; fsi.
Theorem 7.6 ([26]) In the setting of Theorem 7.5 with the additional property that
2 < deg.fi/  d for all i 2 f1; : : : ; sg we can choose
r :D 2dn
log 2dn C log log 2dn
C 1 2 N>0
All terms of a polynomial contained in a pure binomial ideal can be partitioned
into equivalence classes modulo the ideal where the sum of the coefﬁcients in each

Complexity of Membership Problems of Different Types of Polynomial Ideals
491
Fig. 2 All possible
equivalence classes of terms
of a ﬁfth power of a pure
binomial .xu  xv/5 2 I
modulo a pure binomial ideal
I. We use the notation
i.j/ D xjuC.ij/v and the
coefﬁcients of the terms are
given in brackets
equivalence class is to 0. All possible conﬁgurations of those equivalence classes of
the ﬁfth power of a pure binomial are visualized in Fig. 2.
The theorems above imply that for powers of pure binomials we additionally only
get one equivalence class for exponents of the given size. Those theorems allow the
following deﬁnition of a radical of commutative Thue systems by translating them
form pure binomial ideals to commutative Thue systems since they only contain
statements on pure binomials only.
Theorem 7.7 ([26]) Let ˙ be a ﬁnite alphabet and let P be a commutative Thue
system over ˙. We iteratively deﬁne P0 :D P and Pi to be the commutative Thue
system over ˙ generated by all equivalences ˛ Pi ˇ with ˛; ˇ 2 ˙ and
˛˛ Pi1 ˛ˇ as well as ˛ˇ Pi1 ˇˇ
for i 2 N>0. There is an s 2 N>0 with Ps D Pi for all i 2 N>0, i  s and
IQ.Ps/ D
p
IQ.P/
Using this approach one can compute the radical of a commutative Thue system
in EXPSPACE. This is similar to numerous other problems on commutative Thue

492
E.W. Mayr and S. Toman
systems which have a complexity of EXPSPACE like the coverability, the subword,
the containment, and the equivalence problems [12, 13].
Ps is a radical of P deﬁned purely in terms of commutative Thue systems.
This construction provides another tool for ﬁnding better degree bounds for radical
ideals.
8
Future Research
There are numerous open questions related to degree bounds of polynomial ideals
that can be answered in future research. The known upper and lower bounds for the
degree of the generators of a Gröbner bases of the radical of a given polynomial
ideal do not match.
Likewise, the algorithms presented above for the radical word problem of
binomial ideals do not compute an actual basis of the radical ideal. It is an open
question whether the complexity for computing the basis of the radical of a binomial
ideal is different to the general case.
Some of the results presented above only work for the rationals as base ﬁeld of
the polynomial ring. Similar bounds for positive characteristics of the base ﬁeld are
often unknown.
Acknowledgements This work was partially supported by Deutsche Forschungsgemeinschaft
(DFG) through priority program SPP 1489 “Algorithmic and Experimental Methods in Algebra,
Geometry, and Number Theory” in the project “Degree Bounds for Gröbner Bases of Important
Classes of Polynomial Ideals and Efﬁcient Algorithms”, TUM Graduate School, and TopMath, a
graduate program of the Elite Network of Bavaria. We are grateful for their support.
References
1. N.H. Abel, Démonstration de l’impossibilité de la résolution algébrique des équations
générales qui passent le quatrieme degré. J. Reine Angew. Math. 1, 65–96 (1826)
2. E. Becker, R. Grobe, M. Niermann, Radicals of binomial ideals. J. Pure Appl. Algebra 117–
118, 41–79 (1997)
3. W.D. Brownawell, Bounds for the degrees in the nullstellensatz. Ann. Math. 126(3), 577
(1987)
4. B. Buchberger, Ein Algorithmus zum Aufﬁnden der Basiselemente des Restklassenringes nach
einem nulldimensionalen Polynomideal (An algorithm for ﬁnding the basis elements in the
residue class ring modulo a zero dimensional polynomial ideal). Ph.D. Thesis, Mathematical
Institute, University of Innsbruck (1965)
5. A. Dickenstein, N. Fitchas, M. Giusti, C. Sessa,
The membership problem for unmixed
polynomial ideals is solvable in single exponential time. Discret. Appl. Math. 33(1), 73–94
(1991)
6. T.W. Dubé, The structure of polynomial ideals and Gröbner bases. SIAM J. Comput. 19(4),
750–773 (1990)
7. D. Eisenbud, B. Sturmfels, Binomial ideals. Duke Math. J. 84(1), 1–45 (1996)

Complexity of Membership Problems of Different Types of Polynomial Ideals
493
8. J.C. Faugère, P. Gianni, D. Lazard, T. Mora, Efﬁcient computation of zero-dimensional gröbner
bases by change of ordering. J. Symb. Comput. 16(4), 329–344 (1993)
9. R. Gilmer, Commutative Semigroup Rings. Chicago Lectures in Mathematics (University of
Chicago Press, Chicago, 1984)
10. G. Hermann, Die Frage der endlich vielen Schritte in der Theorie der Polynomideale. Math.
Ann. 95(1), 736–788 (1926)
11. J. Kollár, Sharp effective Nullstellensatz. J. Am. Math. Soc. 1(4), 963 (1988)
12. U. Koppenhagen, E.W. Mayr,
Optimal algorithms for the coverability, the subword, the
containment, and the equivalence problems for commutative semigroups. Inf. Comput. 158(2),
98–124 (2000)
13. U. Koppenhagen, E.W. Mayr, An optimal algorithm for constructing the reduced Gröbner basis
of binomial ideals, and applications to commutative semigroups. J. Symb. Comput. 31(1–2),
259–276 (2001)
14. M. Kratzer,
Computing the dimension of a polynomial ideal and membership in low-
dimensional ideals. Master’s Thesis, TU München (2008)
15. K. Kühnle, E.W. Mayr, Exponential space computation of Gröbner bases. In: Proceedings
of the 1996 International Symposium on Symbolic and Algebraic Computation - ISSAC ’96
(ACM, New York, 1996), pp. 63–71
16. S. Laplagne, An algorithm for the computation of the radical of an ideal. In: Proceedings of the
2006 International Symposium on Symbolic and Algebraic Computation - ISSAC ’06 (ACM,
New York, 2006), p. 191
17. E.W. Mayr, Some complexity results for polynomial ideals. J. Complexity 13(3), 303–325
(1997)
18. E.W. Mayr, A.R. Meyer, The complexity of the word problems for commutative semigroups
and polynomial ideals. Adv. Math. 46(3), 305–329 (1982)
19. E.W. Mayr, S. Ritscher, Space-efﬁcient Gröbner basis computation without degree bounds.
In: Proceedings of the 36th International Symposium on Symbolic and Algebraic Computation
(ISSAC ’11) (ACM, New York, 2011), pp. 257–264
20. E.W. Mayr, S. Ritscher, Dimension-dependent bounds for Gröbner bases of polynomial ideals.
J. Symb. Comput. 49, 78–94 (2013). The International Symposium on Symbolic and Algebraic
Computation
21. E.W. Mayr, S. Toman, The complexity of the membership problem for radical binomial ideals,
in International Conference Polynomial Computer Algebra ’2015, ed. by N.N. Vassiliev (Euler
International Mathematical Institute/VVM Publishing, Saint Petersburg, 2015), pp. 61–64
22. S. Ritscher,
Degree bounds and complexity of Gröbner bases of important classes of
polynomial ideals. Ph.D. Thesis, TU München (2012)
23. A. Thue, Die Lösung eines Spezialfalles eines generellen logischen Problems. Skrifter udg. af
Videnskabs-Selskabet i Christiania. I, Math. Naturv. Klasse 8 (1910)
24. A. Thue, Problem über Veränderungen von Zeichenreihen nach gegebenen Regeln. Skrifter
udg. af Videnskabs-Selskabet i Christiania. I, Math. Naturv. Klasse 10 (1914)
25. S. Toman, The radical word problem for binomial ideals. Master’s Thesis, TU München (2015)
26. S. Toman, Radicals of binomial ideals and commutative Thue systems. Ph.D. Thesis,
TU München (2017)
27. C.K. Yap, A new lower bound construction for commutative Thue systems with applications.
J. Symb. Comput. 12(1), 1–27 (1991)

Localizations of Inductively Factored
Arrangements
Tilman Möller and Gerhard Röhrle
Abstract We show that the class of inductively factored arrangements is closed
under taking localizations. We illustrate the usefulness of this with an application.
Keywords Nice arrangement • Inductively factored arrangement • Localization
of arrangement
Subject Classiﬁcations Primary 52C35, 14N20; Secondary 51D20
1
Introduction
The notion of a nice arrangement is due to Terao [12]. This class generalizes the
class of supersolvable arrangements, [9] (cf. [10, Thm. 3.81]). There is an inductive
version of this class, so called inductively factored arrangements, due to Jambu and
Paris [6], see Deﬁnition 2.7. This inductive class (properly) contains the class of
supersolvable arrangements and is (properly) contained in the class of inductively
free arrangements, see [3, Rem. 3.33].
For an overview on properties of nice and inductively factored arrangements, and
for their connection with the underlying Orlik-Solomon algebra, see [10, §3], [6],
and [3]. In [3], Hoge and the second author proved an addition-deletion theorem
for nice arrangements, see Theorem 2.6 below. This is an analogue of Terao’s
celebrated Addition-Deletion Theorem 2.1 for free arrangements for the class of
nice arrangements.
The class of free arrangements is known to be closed under taking localizations,
[10, Thm. 4.37]. It is also known that this property restricts to various stronger
notions of freeness, see [5, Thm. 1]. It is clear that the class of nice arrangements
also satisﬁes this property, see Remark 2.5 below. Inductive arguments by means of
T. Möller • G. Röhrle ()
Fakultät für Mathematik, Ruhr-Universität Bochum, 44780 Bochum, Germany
e-mail: tilman.moeller@rub.de; gerhard.roehrle@rub.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_21
495

496
T. Möller and G. Röhrle
localizations are a pivotal technique in the theory of arrangements. Therefore, it is
natural to investigate this question for the stronger property of inductively factored
arrangements as well. Here is the main result of our note.
Theorem 1.1 The class of inductively factored arrangements is closed under taking
localizations.
Theorem 1.1 readily extends to the class of hereditarily inductively factored
arrangements, see Remark 3.3.
We show the utility of Theorem 1.1 in Example 3.4 which in turn is used in the
classiﬁcation of all inductively factored restrictions of reﬂection arrangements in
[7].
2
Recollections and Preliminaries
2.1
Hyperplane Arrangements
Let K be a ﬁeld and let V D K` be an `-dimensional K-vector space. A hyperplane
arrangement A in V is a ﬁnite collection of hyperplanes in V. We also use the term
`-arrangement for A . The empty `-arrangement is denoted by ˚`.
The lattice L.A / of A is the set of subspaces of V of the form H1\  \Hi where
fH1; : : : ; Hig is a subset of A . For X 2 L.A /, we have two associated arrangements,
ﬁrstly AX WD fH 2 A j X  Hg  A , the localization of A at X, and secondly,
the restriction of A to X, .A X; X/, where A X WD fX \H j H 2 A nAXg. Note that
V belongs to L.A / as the intersection of the empty collection of hyperplanes and
A V D A . The lattice L.A / is a partially ordered set by reverse inclusion: X  Y
provided Y  X for X; Y 2 L.A /.
If 0 2 H for each H in A , then A is called central. If A is central, then the
center TA WD \H2A H of A is the unique maximal element in L.A / with respect
to the partial order. We have a rank function on L.A /: r.X/ WD codimV.X/. The
rank r WD r.A / of A is the rank of a maximal element in L.A /. Throughout, we
only consider central arrangements.
More generally, for U an arbitrary subspace of V, we can deﬁne AU WD fH 2
A j U  Hg  A , the localization of A at U, and A U WD fU\H j H 2 A nAUg,
a subarrangement in U.
2.2
Free Hyperplane Arrangements
Let S D S.V/ be the symmetric algebra of the dual space V of V. Let Der.S/ be
the S-module of K-derivations of S. Since S is graded, Der.S/ is a graded S-module.
Let A be a central arrangement in V. Then for H 2 A we ﬁx ˛H 2 V with H D
ker ˛H. The deﬁning polynomial Q.A / of A is given by Q.A / WD Q
H2A ˛H 2 S.

Localizations of Inductively Factored Arrangements
497
The module of A -derivations of A is deﬁned by
D.A / WD f 2 Der.S/ j .Q.A // 2 Q.A /Sg:
We say that A is free if D.A / is a free S-module, cf. [10, §4].
If A is a free arrangement, then the S-module D.A / admits a basis of n
homogeneous derivations, say 1; : : : ; n, [10, Prop. 4.18]. While the i’s are not
unique, their polynomial degrees pdeg i are unique (up to ordering). This multiset
is the set of exponents of the free arrangement A and is denoted by exp A .
Terao’s celebrated Addition-Deletion Theorem which we recall next plays a
pivotal role in the study of free arrangements, [10, §4]. For A non-empty, let
H0 2 A . Deﬁne A 0 WD A n fH0g, and A 00 WD A H0 D fH0 \ H j H 2 A 0g,
the restriction of A to H0. Then .A ; A 0; A 00/ is a triple of arrangements, [10,
Def. 1.14].
Theorem 2.1 ([11]) Suppose that A
¤ ˚`. Let .A ; A 0; A 00/ be a triple of
arrangements. Then any two of the following statements imply the third:
(i) A is free with exp A D fb1; : : : ; b`1; b`g;
(ii) A 0 is free with exp A 0 D fb1; : : : ; b`1; b`  1g;
(iii) A 00 is free with exp A 00 D fb1; : : : ; b`1g.
There are various stronger notions of freeness which we discuss in the following
sections.
2.3
Inductively Free Arrangements
Theorem 2.1 motivates the notion of inductively free arrangements, see [11] or [10,
Def. 4.53].
Deﬁnition 2.2 The class IF of inductively free arrangements is the smallest class
of arrangements subject to
(i) ˚` 2 IF for each `  0;
(ii) if there exists a hyperplane H0 2 A such that both A 0 and A 00 belong to IF,
and expA 00  exp A 0, then A also belongs to IF.
Free arrangements are closed with respect to taking localizations, e.g. see [10,
Thm. 4.37]. This also holds for the class IF.
Theorem 2.3 ([5, Thm. 1]) If A is inductively free, then so is AU for every
subspace U in V.

498
T. Möller and G. Röhrle
2.4
Nice and Inductively Factored Arrangements
The notion of a nice or factored arrangement is due to Terao [12]. It generalizes
the concept of a supersolvable arrangement, see [9, Thm. 5.3] and [10, Prop. 2.67,
Thm. 3.81]. Terao’s main motivation was to give a general combinatorial framework
to deduce factorizations of the underlying Orlik-Solomon algebra, see also [10,
§3.3]. We recall the relevant notions from [12] (cf. [10, §2.3]):
Deﬁnition 2.4 Let  D .1; : : : ; s/ be a partition of A .
(a)  is called independent, provided for any choice Hi 2 i for 1  i  s, the
resulting s hyperplanes are linearly independent, i.e. r.H1 \ : : : \ Hs/ D s.
(b) Let X 2 L.A /. The induced partition X of AX is given by the non-empty
blocks of the form i \ AX.
(c)  is nice for A or a factorization of A provided
(i)  is independent, and
(ii) for each X 2 L.A / n fVg, the induced partition X admits a block which is
a singleton.
If A admits a factorization, then we also say that A is factored or nice.
Remark 2.5 The class of nice arrangements is closed under taking localizations.
For, if A is non-empty and  is a nice partition of A , then the non-empty parts
of the induced partition X form a nice partition of AX for each X 2 L.A / n fVg;
cf. the proof of [12, Cor. 2.11].
Following Jambu and Paris [6], we introduce further notation. Suppose A is not
empty. Let  D .1; : : : ; s/ be a partition of A . Let H0 2 1 and let .A ; A 0; A 00/
be the triple associated with H0. Then  induces a partition 0 of A 0, i.e. the non-
empty subsets i \ A 0. Note that since H0 2 1, we have i \ A 0 D i for
i D 2; : : : ; s. Also, associated with  and H0, we deﬁne the restriction map
% WD %;H0 W A n 1 ! A 00 given by H 7! H \ H0
and set
00
i WD %.i/ D fH \ H0 j H 2 ig for 2  i  s:
In general, % need not be surjective nor injective. However, since we are only
concerned with cases when 00 D .00
2 ; : : : ; 00
s / is a partition of A 00, % has to be
onto and %.i/ \ %.j/ D ¿ for i ¤ j.
The following analogue of Terao’s Addition-Deletion Theorem 2.1 for free
arrangements for the class of nice arrangements is proved in [3, Thm. 3.5].
Theorem 2.6 Suppose that A ¤ ˚`. Let  D .1; : : : ; s/ be a partition of A .
Let H0 2 1 and let .A ; A 0; A 00/ be the triple associated with H0. Then any two of
the following statements imply the third:

Localizations of Inductively Factored Arrangements
499
(i)  is nice for A ;
(ii) 0 is nice for A 0;
(iii) % W A n 1 ! A 00 is bijective and 00 is nice for A 00.
Note the bijectivity condition on % in Theorem 2.6 is necessary, cf. [3, Ex. 3.3].
Theorem 2.6 motivates the following stronger notion of factorization, cf. [6], [3,
Def. 3.8].
Deﬁnition 2.7 The class IFA C of inductively factored arrangements is the
smallest class of pairs .A ; / of arrangements A together with a partition  subject
to
(i) .˚`; .// 2 IFA C for each `  0;
(ii) if there exists a partition  of A and a hyperplane H0 2 1 such that for
the triple .A ; A 0; A 00/ associated with H0 the restriction map % D %;H0 W
A n 1 ! A 00 is bijective and for the induced partitions 0 of A 0 and 00 of
A 00 both .A 0; 0/ and .A 00; 00/ belong to IFA C , then .A ; / also belongs
to IFA C .
If .A ; / is in IFA C , then we say that A is inductively factored with respect to
, or else that  is an inductive factorization of A . Sometimes we simply say A is
inductively factored without reference to a speciﬁc inductive factorization of A .
Remark 2.8 If  is an inductive factorization of A , then there exists an induction
of factorizations by means of Theorem 2.6 as follows. This procedure amounts to
choosing a total order on A , say A D fH1; : : : ; Hng, so that each of the pairs
.A0 D ˚`; .//, .Ai WD fH1; : : : ; Hig; i WD jAi/, and .A 00
i
WD A Hi
i ; 00
i / for each
1  i  n, belongs to IFA C see [3, Rem. 3.16].
The connection with the previous notions is as follows.
Proposition 2.9 ([3, Prop. 3.11]) If A is supersolvable, then A is inductively
factored.
Proposition 2.10 ([6, Prop. 2.2], [3, Prop. 3.14]) Let 
D
.1; : : : ; r/ be
an inductive factorization of A . Then A is inductively free with exp A
D
f0`r; j1j; : : : ; jrjg.
Deﬁnition 2.11 We say that A is hereditarily inductively factored provided A Y is
inductively factored for every Y 2 L.A /.
3
Proof of Theorem 1.1
Theorem 1.1 follows from our next theorem which asserts that an inductive
factorization of an arrangement affords one for any localization.
Theorem 3.1 For U a proper, non-trivial subspace of V, if .A ; / belongs to
IFA C , then so does .AU; U/.

500
T. Möller and G. Röhrle
Proof We argue by induction on jA j. If A D ˚` there is nothing to show. So
assume jA j > 0 and that the result holds for arrangements with fewer than jA j
hyperplanes. Since A is non-empty and inductively factored, there is a partition 
of A and H0 2 A so that .A ; /, .A 0; 0/ and .A 00; 00/ belong to IFA C .
Suppose that U 6 H0. Then .AU; U/ D ..A 0/U; 0
U/. As jA 0j < jA j and
.A 0; 0/ belongs to IFA C , so does ..A 0/U; 0
U/, by our induction hypothesis. So
.AU; U/ 2 IFA C .
Now suppose that U  H0. Then we have that ..AU/0; .U/0/ D ..A 0/U; .0/U/
and also ..AU/00; .U/00/ D ..A 00/U; .00/U/. Therefore, since jA 0j; jA 00j < jA j,
both ..AU/0; .U/0/ and ..AU/00; .U/00/ belong to IFA C , as both .A 0; 0/ and
.A 00; 00/ do.
Moreover, as U is nice for AU and 0
U is nice for A 0
U, by Remark 2.5, it follows
from Theorem 2.6 that the corresponding restriction map is bijective. Therefore, by
Deﬁnition 2.7, .AU; U/ belongs to IFA C , as claimed.
Remark 3.2 An alternative proof of Theorem 3.1 consists in choosing an inductive
chain of .A ; / and intersecting it with AU. One then shows that (after removing
redundant terms) that this then affords an inductive chain of .AU; U/.
Remark 3.3 Theorem 1.1 readily extends to hereditarily inductively factored
arrangements. For, let A be hereditarily inductively factored and let Y  X in
L.A /. Then, since A Y is inductively factored, so is .A Y/X, by Theorem 1.1.
Finally, since .AX/Y D .A Y/X, it follows that .AX/Y is inductively factored.
The following example shows the utility of the results above. In particular, this
example is used in the classiﬁcations of the nice and inductively factored restrictions
of reﬂection arrangements in [7].
Example 3.4 Let V D C` be an `-dimensional C-vector space. Orlik and Solomon
deﬁned intermediate arrangements A k
` .r/ in [8, §2] (cf. [10, §6.4]) which inter-
polate between the reﬂection arrangements A .G.r; 1; `// and A .G.r; r; `// of the
complex reﬂection groups G.r; 1; `/ and G.r; r; `/. For `; r  2 and 0  k  `, the
deﬁning polynomial of A k
` .r/ is
Q.A k
` .r// D x1    xk
Y
1i<j`
0n<r
.xi  nxj/;
where  is a primitive rth root of unity, so that A `
` .r/ D A .G.r; 1; `// and A 0
` .r/ D
A .G.r; r; `//. Note that for 1 < k < `, A k
` .r/ is not a reﬂection arrangement.
Each of these arrangements is known to be free, cf. [10, Prop. 6.85]. The
supersolvable and inductively free cases among them were classiﬁed in [2], and
[1], respectively.
If k 2 f`  1; `g, then A k
` .r/ is supersolvable, by [2, Thm. 1.3], and so A k
` .r/ is
inductively factored, by Proposition 2.9. Let `  4. We claim that A k
` .r/ is not nice
for 0  k  `4 and moreover A k
` .r/ is not inductively factored for 0  k  `3.

Localizations of Inductively Factored Arrangements
501
For k D 0, this follows from [4, Thm. 1.3]. So let 1  k  `  3 and set
A D A k
` .r/. Deﬁne
X WD
\
kC1i<j`
0n<r
ker.xi  nxj/:
Then one checks that
AX Š A 0
`k.r/ D A .G.r; r; `  k//:
For 1  k  `  4, it follows from [4, Thm. 1.3] that A .G.r; r; `  k// is not
nice. Consequently, neither is A k
` .r/, by Remark 2.5. For k D `  3, we have
AX Š A .G.r; r; 3//. By Hoge and Röhrle [4, Cor. 1.4], the latter is not inductively
factored, thus neither is A `3
`
.r/, thanks to Theorem 1.1.
Acknowledgements We acknowledge support from the DFG-priority program SPP1489 “Algo-
rithmic and Experimental Methods in Algebra, Geometry, and Number Theory”.
We are grateful to the referee for some helpful comments which lead to a simpler argument for
the proof of Theorem 1.1.
References
1. N. Amend, T. Hoge, G. Röhrle, On inductively free restrictions of reﬂection arrangements.
J. Algebra 418, 197–212 (2014)
2. N. Amend, T. Hoge, G. Röhrle, Supersolvable restrictions of reﬂection arrangements. J. Comb.
Theory Ser. A 127, 336–352 (2014)
3. T. Hoge, G. Röhrle, Addition-deletion theorems for factorizations of Orlik-Solomon algebras
and nice arrangements. Eur. J. Comb. 55, 20–40 (2016)
4. T. Hoge, G. Röhrle, Nice reﬂection arrangements. Electron. J. Comb. 23(2), Paper 2.9, 24 pp.
(2016)
5. T. Hoge, G. Röhrle, A. Schauenburg, Inductive and recursive freeness of localizations of
multiarrangements, in Algorithmic and Experimental Methods in Algebra, Geometry, and
Number Theory (Springer, Berlin, 2017)
6. M. Jambu, L. Paris, Combinatorics of inductively factored arrangements. Eur. J. Comb. 16,
267–292 (1995)
7. T. Möller, G. Röhrle, Nice restrictions of reﬂection arrangements. Electron. J. Comb. 24(3),
Paper 3.44 (2017)
8. P. Orlik, L. Solomon, Arrangements deﬁned by unitary reﬂection groups. Math. Ann. 261,
339–357 (1982)
9. P. Orlik, L. Solomon, H. Terao, Arrangements of hyperplanes and differential forms, in Com-
binatorics and Algebra (Boulder, CO, 1983). Contemporary Mathematics, vol. 34 (American
Mathematical Society, Providence, 1984), pp. 29–65
10. P. Orlik, H. Terao, Arrangements of Hyperplanes (Springer, Berlin, 1992)
11. H. Terao, Arrangements of hyperplanes and their freeness I, II. J. Fac. Sci. Univ. Tokyo 27,
293–320 (1980)
12. H. Terao, Factorizations of the Orlik-Solomon algebras. Adv. Math. 92, 45–53 (1992)

One Class Genera of Lattice Chains Over
Number Fields
Markus Kirschmer and Gabriele Nebe
Abstract We classify all one-class genera of admissible lattice chains of length
at least 2 in hermitian spaces over number ﬁelds. If L is a lattice in the chain
and p the prime ideal dividing the index of the lattices in the chain, then the
fpg-arithmetic group Aut.Lfpg/ acts chamber transitively on the corresponding
Bruhat-Tits building. So our classiﬁcation provides a step forward to a complete
classiﬁcation of these chamber transitive groups which has been announced 1987
(without a detailed proof) by Kantor, Liebler and Tits. In fact we ﬁnd all their groups
over number ﬁelds and one additional building with a discrete chamber transitive
group.
Keywords Genus of lattice • Class number • Afﬁne buildings • Lattice chains
Subject Classiﬁcations 11E41, 20G30, 20G25
1
Introduction
Kantor et al. [11] classiﬁed discrete groups  with a type preserving chamber
transitive action on the afﬁne building BC of a simple adjoint algebraic group
of relative rank r  2. Such groups are very rare and hence this situation is an
interesting phenomenon. Except for two cases in characteristic 2 [11, case (v)]
and the exceptional group G2.Q2/ ([11, case (iii)], Sect. 5.4) the groups arise from
classical groups Up over Qp for p D 2; 3. Moreover  is a subgroup of the
S-arithmetic group max WD Aut.L ˝Z ZŒ 1
p/ (so S D fpg) for a suitable lattice L
in some hermitian space .V; ˚/ and Up D U.Vp; ˚/ is the completion of the unitary
M. Kirschmer • G. Nebe ()
Lehrstuhl D für Mathematik, RWTH Aachen University, 52056 Aachen, Germany
e-mail: markus.kirschmer@math.rwth-aachen.de; nebe@math.rwth-aachen.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_22
503

504
M. Kirschmer and G. Nebe
group U.V; ˚/ (see Remark 2.3). This paper uses the classiﬁcation of one- and two-
class genera of hermitian lattices in [16] to obtain these S-arithmetic groups max.
Instead of the thick building BC we start with the afﬁne building B of admissible
lattice chains as deﬁned in [1]. The points in the building B correspond to homothety
classes of certain Zp-lattices in Vp. The lattices form a simplex in B, if and only if
representatives in these classes can be chosen to form an admissible chain of lattices
in Vp. In particular the maximal simplices of B (the so called chambers) correspond
to the ﬁne admissible lattice chains in Vp (for the thick building BC one might have
to apply the oriﬂamme construction as explained in Remark 4.6).
Any ﬁne admissible lattice chain Lp in Vp arises as the completion of a lattice
chain L0 in .V; ˚/. After rescaling and applying the reduction operators from
Sect. 2.3 we obtain a ﬁne p-admissible lattice chain L D .L0; : : : ; Lr/ in .V; ˚/
(see Deﬁnition 3.4) such that Aut.L/  Aut.L0/ and such that the completion of L
at p is Lp. The S-arithmetic group
Aut.L0 ˝ ZŒ 1
p/ D Aut.Li ˝ ZŒ 1
p/ DW Aut.L ˝ ZŒ 1
p/
contains Aut.L0 ˝ ZŒ 1
p/. Therefore we call this group closed.
The closed fpg-arithmetic group Aut.L0˝ZŒ 1
p/ acts chamber transitively on B, if
the lattice L0 represents a genus of class number one and Aut.L0/ acts transitively on
the ﬁne ﬂags of (isotropic) subspaces in the hermitian space L0 (see Theorem 4.4). If
we only impose chamber transitivity on the thick building BC, then we also have to
take two-class genera of lattices L0 into account. To obtain a complete classiﬁcation
of all chamber transitive actions of closed S-arithmetic groups on the thick building
BC using this strategy there are two ingredients missing:
(a) By Theorem 4.9 we need the still unknown classiﬁcation of proper special
genera of lattices L0 with class number one (see also Proposition 4.5 and [27,
Proposition 1]).
(b) We should also include the skew hermitian forms over quaternion algebras for
which a classiﬁcation of one-class genera is still unknown.
Already taking only the one-class genera of lattices L0 we ﬁnd all the groups
from [11] and one additional case (described in Proposition 5.3 (1)). Hence
our computations correct an omission in the classiﬁcation of [11]. A list of the
corresponding buildings and groups Up is given in Sect. 6.
2
Lattices in Hermitian Spaces
Let K be a number ﬁeld. Further, let E=K be a ﬁeld extension of degree at most
2 or let E be a quaternion skewﬁeld over K. The canonical involution of E=K will
be denoted by W E ! E. In particular, K is the ﬁxed ﬁeld of  and hence the
involution  is the identity if and only if K D E. A hermitian space over E is

One Class Genera of Lattice Chains Over Number Fields
505
a ﬁnitely generated (left) vector space V over E equipped with a non-degenerate
sesquilinear form ˚W V  V ! E such that
•
˚.x C x0; y/ D ˚.x; y/ C ˚.x0; y/ for all x; x0; y 2 V.
•
˚.˛x; ˇy/ D ˛˚.x; y/.ˇ/ for all x; y 2 V and ˛; ˇ 2 E.
•
˚.y; x/ D .˚.x; y// for all x; y 2 V.
The unitary group U.V; ˚/ of ˚ is the group of all E-linear endomorphisms of
V that preserve the hermitian form ˚. The special unitary group is deﬁned as
SU.V; ˚/ WD fg 2 U.V; ˚/ j det.g/ D 1g
if E is commutative and SU.V; ˚/ WD U.V; ˚/ if E is a quaternion algebra.
We denote by ZK the ring of integers of the ﬁeld K and we ﬁx some maximal
order M in E. Further, let d be the dimension of V over E.
Deﬁnition 2.1 An M-lattice in V is a ﬁnitely generated M-submodule of V that
contains an E-basis of V. If L is an M-lattice in V then its automorphism group is
Aut.L/ WD fg 2 U.V; ˚/ j Lg D Lg:
2.1
Completion of Lattices and Groups
Let P be a maximal two sided ideal of M and let p D P \ K. The completion
Up WD U.V ˝K Kp; ˚/ is an algebraic group over the p-adic completion Kp of K.
Let L  V be some M-lattice in V. We deﬁne the p-adic completion of L as
Lp WD L ˝ZK ZKp and we let
L.p/ WD fX  V j Xq D Lq for all prime ideals q ¤ pg;
be the set of all M-lattices in V whose q-adic completion coincides with the one of
L for all prime ideals q ¤ p.
Remark 2.2 By the local global principle, given a lattice X in Vp, there is a unique
lattice M 2 L.p/ with Mp D X.
To describe the groups Up in the respective cases, we need some notation: Let
R be one of E; K; ZK; M or a suitable completion. A hermitian module H.R/
with R-basis .e; f/ satisfying ˚.e; f/ D 1; ˚.e; e/ D ˚.f; f/ D 0 is called a
hyperbolic plane. By Kneser [18, Theorem (2.22)] any hermitian space over E is
either anisotropic (i.e. ˚.x; x/ ¤ 0 for all x ¤ 0) or it has a hyperbolic plane as an
orthogonal direct summand.
Remark 2.3 In our situation the following cases are possible:
•
E D K: Then .V˝KKp; ˚/ is a quadratic space and hence isometric to H.Kp/r ?
.V0; ˚0/ with .V0; ˚0/ anisotropic. The rank of Up is r. The group that acts type

506
M. Kirschmer and G. Nebe
preservingly on the thick Bruhat-Tits building BC deﬁned in Sect. 4.3 is
UC
p WD fg 2 Up j det.g/ D 1; .g/ 2 K2g
the subgroup of the special orthogonal group with trivial spinor norm .
•
P ¤ .P/. Then E ˝K Kp Š Kp ˚ Kp where the involution interchanges the
two components and Up Š GLd.Kp/ has rank r D d  1. As P is assumed to
be a maximal 2-sided ideal of M, the case that E is a quaternion algebra is not
possible here. Here we let
UC
p D fg 2 Up j det.g/ D 1g D SLd.Kp/:
•
ŒE W K D 4 and P D pM. Then Ep Š K22
p
and for x 2 Ep, .x/ is simply
the adjugate of x as .x/x 2 K. Let e2 D e 2 Ep such that .e/ D 1  e. Then
Vp D eVp
L.1  e/Vp. The hermitian form ˚ gives rise to a skew-symmetric
form
W eVp  eVp ! eEp.1  e/ Š Kp;
.ex; ey/ 7! ˚.ex; ey/ D e˚.x; y/.1  e/ :
From Ep D EpeEp we conclude that Vp D EpeEpV. Hence we can recover the
form ˚ from  and thus Up Š U.eV; / Š Sp2d.Kp/ has rank r D d. Here the
full group Up acts type preservingly on BC and we put UC
p WD Up.
•
In the remaining cases E ˝ Kp D EP is a skewﬁeld, which is ramiﬁed over Kp if
and only if P2 D pM. In all cases Up is isomorphic to a unitary group over EP.
Hence it admits a decomposition H.EP/r ? .V0; ˚0/ with .V0; ˚0/ anisotropic
where r is the rank of Up. If Ep is commutative, we deﬁne
UC
p WD fg 2 Up j det.g/ D 1g D SUp
and put UC
p D SUp WD Up in the non-commutative case.
2.2
The Genus of a Lattice
To shorten notation, we introduce the adelic ring A D A.K/ D Q
v Kv where v
runs over the set of all places of K. We denote the adelic unitary group of the A ˝K
E-module VA D A ˝K V by U.VA; ˚/. The normal subgroup
UC.VA; ˚/ WD f.gp/p 2 U.VA; ˚/ j gp 2 UC
p g  U.VA; ˚/
is called the special adelic unitary group.

One Class Genera of Lattice Chains Over Number Fields
507
The adelic unitary group acts on the set of all M-lattices in V by letting Lg D L0
where L0 is the unique lattice in V such that its p-adic completion .L0/p D Lpgp for
all maximal ideals p of ZK.
Deﬁnition 2.4 Let L be an M-lattice in V. Then
genus.L/ WD fLg j g 2 U.VA; ˚/g
is called the genus of L.
Two lattices L and M are said to be isometric (respectively properly isometric), if
L D Mg for some g 2 U.V; ˚/ (resp. g 2 SU.V; ˚/).
Two lattices L and M are said to be in the same proper special genus, if there exist
g 2 SU.V; ˚/ and h 2 UC.VA; ˚/ such that Lgh D M. The proper special genus of
L will be denoted by genusC.L/.
Let L be an M-lattice in V. It is well known that genus.L/ is a ﬁnite union of
isometry classes, c.f. [4, Theorem 5.1]. The number of isometry classes in genus.L/
is called the class number h.L/ of (the genus of) L. Similarly the proper special
genus is a ﬁnite union of proper isometry classes, the proper class number will be
denoted by hC.L/.
2.3
Normalised Genera
Deﬁnition 2.5 Let L be an M-lattice in V. Then
L# D fx 2 V j ˚.x; L/  Mg
is called the dual lattice of L. If p is a maximal ideal of ZK, then the unique M-lattice
X 2 L.p/ such that Xp D L#
p is called the partial dual of L at p. It will be denoted
by L#;p.
Deﬁnition 2.6 Let L be an M-lattice in V. Further, let P be a maximal two sided
ideal of M and set p D P \ K. If Ep Š Kp ˚ Kp then Lp is called square-free if
Lp D L#
p. In all other cases, Lp is called square-free if PL#
p  Lp  L#
p. The lattice
L is called square-free if Lp is square-free for all maximal ideals p of ZK.
Given a maximal two sided ideal P of M, we deﬁne an operator P on the set
of all M-lattices as follows:
P.L/ D
(
L C .P1L \ L#/
if P ¤ .P/;
L C .P1L \ PL#/
otherwise.
The operators generalise the maps deﬁned by Gerstein in [7] for quadratic spaces.
They are similar in nature to the p-mappings introduced by Watson in [32]. The
maps satisfy the following properties:

508
M. Kirschmer and G. Nebe
Remark 2.7 Let L be an M-lattice in V. Let P be a maximal two sided ideal of M
and set p D P \ ZK.
1. P.L/ 2 L.p/.
2. If Lp is integral, then .P.L//p D Lp ” Lp is square-free.
3. If Q is a maximal two sided ideal of M, then P ı Q D Q ı P.
4. If L is integral, there exist a sequence of not necessarily distinct maximal two
sided ideals P1; : : : ; Ps of M such that
L0 WD .P1 ı : : : ı Ps/.L/
is square-free. Moreover, the genus of L0 is uniquely determined by the genus of
L.
Proposition 2.8 Let L be an M-lattice in V and let P be a maximal two sided ideal
of M. Then the class number of P.L/ is at most the class number of L.
Proof The deﬁnition of P.L/ only involves taking sums and intersections of
multiples of L and its dual. Hence P.L/g D P.Lg/ for all g 2 U.V; ˚/ and similar
for g 2 U.VA; ˚/. In particular, P maps lattices in the same genus (isometry class)
to ones in the same genus (isometry class). The result follows.
ut
Deﬁnition 2.9 Let A be a two sided M-ideal. An M-lattice L is called A-maximal,
if ˚.x; x/ 2 A for all x 2 L and no proper overlattice of L has that property.
Similarly, one deﬁnes maximal lattices in Vp for a maximal ideal p of ZK.
Deﬁnition 2.10 Let P be a maximal two sided ideal of M and set p D P \ K. We
say that an M-lattice L is p-normalised if L satisﬁes the following conditions:
•
L is square-free.
•
If E D K then Lp Š H.ZKp/r ? M0 where M0 D 1
p .M/ and M denotes a
2ZKp-maximal lattice in an anisotropic quadratic space over Kp.
•
If Ep=Kp is a quadratic ﬁeld extension with different D.Ep=Kp/, then Lp Š
H.Mp/r ? M0 where M0 D 1
p .M/ for some D.Ep=Kp/-maximal lattice M
in an anisotropic hermitian space over Ep.
•
If ŒE W K D 4, then Lp D L#
p.
Here 1
P .M/ denotes the image of M under repeated application of P until this
process becomes stable.
Remark 2.11 Let P; p and L be as in Deﬁnition 2.10. Then the isometry class of Lp
is uniquely determined by .Vp; ˚/.
Proof There is nothing to show if ŒE W K D 4. Suppose now E D K. The space
KM0 is a maximal anisotropic subspace of .Vp; ˚/. By Witt’s theorem [25, Theorem
42:17] its isometry type is uniquely determined by .Vp; ˚/. Further, M0 is the unique
2ZKp-maximal ZKp-lattice in KM0, see [25, Theorem 91:1]. Hence the isometry
type of 1
p .M0/ depends only on .Vp; ˚/. The case ŒE W K D 2 is proved similarly.
ut

One Class Genera of Lattice Chains Over Number Fields
509
3
Genera of Lattice Chains
Deﬁnition 3.1 Let L WD .L1; : : : ; Lm/ and L0 WD .L0
1; : : : ; L0
m/ be two m-tuples of
M-lattices in V. Then L and L0 are isometric, if there is some g 2 U.V; ˚/ such
that Lig D L0
i for all i D 1; : : : ; m. They are in the same genus if there is such an
element g 2 U.VA; ˚/. Let
ŒL WD fL0 j L0 is isometric to Lg
and
genus.L/ WD fL0 j L0 and L are in the same genusg
denote the isometry class and the genus of L, respectively. The automorphism group
of L is the stabiliser of L in U.V; ˚/, i.e.
Aut.L/ D
m
\
iD1
Aut.Li/:
It is well known [4, Theorem 5.1] that any genus of a single lattice contains only
ﬁnitely many isometry classes. This is also true for ﬁnite tuples of lattices in V:
Lemma 3.2 Let L D .L1; : : : ; Lm/ be an m-tuple of M-lattices in V. Then
genus.L/ is the disjoint union of ﬁnitely many isometry classes. The number of
isometry classes in genus.L/ is called the class number of L.
Proof The case m D 1 is the classical case. So assume that m  2 and let
genus.L1/ WD ŒM1 ] : : : ] ŒMh, with Mi D L1gi for suitable gi 2 U.VA; ˚/.
We decompose genus.L/ D G1 ] : : : ] Gh where
Gi WD f.L0
1; : : : ; L0
m/ 2 genus.L/ j L0
1 Š Mig :
It is clearly enough to show that each Gi is the union of ﬁnitely many isometry
classes. By construction, any isometry class in Gi contains a representative of the
form .Mi; L0
2; : : : ; L0
m/ for some lattices L0
j in the genus of Lj. As all the Lj are lattices
in the same vector space V, there are a; b 2 ZK such that
bL1  Lj  1
aL1 for all 1  j  m:
As .Mi; L0
2; : : : ; L0
m/ D Lg for some g 2 U.VA; ˚/ we also have
bMi  L0
j  1
aMi for all 2  j  m:

510
M. Kirschmer and G. Nebe
So there are only ﬁnitely many possibilities for such lattices L0
j. Hence the set of all
m-tuples .Mi; L0
2; : : : ; L0
m/ 2 genus.L/ is ﬁnite and so is the class number.
ut
Remark 3.3 If L0  L then the class number of L0 is at most the class number of L.
3.1
Admissible Lattice Chains
Deﬁnition 3.4 Let P be a maximal 2-sided ideal of M and p WD K \ P. A lattice
chain
L WD fL0  L1  : : :  Lm1  Lmg
is called admissible for P, if
1. L0  L#;p
0 ,
2. PL0 	 Lm,
3. PL#;p
m  Lm if P D .P/.
We call a P-admissible chain ﬁne, if L0 is normalised for p in the sense of
Deﬁnition 2.10, Li is a maximal sublattice of Li1 for all i D 1; : : : ; m and either
(a) P D .P/ and Lm=PL#;p
m is an anisotropic space over M=P
(b) P ¤ .P/ and PL0 is a maximal sublattice of Lm.
Remark 3.5 In the case that P ¤ .P/ the length m of a ﬁne admissible lattice
chain is just m D r D dimE.V/  1. Also if P D .P/, then m D r, where r is the
rank of the p-adic group deﬁned in Remark 2.3.
Note that any admissible chain L contains a unique maximal integral lattice
which we will always denote by L0.
Remark 3.6 Let L D .L0; : : : ; Lr/ be a ﬁne admissible lattice chain for P.
(a) If P D .P/ then L0 WD L0=PL#;p
0
is a hermitian space over M=P and the
spaces Vj WD PL#;p
j
=PL#;p
0
(j D 1; : : : ; r) deﬁne a maximal chain of isotropic
subspaces of this hermitian space. We call the chain .V1; : : : ; Vr1/ truncated.
(b) If P ¤ .P/ then L0 WD L0=PL0 is a vector space over M=P and the spaces
Vj WD Lj=PL0 (j D r; : : : ; 1) form a maximal chain of subspaces. Here we call
the chain .Vr1; : : : ; V1/ truncated.
For the different hermitian spaces L0, the number of such chains of isotropic
subspaces can be found by recursively applying the formulas in [29, Exercises 8.1,
10.4, 11.3].
Lemma 3.7 The ﬁne admissible lattice chain L represents a one-class genus of
lattice chains if and only if L0 represents a one-class genus of lattices and Aut.L0/
is transitive on the maximal chains of (isotropic) subspaces of L0.

One Class Genera of Lattice Chains Over Number Fields
511
Proof If L has class number one, so has any lattice in the chain L. Suppose now
L0 has class number one. Let L0 be any other lattice chain in the genus of L. We
have to show that L and L0 are isometric. To that end, let L0
0 be the unique maximal
integral lattice in L0. Then L0 and L0
0 are isometric, as they are in the same genus. So
without loss of generality, L0 D L0
0. Then L and L0 correspond to unique maximal
chains of (isotropic) subspaces of L0. Since Aut.L0/ acts transitively on these chains
of subspaces, it yields an isometry from L to L0.
ut
4
Chamber Transitive Actions on Afﬁne Buildings
Kantor et al. [11] classiﬁed discrete groups acting chamber transitively and type
preservingly on the afﬁne building of a simple adjoint algebraic group of relative
rank  2 over a locally compact local ﬁeld. Such groups are very rare and hence
this situation is an interesting phenomenon, further studied in [9, 10, 12, 19, 22], and
[21] (and many more papers by these authors) where explicit constructions of the
groups are given. One major disadvantage of the existing literature is that the proof
in [11] is very sketchy, essentially the authors limit the possibilities that need to be
checked to a ﬁnite number.
From the classiﬁcation of the one-class genera of admissible ﬁne lattice chains in
Sect. 5, we obtain a number theoretic construction of the groups in [11] over ﬁelds
of characteristic 0. It turns out that we ﬁnd essentially all these groups and that our
construction allows to ﬁnd one more case: The building of U5.Q3.
p
3// of type
C  BC2, see Proposition 5.3 (1), which, to our best knowledge, has not appeared in
the literature before.
4.1
S-Arithmetic Groups
We assume that .V; ˚/ is a totally positive deﬁnite hermitian space, i.e. K is totally
real and ˚.x; x/ 2 K is totally positive for all non-zero x 2 V.
Let S D fp1; : : : ; pmg be a ﬁnite set of prime ideals of ZK. For a prime ideal p we
denote by p the p-adic valuation of K. Then the ring of S-integers in K is
ZS WD fa 2 K j q.a/  0 for all prime ideals q … Sg:
Let L be some M-lattice in .V; ˚/ and put LS WD L ˝ZK ZS. Then the group
Aut.LS/ WD fg 2 U.V; ˚/ j LSg D LSg
is an S-arithmetic subgroup of U.V; ˚/.

512
M. Kirschmer and G. Nebe
Remark 4.1 For any prime ideal p, the group U.V; ˚/ (being a subgroup of Up)
acts on the Bruhat-Tits building B of the group Up deﬁned in Remark 2.3. Assume
that the rank of Up is at least 1. The action of the subgroup Aut.LS/ is discrete and
cocompact on B, if and only if p 2 S and .Vq; ˚/ is anisotropic for all p ¤ q 2 S.
4.2
The Action on the Building of Up
In the following we ﬁx a prime ideal p and assume that S D fpg.
A lattice class model for the afﬁne building B has been described in [1]. Note
that [1] imposes the assumption that the residue characteristic of Kp is p ¤ 2. This
is only necessary to obtain a proof of the building axioms that is independent from
Bruhat-Tits theory. For p D 2, the dissertation [6] contains the analogous description
of the Bruhat-Tits building for orthogonal groups. For all residue characteristics, the
chambers in B correspond to certain ﬁne lattice chains in the natural Up-module
Wp.
Let L be a ﬁxed p-normalised lattice in V and put Vp WD V ˝K Kp.
In the case that E ˝K Kp is a skewﬁeld, we decompose the completion
Lp D H.Mp/r ? M0 D
r?
iD1
hei; fiiMp ? M0
as in Deﬁnition 2.10. Then Vp D V0 ? he1; : : : ; er; f1; : : : ; friKp where V0 D KpM0
is anisotropic. Then the standard chamber corresponding to L and the choice of this
hyperbolic basis is represented by the admissible ﬁne lattice chain
L D .L D L0; L1; : : : ; Lr/
where Lj 2 L.p/ is the unique lattice in V such that
.Lj/p D
j
?
iD1
hei; fiiMp ?
r?
iDjC1
hei; fiiMp ? M0:
Now assume that E˝K Kp Š K22
p
and Wp D eVp for some primitive idempotent
e such that .e/ D 1  e as in Remark 2.3. Then Wp carries a symplectic form 
and the lattice Lpe has a symplectic basis .e1; f1; : : : ; er; fr/, i.e.
Lpe D
r?
iD1
hei; fiiZKp

One Class Genera of Lattice Chains Over Number Fields
513
with .ei; fi/ D 1. The standard chamber corresponding to L and the choice of this
symplectic basis is represented by the admissible ﬁne lattice chain
L D .L D L0; L1; : : : ; Lr/
where Lj 2 L.p/ is the unique lattice in V such that
.Lj/p D
j
?
iD1
hei; fiiMp ?
r?
iDjC1
hei; fiiMp:
In the last and most tricky case E ˝K Kp Š Kp ˚ Kp. Then Wp D VpeP for any
of the two maximal ideals P of M that contain p, Up  SL.Wp/ and Mp WD LpeP
is a lattice in Wp. To deﬁne the standard chamber ﬁx some ZKp-basis .e1; : : : ; er/ of
Mp. Then the ﬁne admissible lattice chain
L D .L D L0; L1; : : : ; Lr/
where Lj is the unique lattice in V such that
•
.Lj/Q D LQ for all prime ideals Q ¤ P of M
•
.Lj/P D Lj
iD1heiiMP ˚ Lr
iDjC1heiiMP:
Lemma 4.2 Assume that P ¤ .P/, so E˝K Kp Š Kp ˚Kp and keep the notation
from above. Let M be some M-lattice in V. Then
fX 2 M.p/ j ePXp D ePMpg
contains a unique lattice Y with Y D Y#;p.
Proof As Y 2 M.p/ it is enough to deﬁne Yp D ePMp ˚ .1  eP/Xp. This
Mp-lattice is unimodular if and only if
.1  eP/Xp D fx 2 .1  eP/V j ˚.ePMp; x/  Mpg:
The result follows.
ut
Thus for P ¤ .P/ the stabiliser in the S-arithmetic group Aut.LS/ of a vertex
in the building B is the automorphism group of a p-unimodular lattice. Also if
P D .P/, any vertex in the building B corresponds to a unique homothety class
of lattices ŒMp D faMp j a 2 K
pg. So by Remark 2.2 there is a unique lattice
X 2 L.p/ with Xp D Mp. Hence the stabilisers of the vertices in B are exactly the
automorphism groups of the respective lattices in V. In particular these are ﬁnite
groups.
Remark 4.3 As Up acts transitively on the chambers of B, any other chamber (i.e.
r-dimensional simplex) in B corresponds to some lattice chain in the genus of L D

514
M. Kirschmer and G. Nebe
.L0; : : : ; Lr/. The .r  1/-dimensional simplices are the Up-orbits of the subchains
Lj WD .Li j i ¤ j/ of L for j D 0; : : : ; r. We call these simplices panels and j the
cotype of the panel Lj.
Theorem 4.4 Let L D .L0; : : : ; Lr/ be a ﬁne admissible lattice chain for P of class
number one. Put L WD L0 and S WD fpg. Then Aut.LS/ acts chamber transitively on
the (weak) Bruhat-Tits building B of the completion Up.
Proof We use the characterisation of Lemma 3.7. Let C be the chamber of B that
corresponds to L by the construction above and let D be some other chamber in B.
Then there is some element g 2 Up with Cg D D. As the genus of L consists only
of one class, there is some h 2 Aut.LS/ such that gh 2 Up stabilises the vertex v
that corresponds to L. So gh 2 StabUp.Lp/ and Dh is some chamber in B containing
the vertex v. Now Aut.L/ acts transitively on the set of all ﬁne admissible lattice
chains for P starting in L, so there is some h0 2 Aut.L/ such that Dhh0 D C. Thus
the element hh0 2 Aut.LS/ maps D to C.
ut
As in [27, Proposition 1] we obtain the following if and only if statement:
Proposition 4.5 The group AutC.LS/ acts chamber transitively on the (weak)
Bruhat-Tits building B if and only if the special class number hC.L/ D 1 or
equivalently if hC.L0/ D 1 and AutC.L0/ is transitive on the maximal chains of
(isotropic) subspaces of L0.
For the maximal S-arithmetic group Aut.LS/ an if and only if statement is
technically more involved due to the fact that U.V; ˚/ is not necessarily connected
and so we do not have strong approximation for this group. Here we obtain that
Aut.LS/ acts chamber transitively on B if and only if Aut.L0/ acts transitively on the
maximal chains of (isotropic) subspaces of L0 (see Lemma 3.7) and all p-neighbours
of L0 (i.e. all lattices L in the genus of L0 with L=.L\L0/ Š M=P for some maximal
twosided ideal P of M over p) are isometric to L0.
For the orthogonal groups we can further characterise the transitivity of Aut.LS/
on B: Let g 2 U.V; ˚/ be some isometry of determinant 1. Then the union of the
proper special genera of L and g.L/ consists of exactly hC.L/ isometry classes. Let
N C
p .L/ WD fMh j M is an iterated p-neighbour; h 2 UC.V; ˚/g:
Then by Benham and Hsia [2] the set N C
p .L/ consists of a  2 proper special
genera. The exact value of a is given by some local condition, see [2, Equation
(1.1)]. In particular, the union of all isometry classes of iterated p-neighbours is the
following union of proper special genera
genusC.L/ [ genusC.Lg/ [ genusC.L0/ [ genusC.L0g/:
where L0 denotes any p-neighbour of L. The above union consists of a single
isometry class, if and only if hC.L/ D 1 and a D 1.

One Class Genera of Lattice Chains Over Number Fields
515
4.3
The Oriﬂamme Construction
The buildings B described above are in general not thick buildings, i.e. there are
panels that are only contained in exactly two chambers. Such panels are called
thin. To obtain a thick building BC (with a type preserving action by the group
UC
p deﬁned in Remark 2.3) we need to apply a generalisation of the oriﬂamme
construction as described in [1, Section 8]. In particular [1, Section 8.1] gives the
precise situations which panels are thin for the case that p ¤ 2. Also for p D 2 only
the panels of cotype 0 and r can be thin. We refrain from describing the situations
for p D 2 in general, but refer to the individual examples below.
Remark 4.6 Assume that P D .P/.
(a) Assume that there are only two lattices L0 and L0
0 in the genus of L0 such that
L1  L0; L0
0  L#;p
1 :
Then L and L0 WD .L0
0; L1; : : : ; Lr/ are the only chambers in B that contain the
panel L0 D .L1; : : : ; Lr/ and hence this panel is thin. Then we replace the vertex
represented by L1 by the one represented by L0
0.
(b) Assume that there are only two lattices Lr and L0
r in the genus of Lr such that
PL#;p
r1  Lr; L0
r  Lr1:
Then L and L0 WD .L0; L1; : : : ; L0
r/ are the only chambers in B that contain the
panel Lr D .L0; : : : ; Lr1/ and hence this panel is thin. Then we replace the
vertex represented by Lr1 by the one represented by L0
r.
(c) After this construction the standard chamber LC in the thick building BC
is either represented by L, .L0; L0
0; L2; : : : ; Lr/, .L0; L1; : : : ; Lr2; Lr; L0
r/, or
.L0; L0
0; L2; : : : ; Lr2; Lr; L0
r/. Note that by construction the chain L can be
recovered from LC, so the stabiliser of L is equal to the stabiliser of all lattices
in LC. Moreover every element in Up mapping the chain L to some other chain
L0 maps the chamber LC to the chamber .L0/C .
For more details we refer to [1, Section 8.3].
In particular by part (c) of the previous remark we ﬁnd the important corollary.
Corollary 4.7 In the situation of Theorem 4.4 the group Aut.LS/ also acts chamber
transitively (not necessarily type preservingly) on the thick building BC.
Remark 4.8 Also in the situation where P ¤ .P/, i.e. Ep D Kp ˚ Kp, the
stabilisers of the points in the building are not the stabilisers of the lattices in the
lattice chain. By Lemma 4.2 the lattices Li (i D 1; : : : ; r) need to be replaced
by the uniquely deﬁned lattices Yi 2 Li.p/, such that .Yi/p is unimodular (as in
Lemma 4.2) and Yi \ L0 D Li. We refer to this construction as a variant of the
oriﬂamme construction in the examples below.

516
M. Kirschmer and G. Nebe
Theorem 4.9 Let L D .L0; : : : ; Lr/ be a ﬁne P-admissible lattice chain for some
maximal two sided ideal P of M such that .P/ D P. Suppose that the oriﬂamme
construction replaces L by some sequence of lattices LC which is one of
L D .L0; : : : ; Lr/; .L0; L0
0; L2; : : : ; Lr/;
.L0; L1; : : : ; Lr2; Lr; L0
r/ or .L0; L0
0; L2; : : : ; Lr2; Lr; L0
r/ :
Then L0 and L0
0 as well as Lr and L0
r are in the same genus but not in the same proper
special genus. Put L WD L0 and S WD fpg. Then AutC.LS/ WD Aut.LS/ \ SU.V; ˚/
acts type preservingly on the thick building BC. This action is chamber transitive if
and only if hC.L/ D 1 and AutC.L/ is transitive on the maximal chains (in the ﬁrst
two cases) respectively truncated maximal chains (in the last two cases) of isotropic
subspaces of L deﬁned in Remark 3.6.
Proof The proof that the action is chamber transitive in all cases is completely
analogous to the proof of Theorem 4.4. We only need to show that hC.L/ D 1. So let
M be some lattice in the same proper special genus as L. By strong approximation
for UC.VA; ˚/ (see [17]), there is some element g 2 UC
p and h 2 SU.V; ˚/ such
that Mh D Lg. As AutC.LS/ is chamber transitive and type preserving, there is some
f 2 AutC.LS/ such that Lf D Mh so M D Lfh1 is properly isometric to L.
ut
To obtain a classiﬁcation of all chamber transitive discrete actions on BC we
hence need a classiﬁcation of all proper spinor genera with proper class number
one. The thesis [16] only lists the genera of class number one and two. In some
cases, h.L/ D hC.L/ for every square-free lattice L, for example if:
(a) E D K, dim.V/  5 and K has narrow class number one [25, Theorem 102.9],
(b) ŒE W K D 2 and dimE.V/ is odd [28],
(c) ŒE W K D 4.
It seems to be very unlikely that there are square-free lattices L with hC.L/ D 1 and
h.L/ > 2 that yield a chamber transitive action.
5
The One-Class Genera of Fine Admissible Lattice Chains
We split this section into three sections dealing with the different types of hermitian
spaces (ŒE W K D 1; 2; 4). The fourth section comments on the exceptional groups.
Suppose L D .L0; : : : ; Lr/ is a ﬁne P-admissible lattice chain of class number
one, where P is a maximal two sided ideal of M. Then p WD P \ ZK together with
L0 determines the isometry class of L WD L.L0; p/. Moreover L0 is a p-normalised
lattice in .V; ˚/ of class number one and by Corollary 3.7 the ﬁnite group Aut.L0/
acts transitively on the ﬁne chains of (isotropic) subspaces of L0 as in Remark 3.6.
The one- and two-class genera of lattices in hermitian spaces .V; ˚/ have been
classiﬁed in [16]. For all such lattices L0 and all prime ideals p, for which L0 is

One Class Genera of Lattice Chains Over Number Fields
517
p-normalised, we check by computer if Aut.L0/ acts transitively on the ﬁne chains
of (isotropic) subspaces of L0. Note that the number of such chains grows with the
norm of p, so the order of Aut.L0/ gives us a bound on the possible prime ideals
p. We also checked weaker conditions (similar to the ones in Theorem 4.9) that
would imply a chamber transitive action on the thick building BC, i.e. h.L0/  2
and transitivity only on the truncated maximal chains. The cases h.L0/ D 2 never
gave a transitive action on the chambers of BC.
For any non-empty subset T of f1; 2; : : : ; rg we list the automorphism group GT
of the subchain .Li/i2T. With our applications on the action on buildings in mind,
we also give the order of
GC
T WD GT \ UC
p
where UC
p is given in Remark 2.3. Note that we will always assume that the rank of
the group Up is r  2.
5.1
Quadratic Forms
In this section suppose that E D K. We denote by An; Bn; Dn; En the root lattices
of the same type over ZK. If L is a lattice and a 2 K we denote by .a/L the lattice
L with form rescaled by a. Sometimes we identify lattices over number ﬁelds using
the trace lattice. For instance .E8/p
3 denotes a hermitian lattice over ZŒ 1C
p
3
2
 of
dimension 4 whose trace lattice over Z is isometric to E8.
5.1.1
Quadratic Forms in More than Four Variables
If E D K, dimK.V/  5 and .V; ˚/ contains a one-class genus of lattices, then by
Kirschmer [16, Section 7.4] either K D Q or K D QŒ
p
5 where one has essentially
one one-class genus of lattices of dimension 5 and 6 each. The rational lattices have
been classiﬁed in [20] and are available electronically from [13].
Proposition 5.1 If E D K, dimK.V/  5 and .V; ˚/ contains a ﬁne p-admissible
lattice chain L.L0; p/ of class number one for some prime ideal p, then K D Q and
L.L0; p/ is one of the following nine essentially different chains:
1. L.E8; 2/ D .E8; D8; D4 ? D4; .2/D#
8; .2/E8/. After applying the oriﬂamme
construction, the lattice chain becomes

518
M. Kirschmer and G. Nebe
0
E8
0′ E′
8
•
2
D4 ⊥D4
•
4
(2)E8
4′
(2)E′
8
The automorphism groups are as follows
T
GT
#GC
T
fig
2:OC
8 .2/:2
213  35  52  7
f2g
Aut.D4/ o C2
213  34
fi; jg
21C6
C :S8
213  32  5  7
f2; ig
N:.S3  S3 o C2/
213  33
fi; j; kg
21C6
C :.C2
3:PSL2.7// 213  3  7
f2; i; jg
N:.C2  S3 o C2/ 213  32
f0; 00; 4; 40g
21C6
C :.C3
2 W S4/
213  3
f2; i; j; kg
N:.C3
2  S3/
213  3
f0; 00; 2; 4; 40g
N:C3
2
213
where N
D O2.Gf2g/ Š
21C4
C
 21C4
C
and i; j; k
2 f0; 00; 2; 4; 40g with
#fi; j; kg D 3.
2. L.E7; 2/ D .E7; D6 ? A1; D4 ? .2/B3; .2/B7/. After applying the oriﬂamme
construction, the lattice chain becomes
0
E7
0′ E′
7
•
2
D4 ⊥(2)B3
3
(2)B7
The automorphism groups are as follows

One Class Genera of Lattice Chains Over Number Fields
519
T
GT
#GC
T
fig
C2  PSp6.2/
29  34  5  7
f2g
Aut.D4/  C2 o S3 29  33
f3g
C2 o S7
29  32  5  7
f0; 00g
C6
2:S6
29  32  5
fi; 2g
N:S2
3
29  32
fi; 3g
C7
2:PSL2.7/
29  3  7
f2; 3g
N:.C2  S2
3/
29  32
f0; 00; 2g; fi; 2; 3g
N:D12
29  3
f0; 00; 3g
C7
2:S4
29  3
f0; 00; 2; 3g
N:C2
2
29
where N WD O2.Gf2g/ Š 21C4
C
 Q8 and i 2 f0; 00g. The one-class chain
L.B7; 2/ D fB7; .2/.D#
4 ? B3/; .2/D#
6 ? B1; .2/E#
7g
yields the same stabilisers.
3. L.A6; 2/ D fA6; X; .2/X#;2; .2/A6g. Here X is an indecomposable lattice with
Aut.X/ D .C4
2  C3/:D12. After applying the oriﬂamme construction, the lattice
chain becomes
0
A6
0′ A′
6
3
(2)A6
3′
(2)A′
6
The automorphism groups are as follows
T
GT
#GC
T
sgdb
#T D 1
C2  S7
23  32  5  7

f0; 00g; f3; 30g
C2  S3  S4 23  32
43
f0; 3g; f0; 30g; f00; 3g; f00; 30g C2  PSL2.7/ 23  3  7
42
#T D 3
C2  S4
23  3
12
f0; 00; 3; 30g
C2  D8
23
3
Here, and in the following tables, the column sgdb gives the label of GC
T as
deﬁned by the small group database [3].

520
M. Kirschmer and G. Nebe
The admissible one-class chain
L..7/A#
6; 2/ D f.7/A#
6; .7/X#;7; .14/X#; .14/A#
6g
yields the same groups.
4. L.E6; 2/ D fE6; Y0; D4 ? .2/A2g. Here Y0 is the even sublattice of B5 ? .3/B1.
It is indecomposable and Aut.Y0/ D Aut.B5 ? .3/B1/ Š C2  C2 o S5. After
applying the oriﬂamme construction, the lattice chain becomes
0
E6
0′ E′
6
•
2
D4 ⊥(2)A2
The automorphism groups are as follows
T
GT
#GC
T
sgdb
fig
C2  U4.2/:2 26  34  5

f2g
Aut.D4/  D12 26  33

f0; 00g
C2 o S5
26  3  5 11358
fi; 2g
N:S2
3
26  32
8277
f0; 00; 2g
N:D12
26  3
201
where N D O2.G3/ Š 21C4
C
C2 and i 2 f0; 00g. The admissible one-class chains
L.A2 ? D4; 2/ D fA2 ? D4; .2/Y#;2; .2/E6g
L..3/.A#
2 ? D4/; 2/ D f.3/.A#
2 ? D4/; .6/Y#; .6/E6g
L..3/E#
6; 2/ D f.3/E#
6; .3/Y#;3; .3/.A2 ? D4/#;3g
yield the same stabilisers.
5. L.D6; 2/ D fD6; D4 ?
.2/B2; .2/B6g. Here the application of the oriﬂamme
construction is not necessary. The automorphism groups are as follows
T
GT
#GC
T
sgdb
f0g; f2g
C2 o S6
28  32  5

f1g
Aut.D4/ ? C2 o S2 28  32

f0; 1g; f1; 2g
C6
2:.C2  S4/
28  3
1086007
f0; 2g
C6
2:.C2  S4/
28  3
1088660
f0; 1; 2g
C6
2:.C2  D8/
28
6331

One Class Genera of Lattice Chains Over Number Fields
521
6. L.E6; 3/ D fE6; A3
2; .3/E6g. Here the application of the oriﬂamme construction
is not necessary. The automorphism groups are as follows
T
GT
#GC
T
sgdb
f0g; f2g
C2  U4.2/:2
26  34  5

f1g
D12 o S3
25  34

f0; 2g
31C2
C :.C2  GL2.3// 23  34
533
f0; 1g; f1; 2g
N:.C2
2  S4/
23  34
704
f0; 1; 2g
N:.C2
2  S3/
2  34
10
where N D O3.Gf1g/ Š C3
3.
7. L.B5 ? .3/B1; 3/ D fB5 ? .3/B1; B2 ? A2 ? .3/B2I B1 ? .3/B5g. Here the
application of the oriﬂamme construction is not necessary. The automorphism
groups are as follows
T
GT
#GC
T
sgdb
f0g; f2g
C2  C2 o S5
26  3  5

f1g
C2 o S2  D12  C2 o S2 25  3
144
f0; 2g
C2
2  GL2.3/
23  3
3
f0; 1g; f1; 2g
C2
2  D8  S3
23  3
8
f0; 1; 2g
C3
2  S3
2  3
2
For 0  i  2 let Yi be the even sublattice of L.B5 ? .3/B1; 3/i, see also part (4).
Then the admissible one-class chains
L.Y0; 3/ D fY0; Y1; Y2g and L..2/Y#;2
0 ; 3/ D ..2/Y#;2
0 ; .2/Y#;2
1 ; .2/Y#;2
2 /
yield the same groups.
8. L.A5; 2/ D fA5; .2/B1 ? Z; .2/.A2 ? B3/g. Here Z is the even sublattice of B3 ?
.3/B1 and Aut.Z/ D Aut.B3 ? .3/B1/. After applying the oriﬂamme construction,
the lattice chain becomes
0
A5
0′ A′
5
2
(2)(A2 ⊥B3)
The automorphism groups are as follows

522
M. Kirschmer and G. Nebe
T
GT
#GC
T
sgdb
f0g; f00g
C2  S6
23  32  5 118
f2g
D12  C2 o S3 23  32
43
#T D 2
C2
2  S4
23  3
12
f0; 00; 2g
C2
2  D8
23
3
The admissible one-class chains
L..3/A#;3
5 ; 2/ D f.3/A#;3
5 ; .6/B1 ? .3/Z#;3; .6/.A#
2 ? B3/g
L.A2 ? B3; 2/ D fA2 ? B3; B1 ? .2/Z#;2; .2/A#;2
5 g
L..3/.A#
2 ? B3/; 2/ D f.3/.A#
2 ? B3/; .3/B1 ? .6/Z#; .6/A#
5g
yield the same stabilisers.
9. L.B5; 3/ D fB5; B2 ? A2 ? .3/B1; B1 ? .3/B4g. After applying the oriﬂamme
construction, the lattice chain becomes
0
B5
0′ B′
5
•
2
(B1 ⊥(3)B4)
T
GT
#GC
T
sgdb
fig
C2 o S5
26  3  5 11358
f2g
C2 o S4  C2
25  3
204
f0; 00g .C2  D8/  S3 23  3
3
fi; 2g
C2  GL2.3/ 23  3
8
f0; 00; 2g
C2
2  S3
2  3
2
where i 2 f0; 00g. The admissible one-class chain
L.B4 ? .3/B1; 3/ D fB4 ? .3/B1; B1 ? A2 ? .3/B2; .3/B5g
yields the same stabilisers.
5.1.2
Quadratic Forms in Four Variables
Now assume that K D E and dimK.V/ D 4. By Kirschmer [16, Theorem 7.4.1]
there are up to similarity exactly 481 one-class genera of lattices if K D Q and
additionally 607 such genera over 22 other base ﬁelds where the largest degree is

One Class Genera of Lattice Chains Over Number Fields
523
ŒK W Q D 5 [16, Theorem 7.4.2]. As we are only interested in the case where the
rank of Up is 2, we only need to consider pairs .L; p/ where L is one of these 1088
lattices and p a prime ideal such that Vp Š H.Kp/ ? H.Kp/. In this case the building
B of Up is of type A1 ˚ A1 and not connected even after oriﬂamme construction.
We will not list the groups acting chamber transitively on BC, also because of the
numerous cases of one-class lattice chains in this situation.
To list the lattices we need some more notation. We denote by Q WD Q˛;1;p1;:::;ps
a deﬁnite quaternion algebra over K D Q.˛/ which ramiﬁes exactly at the ﬁnite
places p1; : : : ; ps of K. Given an integral ideal a of ZK coprime to all pi, then
O˛;1;p1;:::;psIa denotes an Eichler order of level a in Q.
We omit the subscript ˛ whenever K D Q. Similarly, the subscript a is omitted,
if a D ZK, i.e. the order is maximal.
Then O˛;1;p1;:::;psIa with the reduced norm form of Q yields a quaternary lattice
over ZK. By Nebe [24, Corollary 4.6] this lattice is unique in its genus, if and only
if all Eichler orders of level a in Q are conjugate.
Hence we identify such orders with their quaternary lattices.
Proposition 5.2 Let L be a p-normalised, quaternary lattice over ZK such that
L.L; p/ is a ﬁne p-admissible lattice chain of length 2 and class number one. Then
one of the following holds.
1. K D Q and either
•
p D 2 and L Š O1;3 Š A2 ? A2 or O1;5.
•
p 2 f3; 5; 11g and L Š O1;2 Š D4.
•
p D 3 and L Š B4.
2. K D Q.
p
5/ and either
•
NrK=Q.p/ 2 f4; 5; 9; 11; 19; 29; 59g and L Š Op
5;1. This lattice is called
H4 in [26].
•
NrK=Q.p/ 2 f5; 11g and L Š Op
5;1I2ZK Š D4.
•
p D 2ZK and L Š Op
5;1Ia Š L.Op
5;1; a/2 with NrK=Q.a/ 2 f5; 11g.
3. K D Q.
p
2/ and either
•
NrK=Q.p/ 2 f2; 7; 23g and L Š Op
2;1.
•
NrK=Q.p/ D 7 and L Š Op
2;1I
p
2ZK Š L.Op
2;1/2 or L is isometric to a
unimodular lattice of norm
p
2ZK in .V; ˚/ Š h1; 1; 1; 1i. By O’Meara [25,
IX:93], the genus of the latter lattice is uniquely determined and it has class
number one by Kirschmer [16].
•
p D
p
2ZK and L Š Op
5;1Ia Š L.Op
5;1; a/2 with NrK=Q.a/ D 7.
4. K D Q.
p
3/ and either
•
p D
p
3ZK and L Š Op
3;1Ip2 or L is isometric to a unimodular lattice of
norm p2 in .V; ˚/ Š h1; 1; 1; 1i. Again, this lattice is unique up to isometry.
•
p D p2 and L Š Op
3;1I
p
3ZK.

524
M. Kirschmer and G. Nebe
5. K D Q.
p
13/ and NrK=Q.p/ D 3 and L Š Op
13;1. This lattice is called D
4 in
[26].
6. K D Q.
p
17/ and NrK=Q.p/ D 2 and L Š Op
17;1. This lattice is called
.2A2/ in [26].
7. K D Q.9/ is the maximal totally real subﬁeld of the cyclotomic ﬁeld Q.9/
and p D 2ZK and L Š O;1;p3.
8. K D Q.˛/ Š QŒX=.X3X23XC1/ is the unique totally real number ﬁeld of
degree 3 and discriminant 148. Then either p D p5 and L Š O˛;1Ip2 or p D p2
and L Š O˛;1Ip5.
9. K D Q.˛/ Š QŒX=.X3  X2  4X C 2/ is the unique totally real number ﬁeld
of degree 3 and discriminant 316. Then p D p2 and L Š O˛;1Ip4.
10. K D Q.˛/ Š QŒX=.X4  X3  3X2 C X C 1/ is the unique totally real
number ﬁeld of degree 4 and discriminant 725. Then L Š O˛;1 and NrK=Q.p/ 2
f11; 19g or p is the ramiﬁed prime ideal of norm 29.
11. K D Q.˛/ Š QŒX=.X4  4X2  X C 1/ is the unique totally real number ﬁeld
of degree 4 and discriminant 1957. Then p D p3 and L Š O˛;1.
12. K D Q.˛/ Š QŒX=.X4  X3  4X2 C X C 2/ is the unique totally real number
ﬁeld of degree 4 and discriminant 2777. Then p D p2 and L Š O˛;1.
Here pq denotes a prime ideal of ZK of norm q. Conversely, in all these cases the
chain L.L; p/ is p-admissible and has class number one.
5.2
Hermitian Forms
In this section we treat the case that ŒE W K D 2, so E is a totally complex extension
of degree 2 of the totally real number ﬁeld K. The automorphism groups of the
hermitian lattices that occur in the tables below are strongly related to maximal
ﬁnite symplectic matrix groups classiﬁed in [14]. We use the notation introduced
in this thesis (see also [15]) to name the groups. All hermitian lattices with class
number  2 are classiﬁed in [16, Section 8] and listed explicitly for n  3 in [16,
pp. 129–140].
Proposition 5.3 Let L.L0; p/ be a ﬁne P-admissible chain of class number one and
of length at least 2. Then K D Q, d WD dimE.V/ 2 f3; 4; 5g and one the following
holds:
1. E D Q.
p
3/, p D 3Z and L0 Š B5 ˝Z ZŒ 1C
p
3
2
 Š .A5
2/p
3:
L.L0; 3/ D fL0; .A2
2 ? .3/E#
6/p
3; .A2 ? E8/p
3g:
Here the application of the oriﬂamme construction is not necessary. The
automorphism groups are as follows:

One Class Genera of Lattice Chains Over Number Fields
525
T
GT
#GC
T
f0g
C6 o S5
27  35  5
f1g
C6 o S2  p
3Œ˙31C2
C :SL2.3/3
26  35
f2g
C6  p
3ŒSp4.3/  C34
27  35  5
f0; 1g
C6 o S2  p
3Œ˙31C2
C :C63
24  35
f1; 2g C6  p
3Œ˙.31C2
C :SL2.3/  C3/4
24  35
f0; 1g
C6  p
3Œ˙33 W S4  C34
24  35
f1; 2g C6  p
3Œ˙.31C2
C :SL2.3/  C3/4
24  35
f0; 1; 2g
C6  p
3Œ˙31C2
C :C6  C34
22  35
2. E D Q.
p
7/, p D 2Z and L0 Š .E8/p
7:
L..E8/p
7; 2/ D f.E8/p
7; .D8/p
7; .D4 ? D4/p
7; ..2/D8/p
7g:
After applying the variant of the oriﬂamme construction described in Remark 4.8,
the lattice chain becomes
0
(E8)√−7
∼=
3′
0′
3
•
•
•
The automorphism groups are as follows:
T
GT
#GC
T
sgdb
#T D 1
2:Alt7
24  32  5  7

f0; 00g; f3; 30g
SL2.3/  C3 W 2 24  32
124
f0; 3g; f0; 30g; f00; 3g; f00; 30g
SL2.7/
24  3  7
114
#T D 3
2:S4
24  3
28
f0; 00; 3; 30g
Q16
24
9
3. E D Q.
p
3/, p D 2Z and L0 Š .E8/p
3:
L..E8/p
3; 2/ D f.E8/p
3; .D4 ? D4/p
3; ..2/E8/p
3g:
Here the application of the oriﬂamme construction is not necessary. The
automorphism groups are as follows:

526
M. Kirschmer and G. Nebe
T
GT
#GC
T
f0g; f2g
p
3ŒSp4.3/  C34 27  34  5
f1g
p
3ŒSL2.3/  C32
2 27  33
f0; 2g
21C4

:Alt5  C3
27  3  5
f0; 1g; f1; 2g SL2.3/ o C2  C3
27  32
f0; 1; 2g
.Q8 o S2/ W C3  C3 27  3
4. E D Q.
p
1/, p D 2Z and L0 Š .E8/p
1:
L..E8/p
1; 2/ D f.E8/p
1; .D8/p
1; .D4 ? D4/p
1g:
Here the application of the oriﬂamme construction is not necessary. After
applying the oriﬂamme construction, one obtains the following lattices
0
(E8)√−1
0′ (E8)′√−1
2
(D4 ⊥D4)√−1
T
GT
#GC
T
f0g; f00g
iŒ.21C4
C YC4/:S64 29  32  5
f2g
iŒ.D8YC4/:S32
2 29  32
f0; 2g; f00; 2g
29  3
f0; 00g
29  3
f0; 2; 00g
29
5. E D Q.
p
3/, p D 3Z and L0 D B4 ˝Z ZŒ 1C
p
3
1
 Š .E8/p
3: Here the
application of the oriﬂamme construction is not necessary.
L.L0; 3/ D f.A4
2/p
3; .A2 ? .3/E#
6/p
3; ..3/E8/p
3g:
After applying the oriﬂamme construction, the chain becomes:
2
((3)E8)√−3
2′ ((3)E8)′√−3
•
0
(A4
2)√−3

One Class Genera of Lattice Chains Over Number Fields
527
The automorphism groups are as follows:
T
GT
#GC
T
sgdb
f0g
C6 o S4
26  34

f2g; f20g
p
3ŒSp4.3/  C34 27  34  5

f0; 2g; f0; 20g
.˙C4
3/:S4
24  34
3085
f2; 20g
.C6  31C2
C /:S3
24  34
2895
f0; 2; 20g
.C6  C3 o C3/:2
22  34
68
6. E D Q.
p
7/, p D 2Z and L0 D ..7/A#
6/p
7. After applying the variant of the
oriﬂamme construction described in Remark 4.8, the chain becomes:
0
((7)A#
6 )√−7
∼=
0′
0′′
•
•
The automorphism groups are as follows:
T
GT
#GC
T
#T D 1 ˙C7 W 3 3  7
#T D 2
C6
3
f0; 00; 000g
C2
1
5.3
Quaternionic Hermitian Forms
In this section we treat the case that ŒE W K D 4, so E is a totally deﬁnite quaternion
algebra over the totally real number ﬁeld K. All quaternionic hermitian lattices with
class number  2 are classiﬁed in [16, Section 9] and listed explicitly for n  2 in
[16, pp. 147–150].
Proposition 5.4 Suppose E is a deﬁnite quaternion algebra and let L.L0; p/ be a
ﬁne P-admissible chain of length at least 2 and of class number one. Then K D Q,
d WD dimE.V/ D 2 and one of the following holds:
1. E Š Q1;2, the rational quaternion algebra ramiﬁed at 2 and 1, p D 3Z and
L0 Š .E8/1;2 is the unique M-structure of the E8-lattice whose automorphism
group is called 1;2Œ21C4

:Alt52 in [24]. The oriﬂamme construction is not
necessary and the automorphism groups are

528
M. Kirschmer and G. Nebe
T
GT
#GT
sgdb
f0g; f2g
1;2Œ21C4

:Alt52 27  3  5

f1g
Q8 W SL2.3/
26  3
1022
f0; 1g; f1; 2g
C2  SL2.3/
24  3
32
f0; 2g
C3 W SD16
24  3
16
#T D 3
C2  C6
22  3
9
2. E Š Q1;3 and p D 2Z and L0 Š .E8/1;3 is the unique M-structure of the
E8-lattice whose automorphism group is called 1;3ŒSL2.9/2 in [24]. The
oriﬂamme construction is not necessary and the automorphism groups are
T
GT
#GT
sgdb
f0g; f2g 1;3ŒSL2.9/2 24  32  5 409
f1g
SL2.3/:S3
24  32
124
#T D 2
C2:S4
24  3
28
f0; 1; 2g
Q16
24
9
Note that the above quaternion algebras only have one conjugacy class of maximal
orders and for any such order M, the above M-lattice L0 is uniquely determined
up to isometry.
5.4
The Exceptional Groups
The exceptional groups have been dealt with in [16, Chapter 10], where it is shown
that only the group G2 admits one-class genera deﬁned by a coherent family of
parahoric subgroups. In all cases the number ﬁeld is the ﬁeld of rational numbers.
The one-class genera of lattice chains correspond to the coherent families of
parahoric subgroups .Pq/q prime where for one prime p the parahoric subgroup Pp is
the Iwahori subgroup, a stabiliser of a chamber in the corresponding p-adic building.
Hence [16, Theorem 10.3.1] shows directly that there is a unique S-arithmetic group
of type G2 with a discrete and chamber transitive action. It is given by the Z-form
G2 where each parahoric subgroup Pq is hyperspecial. This integral model of G2 is
described in [8] (see also [5] for more one-class genera of G2). Here G2.Z/ Š G2.2/
and the S-arithmetic group is G2.ZŒ 1
2/ (so S D f.2/g). The extended Dynkin
diagram of G2 is as follows.
0
1
2
The stabilisers GT of the simplices T  f0; 1; 2g in the corresponding building of
G2.Q2/ are given in [16, Section 10.3]:

One Class Genera of Lattice Chains Over Number Fields
529
T
GT
#GT
sgdb
{0}
G2.2/
26 	 33 	 7

{2}
23:GL3.2/
26 	 3 	 7
814
{1}
21C4
C :..C3  C3/:2/
26 	 32
8282
{1,2}
21C4
C :S3
26 	 3
1494
{0,2}
..C4  C4/:2/:S3
26 	 3
956
{0,1}
21C4
C :S3
26 	 3
988
{0,1,2}
Syl2.G2.2//
26
134
One may visualise the chamber transitive action of G2.ZŒ 1
2/ on the Bruhat-Tits
building of G2.Q2/ by indicating the three generators x; y; z of G2.ZŒ 1
2/ of order 3
mapping the standard chamber to one of the (three times) two neighbours.
G2(2)
26·33·7
23.L3(2)
26·3·7
26· 32
26
26· 3
26· 3
26· 3
z
x
y
Using a suitable embedding G2 ,! O7 we ﬁnd matrices for the three generators
x WD
0
BBBBBBBBB@
0
1 1111
0
0
0 0
0 0
0 1
0
11
0 01
1
1
1 01 01
0
0
01
0 0
0 1
01 1
0 0
0 0
0
1 0
011
0
1
CCCCCCCCCA
; y WD
0
BBBBBBBBB@
1
1 0111
0
1
111
01
0
1
11 0
01
0
1
01 0
01
0
1
1 01
011
0
1 011 0
0
1
0 0 0
0 0
0
1
CCCCCCCCCA
; z WD 1
2
0
BBBBBBBBB@
2 2
01
021
1 0
2 01 01
2 2
23221
2 2
01221
0 0
422 02
22
0 1
2 01
0 2
01
02
1
1
CCCCCCCCCA
:
6
Chamber Transitive Actions on p-Adic Buildings
In this section we tabulate the chamber transitive actions on the p-adic buildings
obtained from the one-class genera of lattice chains given in the previous section.
We use the names and the local Dynkin diagrams as given in [31]. The name
for Up usually does not give the precise type of the p-adic group. For instance the

530
M. Kirschmer and G. Nebe
Table 1 Buildings with chamber transitive discrete actions
lattices E6 and D6 deﬁne two non isomorphic non-split forms of the algebraic group
O6 over Q2 which we both denote by O
6 .Q2/. To distinguish these groups, we
also give the Tits index as in [30] and [31, Section 4.4]. Note that the isomorphism
O
6 Š U4 is given by the action of O6 on the even part of the Clifford algebra.
So we ﬁnd the one-class genera of lattice chains also in a hermitian geometry, for
L.E6; 2/ (from 5.1 (3)) we get the same stabilisers as for L..E8/p
3; 2/ (from 5.3
(2)) in the projective group. Such coincidences are indicated by listing the lattices
L0 and the corresponding references (ref) in Table 1. The last column of Table 1
refers to a construction of the respective chamber transitive action in the literature.
For a more detailed description of the different unitary groups Up associated to the
various types of local Dynkin diagrams we refer the reader to [31, Section 4.4].
Acknowledgements The research leading to this paper was supported by the DFG in the
framework of the SPP1489. The authors thank Bill Kantor and Rudolf Scharlau for helpful
discussions.

One Class Genera of Lattice Chains Over Number Fields
531
References
1. P. Abramenko, G. Nebe, Lattice chain models for afﬁne buildings of classical type. Math. Ann.
322(3), 537–562 (2002)
2. J.W. Benham, J.S. Hsia, Spinor equivalence of quadratic forms. J. Number Theory 17(3), 337–
342 (1983)
3. H.U. Besche, B. Eick, E.A. O’Brien, The groups of order at most 2000. Electron. Res.
Announc. Am. Math. Soc. 7, 1–4 (2001)
4. A. Borel, Some ﬁniteness properties of Adele groups over number ﬁelds. Publ. Math. I.H.E.S.
16, 5–30 (1963)
5. A.M. Cohen, G. Nebe, W. Plesken, Maximal integral forms of the algebraic group G2 deﬁned
by ﬁnite subgroups. J. Number Theory 72(2), 282–308 (1998)
6. W. Frisch, The Cohomology of S -Arithmetic Spin Groups and Related Bruhat-Tits Buildings
(University of Göttingen, Mathematisch-Naturwissenschaftliche Fakultät, Göttingen, 2002)
7. L. Gerstein, The growth of class numbers of quadratic forms. Am. J. Math. 94(1), 221–236
(1972)
8. B.H. Gross, Groups over Z. Invent. Math. 124(1–3), 263–279 (1996)
9. W.M. Kantor, Some exceptional 2-adic buildings. J. Algebra 92(1), 208–223 (1985)
10. W.M. Kantor, Some locally ﬁnite ﬂag-transitive buildings. Eur. J. Comb. 8(4), 429–436 (1987)
11. W.M. Kantor, R.A. Liebler, J. Tits, On discrete chamber-transitive automorphism groups of
afﬁne buildings. Bull. Am. Math. Soc. (N.S.) 16(1), 129–133 (1987)
12. W.M. Kantor, T. Meixner, M. Wester, Two exceptional 3-adic afﬁne buildings. Geom. Dedicata
33(1), 1–11 (1990)
13. M. Kirschmer, Genera of quadratic and hermitian lattices with small class number (2016).
http://www.math.rwth-aachen.de/homes/Markus.Kirschmer/forms/
14. M. Kirschmer, Finite symplectic matrix groups. Ph.D. thesis, RWTH Aachen University, 2009
15. M. Kirschmer, Finite symplectic matrix groups. Exp. Math. 20(2), 217–228 (2011)
16. M. Kirschmer, Deﬁnite quadratic and hermitian form with small class number. Habilitation,
RWTH Aachen University, 2016
17. M. Kneser, Strong approximation, in Algebraic Groups and Discontinuous Subgroups (Pro-
ceedings of Symposia in Pure Mathematics, Boulder, CO, 1965) (American Mathematical
Society, Providence, 1966), pp. 187–196
18. M. Kneser, Quadratische Formen (Springer, Berlin, 2002). Revised and edited in collaboration
with Rudolf Scharlau
19. P. Köhler, T. Meixner, M. Wester, The 2-adic afﬁne building of type QA2 and its ﬁnite projections.
J. Comb. Theory Ser. A 38(2), 203–209 (1985)
20. D. Lorch, M. Kirschmer, Single-class genera of positive integral lattices. LMS J. Comput.
Math. 16, 172–186 (2013)
21. T. Meixner, Klassische Tits Kammersysteme mit einer transitiven Automorphismengruppe.
Mitt. Math. Sem. Giessen 174, x+115 (1986)
22. T. Meixner, M. Wester, Some locally ﬁnite buildings derived from Kantor’s 2-adic groups.
Commun. Algebra 14(3), 389–410 (1986)
23. D. Mumford, An algebraic surface with K ample, .K2/ D 9, pg D q D 0. Am. J. Math. 101(1),
233–244 (1979)
24. G. Nebe, Finite quaternionic matrix groups. Represent. Theory 2, 106–223 (1998)
25. O.T. O’Meara, Introduction to Quadratic Forms (Springer, Berlin, 1973)
26. R. Scharlau, Unimodular lattices over real quadratic ﬁelds. Math. Z. 216, 437–452 (1994)
27. R. Scharlau, Martin Kneser’s work on quadratic forms and algebraic groups, in Quadratic
Forms—Algebra, Arithmetic, and Geometry. Contemporary Mathematics, vol. 493 (American
Mathematical Society, Providence, 2009), pp. 339–357
28. G. Shimura, Arithmetic of unitary groups. Ann. Math. 79, 269–409 (1964)
29. D.E. Taylor, The Geometry of the Classical Groups. Sigma Series in Pure Mathematics, vol. 9
(Heldermann Verlag, Berlin, 1992)

532
M. Kirschmer and G. Nebe
30. J. Tits, Classiﬁcation of algebraic semisimple groups, in Proceedings of the Summer Institute
in Algebraic Groups and Discontinuous Groups (Boulder 1965). Proceedings of Symposia in
Pure Mathematics, vol. 9 (American Mathematical Society, Providence, 1966), pp. 33–62
31. J. Tits, Reductive groups over local ﬁelds, in Automorphic Forms, Representations and
L-Functions (Proceedings of Symposia in Pure Mathematics), vol. 33 (American Mathematical
Society, Providence, 1979), pp. 29–69
32. G.L. Watson, Transformations of a quadratic form which do not increase the class-number.
Proc. Lond. Math. Soc. (3) 12, 577–587 (1962)

polyDB: A Database for Polytopes
and Related Objects
Andreas Paffenholz
Abstract polyDB is a database for discrete geometric objects independent of a
particular software. The database is accessible via web and an interface from the
software package polymake. It contains various datasets from the area of lattice
polytopes, combinatorial polytopes, matroids and tropical geometry.
In this short note we introduce the structure of the database and explain its use
with a computation of the free sums and certain skew bipyramids among the class
of smooth Fano polytopes in dimension up to 8.
Keywords Database • polyDB • Discrete geometry • Lattice polytopes •
Reﬂexive polytopes • Smooth polytopes
Subject Classiﬁcations 52-04, 52B20
1
Introduction
In recent years availability of computational classiﬁcations of mathematical objects
has proven to be an important and valuable tool to obtain new results, to check new
ideas and to experiment with the objects to obtain insight into their structure and
directions for further research.
We know the full list of smooth Fano polytopes (up to lattice equivalence)
up to dimension 9 by an algorithm of Øbro [33], whose availability within the
software package polymake has been the foundation e.g. for counter-examples
to a conjecture of Batyrev and Selivanova [32] or the classiﬁcation of simplicial,
terminal, and reﬂexive polytopes with many vertices by Assarf et al. [5]. Availability
of the same data in Magma [37] lead to the study of the poset of blowups by
Higashitani [16] or the study of reﬂexive polytopes of higher index by Kasprzyk and
A. Paffenholz ()
TU Darmstadt, Dolivostr. 15, 64293 Darmstadt, Germany
e-mail: paffenholz@opt.tu-darmstadt.de; paffenholz@mathematik.tu-darmstadt.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_23
533

534
A. Paffenholz
Nill [24]. The classiﬁcation of 0=1-polytopes up to dimension 6 by Aichholzer [2]
was used in the study of permutation polytopes by Baumeister et al. [6].
We also know classiﬁcations of small oriented matroids by Miyata et al. [12],
polytropes [21, 39], and reﬂexive polytopes up to dimension 4 by Kreuzer and
Skarke [3, 26]. The symbolic data project by Gräbe et al. [13] aims to collect
data from computer algebra and make it accessible in a structured and searchable
form on their web page. The library MIPLIB by Koch et al. [25] collects discrete
optimization problems for benchmarking of algorithms.
Most of these collections, however, cannot easily be used in a software package.
Sometimes the data is only available in text format or, if searchable via a database,
is connected to a speciﬁc software package or lacks a proper interface at all. For
example, the small oriented matroids [12], polytropes [27, 39], or 0=1-polytopes [2]
are available as text ﬁles, while access to the small groups library [7] is linked to
GAP [36]. Altman et al. [3] have created a database for the reﬂexive polytopes up to
dimension 4 computed by Kreuzer and Skarke [26], but it is currently not accessible
at the link given in the paper.
On the other hand, the Graded Rings Database [8] project has a more general
approach and provides data in a format both searchable via a web interface and
accessible via a programmatic interface that can be used in software packages. It
currently has a focus on data from combinatorial commutative algebra and toric
geometry.
The new database polyDB aims to provide searchable data from a wide range
of areas at a permanent location in an application independent format. It allows
download in text format and access from any software package that provides an
interface to the data. It is also searchable via a web interface at db.polymake.org.
Currently, one interface to a software package is implemented, in the software
package polymake [4, 22]. The current collection of data is thus still inspired
by the range of applications of polymake with data from combinatorial geometry,
matroid theory, toric geometry and combinatorial topology.
In the following two sections we explain the concept of the database and
introduce the interface implemented in polymake to access the data. The last
section shows one application of the database and the interface. We will show that in
dimensions up to 8 more than 80% of the smooth Fano polytopes arise from lower
dimensional ones as a free sum of two lower dimensional smooth Fano polytopes
or a certain skew sum construction of a smooth Fano polytope and a simplex. We
give the count of polytopes decomposable in this way in Table 1. With a simple
extension of the scripts one can also obtain the list of possible decompositions for
each polytope.

polyDB: A Database for Polytopes and Related Objects
535
Table 1 Free sums, skew bipyramids and generalized smooth simplex sums among the smooth
Fano polytopes
Dimension
2
3
4
5
6
7
8
Smooth Fano polytopes
5
18
124
866
7622
72,256
749,892
Free sums
1
5
28
176
1361
11,760
112,285
Skew bipyramids
1
9
57
489
4323
43,777
466,770
sg simplex-1 sums
2
13
66
556
4700
47,076
495,092
sg simplex-2 sums
1
3
31
232
2403
25,157
284,249
sg simplex-3 sums
–
1
4
52
515
6635
83,730
sg simplex-4 sums
–
–
1
5
81
961
14,598
sg simplex-5 sums
–
–
–
1
6
114
1609
sg simplex-6 sums
–
–
–
–
1
7
155
sg simplex-7 sums
–
–
–
–
–
1
8
sg simplex-8 sums
–
–
–
–
–
–
1
Total sg simplex sums
3
16
93
708
6283
61,961
657,380
Total decomposable
3
16
96
712
6346
62,331
660,792
The rows denoted by sg simplex-n sums for n between 1 and 8 count the simplex sums with a
simplex of dimension n. The row denoted by total sg simplex sums gives the number of different
generalized smooth simplex sums with a simplex of any dimension. The row total decomposable
counts the number of different polytopes among the free sums and the smooth generalized simplex
sums
2
polyDB
In this section we brieﬂy introduce the structure of the database polyDB and the
data sets already contained in it.
The database polyDB for discrete geometric objects is based on the open
source NoSQL database MongoDB [31]. It has been set up at db.polymake.org.
The database stores its data as plain JSON documents grouped into collections
and databases (To avoid confusion with this and the abstract database polyDB
we will refer to this technical term introduced by MongoDB as a collection group).
We use this to group collections from the same area of discrete geometry into a
common collection group. E.g., the collection group Objects in Tropical Geometry
currently contains two collections of such objects, the small tropical oriented
matroids classiﬁed by Horn [17] and the polytropes classiﬁed by Kulas [27] and
Tran [39]. polyDB stores data in a plain JSON format independent of any particular
software package. See Fig. 1 for an example of an entry in the collection of smooth
reﬂexive polytopes.
Each document contains one special entry polyDB (besides its _id, which is
required by MongoDB). Apart form this all other entries and their tags can be chosen
freely depending on the data. The entry polyDB may specify format restrictions for
the data and import or export speciﬁcations for various software packages, separated
by subﬁelds naming the software. This section may contain, e.g., information on
the required version, authors of the data, and the method to load the data into the

536
A. Paffenholz
{
"_id" : "F.2D.3",
"DIM":2,
"FACETS" : [[1,0,1],[1,0,-1],[1,1,0],[1,-1,-1],[1,-1,0]],
"VERTICES":[[1,-1,-1],[1,-1,1],[1,0,1],[1,1,0],[1,1,-1]],
"F_VECTOR" : [5,5],
"EHRHART_POLYNOMIAL_COEFF":["1","7/2","7/2"],
"H_STAR_VECTOR":[1,5,1],
"CENTROID":["1","-2/21","-2/21"],
"N_LATTICE_POINTS":8,
"NORMAL" : "true",
"VERY_AMPLE" : "true",
"LATTICE_VOLUME":7,
"polyDB" : {
[...]
}
}
Fig. 1 An entry in the collection of smooth Fano polytopes. Naming of the ﬁelds is in this example
taken from standard properties of objects in polymake. However, there are no restrictions on ﬁeld
names
particular software package. Each collection group also has a separate collection
type_information that speciﬁes the format of an entry in a collection and allows
to store information applicable to all data sets in this collection, e.g., methods
for import and export of the data. The web interface at db.polymake.org allows
independent and searchable access to all data sets in polyDB.
There are currently ﬁve collections, grouped into four collection groups con-
tained in polyDB. We give a brief introduction to each of the collections.
•
The collection group Lattice Polytopes has the collection Smooth Reﬂexive
Polytopes that contains low dimensional smooth reﬂexive polytopes based on
the algorithm of Øbro [33]. Øbro used his algorithm to compute the data up to
dimension 8. Later, dimension 9 was computed with an improved implementation
of the algorithm by Lorenz and the author. There are 9;060;505 such polytopes.
•
The collection group Objects in Tropical Geometry has two collections. The
collection Tropical Oriented Matroids contains a list of 71 known non-realizable
tropical oriented matroids. This data was provided by Horn [17]. The col-
lection Full-dimensional Polytropes in TP3 contains all 1013 polytropes in
3-dimensional tropical projective space. The collection was generated by Con-
stantin Fischer from data of Joswig and Kulas [21] and Tran [39]. See [20] for a
description.
•
The collection group Special Polytopes has the collection Faces of Birkhoff
Polytopes which contains all 5371 combinatorial types of faces up to dimension
8 of the Birkhoff polytope in any dimension [34].

polyDB: A Database for Polytopes and Related Objects
537
•
The collection group Matroids has the collection Matroids on at most 12
elements. This collection contains all 32;401;446 small matroids as computed
by Miyata et al. [11, 12, 30].
Further collections are in preparation.
3
The polymake Interface to polyDB
The initiative for polyDB was started in 2013 by Silke Horn and the author as an
extension for the software package polymake [19] with associated database. With
the latest version 3.1 of polymake [38], released in March 2017, the interface to
the database has been turned into a bundled extension for polymake that is directly
delivered with the software and the database has been set up as an independent
project.
However, the software package polymake currently provides the only interface
for import of data into the database and methods to access and use it for com-
putations. Given a search query, i.e. a list of restrictions on the properties of an
object, MongoDB allows the retrieval of a single object satisfying the query, an
array with all objects satisfying the query or a cursor that returns objects from the
result set one after another. All three methods are also implemented in polymake.
The implementation is based on the perl MongoDB driver [1]. With
polytope > db_info();
DATABASE: LatticePolytopes
This database contains various classes of lattice polytopes.
Collection: SmoothReflexive
A complete collection of smooth reflexive lattice polytopes
in dimensions up to 9, up to lattice equivalence. [...]
we can query which collection groups are available. The collection group and
collection we want to use for our search are then speciﬁed with the keywords db and
collection in any access function. The query itself is given as a perl hash. The
query is not processed by polymake but directly handed over to MongoDB, so it
allows all queries speciﬁed in the MongoDB query language. A speciﬁcation of the
full query language and its use from within perl can be found in the documentation
of MongoDB [31] and the perl driver for it [1].
Here is an example returning an array of results.
polytope > $parray=db_query({"DIM"=>3, "N_FACETS"=>5},
polytope(2) > db=>"LatticePolytopes",
polytope(3) > collection=>"SmoothReflexive");
polytope > print $parray->size;
4
This shows that there are four polytopes in the collection SmoothReﬂexive that have
dimension 3 and 5 facets. Using a loop over this array or a database cursor we can

538
A. Paffenholz
check properties of each object returned. For example
polytope > $cursor=db_cursor({"DIM"=>3, "N_FACETS"=>5},
polytope(2) > db=>"LatticePolytopes",
polytope(3) > collection=>"SmoothReflexive");
polytope > while ( !$cursor->at_end() ) {
polytope(2) > $p=$cursor->next();
polytope(3) > print $p->N_LATTICE_POINTS, " ";
polytope(4) > }
34 30 31 30
deﬁnes a cursor over the collection SmoothReﬂexive successively returning all
polytopes that satisfy the restrictions given in the query, i.e., that have ﬁve facets
in dimension 3. Here it tells us that among the four polytopes found above, two
have 30, one has 31 and one has 34 lattice points.
4
Decomposing Smooth Fano Polytopes
We illustrate the use of polyDB and its interface to polymake with a computation
that uses the collection SmoothReﬂexive in the collection group LatticePolytopes to
compute decompositions of smooth Fano polytopes in dimensions 1 to 8. With our
computations we start a new statistics that counts how many of the smooth Fano
polytopes can be generated from lower dimensional smooth Fano polytopes with
some simple known polytope construction method that preserves both smoothness
and reﬂexiveness of the polytope. We consider three methods in this paper and
determine how many of the smooth Fano polytopes in these dimensions are
•
free sums of two smooth Fano polytopes
•
a smooth skew bipyramid over a smooth Fano polytope as deﬁned in [5], or
•
a generalized simplex sum of a smooth Fano polytope with a smooth simplex.
This new construction method will be deﬁned below.
All smooth skew bipyramids and many of the free sums are also generalized smooth
simplex sums. We will also provide the total number of smooth Fano polytopes that
can be decomposed with at least one of these constructions. The results are collected
in Table 1.
We brieﬂy explain the relevant notions. More background can, e.g., be found in
the book of Ewald [10]. Let P  Rd be a polytope with vertices v1; : : : ; vr 2 Rd,
i.e.,
P WD conv.v1; : : : ; vr/
(1)
is the convex hull of these points and none of the vi can be omitted in the deﬁnition.
We assume that P is full dimensional, i.e., the afﬁne hull of P is Rd (otherwise we
can pass to a subspace). A polytope can equally be given as the intersection of a

polyDB: A Database for Polytopes and Related Objects
539
ﬁnite number of half-spaces in the form
P D f x j Ax  b g
(2)
for some A 2 Rsd and b 2 Rs. We can again assume that no inequality is redundant
in this deﬁnition. In this case the rows of A are the facet normals of P. A facet F of
P is the set of all x 2 P that satisfy one of the inequalities in (2) with equality. A face
of P is the common intersection in P of a subset of the facets (this may be empty).
The vertices, which are the faces of dimension 0, are in the common intersection of
at least d facets.
If 0 is strictly contained in the interior of P, then the polar or dual polytope is
deﬁned as
P_ WD f v j hv; xi  1 for all x 2 P g :
In fact, a ﬁnite subset of the inequalities in this deﬁnition sufﬁce to deﬁne P_ (those
corresponding to the vertices of P), so that P_ is again a polytope. Further, we have
.P_/_ D P.
A lattice  is the integral span of a linearly independent set of vectors in Rn.
Up to a linear transformation we can assume that  is the integer lattice Zd 	 Rn,
and by passing to a subspace we can assume that n D d. With these assumptions a
polytope P is a lattice polytope if all its vertices are in Zd.
In this case we can assume that both A and b are integral in (2), and that the
greatest common divisor of the entries of each row of A (i.e., of the entries of each
facet normal) is 1. A lattice polytope P is reﬂexive if P_ is again a lattice polytope.
In this case b D 1 in (2), and for both P and P_ the origin is the unique interior
lattice point. P is smooth if the vertices of any facet of P are a lattice basis of Zd. In
this case 0 is a strictly interior point of P and each facet has exactly d vertices, so
P is simplicial. Moreover, the polar polytope is again a lattice polytope (in the dual
lattice) whose vertices are the facet normals (the rows of A), so P is also reﬂexive.
Note that in the literature sometimes the polytopes polar to the ones deﬁned here are
called smooth.
It follows from a result of Hensley [15] and Lagarias and Ziegler [28] that
there are only ﬁnitely many smooth reﬂexive polytopes in each dimension up to
lattice equivalence (afﬁne transformations preserving Zd), as reﬂexive polytopes
have exactly one interior lattice point. See Fig. 2 for the list of such polytopes
in dimension 2. The complete list is contained in polyDB for d  9 in the
collection SmoothReﬂexive of the database LatticePolytopes. Note however, that
in the database we follow the above mentioned alternative deﬁnition and list the
duals of the ones deﬁned here. Yet, for the purpose of the following constructions
it is easier to work with the deﬁnition given above, so we will use that one in the
following. This requires that in the scripts we use for our computations below we
polarize the polytopes obtained from the database. Sometimes this is, however, only
done implicitly. This is saves computation time, as it follows from the design of
polymake that for reﬂexive polytopes the facets of the polytope are the vertices

540
A. Paffenholz
(a)
(b)
(c)
(d)
(e)
Fig. 2 The ﬁve 2-dimensional smooth Fano polytopes. (a) P6. (b) P5. (c) P4a. (d) P4b. (e) P3
of its dual. Also, as we will see below, most constructions can also be given for the
duals of the polytopes.
We introduce several methods to construct a smooth Fano polytope from smaller
ones. The most well known construction is the free sum of two polytopes P  Ra
and Q  Rb that both contain the origin in their interior. This is the polytope
P ˚ Q WD conv
˚
.v; 0/ 2 RaCb j v 2 P
	
[
˚
.0; w/ 2 RaCb j w 2 Q
	
:
We can also deﬁne this on the dual side. The product of polytopes P and Q is the
polytope
P  Q WD f .x; y/ j x 2 P; y 2 Q g :
Then, if P and Q contain the origin in their interior,
P ˚ Q D .P_  Q_/_ :
(3)
We will use this dual deﬁnition for the detection of free sums among the smooth
Fano polytopes. See Fig. 3a for an example.
A bipyramid over a polytope P is the free sum of P with a segment S containing
the origin in the interior. More generally, we say that Q is a skew bipyramid over P
if Q has the same combinatorial type (the same face lattice) as a bipyramid over P.
The two vertices coming from vertices of S are the two apices of Q.
If P is a smooth d-dimensional Fano polytope then we call the free sum with
the segment Œ1; 1 the smooth bipyramid over P. Let v be a vertex of P and Nv its
embedding into RdC1 by adding a 0 at the end. Then the smooth skew bipyramid for
vertex v as deﬁned by Assarf et al. [5] is the polytope
SBipyr.P; v/ WD conv . P  f0g [ fedC1; Nv C edC1g/ :
Figure 3b shows an example of this deﬁnition. More generally, we say that Q is a
smooth generalized skew bipyramid over P if Q is a skew bipyramid over P such
that the two apices have lattice distance 1 from P. This class contains all smooth
bipyramids and smooth skew bipyramids. The following proposition is an extension
of Lemmas 1, 2 and 3 of [5]. The proof easily carries over into this more general
setting.

polyDB: A Database for Polytopes and Related Objects
541
e3
e1
−e1
e2
(a)
e3
e3
−e1
e1+e3
e2
(b)
e1
e2+e3
−e2
−e3
(c)
e1
−e2
e1+e2+e3
−e3
(d)
Fig. 3 Polytope constructions. (a) The free sum of a hexagon and a segment. This is at the same
time also a proper bipyramid over the hexagon. (b) A skew bipyramid of a hexagon. The top apex
has been shifted to e1 Ce3. (c) A generalized simplex sum of a segment and a triangle. (d) Another
generalized simplex sum of a segment with a triangle
Proposition 4.1 Let P and Q be smooth Fano polytopes. Then the free sum P ˚ Q,
the smooth bipyramid and any smooth (generalized) skew bipyramid over P are
again smooth Fano polytopes.
ut
We further generalize this construction. Let P  Ra be a smooth Fano polytope
and Q  Rb a smooth Fano simplex (this is unique up to lattice equivalence). Let
v be a vertex of Q. Then R WD P ˚ Q is a smooth Fano polytope and also any
polytope R0 obtained from R by replacing v with a lattice point v0 in the hyperplane
Ra C v  RaCb, as long as R and R0 have the same combinatorial type. This is
again a simple extension of the proposition above. We call those polytopes smooth
generalized simplex sums. Figure 3c, d shows two examples. Observe that any
smooth (generalized skew) bipyramid is a simplex sum.
We can use polymake and polyDB to detect all free sums and smooth
generalized simplex sums among the smooth Fano polytopes. Clearly, these two
constructions overlap in various ways. Any proper bipyramid over all polytope P
is also the free sum of a P with a segment, and polytopes may have more than
one possible decomposition into a free sum. Many of the various possibilities to
place the vertex v0 for a generalized smooth simplex sum are lattice equivalent. Our

542
A. Paffenholz
approach to detect all different instances is as follows: For a ﬁxed dimension d we
consider all possible splits of d as a sum of dimensions a and b and compute all free
sums of smooth Fano polytopes in these two dimensions and all simplex sums of an
a-dimensional smooth Fano polytope with a b-dimensional simplex. For each such
polytope we run through the list of d-dimensional smooth Fano polytopes, check
for lattice equivalence and store the name of the polytope we have found. We could
also store the way we obtained it alongside, so that in the end we have a list of all
possible splits for a given d-dimensional smooth Fano polytope.
We did the computation up to dimension 8. The results are given in Table 1.
The free sums can be obtained with the small scripts given in Fig. 4. The ﬁrst
script identify_smooth_polytope takes a smooth Fano polytope, iden-
tiﬁes it in the database and returns its name. The identiﬁcation is based on
the polymake function lattice_isomorphic_smooth_polytopes, that
reduces the check whether two lattice polytopes are lattice isomorphic to a colored
graph isomorphism problem (which is solved using bliss [23] or nauty [29]).
Note that there is also the extension LatticeNormalization [18] to polymake that
computes the lattice normal form of a lattice polytope (see [14] for a deﬁnition), but
the reduction to colored graph isomorphism is more efﬁcient for smooth polytopes.
The simpler problem of checking combinatorial isomorphisms (i.e., graph isomor-
phism) can also be done with the polymake-function canonical_hash (also
based on bliss or nauty). The second function all_free_sums_in_dim
computes all possible free sums that lead to a d-dimensional smooth Fano polytope.
As the database contains the polytopes dual to the ones we consider we use (3) and
compute products instead of sums to avoid explicit dualization. For each product
the function calls identify_smooth_polytope to identify it in the database.
The function returns a list of all names (_ids) found in this way. If splitinfo is
set to 1 it also returns all pairs of summands.
For the computation of the smooth generalized simplex sums we used the
function all_skew_simplex_sums_in_dim available at [35]. For each com-
bination of an a-dimensional smooth Fano polytope and a b-dimensional simplex
with d D a C b we compute all possible lattice points for the shifted vertex v0,
construct the polytope and again use identify_smooth_polytope to identify
it in the database. Computation of all possible v0 requires the computation of all
lattice points in the hyperplane Ra C v  RaCb that lead to a lattice polytope
with the same combinatorial type as the proper free sum. This can be reduced to
enumerating lattice points in the interior of a polytope, which is done in polymake
via the interface to Normaliz [9]. As above the function returns a list of ids, and
also all possible decompositions into a simplex sum if splitinfo is set to 1. You
can save the scripts to a ﬁle in the current folder and load this into polymake via
polytope> script(<filename>);

polyDB: A Database for Polytopes and Related Objects
543
use application "polytope";
sub identify_smooth_fano_in_polydb {
my $p = shift;
my $d = $p->DIM;
my $nlp = new Int($p->N_LATTICE_POINTS);
my $parray=db_query({"DIM"=>$d, "N_VERTICES"=>$p->N_VERTICES, "
N_FACETS"=>$p->N_FACETS,
"N_LATTICE_POINTS"=>$nlp, }, db=>"LatticePolytopes",
collection=>"SmoothReflexive");
foreach my $c ( @$parray ) {
if ( lattice_isomorphic_smooth_polytopes($c,$p) ) { return $c
->name; }
}
die "polytope not found\n";
}
sub all_free_sums_in_dim {
my ($d,%options) = @_;
my $list;
if ( $options{"splitinfo"} ) {
$list = new Map<String,Set<Pair<String,String> > >;
} else {
$list = new Set<String>;
}
my $cur_options = { db=>"LatticePolytopes", collection=>"
SmoothReflexive" };
foreach my $n (1..$d/2) {
my $cur1=db_cursor({"DIM"=>$n}, $cur_options);
while ( !$cur1->at_end() ) {
my $c1 = $cur1->next();
my $cur2=db_cursor({"DIM"=>$d-$n}, $cur_options );
while ( !$cur2->at_end() ) {
my $c2 = $cur2->next();
my $name = identify_smooth_fano_in_polydb(product($c1,$c2))
;
if ( $options{"splitinfo"} ) {
my $split = new Pair<String,String>($c1->name,$c2->name);
$list->{$name} += $split;
} else {
$list += $name;
} } } }
return $list;
}
Fig. 4 A function to detect all free sums among the smooth Fano polytopes. This is a shortened
version of the script given at [35]

544
A. Paffenholz
Then the classiﬁcation, e.g. in dimension 4, is obtained with
polytope > $fs = all_free_sums_in_dim(4);
polytope > print $fs->size;
28
polytope > $sb = all_skew_bipyramids_in_dim(4);
polytope > print $fs->size;
57
polytope > $s = new Set<String>;
polytope > foreach (1..4) {
polytope(2) > $st = skew_simplex_sums_in_dim(4,$_);
polytope(3) > print $st->size, " ";
polytope(4) > $s += $st;
polytope(5) > }
66 31 4 1
polytope > print $s->size;
93
polytope > print (($fs+$s)->size);
96
The scripts containing the functions all_skew_bipyramids_in_dim for
skew bipyramids and skew_simplex_sums_in_dim for generalized smooth
simplex sums are available from [35] and allow to store the possible decompositions.
Note that the computation time for the decompositions grows quickly in the
dimension. While dimension 4 runs in a few minutes on an Intel Xeon E5-4650,
computations in dimension 8 took over a month.
From these computations we can, e.g., see that we have three different decom-
positions of the dual of the 5-dimensional polytope with index F.5.0116. Its
vertices are the rows of the matrix in Table 2a. We can decompose this into three
different simplex sums. One is over dual of the 3-dimensional polytope P3 with
index F.3D.0112. This is shown in Table 2b, where the shaded part corresponds
to the vertices of P3. The shifted vertex of the triangle is Œ0; 0; 2; 1; 1. Note that the
vertices are given as obtained by dualization from the database. Hence, the equality
Table 2 Simplex sums leading to the dual of F.5D.0116
0
0
0
0
1
0
0
1
0 −1
0
0 −1
0
0
0
0
0 −1
0
0
0
0
0 −1
−1
0
0
0
0
0 −1
0
0
0
0
1
0
0
1
1
0
0
1
2
(a) Dual of
F.5D.0116
0
1
1
0
0
−1
0
0
0
0
0
0
1
0
0
0 −1
0
0
0
0
0 −1
0
0
1
0 −1
0
0
0
0
0 −1
0
0
0
0
0 −1
0
0 −2
1
1
(b) Dual of
F.3D.0112
extended with skew
triangle
−1
0
0
0
0
0
0
0 −1
0
0
1
0
1
0
0 −1
0
0
0
0
0
0
1
0
0
0 −1
0
0
1
0
1
2
0
0
0
0
0 −1
0
0
0 −1
1
(c) Dual of
F.4D.0008
extended with
segment
−1
0
0
0
0
0
0
0 −1
0
0
1
0 −1
0
0 −1
0
0
0
0
0
0
1
0
0
0 −1
0
0
1
0
1
2
0
0
0
0
0 −1
0
0
0
1
1
(d) Dual of
F.4D.0019
extended with
segment

polyDB: A Database for Polytopes and Related Objects
545
is not directly visible from the vertices, as the two polytopes differ by a lattice
isomorphism. We can check this with polymake.
polytope > $p3_ext = new Polytope(VERTICES=>
polytope(2) > [[1,0,1,1,0,0],[1,-1,0,0,0,0],[1,0,0,1,0,0],
polytope(3) > [1,0,-1,0,0,0],[1,0,0,-1,0,0],[1,1,0,-1,0,0],
polytope(4) > [1,0,0,0,-1,0],[1,0,0,0,0,-1],
polytope(5) > [1,0,0,-2,1,1]]);
polytope > $p5 = new Polytope(VERTICES=>
polytope(2) > [[1,0,0,0,0,1],[1,0,0,1,0,-1],[1,0,0,-1,0,0],
polytope(3) > [1,0,0,0,-1,0],[1,0,0,0,0,-1],[1,-1,0,0,0,0],
polytope(4) > [1,0,-1,0,0,0],[1,0,1,0,0,1],[1,1,0,0,1,2]]);
polytope > print lattice_isomorphic_smooth_polytope(
polytope(2) > polarize($p3_ext),polarize($p5));
1
Here, the variable $p3_ext contains the polytope P3 and $p5 is P5. As above
we need to dualize for the isomorphism check. The check returns 1, which is the
true-value for polymake.
The other two decompositions are over the 4-dimensional polytopes P1
4 and
P2
4 with index F.4D.0008 and F.4D.0019. Those are shown in Table 2c
and d. Again, the vertices of P1
4 and P2
4 are shaded. The shifted vertices of the
1-dimensional simplex are in the last line.
With this simple computation we have seen that over 80% of the smooth Fano
polytopes can be obtained from at least one of the constructions considered here.
Hence, for a structural description of all smooth Fano polytopes it sufﬁces to look
at the remaining less than 20%.
References
1. A perl driver for MongoDB (2016). Available at search.cpan.org/perldoc?MongoDB
2. O.
Aichholzer,
Extremal
properties
of
0=1-polytopes
of
dimension
5,
in
Polytopes—Combinatorics
and
Computation
(Oberwolfach,
1997),
vol.
29,
ed.
by
G.
Kalai,
G.M.
Ziegler,
DMV
Seminar
(Birkhäuser,
Basel,
2000),
pp.
111–130,
http://www.ist.tugraz.at/staff/aichholzer/research/rp/rcs/
info01poly/www.ist.tugraz.at/staff/aichholzer/research/rp/rcs/info01poly
3. R. Altman, J. Gray, Y.H. He, V. Jejjala, B.D. Nelson, A Calabi-Yau database: threefolds
constructed from the Kreuzer-Skarke list. J. High Energy Phys. (2) 158, front matter+48 (2015)
4. B. Assarf, E. Gawrilow, K. Herr, M. Joswig, B. Lorenz, A. Paffenholz, T. Rehn, Polymake
in linear and integer programming. Math. Program. Comput. (2014, to appear). Available at
arxiv:1408.4653
5. B. Assarf, M. Joswig, A. Paffenholz, Smooth Fano polytopes with many vertices. Discrete
Comput. Geom. 52, 153–194 (2014)
6. B. Baumeister, C. Haase, B. Nill, A. Paffenholz, On permutation polytopes. Adv. Math. 222(2),
431–452 (2009)
7. H.U. Besche,
B. Eick, E. O’Brien,
Small groups
library
(2002).
Available
at
www.icm.tu-bs.de/ag_algebra/software/small/
8. G. Brown, A. Kasprzyk, The graded rings database. Available at www.grdb.co.uk

546
A. Paffenholz
9. W. Bruns, B. Ichim, T. Römer, R. Sieg, C. Söger, Normaliz. Algorithms for ratio-
nal
cones
and
afﬁne
monoids.
J.
Algebra
324,
1098–1113
(2010).
Available
at
www.normaliz.uni-osnabrueck.de
10. G. Ewald, Combinatorial Convexity and Algebraic Geometry. Graduate Texts in Mathematics,
vol. 168 (Springer, New York, 1996)
11. L. Finschi, K. Fukuda, Combinatorial generation of small point conﬁgurations and hyperplane
arrangements, in Discrete and Computational Geometry. Algorithms and Combinatorics,
vol. 25 (Springer, Berlin, 2003), pp. 425–440
12. K. Fukuda, H. Miyata, S. Moriyama, Complete enumeration of small realizable oriented
matroids. Discrete Comput. Geom. 49(2), 359–381 (2013)
13. H.G. Gräbe, Semantic-aware ﬁngerprints of symbolic research data, in Mathematical Software
ICMS 2016, vol. 9725, ed. by G.M. Greuel, T. Koch, P. Paule, A. Sommese. Theoretical
Computer Science and General Issues (Springer, Cham, 2016)
14. R. Grinis, A. Kasprzyk, Normal forms of convex lattice polytopes (2013). Available at
arxiv:1301.6641
15. D. Hensley, Lattice vertex polytopes with interior lattice points. Pac. J. Math. 105(1), 183–191
(1983)
16. A. Higashitani, Equivalence classes for smooth Fano polytopes (2015). Available at
arxiv:1503.06434
17. S. Horn, Tropical oriented matroids and cubical complexes. Ph.D. thesis, 2012
18. S. Horn, A. Paffenholz, Lattice normalization: a polymake extension for lattice isomorphism
checks (2014). Available at github.com/apaffenholz/lattice_normalization
19. S. Horn, A. Paffenholz, polyDB: a database extension for polymake (2014). Available at
github.com/solros/poly_db
20. M. Joswig, Polytropes in the tropical projective 3-torus (2016). Available at home-
pages.math.tu-berlin.de/ joswig/polymake/data/
21. M. Joswig, K. Kulas, Tropical and ordinary convexity combined. Adv. Geom. 10(2), 333–352
(2010)
22. M. Joswig, B. Müller, A. Paffenholz, polymake and lattice polytopes, in 21st International
Conference on Formal Power Series and Algebraic Combinatorics (FPSAC 2009), ed. by
C. Krattenthaler, V. Strehl, M.N. Kauers. Discrete Mathematics and Theoretical Computer
Science Proceedings, AK (Association of Discrete Mathematics and Theoretical Computer
Science, Nancy, 2009), pp. 491–502
23. T. Junttila, P. Kaski, bliss: a tool for computing automorphism groups and canonical
labelings of graphs (2011). Available at www.tcs.hut.ﬁ/Software/bliss/
24. A.M. Kasprzyk, B. Nill, Reﬂexive polytopes of higher index and the number 12 (2011).
Available at arxiv:1107.4945
25. T. Koch, T. Achterberg, E. Andersen, O. Bastert, T. Berthold, R.E. Bixby, E. Danna, G.
Gamrath, A.M. Gleixner, S. Heinz, A. Lodi, H. Mittelmann, T. Ralphs, D. Salvagnin, D.E.
Steffy, K. Wolter, MIPLIB 2010. Math. Program. Comput. 3(2), 103–163 (2011). Available at
mpc.zib.de/index.php/MPC/article/view/56/28
26. M. Kreuzer, H. Skarke, Calabi-yau data (1997). Available at hep.itp.tuwien.ac.at/ kreuzer/CY/
27. K. Kulas, Coarse types of tropical matroid polytopes (2010). Available at arxiv:1012.3053
28. J.C. Lagarias, G.M. Ziegler, Bounds for lattice polytopes containing a ﬁxed number of interior
points in a sublattice. Can. J. Math. 43(5), 1022–1035 (1991). https://doi.org/10.4153/CJM-
1991-058-4
29. B. McKay, nauty 2.5 (2013). Available at cs.anu.edu.au/ bdm/nauty/
30. H. Miyata, S. Moriyama, K. Fukuda, Classiﬁcation of oriented matroids (2013). Available at
www-imai.is.s.u-tokyo.ac.jp/ hmiyata/oriented_matroids/
31. Mongodb v3.2 (2016). Available at www.mongodb.com
32. B. Nill, A. Paffenholz, Examples of Kähler-Einstein toric Fano manifolds associated to non-
symmetric reﬂexive polytopes. Beitr. Algebra Geom. 52(2), 297–304 (2011). https://doi.org/
10.1007/s13366-011-0041-y

polyDB: A Database for Polytopes and Related Objects
547
33. M. Øbro, Classiﬁcation of Smooth Fano Polytopes. Ph.D. thesis, University of Aarhus, 2007.
Available at pure.au.dk/portal/ﬁles/41742384/imf_phd_2008_moe.pdf
34. A. Paffenholz, Faces of Birkhoff polytopes. Electron. J. Combin. 22(1), Paper 1.67, 36 (2015)
35. A. Paffenholz, polymake_smooth_fano: scripts for decompositions of Fano polytopes (2016).
Available at github.com/apaffenholz/polymake_smooth_fano
36. The GAP Group, GAP – Groups, Algorithms, and Programming, Version 4.4.12. The
GAP Group (2008). Available at www.gap-system.org
37. The
Magma
Group,
Magma
computational
algebra
system
(2017).
Available
at
magma.maths.usyd.edu.au/magma/
38. The
polymake-Team,
polymake
release
3.1
(2017).
Available
at
github.com/polymake/polymake
39. N.M. Tran, Polytropes and tropical eigenspaces: cones of linearity. Discrete Comput. Geom.
51(3), 539–558 (2014)

Construction of Neron Desingularization
for Two Dimensional Rings
Gerhard Pﬁster and Dorin Popescu
Abstract Let u W A ! A0 be a regular morphism of Noetherian rings and B an
A-algebra of ﬁnite type. Then any A-morphism v W B ! A0 factors through a
smooth A-algebra C, that is v is a composite A-morphism B ! C ! A0. This
theorem called General Neron Desingularization was ﬁrst proved by the second
author (Popescu, Nagoya Math J 100:97–126, 1985). Later different proofs were
given by André (Cinq exposés sur la désingularisation. Handwritten manuscript
Ecole Polytechnique Fédérale de Lausanne, 1991), Swan (Neron-Popescu desin-
gularization. In: Kang (ed) Algebra and geometry. International Press, Cambridge,
pp 135–192, 1998) and Spivakovsky (J Am Math Soc 294:381–444, 1999). All the
proofs are not constructive. In Pﬁster and Popescu (J Symb Comput 80:570–580,
2017) the authors gave a constructive proof together with an algorithm to compute
the Neron Desingularization for 1-dimensional local rings. In this paper we go one
step further. We give an algorithmic proof of the General Neron Desingularization
theorem for 2-dimensional local rings and morphisms with small singular locus. The
main idea of the proof is to reduce the problem to the one-dimensional case. Based
on this proof we give an algorithm to compute the desingularization.
Keywords Smooth morphisms • Regular morphisms • Neron desingularization
2010
Mathematics
Subject
Classiﬁcation
Primary
13B40;
Secondary
14B25,13H05
G. Pﬁster ()
Fachbereich Mathematik, Universität Kaiserslautern, Postfach 3049, 67653 Kaiserslautern,
Germany
e-mail: pﬁster@mathematik.uni-kl.de
D. Popescu
Simion Stoilow Institute of Mathematics of the Romanian Academy, Research Unit 5,
University of Bucharest, P.O. Box 1-764, Bucharest 014700, Romania
e-mail: dorin.popescu@imar.ro
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_24
549

550
G. Pﬁster and D. Popescu
1
Introduction
The General Neron Desingularization Theorem, ﬁrst proved by the second author
has many important applications. One application is the generalization of Artin’s
famous approximation theorem [2, 8, 9].
Let us recall some deﬁnitions. A ring morphism u W A ! A0 has regular ﬁbers if
for all prime ideals P 2 Spec A the ring A0=PA0 is a regular ring, i.e. its localizations
are regular local rings. It has geometrically regular ﬁbers if for all prime ideals P 2
Spec A and all ﬁnite ﬁeld extensions K of the fraction ﬁeld of A=P the ring K ˝A=P
A0=PA0 is regular. If for all P 2 Spec A the fraction ﬁeld of A=P has characteristic
0 then the regular ﬁbers of u are geometrically regular ﬁbers. A ﬂat morphism u is
regular if its ﬁbers are geometrically regular. If u is regular of ﬁnite type then u is
called smooth. A localization of a smooth algebra is called essentially smooth.
Theorem 1.1 (General Neron Desingularization, André [1], Neron [5], Popescu
[7–9], Swan [12], Spivakovsky [11]) Let u W A ! A0 be a regular morphism
of Noetherian rings and B an A-algebra of ﬁnite type. Then any A-morphism v W
B ! A0 factors through a smooth A-algebra C, that is v is a composite A-morphism
B ! C ! A0.
The proof of this theorem is not constructive. Constructive proofs for one-
dimensional rings were given in Popescu and Popescu [10] and Pﬁster and Popescu
[6]. In this paper we will treat the 2-dimensional case. The idea is to reduce the
problem to the one-dimensional case. We will choose a suitable element a 2 A
and consider NA D A=aA, NB D NA ˝A B, NA0 D A0=aA0, Nv D NA ˝A v W NB ! NA0
to ﬁnd a desingularization NB ! ND ! NA0 induced by a smooth A-algebra D. This
desingularization can then be lifted to a desingularization B ! C ! A0.
For the computational part we have the following assumptions: Let k be a ﬁeld,
x D .x1; : : : ; xn/ and J 	 kŒx be an ideal. We assume
A D .kŒx=J/<x> is Cohen-Macaulay of dimension 2, A0 is its completion
and u the inclusion. The images of the morphism v W B ! A0 need not to be in A,
i.e. the input for the algorithm can only be an approximation of v by polynomials up
to a given bound. The bound to obtain a desingularization of v depends also on the
ring B and is usually not known in advance. If the given bound is not good enough
the algorithm will fail. In this case the bound has to be enlarged and the algorithm
has to be restarted with new approximations of v.
The case that the image of v is already in A is trivial because in this case we can
use the smooth A-algebra C D A as desingularization.
2
Constructive General Neron Desingularization
Let u W A ! A0 be a ﬂat morphism of Noetherian local rings of dimension 2.
Suppose that the maximal ideal m of A generates the maximal ideal of A0 and the

Neron Desingularization for Two Dimensional Rings
551
completions of A; A0 are isomorphic. Moreover suppose that A0 is Henselian, and u
is a regular morphism.
Let B D AŒY=I, Y D .Y1; : : : ; Yn/. If f D .f1; : : : ; fr/, r  n is a system of
polynomials from I then we can deﬁne the ideal
f generated by all r  r-minors of the Jacobian matrix .@fi=@Yj/:
After Elkik [4] let HB=A be the radical of the ideal P
f ..f/ W I/fB, where the sum
is taken over all systems of polynomials f from I with r  n. Then for p 2 Spec B
Bp is essentially smooth over Aif and only if p 6 HB=A
by the Jacobian criterion for smoothness. Thus HB=A measures the non smooth locus
of B over A. B is standard smooth over A if there exists f in I as above such that
B D ..f/ W I/fB:
The aim of this paper is to give an algorithmic proof of the following theorem.
Theorem 2.1 Any A-morphism v W B ! A0 such that v.HB=A/A0 is mA0-primary
factors through a standard smooth A-algebra B0.
Proof The idea is to ﬁnd a suitable element a 2 A such that we can use the one-
dimensional result obtained for NA D A=.a/, NB D NA ˝A B, NA0 D A0=.aA0/, Nv D
NA ˝A v to ﬁnd a desingularization ND induced by a standard smooth A-algebra D
(Lemma 2.3). This desingularization can then be lifted using D. To simplify the
proof we assume that A is Cohen-Macaulay.
We choose ; 0 2 v.HB=A/A0 \ A such that ; 0 is a regular sequence in A, let
us say  D Pq
iD1 v.bi/zi; 0 D Pq
iD1 v.bi/z0
i for some1 bi 2 HB=A and zi; z0
i 2 A0:
Set B0 D BŒZ; Z0=.f; Qf /, where f D  C Pq
iD1 biZi 2 BŒZ, Z D .Z1; : : : ; Zq/,
Qf D 0 C Pq
iD1 biZ0
i 2 BŒZ0, Z0 D .Z0
1; : : : ; Z0
q/ and let v0 W B0 ! A0 be the map
of B-algebras given by Z ! z, Z0 ! z0. Replacing B by B0 we may suppose that
; 0 2 HB=A.
We need the following lemmata.
Lemma 2.2
1. ([7, Lemma 3.4]) Let B1 be the symmetric algebra SB.I=I2/ of I=I2 over2 B. Then
HB=AB1 	 HB1=A and .˝B1=A/ is free over .B1/ for any  2 HB=A.
2. ([12, Proposition 4.6]) Suppose that .˝B=A/ is free over B. Let I0 D .I; Y0/ 	
AŒY; Y0, Y0 D .Y0
1; : : : ; Y0
n/. Then .I0=I02/ is free over B.
1For the algorithm we have to choose ; 0 more carefully:   Pq
iD1 bi.y0/zi modulo .t; 0t/,
0  Pq
iD1 bi.y0/z0
i modulo .t; 0t/ with zi; z0
i 2 A, and y0
i  v.Yi/ modulo mN in A , N >> 0.
2Let M be a ﬁnitely represented B-module and Bm
.aij/
! Bn ! M ! 0 a presentation then
SB.M/ D BŒT1; : : : ; Tn=J with J D .f
nP
iD1
aijTigjD1;:::;m/.

552
G. Pﬁster and D. Popescu
3. ([9, Corollary 5.10]) Suppose that .I=I2/ is free over B. Then a power of  is
in ..g/ W I/g for some g D .g1; : : : gr/, r  n in I.
Using (1) of Lemma 2.2 we can reduce the proof of Theorem 2.1 to the case
when ˝B=A and ˝B0=A are free over B respectively B0. Let B1 be given by (1) of
Lemma 2.2. The inclusion B 	 B1 has a retraction w which maps I=I2 to zero. For
the reduction we change B; v by B1; vw.
Using (2) from Lemma 2.2 we may reduce the proof to the case when .I=I2/
(resp. .I=I2/0) is free over B (resp. B0). Indeed, since ˝B=A is free over B we
see that changing I with .I; Y0/ 	 AŒY; Y0 we may suppose that .I=I2/ is free over
B. Similarly, for 0.
Using (3) from Lemma 2.2 we may reduce the proof to the case when a power of
 (resp. 0) is in ..f/ W I/f (resp. ..f 0/ W I/f 0) for some f D .f1; : : : fr/, r  n and
f 0 D .f 0
1; : : : f 0
r0/, r0  n from I.
We may now assume that a power d (resp. d0) of  (resp. 0) has the form
d  P D
q
X
iD1
MiLi modulo I; d0  P0 D
q0
X
iD1
M0
iL0
i modulo I
for some r  r (resp. r0  r0) minors Mi (resp. M0
i) of .@f=@Y/ (resp. .@f 0=@Y/) and
Li 2 ..f/ W I/ (resp. L0
i 2 ..f 0/ W I/).
The Jacobian matrix .@f=@Y/ (resp. .@f=@Y/) can be completed with .n  r/
(resp. .n  r0/) rows from An obtaining a square n matrix Hi (resp. H0
i) such that
det Hi D Mi (resp. det H0
i D M0
i). This is easy using just the integers 0; 1.
Let NA D A=.d3/, NB D NA ˝A B, NA0 D A0=.d3A0/, Nv D NA ˝A v. We will now
construct a standard smooth A-algebra D and an A-morphism ! W D ! A0 such that
y D v.Y/ 2 Im ! C d3A0.
Lemma 2.3 There exists a standard smooth A-algebra D such that Nv factors
through ND D NA ˝A D.
Proof Let y0 2 An be such that y D v.Y/  y0 modulo .d3; d03/A0, let us say
y  y0  d02 modulo d3 for  2 d0A0n. Thus
I.y0/  0 modulo .d3; d03/A0:
Recall that we have d0  P0 modulo I and so P0.y0/  d0 modulo .d3; d03/ in A.
Thus
P0.y0/  d0s modulo d3 for a certain s 2 A with s  1 modulo d0:
Let G0
i be the adjoint matrix of H0
i and Gi D L0
iG0
i. We have GiH0
i D H0
iGi D M0
iL0
iIdn
and so
P0.y0/Idn D
q0
X
iD1
Gi.y0/H0
i.y0/:

Neron Desingularization for Two Dimensional Rings
553
But H0
i is the matrix3 .@f 0
k=@Yj/k2Œr0;j2Œn completed with some .n  r0/ rows of 0; 1.
Especially we obtain
.@f 0=@Y/Gi D M0
iL0
i.Idr0j0/:
(1)
Then ti WD H0
i.y0/ 2 d0A0n satisﬁes
Gi.y0/ti D M0
i.y0/L0
i.y0/
and so
q
X
iD1
Gi.y0/ti D P0.y0/  d0s modulo d3:
It follows that
s.y  y0/  d0
q0
X
iD1
Gi.y0/ti modulo d3:
Note that tij D ti1 for all i 2 Œr0 and j 2 Œn because the ﬁrst r0 rows of H0
i does not
depend on i (they are the rows of .@f 0=@Y/).
Let
h D s.Y  y0/  d0
q0
X
iD1
Gi.y0/Ti;
(2)
where Ti D .T1; : : : ; Tr0; Ti;r0C1 : : : ; Ti;n/, i 2 Œq0 are new variables. We will use
also Tij D Ti for i 2 Œr0, j 2 Œn because it is convenient sometimes. The kernel of
the map N W NAŒY; T ! NA0 given by Y ! y, T ! t contains h modulo d3. Since
s.Y  y0/  d0
q0
X
iD1
Gi.y0/Ti modulo h
and
f 0.Y/  f 0.y0/ 
X
j
.@f 0=@Yj/.y0/.Yj  y0
j/ modulo higher order terms in Yj  y0
j
3We use the notation Œn D f1; : : : ; ng.

554
G. Pﬁster and D. Popescu
by Taylor’s formula. We see that for p0 D maxi deg f 0
i we have
sp0f 0.Y/sp0f 0.y0/ 
X
j
sp01d0.@f 0=@Yj/.y0/
q0
X
iD1
Gij.y0/TijCd02Q modulo h
(3)
where Q 2 T2AŒTr0. We have f 0.y0/  d02b0 modulo d3 for some b0 2 d0Ar0. Then
gi D sp0b0
i C sp0Ti C Qi;
i 2 Œr0
(4)
modulo d3 is in the kernel of N. Indeed, we have sp0f 0
i D d02gi modulo .h; d3/
because of (3). Thus d02 N.g/ D d02g.t/ 2 .h.y; t/; f 0.y// 2 d3A0 and so g.t/ 2 d3A0,
because u is ﬂat and d0 is regular on A=.d3/. Set E D NAŒY; T=.I; g; h/ and let
N W E ! NA0 be the map induced by N. Clearly, Nv factors through N because Nv
is the composed map NB D NAŒY=I ! E
N ! NA0.
We will see, there are s0; s00 2 E such that Ess0s00 is smooth over NA and N factors
through Ess0s00.
Note that the r0  r0-minor s0 of .@g=@T/ given by the ﬁrst r0-variables T is from
sr0p0 C .T/ 	 1 C .d0; T/ because Q 2 .T/2. Then V D .NAŒY; T=.h; g//ss0 is smooth
over NA. As in [6] we claim that I NAŒY; T 	 .h; g/NAŒY; Tss0s00 for some s00 2 1 C
.d0; d3; T/AŒY; T. Indeed, we have
P0I NAŒY; T 	 .f 0/AŒY; T 	 .h; g/NAŒY; Ts
and so
P0.y0 C s1d0G.y0/T/I 	 .h; g; d3/AŒY; Ts:
Since P0.y0 C s1d0G.y0/T/ 2 P0.y0/ C d0.T/V we get
P.y0 C s1d0G.y0/T/  d0s00 modulo d3
for some s00 2 1C.T/AŒY; T. It follows that s00I 	 ...h; g/ W d0/; d3/AŒY; Tss0. Thus
s00I is contained modulo d3 in .0 WV d0/ D 0 because d0 is regular on V, the map
NA ! V being ﬂat. This shows our claim. It follows that I 	 .d3; h; g/AŒY; Tss0s00.
Thus Ess0s00 Š Vs00 is a NB-algebra which is also standard smooth over NA.
As u.s/  1 modulo d0 and N .s0/; N .s00/  1 modulo .d0; d3; t/, d; d0; t 2 mA0
we see that u.s/; N .s0/; N .s00/ are invertible because A0 is local. Thus N (and so Nv)
factors through the standard smooth NA-algebra Ess0s00, let us say by N! W Ess0s00 ! NA0.
Now, let Y0 D .Y0
1; : : : :Y0
n/, and D be the A-algebra isomorphic with
.AŒY; T=.I; h; g//ss0s00 by Y0 ! Y; T ! T:

Neron Desingularization for Two Dimensional Rings
555
Since A0 is Henselian we may lift N! to a map .AŒY; T=.I; h; g//ss0s00 ! A0 which
will correspond to a map ! W D ! A0. Then Nv factors4 through ND, let us say NB !
ND ! NA0, where the ﬁrst map is given by Y ! Y0. This proves Lemma 2.3.
To continue with the proof of Theorem 2.1 let ı be the A-morphism deﬁned by
ı W B ˝A D Š DŒY=IDŒY ! A0; b ˝  ! v.b/!./:
Claim ı factors through a special ﬁnite type B ˝A D-algebra QE.
The proof will follow the proof of Lemma 2.3. Note that the map NB ! ND is given
by Y ! Y0 C d3D. Thus I.Y0/  0 modulo d3D. Set Qy D !.Y0/. Since Nv factors
through N! we get
y  Qy D v.Y/  Qy 2 d3A0n; let us say y  Qy D d2 for  2 dA0n:
Recall that P D P
i Li det Hi for Li 2 ..f/ W I/. We have d  P modulo I and
so P.Y0/  d modulo d3 in D because I.Y0/  0 modulo d3D. Thus P.Y0/ D dQs
for a certain Qs 2 D with Qs  1 modulo d. Let QG0
i be the adjoint matrix of Hi and
QGi D Li QG0
i. We have P
i QGiHi D P
i Hi QGi D PIdn and so
dQsIdn D P.Y0/Idn D
X
i
QGi.Y0/Hi.Y0/:
But Hi is the matrix .@fi=@Yj/i2Œr;j2Œn completed with some .n  r/ rows from
0; 1. Especially we obtain
.@f=@Y/
X
i
QGi D .PIdrj0/:
(5)
Then Qti WD !.Hi.Y0// 2 dA0n satisﬁes
X
i
QGi.Y0/Qti D P.Y0/ D dQs
and so
Qs.y  Qy/ D d
X
i
!. QGi.Y0//Qti:
Let
Qh D Qs.Y  Y0/  d
X
i
QGi.Y0/QTi;
(6)
4Note that v does not necessarily factors through D.

556
G. Pﬁster and D. Popescu
where QT D .QT1; : : : ; QTn/ are new variables. The kernel of the map Q W DŒY; QT ! A0
given by Y ! y, QT ! Qt contains Qh. Since
Qs.Y  Y0/  d
X
i
QGi.Y0/QTi modulo Qh
and
f.Y/  f.Y0/ 
X
j
.@f=@Yj/..Y0/.Yj  Y0
j/
modulo higher order terms in Yj  Y0
j, by Taylor’s formula we see that for p D
maxi deg fi we have
Qspf.Y/  Qspf.Y0/ 
X
j
Qsp1d.@f=@Yj/.Y0/
X
i
QGij.Y0/QTij C d2 QQ
(7)
modulo Qh where QQ 2 QT2DŒQTr. We have f.Y0/ D d2Qb for some Qb 2 dDr. Then
Qgi D QspQbi C Qsp QTi C QQi;
i 2 Œr
(8)
is in the kernel of Q. Indeed, we have Qspfi D d2Qgi modulo Qh because of (7) and
P.Y0/ D dQs. Thus d2.Qg/ D d2Qg.t/ 2 .Qh.y;Qt/; f.y// D .0/ and so Qg.Qt/ D 0. Set
QE D DŒY; QT=.I; Qg; Qh/ and let Q W QE ! A0 be the map induced by Q. Clearly, v
factors through Q because v is the composed map
B ! B ˝A D Š DŒY=I ! QE
Q ! A0:
Finally we will prove that there exist Qs0; Qs00 2 QE such that QEQsQs0Qs00 is standard smooth
over A and Q factors through QEQsQs0Qs00.
Note that the r  r-minor Qs0 of .@Qg=@QT/ given by the ﬁrst r-variables QT is from
Qsrp C .QT/ 	 1 C .d; QT/ because QQ 2 .QT/2. Then QV D .DŒY; QT=.Qh; Qg//QsQs0 is smooth
over D. We claim that I 	 .Qh; Qg/DŒY; QTQsQs0Qs00 for some other Qs00 2 1 C .d; QT/DŒY; QT.
Indeed, we have
PIDŒY 	 .f/DŒY 	 .Qh; Qg/DŒY; QTQs
and so
P.Y0 C Qs1d
X
i
QGi.Y0/QTi/I 	 .Qh; Qg/DŒY; QTQs:
Since P.Y0 CQs1d P
i QGi.Y0/QTi/ 2 P.Y0/Cd.QT/ we get P.Y0CQs1d P
i QGi.Y0/QTi/ D
dQs00 for some Qs00 2 1 C .QT/DŒY; QT. It follows that Qs00I 	 ..Qh; Qg/ W d/DŒY; QTQsQs0. Thus

Neron Desingularization for Two Dimensional Rings
557
Qs00I 	 .0 WQV d/ D 0, which shows our claim. It follows that I 	 .Qh; Qg/DŒY; QTQsQs0Qs00.
Thus QEQsQs0Qs00 Š QVQs00 is a B-algebra which is also standard smooth over D and A.
As !.Qs/  1 modulo d and Q .Qs0/; Q .Qs00/  1 modulo .d;Qt/, d;Qt 2 mA0 we see
that !.Qs/; Q .Qs0/; Q .Qs00/ are invertible because A0 is local. Thus Q (and so v) factors
through the standard smooth A-algebra B0 D QEQsQs0Qs00. This proves Theorem 2.1.
3
The Algorithm
Now we want to apply Theorem 2.1 to compute the Neron desingularization.
We assume A D .kŒx=J/<x> is Cohen-Macaulay of dimension 2, A0 is the
completion of A and u the inclusion. The morphism v W B ! A0 will be given
by an approximation, polynomials up to a given bound. We obtain the following
algorithms (which will be implemented in
SINGULAR as a library [3]). The
algorithm prepareDesingularization corresponds to Lemma 2.2 in the proof of
Theorem 2.1.
Algorithm 1 prepareDesingularization
Input: A WD kŒx.x/=J given by J D .h1; : : : ; hp/  kŒx; x D .x1; : : : ; xt/; k a ﬁeld
B WD AŒY=I given by I D .g1; : : : ; gl/  kŒx; Y; Y D .Y1; : : : ; Yn/
and y0 D .y0
1; : : : ; y0
n/ 2 kŒxn such that HB=A.y0/ is zero-dimensional
Output: B WD AŒY=I given by I D .g1; : : : ; gl/  kŒx; Y; Y D .Y1; : : : ; Yn/, y0 D .y0
1; : : : ; y0
n/ 2
kŒxn, f; f 0 2 I and d, d0 a regular sequence in A, d 2 ..f/ W I/f resp. d0 2 ..f 0/ W I/f 0, such
that .I=I2/d resp. .I=I2/d0 are free Bd resp. Bd0 modules.
1: compute HB=A D .b1; : : : ; bq/B and HB=A \ A
2: if dim A=HB=A \ A D 0 then
3:
choose ; 0 2 HB=A \ A, a regular sequence in A
4: else
5:
choose ; 0 2 HB=A.y0/, a regular sequence in A
write
  Pq
iD1 bi.y0/y0
iCn modulo .t; 0t/, 0  Pq
iD1 bi.y0/y0
iCnCq modulo .t; 0t/ for
some t and y0
j 2 kŒx
6:
glC1 WD  C Pq
iD1 biYiCn, glC2 WD 0 C Pq
iD1 biYiCnCq,
Y WD .Y1; : : : ; YnC2q/; y0 WD .y0
1; : : : ; y0
nC2q/; I WD .g1; : : : ; glC2/; l WD l C 2; n WD
n C 2q; B WD AŒY=I.
7: end if
8: B WD SB.I=I2/, y0 trivially extended
9: write
B WD AŒY=I, n WD jYj, Y WD Y; Z, Z D .Z1; : : : ; Zn/, I WD .I; Z/, B WD AŒY=I, y0 trivially
extended
10: compute f D .f1; : : : ; fr/, and f 0 D .f 0
1; : : : ; f 0
r0/ such that
a power d of , resp. d0 of 0 is in ..f/ W I/f , resp. in ..f 0/ W I/0
f
11: return B,y0,f,f 0,d,d0
The next algorithm corresponds to Lemma 2.3 in the proof of Theorem 2.1.

558
G. Pﬁster and D. Popescu
Algorithm 2 reductionToDimensionOne
Input: A WD kŒx.x/=J given by J D .h1; : : : ; hp/  kŒx; x D .x1; : : : ; xt/; k a ﬁeld
B WD AŒY=I given by I D .g1; : : : ; gl/  kŒx; Y; Y D .Y1; : : : ; Yn/, y0 D .y0
1; : : : ; y0
n/ 2 kŒxn ,f 0 D
.f 0
1; : : : ; f 0
r0 /, d0, d 2 A and fH0
i; L0
ig such that d0  P0 D Pq0
iD1det .H0
i /L0
i modulo I
Output: D WD .AŒY0; T=.I; g; h//ss0s00 given by I; g; h; s; s0; s" 2 kŒx; Y0; T,Y0 WD .Y0
1; : : : ; Y0
n/;
1: write
P0.y0/ D d0s modulo d3 for s 2 A, s  1 modulo d0
2: for i D 1 to q0 do
3:
compute G0
i the adjoint matrix of H0
i and Gi D L0
iG0
i
4: end for
5: h WD s.Y  y0/  d0 P
i Gi.y0/Ti, Ti D .T1; : : : ; Tr0; Ti;r0C1; : : : ; Ti;n/
6: p0 WD maxifdeg f 0
i g
7: write
sp0f 0.Y/  sp0f 0.y0/ D
P
j sp01d0@f 0=@Y.y0/
P
i Gij.y0/Tij C d02Q modulo h
8: write f 0.y0/ D d02b0 modulo d3
9: for i D 1 to r0 do
10:
gi WD sp0b0
i C sp0Ti C Qi
11: end for
12: compute s0 the r0-minor of .@g=@T/ given by the ﬁrst r0 variables and s00 such that
P.y0 C s1d0 P
i Gi.y0/T/ D d0s00 modulo d3
13: D WD .AŒY0; T=.I; g; h//ss0 s00; Y0 WD .Y0
1; : : : ; Y0
n/; g WD g.Y0/; I WD I.Y0/; h WD h.Y0/
14: return D
Algorithm 3 NeronDesingularization
Input: N 2 Z>0 a bound
A WD kŒx.x/=J given by J D .h1; : : : ; hp/  kŒx; x D .x1; : : : ; xt/; k a ﬁeld
B WD AŒY=I given by I D .g1; : : : ; gl/  kŒx; Y; Y D .Y1; : : : ; Yn/ v W B ! A0  KŒŒx=JKŒŒx an
A-morphism given by y0 D .y0
1; : : : ; y0
n/ 2 kŒxn, approximations modulo .x/N of v.Y/.
Output: A Neron desingularization of v W B ! A0 or the message “the bound is too small”
1: .B; y0; f; f 0; d; d0/:=prepareDesingularization.A; B; y0/
2: if .d3; d03/ 6 .x/N then
3:
return “the bound is too small”
4: end if
5: choose r-minors Mi (resp. r0-minors M0
i ) of .@f=@Y/, (resp. .@f 0=@Y/) and Li 2 ..f/ W I/, (resp. L0
i 2 ..f 0/ W
I/) such that
for P D P
i MiLi (resp. P0 D P
i M0
i L0
i), d  P modulo I (resp. d0  P0 modulo I)
6: complete the Jacobian matrix .@f=@Y/ (resp. .@f 0=@Y/) by .n  r/ (resp. .n  r0) rows of 0; 1 to obtain
square matrices Hi (resp. H0
i ) such that
det Hi D Mi (resp. det H0
i D M0
i )
7: D:=reductionToDimensionOne(A; B; y0; f 0; d0; d; fH0
i ; L0
ig)
8: write P.Y0/ D dQs; Qs  1 modulo d
9: compute QG0
i the adjoint matrix of Hi and QGi D Li QG0
i
10: Qh WD Qs.Y  Y0/  d Pq
iD1 QGi QTi, QTi D .QT1; : : : ; QTr; QTi;rC1; : : : ; QTi;n/
11: p WD maxifdeg fig
12: write Qspf.Y/  Qspf.Y0/ D P
j Qsp1d@f=@Y.Y0/ P
i QGij.Y0/QTij C d02 QQ modulo Qh and
13: write f.Y0/ D d2Qb, Qb 2 dDr
14: for i D 1 to r do
15:
Qgi WD QspQbi C Qsp QTi C QQi
16: end for
17: compute Qs0 the r  r-minors of .@Qg=@QT/ given by the ﬁrst r variables of QT
18: compute Qs00 such that
P.Y0 C Qs1d P
i QGi.Y0/QT/ D dQs00
19: return DŒY; QT=.I; Qg; Qh/QsQs0Qs00

Neron Desingularization for Two Dimensional Rings
559
References
1. M. André, Cinq exposés sur la désingularisation. Handwritten manuscript Ecole Polytechnique
Fédérale de Lausanne (1991)
2. M. Artin, Algebraic approximation of structures over complete local rings. Publ. Math. IHES
36, 23–58 (1969)
3. W. Decker, G.-M. Greuel, G. Pﬁster, H. Schönemann, SINGULAR 4-1-0 – a computer algebra
system for polynomial computations (2016). http://www.singular.uni-kl.de
4. R. Elkik, Solutions d’équations à coéfﬁcients dans un anneaux hensélien. Ann. Sci. Ecole
Normale Sup. 6, 553–604 (1973)
5. A. Néron, Modèles minimaux des varietés abéliennes sur les corps locaux et globaux. Publ.
Math. IHES 21, 5–128 (1964)
6. G. Pﬁster, D. Popescu, Constructive General Neron Desingularization for one dimensional
local rings. J. Symb. Comput. 80, 570–580 (2017)
7. D. Popescu, General Neron Desingularization. Nagoya Math. J. 100, 97–126 (1985)
8. D. Popescu, General Neron Desingularization and approximation. Nagoya Math. J. 104, 85–
115 (1986)
9. D. Popescu, Artin approximation, in Handbook of Algebra, vol. 2, ed. by M. Hazewinkel
(Elsevier, Amsterdam, 2000), pp. 321–355
10. A. Popescu, D. Popescu, A method to compute the General Neron Desingularization in the
frame of one dimensional local domains, in Singularities and Computer Algebra – Festschrift
for Gert-Martin Greuel, On the Occasion of his 70th Birthday, ed. by W. Decker, G. Pﬁster,
M. Schulze. Springer Monograph, pp. 199–222. arXiv:AC/1508.05511
11. M. Spivakovsky, A new proof of D. Popescu’s theorem on smoothing of ring homomorphisms.
J. Am. Math. Soc. 294, 381–444 (1999)
12. R. Swan, Neron-Popescu desingularization, in Algebra and Geometry, ed. by M. Kang
(International Press, Cambridge, 1998), pp. 135–192

A Framework for Computing Zeta
Functions of Groups, Algebras,
and Modules
Tobias Rossmann
Abstract We give an overview of the author’s recent work on methods for explicitly
computing various types of zeta functions associated with algebraic counting
problems. Among the types of zeta functions that we consider are the so-called
topological ones.
Keywords Subgroup growth • Representation growth • Zeta functions • Topo-
logical zeta functions • Unipotent groups • p-Adic integration • Newton poly-
topes
Subject Classiﬁcations 11M41, 20F69, 14M25, 20F18, 20C15, 20G30
1
Introduction
1.1
Zeta Functions in Group Theory and Related Fields
The past decades saw the development of a theory of zeta functions of groups and
related algebraic structures. In this article, we consider subobject and representation
zeta functions related to enumerative problems associated with nilpotent groups. For
introductions to the area and surveys of developments in particular directions, we
refer the reader to [15, 19, 29, 56, 57]. We will concern ourselves with zeta functions
that one can attach to a suitable inﬁnite algebraic object (e.g. a Lie algebra or a
group). In a different direction, zeta functions have found striking applications in
the study of inﬁnite families of ﬁnite groups; for surveys of this active branch of
asymptotic group theory, we refer to [34, 46].
T. Rossmann ()
Department of Mathematics, University of Auckland, Auckland, New Zealand
e-mail: tobias.rossmann@gmail.com
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_25
561

562
T. Rossmann
The subobject zeta functions of interest to us can be traced back to a number
of sources. An early ancestor is given by the Dedekind zeta function of a number
ﬁeld, an instance of a submodule zeta function as deﬁned below. More recently,
Solomon [48] introduced zeta functions enumerating ZG-lattices within a ﬁxed
ZG-module for a ﬁnite group G. In a seemingly different direction, a hugely
inﬂuential paper of Grunewald et al. [23] initiated the study of zeta functions arising
from the enumeration of subgroups of ﬁnite index in a given ﬁnitely generated
torsion-free nilpotent group (a T-group, for short). In detail, given such a group
G, they deﬁned its (global) subgroup zeta function to be
6
G .s/ D
X
H
jG W Hjs;
where H ranges over the subgroups of ﬁnite index of G. They also established
various key properties of these zeta functions such as:
•
(Convergence.) Let h be the Hirsch length of G. Then 6
G .s/ converges and
deﬁnes an analytic function on the half-plane fs 2 C W Re.s/ > hg.
•
(Euler product.) 6
G .s/ D
Q
p prime
6
OGp.s/, where OGp denotes the pro-p completion of
G and each local subgroup zeta function 6
OGp.s/ is deﬁned by enumerating open
subgroups of OGp according to their indices.
•
(Rationality.) Each 6
OGp.s/ is rational in ps over Q.
For G D Z, we recover the Riemann zeta function .s/ D Z.s/ D P1
nD1 ns
and the classical Euler product .s/ D Q
p.1  ps/1. This simple illustration
notwithstanding, while the ﬁrst two of the above points are elementary, the
rationality of local subgroup zeta functions is a deep theorem.
By only considering normal subgroups of ﬁnite index of G, the normal subgroup
zeta function G
G.s/ of G is obtained; it satisﬁes the evident analogues of the
properties stated above. The subalgebra and submodule zeta functions deﬁned in
Sect. 2.1 essentially constitute generalisations of the local and global (normal)
subgroup zeta functions associated with nilpotent groups. Indeed, as explained
in [23], the Mal’cev correspondence allows us to linearise the enumeration of
subgroups by replacing the nilpotent group in question by a suitable nilpotent Lie
Z-algebra (at the cost of having to discard ﬁnitely many Euler factors).
Apart from subobject zeta functions, we also consider representation zeta
functions. These are Dirichlet series enumerating certain ﬁnite-dimensional irre-
ducible representations of a suitable group up to adequate notions of equivalence.
Representation zeta functions were introduced by Witten [59] in the context of
complex Lie groups. Jaikin-Zapirain [26] made fundamental contributions to the
study of representation zeta functions of compact p-adic analytic groups. Within
inﬁnite group theory, a substantial amount of recent work has been devoted to

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
563
representation zeta functions of groups arising from semisimple algebraic groups;
see e.g. work of Larsen and Lubotzky [32] and Avni et al. [2]. In a seemingly
different direction, Hrushovski and Martin [24] (v1, 2006) introduced representation
zeta functions of T-groups; these are the representation zeta functions that we shall
consider.
As we will explain in Sect. 3, the subobject and representation zeta functions
considered here share a crucial common feature: in each case, a single global object
(e.g. a T-group) gives rise to a family of associated local zeta functions indexed by
primes (or places of a number ﬁeld) and, after excluding ﬁnitely many exceptions,
these local zeta functions can all be described in terms of a single “formula”. We
express this by saying that there exists such a “formula” for the generic local zeta
functions in question. In a surprising number of interesting cases (including most
cases that have been successfully computed so far), the local zeta functions under
consideration are in fact given by a rational function W.p; ps/ in p and ps over Q
(again after possibly excluding ﬁnitely many primes). This phenomenon is referred
to as (almost) uniformity in [19, §1.2.4]. In such uniform cases, we interpret the
natural task of computing the generic local zeta functions under consideration as
computing the (uniquely determined) rational function W. For instance, if H.Z/ is
the discrete Heisenberg group, then, by [23, Prop. 8.1],
6
H.Z/.s/ D .s/.s  1/.2s  2/.2s  3/.3s  3/1 D
Y
p prime
W.p; ps/;
(1)
where W.X; Y/ D .1  X3Y3/=

.1  Y/.1  XY/.1  X2Y2/.1  X3Y2/

.
1.2
Computations: Limitations and Previous Work
Theoretical results on the subobject and representation zeta functions considered
here frequently rely on impractical or even non-constructive methods. In particular,
in one of the central papers in the area, du Sautoy and Grunewald [16] showed that
generic local subobject zeta functions are in principle “computable” (in the sense
that one can compute certain formulae for them, see Sect. 3)—provided that one
happens to know an embedded resolution of singularities of some (usually highly
singular) hypersurface inside some afﬁne space (of dimension > 6 in all cases of
interest); Voll [55, §3.4] obtained a similar result for representation zeta functions
of nilpotent groups.
Apart from striking theoretical applications, the methods developed by du Sautoy
and Grunewald [16] and Voll [55] (and Stasinski and Voll [49]) have also been
successfully used to compute zeta functions in small examples (see, in particular, the
computation of du Sautoy and Taylor [18] of the subalgebra zeta function of sl2.Z/;
for related computations, see [14, 25, 30]). However, when it comes to explicit
computations, the practical scope of these techniques is usually rather limited.

564
T. Rossmann
A substantial number of subobject zeta functions (primarily of nilpotent groups
and Lie algebras) were computed by Woodward [60]. He relied on a combination
of human guidance and computer calculations. Unfortunately, due to a lack of
documentation,his ﬁndings are hard to reproduce. A number of ad hoc computations
of representation zeta functions of nilpotent groups have been carried out by
Ezzat [22], Snocken [47], and Stasinski and Voll [50].
1.3
Topological Zeta Functions
A common catchphrase in the area is that topological zeta functions are obtained
from local ones (such as the 6
OGp.s/ from above) by passing to a limit “p ! 1”.
Indeed, Denef and Loeser [13] introduced topological zeta functions of polynomials
by justifying that such a limit can be applied to Igusa’s local zeta function
(see [11, 36] for introductions). Despite their arithmetic ancestry (for Igusa’s
local zeta function enumerates solutions to congruences), research on topological
zeta functions has been primarily motivated by questions from singularity theory.
In recent years, topological zeta functions of polynomials have mostly been studied
within the realm of motivic zeta functions.
Using such a “motivic” point of view, topological subobject zeta functions were
introduced by du Sautoy and Loeser [17]; these zeta functions are related to,
but different from, Evseev’s “reduced zeta functions” [21]. Apart from giving a
deﬁnition of these zeta functions, they also computed a few small examples. Further
examples were determined by the author [38, 39] who also began an investigation
of topological representation zeta functions [40]. The topological subobject and
representation zeta functions studied by the author seem to exhibit a number
of features distinct from the well-studied case of topological zeta functions of
polynomials; we will discuss some of these features in Sect. 8.
1.4
Computations: A Framework
The author’s articles [38–41] provide a practical framework for explicitly computing
numerous types of (generic) local and topological zeta functions in “fortunate”
cases related to geometric genericity conditions. The main purpose of the present
article is to provide a self-contained and uniﬁed introduction that takes into account
theoretical developments that occurred over the course of the project.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
565
In summary, the author’s methods for computing topological [38–40] or generic
local zeta functions [41] all proceed along the following lines:
1. (Translation.) Express the associated generic local zeta functions in terms of
p-adic integrals deﬁned in terms of certain global “data”.
2. (The simplify-balance-reduce loop.) After discarding ﬁnitely many primes,
attempt to write the integrals from the ﬁrst step as sums of integrals of the same
shape but deﬁned in terms of “regular” (i.e. sufﬁciently generic) data.
3. (Evaluation.) Assuming the second step succeeds, explicitly compute “formulae”
for the generic local or topological zeta functions associated with the integrals
attached to the regular data from the second step.
4. (Final summation.) Add the formulae from the third step.
The ﬁrst step is based on known results. For the computation of subobject
zeta functions, we use the formalism of “cone integrals” of du Sautoy and
Grunewald [16]. For representation zeta functions associated with unipotent groups,
we rely on the formulation in terms of p-adic integrals due to Stasinski and Voll [49]
(which extends Voll’s formalism from [55]); see also related work of Avni et al. [2]
on representation zeta functions of arithmetic groups.
The second step is concerned with manipulations of p-adic integrals represented
in terms of the “toric data” from [39] or the “representation data” from [40]. Either
type of datum consists of algebraic ingredients (Laurent polynomials) and convex-
geometric data (“half-open cones”). Regularity is an algebro-geometric genericity
condition which allows us to invoke the machinery developed in [38] in order to
compute the p-adic integral in question (or the associated topological zeta function).
Being “balanced” is a much weaker property and it is always possible to write the
integral associated with an arbitrary toric/representation datum as a sum of integrals
associated with balanced data—this corresponds to the middle part of the name of
the second step. In fortunate case (related to the notion of non-degeneracy from
[38]), applying the balancing procedure to our initial datum from the ﬁrst step will
produce a family of regular data. The purpose of the reduction step is to modify
balanced but singular (i.e. not regular) data, the goal being to derive regular data.
This may or may not succeed for a given example and it is the main reason why the
author’s methods may fail for speciﬁc examples. While the ﬁnal summation step is
mathematically trivial, it is often computationally daunting.
1.5
Overview
In Sect. 2, we recall deﬁnitions of the global and local zeta functions that we con-
sider. We then discuss the existence of “formulae” for generic local zeta functions in
Sect. 3. Topological zeta functions are the subject of Sect. 4. Prior to presenting our
computational framework and its computer implementation in Sect. 6, we collect

566
T. Rossmann
some background material from convex geometry in Sect. 5. As a demonstration
of the practical usefulness of the author’s methods, a number of applications
are discussed in Sect. 7. Finally, Sect. 8 is devoted to two particularly interesting
conjectures that arose from the author’s computations.
2
Global and Local Zeta Functions
2.1
Formal Subalgebra, Ideal, and Submodule Zeta Functions
Let R be a commutative ring and let A be an R-algebra, i.e. an R-module endowed
with a multiplication A ˝R A ! A (which need not be associative or Lie).
A subalgebra of A is an R-submodule which is stable under the given multiplication.
As usual, by the index jA W Uj of an R-submodule U 6 A, we mean the cardinality
of the R-module quotient A=U. Let a6
n .A/ denote the number of subalgebras of A of
index n. Assuming that these numbers are all ﬁnite, we deﬁne the subalgebra zeta
function of A to be the formal Dirichlet series
6
A .s/ D
1
X
nD1
a6
n .A/ns:
If we only consider (2-sided R-)ideals of A, then we obtain the ideal zeta function
G
A.s/ of A. These notions are all natural generalisations of the subring and ideal zeta
functions introduced by Grunewald et al. [23].
Let M be an R-module and let ˝ be a set of endomorphisms of M. Let an.˝ Õ
M/ denote the number of submodules U of M with jM W Uj D n and such that U
is invariant under each element of ˝. Assuming that each an.˝ Õ M/ is ﬁnite, we
deﬁne the submodule zeta function of ˝ acting on M to be
6
˝ÕM.s/ D
1
X
nD1
an.˝ Õ M/ns:
These zeta functions generalise those of Solomon [48]. It is frequently useful to
note that ˝ÕM.s/ only depends on the unitary associative subalgebra of End.M/
generated by ˝. Moreover, as pointed out in [38], submodule zeta functions as
deﬁned here generalise the ideal zeta functions from above.
Generalising further, we could take into account a given R-module decomposi-
tion of an R-algebra A or an R-module M and consider associated graded counting
problems as in [41, §3]; apart from the author’s work, such graded zeta functions
have recently been studied by Lee and Voll [33]. For the sake of simplicity, while
many results and ideas apply in this greater generality, in the following, we only
consider subalgebra and submodule zeta functions of the form 6
A .s/ and ˝ÕM.s/
and we refer to these as subobject zeta functions.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
567
2.2
Number Fields and Euler Products
The subalgebra and submodule zeta functions deﬁned in Sect. 2.1 are formal
Dirichlet series. Further assumptions are needed for these to give rise to analytic
functions.
We ﬁrst set up some notation that will be used for the remainder of this article. Let
k be a number ﬁeld with ring of integers o. Let Vk be the set of non-Archimedean
places of k; we identify VQ with the set of prime numbers. For v 2 Vk, let pv 2
Spec.o/ correspond to v, let kv denote the v-adic completion of k, and let ov be the
valuation ring of kv. We write Kv for the residue ﬁeld of kv and qv for its size.
For an o-object (e.g. an o-module) X, we write Xv for the associated ov-object
obtained after base change (e.g. X ˝o ov). Let A be an o-algebra, let M be an
o-module, and let ˝  End.M/. We assume that A and M are both free of rank
d as o-modules. It is well-known (cf. [23, Prop. 1]) that 6
A .s/ and ˝ÕM.s/ both
converge for Re.s/ > d. Furthermore, we obtain Euler products
6
A .s/ D
Y
v2Vk
6
Av.s/;
˝ÕM.s/ D
Y
v2Vk
˝ÕMv.s/I
see [38, Lem. 2.3]. In [16], du Sautoy and Grunewald showed that 6
A .s/ and
˝ÕM.s/ have rational abscissae of convergence and admit meromorphic contin-
uation to some larger half-planes than their initial half-planes of convergence.
Furthermore, using their techniques (or the model-theoretic arguments from [23]),
each 6
Av.s/ and ˝ÕMv.s/ is found to be rational in qs
v .
2.3
Representation Zeta Functions of Unipotent Groups
Given a topological group G, let Qrn.G/ denote the number of its continuous
irreducible n-dimensional complex representations, counted up to equivalence
and tensoring with continuous 1-dimensional representations (“twisting”). The
motivation for allowing 1-dimensional “twists” comes from the case of nilpotent
groups: while an inﬁnite (discrete) T-group G has inﬁnitely many homomorphisms
to GL1.C/, Lubotzky and Magid [35] showed that each Qrn.G/ is ﬁnite. Following
Hrushovski and Martin [24] (v1), if each Qrn.G/ is ﬁnite, we deﬁne the (twist)
representation zeta function of G to be the formal Dirichlet series
e
irr
G .s/ D
1
X
nD1
Qrn.G/ns:

568
T. Rossmann
Let G be a T-group. Then e
irr
G .s/ converges in some complex half-plane, see [49,
Lem. 2.1]. Moreover, crucial properties of e
irr
G .s/ such as its abscissa of convergence
only depend on the commensurability class of G, see [20, Cor. B]. It is well-known
that commensurability classes of T-groups are in natural bijection with isomorphism
classes of unipotent algebraic groups over Q. Following Stasinski and Voll [49],
we consider representation zeta functions of T-groups associated with unipotent
algebraic groups over number ﬁelds.
We ﬁrst recall some facts on unipotent algebraic groups. Let Ud be the subgroup
scheme of GLd consisting of upper unitriangular matrices. An algebraic group G
over the number ﬁeld k is unipotent if and only if it embeds into some Ud ˝k;
for other characterisations of unipotence, see [10, Ch. IV]. Let G be a unipotent
algebraic group over k. After choosing an embedding of G into some Ud ˝k, we
obtain an associated o-form G of G as a group scheme by taking the scheme-
theoretic closure of G within Ud ˝o. We regard the T-group G.o/ as a discrete
topological group and for v 2 Vk, we naturally regard G.ov/ as a pro-pv group,
where pv is the rational prime contained in pv. By [49, Prop. 2.2], e
irr
G.o/.s/ D
Q
v2Vk e
irr
G.ov/.s/. Duong and Voll [20] and Hrushovski et al. [24] have shown that
e
irr
G.ov/.s/ is rational in qs
v
for almost all v 2 Vk and that e
irr
G.o/.s/ has rational
abscissa of convergence. Duong and Voll also showed that, as in the enumeration
of subobjects in Sect. 2.2, e
irr
G.o/.s/ admits meromorphic continuation to the left of
its abscissa of convergence.
3
Computability of Generic Local Zeta Functions
We now explain in which sense generic local subobject and representation zeta
functions are, in principle, computable. Let Z D .Zv.s//v2Vk be a family of local
zeta functions deﬁned in one of the following ways:
•
Zv.s/ D .1  q1
v /d  6
Av.s/, where A is an o-algebra whose underlying o-module
is free of rank d.
•
Zv.s/ D .1  q1
v /d  ˝ÕMv.s/, where M is a free o-module of rank d and ˝ 
End.M/.
•
Zv.s/ D e
irr
G.ov/.s/, where G 6 Ud ˝o is the natural o-form of G 6 Ud ˝k.
The role of the factors .1  q1
v /d will be explained in Sect. 4. The global zeta
function associated with Z is in general a subtle analytic object which we shall not
consider further. Instead, we focus on the already quite difﬁcult local picture.
In the study of local zeta functions Zv.s/ attached to a global object, the
exclusion of ﬁnite sets of exceptional places is often unavoidable. For example,
while the subalgebra zeta function of sl2.Zp/ is given by a simple formula which
is valid for all odd primes p, the case p D 2 is exceptional; see [18]. Fortunately,
interesting properties of global zeta functions often remain unaffected when ﬁnitely

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
569
many places are dropped; this is, for instance, the case for the global abscissae of
convergence of subobject zeta functions, cf. [42, Lem. 5.3, Rem. 5.4]. Henceforth,
we focus on the generic local zeta functions Zv.s/ obtained after discarding Zw.s/
for ﬁnitely many w 2 Vk.
As we mentioned above, Zv.s/ is rational in qs
v
for almost every v 2 Vk. The
task of “computing” Zv.s/ then means to determine Wv.Y/ 2 Q.Y/ with Zv.s/ D
Wv.qs
v /. The non-trivial fact that it is even possible to do this algorithmically is a
consequence of the proof of the following deep theorem.
Theorem 3.1 Let Z D .Zv.s//v2Vk be a family of local subalgebra, submodule, or
representation zeta functions as above. There are k-varieties V1; : : : ; Vr and rational
functions W1.X; Y/; : : : ; Wr.X; Y/ 2 Q.X; Y/ such that for almost all v 2 Vk,
Zv.s/ D
r
X
iD1
# NVi.Kv/  Wi.qv; qs
v /;
(2)
where NVi denotes the reduction modulo pv of a ﬁxed o-model of Vi.
Proof For subobject zeta functions, this is due to du Sautoy and Grunewald [16]
(cf. [38, Ex. 5.11(iii)]). For representation zeta functions associated with unipotent
groups, it was proved by Stasinski and Voll [49, Pf of Thm A] (building upon
previous work of Voll [55, §3.4]).
Remark 3.2 A seemingly stronger version of Theorem 3.1 is given by [41,
Thm 4.1]. This strengthened version takes into account not only the variation of the
place v but also allows local base extensions in a suitable manner. However, by [43],
the validity of (2) under variation of v (excluding ﬁnitely many exceptions) already
implies the validity of its analogues after local base extensions. This observation
allows us to rephrase some of our previous results more concisely in the present
article.
While the proofs of Theorem 3.1 in the sources cited above are constructive,
they all rely on some form of resolution of singularities for k-varieties; for non-
constructive model-theoretic approaches, see e.g. [24, 37]. Even though algorithms
for constructive resolution of singularities are known (see [7, 54]), these are typically
impractical in the present context. Nonetheless, we obtain an algorithm which
computes Zv.s/, for each v 2 Vk outside of some ﬁnite set, as a rational function
in qs
v . It is tempting to regard the explicit construction of (2) as the simultaneous
computation of all generic local zeta functions Zv.s/ at once. This point of view,
however, is not entirely satisfactory. For instance, it is unclear how to decide if two
formulae of the form (2) deﬁne the same rational function for almost all v 2 Vk.
For many examples of interest, the phenomenon of “uniformity” mentioned in
the introduction allows us to bypass such problems. We say that Z is uniform if
there exists W.X; Y/ 2 Q.X; Y/ such that Zv.s/ D W.qv; qs
v / for almost all v 2 Vk.
While the author is not aware of any method for testing uniformity of Z, if it is
indeed uniform, our goal is to compute W.X; Y/.

570
T. Rossmann
Before we proceed further with our work towards this goal, the author would
like to emphasise two points. First, he is not aware of a better general notion of
computing generic local zeta functions than to construct a formula (2) (or a motivic
analogue as in [17]). Secondly, he is not aware of a method for carrying out such a
construction which is both general and practical. These two points explain why the
author’s practical methods for computing generic local zeta functions, described in
Sect. 6 below, are not general, i.e. they will not succeed in all cases.
4
Topological Zeta Functions
We now introduce the protagonist of [38–40]: topological zeta functions. These
functions are deﬁned analogously to topological zeta functions of polynomials, as
introduced by Denef and Loeser [13]; topological subobject zeta functions were ﬁrst
deﬁned by du Sautoy and Loeser [17].
4.1
An Informal “Deﬁnition”
Informally, we obtain the topological zeta function associated with a family Z D
.Zv.s//v2Vk as in Theorem 3.1 by taking the limit “qv ! 1”, obtained as the
constant term in the binomial expansion of a “generic” Zv.s/ as a series in qv  1.
For example, by [49, Thm B], if H D U3 is the Heisenberg group scheme, then for
each v 2 Vk,
e
irr
H.ov/.s/ D 1  qs
v
1  q1s
v
(3)
and by symbolically expanding
qabs
v
D .1 C .qv  1//abs D
1
X
`D0
 
a  bs
`
!
.qv  1/`;
we obtain e
irr
H.ov/.s/ D
s
s1 C O.qv  1/ whence the topological representation zeta
function of H is H;top.s/ D s=.s  1/. By [43, §3], this informal “deﬁnition” of
topological zeta functions is rigorous in uniform cases such as (3). However, the
author is not aware of a deﬁnition of topological zeta functions which is at the same
time elementary, general, rigorous, and short. A pragmatic motivation for studying
topological zeta functions is that they turn out to be the type of mathematical
invariant which, while hard to deﬁne, can often be computed and studied effectively.
Moreover, as observed by Denef and Loeser [13, Thm 2.2], by the very nature of the
limit “qv ! 1” used to deﬁne them, topological zeta functions preserve interesting
analytic properties of their local relatives.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
571
4.2
A Rigorous Deﬁnition
Nowadays, topological zeta functions are most commonly studied in the context of
motivic zeta functions and integrals. In contrast, the following exposition is based
on the author’s axiomatisation [38, §5] of the original “arithmetic” deﬁnition of the
topological zeta function of a polynomial by Denef and Loeser [13].
A rigorous notion of the limit “qv ! 1” is based on a formula (2). Speciﬁcally,
we deﬁne such a limit separately for the terms “# NVi.Kv/” and “Wi.qv; qs
v /” and then
combine them in the evident way.
First, we formalise taking a limit “qv ! 1” of W.qv; qs
v /. For e 2 QŒs, write
Xe WD P1
`D0
e
`
.X  1/` 2 QŒsŒŒX  1. The map f.X; Y/ 7! f.X; Xs/ yields an
embedding of Q.X; Y/ into Q.s/..X1//. In general, W.X; Xs/ need not be a power
series in X  1 for W.X; Y/ 2 Q.X; Y/. We will restrict attention to certain rational
functions for which it is:
Deﬁnition 4.1
1. Let MŒX; Y  Q.X; Y/ be the Q-algebra consisting of those rational functions
W.X; Y/ 2 Q.X; Y/ with W.X; Xs/ 2 Q.s/ŒŒX  1 and such that W.X; Y/ D
f.X; Y/=

.1  Xa1Yb1/    .1  XarYbr/

for non-zero .a1; b1/; : : : , .ar; br/ 2 Z2
and a suitable f.X; Y/ 2 QŒX˙1; Y˙1.
2. Write bW.s/c for the image of W.X; Y/ 2 MŒX; Y under “formal reduction
modulo X  1”, i.e. under the map f.X; Y/ 7! f.X; Xs/ mod .X  1/.
The factors .1q1
v /d in the deﬁnition of Zv.s/ in Sect. 3 were included to ensure
the validity of the following:
Lemma 4.2 We may assume that W1.X; Y/; : : : ; Wr.X; Y/ 2 MŒX; Y in Theo-
rem 3.1.
Proof Combine [38, Thm 5.16] and [40, Lem. 3.4].
It remains to deﬁne a limit “qv ! 1” of # NVi.Kv/ in (2). For background and
further details on the following, we refer to [45, §4]. For v 2 Vk, ﬁx an algebraic
closure NKv of Kv and denote by K. f/
v
the extension of Kv of degree f within NKv. Let V
be a k-variety. As above, we ﬁx an o-model, V say, of V and given v 2 Vk, we let NV
denote the reduction modulo pv of V. It follows from Grothendieck’s trace formula
and comparison theorems for `-adic cohomology that for almost all v 2 Vk, there
are ﬁnitely many non-zero complex numbers ˛ij (i; j > 0) such that for all f 2 N,
# NV.K. f/
v / D P
i;j.1/i˛f
ij and, moreover, # NV.K.0/
v / WD P
i;j.1/i˛0
ij D .V.C//;
here, the topological Euler characteristic .V.C// is taken with respect to an
arbitrary embedding of k into C. Numerous results in [45] justify deﬁning # NV.K.0/
v /
as .V.C//. For example, by [41, Lem. 7.1] (an application of Chebotarev’s density
theorem similar to arguments from [45]), if f.X/ 2 ZŒX satisﬁes # NV.Kv/ D f.qv/
for almost all v 2 Vk, then .V.C// D f.1/.

572
T. Rossmann
In summary, our candidate for the topological zeta function associated with a
family Z D .Zv.s//v2Vk as in Theorem 3.1 is Pr
iD1 .Vi.C//  bWi.s/c 2 Q.s/. It
remains to show that this rational function does not depend on the choice of the
particular formula (2). This is the content of the following theorem.
Theorem 4.3 For v 2 Vk, let Zv.s/ be an analytic function on some complex right
half-plane. Let V1; : : : ; Vr be k-varieties, let W1.X; Y/; : : : ; Wr.X; Y/ 2 MŒX; Y,
and suppose that for almost all v 2 Vk, Zv.s/ D
rP
iD1
# NVi.Kv/  Wi.qv; qs
v /. Then the
following rational function is independent of the Vi and the Wi.X; Y/:
Ztop.s/ WD
r
X
iD1
.Vi.C//  bWi.s/c 2 Q.s/:
Proof Combine [38, Thm 5.12] and [43, Thm 3.2].
Theorem 4.3 generalises an insight of Denef and Loeser [13, (2.4)] at the heart
of their original deﬁnition of topological zeta functions of polynomials.
Deﬁnition 4.4 ([38, Def. 5.17]; [40, Def. 3.5]) In the setting of Theorem 3.1,
we deﬁne the topological subalgebra, submodule, or representation zeta function
6
A;top.s/, ˝ÕM;top.s/, or e
irr
G;top.s/, respectively, to be Ztop.s/ 2 Q.s/, where Z is
deﬁned as in Sect. 3.
Up to a simple shift, our deﬁnition of topological subalgebra zeta functions is
consistent with that of du Sautoy and Loeser [17, §8].
Example 4.5 Let h be the Heisenberg Lie Z-algebra. The subalgebra zeta function
of h coincides with the subgroup zeta function of the discrete Heisenberg group
in (1). Hence, for each prime p, 6
h˝Zp.s/ D W.p; ps/, where W.X; Y/ is given
after (1). Thus, the topological subalgebra zeta function of h is the constant term of
.1  X1/3W.X; Xs/ as a series in X  1, i.e.
6
h;top.s/ D
3s  3
s.s  1/.2s  2/.2s  3/ D
3
2s.s  1/.2s  3/:
Observe that the real poles of 6
h˝Zp.s/ and 6
h;top.s/ coincide. While this is not
a general phenomenon, Denef and Loeser [13, Thm 2.2] showed that poles of
topological zeta functions always give rise to poles of suitable associated local
zeta functions. In view of Igusa’s Monodromy Conjecture (see [11, §2.3]), this
connection between poles of local and topological zeta functions provides one of
the key motivations for studying the latter.
Example 4.5 is misleading in the simplicity of the formula for the topological zeta
function and its derivation from knowledge of the associated local zeta functions.
Indeed, one of the key features of the method for computing topological zeta
functions in Sect. 6 is that it does not rely on computations of local zeta functions.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
573
5
Tools from Convex Geometry
We brieﬂy recall basic notions from convex geometry needed in the following.
5.1
Cones and Generating Functions
For details on most of the following, see e.g. [4]. A (linear) half-space in Rn is
a set of the form f! 2 Rn W h˛; !i > 0g, where ˛ 2 Rn is non-zero and h ; i
denotes the usual inner product. If ˛ can be chosen to have rational entries, then
the half-space is rational. By a cone in Rn, we mean a ﬁnite intersection of linear
half-spaces; note that cones are (convex) polyhedra. If these half-spaces can all be
taken to be rational, then we say that the cone is rational. By a half-open cone,
we mean a set of the form C0 D C n .C1 [    [ Cr/, where C is a cone and
each Ci is a face of C (i.e. the intersection of C with a supporting hyperplane).
If the Ci can be chosen to be precisely the faces of C other than C itself, then
C0 is a relatively open cone. If C can be chosen to be rational, then we say that
C0 is rational. We say that C0 is pointed if its closure does not contain a non-
zero linear subspace. Supposing that C0 is rational and pointed, it is well-known
that the generating function P
!2C0\Zn ! 2 QŒŒ1; : : : ; n enumerating (integer)
lattice points in C0 is given by a rational function in Q.1; : : : ; n/. The standard
proof of rationality proceeds by triangulating the closure of C0 followed by an
application of the inclusion-exclusion principle. This argument does not, in general,
lead to a practical algorithm. A more sophisticated method for computing generating
functions is “Barvinok’s algorithm” as described by Barvinok and Woods [5]. The
implementation of this algorithm as part of LattE [3] plays a vital role in the author’s
software Zeta, to be described below.
Half-open cones are convenient for theoretical purposes. However, they appear
scarcely in the literature and software usually does not support them directly.
Fortunately, as explained in [39, §8.4], we may perform all computations required
by the method described below using suitable polyhedra (non-canonically) attached
to the half-open cones in question.
5.2
Newton Polytopes and Initial Forms
Most of the following is well-known but the term “balanced” is non-standard; for
references, see [38, §4.1].
Let f 2 kŒX˙1 WD kŒX˙1
1 ; : : : ; X˙1
n . Write f D P
˛2Zn c˛X˛, where c˛ 2 k and
c˛ D 0 for almost all ˛ 2 Zn. Let supp. f/ WD f˛ 2 Zn W c˛ 6D 0g and deﬁne the
Newton polytope New. f/ of f to be the convex hull of supp. f/ in Rn. Suppose that
f 6D 0 so that New. f/ 6D ;. For ! 2 Rn, let m. f; !/ WD
min
˛2supp. f/h˛; !i. We deﬁne

574
T. Rossmann
the initial form of f in the direction ! to be
in!. f/ WD
X
˛2supp. f/;
h˛;!iDm. f;!/
c˛X˛:
Deﬁnition 5.1 ([39, Def. 5.1(i)]) Let ; 6D M  Rn and let 0 6D f 2 kŒX˙1. We
say that f is M -balanced if ! 7! in!. f/ is constant on M .
Deﬁne an equivalence relation f on Rn by letting ! f !0 if and only if
in!. f/ D in!0. f/. Thus, f is M -balanced if and only if M is contained in one
of the equivalence classes of f . We will now recall descriptions of these classes in
terms of the Newton polytope of f.
Given a non-empty polytope P  Rn and ! 2 Rn, let face!.P/ be the face
of P consisting of those ˛ 2 P which minimise h˛; !i over P. The (relatively
open) normal cone of a face   P is N.P/ WD f! 2 Rn W face!.P/ D g. The
equivalence classes of f from above are precisely the normal cones N.New. f//
for faces   New. f/. In particular, the ﬁnite set fin!. f/ W ! 2 Rng is in natural
bijection with the set of faces of New. f/. The following is now obvious.
Lemma 5.2 ([39, Lem. 5.3]) Let ; 6D M  Rn and 0 6D f 2 kŒX˙1. Then f is
M -balanced if and only if there exists a face   New. f/ with M  N.New. f//.
Now suppose that f D . f1; : : : ; fr/ for non-zero f1; : : : ; fr 2 kŒX˙1. One can
show (cf. [38, §3.3]) that the equivalence classes of f deﬁned by letting ! f !0
if and only if in!. fi/ D in!0. fi/ for i D 1; : : : ; r are precisely the normal cones
associated with faces of New. f1    fr/.
6
A Framework for Computing Zeta Functions
In this section, we provide a uniﬁed summary of the author’s methods for computing
generic local and topological zeta functions. For the sake of a more streamlined
exposition, we only spell out the case of subalgebra zeta functions.
We begin by recalling the translation step (Sect. 6.1) which reduces the computa-
tion of local zeta functions to that of computing p-adic integrals. As we will explain
in Sect. 6.2, these integrals can be encoded in terms of objects that we call “toric
data”. In Sect. 6.3, we introduce the key notions of “balanced” and “regular” toric
data. The “simplify-balance-reduce loop” at the heart of our method is discussed
in Sect. 6.4. Assuming its successful completion, we face different tasks depending
on whether we seek to compute (generic) local or topological zeta functions; these
tasks are discussed in Sect. 6.5.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
575
6.1
p-Adic Integration
Let A be an o-algebra which is free of rank d as an o-module. By choosing a basis,
we identify A and od as o-modules. This allows us to parameterise submodules
of A using the row spans of upper-triangular d  d matrices. Building upon work
of Grunewald et al. [23, §3], du Sautoy and Grunewald [16, Thm 5.5] observed
that those submodules of A which are subalgebras can be characterised in terms of
polynomial divisibility conditions in the entries of matrices. We formalise this as in
[38, Rem. 2.7(ii)].
Let R WD oŒX WD oŒXij W 1 6 i 6 j 6 d and C WD Œıi6j  Xij 2 Trd.R/, where
ıi6j D 1 if i 6 j and ıi6j D 0 otherwise. We identify Rd D A ˝o R and in particular
regard Rd as an R-algebra. Let C1; : : : ; Cd be the rows of C. Let adj.C/ 2 Trd.R/ be
the adjugate matrix of C; hence, over k.X/, adj.C/ D det.C/C1.
Henceforth, for v 2 Vk, let v denote the additive Haar measure on kv with
v.ov/ D 1; we use the same symbol for the product measure on kd
v and Trd.kv/.
Moreover, we let j  jv denote the usual v-adic absolute value with jjv D q1
v
for
 2 pv n p2
v. Finally, we write kAkv WD sup.jajv W a 2 A/. The following expresses
each 6
Av.s/ as a “cone integral” in the sense of du Sautoy and Grunewald [16].
Theorem 6.1 ([16, Thm 5.5]; cf. [23, Prop. 3.1]) Let f  oŒX˙1 consist of the
non-zero entries of all tuples of the form det.C/1.CmCn/ adj.C/ for 1 6 m; n 6 d.
Then for each v 2 Vk,
6
Av.s/ D .1  q1
v /d
Z
˚
x2Trd.ov/ Wkf.x/kv61
	
dY
iD1
jxiijsi
v
dv.x/:
(4)
We remark that local submodule zeta functions can be similarly expressed in
terms of p-adic integrals of the same shape as (4).
Let G 6 Ud ˝k be a unipotent algebraic group over k with associated o-form
G 6 Ud ˝o. Stasinski and Voll [49, §2.2.3] expressed e
irr
G.ov/.s/, for almost all
v 2 Vk, in terms of a p-adic integral deﬁned using a ﬁxed set of globally deﬁned
polynomials. While the author’s framework is ﬂexible enough to accommodate
these integrals (see [38, Def. 4.6] and [40, §5.1]), for the sake of simplicity, in the
following, we only consider integrals of the form (4).
6.2
Toric Data and Associated Integrals
Henceforth, in addition to k, we ﬁx an “ambient space” of dimension n; in the setting
of Theorem 6.1, our ambient space will be Trd so that n D d.d C 1/=2.

576
T. Rossmann
Deﬁnition 6.2 ([39, Def. 3.1]) A toric datum is a pair T D .C0I f/, where C0 
Rn
>0 is a half-open cone (see Sect. 5.1) and f D . f1; : : : ; fr/ is a ﬁnite family of
non-zero Laurent polynomials fi 2 kŒX˙1 WD kŒX˙1
1 ; : : : ; X˙1
n .
Henceforth, we tacitly assume that C0 6D ;. We now explain how a toric datum
T D .C0I f/ gives rise to p-adic integrals. For v 2 Vk and x 2 kn
v, write v.x/ D

v.x1/; : : : ; v.xn/

; an elementary but crucial observation is that if x1    xn 6D 0 and
˛ 2 Zn, then v.x˛/ D h˛; v.x/i. Deﬁne C0.ov/ WD
˚
x 2 on
v W v.x/ 2 C0
	
.
Deﬁnition 6.3 Let T
D
.C0I f/ be a toric datum, ˇ
D
.ˇ1; : : : ; ˇm/ for
ˇ1; : : : ; ˇm 2 Nn
0, v 2 Vk, and let s1; : : : ; sm be complex variables. Deﬁne
ZT;ˇ
v
.s1; : : : ; sm/ WD
Z
fx2C0.ov/Wkf.x/kv61g
jxˇ1js1
v    jxˇmjsm
v dv.x/:
(5)
Thus, the integral in (4) is a univariate specialisation of (5) (with C0 D Rn
>0).
6.3
Balanced and Regular Toric Data
We will now explain how under a suitable regularity hypothesis for a toric datum T,
we may construct an explicit (multivariate analogue of) formula (2) for the integrals
ZT;ˇ
v
.s1; : : : ; sm/. Write Tn WD Spec.ZŒX˙1
1 ; : : : ; X˙1
n / and identify Tn.R/ D .R/n
for any commutative ring R. Let Nk be an algebraic closure of k.
Deﬁnition 6.4 ([39, Def. 5.1(ii), Def. 5.5]) Let T D .C0I f/ be a toric datum with
f D . f1; : : : ; fr/ as above.
•
T is balanced if fi is C0-balanced (see Deﬁnition 5.1) for i D 1; : : : ; r.
•
T is regular if it is balanced and the following holds:
for each J  f1; : : : ; rg and u 2 Tn.Nk/ with fj.u/ D 0 for all j 2 J, the rank of
"
@in!. fj/.u/
@Xi
#
iD1;:::;nI
j2J
is #J, where ! 2 C0 is arbitrary (the particular choice of ! being irrelevant).
Using Lemma 5.2 and the comments following it, we may test if a toric datum T
is balanced. As explained in [39, §5.2], regularity can then be tested using Gröbner
bases techniques.
Theorem 6.5 ([39, Thm 5.8]) Let T D .C0I f/ be a regular toric datum, where
f D . f1; : : : ; fr/. Let ˇ D .ˇ1; : : : ; ˇm/ be as in Deﬁnition 6.3. For J  f1; : : : ; rg,
let Vı
J  Tn ˝ k be the subvariety deﬁned by fj D 0 for j 2 J and fi 6D 0 for i 62 J.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
577
Then there are explicit WJ 2 Q.X; Y1; : : : ; Ym/ such that for almost all v 2 Vk,
ZT;ˇ
v
.s1; : : : ; sm/ D qn
v
X
Jf1;:::;rg
# NVı
J .Kv/  .qv  1/#J  WJ.qv; qs1
v
; : : : ; qsm
v
/:
(6)
The WJ in Theorem 6.5 are given explicitly in the sense that they arise via (explicit)
monomial substitutions from generating functions enumerating lattice points inside
certain half-open cones C J
0  C0  R#J; see [39, §5.5] for details.
Theorem 6.5 is an algorithmically-minded consequence of [38, Thm 4.10]. The
latter theorem provides formulae such as (6) for p-adic integrals of a quite general
shape under suitable “non-degeneracy” conditions (closely related to the above
concept of regularity for toric data). Such notions of non-degeneracy have their
origin in work of Khovanskii [27, 28] and others [6, 31, 52] in toric geometry.
They also found numerous applications in the study of Igusa’s local zeta function,
a close relative of the zeta functions studied here. Indeed, [38, Thm 4.10] was
inspired by (and generalises) a result of Denef and Hoornaert [12, Thm 4.2]; another
source of inspiration is given by work of Veys and Zúñiga-Galindo [53, §4]. For a
more detailed comparison between the author’s approach and previous work in the
literature, we refer to [38, §4.4].
Much like (2), the formalism for attaching topological zeta functions to families
of local ones in Sect. 4.2 admits a natural multivariate version; see [38, §5]. How-
ever, as a technical inconvenience, we cannot pass directly from (6) to the associated
topological zeta function since the Laurent series .X  1/#JWJ.X; Xs1; : : : ; Xsm/
in X  1 over Q.s1; : : : ; sm/ typically fail to be power series in X  1. Fortunately,
as explained in [39, §6.4], it turns out that we may rewrite (6) (altering both the
varieties and the rational functions involved in the process) in a way that allows
us to pass to the associated topological zeta function analogously to Theorem 4.3.
We note that passing from multivariate local zeta functions to topological ones is
compatible with suitable univariate specialisations such as the ones used here; see
[38, Rem. 5.15].
6.4
The Simplify-Balance-Reduce Loop
We now discuss the heart of our method. Starting with an o-algebra A, we seek to
construct a formula (2) for its generic local subalgebra zeta functions. As we have
seen, these zeta functions are expressible in terms of p-adic integrals attached to an
initial toric datum T0 D .Rn
>0I f 0/, where f 0 is a set of Laurent polynomials such as
the set f in Theorem 6.1. (The integrand encoded by ˇ in Deﬁnition 6.3 is all but
insigniﬁcant and will be ignored in the following.) Our method is based on several
operations applied to toric data as part of a loop.

578
T. Rossmann
6.4.1
Overview
At all times of our loop, we maintain a ﬁnite collection, T say, of toric data
such that for almost all v 2 Vk, the integral (5) associated with our initial toric
datum T0 (essentially the subalgebra zeta function of Av) is given by the sum
of the integrals corresponding to the elements of T ; similarly, the topological
zeta function associated with T0 (or, equivalently, the topological subalgebra zeta
function of A) will be expressed as a sum of the topological zeta functions attached
to the elements of T . Initially, T only consists of T0. We repeatedly process those
elements of T that we have not already found to be regular. More precisely, if any
such element, T say, fails to meet certain criteria, then we derive new toric data
T1; : : : ; TN, say, from T, remove T from T , insert T1; : : : ; TN into T , and resume
processing the elements ofT . We now give details on how exactly we process a
given toric datum T D .C0I f/ 2 T .
6.4.2
Simpliﬁcation
First, we “simplify” T. The key observation is that we may replace T by any
other toric datum if almost all of the associated p-adic integrals remain unchanged.
Apart from obvious operations such as removing duplicates or constants from f,
we are e.g. also free to replace f by another ﬁnite generating set of the same kŒX-
submodule of kŒX˙1. Moreover, we may remove all Laurent monomials from f for
an integrality condition “jx˛jv 6 1” is equivalent to the constraint “h˛; v.x/i > 0”
on v.x/ which can be encoded by shrinking C0 accordingly. The precise operations
that we carry out are explained in [39, §§7.1–7.2].
6.4.3
Balancing
Suppose that T has been simpliﬁed but that it is not balanced. By considering the
non-empty intersections of C0 with the normal cones of New.Q f/ (see Sect. 5.2),
we obtain a partition C0 D SN
iD1 C i
0 such that each Ti WD .C i
0I f/ is balanced. We
then remove T from T and insert T1; : : : ; TN.
6.4.4
Reduction
It remains to consider the case that T is singular, i.e. balanced but not regular. The
author is unaware of a practically useful method for dealing with these cases in
general. Instead, the “reduction step” from [39, §7.3] is an attempt to repair certain
speciﬁc types of singularity which the author frequently encountered in examples
of interest. This method may not lead to immediate improvements and to ensure
termination, we impose a bound on the number of subsequent reduction steps. If
this number is exceeded, we let our method fail.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
579
Instead of reiterating [39, §7.3], we illustrate the reduction step by discussing the
special case that gave rise to the general form. Namely, suppose that T D .C0I f/ is
balanced, where f D . f1; : : : ; fr/ and r > 2. Choose ! 2 C0. Further suppose that
there are ˛1; ˛2 2 Zn and g 2 kŒX˙1 such that in!. fi/ D X˛ig for i D 1; 2; write
hi D fi X˛ig. We assume that g consists of more than one term (i.e. # supp.g/ > 2)
whence T is singular. We decompose C0 into half-open cones C 6
0 and C >
0 deﬁned by
C 6
0 WD f 2 C0 W h˛1; i 6 h˛2; ig and
C >
0 WD f 2 C0 W h˛1; i > h˛2; ig:
Instead of T, we may then consider the two toric data T6 WD .C 6
0 I f/ and T> WD
.C >
0 I f/. We only consider T6 in the following, the case of T> being analogous. We
also assume that C 6
0 is non-empty. If x 2 on
v with .x/ 2 C 6
0 , then v.x˛2˛1/ > 0.
It follows that ZT6;ˇ
v
.s1; : : : ; sm/ remains unaffected if we “remove” one reason for
the singularity of T6, namely the summand “X˛2g” of f2, by replacing f2 by f 0
2 WD
f2X˛2˛1f1 D h2X˛2˛1h1. The resulting toric datum may no longer be balanced.
We therefore process it using the steps discussed so far in the hope that eventually,
all singularities will be successfully removed.
6.5
Processing the Pieces
Assuming successful termination of the “simplify-balance-reduce loop”, we obtain
a formula (2) for 6
Av.s/ (and almost every v 2 Vk) by applying Theorem 6.5 to
each regular toric datum that we constructed. In this formula, the Vi are given
as subvarieties of tori Tni ˝ k and the Wi.X; Y/ are “described” combinatorially
(but not yet computed) in terms of generating functions enumerating lattice points
inside certain half-open cones. Our next step is to carry out further computations
involving the Vi and Wi.X; Y/. These computations will depend on whether we seek
to compute topological or generic local zeta functions.
6.5.1
Topological Computations
We ﬁrst consider the computation of 6
A;top.s/ 2 Q.s/. As we mentioned above, by
rewriting the formulae obtained using Theorem 6.5 as in [39, §6.4], we may assume
that Wi.X; Y/ 2 MŒX; Y for each i in (2); the Vi will still be given as subvarieties
(closed ones even) of tori Tni ˝ k. We are thus left with three steps:
(T1) compute each .Vi.C//,
(T2) compute each bWi.s/c, and
(T3) compute
rP
iD1
.Vi.C//  bWi.s/c as a fraction of polynomials from QŒs.

580
T. Rossmann
Regarding (T1), there are general-purpose algorithms for computing Euler
characteristics of varieties; see, in particular, work of Alufﬁ[1]. We do not make
any use of these techniques in practice. Instead, we rely on the following two
ingredients. First, the Bernstein-Khovanskii-Kushnirenko (BKK) Theorem [28, §3,
Thm 2] provides a convex-geometricformula for the topological Euler characteristic
of (the complex analytic space associated with) a closed subvariety f1 D    D
fm
D
0 of Tn ˝ C if . f1; : : : ; fm/ is non-degenerate in the sense of [27,
§2]. Khovanskii’s notion of non-degeneracy is closely related to our concept of
regularity; see [38, §4.2]. In particular, if the reduction step from Sect. 6.4 should
not be needed during our computations, then the BKK Theorem can be applied to all
varieties that we encounter; cf. [39, Rem. 6.15(ii)]. Secondly, we employ a recursive
procedure which seeks to compute topological Euler characteristics associated with
closed subvarieties of Tn ˝ k by decomposing these varieties using subvarieties of
lower-dimensional tori. While this procedure is not guaranteed to work in all cases,
is has proven to be very useful in practice. Details are given in [39, §6.6] (with some
further explanations in [41, §5]).
For (T2), in case Wi.X; Y/ is obtained using the method from above, the
computation of bWi.s/c is described in [39, §6.5]. An important observation (already
used implicitly by Denef and Loeser [13, §5]) is that while Wi.X; Y/ arises from
a generating function enumerating lattice points inside a half-open cone, D0 say,
bWi.s/c can be written as a sum of rational functions indexed by the cones of
maximal dimension in a triangulation of the closure of D0.
Finally, step (T3) remains. As described in [39, §8.3], we can easily keep track
of a common denominator of all bWi.s/c which allows us to recover 6
A;top.s/
using evaluation at random points and polynomial interpolation. This concludes our
method for computing topological subalgebra zeta functions.
6.5.2
Generic Local Computations
Given an associated formula (2) obtained as above, we consider the computation of
the generic local subalgebra zeta functions 6
Av.s/. We make an assumption which
is even stronger than uniformity as deﬁned in Sect. 3. Namely, we assume that for
i D 1; : : : ; r, there exists ci.X/ 2 ZŒX such that # NVi.Kv/ D ci.qv/ for almost all
v 2 Vk. The author would like to note that he is not aware of any method for deciding
if this assumption is satisﬁed (or for computing the ci.X/ if it is); for computations
in possibly non-uniform settings, see [41, §§5–6,8].
Inspired by steps (T1)–(T3) from above, we proceed as follows:
(L1) attempt to construct each ci.X/ 2 ZŒX (failure being an option),
(L2) compute each Wi.X; Y/ as a sum of bivariate rational functions, and
(L3) compute W.X; Y/ 2 Q.X; Y/ with Z6
Av.s/ D W.qv; qs
v / for almost all v 2 Vk.

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
581
For (L1), we extend ideas from the computation of Euler characteristics in (T1).
We sketch the key ingredients; for details, see [41, §5]. Let f1; : : : ; fm 2 kŒX˙1 D
kŒX˙1
1 ; : : : ; X˙1
n  be non-zero. Let V  Tn ˝ k be deﬁned by f1 D    D fm D 0.
We seek to ﬁnd c.X/ 2 ZŒX such that # NV.Kv/ D c.qv/ for almost all v 2 Vk.
This is trivial for n D 0. For n D 1, the Euclidean algorithm allows us to assume
that m D 1. We then check if the roots of f1 lie in k (in which case, we take c.X/
to be the number of distinct roots) and abort if it does not. We may thus assume
n > 1. Similarly to the simpliﬁcation step in Sect. 6.4, we use the fact that we are
free to replace the fi by any collection of Laurent polynomials which generates the
same ideal of kŒX˙1. As one potential reduction of dimensions, we then construct
an isomorphism V k Uk .Tnd ˝k/, where U is a closed subvariety of Td ˝k and
d D dim.New. f1    fm//; see [38, §6.1] and [39, §6.3]. Other potential reductions
of dimensions are obtained by trying to solve each fi D 0 for one of the variables as
in [41, Lem. 5.1–5.2].
For (L2), we use algorithms due to Barvinok and others [5] for computing and
manipulating generating functions associated with polyhedra. Using these methods,
each Wi.X; Y/ will be expressed as a sum of rational functions. For (L3), similarly
to (T3), we write the ﬁnal sum of (2) over a common denominator. However, due
to the frequently large degree of said denominator (in X and Y), at least a naive
variation of the approach based on polynomial interpolation from (T3) is often
impractical. Instead, after grouping together rational functions based on heuristics
(partially inspired by ideas of Woodward [60, §2.5]), we add all numerators over
our common denominator. This is usually by far the most computationally involved
step of all.
6.6
Zeta
The author’s software package Zeta [44] for Sage [51] implements his methods for
computing generic local and topological subalgebra, submodule, and representation
zeta functions; moreover, Zeta offers basic support for Igusa-type zeta functions
associated with polynomials and polynomial mappings (as in [53] but using the
author’s notion of non-degeneracy instead of [53, Def. 4.1]). Apart from functional-
ity built into Sage, Zeta makes critical use of Singular [9] (polynomial arithmetic,
Gröbner bases), Normaliz [8] (triangulations), and LattE [3] (generating functions
associated with polyhedra).
7
Highlights of Computations Using Zeta
The topological subalgebra and representation zeta functions as deﬁned in Sect. 4.2
are all invariant under base change in the sense that they only depend on the
C-isomorphism class of A ˝o C and G ˝o C, respectively; see [38, Prop. 5.19]

582
T. Rossmann
and [40, Prop. 4.3]. Apart from the C-isomorphism class of a single 5-dimensional
algebra, dubbed Fil4 by Woodward, the topological subalgebra zeta functions of
nilpotent Lie algebras of dimension 6 5 can all be derived (via [43, §3]) from
previous p-adic calculations. The algebra Fil4 has a basis .e1; : : : ; e5/ with Œe1; e2 D
e3, Œe1; e3 D e4, Œe1; e4 D e5, Œe2; e3 D e5 and such that all remaining commutators
of basis elements (except for those implied by anti-commutativity) are zero. Based
on computations using Zeta, the following was ﬁrst announced in [38, §7.3]:
Theorem 7.1 ([39, §9.1])
Fil4;top.s/ D

392031360s9  5741480808s8 C 37286908278s7
140917681751s6 C 341501393670s5  550262853249s4C
589429290044s3  404678115300s2 C 161557332768s
28569052512

=

3.15s  26/.7s  12/.7s  13/.6s  11/3
.5s  8/.5s  9/.4s  7/2.3s  4/.2s  3/.s  1/s

:
The seemingly bizarre numbers in the numerator are consistent with the four
conjectures stated in [38, §8], two of which we will discuss below. The generic
local subalgebra zeta functions associated with Fil4 remain unknown.
Prior to the following, sl2.Q/ was the only example of an insoluble Lie algebra
whose associated generic local subalgebra zeta functions had been computed.
Theorem 7.2 ([41, Thm 9.1]) For almost all primes p, 6
gl2.Zp/.s/ D W.p; ps/,
where
W.X; Y/ D

 X8Y10  X8Y9  X7Y9  2X7Y8 C X7Y7  X6Y8  X6Y7 C 2X6Y6
 2X5Y7 C 2X5Y5  3X4Y6 C 3X4Y4  2X3Y5 C 2X3Y3  2X2Y4
C X2Y3 C X2Y2  XY3 C 2XY2 C XY C Y C 1

=

.1  X7Y6/
.1  X3Y3/.1  X2Y2/2.1  Y/

:
Noting that gl2.Zp/  sl2.Zp/ ˚ Zp for p 6D 2, this formula in particular
illustrates the generally wild effect of direct sums on subalgebra zeta functions. We
note that Theorem 7.2 is consistent with results of Voll [55, Thm A] and Evseev [21,
Thm 3.3].
Other computations of particular interest are that of Ud.Zp/ÕZdp.s/ for d 6 5 and
almost all primes p (see [41, §9.4]); the formula for d D 5 ﬁlls about three pages.
These computations are consistent with functional equations recently established by
Voll [58, Thm 5.5] as well as with [42, Prop. 6.1] (which implies that the abscissa
of convergence of Ud.Z/ÕZd.s/ is 1 for any d > 1).

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
583
Regarding representation zeta functions, extending previous work of others,
the author (with the help of Zeta) ﬁnished the determination of the generic local
representation zeta functions of unipotent algebraic groups of dimension at most 6
over number ﬁelds (see [41, §8]); we note that there are inﬁnitely many such groups
of dimension 6. The representation zeta functions of Ud.Zp/ are only known for
d 6 5; the case d D 5 was settled, for almost all p, using Zeta (see [41, Thm 8.4]).
For comments on limitations of the author’s method, see [39, §8.2] and [41,
§6.4]. In particular, to the author’s knowledge, not a single explicit example of a
(local or topological) subalgebra or ideal zeta function associated with a nilpotent
Lie algebra of class at least 5 is known. It seems likely that new theoretical insights
will be needed to compute such examples. Regarding practical limitations, Zeta
can express the generic local subalgebra zeta functions associated with Fil4 in terms
of a sum of bivariate rational functions (thus, in particular, proving uniformity
in the sense of Sect. 3). However, due to the number and complexity of these
rational functions, the author has so far been unable to calculate their sum as a
(reduced) fraction of polynomials. The author feels cautiously optimistic that further
developments of computational techniques will eventually overcome such obstacles.
8
Conjectures
8.1
Local and Topological Zeta Functions at Zero
Every non-trivial local subobject zeta function known to the author has a pole at
zero. No explanation of this phenomenon seems to have been provided. Under
nilpotency assumptions, much more seems to be true.
Conjecture 8.1 ([38, Conj. IV]) Let A be a nilpotent o-algebra (associative or Lie,
say). Let the underlying o-module of A be free of rank d. Then for all v 2 Vk,
6
Av.s/ 

1  qs
v

  

1  qd1s
v
ˇˇˇˇ
sD0
D 1:
Conjecture 8.1 was ﬁrst observed by the author in a “topological form” which
asserts that 6
A;top.s/ has a simple pole at zero with residue .1/d1=.d  1/Š. (For
an example, consider the formula in Theorem 7.1.) Numerous examples illustrate
that Conjecture 8.1 and its topological form may or may not be satisﬁed for non-
nilpotent examples. The author’s “semi-simpliﬁcation conjecture” [42, Conj. E]
disposes of nilpotency assumptions and predicts the exact behaviour of generic local
submodule zeta functions ˝ÕMv.s/ in terms of the Wedderburn decomposition of
the associative unital algebra generated by ˝. (The special case ˝ D f!g of the
semi-simpliﬁcation conjecture follows from [42, Thm 5.1].) It remains an interesting
problem to even state a generalisation of Conjecture 8.1 for possibly non-nilpotent
algebras.

584
T. Rossmann
8.2
Topological Zeta Functions at Inﬁnity
In contrast to the behaviour at zero in Sect. 8.1, the author is not aware of a useful
local analogue of the following.
Conjecture 8.2 (“Degree conjecture”; [38, Conj. I]) Let A be an o-algebra whose
underlying o-module is free of rank d. Then 6
A;top.s/ has degree d as a rational
function in s.
For example, the topological zeta function in Theorem 7.1 has degree 5, as
predicted by Conjecture 8.2. As explained in [38, §8.1], the degree of a topological
zeta function carries valuable information about the associated local zeta functions.
We note that [55, Thm A] implies that for almost all v 2 Vk, the degree of 6
Av.s/
as a rational function in qs
v
is d (cf. [58, §1.3]). A reﬁnement of Conjecture 8.2
asserts that sd6
A;top.s/
ˇˇ
sD1 is a positive rational number. Finding an interpretation
(even conjectural) of this number remains an interesting open problem.
In contrast to the mysterious case of subobject zeta functions, the author found
topological representation zeta functions associated with unipotent groups to always
have degree 0; see [40, Cor. 4.7].
Acknowledgements The author thanks Christopher Voll and the anonymous referee for their
comments and the Alexander von Humboldt-Foundation for support during the preparation of this
article. The work described here was funded by the DFG Priority Programme “Algorithmic and
Experimental Methods in Algebra, Geometry and Number Theory” (SPP 1489).
References
1. P. Alufﬁ, Characteristic classes of singular varieties, in Topics in Cohomological Studies of
Algebraic Varieties (Birkhauser, Basel, 2005), pp. 1–32
2. N. Avni, B. Klopsch, U. Onn, C. Voll, Representation zeta functions of compact p-adic analytic
groups and arithmetic groups. Duke Math. J. 162(1), 111–197 (2013)
3. V. Baldoni, N. Berline, J.A. De Loera, B. Dutra, M. Köppe, S. Moreinis, G. Pinto, M. Vergne,
J. Wu, A User’s Guide for LattE Integrale v1.7.3 (2015). Software package. LattE is available
at http://www.math.ucdavis.edu/~latte/
4. A. Barvinok, Integer Points in Polyhedra. Zurich Lectures in Advanced Mathematics (Euro-
pean Mathematical Society, Zürich, 2008)
5. A. Barvinok, K. Woods, Short rational generating functions for lattice point problems. J. Am.
Math. Soc. 16(4), 957–979 (2003) (electronic)
6. D.N. Bernstein, A.G. Kushnirenko, A.G. Khovanskii, Newton polyhedra (Russian). Usp. Mat.
Nauk 31(3(189)), 201–202 (1976)
7. E. Bierstone, P.D. Milman, Canonical desingularization in characteristic zero by blowing up
the maximum strata of a local invariant. Invent. Math. 128(2), 207–302 (1997)
8. W. Bruns, B. Ichim, T. Römer, C. Söger, Normaliz 3.1.2. Algorithms for Rational Cones and
Afﬁne Monoids (2016). Available from http://www.math.uos.de/normaliz/
9. W. Decker, G.-M. Greuel, G. Pﬁster, H. Schönemann, Singular 4-1-0—A Computer Algebra
System for Polynomial Computations (2016). Available from http://www.singular.uni-kl.de/
10. M. Demazure, P. Gabriel, Groupes algébriques. Tome I: Géométrie algébrique, généralités,
groupes commutatifs. Avec un appendice ıt Corps de classes local par Michiel Hazewinkel
(Masson & Cie/North-Holland Publishing Co., Éditeur Paris/Amsterdam, 1970)

A Framework for Computing Zeta Functions of Groups, Algebras, and Modules
585
11. J. Denef, Report on Igusa’s local zeta function. Séminaire Bourbaki, vol. 1990/1991.
Astérisque 201–203 (1991). Exp. No. 741, 359–386 (1992)
12. J. Denef, K. Hoornaert, Newton polyhedra and Igusa’s local zeta function. J. Number Theory
89(1), 31–64 (2001)
13. J. Denef, F. Loeser, Caractéristiques d’Euler-Poincaré, fonctions zêta locales et modiﬁcations
analytiques. J. Am. Math. Soc. 5(4), 705–720 (1992)
14. M.P.F. du Sautoy, The zeta function of sl2.Z/. Forum Math. 12(2), 197–221 (2000)
15. M.P.F. du Sautoy, Zeta functions of groups: the quest for order versus the ﬂight from ennui,
in Groups St. Andrews 2001 in Oxford, vol. I (Cambridge University Press, Cambridge, 2003),
pp. 150–189
16. M.P.F. du Sautoy, F.J. Grunewald, Analytic properties of zeta functions and subgroup growth.
Ann. Math. (2) 152(3), 793–833 (2000)
17. M.P.F. du Sautoy, F. Loeser, Motivic zeta functions of inﬁnite-dimensional Lie algebras. Sel.
Math. N. Ser. 10(2), 253–303 (2004)
18. M.P.F. du Sautoy, G. Taylor, The zeta function of sl2 and resolution of singularities. Math.
Proc. Camb. Philos. Soc. 132(1), 57–73 (2002)
19. M.P.F. du Sautoy, L. Woodward, Zeta Functions of Groups and Rings. Lecture Notes in
Mathematics, vol. 1925 (Springer, Berlin, 2008)
20. D.H. Dung, C. Voll, Uniform analytic properties of representation zeta functions of ﬁnitely
generated nilpotent groups. Trans. Am. Math. Soc. 369(9), 6327–6349 (2017)
21. A. Evseev, Reduced zeta functions of Lie algebras. J. Reine Angew. Math. 633, 197–211 (2009)
22. S. Ezzat, Representation growth of ﬁnitely generated torsion-free nilpotent groups: methods
and examples, Ph.D. thesis, 2012. See http://hdl.handle.net/10092/7235
23. F.J. Grunewald, D. Segal, G.C. Smith, Subgroups of ﬁnite index in nilpotent groups. Invent.
Math. 93(1), 185–223 (1988)
24. E. Hrushovski, B. Martin, S. Rideau, R. Cluckers, Deﬁnable equivalence relations and zeta
functions of groups. J. Eur. Math. Soc. (2017, to appear). arXiv:math/0701011
25. I. Ilani, Zeta functions related to the group SL2.Zp/. Isr. J. Math. 109, 157–172 (1999)
26. A. Jaikin-Zapirain, Zeta function of representations of compact p-adic analytic groups. J. Am.
Math. Soc. 19(1), 91–118 (2006) (electronic)
27. A.G. Khovanskii, Newton polyhedra, and toroidal varieties. Funkcional. Anal. i Priložen 11(4),
56–64, 96 (1977)
28. A.G. Khovanskii, Newton polyhedra, and the genus of complete intersections. Funktsional.
Anal. i Prilozhen 12(1), 51–61 (1978)
29. B. Klopsch, Representation growth and representation zeta functions of groups. Note Mat.
33(1), 107–120 (2013)
30. B. Klopsch, C. Voll, Zeta functions of three-dimensional p-adic Lie algebras. Math. Z. 263(1),
195–210 (2009)
31. A.G. Kushnirenko, Polyèdres de Newton et nombres de Milnor. Invent. Math. 32(1), 1–31
(1976)
32. M. Larsen, A. Lubotzky, Representation growth of linear groups. J. Eur. Math. Soc. 10(2),
351–390 (2008)
33. S. Lee, C. Voll, Enumerating graded ideals in graded rings associated to free nilpotent Lie rings
(2016). Preprint. arXiv:1606.04515
34. M.W. Liebeck, Probabilistic and asymptotic aspects of ﬁnite simple groups, in Probabilistic
Group Theory Combinatorics, and Computing (Springer, London, 2013), pp. 1–34
35. A. Lubotzky, A.R. Magid, Varieties of representations of ﬁnitely generated groups. Mem. Am.
Math. Soc. 58(336), xiC117 (1985)
36. J. Nicaise, An introduction to p-adic and motivic zeta functions and the monodromy conjecture,
in Algebraic and Analytic Aspects of Zeta Functions and L-Functions (World Scientiﬁc,
Singapore, 2010), pp. 141–166
37. J. Pas, Uniform p-adic cell decomposition and local zeta functions. J. Reine Angew. Math. 399,
137–172 (1989)

586
T. Rossmann
38. T. Rossmann, Computing topological zeta functions of groups, algebras, and modules, I. Proc.
Lond. Math. Soc. (3) 110(5), 1099–1134 (2015)
39. T. Rossmann, Computing topological zeta functions of groups, algebras, and modules, II.
J. Algebra 444, 567–605 (2015)
40. T. Rossmann, Topological representation zeta functions of unipotent groups. J. Algebra 448,
210–237 (2016)
41. T. Rossmann, Computing local zeta functions of groups, algebras, and modules. Trans. Am.
Math. Soc. (2017). https://doi.org/10.1090/tran/7361
42. T. Rossmann, Enumerating submodules invariant under an endomorphism. Math. Ann. 368(1–
2), 391–417 (2017)
43. T. Rossmann, Stability results for local zeta functions of groups algebras, and modules. Math.
Proc. Camb. Philos. Soc. 1–10 (2017). https://doi.org/10.1017/S0305004117000585
44. T. Rossmann, Zeta, Version 0.3.2 (2017). See http://www.math.uni-bielefeld.de/~rossmann/
Zeta/
45. J.-P. Serre, Lectures on NX .p/. Chapman & Hall/CRC Research Notes in Mathematics, vol. 11
(CRC Press, Boca Raton, FL, 2012)
46. A. Shalev, Applications of some zeta functions in group theory, in Zeta Functions in Algebra
and Geometry (American Mathematical Society, Providence, RI, 2012), pp. 331–344
47. R. Snocken, Zeta functions of groups and rings, Ph.D. thesis, 2012. See http://eprints.soton.ac.
uk/id/eprint/372833
48. L. Solomon, Zeta functions and integral representation theory. Adv. Math. 26(3), 306–326
(1977)
49. A. Stasinski, C. Voll, Representation zeta functions of nilpotent groups and generating
functions for Weyl groups of type B. Am. J. Math. 136(2), 501–550 (2014)
50. A. Stasinski, C. Voll, Representation zeta functions of some nilpotent groups associated to
prehomogeneous vector spaces. Forum Math. 29(3), 717–734 (2017)
51. W.A. Stein et al., Sage Mathematics Software (Version 7.4). The Sage Development Team
(2016). Available from http://www.sagemath.org/
52. A.N. Varchenko, Zeta-function of monodromy and Newton’s diagram. Invent. Math. 37(3),
253–262 (1976)
53. W. Veys, W.A. Zúñiga-Galindo, Zeta functions for analytic mappings, log-principalization of
ideals, and Newton polyhedra. Trans. Am. Math. Soc. 360(4), 2205–2227 (2008)
54. O. Villamayor, Constructiveness of Hironaka’s resolution. Ann. Sci. Éc. Norm. Supér. (4)
22(1), 1–32 (1989)
55. C. Voll, Functional equations for zeta functions of groups and rings. Ann. Math. (2) 172(2),
1181–1218 (2010)
56. C. Voll, A newcomer’s guide to zeta functions of groups and rings, in Lectures on Proﬁnite
Topics in Group Theory (Cambridge University Press, Cambridge, 2011), pp. 99–144
57. C. Voll, Zeta functions of groups and rings—recent developments, in Groups St Andrews 2013
(University of St Andrews, St Andrews, 2015), pp. 469–492
58. C. Voll, Local functional equations for submodule zeta functions associated to nilpotent
algebras of endomorphisms. Int. Math. Res. Not. (2017). https://doi.org/10.1093/imrn/rnx186
59. E. Witten, On quantum gauge theories in two dimensions. Commun. Math. Phys. 141(1), 153–
209 (1991)
60. L. Woodward, Zeta functions of groups: computer calculations and functional equations, Ph.D.
thesis, 2005

On Decomposition Numbers of Diagram
Algebras
Armin Shalile
Abstract In this paper, we survey an algorithm which determines the decompo-
sition numbers of the partition algebra, Brauer algebra and walled Brauer algebra
over a ﬁeld of characteristic 0. The algorithm is based on the action of a set of
distinguished elements of the algebra, the so-called Jucys-Murphy elements. We
also outline the proof which is remarkably uniform.
Keywords Diagram algebras • Cellular algebras • Decomposition matrices
Subject Classiﬁcations 20C30, 20G05
1
Introduction
Diagram algebras denotes a class of algebras which among others encompass
Brauer, Temperley-Lieb and partition algebras. They often arise in the context of
generalizations of Schur-Weyl duality, a correspondence which classically relates
the representation theory of the symmetric and the general linear group [28]. For
example Brauer algebras play the role of the symmetric group in this correspon-
dence when the general linear group is replaced by the orthogonal or symplectic
group. Hence diagram algebras are a very important tool but they are also interesting
in their own right. They display a rich and interesting structure, for example they
usually admit a cellular structure [10] and are even cellularly stratiﬁed [13].
In this paper, we survey the determination of decomposition numbers of three
important diagram algebras over certain ﬁelds using a family of commuting
elements, the so called Jucys-Murphy elements. The diagram algebras we consider
are the partition algebra, the Brauer algebra and the walled Brauer algebra. Each
A. Shalile ()
Institute for Algebra and Number Theory, University of Stuttgart, Pfaffenwaldring 57,
70569 Stuttgart, Germany
e-mail: shalile@mathematik.uni-stuttgart.de; a.shalile@googlemail.com
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_26
587

588
A. Shalile
of these algebras has a quotient isomorphic to a symmetric group algebra and the
ﬁelds we consider are such that this quotient is semisimple. Various approaches to
this problem, mostly for the easier characteristic 0 case, exist, see [5, 20, 21]. But
also ﬁrst attempts at the more difﬁcult case of positive characteristic case have been
made, see [17] for the partition algebra and [14] and [15] where Schur algebras of
Brauer algebras are studied thus providing further insights into the decomposition
number problem. The striking feature of the approach presented here is that the
description and to a large extent also the proofs are very similar for each of these
algebras. This indicates that the approach might also be adapted to other diagram
algebras and that there might be a more general way to prove it for a large class
of diagram algebras simultaneously. Because of the description in terms of Jucys-
Murphy elements, the approach is also in principle compatible with the afﬁne
setting, for example for afﬁne cellular algebras [18].
The similarity of the representation theory of different diagram algebras has been
frequently exploited, a particularly fruitful strategy being to lift results from the
symmetric group. For example in the case of the Brauer algebra, ordinary character
theory [27], modular character theory [29], Murphy bases [8, 25], permutation and
Young modules [12] as well as a description of the center in terms of conjugacy
class sums [30] have been studied. Some of this theory was even studied for various
diagram algebras at the same time [13, 23, 26].
Throughout this paper, we work over a ﬁeld F of characteristic 0 bearing in
mind, however, that the approach works with some modiﬁcations in the case of
large enough ﬁnite characteristic. Here, large enough means larger than the degree
(deﬁned below) of the underlying diagram algebra. Let A be either the partition
algebra, Brauer or walled Brauer algebra. Each of these algebras is cellular by
[10] and therefore comes equipped with a set of distinguished modules, called cell
modules and denoted by ./ for some label . The decomposition matrix records
the composition factors for each such cell module. Just as the symmetric groups, the
algebras in question over different degrees form a nested family of algebras and in
particular algebras of higher degrees contain algebras of lower degrees. The main
technique which we will employ is to exploit reﬁned versions of restriction of cell
modules to family members of smaller degrees. This yields a combinatorial object
called tableau which essentially are paths in a tree with vertices labelled by cell
modules and an edge between cell modules if one of the cell modules occurs as
a summand in the restriction of the other cell module. The key for decomposition
numbers is that there is a set of distinguished elements called Jucys-Murphy (JM)
elements for each such algebra which induce colourings of the edges of the graph
which determines decompositions numbers: A module L./ is a composition factor
of ./ if and only if there are tableaux for ./ and ./ with the same colouring
at each level. Some restriction for  and  are necessary here (see Theorem 4.7 for
an exact statement) but nevertheless this methods yields all decomposition numbers.
This paper is structured as follows. After the deﬁnition of the diagram algebras in
question, we collect some well-known properties in Sect. 3 and deﬁne tableaux, JM
elements and the “action” of JM elements on tableaux, see Sect. 4. This will already
sufﬁce to state the main result, Theorem 4.7. Before we give a sketch of the proof of

On Decomposition Numbers of Diagram Algebras
589
the theorem in Sect. 6, we explain a convenient way to check the conditions stated
in the main theorem in Sect. 5.
2
Deﬁnition of the Algebras in Question
Throughout this paper, let F be a ﬁeld of characteristic 0 and ﬁx a parameter ı 2 F.
2.1
Deﬁnition of Partition Algebras
Partition algebras were introduced by Paul Martin [19] for the study of the Potts
model in statistical mechanics and independently by Jones [16]. The partition
algebra Pr.ı/ of degree r 2 N with parameter ı has a basis consisting of set
partitions of the set f1; 10; 2; 20; : : : ; r; r0g which are visualized diagrammatically
as partition diagrams. A partition diagram is a 2  r array of dots, which are
labelled 1; : : : ; r in the top row and 10; : : : ; r0 in the bottom row. We connect dots
by edges in such a way that the connected components are precisely the blocks of
a partition and a minimal number of edges is used. Notice that this is not unique.
For example, the diagram
represents the set
partition ff1; 3; 4; 30; 50g; f2; 60g; f40g; f5; 6; 10; 20gg.
We can deﬁne a multiplication on partitions diagrammatically by a process called
concatenation. To concatenate two partition diagrams a and b, we write a on top of
b and identify adjacent rows. The concatenation a ı b is the diagram obtained from
this construction by deleting all connected components which are not connected to
the top or bottom row and premultiplying the resulting diagram with a power of
the parameter where the exponent of the parameter counts the number of connected
components deleted. An example of this process is given in Fig. 1.
The partition algebra Pr.ı/ has a subalgebra Pr1=2.ı/ which is spanned by all
diagrams where r and r0 belong to the same block of the partition. The algebra
Fig. 1 An example of concatenation

590
A. Shalile
Pr1=2.ı/ in turn contains the partition algebra Pr1.ı/ as a subalgebra where we
identify Pr1.ı/ with the subalgebra spanned by all partitions in which fr; r0g is a
block. Thus we get a chain of subalgebras
P1=2.ı/ 	 P1.ı/ 	 P3=2.ı/ 	 P2.ı/ 	 : : : 	 Pr.ı/:
The half integer degree partition algebras are in fact Morita equivalent to full
integer degree partition algebras:
Theorem 2.1 (Proposition 5 of [20]) There is an equivalence T between the
module categories of PrC1=2.ı/ and Pr.ı  1/.
2.2
Deﬁnition of Brauer Algebras
Brauer algebras were introduced by Richard Brauer in order to generalize Schur-
Weyl duality to the orthogonal and symplectic groups [2]. The Brauer algebra is
deﬁned in a similar fashion as the partition algebra, except that we only allow a
subset of the partition diagrams, namely Brauer diagrams. By a Brauer diagram on
2r (r 2 N) dots we mean a 2  r-array of dots such that each dot is connected by
an edge to exactly one other dot distinct from itself. An example of a diagram on 16
dots is
Deﬁnition 2.2 The Brauer algebra is the subalgebra of the partition algebra
spanned by Brauer diagrams.
2.3
Deﬁnition of Walled Brauer Algebras
The walled Brauer algebra was introduced in [1] for the study of Schur-Weyl duality
for the so called mixed tensor space, see [1] for details. It is a subalgebra of the
Brauer algebra spanned by walled Brauer diagrams. Let r; s 2 N. A walled Brauer
diagram on 2.r C s/ dots is a Brauer diagram on 2.r C s/ dots with a vertical wall
between columns r and r C 1 such that
1. No through arc may intersect the wall.
2. All horizontal arcs must intersect the wall.
In this deﬁnition, a horizontal arc is an edge connecting dots in the same row
and a through arc is an edge which connects dots in the top and bottom row. The

On Decomposition Numbers of Diagram Algebras
591
subalgebra of Br.ı/ spanned by all walled Brauer diagrams on 2.rCs/ dots is called
the walled Brauer algebra and denoted Br;s.ı/.
Example 2.3 The following are examples of walled Brauer diagrams where the wall
is indicated by a dotted line:
3
Simple Modules and Cellularity
All algebras treated here are cellular algebras in the sense of Graham and
Lehrer [10].
Theorem 3.1 ([6, 10, 33]) The Brauer, walled Brauer and partition algebras are
cellular for all choices of r; s and ı.
The concept of a cellular algebra is very useful as it reduces many questions about
the algebra to problems in linear algebra (which does not mean that they become
trivial or easy). In particular, cellular algebras come equipped with a natural class
of modules, called cell modules. The simple modules occur as simple heads of a
subset of the cell modules and the radical of these cell modules can be explicitly
described by a bilinear form. In this way, the dimension of simple modules can
be obtained by computing the ranks of Gram matrices associated with the bilinear
form. There is, however, no general method to compute decomposition numbers for
cellular algebras.
In order to describe the cellular structure in more detail, we ﬁrst need to recall
some deﬁnitions: A partition of a natural number n is a tuple  D .1; 2; : : : ; k/
such that i 2 N, i  iC1 for i D 1; : : : ; k  1 and Pk
iD1 i D n. Each i is
called a part of  and the natural number k is called the number of parts of . We
occasionally view the partition  as .1; 2; : : : ; k; 0; 0; : : :/. We consider  D ;
the unique partition of 0.  is called p-singular if there is j  k  p C 1 such that
j D jC1 D jCp1 and p-regular otherwise. For p D 0 all partitions are considered
p-regular.
Theorem 3.2 ([6, 10, 33]) The labelling set  of the cell modules is given as
follows:
1. In case of the partition algebra Pr.ı/,  is the set of partitions of non-negative
integers l  r.
2. In case of the half partition algebra PrC1=2.ı/,  is also the set of partitions of
non-negative integers l  r.
3. In case of the Brauer algebra Br.ı/,  is given by the partitions of r  2t where
t 2 N0 with r  2t  0.

592
A. Shalile
4. In case of the walled Brauer algebra Br;s.ı/, is given by the set of all ordered
tuples .; 0/ with  a partition of r  l  r and 0 a partition of s  l  s for
some non-negative integer l.
The following is well known and implies among other things that the algebras are
even quasi-hereditary in the cases we consider:
Theorem 3.3 ([6, 10, 33]) When F is a ﬁeld of characteristic 0, then, for each of
the algebras of the previous theorem,  coincides with the set of simple modules
except (a) in the case of the Brauer algebra Br.0/ with r even and (b) in the case of
the partition algebra with ı D 0, in both of which cases the empty partition has to
be excluded.
We will abuse notation slightly and denote both the cell modules and their simple
heads by r./ and Lr./, respectively, for  2 , keeping in mind that in Case
(a) and (b) of the previous theorem, there is no simple module labelled by the
empty partition. Furthermore, we will omit indices and simply write ./ and L./,
respectively, when the parameters are clear from the context. In case of the walled
Brauer algebra, we write .; 0/ for the cell and L.; 0/ for the simple module
labelled by .; 0/ 2 . Sometime we will abuse notation and omit the 0 to unify
statements.
One aim of this paper is to understand the composition factors of the cell modules
./. We denote by d D Œ./ W L./ the composition multiplicity of the simple
module L./ in the cell module ./. The decomposition matrix D is the matrix
with rows and columns labelled by  and entry .; / equal to d. The following
theorem follows from [13]:
Theorem 3.4 (Proposition 6.1 and Corollary 6.2 in [13]) Let DA denote the
decomposition matrix of the cellular algebra A. There is an ordering of cell and
simple modules such that
1. DPd.ı/ D
 DFSr
0

DPd1.ı/

where d 2 fr; r C 1=2g.
2. DBr.ı/ D
 DFSr
0

DBr2.ı/

:
3. DBr;s.ı/ D
DF.SrSs/
0

DBr1;s1.ı/

:
Remark 3.5 It is well known that each of the algebras we consider contain an ideal
such that the algebra modulo this ideal is isomorphic to the symmetric group algebra
FSr or F.SrSs/, respectively. The simple module labelled by a partition  of r (and
0 a partition of s in the case of the walled Brauer algebra) are then inﬂated simple
modules (also called Specht modules S./) for the symmetric group algebra. We
sometimes refer to these partitions (or pairs of partitions) as maximal partitions.
One important corollary of this theorem is that in order to understand all decom-
position numbers, it is enough to understand the composition factors corresponding
to partitions of maximal size (in the sense of the previous remark).

On Decomposition Numbers of Diagram Algebras
593
We will usually identify a partition with its Young diagram. Thus, we will speak
of addable and removable boxes of a partition: These are boxes of the Young
diagram of  such that adding or removing this box will still yield a partition. If the
box is , then we denote the newly created partition by C and , respectively.
We denote by add  and rem  the set of addable and removable boxes of . The
content of a box  which is in row i and column j of the Young diagram is deﬁned
to be c./ D j  i.
Adding and removing boxes of a Young diagram are intimately connected with
induction and restriction of cell modules, which are deﬁned as follows:
Deﬁnition 3.6 Let Ad be equal to Pr.ı/, PrC1=2.ı/, Br.ı/ or Br;s.ı/ and Ad1 be
equal to Pr1=2.ı/,Pr.ı/, Br1.ı/ or Br1;s (or Br;s1 if r D 0), respectively. Then
resd W Ad-mod ! Ad1-mod denotes the restriction functor of Ad-modules to Ad1-
modules and indd W Ad-mod ! AdC1-mod denotes the induction functor of Ad-
modules to AdC1-modules, that is, given an Ad-module M, we set inddM D AdC1˝Ad
M.
The induction and restriction of cell modules is quite well understood:
Theorem 3.7 ([4, 7, 31]) Suppose F is a ﬁeld of characteristic 0. Then the following
sequences are exact
1. In the case of the partition algebra Pr.ı/,
0 !
M
2rem./
r1=2.  / ! resr./ ! r1=2./ ! 0:
2. In the case of the half partition algebra PrC1=2.ı/,
0 ! r./ ! resrC1=2./ !
M
2add./
r. C / ! 0:
3. In the case of the Brauer algebra,
0 !
M
2rem./
.  / ! res./ !
M
02add./
. C 0/ ! 0:
4. In the case of the walled Brauer algebra Br;s.ı/ with r > 0,
0 !
M
2rem./
.  ; 0/ ! res.; 0/ !
M
02add.0/
.; 0 C 0/ ! 0:
5. In the case of the walled Brauer algebra B0;s.ı/,
res0;s.;; 0/ D
M
2rem.0/
0;s1.;; 0  /:

594
A. Shalile
Here we adopt the convention that ./ D 0 whenever  … . In particular, the
decomposition is multiplicity free in each case.
Remark 3.8 Similar statements for induction are also known and follow essentially
from adjointness of induction and restriction.
4
Jucys-Murphy Elements and Gelfand-Zetlin Basis
The multiplicity freeness of restriction in the previous section guarantees the
existence of a natural basis for cell modules, sometimes called Gelfand-Zetlin
basis, which we will now deﬁne. In the semisimple case, a restriction of a cell
module ./ to the family member in the next lowest degree yields a direct sum
decomposition of cell modules L .i/ in which no cell module occurs twice.
Repeating this with the cell modules .i/ in the decomposition, we receive yet
another multiplicity free decomposition. This deﬁnes a tree sometimes also called
Bratelli diagram which has levels corresponding to degrees of the diagram algebras
and vertices at level k labelled by simple modules of the family member in degree
k and an edge from a vertex i in level k to a vertex j at the next lowest level
precisely when .j/ occurs as a direct summand in the restriction of .i/. The
paths from top to bottom of such a graph are called tableaux. This iterated restriction
ultimately yields a unique direct sum decomposition into 1-dimensional subspaces
because if we decrease the degree within the family, we eventually end up with
a ﬁeld. The paths in the Bratelli diagram therefore label this basis in a natural way
which is unique up to scalar multiples. The construction of the basis heavily relies on
the semisimplicity of the algebra in question. Nevertheless we will use the vectors
fvtg of this basis and especially the tableaux t labelling it in the non-semisimple
case as well. This can be done by exploiting the fact that the algebras treated
here are generically semisimple and we can pass to the ﬁeld F we are working
with by specializing the parameter. The problem is that, in general, there will be
denominators which become zero when specializing the parameter which can be
avoided by multiplying vt with the least common multiple of the denominators
occurring. Notice that the Gelfand-Zetlin basis is also only deﬁned up to scalar
multiples. However, it should be noted that the vectors fvtg potentially become
linearly dependent after specialization.
With our knowledge of restriction, we can also deﬁne the notion of a tableau
directly as follows:
Deﬁnition 4.1 A tableau t of a partition  (or .; 0/ in case of Br;s.ı/) is a sequence
of partitions (or pairs of partitions)
1. .t1=2 D ;; t1; t3=2; : : : ; td D / for Pd.ı/ with d 2 fr; r C 1=2g,
2. .t0 D ;; t1; : : : ; tr D / for Br.ı/,
3. .t0 D .;; ;/; t1 D .t1
L; t1
R/; t2 D .t2
L; t2
R/; : : : ; trCs D .; 0// for Br;s.ı/,

On Decomposition Numbers of Diagram Algebras
595
such that for all k 2 N (or k 2 1
2N in case of Pr.ı/ and PrC1=2.ı/)
1. tk D
(
tk1=2ortk1=2 C 
if k 2 N
tk1=2or tk1=2  
if k … N
;
2. tk D tk1 C  or tk D tk1  ;
3. tk D
(
.tk1
L
; tk1
R
C /
if k  s
.tk1
L
C ; tk1
R
/or .tk1
L
; tk1
R
 /
if k > s
;
respectively. Here,  is an addable or removable box, respectively, of the appropriate
partition. We will sometimes refer to the transition from tk1 to tk by adding or
removing a box at the kth step of t.
The set of tableaux of a given partition  2  is denoted by Tab./ (the degree
will always be clear from the context).
Example 4.2 Examples of tableaux are:
1. For the partition algebra of degree d D 4 C 1=2,
u D

;;
;
;
;
;
;
;
;

;
t D

;;
;
;
;
;
;
;
;

:
2. For the Brauer algebra with r D 4,
u D

;;
;
;
;

;
t D

;;
;
;
;

:
3. For the walled Brauer algebra with .r; s/ D .3; 2/,
u D

.;; ;/;

;;

;

;;

;

;

;

;

;

;

;

;
t D

.;:;/;

;;

;

;;

;

;

;

;

;

;

;

:
The missing ingredient for the determination of decomposition numbers are a
distinguished family of elements of the algebras we are considering, the so called
Jucys-Murphy elements or sometimes just called Murphy elements. This is a family
of elements fLkgk2I where the indexing set I is N in the Brauer and walled Brauer
algebra case and 1=2N in the partition algebra case. Their exact deﬁnition will

596
A. Shalile
not be important and we refer the reader to the papers [11, Section 3], [24] and
[4, Equations (2.19) and (2.20)]. However, they have some properties which are
important for us:
Theorem 4.3 ([4, 11, 24])
1. The JM elements fLkgk2I commute with each other.
2. The JM element Lk commutes with Pk1=2.ı/, Bk1.ı/ and B0;k1.ı/ (if k < s) or
Bks;s.ı/ (if k  s).
3. The elements of the Gelfand-Zetlin basis are eigenvectors for all Lk.
The last property will precisely give rise to the colouring of the tableaux which
was mentioned in the introduction: Each tableau t can be coloured at step k by
the eigenvalue Lk.t/ by which the JM element Lk acts on the Gelfand-Zetlin basis
element labelled by this tableau. The eigenvalues Lk.t/ have been determined:
Theorem 4.4 ([4, 11, 24])
1. For the partition algebra, we have
Lk.t/ D
8
ˆˆˆˆ<
ˆˆˆˆ:
c./
if tk D tk1=2 C ; k 2 N
ı  jtkj
if tk D tk1=2; k 2 N
ı  c./
if tk D tk1=2  ; k … N
jtkj
if tk D tk1=2; k … N
:
2. For the Brauer algebra, we have
Lk.t/ D
(
c./
if tk D tk1 C 
1  ı  c./
if tk D tk1  
:
3. For the walled Brauer algebra, we have
Lk.t/ D
(
c./
if a box was added at the kth step of t
ı  c./
if a box was removed at the kth step of t
:
Deﬁnition 4.5 Let  2 . The weight wt.t/ of a -tableau t is deﬁned to be the
tuple
.L1=2.t/; L1.t/; L3=2.t/; : : : Ld.t// (for Pd.ı/ with d D r or d D r C 1=2) or
.L0.t/; L1.t/; : : : Ld.t// (in the Brauer/walled Brauer case with d D r or d D r C s).
We say that ;  2  have a common JM weight if there is a -tableau u and a
-tableau t with wt.u/ D wt.t/.

On Decomposition Numbers of Diagram Algebras
597
Example 4.6 The following examples show how to represent a tableau together
with its weight by a coloured graph:
1. For the partition algebra:
u W ;
0
1
1
2
1
3
2
4
;
t W ;
0
1
1
2
1
3
ı3
ı1
:
If we consider the case ı D 5, then the tableau u and t have the same weight.
Thus, .3; 1/ and .1; 1/ have a common JM weight. Furthermore, one can prove
that Œ.1; 1/ W L.3; 1/ ¤ 0.
2. For the Brauer algebra:
u W

;
0
1
1
2

;
t W

;
0
1
1
1ıC1

:
From this we can read off that wt.t/ D .1; 1; 2/ and wt.u/ D .1; 1; 2  ı/.
Thus, if ı D 0, then .3; 1/ and .1; 1/ again have a common JM weight. At the
same time, it is known that Œ.1; 1/ W L.3; 1/ ¤ 0 with the chosen value of ı.
3. For the walled Brauer algebra:
u W .;; ;/
0 
;;
 1

;;

0

;

1

;

1

;

;
t W .;; ;/
0 
;;
 1

;;

0

;

1

;

ıC1 
;

:
Again for ı D 2 the tableau u and t have the same weight. Thus, ..2; 1/; .1; 1//
and ..2/; .1// have a common JM weight and at the same time Œ ..2/; .1// W
L ..2; 1/; .1; 1// ¤ 0.
The fact that having a common JM weight is related to a non-zero decomposition
number is not a coincidence and this is precisely the main theorem:
Theorem 4.7 If  is a partition of r, 0 is a partition of s and  2  (or .; 0/ 2
), then L./ (or L.; 0/) is a composition factor of ./ (or .; 0/) if and only
if there is a -tableau (or .; 0/-tableau) u and a -tableau (or .; 0/-tableau) t
with wt.u/ D wt.t/ and, in the case of the Brauer algebra only, the tableau u and
t have to be strongly balanced (see Section 5 of [32] for the deﬁnition of strongly
balanced).

598
A. Shalile
Remark 4.8 As we remarked earlier, the statement above actually sufﬁces to
determine the entire decomposition matrix by Theorem 3.4 and the fact that
decomposition numbers are always zero or one in the cases we consider, see
Corollary 4.10.
The fact that the previous statement can be formulated in such a uniﬁed way
is probably not a coincidence. We will see later that to a large extent (modulo
some combinatorial input), even the proof of the statement is quite uniform. Notice
that one quite easily obtains one direction of our main theorem which is proved in
Corollary 2.2 in [32] in a more general context.
Proposition 4.9 Let ;  2  and suppose L./ is a composition factor of ./.
Then  and  have a common JM weight. If  is a partition of r (and 0 a partition
of s in the walled Brauer case), then for every -tableau u there is a -tableau t
with wt.u/ D wt.t/.
For the complete determination of decomposition numbers, we also have to show
that decomposition multiplicities must always be either 0 or 1:
Corollary 4.10 Let ;  2  with  a partition of r (and 0 a partition of s).
Then:
(a) If  and  have a common JM weight, then for every -tableau u there is
precisely one -tableau t with wt.u/ D wt.t/.
(b) Œ./ W L./ 2 f0; 1g.
Proof The ﬁrst part was proved for the partition algebra in Corollary 2.12 of [31]
and for the Brauer algebra in Lemma 3.2 of [32]. The proof for the walled Brauer
algebra is almost identical. We need to simply replace  by .; 0/,  by .; 0/
and 1  ı by ı in the proof. The proof only uses arrow diagrams (which will
be introduced in the next section) and the action of adding/removing boxes with
the same induced JM eigenvalue is the same for the two algebras, as we will see
in Fig. 2. The only difference is that there is no left corner for the walled Brauer
algebra since the arrow diagram is doubly inﬁnite in this case. This further restricts
the number of cases we have to consider in the proof making it actually shorter.
The second part is immediately implied by the ﬁrst since if Œ./ W L./ > 1,
then ./ would contain at least two copies of the simple module L./ D ./.
Therefore, the generalized eigenspace corresponding to wt.t/ contains at least two
linearly independent elements implying that for every -tableau u, there would be at
least two different -tableau of the same weight, see also the proof of Corollary 3.5
in [32].
ut
5
Checking for a Common JM Weight
Theorem 4.7 gives quite a nice description of decomposition numbers, however,
checking the conditions of the theorem is rather computationally involved. It
requires us in principle to compute all possible tableaux, all colourings and then

On Decomposition Numbers of Diagram Algebras
599
to look for matching weights. It turns out that there is a much more efﬁcient way to
do so. It is based on developing a diagrammatic way to represent the main operations
involved in the theorem, namely adding and removing boxes to partitions and pairs
of partitions and at the same time keeping control of the action of the JM elements.
In order to get an idea how to do this, consider the partition .6; 5; 3; 1/. Let us
draw the Young diagram and write the content into every box:
0
1
2
3
4
5

1
0
1
2
3

2

1
0

3
:
If we are just given the set of contents of the last boxes in each row (in our case
f5; 3; 0; 3g), then we can recover the partition from this data. Moreover, removing
for example the box ﬁlled with a 5 amounts to changing the content 5 in our set by
a 4 so that we get f4; 3; 0; 3g. Similarly, adding a box next to the box labelled 5
results in the set f6; 3; 0; 3g. So adding and removing boxes can be implemented
in this simple model. Notice that there can never be two boxes in the last column of
a row with the same content and this constraint coincides precisely with addable or
removable boxes. Thus, a model of our partition could be to have beads on the usual
number line and adding boxes amounts to moving beads up and removing boxes
amount to moving beads down. A bead is then addable, if there is a free space to the
right of it.
To obtain a combinatorial model of partitions adapted to each of our algebras, we
now need to consider when moving two beads amounts to the same JM eigenvalue.
For example in the Brauer case, adding a box of content i amounts to the same JM
eigenvalue as removing a box of content 1  ı  i. To keep track of such moves it is
convenient to fold the number line over in such a way that adding a box of content
i and removing a box of content 1  ı  i both amount to moving a bead from the
same column in the same direction, see examples below. This naturally leads to the
arrow diagrams which were ﬁrst deﬁned by Brundan and Stroppel in [3] and are
deﬁned as follows:
Deﬁnition 5.1 Given a partition  D .1; 2; : : :/ 2 , (where we include all zero
entries) we deﬁne its diagram or arrow diagram d./ as follows:
1. For the partition algebra, the arrow diagram consists of a doubly inﬁnite line with
positions above and below the line labelled as follows:

600
A. Shalile
Thus, opposite labels always sum to ı. For each part i of , we draw a W above
the line at the label i  i (that is, at the content of the last box of each row).
Furthermore, we draw a single V below the line at the label jj.
2. In the Brauer algebra case, we have a half inﬁnite line with positions labelled
above and below the line as follows:
Case 1:
ı odd.
Case 2:
ı even.
For each part i of  we draw at the position labelled i i a W if that position is
above the line and a V if the position is below the line. If ı is even and i  i D
 ı
2, then we only draw a W at the corresponding position above the line.
3. For the walled Brauer algebra, we draw a doubly inﬁnite line with positions
labelled above and below the line as follows:
If  D .1; 2; : : :/ with i  0, then we draw for each part i of  a W at the
position above the line labelled ii. Similarly, if 0 D .0
1; 0
2; : : :/ with 0
i  0,
then we draw for each 0
i a V below the line at position 0
i  i.
Remark 5.2 Notice that  and d./ determine each other and we will often identify
them. Furthermore, adding a box to  in some row corresponds to moving the arrow
W corresponding to that row up by 1 in the arrow diagram, that is to a position with
a higher label. Also, a box is addable if and only if the next higher position is empty
in the arrow diagram. Similar statements hold for removable boxes. We will see in
Fig. 2 that arrow diagrams are additionally particularly well behaved with respect to
the action of the JM elements.
Example 5.3 The deﬁnitions are best understood by examples.
1. In the partition algebra case, we consider the partition  D .3; 2; 2; 2; 1; 0; 0; : : :/
with ı D 8. The contents of the last boxes in each row are .2; 0; 1; 2; 4;

On Decomposition Numbers of Diagram Algebras
601
6; 7; : : :/ and jj D 10. Therefore, we get the following arrow diagram d./:
2. In the Brauer case with  D .6; 4; 3; 3; 1; 0; : : :/ and ı D 1, we get the following
diagram:
3. In the walled Brauer case, with .; 0/ D ..3; 1; 0; : : :/; .3; 0; : : :// and ı D 1,
we get
We will frequently use shorthand notation for arrow diagrams. For example,  as
in Example 5.3(1) will be represented as    
2W  W W W  W    where
W stands for a column which only contains a W, and V// represent columns
containing only a V, both a W and a V, or no arrows at all, respectively. The label
at the top/bottom of a symbol is precisely the label above/below the line in that
column and specifying one will determine all other labels. Sometimes we represent
W = V == in extended notation by
W
=
V=
W
V=
.
We will now connect the study of arrow diagrams with tableaux and the action
of JM elements. Our aim is to relate the property of having a common JM weight to
the study of composition factors of the cell modules ./. It turns out that having a
common JM weight is quite restrictive. If we view a tableau as a construction plan
for the corresponding partition, then the JM weight only leaves few possibilities for
this construction. If the kth entry of the JM weight is i, that is, the JM element Lk acts
by i on the Gelfand-Zetlin basis vector corresponding to the given tableau, then there
are only at most two possibilities which are depicted in Fig. 2. Here the boxes stand
for potential positions of V and W and the arrows indicate which way the arrows
may be moved. For example in the partition algebra, if k is not a natural number, then
we may either add a box of content i at the kth step or leave the partition unchanged
if the size of the partition in question is ı  i. If k is a natural number, then we may
either remove a box of content ı  i or leave the partition unchanged if its size is
i. The Brauer and walled Brauer algebra cases are also depicted, where we have to
distinguish the cases when the label i is above or below the line.

602
A. Shalile
Fig. 2 Possible ways to move arrows with JM eigenvalue i. (a) Pd.ı/, half to full degree. (b)
Pd.ı/, full to half degree. (c) Br.ı/, Case I. (d) Br.ı/, Case II. (e) Br;s.ı/, Case I. (f) Br;s.ı/, Case II
Using these rules we may characterize partitions with a common JM weight. The
following proposition holds for all algebras treated above except the half integer
partition algebras (where one ﬁrst has to apply the equivalence of Theorem 2.1, see
Proposition 2.9 of [31] for details):
Proposition 5.4 Suppose ;  2  have a common JM weight. Then for all k the
kth columns of d./ and d./ contain the same number of arrows (that is, counting
V and W).
Proof This is proved for the partition algebra in Proposition 2.9 of [31] and for the
Brauer algebra in Lemma 3.1 of [32]. For the walled Brauer algebra, the proof is
virtually identical as in the Brauer case and also follows immediately from Fig. 2.
In case of the partition algebra, we can easily state an exact criterion when
two tableaux have a common JM weight. In the Brauer and walled Brauer algebra
case, one ﬁrst constructs from the ordinary arrow diagram d./ a so-called cup-
curl diagram for the Brauer and a cup-cap diagram for the walled Brauer algebra,
denoted c./ and superposes this onto the arrow diagram of d./. Since we do not
need the exact criterion in this article, refer the reader to [5] for the deﬁnition of
these diagrams. Then one obtains the following result where we again leave out the
half integer partition algebra case for simplicity:

On Decomposition Numbers of Diagram Algebras
603
Theorem 5.5 Suppose ;  2  with  ¤  and  is a partition of r (and 0 is a
partition of s). Then  and  have a common JM weight if and only if
1. in the partition algebra case, the arrow diagrams d./ and d./ are the same
except for one conﬁguration of l neighbouring columns of the following form:
 W W



   


V
 W 
V 

   

W

:
2. in the case of the Brauer algebra, the superposition of the cup-curl diagram c./
on top of d./ is oriented.
3. in the case of the walled Brauer algebra, the superposition of the cup-cap
diagram c./ on top of d./ is oriented.
Proof The proof is not difﬁcult but requires us to check a lot of cases. We outline
the idea here. To show that given two partitions with a common JM weight, we get a
diagram of the required form, we use an inductive proof. We start with a diagram of
the required form and show that under moves with the same induced JM eigenvalue,
we get another diagram of the same form. We can control these moves very well,
see Fig. 2, but we have to basically check all possible forms which two adjacent
columns of a diagram can take.
For the other direction, we interpret the cup-curl or cup-cap diagram as a
construction plan for the tableau which give the common JM weight. The broad
idea is to consider the arrow diagrams of  and  and see whether it is possible to
transform them through same column moves into the same diagram. We refer the
reader to the proof of Theorem 6.4 in [32] for details. Notice that the walled Brauer
algebra case is a subcase of the Brauer algebra case because the proof again only
uses graphical calculus.
6
On the Proof of Theorem 4.7
We have to show that if  and  have a common JM weight with  of maximal size,
then L./ is a composition factor of ./. We will achieve this by an induction
on the length of a tableau. If we have a -tableau u and a -tableau t of the same
weight and length k, say, then certainly the partitions (or pairs of partitions) uk1
and tk1 have a common JM weight. The idea is to lift the induced homomorphism
by using induction functors. In order to keep more control in the induction process,
we ﬁrst “factor” the induction functor, as we will see in the next deﬁnition which is
completely analogous to 6.4 of [22]. For that deﬁnition, let d 2 fr; r C 1=2; .r; s/g
(depending on whether we are in the full partition algebra/Brauer algebra, half
partition algebra or walled Brauer algebra case) and d0 be equal to either d  1=2
(partition algebra), d  1 (Brauer algebra), d  .1; 0/ (walled Brauer algebra with

604
A. Shalile
r > 0) or d  .0; 1/ (walled Brauer algebra with r D 0). Furthermore, let cn be
the sum of the JM elements up to the element Ln. The element cn is central in An
for each of the algebras in question, see [9, Theorem 3.10], [24, Corollary 2.4] and
[4, Lemma 2.1]. Therefore, the generalized eigenspaces of the action of cn on any
An-module M induce an An-module decomposition of M.
Deﬁnition 6.1 Let M be an Ad0-module whose generalized eigenspace decomposi-
tion with respect to cd0 is trivial. For i 2 Z, deﬁne i-indd0 M to be the projection
onto the generalized eigenspace of the action of the JM-element Ld on indd0M
with eigenvalue i. Similarly, for an Ad-module M whose cd generalized eigenspace
decomposition is trivial, we set i-resd M to be the generalized eigenspace of the
action of the JM-element Ld0 on resdM with eigenvalue i. Extend this deﬁnition to
arbitrary Ad0-modules and Ad-modules, respectively, by ﬁrst decomposing them into
generalized eigenspaces with respect to cd0 and cd, respectively, and then applying
i-ind and i-res, respectively, to each summand. We usually omit d and d0 if they are
clear from the context.
Remark 6.2
1. Notice that the deﬁnition of the i-induction map is well-deﬁned since it is
equivalent to ﬁrst decomposing a module into generalized eigenspaces with
respect to the central element cd0, then inducing to Ad and ﬁnally decomposing
into generalized eigenspaces with respect to the central element cd since cd 
cd0 D Ld. A similar remark holds for i-restriction.
2. Since the cell modules for the algebra An are generically simple, the central
element cn acts by a scalar multiple of the identity on them and, in particular,
their generalized eigenspace decomposition with respect to cn is always trivial.
These maps have the usual adjointness properties by exactly the same argument
as in 6.4 of [22].
Proposition 6.3 The maps
i-ind W Ad0–mod ! Ad–mod
i-res W Ad–mod ! Ad0–mod
are functorial and i-ind is a left-adjoint to i-res.
For cell modules, the following restriction rules can be deduced from Theo-
rem 3.7 by projection onto the corresponding JM weight space:
Theorem 6.4 Suppose  2  with d and d0 as before. Then there are exact
sequences as follows (where in each case we set . ˙ / D 0 if no addable/re-
movable box  with the required content exists)
1. Partition algebra:
(a) 0 ! r./ ! i-res rC1=2./ ! r. C / ! 0;
where  is an addable box of content ı  i and the term on the left is zero
unless jj D i.

On Decomposition Numbers of Diagram Algebras
605
Fig. 3 Possible ways to
move arrows when
i-restricting. (a) Half to full
degree. (b) Full to half
degree. (c) (Walled) Brauer
algebra I. (d) (Walled) Brauer
algebra II
(a)
(b)
(c)
(d)
(b) 0 ! r1=2.  / ! i-res r./ ! r1=2./ ! 0;
where  is a removable box of content i and the term on the right is zero
unless jj D ı  i.
2. Brauer algebra:
where  is a removable box of  of content i and 0 is an addable box of  of
content 1  ı  i.
3. Walled Brauer algebra:
a. If r > 0, then
b. i-res 0;s.;; 0/ Š 0;s1.;; 0  /.
where  is a removable box of  of content i and 0 is an addable box of  of
content ı  i.
Remark 6.5
1. Similar statements exist for i-induction.
2. Notice that there is always at most one addable and at most one removable box
of a given content when working over characteristic 0.
Figure 3 summarizes the theorem in a similar way as Fig. 2. Notice that the Brauer
and walled Brauer case are identical since we did not indicate the label opposite to i.

606
A. Shalile
We will also need restriction rules for simple modules. Unfortunately, we can
only describe the socle in full generality which will, however, be sufﬁcient for our
purposes. In the following theorem, we abuse notation for simplicity and write ./
instead of .; 0/. Furthermore, the symbol ? is ﬁxed for each situation and either
stands for W or .
Theorem 6.6 Consider the partition, Brauer or walled Brauer algebra over a ﬁeld
of characteristic 0. Then
1. If i-res ./ D 0, then i-res L./ D 0.
2. If i-res ./ D .0/ and i-ind .0/ D ./, then i-res L./ D L.0/.
3. Partition algebra:
a. Let C D   
iW V    2  and  D   
iV W    2 , then
i-res L.C/ D L./ and i-res L./ D 0:
b. If  D    ‹

iW
V
    2 , then the socle of i-res L./ is isomorphic to
L.   ‹

iW
V
    / ˚ L.   ‹V
i


W
    /:
4. Brauer algebra:
a. Suppose 0 2 0 (where 0 is labelling set for simples for Br1.ı/) has an
addable box  of content i and a removable box 0 of content 1  ı  i, where
these boxes need not be distinct. Set C D 0 C 2  and  D 0 0 2 .
Then
i-res L.C/ D L.0/ and i-res L./ D
(
L.0/ if  C 0 D .1; 1/
0 otherwise
:
b. Suppose we are not in case (1),(2) or (4)(a). Then  has a removable box 0
of content i and an addable box  of content 1  ı  i such that the socle of
i-res L./ is isomorphic to
L.  0/ ˚ L. C /:
5. Walled Brauer algebra Br;s.ı/ with r > 0:
a. Suppose 0 D .0
L; 0
R/ 2 0 (where 0 is labelling set for simples for
Br1;s.ı/) and 0
L has an addable box  of content i and 0
R a removable box
0 of content ı i. Set C D .0
L C; 0
R/ 2  and  D .0
L; 0
R 0/ 2 .

On Decomposition Numbers of Diagram Algebras
607
Then
i-res L.C/ D L.0/ and i-res L./ D 0:
b. Suppose we are not in case (1),(2) or (5)(a) and  D .L; R/ 2 . Then L
has a removable box 0 of content i and R has an addable box  of content
ı  i such that the socle of i-res L./ is isomorphic to
L.L  0; R/ ˚ L.L; R C /:
Remark 6.7 We did not include the case of the walled Brauer algebra Br;s.ı/ with
r D 0, since B0;s.ı/ Š FSs and the restriction rules are precisely the ordinary
branching rules for cell modules.
Proof This was proved for the partition algebra in [31, Theorem 3.3] and for the
Brauer algebra in [32, Theorem 4.5]. The proof of the walled Brauer algebra is
again almost exactly the same as the Brauer algebra case since the proof mostly
uses general properties of induction and restriction functors as well as graphical
calculus of arrow diagrams both of which are identical for both algebras. We simply
have to change 1  ı to ı, replace partitions by pairs of partitions and be careful
whether the boxes which are added and removed are done so to the left or to the
right partition in the pair. Furthermore, the corner cases all vanish and in particular,
we do not need to consider the case when the added and removed boxes form the
partition .1; 1/ as L.C/ will always be a composition factor of ./.
We are ﬁnally in a position to sketch the proof of Theorem 4.7:
Proof We have to show that if there are tableaux t 2 Tab./ and u 2 Tab./ with
wt.u/ D wt.t/ and  is a maximal partition, then Œ./ W L./ ¤ 0. The proof will
be by induction on the degree of the algebras. The result is trivially true for r D 0
(and s D 0) or r D 1=2 in the partition algebra case. Assume it holds in smaller
degrees.
We will denote by 0 and 0 the second-last entry of t and u, respectively (the last
entry of course being  and  themselves). It is possible to show that without loss
of generality, we may choose u and t in such a way that i-res ./ Š .0/ with
i D c./ where  is the box added at the last step of u, see Lemma 4.7 of [32], the
walled Brauer case being the same except that we do not even have to worry about
the critical corner.
If we just leave out the last partition in u and t, we obtain t0 2 Tab.0/ and
u0 2 Tab.0/ with wt.u0/ D wt.t0/ and 0 is of maximal size, so that by induction
assumption we have Œ.0/ W L.0/ ¤ 0. Therefore, Hom..0/; .0/=M/ ¤ 0
for some submodule M0  .0/.
Thus, there is a submodule U  .0/ with unique simple top L.0/ D .0/
(for example let U be a submodule of .0/ of minimal length which contains .0/

608
A. Shalile
as a quotient).
0 ¤ Hom.U; .0// D Hom.U; i-res .// D Hom.i-ind U; .//:
We will examine the head of i-ind U more closely.
Suppose the simple module L./ occurs in the head of i-ind U and is a
composition factor of ./. Then
0 ¤ Hom.i-ind U; L.// D Hom.U; i-res L.//:
Since L./ is a composition factor of ./,  and  have a common JM-weight.
Therefore, d./ and d./ have the same number of arrows in each column by
Proposition 5.4. Since i-res ./ Š .0/,  and hence  cannot be of the form in
Case .3/.b/; .4/.b/ or .5/.b/, respectively, of Theorem 6.6. In particular, i-res L./
is either equal to L.0/, for some partition 0 differing from  by one box, or zero.
The latter case cannot happen, since the Hom-space is non-zero. Since U has unique
simple top L.0/, we can conclude that i-res L./ D L.0/ and therefore also
0 D 0.
To prove the theorem, it will sufﬁce to show that  must be equal to . But 0
was obtained from  by moving an arrow of label i to the label i  1 and we can
therefore show the result by simply considering the possibilities for the column c of
d.0/ D d.0/ containing the label i  1. This is done in the proof of Theorem 4.1
of [31] for the partition algebra and Theorem 5.3 of [32] for the Brauer algebra.
The case of the walled Brauer algebra is again identical to the Brauer algebra case
since it is an exercise in arrow diagram calculus which is identical for both algebras
(and even simpler for the walled Brauer algebra, as there is no corner case to be
considered). Notice that in Case II of the proof of Theorem 5.3 in [32], we always
have i-res L./ D 0 in the walled Brauer case, so there is no need to distinguish
whether  C 0 D .1; 1/ or not and the proof is much shorter.
References
1. G. Benkart, M. Chakrabarti, T. Halverson, R. Leduc, C. Lee, J. Stroomer, Tensor product
representations of general linear groups and their connections with Brauer algebras. J. Algebra
166, 529–567 (1994)
2. R. Brauer, On algebras which are connected with the semisimple continuous groups. Ann.
Math. 38, 857–872 (1937)
3. J. Brundan, C. Stroppel, Highest weight categories arising from Khovanov’s diagram algebra
I: cellularity. Mosc. Math. J. 11, 685–722 (2011)
4. J. Brundan, C. Stroppel, Gradings on walled Brauer algebras and Khovanov’s arc algebra. Adv.
Math. 231, 709–773 (2012)
5. A. Cox, M. De Visscher, Diagrammatic Kazhdan-Lusztig theory for the (walled) Brauer
algebra. J. Algebra 340, 151–181 (2011)
6. A. Cox, P. Martin, A. Parker, C. Xi, Representation theory of towers of recollement: theory,
notes, and examples. J. Algebra 302, 340–360 (2006)

On Decomposition Numbers of Diagram Algebras
609
7. W.F. Doran, D.B. Wales, P.J. Hanlon, On the semisimplicity of the Brauer centralizer algebras.
J. Algebra 211, 647–685 (1999)
8. J. Enyang, Cellular bases for the Brauer and Birman-Murakami-Wenzl algebras. J. Algebra
281, 413–449 (2004)
9. J. Enyang, Jucys-Murphy elements and a presentation for partition algebras. J. Algebraic
Combin. 37, 401–454 (2013)
10. J.J. Graham, G.I. Lehrer, Cellular algebras. Invent. Math. 123, 1–34 (1996)
11. T. Halverson, A. Ram, Partition algebras. Eur. J. Comb. 26, 869–921 (2005)
12. R. Hartmann, R. Paget, Young modules and ﬁltration multiplicities for Brauer algebras. Math.
Z. 254, 333–357 (2006)
13. R. Hartmann, A. Henke, S. Koenig, R. Paget, Cohomological stratiﬁcation of diagram algebras.
Math. Ann. 347, 765–804 (2010). https://doi.org/10.1007/s00208-009-0458-x
14. A. Henke, S. Koenig, Schur algebras of Brauer algebras I. Math. Z. 272, 729–759 (2012)
15. A. Henke, S. Koenig, Schur algebras of Brauer algebras, II. Math. Z. 276, 1077–1099 (2014)
16. V.F.R. Jones, The Potts model and the symmetric group, in Subfactors (Kyuzeso, 1993) (World
Scientiﬁc Publishing, River Edge, NJ, 1994), pp. 259–267
17. O. King, Decomposition numbers of partition algebras in non-dividing characteristic. Preprint
(2013)
18. S. Koenig, C. Xi, Afﬁne cellular algebras. Adv. Math. 229, 139–182 (2012)
19. P. Martin, Temperley-Lieb algebras for nonplanar statistical mechanics—the partition algebra
construction. J. Knot Theor. Ramif. 3, 51–82 (1994)
20. P. Martin, The partition algebra and the Potts model transfer matrix spectrum in high
dimensions. J. Phys. A 33, 3669–3695 (2000)
21. P. Martin, The decomposition matrices of the Brauer algebra over the complex ﬁeld (2009).
arXiv:0908.1500
22. A. Mathas, Iwahori-Hecke Algebras and Schur Algebras of the Symmetric Group. University
Lecture Series, vol. 15 (American Mathematical Society, Providence, RI, 1999)
23. A. Mathas, Seminormal forms and Gram determinants for cellular algebras. J. Reine Angew.
Math. 619, 141–173 (2008)
24. M. Nazarov, Young’s orthogonal form for Brauer’s centralizer algebra. J. Algebra 182, 664–
693 (1996)
25. D. Nguyen, A cellular basis of the q-brauer algebra related with murphy bases of the Hecke
algebras (2013). arXiv:1302.4272
26. I. Paul, Structure theory for cellularly stratiﬁed diagram algebras, Doctoral thesis, 2016
27. A. Ram, Characters of Brauer’s centralizer algebras. Paciﬁc J. Math. 169, 173–200 (1995)
28. I. Schur, Über die rationalen Darstellungen der allgemeinen linearen Gruppe (Sitzungs-
berichte Akad., Berlin, 1927), pp. 58–75
29. A. Shalile, Conjugation in Brauer algebras and applications to character theory. J. Pure Appl.
Algebra 215, 2694–2714 (2011)
30. A. Shalile, On the center of the Brauer algebra. Algebr. Represent. Theory 16, 65–100 (2013)
31. A. Shalile, On the modular representation theory of the partition algebra. J. Algebraic Combin.
42, 245–282 (2015)
32. A. Shalile, Decomposition numbers of Brauer algebras in non-dividing characteristic.
J. Algebra 423, 963–1009 (2015)
33. C. Xi, Partition algebras are cellular. Compos. Math. 119, 99–109 (1999)

Koblitz’s Conjecture for Abelian
Varieties
Ute Spreckels and Andreas Stein
Abstract Consider a principally polarized abelian variety A of dimension d deﬁned
over a number ﬁeld F. If p is a prime ideal in F such that A has good reduction at
p, let Np be the order of A mod p. We have formulae for the density p` of primes p
such that Np is divisible by a ﬁxed prime number ` in two cases: A is a CM abelian
variety and the CM-ﬁeld is contained in F, or A has trivial endomorphism ring and
its dimension is 2, 6 or odd. In both cases, we can prove that CA D Q
`
1p`
11=` is
a positive constant. We conjecture that the number of primes p with norm up to n
such that Np is prime is given by the formula CA
n
d log.n/2 , generalizing a formula by
N. Koblitz, conjectured in 1988 for elliptic curves. Numerical evidence that supports
this conjectural formula is provided.
Keywords Abelian varieties over ﬁnite ﬁelds • Galois representations • General
symplectic group over a ﬁnite ﬁeld • Serre’s open image theorem • Torsion points
of abelian varieties
Subject Classiﬁcations 11G10, 11N05, 11F80, 11G20
1
Introduction
Let A be a principally polarized abelian variety of dimension d deﬁned over a
number ﬁeld F with absolute Galois group GF. Denote by p a prime ideal of F
of inertia degree 1 such that A has good reduction at p. Let p be the order of the
residue ﬁeld of p. Consider Np D # NA.Fp/ to be a random variable depending on p
where NA D A mod p. A random integer in the size of pd  # NA.Fp/ is prime with
U. Spreckels • A. Stein ()
Institut für Mathematik, Carl von Ossietzky Universität Oldenburg, 26111 Oldenburg, Germany
e-mail: ute.spreckels@uni-oldenburg.de; andreas.stein@uni-oldenburg.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_27
611

612
U. Spreckels and A. Stein
probability .d log.p//1 by the prime number theorem. Hence if Np were random,
there would be about
X
pn
1
d log.n/ 
n
d log.n/2
(1)
primes p with norm less than n such that Np is prime. However, the orders Np do not
behave like random integers in respect to primality.
For every prime number `, the action of Galois automorphisms on torsion points
of A induces a representation of GF on Aut.AŒ`/ Š F2d
` . Since A is principally
polarized, the Galois action respects the symplectic Weil pairing on A, thus there is
a representation
` W GF ! GSp2d .F`/ :
The ﬁxed ﬁeld of the kernel of ` is called the `-division ﬁeld of A. Its Galois group
is denoted by G`. Let p j p be a prime ideal of F such that A has good reduction at p.
It is known that the order of the group of Fp-rational points on A mod p is divisible
by ` if and only if the Frobenius in G`, represented in GSp2d .F`/, has eigenvalue
1 [11, Lem. 2.1]. If we denote by p` the density of prime ideals p of F such that
` j # NA.Fq/, then Chebotarev’s density theorem yields that p` equals the proportion
of Galois automorphisms in G` that have eigenvalue 1.
As ﬁrst realized by Koblitz [4], p` can be used to improve the estimate (1). Let
CA D
Y
` prime
1  p`
1  1=`:
Based on (1) we conjecture that there are about
CA
X
pn
1
d log.n/  CA
n
d log.n/2
(2)
primes p with norm less than n such that Np is prime. We expect the conjecture to
hold true in case that the events ` j Np, where ` is any prime number, are mutually
independent. The elliptic curve version of this conjecture can be found in Koblitz’s
paper [4], a dimension 2 version in [11, Conj. 4.1] and the generalized conjecture
in [6, Conj. 1.3]. Koblitz presented examples of elliptic curves over Q supporting
this conjecture for d D 1. Zywina noticed that the Koblitz conjecture is false if
one does not ensure that the events ` j Np are mutually independent [12]. In case
that dependencies occur, the constant CA cannot be the product of probabilities as
above. Zywina presented an example of an elliptic curve where Koblitz’s original
conjecture actually fails and thus suggested reﬁnements for CA [12, Section 2.1].
Besides, he extended Koblitz’s conjecture to elliptic curves deﬁned over number
ﬁelds [12, Conj. 1.2]. We do not know of any counterexample of (2) for d > 1.

Koblitz’s Conjecture for Abelian Varieties
613
It is an interesting problem to ﬁnd abelian varieties such that the events ` j Np are
dependent. However, we do not consider this situation. From now on, we therefore
assume that the events ` j Np are independent and work with CA as deﬁned above.
In case that A has CM, the Galois group of the `-division ﬁeld can be embedded in
a maximal torus in the general symplectic group GSp2d .F`/. We obtained a formula
for p` by a matrix counting technique in [6]. This led us to the following theorem.
Theorem 1.1 Let A be a principally polarized abelian variety of arbitrary dimen-
sion d deﬁned over a number ﬁeld F such that A has CM by a CM-ﬁeld K  F.
For a prime number `, let G` be the Galois group of the `-division ﬁeld of A and
assume that G` is isomorphic to a maximal torus of GSp2d .F`/ for almost all prime
numbers `. Then CA D Q
` prime
1p`
11=` is a positive constant.
Proof See [6], Main Theorem 1.2.
ut
The formula for CA that can be found in [6] does not depend on A itself but only
on its CM-ﬁeld. Hence it is reasonable not to consider a single abelian variety but
every abelian variety that has CM by a ﬁxed CM-ﬁeld at once to test the conjectural
formula (2). The conjecture provides us with a prediction of how many of the orders
Np are prime. To check this prediction we thus have to determine the number of
points of abelian varieties over various ﬁnite prime ﬁelds. We were able to avoid
long-lasting computations by exploiting the fact that there is a bijection
Ap;K $ fŒw j w 2 OK; w Nw D p; Q.w/ D Kg
sending ŒA to the conjugacy class of the Frobenius endomorphism of A (by a
theorem of Honda and Tate, see also [6, Theorem 5.2]). Here p is a prime number
and Ap;K is the set of isogeny classes of simple abelian varieties over Fp which have
CM by the ﬁxed CM-ﬁeld K. The algebraic integers w in the set on the right-hand
side are so-called Weil p-integers. Let Pw denote the characteristic polynomial of a
Weil p-integer w. If A corresponds to w by the above bijection, then the number of
points of A=Fp equals Pw.1/. Thus for our purpose it sufﬁces to compute the set of
Weil p-integers for several p (in [6] we considered p up to 107) and evaluate their
characteristical polynomials at 1 to obtain the orders. We then may check how many
of these orders are prime and compare the result with the number predicted by the
conjecture.
Tables with numerical results can be found in both [11] (dimension 2) and [6]
(dimension 3). The experimental data support the conjecture.
In this paper we are interested in the constant CA and the conjecture (2) in the
case where Serre’s open image theorem applies, i.e. for abelian varieties A with
End.A/ D Z and d D 2; 6 or odd. The main result is the following.
Theorem 1.2 Let A be a principally polarized abelian variety of arbitrary dimen-
sion d deﬁned over a number ﬁeld F such that End.A/ D Z and d D 2; 6 or odd.
Then CA D Q
` prime
1p`
11=` is a positive constant.

614
U. Spreckels and A. Stein
By Serre’s open image theorem G` is isomorphic to GSp2d .F`/ for ` 
 0.
Thus the ratio of matrices with eigenvalue 1 in GSp2d .F`/ equals p`. We prove
the convergence of CA with intricate computations using results of [10].
We conclude the paper by presenting numerical evidence to support the conjec-
tural formula (2). We counted the number of prime orders Np with Norm.p/  n
for the Jacobians of the genus 2 curves 587.a.587.1, 743.a.743.1, 971.a.971.1 and
1051.a.1051.1 form the L-Functions and Modular Forms Database [7] (n D 4000).
We also treated a genus 3 curve that stems from [13] (n D 4300).
2
Abelian Varieties with Trivial Endomorphism Ring
By Serre’s open image theorem [5, Theorem 7.3 and subsequent corollary], if A is
an abelian variety with trivial endomorphism ring and dimension 2 or 6 or odd, then
the representation ` deﬁned in the introduction is surjective for almost all `. Thus
G` is isomorphic to GSp2d .F`/ for almost all ` in this case. Recall that
GSp2d .F`/ D
˚
M 2 GL2d .F`/
ˇˇ 9 2 F
` W MtJM D J
	
where J D
 0 Id
Id 0

.
Proposition 2.1 The order of the general symplectic group is
# GSp2d .F`/ D `d2.`  1/
d
Y
iD1
.`2i  1/ D `2d2CdC1  `2d2Cd C 

`2d2Cd1
:
Proof It is easy to see that there is an isomorphism
Sp2d .F`/ 
Id 0
0 Id
 ˇˇˇˇ  2 F
`

Š GSp2d .F`/
and the order of Sp2d .F`/ is `d2 Qd
iD1.`2i  1/.
ut
Let e`.d/ be the number of matrices with eigenvalue 1 in GSp2d .F`/. A formula
for e`.d/ was computed in various context e.g. [1, 3] and in [10]. We will rely on
the latter as this work was done explicitly with the idea to apply to our setting. We
want to prove that
e`.d/ D `2d2Cd  3`2d2Cd2 C O

`2d2Cd3
:

Koblitz’s Conjecture for Abelian Varieties
615
Let m; s 2 N0 with m  2d and 2s  m. Deﬁne
T`.d; m; 0/ D .`  1/`d2 m.m1/
2
dY
jD1
.`2j  1/
m
Y
jD1
.`j  1/1;
(3)
and for s > 0,
T`.d; m; s/ D `d2.ms/2 .m2sC1/.m2s/
2
d
Y
jDsC1
.`2j  1/
m2s
Y
jD1
.`j  1/1:
(4)
Theorem 2.2 ([10], Thm. 3.1) The number of matrices with eigenvalue 1 in
GSp2d .F`/ is
e`.d/ D
2d1
X
iD0
.1/i`
i.iC1/
2
b iC1
2 c
X
sDmax.0;iC1d/
T`.d; i C 1; s/
Proof This is an immediate consequence of [10, Thm. 3.1 and Cor. 2.1] and the last
formula on [10, p. 9] (which in turn stems from [9]), applied with m D 1.
ut
To examine the convergence of CA we will concentrate on the highest powers of
` in e`.d/. We need the following statements.
Lemma 2.3
1. Let d; m; s 2 N with m  2d, s  d and 2s  m. We have
T`.d; m; s/ D T`.d  1; m; s/`2d1.`2d  1/:
2. Let d 2 N with d > 2. We have
T`.d; 2d  1; d  1/ D `2d C `2d1 C    C `;
T`.d; 2d; d/ D 1:
Proof The claims follow immediately from the deﬁnition of T. For instance, for
s D 0, by (3) we have
T`.d; m; 0/ D .`  1/`d2 .m1/m
2
dY
jD1
.`2j  1/
m
Y
jD1
.`j  1/1
D .`  1/`.d1/2C2d1 .m1/m
2
.`2d  1/
d1
Y
jD1
.`2j  1/
m
Y
jD1
.`j  1/1
D T`.d  1; m; 0/`2d1.`2d  1/;

616
U. Spreckels and A. Stein
and for s > 0
T`.d; m; s/ D `d2.ms/2 .mC12s/.m2s/
2
dY
jDsC1
.`2j  1/
m2s
Y
jD1
.`j  1/1
D T`.d  1; m; s/`2d1.`2d  1/;
so the same identity holds in both cases.
The second assertion also is an immediate consequence of (4).
ut
We are now ready to prove the following.
Corollary 2.4 Assume d  2. The number of matrices with eigenvalue 1 in
GSp2d .F`/ is
e`.d/ D `2d2Cd  3`2d2Cd2 C O

`2d2Cd3
:
Proof We will prove the claim using induction over d. For d D 2, we obtain from
Theorem 2.2 and the deﬁnitions (3) and (4),
e`.2/ D `10  3`8 C `7  `6 C `5 C 4`4:
Assume the claim holds for d  1 (where d  3), i.e. we have
e`.d  1/ D `2.d1/2Cd1  3`2.d1/2Cd3 C O

`2.d1/2Cd4
D `2d23dC1  3`2d23d1 C O

`2.d1/2Cd4
Using Lemma 2.3 several times, we can express e`.d/ in terms of e`.d  1/:
e`.d/ D
2.d1/1
X
iD0
.1/i`
i.iC1/
2
b iC1
2 c
X
sDmax.0;iC1d/
T`.d; i C 1; s/
C `
.2d2/.2d1/
2
T`.d; 2d  1; d  1/  `
.2d1/2d
2
T`.d; 2d; d/
D
2.d1/1
X
iD0
.1/i`
i.iC1/
2
b iC1
2 c
X
sDmax.0;iC1.d1//
T`.d  1; i C 1; s/  `2d1.`2d  1/
C
2.d1/1
X
iDd1
.1/i`
i.iC1/
2
T`.d; i C 1; i C 1  d/
C `2d23dC1.`2d C `2d1 C    C `/  `2d2d

Koblitz’s Conjecture for Abelian Varieties
617
D e`.d  1/`2d1.`2d  1/
C
2d3
X
iDd1
.1/i`
i.iC1/
2
T`.d; i C 1; i C 1  d/
C `2d2dC1 C `2d2d1 C    C `2d23dC2
(5)
The induction hypothesis implies that
e`.d  1/`2d1.`2d  1/ D .`2d23dC1  3`2d23d1 C : : : /`2d1.`2d  1/
D `2d2Cd  3`2d2Cd2 C : : :
(6)
The exponents of ` in the terms in the last line of Eq. (5) are lower than 2d2 Cd 2.
Hence we only have to consider the sum
2d3
X
iDd1
.1/i`
i.iC1/
2
T`.d; i C 1; i C 1  d/:
(7)
The ﬁrst term of the sum which we obtain for i D d  1 contains T`.d; d; 0/. We
use (3) to obtain
T`.d; d; 0/ D .`  1/`d2 d.d1/
2
dY
jD1
.`2j  1/
d
Y
jD1
.`j  1/1:
Thus we ﬁnd that the highest exponent of ` in the ﬁrst term of (7) is
d.d  1/
2
C 1 C d2  d.d  1/
2
C d.d C 1/
2
D d.3d C 1/
2
C 1
and for all d  3 this is lower than 2d2 C d  2.
For the terms of (7) with d  i  2d  3 we are left to examine T`.d; m; s/ with
s D m  d > 0, m D i C 1 and d C 1  m  2d  2. For this we use (4) in order to
ﬁnd the highest exponent of ` in T`.d; m; s/:
T`.d; m; s/ D `d2.ms/2 .m2sC1/.m2s/
2
dY
jDsC1
.`2j  1/
m2s
Y
jD1
.`j  1/1
D `d2m2C2mss2 .m2sC1/.m2s/
2
Cd2Cds2s .m2sC1/.m2s/
2
C : : :
D `2d2Cd2m2C.6s1/m6s2Cs C : : :

618
U. Spreckels and A. Stein
Replacing s by m  d we ﬁnd that the highest exponent of ` in the terms of (7) for
d C 1  m D i C 1  2d  2 is
m.m  1/
2
C 6md  4d2  2m2:
The maximum occurs for m D 2d  2, i.e. i D 2d  3. Thus the highest exponent
of ` in the terms of (7) for d  i  2d  3 is 2d2  d  5 and this is smaller than
2d2Cd2 for every d. Hence if the claim is true for d1, it is true for d as well.
ut
We are now ready to proof our main result (Theorem 1.2 in the introduction). We
have to show that CA D Q
` a` is a positive constant.
Proof (of Theorem 1.2) There are only ﬁnitely many ` such that
p` ¤
e`
# GSpd .F`/;
hence if ` is big enough, we may compute p` using Proposition 2.1 and Corol-
lary 2.4. We ﬁnd that there is a function f.`/ with lim
`!1 f.`/ D 1 such that for big
`,
p` D
`2d2Cd  3`2d2Cd2 C O

`2d2Cd3
`2d2CdC1  `2d2Cd C 

`2d2Cd1
D 1
`2
0
@` C
`2d2Cd1 C O

`2d2Cd2
`2d2Cd1  `2d2Cd2 C 

`2d2Cd3
1
A
D ` C f.`/
`2
and hence
a` D 1  p`
1  1
`
D `2  `  f.`/
`2  `
D 1  f.`/
`2  `:
If the inﬁnite sum
S D
X
`
jf.`/j
`2  `
converges, the product CA D Q
` a` converges as well by [8], Theorem 1. Since
f.`/ ! 1, there is an `0 such that jf.`/j  2 for all `  `0. Let Sn be the partial

Koblitz’s Conjecture for Abelian Varieties
619
sum of S taken over all `  n. The sequence .Sn/ is monotonous and bounded since
X
``0
jf.`/j
`2  `  2
X
``0
1
`2  `  2
X
n2
1
n2  n D 2
X
n2

1
n  1  1
n

D 2:
Hence S and CA converge.
ut
We computed approximations of CA for some small dimensions d. We took the
product over all primes ` up to 109 (i.e. we assumed that G` Š GSp2d .F`/ for all
`  109) and got the following values.
d D 2 W
CA  0:6946382884
d D 3 W
CA  0:6885179362
(8)
d D 5 W
CA  0:6885714948
We conclude by presenting some examples supporting the conjectural for-
mula (2). We consider some examples with d D 2 and one examples with d D 3.
All genus 2 curves and their properties are taken from the L-Functions and
Modular Forms Database (LMFDB) [7]. Their Jacobians are abelian varieties of
dimension 2. The Jacobians have trivial torsion unit subgroup and endomorphism
ring Z.
Example 2.5 Consider the Jacobian J1 of the curve D1 deﬁned by
y2 C x3y C xy C y C x2 C x D 0
(curve 587.a.587.1). Bad reduction occurs at 587. We use the computer algebra
system Magma [2] to obtain the group order Np D #J1.Fp/ for all primes p 2
f2; : : : ; ngnf587g where n 2 f1000; 2000; 3000; 4000gand count how many of these
orders are prime. We denote by An.J1/ the number of prime group orders Np with
p  n. We do not check whether the representation `, induced by the action of
GQ on the `-torsion points of J1 is surjective for all primes (recall that the open
image theorem only ensures this holds for almost all primes), but simply assume
that the constant CJ1 is (approximately) 0:6946382884 as computed before. Under
this assumption, this constant depends only on the dimension of J1, so we write C2
instead. In Fig. 1 we list the results and the predicted values.
Example 2.6 Consider the Jacobian J2 of the curve D2 deﬁned by
y2 C x3y C xy C y C x4  x2 D 0
(curve 743.a.743.1). Bad reduction occurs at 743. We denote by An.J2/ the number
of prime group orders Np where p  n is a prime with good reduction. See Fig. 1
for the results.

620
U. Spreckels and A. Stein
n
C2
n
2log(n)2 C2 ∑p≤n
1
2log(p) An(J1) An(J2) An(J3) An(J4)
1000
7.3
11.1
15
15
5
8
2000
12.0
17.6
20
23
7
12
3000
16.3
23.2
25
28
8
15
4000
20.2
28.3
30
30
13
18
Fig. 1 Results of Examples 2.5–2.8, C2 D 0:6946382884
Example 2.7 Consider the Jacobian J3 of the curve D3 deﬁned by
y2 C y  x5 C 2x3  x D 0
(curve 971.a.971.1). Bad reduction occurs at 971. We denote by An.J3/ the number
of prime group orders Np where p  n is a prime with good reduction. See Fig. 1
for the results.
Example 2.8 Consider the Jacobian J4 of the curve D4 deﬁned by
y2 C y  x5 C x4  x2 C x D 0
(curve 1051.a.1051.1). Bad reduction occurs at 1051. We denote by An.J4/ the
number of prime group orders Np where p  n is a prime with good reduction.
See Fig. 1 for the results.
One would expect the second prediction, C2
P
pn
1
2 log.p/, to be more accurate
than the ﬁrst prediction, C2
n
2 log.n/2 . This is conﬁrmed by the ﬁrst two examples:
Although we considered a rather small number of primes p (since it quite time-
consuming to compute Np), the predictions for J1 and J2 are quite good. For J4 the
number of prime orders we counted goes well with the ﬁrst prediction, however
they are a bit to small compared to the second, more accurate prediction. For J3,
the numbers of prime orders we observed are only half of the predicted values.
Either the number of primes we considered was to limited to obtain reliable results
in this examples or the constants CJ3 and CJ4 differ considerably from the constant
C2 D 0:6946382884we computed in the last section. Recall that when we computed
C2 we assumed that G` Š GSp2d .F`/ for all ` up to 109. If this assumption does
not hold for some small `, C2 is not a good approximation for the correct constants
CJ3 and CJ4.
Example 2.9 Let J be the Jacobian of the non-hyperelliptic curve D deﬁned by
D W X3Y  X2Y2 C XY3  Y4 C Y3Z
C X2Z2  XYZ2  Y2Z2  XZ3  YZ3 D 0:

Koblitz’s Conjecture for Abelian Varieties
621
D and J are deﬁned over Q. D has genus 3, thus J has dimension 3. Let GQ be the
absolute Galois group of Q. Zywina [13] has shown that the representation induced
by the action of GQ on `-torsion points of J,
` W GQ ! GSp6 .F`/ ;
is surjective for all primes `. Hence we may use the approximation for CJ computed
in (8).
We used Magma [2] to compute the L-polynomial of D mod p and evaluate it at
1 for all primes numbers p 2 f2; : : : ; 4300gnS, where S D f7; 11; 83g is the set of
those primes where D and J have bad reduction. The result is the order Np of the
Jacobian Jp D J mod p. We found 21 primes such that Np is prime. They are listed
in Figs. 2 and 3 shows that the conjectured values and the actual numbers of p  n
such that Np is prime go well together.
p
Np prime
5
307
557
171219319
613
242503939
637
325438297
863
671644577
1103 1333585301
1297 2192725411
1433 2940030209
1567 3915860191
1597 4109726147
2087 9044075741
p
Np prime
2393 13741348627
2447 14776842569
2459 14560673957
2477 15536256587
2503 15936831311
2741 20088600289
2843 23227460699
2887 24174730291
3389 38453606281
3929 60013471627
Fig. 2 Prime orders
n
CJ
n
3log(n)2 CJ ∑p≤n
1
3log(p) # Np prime with p ⩽n
1000
4.8
7.6
5
2000
7.9
11.8
10
3000
10.7
15.6
19
4300
14.1
20.0
21
Fig. 3 Comparison of predicted and actual values

622
U. Spreckels and A. Stein
References
1. J.D. Achter, J. Holden, Notes on an analogue of the Fontaine-Mazur conjecture. J. Théor.
Nombr. Bordx. 15, 627–637 (2003). https://doi.org/10.5802/jtnb.416
2. W. Bosma, J. Cannon, C. Playoust, The Magma algebra system. I. The user language. J. Symb.
Comput. 24(3–4), 235–265 (1997)
3. J. Fulman, A probabilistic approach to conjugacy classes in the ﬁnite symplectic orthogonal
groups. J. Algebra 234, 207–224 (2000). https://doi.org/10.1006/jabr.2000.8455
4. N. Koblitz, Primality of the number of points on an elliptic curve over a ﬁnite ﬁeld. Pac. J. Math.
131(1), 157–165 (1988). https://doi.org/10.2140/pjm.1988.131.157
5. J.-P. Serre, Lettre à Marie-France Vignéras du 10/2/1986, in Œuvres, Collected Papers, vol. IV
(Springer, Berlin, 2000), pp. 38–55
6. U. Spreckels, On the order of CM abelian varieties over ﬁnite prime ﬁelds. Finite Fields Appl.
45, 386–405 (2017). https://doi.org/10.1016/j.ffa.2017.01.004
7. The LMFDB Collaboration, The l-functions and modular forms database (2016), http://www.
lmfdb.org. Accessed 27 Sept 2016
8. W.F. Trench, Conditional convergence of inﬁnite products. Am. Math. Mon. 106, 646–651
(1999). https://doi.org/10.2307/2589494
9. L.C. Washington, Some remarks on Cohen-Lenstra heuristics. Math. Comp. 47(176), 741–474
(1986). https://doi.org/10.2307/2008187
10. A. Weng, On the order of abelian varieties with trivial endomorphism ring reduced modulo a
prime. Finite Fields Appl. 28, 115–122 (2014). https://doi.org/10.1016/j.ffa.2014.01.002
11. A. Weng, On the order of abelian surfaces of CM-type over ﬁnite prime ﬁelds. Quaest. Math.
38(6), 771–787 (2015). https://doi.org/10.2989/16073606.2014.981720
12. D. Zywina, A reﬁnement of Koblitz’s conjecture. Int. J. Number Theor. 7(3), 739–769 (2011).
https://doi.org/10.1142/S1793042111004411
13. D. Zywina, An explicit Jacobian of dimension 3 with maximal Galois action (2015), http://
www.math.cornell.edu/~zywina/papers/GSp6example.pdf. Accessed 15 Jul 2015

Chabauty Without the Mordell-Weil
Group
Michael Stoll
Abstract Based on ideas from recent joint work with Bjorn Poonen, we describe an
algorithm that can in certain cases determine the set of rational points on a curve C,
given only the p-Selmer group S of its Jacobian (or some other abelian variety C
maps to) and the image of the p-Selmer set of C in S. The method is more likely to
succeed when the genus is large, which is when it is usually rather difﬁcult to obtain
generators of a ﬁnite-index subgroup of the Mordell-Weil group, which one would
need to apply Chabauty’s method in the usual way. We give some applications, for
example to generalized Fermat equations of the form x5 C y5 D zp.
Keywords Rational points on curves • Chabauty’s method • Selmer group
Subject Classiﬁcations 11G30, 14G05, 14G25, 14H25, 11Y50, 11D41
1
Introduction
When one is faced with the task of determining the set of rational points on a (say)
hyperelliptic curve CW y2 D f.x/, then the usual way to proceed is in the following
steps. For the following discussion, we assume that f has odd degree, which implies
that there is a rational point at inﬁnity on C, which eliminates possible shortcuts that
can be used to show that a curve does not have any rational points. We denote the
Jacobian variety of C by J.
1. Search for rational points on C.
This can be done reasonably efﬁciently for x-coordinates whose numerator and
denominator are at most 105, say. Rational points on curves of genus  2
are expected to be fairly small (in relation to the coefﬁcients of the deﬁning
M. Stoll ()
Mathematisches Institut, Universität Bayreuth, 95440 Bayreuth, Germany
e-mail: Michael.Stoll@uni-bayreuth.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_28
623

624
M. Stoll
equation), so the result very likely is C.Q/. It remains to show that we have
not overlooked any points.
2. Compute the 2-Selmer group Sel2 J [14].
The ‘global’ part of this computation requires arithmetic information related to
class group and unit group data for the number ﬁelds generated by the roots of f.
If the degrees of the irreducible factors of f are not too large (and the coefﬁcients
are of moderate size), then this computation is feasible in many cases, possibly
assuming the Generalized Riemann Hypothesis (GRH in the following) to speed
up the class group computation. The ‘local’ part of the computation is fairly easy
for the inﬁnite place and the odd ﬁnite places, but it can be quite involved to ﬁnd
a basis of J.Q2/=2J.Q2/.
To proceed further, we need the resulting bound r for the rank of J.Q/,
r D dimF2 Sel2 J  dimF2 J.Q/Œ2 ;
to be strictly less than the genus g of C. By work of Bhargava and Gross [2] it is
known that the Selmer group is small on average, independent of the genus, so
when g is not very small, this condition is likely to be satisﬁed.
3. Find r independent points in J.Q/.
We can use the points on C we have found in Step 1 to get some points in J.Q/.
However, it can be quite hard to ﬁnd further points if the points we get from
the curve generate a subgroup of rank < r. There are two potential problems.
The ﬁrst is of theoretical nature: the rank of J.Q/ can be strictly smaller than r,
in which case it is obviously impossible to ﬁnd r independent points. Standard
conjectures imply that the difference between r and the rank is even, so we will
not be in this situation when we are missing just one point. In any case, if we
suspect our bound is not tight, we can try to use visualization techniques [4]
to improve the bound. The second problem is practical: some of the generators
of J.Q/ can have fairly large height and are therefore likely to fall outside our
search space. When the genus g is moderately large, then we also have the very
basic problem that the dimension of our search space is large.
To proceed further, we need to know generators of a ﬁnite-index subgroup G
of J.Q/.
4. Fix some (preferably small) prime p (preferably of good reduction) and use
the knowledge of G to compute a basis of the space V of Qp-deﬁned regular
differentials on C that kill the Mordell-Weil group J.Q/ under the Chabauty-
Coleman pairing (see for example [15]).
This requires evaluating a number of p-adic abelian integrals on C, which (in the
case of good reduction with p odd) can be done by an algorithm due to Bradshaw
and Kedlaya and made practical by Balakrishnan [1]. Alternatively, one can use
the group structure to reduce to the computation of ‘tiny’ integrals, which can be
evaluated using power series.
5. Find the common zeros of the functions P 7!
R P
1 ! on C.Qp/, where ! runs
through a basis of V.

Chabauty Without the Mordell-Weil Group
625
The rational points are among this set. If there are additional zeros, then they can
usually be excluded by an application of the Mordell-Weil sieve [6].
The most serious stumbling block is Step 3, in particular when the genus g is of
‘medium’ size (say between 5 and 15). In this case Step 2 is feasible, but we are
likely to run into problems when trying to ﬁnd sufﬁciently many independent points
in the Mordell-Weil group.
In this paper we propose an approach that circumvents this problem. Its great
advantage is that it uses only the 2-Selmer group and data that can be obtained by a
purely 2-adic computation. Its disadvantage is that it may fail: for it to work, several
conditions have to be satisﬁed, which, however, are likely to hold, in particular when
the genus gets large.
Generally speaking, the method tries to use the ideas of [11] (where it is shown
that many curves as above have the point at inﬁnity as their only rational point) to
deal with given concrete curves. Section 2 gives a slightly more ﬂexible version of
one of the relevant results of this paper. In Sect. 4, we formulate the algorithm for
hyperelliptic curves of odd degree that is based on this key result. The method will
apply in other situations as well (whenever we are able to compute a suitable Selmer
group), and we plan to work this out in more detail in a follow-up paper for the case
of general hyperelliptic curves and also for the setting of ‘Elliptic Curve Chabauty’,
where one wants to ﬁnd the set of k-points P on an elliptic curve E deﬁned over
a number ﬁeld k such that f.P/ 2 P1.Q/, where fW E ! P1 is a non-constant
k-morphism. One application in the latter setting is given at the end of this paper.
The approach has also already been applied in [8] to complete the resolution of the
Generalized Fermat Equation x2 C y3 D z11.
One ingredient of the algorithm is the computation of ‘halves’ of points in
the group J.Q2/. In Sect. 5 we give a general procedure for doing this in J.k/,
when J is the Jacobian of an odd degree hyperelliptic curve and k is any ﬁeld not
of characteristic 2. In Sect. 6, we demonstrate the usefulness of our approach by
showing that the only integral solutions of y2  y D x21  x are the obvious ones.
In Sect. 7, we show how our method leads to a fairly simple criterion that implies
the validity of Fermat’s Last Theorem for a given prime exponent. This does not
lead to any new results, of course, but it gives a nice illustration of the power of
the method. In Sect. 8, we then apply our approach to the curves 5y2 D 4xp C 1.
Carrying out the computations, we can show that the only rational points on these
curves are the three obvious ones, namely 1, .1; 1/ and .1; 1/, when p is a prime
 53 (assuming GRH for p  23). A result due to Dahmen and Siksek [7] then
implies that the only coprime integer solutions of the Generalized Fermat Equation
x5 C y5 D zp
are the trivial ones (where xyz D 0).
As already mentioned, we end this paper with another type of example, which
uses the method in the context of ‘Elliptic Curve Chabauty’ to show that a certain
hyperelliptic curve of genus 4 over Q has only the obvious pair of rational points.

626
M. Stoll
The Mordell-Weil rank is 4 in this case, so no variant of Chabauty’s method applies
directly to the curve.
2
The Algorithm
In this section we formulate and prove a variant of [11, Prop. 6.2]. We then use it
to give an algorithm that can show that the set of known rational points in some
subset X of the p-adic points of a curve already consists of all rational points
contained in X, using as input only the p-Selmer group of the Jacobian of the curve.
The idea behind this goes back to McCallum’s paper [10].
Let k be a number ﬁeld, let C=k be a nice (meaning smooth, projective and
geometrically irreducible) curve of genus g  2 and let A=k be an abelian variety,
together with a map iW C ! A such that A is generated by the image of C (for
example, A could be the Jacobian of C and i the embedding given by taking some
k-rational point P0 2 C.k/ as basepoint). Fix a prime number p. We write Selp A
for the p-Selmer group of A. Recall that this is deﬁned as the kernel of the diagonal
homomorphism in the commuting diagram with exact rows
that is induced by applying Galois cohomology to the short exact sequence
0 ! AŒp ! A
	p
! A ! 0
of Galois modules over k and over all completions kv of k, so the products in the
second row run over all places v of k. The vertical maps are induced by k ,! kv. In
particular, for each place v there is a canonical map Selp.A/ ! A.kv/=pA.kv/.
We write kp D k ˝Q Qp; this is the product of the various completions of k at
places above p. The set C.kp/ and the group A.kp/ can similarly be understood as
products of the sets or groups of kv-points, for the various v j p. The inclusion
k ,! kp induces natural maps C.k/ ,! C.kp/ and A.k/ ,! A.kp/. Let X  C.kp/ be
a subset (for example, the points in a product of v-adic residue disks). We then have
the following commutative diagram of maps.

Chabauty Without the Mordell-Weil Group
627
We introduce some more notation. For P 2 A.kp/, we set
q.P/ WD fp.Q/ W Q 2 A.kp/; 9n  0W pnQ D Pg  A.kp/
pA.kp/ ;
(1)
and for a subset S  A.kp/, we set q.S/ D S
P2S q.P/. We further deﬁne
.P/ WD supfn W n  0; P 2 pnA.kp/g 2 Z0 [ f1g :
Note that .P/ D 1 is equivalent to P having ﬁnite order prime to p; on the
complement of the ﬁnite set consisting of such P, the quantities  and q are locally
constant.
With a view toward further applications, we ﬁrst state a more general version of
our result, which we will then specialize (see Theorem 2.6 below). We remark that
C could also be a variety of higher dimension here.
Theorem 2.1 In the situation described above, ﬁx some subgroup   A.k/ and
assume that
(1) ker   ı.. //, and that
(2) qi.X/ C   \ im./  p. /.
Then i

X \ C.k/

 N WD fQ 2 A.k/ W 9n  1W nQ 2  g.
Proof Let P 2 X \ C.k/. We show by induction on n that for each n  0, there
are Tn 2  and Qn 2 A.k/ such that i.P/ D Tn C pnQn. This is clear for n D 0
(take T0 D 0 and Q0 D i.P/). Now assume that Tn and Qn exist. Note that p.Qn/ 2
q.i.P/  Tn/, so
p.Qn/ D .ı..Qn/// 2 q

i.X/ C 

\ im./ I
by assumption (2) this implies .ı..Qn/// 2 p. / D .ı.. ///. This shows
that Qn 2  C ker. ı ı ı /. By assumption (1) and since ı is injective, we have
ker. ı ı ı / D 1
ı1.ker /

 1
. // D  C ker  D  C pA.k/ ;

628
M. Stoll
which implies that Qn 2  CpA.k/. So there are T0 2  and QnC1 2 A.k/ such that
Qn D T0 C pQnC1. We set TnC1 D Tn C pnT0 2  ; then
i.P/ D Tn C pnQn D Tn C pn.T0 C pQnC1/ D TnC1 C pnC1QnC1 :
Now consider the quotient map  W A.k/  A.k/= N . Since N is saturated in the
ﬁnitely generated group A.k/, the quotient group is torsion free and hence free.
Observe that for every n  0,
 .i.P// D  .Tn C pnQn/ D  .Tn/ C pn .Qn/ D pn .Qn/ 2 pn
A.k/= N

;
which implies that  .i.P// D 0 and so i.P/ 2 N .
ut
The point of formulating the statement in this way (as compared to [11]) is that
we avoid the use of p-adic abelian logarithms, which would require us to compute
p-adic abelian integrals, usually with p D 2 and in a situation when the curve has
bad reduction at 2. Instead, we need to be able to compute q.P/ for a given point P,
which comes down to ﬁnding its p-division points. At least in some cases of interest,
this approach seems to be computationally preferable.
Remark 2.2 Instead of considering multiplication by p, we could use an endomor-
phism  of A that is an isogeny of degree a power of p and such that some power
of  is divisible by p in the endomorphism ring of A. We then consider A.k/= A.k/,
A.kp/= A.kp/ and the  -Selmer group Sel A. Note that when  W A ! A0 is any
isogeny whose kernel has order a power of p and with dual isogeny O , then we can
consider AA0 with the endomorphism Q W .P; P0/ 7! . O .P0/;  .P//, which satisﬁes
Q 2 D deg  D pm, together with the morphism Q{W X ! A  A0, P 7! .i.P/; 0/.
Taking   f0g in place of  and writing the relevant maps as
and
the second condition in Theorem 2.1 translates into
qA.i.X/ C  / \ im./  .ı.. ///
and
qA0. O 1.i.X// C A0.k/tors/ \ im.0/  0.ı0.0.A0.k/tors/// :

Chabauty Without the Mordell-Weil Group
629
Remark 2.3 The set X \ i1. N / that contains C.k/ \ X when Theorem 2.1 applies
can in many cases be determined by the usual Chabauty-Coleman techniques; see
for example [15]. Of course, if  is ﬁnite (and so N D A.k/tors is ﬁnite as well),
which is usually the case in applications, then determining X \i1. N / is essentially
trivial.
We give some indication of how one can compute a set such as q.P C  /, where
P 2 A.kp/. We assume that, given P 2 A.kp/, we can ﬁnd all Q 2 A.kp/ such that
pQ D P.
Lemma 2.4 With the notations used in Theorem 2.1, ﬁx a complete set of represen-
tatives R   for  =p . Let P 2 A.kp/ and set
Q D fQ 2 A.kp/ W 9T 2 RW pQ D P C Tg :
Deﬁne an equivalence relation on Q via Q  Q0 ” Q  Q0 2  , and let Q0 be
a complete set of representatives for Q=. Then
q.P C  / D fp.P C T/ W T 2 Rg [
[
Q2Q0
q.Q C  / :
Proof Since QC D Q0C whenever Q  Q0, it is sufﬁcient to prove the equality
with Q in place of Q0. We ﬁrst show that the set on the right is contained in the set
on the left. This is clear for the elements p.P C T/, taking n D 0 in (1). So let now
Q 2 Q and  2 q.Q C  /. Then there are n  0, T0 2  and Q0 2 A.kp/ such that
pnQ0 D Q C T0 and p.Q0/ D . There is also T 2  such that pQ D P C T. We
then have
pnC1Q0 D p.Q C T0/ D P C .T C pT0/ 2 P C 
and so  D p.Q0/ 2 q.P C  /.
Now we show the reverse inclusion. Let  2 q.PC /, so there are n  0, T0 2  ,
Q0 2 A.kp/ such that pnQ0 D P C T0 and p.Q0/ D . There is also some T 2 R
such that T  T0 D pT00 with T00 2  . If n D 0, then  D p.P C T0/ D p.P C T/.
If n > 0, we can write
P C T D .P C T0/ C pT00 D p.pn1Q0 C T00/ D pQ
with Q D pn1Q0 C T00 2 Q, and  D p.Q0/ 2 q.Q  T00/  q.Q C  /.
ut
Whenever sup .P C  / < 1, the recursion implied by Lemma 2.4 will
terminate, and so the lemma translates into an algorithm for computing q.P C  /.
We make this condition more explicit.
Lemma 2.5 Write cl. / for the topological closure of  in A.kp/. Let P 2 A.kp/.
Then sup .P C  / D 1 if and only if there is a point T 2 A.kp/ of ﬁnite order
prime to p such that P 2 T C cl. /.

630
M. Stoll
Proof Let A.kp/1 be the kernel of reduction (i.e., the product of the kernels of
reduction of the various A.kv/ with v a place above p) and let m denote the exponent
of the ﬁnite group A.kp/=A.kp/1. Then for all P 2 A.kp/, pnmP tends to the origin
as n ! 1. If sup .P C  / D 1, then there are arbitrarily large n such there exist
n 2  and Qn 2 A.kp/ with P D n C pnQn, so mP  mn tends to the origin as
n gets large. Then P  n must be close to a point of order m; by restricting to a
sub-sequence, we ﬁnd that Pn approaches a point T 2 A.kp/Œm. Since T is close
to P  n D pnQ for arbitrarily large n, T must be inﬁnitely divisible by p, so the
order of T is prime to p. We clearly have P 2 T C cl. /.
For the converse, it sufﬁces to consider P in the closure of  , since the points of
ﬁnite order prime to p in A.kp/ are inﬁnitely p-divisible. Since any point sufﬁciently
close to the origin is highly p-divisible, this implies that for each n  0 we can ﬁnd
n 2  and Qn 2 A.kp/ such that P  n D pnQn. This implies that sup .P C
 / D 1.
ut
We specialize Theorem 2.1 to the case that k D Q and i embeds the curve into
its Jacobian. Let C be a proper regular model of C over Zp. Then the reduction map
sends C.Qp/ D C .Zp/ to the set of smooth Fp-points on the special ﬁber of C .
The preimage D of a smooth Fp-point on the special ﬁber of C under the reduction
map is called a residue disk in C.Qp/; see [11]. It follows from Hensel’s Lemma that
there is an analytic map ' from the open p-adic unit disk to C such that D D '.pZp/.
If p D 2, then we call the subsets '.4Z2/ and '.2 C 4Z2/ half residue disks.
Theorem 2.6 Let C be a nice curve over Q, with Jacobian J. Let P0 2 C.Q/ and
take X  C.Qp/ to be contained in a residue disk or, when p D 2 and J.Q/Œ2 ¤ 0,
in a half residue disk, and to contain P0. Let iW C ! J be the embedding sending P0
to zero. With the notation introduced above, assume that
(1) ker   ı..J.Q/tors//, and that
(2) q

i.X/ C J.Q/tors

\ im./  p.J.Q/tors/.
Then C.Q/ \ X D fP0g.
Proof We apply Theorem 2.1 with k D Q, C our curve, A D J, i as given in the
statement and  D
N D J.Q/tors. This tells us that iC.Q/ \ X  J.Q/tors. If
p > 2, or p D 2 and J.Q/Œ2 D 0, then the only rational torsion point in the kernel
of reduction of J.Qp/ is the origin, which implies that there cannot be two distinct
points in X both mapping to torsion under i. If p D 2 and J.Q/Œ2 ¤ 0, then the
corresponding statement is true if X is a half residue disk, which means that i.X/ is
contained in K2, the second kernel of reduction; see Sect. 3 below. In both cases, we
ﬁnd that there is at most one rational point in X; since P0 is one such point, it must
be the only one.
ut
This leads to the following algorithm. It either returns FAIL or it returns the set
of rational points on the curve C. We refer to [16] for the deﬁnition of the p-Selmer
set Selp.C/ of the curve C. Given an embedding i of C into its Jacobian J, it can be
interpreted as the subset of Selp.J/ consisting of elements that locally come from
points on the curve.

Chabauty Without the Mordell-Weil Group
631
Algorithm 2.7
Input: A nice curve C, deﬁned over Q, with Jacobian J.
A point P0 2 C.Q/, deﬁning an embedding iW C ! J.
A prime number p.
Output: The set of rational points on C, or FAIL.
1. Compute the p-Selmer group Selp J and the p-Selmer set Selp C;
i induces a map iW Selp C ,! Selp J.
2. Search for rational points on C and collect them in a set C.Q/known.
3. Let W Selp J ! J.Qp/=pJ.Qp/ be the canonical map.
If ker  6 ı..J.Q/tors//, then return FAIL.
4. Let R be the image of J.Q/tors in J.Qp/=pJ.Qp/.
5. Let X be a partition of C.Qp/ into residue disks whose image in J.Qp/=pJ.Qp/ consists of one
element and that are contained in half residue disks when p D 2 and J.Q/Œ2 ¤ 0.
6. For each X 2 X do the following:
a. If X \ C.Q/known D ;:
If p.X/  im. ı i/, then return FAIL;
otherwise continue with the next X.
b. Pick some P1 2 C.Q/known \ X.
c. Compute Y D S
P2X;T2J.Q/tors q.ŒP  P1 C T/  J.Qp/=pJ.Qp/.
d. If Y \ im./ 6 R, then return FAIL.
7. Return C.Q/known.
Proposition 2.8 The algorithm is correct: if it does not return FAIL, then it returns
the set of rational points on C.
Proof First note that Step 3 veriﬁes the ﬁrst assumption of Theorem 2.6; it returns
FAIL when the assumption does not hold. It is also clear that if the algorithm does
not return FAIL, then the set it returns is a subset of C.Q/. We show the reverse
inclusion. So let P 2 C.Q/ be some rational point. There will be some X 2 X such
that P 2 X. Then p.X/ is contained in im. ı i/, so since the algorithm did not
return FAIL, by Step 6a. it follows that X \ C.Q/known ¤ ;; let P1 2 X \ C.Q/known
as in Step 6b. Now by Step 6d. the second assumption of Theorem 2.6 is satisﬁed,
taking the embedding with base-point P1. So the theorem applies, and it shows that
there is only one rational point in X, so P D P1 2 C.Q/known.
ut
Remark 2.9 We note that in Step 6, the set X can be further partitioned if necessary.
If there are several points in C.Q/known that end up in the same set X, then the
second assumption of Theorem 2.6 cannot be satisﬁed. But it is still possible that
the theorem can be applied to smaller disks that separate the points. (If the points
are too close p-adically, this will not work, though. In this case, one could try to use
 C J.Q/tors in the more general version of the theorem, where  is the subgroup
generated by the difference of the two points.)
There are also cases when it helps to combine several sets X into one. One such
situation is when there are points in C.Qp/ that differ by a torsion point of order

632
M. Stoll
prime to p and such that only one of the corresponding sets X contains a (known)
rational point.
A particularly useful case is when C is hyperelliptic, A D J is the Jacobian of C,
and we consider p D 2. There is an algorithm that computes 2-Selmer group Sel2 J,
which is feasible in many cases, compare [14]. We discuss this further in Sect. 4
below in the case when the curve has a rational Weierstrass point at inﬁnity.
Another useful case (using a slightly more general setting) is related to “Elliptic
curve Chabauty”. Here A is the Weil restriction of an elliptic curve E over some
number ﬁeld k such that there is a non-constant morphism C ! E deﬁned over k.
We give an example of this in Sect. 9.
3
Computing the Image Under q of a Disk
In this section, we discuss in some detail how to ﬁnd the image under q of (the
image in J of) a residue disk of C.kp/. The basic idea is that q is locally constant on
the curve even near points where  becomes inﬁnite (a variant of this was already
used in [11]). To get a practical algorithm out of this idea, we have to produce an
explicit neighborhood on which q is constant. We will do this ﬁrst away from the
points where  becomes inﬁnite and then also on residue disks centered at a point
where  becomes inﬁnite.
Since objects over kp are products of objects over the various completions kv at
places v above p, we will now work over a ﬁxed such completion. We ﬁx a non-
constant morphism iW C ! J, where J can be any abelian variety that is spanned
by i.C/. To ease notation, we denote the map J.kv/ ! J.kv/=pJ.kv/ by  instead
of v.
We assume that we can compute q.P/ for any given point P 2 J.kv/ that is not
(too close to) a point of ﬁnite order prime to p. When p D 2 and C is hyperelliptic of
odd degree and J is the Jacobian, this can be done by using the halving algorithm of
Sect. 5 below: we compute the image of P in L
2 and record it; if the image is trivial,
then we compute all halves of P and apply the same procedure to them. Since by
assumption P is not inﬁnitely 2-divisible, the recursion will eventually stop with an
empty set of points still to be considered.
The following is essentially immediate from the deﬁnitions.
Lemma 3.1 Let P1; P2 2 J.kv/ and assume that P1  P2 6 0 mod pmC1J.kv/.
Then .P1/ D .P2/ and q.P1/ D q.P2/.
Proof The assumptions imply that P1; P2 … pmC1J.kv/, so whenever there are Q 2
J.kv/ and n  0 such that pnQ D P1 or P2, then n  m. Let P0 2 J.kv/ such
that P2 D P1 C pmC1P0. Then pnQ D P1 implies pn.Q C pmC1nP0/ D P2, so that
.P2/  .P1/, and by symmetry, we obtain equality.
Let  2 q.P1/; then  D .Q/ for some Q such that pnQ D P1 as above. Then
n  m and so  D .Q/ D .Q C pmC1nP0/ 2 q.P2/ as well. This shows that
q.P1/  q.P2/; the reverse inclusion follows again by symmetry.
ut

Chabauty Without the Mordell-Weil Group
633
We write Ov for the ring of integers in kv and $ for a uniformizer. We abuse
notation and write vW k
v
! Z for the additive valuation, normalized such that
v.$/ D 1. Then e D v.p/ is the absolute ramiﬁcation index of Kv. We ﬁx a proper
regular model C of C over Ov. Let J be the Néron model of J over Ov. For n  1,
we denote by
Kn WD ker

J.kv/ D J .Ov/ ! J .Ov=$nOv/

the ‘higher kernels of reduction’; Kn is also the group of $nOv-points of the formal
group associated to J .
We now ﬁx a residue disk D  C.Kv/ with respect to C ; we will denote an
analytic parameterization D0 ! D by ', where D0 is the open unit disk. Since i
induces a morphism from the smooth part of C to J , it follows that
t; t0 2 $Ov;
v.t  t0/  m
H)
i.'.t//  i.'.t0// 2 Km:
(2)
The formal logarithm converges on K1 and gives a homomorphism K1 ! kdim J
v
.
Restricted to Km with m > e=.p  1/, the formal exponential provides an inverse, so
that the formal logarithm gives an isomorphism Km ! .$mOv/dim J. It follows that
pKm D KmCe; in particular,
KneCm D pnKm  pnJ.kv/
for all n  0:
(3)
This implies together with (2) that for m as above and n  0,
t; t0 2 $Ov;
v.tt0/  neCm
H)
i.'.t//  i.'.t0// mod pnJ.kv/:
(4)
In the following we write  for be=.p  1/c C 1; this is the smallest choice of m in
the considerations above. If kv D Qp (or, more generally, an unramiﬁed extension
of Qp, so that e D 1), then  D 1 when p is odd, and  D 2 when p D 2.
Corollary 3.2 Consider 'W D0 ! D  C.kv/ as above, and let t0 2 $Ov be such
that .i.'.t0///  n. Then for all t with v.t  t0/  e.n C 1/ C , we have
.i.'.t/// D .i.'.t0///
and
q.i.'.t/// D q.i.'.t0/// :
More generally, let   J.kv/ be a subgroup. If max .i.'.t0// C  /  n, then
for all t with v.t  t0/  e.n C 1/ C , we have
max .i.'.t// C  / D max .i.'.t0// C  /
and
q.i.'.t// C  / D q.i.'.t0// C  / :

634
M. Stoll
Proof By (4), we have i.'.t//  i.'.t0// mod pnC1J.kv/. The ﬁrst claim now
follows from Lemma 3.1. The second claim follows from the ﬁrst by considering
i.'.t// C  for each  2  separately, and applying the ﬁrst claim to the shifted
embedding P 7! i.P/ C .
ut
If the image of the disk D in J does not contain a point of ﬁnite order prime
to p, then  will be bounded on D. Corollary 3.2 then provides a partition of D into
ﬁnitely many sub-disks such that qıi is constant on each of them. In this way, we can
compute q.i.D//. In a similar way, this allows us to compute q.i.D/ C  / if i.D/
does not meet cl. / C J.kv/Œp0, where GŒp0 denotes the subgroup of an abelian
group G consisting of elements of ﬁnite order prime to p; compare Lemma 2.5.
We now consider the case when D contains a point P0 such that i.P0/ 2 J.kv/Œp0.
In this situation, the result above will not produce a ﬁnite partition into sub-disks,
so we need to have an explicit estimate for the size of the pointed disk around P0 on
which q ı i is constant. Without loss of generality, i.P0/ D 0. We also assume that
'.0/ D P0, so that i.'.0// D 0 2 J.
In the following, we write ntors for the smallest n

0 such that
J.kv/Œp1  JŒpn. In other words, pntors is the exponent of the p-power torsion
subgroup J.kv/Œp1.
Lemma 3.3 Let P 2 J.kv/.
(1) If ntors D 0, then .pP/ D .P/ C 1 and q.P/  q.pP/  q.P/ [ f0g.
(2) .P/ > ntors, then .pP/ D .P/ C 1 and q.pP/ D q.P/.
Proof Since pnQ D P implies pnC1Q D pP, the inclusion q.P/  q.pP/ is clear, as
is the inequality .pP/  .P/ C 1, for arbitrary P.
First assume that ntors D 0. Consider  2 q.pP/, so there are Q 2 J.kv/ and
n  0 such that pnQ D pP and .Q/ D . If n D 0, then  D .Q/ D .pP/ D 0.
If n  1, then we must have pn1Q D P (there is no nontrivial p-torsion), so
 D .Q/ 2 q.P/. Taking n D .pP/ shows that .P/  .pP/  1.
Now assume that .P/ > ntors and write P D pntorsC1P0 for P0 2 J.kv/. We ﬁrst
show that .J.kv/Œp1/  q.P/. For this, let T 2 J.kv/Œp1 D J.kv/Œpntors. Then
pntors.T C pP0/ D P, so .T/ D .T C pP0/ 2 q.P/ by (1).
To show that q.pP/  q.P/, let  2 q.pP/, so there are some Q 2 J.kv/ and n  0
with .Q/ D  such that pnQ D pP D pntorsC2P0. If n  ntors C 1, then it follows
that Q D pntorsC2nP0 C T with T 2 J.kv/Œp1, so  D .Q/ D .T/ 2 q.P/ by the
argument above. If n  ntors C 2, then pnntors2Q D P0 C T with T 2 J.kv/Œpntors,
and therefore pn1Q D pntorsC1P0 D P, so  D .Q/ 2 q.P/. Carrying out this
argument with n D .pP/ and a suitable Q, we also get that .P/  .pP/  1.
ut
For m  1 we deﬁne
N.m/ D 1 C min
njkm  v.k/  
e
k
W k  2
o
:
Then N.m/e  2m  a for some constant a.

Chabauty Without the Mordell-Weil Group
635
Lemma 3.4 Assume that v.t/ D m  1. Then
p  i.'.t//  i.'.pt// mod pN.m/J.kv/ :
Proof In terms of formal group coordinates, we can write
logJ i.'.t// D c1t C c2
2 t2 C c3
3 t3 C : : :
with c1; c2; c3; : : : 2 Odim J
v
. We ﬁnd that
logJ

pi.'.t//  i.'.pt//

D p logJ i.'.t//  logJ i.'.pt//
D c2
p  p2
2
t2 C c3
p  p3
3
t3 C c4
p  p4
4
t4 C : : : 2 .$N.m/eCOv/dim J ;
by the deﬁnition of N.m/. We have that
p  i.'.t//  i.'.pt// 2 pKm C KmCe D KmCe  K ;
so we are in the domain of the isomorphism induced by the formal logarithm, which
allows us to conclude that pi.'.t//  i.'.pt// 2 KN.m/eC. The claim then follows
from (3).
ut
Corollary 3.5 If we have p D 2 and e D 1 (which is the case when kv D Q2) in
the situation of Lemma 3.4, then
2i.'.t//  i.'.2t// mod 22m2J.Q2/ :
If in addition C is hyperelliptic, '.0/ is a Weierstrass point and '.t/ D 	.'.t//,
where 	 is the hyperelliptic involution, then
2i.'.t//  i.'.2t// mod 23m1J.Q2/ :
Proof If p D 2 and e D 1, then  D 2 and so N.m/ D 2m  2 in Lemma 3.4 (the
minimum is attained for k D 2).
Under the additional assumptions on C and ', it follows that logJ ı i ı ' is odd,
so that c2n D 0 for all n  1 in the proof of Lemma 3.4. We then obtain the better
bound in the same way as in that proof, noting that we can restrict to odd k (which
have v.k/ D 0).
ut
For our ﬁxed ' and i, we deﬁne, for m  1,
nm WD maxf.i.'.t/// W t 2 $Ov; v.t/ D mg :
Lemma 3.6 There is some b 2 Z such that nme  m C b for all m  1.

636
M. Stoll
Proof First note that i.'.t// 2 KmCa n KmCaC1 for some ﬁxed a when m is
sufﬁciently large, where a is the valuation of c1 in the proof of Lemma 3.4 above.
Next, let a0 denote the p-adic valuation of the exponent of the (ﬁnite) quotient
group J.kv/=K. Then for n   and P 2 Kn n KnC1, we have .P/e  n   C a0e.
To see this, write P D p.P/Q for some Q 2 J.kv/; assume .P/e > n   C a0e.
Then pa0Q maps to an element of order prime to p in J.kv/=K, and since P D
p.P/a0.pa0Q/ 2 K, it follows that pa0Q 2 K (its class in J.kv/=K has order
prime to p and a power of p at the same time, so it must be zero). This in turn
implies, using (3),
P D p.P/Q D p.P/a0  .pa0Q/ 2 KC..P/a0/e  KnC1 ;
a contradiction. So .P/e  n   C a0e as claimed.
Finally, combining these arguments, we see that nme  m C .a C a0e  / for
large m, which implies the claim.
ut
Lemma 3.7 Let m0 D 1 if ntors D 0 and m0 D ntorse C  C e otherwise. There is
some m  m0 such that N.m/  nm C 1. For any such m, we have that
q.i.'.ft W m  v.t/ < 1g/// D q.i.'.ft W v.t/ D mg/// [ f0g :
Proof By Lemma 3.6, nme  mCb for some b; on the other hand, N.m/e  2ma
for some a, so whenever m  a C b C e, the inequality N.m/  nm C 1 holds. Fix
such an m that also satisﬁes m  m0. We now show that if v.t/ D m, then
.i.'.pnt/// D .i.'.t/// C n
and
q.i.'.pnt///  q.i.'.t/// [ f0g
for all n  0, which implies the claim (note that 0 2 q.i.P// if P is sufﬁciently close
to P0). Note that m  ntorse C  C e implies nm  ntors C 1 by (4) (taking t0 D 0).
We proceed by induction on n, the case n D 0 being trivial. So consider n  1. By
the inductive assumption, we have
.i.'.pn1t/// D .i.'.t/// C n  1  nm C n  1
and
q.i.'.pn1t///  q.i.'.t/// [ f0g :
By Lemma 3.4, this implies p  i.'.pn1t//  i.'.pnt// mod pN.mC.n1/e/J.kv/, and
since
N.m C .n  1/e/  N.m/ C 2n  2  nm C n  .i.'.pn1t/// C 1

Chabauty Without the Mordell-Weil Group
637
and nm  ntors C 1 in case ntors > 0, by Lemmas 3.1 and 3.3 it follows that
.i.'.pnt/// D .p  i.'.pn1t/// D .i.'.pn1t/// C 1 D .i.'.t/// C n
and
q.i.'.pnt/// D q.p  i.'.pn1t///  q.i.'.pn1t/// [ f0g  q.i.'.t/// [ f0g :
ut
Corollary 3.8 If p D 2 and e D 1 in the situation of Lemma 3.7, then we take
m0 D 1 if ntors D 0 and m0 D ntors C 3 otherwise. There is then some m  m0 such
that 2m  3  nm. For any such m, we have that
q.i.'.ft W m  v.t/ < 1g/// D q.i.'.ft W v.t/ D mg/// [ f0g :
If the curve is hyperelliptic, P0 D '.0/ is a Weierstrass point and '.t/ D 	.'.t//,
where 	 is the hyperelliptic involution, then the condition above can be replaced by
3m  2  nm.
Proof This follows again from  D 2 and N.m/  2m2. The improved statement
under the additional assumptions follows in the same way as for Corollary 3.5.
ut
This now allows us to ﬁnd q.i.D// when 0 2 i.D/. First we use Corollary 3.2 to
determine q.i.'.ft W 1  v.t/  m0  1g///. Then for m D m0; m0 C 1; : : :, we ﬁnd
in a similar way nm and q.i.'.ft W v.t/ D mg///. As soon as nm C 1  N.m/, we can
stop the computation; we then have
q.i.D n fP0g// D q.i.'.ft W 1  v.t/  mg/// [ f0g:
We state a special case for later use.
Corollary 3.9 Assume that C is hyperelliptic, of good reduction mod 2, and satisﬁes
J.Q2/Œ2 D 0 and J.F2/Œ2 D 0. Let P0 2 C.Q2/, choose a parameterization ' of a
residue disk D centered at P0 and let iP0 denote the embedding of C into J sending
P0 to 0. Then
(1) q.iP0.D// D q.iP0.'.2Z
2 [ 4Z
2 /// [ f0g, and
(2) if P0 is a Weierstrass point and ' satisﬁes '.t/ D 	.'.t//, then
q.iP0.D// D q.iP0.'.2Z
2 /// [ f0g.
Proof Since kv D Q2, we are in the case p D 2 and e D 1. The assumptions
on 2-torsion over Q2 and over F2 imply that ntors D 0, which in turn implies that
when m  1 and P 2 Km n KmC1, we have .P/ 2 fm  2; m  1g, compare [11,
Lemma 10.1] and its proof. Also, K1 has odd index in J.Q2/. We can therefore take
b D 1 in Lemma 3.6. Then m D 2 is a suitable value in Corollary 3.8. When P0 is
a Weierstrass point, then by Corollary 3.8 again even m D 1 is sufﬁcient.
ut
We now give a version of Lemma 3.7 that applies when we work with a
subgroup  that does not consist of torsion points only. We restrict here to the

638
M. Stoll
case kv D Q2; a general statement can be obtained and proved along the same lines,
with changes similar to the statement and proof of Lemma 3.7.
We let   J.Q2/ be a subgroup such that  \ 2J.Q2/ D 2 and such that
cl. / is not of ﬁnite index in J.Q2/. We deﬁne
nm; WD supf.i.'.t// C / W  2 ; t 2 2Z2; v.t/ D mg :
Lemma 3.10 Let m0 D 2 if ntors D 0 and m0 D ntors C 3 otherwise. Assume that
there is m  m0 such that 2m  3  nm; . For any such m, we have that
q.i.'.ft W m  v.t/ < 1g// C  / D q.i.'.ft W v.t/ D mg// C  / [ q. / :
If the curve is hyperelliptic, P0 D '.0/ is a Weierstrass point and '.t/ D 	.'.t//,
where 	 is the hyperelliptic involution, then the condition above can be replaced by
3m  2  nm; .
By standard Chabauty-Coleman, the intersection of i.D/ with cl. / is ﬁnite. So
for m sufﬁciently large, i.'.2mZ2// will meet cl. / only in P0, hence nm; < 1.
So we can hope to ﬁnd an m as in the lemma. It is conceivable, however, that the
image of the curve meets cl. / at i.P0/ with higher multiplicity, in which case nm;
may grow too fast with m.
Proof We show again inductively that if v.t/ D m, then
max .i.'.2nt// C  / D max .i.'.t// C  / C n
and
q.i.'.2nt// C  /  q.i.'.t// C  / [ q. /
for all n  0 (note that q. /  q.i.P/ C  / if P is sufﬁciently close to P0). The
case n D 0 is trivial. So consider n  1. By the inductive assumption, we have
max .i.'.2n1t// C  / D max .i.'.t// C  / C n  1  nm; C n  1
and
q.i.'.2n1t// C  /  q.i.'.t// C  / [ q. / :
By Corollary 3.5, we have 2i.'.2n1t//  i.'.2nt// mod 22mC2n4J.Q2/. So for
every  2  , we have
2

i.'.2n1t// C 

 i.'.2nt// C 2 mod 22mC2n4J.Q2/ :
Since
2m C 2n  4  nm; C n  .i.'.2n1t// C / C 1

Chabauty Without the Mordell-Weil Group
639
and nm;  ntors C 1 in case ntors > 0, by Lemmas 3.1 and 3.3 it follows that
.i.'.2nt// C 2/ D .2.i.'.2n1t// C // D .i.'.2n1t// C / C 1
and
q.i.'.2nt// C 2/ D q.2.i.'.2n1t// C //
 q.i.'.2n1t// C / [ f0g  q.i.'.t// C  / [ q. / :
Now consider  2  n 2 . Since i.'.2nt// 2 2nCm2J.Q2/ and n C m  2  1, we
get
.i.'.2nt// C / D 0
and
q.i.'.2nt// C / D f./g  q. / :
(We use here that  … 2J.Q2/.) Together, these relations imply that
max .i.'.2nt// C  / D max .i.'.t// C  / C n
and
q.i.'.2nt// C  /  q.i.'.t// C  / [ q. /
as claimed.
The improved statement under the additional assumptions follows again in the
same way.
ut
4
Determining the Set of Rational Points on Odd Degree
Hyperelliptic Curves
In this section, we specialize the algorithm formulated in Sect. 2 to hyperelliptic
curves of odd degree over Q. So let
CW y2 D f.x/
be a hyperelliptic curve, given by a squarefree polynomial f 2 ZŒx of odd degree
2g C 1 (then g is the genus of C). We understand C to be the smooth projective
model of the afﬁne curve given by the equation; then C is a nice curve. We write J
for the Jacobian of C. For a point P0 2 C.Q/ (or C.Q2/), we let iP0W C ! J denote
the embedding that sends P0 to the origin of J.
To carry out one of the relevant steps, we have to compute q.P/ for points P 2
J.Q2/ (where q.P/ is deﬁned as above with p D 2). The basic strategy for this was

640
M. Stoll
explained in Sect. 3. To implement it, we need to be able to divide by 2 in J.Q2/.
We consider this problem in Sect. 5 below.
We recall the algorithm for computing the 2-Selmer group of J, compare [12, 14].
Let C be given by the afﬁne equation y2 D f.x/ with f 2 ZŒx squarefree and of odd
degree 2g C 1, where g is the genus of C. Let L D QŒx=hfi be the associated étale
algebra and write  for the image of x in L. If A is any commutative ring, then we
write A for the group A=.A/2 of square classes in the multiplicative group A
of A.
For any ﬁeld extension k of Q, there is an isomorphism
H1.k; JŒ2/
'
! ker

N.L˝Qk/=kW .L ˝Q k/ ! k
(5)
realizing the Galois cohomology group on the left in a concrete way, and there is
the ‘Cassels map’ or ‘x  T’ map
kW J.k/ ! J.k/=2J.k/ ,! .L ˝Q k/
that is induced by evaluating x   (multiplicatively) on divisors whose support is
disjoint from the set of Weierstrass points of C. The image of k is contained in
the kernel of the norm map above; k is the composition of the connecting map
ıkW J.k/ ! H1.k; JŒ2/ induced by the exact sequence of Galois modules
0 ! JŒ2 ! J.k/
	2
! J.k/ ! 0
with the isomorphism (5). We write  D Q, and for v a place of Q, we write
Lv D L ˝Q Qv (with Q1 D R as usual) and set v D Qv.
Let ˙ be the set of places of Q consisting of 2 and the ﬁnite places v such that
the Tamagawa number of J at v is even. The subgroup L.˙; 2/ of L consists of the
elements represented by ˛ 2 L such that the fractional ideal generated by ˛ has the
form I2
1I2 with I2 supported on the primes above primes in ˙. Then the isomorphic
image of Sel2 J in L, which we will identify with Sel2 J, is given by
Sel2 J D f 2 L.˙; 2/ W NL=Q./ D ; 8v 2 ˙ [ f1gW v./ 2 im.v/g ;
where vW L ! L
v is the canonical map. There is also the 2-Selmer set of C, given
by
Sel2 C D f 2 L.˙; 2/ W NL=Q./ D ; 8vW v./ 2 v.i1.C.Qv///g :
It is a subset of the 2-Selmer group. The set of places v in the condition can be
restricted to the set ˙ [ f1g together with all ‘small’ primes, where ‘small’ in
practice can be rather large; see [5].
Algorithm 2, combined with the representation of J.k/=2J.k/ as a subgroup
of .L ˝Q k/, then leads to the following.

Chabauty Without the Mordell-Weil Group
641
Algorithm 4.1
Input: A polynomial f 2 ZŒx, squarefree and of odd degree 2g C 1.
Output: The set of rational points on CW y2 D f.x/, or FAIL.
1. Let J denote the Jacobian of C. Set L D QŒx=hfi.
2. Compute Sel2 J and Sel2 C as a subgroup and a subset of L.
3. Let L2 D L ˝Q Q2; let rW L ! L
2 be the map induced by Q ! Q2.
If ker r \ Sel2 J 6 ı..J.Q/Œ21//, then return FAIL.
4. Search for rational points on C and collect them in a set C.Q/known.
5. Let X be a partition of C.Q2/ into residue disks whose image in L
2 consists of one element
and that are contained in half residue disks when J.Q/Œ2 ¤ 0.
6. Let R denote the image of J.Q/Œ21 in L
2 .
7. For each X 2 X do the following:
a. If X \ C.Q/known D ;:
If 2.X/  Sel2 C, then return FAIL;
otherwise continue with the next X.
b. Pick some P0 2 C.Q/known \ X.
c. Compute Y D 2.q.iP0.X/ C J.Q/Œ21//  L
2 .
d. If Y \ r.Sel2 J/ 6 R, then return FAIL.
8. Return C.Q/known.
That the algorithm is correct is a special case of Proposition 2.8, taking into
account that torsion points of odd order are inﬁnitely 2-divisible, which allows us to
replace J.Q/tors with J.Q/Œ21 at the places where the latter occurs.
Remark 2.9 applies in the same way as to the general algorithm.
Remark 4.2 We note that the (image of the) Selmer group in L that is used in the
algorithm can be replaced by any subgroup S of L that contains it (and similarly
for the Selmer set). For example, we can take
S D f 2 L.˙; 2/ W NL=Q./ D ; 8v 2 ˙ [ f1g n f2gW resv./ 2 im.v/g ;
where ˙ is the set of ‘bad primes’ for 2-descent on J. This leaves out the 2-adic
Selmer condition. Taking it into account requires the computation of 2.J.Q2//,
which is usually the most time-consuming step in the local part of the computation
of Sel2 J. We can do without it, since using S in the algorithm is actually equivalent
to using Sel2 J. To see this, ﬁrst consider Step 3. Since all elements in the kernel of r
satisfy the 2-adic Selmer condition trivially, it follows that ker r\S D ker r\Sel2 J,
so that the outcome of Step 3 is the same in both cases. Now consider Step 7a. This
does not involve Sel2 J, so its outcome is trivially the same in both cases. Finally
consider Step 7d. If Y \ r.S/ 6 R, then there is some s 2 S such that r.s/ … R
and r.s/ 2 Y. But everything in Y is of the form 2.Q/ for some Q 2 J.Q2/, so
Y  im.2/, which means that s satisﬁes the 2-adic Selmer condition. This shows
that s 2 Sel2 J and then implies that Y \ r.Sel2 J/ 3 r.s/ … R, so that the outcome

642
M. Stoll
of this step is again the same in both cases. The preceding arguments show that
the algorithm fails on S if and only if it fails on Sel2 J. Finally, it is clear that the
result will be the same, namely C.Q/known, in both cases when the algorithm does
not output FAIL.
If ˙  f2; pg with p 6 ˙1 mod 8, then we can also leave out the condition
NL=Q./ D , since then Q.˙; 2/ injects into Q
2 , so the norm condition is implied
by the image under r being in Y.
Of course, we can also use a subset of L that is possibly larger than Sel2 C
instead of the 2-Selmer set. In fact, this is what we have to do in practice, since the
computation of the exact 2-Selmer set usually requires taking into account the local
conditions for all primes up to some bound that is exponential in the genus of C;
compare [5].
If we assume that C.Q/known meets every set in X , then the other conditions
required to avoid failure of the algorithm are likely to be satisﬁed. This follows
from work of Bhargava and Gross [2], which we use in a similar way as in [11]:
the ‘probability’ that the map Sel2 J ! J.Q2/=2J.Q2/ is injective is at least
1  21gdimF2 J.Q2/Œ2, and the ‘probability’ that the image has intersection with Y
contained in R is at least 1  .#.Y=R/  1/21g. Since by the results of [11] Y is
usually small and by [17] the size of Y modulo R is uniformly bounded by some
constant times g2, there is a very good chance that both conditions are satisﬁed
when g is large.
5
Halving Points on Odd Degree Hyperelliptic Jacobians
In this section we describe an algorithm that computes one ‘half’ or all ‘halves’ of
a point P 2 2J.k/, where J is the Jacobian of a hyperelliptic curve C of odd degree
over the ﬁeld k. We assume that char.k/ ¤ 2, so that C can be given by an equation
y2 D f.x/ with f 2 kŒx squarefree and of odd degree 2g C 1.
Recall that each point in J.k/ is uniquely represented in the form ŒDd1, where
D is an effective divisor in general position deﬁned over k and d D deg D  g. An
effective divisor D is said to be in general position if its support does not contain 1
and D 6 P C 	.P/ for any point P 2 C, where 	W C ! C is the hyperelliptic
involution.
Any effective divisor D in general position can be described by its Mumford
representation .a; b/. Here a 2 kŒx is a monic polynomial of degree d D deg D
whose roots are the x-coordinates of the points in the support of D, with appropriate
multiplicity (so that a corresponds to the image of D under the hyperelliptic quotient
map to P1), and b 2 kŒx is another polynomial such that b./ D 
 for any point
P D .; 
/ in the support of D and satisfying a j f b2. This polynomial b is uniquely
determined modulo a; in particular, we obtain a unique representation if we require
deg.b/ < d. However, it is sometimes useful to allow additional ﬂexibility, so we
will not always insist on this normalization. In fact, we may also want to allow

Chabauty Without the Mordell-Weil Group
643
polynomials a of larger degree (this leads to even more non-unique representations,
but can be useful in certain situations).
We will use the notation .a; b/ to denote the divisor D, and we will write Œa; b D
Œ.a; b/  d1 for the point on J corresponding to it.
Let c be the leading coefﬁcient of f. Then in terms of the Mumford representa-
tion, the descent map W J.k/ ! L is given by
Œa; b 7! .c/deg.a/a./  .L/2
if a and f are coprime. In the general case, write a1 and f1 for a and f divided by
their (monic) gcd; then
.Œa; b/ D Q.a/ WD .c/deg.a/
a./  a1./f1./

 .L/2 I
compare [12].
Since the kernel of  is 2J.k/, this gives us a way of deciding if a point P 2 J.k/
is divisible by 2 in J.k/: this is equivalent to the existence of a polynomial s 2 kŒx
such that
s./2 D .c/deg.a/
a./  a1./f1./

I
equivalently,
s2  .c/deg.a/.a  a1f1/ mod f :
We will now state a result that shows how to compute a point Q 2 J.k/ such that
2Q D P, given such a polynomial s.
Note that when a D a2
1a2, then P D Œa; b is divisible by 2 if and only if P2 D
Œa2; b is, and each point Q such that 2Q D P has the form Q D Q1 C Q2 where Q2
satisﬁes 2Q2 D P2 and Q1 D Œa1; b. So we can assume that a is squarefree.
Proposition 5.1 Let a 2 kŒx be monic and squarefree, of degree  2g C 1. Let d
denote gcd.a; f/, so that a D da1 and f D df1 as above. Suppose we have b; s 2 kŒx
with
f  b2 mod a
and
.c/deg.a/.a  a1f1/  s2 mod f ;
so that Œa; b 2 2J.k/. For polynomials u, v and w, consider the following system of
congruences:
vd  ws mod f1;
vd  ub mod a1;
uf1  ws mod d:
(6)
Then this system has a nontrivial solution .u; v; w/ with w monic such that
deg.u/ < deg.a/=2;
deg.v/  g C deg.a/=2  deg.d/
and
deg.w/  g:
(7)

644
M. Stoll
Each such solution satisﬁes the relation
u2f1 D dv2  .c/deg.a/a1w2:
(8)
Now assume that .u; v; w/ is a solution such that w has minimal degree. Let d1 D
gcd.u; w/; then d1 divides fa1 and v. Write d1 D dfda with df D gcd.d1; f/ and
da D gcd.d1; a1/. Set w1 D w=d1, u1 D u=d1, v1 D v=d1 and let r 2 kŒx be such
that
ru1  v1d mod w1da
and
r  0 mod df :
Then Q D Œw; r satisﬁes P D 2Q.
If Q and Q0 are computed starting from s and s0 such that s0 6 ˙s mod f, then Q
and Q0 are distinct.
Proof First note that, since f is squarefree, we have that d and f1 are coprime. Also, d
and a1 are coprime, since a divisor in general position contains no ramiﬁcation point
with multiplicity 2 or more. So f1, a1 and d are coprime in pairs and squarefree. The
fact that a divides f b2 implies that d divides b and that d is also the gcd of a and b.
The ﬁrst claim is that the system of congruences has a nontrivial solution when
the degrees of the polynomials are bounded as stated. To see this, note that the
conditions are linear in (the coefﬁcients of) u, v and w, and that the total number of
coefﬁcients of u, v and w is
ddeg.a/=2e C .g C bdeg.a/=2c  deg.d/ C 1/ C .g C 1/
D 2g C deg.a/  deg.d/ C 2 D deg.f1/ C deg.a1/ C deg.d/ C 1:
On the other hand, the number of linear constraints is deg.f1/ C deg.a1/ C deg.d/.
So there are more variables than constraints, hence nontrivial solutions exist.
We claim that w cannot be zero in such a solution. Otherwise, the ﬁrst congruence
would imply that f1 divides v (since f1, a1 and d are coprime in pairs), which for
degree reasons (recall that deg.a/  2g C 1) is only possible when v D 0. In a
similar way, the second congruence would then imply that a1 divides u (since a1 is
coprime to b), whereas the third congruence implies that d divides u, so a divides u,
which is only possible when u D 0. But then our solution is trivial, a contradiction.
So w ¤ 0, and without loss of generality, w can be taken to be monic.
We show that every solution as above satisﬁes relation (8). Namely, by the ﬁrst
congruence and since s2  .c/deg.a/a mod f1,
d2v2 D .dv/2  .sw/2 D s2w2  .c/deg.a/aw2 D .c/deg.a/da1w2 mod f1 ;
so (since d and f1 are coprime), the relation holds mod f1. Next, by the second
congruence,
d2v2 D .dv/2  .bu/2 D b2u2  fu2 D df1u2 mod a1 ;

Chabauty Without the Mordell-Weil Group
645
so (since d and a1 are coprime), the relation holds mod a1. Finally, by the last
congruence,
u2f 2
1 D .uf1/2  .sw/2 D s2w2  .c/deg.a/a1f1w2 mod d ;
so (since d and f1 are coprime again), the relation holds also mod d. It follows that
it holds mod f1a1d. Since the degrees of all terms are strictly less than the degree of
f1a1d, equality follows, and (8) is veriﬁed.
We note that the fact shown above that a nontrivial solution has w ¤ 0 implies
that w determines the solution uniquely. It follows that there is in fact a unique
solution with w monic and deg.w/ minimal.
Since d is squarefree, (8) implies that the gcd d1 of w and u also divides v. We
can therefore divide all three by this gcd, obtaining u1, v1 and w1; they satisfy
u2
1f1 D dv2
1  .c/deg.a/a1w2
1 :
If some irreducible factor p of d1 does not divide fa1, then .u=p; v=p; w=p/ also
satisfy the system of congruences, contradicting the minimality of deg.w/. Now
assume that p2 divides d1 for some irreducible polynomial p. Then p divides f1,
a1 or d, say p j a1 (the other cases are analogous). Since a1 is squarefree, the
congruence vd  ub mod a1 implies .v=p/d  .u=p/b mod a1, and so again
.u=p; v=p; w=p/ satisfy the system of congruences, contradiction. So d1 is squarefree
and must therefore divide a1f1d. In particular, we can write d1 D dfda as claimed.
Note that .u1b/2  u2
1f  .v1d/2 mod a1, so a1 divides .u1b  v1d/.u1b C v1d/.
We claim that da D gcd.u1b C v1d; a1/. For this, consider an irreducible factor p
of da. If p divides u1b  v1d, then .u=p; v=p; w=p/ is a solution, a contradiction. So
p must divide u1b C v1d. Conversely, if p is any irreducible factor of a1 that divides
u1b C v1d, then (noticing that b is invertible mod a1) for p to divide ub  vd, it must
necessarily divide u and v, so p j da.
u1 is invertible mod w1, but also mod da (since u1 and v1 are coprime as well—
a1 is squarefree—and da is coprime with f1 and d). Furthermore, df is coprime
with w1 (and of course also with da), for essentially the same reason. Therefore
a polynomial r exists such that u1r  v1d mod w1da and r  0 mod df .
Now we consider the function
 D u.x/y  v.x/d.x/ D df.x/da.x/ .u1.x/y  v1.x/d.x//
on C. Its divisor of zeros is
2.df; 0/ C

.da; b/ C .da; b/

C

.d; 0/ C .da; b/ C .a1=da; b/ C 2.w1; r/

D .a1; b/ C .d; 0/ C 2

.df; 0/ C .da; b/ C .w1; r/

D .a; b/ C 2.w; r/:

646
M. Stoll
To see this, note that the norm in kŒx of the last factor of  is u2
1f  v2
1d2 D
.c/deg.a/da1w2
1 and that u1b  v1d mod a1=da and u1b  v1d mod da (and so
also r  b mod da). Setting Q D Œw; r, we therefore obtain 2Q D P.
We now show that Q determines s mod f up to sign. Given Q D Œw; r such that
2Q D P, there is a unique function (up to scaling) on C whose divisor is .a; b/ C
2.w; r/n1 (where n D deg.a/C2 deg.w/); this function must then be , which
gives us u and v up to scaling; the relation u2f1 D dv2.c/deg.a/aw2 then ﬁxes them
up to a common sign. Write df D df1dd with df1 D gcd.df; f1/ and dd D gcd.df; d/.
In a similar way as above for da, one shows that df1 D gcd.w1s C v1d; f1/ and
dd D gcd.u1f1 C w1s; d/. Since w1 is coprime with f, this determines s mod f via
the congruences
w1s  v1d mod f1=df1;
w1s  v1d mod df1;
w1s  u1f1 mod d=dd;
w1s  u1f1 mod dd:
A common sign change of u and v (which is the only ambiguity here) results in a
sign change of s.
ut
We can try to use the algorithm implied by Proposition 5.1 over a p-adic ﬁeld.
It will possibly run into precision problems when some of the roots of a get close
to roots of f (but with the resultant of a and f still being nonzero, albeit p-adically
small) or when the resulting point is represented by a divisor of lower degree or
such that some points are close to the point at inﬁnity. In practice, however, these
problems occur fairly rarely. A possible remedy in such a case is to replace .a; b/
by another representation .a0; b0/ such that Œa0; b0 D Œa; b and deg.a/ > g. Writing
f  b2 D ac, we have Œc  2hb  h2a; b  ha D Œa; b for all polynomials h.
Taking h to be constant already allows us to replace a by a polynomial a0 that is
coprime with f (and probably we can also arrange a0 to be squarefree) and satisﬁes
deg.a0/  g C 1 if deg.a/ D g. Another possibility is to consider points in a residue
disk given by suitable Laurent series, perform the computation on the Laurent series
and then specialize.
Remark 5.2 In the context of computing q.P/, the following observation can be
useful. Given P D Œa; b with deg.a/  g C 1 and T D Œh; 0 2 J.k/Œ2 with h j f
and deg.h/  g, we can use the method described in Proposition 5.1 to compute
halves of P C T without ﬁrst computing a representation of the sum. For simplicity
assume gcd.a; f/ D 1 (this can be arranged, see above). Then P C T D Œah; b0h
where b0h  b mod a. There will be s1 and s2 such that s2
1  .c/deg.a/ah mod f=h
and s2
2  .c/deg.a/a.f=h/ mod h. We obtain the congruences
vh  ws1 mod f=h;
vh  ub mod a;
u.f=h/  ws2 mod h
with the bounds deg.u/ < .deg.a/ C deg.h//=2, deg.v/  g C .deg.a/  deg.h//=2
and deg.w/  g.

Chabauty Without the Mordell-Weil Group
647
In a similar way, we can divide P C P0 by 2: let P D Œa; b, P0 D Œa0; b0 and
assume that deg.a/ C deg.a0/  2g C 1 and that a, a0 and f are coprime in pairs.
Given a polynomial s such that s2  .c/deg.a/Cdeg.a0/aa0 mod f, the system to be
solved is
v  ws mod f;
v  ub mod a;
v  ub0 mod a0 ;
where we require deg.u/ < .deg.a/Cdeg.a0//=2, deg.v/  gC.deg.a/Cdeg.a0//=2
and deg.w/  g.
We mention one implication that can be helpful in applications.
Corollary 5.3 Let Œa0; b be the Mumford representation of a point P 2 J.k/, write
a0 D a2
0a with a squarefree and monic and ﬁx a polynomial s such that
s2  .c/deg.a/.a  a1f1/ mod f
as above. Let .u; v; w/ be the solution with w monic and of smallest degree of the
system (6) with the restrictions in (7), and let Q 2 J.k/ be the associated point such
that 2Q D P. Then .Q/ D Q.a0/ Q.w/.
Proof This is because according to Proposition 5.1, we have Q D Œa0; bCŒw; r for
some r 2 kŒx.
ut
Corollary 5.4 In the situation of Corollary 5.3, we have the following special
cases.
(1) If PDŒ.; 
/  1 2 2J.k/ with 
 ¤ 0, ﬁx s 2 kŒx such that s2c.  x/
mod f. Let w be the monic polynomial of smallest degree such that the residue
of smallest degree of ws modulo f has degree  g. Then the point Q 2 J.k/ with
2Q D P that is associated to s satisﬁes
.Q/ D Q.w/ :
(2) If P D Œ.1; 
1/  .2; 
2/ 2 2J.k/ with 1 ¤ 2 and 
j ¤ 0 for j 2 f1; 2g, ﬁx
s 2 kŒx such that s2  .x  1/.x  2/ mod f. Let w be the monic polynomial
of smallest degree such that the residue v of smallest degree of ws modulo f has
degree  g C 1 and satisﬁes 
2v.1/ C 
1v.2/ D 0. Then the point Q 2 J.k/
with 2Q D P that is associated to s satisﬁes
.Q/ D Q.w/ :
Proof This follows directly from Corollary 5.3, using that d D 1 (in the notation
of Proposition 5.1) in both cases and that u has to be constant. In the ﬁrst case,
the congruence v  ub mod a is redundant, and the system reduces to just v 
ws mod f. In the second case, the congruence v  ub mod a is equivalent to the
condition 
2v.1/ C 
1v.2/ D 0.
ut

648
M. Stoll
6
A Concrete Example
In this section we use the approach described above to show the following result.
Theorem 6.1 Assuming GRH, the only integral solutions of the equation
y2  y D x21  x
have x 2 f1; 0; 1g.
We remark that l D 21 is the smallest odd exponent such that our method can
be successfully applied to determine the set of integral points on the curve given by
y2  y D xl  x. One can check that for l 2 f5; 7; 9; 11; 13; 17g the 2-Selmer rank
of the Jacobian is  g D .l  1/=2, and for l 2 f15; 19g, the map from Sel2 J to
J.Q2/=2J.Q2/ is not injective.
We also note that all these curves have a pair of rational points with x D 1=4;
these points are of the form '.2u/ for a parameterization ' of the residue disk
at inﬁnity, where u 2 Z
2 . For such a point P, ŒP  1 has nontrivial image
in J.Q2/=2J.Q2/, and this image is contained in the image of the Selmer group.
On the other hand, by Corollary 3.9, the value of q on the residue disk of 1 is given
by the values at points of the form '.2u/, so q.i1.D// will meet the image of the
Selmer group non-trivially for every disk D around inﬁnity, no matter how small.
This implies that our approach cannot be used to show that 1 is the only rational
point 2-adically close to 1. This is why we restrict to integral points in the statement
of Theorem 6.1. The result is in fact stronger: it covers all rational solutions whose
x-coordinate has odd denominator.
In principle, one could try to deal with the residue disk at inﬁnity using  D hi
where  D Œ. 1
4; 1
2 C
1
221 /  1, since the three (known) rational points in the disk
map into this group. Unfortunately, it turns out that q.i1.P4// meets the image
of the Selmer group outside the image of  , which prevents us from applying
Theorem 2.1. Here P4 D '.4/ denotes a point with x-coordinate 1=42 (we can
use a parameterization of the disk at inﬁnity whose x-coordinate is given by t2):
i1.P4/ C 6 D 23Q with 2.Q/ 2 .Sel2 J/ n 2. /.
Proof Let C denote the curve deﬁned by the equation y2  y D x21  x, and let J be
its Jacobian. Note that C is isomorphic to the curve given by y2 D 4x21  4x C 1;
write f D 4x21  4x C 1 and let L D QŒx=hfi. We compute a group S 	 L
containing Sel2 J using the algorithm described in [14]. The discriminant of f is
240 times the product of six distinct odd primes. This implies that 2 is the only
‘bad’ prime for 2-descent, so that the image of the Selmer group is contained
in L.f2g; 2/. Since L is totally ramiﬁed at 2, we can reduce this to S D L.;; 2/
(if  represents an element of L.f2g; 2/ and NL=Q./ is a square, then the ideal
generated by  must be a square). The class group of L turns out to be trivial, so
that L.;; 2/ D O
L , but we do not need this fact. We do need to compute L.;; 2/ and
explicit generators of it, though. This is where we use GRH to make the computation
feasible in reasonable time. We check that the map S ! L
2 is injective.

Chabauty Without the Mordell-Weil Group
649
The curve has good reduction mod 2, and J.F2/ and J.Q2/ both have no elements
of order 2. Up to the action of the hyperelliptic involution, there are two residue disks
with 2-adically integral x-coordinates; we can center them at the rational points
.0; 0/ and .1; 0/, respectively. By [14, Lemma 6.3], it follows that the image in L
2
of a point P 2 C.Q2/ with x.P/ 2 Z2 depends only on x mod 4. We check that the
image in L
2 of the points with x.P/  2 mod 4 is not in the image of S. This shows
that any (2-adically) integral point P 2 C.Q/ must have x.P/  1; 0 or 1 mod
4. We consider each of the corresponding (pairs of) half residue disks separately.
Let P0 be one of the points .1; 0/, .0; 0/ or .1; 0/ on C and let D be the disk
around P0 consisting of points P with x.P/  x.P0/ mod 4 and y.P/  0 mod 2.
By Corollary 3.9 (note that the disk D corresponds to m  2 in terms of the maximal
residue disk around P0), we have
q.iP0.D// D q.iP0.'.4Z
2 /// ;
where ' is a parameterization of the residue disk containing P0 such that '.0/ D P0
and D D '.4Z2/. By Lemma 3.1 and since .iP0.'.4u/// D 1 for some u 2 Z
2
(as becomes apparent in the course of the computation), it is sufﬁcient to consider
'.4/ and '.4/. So we compute the (unique) half of iP0.P/ for each point P 2 D
such that x.P/ D x.P0/ ˙ 4; we ﬁnd that its image in L
2 is nontrivial (and does
not depend on the sign) and is not contained in the image of S. By Theorem 2.6 this
now implies that D \ C.Q/ D fP0g, for each of the three points. So we obtain the
result that
C.Q/ \ C.Z2/ D f.1; 0/; .1; 1/; .0; 0/; .0; 1/; .1; 0/; .1; 1/g
as claimed.
ut
7
An Application to Fermat’s Last Theorem
In this section we apply the criterion that is given by the algorithm in Sect. 4 to a
certain family of hyperelliptic curves that are related to Fermat curves. This leads
to a criterion for Fermat’s Last Theorem to hold for a given prime p. Of course,
FLT has been proved in general by Wiles [18, 21], so this will not produce a new
result. On the other hand, it shows that the method does work in practice. In the
next section, we will deal with a similar family of curves that are related to certain
generalized Fermat equations; our method applies again and does indeed solve some
new cases of generalized Fermat equations.
Consider
ClW y2 D f.x/ WD 4xl C 1

650
M. Stoll
with l D 2g C 1. This curve has good reduction at 2, since it is isomorphic to the
curve y2 C y D xl. The reduction has three F2-points, so there are three residue
classes in Cl.Q2/. We also note that Cl has the three obvious rational points 1,
.0; 1/ and .0; 1/ and that Œ.0; ˙1/  1 2 Jl.Q/, where Jl denotes the Jacobian
of Cl, is a point of odd order l. We note that Jl.Q2/ and Jl.F2/ contain no points of
order 2.
Corollary 7.1 Let 'W D0 ! D  Cl.Q2/ be a parameterization of one of the three
residue disks of Cl.Q2/, with '.0/ being 1 or .0; ˙1/. Then
q.i1.D// D
(
q.i1.'.2Z
2 [ 4Z
2 /// [ f0g
if '.0/ D .0; ˙1/I
q.i1.'.2Z
2 /// [ f0g
if '.0/ D 1:
Proof This is simply Corollary 3.9 specialized to the case at hand.
ut
We now want to ﬁnd q.i1.Cl.Q2/// in terms of its image in L
2 as in Algorithm 4.
To do this, we need a basis for the latter group. We ﬁrst note that f is irreducible
over Q2, so L2 is a ﬁeld. Let  D 21=l, then L2 D Q2./ is totally and tamely
ramiﬁed and  D 2 is a root of f. Clearly, 2 D l. Note that an element of the
form 1C4˛ D 1C˛2lC1 with ˛ 2 OL2 is always a square in L2 (the power series
for p1 C x converges when the valuation of x exceeds that of 4). Furthermore,
.1 C n/2 D 1 C 2n C nCl D .1 C 2n/.1 C nCl C : : :/ ;
which allows us to eliminate factors of the form 1 C2n for n  l1 when working
modulo squares. In this way, we ﬁnd that the following elements represent an
F2-basis for L
2 :
; 1 C ; 1 C 3; : : : ; 1 C 2nC1; : : : ; 1 C 2l3; 1 C 2l1; 1 C 2l :
Lemma 7.2 The image of q.i1.Cl.Q2/// in L
2 consists of the classes of
1;
1 C lC2;
1 C 2l1;
Y
k1
.1 C lC2k/ :
We let Z denote the set consisting of the three nontrivial classes in this image.
Proof We ﬁrst consider the residue disk D1 around 1. By Corollary 7.1, it is
sufﬁcient to ﬁnd 2.q.i1.'.t//// for t D 2u with u 2 Z
2 . One choice of ' is
'.t/ D

t2; 2tl.1 C 23t2l  27t4l ˙ : : :/

:
Then 2.i1.'.2u/// is the class of .2u/2 C 2 in L
2 . We have
.2u/2 C 2 D .2u/2.1 C u22l2/  1 C 2l2  1 C 2l1 ;

Chabauty Without the Mordell-Weil Group
651
where  denotes equivalence mod squares, by the relation
1  .1 C l1/2 D 1 C 2l2 C 2l1  .1 C 2l2/.1 C 2l1/ :
We conclude that (specifying elements of L
2 using representatives in L
2 )
2.q.i1.D1/// D f1; 1 C 2l1g :
(Compare [11, Lemma 10.2], which says that the image of the residue disk at inﬁnity
under the  log map has just one element.)
Now we consider the residue disk D.0;1/ around .0; 1/. If P D .; 
/ 2 Cl.Q2/
has integral x-coordinate, then we must have  2 2Z2 (otherwise the right hand side
is 5 mod 8 and therefore not a square). We can parameterize D.0;1/ by
'.t/ D

t;
p
1 C 4tl D 1 C 2tl  2t2l C : : :

:
Then 2.i1.'.2u/// is the class of
2u C 2 D 2.1 C lC2u/  1 C lC2 I
the latter relation holds when u is a unit. By Corollary 7.1, we also need to ﬁnd the
image under q of points given by t 2 4Z
2 , so t D 4u with u 2 Z
2 . In this case
(recall that  D 2)
4u   D .2gC1/2.1  4u=/ D s./2
where s 2 Q2Œx is a polynomial of degree  l  1 such that
s./ D 2gC1p
1  4u=
D 2.gC1  2ug  2u2g1  4u3g2  : : :/:
The coefﬁcients of
p
1  4x D
1
X
nD0
22n.1/n
 
1=2
n
!
xn D 1 
1
X
nD1
2n 1  3  5    .2n  3/
nŠ
xn
(except for the constant term) all have 2-adic valuation at least 1 (since v2.nŠ/ 
n  1) and 1 D 42g, so
1
2s.x/  xgC1  2uxg  2u2xg1  : : :  cgC1ugC1 mod 8Z2Œx;

652
M. Stoll
where cgC1 denotes the coefﬁcient of xgC1 in 
p
1  4x. Let w0.x/ denote the partial
sum of the power series of .1  4ux/1=2 up to and including the term with xg, and
set
Qw.x/ D xgw0.1=x/ D xg C 2uxg1 C 6u2xg2  : : : :
Then
Qw.x/s.x/  2x2gC1 C .terms up to xg/ mod 8Z2Œx ;
so Qw.x/  w.x/ mod 8Z2Œx, where w.x/ is the monic polynomial of degree g such
that w./s./ 2 Q2 C Q2 C : : : C Q2g. Let Q 2 Jl.Q2/ denote the point such that
2Q D Œ.4u; /1. By Corollary 5.4, the image of Q in L
2 is given by the class of
.1/gw./  .1/g Qw./
D ./g.1 C 2u2 C 6u24 C 20u36 C 70u48 C : : :/
 1 C 22 C 64 C 206 C 708 C : : :
 1 C
1
X
kD1
lC2k
 .1 C lC2/.1 C lC4/.1 C lC8/    .1 C lC2k/    ;
where the product can be truncated as soon as 2k > l. (We have used that the
valuation of the coefﬁcient of xn in .1  4x/1=2 is 1 precisely when n is a power
of 2.)
ut
We can generalize this result to certain curves of the form y2 D 4xl C A. Let
A 2 Z with A  1 mod 8 and consider
Cl;AW y2 D 4xl C A :
Then Cl;A is Q2-isomorphic to Cl D Cl;1, since A is a square and an lth power in Q2.
In particular, we still have L2 D Q2./, where now L D QŒx=h4xl C Ai, and the
image of q.i1.Cl;A.Q2/// in L
2 is the same as for Cl, namely Z [ f1g.
Proposition 7.3 Let A be an integer satisfying A  1 mod 8; consider the curve
Cl;AW y2 D 4xl C A over Q with l D 2g C 1  5, with Jacobian Jl;A. Let further
L D QŒx=h4xl C Ai and L2 D L ˝Q Q2 D Q2./ with  D 21=l. If
(1) the canonical map Sel2 Jl;A ,! L ! L
2 is injective and
(2) its image does not meet Z,
then Cl;A.Q/ D f1g if A is not a square, and Cl;A.Q/ D f1; .0; a/; .0; a/g if
A D a2.

Chabauty Without the Mordell-Weil Group
653
Proof We apply Theorem 2.1 with A D Jl;A, i D i1, 
D f0g and X D
Cl;A.Q2/. By Lemma 7.2, Z is the set of nontrivial images in L
2 of elements in
q.i1.Cl;A.Q2///. So the assumptions here match the assumptions of Theorem 2.1,
and we conclude that i1.Cl;A.Q//  f0g D Jl;A.Q/tors. Since Cl;A has good
reduction at 2 and Jl;A.Q/Œ2 is trivial, we ﬁnd that Jl;A.Q/tors injects into Jl;A.F2/;
in particular, Cl;A.Q/ will inject into Cl;A.F2/, which has three elements. Since each
residue class in Cl;A.Q2/ contains exactly one torsion point (namely, 1, .0; a/ and
.0; a/, respectively, where a is a square root of A in Q2), the claim follows.
ut
It is known that Fermat’s Last Theorem holds for a prime p  3 if (and only if)
the curve y2 D 4xpC1 has only the obvious three rational points. So Proposition 7.3
gives a criterion for FLT for exponent p to hold, in terms of the 2-Selmer group of
the Jacobian of this curve. We can deduce the following criterion.
Proposition 7.4 Let p  5 be a prime and set L D Q.21=p/ and L2 D Q2.21=p/. Let
rW O
L ! O
L2 denote the canonical map. If
(1) p2 −2p1  1,
(2) the class number of L is odd, and
(3) im.r/ \ Z D ; (where Z is as above),
then Fermat’s Last Theorem holds for the exponent p.
Proof Let f.x/ D xp C 1=4. Then f.x  1=4/  xp mod pZpŒx, and the ﬁrst
assumption p2 −2p11 implies that the constant term is not divisible by p2. This in
turn implies that CpW y2 D 4xpC1 is regular over Zp and the component group of the
Néron model of the Jacobian J of C over Zp is trivial. By [14, Lemma 4.5] or [13,
Prop. 3.2] (which applies equally to abelian varieties), the only ‘bad prime’ for the
computation of Sel2 Jp is 2. By the second assumption, the class group of L has odd
order and therefore trivial 2-torsion. Together, the previous two sentences imply that
the isomorphic image of Sel2 Jp in L is contained in the subgroup generated by O
L
and the image of 21=p. The map to L
2 decomposes as a direct sum of the map r and
an isomorphism of 1-dimensional F2-vector spaces (since the class of  D 21=p is
not contained in the image of the (global or 2-adic) units). We note that r is injective:
assume that u 2 O
L is a square in OL2. Since u is a unit, the extension L.pu/=L is
unramiﬁed at all places not dividing 2 or 1. The extension is unramiﬁed at 1, since
NL=Q.u/ must be 1 (it is a 2-adic square by assumption), so the image of u under the
unique real embedding of L is positive. Finally, it is unramiﬁed (and even split) at
the prime above 2. Since the class number is odd, there are no nontrivial everywhere
unramiﬁed quadratic extensions of L, hence u must be a square. This implies that
Sel2 J ! L
2 is injective. Since Z is contained in O
L2, assumption (3) implies that
r.Sel2 J/ \ Z D ; as well. We can now apply Proposition 7.3 and conclude that
Cp.Q/ D f1; .0; 1/; .0; 1/g.
Now let FpW up C vp C wp D 0 denote the projective Fermat curve of exponent p.
Then there is a non-constant morphism
 W Fp ! Cp;
.u W v W w/ 7! .x; y/ D

uv
w2 ; 2 up
wp C 1

:

654
M. Stoll
So if P D .u W v W w/ 2 Fp.Q/, then either w D 0 (if  .P/ D 1) or else uv D 0 (if
 .P/ D .0; ˙1/), so P is a trivial point.
ut
Note that by Remark 4.2, the criterion formulated in the proposition above is
equivalent to what we would obtain when using the 2-Selmer group Sel2 Jp instead
of O
L .
We can improve on Proposition 7.4 a bit. Note that if u; u0 2 OL are units with
u positive (in the unique real embedding of L), then the Hilbert symbol .u; u0/v is 1
for all places v distinct from the place  above 2. The product formula for the Hilbert
symbol implies that .u; u0/ D 1 as well. There are the two positive global units 1
and .1   C 2/=.1 C /. Multiplying the latter by the square .1 C /2, we obtain
1 C 3. So if u 2 O
L2 and we can show that .  1; u/ D 1 or .1 C 3; u/ D 1,
then u cannot be in the image of O
L .
Lemma 7.5 We work in L2 D Q2./ with l D 2 as before. If 1  m < l, then we
have
.  1; 1 C 2lm/ D 1
and
.1 C 3; 1 C 2lm/ D
(
1
if 3 −m;
1
if 3 j m:
Proof We ﬁrst consider   1. Note that .1; 1 C 2lm/ D .1; 1 C 22lm/2 D 1,
so we can as well work with .1  ; 1 C 2lm/. We have for n  .l  1/=2 that
.1 C n/2  .1  /.n/2 D 1 C 2nC1 C lCn  .1 C 2nC1/.1 C lCn/
is a norm from L2.
p
1  /, which implies that
.1  ; 1 C 2lm/ D .1  ; 1 C 2l.mC1/=2/
when 1  m < l is odd. For even m, we have
1  .1 C lm=2/2 D 1 C 2lm C 2lm=2  .1 C 2lm/.1 C 2lm=2/ ;
which implies that
.1  ; 1 C 2lm/ D .1  ; 1 C 2lm=2/
when 1  m < l is even. An easy induction then shows that
.1  ; 1 C 2lm/ D .1  ; 1 C 2l1/
for all 1  m < l. Finally, this last symbol is 1: clearly, an element is a norm
from L2.
p
1 C 2l1/ if and only if it has the form x2  .1 C 2l1/y2. Substituting
.x; y/  .l1x C y; y/ and dividing by 2l2, we see that norms have the form x2 C
xy  y2. If the norm is integral, then x and y must be in OL2 as well. Considering

Chabauty Without the Mordell-Weil Group
655
the equation
1   D x2 C xy  y2
modulo 2, we see that it has no solution.
Now we consider 1 C 3. For even 1  m < l we have in the same way as above
that
.1 C 3; 1 C 2lm/ D .1 C 3; 1 C 2lm=2/ :
For n  .l  1/=2, we have the norms
.1 C n/2  .1 C 3/.n/2 D 1  2nC3 C lCn  .1 C 2nC3/.1 C lCn/ ;
leading to
.1 C 3; 1 C 2lm/ D .1  ; 1 C 2l.mC3/=2/
when 1  m < l is odd. By induction again, we see that
.1 C 3; 1 C 2lm/ D
(
.1 C 3; 1 C 2l1/
if 3 −m;
.1 C 3; 1 C 2l3/
if 3 j m:
Let a 2 L2 satisfy a2  a C 2 D 0 (such a exist by Hensel’s Lemma). Then
1 C 3 D 12 C   1  a    a2 is a norm from L2.
p
1 C 2l1/, so the ﬁrst symbol
is 1. In a similar way as before, we see that norms from L2.
p
1 C 2l3/ are of
the form x2 C 2xy  y2. A consideration modulo 4 shows that this can never
equal 1 C 3, so the second symbol is 1.
ut
Corollary 7.6 Let p  5 be a prime and set L D Q.21=p/ and L2 D Q2.21=p/. As
before, rW O
L ! O
L2 denotes the canonical map. If
(1) p2 −2p1  1,
(2) the class number of L is odd, and
(3) 4 −blog2 pc or z … im.r/, where z is the last element listed in Lemma 7.2,
then Fermat’s Last Theorem holds for the exponent p.
Proof We only have to show that the third condition here implies that im.r/\Z D ;.
By Lemma 7.5, we have (with l D p)
.  1; 1 C pC2/ D .  1; 1 C 2p1/ D 1 ;
which implies that the ﬁrst two elements of Z can never be images of global units.
We also have .  1; z/ D .1/blog2 pc, so we can also rule out z when blog2 pc is
odd. So we can now assume that blog2 pc  2 mod 4. Then by Lemma 7.5 again,

656
M. Stoll
we ﬁnd that .1 C 3; z/ D 1 (note that every other term in the sequence .p  2k/k
is divisible by 3), and we can again rule out z.
ut
Corollary 7.7 FLT holds for exponents 5, 7, 11, 13, 17, 19 and, assuming the
Generalized Riemann Hypothesis, also for exponents 23, 29, 31, 37, 41, 43, 47,
53 and 59.
Proof We use Magma [3] to check the assumptions (assuming GRH where indi-
cated to speed up the computation of the class group). It turns out that the class group
of Q.21=p/ is trivial for all primes considered. We note that p D 17; 19; 23; 29; 31 are
the only primes p up to 59 that satisfy 4 j blog2 pc, so we need a basis of O
L only
for these primes; for the remaining ones it sufﬁces to know that the class number is
odd.
ut
Remark 7.8 Computations show that the class group of Q.21=n/ is trivial for all
n  50 (assuming GRH for n  20), regardless whether n is prime or not. According
to class group heuristics [20, Sect. 4.1], the 2-torsion in the class group of a number
ﬁeld with unit rank u should behave like the cokernel of a random linear map
FnCu
2
! Fn
2 for large n (at least in absence of special effects leading to systematically
occurring elements of order 2). Such a map is surjective with probability > 1 2u,
so noting that u D .p  1/=2 in the case of interest, the ‘probability’ that the class
number of L is odd for all p is > 1  229 (assuming we know it for p  59). See
also [9].
We also remark that when the ﬁrst condition p2 −2p1  1 is not satisﬁed, the
criterion does still work when we replace O
L by the larger subgroup L.fpg; 2/ of L
represented by elements generating ideals of the form I2
1I2 with I2 supported on the
ideals above p. In this case, however, we also have to check that the map to L
2 is
injective. A similar remark applies to the case when the class group does have even
order.
8
An Application to Certain Generalized Fermat Equations
Recall the following statement, which is Lemma 3.1 and Prop. 3.3 in [7].
Proposition 8.1 (Dahmen and Siksek) Let p be an odd prime. If the only rational
points on the curve
C0
pW 5y2 D 4xp C 1
are the obvious three (namely 1, .1; 1/ and .1; 1/), then the only primitive integral
solutions of the generalized Fermat equation x5 C y5 D zp are the trivial ones:
.x; y; z/ D ˙.0; 1; 1/; ˙.1; 0; 1/; ˙.1; 1; 0/ :

Chabauty Without the Mordell-Weil Group
657
Dahmen and Siksek verify the assumption on C0
p.Q/ when p 2 f7; 19g and,
assuming GRH, also when p 2 f11; 13g. We will use our approach to extend the
range of primes p for which it can be shown that C0
p.Q/ has only the obvious three
rational points.
So we now consider the curves C0
l, with l D 2g C 1 odd, but not necessarily
prime. The corresponding étale algebra is still L D Q./ with  D 21=l (since C0
l
is the quadratic twist by 5 of y2 D 4xl C 1), but the descent map is now given on
a point on the Jacobian with Mumford representation Œa; b by the class of 5a./
(instead of a./) if the degree of a is odd.
It is still the case that C0
l has good reduction mod 2 (replacing y by 2y C 1 and
dividing by 4 gives 5.y2 C y/ D xl  1) and that there is no nontrivial 2-torsion
in J0
l.Q2/ nor in J0
l.F2/, where J0
l denotes the Jacobian of C0
l. We therefore have
a statement similar to Corollary 7.1. Note that we have again three residue disks,
centered at 1, .1; 1/ and .1; 1/, respectively.
If P0 2 C0
l.Q/, then we write DP0 for the residue disk centered at P0. We let
'P0W D0 ! DP0 be a parameterization of DP0 such that '.0/ D P0 (and such that
i1 ı '1 is odd).
Corollary 8.2 We have
q.i1.D1// D q.i1.'1.2Z
2 /// [ f0g
q.i.1;1/.D.1;1/// D q.i.1;1/.'.1;1/.2Z
2 [ 4Z
2 /// [ f0g
Proof This again follows from Corollary 3.9.
ut
The main difference with the case discussed in the previous section is that, if
l  7, the two points .1; ˙1/ do not map to points of ﬁnite order in J0
l under the
embedding that sends 1 to zero. So from now on, we assume that l  7. Note that
the rank of J0
5.Q/ is zero (the 2-Selmer group is trivial), so it is almost immediate
that C0
5.Q/ D f1; .1; ˙1/g.
We ﬁrst consider the image of C0
l.Q2/ in J0
l.Q2/=2J0
l.Q2/ under q ı i1.
Lemma 8.3 In terms of representatives in L
2 , we have
(1) 2.q.i1.D1/// D f1; 1 C 2l1g.
(2) 2.q.i1.D.1;1//// D f5.1 C 2/; 5.1 C 2 C lC2/g.
Proof By Corollary 8.2, we know that q.i1.D1// D q.i1.'1.2Z
2 ///[f0g, where
we can choose '1 such that x.'1.t// D 5t2. So let u 2 Z
2 , then 2.i1.'1.2u///
is represented by
5
 5
4u2 C 2

D
 5
2u
2 
1 C 4u2
5 2

 1 C 2l2  1 C 2l1 :
This proves (1).

658
M. Stoll
Now let P 2 D.1;1/. We can choose '.1;1/ such that x.'.1;1/.t// D 1Ct. If u 2 Z
2 ,
then 2.i1.'.1;1/.2u/// is represented by
5.1 C 2u C 2/  5.1 C 2 C ulC2/  5.1 C 2 C lC2/ ;
and for any u 2 Z2, 2.i1.'.1;1/.4u/// is represented by
5.1 C 4u C 2/  5.1 C 2 C u2lC2/  5.1 C 2/ :
This proves (2).
ut
Now we consider the embedding i.1;1/.
Lemma 8.4 In terms of representatives in L
2 , we have
2.q.i.1;1/.D.1;1//// D f1; 1 C lC2=.1 C 2/; ; 0g ;
where  D 2.Q/ for the point Q 2 Jl.Q2/ such that 2Q D '.1;1/.4/ and 0 D
2.Q0/ where 2Q0 D '.1;1/.4/.
Proof We make use of Corollary 8.2 again, which tells us that it sufﬁces to consider
points P with x-coordinates 1 C 2u or 1 C 4u, where u 2 Z
2 . If x D 1 C 2u, then
we have 2.i.1;1/.P// D 2.i1.P//  2.i1..1; 1///, which by the computation in
the proof of Lemma 8.3 is represented by
5.1 C 2/  5.1 C 2 C lC2/  1 C
lC2
1 C 2 :
If x D 1 C 4u, then i.1;1/.P/ is divisible by 2 in J0
l.Q2/, so we have to look at
2.Q/ where 2Q D P, for suitable values of u. Since i.1;1/.P/ 2 K2 n K3, we have
.i.1;1/.P// D 1, so by Corollary 3.2, 2.Q/ depends only on u mod 4, so the two
values u D 1 and u D 1 are sufﬁcient.
ut
In practice, it appears that  D 0 in all cases, which would be implied by the
difference of the images of any pair chosen from the relevant points being divisible
by 4. We know this difference is in K3, but we did not exclude the possibility that it
is only divisible by 2 and not by 4.
We can now formulate a criterion.
Proposition 8.5 Consider C0
lW 5y2 D 4xl C 1, with Jacobian J0
l, where l D 2g C 1
is odd and l  7. Recall that L D Q.21=l/; let S  L be a ﬁnite subgroup that
contains the image of Sel2 J0
l. Assume that
(1) the canonical map S ,! L ! L
2 is injective, and
(2) its image does not meet the set Z0 consisting of the classes of
1 C 2l1;
1 C
lC2
1 C 2 ;
;
0
in L
2 .

Chabauty Without the Mordell-Weil Group
659
Then C0
l.Q/ D f1; .1; 1/; .1; 1/g.
In particular, if l D p is a prime, then the generalized Fermat equation
x5 C y5 D zp
has no nontrivial coprime integral solutions.
Proof Note that Lemmas 8.3 and 8.4 imply that Z0 [ f1g is the union of the sets Y
occurring in Algorithm 4 when it is applied to the curve C0
l, so the assumptions
imply that the algorithm will not return FAIL. (There cannot be any elements in
Sel2 C other than the images of the known points, since this would lead to a non-
trivial intersection of Z0 with the image of S.) The set returned by the algorithm can
contain at most one point in each 2-adic residue disk. Since there are only three such
disks, the known points must account for all rational points on C0
l.
ut
Computing  and 0 for many values of l, it appears that their images in L
2 are
represented uniformly by an inﬁnite product
.1 C lC2/.1 C lC6/.1 C lC8/.1 C lC10/.1 C lC14/.1 C lC18/.1 C lC22/    ;
but it is not obvious which rule is behind the sequence .2; 6; 8; 10; 14; 18; 22; : : :/.
However, extending it further and consulting the OEIS [19] gives exactly one hit,
namely A036554, the sequence of ‘numbers n whose binary representation ends in
an odd number of zeros’, i.e., such that v2.n/ is odd. So we propose the following.
Conjecture 1 2./ (and also 2.0/) is represented by
Y
n1;2−v2.n/
.1 C lCn/  1 C
l
Q
k1.1 C 2k/ :
We give a more concrete version of the criterion, following the considerations of
Remark 4.2.
Corollary 8.6 Assume that l is prime and that l2 −2l1  1. Then a possible
choice of the subgroup S in Proposition 8.5 is the subgroup of L.f5g; 2/ consisting
of elements mapping into the image of J0
l.Q5/ in L
5 . In fact, the resulting criterion
is equivalent to what would be obtained by taking S to be the image of Sel2 J0
l.
Proof As in the case discussed in the preceding section, the assumption l2 −2l11
implies that the Tamagawa number at l is 1, so that we can reduce to ˙ D f2; 5g.
Furthermore, since 2 is totally ramiﬁed in L and L has odd degree, the norm of
any element ˛ 2 L whose valuation with respect to the prime above 2 is odd will
have odd 2-adic valuation and cannot be a square. This lets us reduce to L.f5g; 2/.
Remark 4.2 now shows that using S is equivalent to using Sel2 J0
l in the algorithm.
ut
We note that it is fairly easy to ﬁnd S, given L.f5g; 2/, since the image of J0
l.Q5/
in L
5 equals the image of J0
l.Q5/Œ2, unless there are elements of order 4 in J0
l.Q5/.

660
M. Stoll
We can easily exclude this by checking that the images of an F2-basis of J0
l.Q5/Œ2
are independent.
We carried out the computations necessary to test the criterion of Proposition 8.5
in the version of Corollary 8.6. This results in the following.
Theorem 8.7 For 7  p  53 prime, we have (assuming GRH when p  23)
C0
p.Q/ D f1; .1; 1/; .1; 1/g :
In particular, the generalized Fermat equation x5 C y5 D zp has only the trivial
coprime integral solutions.
9
An ‘Elliptic Chabauty’ Example
In this section, we apply our approach to ‘Elliptic Curve Chabauty’. The curve in
the following result comes up in the course of trying to ﬁnd all primitive integral
solutions to the Generalized Fermat Equation x2 C y3 D z25. It is a hyperelliptic
curve over Q of genus 4; it can be shown that the Mordell-Weil group of its Jacobian
has rank 4 (generators of a ﬁnite-index subgroup can be found), so that Chabauty’s
method does not apply directly to the curve.
Theorem 9.1 Let C be the smooth projective curve given by the afﬁne equation
y2 D 81x10 C 420x9 C 1380x8 C 1860x7 C 3060x6  66x5
C 3240x4  1740x3 C 1320x2  480x C 69 :
If GRH holds, then C.Q/ consists of the two points at inﬁnity only.
Proof As a ﬁrst step, we compute the fake 2-Selmer set as in [5]. We obtain a
one-element set (this requires local information only at the primes 2, 3 and 29).
Using [14, Lemma 6.3], we then show that the points in C.Q2/ whose image
in L
2 =Q
2 is the image of the unique element of the fake 2-Selmer set are those
whose x-coordinate has 2-adic valuation  3. This set is the union of two half
residue disks (the maximal residue disks contain the points P such that v2.x.P// 
2) that are mapped to each other by the hyperelliptic involution, so it is sufﬁcient
to consider just one of them, say the disk that contains P0 D 19, the point at inﬁnity
such that .y=x5/.P0/ D 9.
The splitting ﬁeld of the polynomial f on the right hand side of the curve equation
contains three pairwise non-conjugate subﬁelds k of degree 10 over which f is
divisible by a monic polynomial g 2 kŒx of degree 4. If P is any rational point
on C, then it follows that g.x.P// is a square in k (this is because the image of P in
the fake 2-Selmer set is the same as that of P0), so we obtain a point .; 
/ 2 H.k/
with  2 Q (or  D 1) where H is the smooth projective curve given by y2 D g.x/.

Chabauty Without the Mordell-Weil Group
661
We can parameterize the image of the residue disk around P0 by a pair of Laurent
series

.2t/1;
p
g..2t/1/

(where we can take the square root to have leading term
t2=4). Since H.k/ contains the two points at inﬁnity, H is isomorphic to an elliptic
curve E over k; we take the isomorphism so that it sends 11 2 H.k/ to the origin
of E. We then obtain a Laurent series .t/ 2 k..t// that gives the x-coordinate of the
image on E of the point whose parameter is t.
For the following, we take k to be the ﬁeld generated by a root of
x10 C 75x6  50x5 C 100x3 C 625x2 C 1250x C 645 I
the polynomial g and the curves H and E are taken with respect to this ﬁeld. We
next compute the 2-Selmer group of E over k. There is exactly one point of order 2
in E.k/, which means that we have to work with a quadratic extension of k. This
is where we use GRH, which allows us to ﬁnd the relevant arithmetic information
for this ﬁeld of degree 20 faster. The Selmer group has F2-dimension 6 (so the
bound for the rank of E.k/ is 5). We check that it injects into E.k2/=2E.k2/, where
k2 D k ˝Q Q2; note that this splits as a product of two extensions of Q2, both of
ramiﬁcation index 2 and one of residue class degree 1, the other of residue class
degree 4.
In the context of our method, we consider the curve that is the (desingularization
of) the curve over Q in A D Rk=QE (the latter denotes the Weil restriction of scalars)
that corresponds to the set of points on H whose x-coordinate is rational. We have
E.k2/ Š A.Q2/, so we can use arithmetic on E over k and its completions for the
computations. We check that ntors D 1 (the map from E.k2/Œ2 to E.k2/=2E.k2/ is
injective). By Lemma 3.7, a suitable value of m is m D 4, provided 5  n4 in
the notation of the lemma. Note that in this situation halving points is easy, since
doubling a point corresponds to an explicit map of degree 4 on the x-coordinate.
If P is in our half residue disk, then i.P/ C T (where T is the point of order 2 in
E.k/ D A.Q/) is not divisible by 2, and its image in A.Q2/=2A.Q2/ is the same as
that of T. So we only have to determine q.i.P// for a suitable selection of points P
in our disk. We write Pt for the point corresponding to the parameter t 2 2Z2.
We compute Yt D q.i.Pt// for t 2 f˙4; ˙8; ˙16g. Note that this can be done
solely in terms of the x-coordinate .t/. We ﬁnd that .i.Pt// D v2.t/  1 for these
values and that Yt D Yt. This implies that nm D m  1 for 2  m  4 and that q
of the disk in question is the union Y4 [ Y8 [ Y16. In fact, it turns out that this union
is equal to Y8, and we verify that Y8 meets the image of the 2-Selmer group only in
the image of the global torsion. By Theorem 2.6, this then implies that there can be
no other point than P0 in our (half) residue disk. The claim follows.
ut
We note that the two other possible choices of k also lead to elliptic curves with
a 2-Selmer rank of 5 (this is unconditional for one of the choices, where the curve E
happens to have full 2-torsion over k), but for these other ﬁelds, the condition that
the image of the disk under q meets the image of the Selmer group only in the image
of the global torsion is not satisﬁed. We also remark that we have been unable to ﬁnd
ﬁve independent points in E.k/ (for any of the three possible choices of k and E), so
that we could not apply the standard Elliptic Curve Chabauty method.

662
M. Stoll
Another application of our ‘Selmer group Chabauty’ approach in the setting of
Elliptic Curve Chabauty was made in [8]. We use this to show that there are no
unexpected points on the elliptic curve X0.11/ deﬁned over certain number ﬁelds
of degree 12 and such that the image under the j-map is in Q. This is a vital step
in the proof that the only nontrivial primitive integral solutions of the Generalized
Fermat Equation x2 C y3 D z11 are .x; y; z/ D .˙3; 2; 1/. The situation is similar
to what happens for the example presented here: we can compute the 2-Selmer
group of X0.11/ over the ﬁelds of interest, but we are unable to produce enough
independent points to meet the upper bound on the rank, so we cannot apply the
standard method.
Acknowledgements I would like to thank Bjorn Poonen for useful discussions and MIT for
its hospitality during a visit of two weeks in May 2015, when these discussions took place. All
computations were done using the computer algebra system Magma [3].
References
1. J.S. Balakrishnan, R.W. Bradshaw, K.S. Kedlaya, Explicit Coleman integration for hyperel-
liptic curves, in Algorithmic Number Theory. Lecture Notes in Computer Science, vol. 6197
(Springer, Berlin, 2010), pp. 16–31
2. M. Bhargava, B.H. Gross, The average size of the 2-Selmer group of Jacobians of hyperelliptic
curves having a rational Weierstrass point, in Automorphic Representations and L-Functions.
Tata Institute of Fundamental Research Studies in Mathematics, vol. 22 (Tata Institute of
Fundamental Research, Mumbai, 2013), pp. 23–91
3. W. Bosma, J. Cannon, C. Playoust, The Magma algebra system. I. The user language. J. Symb.
Comput. 24, 235–265 (1997)
4. N. Bruin, E.V. Flynn, Exhibiting SHA[2] on hyperelliptic Jacobians. J. Number Theory 118,
266–291 (2006)
5. N. Bruin, M. Stoll, Two-cover descent on hyperelliptic curves. Math. Comput. 78, 2347–2370
(2009)
6. N. Bruin, M. Stoll, The Mordell-Weil sieve: proving non-existence of rational points on curves.
LMS J. Comput. Math. 13, 272–306 (2010)
7. S.R. Dahmen, S. Siksek, Perfect powers expressible as sums of two ﬁfth or seventh powers.
Acta Arith. 164, 65–100 (2014)
8. N. Freitas, B. Naskre¸cki, M. Stoll, The generalized Fermat equation with exponents 2, 3, n.
Preprint (2017). arXiv:1703.05058 [math.NT]
9. W. Ho, A. Shankar, I. Varma, Odd degree number ﬁelds with odd class number. Preprint (2016).
arXiv:1603.06269
10. W.G. McCallum, On the method of Coleman and Chabauty. Math. Ann. 299, 565–596 (1994)
11. B. Poonen, M. Stoll, Most odd degree hyperelliptic curves have only one rational point. Ann.
Math. (2) 180, 1137–1166 (2014)
12. E.F. Schaefer, 2-Descent on the Jacobians of hyperelliptic curves. J. Number Theory 51, 219–
232 (1995)
13. E.F. Schaefer, M. Stoll, How to do a p-descent on an elliptic curve. Trans. Am. Math. Soc. 356,
1209–1231 (2004)
14. M. Stoll, Implementing 2-descent for Jacobians of hyperelliptic curves. Acta Arith. 98, 245–
277 (2001)

Chabauty Without the Mordell-Weil Group
663
15. M. Stoll, Independence of rational points on twists of a given curve. Compos. Math. 142,
1201–1214 (2006)
16. M. Stoll, Finite descent obstructions and rational points on curves. Algebra Number Theory 1,
349–391 (2007)
17. M. Stoll, Uniform bounds for the number of rational points on hyperelliptic curves of small
Mordell-Weil rank. J. Eur. Math. Soc. Preprint. arXiv:1307.1773 (to appear)
18. R. Taylor, A. Wiles, Ring-theoretic properties of certain Hecke algebras. Ann. Math. (2) 141,
553–572 (1995)
19. The On-Line Encyclopedia of Integer Sequences, http://oeis.org
20. A. Venkatesh, J.S. Ellenberg, Statistics of number ﬁelds and function ﬁelds, in Proceedings of
the International Congress of Mathematicians, vol. II (Hindustan Book Agency, New Delhi,
2010)
21. A. Wiles, Modular elliptic curves and Fermat’s last theorem. Ann. Math. (2) 141, 443–551
(1995)

An Explicit Theory of Heights for
Hyperelliptic Jacobians of Genus Three
Michael Stoll
Abstract We develop an explicit theory of Kummer varieties associated to Jaco-
bians of hyperelliptic curves of genus 3, over any ﬁeld k of characteristic ¤ 2.
In particular, we provide explicit equations deﬁning the Kummer variety K as
a subvariety of P7, together with explicit polynomials giving the duplication map
on K. A careful study of the degenerations of this map then forms the basis for the
development of an explicit theory of heights on such Jacobians when k is a number
ﬁeld. We use this input to obtain a good bound on the difference between naive and
canonical height, which is a necessary ingredient for the explicit determination of
the Mordell-Weil group. We illustrate our results with two examples.
Keywords Kummer variety • Hyperelliptic curve • Genus 3 • Canonical height
Subject Classiﬁcations: 14H40, 14H45, 11G10, 11G50, 14Q05, 14Q15
1
Introduction
The goal of this paper is to take up the approaches used to deal with Jacobians
and Kummer surfaces of curves of genus 2 by Cassels and Flynn [4] and by the
author [14, 16] and extend them to hyperelliptic curves of genus 3. We always
assume that the base ﬁeld k has characteristic ¤ 2. A hyperelliptic curve C over k
of genus 3 is then given by an equation of the form y2 D f.x/, where f is a
squarefree polynomial of degree 7 or 8 with coefﬁcients in k; we take C to be
the smooth projective curve determined by this afﬁne equation. We denote the
Jacobian variety of C by J. Identifying points with their negatives on J, we
obtain the Kummer variety of J. It is known that the morphism J ! P7 given
M. Stoll ()
Mathematisches Institut, Universität Bayreuth, 95440 Bayreuth, Germany
e-mail: Michael.Stoll@uni-bayreuth.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_29
665

666
M. Stoll
by the linear system j2j on J (where  denotes the theta divisor) induces an
isomorphism of the Kummer variety with the image of J in P7; we denote the
image by K 	 P7. Our ﬁrst task is to ﬁnd a suitable basis of the Riemann-Roch
space L.2/ and to give explicit equations deﬁning K, thereby completing earlier
work by Stubbs [18], Duquesne [5] and Müller [9, 11]. To this end, we make use of
the canonical identiﬁcation of J with X D Pic4.C / and realize the complement
of  in X as the quotient of an explicit 6-dimensional variety V in A15 by the
action of a certain group . This allows us to identify the ring of regular functions
on X n  with the ring of  -invariants in the coordinate ring of V. In this way,
we obtain a natural basis of L.2/, and we ﬁnd the quadric and the 34 quartics that
deﬁne K ; see Sect. 2. We give the relation between the coordinates chosen here and
those used in previous work and discuss how transformations of the curve equation
induced by the action of GL.2/ on .x; z/ act on our coordinates; see Sect. 3. We then
give a recipe that allows to decide whether a k-rational point on K comes from a
k-rational point on J (Sect. 4).
The next task is to describe the maps K
! K and Sym2 K
! Sym2 K
induced by multiplication by 2 and by fP; Qg 7! fP C Q; P  Qg on J. We use
the approach followed in [14]: we consider the action of a double cover of the
2-torsion subgroup J Œ2 on the coordinate ring of P7. This induces an action
of J Œ2 itself on forms of even degree. We use the information obtained on the
various eigenspaces and the invariant subspaces in particular to obtain an explicit
description of the duplication map ı and of the sum-and-difference map on K. The
study of the action of J Œ2 is done in Sects. 5 and 6; the results on the duplication
map and on the sum-and-difference map are obtained in Sects. 7 and 8, respectively.
In Sect. 9, we then study the degeneration of these maps that occur when we allow
the curve to acquire singularities. This is relevant in the context of bad reduction
and is needed as input for the results on the height difference bound.
We then turn to the topic motivating our study, which is the canonical height Oh
on the Jacobian, and, in particular, a bound on the difference h  Oh between naive
and canonical height. Such a bound is a necessary ingredient for the determination
of generators of the Mordell-Weil group J .k/ (where k now is a number ﬁeld;
in practice, usually k D Q), given generators of a ﬁnite-index subgroup. The
difference h  Oh can be expressed in terms of the local ‘loss of precision’ under ı
at the various primes of bad reduction and the archimedean places of k. In analogy
with [14], we obtain an estimate for this local ‘loss of precision’ in terms of the
valuation of the discriminant of f. This is one of the main results of Sect. 10,
together with a statement on the structure of the local ‘height correction function’,
which is analogous to that obtained in [16, Thm. 4.1]. These results allow us to
obtain reasonable bounds for the height difference. We illustrate this by determining
generators of the Mordell-Weil group of the Jacobian of the curve y2 D 4x74xC1.
We then use this result to determine the set of integral solutions of the equation
y2  y D x7  x, using the method of [3]; see Sect. 11.
In addition, we show in Sect. 12 how one can obtain better bounds (for a
modiﬁed naive height) when the polynomial deﬁning the curve is not primitive.
As an example, we determine explicit generators of the Mordell-Weil group of the

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
667
Jacobian of the curve given by the binomial coefﬁcient equation
 
y
2
!
D
 
x
7
!
:
We have made available at [17] ﬁles that can be read into Magma [1] and provide
explicit representations of the quartics deﬁning the Kummer variety, the matrices
giving the action of 2-torsion points, the polynomials deﬁning the duplication map
and the matrix of bi-quadratic forms related to the ‘sum-and-difference map’. We
have also made available the ﬁle Kum3-verification.magma, which, when
loaded into Magma, will perform the computations necessary to verify a number of
claims made throughout the paper. These claims are marked by a star, like thisF.
2
The Kummer Variety
We consider a hyperelliptic curve of genus 3 over a ﬁeld k of characteristic different
from 2, given by the afﬁne equation
C W y2 D f8x8 C f7x7 C : : : C f1x C f0 D f.x/ ;
where f is a squarefree polynomial of degree 7 or 8. (We do not assume that C has
a Weierstrass point at inﬁnity, which would correspond to f having degree 7.) Let
F.x; z/ denote the octic binary form that is the homogenization of f; F is squarefree.
Then the equation y2 D F.x; z/ deﬁnes a smooth model of C in the weighted
projective plane P2
1;4;1. Here x and z have weight 1 and y has weight 4. We denote
the hyperelliptic involution on C by 	, so that 	.x W y W z/ D .x W y W z/.
As in the introduction, we denote the Jacobian variety of C by J. We would like
to ﬁnd an explicit version of the map
J ! P7
given by the linear system of twice the theta divisor; it embeds the Kummer variety
J =f˙1g into P7. We denote the image by K.
We note that the canonical class W on C has degree 4. Therefore J D Pic0
C is
canonically isomorphic to X D Pic4
C , with the isomorphism sending D to D C W.
Then the map induced by 	 on X corresponds to multiplication by 1 on J. There
is a canonical theta divisor on Pic0
C whose support consists of the divisor classes of
the form Œ.P1/ C .P2/  m, where m is the class of the polar divisor .x/1; we have
W D 2m. The support of the theta divisor is the locus of points on X that are not
represented by divisors in general position, where an effective divisor D on C is in
general position unless there is a point P 2 C such that D  .P/C.	P/. This can be
seen as follows. The image on X of a point Œ.P1/ C .P2/  m on the theta divisor
is represented by all effective divisors of the form .P1/ C .P2/ C .P/ C .	P/ for an
arbitrary point P 2 C. If P2 ¤ 	P1, then the Riemann-Roch Theorem implies that

668
M. Stoll
the linear system containing these divisors is one-dimensional, and so all divisors
representing our point on X have this form; in particular, there is no representative
divisor in general position. If P2 D 	P1, then the linear system has dimension 2 and
consists of all divisors of the form .P/ C .	P/ C .P0/ C .	P0/, none of which is in
general position.
We identify J and X, and we denote the theta divisor on J and its
image on X by . We write L.n/ for the Riemann-Roch space L.X ; n/ Š
L.J ; n/, where n  0 is an integer. It is known that dim L.n/ D n3. Since
 is symmetric, the negation map acts on L.n/ (via  7! .P 7! .P//), and
it makes sense to speak of even and odd functions in L.n/ (with respect to this
action). We write L.n/C for the subspace of even functions. It is known that
dim L.n/C D n3=2 C 4 for n even and dim L.n/C D .n3 C 1/=2 for n odd.
We can parameterize effective degree 4 divisors in general position as follows.
Any such divisor D is given by a binary quartic form A.x; z/ specifying the image
of D on P1 under the hyperelliptic quotient map W C ! P1, .x W y W z/ 7! .x W z/,
together with another quartic binary form B.x; z/ such that y D B.x; z/ on the points
in D, with the correct multiplicity. (Note that by the ‘general position’ condition, y is
uniquely determined by x and z for each point in the support of D.) More precisely,
we must have that
B.x; z/2  A.x; z/C.x; z/ D F.x; z/
(1)
for a suitable quartic binary form C.x; z/. We then have a statement analogous to
that given in [4, Chap. 4] for Pic3 of a curve of genus 2; see Lemma 2.1 below.
Before we can formulate it, we need some notation.
We let Q be the ternary quadratic form x2
2  x1x3. We write
D D
0
@
0 0 1
0 2 0
1 0 0
1
A
(2)
for the associated symmetric matrix (times 2) and
 D SO.Q/ D f 2 SL.3/ W D> D DgI
then  D O.Q/nSO.Q/, and ˙ D O.Q/. We have the following elements in 
(for arbitrary  and  in the base ﬁeld):
t D
0
@
 0
0
0 1
0
0 0 1
1
A ;
n D
0
@
1  2
0 1 2
0 0 1
1
A
and
w D
0
@
0 0 1
0 1 0
1 0 0
1
A I
these elements generate  .
Lemma 2.1 Two triples .A; B; C/ and .A0; B0; C0/ satisfying (1) specify the same
point on X if and only if .A0; B0; C0/ D .A; B; C/ for some  2 . They represent

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
669
opposite points (with respect to the involution on X induced by 	) if and only if the
relation above holds for some  2 .
Proof We ﬁrst show that two triples specifying the same point are in the same  -
orbit. Let D and D0 be the effective divisors of degree 4 given by A.x; z/ D 0,
y D B.x; z/ and by A0.x; z/ D 0, y D B0.x; z/, respectively. By assumption, D
and D0 are linearly equivalent, and they are both in general position. If D and D0
share a point P in their supports, then subtracting P from both D and D0, we obtain
two effective divisors of degree 3 in general position that are linearly equivalent.
Since such divisors are non-special, they must be equal, hence D D D0. So A and A0
agree up to scaling, and B0  B is a multiple of A:
A0 D A;
B0 D B C A;
C0 D 1.C C 2B C 2A/ I
then .A0; B0; C0/ D .A; B; C/nt. So we can now suppose that the supports of D
and D0 are disjoint. Then, denoting by 	D0 the image of D0 under the hyperelliptic
involution, DC	D0 is a divisor of degree 8 in general position, which is in twice the
canonical class, so it is linearly equivalent to 4m. Since the Riemann-Roch space
of that divisor on C is generated (in terms of the afﬁne coordinates obtained by
setting z D 1) by 1; x; x2; x3; x4; y, there is a function of the form y  QB.x; 1/ with QB
homogeneous of degree 4 that has divisor D C 	D0  4m. Equivalently, D C 	D0 is
the intersection of C with the curve given by y D QB.x; z/. This implies that QB2  F
is a constant times AA0. Up to scaling A0 and C0 by  and 1 for a suitable  (this
corresponds to acting on .A0; B0; C0/ by t 2  ), we have
QB2  AA0 D F ;
so that .A; QB; A0/ corresponds to D and .A0; QB; A/ corresponds to D0. The argument
above (for the case D D D0) shows that .A; B; C/ and .A; QB; A0/ are in the same
 -orbit, and the same is true of .A0; B0; C0/ and .A0; QB; A/. Finally,
.A0; QB; A/ D .A; QB; A0/w :
Conversely, it is easy to see that the generators of  given above do not change
the linear equivalence class of the associated divisor: the ﬁrst two do not even change
the divisor, and the third replaces D by the linearly equivalent divisor 	D0, where
D C D0  2W is the divisor of y  B.x; z/ on C.
For the last statement, it sufﬁces to observe that .A; B; C/ gives the point
opposite to that given by .A; B; C/; the associated matrix is t1 2 .
ut
We write A, B, C as follows.
A.x; z/ D a4x4 C a3x3z C a2x2z2 C a1xz3 C a0z4
B.x; z/ D b4x4 C b3x3z C b2x2z2 C b1xz3 C b0z4
C.x; z/ D c4x4 C c3x3z C c2x2z2 C c1xz3 C c0z4

670
M. Stoll
and use a0; : : : ; a4; b0 : : : ; b4; c0; : : : ; c4 as afﬁne coordinates on A15. We arrange
these coefﬁcients into a matrix
L D
0
@
a0 a1 a2 a3 a4
b0 b1 b2 b3 b4
c0 c1 c2 c3 c4
1
A :
(3)
Then  2 ˙ acts on A15 via multiplication by > on the left on L. Since there is
a multiplicative group sitting inside  acting by .A; B; C/   D .A; B; 1C/, any
 -invariant polynomial must be a linear combination of monomials having the same
number of ai and cj. Hence in any term of a homogeneous  -invariant polynomial
of degree d, the number of factors bi has the same parity as d. This shows that such
a  -invariant polynomial is even with respect to 	 if d is even, and odd if d is odd.
It is not hard to see that there are no  -invariant polynomials of degree 1: by
the above, they would have to be a linear combination of the bi, but the involution
.A; B; C/ 7! .C; B; A/ D .A; B; C/w negates all the bi. It is also not hard to check
that the space of invariants of degree 2 is spanned by the coefﬁcients of the quadratic
form
B2
l  AlCl 2 Sym2hx0; x1; x2; x3; x4i ;
where
Al D a0x0 C a1x1 C a2x2 C a3x3 C a4x4
Bl D b0x0 C b1x1 C b2x2 C b3x3 C b4x4
Cl D c0x0 C c1x1 C c2x2 C c3x3 C c4x4
are linear forms in ﬁve variables. We write
B2
l  AlCl D
X
0ij4

ijxixj ;
so that 
ii D b2
i  aici and for i < j, 
ij D 2bibj  aicj  ajci. Up to scaling, the
quadratic form corresponds to the symmetric matrix
L>DL D
0
BBBBB@
2
00 
01

02

03

04

01 2
11 
12

13

14

02

12 2
22 
23

24

03

13

23 2
33 
34

04

14

24

34 2
44
1
CCCCCA
;
(4)

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
671
and the image Q of the map qW A15 ! Sym2 A5 given by this matrix consists of
the matrices of rank at most 3; it is therefore deﬁned by the 15 different quartics
obtained as 4  4-minors of this matrix.
Scaling x by  corresponds to scaling aj; bj; cj by j. This introduces another
grading on the coordinate ring of our A15; we call the corresponding degree the
weight. We then have wt.aj/ D wt.bj/ D wt.cj/ D j and therefore wt.
ij/ D i C j.
The 15 quartics deﬁning Q have weights
12; 13; 14; 14; 15; 15; 16; 16; 16; 17; 17; 18; 18; 19; 20 :
We will reserve the word degree for the degree in terms of the 
ij; then it makes
sense to set deg.aj/ D deg.bj/ D deg.cj/ D 1
2.
We let V 	 A15 be the afﬁne variety given by (1). The deﬁning equations of V
then read
b2
0  a0c0 D f0
2b0b1  .a0c1 C a1c0/ D f1
2b0b2 C b2
1  .a0c2 C a1c1 C a2c0/ D f2
2b0b3 C 2b1b2  .a0c3 C a1c2 C a2c1 C a3c0/ D f3
2b0b4 C 2b1b3 C b2
2  .a0c4 C a1c3 C a2c2 C a3c1 C a4c0/ D f4
2b1b4 C 2b2b3  .a1c4 C a2c3 C a3c2 C a4c1/ D f5
2b2b4 C b2
3  .a2c4 C a3c3 C a4c2/ D f6
2b3b4  .a3c4 C a4c3/ D f7
b2
4  a4c4 D f8 :
In terms of the 
ij, we have

00 D f0;

01 D f1;

02 C 
11 D f2;

03 C 
12 D f3;

04 C 
13 C 
22 D f4;

14 C 
23 D f5;

24 C 
33 D f6;

34 D f7;

44 D f8 I
in particular, the image of V under q is a linear ‘slice’ W of Q, cut out by
the nine linear equations above (recall that the 
ij are coordinates on the ambient
space Sym2 A5 of Q). It is then natural to deﬁne deg.fj/ D 1 and wt.fj/ D j.
By Lemma 2.1, the quotient V = of V by the action of  can be identiﬁed with
U WD X n , the complement of the theta divisor in X. Since the map q is given
by ˙ -invariants, we obtain a surjective morphism K n ./ ! W. We will see
that it is actually an isomorphism.
Functions in the Riemann-Roch space L.n/ will be represented by  -invariant
polynomials in the ai, bi, ci. Similarly, functions in the even part L.n/C of this
space are represented by ˙ -invariant polynomials. A  -invariant polynomial that
is homogeneous of degree n in the ai, bi, ci will conversely give rise to a function
in L.n/. Modulo the relations deﬁning V , there are six independent such invariants

672
M. Stoll
of degree 2. We choose

02; 
03; 
04; 
13; 
14; 
24
as representatives. As mentioned above, invariants of even degree are ˙ -invariant
and so give rise to even functions on X with respect to 	, whereas invariants of odd
degree give rise to odd functions on X. Together with the constant function 1, we
have found seven functions in L.2/ D L.2/C. Since dim L.2/ D 23 D 8, we
are missing one function. We will see that is given by some quadratic form in the 
ij
above, with the property that it does not grow faster than them when we approach .
To ﬁnd this quadratic form, we have to ﬁnd out what .
02 W 
03 W : : : W 
24/ tends
to as we approach the point represented by .x1; y1/ C .x2; y2/ C m on X. A suitable
approximation, taking y D `.x/ to be the line interpolating between the two points,
B.x; 1/ D .x  x0/.x  x1/.x  x2/ C `.x/ ;
A0.x/ D .x  x1/.x  x2/, '˙.x/ D .f.x/ ˙ `.x/2/=A0.x/2,  .x/ D `.x/=A0.x/, and
A.x; 1/ D A0.x/

2.x  x0/2 C

2 .x0/  '0
C.x0/

.x  x0/  '.x0/ C O.1/

;
shows thatF

02 D 2.x1x2/2 C O./

03 D 2.x1 C x2/x1x2 C O./

04 D 2x1x2 C O./

13 D 2.x2
1 C x2
2/ C O./

14 D 2.x1 C x2/ C O./

24 D 2 C O.1/
as  ! 1. There are various quadratic expressions in these that grow at most
like 3, namely
2
04
24 C 
13
24  
2
14;

03
24  
04
14;

02
24  
2
04;

02
14  
03
04;
2
02
04 C 
02
13  
2
03
(they provide ﬁve independent even functions in L.3/ modulo L.2/) and

 D 
02
24  
03
14 C 
2
04 C 
04
13 ;
(5)

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
673
which in fact only grows like 2 and therefore gives us the missing basis element
of L.2/. We ﬁnd thatF

 D 2 G.x1; x2/  2y1y2
.x1  x2/2
C O./ ;
where
G.x1; x2/ D 2
4
X
jD0
f2j.x1x2/j C .x1 C x2/
3
X
jD0
f2jC1.x1x2/j :
(Note the similarity with the fourth Kummer surface coordinate in the genus 2 case;
see [4].)
The map X ! P7 we are looking for is then given by
.1 W 
24 W 
14 W 
04 W 
04 C 
13 W 
03 W 
02 W 
/ :
We use .1; : : : ; 8/ to denote these coordinates (in the given order). The reason for
setting 5 D 
04 C 
13 rather than 
13 is that this leads to nicer formulas later on.
For example, we then have the simple quadratic relation
18  27 C 36  45 D 0 :
(6)
Regarding degree and weight, we have, writing  D .1; 2; : : : ; 8/, that
deg./ D .0; 1; 1; 1; 1; 1; 1; 2/
and
wt./ D .0; 6; 5; 4; 4; 3; 2; 8/ :
It is known that the image K
of the Kummer variety in P7 of a generic
hyperelliptic Jacobian of genus 3 is given by a quadric and 34 independent quartic
relations that are not multiples of the quadric; see [11, Thm. 3.3]. (For this, we
can work over an algebraically closed ﬁeld, so that we can change coordinates
to move one of the Weierstrass points to inﬁnity so that we are in the setting
of [11].) The quadric is just (6). It is also known [11, Prop. 3.1] that K is deﬁned
by quartic equations. Since there are 36 quartic multiples of the quadric (6), the
space of quartics in eight variables has dimension 330 and the space L.8/C has
dimension 260, there must be at least 34 further independent quartics vanishing
on K : the space of quartics vanishing on K is the kernel of Sym4 L.2/ !
L.8/C, which has dimension  70. We can ﬁnd these quartics as follows.

674
M. Stoll
There are 15 quartic relations in .1; 2; 3; 4; 5; 6; 7/ coming from the quartics
deﬁning Q. They are given by the 4  4 minors of the matrix (4), which restricted
to V is
M D
0
BBBBB@
2f01
f11
7
6
4
f11 2.f21  7/
f31  6
5  4
3
7
f31  6
2.f41  5/
f51  3
2
6
5  4
f51  3
2.f61  2/ f71
4
3
2
f71
2f81
1
CCCCCA
:
(7)
Since these relations do not involve 8, they cannot be multiples of the quadratic
relation. We ﬁnd 55 further independent quartics vanishing on K (and thence a
basis of the ‘new’ space of quartics that are not multiples of the quadratic relation)
by searching for polynomials of given degree and weight that vanish on V when
pulled back to A15. Removing those that are multiples of the invariant quadric, we
obtain quartics with the following 34 pairs of degree and weight:
deg D 4W
wt D 12; 13; 14; 14; 15; 15; 16; 16; 16; 17; 17; 18; 18; 19; 20I
deg D 5W
wt D 17; 18; 18; 19; 19; 20; 20; 20; 21; 21; 22; 22; 23I
deg D 6W
wt D 22; 23; 24; 24; 25; 26:
(Recall that ‘degree’ refers to the degree in terms of the original 
ij.) These quartics
are given in the ﬁle Kum3-quartics.magma at [17]. The quartics are scaled so
that their coefﬁcients are in ZŒf0; : : : ; f8. The 15 quartics of degree 4 are exactly
those obtained as 4  4-minors of the matrix M above.
Lemma 2.2 Let f0; : : : ; f8 2 k be arbitrary. Then the 70 quartics constructed as
described above are linearly independent over k.
Proof We can ﬁndF 70 monomials such that the 70  70-matrix formed by the
coefﬁcients of the quartics with respect to these monomials has determinant ˙1. ut
Note that regarding k, this is a slight improvement over [11, Lemma 3.2], where
k was assumed to have characteristic ¤ 2; 3; 5.
We now show that these quartics indeed give all the relations.
Lemma 2.3 The natural map Sym2 L.4/C ! L.8/C is surjective.
Proof Mumford shows [13, §4, Thm. 1] that Sym2 L.4/ ! L.8/ is surjective.
The proof can be modiﬁed to give the corresponding result for the even subspaces,
as follows (notations as in [13]). We work with the even functions ıaCb C ıab and

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
675
ıab C ıaCb. This gives
X

2Z2
l.
/.ıaCbC
 C ıab
/  .ıabC
 C ıaCb
/
D
 X

2Z2
l.
/q1.b C 
/
 X

2Z2
l.
/.ıaC
 C ıa
/

C
 X

2Z2
l.
/q1.a C 
/
 X

2Z2
l.
/.ıbC
 C ıb
/

:
We ﬁx the homomorphism lW Z2 ! f˙1g and the class of a mod K.ı/. By (*) in [13,
p. 339] there is some b in this class such that P

 l.
/q.b C 
/ ¤ 0. Taking a D b,
we see that
.b/ WD
X

l.
/.ıbC
 C ıb
/
is in the image. Using this, we see that for all other a in the class, .a/ is also in the
image. Inverting the Fourier transform, we ﬁnd that all ıa C ıa are in the image,
which therefore consists of all even functions.
ut
Corollary 2.4 The natural map Sym4 L.2/ ! L.8/C is surjective.
Proof Note that L.2/ D L.2/C, so the image of Sym4 L.2/ ! L.8/ is
contained in the even subspace. Since there is exactly one quadratic relation, the map
Sym2 L.2/ ! L.4/C is not surjective, but has a one-dimensional cokernel. We
will see below in Sect. 7 that this cokernel is generated by the image of a function #
such that ij# (for all i; j) and #2 can be expressed as quartics in the i. This implies
that the image of the map in the statement contains the image of Sym2 L.4/C, and
surjectivity follows from Lemma 2.3. Note that once we have found # explicitly,
the assertions relating to it made above can be checked directly and without relying
on the considerations leading to the determination of #.
ut
Theorem 2.5 Let k be a ﬁeld of characteristic different from 2 and let F 2 kŒx; z be
homogeneous of degree 8 and squarefree. Then the image K in P7 of the Kummer
variety associated to the Jacobian variety of the hyperelliptic curve y2 D F.x; 1/ is
deﬁned by the quadric (6) and the 34 quartics constructed above.
Proof By Corollary 2.4 the dimension of the space of quartics vanishing on K
is 70. By Lemma 2.2 the quadric and the 34 quartics give rise to 70 independent
quartics vanishing on K. By [11, Prop. 3.1] K can be deﬁned by quartics, so the
claim follows.
ut
This improves on [11, Thm. 3.3] by removing the genericity assumption (and
allowing characteristic 3 or 5).
To conclude this section, we determine the images of some special points on J
under the map to K.

676
M. Stoll
The discussion on p. 672 shows that on a point Œ.x1; y1/ C .x2; y2/ C m 2 , the
map restricts to

0 W 1 W .x1 C x2/ W x1x2 W x2
1 C x1x2 C x2
2
W .x1 C x2/x1x2 W .x1x2/2 W 2y1y2  G.x1; x2/
.x1  x2/2

:
If we write .X  x1/.X  x2/ D 0X2 C 1X C 2, then this can be written as
.0 W 2
0 W 01 W 02 W 2
1  02 W 12 W 2
2 W 8/ ;
where, rewriting

.x1  x2/28  G.x1; x2/
2 D 4F.x1; 1/F.x2; 1/, we have that
.2
1  402/2
8
C .4f04
0  2f13
0 1 C 4f23
0 2  2f32
0 12 C 4f42
0 2
2
 2f5012
2 C 4f603
2  2f713
2 C 4f84
2 /8
C .4f0f2 C f 2
1 /6
0 C 4f0f35
0 1  2f1f35
02  4f0f44
0 2
1
C .4f0f5 C 4f1f4/4
0 12 C .4f0f6 C 2f1f5  4f2f4 C f 2
3 /4
0 2
2
C 4f0f53
0 3
1 C .8f0f6  4f1f5/3
0 2
1 2 C .8f0f7  4f1f6 C 4f2f5/3
012
2
C .2f1f7  2f3f5/3
0 3
2  4f0f62
0 4
1 C .12f0f7 C 4f1f6/2
0 3
1 2
C .16f0f8 C 8f1f7  4f2f6/2
0 2
1 2
2 C .8f1f8  4f2f7 C 4f3f6/2
0 13
2
C .4f2f8 C 2f3f7  4f4f6 C f 2
5 /2
04
2 C 4f0f705
1
C .16f0f8  4f1f7/04
1 2 C .12f1f8 C 4f2f7/03
1 2
2
C .8f2f8  4f3f7/02
1 3
2 C .4f3f8 C 4f4f7/014
2  2f5f705
2
 4f0f86
1 C 4f1f85
1 2  4f2f84
1 2
2 C 4f3f83
1 3
2  4f4f82
14
2
C 4f5f815
2 C .4f6f8 C f 2
7 /6
2
D 0 :
(This is similar to the quartic deﬁning the Kummer surface in the genus 2 case.) The
image on K of the theta divisor is a surface of degree 12 in P6 D P7 \ f1 D 0g;
the intersection of K with the hyperplane 1 D 0 is twice the image of . (The

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
677
equation above is cubic in the middle six coordinates and 8, so we get three times
the degree of the Veronese surface. It is known that K has degree 24.)
When .x2; y2/ approaches .x1; y1/, then the last coordinate tends to inﬁnity,
whereas the remaining ones stay bounded, so the origin on J is mapped to
o WD .0 W 0 W 0 W 0 W 0 W 0 W 0 W 1/ :
Points in J Œ2 are represented by factorizations F D GH with d D deg G even,
compare Sect. 5 below. Writing
G D gdxd Cgd1xd1zC: : :Cg0zd and H D h8dx8d Ch7dx7dzC: : : Ch0z8d ;
we see that a 2-torsion point represented by .G; H/ with deg G D 2 maps to
.0 W g2
2 W g1g2 W g0g2 W g2
1g0g2 W g0g1 W g2
0 W g3
0h6Cg2
0g2h4Cg0g2
2h2Cg3
2h0/ :
(8)
A 2-torsion point represented by .G; H/ with deg G D 4 maps to

1 W g2h4 C g4h2 W g1h4 C g4h1 W g0h4 C g4h0
(9)
W g0h4 C g4h0 C g1h3 C g3h1 W g0h3 C g3h0 W g0h2 C g2h0
W .g0h4 C g4h0/2 C .g0h2 C g2h0/.g2h4 C g4h2/ C .g1h0  g0h1/.g4h3  g3h4/ I
this is obtained by taking .A; B; C/ D .G; 0; H/ in our original parameterization.
3
Transformations
We compare our coordinates for the Kummer variety with those of Stubbs [18],
Duquesne [5] and Müller [9] in the special case f8 D 0. In this case there is a rational
Weierstrass point at inﬁnity, and we can ﬁx the representation of a point outside
of  by requiring that A vanishes at inﬁnity and that deg B.x; 1/ < deg A.x; 1/. For
a generic point P on J, deg A.x; 1/ D 3; let .xj; yj/ for j D 1; 2; 3 be the three points
in the effective divisor D such that P D ŒD  3  1. Generically, the three points
are distinct. Then
A.x; 1/ D .x  x1/.x  x2/.x  x3/

678
M. Stoll
and B.x; 1/ is the interpolation polynomial such that B.xj; 1/ D yj for j D 1; 2; 3.
We obtain the cj from C D .B2  F/=A by polynomial division. This leads toF
1 D
1
2 D
f72
3 D
f73
4 D
f74
5 D f41 C f52 C 2f63 C 3f74  5
6 D f31 C f42 C
f53
 6
7 D f21

f43  3f54
 7
8 D
f2f72  f3f73  f4f74
C f78
where 1; 2; : : : ; 8 are the coordinates used by the other authors.
We consider the effect of a transformation of the curve equation. First suppose
that QF.x; z/ D F.x C z; z/ (corresponding to a shift of the x-coordinate in the afﬁne
equation). A point represented by a triple .A.x; z/; B.x; z/; C.x; z// of polynomials
will correspond to the point .QA.x; z/; QB.x; z/; QC.x; z// with QA.x; z/ D A.xCz; z/ and
analogously for QB and QC. We obtainF
Q1 D 1
Q2 D 2 C 3f71 C 122f81
Q3 D 3 C 22 C 32f71 C 83f81
Q4 D 4 C 3 C 22 C 3f71 C 24f81
Q5 D 5 C .2f51 C 33/ C 2.6f61 C 32/ C 173f71 C 344f81
Q6 D 6 C .34 C 5/ C 2.f51 C 33/ C 3.2f61 C 22/ C 54f71 C 85f81
Q7 D 7 C .f31 C 26/ C 2.2f41 C 34 C 5/ C 3.4f51 C 23/
C 4.6f61 C 2/ C 95f71 C 126f81
Q8 D 8 C .f32 C 2f54 C 3f77/
C 2.3f3f71 C 2f42 C f53 C 6f64 C 3f76 C 12f87/
C 3..12f3f8 C 6f4f7/1 C 4f52 C 4f63 C 17f74 C f75 C 16f86/
C 4..24f4f8 C 11f5f7/1 C 8f62 C 12f73 C 46f84 C 6f85/
C 5..44f5f8 C 18f6f7/1 C 16f72 C 32f83/
C 6..68f6f8 C 29f 2
7 /1 C 32f82/ C 1487f7f81 C 1488f 2
8 1 :

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
679
For the transformation given by QF.x; z/ D F.z; x/, we have
Qaj D a4j;
Qbj D b4j;
Qcj D c4j
and therefore
.Q1; Q2; Q3; Q4; Q5; Q6; Q7; Q8/ D .1; 7; 6; 4; 5; 3; 2; 8/ :
More generally, consider an element
 D
r s
t u

2 GL.2/
acting by .x; z/ 7! .rx C sz; tx C uz/. Let ˙ 2 GL.5/ be the matrix whose columns
are the coefﬁcients of .rx C sz/j.tx C uz/4j, for j D 0; 1; 2; 3; 4 (this is the matrix
giving the action of  on the fourth symmetric power of the standard representation
of GL.2/). Recall the matrix L from (3) whose rows contain the coefﬁcients of A,
B and C. Then the effect on our variables ai, bi, ci is given by L 7! L˙>. With D
as in (2), we have L>DL D M with M as in (7). So the effect of  on M is given
by M 7! ˙M˙>. Note that Q1 D 1 and that we can extract Q2; : : : ; Q7 from M;
to get Q8 when 1 is not invertible, we can perform a generic computation and then
specialize.
This allows us to reduce our more general setting to the situation when there is
a Weierstrass point at inﬁnity: we adjoin a root of F.x; 1/, then we shift this root to
zero and invert. This leads to an equation with f8 D 0. This was used to obtain the
matrix representing the action of an even 2-torsion point in Sect. 5 below.
4
Lifting Points to the Jacobian
Let P 2 K .k/ be a k-rational point on the Kummer variety. We want to decide if
P D .P0/ for a k-rational point P0 on the Jacobian J. Consider an odd function h
on J (i.e., such that h.Q/ D h.Q/ for Q 2 J ) such that h is deﬁned over k;
then h.P0/ 2 k (or h as a pole at P0). Since h2 is an even function, it descends to a
function on K, and we must have that h2.P/ D h2.P0/ D h.P0/2 is a square in k.
Conversely, any non-zero odd function h on J will generically separate the two
points in the ﬁber of the double cover J ! K, so if h2.P/ is a non-zero square
in k, then this implies that P lifts to a k-rational point on J.
So we will now exhibit some odd functions that we can use to decide if a point
lifts. Since L.2/ consists of even functions only, we look at L.3/, which has
dimension 33 D 27. Its subspace of even functions has dimension 14 and is spanned

680
M. Stoll
by 1; : : : ; 8, the ﬁve quadratics
2.4 C 5/  2
3;
26  34;
26  2
4;
36  47;
.4 C 5/7  2
6
and a further function, which can be taken to beF
2.2f02
2  f123 C 2f224  f326 C 2f427
 f537 C 2f647  f767 C 2f82
7/
 7247 C 257 C 22
6 C 2
37 C 4346  2356 C 3
4  52
45 C 242
5 :
The subspace of odd functions has dimension 13. We obtain a ten-dimensional
subspace of this space by considering the coefﬁcients of Al ^ Bl ^ Cl, which is
an expression of degree 3, of odd degree in B and invariant even under SL.3/ acting
on .A; B; C/. (One can check that there are no further  -invariants of degree 3.)
These coefﬁcients are given by the 3  3-minors of the matrix L of (3). If we denote
the minor corresponding to 0  i < j < k  4 by ijk, then we ﬁnd that
2
ijk D 
ii
2
jk C 
jj
2
ik C 
kk
2
ij  4
ii
jj
kk  
ij
ik
jk :
(10)
If Lijk is the corresponding 3  3 submatrix of L, then we have that
2
ijk D det.Lijk/2 D  1
2 det.L>
ijkDLijk/
with D as in (2). We also have that L>DL D M, where M is the matrix corresponding
to the quadratic form B2
l  AlCl given in (7). We can express this by saying that 2
ijk
is  1
2 times the corresponding principal minor of M. In the same way, one sees that
ijki0j0k0 is  1
2 times the minor of M given by selecting rows i; j; k and columns
i0; j0; k0. This shows that if one 2
ijk.P/ is a non-zero square in k, then all 2
i0j0k0.P/
are squares in k. All ten of them vanish simultaneously if and only if A, B and C
are linearly dependent (this is equivalent to the rank of B2
l  AlCl being at most 2).
The dimension of the space spanned by A, B and C cannot be strictly less than 2,
since this would imply that F is a constant times a square, which contradicts the
assumption that F is squarefree. So we can write A, B and C as linear combinations
of two polynomials A0 and C0, and after a suitable change of basis, we ﬁnd that
F D B2  AC D A0C0. This means that the point is the image of a 2-torsion point
on J, and it will always lift.
So for a point P in K .k/ with 1 D 1 (hence outside the theta divisor) to lift to
a point in J .k/, it is necessary that all these expressions, when evaluated at P, are
squares in k, and sufﬁcient that one of them gives a non-zero square. For points with
1 D 0, we can use the explicit description of the image of  given in Sect. 2.
Let V 0 be the quotient of V by the action of the subgroup of  generated by
the elements of the form t and n; then the points of V 0 correspond to effective
divisors of degree 4 on C in general position. Geometrically, the induced map

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
681
V 0 ! X n  is a conic bundle: for a point on X outside the theta divisor, all
effective divisors representing it are in general position, and the corresponding linear
system has dimension 1 by the Riemann-Roch Theorem, so the ﬁbers are Severi-
Brauer varieties of dimension 1. If C has a k-rational point P, then the bundle has a
section (and so is in fact a P1-bundle), since we can select the unique representative
containing P in its support. If k is a number ﬁeld and C has points over every
completion of k, then all the conics in ﬁbers above k-rational points on X n  have
points over all completions of k and therefore are isomorphic to P1 over k. We can
check whether a k-deﬁned divisor representing a lift of P to a k-rational point on J
exists and ﬁnd one in this case in the following way. We assume that P is not in the
image of  and is not the image of a 2-torsion point. We are looking for a matrix
QL 2 A15.k/ representing a lift P0 2 J .k/ of P. Since we exclude 2-torsion, the
matrix QL must have rank 3, and there is a minor ijk such that 2
ijk.P/ D ijk.P0/2 is
a non-zero square in k. The rank of M.P/ D QL>DQL is also 3, so both L.QP/ and M.P/
have the same 2-dimensional kernel. We can compute the kernel from M.P/ and
then we ﬁnd the space generated by the rows of QL as its annihilator, which is simply
given by rows i; j; k of M.P/. If we ﬁnd an invertible 3  3 matrix U with entries
in k such that Mijk.P/ D U>DU (where Mijk is the principal 3  3 submatrix of M
given by rows and columns i; j; k), then we can ﬁnd a suitable matrix QL whose rows
are in the space generated by rows i; j; k of M.P/ and such that QLijk D U. Then
QL>DQL D M.P/, so QL gives us the desired representative. Finding U is equivalent to
ﬁnding an isomorphism between the quadratic forms given by
.x1; x2; x3/Mijk.P/.x1; x2; x3/>
and
2x1x3  2x2
2 ;
for whose existence a necessary condition is that det Mijk.P/ D 22
ijk.P/ is a square
times det D D 2. Given this, the problem comes down to ﬁnding a point on the
conic given by the ﬁrst form (which is the conic making up the ﬁber above P0 or P0)
and then parameterizing the conic using lines through the point.
Remark 4.1 One can checkF that the following three expressions are a possible
choice for the missing three basis elements of the odd subspace of L.3/:
2012  3013 C 5014
3014  .4 C 5/024 C 4123 C 6034
5034  6134 C 7234
5
The Action of the 2-Torsion Subgroup on K
We follow the approach taken in [14] and consider the action of the 2-torsion
subgroup of J on K and the ambient projective space. Note that translation by
a 2-torsion point commutes with negation on J, so the translation descends to

682
M. Stoll
an automorphism of K, and since 2 is linearly equivalent to its translate, this
automorphism actually is induced by an automorphism of the ambient P7.
We will see that this projective representation of J Œ2 ' .Z=2Z/6 can be lifted
to a representation of a central extension of J Œ2 by 2 on the space of linear forms
in the coordinates 1; : : : ; 8. This representation is irreducible. In the next section,
we consider this representation and the induced representations on the spaces of
quadratic and quartic forms in 1; : : : ; 8, whereas in this section, we obtain an
explicit description of the action of J Œ2 on P7.
There is a natural bijection between the 2-torsion subgroup J Œ2 of the Jacobian
and the set of unordered partitions of the set ˝ 	 P1 of zeros of F into two subsets
of even cardinality. The torsion point T corresponding to a partition f˝1; ˝2g is
2
4 X
!2˝1
.!; 0/
3
5  #˝1
2 m D
2
4 X
!2˝2
.!; 0/
3
5  #˝2
2 m :
Since #˝ D 8 is divisible by 4, the quantity ".T/ D .1/#˝1=2 D .1/#˝2=2 is well-
deﬁned. We say that T is even if ".T/ D 1 and odd if ".T/ D 1. By deﬁnition,
the even 2-torsion points are the 35 points corresponding to a partition into two
sets of four roots, together with the origin, and the odd 2-torsion points are the
28 points corresponding to a partition into subsets of sizes 2 and 6. The Weil pairing
of two torsion points T and T0 represented by f˝1; ˝2g and f˝0
1; ˝0
2g, respectively,
is given by
e2.T; T0/ D .1/#.˝1\˝0
1/ :
It is then easy to check that
e2.T; T0/ D ".T/".T0/".T C T0/ :
(11)
Note that Pic0
C is canonically isomorphic to Pic2
C (by adding the class of m), which
contains the theta characteristics. (A divisor class D 2 Pic2
C is a theta characteristic
if 2D D W.) In this way, the theta characteristics are identiﬁed with the 2-torsion
points, and the odd (resp., even) theta characteristics correspond to the odd (resp.,
even) 2-torsion points.
Using the transformations described in Sect. 3 and the matrices obtained by
Duquesne [5] representing the translation by a 2-torsion point, we ﬁnd the cor-
responding matrices in our setting for an even nontrivial 2-torsion point. The
matrices corresponding to odd 2-torsion points can then also be derived. For each
factorization F D GH into two forms of even degree, there is a matrix M.G;H/
whose entries are polynomials with integral coefﬁcients in the coefﬁcients of G
and H and whose image in PGL.8/ gives the action of the corresponding 2-torsion
point. These entries are too large to be reproduced here, but are given in the ﬁle
Kum3-torsionmats.magma at [17].

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
683
The matrices satisfy the relationsF
M2
.G;H/ D Res.G; H/I8
and
det M.G;H/ D Res.G; H/4 ;
(12)
where Res denotes the resultant of two binary forms. Let
S D
0
BBBBBBBBBBB@
0
0 0
0
0 0
0 1
0
0 0
0
0 0 1 0
0
0 0
0
0 1
0 0
0
0 0
0 1 0
0 0
0
0 0 1
0 0
0 0
0
0 1
0
0 0
0 0
0 1 0
0
0 0
0 0
1
0 0
0
0 0
0 0
1
CCCCCCCCCCCA
be the matrix corresponding to the quadratic relation (6) satisﬁed by points on the
Kummer variety.
Deﬁnition 5.1 We will write h; iS for the pairing given by S. Concretely, for
vectors  D .1; : : : ; 8/ and  D .1; : : : ; 8/, we have
h; iS D 18  27 C 36  45  54 C 63  72 C 81 :
One checksF that for all G; H as above,
.SM.G;H//> D .1/.deg G/=2SM.G;H/ :
If T ¤ 0 is even, then all corresponding matrices M.G;H/ are equal; we denote this
matrix by MT. In this case, also the resultant Res.G; H/ depends only on T; we write
it r.T/, so that we have M2
T D r.T/I8. For T odd and represented by .G; H/ with
deg G D 2, we have M.G;1H/ D 2M.G;H/. As a special case, we have M.1;F/ D I8.
For T ¤ 0 even, the entry in the upper right corner of MT is 1, for all other 2-torsion
points, this entry is zero.
For a 2-torsion point T 2 J Œ2, if we denote by MT the matrix corresponding to
one of the factorizations deﬁning T, we therefore have (using that S D S> D S1)
.SMT/> D ".T/SMT;
or equivalently,
MT D ".T/SM>
T S :
This implies (using that MT0MT is, up to scaling, a matrix corresponding to T C T0)
MTMT0 D ".T/SM>
T S  ".T0/SM>
T0S
D ".T/".T0/S.MT0MT/>S D ".T/".T0/".T C T0/MT0MT :

684
M. Stoll
Using (11), we recover the well-known fact that
MTMT0 D e2.T; T0/MT0MT :
(13)
Since M2
T is a scalar matrix, the relation given above implies that the quadratic
relation is invariant (up to scaling) under the action of J Œ2 on P7:
M>
T SMT D Res.G; H/S :
6
The Action on Linear, Quadratic and Quartic Forms
We work over an algebraically closed ﬁeld k of characteristic different from 2. The
ﬁrst result describes a representation of a central extension G of J Œ2 on the space
of linear forms that lifts the action on P7.
Lemma 6.1 There is a subgroup G of SL.8/ and an exact sequence
0 ! 2 ! G ! J Œ2 ! 0
induced by the standard sequence
0 ! 8 ! SL.8/ ! PSL.8/ ! 0
and the embedding J Œ2 ! PSL.8/ given by associating to T the class of any
matrix MT.
Proof Let T 2 J Œ2 and let MT 2 GL.8/ be any matrix associated to T. Then
M2
T D cI8 with some c (compare (12)), and we let QMT denote one of the two matrices
MT where 2c D ".T/. Then QMT 2 SL.8/, since (again by (12))
det QMT D 8 det MT D .".T/c1/4c4 D 1 :
Since any two choices of MT differ only by scaling, QMT is well-deﬁned up to sign.
Among the lifts of the class of MT in PSL.8/ to SL.8/, ˙ QMT are characterized by
the relation QM2
T D ".T/I8. We now set
G D f˙ QMT W T 2 J Œ2g :
It is clear that G surjects onto the image of J Œ2 in PSL.8/ and that the map is
two-to-one. It remains to show that G is a group. So let T; T0 2 J Œ2. Then QMT QMT0

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
685
is a matrix corresponding to T C T0. Since (using (13) and (11))
. QMT QMT0/2 D QMT QMT0 QMT QMT0 D e2.T; T0/ QM2
T QM2
T0
D e2.T; T0/".T/".T0/I8 D ".T C T0/I8 ;
we ﬁnd that QMT QMT0 2 G.
ut
Remark 6.2 Note that the situation here is somewhat different from the situation
in genus 2, as discussed in [14]. In the even genus hyperelliptic case, the theta
characteristics live in Picodd rather than in Piceven and can therefore not be identiﬁed
with the 2-torsion points. The effect is that there is no map "W J Œ2 ! 2 that
induces the Weil pairing as in (11), so that we have to use a fourfold covering
of J Œ2 in SL.4/ rather than a double cover.
We now proceed to a study of the representations of G on linear, quadratic and
quartic forms on P7 that are induced by G 	 SL.8/. The representation 1 on the
space V1 of linear forms is the standard representation. For its character 1, we ﬁnd
that
1.˙I8/ D ˙8
and
1.˙ QMT/ D 0
for all T ¤ 0:
This follows from the observation that T can be written as T D T0 C T00 with
e2.T0; T00/ D 1. Since ˙ QMT D QMT0 QMT00 D  QMT00 QMT0, the trace of QMT must be
zero. We deduce that 1 is irreducible. (1 is essentially the representation V.ı/
in [13], where ı D .2; 2; 2/ in our case.)
The representation 2 on the space V2 of quadratic forms is the symmetric square
of 1. Since ˙I8 act trivially on even degree forms, 2 descends to a representation
of J Œ2. Its character 2 is given by
2.0/ D 36
and
2.T/ D 1
2

1. QMT/2 C 1. QM2
T/

D 1
2.0 C 8".T// D 4".T/
for T ¤ 0:
Since J Œ2 is abelian, this representation has to split into a direct sum of one-
dimensional representations. Deﬁne the character T of J Œ2 by T.T0/
D
e2.T; T0/. Then the above implies that
2 D
M
TW".T/D1
T :
(14)
So for each even T 2 J Œ2, there is a one-dimensional eigenspace of quadratic
forms such that the action of T0 is given by multiplication with e2.T; T0/. For T D 0,
this eigenspace is spanned by the invariant quadratic (6).

686
M. Stoll
Deﬁnition 6.3 We set
y0 D 2.18  27 C 36  45/ I
this is the quadratic form corresponding to S, since y0./ D S> D h; iS.
For nontrivial even T, we denote by yT the form in the eigenspace corresponding
to T that has coefﬁcient 1 on 2
8. We will see that this makes sense, i.e., that this
coefﬁcient is always nonzero.
Lemma 6.4 For every nontrivial even 2-torsion point T, the matrix corresponding
to the quadratic form yT is the symmetric matrix SMT. In particular, if T corresponds
to a factorization F D GH into two polynomials of degree 4, then the coefﬁcients
of yT are polynomials in the coefﬁcients of G and H with integral coefﬁcients, and
the coefﬁcients of the monomials ij with i ¤ j are divisible by 2.
Proof We show that QM>
T0.SMT/ QMT0 D e2.T; T0/SMT. We use that QM2
T0 D ".T0/I8,
S QMT0 D ".T0/ QM>
T0S and the fact that the Weil pairing is given by commutators. This
gives that
QM>
T0SMT QMT0 D ".T0/S QMT0MT QMT0 D ".T0/e2.T; T0/SMT QM2
T0 D e2.T; T0/SMT
as desired, so SMT gives a quadratic form in the correct eigenspace. Since the upper
right entry of MT is 1, the lower right entry, which corresponds to the coefﬁcient
of 2
8, of SMT is 1, so that we indeed obtain yT.
ut
We can express yT as yT./ D h; M>
T iS.
Remark 6.5 Note that if T is an odd 2-torsion point, represented by the factorization
.G; H/, then the same argument shows that the alternating bilinear form correspond-
ing to the matrix SM.G;H/ is multiplied by e2.T; T0/ under the action of T0 2 J Œ2.
We set
."1; "2; "3; "4; "5; "6; "7; "8/ D .1; 1; 1; 1; 1; 1; 1; 1/ I
these are the entries occurring in S along the diagonal from upper right to lower left.
Corollary 6.6 Let T be a nontrivial even 2-torsion point with image on K given
by
.1 W 2 W 3 W 4 W 5 W 6 W 7 W 8/ :
Then
yT D 2
8 C 2
8
X
jD2
"jj9j8 C .terms not involving 8/ :
A similar statement is true for T D 0 if we take coordinates .0 W : : : W 0 W 1/: we
have that y0 D 218 C .terms not involving 8/.

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
687
Proof The last column of MT has entries 1; 2; : : : ; 8 (since MT maps the origin to
the image of T and has upper right entry 1). Multiplication by S from the left reverses
the order and introduces the signs "j. Since the coefﬁcients of yT of monomials
involving 8 are given by the entries of the last column of SMT by Lemma 6.4, the
claim follows.
ut
We deﬁne a pairing on the space V1 ˝ V1 of bilinear forms as follows. If the
bilinear forms  and 0 are represented by matrices A and A0 with respect to our
standard basis 1; : : : ; 8 of V1, then h; 0i D 1
8 Tr.A>A0/ (the scaling has the effect
of giving the standard quadratic form norm 1).
For an even 2-torsion point T, we write QyT for the symmetric bilinear form
corresponding to the matrix S QMT (this is well-deﬁned up to sign) and QzT for the
symmetric bilinear form corresponding to S QM>
T D QMTS. Also, zT will denote the
form corresponding to SM>
T D MTS. Then, since S.MTS/S D SMT, we have the
relation zT./ D yT.S/; explicitly,
zT.1; 2; 3; 4; 5; 6; 7; 8/ D yT.8; 7; 6; 5; 4; 3; 2; 1/ :
Lemma 6.7 For all even 2-torsion points T and T0, we have that
hQzT; QyT0i D
(
1
if T D T0;
0
if T ¤ T0:
Equivalently,
hzT; yT0i D
(
r.T/
if T D T0;
0
if T ¤ T0:
Here we restrict the scalar product deﬁned above to V2 	 V1 ˝ V1.
Proof The claim is that Tr

.S QM>
T />.S QMT0/

is zero if T ¤ T0 and that it equals 8 if
T D T0. We have that
Tr

.S QM>
T />.S QMT0/

D Tr. QMTS2 QMT0/ D Tr. QMT QMT0/ D ˙ Tr. QMTCT0/ :
If T ¤ T0, then this trace is zero, as we had already seen. If T D T0, then the matrix
˙ QMTCT0 is I8, so the result is 8 as desired.
ut
This allows us to express the 2
j in terms of the yT. We set r.0/ D 1 and M0 D I8.
We denote the coefﬁcient of ij in a quadratic form q 2 V2 by Œijq.
Lemma 6.8 For every j 2 f1; 2; : : : ; 8g, we have that
2
j D
X
TW".T/D1
Œ2
9jyT
8r.T/ yT :

688
M. Stoll
Similarly, for 1  i < j  8, we have that
2ij D "i"j
X
TW".T/D1
Œ9i9jyT
8r.T/
yT :
Proof We have by Lemma 6.7 that
2
j D
X
TW".T/D1
hQzT; 2
j iQyT D
X
TW".T/D1
hzT; 2
j i
r.T/ yT
D
X
TW".T/D1
Œ2
j zT
8r.T/ yT D
X
TW".T/D1
Œ2
9jyT
8r.T/ yT :
In the same way, we have for i ¤ j that
2ij D
X
TW".T/D1
2hQzT; ijiQyT D
X
TW".T/D1
2hzT; iji
r.T/
yT
D
X
TW".T/D1
ŒijzT
8r.T/ yT D "i"j
X
TW".T/D1
Œ9i9jyT
8r.T/
yT :
(Note that 8hzT; iji is half the coefﬁcient of ij in zT.)
ut
Corollary 6.9 We have that
X
TW".T/D1
1
8r.T/yT./yT./ D

8
X
jD1
"jj9j
2
D h; i2
S :
In particular, setting  D , we obtain that
X
TW".T/D1
1
8r.T/y2
T D y2
0 D 4.18  27 C 36  45/2 :
Proof We compute using Lemma 6.8:
X
TW".T/D1
1
8r.T/yT./yT./
D
8
X
iD1
2
i
X
TW".T/D1
Œ2
i yT./
8r.T/
yT./ C
X
1i<j8
ij
X
TW".T/D1
ŒijyT./
8r.T/
yT./

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
689
D
8
X
iD1
2
i 2
9i C 2
X
1i<j8
"i"j ij9i9j
D

8
X
jD1
"j j9j
2
:
ut
Now we consider the representation 4 of J Œ2 on the space V4 of quartic forms.
For its character 4, we have the general formula
4.T/ D
1
24

1. QMT/4 C 81. QMT/1. QM3
T/ C 31. QM2
T/2
C 61. QMT/21. QM2
T/ C 61. QM4
T/

:
This gives us that
4.0/ D 330
and
4.T/ D 10
for T ¤ 0:
We deduce that
4 D ˚15
0
˚
M
T¤0
˚5
T
:
(15)
7
The Duplication Map
and the Missing Generator of L.4/C
We continue to work over a ﬁeld k of characteristic ¤ 2. We also continue to assume
that F 2 kŒx; z is squarefree, so that C is a smooth hyperelliptic curve of genus 3
over k.
Consider the commutative diagram
where the map in the top row is multiplication by 2 and ı is the endomorphism
of K induced by it. Pulling back a hyperplane section to the copy of J on the
right, we obtain a divisor in the class of 2. Pulling it further back to the copy on
the left, we obtain a divisor in the class of the pull-back of 2 under duplication,
which is the class of 8 ( is symmetric, so pulling back under multiplication

690
M. Stoll
by n multiplies its class by n2). The combined map from the left J to P7 then
is given by an 8-dimensional subspace of L.8/C; by Corollary 2.4 this means
that ı is given by eight quartic forms in . Since ı maps o, the image of the origin
on K, to itself, we can normalize these quartics so that they evaluate to .0; : : : ; 0; 1/
on .0; : : : ; 0; 1/. We use ı D .ı1; : : : ; ı8/ to denote these quartic forms; they are
determined up to adding a quartic form vanishing on K. We write E4 	 V4 for
the subspace of quartics vanishing on K. Note that we can test whether a given
homogeneous polynomial in  vanishes on K by pulling it back to W or to A15 and
checking whether it vanishes on V.
We now determine the structure of E4 as a representation of J Œ2 and we identify
the space generated by ı in V4=E4.
Lemma 7.1
(1) The restriction of 4 to E4 splits as 4jE4 D ˚7
0
˚ L
T¤0 T.
(2) The images of ı1; : : : ; ı8 form a basis of the quotient V
J Œ2
4
=E
J Œ2
4
of invariant
subspaces.
Proof
(1) The dimension of E4 is 70 by Theorem 2.5, and a subspace of dimension 36
is given by y0V2. The latter splits in the same way as 2 does. Since for the
generic curve, the Galois action is transitive on the odd 2-torsion points and on
the nontrivial even 2-torsion points, the multiplicities of all odd characters and
those of all nontrivial even characters in 4jE4 have to agree. The only way to
make the numbers come out correctly is as indicated.
(2) Since the result of duplicating a point is unchanged when a 2-torsion point is
added to it, the images of all ıj in V4=E4 must lie in the same eigenspace of the
J Œ2-action. Since K spans P7 and the duplication map ıW K ! K is surjective,
the images of the ıj in V4=E4 must be linearly independent. So they must live in
an eigenspace of dimension at least eight. The only such eigenspace is that of
the trivial character, which has dimension exactly 8 D 15  7 by the ﬁrst part.
ut
We see that the 36 quartic forms y2
T for T an even 2-torsion point are in the
invariant subspace of V4 of dimension 15. Let Teven denote the ﬁnite k-scheme
whose geometric points are the 36 even 2-torsion points (we can consider Teven
as a subscheme of J or of K ), and denote by keven its coordinate ring; this is an
étale k-algebra of dimension 36. Then yW T 7! yT can be considered as a quadratic
form with coefﬁcients in keven and rW T 7! r.T/ is an element of k
even.
Lemma 7.2 The 36 coefﬁcients cii D Œ2
i y, for 1  i  8, and cij D 1
2Œijy, for
1  i < j  8, constitute a k-basis of keven.
Proof We deﬁne further elements of keven by
Qcii D 1
8rŒ2
9iy
and
Qcij D "i"j
8r Œ9i9jy :

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
691
Fig. 1 A basis of the J Œ2-invariant subspace of V4
Lemma 6.8 can be interpreted as saying that
Trkeven=k.Qcijci0j0/ D
(
1
if .i; j/ D .i0; j0/;
0
otherwise.
This shows that the given elements are linearly independent over k.
ut
We can compute the structure constants of keven with respect to this basis and
use this to express y2 in terms of the basis again. Extracting coefﬁcients, we obtain
36 quartic forms with coefﬁcients in k that all lie in the 15-dimensional space of
invariants under J Œ2. We checkF that they indeed span a space of this dimension
and that we get a subspace of dimension 7 of quartics vanishing on the Kummer
variety.
It turns outF that the quartics in V
J Œ2
4
that vanish on K are exactly those that
do not contain terms cubic or quartic in 8. Forms spanning the complementary
space are uniquely determined modulo EJ Œ2
4
by ﬁxing the terms of higher degree

692
M. Stoll
in 8. We take qj D j3
8 C .deg8  2/ for j D 1; : : : ; 8. Then the qj can
be chosen so that they have coefﬁcients in ZŒf0; : : : ; f8. To ﬁx qj completely, it
sufﬁces to specify in addition the coefﬁcients of 1i2
8 for 1  i  7. One
possibility is to choose them as given in Fig. 1, which includes q9; : : : ; q15 in the
ideal of K, where E
J Œ2
4
D hq9; q10; : : : ; q15i. These quartics can be obtained from
Kum3-invariants.magma at [17].
We can now identify the duplication map on K.
Theorem 7.3 The polynomials
.ı1; ı2; ı3; ı4; ı5; ı6; ı7; ı8/ D .4q1; 4q2; 4q3; 4q4; 4q5; 4q6; 4q7; q8/
in VJ Œ2
4
(with qj as above) have the following properties.
(1) ıj 2 ZŒf0; f1; : : : ; f8Œ1; 2; : : : ; 8 for all 1  j  8.
(2) .ı1; ı2; : : : ; ı8/.0; 0; : : : ; 0; 1/ D .0; 0; : : : ; 0; 1/.
(3) With yT as deﬁned earlier for an even 2-torsion point with image
.1 W 2 W 3 W 4 W 5 W 6 W 7 W 8/
on K, we have that
y2
T  ı8 2ı7 C3ı6 4ı5 5ı4 C6ı3 7ı2 C8ı1 D h; ıiS mod E
J Œ2
4
;
where  D .1; 2; : : : ; 8/ and ı D .ı1; : : : ; ı8/.
(4) The ıj do not vanish simultaneously on K.
(5) The map ıW K ! K given by .ı1 W : : : W ı8/ is the duplication map on K.
Proof
(1) This can be veriﬁed using the explicit polynomials.
(2) This is obvious.
(3) We compare the coefﬁcients of j3
8 on both sides. Since by Corollary 6.6,
yT D 2
8 C2"2278 C2"3368 C: : :C2"8818 C.terms not involving 8/ ;
we ﬁnd that
y2
T D 4
8 C 4"2273
8 C : : : C 4"8813
8 C .terms of degree  2 in 8/
and the right hand side has the same form. So the difference is a form in VJ Œ2
4
of degree at most 2 in 8, which implies that it is in EJ Œ2
4
.
(4) Let  2 k8 n f0g be coordinates of a point in K . Then ı./ D 0 implies by (3)
that yT./ D 0 for all even 2-torsion points T (note that y0 vanishes on all
of K ). Lemma 6.8 then shows that  D 0 as well, since 8r.T/ ¤ 0 in k. This
contradicts our choice of .

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
693
(5) By (4), ı is a morphism K ! P7, and by Lemma 7.1 (2) ı differs from the
duplication map by post-composing with an automorphism ˛ of P7. We showF
that on a generic point, ı coincides with the duplication map; this proves that ˛
is the identity. We use the action of GL.2/ on .x; z/ (and scaling on y) to reduce
to the case that F.x; 1/ is monic of degree 7. A generic point P on J can then
be represented by .A; B; C/ such that A.x; 1/ is monic of degree 3 and squarefree
and B.x; 1/ is of degree  2. After making a further afﬁne transformation, we
can assume that A.x; 1/ D x.x  1/.x  a/ for some a 2 k. The corresponding
point on K is then
.P/ D .1 W a  1 W a W 0 W ac3  c1 W c0
W .a C 1/c0 C 2b0b2 W .a2 C a C 1/c0  2.a C 1/b0b2/ ;
where B.x; 1/ D b0 C b1x C b2x2, C.x; 1/ D c0 C c1x C c2x2 Cc3x3  x4.
We compute 2P in terms of its Mumford representation using Cantor’s algo-
rithm as implemented in Magma and ﬁnd .2P/. On the other hand, we
compute ı..P//. Both points are equal, which proves the claim.
ut
The quartics ı D .ı1; : : : ; ı8/ are given in the ﬁle Kum3-deltas.magma at [17].
The canonical map from V2 D Sym2 L.2/ to L.4/ has non-trivial one-dimen-
sional kernel, spanned by the quadric y0 vanishing on K. Since the dimension of
the even part L.4/C of L.4/ is 36 D dim V2, the map V2 ! L.4/C has a
one-dimensional cokernel. Looking at the action of J Œ2 on L.4/C, it is clear that
this space splits as a direct sum of the image of V2 and a one-dimensional invariant
subspace. We will identify a generator of the latter.
Lemma 7.4 The image of q1 in L.8/ is the square of an element # 2 L.4/C
that is invariant under the action of J Œ2.
Proof We pull back q1 to a polynomial function on the afﬁne space A15 that
parameterizes the triples of polynomials .A; B; C/. We ﬁndF that this polynomial
is the square of some other polynomial p that can be written as a quadratic in the
components of Al ^ Bl ^ Cl. So p is invariant under ˙ , which means that it gives
an element # of L.4/C.
ut
To make # more explicit, we note that p can be expressed as a cubic in the j.
Taking into account that 1 D 1 on the afﬁne space, we ﬁnd that (up to the choice
of a sign)
1# D .8f0f4f8 C 2f0f5f7 C 2f1f3f8/3
1  4f0f62
12 C .4f0f7 C 2f1f6/2
13
C .4f0f8 C 2f1f7  4f2f6 C f3f5/2
14 C .12f0f8  f1f7/2
15
C .4f1f8 C 2f2f7/2
16  4f2f82
17 C 6f012
2  3f1123
C 6f2124  f3126  2f3134 C 2f4136  f5137

694
M. Stoll
C 4f412
4  2f4145  2f5146 C 6f6147  3f7167
C 6f812
7  11247 C 257 C 222
6 C 22
37 C 5346
 3356 C 23
4  72
45 C 342
5 :
We obtain similar cubic expressions for j# with j 2 f2; 3; : : : ; 8g by multiplying
the polynomial above by j, then adding a suitable linear combination of the quartics
vanishing on K so that we obtain something that is divisible by 1. These cubics
are given in the ﬁle Kum3-Xipols.magma at [17]. With this information, we can
evaluate # on any given set  of coordinates of a point on K : we ﬁnd an index j
with j ¤ 0 and evaluate # as .j#/=j.
This gives us a basis of L.4/C consisting of # and the quadratic monomials
in the j minus one of the monomials j9j. Alternatively, we can use the basis
consisting of # and the yT for the 35 nonzero even 2-torsion points T.
8
Sum and Difference on the Kummer Variety
In this section, k continues to be a ﬁeld of characteristic ¤ 2 and F to be squarefree.
We consider the composition
J  J
.C;/
! J  J
.;/
! K  K ! P7  P7 Segre
! P63 symm.
! P35
where ‘symm.’ is the symmetrization map that sends a matrix A to A C A> and we
identify the Segre map with the multiplication map
(column vectors)  (row vectors) ! matrices :
Pulling back hyperplanes to J  J, we see that the map is given by sections
of 4 pr
1  C 4 pr
2 , hence symmetric bilinear forms on L.4/. The map is
invariant under negation of either one of the arguments, therefore the bilinear forms
only involve even sections. The map can be described by a symmetric matrix B
of such bilinear forms such that in terms of coordinates .wj/ and .zj/ of the
images .P C Q/ and .P  Q/ of P ˙ Q on K, we have that (up to scaling)
wizj C wjzi D 2Bij..P/; .Q//. We normalize by requiring that B88.o; o/ D 1,
where o D .0; : : : ; 0; 1/.
We write QV2 for L.4/C; then B can be interpreted as an element ˇ of the
tensor product QV2 ˝ QV2 ˝ V
2 . The last factor V
2 can be identiﬁed with the space of
symmetric 8  8 matrices (whose entries are thought of representing 1
2.wizj C wjzi/
for coordinates w and z of points in P7) by specifying that a quadratic form
q 2 V2 evaluates on such a matrix to b.w; z/ where b is the bilinear form such
that q.x/ D b.x; x/. If M is the matrix of b and B is the matrix corresponding to the
unordered pair fw; zg, then the pairing is Tr.M>B/ D 8hM; Bi. Put differently, we
obtain the .i; j/-entry of the matrix by evaluating at the quadratic form ij.

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
695
The 2-torsion group J Œ2 acts on each factor, and ˇ must be invariant under the
action of J Œ2  J Œ2 such that .T; T0/ acts via .T; T0; T C T0/ on the three factors
(shifting P by T and Q by T0 shifts P ˙ Q by T C T0).
We use the basis of QV2 given by # and yT for the nonzero even 2-torsion points T
(suitably extending k if necessary); for V
2 we use the basis dual to .yT/T even, which
is given by the linear forms
y
TW v 7!
1
r.T/hzT; vi :
If T1; T2; T3 are even 2-torsion points, then the effect of .T; T0/ acting on the
corresponding basis element of the triple tensor product is to multiply it by
e2.T; T1/e2.T0; T2/e2.T C T0; T3/ D e2.T; T1 C T3/e2.T0; T2 C T3/ :
If this basis element occurs in ˇ with a nonzero coefﬁcient, then this factor must
be 1 for all T; T0, which means that T1 D T2 D T3. This shows that we must have
that
ˇ D
X
T¤0
aT.yT ˝ yT ˝ y
T/ C a0.# ˝ # ˝ y
0 / :
If we evaluate at the origin in the ﬁrst component, we obtain (using that # vanishes
there and that yT.o/ D 1 for T ¤ 0 even) that
ˇo D
X
T¤0
aT.yT ˝ y
T/ :
This corresponds to taking P D O, resulting in the pair ˙Q leading to f.Q/; .Q/g.
So, taking  as coordinates of Q and using that B88.o; o/ D 1, the .i; j/-component
of this expression, evaluated at  in the (now) ﬁrst component of ˇo, must be ij,
up to a multiple of y0:
ij 
X
T¤0
aTy
T.ij/  yT mod y0 :
In other words, ˇo, interpreted as a linear map V2 ! QV2, is the canonical map; in
particular, it sends yT to yT for all even T ¤ 0, and so aT D 1 for all T ¤ 0. It only
remains to ﬁnd a0; then ˇ is completely determined. We consider the image of ˇ in
Sym2 QV2 ˝ V
2 , which corresponds to taking P D Q. This results in the unordered
pair f2P; Og, represented (according to our normalization) by the symmetric matrix
that is zero everywhere except in the last row and column, where it has entries

696
M. Stoll
1
2ı1; : : : ; 1
2ı7; ı8. We obtain (recall that #2 D q1 and ı1 D 4q1) that
X
T¤0
y2
T ˝ y
T.ij/ C a0q1 ˝ y
0.ij/ D
8
ˆˆ<
ˆˆ:
0
if i; j < 8I
1
2ıi
if i < j D 8I
ı8
if i D j D 8:
Evaluating at y0 D 2.18  27 C 36  45/, we ﬁnd that
a0q1 D ı1 D 4q1 :
This shows that a0 D 4. (Note that if we evaluate at yT, we recover the relation
y2
T D
7
X
jD1
1
2ıj  Œj8yT C ı8  Œ2
8yT D
7
X
jD1
"9j9jıj C ı8 :)
We have shown:
Lemma 8.1 The element ˇ 2 QV2 ˝ QV2 ˝ V
2 is given by
ˇ D
X
T¤0
yT ˝ yT ˝ y
T C 4 # ˝ # ˝ y
0 :
In terms of matrices, we have that
2B.; / D
X
T¤0
yT./yT./
4r.T/
MTS C #./#./S :
(16)
To get the expression for B, note that y
T corresponds to the matrix

y
T.ij/

i;j D
1
r.T/

hzT; iji

i;j D
1
8r.T/MTS :
The resulting matrix of bi-quadratic forms corresponding to the ﬁrst summand
in (16) has entries that can be written as elements of ZŒf0; : : : ; f8Œ; . The entries
are given in the ﬁle Kum3-biquforms.magma at [17]. More precisely, let
q D 1.f3f54 C f1f75/ C f123 C f326 C f537 C f767 C .4 C 5/8 ;
then the entries of
B.; /  1
2
q./q./ C #./#./S
are (up to addition of multiples of y0./ and y0./) in ZŒf0; : : : ; f8Œ; . (Note that
q  # mod .2; y0/ so that the term in parentheses is divisible by 2.)

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
697
We can now use the matrix B to perform ‘pseudo-addition’ on K in complete
analogy to the case of genus 2 described in [6]. This means that given .P/, .Q/
and .P  Q/, we can ﬁnd .P C Q/. This in turn can be used to compute multiples
of points on K by a variant of the usual divide-and-conquer scheme (‘repeated
squaring’).
We can make the upper left entry of B completely explicit.
Lemma 8.2 Recall that h; iS denotes the bilinear form corresponding to the
matrix S. We have that
B11.; /  h; i2
S mod .y0./; y0.// :
Proof This follows from hzT; 2
1i D Œ2
8yT D 1 (for T ¤ 0) and Corollary 6.9:
B11.; / 
X
T¤0
yT./yT./
8r.T/
D h; i2
S :
ut
Corollary 8.3 For two points P; Q 2 J with images .P/; .Q/ 2 K, we have
that
P ˙ Q 2  ” h.P/; .Q/iS D 0 :
Proof The bilinear form associated to S vanishes if and only if B11..P/; .Q//
vanishes, which means that 1.P C Q/1.P  Q/ D 0, which in turn is equivalent to
P C Q 2  or P  Q 2 .
ut
This is analogous to the duality between the Kummer Surface and the Dual
Kummer Surface in the case of a curve of genus 2, see [4, Thm. 4.3.1]. The
difference is that here the Kummer variety is self-dual.
We can now also describe the locus of vanishing of yT on K.
Corollary 8.4 Let T ¤ 0 be an even 2-torsion point. Then for P 2 J, we have that
yT..P// D 0 if and only if 2P C T 2 .
Proof This is because y2
T D h.T/; ıiS (up to scaling).
ut
For T D 0, we get that #..P// D 0 if and only if 2P 2 . This is because
4#2 D ı1.
9
Further Properties of the Duplication
and the Sum-and-Difference Maps
With a view of considering bad reduction later, we now allow k to be any ﬁeld and
F 2 kŒx; z to be any binary form of degree 8; in particular, F D 0 is allowed. Note
that the relations deduced so far are valid over ZŒf0; : : : ; f8 and so can be specialized

698
M. Stoll
to any k and F. In this context, K denotes the variety in P7
k deﬁned by the
specializations of the quadric and the 34 quartics that deﬁne the Kummer variety in
the generic case, and ı denotes the rational map (which now may have base points)
from K to itself given by the quartics ı. We can also still consider factorizations
F D GH into two factors of degree 4 (if F D 0, we take both of the factors to be
the zero form of degree 4) and obtain points on K that are specializations of the
images of 2-torsion points. We will call equivalence classes of such factorizations
(up to scaling) ‘nontrivial even 2-torsion points’ for simplicity, even though they do
not in general arise from points of order 2 on some algebraic group. If T is such
a nontrivial even 2-torsion point, then we denote the corresponding point on K
by .T/. We normalize the coordinates of .T/ such that the ﬁrst coordinate is 1.
We also have the associated quadratic form yT. If F D 0, we obtain for example
.T/ D .1 W 0 W : : : W 0/ for the unique nontrivial even 2-torsion point, with
associated quadratic form yT D 2
8.
We now state explicit criteria for the vanishing of ı at a point on K. We ﬁrst
exhibit a necessary condition. For the following, we assume k to be algebraically
closed and of characteristic ¤ 2.
Remark 9.1 Note that in characteristic 2 we have that ı1 D : : : D ı7 D 0 and
ı8 D y2
T on K for all T, where
yT D 2
8 C f6f82
7 C f4f82
6 C f2f82
5 C f4f62
4 C f2f62
3 C f2f42
2 C f2f4f6f82
1 ;
which is the square of a linear form over k when k is perfect. Let L denote the
hyperplane deﬁned by this linear form. Then ı restricts to a morphism on K n L ,
which is constant with image the origin .0 W : : : W 0 W 1/.
Assume for now that F ¤ 0 and write
F D F2
0F1
with F1 squarefree.
We deﬁne T .F/ to be the set of nontrivial even 2-torsion points T associated to
factorizations .G; H/ with G and H both divisible by F0. So T .F/ is in bijection
with the unordered partitions of the roots of F1 into two sets of equal size. We also
deﬁne T .0/ to be the one-element set fTg, where T corresponds to the factorization
0 D 0  0.
Lemma 9.2 With the notation introduced above, the following statements are
equivalent for a point on K with coordinate vector :
(i) For all T 2 T .F/, we have that h.T/; ı./iS D 0.
(ii) For all T 2 T .F/, we have that h.T/; iS D 0.
In particular, ı./ D 0 implies that h.T/; iS D 0 for all T 2 T .F/.
Proof By Theorem 7.3 (3), we have for all T 2 T .F/ that yT./2 D h.T/; ı./iS,
so (i) is equivalent to yT./ D 0 for all T 2 T .F/. When F D 0, we have yT D 2
8
and .T/ D .1 W 0 W : : : W 0/ for the unique T 2 T .F/, so yT./ D 0 is equivalent

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
699
to 8 D 0, which is equivalent to h.T/; iS D 0. If, at the other extreme, F is
squarefree, then one checksF that the coordinate vectors of the points in T .F/ are
linearly independent, which implies that (i) is equivalent to ı./ D 0 and (ii) is
equivalent to  D 0. The claim then follows from Theorem 7.3 (4).
We now assume that F ¤ 0 and write F D F2
0F1 as above with F1 squarefree and
F0 non-constant. We check by an explicit computationF that
(*) the yT for T 2 T .F/ form a basis of the symmetric square of the space
spanned by the linear forms h.T/; iS for T 2 T .F/.
This implies that the vanishing of the yT is equivalent to (ii). To verify (*), we can
apply a transformation moving the roots of F0 to an initial segment of .0; 1; 1; a/
(where a 2 knf0; 1g). The most involved case is when deg F0 D 1. We can then take
F0 D x and ﬁnd that the linear forms given by the T 2 T .F/ span h4; 6; 7; 8i and
that the 10  10 matrix whose rows are the coefﬁcient vectors of the yT with respect
to the monomials of degree 2 in these four variables has determinant a power of
two times a power of disc.F1/, hence is invertible. The other cases are similar, but
simpler.
ut
This prompts the following deﬁnition.
Deﬁnition 9.3 We write Kgood for the open subscheme
K n fP W h.T/; PiS D 0 for all T 2 T .F/g
of K.
Lemma 9.2 now immediately implies the following.
Corollary 9.4 The rational map ı on K restricts to a morphism Kgood ! Kgood.
We will now consider the ‘bad’ subset K n Kgood of K
in more detail,
in particular in relation to the base locus of ı, which it contains according to
Corollary 9.4. We begin with a simple sufﬁcient condition for a point to be in the
base locus.
Lemma 9.5 Assume that F.x; z/ is divisible by z2. Let  be the coordinate vector of
a point on K such that 2 D 3 D 4 D 8 D 0. Then ı./ D 0.
Proof Plugging f7 D f8 D 2 D 3 D 4 D 8 D 0 into the expressions for the ıj
gives zeroF.
ut
We set
L1 D f.1 W : : : W 8/ 2 P7 W 2 D 3 D 4 D 8 D 0g :
Using the formulas given in Sect. 3 for the action on , one sees easily that L1 is
invariant under scaling of x and also under shifting .x; z/ 7! .x C z; z/ (always
assuming that f7 D f8 D 0), which together generate the stabilizer of 1 in PGL.2/.
For F with a multiple root at some point a 2 P1, let QF be the result of acting on F
by a linear substitution  that moves a to 1; then QF is divisible by z2. We write

700
M. Stoll
La 	 P7 for the image of L1 under the automorphism of P7 induced by 1. Since
the stabilizer of 1 in PGL.2/ leaves L1 invariant, this deﬁnition of La does not
depend on the choice of . For example,
L0 D f.1 W : : : W 8/ 2 P7 W 4 D 6 D 7 D 8 D 0g :
We write A.F/ 	 P1 for the set of multiple roots of F. This is all of P1 when F D 0.
Otherwise, A.F/ consists of the roots of F0 when F D F2
0F1 with F1 squarefree.
Corollary 9.6 If P 2 K \ La for some a 2 A.F/, then ı.P/ D 0.
Proof This follows from Lemma 9.5 by applying a suitable automorphism of P1.
ut
So the base locus of ı contains K \S
a2A.F/ La. When F is not a nonzero square,
we can show that this is exactly the ‘bad set’ K n Kgood.
Lemma 9.7 Assume that F is not of the form F D H2 with H ¤ 0. Let P be in the
‘bad set’ K n Kgood. Then P 2 La for some a 2 A.F/. In particular,
Kgood D K n
[
a2A.F/
La ;
and K n Kgood D K \ S
a2A.F/ La is the base locus of ı.
Proof Let  be a coordinate vector for P. We write F D F2
0F1 with F1 squarefree.
We split the proof into various cases according to the factorization type of F0. If F0
is constant, there is nothing to prove. Otherwise we move the roots of F0 to an initial
segment of .0; 1; 1/.
1. F0 D x. In this case the assumption is equivalent to 4 D 6 D 7 D 8 D 0
(compare the proof of Lemma 9.2), so that P 2 L0.
2. F0 D x2. The assumption is that 7 D 8 D 0; using the equations deﬁning K
this impliesF that 4 D 6 D 0, so P 2 L0.
3. F0 D x3. The assumption is that 8 D 0, which impliesF that 7 D 6 D 4 D 0,
so P 2 L0.
4. F0 D xz. In this case the assumption is that 4 D 8 D 0, which then impliesF
that 6 D 7 D 0 or 2 D 3 D 0, and so P 2 L0 or P 2 L1.
5. F0 D x2z. The assumption is that 8 D 0, which leads toF P 2 L0 or P 2 L1.
6. F0 D xz.x  z/. A similar computation showsF that P 2 L0 [ L1 [ L1.
7. F D 0. Here the assumption is that 8 D 0. The intersection K \ f8 D 0g is
deﬁnedF by the 2  2-minors of the matrix
0
@
2
3
4
3 4 C 5 6
4
6
7
1
A ;
which therefore has rank 1 when evaluated on any point in K \ f8 D 0g. If
2 D 0, then this implies that 3 D 4 D 0 as well, so that P 2 L1. Otherwise,

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
701
we can make a transformation shifting x=z by  as in Sect. 3 that makes Q7 D 0
(Q7 is a polynomial of degree 4 in  with leading coefﬁcient 2, so we can ﬁnd
a suitable , since k is assumed to be algebraically closed). Then we get that
Q8 D Q7 D Q6 D Q4 D 0, so the image point is in L0, hence P 2 L.
The last statement follows, since Corollary 9.4 shows that the base scheme of ı is
contained in K n Kgood and Corollary 9.6 shows that it contains the intersection
of K with the union of the La.
ut
We now consider the case F D F2
0 ¤ 0. Then the curve y2 D F.x; z/ D F0.x; z/2
splits into the two components y D ˙F0.x; z/. The points on K correspond to
linear equivalence classes of effective divisors of degree 4, modulo the action of the
hyperelliptic involution. So there are three distinct possibilities how the points can
be distributed among the two components: two on each, one and three, or all four on
the same component. In the last case, we have B  ˙F0 mod A, and we can change
the representative so that B D ˙F0, which makes C D 0. So the two components
of Pic4.C / consisting of classes of divisors whose support is contained in one of
the two components of C map to a single point ! 2 K, which one can checkF
coincides with .T/ for the single T 2 T .F/; it satisﬁes ı.!/ D 0.
Now a point P on the component of K corresponding to the distribution of one
and three points on the two components, if it is not in the base scheme of ı, must
satisfy ı.P/ D !. So for such points we have ı.ı.P// D 0, but ı.P/ ¤ 0. Let
 be coordinates for a point P with ı.P/ D ! D .T/. Then h.T/; ı./iS D
h.T/; .T/iS D 0 (all points on K satisfy h; iS D y0./ D 0). By Lemma 9.2,
this is equivalent to h.T/; iS D 0. We write E for the hyperplane given by
h.T/; iS D 0. So in this case Kgood D K n E , and P 2 K \ E D K n Kgood
does not necessarily imply that ı.P/ D 0. But we still have the following.
Lemma 9.8 Assume that F D F2
0 with F0 ¤ 0. If P 2 K with ı.P/ D 0, then
P 2 La for some a 2 A.F/ (which here is simply the set of roots of F0).
Proof We can again assume that the roots of F0 are given by an initial segment
of .0; 1; 1; a/ (with a ¤ 1; 0; 1). We consider the various factorization types of F0
in turn; they are represented by
F0 D x4;
x3z;
x2z2;
x2z.x  z/
and
xz.x  z/.x  az/ :
The computationsF are similar to those done in the proof of Lemma 9.7. The most
involved case is when F0 has four distinct roots. To deal with it successfully, we
make use of the Klein Four Group of automorphisms of the set of roots of F0.
ut
We now have a precise description of the base scheme of the duplication map ı
on K, which is given by the quartic forms ı.
Proposition 9.9 Let k be an algebraically closed ﬁeld of characteristic ¤ 2 and
let F 2 kŒx; z be homogeneous of degree 8. We denote by K and ı the objects
associated to F.

702
M. Stoll
(1) The base locus of ı is K \ S
a2A.F/ La.
(2) The base locus of ı ı ı is K n Kgood; ı can be iterated indeﬁnitely on Kgood.
(3) If F is not of the form F D F2
0 with F0 ¤ 0, then the base locus of ı is K nKgood.
Proof
(1) Corollary 9.6 shows that the condition is sufﬁcient. Conversely, if ı.P/ D 0,
then Lemmas 9.2, 9.7 and 9.8 show that P 2 La for some multiple root a of F.
(2) The second statement is Corollary 9.4. In view of (3), it is sufﬁcient to consider
the case F D F2
0 ¤ 0 for the ﬁrst statement. If P 2 K n Kgood is not in the base
locus of ı, then ı.P/ D !, which is in the base locus of ı, so P is in the base
locus of ı ı ı. Conversely, if P is in the base locus of ı ı ı, then P cannot be
in Kgood by the second statement.
(3) This follows from Corollary 9.4 and Lemma 9.7.
ut
We can state a property of the ‘add-and-subtract’ morphism that is similar to
that of ı given in Corollary 9.4. We write ˛W Sym2 K
! Sym2 K for the map
given by the matrix B as deﬁned in Sect. 8; this is deﬁned for arbitrary F 2 kŒx; z,
homogeneous of degree 8. In general ˛ is only a rational map.
Lemma 9.10 Let k be an algebraically closed ﬁeld of characteristic different from 2
and let F 2 kŒx; z be homogeneous of degree 8. We denote by K and ı the objects
associated to F. Then ˛ restricts to a morphism Sym2 Kgood ! Sym2 Kgood.
Proof Note that generically, ˛ ı ˛ D Sym2 ı; this comes from the fact that
f.P C Q/ C .P  Q/; .P C Q/  .P  Q/g D f2P; 2Qg :
If we write   0 for the symmetric matrix > 0 C 0> , then this relation shows
that
  0 D 2B.; 0/
H)
ı./  ı.0/ D 2B.; 0/ ;
(17)
up to a scalar factor, which we ﬁnd to be 1 by taking  D 0 D .0; : : : ; 0; 1/. This is
then a relation that is valid over ZŒf0; : : : ; f8.
Now let  and 0 be projective coordinate vectors of points in Kgood and write
2B.; 0/ D   0 for suitable vectors ; 0. Then by Corollary 9.4, ı./ and ı.0/
both do not vanish, so ı./  ı.0/ ¤ 0. This implies that ; 0 ¤ 0, which shows
that ˛ is deﬁned on Kgood. If the point given by   0 were not in Sym2 Kgood,
then iterating ˛ at most four more times would produce zero by Proposition 9.9 (2),
contradicting the fact that ı can be iterated indeﬁnitely on the points represented
by  and 0.
ut

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
703
10
Heights
We now take k to be a number ﬁeld (or some other ﬁeld of characteristic ¤ 2 with a
collection of absolute values satisfying the product formula, for example a function
ﬁeld in one variable). We also assume again that F 2 kŒx; z is a squarefree binary
octic form. Then C is a curve of genus 3 over k, and we have the Jacobian J
and the Kummer variety K associated to C. We deﬁne the naive height on J and
on K to be the standard height on P7 with respect to the coordinates .1 W : : : W 8/.
We denote it by
h.P/ D
X
v
nv log maxfj1.P/jv; : : : ; j8.P/jvg
for P 2 J .k/ or K .k/;
where v runs through the places of k, the absolute values j  jv extend the standard
absolute values on Q and nv D ŒKv W Qw, where w is the place of Q lying below v,
so that we have the product formula
Y
v
j˛jnv
v D 1
for all ˛ 2 k:
Then by general theory (see for example [7, Part B]) the limit
Oh.P/ D lim
n!1
h.nP/
n2
exists and differs from h.P/ by a bounded amount. This is the canonical height of P.
One of our goals in this section will be to ﬁnd an explicit bound for
ˇ D
sup
P2J .k/

h.P/  Oh.P/

:
We refer to [12] for a detailed study of heights in the case of Jacobians of curves
of genus 2, with input from [14] and [16]. We will now proceed to obtain some
comparable results in our case of hyperelliptic genus 3 Jacobians. Most of this is
based on the following telescoping series trick going back to Tate: we write
Oh.P/ D lim
n!1 4nh.2nP/ D h.P/ C
1
X
nD0
4.nC1/
h.2nC1P/  4h.2nP/

and split the term h.2P/  4h.P/ into local components as follows:
h.2P/  4h.P/ D
X
v
nv

max
j
log jıj..P//jv  4 max
j
log jj.P/jv

D
X
v
nv"v.P/

704
M. Stoll
with "v.P/ D maxj log jıj..P//jv  4 maxj log jj.P/jv, which is independent of the
scaling of the coordinates .P/ and so can be deﬁned for all P 2 J .kv/ or K .kv/.
Then "vW K .kv/ ! R is continuous, so (since K .kv/ is compact) it is bounded. If
v  infP2K .kv/ "v.P/, then we have that
ˇ 
X
v
nv
1
X
nD0
4.nC1/v D 1
3
X
v
nvv :
So we will now obtain estimates for v. We follow closely the strategy of [14]. Note
that writing
v.P/ D
1
X
nD0
4.nC1/"v.2nP/ D lim
n!1 4n max
j
log jıın..P//jv  max
j
log jj.P/j ;
we also have that
Oh.P/ D h.P/ C
X
v
nvv.P/ :
We assume that the polynomial deﬁning the curve C has coefﬁcients in the ring
of integers of k. Then the matrices MT deﬁned in Sect. 5 for even 2-torsion points
have entries that are algebraic integers. We use O to denote the ring of all algebraic
integers. Let  be coordinates of a point on K. Then Theorem 7.3 (3) tells us that
for all even 2-torsion points T ¤ 0, we have that
yT./2 2 Oı1./ C Oı2./ C : : : C Oı8./
and Lemma 6.8 tells us that (note that the coefﬁcient of 2
9j in y0 is zero)
2
j 2
X
T¤0;even
1
8r.T/OyT./ :
Lemma 10.1 Let v be a non-archimedean place of k. Then for P 2 K .kv/, we
have that
log j26 disc.F/jv  log min
T j26r.T/2jv  "v.P/  0 ;
where T runs through the non-trivial even 2-torsion points.
Proof Let  be coordinates for P and write dj D ıj./ for j D 1; : : : ; 8. Then for all
even T ¤ 0,
jyT./j2
v  max
j
jdjjv

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
705
and
jjj4
v  max
T
j8r.T/j2
v jyT./j2
v  max
T
j8r.T/j2
v max
j
jdjjv :
So
"v.P/ D log max
j
jdjjv  4 log max
j
jjjv  log min
T j26r.T/2jv :
Since r.T/2 divides the discriminant disc.F/, the ﬁrst inequality on the left also
follows. The upper bound follows from the fact that the polynomials ıj have integral
coefﬁcients.
ut
Since "v.P/ is an integral multiple of the logarithm of the absolute value of a
uniformizer v, we can sometimes gain a little bit by using
"v.P/  
j
max
T
v

j26r.T/2j
k
log jvjv ;
where v denotes the v-adic additive valuation, normalized so that v.v/ D 1.
Example 10.2 For the curve
y2 D 4x7  4x C 1
over Q and v D 2, the discriminant bound givesF "2.P/  22 log2, since the dis-
criminant of the polynomial on the right hand side (considered as a dehomogenized
binary octic form) has 2-adic valuation 16. To get a better bound, we consider the
resultants r.T/. If we write
f.x/ D 4x7  4x C 1 D 4g.x/h.x/
with g and h monic of degree 3 and 4, respectively, then r.T/ D 28 Res.g; h/. From
the Newton Polygon of f we see that all roots  of f satisfy v2./ D 2=7. This
gives v2.r.T//  32=7. Since the product of all 35 resultants r.T/ is the tenth power
of the discriminant, we must have equality. We get that "2.P/  .15 C 1
7/ log 2,
which can be improved to 15 log 2, so that we have the bound 2  5 log 2.
Corollary 10.3 Assume that k D Q. Then we have that
ˇ  1
3 log j26 disc.F/j C 1
31 :
To get a bound on 1, we use the archimedean triangle inequality. We write
j.T/ for the coordinates of a non-trivial even 2-torsion point T (with 1.T/ D 1)
and &j.T/ for the coefﬁcients in the formula for 2
j , so that we have
2
j D
X
T
&j.T/yT :

706
M. Stoll
Lemma 10.4 Let v be an archimedean place of k. Then we have that
v  log max
j
0
@X
T
j&j.T/jv
v
u
u
t
8
X
iD1
ji.T/jv
1
A
2
:
Proof Similarly as in the non-archimedean case, we have that
jyT./j2
v 
8
X
jD1
jj.T/jv max
j
jdjjv
and
max
j
jjj2
v  max
j
X
T
j&j.T/jvjyT./jv :
Combining these gives the result.
ut
As in [12, Sect. 16B], we can reﬁne this result somewhat. Deﬁne a function
fW R8
0 ! R8
0;
.d1; : : : ; d8/ 7!
0
BB@
v
u
u
u
tX
T
j&j.T/jv
v
u
u
t
8
X
iD1
ji.T/d9ijv
1
CCA
1j8
:
We write k.x1; : : : ; x8/k1 D maxfjx1j; : : : ; jx8jg for the maximum norm.
Lemma 10.5 Deﬁne a sequence .bn/ in R8
0 by
b0 D .1; : : : ; 1/
and
bnC1 D f.bn/ :
The .bn/ converges to a limit b, and we have that
v.P/ 
4N
4N  1 log kbNk1
for all N  1 and all P 2 J .C/. In particular, sup v.J .C//  log kbk1.
Proof See the proof of [12, Lemma 16.1].
ut
Example 10.6 For the curve
y2 D 4x7  4x C 1 ;
the bound 1=3 is 1:15134, whereas with N D 8, we obtain the considerably better
bound 1  0:51852.

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
707
We can improve this a little bit more if kv D R, by making use of the fact that
the coordinates of the points involved are real, but the i.T/ may be non-real. This
can give a better bound on
jy2
Tjv  max
jıijdi
ˇˇˇˇˇ
8
X
iD1
"ii.T/ı9i
ˇˇˇˇˇ
v
:
For the curve above, this improvesF the upper bound for 1 to 0:43829.
Now we show that in the most common cases of bad reduction, there is in fact no
contribution to the height difference bound. This result is similar to [16, Prop. 5.2].
Lemma 10.7 Let v be a non-archimedean place of k of odd residue characteristic.
Assume that the reduction of F at v has a simple root and that the model of C given
by y2 D F.x; z/ is regular at v. Then v.P/ D "v.P/ D 0 for all P 2 J .kv/.
Note that the assumptions on the model are satisﬁed when v.disc.F// D 1.
Proof We work with a suitable unramiﬁed extension K of kv, so that the reduction NF
of F splits into linear factors over the residue ﬁeld. We denote the ring of integers
of K by O. By assumption, NF has a simple root, which by Hensel’s Lemma lifts to
a root of F in P1.K/. We can use a transformation deﬁned over O to move this root
of F to 1. Then we have f8 D 0 and v.f7/ D 0. We can further scale F (at the cost
of at most a further quadratic unramiﬁed extension) so that f7 D 1.
Assume that P 2 J .K/ has "v.P/ ¤ 0 and let  be normalized coordinates for
.P/ 2 K .K/ (i.e., such that the coordinates are in O and at least one of them is
in O). By Proposition 9.9, the reduction of P must lie in some La where a ¤ 1 is
a multiple root of NF. We can shift a to 0; then the coordinates 4, 6, 7 and 8 have
positive valuation. We also have v.f0/ D 1 (this is because the model is regular at
the point .0 W 0 W 1/ in the reduction) and v.f1/  1 (since a D 0 is a multiple root
of NF).
Now assume ﬁrst that v.1/ D 0; then we can scale  such that 1 D 1. We
consider the quantity 034 introduced in Sect. 4; its value on P is in K. By (10), we
have that
2
034 D 
00
2
34 C 
33
2
04 C 
44
2
03  4
00
33
44  
03
04
34
D f0 C .f6  2/2
4  64
(note that 
44 D f8 D 0, 
34 D f7 D 1, 
33 D f6  
24, 
24 D 2, 
04 D 4
and 
03 D 6). Now since v.f0/ D 1, v.4/  1 and v.6/  1, we ﬁnd that
2v.034/ D 1, a contradiction.
So we must have that v.1/ > 0. One can checkF that
1 D .4  5/013 C 7123;
2 D 3014  4024
and
3 D 2024  4134

708
M. Stoll
are functions in L.4/, which are clearly odd, so their squares can be written as
quartics in the j by Lemma 2.3. Let I be the square of the ideal generated by
f0; f1; 1; 4; 6; 7; 8; then anything in I has valuation at least 2. We ﬁndF that
modulo I,
2
1  f04
5;
2
2  f04
3;
2
3  f04
2 :
Since (at least) one of 2, 3, 5 is a unit and v.f0/ D 1, we obtain a contradiction
again.
Therefore "v.P/ D 0 for all P 2 J .K/, which implies that v.P/ D 0 as well.
ut
Example 10.8 The discriminant of the curve
C W y2 D 4x7  4x C 1
isF 2281922344909.Lemma 10.7 now implies that "v.P/ D 0 for all P 2 J .Qv/
for all places v except 2 and 1, including the bad primes 19, 223 and 44909. So,
using Examples 10.2 and 10.6, we obtain the bound
h.P/  Oh.P/ C 5 log 2 C 0:43829  Oh.P/ C 3:90403
for all P 2 J .Q/.
To compute the canonical height Oh.P/ for some point P 2 J .Q/ (say, for a
hyperelliptic curve C of genus 3 deﬁned over Q), we can use any of the approaches
described in [12], except the most efﬁcient one (building on Proposition 14.3 in
loc. cit.), since we have so far no general bound on the denominator of p= log p
in terms of the discriminant. A little bit of care is needed, since contrary to the
genus 2 situation, "v D 0 and v D 0 are not necessarily equivalent—there can be a
difference when the reduction of F is a constant times a square—so the criterion for
a point to be in the subgroup on which v D 0 has to be taken as .P/ 2 Kgood.F/,
where .P/ is the reduction of .P/ at v and F is the residue class ﬁeld.
We can describe the subset on which v D 0 and show that it is a subgroup and
that v factors through the quotient.
Theorem 10.9 Let v be a non-archimedean place of k of odd residue characteristic.
Write J .kv/good for the subset of J .kv/ consisting of the points P such that .P/
reduces to a point in Kgood.F/. Then J .kv/good D fP 2 J .kv/ W v.P/ D 0g
is a subgroup of ﬁnite index of J .kv/, and "v and v factor through the quotient
J .kv/=J .kv/good.
Proof That J .kv/good is a group follows from Lemma 9.10: If P1 and P2 are
in J .kv/good, then P1 ˙ P2 reduce to a point in Kgood as well. This subgroup
contains the kernel of reduction, which is of ﬁnite index, so it is itself of ﬁnite
index. That J .kv/good D fP 2 J .kv/ W v.P/ D 0g follows from the results of
Sect. 9.

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
709
It remains to show that v (and therefore also "v, since "v.P/ D 4v.P/ 
v.2P/) factors through the quotient group. Let P; P0 2 J .kv/ and let  and 0 be
coordinate vectors for .P/ and .P0/, respectively. We can then choose coordinate
vectors  and 0 for .P0CP/ and .P0P/, respectively, such that 0 D 2B.; 0/.
Iterating the implication in (17) then gives
ı./  ı.0/ D 2B

ı./; ı.0/

;
and we can iterate this relation further. If ˛ is a vector or matrix, then we write j˛jv
for the maximum of the v-adic absolute values of the entries of ˛. Deﬁne
"v.P; P0/ D log j2B.; 0/jv  2 log jjv  2 log j0jv
(this does not depend on the scaling of the coordinate vectors) and note that
j  0jv D jjv  j0jv (here we use that the residue characteristic is odd). We then
see that v.P/ D 0 implies v.P C Q/ D v.Q/ for all Q 2 J .kv/ in the same
way as in the proof of [12, Lemma 3.7].
ut
11
An Application
We consider the curve
C 0W y2  y D x7  x ;
which is isomorphic to the curve
C W y2 D 4x7  4x C 1 ;
which we have been using as our running example. Our results can now be used
to determine a set of generators for the Mordell-Weil group J .Q/. This is the key
ingredient for the method that determines the set of integral points on a hyperelliptic
curve as in [3]. We carry out the necessary computations and thence ﬁnd all the
integral solutions of the equation y2  y D x7  x.
A 2-descent on the Jacobian J of C as described in [15] and implemented in
Magma [1] shows that the rank of J .Q/ is at most 4. We have #J .F3/ D 94 and
#J .F7/ D 911, which implies that J .Q/ is torsion free (the torsion subgroup
injects into J .Fp/ for p an odd prime of good reduction). We have the obvious
points .0; ˙1/, .˙1; ˙1/, .˙!; ˙1/, .˙!2; ˙1/ on C , where ! denotes a primitive
cube root of unity, together with the point at inﬁnity. We can check that the rational
divisors of degree zero on C supported in these points generate a subgroup G
of J .Q/ of rank 4, which already shows that J .Q/ Š Z4. Computing canonical
heights, either with an approach as in [12] or with the more general algorithms due

710
M. Stoll
independently to Holmes [8] and Müller [10], we ﬁnd that an LLL-reduced basis of
the lattice .G; Oh/ is given by
P1 D Œ.0; 1/  1;
P2 D Œ.1; 1/  1;
P3 D Œ.1; 1/  1;
P4 D Œ.1; 1/ C .!; 1/ C .!2; 1/  3  1
with height pairing matrix
M 
0
BB@
0:17820
0:01340 0:05683 0:08269
0:01340
0:81995 0:34461 0:26775
0:05683 0:34461 0:98526
0:37358
0:08269 0:26775 0:37358
1:07765
1
CCA :
We can bound the covering radius  of this lattice by 2  0:50752. Using
Example 10.8, it follows that if G ¤ J .Q/, then there must be a point P 2
J .Q/ n G satisfying
h.P/  2 C ˇ  0:50752 C 3:90403 D 4:41155 ;
so that we can write .P/ D .1 W 2 W : : : W 8/ 2 K .Q/ with coprime integers j
such that jjj  be4:41155c D 82. We can enumerate all points in K .Q/ up to this
height bound and check that no such point lifts to a point in J .Q/ that is not in G.
(Compare [16, §7] for this approach to determining the Mordell-Weil group.) We
have therefore proved the following.
Proposition 11.1 The group J .Q/ is free abelian of rank 4, generated by the
points P1, P2, P3 and P4.
A Mordell-Weil sieve computation as described in [2] shows that any unknown
rational point on C must differ from one of the eleven known points
1; .1; ˙1/; .0; ˙1/; . 1
4; ˙ 1
64/; .1; ˙1/; .5; ˙559/
by an element of B  J .Q/, where
B D 26  33  53  72  11  13  17  19  23  29  31  37  43  47  53  61  71  79  83  97
 1:1  1032 :
In particular, we know that every rational point is in the same coset modulo 2J .Q/
as one of the known points. For each of these cosets (there are ﬁve such cosets: the
points with x-coordinate 1=4 are in the same coset as those with x-coordinate 0), we
compute a bound for the size of the x-coordinate of an integral point on C with the
method given in [3]. This shows that
log jxj  2  101229

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
711
for any such point .x; y/. On the other hand, using the second stage of the Mordell-
Weil sieve as explained in [3], we obtain a lattice L 	 Z4 of index  2:3102505 such
that the minimal squared euclidean length of a nonzero element of L is roughly 2:55
101252 and such that every rational point on C differs from one of the known points
by an element in the image of L in J .Q/ under the isomorphism Z4
Š
! J .Q/
given by the basis above. This is more than sufﬁcient to produce a contradiction
to the assumption that there is an integral point we do not already know. We have
therefore proved:
Theorem 11.2 The only points in C .Q/ with integral x-coordinate are
.1; ˙1/; .0; ˙1/; .1; ˙1/; .5; ˙559/ :
In particular, the only integral solutions of the equation
y2  y D x7  x
are .x; y/ D .1; 0/, .1; 1/, .0; 0/, .0; 1/, .1; 0/, .1; 1/, .5; 280/ and .5; 279/.
12
Quadratic Twists
Let F be a squarefree octic binary form over a ﬁeld k not of characteristic 2 and
let c 2 k. Then the Kummer varieties K and K .c/ associated to F and to cF,
respectively, are isomorphic, with an isomorphism from the former to the latter
being given by
.1 W 2 W 3 W : : : W 7 W 8/ 7! .1 W c2 W c3 W : : : W c7 W c28/ :
We can therefore use K as a model for the Kummer variety associated to the
curve C .c/W y2 D cF.x; z/. This will in general change the naive height of a
point P 2 J .c/.Q/, but will not affect the canonical height, which is insensitive
to automorphisms of the ambient P7. The duplication map is preserved by the
isomorphism. This implies that the height difference bounds of Lemmas 10.1
and 10.5 for F apply to K, even when K is used as the Kummer variety of C .c/.
This is because these bounds are valid for all kv-points on K, regardless of whether
they lift to points in J .kv/ or not. Note, however, that the result of Lemma 10.7
does not carry over: in the interesting case, c has odd valuation at v, and so we are in
effect looking at (certain) points on J deﬁned over a ramiﬁed quadratic extension
of kv. Since in terms of the original valuation, the possible values of the valuation
on this larger ﬁeld are now in 1
2Z, the argument in the proof of Lemma 10.7 breaks
down.

712
M. Stoll
When working with this model, one has to modify the criterion for a point to lift
to J .k/ by multiplying the ijk by c.
As an example, consider the curve given by
 
y
2
!
D
 
x
7
!
:
It is isomorphic to the curve
C W y2 D 70.x7  14x5 C 49x3  36x C 630/ D 70F.x; 1/
where F is the obvious octic binary form. The 2-Selmer rank of its Jacobian J is 9,
J .Q/ is torsion free, and the subgroup G of J .Q/ generated by differences of the
27 small rational points on C has rank 9 with LLL-reduced basis
Œ.2; 210/  1;
Œ.1; 210/  1;
Œ.3; 210/  1;
Œ.2; 210/  1;
Œ.3; 210/  1;
Œ.4; 630/  1;
Œ. 5
2;  1785
8 / C .3; 210/ C .4; 630/  31;
Œ.0; 210/  1;
Œ.6; 3570/  1:
We would like to show that these points are actually generators of J .Q/.
Using the Kummer variety associated to 70F, we obtain the following bound
for v at the bad primes and inﬁnity (using the valuations of the resultants r.T/,
Lemma 10.7 and Lemma 10.5):
2  6 log 2;
3   10
3 log 3;
5   10
3 log 5;
7   8
3 log 7;
13 D 0;
17   2
3 log 17;
15717742643 D 0;
1  0:6152:
The resulting bound  20:88 for h  Oh is much too large to be useful.
However, using the Kummer variety associated to F, we ﬁnd that
2   10
3 log 2;
3   10
3 log 3;
5   2
3 log 5;
7 D 0;
13 D 0;
17   2
3 log 17;
15717742643 D 0;
1  0:6152:
This gives a bound of  9:55 (now for a different naive height), which is already a
lot better, but still a bit too large for practical purposes. Now one can check that for
a point P 2 J .Qp/ with p 2 f5; 17g, we always have .2P/ 2 Kgood. This implies
that we get a better estimate
h.2P/  Oh.2P/ C 10
3 log 6 C 0:6152  Oh.2P/ C 6:588
for P 2 J .Q/. A further study of the situation at p D 3 reveals that 3 factors
through the component group ˚ of the Néron model of J over Z3, which has the

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
713
structure Z=3Z  Z=4Z  Z=2Z, and that the minimum of 3 on 2˚ is  5
3 log 3.
This leads to
h.2P/  Oh.2P/ C 4:757 :
(18)
We enumerate all points P in J .Q/ such that h.P/  log 2000 using a p-adic
lattice-based approach with p D 277, as follows. For each of the 10;965;233 points
.0/ ¤ Q 2 K .Fp/ that are in the image of J .Fp/, we construct a sublattice LQ
of Z8 such that for every point P 2 J .Q/ such that .P/ reduces mod p to Q,
every integral coordinate vector for .P/ is in LQ and such that .Z8 W LQ/  p11.
We then search for short vectors in LQ, thus obtaining all points of multiplicative
naive height  2000. Note that all these points are smooth on K over Fp, since
#J .Fp/ is odd. This computation took about two CPU weeks. For points reducing
to the origin, we see that the quadratic equation satisﬁed by points on K forces
1 to be divisible by p2 > 2000, so 1 D 0, and every such point must be on the
theta divisor. A point P D ŒP1 C P2  2  1 2 J .Q/ reduces to the origin if and
only if the points P1 and P2 reduce to opposite points; in particular, the polynomial
whose roots are the x-coordinates of P1 and P2 reduces to a square mod p. Since
the coefﬁcients are bounded by 7 D b2000=pc, divisibility of the discriminant by p
implies that the discriminant vanishes, so that P1 D P2, and the point P does not
reduce to the origin, after all.
We ﬁnd no point P such that 0 < Oh.P/ < Oh.P1/  1:619, where P1 is a known
point of minimal positive canonical height, and no points P outside G such that
Oh.P/ < 2:844  log 2000  4:757. Since the bound (18) is only valid on 2J .Q/,
this implies that there are no points P 2 J .Q/ with 0 < Oh.P/ < 0:711 DW m. Using
the bound (see [6])
I 
6664
s
9
9 det.M/
m9
7775  1787
for the index of the known subgroup in J .Q/, where 9 denotes the Hermite
constant for 9-dimensional lattices and M is the height pairing matrix of the basis
of the known subgroup of J .Q/, we see that it sufﬁces to rule out all primes up
to 1787 as possible index divisors. We therefore check that the known subgroup G
is in fact saturated at all those primes with the method already introduced in [6]:
to verify saturation at p, we ﬁnd sufﬁciently many primes q of good reduction such
that #J .Fq/ is divisible by p (usually nine such primes will sufﬁce) and check that
the kernel of the natural map
G=pG !
Y
q
J .Fq/=pJ .Fq/

714
M. Stoll
is trivial. This computation takes a few CPU days; the most time-consuming task is
to ﬁnd #J .Fq/ for all primes q up to q D 322 781 (which is needed for p D 1471).
This gives the following result.
Theorem 12.1 The points ŒPj  1 freely generate J .Q/, where the Pj 2 C .Q/
are the points with the following x-coordinates and positive y-coordinate:
3; 2;  5
2; 0; 1; 2; 3; 4; 6 :
In principle, one could now try to determine the set of integral points on C with
the method we had already used for y2  y D x7  x. However, a Mordell-Weil sieve
computation with a group of rank 9 is a rather daunting task, which we prefer to
leave to the truly dedicated reader.
Acknowledgements I would like to thank Steffen Müller for helpful comments on a draft version
of this paper and for pointers to the literature. The necessary computations were performed using
the Magma computer algebra system [1].
References
1. W. Bosma, J. Cannon, C. Playoust, The Magma algebra system. I. The user language. J. Symb.
Comput. 24, 235–265 (1997)
2. N. Bruin, M. Stoll, The Mordell-Weil sieve: proving non-existence of rational points on curves.
LMS J. Comput. Math. 13, 272–306 (2010)
3. Y. Bugeaud, M. Mignotte, S. Siksek, M. Stoll, Sz. Tengely, Integral points on hyperelliptic
curves. Algebra & Number Theory 2(8), 859–885 (2008)
4. J.W.S. Cassels, E.V. Flynn, Prolegomena to a Middlebrow Arithmetic of Curves of Genus 2
(Cambridge University Press, Cambridge, 1996)
5. S. Duquesne, Calculs effectifs des points entiers et rationnels sur les courbes, Thèse de
doctorat, Université Bordeaux, 2001
6. E.V. Flynn, N.P. Smart, Canonical heights on the Jacobians of curves of genus 2 and the inﬁnite
descent. Acta Arith. 79(4), 333–352 (1997)
7. M. Hindry, J.H. Silverman, Diophantine Geometry. An Introduction. Springer GTM, vol. 201
(Springer, New York, 2000)
8. D. Holmes, Computing Néron–Tate heights of points on hyperelliptic Jacobians. J. Number
Theory 132(6), 1295–1305 (2012)
9. J.S. Müller, Computing canonical heights on Jacobians, PhD thesis, Universität Bayreuth, 2010
10. J.S. Müller, Computing canonical heights using arithmetic intersection theory. Math. Comput.
83, 311–336 (2014)
11. J.S. Müller, Explicit Kummer varieties of hyperelliptic Jacobian threefolds. LMS J. Comput.
Math. 17, 496–508 (2014)
12. J.S. Müller, M. Stoll, Canonical heights on genus two Jacobians. Algebra & Number Theory
10(10), 2153–2234 (2016)
13. D. Mumford, On the equations deﬁning abelian varieties. I. Invent. Math. 1, 287–354 (1966)
14. M. Stoll, On the height constant for curves of genus two. Acta Arith. 90, 183–201 (1999)

An Explicit Theory of Heights for Hyperelliptic Jacobians of Genus Three
715
15. M. Stoll, Implementing 2-descent for Jacobians of hyperelliptic curves. Acta Arith. 98, 245–
277 (2001)
16. M. Stoll, On the height constant for curves of genus two, II. Acta Arith. 104, 165–182 (2002)
17. M. Stoll, Magma ﬁles with relevant data, http://www.mathe2.uni-bayreuth.de/stoll/magma/
index.html
18. A.G.J. Stubbs, Hyperelliptic curves, PhD thesis, University of Liverpool, 2000

Some Recent Developments
in Spectrahedral Computation
Thorsten Theobald
Abstract Spectrahedra are the feasible sets of semideﬁnite programming and
provide a central link between real algebraic geometry and convex optimization. In
this expository paper, we review some recent developments on effective methods
for handling spectrahedra. In particular, we consider the algorithmic problems
of deciding emptiness of spectrahedra, boundedness of spectrahedra as well as
the question of containment of a spectrahedron in another one. These problems
can proﬁtably be approached by combinations of methods from real algebra and
optimization.
Keywords Spectrahedron • Spectrahedral computation • Real algebraic geome-
try • Convex algebraic geometry • Containment
Subject Classiﬁcations 14Q20, 52A20, 68W30, 90C22
1
Introduction
In the last decade tremendous developments around the connections between
algebraic geometry, convexity and optimization have brought the geometric concept
of a spectrahedron into the focus of research activities. A spectrahedron, whose
terminology is due to Ramana and Goldman [33], is the feasible region of a semidef-
inite program. Hence, spectrahedra are a natural generalization of polyhedra (which
are the feasible sets of linear programs). Spectrahedra are basic semialgebraic sets
and provide a major concept in modern computational real algebraic geometry
[4, 14, 30].
T. Theobald ()
Goethe-Universität, FB 12 – Institut für Mathematik, Postfach 11 19 32,
60054 Frankfurt am Main, Germany
e-mail: theobald@math.uni-frankfurt.de
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_30
717

718
T. Theobald
Formally, let Sk be the set of real symmetric k  k-matrices, S C
k
 Sk be the
subset of positive semideﬁnite matrices, and SkŒx be the set of symmetric k  k-
matrices with polynomial entries in x D .x1; : : : ; xn/. For A0; : : : ; An 2 Sk, denote
by A.x/ the linear (matrix) pencil A.x/ D A0 C x1A1 C    C xnAn 2 SkŒx. The set
SA D fx 2 Rn W A.x/  0g
(1)
is called a spectrahedron, where A.x/  0 denotes positive semideﬁniteness of the
matrix A.x/.
Recent work by a number of authors have advanced a theory of spectrahedral
computation. In this expository paper, we review some of these developments,
equipped with a view towards real and convex algebraic geometry. A particular
focus will then be given on the question whether one given spectrahedron is
contained in another one.
Precisely, given linear matrix pencils A.x/ and B.x/ we consider the following
problems:
Emptiness:
Is SA empty?
Boundedness:
Is SA bounded?
Containment:
Does SA  SB hold?
Most of the results discussed here come from the work of Helton, Kellner, Klep,
McCullough, Schweighofer, Trabandt as well as the author. Rather than to focus on
complete coverage, our goal is to provide an insightful window into these research
developments. Most proofs are omitted and can be found in the original papers.
The paper is structured as follows. In Sect. 2, we introduce polyhedra and
spectrahedra and highlight some occurrences of spectrahedra in real and convex
algebraic geometry. In Sect. 3, we discuss some fundamental algorithmic problems,
in particular the emptiness and boundedness problem. Then, in Sect. 4, we deal
with fundamental aspects of the containment problem. Section 5 is devoted to
hierarchical semideﬁnite approaches to the containment problem.
2
From Polyhedra to Spectrahedra
Starting from polyhedra as a classical cornerstone of mathematics (see the mono-
graphs of Grünbaum [11] or Ziegler [38]), we then introduce some basic notions of
spectrahedra.
2.1
Polyhedra and Polytopes
For a matrix A 2 Rmn and a vector b 2 Rm, the set P D fx 2 Rn W b C Ax  0g
is called a polyhedron. Geometrically, P is the intersection of a ﬁnite number of
halfspaces (H -presentation of a polyhedron, or, for short, H -polyhedron). If the

Some Recent Developments in Spectrahedral Computation
719
polyhedron P is a bounded set, then P is called a polytope. Polytopes can also be
represented as the convex hull of ﬁnitely many points, P D convfp.1/; : : : ; p.l/g with
p.1/; : : : ; p.l/ 2 Rn (V -presentation of a polytope or, for short, V -polytope).
As an occurrence of polyhedra in real algebraic geometry, let us state Handel-
man’s Theorem [12], which provides a characterization of the positive polynomials
on a given polytope. And under a degree restriction it gives a polyhedron of
solutions, since all conditions are linear.
Theorem 2.1 (Handelman) Let g1; : : : ; gm 2 RŒx be afﬁne-linear polynomials
such that K D fx 2 Rn W g1.x/  0; : : : ; gm.x/  0g is non-empty and bounded,
that is, a polytope. Any polynomial p 2 RŒx which is strictly positive on K can be
written as a ﬁnite sum
p D
X
ˇ
cˇ
m
Y
jD1
g
ˇj
j
(2)
with coefﬁcients cˇ  0 (ˇ 2 Nm
0 ). For a ﬁxed upper bound t on the degree, where
t  deg p, the set of solutions .cˇ/jˇjt of
p D
X
jˇjt
cˇ
m
Y
jD1
g
ˇj
j
is a polyhedron.
The latter condition can be transformed into an optimization version to ﬁnd lower
bounds for p on K.
Though polytopes and polyhedra are deﬁned by linear inequalities, they have a
rich geometric and combinatorial structure. Denote by V.P/ the set of vertices (i.e.,
0-dimensional faces) of a polytope P, and by F.P/ the set of facets (i.e., faces of
codimension 1). By McMullen’s Upper bound Theorem [28], any n-dimensional
polytope with k vertices has at most
 
k  d n
2e
b n
2c
!
C
 
k  1  d n1
2 e
b n1
2 c
!
(3)
facets. This bound, which is of inherent importance for polyhedral computation
software such as polymake [9], is sharp for neighborly polytopes, that is, for
polytopes with the property that every set of at most bn=2c vertices is the vertex
set of a face of P. For example, cyclic polytopes are neighborly. And, dual to the
statement, the maximum number of vertices of any n-dimensional polytope with k
facets is given by (3) as well, with equality for dually neighborly polytopes.

720
T. Theobald
2.2
Spectrahedra
We build upon the terminology from the Introduction. Speciﬁcally, for A0; : : : ; An 2
Sk, let SA D fx 2 Rn W A.x/ D A0 C Pn
iD1 xiAi  0g denote the spectrahedron as
deﬁned in (1). The inequality A0CPn
iD1 xiAi  0 is called a linear matrix inequality
(LMI). Since the operator A./ is linear, any spectrahedron is a convex set.
Example 2.2 Figure 1 shows the example of the elliptope
SA D
˚
x 2 R3 W
0
@
1 x1 x2
x1 1 x3
x2 x3 1
1
A  0
	
(see, e.g., [26]).
Note that every polyhedron P D fx 2 Rn W b C Ax  0g can be regarded as a
spectrahedron,
P D PA D
8
ˆ<
ˆ:
x 2 Rn W A.x/ D
0
B@
a1.x/ 0
0
0
:::
0
0
0 ak.x/
1
CA  0
9
>=
>;
;
(4)
where ai.x/ denotes the i-th entry of the vector b C Ax. PA contains the origin in its
interior if and only if the inequalities can be scaled so that b is the all-ones vector
1k in Rk. In this case, A.x/ is called the normal form of the polyhedron PA.
Fig. 1 Visualization of an
elliptope

Some Recent Developments in Spectrahedral Computation
721
Example 2.3 The unit disc fx 2 R2 W x2
1 C x2
2  1g is a spectrahedron. This follows
from setting
A0 D
1 0
0 1

;
A1 D
1 0
0 1

;
A2 D
 0 1
1 0

and observing that
A.x/ D
1 C x1
x2
x2
1  x1

is positive semideﬁnite if and only if 1  x2
1  x2
2  0.
Every spectrahedron S is a basic closed semialgebraic set. This can be seen by
writing S D fx 2 Rn W pi.x/  0 ; i 2 Ig where the pi.x/ are the principal minors
of A.x/, indexed by the set I 2 2f1;:::;kg n f0g. A slightly more concise representation
is given by the following well-known statement, where Ik denotes the k  k identity
matrix.
Proposition 2.4 Any spectrahedron S D SA is a basic closed semialgebraic set. In
particular, given the modiﬁed characteristic polynomial
t 7! det.A.x/ C tIk/ DW tk C
k1
X
iD0
pi.x/ti ;
(5)
S has the representation S D fx 2 Rn W pi.x/  0; 0  i  k  1g.
Proof Denoting by 1.x/; : : : ; k.x/ the eigenvalues of the linear pencil A.x/, we
observe
det.A.x/ C tIk/ D .t C 1.x//    .t C k.x// :
Since A.x/ is symmetric, all i.x/ are real, for any x 2 Rn. Comparing the
coefﬁcients then shows
pki.x/ D
X
t1<			<ti
t1.x/    ti.x/ ;
1  i  k :
Now “” of the desired representation follows from the fact that positive
semideﬁniteness of A.x/ at a given x 2 Rn implies non-negativity of all eigenvalues
1.x/; : : : ; k.x/ and thus non-negativity of all pi.x/. Conversely, if for a given

722
T. Theobald
x 2 Rn we have pi.x/  0 for all i, then the modiﬁed characteristic polynomial
has no sign changes. Thus, by Descartes’ rule of signs, it has no positive roots, and
therefore A.x/ is positive semideﬁnite.

It is an open question to provide good effective criteria to test whether a
given convex semialgebraic set is a spectrahedron or the linear projection of a
spectrahedron. Recently, the conjecture that every convex semialgebraic set would
be the linear projection of a spectrahedron (“Helton-Nie conjecture”) has been
disproven by Scheiderer [34].
2.3
Spectrahedra in Real and Convex Algebraic Geometry
Spectrahedra occur in many places of real and convex algebraic geometry. We point
out three connections to the algorithmic problems mentioned in Sect. 3.
Non-negative Polynomials and Sums of Squares A polynomial p D P
˛ c˛x˛ 2
RŒx D RŒx1; : : : ; xn is called a sum of squares (sos) if it can be written as a
ﬁnite sum P
i ui.x/2 with polynomials ui 2 RŒx. The total degree deg p of an
sos-polynomial p is even. Sum of squares polynomials are ubiquitous in real and
convex algebraic geometry and provide a fundamental sufﬁcient condition for the
property that a polynomial p is non-negative. In order to phrase the sos-property
in terms of a spectrahedral property, let y denote the
nCdeg p=2
n

-dimensional vector
of all monomials in x up to half of the total degree of p. And for some m  0 and
k D
nCdeg p=2
n

, let A.w/ D A0CPm
iD1 wiAi be a matrix pencil spanning the subspace
in Sk deﬁned by the equations
c˛ D
X
ˇCD˛
zˇ;
for all ˛ of total degree at most deg p
(6)
in the symmetric matrix of variables Z D .zˇ;/jˇj;jjdeg p=2.
Proposition 2.5 A polynomial p 2 RŒx can be written as a sum of squares if and
only if the spectrahedron SA is non-empty.
Proof The comparison of the coefﬁcients in (6) is satisﬁed if and only if there exists
a matrix Z with yTZy D c, where c is the coefﬁcient vector of p. Since Z has
a Choleski decomposition LLT if and only if it is positive semideﬁnite, the claim
follows.

Computation of Amoebas For an ideal I D hf1; : : : ; fri  CŒz D CŒz1; : : : ; zn,
the algebraic amoeba (or unlog amoeba) AI is the image of its zero set V .I/ under
the absolute value map, that is, AI D fjzj W z 2 V .I/g. Given  D .1; : : : ; n/ 2
Rn
0, the amoeba membership problem asks whether  2 AI.
For f 2 CŒz, let <.f/ and =.f/ 2 RŒx; y be given through
f.x C iy/ D <.f/.x; y/ C i=.f/.x; y/ :

Some Recent Developments in Spectrahedral Computation
723
Now consider the ideal J generated by the set of polynomials
<.fj/; =.fj/
1  j  r;
x2
k C y2
k  2
k;
1  k  n :
By the real Nullstellensatz, we have  2 AI unless there exists a polynomial G 2 J
and an sos-polynomial H such that G C H C 1 D 0. Given a ﬁxed degree bound,
the set of all the certiﬁcates satisfying that bound deﬁnes a spectrahedron, and
thus the amoeba membership problem can be approached through a hierarchy of
spectrahedral feasibility problems, see [37].
Non-negative Biquadratic Forms Given a biquadratic form
F.x; y/ D
X
.i;j;s;t/2
bijklxiyjxsyt
with  D f.i; j; s; t/ W 1  i; s  k; 1  j; t  lg and real coefﬁcients bijkl, we ask
whether F is non-negative. We can assume that the coefﬁcients satisfy the symmetry
condition bijkl D bkjil and bijkl D bilkj
In order to phrase this question as a containment problem of spectrahedra, set
n D
kC1
2

. For notational convenience, we can then identify x D .x1; : : : ; xn/
with a matrix X 2 Sk. Let A.X/ D X and B.X/ 2 SlŒX be given by bj;t.X/ D
P
1i;sk bijstxis, 1  j; t  l.
Proposition 2.6 The biquadratic form F is non-negative if and only if the spectra-
hedron SA is contained in the spectrahedron SB.
Proof If SA  SB then any positive semideﬁnite matrix X satisﬁes B.X/  0, and
thus for every .x; y/ 2 Rk  Rl we have F.x; y/ D yTB.xxT/y  0. Hence, F is
positive semideﬁnite.
Conversely, let F.x; y/ be a positive semideﬁnite biquadratic form. Since any
positive semideﬁnite matrix X can be written as a ﬁnite sum X D P
i x.i/.x.i//T
with vectors x.i/ 2 Rk, linearity implies yTB.X/y D P
i yTB.x.i/.x.i//T/y D
P
i F.x.i/; y/  0 for any y 2 Rl. Hence, B.X/  0.

3
Fundamental Algorithmic Concepts
In the early years, spectrahedra were mainly considered within optimization
frameworks. The stronger focus on the geometry of these sets has established new
connections to real algebraic geometry and effective computation.

724
T. Theobald
3.1
Infeasibility Certiﬁcates
Given a linear matrix pencil A.x/ 2 SkŒx, we study the question whether SA D ;.
Remark 3.1 For polytopes PA D fx 2 Rn W b C Ax  0g, the question whether
PA is non-empty can be phrased as a linear program and thus can be decided in
polynomial time for a rational input polytope. Also note that even deciding whether
a polytope has an interior point can be decided by a linear program as well (see,
e.g., [18, Example 4.3]).
Testing whether SA D ; can be regarded as the complement of a semideﬁnite
feasibility problem (SDFP), which asks whether for a given linear pencil A.x/ the
spectrahedron SA is nonempty. While semideﬁnite programs (with rational input
data) can be approximated in polynomial time (see [6]), the complexity of SDFP is
open, see [32]. In practice, however, SDFPs can numerically be solved efﬁciently
by semideﬁnite programming.
In view of the classical Nullstellensätze and Positivstellensätze from real alge-
braic geometry, it is a natural question how to certify the emptiness of a spec-
trahedron. For polytopes, the classical Farkas’ Lemma (see, e.g., [35, Cor. 7.1e])
characterizes the emptiness of a polytope in terms of an identity of afﬁne functions
coming from a geometric cone condition.
Theorem 3.2 A polyhedron P D fx 2 Rn W Ax C b  0g is empty if and only if
the constant polynomial 1 can be written as 1 D P
i si.Ax C b/i with si  0; or,
equivalently, if 1 can be written as 1 D c C P
i si.Ax C b/i with c  0, si  0.
Let A.x/ 2 SkŒx. A.x/ is called feasible if the spectrahedron SA is non-empty.
Further, A.x/ is called strongly feasible if A.x/ is feasible and there exists an x 2 Rn
with A.x/  0. In relation to this, the spectrahedron SA is called strongly empty if
A.x/ it is not strongly feasible.
In order to extend Farkas’ Lemma to spectrahedra, denote by CA the convex cone
in SkŒx deﬁned by
CA D fc C hA; Si W c  0; S 2 S C
k g
D fc C
X
i
uT
i Aui W c  0; ui 2 Rng ;
where hA; Si D Tr.AS/ is the dot product underlying the Frobenius norm and Tr
denotes the trace of a matrix. Since A D A.x/ is a linear pencil in SkŒx, every
element in CA is a linear polynomial which is non-negative on the spectrahedron SA.
Theorem 3.3 (Sturm [36]) Given A.x/ 2 SkŒx, the spectrahedron SA is strongly
empty if and only if 1 2 CA.

Some Recent Developments in Spectrahedral Computation
725
An exact characterization for the emptiness of SA can be established in terms of
a quadratic module associated to A.x/. Recall that a subset M of a commutative ring
R with 1 is called a quadratic module if it satisﬁes the conditions
1 2 M; M C M  M and a2M  M for any a 2 R :
Given a linear pencil matrix A D A.x/, denote by MA the quadratic module in RŒx
MA D fs C hA; Si W s 2 ˙Œx; S 2 RŒxkk an sos-matrixg
(7)
D fs C
X
i
uT
i Aui W s 2 ˙Œx; ui 2 RŒxkg ;
(8)
where ˙Œx denotes the subset of sums of squares of polynomials within RŒx and an
sos-matrix is a matrix polynomial of the form PTP for some matrix polynomial P.
Note that if a polynomial f 2 RŒx is contained in MA then it is non-negative on SA.
Further, denote by M.t/
A the truncated quadratic module
M.t/
A D fs C hA; Si W s 2 ˙Œx \ RŒx2t; S 2 RŒxkk
2t
sos-matrixg
D fs C
X
i
uT
i Aui W s 2 ˙Œx2t; ui 2 RŒxk
t g  RŒx2tC1 ;
where RŒxt denotes the set of polynomials of total degree at most t.
Theorem 3.4 (Klep, Schweighofer [23]) For A.x/ 2 SkŒx, the following are
equivalent:
1. The spectrahedron SA is empty.
2. 1 2 MA.
3. 1 2 M.2minfn;k1g/
A
.
The third of these statements provides the ground for a computational treatment
in terms of algebraic certiﬁcates for infeasibility. Namely, the question whether
such a representation of bounded degree exists can be formulated as a semideﬁnite
feasibility problem.
In order to carry out this formulation as a semideﬁnite program, set t D
2minfn;k1g. Then the value
max
˚
 2 R W 1   D s C hA; Si; s 2 ˙Œx \ RŒx2t; S 2 RŒxkk
2t
sos-matrix
	
coincides with the value of the semideﬁnite program
max 
s:t: 1   D Tr.P1X/ C Tr.Q1Y/
0 D Tr.PiX/ C Tr.QiY/
for 2  i  mw WD
nC2tC1
2tC1

;
X  0; Y  0 :
(9)

726
T. Theobald
Here, denoting by w D w.x/ and y D y.x/ the vectors of monomials in x1; : : : ; xn of
degrees up to 2t C 1 and t in lexicographic order, Qi is deﬁned through y.x/y.x/T D
Pmw
iD1 Qiwi.x/. And, setting my D
nCt
t

, the permutation matrix P 2 Rkmykmy is
given via P.Ik ˝ y.x// D y.x/ ˝ Ik, and the matrices Pi are deﬁned through
P.Ik ˝ y.x//  A.x/  .P.Ik ˝ y.x///T D
mw
X
iD1
Piwi.x/ 2 RŒxkmykmy :
Hence, 1 2 M.2 minfn;k1g/
A
if and only if the objective value of (9) is non-
negative. This decision problem is a semideﬁnite feasibility problem, since the
property of a non-negative linear objective function can also be viewed as an
additional linear constraint.
Example 3.5 Let
A.x/ D
0
@
1 C x 1
0
1
0 1
0
1 x
1
A D
0
@
1 1
0
1 0 1
0 1 0
1
A C x
0
@
1 0 0
0 0 0
0 0 1
1
A :
Since minfn; k1g D f1; 31g D 1, we can assume y D y.x/ D .1; x/T. We obtain
Q1 D
1 0
0 0

;
Q2 D
0 1
1 0

;
Q3 D
0 0
0 1

;
Q4 D
0 0
0 0

;
and the matrices P1; : : : ; P4 are
0
BBBBBBB@
1 1
0 0 0 0
1 0 1 0 0 0
0 1 0 0 0 0
0 0
0 0 0 0
0 0
0 0 0 0
0 0
0 0 0 0
1
CCCCCCCA
;
0
BBBBBBB@
1 0
0 1 1
0
0 0
0 1 0 1
0 0
1 0 1 0
1 1
0 0 0
0
1 0 1 0 0
0
0 1 0 0 0
0
1
CCCCCCCA
;
0
BBBBBBB@
0 0 0 1 0
0
0 0 0 0 0
0
0 0 0 0 0
1
1 0 0 1 1
0
0 0 0 1 0 1
0 0 1 0 1 0
1
CCCCCCCA
;
0
BBBBBBB@
0 0 0 0 0 0
0 0 0 0 0 0
0 0 0 0 0 0
0 0 0 1 0 0
0 0 0 0 0 0
0 0 0 0 0 1
1
CCCCCCCA
:
Since the positive semideﬁnite matrices
X D
0
BBBBBBB@
1 0 0 0 0 0
0 2 1 0 0 0
0 1 2 0 3
2 0
0 0 0 0 0 0
0 0 3
2 0 2 0
0 0 0 0 0 0
1
CCCCCCCA
;
Y D
0 0
0 0


Some Recent Developments in Spectrahedral Computation
727
provide a feasible solution of the semideﬁnite program (9) with objective value 0,
we see that the spectrahedron SA is empty. By a Choleski factorization
X D LLT
with L D
0
BBBBBBB@
1
0
0
0
0
p
2
0
0
0
p
2=2
p
6=2
0
0
0
0
0
0
0
p
6=2
p
2=2
0
0
0
0
1
CCCCCCCA
;
we can deduce from the semideﬁnite program (9) that u1 D .1; 0; 0/T, u2 D
.0;
p
2;
p
2=2/T, u3 D .0;
p
6=2x;
p
6=2/T, u4 D .0;
p
2=2x; 0/T provides the
desired algebraic certiﬁcate 1 2 MA, where the ui are as in (8). We remark that
u4 can be omitted due to uT
4A.x/u4 D 0.
Origin in the Interior We shortly point out a ﬁne point which explains a technical
assumption in later statements. Clearly, if the constant matrix A0 of a pencil A.x/ is
positive semideﬁnite then the origin is contained in the spectrahedron SA. However,
in general it is not true that A0 is positive deﬁnite if and only if the origin is contained
in the interior of SA. Fortunately, by [33, Corollary 5], if a spectrahedron SA is
full-dimensional, then there exists a so-called reduced linear pencil that is positive
deﬁnite exactly on the interior of SA. Hence, in the case of a reduced pencil we
have 0 2 int SA if and only A0  0. Moreover, for arbitrary dimension of SA, we
have 0 2 int SA if and only if there is a linear pencil A0.x/ with the same positivity
domain such that A0
0 D Ik (see [14]). Such a pencil is called monic.
3.2
Boundedness
In order to certify that a given spectrahedron is bounded, the quadratic module (7)
is applied as well. Recall that a quadratic module M  RŒx is called archimedean
if it contains a polynomial of the form N  Pn
iD1 x2
i for some N > 0.
Theorem 3.6 (Klep, Schweighofer [23]) Given A.x/ 2 SkŒx, the spectrahedron
SA is bounded if and only if MA is archimedean.
Example 3.7 In order to show that the spectrahedron SA of
A.x/ D
0
@
x 1
0
1 x
0
0 0 x C 2
1
A

728
T. Theobald
is bounded, we ask for u 2 RŒx3 and sos-polynomials s0, s1 with
N 
3
X
iD1
x2
i D uTAu C s2
1.x C 2/ C s0
for some N > 0. The choice u D .x  1
2; x C 1; 0/T, s1 D 2x2 C 17
4 , s0 D 0 and
N D 17
2 gives an algebraic certiﬁcate for the boundedness of SA.
There exist spectrahedra whose elements have coordinates of double-exponential
size in the number of variables and whose distance to the origin grows double-
exponentially in the number of variables (see [1, 33]). Hence, in general one
cannot expect to have a certiﬁcate of polynomial size for the boundedness of the
spectrahedron.
4
Containment Problems
As a next step in the class of algorithmic problems on spectrahedra, we consider
containment problems: Given two linear pencils A.x/ 2 SkŒx and B.x/ 2 SlŒx, is
SA  SB?
Containment problems of convex sets are a classical topic in convex geometry
(see, e.g., Gritzmann and Klee for the containment of polytopes and a number of
computational aspects [10]). In the context of spectrahedra, the study of algorithmic
approaches and relaxations has been initiated by Ben-Tal and Nemirovski [2] who
investigated the case where SA is a cube and SB is an arbitrary spectrahedron (“matrix
cube problem”). Figure 2 visualizes an elliptope in a ball.
4.1
Complexity of Containment Problems for Spectrahedra
It is useful to start from the case of polytopes. Here, it is well-known that the
computational complexity of deciding containment of a given polytope P in a given
polytope Q strongly depends on the type of input representations. We assume that
all input data is given in terms of rational numbers, and the dimension is part of the
input.
Proposition 4.1 [7] The following problems can be decided in polynomial time.
1. Given H -polytopes P and Q, is P  Q?
2. Given V -polytopes P and Q, is P  Q?
3. Given a V -polytope P and an H -polytope Q, is P  Q?
In contrast to this, deciding whether an H -polytope is contained in a V -polytope
is co-NP-complete.

Some Recent Developments in Spectrahedral Computation
729
Fig. 2 Visualization of an
elliptope in a ball
In [21], this classiﬁcation has been extended to containment problems involving
polytopes and spectrahedra, where the spectrahedra are given by a linear pencil with
rational entries. The main hardness results are given by the subsequent Theorems 4.2
and Proposition 4.3.
Theorem 4.2 [21] The following problems are co-NP-hard:
1. Given a spectrahedron SA and a V -polytope Q, is SA  Q?
2. Given an H -polytope P and a spectrahedron SB, is P  SB?
The latter hardness statement persists if the H -polytope is a standard cube or if the
outer spectrahedron is a ball.
Since deciding whether a given rational matrix is positive semideﬁnite can
be done in polynomial time, it can be decided in polynomial time whether a
V -polytope is contained in a spectrahedron. As mentioned earlier, the question
“Can semideﬁnite feasibility problems SDFP be solved in polynomial time?” is an
open complexity question. Consequently, the following statement on containment
of a spectrahedron in an H -polytope does not give a complete answer concerning
polynomial solvability of these containment questions in the Turing machine model.
If the additional inequalities were non-strict, then we had to decide a ﬁnite set of
problems from the complement of the class SDFP.

730
T. Theobald
Table 1 Computational
complexity of containment
problems, where the rows
refer to the inner set and the
columns to the outer set
H
V
S
H P
co-NP-complete co-NP-hard
V
P
P
P
S
“SDFP” co-NP-hard
co-NP-hard
“SDFP” refers to the formulations through
semideﬁnite
feasibility
problems
as
described in Proposition 4.3
Proposition 4.3 [21] The problem of deciding whether a spectrahedron is con-
tained in an H -polytope can be formulated by the complement of semideﬁnite
feasibility problems (involving also strict inequalities), whose sizes are polynomial
in the input data.
Since Theorem 4.2 also implies that deciding containment of a spectrahedron in
a spectrahedron is co-NP-hard, all the relevant cases are covered. See Table 1 for a
condensed presentation, where H , V and S stand for H -polytope, V -polytope
and spectrahedron, respectively.
For the computational question of deciding whether a spectrahedron is a
polyhedron see Bhardwaj et al. [3], and for sos-based approaches to the NP-
hard containment problem of deciding whether an H -polytope is contained in a
V -polytope see Kellner and Theobald [20].
4.2
From Farkas-Type Characterizations for Polytopes to
Relaxations for Spectrahedra
In this section, we present some recent results on semideﬁnite relaxations which
provide a sufﬁcient criterion for the containment problem of spectrahedra. Here,
relaxation means that some conditions are omitted from the original problem in
order to obtain a more tractable, semideﬁnite formulation.
It is helpful to start from the containment problem for pairs of H -polytopes,
which by Proposition 4.1 can be decided in polynomial time. Indeed, as a conse-
quence of the afﬁne form of Farkas’ Lemma, this can be achieved by solving a linear
program, as stated by the following necessary and sufﬁcient criterion (see, e.g.,
[21]). Recall that a real matrix with non-negative entries is called right stochastic
if each row sums to one.
Proposition 4.4 Let PA D fx 2 Rn W 1kCAx  0g and PB D fx 2 Rn W 1lCBx 
0g be polytopes. Then PA  PB if and only if there exists a right stochastic matrix C
with B D CA.

Some Recent Developments in Spectrahedral Computation
731
For the treatment of containment of spectrahedra, a good starting point is the
sufﬁcient criterion given by Helton et al. [15]. As earlier, let A.x/ 2 SkŒx and
B.x/ 2 SlŒx be linear pencils. In the subsequent statement, the indeterminate matrix
C D

Cij
k
i;jD1 is a symmetric kl  kl-matrix where the Cij are l  l-blocks.
Theorem 4.5 ([15, Theorem 4.3], See Also [21, Theorems 4.3 and 4.4]) Let A.x/ 2
SkŒx and B.x/ 2 SlŒx be linear pencils. If one of the systems
C D

Cij
k
i;jD1  0;
8p D 0; : : : ; n W Bp D
k
X
i;jD1
ap
ijCij
(10)
or
C D

Cij
k
i;jD1  0;
B0 
k
X
i;jD1
a0
ijCij  0;
8p D 1; : : : ; n W Bp D
k
X
i;jD1
ap
ijCij
(11)
is feasible, then SA  SB. Here, ap
ij denotes the .i; j/-entry of Ap.
Note that whenever (10) is satisﬁed, condition (11) is satisﬁed as well. However,
(11) contains an additional sos-condition. An elementary proof of Theorem 4.5 was
given in [21]—here, we provide a slight variant of that proof.
Proof of Theorem 4.5. For x 2 SA, the last two conditions in (11) imply
B.x/ D B0 C
n
X
pD1
xpBp 
k
X
i;jD1
a0
ij Cij C
n
X
pD1
k
X
i;jD1
xp ap
ij Cij D
k
X
i;jD1
.A.x//ij Cij :
(12)
For any block matrices S D .Sij/ij and T D .Tij/ij, consisting of k  k blocks of
size p  p and q  q, the Khatri-Rao product of S and T is deﬁned as the block-wise
Kronecker product of S and T, i.e.,
S  T D

Sij ˝ Tij

ij 2 Skpq :
If both S and T are positive semideﬁnite, then the Khatri-Rao product ST is positive
semideﬁnite as well, see [27, Theorem 5].
In our situation, we have p D 1 and q D l, and the Khatri-Rao product
A.x/  C D

.A.x//ij ˝ Cij
k
i;jD1 D

.A.x//ijCij
k
i;jD1
is positive semideﬁnite. And since B.x/ is given in (12) as a sum of submatrices of
A.x/  C, we obtain that B.x/ is positive semideﬁnite, i.e., x 2 SB.
When starting from system (10), the inequality chain in (12) becomes an equality,
and the remaining part of the proof remains valid.


732
T. Theobald
For both systems (10) and (11) the feasibility depends on the linear pencil
representation of the sets involved. If SB is contained in the positive orthant, a
stronger version can be given.
Corollary 4.6 Let A.x/ 2 SkŒx and B.x/ 2 SlŒx be linear pencils and let SA be
contained in the non-negative orthant. If the system
C D

Cij
k
i;jD1  0;
B0 
k
X
i;jD1
a0
ijCij  0;
8p D 1; : : : ; n W Bp 
k
X
i;jD1
ap
ijCij  0
(13)
is feasible, then SA  SB.
Proof Since SA is contained in the non-negative orthant, any x 2 SA has non-
negative coordinates, and hence,
B.x/ D B0 C
n
X
pD1
xpBp 
k
X
i;jD1
a0
ij Cij C
n
X
pD1
k
X
i;jD1
xp ap
ij Cij D
k
X
i;jD1
.A.x//ij Cij :

The version (13) is strictly stronger than system (10). There are cases, where
a solution to the condition (13) exists, even though the original system (10) is
infeasible.
4.3
Exact Cases of the Relaxation
It turns out that the sufﬁcient semideﬁnite criteria (10) and (11) even provide exact
containment characterizations in several important cases.
Recall the normal form for polyhedral spectrahedra introduced in Sect. 2, and
let us also introduce a normal form for the class of centered and aligned ellipsoids.
Here, an ellipsoid is called centered if it is centrally symmetric, and it is called
aligned if its axes are aligned to the directions of the coordinate axes. A centered
and aligned ellipsoid with semi-axes of lengths a1; : : : ; an can be written as the
spectrahedron SA of the monic linear pencil
A.x/ D InC1 C
n
X
pD1
xp
ap
.Ep;nC1 C EnC1;p/;
(14)
where Eij denotes the matrix with a one in position .i; j/ and zeros elsewhere. This
representation is called the normal form of the ellipsoid. If a1 D    D an, this
gives the normal form of a ball. The exact characterizations also use the following

Some Recent Developments in Spectrahedral Computation
733
extended form Sb
A of a spectrahedron SA. Given a linear pencil A.x/ 2 SkŒx, we call
the linear pencil with an additional 1 on the diagonal
bA.x/ D
1
0
0 A.x/

2 SkC1Œx
(15)
the extended linear pencil of SA D Sb
A. Note that the spectrahedra SA D Sb
A coincide.
The entries of bAp in the pencil bA.x/ D bA0 C Pn
pD1 xpbAp are denoted by ba p
ij for
i; j D 0; : : : ; k.
Theorem 4.7 [21] Let A.x/ 2 SkŒx and B.x/ 2 SlŒx be monic linear pencils. In
the following cases the criteria (10) as well as (11) are necessary and sufﬁcient for
the inclusion SA  SB:
1. if A.x/ and B.x/ are normal forms of centered and aligned ellipsoids,
2. if A.x/ and B.x/ are normal forms of a ball and an H -polyhedron, respectively,
3. if B.x/ is the normal form of a polytope,
4. if bA.x/ is the extended form of a spectrahedron and B.x/ is the normal form of a
polyhedron.
Recently, Fritz, Netzer and Thom have shown the following exactness result
which distinguishes the simplex situation within the situation that SA is a polytope.
Theorem 4.8 [8, Cor. 5.3] For a ﬁxed polytope SA, the criterion (10) is exact for
any spectrahedron SB if and only if SA is a simplex, and this statement is independent
of the representing pencil of the polytope SA.
Note that all the exactness statements presented in this section refer to exact
characterizations of the containment problem in terms of a formulation as semidef-
inite program. Similar to the case of the infeasibility certiﬁcates in Sect. 3, when it
comes to actually solving the semideﬁnite programs, in case of employing numerical
solvers this involves additional numerical aspects.
5
Sufﬁcient Semideﬁnite Hierarchies for Containment of
Spectrahedra
In this section, we present two hierarchical approaches for the containment problem
in terms of polynomial matrix inequalities (PMI). The underlying PMI hierarchy
was developed by Kojima [24], Hol and Scherer [17], as well as Henrion and
Lasserre [16], and it generalizes the Lasserre hierarchy for polynomial optimiza-
tion [25]. We then discuss the relation of the two approaches for containment to
each other as well as the connection to positive maps.

734
T. Theobald
5.1
From the Sufﬁcient Criterion to a Moment Hierarchy of
Sufﬁcient Criteria
As before, let A.x/ 2 SkŒx and B.x/ 2 SlŒx, and assume that SA ¤ ;. By deﬁnition
of a positive semideﬁnite matrix, we have SA  SB if and only if the inﬁmum  of
the polynomial optimization problem
 D inf zTB.x/z
s:t: A.x/  0
g.z/ WD zTz  1 D 0
(16)
in the variables .x; z/ D .x1; : : : ; xn; z1; : : : ; zl/ is non-negative(cf. [22] for improved
numerical stability). Setting GA.x; z/ to be the matrix with blocks A.x/ as well as the
two 1  1-blocks g.z/ and g.z/, the constraints can be written as GA.x; z/  0.
The general framework of moment relaxations for PMIs translates the opti-
mization problem into a semideﬁnite hierarchy as a relaxation to problem (16).
Assuming, for ease of notation, that we are working over the variables x D
.x1; : : : ; xn/, let y D .y˛/ be a real sequence indexed by the monomials in x. Let M.y/
be the inﬁnite moment matrix deﬁned by .M.y//˛;ˇ D Ly..ŒxŒxT/˛;ˇ/ D y˛Cˇ,
where Œx is the inﬁnite vector of monomials in x1; : : : ; xn and Ly is the linearization
operator that maps a monomial x˛ to the associated moment variable y˛. Mt.y/
denotes the truncated moment matrix that contains only entries .M.y//˛;ˇ with
j˛j; jˇj  t.
The positive semideﬁniteness constraint on a matrix polynomial G.x/ 2 SkŒx
is captured by the localizing matrices. The truncated localizing matrix Mt.Gy/ is
deﬁned as Mt.Gy/ D Ly.ŒxtŒxT
t ˝ G.x//, where application of the linearization
operator Ly is component-wise. If dG denotes the highest degree of a polynomial
appearing in G.x/, then only linearization variables coming from monomials of
degree at most 2t C dG appear in Mt.Gy/.
For t  2, the t-th relaxation of the polynomial optimization problem (16)
becomes
mom.t/ D inf Ly.zTB.x/z/
s.t. Mt.y/  0
Mt1.GAy/  0 :
(17)
Note that t D 2 is the initial relaxation order. The sequence mom.t/ for t  2 is
monotone non-decreasing. If for some t the condition mom.t/  0 is satisﬁed,
then SA  SB.
The following connection will be further reﬁned and extended in Theorems 5.5
and 5.7.

Some Recent Developments in Spectrahedral Computation
735
Theorem 5.1 [22] Let SA ¤ ;. Then mom.2/  0 (and thus mom.t/  0 for all
t  2) if and only if the SDFP (10) has a solution C  0, that is, if and only if the
sufﬁcient containment criterion in Theorem 4.5 is satisﬁed.
5.2
The Hol-Scherer Hierarchy
The background of the second hierarchical approach is provided by Hol-Scherer’s
Positivstellensatz. In order to characterize matrix polynomials which are positive
semideﬁnite on a spectrahedron, we consider a generalization of the quadratic
module (7) for a matrix polynomial G 2 SkŒx. For any l  0, let
MG;l D fS0 C hS; Gil W S0 2 RŒxll sos-matrix; S 2 RŒxklkl sos-matrixg ;
where for matrices U D .Uij/l
i;jD1 2 Skl and V 2 Sk the lth scalar product is
deﬁned by
hU; Vil D .hUij; Vi/l
i;jD1 2 Sl :
Proposition 5.2 (Hol, Scherer [17]) Let G.x/ be a matrix polynomial in SkŒx.
Further assume that there exists a polynomial p.x/ D s.x/ C hS.x/; G.x/i for some
sos-polynomial s.x/ 2 RŒx and some sos-matrix S.x/ 2 SkŒx, such that the level
set fx 2 Rn W p.x/  0g is compact. Then every matrix polynomial F 2 SlŒx
which is positive semideﬁnite on fx 2 Rn W G.x/  0g is contained in the quadratic
module MG;l.
As before, let A.x/ 2 SkŒx and B.x/ 2 SlŒx be linear pencils, and consider for
t  0 the truncated quadratic module
M.t/
A;l D fS0 C hS; Ail W S 2 RŒxll
2t sos-matrix; S 2 RŒxklkl
2t
sos-matrixg :
(18)
Proposition 5.3 ([19, 22]) Let A.x/ 2 SkŒx, BŒx 2 SlŒx be linear pencils.
1. If B.x/ 2 M.t/
A;l for some t  0, then SA  SB.
2. Let SA be bounded and B.x/ be a reduced pencil. If SA is contained in the interior
of SB then there exists some t  0 such that B.x/ 2 M.t/
A;l.
For computational purposes and to relate the hierarchy to the moment approach
in Sect. 5.1, it is useful to pass over to a robust optimization version. First note that
SA  SB if and only there exists some   0 with
B.x/  Il  0
for all x 2 SA :

736
T. Theobald
Now we consider the hierarchy of optimization problems
sos.t/ D sup 
s:t: B.x/  Il  .hSi;j.x/; A.x/i/l
i;jD1 sos-matrix
S.x/ D .Si;j.x//l
i;jD1 2 SklŒx sos-matrix;
(19)
where S.x/ has l  l blocks of size k  k with entries of degree at most 2t  0. Given
some t  0, we observe that sos.t/  0 implies that SA  SB.
Theorem 5.4 ([22]) Let A.x/ 2 SkŒx be a linear pencil such that the spectrahe-
dron SA is bounded. Then the optimal values of the moment relaxation (17) and of
the sos-relaxation (19) converge from below to the optimal value of the polynomial
optimization problem (16), i.e., mom.t/ "  and sos.t/ "  as t ! 1.
The following theorem shows that that the sufﬁcient criteria coming from the
hierarchies of relaxations are at least as strong as the criterion (10) by showing
that feasibility of the criterion (10) implies .t/  0 and sos.t/  0 in the initial
relaxation steps of the semideﬁnite hierarchies (17) and (19). From this relation, we
get that in some cases already the initial relaxation step of the hierarchies gives an
exact answer to the containment problem; see Sect. 5.3.
Theorem 5.5 ([22]) Let SA ¤ ;. Then for the properties
1. the SDFP (10) has a solution C  0,
2. sos.0/  0,
3. mom.2/  0,
4. SA  SB,
we have the implications 1 ” 2 H) 3 H) 4 :
For further aspects on the Hol-Scherer hierarchy for containment see also
Kellner’s dissertation [19].
5.3
(Completely) Positive Maps
We brieﬂy discuss the connection of the hierarchies to the theory of positive maps
and completely positive maps. For background on positive and completely positive
maps see, e.g., [31].
Deﬁnition 5.6 Given two linear subspaces A  Rkk and B  Rll, a linear map
˚ W A ! B is called positive if ˚.A/  0 for any A 2 A with A  0.
The map ˚ is called d-positive if the map ˚d W Rdd ˝ A ! Rdd ˝ B; M ˝
A 7! M ˝ ˚.A/ is positive, i.e., if M ˝ ˚.A/  0 whenever M ˝ A  0. And ˚ is
called completely positive if ˚d is positive for all d  1.

Some Recent Developments in Spectrahedral Computation
737
As explained in the following, checking positivity of a map on a subspace is
equivalent to checking containment for spectrahedra. This does not only provide
a structural connection, but also allows to apply the hierarchy for the containment
question to positivity questions of maps on subspaces, such as the ones in [13]. Note
that for the special case of detecting positivity of a map on the whole space, Nie has
recently shown that this can be done by solving a ﬁnite number of semideﬁnite
relaxations [29].
For simplicity, we restrict to the situation that A0; : : : ; An are linearly independent
and that SA is bounded. Let the linear map ˚AB W A ! B be deﬁned through
˚AB.Ap/ D Bp
for 0  p  n :
Then the following extension of Theorem 5.5 states the connection of the semideﬁ-
nite hierarchies with positive and completely positive maps.
Theorem 5.7 [22] Let A0; : : : ; An be linearly independent and SA be non-empty
and bounded. Then for the properties
1. ˚AB is completely positive,
2. the SDFP (10) has a solution C  0,
3. sos.0/  0,
4. mom.2/  0,
5. SA  SB,
6. ˚AB is positive,
we have the implications 1 (H 2 ” 3 H) 4 H) 5 ” 6. If A contains a
positive deﬁnite matrix, then the implication 1 (H 2 is an equivalence.
Note that Theorem 5.4 implies a partial converse of the implication 3 H) 4.
Namely, if ; ¤ SA  SB and SA is bounded, then mom.t/ "   0 for t ! 1.
Theorem 5.7 allows to extend the exactness results from Theorem 4.7 to the
initial step of the hierarchy (17).
Remark 5.8 It is well-known that the map ˚AB connects to the characterization of
biquadratic forms in Proposition 2.6 (see [5]). A positive linear map ˚ W Sk ! Sl
is completely positive if and only if ˚ can be written as ˚.A/ D P
s VT
s AVs for
some matrices Vs 2 Rkl if and only if the corresponding biquadratic form F.x; y/
is a sum of squares of bilinear forms, F.x; y/ D P
s.xTVsy/2.
6
Final Remarks
We have reviewed some recent developments on fundamental algorithmic problems
in spectrahedral computation. While containment question for spectrahedra are co-
NP-hard in general, the hierarchical relaxation techniques give a practical way
of certifying containment. For detailed experiments of the two approaches (17)

738
T. Theobald
and (19), see [21] and [22]. In practice, the sufﬁcient criteria perform well already
for small relaxation orders.
While in many situations the running times of the two hierarchical approaches for
containment are comparable, the number of linearization variables in the moment
approach (17) does not depend on the size k of the pencil A.x/. Therefore, for
problems with relatively large k, this approach to the containment problem seems to
be superior to the approach based on Hol-Scherer’s hierarchy.
Acknowledgements The author was partially supported through DFG grant 1333/3-1 within
the Priority Program 1489 “Algorithmic and Experimental Methods in Algebra, Geometry, and
Number Theory.”
He would also like to thank an anonymous referee for careful reading and helpful suggestions.
References
1. F. Alizadeh, Interior point methods in semideﬁnite programming with applications to combi-
natorial optimization. SIAM J. Optim. 5(1), 13–51 (1993)
2. A. Ben-Tal, A. Nemirovski, On tractable approximations of uncertain linear matrix inequalities
affected by interval uncertainty. SIAM J. Optim. 12(3), 811–833 (2002)
3. A. Bhardwaj, P. Rostalski, R. Sanyal, Deciding polyhedrality of spectrahedra. SIAM J. Optim.
25(3), 1873–1884 (2015)
4. G. Blekherman, P.A. Parrilo, R.R. Thomas, Semideﬁnite Optimization and Convex Algebraic
Geometry (Society for Industrial and Applied Mathmatics, Philadelphia, PA, 2013)
5. M.-D. Choi, Positive semideﬁnite biquadratic forms. Linear Algebra Appl. 12(2), 95–100
(1975)
6. E. de Klerk, Aspects of Semideﬁnite Programming, Applied Optimization, vol. 65 (Kluwer
Academic Publishers, Dordrecht, 2002)
7. R.M. Freund, J.B. Orlin, On the complexity of four polyhedral set containment problems. Math.
Program. 33(2), 139–145 (1985)
8. T. Fritz, T. Netzer, A. Thom, Spectrahedral containment and operator systems with ﬁnite-
dimensional realization (2016). Preprint, arXiv:1609.07908
9. E. Gawrilow, M. Joswig, polymake: A framework for analyzing convex polytopes, in
Polytopes–Combinatorics and Computation, ed. by G. Kalai, G.M. Ziegler (Birkhäuser, Basel,
2000), pp. 43–74
10. P. Gritzmann, V. Klee, On the complexity of some basic problems in computational convexity.
I. Containment problems. Discrete Math. 136(1–3), 129–174 (1994)
11. B. Grünbaum, Convex Polytopes, 2nd edn. Graduate Texts in Mathematics, vol. 221 (Springer,
New York, 2003)
12. D. Handelman, Representing polynomials by positive linear functions on compact convex
polyhedra. Pac. J. Math. 132(1), 35–62 (1988)
13. T. Heinosaari, M.A. Jivulescu, D. Reeb, M.M. Wolf, Extending quantum operations. J. Math.
Phys. 53(10), 102208 (2012)
14. J.W. Helton, V. Vinnikov, Linear matrix inequality representation of sets. Commun. Pure Appl.
Math. 60(5), 654–674 (2007)
15. J.W. Helton, I. Klep, S. McCullough, The matricial relaxation of a linear matrix inequality.
Math. Program. 138(1–2, Ser. A), 401–445 (2013)
16. D. Henrion, J.B. Lasserre, Convergent relaxations of polynomial matrix inequalities and static
output feedback. IEEE Trans. Autom. Control 51(2), 192–202 (2006)

Some Recent Developments in Spectrahedral Computation
739
17. C.W.J. Hol, C.W. Scherer, Sum of squares relaxations for polynomial semideﬁnite program-
ming, in Proceedings of Symposium in Mathematical Theory of Networks and Systems, Leuven,
2004
18. M. Joswig, T. Theobald, Polyhedral and Algebraic Methods in Computational Geometry.
Universitext (Springer, London, 2013)
19. K. Kellner, Positivstellensatz certiﬁcates for containment of polyhedra and spectrahedra. PhD
thesis, Goethe University, Frankfurt am Main, 2015
20. K. Kellner, T. Theobald, Sum of squares certiﬁcates for containment of H -polytopes in
V -polytopes. SIAM J. Discrete Math. 30(2), 763–776 (2016)
21. K. Kellner, T. Theobald, C. Trabandt, Containment problems for polytopes and spectrahedra.
SIAM J. Optim. 23(2), 1000–1020 (2013)
22. K. Kellner, T. Theobald, C. Trabandt, A semideﬁnite hierarchy for containment of spectrahedra.
SIAM J. Optim. 25(2), 1013–1033 (2015)
23. I. Klep, M. Schweighofer, An exact duality theory for semideﬁnite programming based on
sums of squares. Math. Oper. Res. 38(3), 569–590 (2013)
24. M. Kojima, Sums of squares relaxations of polynomial semideﬁnite programs. Technical
report, Research Report B-397, Mathematical and Computing Sciences Tokyo Institute of
Technology, Tokyo, 2003
25. J.B. Lasserre, Global optimization with polynomials and the problem of moments. SIAM J.
Optim. 11(3), 796 (2001)
26. M. Laurent, S. Poljak, On a positive semideﬁnite relaxation of the cut polytope. Linear Algebra
Appl. 223, 439–461 (1995)
27. S. Liu, Matrix results on the Khatri-Rao and Tracy-Singh products. Linear Algebra Appl.
289(1–3), 267–277 (1999)
28. P. McMullen, The maximum numbers of faces of a convex polytope. Mathematika 17, 179–184
(1970)
29. J. Nie, X. Zhang, Positive maps and separable matrices. SIAM J. Optim. 26(2), 1236–1256
(2016)
30. G. Pataki, The geometry of semideﬁnite programming, in Handbook of Semideﬁnite Program-
ming (Kluwer Academic Publishers, Boston, MA, 2000), pp. 29–65
31. V. Paulsen, Completely Bounded Maps and Operator Algebras (Cambridge University Press,
Cambridge, 2003)
32. M. Ramana, An exact duality theory for semideﬁnite programming and its complexity
implications. Math. Program. 77(1, Ser. A), 129–162 (1997)
33. M. Ramana, A.J. Goldman, Some geometric results in semideﬁnite programming. J. Global
Optim. 7(1), 33–50 (1995)
34. C. Scheiderer, Semideﬁnitely representable convex sets (2016). Preprint. arXiv:1612.07048
35. A. Schrijver, Theory of Linear and Integer Programming. Wiley-Interscience Series in Discrete
Mathematics (Wiley, Chichester, 1986)
36. J.F. Sturm, Theory and algorithms of semideﬁnite programming, in High Performance
Optimization, ed. by H. Frenk, K. Roos, K. Terlaky, S. Zhang, Applied Optimization, vol. 33
(Kluwer Academic Publishers, Dordrecht, 2000), pp. 1–194
37. T. Theobald, T. de Wolff, Approximating amoebas and coamoebas by sums of squares. Math.
Comp. 84(291), 455–473 (2015)
38. G.M. Ziegler, Lectures on Polytopes. Graduate Texts in Mathematics (Springer, New York,
1995)

Topics on Modular Galois
Representations Modulo Prime Powers
Panagiotis Tsaknias and Gabor Wiese
Abstract This article surveys modularity, level raising and level lowering questions
for two-dimensional representations modulo prime powers of the absolute Galois
group of the rational numbers. It contributes some new results and describes
algorithms and a database of modular forms orbits and higher congruences.
Keywords Modular forms • Galois representations • Modularity higher congru-
ences • Level raising • Level lowering • Database
Subject Classiﬁcations 11F33, 11F80
1
Introduction
The Fontaine-Mazur conjecture relates `-adic ‘geometric’ Galois representations
with objects from geometry. In the 2-dimensional case over Q much progress has
been achieved ([12, Thm.1.2.4(2)] and [16]):
Theorem 1.1 (Emerton, Kisin) Let ` > 2, let E=Q` be a ﬁnite extension and let  W
Gal.Q=Q/ ! GL2.E/ be an irreducible, ﬁnitely ramiﬁed, odd Galois representation
which is de Rham at ` with distinct Hodge-Tate weights. Assume that the residual
representation  satisﬁes certain local conditions.
Then a twist of  is attached to some newform.
In fact, the level and the weight of the newform can be read off from .
The picture for mod ` representations is even more complete: Serre type modular-
ity conjectures relate 2-dimensional Galois representations with F`-coefﬁcients with
modular forms over F`. Serre’s original modularity conjecture has been established
by Khare and Wintenberger [14]:
P. Tsaknias • G. Wiese ()
Université du Luxembourg, Unité de Recherche en Mathématiques, Maison du nombre, 6, avenue
de la Fonte, L-4364 Esch-sur-Alzette, Luxembourg
e-mail: p.tsaknias@gmail.com; gabor.wiese@uni.lu
© Springer International Publishing AG, part of Springer Nature 2017
G. Böckle et al. (eds.), Algorithmic and Experimental Methods
in Algebra, Geometry, and Number Theory,
https://doi.org/10.1007/978-3-319-70566-8_31
741

742
P. Tsaknias and G. Wiese
Theorem 1.2 (Khare, Wintenberger, Kisin) Let  W Gal.Q=Q/ ! GL2.F`/ be an
odd irreducible Galois representation. Then  is attached to (the reduction of) some
newform.
Also in this case, the level and the weight of one of the (inﬁnitely many) newforms
attached to  can be read off from : the level is the prime-to-` Artin conductor,
and there is a formula for the weight given by Serre. In fact, it had been known
for a long time that if  is attached to some newform then it also is to one with a
certain predicted weight and level. Since the predicted weight and level are minimal
(except for two cases in the weight, see [11]), the process of ﬁnding a newform
with predicted invariants is called level lowering or weight lowering. The quest
for attached newforms with non-minimal levels is accordingly called level raising.
These three questions have been completely solved (with a tiny exception when
` D 2 and the minimal weight 1 is concerned).
With the `-adic and the mod ` cases of irreducible odd 2-dimensional represen-
tations of GQ WD Gal.Q=Q/ essentially settled, it is natural to wonder what happens
in between, i.e. modulo prime powers. Quite some research has been done, but the
picture is far from clear. In fact, very basic questions are still open.
1.1
Modularity Modulo Prime Powers
Let us consider a representation (continuous like all representations in this paper)
 W GQ ! GL2.O=m/
with O the valuation ring of a ﬁnite extension of Q` and  its valuation ideal. It
turns out that the modularity of  follows from known results if one supposes that
the residual representation  is absolutely irreducible and odd and satisﬁes certain
technical local conditions. This was surely known to many experts and had been,
for instance, discussed on mathoverﬂow. We make this precise in Sect. 2.
An important point here is that one needs to use the right notion of modularity.
This difﬁculty is not visible when only working `-adically or modulo `. The second
author together with Chen and Kiming introduced in [7] three notions of modularity
modulo prime powers: strong modularity, weak modularity, dc-weak modularity.
These three notions stem from three notions of Hecke eigenforms modulo prime
powers, also called strong, weak, and dc-weak, which we brieﬂy explain now.
Throughout this article, we understand by a Hecke eigenform f with coefﬁcients
in a ring R (they are all normalised and almost all cuspidal without this being said
explicitly) a ring homomorphism f W T ! R, where T is a Hecke algebra (to be
speciﬁed very soon). We often think of f as the q-expansion P
n1 f.Tn/qn 2 RŒŒq.
Let Tk. / be the full Hecke algebra, generated as a ring by all Hecke operators
Tn, acting faithfully on the space of holomorphic cusp forms Sk. / of weight k and
level  .

Topics on Modular Galois Representations Modulo Prime Powers
743
A weak Hecke eigenform of weight k and level  with coefﬁcients in R is a ring
homomorphism f W Tk. / ! R. It is called strong if there exists an order O in a
number ﬁeld together with a ring homomorphism  W O ! R such that f factors
as Tk. / ! O
! R. By embedding the order O into C, the ﬁrst arrow leads
to Tk. / ! C, a holomorphic Hecke eigenform. In simple terms, strong Hecke
eigenforms with coefﬁcients in R are those that are obtained by applying  to the
coefﬁcients of a holomorphic eigenform.
Put Sb. / D Lb
kD1 Sk. / and let Tb. / be the full Hecke algebra acting
faithfully on it. A ring homomorphism f W Tb. / ! R is called a dc-weak
eigenform of level  (and weights  b; in fact, b will not play any role as long
as it is large enough). A dc-weak eigenform can hence have contributions from
many different weights, as is the case for divided congruences, which is what the
abbreviation ‘dc’ stands for. If R is a ﬁnite ﬁeld or F`, all three notions coincide by
the Deligne-Serre lifting lemma (for a presentation in the setup used here, see [7,
Lemma 16]), but they are different in general. An example that strong is stronger
than weak modulo `m for m > 1, even if one allows the weight to change (but not
the level), is given in [15, §2.5].
As rings of coefﬁcients R, we take in this article rings of the form O=m where O
is the valuation ring of a ﬁnite ﬁeld extension of Q`,  is its valuation ideal and m a
positive integer. Many results can be and are phrased in this way. However, a general
difﬁculty exists: we often need to compare two eigenforms, one with coefﬁcients in
O1=m1
1 , the other one with coefﬁcients in O2=m2
2 . One then needs to ﬁnd a ring
containing both. In order for such a ring to exist, it is necessary that mi
i
\ Z` for
i D 1; 2 both yield the same power of `, say `m. This led the second author together
with Taixés i Ventosa [21] to introduce the ring
Z=`mZ D Z`=fx 2 Z` j v.x/ > m  1g;
where v denotes the normalised valuation, i.e. v.`/ D 1. We always consider Z=`mZ
with the discrete topology. We have Z=`Z D F` and for the valuation ring O of
any ﬁnite extension of Q` with absolute ramiﬁcation index e and valuation ideal ,
the quotient O=e.m1/C1 injects into Z=`mZ. This quotient is the smallest one that
extends Z=`mZ. The ring Z=`mZ is a local Z=`mZ-algebra of Krull dimension 0
with residue ﬁeld F` and the ring extension Z=`mZ  Z=`mZ is integral. Any
ﬁnitely generated subring R of Z=`mZ is contained in some ring O=e.m1/C1
as above. These are free as Z=`mZ-modules, but this is not true for all ﬁnite
subrings of Z=`mZ. A Hecke eigenform with coefﬁcients in Z=`mZ shall simply
be called a modulo `m Hecke eigenform. Dc-weak (and hence also weak) Hecke
eigenforms modulo `m have attached Galois representations, under the condition
that the residual representation is absolutely irreducible (see [7, Theorem 3]).

744
P. Tsaknias and G. Wiese
1.2
Weight Lowering and Finiteness
Let us recall now that in a ﬁxed prime-to-` level, there are only ﬁnitely many
modular Galois representations with coefﬁcients in F`, which can all be realised—
up to twist—in weights up to `C1 and that there is an explicit recipe for the minimal
weight.
A natural question is whether there is a recipe for a minimal weight for
strong eigenforms modulo `m, i.e. whether (almost) all the (prime-indexed) Hecke
eigenvalues of a given strong eigenform f modulo `m in weight k and level N (prime
to `) also occur for a strong eigenform g modulo `m in the same level N and a ‘low’
or ‘minimal’ weight that can be calculated from the restriction to a decomposition
group at ` of the Galois representation attached to f (under the assumption of
residual absolute irreducibility).
This question seems to be very difﬁcult. One is then led to consider the question,
for ﬁxed prime-to ` level N, whether the set
f
X
n1
f.Tn/qn 2 Z=`mZŒŒq j f strong eigenform modulo `m of level N; any weight g
is ﬁnite. It can also be seen as the set of reductions modulo `m of all holomorphic
Hecke eigenforms in level N of any weight. The second author together with Kiming
and Rustom conjectures that this is the case ([15, Conjecture 1]). As is shown in
Theorem 2 of loc. cit., a positive answer to a question of Buzzard [5, Question
4.4] would indeed imply this. As an indication towards ﬁniteness or the potential
existence of a weight recipe as alluded to above, [15, Theorem 3], proved with the
help of Frank Calegari, shows that for `  5, there exists a bound B D B.N; `m/
such that the q-expansion of any strong Hecke eigenform modulo `m of level N,
but any weight, already occurs in weight k  B for some weak Hecke eigenform
modulo `m of level N. One should compare this with the level raising and level
lowering results below, which also ‘only’ lead to weak forms.
Some ﬁrst experimentation has led Kiming, Rustom and the second author to
state the formula
B.N; `m/ D 2`m C `2 C 1
for m  2. It is consistent with the available computational data, but should not be
understood as a conjecture at this point.
1.3
Level Raising
Led by classical level raising results, one can hope that similar statements are true
modulo `m. It seems that part of the theory indeed carries over from modulo `

Topics on Modular Galois Representations Modulo Prime Powers
745
to modulo `m eigenforms. In Sect. 3 we prove a level raising result for weight 2
eigenforms on 0.N/. For ` > 2, this result is as general as possible. Only for ` D 2
some rare cases could not be proved.
Let f W T ! Z=`mZ be a weak modulo `m Hecke eigenform with Galois
representation . The main idea is to extend Ribet’s ‘classical’ geometric approach
of level raising to our more general situation. For that we need to realise  on
the Jacobian J of the appropriate modular curve. It is well known that the Hecke
algebra acts faithfully on J. However, we need that T= ker. f/, i.e. the image of the
weak eigenform, also acts faithfully on a subgroup of the Jacobian. The natural
place is J.Q/Œker. f/. It turns out that this faithfulness does not seem to be that
clear. In fact, we currently make use of the ‘multiplicity one’ property for the
residual Galois representation on the Jacobian and, equivalently, the Gorenstein
property of the residual Hecke algebra. Once this faithfulness is established, the
proof proceeds by comparing the new and the old subvarieties in level Np as in
Ribet’s original work [18]. One should expect similar limitations when extending
level raising modulo `m to higher weights, e.g. the weight will likely have to be
less than ` if one wants complete results in order to remain in the multiplicity one
situation, where faithfulness is known and easily obtained from existing results.
1.4
Level Lowering and Other Results
Another natural domain is that of level lowering modulo `m. The principal idea is
that one should always be able to ﬁnd an eigenform giving rise to a given Galois
representation when the level is equal to the Artin conductor of the representation.
An immediate difﬁculty is then, of course, to deﬁne an Artin conductor for Galois
representations modulo `m. It does not seem to be immediately clear how to do this
because not every module over Z=`mZ is free, so that there is no natural analog
for the dimension (of, say, inertia invariants) used in the classical Artin conductor.
Nevertheless, one can at least ask whether one can always ﬁnd a modulo `m
Hecke eigenform of a level which is only divisible by primes ramifying in the
representation. There are, indeed, two such results, one is due to Dummigan,
and the other one due to Camporino and Pacetti. We quote both in Sect. 4.
Dummigan’s result, similar to our level raising theorem, works geometrically on
cohomology, whereas Camporino and Pacetti use the deformation theory of Galois
representations. Both approaches currently seem to lead to some restrictions (a
congruence condition for Dummigan, and unramiﬁed coefﬁcients for Camporino–
Pacetti).
Concerning generalisations along the lines of level lowering results modulo `,
which are based on the use of Shimura curves, the mod `m Galois representation
must ﬁrst be realised in the cohomology (or the Jacobian) of the appropriate Shimura
curve. This is likely going to lead into faithfulness problems analogous to the one
we solved in the level raising result by appealing to the Gorenstein or multiplicity
one condition.

746
P. Tsaknias and G. Wiese
As a further instance of level lowering (though of a slightly different nature),
we mention the following result from [7, Theorem 5]: Any dc-weak eigenform
modulo `m in level N`r already arises from a dc-weak eigenform modulo `m in
level N, under the hypotheses `  5 and that the mod ` reduction has an absolutely
irreducible Galois representation. It is also shown that even if one starts with a strong
eigenform modulo `m, the one in level N will only be dc-weak, in general.
Another natural direction is to extend companionship results from eigenforms
modulo ` to `m. This has been successfully performed by Adibhatla and Manohar-
mayum in [1] for odd ` and ordinary modular forms with coefﬁcients unramiﬁed
at `, under certain conditions. In fact, that work is set in the more general world
of Hilbert modular forms. Another companionship result modulo prime powers has
been achieved by the ﬁrst author together with Adibhatla [2].
1.5
Computations, Algorithm and Database
Next to the theoretical and structural motivation for studying modular forms and
modularity questions modulo prime powers, there is also a strong computational
driving force: realising `-adic modular forms on a computer is only possible up to a
certain precision, i.e. one necessarily realises modular forms modulo `m.
This also naturally leads to the questions studied in this article. For instance,
if one wants to compute modulo which power of ` a modular `-adic Galois
representation  of conductor Np (with p a prime not dividing N) becomes
unramiﬁed at p, one can test whether the system of Hecke eigenvalues modulo `m
also occurs in level N=p for m D 1; 2; : : : until this fails. If it ﬁrst fails at m C 1,
then  modulo `m is known to be unramiﬁed at p. In cases where level lowering
modulo `m is entirely proved, one also gets that  modulo `mC1 does ramify at p. The
authors know of no other way of obtaining such information of an `-adic modular
Galois representation.
The authors have developed several algorithmic tools for handling modular forms
modulo `m and they have set up a database. Section 5 contains a brief exposition
of how to compute decompositions of commutative algebras into local factors in
situations arising from Hecke algebras, and how to perform weak modularity tests
explicitly. Finally, in Sect. 6 we describe features of the database of modular form
orbits and higher congruences that we have developed.
2
Modularity
In this section we prove the following modularity theorem. This theorem has been
known to the experts and is a pretty straight forward application of ‘bigR=bigT’
theorems.

Topics on Modular Galois Representations Modulo Prime Powers
747
Theorem 2.1 Let `  5 be a prime number, let ˙ be a ﬁnite set of primes not
containing ` and let GQ;˙[f1;`g be the Galois group of the maximal extension of Q
unramiﬁed outside ˙ [ f`; 1g. Consider a continuous Galois representation
 W GQ;˙[f1;`g ! GL2.Z=`mZ/
such that the residual representation  satisﬁes:
•
 is odd,
•
jGQ.p/ is absolutely irreducible,
•
jGQ` 6  ˝
1 
0 1

and jGQ` 6  ˝
1 
0 

, for any F`-valued character  of
GQ` and the mod ` cyclotomic character  (where  may or may not be zero).
Let N be the maximal positive integer divisible only by primes in ˙ such that there
is a newform of level N (and some weight) giving rise to .
Then  is dc-weakly modular of level N, i.e.  Š f with f a dc-weak Hecke
eigenform modulo `m of level N.
In the exposition of the theory, we essentially follow Deo’s paper [8]. Let us
assume the notation and the set-up from Theorem 2.1. Let O be the valuation ring
of a ﬁnite extension of Q` with ramiﬁcation index e, valuation ideal  and residue
ﬁeld F such that (possibly after conjugation)  takes values in GL2.O=w/ 	
GL2.Z=`mZ/ with w D e.m  1/ C 1. Let T0
O.1.N// be deﬁned as the projective
limit over b of O ˝ T0
b.1.N// which are deﬁned precisely like Tb.1.N//, but
only take Hecke operators Tn with n coprime to N` into account. Similarly, like
Deo we deﬁne the partially full Hecke algebra Tpf
O.1.N// as the projective limit
of O ˝ Tpf
b.1.N// by using in addition the operators Uq for primes q j N. If
we localise at the system of eigenvalues afforded by , we denote this by  in the
index. Accordingly, denote by R the universal deformation ring of  for the group
GQ;˙[f1;`g in the category of local proﬁnite O-algebras with residue ﬁeld F.
Theorem 2.2 (Böckle, Diamond–Flach–Guo, Gouvêa–Mazur, Kisin) Assume
the set-up of Theorem 2.1. Then R Š T0
O.1.N//.
This is Theorem 5 from [8]. Note that Deo works with pseudo-representations,
but this comes down to the same thing here because we assume  to be irreducible.
In the proof, Deo essentially explains why the results of [9] allow to strengthen the
conclusions of [3]. A similar discussion can also be found in [12, §7.3], where the
theorem is, however, not stated in the form we need here. Alternatively, one can also
invoke [12, Theorem 1.2.3] to an `-adic lift of , provided such a lift exists. Recent
work by Khare and Ramakrishna [13] provides a construction in the ordinary case.
We now apply Theorem 2.2. By assumption,  is a deformation of  with the
right ramiﬁcation set, whence the universality leads to an O-algebra homomorphism
R ! O=w, which we consider as an O-algebra homomorphism
f W T0
O.1.N// ! O=w:
By construction, the Galois representation associated with f is isomorphic to .

748
P. Tsaknias and G. Wiese
In order to ﬁnish the proof of Theorem 2.1, f has to be extended to the full Hecke
algebra in order to make it a genuine Hecke eigenform modulo `m. Next we use that
Tpf
O.1.N// is ﬁnite over T0
O.1.N//. This is proved in [8, Proposition 6]; one
should note that the 1.N/-new assumption is not necessary for this statement (see
the proof of [8, Theorem 3]). This integrality allows us to extend f to an O-algebra
homomorphism
f W Tpf
O.1.N// ! QO=QQw
where O 
QO is the valuation ring of some ﬁnite extension of Q` with valuation
ideal Q and ramiﬁcation index Qe and Qw D Qe.m  1/ C 1. One is able to make this
extension because one only needs to ﬁnd one zero in some ring of the form QO=QQw
for any monic polynomial with coefﬁcients in O=w; that this is possible follows,
for instance, by choosing any monic lift to O. From the natural degeneracy map,
we next get an O-algebra homomorphism f W Tpf
O.1.N`// ! QO=QQw, which after
choice of f.U`/ leads to the O-algebra homomorphism
f W Tpf
O.1.N`//ŒŒU` ! QO=QQw:
According to [8, Proposition 5], one can identify Tpf
O.1.N`//ŒŒU` with a quotient
of the full Hecke algebra TO.1.N`//. We obtain thus an O-algebra homomorphism
f W TO.1.N`// ! QO=QQw:
As its image is ﬁnite, it will factor through O ˝ Tb.1.N`// for a suitable weight
bound b, so that we ﬁnally get a ring homomorphism
f W Tb.1.N`// ! QO=QQw:
This is the dc-weak eigenform that is needed to ﬁnish the proof of Theorem 2.1.
Note that one can still remove ` from the level of the ﬁnal form because of [7,
Theorem 5].
3
Level Raising via Modular Curves
Let p −N be a rational prime. Then one has a natural inclusion map
Sk.0.N// ˚ Sk.0.N// ! Sk.0.Np//;
the image of which is called the p-old subspace. This subspace is stable under the
action of Tk.Np/ WD Tk.0.Np// and so is its orthogonal complement under the
Petersson inner product. This complementary subspace is called the p-new subspace

Topics on Modular Galois Representations Modulo Prime Powers
749
and we denote by Tpnew
k
.Np/ the quotient of Tk.Np/ that acts faithfully on it. We
will call this quotient the p-new quotient of Tk.Np/. There is also the p-old quotient
that is deﬁned in the obvious way.
We can now state the main level raising result of this article.
Theorem 3.1 Let R be a local topological ring with maximal ideal mR. Let  W
GQ ! GL2.R/ be a continuous Galois representation that is modular, associated
with a weak eigenform  W T2.N/ ! R, and such that the residual representation
 W GQ ! GL2.R=m/ is absolutely irreducible. If the characteristic of R=m is 2,
assume the multiplicity one/Gorenstein condition that  is not unramiﬁed at 2 with
scalar Frobenius.
Let p −N be a prime which satisﬁes the level raising condition for  by which we
mean that  is unramiﬁed at p and
Tr..Frobp// D ˙. p C 1/:
Then the image of  is a ﬁnite ring, R=m is a ﬁnite ﬁeld and  is also associated
with a weak eigenform 0 W T2.Np/ ! R which is new at p, i.e. 0 factors through
Tpnew
2
.Np/.
In view of Lemma 3.4, the following corollary is essentially just an equivalent
reformulation. Let O be the ring of integers of a number ﬁeld and  a prime in O
above `.
Corollary 3.2 Let m  1 be an integer and  W GQ ! GL2.O=m/ be a
continuous (for the discrete topology on O=m) Galois representation that is
modular, associated with a weak eigenform  W T2.N/ ! O=m, and such that
the residual representation  W GQ ! GL2.O=/ is absolutely irreducible. If O=
is of characteristic 2, assume the multiplicity one/Gorenstein condition that  is not
unramiﬁed at 2 with scalar Frobenius.
Let p be a prime which satisﬁes the level raising condition for , which means
here that
.`N; p/ D 1 and Tr..Frobp//  ˙. p C 1/ mod m:
Then  is also associated with a weak eigenform 0 W T2.Np/ ! O=m which is
new at p, i.e. 0 factors through the Tpnew
2
.Np/.
We remark that for m D 1 this is Theorem 1 of [18]. Even if  is a strong
eigenform, there is no guarantee that the weak eigenform of level new at p that one
obtains in the end is strong.
Corollary 3.3 Let R be a local topological ring with maximal ideal mR and let
 W GQ ! GL2.R/ be a continuous Galois representation that is modular, has ﬁnite
image and such that the residual representation  W GQ ! GL2.R=m/ is absolutely
irreducible. If the characteristic of R=m is 2, assume the multiplicity one/Gorenstein
condition that  is not unramiﬁed at 2 with scalar Frobenius.

750
P. Tsaknias and G. Wiese
Then there exists a positive set of primes p (coprime to N) such that  is modular
of level Np and new at p.
Proof This is proved as in [18]. The argument is that complex conjugation, as an
involution, has trace 0 and determinant 1. By Chebotarev’s density theorem, there
is a positive density set of primes p such that 1 D det..Frobp// D p and p C 1 D
0 D Tr..Frobp// in R.
ut
3.1
Jacobians of Modular Curves
In what follows we set TN WD T2.0.N// and TNp WD T2.0.Np//. The approach
taken here is adapted from Ribet’s original one, i.e. it is based on the geometry of
modular curves and their Jacobians. In this section we gather the necessary results
from [18] that we need for the proof of the main result. Let N be a positive integer.
Let X0.N/ be the modular curve of level N and J0.N/ WD Pic0.X0.N// its Jacobian.
There is a well deﬁned action of the Hecke operators Tn on X0.N/ and hence, by
functoriality, on J0.N/, too. The dual of J0.N/ carries an action of the Hecke algebra
as well and can be identiﬁed with S2.0.N//. This implies that one has a faithful
action of TN on J0.N/.
Let now p be a prime not dividing N. In the same way one has an action of
Hecke operators on X0.Np/ and its Jacobian J0.Np/ and the latter admits a faithful
action of TNp. The moduli interpretation of X0.N/ and X0.Np/ allows us to deﬁne
the two natural degeneracy maps ı1; ıp W X0.Np/ ! X0.N/ and their pullbacks
ı
1 ; ı
p W J0.N/ ! J0.Np/. The image of the map
˛ W J0.N/  J0.N/ ! J0.Np/;
.x; y/ 7! ı
1 .x/ C ı
p .y/:
is by deﬁnition the p-old subvariety of J0.Np/. We will denote it by A. The map ˛
is almost Hecke-equivariant:
˛ ı Tq D Tq ı ˛ for every prime q ¤ p;
(1)
˛ ı
Tp p
1 0

D Up ı ˛:
(2)
For the ﬁrst equation to make sense one interprets the operator Tq on the left hand
side of Eq. (1) as acting diagonally on J0.N/  J0.N/. We also work under the
notational convention Tq D Uq for primes q j N, but we write Up in level Np.
Consider also the kernel Sh of the map J0.N/ ! J1.N/ induced by X1.N/ ! X0.N/.
If we inject it into J0.N/  J0.N/ via x 7! .x; x/ then its image, which we will
denote by ˙, is the kernel of ˛ (see Proposition 1 in [18]).

Topics on Modular Galois Representations Modulo Prime Powers
751
Let  be the kernel of
1 C p
Tp
Tp
1 C p

2 M22.TN/ acting on J0.N/J0.N/. The
group  is ﬁnite and comes equipped with a perfect Gm-valued skew-symmetric
pairing. Furthermore ˙ is a subgroup of , self orthogonal, and ˙  ˙?  .
One can also see =˙, and therefore its subgroup ˙?=˙, as a subgroup of A.
Let B be the p-new subvariety of J0.Np/. It is a complement of A, i.e. A C B D
J0.Np/ and A \ B is ﬁnite. The Hecke algebra acts faithfully on B through its p-new
quotient and it turns out (see Theorem 2 in [18]) that
A \ B Š ˙?=˙:
(3)
as groups.
Furthermore Sh, and therefore ˙ and its Cartier dual =˙?, are annihilated by
the operators 
r D Tr  .r C 1/ 2 TN for all primes r −Np (see Proposition 2
in [18]). In this context, we recall that a maximal ideal m of the Hecke algebra TN
is called Eisenstein if Tr mod m equals the Frobenius traces of a two-dimensional
reducible Galois representation at almost all primes r. This is in particular the case
if m contains the operator Tr  .r C 1/ for almost all primes r. Consequently, any
maximal ideal in the support of the Hecke modules ˙ and =˙? is Eisenstein.
3.2
Proof of Theorem 3.1
We assume the setting of Theorem 3.1. In particular, we assume that  satisﬁes the
level raising condition at a prime p −N, i.e. there is  2 f˙1g such that .Tp/ D
Tr..Frobp// D . p C 1/. Let N W TN ! R=mR be its reduction modulo mR (which
is associated with , the modulo mR reduction of ), and let I and m be the kernels
of  and N, respectively. It will be enough to ﬁnd a weak eigenform 0 W TNp ! R
(i.e. a ring homomorphism) that agrees with  on Tq for all primes q ¤ p and factors
through Tpnew
Np
(hence, new at p).
Lemma 3.4 The ideal m is the only maximal ideal of TN containing I. Moreover,
TN=I is a ﬁnite subring of R of positive characteristic a prime power `r.
Proof Since TN is a Z-Hecke algebra acting faithfully on S2.N/ we have that TN
injects into Mdd.Z/, where d is the dimension of S2.N/. We can therefore see every
operator in TN as an integral matrix of dimension d. We recall that the eigenvalues
of the operator Tn will correspond to the coefﬁcients an. f/ when f runs through the
normalised eigenforms in S2.N/.
Let g.X/ 2 ZŒX be the characteristic polynomial of Tp. The hypothesis .Tp/ D
. p C 1/ implies that Tp  . p C 1/ 2 I and therefore m WD g.. p C 1// 2 I. Since
p −N, the Ramanujan-Petersson bounds guarantee that none of the eigenvalues of
Tp is equal to . p C1/ and therefore m is non-zero. We thus have that .m/  I. This
makes the quotient T=I ﬁnite.

752
P. Tsaknias and G. Wiese
Since T=I is Artinian, it can be written as a direct product of Artinian local rings
indexed by its ﬁnitely many maximal ideals. Assume it decomposes as a direct
product of s local rings, with s  1. The set containing the identity ei of each
component then forms a complete set (i.e. Ps
iD1 ei D 1) of pairwise orthogonal (i.e.
eiej D 0 for 1  i ¤ j  s) non-trivial (i.e. ei ¤ 0; 1) idempotents for TN=I.
The set fNe1; : : : ; Nesg of their image through the injection of TN=I into R is clearly a
complete set of pairwise orthogonal non-trivial idempotents, too. This implies that
R is isomorphic to Qs
iD1 NeiR. But this cannot happen unless s D 1 since R is local.
Since s D 1 we get that TN=I is local as well. The claims are then immediate.
ut
By the previous lemma, we have inclusions .`r/  I  m with some prime
power `r > 1, giving rise to inclusions
VŒ`r WD J0.N/.Q/Œ`r  VŒI WD J0.N/.Q/ŒI  VŒm WD J0.N/.Q/Œm:
Lemma 3.5 The support of VŒI is the singleton m and is hence non-Eisenstein.
Proof As VŒI  VŒm, the maximal ideal m is in the support of VŒI. Since the
representation  is irreducible we get that m is non-Eisenstein (see for example
Theorem 5.2c in [17]). Finally, Lemma 3.4 implies that Supp.VŒI/ is the single-
ton fmg.
ut
Lemma 3.6 The restriction of ˛ to VŒI is injective and its image ˛.VŒI/ is stable
under the action of TNp. In particular, Up acts on ˛.VŒI/ by multiplication by .
Proof Consider the image of VŒI (still denoted VŒI) under the TN-equivariant
embedding
J0.N/
x7!.x;x/
! J0.N/  J0.N/:
Next recall that the kernel ˙ of J0.N/  J0.N/
˛! A  J0.Np/ is annihilated by
almost all operators Tr  .r C 1/ with r prime. The fact that the support of VŒI is
non-Eisenstein from Lemma 3.5 shows that the intersection of ˙ and VŒI is trivial,
proving the injectivity of ˛jVŒI.
As ˛ commutes with the action of the Hecke operators Tn with n coprime to p (see
Eq. (1)), it follows that ˛.VŒI/ is stable under those operators. Here the level raising
condition enters for proving the stability under Up, as follows by using Eq. (2) for
y 2 VŒI:
Up.y/ D Up.˛.x; x// D ˛.
Tp p
1 0
  x
x

/ D ˛.Tp.x/  px; x/
D ˛.. p C 1/x  px; x/ D ˛.x; x/ D ˛.x; x/ D y:
The ﬁnal claim follows as well.
ut
The following proposition is a non-trivial input.

Topics on Modular Galois Representations Modulo Prime Powers
753
Proposition 3.7 The TN=I-module VŒI is faithful.
Proof Due to the assumptions, Theorem 9.2 of [11] implies that VŒm is of dimen-
sion 2 as TN=m-module. By Nakayama’s Lemma, it follows that the localisation
at m of the `-adic Tate module is free of rank 2 as .TN ˝Z Z`/m-module and that
HomZ`..TN ˝Z Z`/m; Z`/ is free of rank 1 as .TN ˝Z Z`/m-module, precisely as on
p. 333 of [19]. Consequently,
VŒ`rm Š .TN=`rTN/2
m Š HomZ`..TN=`rTN/m; Z=`rZ/2;
which implies by taking the I-kernel with I the ideal such that TN=I Š .TN=`rTN/=I
that
VŒI Š HomZ..TN=`rTN/=I; Z=`rZ/2 D HomZ.TN=I; Z=`rZ/2;
showing that VŒI is faithful as TN=I-module.
ut
The authors do not know if the ‘multiplicity one’ or ‘Gorenstein’ condition is
necessary. In the remaining case, the 2r-torsion group scheme is ordinary, and hence
by arguments as in Corollary 2.3 of [22] admits a nice decomposition as
0 ! .TN=`rTN/m ! VŒ`rm ! HomZ..TN=`rTN/m; Z=`rZ/ ! 0:
However, we do not know if this sequence remains exact after taking the I-kernel.
If this were the case, the additional assumption would be unnecessary.
Lemma 3.8 The action of TNp on ˛.VŒI/ is given by a ring homomorphism 0 W
TNp ! R satisfying 0.Tq/ D .Tq/ for all primes q ¤ p and 0.Up/ D . In
particular,  and 0 give rise to isomorphic Galois representations.
Proof The faithfulness of VŒI as T=I-module from Proposition 3.7 implies that 
factors through a subring S of End.VŒI/, which is also a subring of R. By Lemma 3.6
and Eq. (1), the action of TNp on ˛.VŒI/ is also given by elements of S, leading to a
ring homomorphism 0 W TNp ! S  R.
ut
To ﬁnish the proof of Theorem 3.1, it remains to show that 0 factors through the
p-new quotient of TNp. To this end, it is enough to show that ˛.VŒI/ is a subgroup
of A \ B. We again proceed according to Ribet. By the level raising condition,
VŒI, when considered as a subgroup of J0.N/  J0.N/, is a subgroup of , whence
˛.VŒI/  =˙. As =˙? is Eisenstein but ˛.VŒI/ is not, ˛.VŒI/=˙? D 0. This
implies ˛.VŒI/  ˙?=˙ D A \ B, completing the proof of Theorem 3.1.
4
Level Lowering
In this section we give an overview of results about level lowering modulo prime
powers. We start by the following simple observation: twisting an eigenform f by a

754
P. Tsaknias and G. Wiese
Dirichlet character  such that   1 mod m leads to an eigenform g D f ˝ ,
which is congruent to f modulo m. This idea leads to the following two level
lowering results from the ﬁrst author’s unpublished PhD thesis [20].
Proposition 4.1 (Split Ramiﬁed Case) Let f 2 Sk.1.M// be a newform such that
the restriction to a decomposition group at p ¤ ` of the `-adic Galois representation
attached to f is isomorphic to 1 ˚ 2, where both characters ramify. Let  be a
prime ideal of a number ﬁeld containing the coefﬁcients of f.
If 1 is unramiﬁed modulo m, then there exists a normalised eigenform g 2
Sk.1.M=p// such that f  g mod m.
Proof We can decompose 1 D 1;unr1;ram into an unramiﬁed and a ramiﬁed
character of GQp. As p ¤ `, the order of 1;ram is ﬁnite. By assumption, 1;ram  1
mod m, whence in particular the order of 1;ram is a power of ` because only roots
of unity of `-power order vanish under reduction modulo . Thus 1;ram is tamely
ramiﬁed. By the local and the global Kronecker-Weber theorems, 1;ram can be seen
as a global Dirichlet character Q1;ram of conductor p the restriction of which to GQp
equals 1;ram.
Let now g be the newform corresponding to the twist f ˝ Q1
1;ram. Then the
restriction to a decomposition group at p of the `-adic Galois representation attached
to g is isomorphic to 1;unr ˚ 21
1;ram. If 2 is tame (i.e. of conductor p), then
21
1;ram is either tame or unramiﬁed, and in any case its conductor divides p. If 2 is
wild, i.e. it factors through Gal.Qp.prN/=Qp/ with r  2 and p −N, but not through
Gal.Qp.pr1N/=Qp/, then also 21
1;ram factors through Gal.Qp.prN/=Qp/ but not
through Gal.Qp.pr1N/=Qp/, whence the conductor of 21
1;ram equals that of 2. In
both cases we hence ﬁnd that the conductor of 21
1;ram divides the conductor of 2.
Since the p-valuation of M equals the p-valuation of the conductor of 2 plus 1
(since the conductor of 1 is p) and the p-valuation of the newform level of g is
the p-valuation of the conductor of 21
1;ram, it is clear that the newform level of g
divides M=p.
ut
Proposition 4.2 (Special Ramiﬁed Case) Let f 2 Sk.1.M// be a newform such
that the restriction to a decomposition group at p ¤ ` of the `-adic Galois
representation attached to f is isomorphic to  ˝
! 
0 1

, where  and  ramify
and ! is the `-adic cyclotomic character. Let  be a prime ideal of a number ﬁeld
containing the coefﬁcients of f.
If  is unramiﬁed modulo m, then there exists a newform g 2 Sk.1.M=p// such
that f  g mod m.
Proof The proof is essentially the same as in the split ramiﬁed case. Note, however,
that the tameness of  implies that p2 exactly divides M, whence the newform level
of g will be exactly M=p.
ut
These propositions may be useful in some situations. We also remark that the
only Dirichlet character that is trivial modulo `2 in the sense of being equal to
1 2 Z=`2Z is the trivial one. That is just due to the fact that  WD 1  ` is a
uniformiser of Q`.`/, whence ` 6 1 mod ./2. This implies that the level does

Topics on Modular Galois Representations Modulo Prime Powers
755
not lower modulo `m for any m  2 at primes p satisfying the hypothesis of one of
the preceding propositions. We now quote the main result from [10], including the
discussion in the last paragraph of that article.
Theorem 4.3 (Dummigan) Let ` be a prime. Let ` C 2 > k  2 and let p be
a prime not dividing N 2 N such that p 6 1 mod `. Let f 2 Sk.1.Np// be an
eigenform and let  be a prime of the coefﬁcient ﬁeld of f above `. Suppose that the
residual Galois representation of f modulo  is irreducible.
If for some m  1 the Galois representation of f modulo m is unramiﬁed at p,
then there is a weak eigenform g of weight k and level 1.N/ such that f
mod m
equals g at all coefﬁcients the index of which is coprime to p.
Dummigan also gives an explicit example where the resulting form g cannot be
strong. We include another still unpublished result from [6] on level lowering, which
is proved using the deformation theory of Galois representations.
Theorem 4.4 (Pacetti-Camporino) Let `  7 be a prime. Let 2  k  `  1. Let
M be a positive integer. Let f 2 Sk.1.M// be an eigenform with coefﬁcients in Kf .
Let Of be the ring of integers of Kf . Assume that
•
` is unramiﬁed in Of , and
•
SL2.Of =/ is a subgroup of the image of the mod  representation attached to f.
If p j M is a prime and m  1 is an integer such that the modulo m Galois
representation associated with f is unramiﬁed at p, then there is a weak eigenform g
of weight k and level 1.M=p/ such that f
mod m equals g at all coefﬁcients the
index of which is coprime to p.
This result is proved by ﬁrst applying techniques of Ramakrishna: by introducing
auxiliary primes in order to kill local obstructions, the authors construct an `-adic
lift in which p remains unramiﬁed. They then prove and use a modularity lifting
theorem to obtain that their lift is associated with some newform. Finally, they apply
Theorem 4.3 to remove the auxiliary primes, which had been chosen in such a way
that Dummigan’s theorem applies.
5
Computational Aspects
In this section, we describe various algorithms we have implemented and used in
our computational study of higher congruences.
5.1
Some Commutative Algebra
We start by summarising some well known facts from commutative algebra. Let R
be an Artinian ring, i.e. a ring in which every descending chain of ideals becomes
stationary. In particular, for any ideal a of R, the sequence an becomes stationary,

756
P. Tsaknias and G. Wiese
i.e. an D anC1 for all n “big enough”. We will then use the notation a1 for an. The
following proposition is well known and easy to prove:
Proposition 5.1 Let R be an Artinian ring. Then every prime ideal of R is maximal
and there are only ﬁnitely many maximal ideals in R. Moreover, the maximal ideal m
is the only one containing m1. Furthermore, if m ¤ n are two maximal ideals,
then for any k 2 N [ f1g, the ideals mk and nk are coprime. The Jacobson radical
T
m2Spec.R/ m is equal to the nilradical and consists of the nilpotent elements, and we
have T
m2Spec.R/ m1 D .0/. Moreover, for every maximal ideal m, the ring R=m1
is local with maximal ideal m and is hence isomorphic to Rm, the localisation of R
at m. Finally, by virtue of the Chinese Remainder Theorem we have the following
isomorphism, referred to as local decomposition:
R
a7!.:::;aCm1;::: /
!
Y
m2Spec.R/
R=m1 Š
Y
m2Spec.R/
Rm:
Deﬁnition 5.2 An idempotent of a ring R is an element e that satisﬁes e2 D e. Two
idempotents e, f are orthogonal if ef D 0. An idempotent e is primitive if it cannot
be written as a sum of two idempotents both different from 0. A set of idempotents
fe1; : : : ; eng is said to be complete if 1 D Pn
iD1 ei.
In concrete terms, a complete set of primitive pairwise orthogonal idempotents
is given by .1; 0; : : : ; 0/; .0; 1; 0; : : : ; 0/; : : : ; .0; : : : ; 0; 1/.
Proposition 5.3 (Newton Method/Hensel Lifting—Special Case) Let R be a ring
and I be an ideal. Let f 2 RŒX be a polynomial. We assume that there exist a 2 R
and a polynomial b 2 RŒX such that 1 D af.X/ C b.X/f 0.X/. Let further a0 2 R
be such that f.a0/ 2 Ir for some r  1. For n  1, we make the following recursive
deﬁnition:
an WD an1  f.an1/b.an1/:
Then for all n 2 N, we have f.an/ 2 .Ir/2n. In particular, if T
n1 In D 0 then the
sequence f.an/ converges to 0 exponentially.
Proof This is a straight forward calculation with Taylor expansions of the polyno-
mial.
ut
Corollary 5.4 (Algorithmic Idempotent Lifting) Let R be a commutative Z`-al-
gebra which is ﬁnitely generated as Z`-module. Let e0 2 R=`R be an idempotent.
For n  1, make the following recursive deﬁnition:
en WD en1  .e2
n1  en1/.2en1  1/ D 3e2
n1  2e3
n1:
(4)
Then e2
n  en mod `2nR for all n  0. Moreover, the en form a Cauchy sequence
in R and thus converge to an idempotent e 2 R ‘lifting’ e0, i.e. the image of e in R=`R
is e0.

Topics on Modular Galois Representations Modulo Prime Powers
757
Proof This is a simple application of the Newton method to the polynomial f.X/ D
X2 X. Note that we have f 0.X/ D 2X 1 and 1 D 4.X2 X/C.2X 1/.2X 1/.
ut
The corollary thus tells us that any idempotent of R=`R lifts to an idempotent
of R, and it tells us that the lift can be approximated by a simple recursion formula
that is easy to implement and converges very rapidly. We shall now apply the
preceding considerations to a commutative Z`-algebra T which is free and ﬁnitely
generated as a Z`-module. Let T D T ˝ F` and TQ` D T ˝ Q`. Note that T
and TQ` are Artinian rings because they are ﬁnite dimensional vector spaces. The
following well-known result follows from the above considerations together with
some standard commutative algebra.
Proposition 5.5 The algebra T is equidimensional (in the sense of Krull dimen-
sion) of dimension 1, i.e. any maximal ideal m strictly contains at least one minimal
prime ideal  and there is no prime ideal strictly in between the two. The maximal
ideals of T correspond bijectively under taking pre-images to the maximal ideals
of T; the same letter will be used to denote them. The minimal primes  of T
are in bijection with the prime ideals of TQ` (all of which are maximal) under
extension, for which the notation .e/ will be used. Under the correspondences,
one has Tm Š Tm ˝ F` and T Š TQ`;.e/. By virtue of lifts of idempotents and
Proposition 5.1, we have the local decompositions
T Š
Y
m
Tm; T Š
Y
m
Tm and TQ` Š
Y

TQ`;.e/ Š
Y

T;
where m runs through the maximal ideals of T (and T) and  runs through the
minimal primes of T (or, equivalently, all the prime=maximal ideals of TQ`).
5.2
Package for Computing `-Adic Decompositions
The second author has developed the MAGMA [4] package PADICALGEBRAS (see
[24]) for computing the objects appearing in Proposition 5.5. The package depends
on the second author’s earlier MAGMA package ARTINALGEBRAS (see [23]).
The main ingredients are standard linear algebra, especially over ﬁnite ﬁelds, and
the algorithmic idempotent lifting from Corollary 5.4.
5.3
Application of the Commutative Algebra to Modular Forms
Let S.C/ be a space of modular forms, e.g. Sk.1.N//. We only work with spaces
that have a basis with coefﬁcients in Z. We denote by S.R/ the corresponding space
with coefﬁcients in the ring R. Here the notion S.R/ is the naive one via the standard

758
P. Tsaknias and G. Wiese
q-expansion: S.R/ is the set of R-linear combinations of the image of the Z-basis
in RŒŒq via the standard q-expansion. The space S.R/ can also be characterised
as follows. The Hecke operators Tn for n 2 N acting on S.C/ generate a ring (a
Z-algebra), denoted T, and we have the isomorphism
S.R/ Š HomZ.T; R/:
Concretely, if ' 2 HomZ.T; R/, then P
n1 '.Tn/qn is a cusp form. Thus a Z-basis
of T gives rise to a ‘dual basis’ of S.R/. We also speak of an ‘echelonised basis’.
By Proposition 5.5, we have the decompositions
TQ WD Q ˝Z T Š
Y
Œ f
TŒ f and S.Q/ Š
M
Œ f
SŒ f.Q/;
where the product and the sum run over GQ-orbits of Hecke eigenforms. If the space
S.C/ is a newspace, then SŒf.Q/ is the set of forms with coefﬁcients in Q in the C-
span of all the GQ-conjugates of f. Concretely, SŒ f.Z/ is the Z-dual of the Z-algebra
generated by the Hecke operators Tn in TŒ f. All Hecke operators acting on SŒ f.Z/
are represented as matrices with Z-entries.
We now consider TZ` D Z` ˝Z T. Then we have S.Z`/ D HomZ`.TZ`; Z`/.
Importantly, again by Proposition 5.5, we have the decompositions
TZ` Š
Y
Œ f
TŒ f  and S.Z`/ Š
M
Œ f 
SŒ f .Z`/;
where the sum and the product run over the GF`-orbits of Hecke eigenforms in S.F`/.
These correspond to the maximal ideals of TZ`. We refer to the SŒ f.Z`/ either as Z`-
orbits or as GF`-orbits.
We are also interested in Q`-orbits of eigenforms inside a Z`-orbit. By Proposi-
tion 5.5, Q` ˝Z` S.Z`/ D S.Q`/ breaks as a direct sum
S.Q`/ Š
M
Œ Qf 
SŒ Qf.Q`/;
where the sum runs over the Q`-valued eigenforms up to GQ`-conjugation. The fact
that these GQ`-orbits lie in a single Z`-orbit simply means that they are all congruent
modulo a uniformiser.
5.4
Testing Weak Congruences
The second author has developed the MAGMA package WEAKCONG (see [25]),
which has the purpose to compute whether Hecke eigenforms over Q` belong to

Topics on Modular Galois Representations Modulo Prime Powers
759
given Z`-orbits of Hecke eigenforms modulo powers of ` (or uniformisers). Here
we brieﬂy describe how it functions.
Let n1; : : : ; nr be indices such that Tn1; : : : ; Tnr form a basis of the Hecke
algebra TZ` (which we may assume to be local by using the MAGMA package
PADICALGEBRAS, see above). We speak of basis indices. These indices are
computed via Nakayama’s lemma, i.e. by reducing the matrices to F`.
For any n, we have Tn D Pr
iD1 an;iTni; in particular, anj;i D ıi;j. For each i 2
f1; : : : ; rg, we deﬁne a cusp form fi by specifying its coefﬁcients as follows:
an. fi/ WD an;i:
Then f1; : : : ; fr form an R-basis of HomZ`.TZ`; R/ for any Z`-algebra R. We call this
basis echelonised because it is at the coefﬁcients n1; : : : ; nr. It is the dual basis with
respect to the basis Tn1; : : : ; Tnr of TZ`.
Furthermore, we compute one Q`-eigenform for each Q`-orbit inside the given
Z`-orbit. This is done via standard linear algebra over local ﬁelds, using both the
new MAGMA command LocalField and the older implementation. If we ﬁnd that a
system of linear equations which mathematically must have a solution does not seem
to have any, then we lower the precision until the desired solution exists. Thus, in
this procedure generally some precision is lost.
Let g D P
n1 bnqn 2 S.Q`/ be an eigenform in some level and weight. Let O
be the valuation ring of some ﬁnite extension of Q` that contains all coefﬁcients
bn of g, and let  be a uniformiser of O. The main purpose of this package is to
compute the maximum integer m such that g lies in a given Z`-orbit (some level and
some weight) modulo m.
Put h WD g  Pr
iD1 bni fi. We then have:
h  0 mod m , 9 s1; : : : ; sr 2 O W g 
r
X
iD1
sifi mod m:
This equivalence is clear as the basis is echelonised, whence automatically si  bni
mod m for all i D 1; : : : ; r. The desired highest exponent m can thus be computed
as the minimum of the valuations of the coefﬁcients of h up to the Sturm bound.
6
Database of Modular Form Orbits and Higher
Congruences
The ﬁrst author has created a PostgreSQL database containing data on Q-, Q`-
and Z`-orbits, as well as information on congruences modulo powers of `. We are
currently planning to integrate parts of the database into the LMFDB.1
1http://lmfdb.org.

760
P. Tsaknias and G. Wiese
6.1
Technical Features
In this section we describe the way our database is organised and what kind of data
it contains. This will also highlight two important aspects of our approach:
•
We do our best to avoid computing again data that are used more than once. This
aims to speed up the process of computing the GQ`-orbits. In order to do this we
store a lot of useful information, even intermediate results, e.g. congruences with
forms other than those that provide an optimal weight or level, even congruence
of individual coefﬁcients.
•
We try to parallelise as much of the problem as possible. This also aims at
speeding up the computation of congruences. This becomes especially handy
when the coefﬁcient ﬁelds of the forms that are compared become large.
We will come back to both of these features after the description of the database
tables. We list them together with a brief description of the data each one holds.
1. Modular form spaces over Q: For every level and weight we store some useful
information: The dimension of its Eisenstein subspace, old cuspidal subspace,
new cuspidal subspace as well as the number of new Eisenstein Q-Galois orbits
and the number of newform Q-Galois orbits.
2. Bases of modular form spaces over Q: Here we store the basis in terms of
modular symbols for every space in the previous table. This in Magma readable
format.
3. Eigenforms over Q: For every space over Q, we store an entry for every
Eisenstein and newform Q-Galois orbit uniquely determined by its level, weight
and orbit number.
4. Hecke matrices over Z: For each of the newform orbits in the previous table
we store a list (up to a bound that can be increased as needed) of all the Hecke
matrices acting on the Q-subspace spanned by this orbit.
5. Lattices: For each of the newform orbits in the Q-eigenforms table, we store a
list of base change matrices that ensure the matrices in the table above, after base
change, are with respect to the same basis.
6. `-adic idempotents: Given a newform from the Q-eigenforms list and a prime
number `, we store a list of idempotents which provide the decomposition of the
corresponding `-adic Hecke algebra into local factors (see Proposition 5.5), their
number and the `-adic precision that they were computed in.
7. F`-Galois orbits: For each entry in the table above (i.e. a list of idempotents), we
store an Z-integral basis for each of the components (indexed by the idempotents
in this list) that the parent Q-Galois orbit of newforms breaks into.
8. Q`-Galois orbits of newforms: For each Q-Galois orbit of newforms and the
prime `, we store the Q`-Galois orbit of newforms it decomposes into, along
with the `-adic precision they were computed in.
These are the tables that provide a hierarchical organisation of the objects
involved in the database and we tried to present it in a top to bottom fashion were an

Topics on Modular Galois Representations Modulo Prime Powers
761
entry in one of these table will be associated with many entries in the ones mentioned
after it.
There are some auxiliary tables where all the congruence information is stored.
We store everything down to congruences of individual pairs of coefﬁcients. These
are detailed catalogs of all meaningful congruences when it comes to level or weight
lowering, weak or strong.
It is obvious that the comparison of two eigenvalues at a prime p is independent
from the comparison of the ones at some other prime q. We thus run a multi-threaded
application utilising as many CPU cores as possible where all threads compare a
speciﬁc pair of eigenvalues each simultaneously. Let us stress here that the design
of the database and the multi-threaded application is such that it allows us to utilise
more than one server and/or personal computers to compute even more congruences
simultaneously. Extra care has been taken to avoid overlapping of threads, i.e. two
of those computing the same congruence, but we choose not to elaborate on these
technical matters.
The current size of the database is 488GB. It contains 3906 Q-eigenforms, of
level and weight up to 361 and 298 respectively (not of all possible combinations of
course).
6.2
Accessibility
We have designed a basic web interface2 for the database which currently allows
one to query the database about the following:
1. Given a GQ-orbit Œ f and a prime `, return GQ`-orbits appearing in it.
2. Given a GQ orbit Œ f, a prime ` and a positive integer n, return the GQ`-orbits that
are congruent to the ones corresponding to Œ f and ` modulo `n and are of the
smallest weight possible, i.e. the answer to the strong weight lowering modulo
`n problem for Œ f.
3. Given a GQ-orbit Œ f and a prime `, return a list of downloadable ﬁles (one for
each GQ`-orbit) containing all the `-adic, prime-indexed Hecke polynomials (that
are stored in the database) for each GQ`-orbit.
6.3
Some Remarks on the Algorithms Used
We now describe how we computed the various orbits. Our algorithm is imple-
mented in the MAGMA computer algebra system [4]. Assume as input a given level
N, weight k and prime `.
2http://math.uni.lu/~tsaknias/elladicdatabase_2.php.

762
P. Tsaknias and G. Wiese
1. Compute the newsubspace of the cuspidal subspace of the modular symbols of
level N and weight k. Decompose this subspace into irreducible Hecke modules.
These correspond to GQ-orbits. This is done with standard MAGMA commands.
2. For a given irreducible Hecke module of the previous decomposition, compute
the matrices for all operators Tn acting on it up to a sufﬁcient bound B.
3. Use the package PADICALGEBRAS [24] to factor the completion of the Hecke
algebra at ` into local factors over Z`. Each of these factors corresponds to a GF`-
orbit. Project the matrices representing the Tn’s onto each of these local factors.
4. After tensoring with Q`, each of these GF`-orbits is the sum of all the GQ`-orbits
admitting the same reduction mod `. For each such orbit, take the collection
of projections of the Hecke matrices onto it computed in the previous step and
decompose the corresponding Q`-vector space into simultaneous generalised
eigenspaces by applying each operator successively. The resulting decomposition
is the breaking of the corresponding GF`-orbit into the GQ`-ones that coincide
mod `.
Acknowledgements The authors would like to thank Rajender Adibhatla, Sara Arias-de-Reyna,
Gebhard Böckle, Frank Calegari, Imin Chen, Shaunak Deo, Frazer Jarvis, Ian Kiming, Ariel
Pacetti, Nadim Ruston and many others for various discussions about topics on modular Galois
representations modulo prime powers. They also thank Ken Ribet for having pointed out an
inaccuracy in a previous version. Thanks are also due to the referee for a careful reading and useful
suggestions. The second author thanks Gabi Nebe for having explained the simple algorithmic
idempotent lifting (Eq. (4)) to him a long time ago.
This project was supported by the Luxembourg Research Fund (Fonds National de la Recherche
Luxembourg) INTER/DFG/12/10/COMFGREP in the framework of the priority program 1489 of
the Deutsche Forschungsgemeinschaft.
References
1. R. Adibhatla, J. Manoharmayum, Higher congruence companion forms. Acta Arith. 156(2),
159–175 (2012)
2. R. Adibhatla, P. Tsaknias, A characterisation of ordinary modular eigenforms with CM,
in Arithmetic and Geometry. London Mathematical Society Lecture Note Series, vol. 420
(Cambridge University Press, Cambridge, 2015), pp. 24–35
3. G. Böckle, On the density of modular points in universal deformation spaces. Am. J. Math.
123(5), 985–1007 (2001)
4. W. Bosma, J. Cannon, C. Playoust, The Magma algebra system. I. The user language. J. Symb.
Comput. 24(3–4), 235–265 (1997). Computational algebra and number theory (London, 1993)
5. K. Buzzard, Questions about slopes of modular forms. Astérisque 298, 1–15 (2005). Automor-
phic forms. I
6. M. Camporino, A. Pacetti, Congruences between modular forms modulo prime powers (2013).
arXiv:1312.4925
7. I. Chen, I. Kiming, G. Wiese, On modular Galois representations modulo prime powers. Int. J.
Number Theory 9(1), 91–113 (2013)
8. S.V. Deo, Structure of Hecke algebras of modular forms modulo p. Algebra Number Theory
11(1), 1–38 (2017)

Topics on Modular Galois Representations Modulo Prime Powers
763
9. F. Diamond, M. Flach, L. Guo, The Tamagawa number conjecture of adjoint motives of
modular forms. Ann. Sci. Éc. Norm. Supér. (4) 37(5), 663–727 (2004)
10. N. Dummigan, Level-lowering for higher congruences of modular forms (2015). http://neil-
dummigan.staff.shef.ac.uk/levell8.pdf
11. B. Edixhoven, The weight in Serre’s conjectures on modular forms. Invent. Math. 109(3),
563–594 (1992)
12. M. Emerton, Local-global compatibility in the p-adic Langlands programme for GL2=Q (2011).
http://www.math.uchicago.edu/~emerton/pdfﬁles/lg.pdf
13. C. Khare, R. Ramakrishna, Lifting torsion Galois representations. Forum Math. Sigma 3, e14,
37 (2015)
14. C. Khare, J.P. Wintenberger, Serre’s modularity conjecture. I. Invent. Math. 178(3), 485–504
(2009)
15. I. Kiming, N. Rustom, G. Wiese, On certain ﬁniteness questions in the arithmetic of modular
forms. J. Lond. Math. Soc. 94(2), 479–502 (2016)
16. M. Kisin, The Fontaine-Mazur conjecture for GL2. J. Am. Math. Soc. 22(3), 641–690 (2009)
17. K.A. Ribet, On modular representations of Gal.Q=Q/ arising from modular forms. Invent.
Math. 100(2), 431–476 (1990)
18. K.A. Ribet, Raising the levels of modular representations, in Séminaire de Théorie des
Nombres, Paris 1987–88. Progress in Mathematics, vol. 81 (Birkhäuser Boston, Boston, MA,
1990), pp. 259–271
19. J. Tilouine, Hecke algebras and the Gorenstein property, in Modular Forms and Fermat’s Last
Theorem (Boston, MA, 1995) (Springer, New York, 1997), pp. 327–342
20. P. Tsaknias, On higher congruences of modular Galois representations, Ph.D. thesis, University
of Shefﬁeld, 2009
21. X.T.i. Ventosa, G. Wiese, Computing congruences of modular forms and Galois representations
modulo prime powers, in Arithmetic, Geometry, Cryptography and Coding Theory 2009.
Contemporary Mathematics, vol. 521 (American Mathematical Society, Providence, RI, 2010),
pp. 145–166
22. G. Wiese, Multiplicities of Galois representations of weight one. Algebra Number Theory 1(1),
67–85 (2007). With an appendix by Niko Naumann
23. G. Wiese, Magma package
ArtinAlgebras (2008). http://math.uni.lu/~wiese/programs/
ArtinAlgebras
24. G. Wiese, Magma package pAdicAlgebras (2014). http://math.uni.lu/~wiese/programs/
pAdicAlgebras
25. G. Wiese, Magma package WeakCong (2016). http://math.uni.lu/~wiese/programs/WeakCong

