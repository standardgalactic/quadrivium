
Design of Analog CMOS
Integrated Circuits
Second Edition
Behzad Razavi
Professor of Electrical Engineering
University of California, Los Angeles

DESIGN OF ANALOG CMOS INTEGRATED CIRCUITS, SECOND EDITION
Published by McGraw-Hill Education, 2 Penn Plaza, New York, NY 10121. Copyright c⃝2017 by McGraw-Hill
Education. All rights reserved. Printed in the United States of America. Previous edition c⃝2001. No part of
this publication may be reproduced or distributed in any form or by any means, or stored in a database or
retrieval system, without the prior written consent of McGraw-Hill Education, including, but not limited to, in
any network or other electronic storage or transmission, or broadcast for distance learning
Some ancillaries, including electronic and print components, may not be available to customers outside the
United States.
This book is printed on acid-free paper.
1 2 3 4 5 6 7 8 9 0 QVS/QVS 1 0 9 8 7 6
ISBN 978-0-07-252493-2
MHID 0-07-252493-6
Senior Vice President, Products & Markets: Kurt L. Strand
Vice President, General Manager, Products & Markets: Marty Lange
Vice President, Content Design & Delivery: Kimberly Meriwether David
Managing Director: Thomas Timp
Global Brand Manager: Raghu Srinivasan
Director, Product Development: Rose Koos
Product Developer: Vincent Bradshaw
Marketing Manager: Nick McFadden
Director of Digital Content: Chelsea Haupt, Ph. D
Director, Content Design & Delivery: Linda Avenarius
Program Manager: Faye M. Herrig
Content Project Managers: Heather Ervolino; Sandra Schnee
Buyer: Jennifer Pickel
Content Licensing Specialists: Lorraine Buczek (Text)
Compositor: MPS Limited
Printer: Quad/Graphics
All credits appearing on page or at the end of the book are considered to be an extension of the copyright page.
Library of Congress Cataloging-in-Publication Data
Razavi, Behzad.
Design of analog CMOS integrated circuits / Behzad Razavi, professor of electrical engineering,
University of California, Los Angeles. – Second edition.
pages cm
Includes bibliographical references and index.
ISBN 978-0-07-252493-2 (alk. paper) – ISBN 0-07-252493-6 (alk. paper) 1.
Analog CMOS integrated circuits. 2. Linear integrated circuits–Design and
construction. 3. Metal oxide semiconductors, Complementary. I. Title.
TK7874.654.R39 2017
621.3815–dc23
2015035303
The Internet addresses listed in the text were accurate at the time of publication. The inclusion of a website does
not indicate an endorsement by the authors or McGraw-Hill Education, and McGraw-Hill Education does not
guarantee the accuracy of the information presented at these sites.
mheducation.com/highered

To the memory of my parents

Preface to the Second Edition
When I submitted proposals to publishers for the ﬁrst edition of this book, they posed two questions to
me: (1) What is the future demand for analog books in a digital world? and (2) Is it wise to publish a book
dealing solely with CMOS? The words “analog” and “CMOS” in the book’s title were both in question.
Fortunately, the book resonated with students, instructors, and engineers. It has been adopted by
hundreds of universities around the world, translated to ﬁve languages, and cited 6,500 times.
While many fundamentals of analog design have not changed since the ﬁrst edition was introduced,
several factors have called for a second: migration of CMOS technologies to ﬁner geometries and lower
supply voltages, new approaches to analysis and design, and the need for more detailed treatments of
some topics. This edition provides:
• Greater emphasis on modern CMOS technology, culminating in a new chapter, Chapter 11, on
design methodologies and step-by-step op amp design in nanometer processes
• Extensive study of feedback through the approaches by Bode and Middlebrook
• A new section on the analysis of stability using Nyquist’s approach—as the oft-used Bode method
falls short in some common systems
• Study of FinFETs
• Sidebars highlighting important points in nanometer design
• A new section on biasing techniques
• Study of low-voltage bandgap circuits
• More than 100 new examples
Some instructors ask why we begin with square-law devices. This is for two reasons: (1) such a path
serves as an intuitive entry point and provides considerable value in the analysis of ampliﬁers in terms of
allowable voltage swings, and (2) despite their very short channel lengths, FinFETs—the devices used
in 16-nm nodes and below—exhibit nearly square-law characteristics.
This book is accompanied with a solutions manual and a new set of PowerPoint slides, available at
www.mhhe.com/razavi.
Behzad Razavi
July 2015
iv

Preface to the Second Edition
v
Preface to the First Edition
In the past two decades, CMOS technology has rapidly embraced the ﬁeld of analog integrated circuits,
providing low-cost, high-performance solutions and rising to dominate the market. While silicon bipolar
and III-V devices still ﬁnd niche applications, only CMOS processes have emerged as a viable choice for
the integration of today’s complex mixed-signal systems. With channel lengths projected to scale down
to 0.05 μm, CMOS technology will continue to serve circuit design for another two decades.
Analog circuit design itself has evolved with the technology as well. High-voltage, high-power analog
circuits containing a few tens of transistors and processing small, continuous-time signals have gradually
been replaced by low-voltage, low-power systems comprising thousands of devices and processing large,
mostly discrete-time signals. For example, many analog techniques used only ten years ago have been
abandoned because they do not lend themselves to low-voltage operation.
This book deals with the analysis and design of analog CMOS integrated circuits, emphasizing fun-
damentals as well as new paradigms that students and practicing engineers need to master in today’s
industry. Since analog design requires both intuition and rigor, each concept is ﬁrst introduced from an
intuitive perspective and subsequently treated by careful analysis. The objective is to develop both a solid
foundation and methods of analyzing circuits by inspection so that the reader learns what approximations
can be made in which circuits and how much error to expect in each approximation. This approach also
enables the reader to apply the concepts to bipolar circuits with little additional effort.
I have taught most of the material in this book both at UCLA and in industry, polishing the order, the
format, and the content with every offering. As the reader will see throughout the book, I follow four
“golden rules” in writing (and teaching): (1) I explain why the reader needs to know the concept that is
to be studied; (2) I put myself in the reader’s position and predict the questions that he/she may have
while reading the material for the ﬁrst time; (3) With Rule 2 in mind, I pretend to know only as much
as the (ﬁrst-time) reader and try to “grow” with him/her, thereby experiencing the same thought process;
(4) I begin with the “core” concept in a simple (even imprecise) language and gradually add necessary
modiﬁcations to arrive at the ﬁnal (precise) idea. The last rule is particularly important in teaching circuits
because it allows the reader to observe the evolution of a topology and hence learn both analysis and
synthesis.
The text comprises 16 chapters whose contents and order are carefully chosen to provide a natural
ﬂow for both self-study and classroom adoption in quarter or semester systems. Unlike some other books
on analog design, we cover only a bare minimum of MOS device physics at the beginning, leaving more
advanced properties and fabrication details for later chapters. To an expert, the elementary device physics
treatment my appear oversimpliﬁed, but my experience suggests that (a) ﬁrst-time readers simply do
not absorb the high-order device effects and fabrication technology before they study circuits because
they do not see the relevance; (b) if properly presented, even the simple treatment proves adequate for a
substantial coverage of basic circuits; (c) readers learn advanced device phenomena and processing steps
much more readily after they have been exposed to a signiﬁcant amount of circuit analysis and design.
Chapter 1 provides the reader with motivation for learning the material in this book. Chapter 2 describes
basic physics and operation of MOS devices.
Chapters 3 through 5 deal with single-stage and differential ampliﬁers and current mirrors, respectively,
developing efﬁcient analytical tools for quantifying the behavior of basic circuits by inspection.
Chapters 6 and 7 introduce two imperfections of circuits, namely, frequency response and noise. Noise
is treated at an early stage so that it “sinks in” as the reader accounts for its effects in subsequent circuit
developments.
Chapters 8 through 10 describe feedback, operational ampliﬁers, and stability in feedback sys-
tems, respectively. With the useful properties of feedback analyzed, the reader is motivated to design
high-performance, stable op amps and understand the trade-offs between speed, precision, and power
dissipation.

vi
Preface to the Second Edition
Chapters 11 through 13 deal with more advanced topics: bandgap references, elementary switched-
capacitor circuits, and the effect of nonlinearity and mismatch. These three subjects are included here
because they prove essential in most analog and mixed-signal systems today.
Chapter 14 is concerned with high-order MOS device effects and models, emphasizing the circuit
design implications. If preferred, the chapter can directly follow Chapter 2 as well. Chapter 15 describes
CMOS fabrication technology with a brief overview of layout design rules.
Chapter16presentsthelayoutandpackagingofanalogandmixed-signalcircuits.Manypracticalissues
that directly impact the performance of the circuit are described and various techniques are introduced.
The reader is assumed to have a basic knowledge of electronic circuits and devices, e.g., pn junctions,
the concept of small-signal operation, equivalent circuits, and simple biasing. For a senior-level elective
course, Chapters 1 through 8 can be covered in a quarter and Chapters 1 through 10 in a semester. For a
ﬁrst-year graduate course, Chapters 1 through 11 plus one of Chapters 12, 13, or 14 can be taught in one
quarter, and almost the entire book in one semester.
The problem sets at the end of each chapter are designed to extend the reader’s understanding of the
material and complement it with additional practical considerations. A solutions manual will be available
for instructors.
Behzad Razavi
July 2000
Acknowledgments for the Second Edition
The second edition was enthusiastically and meticulously reviewed by a large number of individuals in
academia and industry. It is my pleasure to acknowldege their contributions:
Saheed Adeolu Tijani (University of Pavia)
Firooz Aﬂatouni (University of Pennsylvania)
Pietro Andreani (Lund University)
Emily Allstot (University of Washington)
Tejasvi Anand (University of Illinois, Urbana-Champaign)
Afshin Babveyh (Stanford)
Nima Baniasadi (UC Berkeley)
Sun Yong Cho (Seoul National University)
Min Sung Chu (Seoul National University)
Yi-Ying Cheng (UCLA)
Jeny Chu (UCLA)
Milad Darvishi (Qualcomm)
Luis Fei (Intel)
Andrea Ghilioni (University of Pavia)
Chengkai Gu (UCLA)
Payam Heydari (UC Irvine)
Cheng-En Hsieh (National Taiwan University)
Po-Chiun Huang (National Tsing-Hua University)
Deog-Kyoon Jeong (Seoul National University)
Nader Kalantari (Broadcom)

Preface to the Second Edition
vii
Alireza Karimi (UC Irvine)
Ehsan Kargaran (University of Pavia)
Sotirios Limotyrakis (Qualcomm Atheros)
Xiaodong Liu (Lund University)
Nima Maghari (University of Florida)
Shahriar Mirabbasi (University of British Columbia)
Hossein Mohammadnezhad (UC Irvine)
Amir Nikpaik (University of British Columbia)
Aria Samiei (University of Southern California)
Kia Salimi (IMEC)
Alireza Sharif-Bakhtiar (University of Toronto)
Guanghua Shu (University of Illinois, Urbana-Champaign)
David Su (Qualcomm Atheros)
Siyu Tan (Lund University)
Jeffrey Wang (University of Toronto)
Tzu-Chao Yan (National Chiao-Tung University)
Ehzan Zhian Tabasy (University of Texas A&M)
In addition, my colleague Jason Woo explained to me many subtleties of nanometer devices and their
physics. I wish to thank all.
The production of the book has been in the hands of Heather Ervolino and Vincent Bradshaw of
McGraw-Hill, who tirelessly attended to every detail over a six-month period. I would like to thank both.
Finally, I wish to thank my wife, Angelina, for her continual help with typing and organizing the
chapters.
Acknowledgments for the First Edition
Writing a book begins with a great deal of excitement. However, after two years of relentless writing,
drawing, and revising, when the book exceeds 700 pages and it is almost impossible to make the equations
and subscripts and superscripts in the last chapter consisent with those in the ﬁrst, the author begins to
feel streaks of insanity, realizing that the book will never ﬁnish without the support of many other
people.
This book has beneﬁted from the contributions of many individuals. A number of UCLA students read
the ﬁrst draft and the preview edition sentence by sentence. In particular, Alireza Zolfaghari, Ellie Cijvat,
and Hamid Rafati meticulously read the book and found several hundred errors (some quite subtle).
Also, Emad Hegazi, Dawei Guo, Alireza Razzaghi, Jafar Savoj, and Jing Tian made helpful suggestions
regarding many chapters. I thank all.
Many experts in academia and industry read various parts of the book and provided useful feedback.
Among them are Brian Brandt (National Semiconductor), Matt Corey (National Semiconductor), Terri
Fiez (Oregon State University), Ian Galton (UC San Diego), Ali Hajimiri (Caltech), Stacy Ho (Analog
Devices), Yin Hu (Texas Instruments), Shen-Iuan Liu (National Taiwan University), Joe Lutsky (National
Semiconductor), Amit Mehrotra (University of Illinois, Urbana-Champaign), David Robertson (Analog
Devices), David Su (T-Span), Tao Sun (National Semiconductor), Robert Taft (National Semiconductor),
and Masoud Zargari (T-Span). Jason Woo (UCLA) patiently endured and answered my questions about
device physics. I thank all.

viii
Preface to the Second Edition
Ramesh Harjani (University of Minnesota), John Nyenhius (Purdue University), Norman Tien (Cornell
University), and Mahmoud Wagdy (California State University, Long Beach) reviewed the book proposal
and made valuable sugegstions. I thank all.
My wife, Angelina, has made many contributions to this book, from typing chapters to ﬁnding nu-
merous errors and raising questions that made me reexamine my own understanding. I am very grateful
to her.
The timely production of the book was made possible by the hard work of the staff at McGraw-Hill,
particularly Catherine Fields, Michelle Flomenhoft, Heather Burbridge, Denise Santor-Mitzit, and Jim
Labeots. I thank all.
I learned analog design from two masters: Mehrdad Sharif-Bakhtiar (Sharif University of Technology)
and Bruce Wooley (Stanford University), and it is only appropriate that I express my gratitude to them
here. What I inherited from them will be inherited by many generations of students.

About the Author
Behzad Razavi received the BSEE degree from Sharif University of Technology in 1985 and the MSEE
and PhDEE degrees from Stanford University in 1988 and 1992, respectively. He was with AT&T Bell
Laboratories and Hewlett-Packard Laboratories until 1996. Since 1996, he has been Associate Professor
and subsequently Professor of Electrical Engineering at University of California, Los Angeles. His current
research includes wireless transceivers, frequency synthesizers, phase-locking and clock recovery for
high-speed data communications, and data converters.
Professor Razavi was an Adjunct Professor at Princeton University from 1992 to 1994, and at Stanford
University in 1995. He served on the Technical Program Committees of the International Solid-State
Circuits Conference (ISSCC) from 1993 to 2002 and VLSI Circuits Symposium from 1998 to 2002. He
has also served as Guest Editor and Associate Editor of the IEEE Journal of Solid-State Circuits, IEEE
Transactions on Circuits and Systems, and International Journal of High Speed Electronics.
Professor Razavi received the Beatrice Winner Award for Editorial Excellence at the 1994 ISSCC,
the best paper award at the 1994 European Solid-State Circuits Conference, the best panel award at the
1995 and 1997 ISSCC, the TRW Innovative Teaching Award in 1997, the best paper award at the IEEE
Custom Integrated Circuits Conference in 1998, and the McGraw-Hill First Edition of the Year Award in
2001. He was the corecipient of both the Jack Kilby Outstanding Student Paper Award and the Beatrice
Winner Award for Editorial Excellence at the 2001 ISSCC. He received the Lockheed Martin Excellence
in Teaching Award in 2006, the UCLA Faculty Senate Teaching Award in 2007, and the CICC Best
Invited Paper Award in 2009 and in 2012. He was the corecipient of the 2012 VLSI Circuits Symposium
Best Student Paper Award and the 2013 CICC Best Paper Award. He was also recognized as one of the top
10 authors in the 50-year history of ISSCC. He received the 2012 Donald Pederson Award in Solid-State
Circuits and the American Society for Engineering Education PSW Teaching Award in 2014.
Professor Razavi has served as an IEEE Distinguished Lecturer and is a Fellow of IEEE. He is the
author of Principles of Data Conversion System Design, RF Microelectronics, Design of Analog CMOS
Integrated Circuits, Design of Integrated Circuits for Optical Communications, and Fundamentals of
Microelectronics, and the editor of Monolithic Phase-Locked Loops and Clock Recovery Circuits and
Phase-Locking in High-Performance Systems.
ix

Brief Contents
1
Introduction to Analog Design . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
1
2
Basic MOS Device Physics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
7
3
Single-Stage Ampliﬁers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
45
4
Differential Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100
5
Current Mirrors and Biasing Techniques. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 134
6
Frequency Response of Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173
7
Noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 219
8
Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 274
9
Operational Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 344
10 Stability and Frequency Compensation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 410
11 Nanometer Design Studies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 459
12 Bandgap References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 509
13 Introduction to Switched-Capacitor Circuits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 539
14 Nonlinearity and Mismatch. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 576
15 Oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 607
16 Phase-Locked Loops . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 651
17 Short-Channel Effects and Device Models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 691
18 CMOS Processing Technology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 712
19 Layout and Packaging. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 733
Index . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 774
x

Contents
Preface to the Second Edition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
iv
About the Author . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
ix
1
Introduction to Analog Design . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
1
1.1 Why Analog? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
1
1.1.1 Sensing and Processing Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
1
1.1.2 When Digital Signals Become Analog . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2
1.1.3 Analog Design Is in Great Demand . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3
1.1.4 Analog Design Challenges. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
4
1.2 Why Integrated? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
4
1.3 Why CMOS?. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
5
1.4 Why This Book? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
5
1.5 Levels of Abstraction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
5
2
Basic MOS Device Physics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
7
2.1 General Considerations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
7
2.1.1 MOSFET as a Switch . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
7
2.1.2 MOSFET Structure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
8
2.1.3 MOS Symbols. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
9
2.2 MOS I/V Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
10
2.2.1 Threshold Voltage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
10
2.2.2 Derivation of I/V Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
12
2.2.3 MOS Transconductance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
19
2.3 Second-Order Effects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
20
2.4 MOS Device Models. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
26
2.4.1 MOS Device Layout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
26
2.4.2 MOS Device Capacitances. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
27
2.4.3 MOS Small-Signal Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
31
2.4.4 MOS SPICE models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
34
2.4.5 NMOS Versus PMOS Devices . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
35
2.4.6 Long-Channel Versus Short-Channel Devices. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
35
2.5 Appendix A: FinFETs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
36
2.6 Appendix B: Behavior of a MOS Device as a Capacitor. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
37
xi

xii
Contents
3
Single-Stage Ampliﬁers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
45
3.1 Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
45
3.2 General Considerations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
45
3.3 Common-Source Stage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
47
3.3.1 Common-Source Stage with Resistive Load . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
47
3.3.2 CS Stage with Diode-Connected Load . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
52
3.3.3 CS Stage with Current-Source Load . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
58
3.3.4 CS Stage with Active Load . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
59
3.3.5 CS Stage with Triode Load . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
60
3.3.6 CS Stage with Source Degeneration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
61
3.4 Source Follower . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
68
3.5 Common-Gate Stage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
75
3.6 Cascode Stage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
82
3.6.1 Folded Cascode. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
90
3.7 Choice of Device Models. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
92
4
Differential Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100
4.1 Single-Ended and Differential Operation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100
4.2 Basic Differential Pair. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 103
4.2.1 Qualitative Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104
4.2.2 Quantitative Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106
4.2.3 Degenerated Differential Pair . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116
4.3 Common-Mode Response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118
4.4 Differential Pair with MOS Loads . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123
4.5 Gilbert Cell . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 126
5
Current Mirrors and Biasing Techniques. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 134
5.1 Basic Current Mirrors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 134
5.2 Cascode Current Mirrors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 139
5.3 Active Current Mirrors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 146
5.3.1 Large-Signal Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 149
5.3.2 Small-Signal Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 152
5.3.3 Common-Mode Properties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 156
5.3.4 Other Properties of Five-Transistor OTA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 159
5.4 Biasing Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 160
5.4.1 CS Biasing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 161
5.4.2 CG Biasing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 164
5.4.3 Source Follower Biasing. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 165
5.4.4 Differential Pair Biasing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 166
6
Frequency Response of Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173
6.1 General Considerations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173
6.1.1 Miller Effect . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 174
6.1.2 Association of Poles with Nodes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 179
6.2 Common-Source Stage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 180
6.3 Source Followers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 188

Contents
xiii
6.4 Common-Gate Stage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 193
6.5 Cascode Stage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 196
6.6 Differential Pair . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 198
6.6.1 Differential Pair with Passive Loads . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 198
6.6.2 Differential Pair with Active Load . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 201
6.7 Gain-Bandwidth Trade-Offs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 203
6.7.1 One-Pole Circuits. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 204
6.7.2 Multi-Pole Circuits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
205
6.8 Appendix A: Extra Element Theorem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 206
6.9 Appendix B: Zero-Value Time Constant Method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 208
6.10 Appendix C: Dual of Miller’s Theorem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 212
7
Noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 219
7.1 Statistical Characteristics of Noise. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 219
7.1.1 Noise Spectrum . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
221
7.1.2 Amplitude Distribution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 224
7.1.3 Correlated and Uncorrelated Sources . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 225
7.1.4 Signal-to-Noise Ratio . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 226
7.1.5 Noise Analysis Procedure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
227
7.2 Types of Noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 228
7.2.1 Thermal Noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
228
7.2.2 Flicker Noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 234
7.3 Representation of Noise in Circuits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 236
7.4 Noise in Single-Stage Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 243
7.4.1 Common-Source Stage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 244
7.4.2 Common-Gate Stage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 249
7.4.3 Source Followers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 253
7.4.4 Cascode Stage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 254
7.5 Noise in Current Mirrors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 254
7.6 Noise in Differential Pairs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 256
7.7 Noise-Power Trade-Off. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 263
7.8 Noise Bandwidth . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 264
7.9 Problem of Input Noise Integration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 265
7.10 Appendix A: Problem of Noise Correlation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 265
8
Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 274
8.1 General Considerations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 274
8.1.1 Properties of Feedback Circuits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 275
8.1.2 Types of Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 282
8.1.3 Sense and Return Mechanisms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 284
8.2 Feedback Topologies. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 286
8.2.1 Voltage-Voltage Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 286
8.2.2 Current-Voltage Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 291
8.2.3 Voltage-Current Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 294
8.2.4 Current-Current Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 297
8.3 Effect of Feedback on Noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 298

xiv
Contents
8.4 Feedback Analysis Difﬁculties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 299
8.5 Effect of Loading . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 303
8.5.1 Two-Port Network Models. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 303
8.5.2 Loading in Voltage-Voltage Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 304
8.5.3 Loading in Current-Voltage Feedback. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 308
8.5.4 Loading in Voltage-Current Feedback. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 310
8.5.5 Loading in Current-Current Feedback. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 313
8.5.6 Summary of Loading Effects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 315
8.6 Bode’s Analysis of Feedback Circuits. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 315
8.6.1 Observations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 315
8.6.2 Interpretation of Coefﬁcients. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 317
8.6.3 Bode’s Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 320
8.6.4 Blackman’s Impedance Theorem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 325
8.7 Middlebrook’s Method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 331
8.8 Loop Gain Calculation Issues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 332
8.8.1 Preliminary Concepts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 332
8.8.2 Difﬁculties with Return Ratio . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 334
8.9 Alternative Interpretations of Bode’s Method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 336
9
Operational Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 344
9.1 General Considerations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 344
9.1.1 Performance Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 344
9.2 One-Stage Op Amps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 349
9.2.1 Basic Topologies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 349
9.2.2 Design Procedure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 353
9.2.3 Linear Scaling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 354
9.2.4 Folded-Cascode Op Amps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 355
9.2.5 Folded-Cascode Properties. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 358
9.2.6 Design Procedure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 359
9.3 Two-Stage Op Amps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 361
9.3.1 Design Procedure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 363
9.4 Gain Boosting . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 364
9.4.1 Basic Idea. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 364
9.4.2 Circuit Implementation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 368
9.4.3 Frequency Response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 371
9.5 Comparison . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 373
9.6 Output Swing Calculations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 373
9.7 Common-Mode Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 374
9.7.1 Basic Concepts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 374
9.7.2 CM Sensing Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 377
9.7.3 CM Feedback Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 380
9.7.4 CMFB in Two-Stage Op Amps. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 386
9.8 Input Range Limitations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 388
9.9 Slew Rate . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 390

Contents
xv
9.10 High-Slew-Rate Op Amps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 397
9.10.1 One-Stage Op Amps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 397
9.10.2 Two-Stage Op Amps. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 399
9.11 Power Supply Rejection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 400
9.12 Noise in Op Amps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 402
10 Stability and Frequency Compensation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 410
10.1 General Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
410
10.2 Multipole Systems. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 414
10.3 Phase Margin . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 416
10.4 Basic Frequency Compensation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 420
10.5 Compensation of Two-Stage Op Amps. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 426
10.6 Slewing in Two-Stage Op Amps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 433
10.7 Other Compensation Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 436
10.8 Nyquist’s Stability Criterion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 439
10.8.1 Motivation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 439
10.8.2 Basic Concepts. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 440
10.8.3 Construction of Polar Plots . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 442
10.8.4 Cauchy’s Principle. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 447
10.8.5 Nyquist’s Method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
447
10.8.6 Systems with Poles at Origin . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 450
10.8.7 Systems with Multiple 180◦Crossings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 454
11 Nanometer Design Studies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 459
11.1 Transistor Design Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
459
11.2 Deep-Submicron Effects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 460
11.3 Transconductance Scaling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 463
11.4 Transistor Design. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 466
11.4.1 Design for Given ID and VDS,min . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 466
11.4.2 Design for Given gm and ID . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 469
11.4.3 Design for Given gm and VDS,min . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 470
11.4.4 Design for a Given gm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 471
11.4.5 Choice of Channel Length. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 472
11.5 Op Amp Design Examples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 472
11.5.1 Telescopic Op Amp. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 473
11.5.2 Two-Stage Op Amp. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 487
11.6 High-Speed Ampliﬁer. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 495
11.6.1 General Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 496
11.6.2 Op Amp Design . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 500
11.6.3 Closed-Loop Small-Signal Performance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 501
11.6.4 Op Amp Scaling. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 502
11.6.5 Large-Signal Behavior . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 505
11.7 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 507

xvi
Contents
12 Bandgap References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 509
12.1 General Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
509
12.2 Supply-Independent Biasing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 509
12.3 Temperature-Independent References. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 513
12.3.1 Negative-TC Voltage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 513
12.3.2 Positive-TC Voltage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 514
12.3.3 Bandgap Reference . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 515
12.4 PTAT Current Generation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
523
12.5 Constant-Gm Biasing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 524
12.6 Speed and Noise Issues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
525
12.7 Low-Voltage Bandgap References . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 529
12.8 Case Study. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 533
13 Introduction to Switched-Capacitor Circuits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 539
13.1 General Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
539
13.2 Sampling Switches . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 543
13.2.1 MOSFETS as Switches . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 543
13.2.2 Speed Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 547
13.2.3 Precision Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 549
13.2.4 Charge Injection Cancellation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 553
13.3 Switched-Capacitor Ampliﬁers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
555
13.3.1 Unity-Gain Sampler/Buffer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 555
13.3.2 Noninverting Ampliﬁer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 562
13.3.3 Precision Multiply-by-Two Circuit . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 567
13.4 Switched-Capacitor Integrator . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 568
13.5 Switched-Capacitor Common-Mode Feedback . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 571
14 Nonlinearity and Mismatch. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 576
14.1 Nonlinearity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 576
14.1.1 General Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 576
14.1.2 Nonlinearity of Differential Circuits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 579
14.1.3 Effect of Negative Feedback on Nonlinearity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 581
14.1.4 Capacitor Nonlinearity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 583
14.1.5 Nonlinearity in Sampling Circuits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 584
14.1.6 Linearization Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 585
14.2 Mismatch . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 591
14.2.1 Effect of Mismatch . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 593
14.2.2 Offset Cancellation Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 598
14.2.3 Reduction of Noise by Offset Cancellation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 602
14.2.4 Alternative Deﬁnition of CMRR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 603
15 Oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 607
15.1 General Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
607
15.2 Ring Oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 609
15.3 LC Oscillators. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 618

Contents
xvii
15.3.1 Basic Concepts. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 618
15.3.2 Cross-Coupled Oscillator. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 621
15.3.3 Colpitts Oscillator . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 624
15.3.4 One-Port Oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 626
15.4 Voltage-Controlled Oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 630
15.4.1 Tuning in Ring Oscillators. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 633
15.4.2 Tuning in LC Oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 641
15.5 Mathematical Model of VCOs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 644
16 Phase-Locked Loops . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 651
16.1 Simple PLL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 651
16.1.1 Phase Detector . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 651
16.1.2 Basic PLL Topology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 653
16.1.3 Dynamics of Simple PLL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
660
16.2 Charge-Pump PLLs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 666
16.2.1 Problem of Lock Acquisition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 666
16.2.2 Phase/Frequency Detector . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 667
16.2.3 Charge Pump . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 669
16.2.4 Basic Charge-Pump PLL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 671
16.3 Nonideal Effects in PLLs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 677
16.3.1 PFD/CP Nonidealities. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 677
16.3.2 Jitter in PLLs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 681
16.4 Delay-Locked Loops. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 683
16.5 Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 685
16.5.1 Frequency Multiplication and Synthesis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 685
16.5.2 Skew Reduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 687
16.5.3 Jitter Reduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 688
17 Short-Channel Effects and Device Models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 691
17.1 Scaling Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 691
17.2 Short-Channel Effects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 695
17.2.1 Threshold Voltage Variation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 695
17.2.2 Mobility Degradation with Vertical Field. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 697
17.2.3 Velocity Saturation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 698
17.2.4 Hot Carrier Effects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 700
17.2.5 Output Impedance Variation with Drain-Source Voltage . . . . . . . . . . . . . . . . . . . . . . 700
17.3 MOS Device Models. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 701
17.3.1 Level 1 Model. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 702
17.3.2 Level 2 Model. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 702
17.3.3 Level 3 Model. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 704
17.3.4 BSIM Series . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 706
17.3.5 Other Models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 707
17.3.6 Charge and Capacitance Modeling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 707
17.3.7 Temperature Dependence. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 708
17.4 Process Corners . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 708

xviii
Contents
18 CMOS Processing Technology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 712
18.1 General Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
712
18.2 Wafer Processing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 713
18.3 Photolithography . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 714
18.4 Oxidation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 715
18.5 Ion Implantation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 716
18.6 Deposition and Etching . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 718
18.7 Device Fabrication. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 718
18.7.1 Active Devices . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 718
18.7.2 Passive Devices . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 721
18.7.3 Interconnects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 727
18.8 Latch-Up . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 730
19 Layout and Packaging. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 733
19.1 General Layout Considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
733
19.1.1 Design Rules. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 734
19.1.2 Antenna Effect . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 736
19.2 Analog Layout Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 736
19.2.1 Multiﬁnger Transistors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 737
19.2.2 Symmetry . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 739
19.2.3 Shallow Trench Isolation Issues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 743
19.2.4 Well Proximity Effects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 744
19.2.5 Reference Distribution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 744
19.2.6 Passive Devices . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 746
19.2.7 Interconnects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 753
19.2.8 Pads and ESD Protection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 757
19.3 Substrate Coupling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 760
19.4 Packaging . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 764
Index . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 774

CHAPTER
1
Introduction to Analog Design
1.1
Why Analog?
We are surrounded by “digital” devices: digital cameras, digital TVs, digital communications (cell phones
and WiFi), the Internet, etc. Why, then, are we still interested in analog circuits? Isn’t analog design old
and out of fashion? Will there even be jobs for analog designers ten years from now?
Interestingly, these questions have been raised about every ﬁve years over the past 50 years, but mostly
by those who either did not understand analog design or did not want to deal with its challenges. In this
section, we learn that analog design is still essential, relevant, and challenging and will remain so for
decades to come.
1.1.1 Sensing and Processing Signals
Many electronic systems perform two principal functions: they sense (receive) a signal and subsequently
process and extract information from it. Your cell phone receives a radio-frequency (RF) signal and, after
processing it, provides voice or data information. Similarly, your digital camera senses the light intensity
emitted from various parts of an object and processes the result to extract an image.
We know intuitively that the complex task of processing is preferably carried out in the digital domain.
In fact, we may wonder whether we can directly digitize the signal and avoid any operations in the analog
domain. Figure 1.1 shows an example where the RF signal received by the antenna is digitized by an
analog-to-digital converter (ADC) and processed entirely in the digital domain. Would this scenario send
analog and RF designers to the unemployment ofﬁce?
Analog−to−Digital
Converter
Antenna
0
0
1
0
1
1
0
1
1
0
Digital Signal
Processor
RF Signal
Figure 1.1
Hypothetical RF receiver with direct signal digitization.
1

2
Chap. 1
Introduction to Analog Design
The answer is an emphatic no. An ADC that could digitize the minuscule RF signal1 would consume
much more power than today’s cell phone receivers. Furthermore, even if this approach were seriously
considered, only analog designers would be able to develop the ADC. The key point offered by this
example is that the sensing interface still demands high-performance analog design.
t
Action
Potential
Electronics
Probes
ADC
Ampliﬁer
ADC
Ampliﬁer
Processor
RF
Transmitter
(b)
(a)
(c)
Figure 1.2
(a) Voltage waveform generated as a result of neural activity, (b) use of probes to measure action
potentials, and (c) processing and transmission of signals.
Another interesting example of sensing challenges arises in the study of the brain signals. Each time a
neuron in your brain “ﬁres,” it generates an electric pulse with a height of a few millivolts and a duration
of a few hundred microseconds [Fig. 1.2(a)]. To monitor brain activities, a neural recording system may
employ tens of “probes” (electrodes) [Fig. 1.2(b)], each sensing a series of pulses. The signal produced
by each probe must now be ampliﬁed, digitized, and transmitted wirelessly so that the patient is free
to move around [Fig. 1.2(c)]. The sensing, processing, and transmission electronics in this environment
must consume a low amount of power for two reasons: (1) to permit the use of a small battery for days or
weeks, and (2) to minimize the rise in the chip’s temperature, which could otherwise damage the patient’s
tissue. Among the functions shown in Fig. 1.2(c), the ampliﬁers, the ADCs, and the RF transmitter—all
analog circuits—consume most of the power.
1.1.2 When Digital Signals Become Analog
The use of analog circuits is not limited to analog signals. If a digital signal is so small and/or so distorted
that a digital gate cannot interpret it correctly, then the analog designer must step in. For example, consider
a long USB cable carrying data rate of hundreds of megabits per second between two laptops. As shown
in Fig. 1.3, Laptop 1 delivers the data to the cable in the form of a sequence of ONEs and ZERO.
1And withstand large unwanted signals.

Sec. 1.1
Why Analog?
3
Laptop 1 
Equalizer
Laptop 2 
f
H
f
H
1
USB Cable
Figure 1.3
Equalization to compensate for high-frequency attenuation in a USB cable.
Unfortunately, the cable exhibits a ﬁnite bandwidth, attenuating high frequencies and distorting the data
as it reaches Laptop 2. This device must now perform sensing and processing, the former requiring an
analog circuit (called an “equalizer”) that corrects the distortion. For example, since the cable attenuates
high frequencies, we may design the equalizer to amplify such frequencies, as shown conceptually by the
1/|H| plot in Fig. 1.3.
The reader may wonder whether the task of equalization in Fig. 1.3 could be performed in the digital
domain. That is, could we directly digitize the received distorted signal, digitally correct for the cable’s
limited bandwidth, and then carry out the standard USB signal processing? Indeed, this is possible if
the ADC required here demands less power and less complexity than the analog equalizer. Following a
detailed analysis, the analog designer decides which approach to adopt, but we intuitively know that at very
high data rates, e.g., tens of gigabits per second, an analog equalizer proves more efﬁcient than an ADC.
The above equalization task exempliﬁes a general trend in electronics: at lower speeds, it is more
efﬁcient to digitize the signal and perform the required function(s) in the digital domain, whereas at
higher speeds, we implement the function(s) in the analog domain. The speed boundary between these
two paradigms depends on the nature of the problem, but it has risen over time.
1.1.3 Analog Design Is in Great Demand
Despite tremendous advances in semiconductor technology, analog design continues to face new chal-
lenges, thus calling for innovations. As a gauge of the demand for analog circuits, we can consider the
papers published by industry and academia at circuits conferences and see what percentage fall in our
domain. Figure 1.4 plots the number of analog papers published at the International Solid-State Circuits
Year
2010 2011 2012 2013 2014
Number of Analog Papers at ISSCC 
25
50
75
100
125
150
175
200
225
Analog
Total
Figure 1.4
Number of analog papers published at the ISSCC in recent years.

4
Chap. 1
Introduction to Analog Design
Conference (ISSCC) in recent years, where “analog” is deﬁned as a paper requiring the knowledge in this
book. We observe that the majority of the papers involve analog design. This is true even though analog
circuits are typically quite a lot less complex than digital circuits; an ADC contains several thousand
transistors whereas a microprocessor employs billions.
1.1.4 Analog Design Challenges
Today’s analog designers must deal with interesting and difﬁcult problems. Our study of devices and
circuits in this book will systematically illustrate various issues, but it is helpful to take a brief look at
what lies ahead.
Transistor Imperfections
As a result of scaling, MOS transistors continue to become faster, but at the
cost of their “analog” properties. For example, the maximum voltage gain that a transistor can provide
declines with each new generation of CMOS technology. Moreover, a transistor’s characteristics may
depend on its surroundings, i.e., the size, shape, and distance of other components around it on the chip.
Declining Supply Voltages
As a result of device scaling, the supply voltage of CMOS circuits has
inevitably fallen from about 12 V in the 1970s to about 0.9 V today. Many circuit conﬁgurations have not
survived this supply reduction and have been discarded. We continue to seek new topologies that operate
well at low voltages.
Power Consumption
The semiconductor industry, more than ever, is striving for low-power design.
This effort applies both to portable devices—so as to increase their battery lifetime—and to larger
systems—so as to reduce the cost of heat removal and ease their drag on the earth’s resources. MOS
device scaling directly lowers the power consumption of digital circuits, but its effect on analog circuits
is much more complicated.
Circuit Complexity
Today’s analog circuits may contain tens of thousands of transistors, demanding
long and tedious simulations. Indeed, modern analog designers must be as adept at SPICE as at higher-
level simulators such as MATLAB.
PVT Variations
Many device and circuit parameters vary with the fabrication process, supply voltage,
and ambient temperature. We denote these effects by PVT and design circuits such that their performance
is acceptable for a speciﬁed range of PVT variations. For example, the supply voltage may vary from 1 V
to 0.95 V and the temperature from 0◦to 80◦. Robust analog design in CMOS technology is a challenging
task because device parameters vary signiﬁcantly across PVT.
1.2
Why Integrated?
The idea of placing multiple electronic devices on the same substrate was conceived in the late 1950s. In
60 years, the technology has evolved from producing simple chips containing a handful of components to
fabricating ﬂash drives with one trillion transistors as well as microprocessors comprising several billion
devices. As Gordon Moore (one of the founders of Intel) predicted in the early 1970s, the number of
transistors per chip has continued to double approximately every one and a half years. At the same time,
the minimum dimension of transistors has dropped from about 25 μm in 1960 to about 12 nm in the year
2015, resulting in a tremendous improvement in the speed of integrated circuits.
Driven primarily by the memory and microprocessor market, integrated-circuit technologies have also
embraced analog design, affording a complexity, speed, and precision that would be impossible to achieve
using discrete implementations. We can no longer build a discrete prototype to predict the behavior and
performance of modern analog circuits.

Sec. 1.5
Levels of Abstraction
5
1.3
Why CMOS?
The idea of metal-oxide-silicon ﬁeld-effect transistors (MOSFETs) was patented by J. E. Lilienfeld in the
early 1930s—well before the invention of the bipolar transistor. Owing to fabrication limitations, however,
MOS technologies became practical only much later, in the early 1960s, with the ﬁrst several generations
producing only n-type transistors. It was in the mid-1960s that complementary MOS (CMOS) devices
(i.e., with both n-type and p-type transistors) were introduced, initiating a revolution in the semiconductor
industry.
CMOS technologies rapidly captured the digital market: CMOS gates dissipated power only during
switching and required very few devices, two attributes in sharp contrast to their bipolar or GaAs coun-
terparts. It was also soon discovered that the dimensions of MOS devices could be scaled down more
easily than those of other types of transistors.
The next obvious step was to apply CMOS technology to analog design. The low cost of fabrication
and the possibility of placing both analog and digital circuits on the same chip so as to improve the
overall performance and/or reduce the cost of packaging made CMOS technology attractive. However,
MOSFETs were slower and noisier than bipolar transistors, ﬁnding limited application.
How did CMOS technology come to dominate the analog market as well? The principal force was
device scaling because it continued to improve the speed of MOSFETs. The intrinsic speed of MOS
transistors has increased by orders of magnitude in the past 60 years, exceeding that of bipolar devices
even though the latter have also been scaled (but not as fast).
Another critical advantage of MOS devices over bipolar transistors is that the former can operate
with lower supply voltages. In today’s technology, CMOS circuits run from supplies around 1 V and
bipolar circuits around 2 V. The lower supplies have permitted a smaller power consumption for complex
integrated circuits.
1.4
Why This Book?
The design of analog circuits itself has evolved together with the technology and the performance re-
quirements. As the device dimensions shrink, the supply voltage of intergrated circuits drops, and analog
and digital circuits are fabricated on one chip, many design issues arise that were previously unimportant.
Such trends demand that the analysis and design of circuits be accompanied by an in-depth understanding
of new technology-imposed limitations.
Good analog design requires intuition, rigor, and creativity. As analog designers, we must wear our
engineer’s hat for a quick and intuitive understanding of a large circuit, our mathematician’s hat for quan-
tifying subtle, yet important effects in a circuit, and our artist’s hat for inventing new circuit topologies.
This book describes modern analog design from both intuitive and rigorous angles. It also fosters the
reader’s creativity by carefully guiding him or her through the evolution of each circuit and presenting
the thought process that occurs during the development of new circuit techniques.
1.5
Levels of Abstraction
Analysisanddesignofintegratedcircuitsoftenrequirethinkingatvariouslevelsofabstraction.Depending
on the effect or quantity of interest, we may study a complex circuit at device physics level, transistor level,
architecture level, or system level. In other words, we may consider the behavior of individual devices in
terms of their internal electric ﬁelds and charge transport [Fig. 1.5(a)], the interaction of a group of devices
according to their electrical characteristics [Fig. 1.5(b)], the function of several building blocks operating
as a unit [Fig. 1.5(c)], or the performance of the system in terms of that of its constituent subsystems

6
Chap. 1
Introduction to Analog Design
[Fig. 1.5(d)]. Switching between levels of abstraction becomes necessary in both understanding the details
of the operation and optimizing the overall performance. In fact, in today’s IC industry, the interaction
among all groups, from device physicists to system designers, is essential to achieving high performance
and low cost. In this book, we begin with device physics and develop increasingly more complex circuit
topologies.
Architecture
System
n+
n+
Analog−to−Digital
Converter
Amp./Filter
Clock
Recovery
(a)
(b)
(c)
(d)
AGC
Equalizer
Circuit
Device
Figure 1.5
Abstraction levels in circuit design: (a) device level, (b) circuit level, (c) architecture level,
(d) system level.

CHAPTER
2
Basic MOS Device Physics
In studying the design of integrated circuits (ICs), one of two extreme approaches can be taken, (1) be-
gin with quantum mechanics and understand solid-state physics, semiconductor device physics, device
modeling, and ﬁnally the design of circuits; or (2) treat each semiconductor device as a black box whose
behavior is described in terms of its terminal voltages and currents and design circuits with little attention
to the internal operation of the device. Experience shows that neither approach is optimum. In the ﬁrst
case, the reader cannot see the relevance of all the physics to designing circuits, and in the second, he or
she is constantly mystiﬁed by the contents of the black box.
In today’s IC industry, a solid understanding of semiconductor devices is essential—more so in analog
design than in digital design, because in the former, transistors are not considered to be simple switches,
and many of their second-order effects directly impact the performance. Furthermore, as each new
generation of IC technologies scales the devices, these effects become more signiﬁcant. Since the designer
must often decide which effects can be neglected in a given circuit, insight into device operation proves
invaluable.
In this chapter, we study the physics of MOSFETs at an elementary level, covering the bare minimum
that is necessary for basic analog design. The ultimate goal is still to develop a circuit model for each device
by formulating its operation, but this is accomplished through a good understanding of the underlying
principles. After studying many analog circuits in Chapters 3 through 14 and gaining motivation for a
deeper understanding of devices, we return to the subject in Chapter 17 and deal with other aspects of
MOS operation.
We begin our study with the structure of MOS transistors and derive their I/V characteristics. Next,
we describe second-order effects such as body effect, channel-length modulation, and subthreshold
conduction. We then identify the parasitic capacitances of MOSFETs, derive a small-signal model, and
present a simple SPICE model. We assume that the reader is familiar with such basic concepts as doping,
mobility, and pn junctions.
2.1
General Considerations
2.1.1 MOSFET as a Switch
Before delving into the actual operation of the MOSFET, we consider a simplistic model of the device so
as to gain a feel for what the transistor is expected to be and which aspects of its behavior are important.
Shown in Fig. 2.1 is the symbol for an n-type MOSFET, revealing three terminals: gate (G), source
(S), and drain (D). The latter two are interchangeable because the device is symmetric. When operating
7

8
Chap. 2
Basic MOS Device Physics
Gate
Source
Drain
Figure 2.1
Simple view of a MOS
device.
as a switch, the transistor “connects” the source and the drain together if the gate voltage, VG, is “high”
and isolates the source and the drain if VG is “low.”
Even with this simpliﬁed view, we must answer several questions. For what value of VG does the
device turn on? In other words, what is the “threshold” voltage? What is the resistance between S and D
when the device is on (or off)? How does this resistance depend on the terminal voltages? Can we always
model the path between S and D by a simple linear resistor? What limits the speed of the device?
While all of these questions arise at the circuit level, they can be answered only by analyzing the
structure and physics of the transistor.
2.1.2 MOSFET Structure
Figure2.2showsasimpliﬁedstructureofann-typeMOS(NMOS)device.Fabricatedona p-typesubstrate
(also called the “bulk” or the “body”), the device consists of two heavily-doped n regions forming the
source and drain terminals, a heavily-doped (conductive) piece of polysilicon1 (simply called “poly”)
operating as the gate, and a thin layer of silicon dioxide (SiO2) (simply called “oxide”) insulating the gate
from the substrate. The useful action of the device occurs in the substrate region under the gate oxide.
Note that the structure is symmetric with respect to S and D.
n+
n+
Oxide
Poly
p−substrate
Leff
Ldrawn
S
D
G
LD
tox
W
Figure 2.2
Structure of a MOS device.
The lateral dimension of the gate along the source-drain path is called the length, L, and that perpen-
dicular to the length is called the width, W. Since the S/D junctions “side-diffuse” during fabrication, the
actual distance between the source and the drain is slightly less than L. To avoid confusion, we write,
Leff = Ldrawn −2L D, where Leff is the “effective” length, Ldrawn is the total length,2 and L D is the amount
of side diffusion. As we will see later, Leff and the gate oxide thickness, tox, play an important role in the
performance of MOS circuits. Consequently, the principal thrust in MOS technology development is to
reduce both of these dimensions from one generation to the next without degrading other parameters of
the device. Typical values at the time of this writing are Leff ≈10 nm and tox ≈15 A
◦. In the remainder of
this book, we denote the effective length by L unless otherwise stated.
1Polysilicon is silicon in amorphous (non crystal) form. As explained in Chapter 18, when the gate silicon is grown on top of
the oxide, it cannot form a crystal. The gate was originally made of metal [hence the term “metal-oxide-semiconductor” (MOS)]
and is returning to metal in recent generations.
2The subscript “drawn” is used because this is the dimension that we draw in the layout of the transistor (Sec. 2.4.1).

Sec. 2.1
General Considerations
9
If the MOS structure is symmetric, why do we call one n region the source and the other the drain?
This becomes clear if the source is deﬁned as the terminal that provides the charge carriers (electrons
in the case of NMOS devices) and the drain as the terminal that collects them. Thus, as the voltages at
the three terminals of the device vary, the source and the drain may exchange roles. These concepts are
practiced in the problems at the end of the chapter.
We have thus far ignored the substrate on which the device is fabricated. In reality, the substrate
potential greatly inﬂuences the device characteristics. That is, the MOSFET is a four-terminal device.
Since in typical MOS operation, the S/D junction diodes must be reverse-biased, we assume that the
substrate of NMOS transistors is connected to the most negative supply in the system. For example, if
a circuit operates between zero and 1.2 volts, Vsub,NMOS = 0. The actual connection is usually provided
through an ohmic p+ region, as depicted in the side view of the device in Fig. 2.3.
G
D
S
p+
B
n+
n+
p−substrate
Figure 2.3
Substrate connection.
In complementary MOS (CMOS) technologies, both NMOS and PMOS transistors are available. From
a simplistic viewpoint, the PMOS device is obtained by negating all of the doping types (including the
substrate) [Fig. 2.4(a)], but in practice, NMOS and PMOS devices must be fabricated on the same wafer,
i.e., the same substrate. For this reason, one device type can be placed in a “local substrate,” usually called
a “well.” In today’s CMOS processes, the PMOS device is fabricated in an n-well [Fig. 2.4(b)]. Note that
the n-well must be connected to a potential such that the S/D junction diodes of the PMOS transistor
remain reverse-biased under all conditions. In most circuits, the n-well is tied to the most positive supply
voltage. For the sake of brevity, we sometimes call NMOS and PMOS devices “NFETs” and “PFETs,”
respectively.
Nanometer Design Notes
Some modern CMOS processes offer a
“deep n-well,” an n-well that contains an
NMOS device and its p-type bulk. As
shown below, the NMOS transistor’s bulk
is now localized and need not be tied
to that of other NMOS devices. But the
design incurs substantial area overhead
because the deep n-well must extend
beyond the p-well by a certain amount
and must maintain a certain distance to
the regular n-well.
p−substrate
n+
n+
p+
p−well
Deep n−well
p+
p+
n+
n−well
n+
PMOS
NMOS
Figure2.4(b)indicatesaninterestingdifferencebetweenNMOSandPMOS
transistors: while all NFETs share the same substrate, each PFET can have
an independent n-well. This ﬂexibility of PFETs is exploited in some analog
circuits.
2.1.3 MOS Symbols
The circuit symbols used to represent NMOS and PMOS transistors are shown
in Fig. 2.5. The symbols in Fig. 2.5(a) contain all four terminals, with the sub-
strate denoted by “B” (bulk) rather than “S” to avoid confusion with the source.
The source of the PMOS device is positioned on top as a visual aid because
it has a higher potential than its gate. Since in most circuits the bulk terminals
of NMOS and PMOS devices are tied to ground and VDD, respectively, we
usually omit these connections in drawing [Fig. 2.5(b)]. In digital circuits, it
is customary to use the “switch” symbols depicted in Fig. 2.5(c) for the two
types, but we prefer those in Fig. 2.5(b) because the visual distinction between
S and D proves helpful in understanding the operation of circuits.

10
Chap. 2
Basic MOS Device Physics
G
D
S
B
n−substrate
G
D
S
B
n+
p+
p+
p+
n+
p+
n−well
G
D
S
B
p−substrate
(a)
(b)
n+
n+
p+
Figure 2.4
(a) Simple PMOS device; (b) PMOS inside an n-well.
D
G
S
B
D
G
S
B
NMOS
PMOS
D
G
S
D
G
S
NMOS
PMOS
D
G
S
NMOS
D
G
S
PMOS
(c)
(a)
(b)
Figure 2.5
MOS symbols.
2.2
MOS I/V Characteristics
In this section, we analyze the generation and transport of charge in MOSFETs as a function of the
terminal voltages. Our objective is to derive equations for the I/V characteristics such that we can elevate
our abstraction from device physics level to circuit level.
2.2.1 Threshold Voltage
Consider an NFET connected to external voltages as shown in Fig. 2.6(a). What happens as the gate
voltage, VG, increases from zero? Since the gate, the dielectric, and the substrate form a capacitor, as VG
becomes more positive, the holes in the p-substrate are repelled from the gate area, leaving negative ions
behind so as to mirror the charge on the gate. In other words, a depletion region is created [Fig. 2.6(b)].
Under this condition, no current ﬂows because no charge carriers are available.
As VG increases, so do the width of the depletion region and the potential at the oxide-silicon interface.
In a sense, the structure resembles a voltage divider consisting of two capacitors in series: the gate-
oxide capacitor and the depletion-region capacitor [Fig. 2.6(c)]. When the interface potential reaches a
sufﬁciently positive value, electrons ﬂow from the source to the interface and eventually to the drain.

Sec. 2.2
MOS I/V Characteristics
11
p−substrate
VG
VG
n+
n+
n+
n+
p+
p−substrate
VG
(a)
(b)
p−substrate
VG
Cox
Cdep
(c)
n+
n+
n+
n+
p−substrate
VG
(d)
Negative Ions
Electrons
+0.1 V
+0.1 V
+0.1 V
+0.1 V
+0.1 V
(Channel)
Figure 2.6
(a) A MOSFET driven by a gate voltage; (b) formation of depletion region; (c) onset of inversion;
(d) formation of inversion layer.
Thus, a “channel” of charge carriers is formed under the gate oxide between S and D, and the transistor
is “turned on.” We say the interface is “inverted.” For this reason, the channel is also called the “inversion
layer.” The value of VG for which this occurs is called the “threshold voltage,” VTH. If VG rises further,
the charge in the depletion region remains relatively constant while the channel charge density continues
to increase, providing a greater current from S to D.
In reality, the turn-on phenomenon is a gradual function of the gate voltage, making it difﬁcult to
deﬁne VTH unambiguously. In semiconductor physics, the VTH of an NFET is usually deﬁned as the
gate voltage for which the interface is “as much n-type as the substrate is p-type.” It can be proved [1]
that3
VTH = MS + 2F + Qdep
Cox
(2.1)
where MS is the difference between the work functions of the polysilicon gate and the silicon substrate,
F = (kT/q) ln(Nsub/ni), k is Boltzmann’s constant, q is the electron charge, Nsub is the doping density
of the substrate, ni is the density of electrons in undoped silicon, Qdep is the charge in the depletion region,
and Cox is the gate-oxide capacitance per unit area. From pn junction theory, Qdep = √4qϵsi|F|Nsub,
where ϵsi denotes the dielectric constant of silicon. Since Cox appears very frequently in device and
circuit calculations, it is helpful to remember that for tox ≈20 A
◦, Cox ≈17.25 fF/μm2. The value of Cox
can then be scaled proportionally for other oxide thicknesses.
In practice, the “native” threshold value obtained from the above equation may not be suited to circuit
design, e.g., VTH = 0 and the device does not turn off for VG ≥0.4 For this reason, the threshold voltage
is typically adjusted by implantation of dopants into the channel area during device fabrication, in essence
altering the doping level of the substrate near the oxide interface. For example, as shown in Fig. 2.7, if a
thin sheet of p+ is created, the gate voltage required to deplete this region increases.
3Charge trapping in the oxide is neglected here.
4Called a “depletion-mode” FET, such a device was used in old technologies. NFETs with a positive threshold are called
“enhancement-mode” devices.

12
Chap. 2
Basic MOS Device Physics
n+
n+
p−substrate
p+
Figure 2.7
Implantation of p+
dopants to alter the threshold.
The above deﬁnition is not directly applicable to the measurement of VTH. In Fig. 2.6(a), only the
drain current can indicate whether the device is “on” or “off,” failing to reveal at what VGS the interface
is as much n-type as the bulk is p-type. As a result, the calculation of VTH from I/V measurements is
somewhat ambiguous. We will return to this point later, but assume for now that the device turns on
abruptly for VGS ≥VTH.
The turn-on phenomenon in a PMOS device is similar to that of NFETs, but with all the polarities
reversed. As shown in Fig. 2.8, if the gate-source voltage becomes sufﬁciently negative, an inversion
layer consisting of holes is formed at the oxide-silicon interface, providing a conduction path between
the source and the drain. That is, the threshold voltage of a PMOS device is typically negative.
VG
VG
–0.1 V
–0.1 V
Holes
n−substrate
p+
p+
Figure 2.8
Formation of inversion layer in a PFET.
2.2.2 Derivation of I/V Characteristics
In order to obtain the relationship between the drain current of a MOSFET and its terminal voltages, we
make two observations.
First, consider a semiconductor bar carrying a current I [Fig. 2.9(a)]. If the mobile charge density
along the direction of current is Qd coulombs per meter and the velocity of the charge is v meters per
second, then
I = Qd · v
(2.2)
To understand why, we measure the total charge that passes through a cross section of the bar in unit time.
With a velocity v, all of the charge enclosed in v meters of the bar must ﬂow through the cross section in
I
One second later
v meters
(a)
(b)
Figure 2.9
(a) A semiconductor bar carrying a current I; (b) snapshots of the carriers one second apart.

Sec. 2.2
MOS I/V Characteristics
13
one second [Fig. 2.9(b)]. Since the charge density is Qd, the total charge in v meters equals Qd · v. This
lemma proves useful in analyzing semiconductor devices.
Second, to utilize the above lemma, we must determine the mobile charge density in a MOSFET. To
this end, consider an NFET whose source and drain are connected to ground [Fig. 2.10(a)]. What is the
charge density in the inversion layer? Since we assume that the onset of inversion occurs at VGS = VTH,
the inversion charge density produced by the gate-oxide capacitance is proportional to VGS −VTH. For
VGS ≥VTH, any charge placed on the gate must be mirrored by the charge in the channel, yielding a
uniform channel charge density (charge per unit length along the source-drain path) equal to
Qd = WCox(VGS −VTH)
(2.3)
where Cox is multiplied by W to represent the total capacitance per unit length.
Now suppose, as depicted in Fig. 2.10(b), that the drain voltage is greater than zero. Since the channel
potential varies from zero at the source to VD at the drain, the local voltage difference between the gate
and the channel varies from VG (near the source) to VG −VD (near the drain). Thus, the charge density
at a point x along the channel can be written as
Qd(x) = WCox[VGS −V (x) −VTH]
(2.4)
where V (x) is the channel potential at x. From (2.2), the current is given by
ID = −WCox[VGS −V (x) −VTH]v
(2.5)
S
D
VG
VG
VG
VD
W
p−substrate
VG
n+
n+
S
VD
(a)
(b)
0
L
x
W
W
W
Gate−Sub.
Voltage Difference
p−substrate
Gate−Sub.
Voltage Difference
n+
n+
Figure 2.10
Channel charge with (a) equal source and drain voltages and (b) unequal source and drain voltages.

14
Chap. 2
Basic MOS Device Physics
where the negative sign is inserted because the charge carriers are negative. Note that v denotes the
velocity of the electrons in the channel. For semiconductors, v = μE, where μ is the mobility of charge
carriers and E is the electric ﬁeld. Noting that E(x) = −dV/dx and representing the mobility of electrons
by μn, we have
ID = WCox[VGS −V (x) −VTH]μn
dV(x)
dx
(2.6)
subject to boundary conditions V (0) = 0 and V (L) = VDS. While V (x) can be easily found from this
equation, the quantity of interest is in fact ID. Multiplying both sides by dx and performing integration,
we obtain
 L
x=0
IDdx =
 VDS
V =0
WCoxμn[VGS −V (x) −VTH]dV
(2.7)
Since ID is constant along the channel,
ID = μnCox
W
L

(VGS −VTH)VDS −1
2V 2
DS

(2.8)
Note that L is the effective channel length.
Figure 2.11 plots the parabolas given by (2.8) for different values of VGS, indicating that the “current
capability” of the device increases with VGS. Calculating ∂ID/∂VDS, the reader can show that the peak
of each parabola occurs at VDS = VGS −VTH and the peak current is
ID, max = 1
2μnCox
W
L (VGS −VTH)2
(2.9)
We call VGS −VTH the “overdrive voltage” and W/L the “aspect ratio.” If VDS ≤VGS −VTH, we say the
device operates in the “triode region.”5
VDS
ID
VGS1
VGS2
VGS3
Triode Region
VGS1 – VTH
VGS2 – VTH
VGS3 – VTH
Figure 2.11
Drain current versus
drain-source voltage in the triode region.
Equations (2.8) and (2.9) serve as our ﬁrst step toward CMOS circuit design, describing the dependence
of ID upon the constant of the technology, μnCox, the device dimensions, W and L, and the gate and
drain potentials with respect to the source. Note that the integration in (2.7) assumes that μn and VTH are
independent of x and the gate and drain voltages, an approximation that we will revisit in Chapter 17.
5Also called the “linear region.”

Sec. 2.2
MOS I/V Characteristics
15
If in (2.8), VDS ≪2(VGS −VTH), we have
ID ≈μnCox
W
L (VGS −VTH)VDS
(2.10)
that is, the drain current is a linear function of VDS. This is also evident from the characteristics of
Fig. 2.11 for small VDS: as shown in Fig. 2.12, each parabola can be approximated by a straight line.
The linear relationship implies that the path from the source to the drain can be represented by a linear
resistor equal to
Ron =
1
μnCox
W
L (VGS −VTH)
(2.11)
VDS
ID
VGS1
VGS2
VGS3
VGS1
VGS2
VGS3
Figure 2.12
Linear operation in deep triode region.
A MOSFET can therefore operate as a resistor whose value is controlled by the overdrive voltage [so long
as VDS ≪2(VGS −VTH)]. This is conceptually illustrated in Fig. 2.13. Note that in contrast to bipolar
transistors, a MOS device may be on even if it carries no current. With the condition VDS ≪2(VGS−VTH),
we say the device operates in the deep triode region.
G
D
S
VGS
S
D
Figure 2.13
MOSFET as a controlled
linear resistor.
▲
Example2.1
For the arrangement in Fig. 2.14(a), plot the on-resistance of M1 as a function of VG. Assume that μnCox =
50 μA/V2, W/L = 10, and VTH = 0.3 V. Note that the drain terminal is open.
Solution
Since the drain terminal is open, ID = 0 and VDS = 0. Thus, if the device is on, it operates in the deep triode region.
For VG < 1 V + VTH, M1 is off and Ron = ∞. For VG > 1 V + VTH, we have
Ron =
1
50 μA/V2 × 10(VG −1 V −0.3 V)
(2.12)
The result is plotted in Fig. 2.14(b).

16
Chap. 2
Basic MOS Device Physics
VG
1 V
M1
Ron
VG
(a)
(b)
1.3 V
Figure 2.14
▲
MOSFETs operating as controllable resistors play a crucial role in many analog circuits. For example, a
voltage-controlled resistor can be used to adjust the frequency of the clock generator in a laptop computer
if the system must go into a power saving mode. As studied in Chapter 13, MOSFETs also serve as
switches.
What happens if the drain-source voltage in Fig. 2.11 exceeds VGS −VTH? In reality, the drain cur-
rent does not follow the parabolic behavior for VDS > VGS −VTH. In fact, as shown in Fig. 2.15, ID
becomes relatively constant, and we say the device operates in the “saturation” region.6 To understand
this phenomenon, recall from (2.4) that the local density of the inversion-layer charge is proportional to
VGS −V (x) −VTH. Thus, if V (x) approaches VGS −VTH, then Qd(x) drops to zero. In other words, as
depicted in Fig. 2.16, if VDS is slightly greater than VGS −VTH, then the inversion layer stops at x ≤L,
and we say the channel is “pinched off.” As VDS increases further, the point at which Qd equals zero
gradually moves toward the source. Thus, at some point along the channel, the local potential difference
between the gate and the oxide-silicon interface is not sufﬁcient to support an inversion layer.
VDS
ID
VGS1
VGS2
VGS3
Saturation Region
VGS3 − VTH
VGS2 − VTH
VGS1 − VTH
Figure 2.15
Saturation of drain current.
How does the device conduct current in the presence of pinch-off? As the electrons approach the
pinch-off point (where Qd →0), their velocity rises tremendously (v = I/Qd). Upon passing the pinch-
off point, the electrons simply shoot through the depletion region near the drain junction and arrive at the
drain terminal.
6Note the difference between saturation in bipolar and MOS devices.

Sec. 2.2
MOS I/V Characteristics
17
n+
n+
Pinch−off
0
x1
VDS1
Pinch−off
V(x2) = VGS – VTH
V(x1) = VGS – VTH
0
x2
VDS2 > VDS1
VG
VG
Gate−Sub.
Voltage Difference
VTH
Gate−Sub.
Voltage Difference
VTH
Depletion
Region
n+
n+
Figure 2.16
Pinch-off behavior.
With the above observations, we reexamine (2.7) for a saturated device. Since Qd is the density of
mobile charge, the integral on the left-hand side of (2.7) must be taken from x = 0 to x = L′, where
L′ is the point at which Qd drops to zero (e.g., x2 in Fig. 2.16), and that on the right from V (x) = 0 to
V (x) = VGS −VTH. As a result,
ID = 1
2μnCox
W
L′ (VGS −VTH)2
(2.13)
indicating that ID is relatively independent of VDS if L′ remains close to L. We say the device exhibits a
“square-law” behavior. If ID is known, then VGS is obtained as
VGS =




2ID
μnCox
W
L′
+ VTH
(2.14)
We must emphasize that for the transistor to remain in saturation (as is the case in many analog
circuits), the drain-source voltage must be equal to or greater than the overdrive voltage. For this reason,
some books write VD,sat = VGS −VTH, where VD,sat denotes the minimum VDS necessary for operation
in saturation. As seen later in this book, if the signal swings at the drain or the gate cause VDS to fall
below VGS −VTH, then a number of undesirable effects occur. For this reason, the choice of the overdrive
and hence VD,sat translates to a certain voltage “headroom” for the signal swings in the circuit: the larger
the VD,sat, the less headroom is available for the signals.
Equations (2.8) and (2.13) represent the “large-signal” behavior of NMOS devices; i.e., they can
predict the drain current for arbitrary voltages applied to the gate, source, and drain (but only if the device
is on). Since the nonlinear nature of these equations makes the analysis difﬁcult, we often resort to linear
approximations (“small-signal” models) so as to develop some understanding of a given circuit. This
point becomes clear in Sec. 2.4.3.
For PMOS devices, Eqs. (2.8) and (2.13) are respectively written as
ID = −μpCox
W
L

(VGS −VTH)VDS −1
2V 2
DS

(2.15)
and
ID = −1
2μpCox
W
L′ (VGS −VTH)2
(2.16)

18
Chap. 2
Basic MOS Device Physics
The negative sign appears here because we assume that ID ﬂows from the drain to the source, whereas
holes ﬂow in the reverse direction. Note that VGS, VDS, VTH, and VGS −VTH are negative for a PMOS
transistor that is turned on. Since the mobility of holes is about one-half the mobility of electrons, PMOS
devices suffer from lower “current drive” capability.
Vb
VDD
VDD
Vb
I1
I1
I2
I2
Figure 2.17
Saturated MOSFETs operating as current sources.
With L assumed constant, a saturated MOSFET can be used as a current source connected between the
drain and the source (Fig. 2.17), an important component in analog design. Note that the NMOS current
source injects current into ground and the PMOS current source draws current from VDD. In other words,
only one terminal of each current source is “ﬂoating.” (It is difﬁcult to design a current source that ﬂows
between two arbitrary nodes of a circuit.)
▲
Example2.2
On a VDS-VGS plane, show the regions of operation of an NMOS transistor.
VGS
VTH
VDS
VGS − VTH
Triode
Saturation
Off
Figure 2.18
VDS-VGS plane showing
regions of operation.
Solution
Since the value of VDS with respect to VGS −VTH determines the region of operation, we draw the line VDS =
VGS −VTH in the plane, as shown in Fig. 2.18. If VGS > VTH, then the region above the line corresponds to satu-
ration, and that below the line corresponds to the triode region. Note that for a given VDS, the device eventually
leaves saturation as VGS increases. The minimum allowable VDS for operation in saturation is also called VD,sat.
It is important to bear in mind that VD,sat = VGS −VTH.
▲
The distinction between saturation and triode regions can be confusing, especially for PMOS devices.
Intuitively, we note that the channel is pinched off if the difference between the gate and drain voltages is
not sufﬁcient to create an inversion layer. As depicted conceptually in Fig. 2.19, as VG −VD of an NFET
drops below VTH, pinch-off occurs. Similarly, if VD −VG of a PFET is not large enough (< |VTHP|), the
device is saturated. Note that this view does not require knowledge of the source voltage. This means that
we must know a priori which terminal operates as the drain. The drain is deﬁned as the terminal with a
higher (lower) voltage than the source for an NFET (PFET).

Sec. 2.2
MOS I/V Characteristics
19
VTHN
VTHP
(a)
(b)
Saturation
Edge of Triode Region
Saturation
Edge of Triode Region
Figure 2.19
Conceptual visualization of saturation and triode regions.
2.2.3 MOS Transconductance
Since a MOSFET operating in saturation produces a current in response to its gate-source overdrive
voltage, we may deﬁne a ﬁgure of merit that indicates how well a device converts a voltage to a current.
More speciﬁcally, since in processing signals, we deal with the changes in voltages and currents, we
deﬁne the ﬁgure of merit as the change in the drain current divided by the change in the gate-source
voltage. Called the “transconductance” (and usually deﬁned in the saturation region) and denoted by gm,
this quantity is expressed as
gm = ∂ID
∂VGS

VDS const.
(2.17)
= μnCox
W
L (VGS −VTH)
(2.18)
In a sense, gm represents the sensitivity of the device: for a high gm, a small change in VGS results in a
large change in ID. We express gm in 1/ or in siemens (S); e.g., gm = 1/(100 ) = 0.01 S. In analog
design, we sometimes say a MOSFET operates as a “transconductor” or a “V/I converter” to indicate
that it converts a voltage change to a current change. Interestingly, gm in the saturation region is equal to
the inverse of Ron in the deep triode region.
The reader can prove that gm can also be expressed as
gm =
	
2μnCox
W
L ID
(2.19)
=
2ID
VGS −VTH
(2.20)
Plotted in Fig. 2.20, each of the above expressions proves useful in studying the behavior of gm as a
function of one parameter while other parameters remain constant. For example, (2.18) suggests that
VGS − VTH
VGS − VTH
gm
W/L Constant
gm
W/L Constant
ID
gm
ID Constant
Figure 2.20
Approximate MOS transconductance as a function of overdrive and drain current.

20
Chap. 2
Basic MOS Device Physics
gm increases with the overdrive if W/L is constant, whereas (2.20) implies that gm decreases with the
overdrive if ID is constant.
The ID and VGS −VTH terms in the above gm equations are bias values. For example, a transistor with
W/L = 5 μm/0.1 μm and biased at ID = 0.5 mA may exhibit a transconductance of (1/200 ). If a
signal is applied to the device, then ID and VGS −VTH and hence gm vary, but in small-signal analysis,
we assume that the signal amplitude is small enough that this variation is negligible.
Equation (2.19) implies that the transconductance can be raised arbitrarily if we increase W/L and
keep ID constant. This result is incorrect and will be revised in Sec. 2.3.
The concept of transconductance can also be applied to a device operating in the triode region, as
illustrated in the following example.
▲
Example2.3
For the arrangement shown in Fig. 2.21, plot the transconductance as a function of VDS.
Vb
VDS
Vb – VTH
gm
VDS
M1
ID
Figure 2.21
Solution
It is simpler to study gm as VDS decreases from inﬁnity. So long as VDS ≥Vb −VTH, M1 is in saturation, ID is
relatively constant, and, from (2.19), so is gm. If the drain voltage falls below the gate voltage by more than one
threshold, M1 enters the triode region, and
gm =
∂
∂VGS

1
2μnCox
W
L

2(VGS −VTH)VDS −V 2
DS

(2.21)
= μnCox
W
L VDS
(2.22)
Thus, as plotted in Fig. 2.21, the transconductance drops in the triode region. For ampliﬁcation, therefore, we usually
employ MOSFETs in saturation.
▲
For a PFET, the transconductance in the saturation region is expressed as gm =−μpCox(W/L)
(VGS −VTH) = −2ID/(VGS −VTH) =

2μpCox(W/L)ID.
2.3
Second-Order Effects
Our analysis of the MOS structure has thus far entailed various simplifying assumptions, some of which
are not valid in many analog circuits. In this section, we describe three second-order effects that are
essential in our subsequent circuit analyses. Other phenomena that appear in nanometer devices are
studied in Chapter 17.
Body Effect
In the analysis of Fig. 2.10, we tacitly assumed that the bulk and the source of the tran-
sistor were tied to ground. What happens if the bulk voltage of an NFET drops below the source voltage
(Fig. 2.22)? Since the S and D junctions remain reverse-biased, we surmise that the device continues
to operate properly, but some of its characteristics may change. To understand the effect, suppose

Sec. 2.3
Second-Order Effects
21
n+
n+
p−substrate
VG
VG
VB < 0
VB < 0
VD
VD
p+
Figure 2.22
NMOS device with negative bulk voltage.
n+
n+
p−substrate
VG
VB = 0
VB < 0
VD
p−substrate
VG
VD
Qd
Qd
p+
n+
p+
n+
Figure 2.23
Variation of depletion region charge with bulk voltage.
VS = VD = 0, and VG is somewhat less than VTH, so that a depletion region is formed under the gate but
no inversion layer exists. As VB becomes more negative, more holes are attracted to the substrate connec-
tion, leaving a larger negative charge behind; i.e., as depicted in Fig. 2.23, the depletion region becomes
wider. Now recall from Eq. (2.1) that the threshold voltage is a function of the total charge in the depletion
region because the gate charge must mirror Qd before an inversion layer is formed. Thus, as VB drops and
Qd increases, VTH also increases. This phenomenon is called the “body effect” or the “back-gate effect.”
It can be proved that with body effect,
VTH = VT H0 + γ

2F + VSB −

|2F|

(2.23)
where VT H0 is given by (2.1), γ = √2qϵsi Nsub/Cox denotes the body-effect coefﬁcient, and VSB is the
source-bulk potential difference [1]. The value of γ typically lies in the range of 0.3 to 0.4 V1/2.
▲
Example2.4
In Fig. 2.24(a), plot the drain current if VX varies from −∞to 0. Assume VT H0 = 0.3 V, γ = 0.4 V1/2, and
2F = 0.7 V.
ID
VX
ID
VX1
2 V
M1
VX
0
(a)
(b)
+1.2 V
Figure 2.24

22
Chap. 2
Basic MOS Device Physics
Solution
If VX is sufﬁciently negative, the threshold voltage of M1 exceeds 1.2 V and the device is off. That is,
1.2 V = 0.3 + 0.4

0.7 −VX1 −
√
0.7

(2.24)
and hence VX1 = −8.83 V. For VX1 < VX < 0, ID increases according to
ID = 1
2μnCox
W
L

VGS −VT H0 −γ

2F −VX −

2F
2
(2.25)
Fig. 2.24(b) shows the resulting behavior.
▲
For body effect to manifest itself, the bulk potential, Vsub, need not change: if the source voltage varies
with respect to Vsub, the same phenomenon occurs. For example, consider the circuit in Fig. 2.25(a), ﬁrst
ignoring body effect. We note that as Vin varies, Vout closely follows the input because the drain current
remains equal to I1. In fact, we can write
I1 = 1
2μnCox
W
L (Vin −Vout −VTH)2
(2.26)
concluding that Vin −Vout is constant if I1 is constant [Fig. 2.25(b)].
M1
VDD
Vin
Vout
I1
t
Vin
t
Vin
(c)
(a)
(b)
Vout
Vout
Figure 2.25
(a) A circuit in which the source-bulk voltage varies with input level; (b) input and output voltages
with no body effect; (c) input and output voltages with body effect.
Now suppose that the substrate is tied to ground and body effect is signiﬁcant. Then, as Vin and hence
Vout become more positive, the potential difference between the source and the bulk increases, raising
the value of VTH. Equation (2.26) implies that Vin −Vout must increase so as to maintain ID constant
[Fig. 2.25(c)].
Body effect is usually undesirable. The change in the threshold voltage, e.g., as in Fig. 2.25(a), often
complicates the design of analog (and even digital) circuits. Device technologists balance Nsub and Cox
to obtain a reasonable value for γ .
▲
Example2.5
Equation (2.23) suggests that if VSB becomes negative, then VTH decreases. Is this correct?
Solution
Yes, it is. If the bulk voltage of an NMOS device rises above its source voltage, VTH falls below VT H0. This observation
proves useful in low-voltage design, where the performance of a circuit may suffer due to a high threshold voltage;
one can bias the bulk to reduce VTH. Unfortunately, this is not straightforward for NFETs because they typically
share one substrate, but it can readily be applied to individual PFETs.
▲

Sec. 2.3
Second-Order Effects
23
Channel-Length Modulation
In the analysis of channel pinch-off in Sec. 2.2, we noted that the actual
length of the channel gradually decreases as the potential difference between the gate and the drain
decreases. In other words, in (2.13), L′ is in fact a function of VDS. This effect is called “channel-length
modulation.” Writing L′ = L −L, i.e., 1/L′ ≈(1+L/L)/L, and assuming a ﬁrst-order relationship
between L/L and VDS, such as L/L = λVDS, we have, in saturation,
ID ≈1
2μnCox
W
L (VGS −VTH)2(1 + λVDS)
(2.27)
where λ is the “channel-length modulation coefﬁcient.” Illustrated in Fig. 2.26, this phenomenon results
in a nonzero slope in the ID/VDS characteristic and hence a nonideal current source between D and S in
saturation. The parameter λ represents the relative variation in length for a given increment in VDS. Thus,
for longer channels, λ is smaller.
VDS
ID
VGS1
VGS2
Figure 2.26
Finite saturation region
slope resulting from channel-length
modulation.
▲
Example2.6
Is there channel-length modulation in the triode region?
Solution
No, there is not. In the triode region, the channel continuously stretches from the source
to the drain, experiencing no pinch-off. Thus, the drain voltage does not modulate the
length of the channel.
Nanometer Design Notes
Nanometer transistors suffer from vari-
ous imperfections and markedly depart
from square-law behavior. Shown below
are the actual I-V characteristics of
an NFET with W/L = 5 μm/40 nm for
VGS= 0.3 V · · · 0.8 V. Also plotted are
the
characteristics
of
a
square-law
device of the same dimensions. Despite
our best efforts to match the latter
device to the former, we still observe
signiﬁcant differences.
0
0.2
0.4
0.6
0.8
1
0
0.5
1
1.5
2
2.5
3
3.5
VDS (V)
ID (mA)
The reader may then observe a discontinuity in the equations as the device goes
from the triode region to saturation:
ID,tri = 1
2μnCox
W
L

2(VGS −VTH)VDS −V 2
DS

(2.28)
ID,sat = 1
2μnCox
W
L (VGS −VTH)2(1 + λVDS)
(2.29)
The former yields (1/2)μnCoxW/L(VGS −VTH)2 at the edge of the triode region,
whereas the latter exhibits an additional factor of 1+λVDS. This discrepancy is removed
in more complex models of MOSFETs (Chapter 17).
▲
With channel-length modulation, some of the expressions derived for gm
must be modiﬁed. Equations (2.18) and (2.19) are respectively rewritten as
gm = μnCox
W
L (VGS −VTH)(1 + λVDS)
(2.30)
=

2μnCox(W/L)ID(1 + λVDS)
(2.31)
while Eq. (2.20) remains unchanged.

24
Chap. 2
Basic MOS Device Physics
▲
Example2.7
Keeping all other parameters constant, plot the ID/VDS characteristic of a MOSFET for L = L1 and L = 2L1.
Solution
Writing
ID = 1
2μnCox
W
L (VGS −VTH)2(1 + λVDS)
(2.32)
and λ ∝1/L, we note that if the length is doubled, the slope of ID vs. VDS is divided by four because ∂ID/∂VDS ∝
λ/L ∝1/L2 (Fig. 2.27). (This is true only if VGS −VTH is constant.) For a given gate-source overdrive, a larger
L gives a more ideal current source while degrading the current capability of the device. Thus, W may need to be
increased proportionally. In fact, if we double W to restore ID to its original value, the slope also doubles. In other
words, for a required drain current and a given overdrive, doubling the length reduces the slope by a factor of 2.
VDS
ID
L = L1
L = 2L1
Figure 2.27
Effect of doubling
channel length.
▲
The linear approximation L/L ∝VDS becomes less accurate in short-channel transistors, resulting
in a variable slope in the saturated ID/VDS characteristics. We return to this issue in Chapter 17.
The dependence of ID upon VDS in saturation may suggest that the bias current of a MOSFET can be
deﬁned by the proper choice of the drain-source voltage, allowing freedom in the choice of VGS −VTH.
However, since the dependence on VDS is much weaker, the drain-source voltage is not used to set the
current. That is, we always consider VGS −VTH as the current-deﬁning parameter. The effect of VDS on
ID is usually considered an error, and it is studied in Chapter 5.
Subthreshold Conduction
In our analysis of the MOSFET, we have assumed that the device turns off
abruptly as VGS drops below VTH. In reality, for VGS ≈VTH, a “weak” inversion layer still exists and some
current ﬂows from D to S. Even for VGS < VTH, ID is ﬁnite, but it exhibits an exponential dependence on
VGS [2, 3]. Called “subthreshold conduction,” this effect can be formulated for VDS greater than roughly
100 mV as
ID = I0 exp VGS
ξVT
(2.33)
where I0 is proportional to W/L, ξ > 1 is a nonideality factor, and VT = kT/q. We also say the device
operates in “weak inversion.” (Similarly, for VGS > VTH, we say the device operates in “strong inversion.”)
Except for ξ, (2.33) is similar to the exponential IC/VBE relationship of a bipolar transistor. The key point
here is that as VGS falls below VTH, the drain current drops at a ﬁnite rate. With typical values of ξ, at room
temperature VGS must decrease by approximately 80 mV for ID to decrease by one decade (Fig. 2.28).
For example, if a threshold of 0.3 V is chosen in a process to allow low-voltage operation, then when VGS
is reduced to zero, the drain current decreases by only a factor of 100.3 V/80 mV = 103.75 ≈5.62×103. For
example, if the transistor carries about 1 μA for VGS = VTH and we have 100 million such devices, then

Sec. 2.3
Second-Order Effects
25
VGS
log ID
VTH
80 mV
1 decade
Exponential
Square
Law
Figure 2.28
MOS subthreshold char-
acteristics.
they draw 18 mA when they are nominally off. Especially problematic in large circuits such as memories,
subthreshold conduction can result in signiﬁcant power dissipation (or loss of analog information).
If a MOS device conducts for VGS < VTH, then how do we deﬁne the threshold voltage? Indeed,
numerous deﬁnitions have been proposed. One possibility is to extrapolate, on a logarithmic vertical
scale, the weak inversion and strong inversion characteristics and consider their intercept voltage as the
threshold (Fig. 2.28).
We now reexamine Eq. (2.19) for the transconductance of a MOS device operating in the subthresh-
old region. Is it possible to achieve an arbitrarily high transconductance by increasing W while main-
taining ID constant? Is it possible to obtain a higher transconductance than that of a bipolar transistor
(IC/VT ) biased at the same current? Equation (2.19) was derived from the square-law characteristic ID =
(1/2)μnCox(W/L)(VGS −VTH)2. However, if W increases while ID remains constant, then VGS →VTH
and the device enters the subthreshold region. As a result, the transconductance is calculated from (2.33)
to be gm = ID/(ξVT ), revealing that MOSFETs are still inferior to bipolar transistors in this respect.
At what overdrive voltage can we say the transistor goes from strong inversion to weak inversion?
While somewhat arbitrary, this transition point can be deﬁned as the overdrive voltage, (VGS −VTH)1, at
which the corresponding transconductances would become equal for the same drain current:
ID
ξVT
=
2ID
(VGS −VTH)1
(2.34)
and hence
(VGS −VTH)1 = 2ξVT
(2.35)
For ξ ≈1.5, this amounts to about 80 mV.
The exponential dependence of ID upon VGS in subthreshold operation may suggest the use of MOS
devices in this regime so as to achieve a higher gain. However, since such conditions are met only by a
large device width or low drain current, the speed of subthreshold circuits is severely limited.
▲
Example2.8
Examine the behavior of a MOSFET as the drain “current density,” ID/W, varies.
Solution
For a given drain current and device width, how do we determine the region of operation? We must consider the
equations for both strong and weak inversion:
ID = 1
2μnCox
W
L (VGS −VTH)2
(2.36)
ID = α W
L exp VGS
ξVT
(2.37)

26
Chap. 2
Basic MOS Device Physics
where channel-length modulation is neglected and I0 in Eq. (2.33) has been expressed as a proportionality factor,
α, multiplied by W/L. What happens if the device is in strong inversion and we continue to reduce ID while W/L
is constant? Can VGS simply approach VTH to yield an arbitrarily small value for (VGS −VTH)2? Why does the
square-law equation not hold as VGS approaches VTH?
To answer these questions, we return to the plot of Fig. 2.28 and observe that only currents beyond a certain level
can be supported in strong inversion. In other words, for a given current and W/L, we must obtain VGS from both
the square-law and exponential equations and select the lower value:
VGS =
	
2ID
μnCoxW/L + VTH
(2.38)
VGS = ξVT ln
ID
αW/L
(2.39)
If ID remains constant and W increases, VGS falls and the device goes from strong inversion to weak inversion.
▲
Voltage Limitations
A MOSFET experiences various undesirable effects if its terminal voltage differ-
ences exceed certain limits (if the device is “stressed”). At high gate-source voltages, the gate oxide breaks
down irreversibly, damaging the transistor. In short-channel devices, an excessively large drain-source
voltage widens the depletion region around the drain so much that it touches that around the source,
creating a very large drain current. (This effect is called “punchthrough.”) Even without breakdown,
MOSFETs’ characteristics can change permanently if the terminal voltage differences exceed a speciﬁed
value. Such effects are described in Chapter 17.
2.4
MOS Device Models
2.4.1 MOS Device Layout
For the developments in subsequent sections, it is beneﬁcial to have some understanding of the layout of a
MOSFET. We describe only a simple view here, deferring the fabrication details and structural subtleties
to Chapters 18 and 19.
The layout of a MOSFET is determined by both the electrical properties required of the device in
the circuit and the “design rules” imposed by the technology. For example, W/L is chosen to set the
transconductance or other circuit parameters while the minimum L is dictated by the process. In addition
to the gate, the source and drain areas must be deﬁned properly as well.
Shown in Fig. 2.29 are the “bird’s-eye view” and the top view of a MOSFET. The gate polysilicon
and the source and drain terminals must be tied to metal (aluminum) wires that serve as interconnects
with low resistance and capacitance. To accomplish this, one or more “contact windows” must be
opened in each region, ﬁlled with metal, and connected to the upper metal wires. Note that the gate
poly extends beyond the channel area by some amount to ensure reliable deﬁnition of the “edge” of the
transistor.
The source and drain junctions play an important role in the performance. To minimize the capacitance
of S and D, the total area of each junction must be minimized. We see from Fig. 2.29 that one dimension
of the junctions is equal to W. The other dimension must be large enough to accommodate the contact
windows and is speciﬁed by the technology design rules.7
7This dimension is typically three to four times the minimum allowable channel length.

Sec. 2.4
MOS Device Models
27
W
W
Ldrawn
Channel
Area
(a)
(b)
n+
n+
Contact
Windows
Gate
Figure 2.29
Bird’s-eye and vertical views of a MOS device.
▲
Example2.9
Draw the layout of the circuit shown in Fig. 2.30(a).
M1
M2
M3
A
B
E
N
F
C
E
C
N
F
M1
M2
M3
B
E
F
A
N
Aluminum
Wires
(c)
(a)
(b)
Figure 2.30
Solution
Observing that M1 and M2 share the same S/D junctions at node C and M2 and M3 also do so at node N, we surmise
that the three transistors can be laid out as shown in Fig. 2.30(b). Connecting the remaining terminals, we obtain the
layout in Fig. 2.30(c). Note that the gate polysilicon of M3 cannot be directly tied to the source material of M1, thus
requiring a metal interconnect.
▲
2.4.2 MOS Device Capacitances
The basic quadratic I/V relationships derived in the previous section, along with corrections for body
effect and channel-length modulation, provide some understanding of the low-frequency behavior of
CMOS circuits. In many analog circuits, however, the capacitances associated with the devices must also
be taken into account so as to predict the high-frequency behavior as well.
We expect that a capacitance exists between every two of the four terminals of a MOSFET (Fig. 2.31).8
Moreover, the value of each of these capacitances may depend on the bias conditions of the transistor.
8The capacitance between S and D is negligible.

28
Chap. 2
Basic MOS Device Physics
CGD
CGS
CDB
CSB
CGB
G
D
S
B
Figure 2.31
MOS capacitances.
p−substrate
n+
n+
C1
C2
Inversion
Layer 
Depletion
Layer
C3
C4
C5
C6
n+
Cj
Cjsw
(a)
(b)
LD
Figure 2.32
(a) MOS device capacitances; (b) decomposition of S/D junction capacitance into bottom-plate and
sidewall components.
Nanometer Design Notes
New generations of CMOS technology
incorporate the “FinFET” structure. Un-
like the conventional “planar” device, the
FinFET extends in the third dimension.
As shown below, it consists of an n+
wall (resembling a shark’s ﬁn) and a gate
that wraps around the wall. The tran-
sistor carries current from the source
to the drain on the surfaces of the ﬁn.
Owing to the tight conﬁnement of the
electric ﬁeld between the two vertical
walls of the gate, the FinFET exhibits
less channel-length modulation and sub-
threshold leakage. But where do the S/D
contacts land? What other issues do we
face in FinFETs? We return to these
questions later in this book.
S
D
G
Oxide
Substrate
S/D Fin
n+
n+
Considering the physical structure in Fig. 2.32(a), we identify the following:
(1) the oxide capacitance between the gate and the channel, C1 = WLCox;
(2) the depletion capacitance between the channel and the substrate, C2 =
WL√qϵsi Nsub/(4F); and (3) the capacitance due to the overlap of the gate
poly with the source and drain areas, C3 and C4. Owing to fringing electric
ﬁeld lines, C3 and C4 cannot be simply written as WLDCox, and are usually ob-
tained by more elaborate calculations. The overlap capacitance per unit width
is denoted by Cov and expressed in F/m (or fF/μm). We simply multiply Cov by
W to ﬁnd the gate-source and gate-drain overlap capacitances. (4) The junc-
tion capacitance between the source/drain areas and the substrate. As shown
in Fig. 2.32(b), this last capacitance is decomposed into two components:
the bottom-plate capacitance associated with the bottom of the junction, C j,
and the sidewall capacitance due to the perimeter of the junction, C jsw. The
distinction is necessary because different transistor geometries yield different
area and perimeter values for the S/D junctions. We specify C j and Cjsw as ca-
pacitance per unit area (in F/m2) and unit length (in F/m), respectively. Thus,
C j is multiplied by the S/D area, and C jsw by the S/D perimeter. Note that
each junction capacitance can be expressed as C j = C j0/[1 + VR/(B)]m,
where VR is the reverse voltage across the junction, B is the junction built-in
potential, and m is a power typically in the range of 0.3 and 0.4.

Sec. 2.4
MOS Device Models
29
▲
Example2.10
Calculate the source and drain junction capacitances of the two structures shown in Fig. 2.33.
(a)
(b)
W
E
W
2
Source
Terminal
Drain
Terminal
E
Figure 2.33
Solution
For the transistor in Fig. 2.33(a), we have
CDB = CSB = WEC j + 2(W + E)Cjsw
(2.40)
whereas for that in Fig. 2.33(b),
CDB = W
2 EC j + 2

W
2 + E

Cjsw
(2.41)
CSB = 2

W
2 EC j + 2

W
2 + E

Cjsw

(2.42)
= W EC j + 2(W + 2E)Cjsw
(2.43)
Called a “folded” structure, the geometry in Fig. 2.33(b) exhibits substantially less drain junction capacitance than
that in Fig. 2.33(a) while providing the same W/L.
In the above calculations, we have assumed that the total source or drain perimeter, 2(W + E), is multiplied
by Cjsw. In reality, the capacitance of the inner sidewall (under the gate) may be different from that of the other
sidewalls.9 Nonetheless, we typically assume that all four sides have the same Cjsw. The error resulting from this
assumption is negligible because each node in a circuit is connected to a number of other device capacitances
as well.
▲
We now derive the capacitances between terminals of a MOSFET in different regions of opera-
tion. If the device is off, CGD = CGS = CovW, and the gate-bulk capacitance consists of the series
combination of the gate-oxide capacitance and the depletion-region capacitance [Fig. 2.32(a)], i.e.,
CGB = (WLCox)Cd/(WLCox + Cd), where L is the effective length, Cd = WL√qϵsi Nsub/(4F), and
9This is because the other sidewalls are surrounded by a “trench” (Chapter 18).

30
Chap. 2
Basic MOS Device Physics
ϵsi = ϵr,si × ϵ0 = 11.8 × (8.85 × 10−14) F/cm. The value of CSB and CDB is a function of the source and
drain voltages with respect to the substrate.
If the device is in the deep triode region, i.e., if S and D have approximately equal voltages, then the
gate-channel capacitance, WLCox, is divided equally between the gate and source terminals and the gate
and drain terminals (Fig. 2.34). This is because a change of V in the gate voltage draws equal amounts
of charge from S and D. Thus, CGD = CGS = WLCox/2 + WCov.
VGS
VTH
VD + VTH
2
3 WLCox + WCov
WCov
WLCox
2
+ WCov
Saturation
Off
Triode
CGS
CGD
VG
VD
Figure 2.34
Variation of gate-source and gate-drain capacitances versus VGS.
Let us now consider CGD and CGS. If in saturation, a MOSFET exhibits a gate-drain capacitance
roughly equal to WCov. As for CGS, we note that the potential difference between the gate and the
channel varies from VGS at the source to VTH at the pinch-off point, resulting in a nonuniform vertical
electric ﬁeld in the gate oxide as we travel from the source to the drain. It can be proved that the equivalent
capacitance of this structure, excluding the gate-source overlap capacitance, equals (2/3)WLCox [1]. Thus,
CGS = 2W LeffCox/3+WCov. The behavior of CGD and CGS in different regions of operation is plotted in
Fig. 2.34. Note that the above equations do not provide a smooth transition from one region of operation
to another, creating convergence difﬁculties in simulation programs. This issue is revisited in Chapter 17.
The gate-bulk capacitance is usually neglected in the triode and saturation regions because the inversion
layer acts as a “shield” between the gate and the bulk. In other words, if the gate voltage varies, the charge
is supplied by the source and the drain rather than the bulk.
▲
Example2.11
Sketch the capacitances of M1 in Fig. 2.35 as VX varies from zero to 3 V. Assume that VTH = 0.3 V and λ = γ = 0.
M1
VX
+2 V
+1 V
N
F
E
Figure 2.35
Solution
To avoid confusion, we label the three terminals as shown in Fig. 2.35 and denote the bulk by B. For VX ≈0, M1 is
in the triode region, CEN ≈CEF = (1/2)WLCox + WCov, and CFB is maximum. The value of CNB is independent
of VX. As VX exceeds 1 V, the role of the source and drain is exchanged [Fig. 2.36(a)], eventually bringing M1 out
of the triode region for VX ≥2 V −0.3 V. The variation of the capacitances is plotted in Figs. 2.36(b) and (c).

Sec. 2.4
MOS Device Models
31
M1
VX
+2 V
+1 V
E
CEN
CEF
WLCox
2
+ WCov
WCov
2
3 WLCox + WCov
VX (V)
VX (V)
CNB
CFB
1.0
(c)
(a)
(b)
F
N
1.7
Figure 2.36
▲
2.4.3 MOS Small-Signal Model
The quadratic characteristics described by (2.8) and (2.9) along with the voltage-dependent capacitances
derived above form the large-signal model of MOSFETs. Such a model proves essential in analyzing
circuits in which the signal signiﬁcantly disturbs the bias points, particularly if nonlinear effects are
of concern. By contrast, if the perturbation in bias conditions is small, a “small-signal” model, i.e., an
approximation of the large-signal model around the operating point, can be employed to simplify the
calculations. Since in many analog circuits, MOSFETs are biased in the saturation region, we derive the
corresponding small-signal model here. For transistors operating as switches, a linear resistor given by
(2.11) together with device capacitances serves as a rough small-signal equivalent.
We derive the small-signal model by producing a small increment in one bias parameter and calculating
the resulting increment in other bias parameters. Speciﬁcally, we (1) apply certain bias voltages to the
terminals of the device, (2) increment the potential difference between two of the terminals while other
terminal voltages remain constant, and (3) measure the resulting change in all terminal currents. If we
change the voltage between two terminals by V and measure a current change of I in some branch,
we can model the effect by a voltage-dependent current source. Let us apply a change to the gate-source
voltage, V = VGS, where VGS is a small-signal quantity.10 The drain current therefore changes by
gmVGS and is modeled by a voltage-dependent current source tied between the drain and source terminals
[Fig. 2.37(a)]. The gate current is very small and its change is negligible, thus requiring no representation
here. The result is the small-signal model of an ideal MOSFET—the model that an analog designer applies
to most devices in a circuit at ﬁrst glance.
Owing to channel-length modulation, the drain current also varies with the drain-source voltage. This
effect can be modeled by a voltage-dependent current source [Fig. 2.37(b)], but a current source whose
value linearly depends on the voltage across it is equivalent to a linear resistor [Fig. 2.37(c)] (why?). Tied
between D and S, the resistor is given by
rO = ∂VDS
∂ID
(2.44)
=
1
∂ID/∂VDS
(2.45)
=
1
1
2μnCox
W
L (VGS −VTH)2 · λ
(2.46)
10In this book, we use uppercase letters to denote large-signal or small-signal quantities. The distinction will be clear from
the context.

32
Chap. 2
Basic MOS Device Physics
gmVGS
G
S
D
gmVGS
VGS
VGS
VGS
G
S
D
αVDS
gmVGS
G
S
D
rO
rO
gmVGS
gmbVBS
Vgs
G
S
D
VB
VBS
(a)
(b)
(c)
(d)
Figure 2.37
(a) Basic MOS small-signal model; (b) channel-length modulation represented by a dependent
current source; (c) channel-length modulation represented by a resistor; (d) body effect represented by a dependent
current source.
≈1 + λVDS
λID
(2.47)
≈
1
λID
(2.48)
where it is assumed that λVDS ≪1. As seen throughout this book, the output resistance, rO, affects the
performanceofmanyanalogcircuits.Forexample,rO limitsthemaximumvoltagegainofmostampliﬁers.
Now recall that the bulk potential inﬂuences the threshold voltage and hence the gate-source overdrive.
As demonstrated in Example 2.3, with all other terminals held at a constant voltage, the drain current
is a function of the bulk voltage. That is, the bulk behaves as a second gate. Modeling this dependence
by a current source connected between D and S [Fig. 2.37(d)], we write the value as gmbVbs, where
gmb = ∂ID/∂VBS. In the saturation region, gmb can be expressed as
gmb = ∂ID
∂VBS
(2.49)
= μnCox
W
L (VGS −VTH)

−∂VTH
∂VBS

(2.50)
We also have
∂VTH
∂VBS
= −∂VTH
∂VSB
(2.51)
= −γ
2 (2F + VSB)−1/2
(2.52)
Thus,
gmb = gm
γ
2√2F + VSB
(2.53)
= ηgm
(2.54)

Sec. 2.4
MOS Device Models
33
where η = gmb/gm and is typically around 0.25. As expected, gmb is proportional to γ . Equation (2.53)
also suggests that the incremental body effect becomes less pronounced as VSB increases. Note that gmVGS
and gmbVBS have the same polarity, i.e., raising the gate voltage has the same effect as raising the bulk
potential.
The model in Fig. 2.37(d) is adequate for most low-frequency small-signal analyses. In reality, each
terminal of a MOSFET exhibits a ﬁnite ohmic resistance resulting from the resistivity of the material (and
the contacts), but proper layout can minimize such resistances. For example, consider the two structures
of Fig. 2.33, repeated in Fig. 2.38 along with the gate distributed resistance. We note that folding reduces
the gate resistance by a factor of four.
(a)
(b)
W
W
2
RG
RG
2
RG
2
Figure 2.38
Reduction of gate resis-
tance by folding.
Shown in Fig. 2.39, the complete small-signal model includes the device capacitances as well. The
value of each capacitance is calculated according to the equations derived in Sec. 2.4.2. The reader may
wonder how a complex circuit is analyzed intuitively if each transistor must be replaced by the model
of Fig. 2.39. The ﬁrst step is to determine the simplest device model that can represent the role of each
transistor with reasonable accuracy. We provide some guidelines for this task at the end of Chapter 3.
gmVGS
VGS
G
S
D
rO
gmbVBS
VBS
CGD
CGS
CSB
CDB
CGB
B
Figure 2.39
Complete MOS small-signal model.
▲
Example2.12
Sketch gm and gmb of M1 in Fig. 2.40 as a function of the bias current I1.
Solution
Since gm = √2μnCox(W/L)ID, we have gm ∝√I1. The dependence of gmb upon I1 is less straightforward. As I1
increases, VX decreases, and so does VSB.

34
Chap. 2
Basic MOS Device Physics
M1
VDD
I1
(a)
(b)
X
I1
gm
gmb
Figure 2.40
▲
PMOS Small-Signal Model
The derivation of the small-signal model seeks changes in the terminal
currents due to changes in the terminal voltage differences. As such, this derivation yields exactly the
same model for PMOS devices as for NMOS devices. For example, consider the arrangement shown in
Fig. 2.41(a), where the voltage source V1 is changed by a small amount and the change in ID is measured
(while M1 remains in saturation). Suppose V1 becomes more positive, making VGS more negative. Since
the transistor now has a greater overdrive, it carries a higher current, and hence ID becomes more negative.
(Recall that ID, in the direction shown here, is negative because the actual current of holes ﬂows from
the source to the drain.) Thus, a negative VGS leads to a negative ID. Conversely, a positive VGS
produces a positive ID, as is the case for an NMOS device.
VDD
V1
ID
M1
Gate
Source
Drain
VD
V1
(a)
(b)
Figure 2.41
(a) Small-signal test of
a PMOS device, and (b) small-signal
model.
In our circuit diagrams, we usually draw the PMOS devices with their source terminals on top and
their drain terminals on the bottom because the former are at a more positive voltage. This practice may
cause confusion in drawing small-signal models. Let us draw the small-signal equivalent of the above
circuit, assuming no channel-length modulation. Depicted in Fig. 2.41(b), the model shows the voltage-
dependent current source pointing upward, giving the (wrong) impression that the direction of the current
in the PMOS model is the opposite of that in the NMOS model. The reader is cautioned to avoid this
confusion and bear in mind that the small-signal models of NMOS and PMOS transistors are identical.
Unless otherwise stated, in this book we assume that the bulk of all NFETs is tied to the most negative
supply (usually the ground) and that of PFETs to the most positive supply (usually VDD).
2.4.4 MOS SPICE models
In order to represent the behavior of transistors in circuit simulations, simulators such as SPICE and
Cadence require an accurate model for each device. Over the last three decades, MOS modeling has
made tremendous progress, reaching sophisticated levels so as to represent high-order effects in short-
channel devices.
In this section, we describe the simplest MOS SPICE model, known as “Level 1,” and provide typical
values for each parameter in the model corresponding to a 0.5-μm technology. Chapter 17 describes

Sec. 2.4
MOS Device Models
35
more accurate SPICE models. Table 2.1 shows the model parameters for NMOS and PMOS devices. The
parameters are deﬁned as follows:
Table 2.1
Level 1 SPICE models for NMOS and PMOS devices.
NMOS Model
LEVEL = 1
VTO = 0.7
GAMMA = 0.45
PHI = 0.9
NSUB = 9e+14
LD = 0.08e−6
UO = 350
LAMBDA = 0.1
TOX = 9e−9
PB = 0.9
CJ = 0.56e−3
CJSW = 0.35e−11
MJ = 0.45
MJSW = 0.2
CGDO = 0.4e−9
JS = 1.0e−8
PMOS Model
LEVEL = 1
VTO = −0.8
GAMMA = 0.4
PHI = 0.8
NSUB = 5e+14
LD = 0.09e−6
UO = 100
LAMBDA = 0.2
TOX = 9e−9
PB = 0.9
CJ = 0.94e−3
CJSW = 0.32e−11
MJ = 0.5
MJSW = 0.3
CGDO = 0.3e−9
JS = 0.5e−8
VTO: threshold voltage with zero VSB (unit: V)
GAMMA: body-effect coefﬁcient (unit: V1/2)
PHI: 2F (unit: V)
TOX: gate-oxide thickness (unit: m)
NSUB: substrate doping (unit: cm−3)
LD: source/drain side diffusion (unit: m)
UO: channel mobility (unit: cm2/V/s)
LAMBDA: channel-length modulation coefﬁcient (unit: V−1)
CJ: source/drain bottom-plate junction capacitance per unit area (unit: F/m2)
CJSW: source/drain sidewall junction capacitance per unit length (unit: F/m)
PB: source/drain junction built-in potential (unit: V)
MJ: exponent in CJ equation (unitless)
MJSW: exponent in CJSW equation (unitless)
CGDO: gate-drain overlap capacitance per unit width (unit: F/m)
CGSO: gate-source overlap capacitance per unit width (unit: F/m)
JS: source/drain leakage current per unit area (unit: A/m2)
2.4.5 NMOS Versus PMOS Devices
In most CMOS technologies, PMOS devices are quite inferior to NMOS transistors. For example, due
to the lower mobility of holes, μpCox ≈0.5μnCox, yielding low current drive and transconductance.
Moreover, for given dimensions and bias currents, NMOS transistors exhibit a higher output resistance,
providing more ideal current sources and higher gain in ampliﬁers. For these reasons, incorporating
NFETs rather than PFETs wherever possible is preferred.11
2.4.6 Long-Channel Versus Short-Channel Devices
In this chapter, we have employed a very simple view of MOSFETs so as to understand the basic principles
of their operation. Most of our treatment is valid for “long-channel” devices, e.g., transistors having a
minimum length of a few microns. Many of the relationships derived here must be reexamined and revised
for short-channel MOSFETs. Furthermore, the SPICE models necessary for simulation of today’s devices
11One exception is when ﬂicker noise is critical (Chapter 7).

36
Chap. 2
Basic MOS Device Physics
are much more sophisticated than the Level 1 model. For example, the intrinsic gain, gmrO, calculated
from the device parameters in Table 2.1 is much higher than actual values. These issues are studied in
Chapter 17.
The reader may wonder why we begin with a simplistic view of devices if such a view does not lead to
high accuracy in predicting the performance of circuits. The key point is that the simple model provides
a great deal of intuition that is necessary in analog design. As we will see throughout this book, we often
encounter a trade-off between intuition and rigor, and our approach is to establish the intuition ﬁrst and
gradually complete our understanding so as to achieve rigor as well.
2.5
Appendix A: FinFETs
New CMOS technology generations (“nodes”) have migrated from the two-dimensional transistor struc-
ture to a three-dimensional geometry called the “FinFET.” This device exhibits superior performance
as channel lengths fall below approximately 20 nm. In fact, FinFET I/V characteristics are closer to
square-law behavior, making our simple large-signal mode relevant again.
Shown in Fig. 2.42(a), the FinFET consists of a vertical silicon “ﬁn,” a dielectric (e.g., oxide) layer
deposited over the ﬁn, and a polysilicon or metal gate created over the dielectric layer. Controlled by the
gate voltage, the current ﬂows from one end of the ﬁn to the other. The top view looks similar to that of
a planar MOSFET [Fig. 2.42(b)].
Source
Drain
Gate
Substrate
Oxide
WF
Gate
Length
HF
Drain
Source
Gate
(a)
(b)
Figure 2.42
(a) FinFET structure, and (b) top view.
As depicted in Fig. 2.42(a), the gate length can be readily identiﬁed, but how about the gate width?
We note that the current ﬂows on three facets of the ﬁn. The equivalent channel width is therefore equal
to the sum of the ﬁn’s width, WF, and twice its height, HF: W = WF + 2HF. Typically, WF ≈6 nm and
HF ≈50 nm.
Since HF is not under the circuit designer’s control, it appears that WF can be chosen so that WF +2HF
yields the desired transistor width. However, WF affects device imperfections such as source and drain
series resistance, channel-length modulation, subthreshold conduction, etc. For this reason, the ﬁn width
is also ﬁxed, dictating discrete values for the transistor width. For example, if WF +2HF = 100 nm, then
wider transistors can be obtained only by increasing the number of ﬁns and only in 100-nm increments
(Fig. 2.43). The spacing between the ﬁns, SF, also plays a signiﬁcant role in the performance and is
typically ﬁxed.
Due to the small dimensions of the intrinsic FinFET, the gate and S/D contacts must be placed away
from the core of the device. Figure 2.44 shows the details for a single- and a double-ﬁn structure.

Sec. 2.6
Appendix B: Behavior of a MOS Device as a Capacitor
37
Gate
Drain
Source
SF
Figure 2.43
FinFET with multiple ﬁns.
Figure 2.44
Layout of single- and
double-ﬁn transistors.
2.6
Appendix B: Behavior of a MOS Device as a Capacitor
In this chapter, we have limited our treatment of MOS devices to a basic level. However, the behavior of
a MOSFET as a capacitor merits some attention. Recall that if the source, drain, and bulk of an NFET
are grounded and the gate voltage rises, an inversion layer begins to form for VGS ≈VTH. We also noted
that for 0 < VGS < VTH, the device operates in the subthreshold region.
Now consider the NFET of Fig. 2.45. The transistor can be considered a two-terminal device, and
hence its capacitance can be examined for different gate voltages. Let us begin with a very negative
gate-source voltage. The negative potential on the gate attracts the holes in the substrate to the oxide
interface. We say that the MOSFET operates in the “accumulation” region. The two-terminal device can
be viewed as a capacitor having a unit-area capacitance of Cox because the two “plates” of the capacitor
are separated by tox.
n+
n+
p−substrate
VG
+
VG < 0
Holes
+ + + +
+ + + +
Figure 2.45
NMOS operating in
accumulation mode.
As VGS rises, the density of holes at the interface falls, a depletion region begins to form under the oxide,
and the device enters weak inversion. In this mode, the capacitance consists of the series combination of
Cox and Cdep. Finally, as VGS exceeds VTH, the oxide-silicon interface sustains a channel and the unit-area
capacitance returns to Cox. Figure 2.46 plots the behavior.

38
Chap. 2
Basic MOS Device Physics
VGS
CGS
0 VTH
Accumulation
Strong Inversion
Figure 2.46
Capacitance-voltage
characteristic of an NMOS device.
References
[1] R. S. Muller and T. I. Kamins, Device Electronics for Integrated Circuits, 2nd ed. (New York: Wiley, 1986).
[2] Y. Tsividis, Operation and Modeling of the MOS Transistor, 2nd ed. (Boston: McGraw-Hill, 1999).
[3] Y. Taur and T. H. Ning, Fundamentals of Modern VLSI Devices (New York: Cambridge University Press, 1998).
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume VDD = 3 V
where necessary.
2.1.
For W/L = 50/0.5, plot the drain current of an NFET and a PFET as a function of |VGS| as |VGS| varies from
0 to 3 V. Assume that |VDS| = 3 V.
2.2.
For W/L = 50/0.5 and |ID| = 0.5 mA, calculate the transconductance and output impedance of both NMOS
and PMOS devices. Also, ﬁnd the “intrinsic gain,” deﬁned as gmrO.
2.3.
Derive expressions for gmrO in terms of ID and W/L. Plot gmrO as a function of ID with L as a parameter.
Note that λ ∝1/L.
2.4.
Plot ID versus VGS for a MOS transistor (a) with VDS as a parameter, and (b) with VBS as a parameter. Identify
the break points in the characteristics.
2.5.
Sketch IX and the transconductance of the transistor as a function of VX for each circuit in Fig. 2.47 as VX
varies from 0 to VDD. In part (a), assume that VX varies from 0 to 1.5 V.
VDD
VX
VX
VX
VX
VX
IX
IX
IX
IX
IX
M1
M1
M1
M1
M1
+1.9 V
+1 V
+1 V
+1.9 V
+1 V
+1.9 V
+1.9 V
+1 V
+1.5 V
(c)
(a)
(b)
(d)
(e)
Figure 2.47

Problems
39
2.6.
Sketch IX and the transconductance of the transistor as a function of VX for each circuit in Fig. 2.48 as VX
varies from 0 to VDD.
M1
M1
M1
VX
VX
VX
VX
R1
R2
R1
R1
R2
VDD
VDD
VDD
IX
IX
IX
IX
M1
I1
R1
+2 V
+2 V
I1
M1
I1
VX
R1
IX
(c)
(a)
(b)
(d)
(e)
Figure 2.48
2.7.
Sketch Vout as a function of Vin for each circuit in Fig. 2.49 as Vin varies from 0 to VDD.
M1
Vin
M1
+1 V
(c)
(a)
(b)
(d)
R1
Vout
+3 V
M1
Vin
R1
Vout
+1 V
Vin
R1
Vout
M1
R1
Vout
Vin
+2 V
Figure 2.49

40
Chap. 2
Basic MOS Device Physics
2.8.
Sketch Vout as a function of Vin for each circuit in Fig. 2.50 as Vin varies from 0 to VDD.
VDD
M1
M1
+1 V
(c)
(a)
(b)
Vin
I1
Vout
R1
VDD
Vout
+2 V
Vin
M1
R1
Vout
+2 V
+2 V
Vin
Figure 2.50
2.9.
Sketch VX and IX as a function of time for each circuit in Fig. 2.51. The initial voltage of C1 is equal to 3 V.
In part (e), assume that the switch turns off at t = 0.
(c)
(a)
(b)
(d)
(e)
M1
Vb
C1
VX
IX
M1
C1
VX
IX
VDD
C1
M1
Vb
VX
M1
Vb
C1
VX
I1
IX
IX
M1
Vb
C1
VX
I1
IX
Figure 2.51
2.10. Sketch VX and IX as a function of time for each circuit in Fig. 2.52. The initial voltage of each capacitor is
shown.
(c)
(a)
(b)
M1
C1
VX
IX
I1
C2
M1
C1
VX
X
C2
I
+2 V
M1
C1
VX
C2
+2 V
IX
Figure 2.52

Problems
41
2.11. Sketch VX as a function of time for each circuit in Fig. 2.53. The initial voltage of each capacitor is shown.
(c)
(a)
(b)
(d)
M1
M1
C1
VX
M1
C1
VX
C1
0
+3
Vin
0
+3
Vin
VDD
C1
M1
VX
0
+3
Vin
0
+3
Vin
VDD
1 V
1 V
2 V
VX
3 V
Figure 2.53
2.12. Sketch VX as a function of time for each circuit in Fig. 2.54. The initial voltage of each capacitor is shown.
(c)
(a)
(b)
(d)
M1
C1
VDD
0
+3
Vin
VX
M1
0
+3
Vin
C1
VX
VDD
M1
0
+3
Vin
C1
VDD
VX
M1
0
+3
Vin
C1
C2
VX
3 V
3 V
3 V
3 V
3 V
Figure 2.54
2.13. The transit frequency, fT , of a MOSFET is deﬁned as the frequency at which the small-signal current gain of
the device drops to unity while the source and drain terminals are held at ac ground.
(a) Prove that
fT =
gm
2π(CGD + CGS)
(2.55)

42
Chap. 2
Basic MOS Device Physics
Note that fT does not include the effect of the S/D junction capacitance.
(b) Suppose the gate resistance, RG, is signiﬁcant and the device is modeled as a distributed set of n transistors,
each with a gate resistance equal to RG/n. Prove that the fT of the device is independent of RG and still equal
to the value given above.
(c) For a given bias current, the minimum allowable drain-source voltage for operation in saturation can
be reduced only by increasing the width and hence the capacitances of the transistor. Using square-law
characteristics, prove that
fT = μn
2π
VGS −VTH
L2
(2.56)
This relation indicates how the speed is limited as a device is designed to operate with lower supply voltages.
2.14. Calculate the fT of a MOS device in the subthreshold region and compare the result with that obtained in
Prob. 2.13.
2.15. For a saturated NMOS device having W = 50 μm and L = 0.5 μm, calculate all the capacitances. Assume
that the minimum (lateral) dimension of the S/D areas is 1.5 μm and that the device is folded as shown in
Fig. 2.33(b). What is the fT if the drain current is 1 mA?
2.16. Consider the structure shown in Fig. 2.55. Determine ID, as a function of VGS and VDS, and prove that the
structure can be viewed as a single transistor having an aspect ratio W/(2L). Assume that λ = γ = 0.
VGS
VDS
W
L
W
L
Figure 2.55
2.17. For an NMOS device operating in saturation, plot W/L versus VGS −VTH if (a) ID is constant, and
(b) gm is constant.
2.18. Explain why the structures shown in Fig. 2.56 cannot operate as current sources even though the transistors
are in saturation.
I1
VDD
I2
(a)
(b)
Figure 2.56
2.19. Considering the body effect as “back-gate effect,” explain intuitively why γ is directly proportional to √Nsub
and inversely proportional to Cox.
2.20. A “ring” MOS structure is shown in Fig. 2.57. Explain how the device operates and estimate its equivalent
aspect ratio. Compare the drain junction capacitance of this structure with that of the devices shown in Fig. 2.33.
2.21. Suppose we have received an NMOS transistor in a package with four unmarked pins. Describe the minimum
number of dc measurement steps using an ohmmeter that is necessary to determine the gate, source/drain, and
bulk terminals of the device.
2.22. Repeat Prob. 2.21 if the type of the device (NFET or PFET) is not known.
2.23. For an NMOS transistor, the threshold voltage is known, but μnCox and W/L are not. Assume that λ = γ = 0.
If we cannot measure Cox independently, is it possible to devise a sequence of dc measurement tests to
determine μnCox and W/L? What if we have two transistors and we know that one has twice the aspect
ratio of the other?

Problems
43
Gate
W
L
Drain
Source
Figure 2.57
2.24. Sketch IX versus VX for each of the composite structures shown in Fig. 2.58 with VG as a parameter. Also,
sketch the equivalent transconductance. Assume that λ = γ = 0.
(a)
(b)
VX
VX
IX
IX
VG
VG
Figure 2.58
2.25. An NMOS current source with ID = 0.5 mA must operate with drain-source voltages as low as 0.4 V. If the
minimum required output impedance is 20 k, determine the width and length of the device. Calculate the
gate-source, gate-drain, and drain-substrate capacitance if the device is folded as in Fig. 2.33 and E = 3 μm.
2.26. Consider the circuit shown in Fig. 2.59, where the initial voltage at node X is equal to VDD. Assuming that
λ = γ = 0 and neglecting other capacitances, plot VX and VY versus time if (a) Vin is a positive step with
amplitude V0 > VTH, and (b) Vin is a negative step with amplitude V0 = VTH.
VDD
I1
C1
C2
X
Y
Vin
Figure 2.59
2.27. An NMOS device operating in the subthreshold region has a ζ of 1.5. What variation in VGS results in a tenfold
change in ID? If ID = 10 μA, what is gm?

44
Chap. 2
Basic MOS Device Physics
2.28. Consider an NMOS device with VG = 1.5 V and VS = 0. Explain what happens if we continually decrease
VD below zero or increase Vsub above zero.
2.29. Consider the arrangement shown in Fig. 2.60. Explain what happens to the pinch-off point as VG increases.
VG
M1
1.2 V 
Figure 2.60
2.30. From Fig. 2.20, plot ID vs. VGS −VTH if W/L is constant, VGS −VTH vs. ID if W/L is constant, and W/L
vs. VGS −VTH if ID is constant.
2.31. Plotted in Fig. 2.61 are the charactersitics of a square-law NMOS device with W/Ldrawn = 5 μm/40 nm and
tox = 18 A
◦. Here, VGS is incremented in equal steps. Estimate μn, VTH, λ, and the VGS steps.
0
0.2
0.4
0.6
0.8
1
0
0.5
1
1.5
2
2.5
3
3.5
VDS (V)
ID (mA)
Figure 2.61

CHAPTER
3
Single-Stage Ampliﬁers
Ampliﬁcation is an essential function in most analog (and many digital) circuits. We amplify an analog
or digital signal because it may be too small to drive a load, overcome the noise of a subsequent stage,
or provide logical levels to a digital circuit. Ampliﬁcation also plays a critical role in feedback systems
(Chapter 8).
In this chapter, we study the low-frequency behavior of single-stage CMOS ampliﬁers. Analyzing
both the large-signal and the small-signal characteristics of each circuit, we develop intuitive techniques
and models that prove useful in understanding more complex systems. An important part of a designer’s
job is to use proper approximations so as to create a simple mental picture of a complicated circuit. The
intuition thus gained makes it possible to formulate the behavior of most circuits by inspection rather
than by lengthy calculations.
Following a brief review of basic concepts, we describe in this chapter four types of ampliﬁers:
common-source and common-gate topologies, source followers, and cascode conﬁgurations. In each
case, we begin with a simple model and gradually add second-order phenomena such as channel-length
modulation and body effect.
3.1
Applications
Do you carry an ampliﬁer? In all likelihood, yes. Your mobile phone, laptop, and digital camera all
incorporate various types of ampliﬁers. The receiver in your phone must sense and amplify small signals
received by the antenna, thus requiring a “low-noise” ampliﬁer (LNA) at the front end (Fig. 3.1). As the
signal travels down the receive chain, it must be further ampliﬁed by additional stages so as to reach an
acceptably high level. This proves difﬁcult because, in addition to the small desired signal, the antenna
picks up other strong signals (“interferers”) that are transmitted by various other users in the same vicinity.
Your phone’s transmitter, too, employs ampliﬁers: to amplify the signal generated by the microphone and,
eventually, the signal delivered to the antenna. The “power ampliﬁer” (PA) necessary for such delivery
draws the most energy from the battery and still presents interesting challenges.
3.2
General Considerations
An ideal ampliﬁer generates an output, y(t), that is a linear replica of the input, x(t):
y(t) = α1x(t)
(3.1)
45

46
Chap. 3
Single-Stage Ampliﬁers
PA
Downconverter
Amplifying Stages
Upconverter
LNA
Receiver
Antenna
Mike
Transmitter
f
Interferer
Desired
Signal
Figure 3.1
General RF transceiver.
where α1 denotes the gain. Since the output signal is in fact superimposed on a bias (dc operating) point,
α0, we can write the overall output as y(t) = α0 + α1x(t). In this case, the input-output (large-signal)
characteristic of the circuit is a straight line [Fig. 3.2(a)]. However, as the signal excursions become larger
and the bias point of the transistor(s) is disturbed substantially, the gain (the slope of the characteristic)
begins to vary [Fig. 3.2(b)]. We approximate this nonlinear characteristic by a polynomial:
y(t) = α0 + α1x(t) + α2x2(t) + · · · + αnxn(t)
(3.2)
A nonlinear ampliﬁer distorts the signal of interest or creates unwanted interactions among several signals
that may coexist at the input. We return to the problem of nonlinearity in Chapter 14.
x
y
x1
x2
(a)
(b)
x
y
 α0 
 α1
Figure 3.2
Input-output characteristic of a (a) linear and (b) nonlinear system.
What aspects of the performance of an ampliﬁer are important? In addition to gain and speed, such
parameters as power dissipation, supply voltage, linearity, noise, or maximum voltage swings may be
important. Furthermore, the input and output impedances determine how the circuit interacts with the
preceding and subsequent stages. In practice, most of these parameters trade with each other, making the
design a multidimensional optimization problem. Illustrated in the “analog design octagon” of Fig. 3.3,
such trade-offs present many challenges in the design of high-performance ampliﬁers, requiring intuition
and experience to arrive at an acceptable compromise.
Table 3.1 gives a preview of the ampliﬁer topologies studied in this chapter, indicating the much wider
use of the common-source (CS) stage than other circuit conﬁgurations. For these ampliﬁers, we must (1)
set up proper bias conditions so that each transistor provides the necessary transconductance and output
resistance with certain quiescent currents and voltages, and (2) analyze the circuit’s behavior as the input
and output signals cause small or large departures from the bias input (small-signal and large-signal
analyses, respectively). We deal with the latter task here and defer the former to Chapter 5.

Sec. 3.3
Common-Source Stage
47
Noise
Linearity
Gain
Voltage
Swings
Power
Dissipation
Supply
Voltage
Speed
Input/Output
Impedance
Figure 3.3
Analog design octagon.
Table 3.1
Ampliﬁer categories.
Common-Source Stage
Source Follower
Common-Gate Stage
Cascode
With Resistive Load
With Resistive Bias
With Resistive Load
Telescopic
With Diode-Connected Load
With Current-Source Bias
With Current-Source Load
Folded
With Current-Source Load
With Active Load
With Source Degeneration
3.3
Common-Source Stage
3.3.1 Common-Source Stage with Resistive Load
By virtue of its transconductance, a MOSFET converts changes in its gate-source voltage to a small-signal
drain current, which can pass through a resistor to generate an output voltage. Shown in Fig. 3.4(a), the
common-source stage performs such an operation.1 We study both the large-signal and the small-signal
behavior of the circuit. Note that the input impedance of the circuit is very high at low frequencies.
If the input voltage increases from zero, M1 is off and Vout = VDD [Fig. 3.4(b)]. As Vin approaches
VT H, M1 begins to turn on, drawing current from RD and lowering Vout. Transistor M1 turns on in
saturation regardless of the values of VDD and RD (why?), and we have
Vout = VDD −RD
1
2μnCox
W
L (Vin −VT H)2
(3.3)
where channel-length modulation is neglected. With further increase in Vin, Vout drops more, and the tran-
sistor continues to operate in saturation until Vin exceeds Vout by VT H [point A in Fig. 3.4(b)]. At this point,
Vin1 −VT H = VDD −RD
1
2μnCox
W
L (Vin1 −VT H)2
(3.4)
from which Vin1 −VT H and hence Vout can be calculated.
For Vin > Vin1, M1 is in the triode region:
Vout = VDD −RD
1
2μnCox
W
L

2(Vin −VT H)Vout −V 2
out

(3.5)
1The common-source topology is identiﬁed as receiving the input at the gate and producing the output at the drain.

48
Chap. 3
Single-Stage Ampliﬁers
M1
M1
RD
Vout
VTH
VDD
Vin
Vin1
Vin
Vout
VTH
M1
RD
Vout
Vin
Ron
VDD
(c)
(a)
(b)
(d)
VDD
A
RD
Vout
V1
Vin
gmV1
Figure 3.4
(a) Common-source stage, (b) input-output characteristic, (c) equivalent circuit in the deep triode
region, and (d) small-signal model for the saturation region.
If Vin is high enough to drive M1 into the deep triode region, Vout ≪2(Vin −VT H), and, from the
equivalent circuit of Fig. 3.4(c),
Vout = VDD
Ron
Ron + RD
(3.6)
=
VDD
1 + μnCox
W
L RD(Vin −VT H)
(3.7)
Since the transconductance drops in the triode region, we usually ensure that Vout > Vin −VT H, and
hence the current operates to the left of point A in Fig. 3.4(b). Using (3.3) as the input-output characteristic
and viewing its slope as the small-signal gain, we have
Av = ∂Vout
∂Vin
(3.8)
= −RDμnCox
W
L (Vin −VT H)
(3.9)
= −gm RD
(3.10)
This result can be directly derived from the observation that M1 converts an input voltage change Vin
to a drain current change gmVin, and hence an output voltage change −gm RDVin. The small-signal
model of Fig. 3.4(d) yields the same result: Vout = −gmV1RD = −gmVin RD. Note that, as mentioned in
Chapter 2, Vin, V1, and Vout in this ﬁgure denote small-signal quantities.
Even though derived for small-signal operation, the equation Av = −gm RD predicts certain effects
if the circuit senses a large signal swing. Since gm itself varies with the input signal according to

Sec. 3.3
Common-Source Stage
49
gm = μnCox(W/L)(VGS −VT H), the gain of the circuit changes substantially if the signal is large. In
other words, if the gain of the circuit varies signiﬁcantly with the signal swing, then the circuit operates in
the large-signal mode. The dependence of the gain upon the signal level leads to nonlinearity (Chapter 14),
usually an undesirable effect.
A key result here is that to minimize the nonlinearity, the gain equation must be a weak function of
signal-dependent parameters such as gm. We present several examples of this concept in this chapter and
in Chapter 14.
▲
Example3.1
Sketch the drain current and transconductance of M1 in Fig. 3.4(a) as a function of the input voltage.
Nanometer Design Notes
How does the CS stage behave in
nanometer technologies? The ﬁgure
plots the simulated input-output char-
acteristic for W/L
=
2 μm/40 nm,
RD = 2 k, and VDD = 1 V. We observe
that the circuit provides a gain of about
3 in the input range of 0.4 V to 0.6 V. The
output swing is limited to about 0.3 V–0.8
V for the gain not to drop signiﬁcantly.
0
0.2
0.4
0.6
0.8
1
0
0.2
0.4
0.6
0.8
1
Vin (V)
Vout (V)
Solution
The drain current becomes signiﬁcant for Vin > VT H, eventually approaching
VDD/RD if Ron1 ≪RD [Fig. 3.5(a)]. Since in saturation, gm = μnCox(W/L)(Vin −
VT H), the transconductance begins to rise for Vin > VT H. In the triode region,
gm = μnCox(W/L)VDS, falling as Vin exceeds Vin1 [Fig. 3.5(b)]. Starting with
Eq. (3.5), the reader can show that
Av = ∂Vout
∂Vin
=
−μnCox(W/L)RDVout
1 + μnCox(W/L)RD(Vin −VT H −Vout)
(3.11)
which reaches a maximum if Vout = Vin −VT H (point A).
(b)
(a)
VTH
Vin
VDD
RD
ID
VTH
Vin
Vin1
gm
A
Figure 3.5
▲
▲
Example3.2
A CS stage is driven by a sinusoid, Vin = V1 cos ω1t + V0, where V0 is the bias value and V1 is large enough to drive
the transistor into the off and triode regions. Sketch the gm of the transistor as a function of time.
Solution
Let us ﬁrst sketch the output voltage (Fig. 3.6), noting that when Vin = V1 + V0, Vout is low, M1 is in the triode region,
and gm assumes a small value. As Vin falls and Vout and gm rise, M1 enters saturation at t = t1 (when Vin −Vout =
VT H) and gm reaches its maximum (why?). As Vin falls further, so do ID and gm. At t = t2, gm reaches zero.
We observe that (a) since the voltage gain is approximately equal to −gm RD, it experiences the same variation
as the gm, and (b) gm varies periodically.2
2We even express gm as a Fourier series in more advanced courses.

50
Chap. 3
Single-Stage Ampliﬁers
+
VDD
RD
Vout
gm
Vout
M1
t1
t2
Vin
Vin
V1
t
t
t
V0
V0
Figure 3.6
▲
How do we maximize the voltage gain of a common-source stage? Writing (3.10) as
Av = −

2μnCox
W
L ID
VRD
ID
(3.12)
where VRD denotes the voltage drop across RD, we have
Av = −

2μnCox
W
L
VRD
√ID
(3.13)
Thus,themagnitudeof Av canbeincreasedbyincreasing W/L or VRD ordecreasing ID ifotherparameters
are constant. It is important to understand the trade-offs resulting from this equation. A larger device size
leads to greater device capacitances, and a higher VRD limits the maximum voltage swings. For example,
if VDD −VRD = Vin −VT H, then M1 is at the edge of the triode region, allowing only very small swings at
the output (and input). If VRD remains constant and ID is reduced, then RD must increase, thereby leading
to a greater time constant at the output node. In other words, as noted in the analog design octagon, the
circuit exhibits trade-offs between gain, bandwidth, and voltage swings. Lower supply voltages further
tighten these trade-offs.
For large values of RD, the effect of channel-length modulation in M1 becomes signiﬁcant. Modifying
(3.3) to include this effect,
Vout = VDD −RD
1
2μnCox
W
L (Vin −VT H)2(1 + λVout)
(3.14)
we have
∂Vout
∂Vin
= −RDμnCox
W
L (Vin −VT H)(1 + λVout)
−RD
1
2μnCox
W
L (Vin −VT H)2λ∂Vout
∂Vin
(3.15)

Sec. 3.3
Common-Source Stage
51
We recognize that (1/2)μnCox(W/L)(Vin −VT H)2λ = 1/rO and
Av = −RDgm −RD
rO
Av
(3.16)
Thus,
Av = −gm
rO RD
rO + RD
(3.17)
The small-signal model of Fig. 3.7 gives the same result with much less effort. That is, since
gmV1(rO∥RD) = −Vout and V1 = Vin, we have Vout/Vin = −gm(rO∥RD).
RD
Vout
Vin
V1
r0
gmV1
Figure 3.7
Small-signal model of
CS stage including the transistor output
resistance.
▲
Example3.3
Assuming that M1 in Fig. 3.8 is biased in saturation, calculate the small-signal voltage gain of the circuit.
VDD
I1
Vout
M1
Vin
Figure 3.8
Solution
Since I1 introduces an inﬁnite impedance (RD = ∞), the gain is limited by the output resistance of M1:
Av = −gmrO
(3.18)
Called the “intrinsic gain” of a transistor, this quantity represents the maximum voltage gain that can be achieved
using a single device. In today’s CMOS technology, gmrO of short-channel devices is between roughly 5 and 10.
We usually assume 1/gm ≪rO.
In Fig. 3.8, Kirchhoff’s current law (KCL) requires that ID1 = I1. Then, how can Vin change the current of M1
if I1 is constant? Writing the total drain current of M1 as
ID1 = 1
2μnCox
W
L (Vin −VT H)2(1 + λVout)
(3.19)
= I1
(3.20)
we note that Vin appears in the square term and Vout in the linear term. As Vin increases, Vout must decrease such
that the product remains constant. We may nevertheless say “ID1 increases as Vin increases.” This statement simply
refers to the quadratic part of the equation.
▲

52
Chap. 3
Single-Stage Ampliﬁers
An important conclusion here is that, to maximize the voltage gain, we must maximize the (small-
signal) load impedance. Why can we not replace the load with an open circuit? This is because the circuit
still needs a path from VDD to ground for the bias current of M1.
▲
Example3.4
It is possible to use the bulk (back gate) of a MOSFET as the terminal controlling the channel. Shown in Fig. 3.9 is
an example. Determine the voltage gain if λ = 0.
VDD
RD
Vb
Vout
M1
Vin
Figure 3.9
Solution
From the small-signal MOS model developed in Chapter 2, we recall that the drain
current is given by gmbVin. Thus, Av = −gmb RD.
▲
Nanometer Design Notes
How do we design a CS stage for a
given gain and supply voltage? With
W/L, I D, and RD under our control, we
seem to have a wide design space. A
good starting point is to choose a small
device, W/L = 0.5 μm/40 nm, a low
bias current, I D = 50 μA, and a sufﬁ-
ciently large load resistance to achieve
the required gain. To this end, we use
simulations to plot the transconductance
of such a device as a function of I D,
obtaining gm = 0.45 mS. Thus, for a
voltage gain of , say, 10, RD must reach
22.2 k if λ = 0. Is this an acceptable
design? The answer depends on the
application. In addition to gain, the cir-
cuit must also satisfy certain bandwidth,
noise, and output swing requirements.
0
0.05
0.1
0.15
0.2
0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
ID (mA)
gm (mS)
3.3.2 CS Stage with Diode-Connected Load
In some CMOS technologies, it is difﬁcult to fabricate resistors with tightly-
controlled values or a reasonable physical size (Chapter 19). Consequently, it
is desirable to replace RD in Fig. 3.4(a) with a MOS transistor.
A MOSFET can operate as a small-signal resistor if its gate and drain are
shorted [Fig. 3.10(a)]. Called a “diode-connected” device in analogy with its
bipolar counterpart, this conﬁguration exhibits small-signal behavior similar
to that of two-terminal resistor. Note that the transistor is always in saturation
because the drain and the gate have the same potential. Using the small-signal
equivalent shown in Fig. 3.10(b) to obtain the impedance of the device, we
write V1 = VX and IX = VX/rO + gmVX. That is, the impedance of the diode
is simply equal to VX/IX = (1/gm)∥rO ≈1/gm. If body effect exists, we can
use the circuit in Fig. 3.11 to write V1 = −VX, Vbs = −VX, and
(gm + gmb)VX + VX
rO
= IX
(3.21)
(a)
(b)
Diode−Connected Device
gmV1
rO
VX
IX
V1
Figure 3.10
(a) Diode-connected NMOS and PMOS devices; (b) small-signal equivalent circuit.

Sec. 3.3
Common-Source Stage
53
(a)
(b)
rO
gmV1
gmbVbs
V1
VX
IX
VDD
M1
VX
IX
Figure 3.11
(a) Arrangement for measuring the equivalent resistance of a diode-connected MOSFET;
(b) small-signal equivalent circuit.
It follows that
VX
IX
=
1
gm + gmb + r−1
O
(3.22)
=
1
gm + gmb
∥rO
(3.23)
≈
1
gm + gmb
(3.24)
In the general case, VX/IX = (1/gm)||rO||(1/gmb). Interestingly, the impedance seen at the source of
M1 is lower when body effect is included. Intuitive explanation of this effect is left as an exercise for the
reader.
From a large-signal point of view, a diode-connected device acts as a “square-root” operator if its
current is considered the input and its VGS or VGS −VT H the output (why?). We return to this point later.
▲
Example3.5
Consider the circuit shown in Fig. 3.12(a). In some cases, we are interested in the impedance seen looking into the
source, RX. Determine RX if λ = 0.
(a)
(b)
Vin
VDD
Vout
M1
ZL
RX
gmV1
ZL
gmbVbs
V1
VX
IX
IX
Figure 3.12
Impedance seen at the source with λ = 0.
Solution
To determine RX, we set all independent sources to zero, draw the small-signal model, and apply a voltage source
as shown in Fig. 3.12(b). Since V1 = −VX and Vbs = −VX, we have
(gm + gmb)VX = IX
(3.25)

54
Chap. 3
Single-Stage Ampliﬁers
and
VX
IX
=
1
gm + gmb
(3.26)
This result should not be surprising: the topologies in Fig. 3.12(a) and Fig. 3.11(a) are similar except that the drain of
M1 in Fig. 3.12(b) is not at ac ground. This difference does not manifest itself if λ = 0. We sometimes say, “looking
into the source of a MOSFET, we see 1/gm,” assuming implicitly that λ = γ = 0.
▲
We now study a common-source stage with a diode-connected load (Fig. 3.13). With negligible
channel-length modulation, (3.24) can be substituted in (3.10) for the load impedance, yielding
Av = −gm1
1
gm2 + gmb2
(3.27)
= −gm1
gm2
1
1 + η
(3.28)
where η = gmb2/gm2. Expressing gm1 and gm2 in terms of device dimensions and bias currents, we have
Av = −
√2μnCox(W/L)1ID1
√2μnCox(W/L)2ID2
1
1 + η
(3.29)
and, since ID1 = ID2,
Av = −

(W/L)1
(W/L)2
1
1 + η
(3.30)
This equation reveals an interesting property: if the variation of η with the output voltage is neglected,
the gain is independent of the bias currents and voltages (so long as M1 stays in saturation). In other
words, as the input and output signal levels vary, the gain remains relatively constant, indicating that the
input-output characteristic is relatively linear.
VDD
Vin
Vout
M2
M1
Figure 3.13
CS stage with
diode-connected load.
The linear behavior of the circuit can also be conﬁrmed by large-signal analysis. Neglecting channel-
length modulation for simplicity, we have in Fig. 3.13
1
2μnCox
W
L

1
(Vin −VT H1)2 = 1
2μnCox
W
L

2
(VDD −Vout −VT H2)2
(3.31)
and hence
W
L

1
(Vin −VT H1) =
W
L

2
(VDD −Vout −VT H2)
(3.32)

Sec. 3.3
Common-Source Stage
55
Thus, if the variation of VT H2 with Vout is small, the circuit exhibits a linear input-output characteristic.
In essence, the squaring function performed by M1 (from the input voltage to its drain current) and the
square root function performed by M2 (from its drain current to its overdrive) act as f −1( f (x)) = x.
The small-signal gain can also be computed by differentiating both sides with respect to Vin:
W
L

1
=
W
L

2

−∂Vout
∂Vin
−∂VT H2
∂Vin

(3.33)
which, upon application of the chain rule ∂VT H2/∂Vin = (∂VT H2/∂Vout)(∂Vout/∂Vin) = η(∂Vout/∂Vin),
reduces to
∂Vout
∂Vin
= −

(W/L)1
(W/L)2
1
1 + η
(3.34)
It is instructive to study the overall large-signal characteristic of the circuit as well. But let us ﬁrst
consider the circuit shown in Fig. 3.14(a). What is the ﬁnal value of Vout if I1 drops to zero? As I1
decreases, so does the overdrive of M2. Thus, for small I1, VGS2 ≈VT H2 and Vout ≈VDD −VT H2. In
reality, the subthreshold conduction in M2 eventually brings Vout to VDD if ID approaches zero, but at
very low current levels, the ﬁnite capacitance at the output node slows down the change from VDD −VT H2
to VDD. This is illustrated in the time-domain waveforms of Fig. 3.14(b). For this reason, in circuits that
have frequent switching activity, we assume that Vout remains around VDD −VT H2 when I1 falls to small
values.
(a)
(b)
VDD
Vout
CP
I1
M2
t
t
VDD
VDD
VTH2
Vout
I1
–
Figure 3.14
(a) Diode-connected device with stepped bias current; (b) variation of source voltage versus time.
Now we return to the circuit of Fig. 3.13. Plotted in Fig. 3.15 versus Vin, the output voltage equals
VDD −VT H2 if Vin < VT H1. For Vin > VT H1, Eq. (3.32) holds and Vout follows an approximately straight
line. As Vin exceeds Vout + VT H1 (beyond point A), M1 enters the triode region, and the characteristic
becomes nonlinear.
A
Vin
Vout
VTH1
VDD – VTH2
Figure 3.15
Input-output characteris-
tic of a CS stage with diode-connected
load.

56
Chap. 3
Single-Stage Ampliﬁers
The diode-connected load of Fig. 3.13 can be implemented with a PMOS device as well. Shown in
Fig. 3.16, the circuit is free from body effect, providing a small-signal voltage gain equal to
Av = −

μn(W/L)1
μp(W/L)2
(3.35)
where channel-length modulation is neglected.
VDD
Vin
Vout
M2
M1
Figure 3.16
CS stage with diode-
connected PMOS device.
Equations (3.30) and (3.35) indicate that the gain of a common-source stage with diode-connected
load is a relatively weak function of the device dimensions. For example, to achieve a gain of 5,
μn(W/L)1/[μp(W/L)2] = 25, implying that, with μn ≈2μp, we must have (W/L)1 ≈12.5(W/L)2. In
a sense, a high gain requires a “strong” input device and a “weak” load device. In addition to disproportion-
ately wide or long transistors (and hence a large input or load capacitance), a high gain translates to another
important limitation: reduction in allowable voltage swings. Speciﬁcally, since in Fig. 3.16, ID1 = |ID2|,
μn
W
L

1
(VGS1 −VT H1)2 = μp
W
L

2
(VGS2 −VT H2)2
(3.36)
if λ = 0, revealing that
|VGS2 −VT H2|
VGS1 −VT H1
= Av
(3.37)
Nanometer Design Notes
Let us design and simulate a CS stage
with a diode-connected PMOS load in
40-nm technology. We select W/L =
5 μm/40 nm for the NMOS device and
1 μm/40 nm for the PMOS device. The
large-signal I-V characteristic is shown
in the ﬁgure. We observe that the circuit
provides a small-signal gain of about
1.5 for an input range of roughly 0.4 V to
0.5 V. (In this dc sweep, Vout can reach
VDD when the input transistor is off.)
0
0.2
0.4
0.6
0.8
1
0
0.2
0.4
0.6
0.8
1
Vin (V)
Vout (V)
In the above example, the overdrive voltage of M2 must be 5 times that of M1.
For example, with VGS1 −VT H1 = 100 mV and |VT H2| = 0.3 V, we have
|VGS2| = 0.8 V, severely limiting the output swing. This is another example
of the trade-offs suggested by the analog design octagon. Note that, with
diode-connected loads, the swing is constrained by both the required overdrive
voltage and the threshold voltage. That is, even with a small overdrive, the
output level cannot exceed VDD −|VT H|.
An interesting paradox arises here if we write gm = μCox(W/L)|
VGS −VTH|. The voltage gain of the circuit is then given by
|Av| = gm1
gm2
(3.38)
= μnCox(W/L)1(VGS1 −VT H1)
μpCox(W/L)2|VGS2 −VT H2|
(3.39)
Equation (3.39) implies that Av is inversely proportional to |VGS2 −VT H2|.
It is left for the reader to resolve the seemingly opposite trends suggested by
(3.37) and (3.39).

Sec. 3.3
Common-Source Stage
57
▲
Example3.6
In the circuit of Fig. 3.17, M1 is biased in saturation with a drain current equal to I1. The current source IS = 0.75I1
is added to the circuit. How is (3.37) modiﬁed for this case? Assume λ = 0.
VDD
Vin
IS
I1
Vout
M2
M1
Figure 3.17
Solution
Since |ID2| = I1/4, we have
Av = −gm1
gm2
(3.40)
= −

4μn(W/L)1
μp(W/L)2
(3.41)
Moreover,
μn

W
L

1
(VGS1 −VT H1)2 = 4μp

W
L

2
(VGS2 −VT H2)2
(3.42)
yielding
|VGS2 −VT H2|
VGS1 −VT H1
= Av
4
(3.43)
Thus, for a gain of 5, the overdrive of M2 need be only 1.25 times that of M1. Alternatively, for a given overdrive
voltage, this circuit achieves a gain four times that of the stage in Fig. 3.16. Intuitively, this is because for a
given |VGS2 −VTH2|, if the current decreases by a factor of 4, then (W/L)2 must decrease proportionally, and
gm2 = 
2μpCox(W/L)2ID2 is lowered by the same factor.
▲
▲
Example3.7
A student attempts to calculate the voltage gain in the previous example by differentiating both sides of (3.42). Does
this approach give a correct result? Why?
Solution
Since VGS2 = Vout −VDD, differentiation and multiplication by Cox yield
μnCox

W
L

1
(Vin −VT H1)2 = 4μpCox

W
L

2
(Vout −VDD −VT H2)∂Vout
∂Vin
(3.44)
It follows that ∂Vout/∂Vin = −gm1/(4gm2). This incorrect result arises because (3.42) is valid for only one value
of Vin. As Vin is perturbed by the signal, I1 departs from 4|ID2| and (3.42) cannot be differentiated.
▲

58
Chap. 3
Single-Stage Ampliﬁers
In today’s CMOS technology, channel-length modulation is quite signiﬁcant and, more important, the
behavior of transistors notably departs from the square law. Thus, the gain of the stage in Fig. 3.13 must
be expressed as
Av = −gm1
 1
gm2
∥rO1∥rO2

(3.45)
where gm1 and gm2 must be obtained as described in Chapter 17.
3.3.3 CS Stage with Current-Source Load
In applications requiring a large voltage gain in a single stage, the relationship Av = −gm RD suggests
that we should increase the load impedance of the CS stage. With a resistor or diode-connected load,
however, increasing the load resistance translates to a large dc drop across the load, thereby limiting the
output voltage swing.
A more practical approach is to replace the load with a device that does not obey Ohm’s law, e.g., a
current source. Described brieﬂy in Example 3.3, the resulting circuit is shown in Fig. 3.18, where both
transistors operate in saturation. Since the total impedance seen at the output node is equal to rO1∥rO2,
the gain is given by is
Av = −gm1(rO1∥rO2)
(3.46)
The key point here is that the output impedance and the minimum required |VDS| of M2 are less strongly
coupled than the value and voltage drop of a resistor; the former need not satisfy Ohm’s law, but the latter
must. The voltage |VDS2,min| = |VGS2 −VT H2| can be reduced to less than a hundred millivolts by simply
increasing the width of M2. If rO2 is not sufﬁciently high, the length and width of M2 can be increased to
achieve a smaller λ while maintaining the same overdrive voltage. The penalty is the larger capacitance
introduced by M2 at the output node.
VDD
Vin
Vin
Vin
Vb
gm2V2
rO2
rO2
Vout
Vout
Vout
V2
M2
M1
M1
M1
Figure 3.18
CS stage with current-source load.
We should remark that the output bias voltage of the circuit in Fig. 3.18 is not well-deﬁned. Thus, the
stage is reliably biased only if a feedback loop forces Vout to a known value (Chapter 8). The large-signal
analysis of the circuit is left as an exercise for the reader.
As explained in Chapter 2, the output impedance of MOSFETs at a given drain current can be scaled
by changing the channel length, i.e., to the ﬁrst order, λ ∝1/L, and hence rO ∝L/ID. Since the gain of
the stage shown in Fig. 3.18 is proportional to rO1∥rO2, we may surmise that longer transistors yield a
higher voltage gain.
Let us consider M1 and M2 separately. If L1 is scaled up by a factor of α (> 1), then W1 may need to
be scaled proportionally as well. This is because, for a given drain current, VGS1 −VT H1 ∝1/√(W/L)1,
i.e., if W1 is not scaled, the overdrive voltage increases, limiting the output voltage swing. Also, since
gm1 ∝√(W/L)1, scaling up only L1 lowers gm1.

Sec. 3.3
Common-Source Stage
59
In applications where these issues are unimportant, W1 can remain constant while L1 increases. Thus,
the intrinsic gain of M1 can be written as
gm1rO1 =

2
W
L

1
μnCox ID
1
λID
(3.47)
indicating that the gain increases with L because λ depends more strongly on L than gm does. Also, note
that gmrO decreases as ID increases.
Increasing L2 while keeping W2 constant increases rO2 and hence the voltage gain, but at the cost of
a higher |VDS2,min|, which is required to maintain M2 in saturation.
▲
Example3.8
Compare the maximum output voltage swings of CS stages with resistive and current-source loads.
Solution
For the resistively-loaded stage [Fig. 3.19(a)], the maximum output voltage is near VDD (when Vin falls to about
VT H1). The minimum is the value that places M1 at the edge of the triode region, Vin −VT H1.
(a)
(b)
VDD
VDD
Vin
Vb
M2
M2 at Edge of
Saturation
M1
–
Vin – VTH1
VGS2 – VTH2
0
VDD
VDD
Vin
RD
ID
M1
Vin – VTH1
Figure 3.19
Output swing in CS stage with (a) resistive load and (b) current-source load.
For the stage with a current-source load [Fig. 3.19(b)], the maximum output voltage is that which places M2 at
the edge of the triode region, VDD −|VGS2 −VT H2|. Thus, the latter actually provides smaller swings than the
former, but can always achieve a higher gain if L1 and L2 are increased.
▲
3.3.4 CS Stage with Active Load
In the ampliﬁer topology of Fig. 3.19(b), the PMOS device serves as a constant current source. Is it
possible for M2 to operate as an amplifying device? Yes; we can apply the input signal to the gate of
M2 as well [Fig. 3.20(a)], converting it to an “active” load. The reader may recognize this topology as a
CMOS inverter. Suppose both transistors are in saturation and Vin rises by V0. Two changes now occur:
(a) ID1 increases, pulling Vout lower, and (b) M2 injects less current into the output node, allowing Vout to
drop. The two changes thus enhance each other, leading to a greater voltage gain. Equivalently, as seen
in Fig. 3.20(b), the two transistors operate in parallel and collapse into one as illustrated in Fig. 3.20(c).
It follows that −(gm1 + gm2)Vin(rO1||rO2) = Vout, and hence
Av = −(gm1 + gm2)(rO1||rO2)
(3.48)
Compared to the ampliﬁer of Fig. 3.19(b), this circuit exhibits the same output resistance, rO1||rO2, but
a higher transconductance. This topology is also called a “complementary CS stage.”
The ampliﬁer of Fig. 3.20(a) must deal with two critical issues. First, the bias current of the two
transistors is a strong function of PVT. In particular, since VGS1 + |VGS2| = VDD, variations in VDD or
the threshold voltages directly translate to changes in the drain currents. Second, the circuit ampliﬁes

60
Chap. 3
Single-Stage Ampliﬁers
(c)
(b)
(a)
gm2V2
rO2
rO1
gm1V1
Vout
Vin
V2
V1
VDD
Vout
Vin
M1
M2
rO2
rO1
Vout
Vin
( gm1 + gm2 )Vin
Figure 3.20
(a) CS stage with active load, (b) small-signal model, and (c) simpliﬁed model.
supply voltage variations (“supply noise”)! To understand this point, consider the arrangement depicted
in Fig. 3.21, where VB is a bias voltage to place M1 and M2 in saturation. In Problem 3.31, we prove that
the small-signal gain from VDD to Vout is given by
Vout
VDD
= gm2rO2 + 1
rO2 + rO1
rO1
(3.49)
=

gm2 + 1
rO2

(rO1||rO2)
(3.50)
Nanometer Design Notes
With minimum channel lengths, the
CS
stage
with
current-source
load
provides
a
low
gain.
For
example,
if (W/L)NMOS
=
5 μm/40 nm and
(W/L)PMOS = 10 μm/40 nm, we obtain
the input-output characteristic shown in
the ﬁgure, where the maximum gain is
about 2.5! If we plot the slope, we also
see the useful output voltage range to
be about 0.7 V with VDD = 1 V. Outside
this range, the gain drops considerably.
0
0.2
0.4
0.6
0.8
1
0
0.2
0.4
0.6
0.8
1
Vin (V)
Vout (V)
0
0.2
0.4
0.6
0.8
1
–3
–2.5
–2
–1.5
–1
–0.5
0
Vin (V)
Av
about half of the Av found above. These issues are addressed in Chapter 5.
VDD
Vout
VB
M1
M2
Figure 3.21
Arrangement for study-
ing supply sensitivity of CS stage with
active load.
3.3.5 CS Stage with Triode Load
A MOS device operating in the deep triode region behaves as a resistor and
can therefore serve as the load in a CS stage. Illustrated in Fig. 3.22, such a
circuit biases the gate of M2 at a sufﬁciently low level, ensuring that the load
is in the deep triode region for all output voltage swings. Since
Ron2 =
1
μpCox(W/L)2(VDD −Vb −|VT H P|)
(3.51)
the voltage gain can be readily calculated.
The principal drawback of this circuit stems from the dependence of Ron2
upon μpCox, Vb, and VT H P. Since μpCox and VT H P vary with process and
temperature, and since generating a precise value for Vb requires additional
complexity, this circuit is difﬁcult to use. Triode loads, however, consume
less voltage headroom than do diode-connected devices because in Fig. 3.22,
Vout,max = VDD, whereas in Fig. 3.16, Vout,max ≈VDD −|VT H P|.

Sec. 3.3
Common-Source Stage
61
VDD
VDD
Ron2
Vb
Vout
Vout
Vin
Vin
M1
M2
M1
Figure 3.22
CS stage with triode load.
Among the ﬁve CS variants studied above, those employing resistive, current-source, or active loads
ﬁnd wider usage than the other two.
(a)
(b)
ID
VDD
Vin
RS
RD
Vout
ID
RS
gmV1
Vin
V1
M1
Figure 3.23
CS stage with source degeneration.
3.3.6 CS Stage with Source Degeneration
In some applications, the nonlinear dependence of the drain current upon the overdrive voltage introduces
excessive nonlinearity, making it desirable to “soften” the device characteristics. In Sec. 3.3.2, we noted
the linear behavior of a CS stage using a diode-connected load, which allows “postcorrection” of the
nonlinearity. Alternatively, as depicted in Fig. 3.23(a), this can be accomplished by placing a “degenera-
tion” resistor in series with the source terminal so as to make the input device more linear. Let us neglect
channel-length modulation and body effect. Here, as Vin increases, so do ID and the voltage drop across
RS. That is, a fraction of the change in Vin appears across the resistor rather than as the gate-source
overdrive, thus leading to a smoother variation of ID. From another perspective, we intend to make the
gain equation a weaker function of gm. Since Vout = VDD −ID RD, the nonlinearity of the circuit arises
from the nonlinear dependence of ID upon Vin. We note that ∂Vout/∂Vin = −(∂ID/∂Vin)RD, and deﬁne
the equivalent transconductance of the circuit as Gm = ∂ID/∂Vin.3 Now, assuming that ID = f (VGS),
we write
Gm = ∂ID
∂Vin
(3.52)
=
∂f
∂VGS
∂VGS
∂Vin
(3.53)
3As explained later, the output voltage must be kept constant when Gm is calculated.

62
Chap. 3
Single-Stage Ampliﬁers
Since VGS = Vin −ID RS, we have ∂VGS/∂Vin = 1 −RS∂ID/∂Vin, obtaining
Gm =

1 −RS
∂ID
∂Vin

∂f
∂VGS
(3.54)
But, ∂f/∂VGS is the transconductance of M1, and
Gm =
gm
1 + gm RS
(3.55)
The small-signal voltage gain is thus equal to
Av = −Gm RD
(3.56)
=
−gm RD
1 + gm RS
(3.57)
The same result can be derived using the small-signal model of Fig. 3.23(b) by writing a KVL, Vin =
V1 + ID RS, and noting that ID = gmV1. Equation (3.55) implies that as RS increases, Gm becomes
a weaker function of gm and hence the drain current. In fact, for RS ≫1/gm, we have Gm ≈1/RS,
i.e., ID ≈Vin/RS, concluding that most of the change in Vin appears across RS. We say that the
drain current is a “linearized” function of the input voltage. In Problem 3.30, we examine this effect
from a different perspective. The linearization is obtained at the cost of lower gain [and higher noise
(Chapter 7)].
For our subsequent calculations, it is useful to determine Gm in the presence of body effect and
channel-length modulation. With the aid of the equivalent circuit shown in Fig. 3.24, we recognize that
the current through RS equals Iout and, therefore, Vin = V1 + Iout RS. Summing the currents at node X,
we have
Iout = gmV1 −gmbVX −Iout RS
rO
(3.58)
= gm(Vin −Iout RS) + gmb(−Iout RS) −Iout RS
rO
(3.59)
It follows that
Gm = Iout
Vin
(3.60)
=
gmrO
RS + [1 + (gm + gmb)RS]rO
(3.61)
gmV1
rO
gmbVbs
Iout
Vin
V1
X
RS
Figure 3.24
Small-signal equivalent
circuit of a degenerated CS stage.

Sec. 3.3
Common-Source Stage
63
Let us now examine the large-signal behavior of the CS stage with RS = 0 and RS ̸= 0. For RS = 0,
our derivations in Chapter 2 indicate that ID and gm vary as shown in Fig. 3.25(a). For RS ̸= 0, the
turn-on behavior is similar to that in Fig. 3.25(a) because, at low current levels, 1/gm ≫RS, and hence
Gm ≈gm [Fig. 3.25(b)]. As the overdrive and therefore gm increase, the effect of degeneration, 1+gm RS
in (3.55), becomes more signiﬁcant. For large values of Vin (if M1 is still saturated), ID is approximately
a linear function of Vin and Gm approaches 1/RS.
(a)
(b)
ID
gm
VTH
VTH
Vin
Vin
1
RS
1
RS
Gm
VTH
VTH
Vin
Vin
ID
Figure 3.25
Drain current and transconductance of a CS device (a) without and (b) with source degeneration.
▲
Example3.9
Plot the small-signal voltage gain of the circuit in Fig. 3.23 as a function of the input bias voltage, Vin.
Solution
Using the results derived above for the equivalent transconductance of M1 and RS, we arrive at the plot shown
in Fig. 3.26. For Vin slightly greater than VT H, 1/gm ≫RS and Av ≈−gm RD. As Vin increases, degeneration
becomes more signiﬁcant and Av = −gm RD/(1+gm RS). For large values of Vin, Gm ≈1/RS and Av = −RD/RS.
However, if Vin > Vout + VT H, that is, if RD ID > VT H + VDD −Vin, M1 enters the triode region and Av drops.
Vin
VTH
Av
gm RD
RD
RS
Figure 3.26
▲
Equation (3.57) can be rewritten as
Av = −
RD
1
gm
+ RS
(3.62)
This result allows formulating the gain by inspection. First, let us examine the denominator of (3.62).
The expression is equal to the series combination of the inverse transconductance of the device and the
explicit resistance seen from the source to ground. We call the denominator “the resistance seen in the
source path” because if, as shown in Fig. 3.27, we disconnect the bottom terminal of RS from ground
and calculate the resistance seen “looking up” (while setting the input to zero), we obtain RS + 1/gm.

64
Chap. 3
Single-Stage Ampliﬁers
+
RS
RS
1
gm
1
gm
Figure 3.27
Resistance seen in the
source path.
Nanometer Design Notes
A common issue in nanometer technolo-
gies is that a MOS transistor experiences
”stress” if its VGS, VDS, or VDG exceeds
certain limits. For example, in 40-nm
technology, these voltages should re-
main below 1 V. Interestingly, the cas-
code structure can avoid device stress
even if VDD is greater than allowed. As
can be seen from the diagram below, as
the drain current decreases and Vout ap-
proaches VDD, M1 experiences VDS =
VDD, whereas M2 sees VDS ≈Vb −
VT H2. Similarly, VDS3 < VDD (why?).
M3
M2
M1
Vin
VDD
Vout
RD
Vb
Vin
VDD
Vout
RD
Noting that the numerator of (3.62) is the resistance seen at the drain, we
view the magnitude of the gain as the resistance seen at the drain node divided
by the total resistance in the source path. This method greatly simpliﬁes the
analysis of more complex circuits.
▲
Example 3.10
Assuming λ = γ = 0, calculate the small-signal gain of the circuit shown in
Fig. 3.28(a).
(a)
(b)
VDD
RD
Vout
Vin
M1
M2
in
V
VDD
RD
Vout
M1
1
gm2
Figure 3.28
Solution
Noting that M2 is a diode-connected device and simplifying the circuit to that shown in Fig. 3.28(b), we use the
above rule to write
Av = −
RD
1
gm1
+
1
gm2
(3.63)
▲
Output Resistance
Another important consequence of source degeneration is the increase in the output
resistance of the stage. We calculate the output resistance ﬁrst with the aid of the equivalent circuit shown
in Fig. 3.29, where the load resistor, RD, is excluded for now. Note that body effect is also included to
gmV1
rO
gmbVbs
V1
VX
IX
IX
RS
Figure 3.29
Equivalent circuit for cal-
culating the output resistance of a degen-
erated CS stage.

Sec. 3.3
Common-Source Stage
65
arrive at a general result. Since the current through RS is equal to IX, V1 = −IX RS, and the current
ﬂowing through rO is given by IX −(gm + gmb)V1 = IX + (gm + gmb)RS IX. Adding the voltage drops
across rO and RS, we obtain
rO[IX + (gm + gmb)RS IX] + IX RS = VX
(3.64)
It follows that
Rout = [1 + (gm + gmb)RS]rO + RS
(3.65)
= [1 + (gm + gmb)rO]RS + rO
(3.66)
Equation (3.65) indicates that rO is “boosted” by a factor of 1 + (gm + gmb)RS and then added to RS.
As an alternative perspective, Eq. (3.66) suggests that RS is boosted by a factor of 1 + (gm + gmb)rO (a
value close to the transistor’s intrinsic gain) and then added to rO. Both views prove useful in analyzing
circuits. Note that the overall output resistance is equal to the parallel combination of Rout and RD. If
(gm + gmb)rO ≫1, we have
Rout ≈(gm + gmb)rO RS + rO
(3.67)
= [1 + (gm + gmb)RS]rO
(3.68)
To gain more insight, let us consider the circuit of Fig. 3.29 with RS = 0 and RS > 0. If RS = 0, then
gmV1 = gmbVbs = 0 and IX = VX/rO. On the other hand, if RS > 0, we have IX RS > 0 and V1 < 0,
obtaining negative gmV1 and gmbVbs. Thus, the current supplied by VX is less than VX/rO, and hence the
output impedance is greater than rO.
The relationship in (3.65) can also be derived by inspection. As shown in Fig. 3.30(a), we apply a
voltage to the output node, change its value by V , and measure the resulting change, I, in the output
current. Since the current through RS must change by I (why?), we ﬁrst compute the voltage change
across RS. To this end, we draw the circuit as shown in Fig. 3.30(b) and note that the resistance seen
looking into the source of M1 is equal to 1/(gm + gmb) [Eq. (3.24)], thus arriving at the equivalent circuit
in Fig. 3.30(c). The voltage change across RS is therefore equal to
VRS = V
1
gm + gmb
∥RS
1
gm + gmb
∥RS + rO
(3.69)
(a)
(b)
(c)
RS
RS
rO
rO
M1
M1
Δ I
ΔV
ΔV
ΔVRS
ΔV
RS
rO
1
gm+gmb
ΔVRS
ΔV
Figure 3.30
(a) Change in drain current in response to change in applied voltage to drain; (b) equivalent of (a);
(c) small-signal model.

66
Chap. 3
Single-Stage Ampliﬁers
The change in the current is
I = VRS
RS
(3.70)
= V
1
[1 + (gm + gmb)]RSrO + RS
(3.71)
that is,
V
I = [1 + (gm + gmb)RS]rO + RS
(3.72)
With the foregoing developments, we can now compute the gain of a degenerated CS stage in the
general case, taking into account both body effect and channel-length modulation. In the equivalent circuit
depicted in Fig. 3.31, the current through RS must equal that through RD, i.e., −Vout/RD. Thus, the source
voltage with respect to ground (and the bulk) is equal to −Vout RS/RD, yielding V1 = Vin + Vout RS/RD.
The current ﬂowing through rO from top to bottom can therefore be written as
Iro = −Vout
RD
−(gmV1 + gmbVbs)
(3.73)
= −Vout
RD
−
	
gm

Vin + Vout
RS
RD

+ gmbVout
RS
RD

(3.74)
RD
–
rO
gmbVbs
Vout
Vin
V1
Vout
RD
–Vout
RD
RS
gmV1
Figure 3.31
Small-signal model of degenerated CS stage with ﬁnite output resistance.
Since the voltage drops across rO and RS must add up to Vout, we have
Vout = IrorO −Vout
RD
RS
(3.75)
= −Vout
RD
rO −
	
gm

Vin + Vout
RS
RD

+ gmbVout
RS
RD

rO −Vout
RS
RD
(3.76)
It follows that
Vout
Vin
=
−gmrO RD
RD + RS + rO + (gm + gmb)RSrO
(3.77)
To gain more insight into this result, we recognize that the last three terms in the denominator, namely,
RS + rO + (gm + gmb)RSrO, represent the output resistance of a MOS device degenerated by a resistor
RS, as originally derived in (3.66). Let us now rewrite (3.77) as
Av = −gmrO RD[RS + rO + (gm + gmb)RSrO]
RD + RS + rO + (gm + gmb)RSrO
·
1
RS + rO + (gm + gmb)RSrO
(3.78)
= −
gmrO
RS + rO + (gm + gmb)RSrO
· RD[RS + rO + (gm + gmb)RSrO]
RD + RS + rO + (gm + gmb)RSrO
(3.79)

Sec. 3.3
Common-Source Stage
67
The two fractions in (3.79) represent two important parameters of the circuit: the ﬁrst is identical to that
in (3.61), i.e., the equivalent transconductance of a degenerated MOSFET; and the second denotes the
parallel combination of RD and RS + rO + (gm + gmb)RSrO, i.e., the overall output resistance of the
circuit.
The above discussion suggests that in some circuits, it may be easier to calculate the voltage gain by
exploiting the following lemma. We recall that the output port of a linear circuit can be represented by a
Norton equivalent [Fig. 3.32(a)].
Lemma In a linear circuit, the voltage gain is equal to −Gm Rout, where Gm denotes the transconduc-
tance of the circuit when the output is shorted to ground [Fig. 3.32(b)] and Rout represents the output
resistance of the circuit when the input voltage is set to zero [Fig. 3.32(c)].
(c)
(a)
(b)
Gm Calculation
Rout Calculation
Iout
Iout
Iout
Rout
Rout
Rout
Rout
Vout
Vout
Vin
Figure 3.32
(a) Norton equivalent of a linear circuit; (b) Gm calculation; and (c) Rout calculation.
The lemma can be proved by noting that the output voltage in Fig. 3.32(a) is equal to −Iout Rout, and
Iout can be obtained by measuring the short-circuit current at the output. Deﬁning Gm = Iout/Vin, we
have Vout = −GmVin Rout. This lemma proves useful if Gm and Rout can be determined by inspection.
Note the direction of Iout.
▲
Example3.11
Calculate the voltage gain of the circuit shown in Fig. 3.33. Assume that I0 is ideal.
VDD
Vout
RS
I0
M1
Vin
Figure 3.33
Solution
The transconductance and output resistance of the stage are given by Eqs. (3.61) and (3.66), respectively. Thus,
Av = −
gmrO
RS + [1 + (gm + gmb)RS]rO
{[1 + (gm + gmb)rO]RS + rO}
(3.80)
= −gmrO
(3.81)
Interestingly, the voltage gain is equal to the intrinsic gain of the transistor and independent of RS. This is because,
if I0 is ideal, the current through RS cannot change, and hence the small-signal voltage drop across RS is zero—as
if RS were zero itself.
▲

68
Chap. 3
Single-Stage Ampliﬁers
3.4
Source Follower
Our analysis of the common-source stage indicates that, to achieve a high voltage gain with limited supply
voltage, the load impedance must be as large as possible. If such a stage is to drive a low-impedance
load, then a “buffer” must be placed after the ampliﬁer so as to drive the load with negligible reduction
in gain. The source follower (also called the “common-drain” stage) can operate as a voltage buffer.
(a)
(b)
Low
Resistance
Gain Stage
Buffer
=
(c)
VDD
VDD
Vout
VGS
Vout
Vout
Vin
RS
Vin
Vin
VTH
M1
High
Resistance
Figure 3.34
(a) Source follower, (b) example of its role as a buffer, and (c) its input-output characteristic.
Illustrated in Fig. 3.34(a), the source follower senses the signal at the gate, while presenting a high
input impedance, and drives the load at the source, allowing the source potential to “follow” the gate
voltage. Figure 3.34(b) depicts how the circuit can be used to drive a low resistance without degrading
the voltage gain of a CS stage. Beginning with the large-signal behavior of the source follower, we note
that for Vin < VT H, M1 is off and Vout = 0. As Vin exceeds VT H, M1 turns on in saturation (why?) and
ID1 ﬂows through RS [Fig. 3.34(c)]. As Vin increases further, Vout follows the input with a difference
(level shift) equal to VGS. We can express the input-output characteristic as
1
2μnCox
W
L (Vin −VT H −Vout)2RS = Vout
(3.82)
where channel-length modulation is neglected. Let us calculate the small-signal gain of the circuit by
differentiating both sides of (3.82) with respect to Vin:
1
2μnCox
W
L 2(Vin −VT H −Vout)

1 −∂VT H
∂Vin
−∂Vout
∂Vin

RS = ∂Vout
∂Vin
(3.83)
Since ∂VT H/∂Vin = (∂VT H/∂VSB)(∂VSB/∂Vin) = η∂Vout/∂Vin,
∂Vout
∂Vin
=
μnCox
W
L (Vin −VT H −Vout)RS
1 + μnCox
W
L (Vin −VT H −Vout)RS(1 + η)
(3.84)
Also, note that
gm = μnCox
W
L (Vin −VT H −Vout)
(3.85)

Sec. 3.4
Source Follower
69
Consequently,
Av =
gm RS
1 + (gm + gmb)RS
(3.86)
The same result is more easily obtained with the aid of a small-signal equivalent circuit. From Fig. 3.35,
we have Vin −V1 = Vout, Vbs = −Vout, and gmV1 −gmbVout = Vout/RS. Thus, Vout/Vin = gm RS/[1 +
(gm + gmb)RS].
gmV1
gmbVbs
Vout
V1
RS
Vin
Figure 3.35
Small-signal equivalent
circuit of source follower.
Sketched in Fig. 3.36 vs. Vin, the voltage gain begins from zero for Vin ≈VT H (that is, gm ≈0) and
monotonically increases. As the drain current and gm increase, Av approaches gm/(gm+gmb) = 1/(1+η).
Since η itself slowly decreases with Vout, Av would eventually become equal to unity, but for typical
allowable source-bulk voltages, η remains greater than roughly 0.2.
1
1 + η
1.0
Av
Vin
VTH
Figure 3.36
Voltage gain of source
follower versus input voltage.
An important result of (3.86) is that even if RS = ∞, the voltage gain of a source follower is not equal
to one (unless body effect is removed as explained later). We return to this point later. Note that M1 in
Fig. 3.34(a) remains in saturation if Vin does not exceed VDD + VT H.
In the source follower of Fig. 3.34(a), the drain current of M1 heavily depends on the input dc level.
For example, if Vin changes from 0.7 V to 1 V, ID may increase by a factor of 2, and hence VGS −VT H
by
√
2. Even if VT H is relatively constant, the increase in VGS means that Vout (= Vin −VGS) does not
follow Vin faithfully, thereby incurring nonlinearity. To alleviate this issue, the resistor can be replaced by
a constant current source as shown in Fig. 3.37(a). The current source itself is implemented as an NMOS
transistor operating in the saturation region [Fig. 3.37(b)].
(a)
I 1
(b)
VDD
VDD
Vout
Vout
Vin
Vin
Vb
M1
M1
M2
Figure 3.37
Source follower using
(a) an ideal current source, and (b) an
NMOS transistor as a current source.

70
Chap. 3
Single-Stage Ampliﬁers
▲
Example3.12
Suppose that in the source follower of Fig. 3.37(a), (W/L)1 = 20/0.5, I1 = 200 μA, VT H0 = 0.6 V, 2
F = 0.7 V,
VDD = 1.2 V, μnCox = 50 μA/V2, and γ = 0.4 V1/2.
(a) Calculate Vout for Vin = 1.2 V.
(b) If I1 is implemented as M2 in Fig. 3.37(b), ﬁnd the minimum value of (W/L)2 for which M2 remains saturated
when Vin = 1.2 V.
Solution
(a) Since the threshold voltage of M1 depends on Vout, we perform a simple iteration. Noting that
(Vin −VT H −Vout)2 =
2ID
μnCox

W
L

1
(3.87)
we ﬁrst assume that VT H ≈0.6 V, obtaining Vout = 0.153 V. Now we calculate a new VT H as
VT H = VT H0 + γ (

2
F + VSB −

2
F)
(3.88)
= 0.635 V
(3.89)
This indicates that Vout is approximately 35 mV less than that calculated above, i.e., Vout ≈0.118 V.
(b)Sincethedrain-sourcevoltageof M2 isequalto0.118V,thedeviceissaturatedonlyif(VGS−VT H)2 ≤0.118V.
With ID = 200 μA, this gives (W/L)2 ≥287/0.5. Note the substantial drain junction and overlap capacitance
contributed by M2 to the output node.
▲
▲
Example3.13
Explain intuitively why the gain of the source follower in Fig. 3.37(a) is equal to unity if I1 is ideal and λ = γ = 0.
Solution
In this case, the drain current of M1 remains exactly constant, and so does VGS1. Since Vout = Vin −VGS1, we
observe that a change in Vin must equally appear in Vout. Alternatively, as shown in Fig. 3.38, we can say that the
small-signal drain current cannot ﬂow through any path and must be zero, yielding V1 = 0 and Vout = Vin.
gmV1
Vout
Vin
V1
Figure 3.38
▲
To gain a better understanding of source followers, let us calculate the small-signal output resistance
of the circuit in Fig. 3.39(a). Using the equivalent circuit of Fig. 3.39(b) and noting that VX = −Vbs, we
write
IX −gmVX −gmbVX = 0
(3.90)
It follows that
Rout =
1
gm + gmb
(3.91)

Sec. 3.4
Source Follower
71
(a)
(b)
(c)
ac
ac
VDD
VDD
gmV1
gmbVbs
Rout
V1
VX
IX
IX
VX
M1
M1
Figure 3.39
Calculation of the output impedance of a source follower.
This result should not come as a surprise: the circuit in Fig. 3.39(b) is similar to that in Fig. 3.11(b).
Interestingly, body effect decreases the output resistance of source followers. To understand why, sup-
pose that in Fig. 3.39(c), VX decreases by V so that the drain current increases. With no body ef-
fect, only the gate-source voltage of M1 would increase by V . With body effect, on the other hand,
the threshold voltage of the device decreases as well. Thus, in (VGS −VT H)2, the ﬁrst term increases
and the second decreases, resulting in a greater change in the drain current and hence a lower output
impedance.
The above phenomenon can also be studied with the aid of the small-signal model shown in Fig. 3.40(a).
It is important to note that the magnitude of the current source gmbVbs = gmbVX is linearly proportional
to the voltage across it (because the current source and the voltage source are in parallel). Such a
behavior is that of a simple resistor equal to 1/gmb, yielding the small-signal model shown in Fig. 3.40(b).
The equivalent resistor simply appears in parallel with the output, thereby lowering the overall output
resistance. Since without 1/gmb, the output resistance equals 1/gm, we conclude that
Rout = 1
gm
∥1
gmb
(3.92)
=
1
gm + gmb
(3.93)
Modeling the effect of gmb by a resistor—which is valid only for source followers—also helps explain
the less-than-unity voltage gain implied by (3.86) for RS = ∞. As shown in the Thevenin equivalent
(a)
gmV1
gmV1
gmbVX
V1
V1
VX
IX
(b)
VX
IX
gmb
1
Figure 3.40
Source follower including body effect.

72
Chap. 3
Single-Stage Ampliﬁers
gmV1
V1
gm
1
gmb
1
gmb
1
gm
1
Vin
Vout
Vin
Vout
Figure 3.41
Representation of intrinsic source follower by a Thevenin equivalent.
of Fig. 3.41,
Av =
1
gmb
1
gm
+
1
gmb
(3.94)
=
gm
gm + gmb
(3.95)
For completeness, we also study a source follower with a ﬁnite load resistance and channel-length
modulation [Fig. 3.42(a)]. Noting that 1/gmb, rO1, rO2, and RL are in parallel, we can reduce the circuit
to that shown in Fig. 3.42(c), where Req = (1/gmb)||rO1||rO2||RL. It follows that
Av =
Req
Req + 1
gm
(3.96)
(b)
VDD
Vin
Vout
M1
M2
Vb
RL
(a)
gmV1
gmV1
V1
gmb
1
Vin
Vout
Vout
rO1
rO2
RL
Vin
V1
Req
(c)
Figure 3.42
(a) Source follower driving load resistance; (b) small-signal equivalent circuit; (c) simpliﬁed model.
▲
Example3.14
Calculate the voltage gain of the circuit shown in Fig. 3.43.
Solution
The impedance seen looking into the source of M2 (a diode-connected device) is equal to [1/(gm2 + gmb2)]∥rO2.
The impedance appears in parallel with 1/gmb1 and rO1. Thus,
Av =
1
gm2 + gmb2
∥rO2∥rO1∥
1
gmb1
1
gm2 + gmb2
∥rO2∥rO1∥
1
gmb1
+
1
gm1
(3.97)

Sec. 3.4
Source Follower
73
VDD
Vin
M1
M2
Vout
VDD
Figure 3.43
▲
Source followers exhibit a high input impedance and a moderate output impedance, but at the cost of
two drawbacks: nonlinearity and voltage headroom limitation. We consider these issues in detail.
As mentioned in relation to Fig. 3.34(a), even if a source follower is biased by an ideal current source,
its input-output characteristic displays some nonlinearity due to the nonlinear dependence of VT H upon
the source potential. In submicron technologies, rO of the transistor also changes substantially with VDS,
thus introducing additional variation in the small-signal gain of the circuit (Chapter 14). For this reason,
typical source followers suffer from signiﬁcant nonlinearity.
The nonlinearity due to body effect can be eliminated if the bulk is tied to the source. This is usually
possible only for PFETs because all NFETs share the same substrate. Figure 3.44 shows a PMOS source
follower employing two separate n-wells so as to eliminate the body effect of M1. The lower mobility of
PFETs, however, yields a higher output impedance in this case than that available in an NMOS counterpart.
VDD
Vin
M2
Vout
M1
Vb
(a)
Vin
Vb
VDD
GND
n−well
n−well
Contacts
(b)
Vout
Figure 3.44
(a) PMOS source follower with no body effect; (b) corresponding layout showing separate n-wells.
Source followers also shift the dc level of the signal by VGS, thereby consuming voltage headroom
and limiting the voltage swings. To understand this point, consider the example illustrated in Fig. 3.45,
a cascade of a common-source stage and a source follower. Without the source follower, the minimum
allowable value of VX would be equal to VGS1 −VT H1 (for M1 to remain in saturation). With the source
follower, on the other hand, VX must be greater than VGS2 + (VGS3 −VT H3) so that M3 is saturated. For
comparable overdrive voltages in M1 and M3, this means the allowable swing at X is reduced by VGS2,
a substantial amount.
It is also instructive to compare the gain of source followers and common-source stages when the load
impedance is relatively low. A practical example is the need to drive an external 50- termination in a

74
Chap. 3
Single-Stage Ampliﬁers
VDD
Vout
M2
M3
Vb
M1
ID
Vin
X
Figure 3.45
Cascade of source
follower and CS stage.
VDD
Vout
M1
I1
RL
(a)
Vin
M1
RL
Vout
Vin
VDD
(b)
Figure 3.46
(a) Source follower and (b) CS stage driving a load resistance.
high-frequency environment. As shown in Fig. 3.46(a), the load can be driven by a source follower with
an overall voltage gain of
Vout
Vin
|SF ≈
RL
RL + 1/gm1
(3.98)
≈
gm1RL
1 + gm1RL
(3.99)
On the other hand, as depicted in Fig. 3.46(b), the load can be included as part of a common-source stage,
providing a gain of
Vout
Vin
|CS ≈−gm1RL
(3.100)
The key difference between these two topologies is the achievable voltage gain for a given bias current.
For example, if 1/gm1 ≈RL, then the source follower exhibits a gain of at most 0.5, whereas the common-
source stage provides a gain close to unity. Thus, source followers are not necessarily efﬁcient drivers.
The drawbacks of source followers, namely, nonlinearity due to body effect and voltage headroom
consumption due to level shift, limit the use of this topology. As a general rule, we avoid the use of source
followers unless they become absolutely necessary. One application of source followers is in performing
voltage-level shift, as illustrated by the following example.
▲
Example3.15
(a) In the circuit of Fig. 3.47(a), calculate the voltage gain if C1 acts as an ac short at the frequency of interest. What
is the maximum dc level of the input signal for which M1 remains saturated?
(b) To accommodate an input dc level close to VDD, the circuit is modiﬁed as shown in Fig. 3.47(b). What
relationship between the gate-source voltages of M2 and M3 guarantees that M1 is saturated?

Sec. 3.5
Common-Gate Stage
75
M1
Vout
I1
Vin
VDD
C1
M1
Vout
I1
Vin
VDD
C1
M3
M2
M2
(a)
(b)
X
Figure 3.47
Solution
(a) Noting that the source of M1 is at ac ground, we write the gain as
Av = −gm1[rO1∥rO2∥(1/gm2)]
(3.101)
Since Vout = VDD −|VGS2|, the maximum allowable dc level of Vin is equal to VDD −|VGS2| + VT H1.
(b) If Vin = VDD, then VX = VDD −VGS3. For M1 to be saturated when Vin = VDD, we must have VDD −
VGS3 −VT H1 ≤VDD −|VGS2|, and hence VGS3 + VT H1 ≥|VGS2|.
▲
As explained in Chapter 7, source followers also introduce substantial noise. For this reason, the circuit
of Fig. 3.47(b) is ill-suited to low-noise applications.
3.5
Common-Gate Stage
In common-source ampliﬁers and source followers, the input signal is applied to the gate of a MOSFET.
It is also possible to apply the signal to the source terminal. Shown in Fig. 3.48(a), a common-gate (CG)
stage senses the input at the source and produces the output at the drain. The gate is connected to a dc
voltage to establish proper operating conditions. Note that the bias current of M1 ﬂows through the input
signal source. Alternatively, as depicted in Fig. 3.48(b), M1 can be biased by a constant current source,
with the signal capacitively coupled to the circuit.
RD
Vout
Vb
VDD
Vin
RD
Vout
Vb
VDD
Vin
C1
I1
(a)
(b)
M1
M1
Figure 3.48
(a) Common-gate stage with direct coupling at input; (b) CG stage with capacitive coupling at input.

76
Chap. 3
Single-Stage Ampliﬁers
Vb − VTH
Vb − VTH
Vin
Vout
VDD
M1 in
Saturation
M1 in
Triode Region
M1 off
Figure 3.49
Common-gate input-
output characteristic.
We ﬁrst study the large-signal behavior of the circuit in Fig. 3.48(a). For simplicity, let us assume that
Vin decreases from a large positive value. Also, λ = 0. For Vin ≥Vb −VT H, M1 is off and Vout = VDD.
For lower values of Vin, we can write
ID = 1
2μnCox
W
L (Vb −Vin −VT H)2
(3.102)
if M1 is in saturation. As Vin decreases, so does Vout, eventually driving M1 into the triode region if
VDD −1
2μnCox
W
L (Vb −Vin −VT H)2RD = Vb −VT H
(3.103)
The input-output characteristic is shown in Fig. 3.49, illustrating a case in which M1 enters the triode
region as Vin decreases. In the region where M1 is saturated, we can express the output voltage as
Vout = VDD −1
2μnCox
W
L (Vb −Vin −VT H)2RD
(3.104)
obtaining a small-signal gain of
∂Vout
∂Vin
= −μnCox
W
L (Vb −Vin −VT H)

−1 −∂VT H
∂Vin

RD
(3.105)
Since ∂VT H/∂Vin = ∂VT H/∂VSB = η, we have
∂Vout
∂Vin
= μnCox
W
L RD(Vb −Vin −VT H)(1 + η)
(3.106)
= gm(1 + η)RD
(3.107)
Note that the gain is positive. Interestingly, body effect increases the equivalent transconductance of the
stage.
For a given bias current and supply voltage (i.e., a given power budget), how do we maximize the
voltage gain of a CG stage? We can increase gm by widening the input device, eventually reaching
subthreshold operation [gm ≈ID/(ξVT )] (why?), and/or we can increase RD and, inevitably, the dc drop
across it. We must bear in mind that the minimum allowable level of Vout in Fig. 3.48(b) is equal to
VGS −VT H + VI1, where VI1 denotes the minimum voltage required by I1.
▲
Example3.16
(a) Is it possible for M1 in Fig. 3.48(a) to remain in saturation for the entire range of Vin from 0 to VDD?
(b) Is it possible for M1 to remain in the triode region for the entire range of Vin from 0 to VDD?

Sec. 3.5
Common-Gate Stage
77
Solution
(a) Yes, it is possible. To so guarantee, we choose VDD −RD ID > Vb −VT H, where ID denotes the drain current
at Vin = 0.
(b) Yes, it is possible. If Vb > VDD + VT H, then M1 turns on at the edge of the triode region at Vin = VDD −VT H
and goes deeper as Vin falls. Of course, this choice of Vb is neither practical nor desirable.
▲
The input impedance of the circuit is also important. We note that for λ = 0, the impedance seen at the
source of M1 in Fig. 3.48(a) is the same as that at the source of M1 in Fig. 3.39, namely, 1/(gm + gmb) =
1/[gm(1 + η)]. Thus, the body effect decreases the input impedance of the common-gate stage. The
relatively low input impedance of the common-gate stage proves useful in some applications.
▲
Example3.17
In Fig. 3.50, transistor M1 senses V and delivers a proportional current to a 50- transmission line. The other
end of the line is terminated by a 50- resistor in Fig. 3.50(a) and a common-gate stage in Fig. 3.50(b). Assume
λ = γ = 0.
(a) Calculate Vout/Vin at low frequencies for both arrangements.
(b) What condition is necessary to minimize wave reﬂection at node X?
RD
Vb
VDD
I1
M2
ΔV
ΔV
RD
VDD
M1
ID1
X
M1
ID1
(a)
(b)
Figure 3.50
Solution
(a) For small signals applied to the gate of M1, the drain current experiences a change equal to gm1VX. This current
is drawn from RD in Fig. 3.50(a) and M2 in Fig. 3.50(b), producing an output voltage swing equal to −gm1VX RD.
Thus, Av = −gm1RD for both cases.
(b) To minimize reﬂection at node X, the resistance seen at the source of M2 must equal 50  and the reactance
must be small. Thus, 1/(gm2 + gmb2) = 50 , which can be ensured by proper sizing and biasing of M2. To
minimize the capacitances of the transistor, it is desirable to use a small device biased at a large current. (Recall that
gm = √2μnCox(W/L)ID.) In addition to higher power dissipation, this remedy also requires a large VGS for M2.
The key point in this example is that, while the overall voltage gain in both arrangements equals −gm1RD, the
value of RD in Fig. 3.50(b) can be much greater than 50  without introducing reﬂections at point X. Thus, the
common-gate circuit can provide a higher voltage gain than that in Fig. 3.50(a).
▲
Now let us study the common-gate topology in a more general case, taking into account both the
output impedance of the transistor and the impedance of the signal source. Depicted in Fig. 3.51(a), the
circuit can be analyzed with the aid of its equivalent shown in Fig. 3.51(b). Noting that the current ﬂowing

78
Chap. 3
Single-Stage Ampliﬁers
rO
Vin
RS
RD
Vout
VDD
Vb
M1
V1
gmV1
gmbVbs
rO
RS
RD
Vout
Vin
X
X
(a)
(b)
Figure 3.51
(a) CG stage with ﬁnite transistor output resistance; (b) small-signal equivalent circuit.
through RS is equal to −Vout/RD, we have
V1 −Vout
RD
RS + Vin = 0
(3.108)
Moreover, since the current through rO is equal to −Vout/RD −gmV1 −gmbV1, we can write
rO
−Vout
RD
−gmV1 −gmbV1

−Vout
RD
RS + Vin = Vout
(3.109)
Upon substitution for V1 from (3.108), (3.109) reduces to
rO
	−Vout
RD
−(gm + gmb)

Vout
RS
RD
−Vin

−Vout RS
RD
+ Vin = Vout
(3.110)
It follows that
Vout
Vin
=
(gm + gmb)rO + 1
rO + (gm + gmb)rO RS + RS + RD
RD
(3.111)
Note the similarity between (3.111) and (3.77). The gain of the common-gate stage is slightly higher due
to body effect.
▲
Example3.18
Calculate the voltage gain of the circuit shown in Fig. 3.52(a) if λ ̸= 0 and γ ̸= 0.
Solution
We ﬁrst ﬁnd the Thevenin equivalent of M1 and Vin. As shown in Fig. 3.52(b), M1 operates as a source follower, the
equivalent Thevenin voltage is given by
Vin,eq =
rO1

1
gmb1
rO1

1
gmb1
+
1
gm1
Vin
(3.112)

Sec. 3.5
Common-Gate Stage
79
(a)
(b)
RD
Vout
VDD
Vb
M1
M2
M1
rO1
Vin
Vin
Vin,eq
Req
RD
Vout
VDD
Vb
M2
Vin,eq
Req
(c)
Figure 3.52
and the equivalent Thevenin resistance is
Req = rO1

1
gmb1

1
gm1
(3.113)
Redrawing the circuit as in Fig. 3.52(c), we use (3.111) to write
Vout
Vin
=
(gm2 + gmb2)rO2 + 1
rO2 + [1 + (gm2 + gmb2)rO2]

rO1

1
gmb1

1
gm1

+ RD
RD
rO1

1
gmb1
rO1

1
gmb1
+
1
gm1
(3.114)
This example demonstrates the ease with which a circuit can be analyzed by inspection—while relying on
previously-derived results—rather than by blindly writing KVLs and KCLs.
▲
The input and output impedances of the common-gate topology are also of interest. To obtain the
impedance seen at the source [Fig. 3.53(a)], we use the equivalent circuit in Fig. 3.53(b). Since V1 = −VX
and the current through rO is equal to IX + gmV1 + gmbV1 = IX −(gm + gmb)VX, we can add up the
voltages across rO and RD and equate the result to
RD IX + rO[IX −(gm + gmb)VX] = VX
(3.115)
rO
RD
VDD
Vb
M1
V1
rO
gmbVbs
gmV1
RD
(a)
(b)
Rin
IX
VX
IX
Figure 3.53
(a) Input resistance of a CG stage; (b) small-signal equivalent circuit.

80
Chap. 3
Single-Stage Ampliﬁers
Thus,
VX
IX
=
RD + rO
1 + (gm + gmb)rO
(3.116)
≈
RD
(gm + gmb)rO
+
1
gm + gmb
(3.117)
if (gm + gmb)rO ≫1. This result reveals that the drain impedance is divided by (gm + gmb)rO when seen
at the source. This is particularly important in short-channel devices because of their low intrinsic gain.
Two special cases of (3.116) are worth studying. First, suppose RD = 0. Then,
VX
IX
=
rO
1 + (gm + gmb)rO
(3.118)
=
1
1
rO
+ gm + gmb
(3.119)
which is simply the impedance seen at the source of a source follower, a predictable result because if
RD = 0, the circuit conﬁguration is the same as in Fig. 3.39(a).
Second, let us replace RD with an ideal current source. Equation (3.117) predicts that the input
impedance approaches inﬁnity. While somewhat surprising, this result can be explained with the aid of
Fig. 3.54. Since the total current through the transistor is ﬁxed and equal to I1, a change in the source
potential cannot change the device current, and hence IX = 0. In other words, the input impedance of a
common-gate stage is relatively low only if the load impedance connected to the drain is small.
rO
VDD
Vb
M1
VX
IX
I1
Figure 3.54
Input resistance of a CG
stage with ideal current-source load.
▲
Example3.19
Calculate the voltage gain of a common-gate stage with a current-source load [Fig. 3.55(a)].
Solution
Letting RD approach inﬁnity in (3.111), we have
Av = (gm + gmb)rO + 1
(3.120)
Interestingly, the gain does not depend on RS. From our foregoing discussion, we recognize that if RD →∞, so
does the impedance seen at the source of M1, and the small-signal voltage at node X becomes equal to Vin. We can
therefore simplify the circuit as shown in Fig. 3.55(b), readily arriving at (3.120).

Sec. 3.5
Common-Gate Stage
81
rO
VDD
Vb
M1
Vin
I1
Vout
(a)
(b)
RS
rO
VDD
Vb
M1
Vin
I1
Vout
X
X
Figure 3.55
▲
Our analysis of the degenerated CS stage and the CG stage gives another interesting insight. As
illustrated in Fig. 3.56, we loosely say that a transistor transforms its source resistance up and its drain
resistance down (when seen at the appropriate terminal).
rO
RD
VDD
M1
RS
M1
[1 + (gm + gmb) rO] RS
1 + (gm + gmb) rO
RD + rO 
Figure 3.56
Impedance transformation by a MOSFET.
In order to calculate the output impedance of the common-gate stage, we use the circuit in Fig. 3.57.
We note that the result is similar to that in Fig. 3.29, and hence
Rout = {[1 + (gm + gmb)rO]RS + rO}∥RD
(3.121)
rO
RS
RD
VDD
Vb
M1
VX
IX
Figure 3.57
Calculation of output
resistance of a CG stage.

82
Chap. 3
Single-Stage Ampliﬁers
▲
Example3.20
As seen in Example 3.17, the input signal of a common-gate stage may be a current rather than a voltage. Shown
in Fig. 3.58 is such an arrangement. Calculate Vout/Iin and the output impedance of the circuit if the input current
source exhibits an output impedance equal to RP.
RD
Vout
Vb
VDD
Iin
RP
Figure 3.58
Solution
To ﬁnd Vout/Iin, we replace Iin and RP with a Thevenin equivalent and use (3.111) to write
Vout
Iin
=
(gm + gmb)rO + 1
rO + (gm + gmb)rO RP + RP + RD
RD RP
(3.122)
The output impedance is simply equal to
Rout = {[1 + (gm + gmb)rO]RP + rO}∥RD
(3.123)
▲
3.6
Cascode Stage
As mentioned in Example 3.17, the input signal of a common-gate stage may be a current. We also
know that a transistor in a common-source arrangement converts a voltage signal to a current signal. The
cascade of a CS stage and a CG stage is called a “cascode”4 topology, providing many useful properties.
Figure 3.59 shows the basic conﬁguration: M1 generates a small-signal drain current proportional to the
small-signal input voltage, Vin, and M2 simply routes the current to RD. We call M1 the input device and
M2 the cascode device. Note that in this example, M1 and M2 carry equal bias and signal currents. As
we describe the attributes of the circuit in this section, many advantages of the cascode topology over a
simple common-source stage become evident. This circuit is also known as the “telescopic” cascode.
RD
Vout
Vb
VDD
M1
M2
Vin
X
Figure 3.59
Cascode stage.
4The term cascode is believed to be the acronym for “cascaded triodes,” possibly invented in vacuum tube days.

Sec. 3.6
Cascode Stage
83
Before delving into our analysis, it is instructive to explore the circuit qualitatively. We wish to know
what happens if the value of Vin or Vb changes by a small amount. Assume that both transistors are in
saturation and λ = γ = 0. If Vin rises by V , then ID1 increases by gm1V . This change in current
ﬂows through the impedance seen at X, i.e., the impedance seen at the source of M2, which is equal to
1/gm2. Thus, VX falls by an amount given by gm1V · (1/gm2) [Fig. 3.60(a)]. The change in ID1 also
ﬂows through RD, producing a drop of gm1V RD in Vout—just as in a simple CS stage.
VDD
M2
RD
M 1
Vb
X
ΔV
ΔV
gm1
gm2
gm1 ΔV RD
VDD
M2
RD
M1
Vb
X
ΔV
VDD
M2
RD
X
ΔV
Vout
Vout
Vout
(a)
(b)
Figure 3.60
Cascode stage sensing a signal at the gate of (a) an input device and (b) a cascode device.
Now, consider the case where Vin is ﬁxed and Vb increases by V . Since VGS1 is constant and
rO1 = ∞, we simplify the circuit as shown in Fig. 3.60(b). How do VX and Vout change here? As far as
node X is concerned, M2 operates as a source follower because it senses an input, V , at its gate and
generates an output at X. With λ = γ = 0, the small-signal voltage gain of the follower is equal to unity,
regardless of the value of RD (why?). Thus, VX rises by V . On the other hand, Vout does not change
because ID2 is equal to ID1 and hence remains constant. We say that the voltage gain from Vb to Vout is
zero in this case.
Let us now study the bias conditions of the cascode, still assuming that λ = γ = 0. For M1 to operate
in saturation, we must have VX ≥Vin −VT H1. If M1 and M2 are both in saturation, M2 operates as a
source follower and VX is determined primarily by Vb: VX = Vb −VGS2. Thus, Vb −VGS2 ≥Vin −VT H1,
and hence Vb > Vin + VGS2 −VT H1 (Fig. 3.61). For M2 to be saturated, Vout ≥Vb −VT H2; that is,
Vout ≥Vin −VT H1 + VGS2 −VT H2
(3.124)
= (VGS1 −VT H1) + (VGS2 −VT H2)
(3.125)
VDD
M2
RD
Vout
M1
VTH1
Vin
Vb
X
VGS2 − VTH2 
VGS1 − VTH1 
Figure 3.61
Allowable voltages in
cascode stage.

84
Chap. 3
Single-Stage Ampliﬁers
if Vb is chosen to place M1 at the edge of saturation. Consequently, the minimum output level for which
both transistors operate in saturation is equal to the overdrive voltage of M1 plus that of M2. In other
words, addition of M2 to the circuit reduces the output voltage swing by at least the overdrive voltage of
M2. We say that M2 is “stacked” on top of M1. We also loosely say that the minimum output voltage is
equal to two overdrives or 2VD,sat.
We now analyze the large-signal behavior of the cascode stage shown in Fig. 3.59 as Vin goes from
zero to VDD. For Vin ≤VT H1, M1 and M2 are off, Vout = VDD, and VX ≈Vb −VT H2 (if subthreshold
conduction is neglected) (Fig. 3.62). As Vin exceeds VT H1, M1 begins to draw current, and Vout drops.
Since ID2 increases, VGS2 must increase as well, causing VX to fall. As Vin assumes sufﬁciently large
values, two effects can occur: (1) VX drops below Vin by VT H1, forcing M1 into the triode region; (2) Vout
drops below Vb by VT H2, driving M2 into the triode region. Depending on the device dimensions and the
values of RD and Vb, one effect may occur before the other. For example, if Vb is relatively low, M1 may
enter the triode region ﬁrst. Note that if M2 goes into the deep triode region, VX and Vout become nearly
equal.
VTH1
Vin
Vout
VDD
Vb − VTH2
VX
Figure 3.62
Input-output
characteristic of a cascode stage.
Let us now consider the small-signal characteristics of a cascode stage, assuming that both transistors
operate in saturation. If λ = 0, the voltage gain is equal to that of a common-source stage because
the drain current produced by the input device must ﬂow through the cascode device. Illustrated in the
equivalent circuit of Fig. 3.63, this result is independent of the transconductance and body effect of M2.
It can also be veriﬁed using Av = −Gm Rout.
RD
Vout
Vin
gm1V1
gm1V1
gm2V2
gmbVbs
V2
V1
Figure 3.63
Small-signal equivalent circuit of cascode stage.
▲
Example3.21
Calculate the voltage gain of the circuit shown in Fig. 3.64 if λ = 0.
Solution
The small-signal drain current of M1, gm1Vin, is divided between RP and the impedance seen looking into the source
of M2, 1/(gm2 + gmb2). Thus, the current ﬂowing through M2 is
ID2 = gm1Vin
(gm2 + gmb2)RP
1 + (gm2 + gmb2)RP
(3.126)

Sec. 3.6
Cascode Stage
85
VDD
M2
RD
Vout
M1
Vb
Vin
RP
Figure 3.64
The voltage gain is therefore given by
Av = −gm1(gm2 + gmb2)RP RD
1 + (gm2 + gmb2)RP
(3.127)
▲
M2
M1
Rout
M2
Rout
rO1
Figure 3.65
Calculation of output
resistance of cascode stage.
Nanometer Design Notes
With
a
limited
voltage
headroom,
nanometer
cascode
current
sources
are only moderately better than single
transistors. The ﬁgure shows the I-V
characteristic
of
an
NMOS
current
source before and after cascoding (gray
and black curves, respectively). Here,
W/L = 5 μm/40 nm for both devices.
We observe that for VX < 0.2 V, the
cascode has only a slightly higher
output impedance.
0
0.2
0.4
0.6
0.8
1
0
0.2
0.4
0.6
0.8
1
VX (V)
IX (mA)
Output Resistance
An important property of the cascode structure is its
high output impedance. As illustrated in Fig. 3.65, for calculation of Rout, the
circuit can be viewed as a common-source stage with a degeneration resistor
equal to rO1. Thus, from (3.66),
Rout = [1 + (gm2 + gmb2)rO2]rO1 + rO2
(3.128)
Assuming gmrO ≫1, we have Rout ≈(gm2 + gmb2)rO2rO1. That is, M2
boosts the output impedance of M1 by a factor of (gm2 + gmb2)rO2. As shown
in Fig. 3.66, cascoding can be extended to three or more stacked devices
to achieve a higher output impedance, but the required additional voltage
M2
M1
Rout
Vin
Vb1
M3
Vb2
Figure 3.66
Triple cascode.

86
Chap. 3
Single-Stage Ampliﬁers
headroom makes such conﬁgurations less attractive. For example, the minimum output voltage of a triple
cascode is equal to the sum of three overdrive voltages.
To appreciate the utility of a high output impedance, recall from the lemma in Sec. 3.3.3 that the
voltage gain can be written as −Gm Rout. Since Gm is typically determined by the transconductance of a
transistor, e.g., M1 in Fig. 3.59, and hence bears trade-offs with the bias current and device capacitances,
it is desirable to increase the voltage gain by maximizing Rout. Shown in Fig. 3.67 is an example.
If both M1 and M2 operate in saturation, then Gm ≈gm1 and Rout ≈(gm2 + gmb2)rO2rO1, yielding
Av = (gm2 + gmb2)rO2gm1rO1. Thus, the maximum voltage gain is roughly equal to the square of the
intrinsic gain of the transistors.
▲
Example3.22
Calculate the exact voltage gain of the circuit shown in Fig. 3.67.
M2
M1
Vin
Vb
I1
Vout
VDD
Figure 3.67
Cascode stage
with current-source load.
Solution
The actual Gm of the stage is slightly less than gm1 because a fraction of the small-signal current produced by M1
is shunted to ground by rO1. As depicted in Fig. 3.68(a), we short the output node to ac ground and recognize that
the impedance seen looking into the source of M2 is equal to [1/(gm2 + gmb2)]||rO2. Thus,
Iout = gm1Vin
rO1
rO1 +
1
gm2 + gmb2
rO2
(3.129)
M2
M1
Vin
Vb
I1
VDD
r
rO2
O1
Iout
M2
Vb
I1
VDD
rO1
rO2
Vout
−gm1 rO1 Vin
(a)
(b)
Figure 3.68

Sec. 3.6
Cascode Stage
87
It follows that the overall transconductance is equal to
Gm =
gm1rO1[rO2(gm2 + gmb2) + 1]
rO1rO2(gm2 + gmb2) + rO1 + rO2
(3.130)
and hence the voltage gain is given by
|Av| = Gm Rout
(3.131)
= gm1rO1[(gm2 + gmb2)rO2 + 1]
(3.132)
If we had assumed that Gm ≈gm1, then |Av| ≈gm1{[1 + (gm2 + gmb2)rO2]rO1 + rO2}.
Another approach to calculating the voltage gain is to replace Vin and M1 by a Thevenin equivalent, reducing the
circuit to a common-gate stage. Illustrated in Fig. 3.68(b), this method in conjunction with (3.111) gives the same
result as (3.132).
▲
It is also interesting to compare the increase in the output impedance due to cascoding with that due to
increasing the length of the input transistor for a given bias current (Fig. 3.69). Suppose, for example, that
the length of the input transistor of a CS stage is quadrupled while the width remains constant. Then, since
ID = (1/2)μnCox(W/L)(VGS −VT H)2, the overdrive voltage is doubled, and the transistor consumes
the same amount of voltage headroom as does a cascode stage. That is, the circuits of Figs. 3.69(b) and
(c) impose equal voltage swing constraints.
ID
ID
W
4L
ID
W
L
W
L
W
L
Vb2
(a)
(b)
(c)
Vin
Vin
Vin
M1
M1
M1
M2
Figure 3.69
Increasing output impedance by increasing the device length or cascoding.
Now consider the output impedance achieved in each case. Since
gmrO =

2μnCox
W
L ID
1
λID
(3.133)
and λ ∝1/L, quadrupling L only doubles the value of gmrO while cascoding results in an output
impedance of roughly gmr2
O. Note that the transconductance of M1 in Fig. 3.69(b) is half that in
Fig. 3.69(c), degrading the performance. In other words, for a given voltage headroom, the cascode
structure provides a higher output impedance.
A cascode structure need not operate as an ampliﬁer. Another popular application of this topology is in
building constant current sources. The high output impedance yields a current source closer to the ideal,
but at the cost of voltage headroom. For example, current source I1 in Fig. 3.67 can be implemented as
a PMOS cascode (Fig. 3.70), exhibiting an impedance equal to [1 + (gm3 + gmb3)rO3]rO4 + rO3.
We calculate the voltage gain with the aid of the lemma illustrated in Fig. 3.32. Writing Gm ≈gm1,
we note that Rout is now equal to the parallel combination of the NMOS cascode output impedance and
the PMOS cascode output impedance:
Rout = {[1 + (gm2 + gmb2)rO2]rO1 + rO2}∥{[1 + (gm3 + gmb3)rO3]rO4 + rO3}
(3.134)

88
Chap. 3
Single-Stage Ampliﬁers
M2
M1
Vin
Vb1
Vout
VDD
Vb2
Vb3
M3
M4 Cascode
Current
Source
Figure 3.70
NMOS cascode ampliﬁer
with PMOS cascode load.
The gain is given by |Av| ≈gm1Rout. For typical values, we approximate the voltage gain as
|Av| ≈gm1[(gm2rO2rO1)∥(gm3rO3rO4)]
(3.135)
▲
Example3.23
How much voltage swing can the cascode ampliﬁer of Fig. 3.70 support at the output?
Solution
Recall from Fig. 3.61 that Vb1 can be chosen low enough to place M1 at the edge of saturation, Vb1 = VGS2 +
(VGS1 −VT H1), allowing a minimum value of (VGS2 −VT H2) + (VGS1 −VT H1) for Vout. Similarly, Vb2 can be
chosen high enough to bias M4 at the edge of saturation: Vb2 +|VGS3| = VDD −|VGS4 −VT H4|. This choice allows
a maximum value of VDD −|VGS4 −VT H4| −|VGS3 −VT H3| for Vout. Thus, the total allowable voltage swing at
the output is equal to
Vout,max −Vout,min = VDD −(VGS1 −VT H1) −(VGS2 −VT H2) −|VGS3 −VT H3| −|VGS4 −VT H4|
(3.136)
We loosely say that the output swing is equal to VDD minus four overdrives or 4VD,sat.
▲
We should caution the reader that the dc value at the output of the cascode ampliﬁer shown in Fig. 3.70
is poorly deﬁned because two possibly unequal high-impedance current sources are placed in series.
(What happens if two unequal ideal current sources appear in series?) For this reason, the circuit must be
biased in a negative-feedback loop.
Poor Man’s Cascode
A “minimalist” cascode current source omits the bias voltage necessary for the
cascode device. Shown in Fig. 3.71, this “poor man’s cascode” places M2 in the triode region because
VGS1 > VT H1 and VDS2 = VGS2 −VGS1 < VGS2 −VT H2. In fact, if M1 and M2 have identical dimensions,
it can be proved that the structure is equivalent to a single transistor having twice the length—not really
a cascode.
M2
M1
Figure 3.71
Poor man’s cascode.

Sec. 3.6
Cascode Stage
89
In modern CMOS technologies, however, transistors with different threshold voltages are available,
allowing M2 to operate in saturation if M1 has a lower threshold than M2. For example, if VT H2 −VT H1 =
150 mV and if VGS1 −VT H1 < 100 mV, then M2 is saturated and the circuit acts as a true cascode.
Shielding Property
Recall from Fig. 3.30 that the high output impedance arises from the fact that if the
output-node voltage is changed by V , the resulting change at the source of the cascode device is much
less. In a sense, the cascode transistor “shields” the input device from voltage variations at the output.
The shielding property of cascodes proves useful in many circuits.
▲
Example3.24
Two identical NMOS transistors are used as constant current sources in a system [Fig. 3.72(a)]. However, due to the
internal circuitry of the system, VX is higher than VY by V .
(a) Calculate the resulting difference between ID1 and ID2 if λ ̸= 0.
(b) Add cascode devices to M1 and M2 and repeat part (a).
Analog
System
M1
Vb
ID1
ID2
M2
Analog
System
M1
Vb1
ID1
ID2
M2
X
Y
X
Y
M3
M4
Vb2
P
Q
(a)
(b)
Figure 3.72
Solution
(a) We have
ID1 −ID2 = 1
2μnCox
W
L (Vb −VT H)2(λVDS1 −λVDS2)
(3.137)
= 1
2μnCox
W
L (Vb −VT H)2(λV )
(3.138)
(b) As shown in Fig. 3.72(b), cascoding reduces the effect of VX and VY upon ID1 and ID2, respectively. As
depicted in Fig. 3.30 and implied by Eq. (3.69), a difference V between VX and VY translates to a difference VP Q
between P and Q equal to
VP Q = V
rO1
[1 + (gm3 + gmb3)rO3]rO1 + rO3
(3.139)
≈
V
(gm3 + gmb3)rO3
(3.140)
Thus,
ID1 −ID2 = 1
2μnCox
W
L (Vb −VT H)2
λV
(gm3 + gmb3)rO3
(3.141)
In other words, cascoding reduces the mismatch between ID1 and ID2 by a factor of (gm3 + gmb3)rO3.
▲

90
Chap. 3
Single-Stage Ampliﬁers
Nanometer Design Notes
Let us implement a cascode stage
with (W/L)NMOS
=
10 μm/40 nm,
(W/L)PMOS = 20 μm/40 nm, and I D =
0.3 mA. The ﬁgure plots the input-output
characteristic of the circuit, displaying
nonlinearity at the extremes of Vout.
How do we quantify this nonlinearity?
We can say that the output swing should
not cause, say, more than a 20% drop
in the small-signal voltage gain. Plotting
the derivative of the characteristic in the
ﬁgure, we observe that the allowable
single-ended peak-to-peak output swing
is about 0.5 V if the gain must remain
greater than 10. We also note that the
gain is fairly low, dictating longer PMOS
devices if a higher gain is necessary.
0.35
0.4
0.45
0.5
0
0.2
0.4
0.6
0.8
1
Vin (V)
Vout (V)
0.35
0.4
0.45
0.5
–15
–10
–5
0
Vin (V)
Av
The shielding property of cascodes diminishes if the cascode device enters
the triode region. To understand why, let us consider the circuit in Fig. 3.73,
assuming that VX decreases from a large positive value. As VX falls below
Vb2 −VT H2, M2 enters the triode region and requires a greater gate-source
overdrive so as to sustain the current drawn by M1. We can write
ID2 = 1
2μnCox
W
L

2
[2(Vb2 −VP −VT H2)(VX −VP) −(VX −VP)2]
(3.142)
concluding that as VX decreases, VP also drops, so that ID2 remains constant.
In other words, variation of VX is less attenuated as it appears at P. If VX falls
sufﬁciently, VP goes below Vb1 −VT H1, driving M1 into the triode region.
M2
M1
Vb1
Vb2
VX
P
Figure 3.73
Output swing of
cascode stage.
3.6.1 Folded Cascode
The idea behind the cascode structure is to convert the input voltage to a current
and apply the result to a common-gate stage. However, the input device and
the cascode device need not be of the same type. For example, as depicted
in Fig. 3.74(a), a PMOS-NMOS combination performs the same function. In
order to bias M1 and M2, a current source must be added as in Fig. 3.74(b).
Note that |ID1| + ID2 is equal to I1 and hence constant. The small-signal
operation is as follows. If Vin becomes more positive, |ID1| decreases, forcing
ID2 to increase and hence Vout to drop. The voltage gain and output impedance
of the circuit can be obtained as calculated for the NMOS-NMOS cascode of
Fig. 3.59. Shown in Fig. 3.74(c) is an NMOS-PMOS cascode. The advantages
and disadvantages of these types will be explained later.
RD
Vout
Vb
VDD
M2
M1
Vin
gm1Vin
RD
Vout
Vb
VDD
M2
M1
Vin
I1
(a)
(b)
M1
RD
Vout
I1
VDD
Vin
Vb
(c)
X
M2
Figure 3.74
(a) Simple folded cascode; (b) folded cascode with proper biasing; (c) folded cascode with NMOS
input.

Sec. 3.6
Cascode Stage
91
The structures of Figs. 3.74(b) and (c) are called “folded cascode” stages because the small-signal
current is “folded” up [in Fig. 3.74(b)] or down [in Fig. 3.74(c)]. We should mention as a point of contrast
that the bias current of M1 in Fig. 3.70 ﬂows through M2, i.e., it is “reused,” whereas those of M1 and M2
in Fig. 3.74(b) add up to I1. Thus, the total bias current in this case must be higher than that in Fig. 3.70
to achieve a comparable performance.
It is instructive to examine the large-signal behavior of a folded-cascode stage. Suppose that in
Fig. 3.74(b), Vin decreases from VDD to zero. For Vin > VDD −|VT H1|, M1 is off and M2 carries
all of I1,5 yielding Vout = VDD −I1RD. For Vin < VDD −|VT H1|, M1 turns on in saturation, giving
ID2 = I1 −1
2μpCox
W
L

1
(VDD −Vin −|VT H1|)2
(3.143)
As Vin drops, ID2 decreases further, falling to zero if ID1 = I1. This occurs at Vin = Vin1 if
1
2μpCox
W
L

1
(VDD −Vin1 −|VT H1|)2 = I1
(3.144)
Thus,
Vin1 = VDD −

2I1
μpCox(W/L)1
−|VT H1|
(3.145)
If Vin falls below this level, ID1 tends to be greater than I1, and M1 enters the triode region so as to ensure
ID1 = I1. The result is plotted in Fig. 3.75. The reader is encouraged to determine the input voltage at
which |ID1| = ID2.
Vin
Vin
Vout
VDD
Vin1
VDD − RDI1
I1
ID2
VDD − ∣VTH1∣
∣ID1∣
Vin1
VDD − ∣VTH1∣
Figure 3.75
Large-signal characteristics of folded cascode.
What happens to VX in the above test? As ID2 drops, VX rises, reaching Vb −VT H2 for ID2 = 0. As
M1 enters the triode region, VX approaches VDD.
▲
Example3.25
Calculate the output impedance of the folded cascode shown in Fig. 3.76(a), where M3 operates as the bias current
source.
Solution
Using the simpliﬁed model in Fig. 3.76(b) and Eq. (3.66), we have
Rout = [1 + (gm2 + gmb2)rO2](rO1∥rO3) + rO2
(3.146)
5If I1 is excessively large, M2 may enter the deep triode region, possibly driving I1 into the triode region as well.

92
Chap. 3
Single-Stage Ampliﬁers
M3
Vin
VDD
Vb3
M1
Vb
M2
Rout
rO1
rO3
Vb
M2
Rout
(a)
(b)
Figure 3.76
Thus, the circuit exhibits an output impedance lower than that of a nonfolded (also called “telescopic”) cascode.
▲
In order to achieve a high voltage gain, the load of a folded cascode can be implemented as a cascode
itself (Fig. 3.77). This structure is studied more extensively in Chapter 9.
Vin
M1
Vb
M2
VDD
Vb2
Vb3
M4
M5
Vout
I1
Load
Figure 3.77
Folded cascode with
cascode load.
Throughout this chapter, we have attempted to increase the output resistance of voltage ampliﬁers so
as to obtain a high gain. This may seem to make the speed of the circuit quite susceptible to the load
capacitance. However, as explained in Chapter 8, a high output impedance per se does not pose a serious
issue if the ampliﬁer is placed in a proper feedback loop.
3.7
Choice of Device Models
In this chapter, we have developed various expressions for the properties of single-stage ampliﬁers.
For example, the voltage gain of a degenerated common-source stage can be as simple as −RD/(RS+g−1
m )
or as complex as Eq. (3.77). How does one choose a sufﬁciently accurate device model or
expression?
The proper choice is not always straightforward, and making it is a skill gained through practice,
experience, and intuition. However, some general principles in choosing the model for each transistor
can be followed. First, break the circuit down into a number of familiar topologies. Next, concentrate
on each subcircuit and use the simplest transistor model (a single voltage-dependent current source for

Problems
93
FETs operating in saturation) for all transistors. If the drain of a device is connected to a high impedance
(e.g., the drain of another), then add rO to its model. At this point, the basic properties of most circuits
can be determined by inspection. In a second, more accurate iteration, the body effect of devices whose
source or bulk is not at ac ground can be included as well.
For bias calculations, it is usually adequate to neglect channel-length modulation and body effect
in the ﬁrst pass. These effects do introduce some error, but they can be included in the next iteration
step—after the basic properties are understood.
In today’s analog design, simulation of circuits is essential because the behavior of short-channel
MOSFETs cannot be predicted accurately by hand calculations. Nonetheless, if the designer avoids a
simple and intuitive analysis of the circuit and hence skips the task of gaining insight, then he/she cannot
interpret the simulation results intelligently. For this reason, we say, “Don’t let the computer think for
you.” Some say, “Don’t be a SPICE monkey.”
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that
VDD = 3 V where necessary. All device dimensions are effective values and in microns.
3.1.
For the circuit of Fig. 3.13, calculate the small-signal voltage gain if (W/L)1 = 50/0.5, (W/L)2 = 10/0.5,
and ID1 = ID2 = 0.5 mA. What is the gain if M2 is implemented as a diode-connected PMOS device
(Fig. 3.16)?
3.2.
In the circuit of Fig. 3.18, assume that (W/L)1 = 50/0.5, (W/L)2 = 50/2, and ID1 = ID2 = 0.5 mA when
both devices are in saturation. Recall that λ ∝1/L.
(a) Calculate the small-signal voltage gain.
(b) Calculate the maximum output voltage swing while both devices are saturated.
3.3.
In the circuit of Fig. 3.4(a), assume that (W/L)1 = 50/0.5, RD = 2 k, and λ = 0.
(a) What is the small-signal gain if M1 is in saturation and ID = 1 mA?
(b) What input voltage places M1 at the edge of the triode region? What is the small-signal gain under this
condition?
(c) What input voltage drives M1 into the triode region by 50 mV? What is the small-signal gain under this
condition?
3.4.
Suppose the common-source stage of Fig. 3.4(a) is to provide an output swing from 1 V to 2.5 V. Assume that
(W/L)1 = 50/0.5, RD = 2 k, and λ = 0.
(a) Calculate the input voltages that yield Vout = 1 V and Vout = 2.5 V.
(b) Calculate the drain current and the transconductance of M1 for both cases.
(c) How much does the small-signal gain, gm RD, vary as the output goes from 1 V to 2.5 V? (Variation of
small-signal gain can be viewed as nonlinearity.)
3.5.
Calculate the intrinsic gain of an NMOS device and a PMOS device operating in saturation with W/L = 50/0.5
and |ID| = 0.5 mA. Repeat these calculations if W/L = 100/1.
3.6.
Assuming a constant L, plot the intrinsic gain of a satuated device versus the gate-source voltage if (a) the
drain current is constant, (b) W is constant.
3.7.
Assuming a constant L, plot the intrinsic gain of a saturated device versus W/L if (a) the gate-source voltage
is constant, (b) the drain current is constant.
3.8.
An NMOS transistor with W/L = 50/0.5 is biased with VG = +1.2 V and VS = 0. The drain voltage is
varied from 0 to 3 V.
(a) Assuming the bulk voltage is zero, plot the intrinsic gain versus VDS.
(b) Repeat part (a) for a bulk voltage of −1 V.
3.9.
For an NMOS device operating in saturation, plot gm, rO, and gmrO as the bulk voltage goes from 0 to −∞
while other terminal voltages remain constant.

94
Chap. 3
Single-Stage Ampliﬁers
3.10. Consider the circuit of Fig. 3.13 with (W/L)1 = 50/0.5 and (W/L)2 = 10/0.5. Assume that λ = γ = 0.
(a) At what input voltage is M1 at the edge of the triode region? What is the small-signal gain under this
condition?
(b) What input voltage drives M1 into the triode region by 50 mV? What is the small-signal gain under this
condition?
3.11. Repeat Problem 3.10 if body effect is not neglected.
3.12. In the circuit of Fig. 3.17, (W/L)1 = 20/0.5, I1 = 1 mA, and IS = 0.75 mA. Assuming λ = 0, calculate
(W/L)2 such that M1 is at the edge of the triode region. What is the small-signal voltage gain under this
condition?
3.13. Plot the small-signal gain of the circuit shown in Fig. 3.17 as IS goes from 0 to 0.75I1. Assume that M1 is
always saturated, and neglect channel-length modulation and body effect.
3.14. The circuit of Fig. 3.18 is designed to provide an output voltage swing of 2.2 V with a bias current of 1 mA
and a small-signal voltage gain of 100. Calculate the dimensions of M1 and M2.
3.15. Sketch Vout versus Vin for the circuits of Fig. 3.78 as Vin varies from 0 to VDD. Identify important transition
points.
(c)
(a)
(b)
(d)
(e)
M1
Vb
Vout
Vin
RD
RF
M1
Vin
RD
VDD
VDD
Vout
RF
M1
RD
VDD
Vout
Vin
RS
M1
RD
VDD
Vout
Vin
RS
M1
VDD
Vin
RS
RF
Vout
Figure 3.78
3.16. Sketch Vout versus Vin for the circuits of Fig. 3.79 as Vin varies from 0 to VDD. Identify important transition
points.
3.17. Sketch Vout versus Vin for the circuits of Fig. 3.80 as Vin varies from 0 to VDD. Identify important transition
points.
3.18. Sketch IX versus VX for the circuits of Fig. 3.81 as VX varies from 0 to VDD. Identify important transition
points.
3.19. Sketch IX versus VX for the circuits of Fig. 3.82 as VX varies from 0 to VDD. Identify important transition
points.

Problems
95
M1
Vin
Vb
RD
VDD
M2
Vout
M1
Vb
RD
VDD
M2
Vout
(c)
(a)
(b)
(d)
Vin
M1
VDD
Vout
M2
R1
R2
M1
Vb1
VDD
Vout
M2
Vb2
Vin
Vin
RS
Figure 3.79
(c)
(a)
(b)
(d)
M1
VDD
Vout
M2
Vin
Vb
M2
VDD
Vout
M1
Vb1
Vin
Vb2
M3
M2
VDD
Vout
M1
Vb1
Vb2
M3
Vin
M2
VDD
Vout
M1
Vb1
Vb2
M3
Vin
Figure 3.80

96
Chap. 3
Single-Stage Ampliﬁers
M1
VDD
(c)
(a)
VDD
M2
R1
VX
IX
RD
Vb
VX
R2
IX
M1
RD
VDD
VX
IX
RS
Vb
(b)
Figure 3.81
VDD
M1
Vb2
M2
Vb1
VX
IX
M1
VDD
M2
VX
IX
M2
VDD
M1
Vb1
Vb2
M3
VX
IX
Vb3
M2
M1
Vb1
Vb2
VX
IX
I1
VDD
M1
VDD
VX
IX
Vb
M2
M1
VDD
VX
IX
M2
R1
(a)
(b)
(c)
(d)
(e)
(f)
Vb1
Vb2
Figure 3.82
3.20. Assuming all MOSFETs are in saturation, calculate the small-signal voltage gain of each circuit in Fig. 3.83
(λ ̸= 0, γ = 0).
3.21. Assuming all MOSFETs are in saturation, calculate the small-signal voltage gain of each circuit in Fig. 3.84
(λ ̸= 0, γ = 0).
3.22. Sketch VX and VY as a function of time for each circuit in Fig. 3.85. The initial voltage across C1 is equal
to VDD.
3.23. In the cascode stage of Fig. 3.59, assume that (W/L)1 = 50/0.5, (W/L)2 = 10/0.5, ID1 = ID2 = 0.5 mA,
and RD = 1 k.
(a) Choose Vb such that M1 is 50 mV away from the triode region.
(b) Calculate the small-signal voltage gain.
(c) Using the value of Vb found in part (a), calculate the maximum output voltage swing. Which device enters
the triode region ﬁrst as Vout falls?
(d) Calculate the swing at node X for the maximum output swing obtained above.

Problems
97
(c)
(a)
(b)
(d)
M1
Vin
RD
VDD
Vout
RF
M2
VDD
Vout
M1
M1
R2
VDD
Vout
R1
Vb
Vin
M1
Vin
VDD
Vout
M2
RD
Vin
Vout
M2
RS
VDD
M1
(e)
Vin
Figure 3.83
(c)
(a)
(b)
(d)
(e)
(f)
(g)
M2
VDD
Vout
M1
M3
Vin
M2
VDD
Vout
M1
M3
Vin
M2
VDD
Vout
M1
Vb1
Vb2
M3
Vin
M2
VDD
Vout
M1
Vb1
Vb2
M3
Vin
M2
VDD
Vout
M1
Vb1
Vin
M3
M1
VDD
Vb1
M3
M2
Vb3
Vb2
Vin
M2
VDD
M1
Vb1
Vin
M3
(h)
Vout
Vout
M2
VDD
M1
Vin
M3
I1
Vout
Figure 3.84

98
Chap. 3
Single-Stage Ampliﬁers
(c)
(a)
(b)
VDD
M1
Vb1
C1
C1
VDD
Vb2
M2
X
Y
M1
Vb1
Vb2
M2
X
VDD
Y
Vb1
Vb2
M2
X
C1
VDD
Y
M1
Figure 3.85
3.24. Consider the circuit of Fig. 3.23 with (W/L)1 = 50/0.5, RD = 2 k, and RS = 200 .
(a) Calculate the small-signal voltage gain if ID = 0.5 mA.
(b) Assuming λ = γ = 0, calculate the input voltage that places M1 at the edge of the triode region. What is
the gain under this condition?
3.25. Suppose the circuit of Fig. 3.22 is designed for a voltage gain of 5. If (W/L)1 = 20/0.5, ID1 = 0.5 mA, and
Vb = 0 V:
(a) Calculate the aspect ratio of M2.
(b) What input level places M1 at the edge of the triode region? What is the small-signal gain under this
condition?
(c) What input level places M2 at the edge of the saturation region? What is the small-signal gain under this
condition?
3.26. Sketch the small-signal voltage gain of the circuit shown in Fig. 3.22 as Vb varies from 0 to VDD. Consider
two cases:
(a) M1 enters the triode region before M2 is saturated;
(b) M1 enters the triode region after M2 is saturated.
3.27. A source follower can operate as a level shifter. Suppose the circuit of Fig. 3.37(b) is designed to shift the
voltage level by 1 V, i.e., Vin −Vout = 1 V.
(a) Calculate the dimensions of M1 and M2 if ID1 = ID2 = 0.5 mA, VGS2 −VGS1 = 0.5 V, and λ = γ = 0.
(b) Repeat part (a) if γ = 0.45 V−1 and Vin = 2.5 V. What is the minimum input voltage for which M2
remains saturated?
3.28. Sketch the small-signal gain, Vout/Vin, of the cascode stage shown in Fig. 3.59 as Vb goes from 0 to VDD.
Assume that λ = γ = 0.
3.29. The cascode of Fig. 3.70 is designed to provide an output swing of 1.9 V with a bias current of 0.5 mA. If
γ = 0 and (W/L)1−4 = W/L, calculate Vb1, Vb2, and W/L. What is the voltage gain if L = 0.5 μm?
3.30. Consider the gate-source voltage of M1 in Fig. 3.23(a): VGS = Vin −ID RS. Determine VGS in response
to a change in Vin and show that it decreases as gm RS increases. How does this trend show that the circuit
becomes more linear?
3.31. Prove that the voltage gain from VDD to Vout in Fig. 3.21 is given by
Vout
Vin
= gm2rO2 + 1
rO2 + rO1
rO1
(3.147)
3.32. In the circuit shown in Fig. 3.86, prove that
Vout1
Vout2
= −RD
RS
(3.148)
where Vout1 and Vout2 are small-signal quantities and λ, γ > 0.

Problems
99
RD
Vout1
Vin
M1
RD
Vout2
VDD
Figure 3.86
3.33. The CG stage of Fig. 3.51(a) is designed such that its input resistance (seen at node X) matches the signal
source resistance, RS. If λ, γ > 0, prove that
Vout
Vin
= 1 + (gm + gmb)rO
2 +

1 + rO
RD

(3.149)
Also, prove that
Vout
Vin
= RD
2RS
(3.150)
3.34. Calculate the voltage gain of a source follower using the lemma Av = −Gm Rout. Assume that the circuit
drives a load resistance of RL and λ, γ > 0.
3.35. Calculate the voltage gain of a common-gate stage using the lemma Av = −Gm Rout. Assume a source
resistance of RS and λ, γ > 0.
3.36. How many ampliﬁer topologies can you create using each of the structures shown in Fig. 3.87 and no other
transistors? (The source and drain terminals can be swapped.)
M2
M1
M1
(a)
(b)
M2
Figure 3.87

CHAPTER
4
Differential Ampliﬁers
The differential ampliﬁer is among the most important circuit inventions, dating back to the vacuum tube
era. Offering many useful properties, differential operation has become the de facto choice in today’s
high-performance analog and mixed-signal circuits.
This chapter deals with the analysis and design of CMOS differential ampliﬁers. Following a review
of single-ended and differential operation, we describe the basic differential pair and analyze both the
large-signal and the small-signal behavior. Next, we introduce the concept of common-mode rejection
and formulate it for differential ampliﬁers. We then study differential pairs with diode-connected and
current-source loads as well as differential cascode stages. Finally, we describe the Gilbert cell.
4.1
Single-Ended and Differential Operation
A “single-ended” signal is deﬁned as one that is measured with respect to a ﬁxed potential, usually the
ground [Fig. 4.1(a)]. A differential signal is deﬁned as one that is measured between two nodes that
have equal and opposite signal excursions around a ﬁxed potential [Fig. 4.1(b)]. In the strict sense, the
two nodes must also exhibit equal impedances to that potential. The “center” potential in differential
signaling is called the “common-mode” (CM) level. It is helpful to view the CM level as the bias value
of the voltages, i.e., the value in the absence of signals.
The speciﬁcation of signal swings in a differential system can be confusing. Suppose each single-
ended output in Fig. 4.1(b) has a peak amplitude of V0. Then, the single-ended peak-to-peak swing is
2V0 and the differential peak-to-peak swing is 4V0. For example, if the voltage at X (with respect to
ground) is V0 cos ωt + VC M and that at Y is −V0 cos ωt + VC M, then the peak-to-peak swing of VX −VY
(=2V0 cos ωt) is 4V0. It is therefore not surprising that a circuit with a supply voltage of 1 V can deliver
a peak-to-peak differential swing of 1.6 V.
An important advantage of differential operation over single-ended signaling is higher immunity to
“environmental” noise. Consider the example depicted in Fig. 4.2, where two adjacent lines in a circuit
carry a small, sensitive signal and a large clock waveform. Due to capacitive coupling between the lines,
transitions on line L2 corrupt the signal on line L1. Now suppose, as shown in Fig. 4.2(b), the sensitive
signal is distributed as two equal and opposite phases. If the clock line is placed midway between the two,
the transitions disturb the differential phases by equal amounts, leaving the difference intact. Since the
common-mode level of the two phases is disturbed, but the differential output is not corrupted, we say
that this arrangement “rejects” common-mode noise.1
1It is also possible to place a “shield” line between the sensitive line and the clock line (Chapter 19).
100

Sec. 4.1
Single-Ended and Differential Operation
101
ZS
ZS
ZS
Vin
Vin1
Vin2
Vout
Vout
t
t
t
(a)
(b)
CM
Level
X
Y
V0
Figure 4.1
(a) Single-ended and (b) differential signals.
M1
VX
CK
L1
Signal Line
M1
VX
M2
V
CK
L1
L2
L3
Y
(a)
(b)
Clock Line
L2
Line–to–Line
Capacitance
Figure 4.2
(a) Corruption of a signal due to coupling; (b) reduction of coupling by differential operation.
Another example of common-mode rejection occurs with noisy supply voltages. In the CS stage of
Fig. 4.3(a), if VDD varies by V , then Vout changes by approximately the same amount, i.e., the output is
quite susceptible to noise on VDD. Now consider the circuit in Fig. 4.3(b). Here, if the circuit is symmetric,
noise on VDD affects VX and VY, but not VX −VY = Vout. Thus, the circuit of Fig. 4.3(b) is much more
robust in dealing with supply noise.
M1
RD
Vout
VDD
M1
M2
RD
RD
VX
VY
VDD
(a)
(b)
X
Y
Figure 4.3
Effect of supply noise on (a) a single-ended circuit and (b) a differential circuit.
Thus far, we have seen the importance of employing differential paths for sensitive signals (“victims”).
It is also beneﬁcial to employ differential distribution for noisy lines (“aggressors”). For example, suppose
the clock signal of Fig. 4.2 is distributed in differential form on two lines (Fig. 4.4). Then, with perfect
symmetry, the components coupled from CK and CK to the signal line cancel each other.

102
Chap. 4
Differential Ampliﬁers
M1
VX
CK
L2
L1
L3
CK
Figure 4.4
Reduction of coupled noise by differential operation.
▲
Example4.1
If differential victims or differential aggressors improve the overall noise immunity, can we choose differential phases
for both victims and aggressors?
Solution
Yes, we can. Let us consider the arrangement shown in Fig. 4.5(a), where the differential victims are surrounded by
the differential aggressors. Unfortunately, in this case, V +
out −V −
out is corrupted because V +
out and V −
out experience
opposite jumps.
(a)
(b)
CK
CK
CK
CK
Vout
Vout
Vout
Vout
Figure 4.5
Now, suppose we modify the routing as depicted in Fig. 4.5(b), where V +
out (V −
out) is adjacent to CK (CK) for half
of the distance and to CK (CK) for the other half. In this case, the couplings from CK and CK cancel each other.
Interestingly, V +
out and V −
out are free from the coupling—and so is their difference. This geometry is an example of
“twisted pairs.”
▲
Another useful property of differential signaling is the increase in maximum achievable voltage swings.
In the circuit of Fig. 4.3, for example, the maximum output swing at X or Y is equal to VDD−(VGS−VT H),
whereas for VX −VY, the peak-to-peak swing is equal to 2[VDD −(VGS −VT H)]. Other advantages of
differential circuits over their single-ended counterparts include simpler biasing and higher linearity
(Chapter 14).
While differential circuits may occupy about twice as much area as single-ended alternatives, in
practice this is a minor drawback. The numerous advantages of differential operation by far outweigh the
possible increase in the area.

Sec. 4.2
Basic Differential Pair
103
4.2
Basic Differential Pair
How do we amplify a differential signal? As suggested by the observations in the previous section, we
may incorporate two identical single-ended signal paths to process the two phases [Fig. 4.6(a)]. Here,
two differential inputs, Vin1 and Vin2, having a certain CM level, Vin,C M, are applied to the gates. The
outputs are also differential and swing around the output CM level, Vout,C M. Such a circuit indeed offers
some of the advantages of differential signaling: high rejection of supply noise, higher output swings, etc.
But what happens if Vin1 and Vin2 experience a large common-mode disturbance or simply do not have a
well-deﬁned common-mode dc level? As the input CM level, Vin,C M, changes, so do the bias currents of
M1 and M2, thus varying both the transconductance of the devices and the output CM level. The variation
of the transconductance, in turn, leads to a change in the small-signal gain, while the departure of the
output CM level from its ideal value lowers the maximum allowable output swings. For example, as
shown in Fig. 4.6(b), if the input CM level is excessively low, the minimum values of Vin1 and Vin2 may
in fact turn off M1 and M2, leading to severe clipping at the output. Thus, it is important that the bias
currents of the devices have minimal dependence on the input CM level.
M1
M2
X
Y
VDD
RD
Vin1
Vin2
t
t
Vin1
Vin2
RD
Vout2
Vout1
Vout1
Vout2
t
t
Vin1
Vin2
Vout1
Vout2
(a)
(b)
Vin,CM
Vin,CM
Vout,CM
Vout,CM
M2 turns off
M1 turns off
VDD
VDD
Figure 4.6
(a) Simple differential circuit; (b) illustration of sensitivity to the input common-mode level.
VDD
M1
M2
RD1
RD2
X
Y
Vin1
Vout1
Vin2
Vout2
ISS
RD1 = RD2 = RD
Figure 4.7
Basic differential pair.
A simple modiﬁcation can resolve the above issue. Shown in Fig. 4.7, the “differential pair”2 employs
a current source ISS to make ID1 + ID2 independent of Vin,C M. Thus, if Vin1 = Vin2, the bias current of
2Also called a “source-coupled” pair or (in the British literature) a “long-tailed” pair.

104
Chap. 4
Differential Ampliﬁers
each transistor equals ISS/2 and the output common-mode level is VDD −RD ISS/2. It is instructive to
study the large-signal behavior of the circuit for both differential and common-mode input variations. In
the large-signal study, we neglect channel-length modulation and body effect.
4.2.1 Qualitative Analysis
Let us assume that in Fig. 4.7, Vin1 −Vin2 varies from −∞to +∞. If Vin1 is much more negative than
Vin2, M1 is off, M2 is on, and ID2 = ISS. Thus, Vout1 = VDD and Vout2 = VDD −RD ISS. As Vin1 is
brought closer to Vin2, M1 gradually turns on, drawing a fraction of ISS from RD1 and hence lowering
Vout1. Since ID1 + ID2 = ISS, the drain current of M2 falls and Vout2 rises. As shown in Fig. 4.8(a), for
Vin1 = Vin2, we have Vout1 = Vout2 = VDD −RD ISS/2, which is the output CM level. As Vin1 becomes
more positive than Vin2, M1 carries a greater current than does M2 and Vout1 drops below Vout2. For
sufﬁciently large Vin1 −Vin2, M1 “hogs” all of ISS, turning M2 off. As a result, Vout1 = VDD −RD ISS
and Vout2 = VDD. Figure 4.8 also plots Vout1 −Vout2 versus Vin1 −Vin2. Note that the circuit contains
three differential quantities: Vin1 −Vin2, Vout1 −Vout2, and ID1 −ID2.
Vin1 – Vin2
Vin1 – Vin2
Vout1
Vout2
Vout1 – Vout2
VDD
VDD – RD ISS
–RD ISS
RD ISS
+RD ISS
(a)
(b)
2
VDD –
Vout,CM
Figure 4.8
Differential input-output characteristics of a differential pair.
The foregoing analysis reveals two important attributes of the differential pair. First, the maximum and
minimum levels at the output are well-deﬁned (VDD and VDD −RD ISS, respectively) and independent
of the input CM level. Second, as proved later, the small-signal gain (the slope of Vout1 −Vout2 versus
Vin1 −Vin2) is maximum for Vin1 = Vin2, gradually falling to zero as |Vin1 −Vin2| increases. In other
words, the circuit becomes more nonlinear as the input voltage swing increases. For Vin1 = Vin2, we say
that the circuit is in “equilibrium.”
Now let us consider the common-mode behavior of the circuit. As mentioned earlier, the role of
the tail current source is to suppress the effect of input CM level variations on the operation of M1
and M2 and the output level. Does this mean that Vin,C M can assume arbitrarily low or high values?
To answer this question, we set Vin1 = Vin2 = Vin,C M and vary Vin,C M from 0 to VDD. Figure 4.9(a)
shows the circuit with ISS implemented by an NFET. Note that the symmetry of the pair requires that
Vout1 = Vout2.
What happens if Vin,C M = 0? Since the gate potential of M1 and M2 is not more positive than their
source potential, both devices are off, yielding ID3 = 0. This indicates that M3 operates in the deep triode
region because Vb is high enough to create an inversion layer in the transistor. With ID1 = ID2 = 0, the
circuit is incapable of signal ampliﬁcation, Vout1 = Vout2 = VDD, and VP = 0.
Now suppose Vin,C M becomes more positive. Modeling M3 by a resistor as in Fig. 4.9(b), we note that
M1 and M2 turn on if Vin,C M ≥VT H. Beyond this point, ID1 and ID2 continue to increase, and VP also
rises [Fig. 4.9(c)]. In a sense, M1 and M2 constitute a source follower, forcing VP to track Vin,C M. For
a sufﬁciently high Vin,C M, the drain-source voltage of M3 exceeds VGS3 −VT H3, allowing the device to
operate in saturation. The total current through M1 and M2 then remains constant. We conclude that for
proper operation, Vin,C M ≥VGS1 + (VGS3 −VT H3).

Sec. 4.2
Basic Differential Pair
105
(a)
(b)
(c)
VDD
VDD
VDD
VDD –
RD
RD
RD
RD
RD
Vout1
Vout1,Vout2
VTH1
VTH1
VGS1 + VGS3 – VTH3
VGS1 + VGS3 – VTH3
Vout1
Vout2
ID1, ID2
VP
Vout2
Ron3
Vin,CM
Vin,CM
Vin,CM
Vin,CM
Vb
ISS
2
M1
M3
M2
M1
M2
X
P
P
Y
X
Y
VTH1
Vin,CM
Figure 4.9
(a) Differential pair sensing an input common-mode change; (b) equivalent circuit if M3 operates in
the deep triode region; (c) common-mode input-output characteristics.
What happens if Vin,C M rises further? Since Vout1 and Vout2 are relatively constant, we expect that M1
and M2 enter the triode region if Vin,C M > Vout1 + VT H = VDD −RD ISS/2 + VT H. This sets an upper
limit on the input CM level. In summary, the allowable value of Vin,C M is bounded as follows:
VGS1 + (VGS3 −VT H3) ≤Vin,C M ≤min

VDD −RD
ISS
2 + VT H, VDD

(4.1)
Beyond the upper bound, the CM characteristics of Fig. 4.9(c) do not change, but the differential gain
drops.3
▲
Example4.2
Sketch the small-signal differential gain of a differential pair as a function of the input CM level.
V2
V1
Vin,CM
VTH
Av
Figure 4.10
Solution
As shown in Fig. 4.10, the gain begins to increase as Vin,C M exceeds VT H. After the tail current source enters
saturation (Vin,C M = V1), the gain remains relatively constant. Finally, if Vin,C M is so high that the input transistors
enter the triode region (Vin,C M = V2), the gain begins to fall.
▲
3This bound assumes small differential swings at the input and the output. This point become clear later.

106
Chap. 4
Differential Ampliﬁers
With our understanding of differential and common-mode behavior of the differential pair, we can
now answer another important question: How large can the output voltage swings of a differential pair
be? Suppose the circuit is biased with input and output bias levels Vin,C M and Vout,C M, respectively, and
Vin,C M < Vout,C M. Also, assume that the voltage gain is high, that is, the input swing is much less than
the output swing. As illustrated in Fig. 4.11, for M1 and M2 to be saturated, each output can go as high
as VDD but as low as approximately Vin,C M −VT H. In other words, the higher the input CM level, the
smaller the allowable output swings. For this reason, it is desirable to choose a relatively low Vin,C M,
but, of course, no less than VGS1 + (VGS3 −VT H3). Such a choice affords a single-ended peak-to-peak
output swing of VDD −(VGS1 −VT H1) −(VGS3 −VT H3) (why?). The reader is encouraged to repeat this
analysis if the voltage gain is around unity.
VDD
X
Y
Vin1
Vin1
VTH1
VY
t
Vin2
Vin2
Vin,CM
Vout,CM
VX
RD
RD
Vb
M1
M2
M3
t
Figure 4.11
Maximum allowable output swings in a differential pair.
▲
Example4.3
Compare the maximum output voltage swings provided by a CS stage and a differential pair.
Nanometer Design Notes
Owing to both severe channel-length
modulation and limited supply voltages,
the voltage gain of nanometer differ-
ential pairs hardly exceeds 5. In this
case, the peak input swing also limits
the output swing. As shown below,
for a peak input amplitude of V0, the
minimum allowable output is equal to
Vi n,CM + V0 −VT H. This issue arises in
any circuit that has a negative gain.
t
t
VTH
V0
Input 
Waveforms
Waveforms
Output
Vin,CM
Solution
Recall from Chapter 3 that a CS stage (with resistive load) allows an output swing
of VDD minus one overdrive (VDD −VD,sat). As seen above, with proper choice
of the input CM level, a differential pair provides a maximum output swing of VDD
minus two overdrives (single-ended) or 2VDD minus four overdrives (differential)
(2VDD −4VD,sat), which is typically quite a lot larger than VDD −VD,sat.
▲
4.2.2 Quantitative Analysis
In this section, we quantify both large-signal and small-signal characteristics
of MOS differential pairs. We begin with large-signal analysis to arrive at
expressions for the plots shown in Fig. 4.8.
Large-Signal Behavior
Consider the differential pair shown in Fig. 4.12.
Our objective is to determine Vout1 −Vout2 as a function of Vin1 −Vin2. We
have Vout1 = VDD −RD1ID1 and Vout2 = VDD −RD2ID2, that is, Vout1 −
Vout2 = RD2ID2 −RD1ID1 = RD(ID2 −ID1) if RD1 = RD2 = RD. Thus, we
simply calculate ID1 and ID2 in terms of Vin1 and Vin2, assuming the circuit
is symmetric, M1 and M2 are saturated, and λ = 0. Since the voltage at node
P is equal to Vin1 −VGS1 and Vin2 −VGS2,
Vin1 −Vin2 = VGS1 −VGS2
(4.2)

Sec. 4.2
Basic Differential Pair
107
VDD
RD1
RD2
Vout1
Vout2
Vin2
ISS
P
Vin1
M1
M2
Figure 4.12
Differential pair.
For a square-law device, we have
(VGS −VT H)2 =
ID
1
2μnCox
W
L
(4.3)
and, therefore,
VGS =




2ID
μnCox
W
L
+ VT H
(4.4)
It follows from (4.2) and (4.4) that
Vin1 −Vin2 =




2ID1
μnCox
W
L
−




2ID2
μnCox
W
L
(4.5)
We wish to calculate the differential output current, ID1 −ID2. Squaring the two sides of (4.5) and
recognizing that ID1 + ID2 = ISS, we obtain
(Vin1 −Vin2)2 =
2
μnCox
W
L
(ISS −2

ID1ID2)
(4.6)
That is,
1
2μnCox
W
L (Vin1 −Vin2)2 −ISS = −2

ID1ID2
(4.7)
Squaring the two sides again and noting that 4ID1ID2 = (ID1+ID2)2−(ID1−ID2)2 = I 2
SS −(ID1−ID2)2,
we arrive at
(ID1 −ID2)2 = −1
4

μnCox
W
L
	2
(Vin1 −Vin2)4 + ISSμnCox
W
L (Vin1 −Vin2)2
(4.8)
Thus,
ID1 −ID2 = 1
2μnCox
W
L (Vin1 −Vin2)




4ISS
μnCox
W
L
−(Vin1 −Vin2)2
(4.9)
=

μnCox
W
L ISS(Vin1 −Vin2)

1 −μnCox(W/L)
4ISS
(Vin1 −Vin2)2
(4.10)
We can say that M1, M2, and the tail operate as a voltage-dependent current source producing ID1 −ID2
according to the above large-signal characteristics. As expected, ID1−ID2 is an odd function of Vin1−Vin2,

108
Chap. 4
Differential Ampliﬁers
falling to zero for Vin1 = Vin2. As |Vin1 −Vin2| increases from zero, |ID1 −ID2| increases because the
factor preceding the square root rises more rapidly than the argument in the square root drops.4
Before examining (4.9) further, it is instructive to calculate the slope of the characteristic, i.e., the
equivalent Gm of M1 and M2. Denoting the differential quantities ID1 −ID2 and Vin1 −Vin2 by ID and
Vin, respectively, the reader can show that
∂ID
∂Vin
= 1
2μnCox
W
L
4ISS
μnCoxW/L −2V 2
in

4ISS
μnCoxW/L −V 2
in
(4.11)
For Vin = 0, Gm is maximum (why?) and equal to √μnCox(W/L)ISS. Moreover, since Vout1 −Vout2 =
RDI = −RDGmVin, we can write the small-signal differential voltage gain of the circuit in the
equilibrium condition as
|Av| =

μnCox
W
L ISS RD
(4.12)
Since each transistor carries a bias current of ISS/2 in this condition, the factor √μmCox(W/L)ISS is in
fact the same as the transconductance of each device, that is, |Av| = gm RD. Equation (4.11) also suggests
that Gm falls to zero for Vin = √2ISS/(μnCoxW/L). As we will see below, this value of Vin plays
an important role in the operation of the circuit.
Let us now examine Eq. (4.9) more closely. If (Vin1 −Vin2)2 ≪4ISS/[μnCox(W/L)], then
ID1 −ID2 =

μnCox
W
L ISS(Vin1 −Vin2)
(4.13)
which yields the same equilibrium Gm as that obtained above.
But what happens for larger values of |Vin1 −Vin2|? It appears that the argument in the square root
drops to zero for Vin = √4ISS/(μnCoxW/L) and ID crosses zero at two different values of Vin,
an effect not predicted by our qualitative analysis in Fig. 4.8. This conclusion, however, is incorrect. To
understand why, recall that (4.9) was derived with the assumption that both M1 and M2 are on. In reality,
as Vin exceeds a limit, one transistor carries the entire ISS, turning off the other.5 Denoting this value
by Vin1, we have ID1 = ISS and Vin1 = VGS1 −VT H because M2 is nearly off. It follows that
Vin1 =




2ISS
μnCox
W
L
(4.14)
For Vin > Vin1, M2 is off and (4.9) and (4.10) do not hold. As mentioned above, Gm falls to zero for
Vin = Vin1. Figure 4.13 plots the behavior.
▲
Example4.4
Plot the output currents of a differential pair versus Vin as the device width and the tail current vary.
Solution
Consider the characteristic shown in Fig. 4.14(a). As W/L increases, Vin1 decreases, narrowing the input range
across which both devices are on [Fig. 4.14(b)]. As ISS increases, both the input range and the output current swing
increase [Fig. 4.14(c)]. Intuitively, we expect the circuit to become more linear as ISS increases or W/L decreases.
▲
4It is interesting to note that, even though ID1 and ID2 are square functions of their respective gate-source voltages, ID1 −ID2
is an odd function of Vin1 −Vin2. This effect is studied in Chapter 14.
5We neglect subthreshold conduction here.

Sec. 4.2
Basic Differential Pair
109
(a)
(b)
ID1
Gm
ID2
–ΔVin1
–ΔVin1
+ΔVin1
+ΔVin1
ΔVin
ΔVin
Figure 4.13
Variation of drain currents and overall transconductance of a differential pair versus input voltage.
(c)
(a)
(b)
–ΔVin1
–ΔVin1
–ΔVin1
+ΔVin1 ΔVin
+ΔVin1
+ΔVin1
ΔVin
ΔVin
ID1 – ID2
ID1 – ID2
ID1 – ID2
+ISS
+ISS
+ISS2
–ISS
–ISS
–ISS2
Figure 4.14
Nanometer Design Notes
Nanometer differential pairs exhibit a
similar relation between the equilibrium
overdrive and the differential voltage
necessary to turn one side off. Plotted
below are the output currents of a
differential pair with W/L = 5 μm/40 nm
and ISS = 0.25 mA using actual models
(black curve) and a square-law model
(gray curve). If we deﬁne cut-off as
when one transistor carries 90% of the
tail current, then the nanometer design
also displays approximately a factor of
√
2 between the equilibrium and cut-off
voltages.
−0.2
−0.1
0
0.1
0.2
0
50
100
150
200
250
Vin (V)
ID (μA)
The value of Vin1 given by (4.14) in essence represents the maximum
differential input that the circuit can “handle.” It is possible to relate Vin1
to the overdrive voltage of M1 and M2 in equilibrium. For a zero differential
input, ID1 = ID2 = ISS/2, yielding
(VGS −VT H)1,2 =




ISS
μnCox
W
L
(4.15)
Thus, Vin1 is equal to
√
2 times the equilibrium overdrive. The point is
that increasing Vin1 to make the circuit more linear inevitably increases the
overdrive voltage of M1 and M2. For a given ISS, this is accomplished only
by reducing W/L and hence the transconductance of the transistors, trading
small-signal gain for linearity. Alternatively, we can increase ISS, but at the
cost of power. (What happens to the gain if ISS is increased but ISS RD is kept
constant due to headroom constraints?)
▲
Example 4.5
Due to a manufacturing defect, the differential signals applied to a differential pair
have unequal dc levels (Fig. 4.15). If the peak swing, V0, is small and the imbalance,
VOS, happens to be equal to Vin1/2 = (1/2)√2ISS/(μnCoxW/L), sketch the output
voltage waveforms and determine the small-signal voltage gain.

110
Chap. 4
Differential Ampliﬁers
t
7
(c)
(a)
(b)
4
VDD
RD
RD
VOS
Gm
Gm1
Gm1 RDV0
ISS RD
Y
X
ISS
ΔVin
Vin1
Vin1
Vin2
VOS
V0
Vin2
t
M1
M2
VY
VX
Figure 4.15
Solution
Let us ﬁrst study the circuit with only dc inputs that differ by VOS. The differential pair senses an imbalance of
Vin1 −Vin2 = VOS and, from Eq. (4.10), generates
ID1 −ID2 =
√
7
4 ISS
(4.16)
That is, ID1 ≈0.83ISS, ID2 ≈0.17ISS and VX −VY = −(
√
7/4)ISS RD.
Now, we recognize from Fig. 4.15(b) that the input dc imbalance biases the transistors away from the highest
transconductance, yielding from Eq. (4.11)
Gm1 =
3
√
14

μnCox
W
L ISS
(4.17)
This value is about 20% less than that at equilibrium. The output waveforms are shown in Fig. 4.15(c).
▲
Small-Signal Analysis
We now study the small-signal behavior of differential pairs. As depicted in
Fig. 4.16, we apply small signals Vin1 and Vin2 and assume that M1 and M2 are saturated. What is the
differential voltage gain, (Vout1 −Vout2)/(Vin1 −Vin2)? Recall from Eq. (4.12) that this quantity equals
√μnCox ISSW/L RD. Since in the vicinity of equilibrium, each transistor carries approximately ISS/2,
this expression reduces to gm RD, where gm denotes the transconductance of M1 and M2. To arrive at the
same result by small-signal analysis, we employ two different methods, each providing insight into the
circuit’s operation. We assume that RD1 = RD2 = RD.
VDD
Vout1
Vout2
Vin2
Vin1
RD1
RD2
M1
X
Y
M2
ISS
Figure 4.16
Differential pair with
small-signal inputs.
Method I
The circuit of Fig. 4.16 is driven by two independent signals. Thus, the output can be
computed by superposition. (The voltages in this section are small-signal quantities.)

Sec. 4.2
Basic Differential Pair
111
(c)
(a)
(b)
VDD
VDD
VDD
Vin1
Vout1
Vout2
Vout1
Vout2
Vin1
Vin1
ISS
RD1
RD1
RD2
RS
RD1
VX
X
Y
Y
X
X
RD2
M1
M2
RS
M1
M1
M2
Figure 4.17
(a) Differential pair sensing one input signal; (b) circuit of (a) viewed as a CS stage degenerated by
M2; (c) equivalent circuit of (b).
Let us set Vin2 to zero and ﬁnd the effect of Vin1 at X and Y [Fig. 4.17(a)]. To obtain VX, we note that
M1 forms a common-source stage with a degeneration resistance equal to the impedance seen looking
into the source of M2 [Fig. 4.17(b)]. Neglecting channel-length modulation and body effect, we have
RS = 1/gm2 [Fig. 4.17(c)] and
VX
Vin1
=
−RD
1
gm1
+
1
gm2
(4.18)
To calculate VY, we note that M1 drives M2 as a source follower and replace Vin1 and M1 by a Thevenin
equivalent (Fig. 4.18): the Thevenin voltage VT = Vin1 and the resistance RT = 1/gm1. Here, M2 operates
as a common-gate stage, exhibiting a gain equal to
VY
Vin1
=
RD
1
gm2
+
1
gm1
(4.19)
It follows from (4.18) and (4.19) that the overall voltage gain for Vin1 is
(VX −VY)|Due to Vin1 =
−2RD
1
gm1
+
1
gm2
Vin1
(4.20)
(a)
(b)
VDD
VDD
Vout2
Vout2
Vin1
RD1
RD2
RD2
M1
M2
M2
RT
VT
Y
Y
Figure 4.18
Replacing M1 by a Thevenin equivalent.

112
Chap. 4
Differential Ampliﬁers
which, for gm1 = gm2 = gm, reduces to
(VX −VY)|Due to Vin1 = −gm RDVin1
(4.21)
By virtue of symmetry, the effect of Vin2 at X and Y is identical to that of Vin1 except for a change in
the polarities:
(VX −VY)|Due to Vin2 = gm RDVin2
(4.22)
Adding the two sides of (4.21) and (4.22) to perform superposition, we have
(VX −VY)tot
Vin1 −Vin2
= −gm RD
(4.23)
Comparison of (4.21), (4.22), and (4.23) indicates that the magnitude of the differential gain is equal
to gm RD regardless of how the inputs are applied: in Figs. 4.17 and 4.18, the input is applied to only one
side, whereas in Fig. 4.16 the input is the difference between two sources. It is also important to recognize
that if the output is single-ended, i.e., it is sensed between X or Y and ground, the gain is halved.
▲
Example4.6
Due to a manufacturing error, in the circuit of Fig. 4.19, M2 is twice as wide as M1. Calculate the small-signal gain
if the dc levels of Vin1 and Vin2 are equal.
VDD
Vout2
Vin1
Vin2
Vout1
2W
L
W
L
RD
RD
M1
M2
ISS
Figure 4.19
Solution
If the gates of M1 and M2 are at the same dc potential, then VGS1 = VGS2 and ID2 = 2ID1 = 2ISS/3. Thus,
gm1 = √2μnCox(W/L)ISS/3 and gm2 = √2μnCox(2W/L)(2ISS)/3 = 2gm1. Following the same procedure as
above, the reader can show that
|Av| =
2RD
1
gm1
+
1
2gm1
(4.24)
= 4
3 gm1RD
(4.25)
Note that, for a given ISS, this value is lower than the gain of a symmetric differential pair [Eq. (4.23)] because gm1
is smaller. The reader can show that the characteristics of Fig. 4.13 are shifted horizontally, and hence the circuit
exhibits an “offset.” We utilize this idea in Chapter 14 to linearize differential pairs.
▲

Sec. 4.2
Basic Differential Pair
113
How does the transconductance of a differential pair compare with that of a common-source stage?
For a given total bias current, the value of gm in (4.23) is 1/
√
2 times that of a single transistor biased at
ISS with the same dimensions. Thus, the total Gm is proportionally less.
Method II
If a fully-symmetric differential pair senses differential inputs (i.e., the two inputs change
by equal and opposite amounts from the equilibrium condition), then the concept of “half circuit” can be
applied. We ﬁrst prove a lemma.
Lemma
Consider the symmetric circuit shown in Fig. 4.20(a), where D1 and D2 represent any three-
terminal active device. Suppose Vin1 and Vin2 change differentially, the former from V0 to V0 + Vin and
the latter from V0 to V0 −Vin [Fig. 4.20(b)]. Then, if the circuit remains linear, VP does not change.
Assume λ = 0.
(b)
(a)
(c)
I1
IT
D1
V1
P
V2
D2
I2
Vin1
Vin1
V0
Va
Vin2
V1
V2
t
ΔVin
ΔV1
ΔV2
ΔVin
Vin2
t
Figure 4.20
Illustration of why node P is a virtual ground.
Proof.
The lemma can be proved by invoking symmetry. As long as the operation remains linear, so
that the difference between the bias currents of D1 and D2 is negligible, the circuit is symmetric. Thus,
VP cannot “favor” the change at one input and “ignore” the other.
From another point of view, the effect of D1 and D2 at node P can be represented by Thevenin
equivalents (Fig. 4.21). If VT 1 and VT 2 change by equal and opposite amounts and RT 1 and RT 2 are equal,
then VP remains constant. We emphasize that this is valid if the changes are small enough that we can
assume RT 1 = RT 2 (e.g., 1/gm1 = 1/gm2).6 This perspective suggests the lemma’s validity even if the
tail current source is not ideal.
❑
VT1
VT2
RT1
P
RT2
Figure 4.21
Replacing each half
of a differential pair by a Thevenin
equivalent.
We now offer a more formal proof. Let us assume that V1 and V2 have an equilibrium value of Va and
change by V1 and V2, respectively [Fig. 4.20(c)]. The output currents therefore change by gmV1
and gmV2. Since I1 + I2 = IT , we have gmV1 + gmV2 = 0, i.e., V1 = −V2. We also know that
Vin1 −V1 = Vin2 −V2, and hence V0 + Vin −(Va + V1) = V0 −Vin −(Va + V2). Consequently,
2Vin = V1−V2 = 2V1.Inotherwords,if Vin1 and Vin2 changeby+Vin and−Vin,respectively,
then V1 and V2 change by the same values, i.e., a differential change in the inputs is simply “absorbed” by
V1 and V2. In fact, since VP = Vin1−V1, and since V1 exhibits the same change as Vin1, VP does not change.
6It is also possible to derive an expression for the large-signal behavior of VP and prove that for small Vin1 −Vin2, VP remains
constant. We defer this calculation to Chapter 15.

114
Chap. 4
Differential Ampliﬁers
The above lemma greatly simpliﬁes the small-signal analysis of differential ampliﬁers. As shown in
Fig. 4.22, since VP experiences no change, node P can be considered “ac ground” (or a “virtual ground”),
and the circuit can be decomposed into two separate halves. We say that we have applied the “half-circuit
concept” [1]. We can write VX/Vin1 = −gm RD and VY/(−Vin1) = −gm RD, where Vin1 and −Vin1
denote the voltage change on each side. Thus, (VX −VY)/(2Vin1) = −gm RD.
(a)
(b)
VDD
X
Y
RD1
RD2
VDD
RD1
RD2
Vout2
Vout1
X
Y
Vout2
Vout1
+Vin1
+Vin1
–Vin1
–Vin1
M1
M2
M1
M2
P
ISS
Figure 4.22
Application of the half-circuit concept.
▲
Example4.7
Calculate the differential gain of the circuit of Fig. 4.22(a) if λ ̸= 0.
Solution
Applying the half-circuit concept as illustrated in Fig. 4.23, we have VX/Vin1 = −gm(RD∥rO1) and VY /(−Vin1) =
−gm(RD∥rO2), thus arriving at (VX −VY )/(2Vin1) = −gm(RD∥rO), where rO = rO1 = rO2. Note that Method I
would require lengthy calculations here.
VDD
rO1
rO2
Vout1
Vout2
+Vin1
–Vin1
RD
X
Y
RD
M1
M2
Figure 4.23
▲
The half-circuit concept provides a powerful technique for analyzing symmetric differential pairs with
fully differential inputs. But what happens if the two inputs are not fully differential [Fig. 4.24(a)]? As
depicted in Figs. 4.24(b) and (c), the two inputs Vin1 and Vin2 can be viewed as
Vin1 = Vin1 −Vin2
2
+ Vin1 + Vin2
2
(4.26)
Vin2 = Vin2 −Vin1
2
+ Vin1 + Vin2
2
(4.27)
Since the second term is common to both inputs, we obtain the equivalent circuit in Fig. 4.24(d), recogniz-
ing that the circuit senses a combination of a differential input and a common-mode variation. Therefore,
as illustrated in Fig. 4.25, the effect of each type of input can be computed by superposition, with the
half-circuit concept applied to the differential-mode operation. We deal with CM analysis in Sec. 4.3.

Sec. 4.2
Basic Differential Pair
115
(b)
(c)
(a)
(d)
Vin1
Vin2
M1
M2
M1
M2
M1
M2
M1
M2
ISS
ISS
ISS
ISS
Vin1
2
+
Vin1 – Vin2
2
Vin1 + Vin2
2
Vin2 – Vin1
2
Vin1 – Vin2
2
Vin2 – Vin1
2
Vin1 + Vin2
2
Vin1 + Vin2
2
Vin1
2
+
Vin2
2
+
Vin2
2
–
Vin2
2
+
Vin2
2
+
Vin1
2
+
Vin1
2
–
Figure 4.24
Conversion of arbitrary inputs to differential and common-mode components.
(a)
(b)
ISS
ISS
M1
M2
M1
M2
Vin1 – Vin2
2
Vin2 – Vin1
2
Vin1 + Vin2
2
Figure 4.25
Superposition for (a) differential and (b) common-mode signals.
▲
Example4.8
In the circuit of Fig. 4.22(a), calculate VX and VY if Vin1 ̸= −Vin2 and λ ̸= 0.
Solution
For differential-mode operation, we have from Fig. 4.26(a)
VX = −gm(RD∥rO1) Vin1 −Vin2
2
(4.28)
VY = −gm(RD∥rO2) Vin2 −Vin1
2
(4.29)

116
Chap. 4
Differential Ampliﬁers
That is,
VX −VY = −gm(RD∥rO)(Vin1 −Vin2)
(4.30)
which is to be expected.
For common-mode operation, the circuit reduces to that in Fig. 4.26(b). How much do VX and VY change as
Vin,C M changes? If the circuit is fully symmetric and ISS an ideal current source, the currents drawn by M1 and
M2 from RD1 and RD2 are exactly equal to ISS/2 and independent of Vin,C M. Thus, VX and VY remain equal
to VDD −RD(ISS/2) and experience no change as Vin,C M varies. Interestingly, the circuit simply ampliﬁes the
difference between Vin1 and Vin2 while eliminating the effect of Vin,C M.
(b)
(a)
VDD
VDD
RD
RD
RD
RD
rO1
rO1
rO2
rO2
Vout1
Vout1
Vout2
Vout2
X
X
Y
Y
M1
M1
M2
M2
ISS
ISS
Vin1 – Vin2
2
Vin2 – Vin1
2
Vin1 + Vin2
2
Vin,CM = 
Figure 4.26
▲
4.2.3 Degenerated Differential Pair
As with a simple common-source stage, a differential pair can incorporate resistive degeneration to
improve its linearity. Shown in Fig. 4.27(a), such a topology softens the nonlinear behavior of M1 and
M2 by RS1 and RS2. This can be seen from the input-output characteristics of Fig. 4.27(b), where, due
to degeneration, the differential voltage necessary to turn off one side increases in magnitude. We can
(a)
(b)
VDD
VDD
VDD – RD ISS
RD1
RD1 = RD2 = RD
RS1 = RS2 = RS
RD2
RS1
RS2
VX
RS = 0
RS > 0
VY
Vin1
Vin2
–ΔVin2 –ΔVin1
+ΔVin1 +ΔVin2 ΔVin
X
Y
M1
M2
ISS
VDD – RD ISS
2
Figure 4.27
(a) Degenerated differential pair, and (b) characteristics with and without degeneration.

Sec. 4.2
Basic Differential Pair
117
readily prove this point. Suppose that at Vin1 −Vin2 = Vin2, M2 turns off and ID1 = ISS. We then have
VGS2 = VT H, and hence
Vin1 −VGS1 −RS ISS = Vin2 −VT H
(4.31)
which yields
Vin1 −Vin2 = VGS1 −VT H + RS ISS
(4.32)
=




2ISS
μnCox
W
L
+ RS ISS
(4.33)
We recognize the ﬁrst term on the right-hand side as Vin1 (the input difference necessary for turning
off M2 if RS = 0). It follows that
Vin2 −Vin1 = RS ISS
(4.34)
suggesting that the linear input range is widened by approximately ±RS ISS.
The small-signal voltage gain of the degenerated differential pair can be obtained by applying the
half-circuit concept. The half circuit is simply a degenerated CS stage, exhibiting a gain of
|Av| =
RD
1
gm
+ RS
(4.35)
if λ = γ = 0. The circuit thus trades gain for linearity—as is also observed from the slopes of the
characteristics in Fig. 4.27(b). Note that Av is less sensitive to gm variations in this case.
In addition to reducing the gain, the degeneration resistors in Fig. 4.27(a) also consume voltage
headroom. In the equilibrium condition, each resistor sustains a voltage drop of RS ISS/2, as if the tail
current source itself required this much more headroom. The input common-mode level must therefore
be higher by this amount, and so must be the minimum voltage at X or Y. In other words, the maximum
allowable differential output swing is reduced by RS ISS. This issue can be resolved as shown in Fig. 4.28,
where the tail current source is split in half, with each half directly tied to a source. In equilibrium, no
current ﬂows through the degeneration resistance, and hence no headroom is sacriﬁced.7 Other methods
of linearizing differential pairs are described in Chapter 14.
VDD
RD1
2RS
RD2
ISS
2
ISS
2
X
Y
M1
M2
Figure 4.28
Degenerated differential
pair with split tail current source.
7But, as explained later in the book, the two tail current sources do contribute differential noise and offset in this case.

118
Chap. 4
Differential Ampliﬁers
4.3
Common-Mode Response
An important attribute of differential ampliﬁers is their ability to suppress the effect of common-mode
perturbations. Example 4.8 portrays an idealized case of common-mode response. In reality, neither is
the circuit fully symmetric nor does the current source exhibit an inﬁnite output impedance. As a result,
a fraction of the input CM variation appears at the output.
(a)
(b)
(c)
VDD
VDD
VDD
RSS
Vout
Vout1
Vout2
RSS
RSS
P
P
Vin,CM
Vin,CM
Vin,CM
RD
RD
RD
RD
X
X
Y
Y
M1
M1
M1
M1 + M2
M2
RD
2
Figure 4.29
(a) Differential pair sensing CM input; (b) simpliﬁed version of (a); (c) equivalent circuit of (b).
We ﬁrst assume that the circuit is symmetric, but the current source has a ﬁnite output impedance, RSS
[Fig. 4.29(a)]. As Vin,C M changes, so does VP, thereby increasing the drain currents of M1 and M2 and
lowering both VX and VY. Owing to symmetry, VX remains equal to VY and, as depicted in Fig. 4.29(b),
the two nodes can be shorted together. Since M1 and M2 are now “in parallel,” i.e., they share all of their
respective terminals, the circuit can be reduced to that in Fig. 4.29(c). Note that the composite device,
M1 + M2, has twice the width and the bias current of each of M1 and M2 and, therefore, twice their
transconductance. The “common-mode gain” of the circuit is thus equal to
Av,C M =
Vout
Vin,C M
(4.36)
= −
RD/2
1/(2gm) + RSS
(4.37)
where gm denotes the transconductance of each of M1 and M2 and λ = γ = 0.
What is the signiﬁcance of this calculation? In a symmetric circuit, input CM variations disturb the
bias points, altering the small-signal gain and possibly limiting the output voltage swings. This can be
illustrated by an example.
▲
Example4.9
The circuit of Fig. 4.30 uses a resistor rather than a current source to deﬁne a tail current of 1 mA. Assume that
(W/L)1,2 = 25/0.5, μnCox = 50 μA/V2, VT H = 0.6 V, λ = γ = 0, and VDD = 3 V.
(a) What is the required input CM voltage for which RSS sustains 0.5 V?
(b) Calculate RD for a differential gain of 5.
(c) What happens at the output if the input CM level is 50 mV higher than the value calculated in (a)?

Sec. 4.3
Common-Mode Response
119
RSS
VDD
Vout1
Vin1
1 mA
Vout2
Vin2
RD
RD
M1
M2
X
Y
Figure 4.30
Solution
(a) Since ID1 = ID2 = 0.5 mA, we have
VGS1 = VGS2 =




2ID1
μnCox
W
L
+ VT H
(4.38)
= 1.23 V
(4.39)
Thus, Vin,C M = VGS1 + 0.5 V = 1.73 V. Note that RSS = 500 .
(b) The transconductance of each device is gm = √2μnCox(W/L)ID1 = 1/(632 ), requiring RD = 3.16 k
for a gain of 5.
Note that the output bias level is equal to VDD −ID1RD = 1.42 V. Since Vin,C M = 1.73 V and VT H = 0.6 V,
the transistors are 290 mV away from the triode region.
(c) If Vin,C M increases by 50 mV, the equivalent circuit of Fig. 4.29(c) suggests that VX and VY drop by
|VX,Y | = Vin,C M
RD/2
RSS + 1/(2gm)
(4.40)
= 50 mV × 1.94
(4.41)
= 96.8 mV
(4.42)
Now, M1 and M2 are only 143 mV away from the triode region because the input CM
level has increased by 50 mV and the output CM level has decreased by 96.8 mV.
▲
Nanometer Design Notes
As a result of the low output impedance
of tail current sources in nanometer
technologies, a CM level change can
“propagate.”
Plotted
below
are
the
output
CM
levels
of
two
cascaded
differential pairs as the main input CM
level, Vi n,CM, increases, revealing a
drop in the ﬁrst and a rise in the second.
0.6
0.62
0.64
0.66
0.68
0.7
0.4
0.45
0.5
0.55
0.6
0.65
Vin, CM (V)
Output CM Level (V)
V1
V2
The foregoing discussion indicates that the ﬁnite output impedance of the
tail current source results in some common-mode gain in a symmetric differ-
ential pair. Nonetheless, this is usually a minor concern. More troublesome
is the variation of the differential output as a result of a change in Vin,C M, an
effect that occurs because in reality the circuit is not fully symmetric, i.e., the
two sides suffer from slight mismatches during manufacturing. For example,
in Fig. 4.29(a), RD1 may not be exactly equal to RD2.
We now study the effect of input common-mode variations if the circuit is
asymmetric and the tail current source suffers from a ﬁnite output impedance.
Suppose, as shown in Fig. 4.31, RD1 = RD and RD2 = RD + RD, where
RD denotes a small mismatch and the circuit is otherwise symmetric. As-
sume that λ = γ = 0 for M1 and M2. What happens to VX and VY as Vin,C M
increases? We recognize that M1 and M2 operate as one source follower,

120
Chap. 4
Differential Ampliﬁers
VDD
RD
RSS
RD + ΔRD
Vout1
Vout2
Vin,CM
X
Y
M1
M2
P
Figure 4.31
Common-mode response
in the presence of resistor mismatch.
raising VP by
VP =
RSS
RSS +
1
2gm
Vin,C M
(4.43)
Since M1 and M2 are identical, ID1 and ID2 increase by [gm/(1 + 2gm RSS)]Vin,C M, but VX and VY
change by different amounts:
VX = −Vin,C M
gm
1 + 2gm RSS
RD
(4.44)
VY = −Vin,C M
gm
1 + 2gm RSS
(RD + RD)
(4.45)
Thus, a common-mode change at the input introduces a differential component at the output. We
say that the circuit exhibits common-mode to differential conversion. This is a critical problem be-
cause if the input of a differential pair includes both a differential signal and common-mode noise,
the circuit corrupts the ampliﬁed differential signal by the input CM change. The effect is illustrated
in Fig. 4.32.
RSS
VDD
Vin,DM
Vin,CM
RD
RD + ΔRD
M1
M2
Figure 4.32
Effect of CM noise in the presence of resistor mismatch.
In summary, the common-mode response of differential pairs depends on the output impedance of
the tail current source and asymmetries in the circuit, manifesting itself through two effects: variation of
the output CM level (in the absence of mismatches) and conversion of input common-mode variations
to differential components at the output. In analog circuits, the latter effect is much more severe than the

Sec. 4.3
Common-Mode Response
121
former. For this reason, the common-mode response should usually be studied with mismatches taken
into account.
How signiﬁcant is common-mode to differential conversion? We make two observations. First, as
the frequency of the CM disturbance increases, the total capacitance shunting the tail current source
introduces larger tail current variations. Thus, even if the output resistance of the current source is high,
common-mode to differential conversion becomes signiﬁcant at high frequencies. Shown in Fig. 4.33,
this capacitance arises from the parasitics of the current source itself as well as the source-bulk junctions
of M1 and M2. Second, the asymmetry in the circuit stems from both the load resistors and the input
transistors, the latter contributing a typically much greater mismatch.
VDD
RD
RD
Vout2
Vout1
Vin,CM
X
Y
M1
C1
M2
ISS
Figure 4.33
CM response with ﬁnite
tail capacitance.
Let us study the asymmetry resulting from mismatches between M1 and M2 in Fig. 4.34(a). Owing
to dimension and threshold voltage mismatches, the two transistors carry slightly different currents and
exhibit unequal transconductances. We assume that λ = γ = 0. To calculate the small-signal gain from
Vin,C M to X and Y, we use the equivalent circuit in Fig. 4.34(b), writing ID1 = gm1(Vin,C M −VP) and
ID2 = gm2(Vin,C M −VP). Since (ID1 + ID2)RSS = VP,
(gm1 + gm2)(Vin,C M −VP)RSS = VP
(4.46)
and
VP =
(gm1 + gm2)RSS
(gm1 + gm2)RSS + 1Vin,C M
(4.47)
(a)
(b)
VDD
VDD
RSS
P
RD
RD
RD
RD
Vout1
Vin,CM
Vin,CM
RSS
P
Vout2
X
X
Y
Y
M1
gm1
gm2
M1
M2
M2
Figure 4.34
(a) Differential pair sensing CM input; (b) equivalent circuit of (a).

122
Chap. 4
Differential Ampliﬁers
We now obtain the output voltages as
VX = −gm1(Vin,C M −VP)RD
(4.48)
=
−gm1
(gm1 + gm2)RSS + 1 RDVin,C M
(4.49)
and
VY = −gm2(Vin,C M −VP)RD
(4.50)
=
−gm2
(gm1 + gm2)RSS + 1 RDVin,C M
(4.51)
The differential component at the output is therefore given by
VX −VY = −
gm1 −gm2
(gm1 + gm2)RSS + 1 RDVin,C M
(4.52)
In other words, the circuit converts input CM variations to a differential error by a factor equal to
AC M−DM = −
gm RD
(gm1 + gm2)RSS + 1
(4.53)
where AC M−DM denotes common-mode to differential-mode conversion and gm = gm1 −gm2.
▲
Example4.10
Two differential pairs are cascaded as shown in Fig. 4.35. Transistors M3 and M4 suffer from a gm mismatch of
gm, the total parasitic capacitance at node P is represented by CP, and the circuit is otherwise symmetric. What
fraction of the supply noise appears as a differential component at the output? Assume that λ = γ = 0.
Vout
RD
A
B
RD
VDD
RD
RD
X
Y
M1
M2
M3
CP
M4
P
ISS
ISS
Figure 4.35
Solution
Neglecting the capacitance at nodes A and B, we note that the supply noise appears at these nodes with no attenuation.
Substituting 1/(CPs) for RSS in (4.53) and taking the magnitude, we have
|AC M−DM| =
gm RD

1 + (gm3 + gm4)2

1
CPω

2
(4.54)
The key point is that the effect becomes more noticeable as the supply noise frequency, ω, increases.
▲

Sec. 4.4
Differential Pair with MOS Loads
123
For a meaningful comparison of differential circuits, the undesirable differential component produced
by CM variations must be normalized to the wanted differential output resulting from ampliﬁcation. We
deﬁne the “common-mode rejection ratio” (CMRR) as the desired gain divided by the undesired gain:
CMRR =

ADM
AC M−DM

(4.55)
If only gm mismatch is considered, the reader can show from the analysis of Fig. 4.17 that
|ADM| = RD
2
gm1 + gm2 + 4gm1gm2RSS
1 + (gm1 + gm2)RSS
(4.56)
and hence
CMRR = gm1 + gm2 + 4gm1gm2RSS
2gm
(4.57)
≈
gm
gm
(1 + 2gm RSS)
(4.58)
where gm denotes the mean value, that is, gm = (gm1 + gm2)/2. In practice, all mismatches must be taken
into account. Note that 2gm RSS ≫1, and hence CMRR ≈2g2
m RSS/gm.
▲
Example4.11
Our studies suggest that an ideal tail current source guarantees inﬁnite CM rejection. Is this always true?
Solution
Interestingly, it is not. If the two transistors exhibit body-effect mismatch, then the circuit still converts an input
CM change to a differential output component even if the tail impedance is inﬁnite. As illustrated in Fig. 4.36, a
change in Vin,C M produces a change in VP, and hence in VBS of both transistors. If gmb1 ̸= gmb2, the change in
ID1(= gmb1VBS1) is not equal to that in ID2, yielding a differential change at the output.
Vin,CM
ISS
ID1
ID2
M2
M1
P
Figure 4.36
▲
4.4
Differential Pair with MOS Loads
The load of a differential pair need not be implemented by linear resistors. As with the common-
source stages studied in Chapter 3, differential pairs can employ diode-connected or current-source
loads (Fig. 4.37). The small-signal differential gain can be derived using the half-circuit concept. For
Fig. 4.37(a),
Av = −gmN

g−1
mP
rON
rO P

(4.59)
≈−gmN
gmP
(4.60)

124
Chap. 4
Differential Ampliﬁers
(a)
(b)
VDD
VDD
Vout
ISS
Vout
Vin
Vin
X
Y
M3
Vb
M1
M2
M1
M2
M4
M4
M3
ISS
Figure 4.37
Differential pair with (a) diode-connected and (b) current-source loads.
where the subscripts N and P denote NMOS and PMOS, respectively. Expressing gmN and gmP in terms
of device dimensions, we have
Av ≈−

μn(W/L)N
μp(W/L)P
(4.61)
For Fig. 4.37(b), we have
Av = −gmN(rON∥rO P)
(4.62)
▲
Example4.12
It is possible to obviate the need for Vb in the circuit of Fig. 4.37(b) as shown in Fig. 4.38(a), where R1 and R2(= R1)
are relatively large. In the absence of signals, VX = VY = VN = VDD −|VGS3,4|. That is, M3 and M4 are
“self-biased.” Determine the differential voltage gain of this topology.
(a)
(b)
VDD
N
X
Y
Vout
Vout
Vin
Vin
M3
M3
M1
R1
R1
M1
M2
R2
M4
ISS
Figure 4.38
Solution
For differential outputs, VN does not change (why?) and can be considered ac ground. Shown in Fig. 4.38(b), the
half-circuit yields
|Av| = gm1(rO1∥R1∥rO3)
(4.63)
If the resistors are much greater than rO1||rO3, then they negligibly reduce the gain.
▲

Sec. 4.4
Differential Pair with MOS Loads
125
In the circuit of Fig. 4.37(a), the diode-connected loads consume voltage headroom, thus creating
a trade-off between the output voltage swings, the voltage gain, and the input CM range. Recall from
Eq. (3.37) that, for given bias current and input device dimensions, the circuit’s gain and the PMOS
overdrive voltage scale together. To achieve a higher gain, (W/L)P must decrease, thereby increasing
|VGSP −VT H P| and lowering the CM level at nodes X and Y.
In order to alleviate the above difﬁculty, part of the bias currents of the input transistors can be provided
by PMOS current sources. Illustrated in Fig. 4.39(a), the idea is to lower the gm of the load devices by
reducing their current rather than their aspect ratio. For example, if the “auxiliary” current sources, M5
and M6, carry 80% of the drain current of M1 and M2, the current through M3 and M4 is reduced by a
factor of ﬁve. For a given |VGSP −VT H P|, this translates to a ﬁvefold reduction in the transconductance of
M3 and M4 because the aspect ratio of the devices can be lowered by the same factor. Thus, the differential
gain is now ﬁve times that of the case with no PMOS current sources (if λ = 0).
Vb
(a)
(b)
VDD
RD
RD
Vout
Vin
Vb
Vb
M3
M1
M2
M4
ISS
0.8 ISS
2
0.8 ISS
2
VDD
Vout
Vin
Vb
M3
M5
M1
M2
M6
M4
ISS
0.8 ISS
2
0.8 ISS
2
Figure 4.39
Addition of current sources to increase the voltage gain with (a) diode-connected loads and
(b) resistive loads.
Since the voltage headroom consumed by diode-connected devices cannot be less than VT H (if sub-
threshold conduction is neglected), the topology of Fig. 4.39(a) allows limited output voltage swings. We
therefore prefer the alternative shown in Fig. 4.39(b), where the loads are realized by resistors—and the
maximum voltage at each output node is equal to VDD −|VGS3,4 −VT H3,4| rather than VDD −|VT H3,4|.
For a given output CM level and 80% auxiliary currents, RD can be ﬁve times as large, yielding a voltage
gain of
|Av| = gmN(RD||rON||rO P)
(4.64)
If the PMOS devices are long (and, necessarily, wide), then rO P ≫rON and the gain is limited by
RD||rON. The circuit of Fig. 4.39(b) approaches that in Fig. 4.37(b) if RD →∞, with the PMOS current
sources providing all of the bias currents of M1 and M2.
The small-signal gain of the differential pair with current-source loads is relatively low—in the range
of 5 to 10 in nanometer technologies. How do we increase the voltage gain? Borrowing ideas from the
ampliﬁers in Chapter 3, we increase the output impedance of both the PMOS and the NMOS devices by
cascoding, in essence creating a differential version of the cascode stage introduced in Chapter 3. The
result is depicted in Fig. 4.40(a). To calculate the gain, we construct the half circuit of Fig. 4.40(b), which
is similar to the cascode stage of Fig. 3.70. It follows that
|Av| ≈gm1[(gm3rO3rO1)∥(gm5rO5rO7)]
(4.65)
Cascoding therefore increases the differential gain substantially, but at the cost of consuming more voltage
headroom. We return to this circuit in Chapter 9.

126
Chap. 4
Differential Ampliﬁers
VDD
VDD
Vout
Vout
Vb3
Vb3
Vb2
Vb1
Vin
Vb2
Vb1
Vin
M7
M7
M5
M3
M1
M8
M5
M6
M3
M4
M1
M2
ISS
(a)
(b)
Figure 4.40
(a) Cascode differential pair; (b) half circuit of (a).
As a ﬁnal note, we should mention that high-gain fully differential ampliﬁers require a means of
deﬁning the output common-mode level. For example, in Fig. 4.37(b), the output common-mode level
is not well-deﬁned, whereas in Fig. 4.37(a), diode-connected transistors deﬁne the output CM level as
VDD −VGSP. We revisit this issue in Chapter 9.
4.5
Gilbert Cell
Our study of differential pairs reveals two important aspects of their operation: (1) the small-signal gain
of the circuit is a function of the tail current, and (2) the two transistors in a differential pair provide a
simple means of steering the tail current to one of two destinations. By combining these two properties,
we can develop a versatile building block.
Suppose we wish to construct a differential pair whose gain is varied by a control voltage. This can
be accomplished as depicted in Fig. 4.41(a), where the control voltage deﬁnes the tail current and hence
the gain. In this topology, Av = Vout/Vin varies from zero (if ID3 = 0) to a maximum value given by
voltage headroom limitations and device dimensions. This circuit is a simple example of a “variable-gain
ampliﬁer” (VGA). VGAs ﬁnd application in systems where the signal amplitude may experience large
variations and hence requires inverse changes in the gain.
Now suppose we seek an ampliﬁer whose gain can be continuously varied from a negative value to
a positive value. Consider two differential pairs that amplify the input by opposite gains [Fig. 4.41(b)].
We now have Vout1/Vin = −gm RD and Vout2/Vin = +gm RD, where gm denotes the transconduc-
tance of each transistor in equilibrium. If I1 and I2 vary in opposite directions, so do |Vout1/Vin|
and |Vout2/Vin|.
But how should Vout1 and Vout2 be combined into a single output? As illustrated in Fig. 4.42(a), the two
voltagescanbesummed,producing Vout = Vout1+Vout2 = A1Vin+A2Vin,where A1 and A2 arecontrolled
by Vcont1 and Vcont2, respectively. The actual implementation is in fact quite simple: since Vout1 =
RD ID1 −RD ID2 and Vout2 = RD ID4 −RD ID3, we have Vout1 +Vout2 = RD(ID1 + ID4)−RD(ID2 + ID3).
Thus,ratherthanadd Vout1 and Vout2,wesimplyshortthecorrespondingdrainterminalstosumthecurrents
and subsequently generate the output voltage [Fig. 4.42(b)]. Note that if I1 = 0, then Vout = +gm RD,
and if I2 = 0, then Vout = −gm RD. For I1 = I2, the gain drops to zero.

Sec. 4.5
Gilbert Cell
127
VDD
VDD
VDD
RD
RD
RD
RD
RD
RD
Vin
Vin
Vin
I1
I2
Vcont
Vcont1
Vcont2
Vout
Vout1
Vout2
M1
M2
M1
M2
M3
M4
M3
(a)
(b)
Figure 4.41
(a) Simple VGA; (b) two stages providing variable gain.
VDD
VDD
VDD
RD
RD
RD
RD
RD
RD
Vcont1
Vout1
Vout
Vout
Vout
Vout2
Vout
Vcont2
Vcont1
Vcont2
Vin
Vcont
Vcont1
Vcont2
I1
I2
Vin
Vin
Vin
Vin
Vin
A1
A2
M1
M2
M1
A
B
M3 M4
M5 M6
M2
M1
M2
M3
M4
M5
M6
M3
M4
ISS
ISS
(a)
(b)
(c)
(d)
Figure 4.42
(a) Summation of the output voltages of two ampliﬁers; (b) summation in the current domain; (c) use
of M5-M6 to control the gain; (d) Gilbert cell.

128
Chap. 4
Differential Ampliﬁers
In the circuit of Fig. 4.42(b), Vcont1 and Vcont2 must change I1 and I2 in opposite directions such that the
gain of the ampliﬁer changes monotonically. What circuit can vary two currents in opposite directions?
A differential pair provides such a characteristic, leading to the topology of Fig. 4.42(c). Note that for
a large |Vcont1 −Vcont2|, all of the tail current is steered to one of the top differential pairs and the gain
from Vin to Vout is at its most positive or most negative value. If Vcont1 = Vcont2, the gain is zero. For
simplicity, we redraw the circuit as shown in Fig. 4.42(d). Called the “Gilbert cell” [2], this topology is
widely used in many analog and communication systems. In a typical design, M1–M4 are identical, and
so are M5 and M6.
▲
Example4.13
Explain why the Gilbert cell can operate as an analog voltage multiplier.
Solution
Since the gain of the circuit is a function of Vcont = Vcont1−Vcont2, we have Vout = Vin· f (Vcont). Expanding f (Vcont)
in a Taylor series and retaining only the ﬁrst-order term, αVcont, we have Vout = αVinVcont. Thus, the circuit can
multiply voltages. This property accompanies any voltage-controlled variable-gain ampliﬁer.
▲
As with a cascode structure, the Gilbert cell consumes a greater voltage headroom than a simple
differential pair does. This is because the two differential pairs M1–M2 and M3–M4 are “stacked”
on top of the control differential pair. To understand this point, suppose the differential input, Vin,
in Fig. 4.42(d) has a common-mode level VC M,in. Then, VA = VB = VC M,in −VGS1, where M1–M4 are
assumed identical. For M5 and M6 to operate in saturation, the CM level of Vcont, VC M,cont, must be such
that VC M,cont ≤VC M,in −VGS1 + VT H5,6. Since VGS1 −VT H5,6 is roughly equal to one overdrive voltage,
we conclude that the control CM level must be lower than the input CM level by at least this value.
In arriving at the Gilbert cell topology, we opted to vary the gain of each differential pair through its
tail current, thereby applying the control voltage to the bottom pair and the input signal to the top pairs.
Interestingly, the order can be exchanged while still obtaining a VGA. Illustrated in Fig. 4.43(a), the idea
is to convert the input voltage to current by means of M5 and M6 and route the current through M1–M4
to the output nodes. If, as shown in Fig. 4.43(b), Vcont is very positive, then only M1 and M3 are on and
Vout = gm5,6RDVin. Similarly, if Vcont is very negative [Fig. 4.43(c)], then only M2 and M4 are on and
Vout = −gm5,6RDVin. For a zero differential control voltage, Vout = 0. The input differential pair may
incorporate degeneration to provide a linear voltage-to-current conversion.
VDD
VDD
VDD
RD
RD
RD
RD
RD
RD
Vcont
Vcont
Vcont
Vin
Vin
Vin
Vout
Vout
Vout
M1
M2
M2
M1
M3
M4
M5 M6
M5 M6
M3
M5 M6
M4
ISS
ISS
ISS
(a)
(b)
(c)
Figure 4.43
(a) Gilbert cell sensing the input voltage by the bottom differential pair; (b) signal path for very
positive Vcont; (c) signal path for very negative Vcont.

Problems
129
References
[1] P. R. Gray and R. G. Meyer, Analysis and Design of Analog Integrated Circuits, 3d ed. (New York: Wiley, 1993).
[2] B. Gilbert, “A Precise Four-Quadrant Multiplier with Subnanosecond Response,” IEEE J. Solid-State Circuits,
vol. SC-3, pp. 365–373, Dec. 1968.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. All device dimensions are effective values and in microns.
4.1.
Suppose the total capacitance between adjacent lines in Fig. 4.2 is 10 fF and the capacitance from the drains
of M1 and M2 to ground is 100 fF.
(a) What is the amplitude of the glitches in the analog output in Fig. 4.2(a) for a clock swing of 3 V?
(b) If in Fig. 4.2(b), the capacitance between L1 and L2 is 10% less than that between L1 and L3, what is the
amplitude of the glitches in the differential analog output for a clock swing of 3 V?
4.2.
Sketch the small-signal differential voltage gain of the circuit shown in Fig. 4.9(a) if VDD varies from 0 to 3
V. Assume that (W/L)1−3 = 50/0.5, Vin,C M = 1.3 V, and Vb = 1 V.
4.3.
Construct the plots of Fig. 4.9(c) for a differential pair using PMOS transistors.
4.4.
In the circuit of Fig. 4.11, (W/L)1,2 = 50/0.5 and ISS = 0.5 mA.
(a) What is the maximum allowable output voltage swing if Vin,C M = 1.2 V?
(b) What is the voltage gain under this condition?
4.5.
A differential pair uses input NMOS devices with W/L = 50/0.5 and a tail current of 1 mA.
(a) What is the equilibrium overdrive voltage of each transistor?
(b) How is the tail current shared between the two sides if Vin1 −Vin2 = 50 mA?
(c) What is the equivalent Gm under this condition?
(d) For what value of Vin1 −Vin2 does the Gm drop by 10%? By 90%?
4.6.
Repeat Problem 4.5 with W/L = 25/0.5 and compare the results.
4.7.
Repeat Problem 4.5 with a tail current of 2 mA and compare the results.
4.8.
Sketch ID1 and ID2 in Fig. 4.19 versus Vin1 −Vin2. For what value of Vin1 −Vin2 are the two currents
equal?
4.9.
Consider the circuit of Fig. 4.32, assuming (W/L)1,2 = 50/0.5 and RD = 2 k. Suppose RSS represents
the output impedance of an NMOS current source with (W/L)SS = 50/0.5 and a drain current of 1 mA. The
input signal consists of Vin,DM = 10 mVpp and Vin,C M = 1.5 V + Vn(t), where Vn(t) denotes noise with a
peak-to-peak amplitude of 100 mV. Assume that R/R = 0.5%.
(a) Calculate the output differential signal-to-noise ratio, deﬁned as the signal amplitude divided by the noise
amplitude.
(b) Calculate the CMRR.
4.10. Repeat Problem 4.9 if R = 0, but M1 and M2 suffer from a threshold voltage mismatch of 1 mV.
4.11. Suppose the differential pair of Fig. 4.37(a) is designed with (W/L)1,2 = 50/0.5, (W/L)3,4 = 10/0.5, and
ISS = 0.5 mA. Also, ISS is implemented with an NMOS device having (W/L)SS = 50/0.5.
(a) What are the minimum and maximum allowable input CM levels if the differential swings at the input
and output are small?
(b) For Vin,C M = 1.2 V, sketch the small-signal differential voltage gain as VDD goes from 0 to 3 V.
4.12. In Problem 4.11, suppose M1 and M2 have a threshold voltage mismatch of 1 mV. What is the CMRR?
4.13. In Problem 4.11, suppose W3 = 10 μm, but W4 = 11 μm. Calculate the CMRR.
4.14. For the differential pairs of Fig. 4.37(a) and (b), calculate the differential voltage gain if ISS = 1 mA,
(W/L)1,2 = 50/0.5, and (W/L)3,4 = 50/1. What is the minimum allowable input CM level if ISS requires at
least 0.4 V across it? Using this value for Vin,C M, calculate the maximum output voltage swing in each case.

130
Chap. 4
Differential Ampliﬁers
4.15. In the circuit of Fig. 4.39(a), assume that ISS = 1 mA and W/L = 50/0.5 for all the transistors.
(a) Determine the voltage gain.
(b) Calculate Vb such that ID5 = ID6 = 0.8(ISS/2).
(c) If ISS requires a minimum voltage of 0.4 V, what is the maximum differential output swing?
4.16. Assuming that all the circuits shown in Fig. 4.44 are symmetric, sketch Vout as (a) Vin1 and Vin2 vary
differentially from zero to VDD, and (b) Vin1 and Vin2 are equal and vary from zero to VDD.
(c)
(a)
(b)
(d)
(e)
VDD
VDD
VDD
VDD
VDD
Vout
Vout
Vout
Vout
Vout
Vin1
Vin1
Vin1
Vin2
Vin2
Vb
Vb2
Vin1
Vin2
Vin1
Vb1
Vin2
Vb1
Vb2
Vb
Vin2
R1
R1
R1
R2
R2
R1
R1
R2
M4
M3
M2
M5
M3
M1
M5
Vb
M5
M2
M1
M2
M4
M3
M4
M1
M4
M4
M3
M1
M2
M5
M3
M1
M5
M2
Figure 4.44
4.17. Assuming that all the circuits shown in Fig. 4.45 are symmetric, sketch Vout as (a) Vin1 and Vin2 vary
differentially from zero to VDD, and (b) Vin1 and Vin2 are equal and vary from zero to VDD.
4.18. Assuming that all the transistors in the circuits of Figs. 4.44 and 4.45 are saturated and λ ̸= 0, calculate the
small-signal differential voltage gain of each circuit.
4.19. Consider the circuit shown in Fig. 4.46.
(a) Sketch Vout as Vin1 and Vin2 vary differentially from zero to VDD.
(b) If λ = 0, obtain an expression for the voltage gain. What is the voltage gain if W3,4 = 0.8W5,6?
4.20. For the circuit shown in Fig. 4.47,
(a) Sketch Vout, VX, and VY as Vin1 and Vin2 vary differentially from zero to VDD.
(b) Calculate the small-signal differential voltage gain.
4.21. Assuming no symmetry in the circuit of Fig. 4.48 and using no equivalent circuits, calculate the small-signal
voltage gain (Vout)/(Vin1 −Vin2) if λ = 0 and γ ̸= 0.
4.22. Due to a manufacturing defect, a large parasitic resistance has appeared between the drain and source ter-
minals of M1 in Fig. 4.49. Assuming λ = γ = 0, calculate the small-signal gain, common-mode gain, and
CMRR.

Problems
131
VDD
VDD
VDD
Vout
Vout
Vin1
Vb
Vin2
Vb1
Vin1
Vin1
Vb1
Vin2
Vb3
Vout
Vb1
Vin2
Vb1
M3
Vb2
M7
RD
RD
M2
M5
M6
M1
M4
M4
M3
M1
M2
M5
M3
M1
M2
M7
M5
M6
M4
(a)
(b)
(c)
Figure 4.45
VDD
Vout
M5
Vin1
Vb1
Vin2
M1
M2
M7
M3
M4
M6
Figure 4.46
4.23. Due to a manufacturing defect, a large parasitic resistance has appeared between the drains of M1 and M4
in the circuit of Fig. 4.50. Assuming λ = γ = 0, calculate the small-signal gain, common-mode gain, and
CMRR.
4.24. In the circuit of Fig. 4.51, all of the transistors have a W/L of 50/0.5, and M3 and M4 are to operate in the deep
triode region with an on-resistance of 2 k. Assuming that ID5 = 20 μA and λ = γ = 0, calculate the input
common-mode level that yields such resistance. Sketch Vout1 and Vout2 as Vin1 and Vin2 vary differentially
from 0 to VDD.

132
Chap. 4
Differential Ampliﬁers
VDD
M5
M6
R1
M4
M3
M1
M2
M7
X
Y
Vout
Vb1
Vb
Vin1
Vin2
Figure 4.47
VDD
RD1
RS1
RS2
RD2
Vout
Vin1
Vin2
M1
M2
ISS
Figure 4.48
VDD
RD
RD
RP
Vout
Vin1
Vin2
Vb
M1
M2
M3
Figure 4.49
VDD
RD
M4
M3
M1
M2
M5
Vb1
Vb
Vin1
Vin2
RD
RP
Vout
Figure 4.50

Problems
133
VDD
Vout1
Vin1
Vin2
Vout2
M1
M2
M5
M3
M4
Vb
Figure 4.51
4.25. In the circuit of Fig. 4.37(b), (W/L)1−4 = 50/0.5 and ISS = 1 mA.
(a) What is the small-signal differential gain?
(b) For Vin,C M = 1.5 V, what is the maximum allowable output voltage swing?
4.26. In the circuit of Fig. 4.39, assume that M5 and M6 have a small threshold voltage mismatch of V and ISS
has an output impedance RSS. Calculate the CMRR.
4.27. What happens if RSS in Eq. (4.56) becomes very large? Can we obtain the same result by analyzing a differential
pair having an ideal tail current source but gm1 ̸= gm2?
4.28. In Example 4.5, how much input dc imbalance can be tolerated if the small-signal gain must not drop by more
than 5%?
4.29. In the lemma illustrated in Fig. 4.20, suppose channel-length modulation is not neglected. Assuming the two
devices are connected to two equal load resistors, explain intuitively why the lemma still holds.
4.30. Does the lemma in Fig. 4.20 still hold if the devices have body effect? Explain.
4.31. Repeat Example 4.7 using Method I.
4.32. Prove the lemma illustrated in Fig. 4.20 if the tail current source is replaced by a resistor RT .
4.33. What happens to the plots on Fig. 4.13 as W/L increases? Determine the area under the Gm plot and use the
result to explain why the peak Gm must increase as W/L increases.
4.34. Assuming that I1 and ISS in Fig. 4.52 are ideal and λ, γ > 0, determine Vout1/Vin and Vout2/Vin.
VDD
R1
M1
M2
I1
Vout1
Vin
Vout2
Vb
ISS
Figure 4.52
4.35. In Problem 4.11, suppose M3 and M4 have a threshold voltage mismatch of 1 mV. Calculate the CMRR.

CHAPTER
5
Current Mirrors and Biasing
Techniques
Our study of single-stage and differential ampliﬁers in Chapters 3 and 4 points to the wide usage of
current sources. In these circuits, current sources act as a large resistor without consuming excessive
voltage headroom. We also noted that MOS devices operating in saturation can act as a current source.
Current sources ﬁnd other applications in analog design as well. For example, some digital-to-analog
(D/A) converters employ an array of current sources to produce an analog output proportional to the
digital input. Also, current sources, in conjunction with “current mirrors,” can perform useful functions
on analog signals.
This chapter deals with the design of current mirrors and bias circuits. Following a review of basic
current mirrors, we study the cascode mirror. Next, we analyze active current mirrors and describe
the properties of differential pairs using such circuits as loads. Finally, we introduce various biasing
techniques for ampliﬁer stages.
5.1
Basic Current Mirrors
Figure 5.1 illustrates two examples in which a current source proves useful. From our study in Chapter 2,
recall that the output resistance and capacitance and the voltage headroom of a current source trade
with the magnitude of the output current. In addition to these issues, several other aspects of current
sources are important: supply, process, and temperature dependence; output noise current; and match-
ing with other current sources. We defer the noise and matching considerations to Chapters 7 and 14,
respectively.
M1
Vout
I1
VDD
Vin
M1
Vout
VDD
Vin
Vb
ISS
Vb
(a)
(b)
I1
ISS
Figure 5.1
Applications of current sources.
134

Sec. 5.1
Basic Current Mirrors
135
M1
R1
R2
VDD
Iout
Figure 5.2
Deﬁnition of current by
resistive divider.
How should a MOSFET be biased so as to operate as a stable current source? To gain a better view of
the issues, let us consider the simple resistive biasing shown in Fig. 5.2. Assuming M1 is in saturation,
we can write
Iout ≈1
2μnCox
W
L

R2
R1 + R2
VDD −VTH
2
(5.1)
This expression reveals various PVT dependencies of Iout. The overdrive voltage is a function of VDD
and VTH; the threshold voltage may vary by 50 to 100 mV from wafer to wafer. Furthermore, both μn
and VTH exhibit temperature dependence. Thus, Iout is poorly deﬁned. The issue becomes more severe as
the device is biased with a smaller overdrive voltage, e.g., to consume less headroom and support greater
voltage swings at the drain. With a nominal overdrive of, say, 200 mV, a 50-mV error in VTH results in a
44% error in the output current.
It is important to note that process and temperature dependencies exist even if the gate voltage is not
a function of the supply voltage. In other words, if the gate-source voltage of a MOSFET is precisely
deﬁned, then its drain current is not! For this reason, we must seek other methods of biasing MOS current
sources.
The design of current sources in analog circuits is based on “copying” currents from a reference,
with the assumption that one precisely-deﬁned current source is already available. While this method
may appear to entail an endless loop, it is carried out as illustrated in Fig. 5.3. A relatively complex
circuit—sometimes requiring external adjustments—is used to generate a stable reference current, IREF,
which is then “cloned” to create many current sources in the system. We study the copying operation
here and the reference generator (which is based on “bandgap” techniques) in Chapter 12.
Reference
Generator
IREF
I1
I2
VDD
Figure 5.3
Use of a reference to gen-
erate various currents.
How do we generate copies of a reference current? For example, in Fig. 5.4, how do we guarantee that
Iout = IREF? For a MOSFET, if ID = f (VGS), where f (·) denotes the dependence of ID upon VGS, then
VGS = f −1(ID). That is, if a transistor is biased at IREF, then it produces VGS = f −1(IREF) [Fig. 5.5(a)].
Thus, if this voltage is applied to the gate and source terminals of a second MOSFET, the resulting current
is Iout = f [ f −1(IREF)] = IREF [Fig. 5.5(b)]. From another point of view, two identical MOS devices that
have equal gate-source voltages and operate in saturation carry equal currents (if λ = 0).

136
Chap. 5
Current Mirrors and Biasing Techniques
VDD
Iout
Copy
Circuit
IREF
Figure 5.4
Conceptual means of
copying currents.
VDD
IREF
f −1(IREF)
VDD
IREF
Iout
L
W
L
W
(a)
(b)
M1
M1
M2
Analog
Circuit
Figure 5.5
(a) Diode-connected device
providing inverse function; (b) basic cur-
rent mirror.
The structure consisting of M1 and M2 in Fig. 5.5(b) is called a “current mirror.” In the general case,
the transistors need not be identical. Neglecting channel-length modulation, we can write
IREF = 1
2μnCox
W
L

1
(VGS −VTH)2
(5.2)
Iout = 1
2μnCox
W
L

2
(VGS −VTH)2
(5.3)
obtaining
Iout = (W/L)2
(W/L)1
IREF
(5.4)
The key property of this topology is that it allows precise copying of the current with no dependence on
process and temperature. The translation from IREF to Iout merely involves the ratio of device dimensions,
a quantity that can be controlled with reasonable accuracy.
It is important to appreciate the cause-and-effect relationships stipulated by VGS = f −1(IREF) and
f [ f −1(IREF)] = IREF. The former suggests that we must generate a VGS from IREF; i.e., IREF is the cause
and VGS is the effect. A MOSFET can perform this function only if it is conﬁgured as a diode while
carrying a current of IREF [M1 in Fig. 5.5(b)]. Similarly, the latter equation indicates that a transistor must
sense f −1(IREF) (= VGS) and generate f [ f −1(IREF)]. In this case, the cause is VGS and the effect is the
output current, f [ f −1(IREF)] [as provided by M2 in Fig. 5.5(b)].
With the aid of these observations, we can understand why a circuit such as that in Fig. 5.6 does not
perform current copying. Here, Vb is not caused by IREF, and hence Iout does not track IREF.

Sec. 5.1
Basic Current Mirrors
137
IREF
M1
M2
VDD
Iout
Vb
Figure 5.6
Circuit incapable of
copying current.
▲
Example5.1
In Fig. 5.7, ﬁnd the drain current of M4 if all of the transistors are in saturation.
VDD
IREF
Iout
M1
M2
M3
M4
Figure 5.7
Solution
We have ID2 = IREF[(W/L)2/(W/L)1]. Also, |ID3| = |ID2| and ID4 = ID3 × [(W/L)4/(W/L)3]. Thus, |ID4| =
αβIREF, where α = (W/L)2/(W/L)1 and β = (W/L)4/(W/L)3. Proper choice of α and β can establish large
or small ratios between ID4 and IREF. For example, α = β = 5 yields a magniﬁcation factor of 25. Similarly,
α = β = 0.2 can be utilized to generate a small, well-deﬁned current.
▲
We should also remark that the copy of a copy may not be as “clear” as the original. Owing to random
“mismatches” between M1 and M2 in the above example, ID2 slightly deviates from its nominal value.
Similarly, as ID2 is copied onto ID4, additional errors accumulate. We must therefore avoid long current
mirror chains.
Current mirrors ﬁnd wide application in analog circuits. Figure 5.8 illustrates a typical case, where a
differential pair is biased by means of an NMOS mirror for the tail current source and a PMOS mirror
IREF
IT
M0
M2
VDD
P
0.4IT
0.4IT
M1
M3
M4
M5
M6
W
L
(
)P
W
L
(
)P
X
W
L )N
5(
W
L )N
2(
W
L )N
(
Figure 5.8
Current mirrors used to bias a differential ampliﬁer.

138
Chap. 5
Current Mirrors and Biasing Techniques
for the load current sources. The device dimensions shown establish a drain current of 0.4IT in M5 and
M6, reducing the drain current of M3 and M4 and hence increasing the ampliﬁer’s gain.
Sizing Issues
Current mirrors usually employ the same length for all of the transistors so as to minimize
errors due to the side-diffusion of the source and drain areas (L D). For example, in Fig. 5.8, the NMOS
current sources must have the same channel length as M0. This is because if Ldrawn is, say, doubled, then
Lef f = Ldrawn −2L D is not. Furthermore, the threshold voltage of short-channel devices exhibits some
dependence on the channel length (Chapter 17). Thus, current ratioing is achieved by scaling only the
width of the transistors.
Suppose we wish to copy a reference current, IREF, and generate 2IREF. We begin with a width
of WREF for the diode-connected reference transistor and hence choose 2WREF for the current source
[Fig. 5.9(a)]. Unfortunately, direct scaling of the width also faces difﬁculties. As illustrated in Fig. 5.9(b),
since the “corners” of the gate are poorly deﬁned, if the drawn W is doubled, the actual width does not
exactly double. We thus prefer to employ a “unit” transistor and create copies by repeating such a device
[Fig. 5.9(c)].
IREF
M2
VDD
(a)
2IREF
2WREF
W
A
A
Gate
Corner
Oxide
Channel
Top
View
AA
View
W
IREF
MREF
M2
VDD
2IREF
WREF
WREF
(c)
(b)
MREF
WREF
Figure 5.9
(a) Current mirror multiplying IREF by 2, (b) effect of gate corner on current accuracy, and (c) more
accurate current multiplication.
But how do we generate a current equal to IREF/2 from IREF? In this case, the diode-connected device
itself must consist of two units, each carrying IREF/2. Figure 5.10(a) depicts an example for the generation
of both 2IREF and IREF/2; each unit has a width of W0 (and the same length).
IREF
MREF
VDD
2IREF
W0
W0
W0
W0
W0
IREF
2
IREF
2
W0
W0
IREF
M
VDD
2IREF
REF
W0
W0
W0
W0
W0
Series Transistors
(a)
(b)
Figure 5.10
Current mirrors providing IREF/2 from IREF by (a) half-width device and (b) series transistors.
The above approach requires a large number of unit transistors if many different currents must be
generated. It is possible to reduce the complexity by scaling the lengths, but not directly. In order
to avoid the errors due to L D, we can, for example, double the equivalent length by placing two unit

Sec. 5.2
Cascode Current Mirrors
139
transistors in series. Illustrated in Fig. 5.10(b), this approach preserves an effective length of Ldrawn−2L D
for each unit, yielding an equivalent length of 2(Ldrawn −2L D) for the composite device and hence
halving the current. Note that this structure is not a cascode because the bottom device is in the triode
region (why?).
We should also mention that current mirrors can process signals as well. In Fig. 5.5(b), for example,
if IREF increases by I, then Iout increases by I (W/L)2/(W/L)1. That is, the circuit ampliﬁes the
small-signal current if (W/L)2/(W/L)1 > 1 (but at the cost of proportional multiplication of the bias
current).
▲
Example5.2
Calculate the small-signal voltage gain of the circuit shown in Fig. 5.11.
M1
Vout
VDD
Vin
RL
M2
M3
Figure 5.11
Solution
The small-signal drain current of M1 is equal to gm1Vin. Since ID2 = ID1 and ID3 = ID2(W/L)3/(W/L)2,
the small-signal drain current of M3 is equal to gm1Vin(W/L)3/(W/L)2, yielding a voltage gain of
gm1RL(W/L)3/(W/L)2.
▲
5.2
Cascode Current Mirrors
In our discussion of current mirrors thus far, we have neglected channel-length modulation. In practice,
this effect produces signiﬁcant error in copying currents, especially if minimum-length transistors are
used so as to minimize the width and hence the output capacitance of the current source. For the simple
mirror of Fig. 5.5(b), we can write
ID1 = 1
2μnCox
W
L

1
(VGS −VTH)2(1 + λVDS1)
(5.5)
ID2 = 1
2μnCox
W
L

2
(VGS −VTH)2(1 + λVDS2)
(5.6)
and hence
ID2
ID1
= (W/L)2
(W/L)1
· 1 + λVDS2
1 + λVDS1
(5.7)
While VDS1 = VGS1 = VGS2, VDS2 may not equal VGS2 because of the circuitry fed by M2. For example,
in Fig. 5.8, the potential at node P is determined by the input common-mode level and the gate-source
voltage of M1 and M2, and it may not equal VX.

140
Chap. 5
Current Mirrors and Biasing Techniques
In order to suppress the effect of channel-length modulation in Fig. 5.5(b), we can (1) force VDS2 to be
equal to VDS1, or (2) force VDS1 to be equal to VDS2. These two principles lead to two different topologies.
First Approach
We begin with the ﬁrst principle and wish to ensure that VDS2 in Fig. 5.5(b) is both
constant and equal to VDS1. Recall from Chapter 3 that a cascode device can shield a current source,
thereby reducing the voltage variations across it. As shown in Fig. 5.12(a), even though the analog
circuit may allow VP to vary substantially, VY remains relatively constant. But how do we ensure that
VDS2 = VDS1? We must generate Vb such that Vb −VGS3 = VDS1 (= VGS1), i.e., Vb = VGS3 + VGS1. In
other words, Vb can be established by two diode-connected devices in series [Fig. 5.12(b)], provided that
VGS0 + VGS1 = VGS3 + VGS1, and hence VGS0 = VGS3. We now attach the Vb generator of Fig. 5.12(b)
to the cascode current source as shown in Fig. 5.12(c). The result allows accurate copying of the current
even in the presence of body effect (why?).
IREF
M0
IREF
M1
M2
M3
VDD
Vb
Iout
Y
X
M1
VDD
X
IREF
M0
M1
VDD
X
M2
M3
Y
N
(c)
(a)
(b)
P
N
Analog
Circuit
Iout
P
Analog
Circuit
VGS0 + VGS1
Vb
Figure 5.12
(a) Cascode current source, (b) modiﬁcation of mirror circuit to generate the cascode bias voltage,
and (c) cascode current mirror.
A few notes on the sizing of the transistors in Fig. 5.12(c) are warranted. As explained earlier, we
typically select L2 = L1 and scale W2 (in integer units) with respect to W1 to obtain the desired multiple
of IREF. Similarly, for VGS3 to be equal to VGS0, we choose L3 = L0 and scale W3 with respect to W0
by the same factor, i.e., W3/W0 = W2/W1. In practice, L3 and L0 are equal to the minimum allowable
value so as to minimize their width, while L1 and L2 may be longer in some cases.1
▲
Example5.3
In Fig. 5.13, sketch VX and VY as a function of IREF. If IREF requires 0.5 V to operate as a current source, what is
its maximum value?
Solution
Since M2 and M3 are properly ratioed with respect to M1 and M0, we have VY = VX ≈√2IREF/[μnCox(W/L)1]+
VTH1. The behavior is plotted in Fig. 5.13(b).
To ﬁnd the maximum value of IREF, we note that
VN = VGS0 + VGS1
(5.8)
=

2IREF
μnCox

L
W

0
+

L
W

1

+ VT H0 + VTH1
(5.9)
1To reduce channel-length modulation, mismatches, or ﬂicker noise.

Sec. 5.2
Cascode Current Mirrors
141
IREF
M0
M1
VDD
X
M2
M3
Iout
Y
N
IREF
VX,VY
VTH1
(a)
(b)
Figure 5.13
Thus,
VDD −

2IREF
μnCox

L
W

0
+

L
W

1

−VTH0 −VTH1 = 0.5 V
(5.10)
and hence
IRE F,max = μnCox
2
(VDD −0.5 V −VTH0 −VTH1)2
(

(L/W )0 +

(L/W )1)2
(5.11)
▲
While operating as a current source with a high output impedance and accurate value, the topology of
Fig. 5.12(c) nonetheless consumes substantial voltage headroom. For simplicity, let us neglect the body
effect and assume that all of the transistors are identical. Then, the minimum allowable voltage at node
P is equal to
VN −VTH = VGS0 + VGS1 −VTH
(5.12)
= (VGS0 −VTH) + (VGS1 −VTH) + VTH
(5.13)
i.e., two overdrive voltages plus one threshold voltage. How does this value compare with that in
Fig. 5.12(a) if Vb could be chosen more arbitrarily? As shown in Fig. 5.14(a), Vb could be so low
IREF
VDD
Vb
Iout ≠ IREF
Y
X
IREF
M0
M1
VDD
X
Iout = IREF
Y
N
(a)
VGS2
VDS2 (=VGS1)
(b)
M1
P
M3
M2
M3
M2
P
VGS3 − VTH3
VGS2 − VTH3
VGS3 − VTH3
Figure 5.14
(a) Cascode current source with minimum headroom voltage; (b) headroom consumed by a
cascode mirror.

142
Chap. 5
Current Mirrors and Biasing Techniques
(= VGS3 + VGS2 −VTH2) that the minimum allowable voltage at P is merely two overdrive voltages.
Thus, the cascode mirror of Fig. 5.12(c) “wastes” one threshold voltage in the headroom. This is because
VDS2 = VGS2, whereas VDS2 could be as low as VGS2 −VTH while maintaining M2 in saturation.
Figure 5.14 summarizes our discussion. In Fig. 5.14(a), Vb is chosen to allow the lowest possible
value of VP, but the output current does not accurately track IREF because M1 and M2 sustain unequal
drain-source voltages. In Fig. 5.14(b), a higher accuracy is achieved, but the minimum level at P is higher
by one threshold voltage.
Before resolving this issue, it is instructive to examine the large-signal behavior of a cascode current
source.
▲
Example5.4
In Fig. 5.15(a), assume that all of the transistors are identical and sketch IX and VB as VX drops from a large positive
value.
IREF
M0
M1
VDD
N
(a)
(b)
A
B
M2
M3
VX
IX
VX
VB
VN − VGS3
VN − VTH3
VX
VN − VTH3
VA − VTH2 + VDS3
IX
(c)
IREF
Figure 5.15
Solution
For VX ≥VN −VTH, both M2 and M3 are in saturation, IX = IREF and VB = VA. As VX drops, which transistor
enters the triode region ﬁrst, M3 or M2? Suppose M2 enters the triode region before M3 does. For this to occur, VDS2
must drop and, since VGS2 is constant, so must ID2. This means that VGS3 increases while ID3 decreases, which is
not possible if M3 is still in saturation. Thus, M3 enters the triode region ﬁrst.
As VX falls below VN −VTH, M3 enters the triode region, requiring a greater gate-source overdrive to carry the
same current. Thus, as shown in Fig. 5.15(b), VB begins to drop, causing ID2 and hence IX to decrease slightly. As
VX and VB decrease further, eventually we have VB < VA −VTH, and M2 enters the triode region. At this point, ID2
begins to drop sharply. For VX = 0, IX = 0, and M2 and M3 operate in the deep triode region. Note that as VX drops
below VN −VTH3, the output impedance of the cascode falls rapidly because gm3 degrades in the triode region.
▲
Second Approach
In order to avoid the VTH penalty in the voltage headroom of the above cascode
current source, we force VDS1 to be equal to VDS2 instead. To understand this principle, we return to
Fig. 5.14(a) and recognize that the VTH headroom consumption is eliminated only if Vb = VGS3 +(VGS2 −
VTH2), i.e., only if VDS2 is around one overdrive voltage. How can we then ensure that VDS1 = VDS2
(= VGS2 −VTH2)? Since M1 is a diode-connected device, it appears impossible to expect a VDS1 less than
one threshold.
A simple escape from the foregoing quandary is to create a deliberate voltage difference between
the gate and drain of M1 by a means of a resistor. Illustrated in Fig. 5.16(a), the idea is to choose
R1IREF ≈VTH1 and Vb = VGS3 + (VGS1 −VTH1). Now, VDS1 = VGS1 −R1IREF ≈VGS1 −VTH1, which is
equal to Vb −VGS3 and hence to VDS2.

Sec. 5.2
Cascode Current Mirrors
143
IREF
M1
VDD
(a)
Vb
R1
M3
M2
M5
R6
I6
VDD
Vb
M5
R6
I6
VDD
Vb
M6
(c)
(b)
Figure 5.16
(a) Use of IR drop to improve accuracy of current mirror, (b) generation of Vb, and (c) alternative
generation of Vb.
▲
Example5.5
Is the M1-R1 combination in Fig. 5.16(a) a diode-connected device? Assume λ > 0.
Solution
From the small-signal equivalent shown in Fig. 5.17, we express the voltage drop across R1 as IX R1 and write a
KCL at the drain node:
VX −IX R1
rO
+ gmVX = IX
(5.14)
VX
gmV1
rO
V1
R1
IX
M1
Figure 5.17
It follows that
VX
IX
= R1 + rO
1 + gmrO
(5.15)
which reduces to 1/gm in the absence of channel-length modulation. (Is it a coincidence that this impedance is the
same as that seen at the source of a common-gate stage with γ = 0?!) Thus, from a small-signal point of view, the
combinationisclosetoadiode-connecteddevice. From a large-signal point of view, VGS1 ≈√2ID/[μnCox(W/L)]+
VTH if λ is small, suggesting diode-connected operation as well.
▲
The circuit of Fig. 5.16(a) entails two issues. First, in the presence of PVT variations, it may be
difﬁcult to guarantee that R1IREF ≈VTH1 as R1 and VTH may vary differently. Second, the generation
of Vb = VGS3 + (VGS1 −VTH1) is not straightforward. Let us address the latter issue ﬁrst. We seek an
arrangement that adds one gate-source voltage to an overdrive, surmising that we must begin with a diode-
connecteddevice.WeconsiderthebranchshowninFig.5.16(b)asacandidateandwrite Vb = VGS5+R6I6.
We can readily choose I6 and the dimensions of M5 to ensure that VGS5 = VGS3. However, the condition
R6I6 = VGS1 −VTH1 = VGS1 −R1IREF translates to R6I6 + R1IREF = VGS1, which is difﬁcult to meet

144
Chap. 5
Current Mirrors and Biasing Techniques
because the I R products do not “track” the MOS gate-source voltage. For example, the value of the
resistors may fall with temperature while VGS may rise.
Depicted in Fig. 5.16(c) is another example, where M5 establishes the VGS, and M6 and R6 the
overdrive. We select I6 and the device parameters such that
VGS5 = VGS3
(5.16)
VGS6 −R6I6 = VGS1 −VTH1
(5.17)
= VGS1 −R1IREF
(5.18)
observing that it is now possible to ensure that VGS6 and VGS1 track each other, and so do R1IREF and
R6I6. For example, we may simply choose I6 = IREF, R6 = R1, and (W/L)6 = (W/L)1.2
To avoid the ﬁrst issue mentioned above, we develop another circuit topology that forces the VDS of
the diode-connected device to be equal to the VDS of the current source transistor. The level shift between
the gate and drain voltages need not be created by a resistor. In particular, suppose we tie the output
node of a cascode topology to its input [Fig. 5.18(a)]. In this case, VDS1 = Vb −VGS0, and Vb can be
chosen to place M1 at the edge of saturation. We now connect this branch to the main cascode current
source as shown in Fig. 5.18(b), recognizing that VDS1 is forced to be equal to VDS2 if VGS0 = VGS3.
Called a “low-voltage cascode,” this conﬁguration ﬁnds wider usage than the regular cascode shown in
Fig. 5.14(b).
(a)
M1
M0
Vb
IREF
A
X
VDD
M1
M0
Vb
IREF
A
X
VDD
B
M2
M3
(b)
Iout
Figure 5.18
Modiﬁcation of cascode mirror for low-voltage operation.
We must now answer two questions. First, how do we choose Vb in Fig. 5.18(a) so that both M1 and M0
are in saturation? We must have Vb −VTH0 ≤VX (= VGS1) for M0 to be saturated and VGS1 −VTH1 ≤VA
(= Vb −VGS0) for M1 to be saturated. Thus,
VGS0 + (VGS1 −VTH1) ≤Vb ≤VGS1 + VTH0
(5.19)
A solution exists if VGS0 + (VGS1 −VTH1) < VGS1 + VTH0, i.e., if VGS0 −VTH0 < VTH1. We must therefore
size M0 to ensure that its overdrive is well below VTH1.
The second question is how to generate Vb. For minimal voltage headroom consumption,
VA = VGS1 −VTH1, and hence Vb must be equal to (or slightly greater than) VGS0 + (VGS1 −VTH1).
Figure 5.19(a) depicts an example where M5 generates VGS5 ≈VGS0 and M6 together with Rb
2The circuit incurs a small tracking error because M6 experiences body effect but M1 does not (and also because M3 does but
M5 does not).

Sec. 5.2
Cascode Current Mirrors
145
(a)
M1
M0
Vb
A
X
(b)
Rb
M5
M6
I1
VDD
M1
M0
Vb
A
X
M6
I1
VDD
M7
Figure 5.19
Generation of gate voltage Vb for cascode mirrors.
produces VDS6 = VGS6 −RbI1 ≈VGS1 −VTH1. Some inaccuracy nevertheless arises because M5 does
not suffer from body effect whereas M0 does. Also, the magnitude of RbI1 is not well-controlled.
A simpler alternative is shown in Fig. 5.19(b), where the diode-connected transistor M7 provides the
necessary VGS and M6 creates a VDS equal to the required overdrive.
▲
Example5.6
Shown in Fig. 5.20(a) is a differential pair along with its bias network. In this particular design, the voltage headroom
is too small to allow the use of a cascode current source. Devise a method to reduce the current mirror error due to
channel-length modulation.
IREF
M1
VDD
ISS
M2
P
A
B
A
B
A
B
IREF
M1
VDD
ISS
M2
P
P’
Wd
Wd
Wr
Wr
(a)
(b)
Figure 5.20
Solution
Since the limited headroom does not allow us to make VDS2 equal to VDS1, we seek to make VDS1 equal to VDS2.
As exempliﬁed by Fig. 5.16(a), we can simply insert a resistor in series with the drain of M1 and select the voltage
drop across it such that VDS1 = VDS2. However, if variations in the circuit preceding the differential pair change
the common-mode level at A and B, then VDS1 ̸= VDS2. We must therefore force the voltage at node P upon the
drain of M1. Let us replicate the differential pair and insert the replica as shown in Fig. 5.20(b). Now, the voltages
at P′ and P track even if the CM level at A and B varies. To ensure that VP′ = VP, the two differential pairs must
incorporate the same lengths and scale their widths according to Wr/Wd = IREF/ISS. Of course, if the CM level at
A and B rises excessively, the replica transistors enter the triode region, introducing some error.
▲

146
Chap. 5
Current Mirrors and Biasing Techniques
▲
Example5.7
Figure 5.21(a) shows an alternative current mirror exhibiting a high output impedance. Study the small-signal and
large-signal properties of the circuit.
IREF
VDD
M2
VX
M1
M3
VX
ID1
VGS1 − VTH1
VTH3
M1 begins
to turn off 
(a)
(b)
N
X
Figure 5.21
Nanometer Design Notes
Owing to severe channel-length modu-
lation in nanometer devices, even the
cascode current mirror may exhibit sub-
stantial mismatches. We choose W/L =
5 μm/40 nm for the devices in the cir-
cuit shown below and IREF = 0.25 mA.
As VX is swept from low to high values,
we observe that I X still varies noticeably
even though all transistors are in satura-
tion for 0.4 V < VX.
IREF
VDD
Vb
VX
IX
0
0.2
0.4
0.6
0.8
1
0
0.05
0.1
0.15
0.2
0.25
0.3
0.35
0.4
VX (V)
IX (mA)
Solution
In this circuit, M3 raises the output impedance by sensing the voltage change at node X
and adjusting the voltage at node N. For example, suppose VX rises by V and tends
to increase ID1 by V/rO1. Transistor M3 then draws a current change of gm3V
from node N, causing VN to fall by approximately gm3V/gm2 and ID1 to decrease by
(gm3V/gm2)gm1. In other words, if we choose gm3gm1/gm2 ≈r−1
O1, the net change
in ID1 is small.
The circuit displays interesting large-signal properties. Let us sweep VX from 0
to a high value and examine ID1. At VX = 0, M1 operates in the deep triode region,
carrying a zero current, and M3 is off. As VX rises, so does ID1 proportionally, up to
VX = VGS1 −VTH1. Beyond this point, ID1 varies more gradually [Fig. 5.21(b)]. If
VX exceeds VTH3, M3 turns on and begins to “regulate” ID1, creating a higher output
impedance. However, for a sufﬁciently large VX, M3 absorbs all of IREF and turns
M1 off.
While providing a high output impedance without a cascode device, the above
circuit does pose its own voltage headroom limitation, i.e., VX must exceed
VTH3(> VDS,sat).
▲
5.3
Active Current Mirrors
As mentioned earlier and exempliﬁed by the circuit of Fig. 5.11, current
mirrors can also process signals, i.e., operate as “active” elements. Particu-
larly useful is a type of mirror topology used in conjunction with differen-
tial pairs. In this section, we study this circuit and its properties. Shown in
Fig. 5.22 and sometimes called a ﬁve-transistor “operational transconductance
ampliﬁer” (OTA), this topology ﬁnds application in many analog and digital
systems and merits a detailed study here. Note that the output is single-ended; hence the circuit is
sometimes used to convert differential signals to a single-ended output. We analyze a simpler topology
with passive load before studying the OTA.
Differential Pair with Passive Load
To generate a single-ended output, we may simply discard one
output of a differential pair as shown in Fig. 5.23(a). Here, a current source in a “passive ” mirror
arrangement serves as the load. What is the small-signal gain, Av = Vout/Vin, of this circuit? We

Sec. 5.3
Active Current Mirrors
147
VDD
M4
M1
M2
Vin1
Vout
M3
Vin2
Figure 5.22
Five-transistor OTA.
VDD
VDD
VDD
M3
M4
ISS
Vin
Vout
P
M3
M4
I1
I1
M1
M2
M1
M2
ISS
Vin
P
Iout
Vb
M2
rO4
gm1
1
rO2
Rout
(c)
(a)
(b)
rO1
Figure 5.23
(a) Differential pair with current-source load; (b) circuit for calculation of Gm; (c) circuit for
calculation of Rout.
calculate Av using two different approaches, assuming γ = 0 for simplicity. Owing to the asymmetry,
the half-circuit concept cannot be applied directly here.
Writing |Av| = Gm Rout, we must compute the short-circuit transconductance, Gm, and the output
resistance, Rout. We recognize from Fig. 5.23(b) that M1 and M2 become symmetric when the output is
shorted to ac ground. Thus, Gm = Iout/Vin = (gm1Vin/2)/Vin = gm1/2. As illustrated in Fig. 5.23(c),
for the Rout calculation, M2 is degenerated by the source output impedance of M1, Rdeg = (1/gm1)||rO1,
thereby exhibiting an output impedance equal to (1 + gm2rO2)Rdeg + rO2a ≈2rO2. It follows that
Rout = (2rO2)∥rO4, and
|Av| = gm1
2 [(2rO2)∥rO4]
(5.20)
Interestingly, if rO4 →∞, then Av →−gm1rO2.
In our second approach, we calculate VP/Vin and Vout/VP in Fig. 5.23(a) and multiply the results to
obtain Vout/Vin. With the aid of Fig. 5.24 and viewing M1 as a source follower, we write
VP
Vin
=
Req||rO1
Req||rO1 +
1
gm1
(5.21)

148
Chap. 5
Current Mirrors and Biasing Techniques
VDD
rO4
M1
Vin
M2
ISS
P
Vout
Req
Figure 5.24
Circuit for calculation of
VP/Vin.
where Req denotes the resistance seen looking into the source of M2. Since the drain of M2 is terminated
by a relatively large resistance, rO4, the value of Req must be obtained from Eq. (3.117):
Req = rO2 + rO4
1 + gm2rO2
(5.22)
It follows that
VP
Vin
=
gm1rO1(rO2 + rO4)
(1 + gm1rO1)(rO2 + rO4) + (1 + gm2rO2)rO1
(5.23)
We now calculate Vout/VP. From Fig. 5.25,
Vout
VP
= (1 + gm2rO2)rO4
rO2 + rO4
(5.24)
Vb
VDD
M2
rO4
rO2
Vout
VP
Figure 5.25
Circuit for calculation of
Vout/VP.
From (5.23) and (5.24), we have
Vout
Vin
= gm2rO2rO4
2rO2 + rO4
(5.25)
= gm2
2 [(2rO2)∥rO4]
(5.26)
Differential Pair with Active Load
In the circuit of Fig. 5.23(a), the small-signal drain current of
M1 is “wasted.” As conceptually shown in Fig. 5.26(a), it is desirable to utilize this current with proper
polarity at the output. This can be accomplished by the ﬁve-transistor OTA shown in Fig. 5.26(b), where
M3 and M4 are identical and operate as an active current mirror.

Sec. 5.3
Active Current Mirrors
149
VDD
M4
M1
M2
ISS
in
V
Vout
(a)
(b)
?
VDD
M4
M1
M2
ISS
Vin
Vout
M3
VDD
M4
M1
M2
ISS
Vout
M3
X
F
(c)
F
Figure 5.26
(a) Concept of combining the drain currents of M1 and M2, (b) realization of (a), and (c) response of
the circuit to differential inputs.
To see how M3 enhances the gain, suppose the gate voltages of M1 and M2 change by equal and
opposite amounts [Fig. 5.26(c)]. Consequently, ID1 increases, VF falls, and ID2 decreases. Thus, the
output voltage rises by means of two mechanisms: M2 draws less current from X to ground and M4
pushes a greater current from VDD to X. By contrast, in the circuit of Fig. 5.23(a), M4 plays no active role
in changing Vout because its gate voltage is constant. The ﬁve-transistor OTA is also called a differential
pair with active load.
5.3.1 Large-Signal Analysis
Let us study the large-signal behavior of the ﬁve-transistor OTA. To this end, we replace the ideal tail
current source by a MOSFET as shown in Fig. 5.27(a). If Vin1 is much more negative than Vin2, M1 is
off, and so are M3 and M4. Since no current can ﬂow from VDD, both M2 and M5 operate in the deep
triode region, carrying zero current. Thus, Vout = 0.3 As Vin1 approaches Vin2, M1 turns on, drawing a
fraction of ID5 from M3 and turning M4 on. The output voltage then depends on the difference between
ID4 and ID2. For a small difference between Vin1 and Vin2, both M2 and M4 are saturated, providing
a high gain [Fig. 5.27(b)]. As Vin1 becomes more positive than Vin2, ID1, |ID3|, and |ID4| increase and
ID2 decreases, allowing Vout to rise and eventually driving M4 into the triode region. If Vin1 −Vin2 is
sufﬁciently large, M2 turns off, M4 operates in the deep triode region with zero current, and Vout = VDD.
VDD
M4
M1
M2
Vin1
Vout
M3
P
(a)
Vin2
(b)
Vin1−Vin2
Vout
VDD
M
Vb
5
F
High−Gain
Region
Figure 5.27
(a) Differential pair with active current mirror and realistic current source; (b) large-signal
input-output characteristic.
3If Vin1 is greater than one threshold voltage with respect to ground, M5 may draw a small current from M1, raising Vout slightly.

150
Chap. 5
Current Mirrors and Biasing Techniques
Note that if Vin1 > VF + VTH, then M1 enters the triode region. Also, Vout is in-phase with respect to Vin1
but 180◦out of phase with respect to Vin2.
The choice of the input common-mode voltage of the circuit is also important. For M2 to be saturated,
the output voltage cannot be less than Vin,C M −VTH. Thus, to allow maximum output swings, the input
CM level must be as low as possible, with the minimum given by VGS1,2 + VDS5,min. The constraint
imposed by the input CM level upon the output swing in this circuit is a critical drawback.
What is the output voltage of the circuit when Vin1 = Vin2? With perfect symmetry, Vout = VF =
VDD −|VGS3|. This can be proved by contradiction as well. Suppose, for example, that Vout < VF. Then,
due to channel-length modulation, M1 must carry a greater current than M2 (and M4 a greater current
than M3). In other words, the total current through M1 is greater than half of ISS. But this means that
the total current through M3 also exceeds ISS/2, violating the assumption that M4 carries more current
than M3. In reality, however, asymmetries in the circuit may result in a large deviation in Vout, possibly
driving M2 or M4 into the triode region. For example, if the threshold voltage of M2 is slightly smaller
than that of M1, the former carries a greater current than the latter even with Vin1 = Vin2, causing Vout
to drop signiﬁcantly. For this reason, the circuit is rarely used in an open-loop conﬁguration to amplify
small signals. Nonetheless, the open-loop OTA proves useful as a differential to a single-ended converter
for large swings, as illustrated by the following example.
▲
Example5.8
Some digital circuits operate with differential (complementary) signals having voltage swings less than VDD. For
example,thesingle-endedswingcanbe300mVpp.Explainhowaﬁve-transistorOTAcanconvertthemoderate-swing
differential signals to a single-ended rail-to-rail signal.
Solution
Consider the OTA shown in Fig. 5.28, where M1 and M2 sense swings equal to V2 −V1 = 300 mV. With proper
choice of (W/L)1,2 and ISS, we can guarantee that such a swing turns off one side. For example, if M1 carries all
of ISS, then M2 remains off, allowing M4 to pull Vout to VDD. Conversely, when M2 hogs ISS, M1, M2, and M4
turn off, M2 and M5 remain on with zero current, and Vout = 0. The “push-pull” action between M2 and M4 thus
produces rail-to-rail swings at the output.
VDD
M4
M1
M2
Vout
M3
X
F
V1
V2
V2
V1
M5
ISS
P
Figure 5.28
In practice, Vout does not reach exactly VDD or zero if V1 > VTH1,2. The proof is left as an exercise for the reader.
(Hint: if M2 and M5 are in the deep triode region, then VP approaches zero, possibly turning on M1.) For this reason,
the OTA is typically followed by a CMOS inverter to obtain rail-to-rail swings.
▲
▲
Example5.9
Assuming perfect symmetry, sketch the output voltage of the circuit in Fig. 5.29(a) as VDD varies from 3 V to zero.
Assume that for VDD = 3 V, all of the devices are saturated.

Sec. 5.3
Active Current Mirrors
151
VDD
M4
M1
M2
Vout
M3
P
(a)
+1.5 V 
+1.5 V 
M5
F
Vb
VDD
Vout
VTHP
+3 V
+3 V –  VGS3
(b)
Figure 5.29
Solution
For VDD = 3 V, symmetry requires that Vout = VF. As VDD drops, so do VF and Vout with a slope close to unity
[Fig. 5.29(b)]. As VF and Vout fall below +1.5 V −VTHN, M1 and M2 enter the triode region, but their drain currents
are constant if M5 is saturated. Further decrease in VDD and hence VF and Vout causes VGS1 and VGS2 to increase,
eventually driving M5 into the triode region. Thereafter, the bias current of all of the transistors drops, lowering the
rate at which Vout decreases. For VDD < |VTHP|, we have Vout = 0.
▲
▲
Example5.10
Sketch the large-signal input-output characteristic of the unity-gain buffer shown in Fig. 5.30(a) if the op amp is
realized as a ﬁve-transistor OTA.
VDD
M4
M1
M2
M3
Vin
Vout
Vout
M5
Vb
Vin
Vin
Vout = Vin
VTH
M4 enters
triode region 
(c)
(a)
(b)
P
Figure 5.30
Solution
Drawing the circuit as shown in Fig. 5.30(b), we begin with Vin = 0 and note that M1, M3, and M4 are off. Thus, M5
enters the triode region with zero drain current and the diode-connected device M2 sustains a zero VGS.4 We therefore
have Vout = VP = 0 [Fig. 5.30(c)]. As Vin rises and exceeds one threshold, M1 begins to draw current from M3,
4In constructing input-output characteristics, we assume that the input is changing slowly, and hence the subthreshold currents
have enough time to reduce VGS to zero.

152
Chap. 5
Current Mirrors and Biasing Techniques
turning M4 and hence M2 on. Note that, since ID3 ≈ID4, we have ID1 ≈ID2 and VGS1 ≈VGS2. That is, Vout ≈Vin.
This unity-gain action continues as Vin increases. For a sufﬁciently high Vin, two phenomena occur: (a) M1 enters
the triode region if Vin > VDD −|VGS3|+ VTH1, and (b) M4 enters the triode region if Vout > VDD −|VGS4 −VTH4|,
and hence Vin > VDD −|VGS4 −VTH4|. These two values are roughly equal if VTH1 and |VTH4| are comparable.
Beyond this point, |ID4| < |ID3| (why?), and hence VGS1 > VGS2, yielding Vout < Vin. If Vin = VDD, then M4
carries little current and Vout incurs substantial error.
▲
Nanometer Design Notes
The ﬁve-transistor OTA provides a lim-
ited gain in nanometer technologies and
across a limited output range. With
VDD = 1 V, W/L = 5 μ/40 nm, a tail cur-
rent of 0.25 mA, and input CM level of 0.5
V, we obtain the characteristic shown be-
low. The slope plot also shows the steep
drop in the gain as the NMOS or PMOS
device tied to the output enters the triode
region.
−0.2
−0.1
0
0.1
0.2
0
0.2
0.4
0.6
0.8
1
Vin (V)
Vout (V)
−0.2
−0.1
0
0.1
0.2
0
1
2
3
4
5
6
Vin (V)
Av
5.3.2 Small-Signal Analysis
We now analyze the small-signal properties of the circuit shown in Fig. 5.27(a),
assuming γ = 0 for simplicity. Can we apply the half-circuit concept to
calculate the differential gain here? As illustrated in Fig. 5.31, with small
differential inputs, the voltage swings at nodes F and X are vastly different.
This is because the diode-connected device M3 yields a much lower voltage
gain from the input to node F than that from the input to node X. As a result,
the effects of VF and VX at node P (through rO1 and rO2, respectively) do not
cancel each other, and this node cannot be considered a virtual ground. Using
the lemma |Av| = Gm Rout, we ﬁrst perform an approximate analysis so as to
develop insight and then carry out an exact calculation of the gain.
VDD
M4
M1
M2
ISS
M3
P
rO1
rO2
F
X
Figure 5.31
Asymmetric swings
in a differential pair with active
current mirror.
Approximate Analysis
For the calculation of Gm, consider Fig. 5.32(a).
The circuit is not quite symmetric, but because the impedance seen at node
F is relatively low and the swing at this node small, the current returning
from F to P through rO1 is negligible, and node P can be approximated by
a virtual ground [Fig. 5.32(b)]. Thus, ID1 = |ID3| = |ID4| = gm1,2Vin/2 and ID2 = −gm1,2Vin/2, yielding
Iout = −gm1,2Vin, and hence |Gm| = gm1,2. Note that, by virtue of active current mirror operation, this
value is twice the transconductance of the circuit of Fig. 5.23(b).
Calculation of Rout is less straightforward. We may surmise that the output resistance of this circuit
is equal to that of the circuit in Fig. 5.23(c), namely, (2rO2)∥rO4. In reality, however, the active mirror
operation yields a different value because when a voltage is applied to the output to measure Rout, the
gate voltage of M4 does not remain constant. Rather than draw the entire equivalent circuit, we observe
that for small signals, ISS is open [Fig. 5.33(a)], any current ﬂowing into M1 must ﬂow out of M2, and the
role of the two transistors can be represented by a resistor RXY = 2rO1,2 [Fig. 5.33(b)]. As a result,
the current drawn from VX by RXY is mirrored by M3 onto M4 with unity gain. This current is equal to

Sec. 5.3
Active Current Mirrors
153
VDD
M4
M1
M2
ISS
M3
P
(a)
Iout
VDD
M4
M1
M2
Vin
M3
2
+
Vin
2
+
Vin
2
−
Vin
2
−
Iout
(b)
F
F
Figure 5.32
(a) Circuit for calculation of Gm; (b) circuit of (a) with node P grounded.
(b)
VDD
M4
M1
M2
M3
M4
VX
IX
RXY
VX
IX
gm3
1
2rO1,2
(a)
rO3
RXY
Figure 5.33
(a) Circuit for calculating Rout; (b) substitution of a resistor for M1 and M2.
VX/[2rO1,2 + (1/gm3)||rO3]. We multiply this current by (1/gm3)||rO3 to obtain the gate-source voltage
of M4 and then multiply the result by gm4. It follows that
IX =
VX
2rO1,2 +
1
gm3
||rO3
	
1 +
 1
gm3
||rO3

gm4

+ VX
rO4
(5.27)
For 2rO1,2 ≫(1/gm3)∥rO3, we have
Rout ≈rO2∥rO4
(5.28)
The overall voltage gain is approximately equal to |Av| = Gm Rout = gm1,2(rO2∥rO4), somewhat higher
than that of the circuit in Fig. 5.23(a).
Exact Analysis
We must compute both the Gm and Rout of the OTA. Let us determine the Gm, without
grounding node P, by solving the equivalent circuit shown in Fig. 5.34. For the sake of brevity, we use
the subscript 1 to denote both M1 and M2. Since the current ﬂowing downward through (1/gm3)||rO3
(denoted by rd hereafter) is −V4/rd, rO1 sustains a voltage equal to (−V4/rd −gm1V1)rO1. Adding this
voltage to VP = Vin1 −V1, we have

−V4
rd
−gm1V1

rO1 + Vin1 −V1 = V4
(5.29)

154
Chap. 5
Current Mirrors and Biasing Techniques
gm1V1
rO1
V1
V2
rO2
Vin2
P
Vin1
rO4
gm4V4
gm2V2
V4
Iout
1
gm3
rO3
rd = 
Figure 5.34
Equivalent circuit of ﬁve-transistor OTA
We also recognize that the sum of gm2V2 and the current ﬂowing through rO2 is equal to V4/rd (why?).
That is
gm2V2 −Vin2 −V2
rO2
= V4
rD
(5.30)
Obtaining V1 and V2 from these equations in terms of V4 and noting that V1 −V2 = Vin1 −Vin2 and
Iout = gm4V4 + V4/rd, we arrive at
Iout = −gm1rO1
gm4rd + 1
rd + 2rO1
(Vin1 −Vin2)
(5.31)
It follows that
Gm = −gm1rO1
gm4rd + 1
rd + 2rO1
(5.32)
In the next step, we calculate Rout. Let us express the output admittance from Eq. (5.27) as
IX
VX
= 1 + gm4rd
2rO1 + rd
+ 1
rO4
(5.33)
= (1 + gm4rd)rO4 + 2rO1 + rd
(2rO1 + rd)rO4
(5.34)
and hence
Gm Rout = −gm1rO1
(gm4rd + 1)rO4
(gm4rd + 1)rO4 + 2rO1 + rd
(5.35)
Since rd = rO3/(1 + gm3rO3), this expression reduces to
Gm Rout = −gm1rO1rO4
2gm3rO3 + 1
(2gm3rO3 + 1)rO4 + 2rO1(1 + gm3rO3) + rO3
(5.36)
= −gm1rO1rO4
rO1 + rO3
· 2gm3rO3 + 1
2(gm3rO3 + 1)
(5.37)
We thus obtain a simple but exact expression for the gain:
|Av| = gm1(rO1||rO4) 2gm4rO4 + 1
2(gm4rO4 + 1)
(5.38)

Sec. 5.3
Active Current Mirrors
155
We can view this result as our approximate solution, gm1(rO1||rO4), multiplied by a “correction” factor
that is less than unity. For example, if gm4rO4 = 5, then |Av| = 0.92gm1(rO1||rO4).
▲
Example5.11
With the aid of the above results, determine the output response to an input CM change if mismatches are neglected.
Solution
To represent an input CM change, we choose Vin1 = Vin2 in Fig. 5.34, obtaining from Eq. (5.31) Iout = 0. The
single-ended output voltage is therefore free from the input CM change.
▲
▲
Example5.12
Calculate the small-signal voltage gain of the circuit shown in Fig. 5.35. How does the performance of this circuit
compare with that of a differential pair with active mirror?
M1
VDD
M2
Vb
Vin
Vout
Figure 5.35
Solution
We have Av = gm1(rO1∥rO2), similar to the value derived above. For given device dimensions, this circuit requires
half of the bias current to achieve the same gain as a differential pair. However, advantages of differential operation
(less sensitivity to CM noise and less distortion) often outweigh the power penalty.
▲
The above calculations of the gain have assumed an ideal tail current source. In reality, the output
impedance of this source affects the gain, but the error is relatively small.
Headroom Issues
The ﬁve-transistor OTA does not easily lend itself to low-voltage operation as
the diode-connected PMOS device tends to consume a substantial voltage headroom. To arrive at a
modiﬁcation, we observe that the gate voltage of this device need not be equal to its drain voltage. As
shown in Fig. 5.36, we insert a resistor in series with the gate and draw a constant current from it, thereby
VDD
M4
M1
M2
Vout
M3
F
R1
I1
ISS
G
Figure 5.36
OTA headroom
improvement by level shift.

156
Chap. 5
Current Mirrors and Biasing Techniques
allowing VG to be below VF by R1I1 ≤VTH3. With this level shift, the input CM level can be higher,
easing the design of the preceding stage and the tail current source. The value of I1 must be much less
than ISS/2 so as to introduce negligible asymmetry between the two sides of the circuit. The reader is
encouraged to compute the input-referred offset voltage arising from I1.
5.3.3 Common-Mode Properties
Let us now study the common-mode properties of the differential pair with active current mirror. We
assume γ = 0 for simplicity and leave a more general analysis including body effect for the reader.
Our objective is to predict the consequences of a ﬁnite output impedance in the tail current source. As
depicted in Fig. 5.37, a change in the input CM level leads to a change in the bias current of all of the
transistors. How do we deﬁne the common-mode gain here? Recall from Chapter 4 that the CM gain
represents the corruption of the output signal of interest due to variations in the input CM level. In the
circuits of Chapter 3, the output signal was sensed differentially, and hence the CM gain was deﬁned in
terms of the output differential component generated by the input CM change. In the circuit of Fig. 5.37,
on the other hand, the output signal of interest is sensed with respect to ground. Thus, we deﬁne the CM
gain in terms of the single-ended output component produced by the input CM change:
AC M =
Vout
Vin,C M
(5.39)
VDD
M4
M1
M2
M3
Vout
F
X
Vin,CM
RSS
P
Figure 5.37
Differential pair with
active current mirror sensing a
common-mode change.
To determine AC M, we observe that if the transistors are symmetric, Vout = VF for any input CM level
(Section 5.3.1). For example, as Vin,C M increases, VF drops and so does Vout. In other words, nodes F
and X can be shorted [Fig. 5.38(a)], resulting in the equivalent circuit shown in Fig. 5.38(b). Here, M1
and M2 appear in parallel and so do M3 and M4. It follows that
AC M ≈
−
1
2gm3,4

rO3,4
2
1
2gm1,2
+ RSS
(5.40)
=
−1
1 + 2gm1,2RSS
gm1,2
gm3,4
(5.41)

Sec. 5.3
Active Current Mirrors
157
(a)
(b)
VDD
M4
M1
M3
Vout
F
X
Vin,CM
RSS
M2
RSS
rO1,2
2
rO3,4
2
1
2gm3,4
Vout
Vin,CM
2gm1,2
VDD
Figure 5.38
(a) Simpliﬁed circuit of Fig. 5.37; (b) equivalent circuit of (a).
where we have assumed that 1/(2gm3,4) ≪rO3,4 and neglected the effect of rO1,2/2. The CMRR is then
given by
CMRR =

ADM
AC M

(5.42)
= gm1,2(rO1,2∥rO3,4)gm3,4(1 + 2gm1,2RSS)
gm1,2
(5.43)
= (1 + 2gm1,2RSS)gm3,4(rO1,2∥rO3,4)
(5.44)
For example, if RSS = rO and 2gm1,2rO ≫1, then CMRR is on the order of (gmrO)2.
Equation (5.41) indicates that, even with perfect symmetry, the output signal is corrupted by input
CM variations. High-frequency common-mode noise therefore degrades the performance considerably
as the capacitance shunting the tail current source exhibits a lower impedance.
▲
Example5.13
The CM gain of the circuit of Fig. 5.37 can be shown to be zero by a (ﬂawed) argument. As shown in Fig. 5.39(a), if
Vin,C M introduces a change of I in the drain current of each input transistor, then ID3 also experiences the same
change, and so does ID4. Thus, M4 seemingly provides the additional current required by M2, and the output voltage
need not change, i.e., AC M = 0. Explain the ﬂaw in this proof.
Solution
The assumption that ID4 completely cancels the effect of ID2 is incorrect. Consider the equivalent circuit shown
in Fig. 5.39(b). Since
VF = I1

1
gm3
rO3

(5.45)
we have
|ID4| = gm4VF
(5.46)
= gm4I1
rO3
1 + gm3rO3
(5.47)

158
Chap. 5
Current Mirrors and Biasing Techniques
VDD
M4
M1
M2
M3
Vout
F
X
RSS
P
ΔI
ΔI
ΔVin,CM
VDD
M4
M3
Vout
F
X
ΔI1
ΔI2
rO4
rO3
(a)
(b)
Figure 5.39
This current and I2 ( = I1 = I) give a net voltage change equal to
Vout = (I1gm4
rO3
1 + gm3rO3
−I2)rO4
(5.48)
= −I
1
gm3rO3 + 1rO4
(5.49)
which is equal to the voltage change at node F.
▲
Effect of Mismatches
It is also instructive to calculate the common-mode gain in the presence of
mismatches. As an example, we consider the case where the input transistors exhibit slightly different
transconductances [Fig. 5.40(a)]. How does Vout depend on Vin,C M? Since the change at nodes F and X
is relatively small, we can compute the change in ID1 and ID2 while neglecting the effect of rO1 and rO2.
As shown in Fig. 5.40(b), the voltage change at P can be obtained by considering M1 and M2 as a single
transistor (in a source follower conﬁguration) with a transconductance equal to gm1 + gm2, i.e.,
VP = Vin,C M
RSS
RSS +
1
gm1 + gm2
(5.50)
where body effect is neglected. The changes in the drain currents of M1 and M2 are therefore given by
ID1 = gm1(Vin,C M −VP)
(5.51)
=
Vin,C M
RSS +
1
gm1 + gm2
gm1
gm1 + gm2
(5.52)
ID2 = gm2(Vin,C M −VP)
(5.53)
=
Vin,C M
RSS +
1
gm1 + gm2
gm2
gm1 + gm2
(5.54)

Sec. 5.3
Active Current Mirrors
159
VDD
M4
M1
M2
M3
Vout
F
X
RSS
P
gm1
gm2
(a)
M1
Vin,CM
RSS
M2
P
(b)
Vin,CM
Figure 5.40
Differential pair with gm mismatch.
The change ID1 multiplied by (1/gm3)∥rO3 yields |ID4| = gm4[(1/gm3)∥rO3]ID1. The difference
between this current and ID2 ﬂows through the output impedance of the circuit, which is equal to rO4
because we have neglected the effect of rO1 and rO2:
Vout =
⎡
⎢⎢⎣
gm1Vin,C M
1 + (gm1 + gm2)RSS
rO3
rO3 +
1
gm3
−
gm2Vin,C M
1 + (gm1 + gm2)RSS
⎤
⎥⎥⎦rO4
(5.55)
=
Vin,C M
1 + (gm1 + gm2)RSS
(gm1 −gm2)rO3 −gm2/gm3
rO3 +
1
gm3
rO4
(5.56)
If rO3 ≫1/gm3, we have
Vout
Vin,C M
≈(gm1 −gm2)rO3 −gm2/gm3
1 + (gm1 + gm2)RSS
(5.57)
Compared to Eq. (5.41), this result contains the additional term (gm1−gm2)rO3 in the numerator, revealing
the effect of transconductance mismatch on the common-mode gain.
5.3.4 Other Properties of Five-Transistor OTA
The ﬁve-transistor OTA suffers from two drawbacks with respect to the fully-differential topologies
studied in Chapter 4. First, the circuit exhibits a ﬁnite CMRR even with perfectly-matched transistors. As
depicted in Fig. 5.41(a), an input CM change directly corrupts Vout in this OTA, but not the differential
output in the fully-differential version [Fig. 5.41(b)].
Second, the supply rejection of this OTA is inferior. To understand this point, let us tie the inputs to a
constant voltage and change VDD by a small amount, VDD [Fig. 5.42(a)]. How much does VF change?
Viewing M1 as a constant current source with a high output impedance, we recognize that VGS3 must
remain relatively constant. That is, VF ≈VDD. With symmetric transistors, Vout must also change by
VDD. In other words, the gain from VDD to Vout is about unity.
Now consider the fully-differential topology in Fig. 5.42(b), where the PMOS current sources are
biased by a current mirror arrangement. How do VX and VY change here in response to a supply change

160
Chap. 5
Current Mirrors and Biasing Techniques
VDD
M4
M1
M2
M3
F
Vout
X
Vin,CM
RSS
P
VDD
M4
M1
M2
Vin,CM
RSS
P
Vb
M3
Vout
(a)
(b)
Figure 5.41
Input CM response of (a) ﬁve-transistor OTA and (b) fully-differential ampliﬁer with
current-source loads.
VDD
M4
M1
M2
M3
Vout
F
X
VDD
M4
M3
ISS
VCM
ΔVDD
ΔVDD
ΔVDD
M1
M2
ISS
VCM
IB
M5
X
Y
M3 + M4
M1 + M2
ISS
VCM
X,Y
VDD
rO3 rO4
(c)
(a)
(b)
Figure 5.42
(a) OTA with supply step, (b) fully-differential circuit with supply step, and (c) equivalent circuit
of (b).
of VDD? We note that VGS5 and hence VGS3 and VGS4 are constant, and, by virtue of symmetry, VX and
VY must change by equal amounts. We thus short X and Y and merge M3 with M4 and M1 with M2
[Fig. 5.42(c)]. If the output impedance of the cascode circuit consisting of M1 + M2 and ISS is very high,
then VX = VY ≈VDD (why?). In this case, too, the output voltages change by VDD, but their
difference remains intact. We should caution the reader that this circuit requires common-mode feedback
(Chapter 9).
5.4
Biasing Techniques
The ampliﬁer stages studied thus far must be properly biased so that, in the absence of the input signal,
each transistor carries the required current and sustains the necessary terminal voltages. We recognize
that the current establishes the transconductance and output resistance of the transistor while the terminal
voltages determine the headroom and hence the allowable voltage swings. In this section, we consider a
number of biasing techniques for CMOS circuits.

Sec. 5.4
Biasing Techniques
161
5.4.1 CS Biasing
Simple CS Stage
We wish to create a certain drain current and desired VGS and VDS for a transistor in
a CS conﬁguration. Using the transistor’s I/V characteristics, we have determined its dimensions and
must now tie the gate to a proper bias voltage [Fig. 5.43(a)]. But how do we ensure that VB does not
“ﬁght” Vin? One solution is to couple Vin capacitively and establish a high impedance for VB so that X
has the same dc voltage as VB and the same signal voltage as Vin [Fig. 5.43(b)]. Noting that CB and RB
form a high-pass ﬁlter, we select 1/(2π RBCB) lower than the lowest input frequency so that the ac gain
from Vin to VX is near unity in the frequency range of interest.
M1
RD
Vout
VDD
Vin
VB
M 1
RD
Vout
VDD
VB
CB
Vin
RB
X
M1
RD
Vout
VDD
CB
Vin
RB
X
MB
VDD
IB
VB
M1
RD
Vout
VDD
CB
Vin
X
MB
VDD
IB
VG
MR
M1
RD
Vout
VDD
CB
Vin
X
MB
VDD
IB
VG
MR
MC
(c)
(a)
(b)
(d)
(e)
?
Figure 5.43
CS stage biasing with (a) VB ﬁghting Vin, (b) ac coupling to set the dc value of VX to VB, (c) use of
a current mirror, (d) a large resistor realized by MR, and (e) accurate VGS generation for MR.
We now make several remarks. (1) Node X in Fig. 5.43(b) must have a dc path to a voltage; if RB is
removed, X ﬂoats, sustaining a poorly-deﬁned voltage.5 (2) As explained in Sec. 5.1, the bias voltage,
VB, must not be constant; rather, it must be generated by a diode-connected device [Fig. 5.43(c)]. (3) We
typically select IB about one-tenth to one-ﬁfth of ID1 so as to minimize the power consumed by the
bias network. (4) The capacitor and the resistor may occupy a large chip area if Vin contains very low
frequencies, e.g., in the audio range. (5) The capacitor introduces its own parasitics in the signal path
(Chapter 19), degrading the high-frequency performance; even if chip area is not critical, the value of the
capacitor is limited by these parasitic effects.
In applications requiring a large RBCB product, one can replace RB with a long, narrow MOSFET
operating in the deep triode region and bias this transistor with a small overdrive voltage, thus maximizing
5In reality, the gate leakage current of M1 would discharge X to zero.

162
Chap. 5
Current Mirrors and Biasing Techniques
its on-resistance [Fig. 5.43(d)]. But how do we guarantee that MR does not turn off with PVT variations?
While small, the overdrive of MR must still be well-controlled, i.e., VG −VB must still be around VTH.
This difference can be created by means of a diode-connected device [Fig. 5.43(e)]. If (W/L)C is large,
VGS,C ≈VTH, producing a high resistance in MR. Using a long-channel model, the reader can prove that,
in strong inversion,
Ron,R = (W/L)C
(W/L)R
1
gm,C
(5.58)
We conclude that (W/L)C must be maximized and (W/L)R minimized. In Problem 5.24, we reexamine
the circuit in the subthreshold region.
Is it possible to remove the input coupling capacitor and provide the bias voltage from the preceding
stage? Figure 5.44 depicts an example, where VDD −RD2ID2 serves as the bias gate voltage of M1. The
principal difﬁculty here is that the bias conditions of M1 are inﬂuenced by those of M2. For example,
if ID2 varies with PVT variations, so do VX and hence ID1. In such a cascade, the PVT variations are
ampliﬁed because they are indistinguishable from the signal. Nonetheless, one can employ direct coupling
between two stages if each has a low gain, e.g., around 2 or 3. For a larger number of stages or higher
gains, negative feedback may become necessary, especilly if the load resistors are replaced with current
sources (Chapter 8).
M1
RD1
Vout
VDD
M2
RD2
Vin
X
Figure 5.44
Direct coupling between
two stages.
CS Stage with Current-Source Load
We now turn our attention to the common-source stage with
current-source load [Fig. 5.45(a)]. The foregoing techniques can be readily applied to both M1 and
M2, yielding the circuit shown in Fig. 5.45(b). We note that ID1 and ID2 are copied from IB1 and IB2,
respectively.
M1
VDD
M2
Vb
Vin
M1
VDD
M2
CB
Vin
MB
IB1
M5
IB2
M1
VDD
M2
CB
Vin
MB
IB1
RG
CG
Vout
Vout
Vout
M1
VDD
M2
CB
Vin
MB
IB1
RG
CG
Vout
IG
N
(c)
(a)
(b)
(d)
Figure 5.45
(a) CS stage with current-source load; (b) simple biasing; (c) self-biasing of current source; (d) use
of IG to shift the output.

Sec. 5.4
Biasing Techniques
163
The CS stage with current-source load exempliﬁes a situation sometimes encountered in analog design:
two high-impedance current sources, M1 and M2, ﬁght each other. That is, if the copied currents in
Fig. 5.45(b) are not exactly equal, each transistor wants to impose its own current. (Imagine what happens
if two unequal ideal current sources are placed in series.) For example, if ID1 tends to be greater than
|ID2|, then Vout falls—possibly driving M1 into the triode region—until ID1 becomes equal to |ID2|. To
resolve this issue, we modify the circuit as shown in Fig. 5.45(c), where M2 acts as a diode-connected
device at dc, happily carrying the current imposed by M1. At high frequencies, CG shorts the gate of M2
to ground, yielding a small-signal gain equal to
Av = −gm1(rO1||rO2||RG)
(5.59)
We therefore select RG ≫rO1||rO2 and 1/(2π RGCG) less than the lowest signal frequency of interest.
In the above CS stage, M2 forces the bias value of Vout to be as low as VDD −|VGS2|. We can draw a
constant current of IG from RG [Fig. 5.45(d)] so that VN is still low enough to provide the necessary VGS
for M2, but Vout = VN + IG RG is higher. The value of IG is chosen much less than the bias current.
▲
Example5.14
Compare the maximum allowable voltage swings in Figs. 5.45(c) and (d).
Solution
In Fig. 5.45(c), Vout begins from VDD −|VGS2| and can rise to VDD −|VGS2 −VTH2| and fall to VGS1 −VTH1.
However, as illustrated in Fig. 5.46(a), since the down swing is limited to VDD −|VGS2| −(VGS1 −VTH1), the up
swing cannot reach its maximum. Thus, the allowable peak-to-peak swing is about 2[VDD −|VGS2|−(VGS1−VTH1)].
t
VDD
VDD −VGS2 − VTH2
VDD −VGS2
VGS1 − VTH1
t
VDD
VDD −VGS2 − VTH2
VDD −VGS2
VGS1 − VTH1
+ IGRG
(a)
(b)
Figure 5.46
In Fig. 5.45(d), on the other hand, IG RG can shift the operating point such that the down swing and the up swing
are approximately equal. From Fig. 5.46(b), we have
VDD −|VGS2| + IG RG −(VGS1 −VTH1) ≈VDD −|VGS2 −VTH2| −[VDD −|VGS2| + IG RG]
(5.60)
If the NMOS and PMOS overdrives are roughly equal, we must choose
IG RG ≈|VGS2| −VDD
2
(5.61)
in which case the output peak-to-peak swing can reach 2[VDD/2 −(VGS1 −VTH1)]. Alternatively, we can choose
|VGS2| = VDD/2 and apply no IG. As explained in Chapter 7, M2 contributes less noise as its overdrive increases
(while its bias current remains constant), making the former topology more attractive.
▲

164
Chap. 5
Current Mirrors and Biasing Techniques
M1
VDD
M2
Vin
Vout
M1
M2
Vin
RF
X
M1
VDD
M2
Vin
Vout
RF
I1
C1
X
VDD
M1
VDD
M2
Vin
Vout
RF
I1
C1
X
Cin
(c)
(a)
(b)
(d)
Vout
Figure 5.47
(a) Complementary CS stage, (b) self-biased topology, (c) accurate deﬁnition of bias current, and (d)
use of ac coupling at input.
Complementary CS Stage
Let us now consider the problem of biasing for the CS stage with active
current source [Fig. 5.47(a)]. As explained in Chapter 3, this topology exhibits considerable PVT depen-
dence because VGS1 + |VGS2| = VDD. Also, in a manner similar to the CS stage of Fig. 5.45(b), M1 and
M2 ﬁght each other.
As a ﬁrst step, consider the arrangement shown in Fig. 5.47(b), where a large resistor is tied between the
drains and gates of the transistors. In the absence of signals, no current ﬂows through RF and Vout = VX; in
essence, each transistor is conﬁgured as a diode-connected device and guaranteed to operate in saturation.
The two devices therefore do not ﬁght anymore: if for example, M1 tends to carry a larger drain current,
then Vout and hence VX fall so that ID1 = |ID2|.
To deﬁne the bias current accurately, we modify the circuit as shown in Fig. 5.47(c). Here, I1 establishes
the drain currents of M1 and M2, and C1 creates a short circuit at the lowest signal frequency of interest,
ωmin. The value of C1 is chosen such that M2 experiences negligible degeneration:
1
C1ωmin
≪
1
gm2
(5.62)
Note that I1 consumes additional voltage headroom in this case.
Since the bias voltage at node X must track Vout, the input must be capacitively coupled [Fig. 5.47(d)].
In Problem 5.25, we compute the corner frequency of the high-pass ﬁlter formed by Cin and the remainder
of the circuit. This frequency must be chosen lower than ωmin. With sufﬁciently large values for Cin,
RF, and C1, the voltage gain of the ampliﬁer at signal frequencies of interest is still given by (gm1 +
gm2)(rO1||rO2).
5.4.2 CG Biasing
In a common-gate stage, the transistor must carry a bias current while sensing the input at its source
terminal. Thus, the source cannot be directly tied to the ground, requiring an intervening element that
passes dc, e.g., a resistor, a current source, or an inductor. Figure 5.48(a) depicts an example where M1
and MB form a current mirror so that ID1 is a multiple of IB. For proper copying of IB, we must ensure
that VGS1 = VGS,B. We therefore choose (W/L)1/(W/L)B equal to the desired ratio for ID1 and IB (e.g.,
in the range of 5 to 10) and apply the same ratio to RB/RS, i.e., RB/RS = ID1/IB.
The circuit of Fig. 5.48(a) faces difﬁculties in low-voltage design. In the presence of a ﬁnite driv-
ing impedance, R1 (i.e., the output impedance of the preceding stage), the signal experiences addi-
tional attenuation due to RS. Neglecting channel-length modulation, we write the voltage gain from Vin

Sec. 5.4
Biasing Techniques
165
RD
Vout
VDD
M1
MB
RB
RS
IB
Vin
R1
X
RD
Vout
VDD
M1
IB
Vin
R1
X
M2
Vb
RD
Vout
VDD
IB
Vin
R1
X
M2
M3
Vb
(c)
(a)
(b)
M1
Cin
Cin
Cin
MB
MB
Figure 5.48
CG stage with (a) resistive path from source to ground, (b) current-source biasing, and (c)
low-voltage current mirror.
to VX as
VX
Vin
=
1
gm1 + gmb1
||RS
1
gm1 + gmb1
||RS + R1
(5.63)
concluding that RS must be much greater than 1/(gm1 + gmb1) to minimize this attenuation. However,
since the gain from VX to Vout is equal to (gm1 + gmb1)RD, this means that RS may reach or even
exceed RD. Thus, RS may sustain a large dc voltage drop, limiting the dc drop across RD and hence the
voltage gain.
To remedy the situation, we replace RS with a current source [Fig. 5.48(b)]. Here, M2 exhibits a high
impedance but does not necessarily require a high VDS. Copied from IB, the drain current of M2 does
incur some error due to channel-length modulation because VDS2 < VDS,B. This issue is reminiscent of
the cascode current mirror studied in Section 5.2 and can be resolved by means of a low-voltage cascode
topology [Fig. 5.48(c)]. The bias voltage, Vb, is also generated as explained in Section 5.2.
5.4.3 Source Follower Biasing
Source followers are typically biased by means of a current source as shown in Fig. 5.49(a). If the
mismatch between ID2 and IB due to channel-length modulation proves undesirable, a resistor can be
placed in series with the drain of MB (Sec. 5.2). Deﬁned by M2, the bias current of M1 is less sensitive to
its gate voltage than in a CS ampliﬁer, allowing direct connection to the preceding stage. In applications
where the input dc voltage may vary considerably, capacitive coupling can be used [Fig. 5.49(b)]. Note
that the gate voltage of M1 begins at VDD and can swing up by one threshold before the transistor enters
the triode region.
IB
VDD
M1
MB
M2
Vin
Vout
IB
VDD
M1
MB
M2
Vin
out
V
Rin
Cin
(a)
(b)
Figure 5.49
Source follower biasing with (a) current source and (b) ac coupling at input.

166
Chap. 5
Current Mirrors and Biasing Techniques
▲
Example5.15
A source follower serves as an output buffer for a CS stage. Study the performance with and without capacitive
coupling between the two stages.
Solution
In Fig. 5.50(a), the minimum drain voltage of M3 is given by VGS1 +VDS2,min, leaving little for the allowable voltage
drop across RD. The CS voltage gain is therefore severely limited. In the circuit of Fig. 5.50(b), on the other hand,
the ﬁrst stage’s gain can be independently maximized.
VDD
M1
M2
Vout
VDD
M1
M2
Vout
RB
CC
(a)
(b)
M3
RD
Vin
X
M3
RD
Vin
X
Figure 5.50
▲
5.4.4 Differential Pair Biasing
In addition to the tail current source, the gate voltage of a differential pair must also be deﬁned. To
maximize the voltage gain and/or output swings, we select the lowest input CM level, as shown in
Fig. 5.51(a), equal to VGS1,2 + VDS3,min. This choice allows the drain voltages of M1 and M2 to be as low
as (VGS1,2 −VTH1,2) + VDS3,min (two overdrive voltages above ground) and hence maximum RD.
Vout
RD
M1
RD
VDD
M2
Vin,CM
Vin,CM
M3
Vb
M4
M5
M6
Vout
RD
M1
RD
VDD
M2
M3
X
Y
(a)
(b)
Figure 5.51
(a) Choice of input CM level for a differential pair, and (b) cascaded pairs.
Since the bias currents of M1 and M2 in Fig. 5.51(a) are relatively insensitive to their gate voltages, we
can directly connect their gates to the preceding stage [Fig. 5.51(b)]. This approach, however, constrains
the overall voltage gain: if the bias value of VX and VY is chosen equal to two overdrives above ground
so as to maximize the gain of the ﬁrst stage, then it is an excessively low common-mode level for the
second stage (why?). For this reason, we may resort to capacitive coupling in some cases.

Problems
167
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. All device dimensions are effective values and in microns.
5.1.
In Fig. 5.2, assume that (W/L)1 = 50/0.5, λ = 0, Iout = 0.5 mA, and M1 is saturated.
(a) Determine R2/R1.
(b) Calculate the sensitivity of Iout to VDD, deﬁned as ∂Iout/∂VDD and normalized to Iout.
(c) How much does Iout change if VTH changes by 50 mV?
(d) If the temperature dependence of μn is expressed as μn ∝T −3/2 but VTH is independent of temperature,
how much does Iout vary if T changes from 300 ◦K to 370 ◦K?
(e) What is the worst-case change in Iout if VDD changes by 10%, VTH changes by 50 mV, and T changes
from 300 ◦K to 370 ◦K?
5.2.
Consider the circuit of Fig. 5.7. Assuming IREF is ideal, sketch Iout versus VDD as VDD varies from 0 to 3 V.
5.3.
In the circuit of Fig. 5.8, (W/L)N = 10/0.5, (W/L)P = 10/0.5, and IREF = 100 μA. The input CM level
applied to the gates of M1 and M2 is equal to 1.3 V.
(a) Assuming λ = 0, calculate VP and the drain voltage of the PMOS diode-connected transistors.
(b) Now take channel-length modulation into account to determine IT and the drain current of the PMOS
diode-connected transistors more accurately.
5.4.
In the circuit of Fig. 5.11, sketch Vout versus VDD as VDD varies from 0 to 3 V.
5.5.
Consider the circuit of Fig. 5.12(a), assuming (W/L)1−3 = 40/0.5, IREF = 0.3 mA, and γ = 0.
(a) Determine Vb such that VX = VY .
(b) If Vb deviates from the value calculated in part (a) by 100 mV, what is the mismatch between Iout and
IREF?
(c) If the circuit fed by the cascode current source changes VP by 1 V, how much does VY change?
5.6.
The circuit of Fig. 5.18(b) is designed with (W/L)1,2 = 20/0.5, (W/L)3,0 = 60/0.5, and IREF = 100 μA.
(a) Determine VX and the acceptable range of Vb.
(b) Estimate the deviation of Iout from 300 μA if the drain voltage of M3 is higher than VX by 1 V.
5.7.
The circuit of Fig. 5.23(a) is designed with (W/L)1−4 = 50/0.5 and ISS = 2I1 = 0.5 mA.
(a) Calculate the small-signal voltage gain.
(b) Determine the maximum output voltage swing if the input CM level is 1.3 V.
5.8.
Consider the circuit of Fig. 5.29(a) with (W/L)1−5 = 50/0.5 and ID5 = 0.5 mA.
(a) Calculate the deviation of Vout from VF if |VTH3| is 1 mV less than |VTH4|.
(b) Determine the CMRR of the ampliﬁer.
5.9.
Sketch VX and VY as a function of VDD for each circuit in Fig. 5.52. Assume the transistors in each circuit
are identical.
5.10. Sketch VX and VY as a function of VDD for each circuit in Fig. 5.53. Assume the transistors in each circuit
are identical.
5.11. For each circuit in Fig. 5.54, sketch VX and VY as a function of V1 for 0 < V1 < VDD. Assume the transistors
in each circuit are identical.
5.12. For each circuit in Fig. 5.55, sketch VX and VY as a function of V1 for 0 < V1 < VDD. Assume the transistors
in each circuit are identical.
5.13. For each circuit in Fig. 5.56, sketch VX and VY as a function of IREF.
5.14. For the circuit of Fig. 5.57, sketch Iout, VX, VA, and VB as a function of (a) IREF, (b) Vb.
5.15. In the circuit shown in Fig. 5.58, a source follower using a wide transistor and a small bias current is inserted
in series with the gate of M3 so as to bias M2 at the edge of saturation. Assuming M0–M3 are identical and
λ ̸= 0, estimate the mismatch between Iout and IREF if (a) γ = 0, (b) γ ̸= 0.
5.16. Sketch VX and VY as a function of time for each circuit in Fig. 5.59. Assume the transistors in each circuit are
identical.

168
Chap. 5
Current Mirrors and Biasing Techniques
(c)
(a)
(b)
(e)
(d)
VDD
VDD
VDD
M1
R1
M2
R1
X
M1
R1
M2
R1
X
R2
M1
R1
M2
R1
X
R2
VDD
VDD
M1
R1
M2
R1
X
R2
M1
R1
M2
R1
X
Y
Y
Y
Y
Y
R2
Figure 5.52
(a)
(b)
VDD
VDD
M1
M2
R1
X
M3
M4
M1
R1
M2
R1
X
Y
Y
M3
Figure 5.53
(c)
(a)
(b)
M1
R1
M2
X
M1
R1
M2
X
R2
IREF
VDD
V1
R2
IREF
V1
VDD
VDD
M1
R1
M2
X
Y
Y
Y
R2
IREF
V1
Figure 5.54

Problems
169
M1
R1
M2
X
M3
IREF
V1
M1
R1
M2
X
Y
Y
M3
IREF
V1
VDD
(a)
(b)
Figure 5.55
(c)
(a)
(b)
M1
R1
M2
X
IREF
VDD
VDD
VDD
R2
M1
R1
M2
X
M3
IREF
M1
M2
X
Y
Y
Y
M3
M4
IREF
Figure 5.56
M1
Vb
M2
M3
M4
IREF
VDD
Iout
X
A
B
Figure 5.57
IREF
M0
M1
VDD
X
Iout
I1
M2
M3
M4
Vb1
Figure 5.58

170
Chap. 5
Current Mirrors and Biasing Techniques
(e)
M1
R1
M2
X
Y
(c)
(a)
(b)
VDD
VDD
VDD
M1
R1
M2
X
Y
IREF
(d)
C1
0
M1
R1
M2
X
Y
IREF
C1
0
C1
V0
VDD
M1
M2
R1
X
Y
C1
V0
VDD
M1
R1
M2
R1
X
Y
C1
V0
Figure 5.59
5.17. Sketch VX and VY as a function of time for each circuit in Fig. 5.60. Assume the transistors in each circuit are
identical.
(c)
(a)
(b)
M1
M2
X
Y
IREF
M3
Vb
C1
0
VDD
VDD
VDD
R1
M1
M2
X
Y
M3
Vb
C1
M1
M2
X
Y
M3
Vb
C1
IREF
VDD
VDD
IREF
R1
Figure 5.60
5.18. Sketch VX and VY as a function of time for each circuit in Fig. 5.61. Assume the transistors in each circuit are
identical.
5.19. The circuit shown in Fig. 5.62 exhibits a negative input inductance. Calculate the input impedance of the
circuit and identify the inductive component.
5.20. Due to a manufacturing defect, a large parasitic resistance, R1, has appeared in the circuits of Fig. 5.63.
Calculate the gain of each circuit if λ > 0.
5.21. In digital circuits such as memories, a differential pair with an active current mirror is used to convert a
small differential signal to a large single-ended swing (Fig. 5.64). In such applications, it is desirable that the
output levels be as close to the supply rails as possible. Assuming moderate differential input swings (e.g.,
V = 0.1 V) around a common-mode level Vin,C M and a high gain in the circuit, explain why Vmin depends
on Vin,C M.
5.22. Sketch VX and VY for each circuit in Fig. 5.65 as a function of time. The initial voltage across C1 is shown.

Problems
171
VDD
M1
Y
M3
M2
X
C1
0
VDD
M1
Y
M3
M2
X
C1
0
(a)
(b)
Figure 5.61
VDD
M3
M2
C1
I1
M1
Zin
Figure 5.62
M1
M2
Vout
Vin1
Vin2
VDD
M4
M3
ISS
R1
M1
M2
Vout
Vin1
Vin2
VDD
M4
M3
ISS
R1
(a)
(b)
Figure 5.63
M1
M2
M5
Vb
VDD
M4
M3
N
P
Vout
Vmax
Vmin
ΔV
ΔV
Figure 5.64

172
Chap. 5
Current Mirrors and Biasing Techniques
M1
M2
VDD
M4
M3
ISS
X
VDD
C1
Y
P
+1.5 V
M1
M2
VDD
VDD
M4
M3
ISS
(b)
X
Y
P
+1.5 V
(a)
C1
0
M1
M2
M4
M3
ISS
X
Y
P
+1.5 V
C1
0
(c)
Figure 5.65
5.23. If in Fig. 5.66, V is small enough that all of the transistors remain in saturation, determine the time constant
and the initial and ﬁnal values of Vout.
M1
M2
VDD
M4
M3
ISS
X
P
Vout
CL
V1
Vin
V1
ΔV
Figure 5.66
5.24. For a device operating in the subthreshold region, we have
ID = μCd
W
L V 2
T

exp VGS −VTH
VT

1 −exp −VDS
VT

(5.64)
(a) If the device is in the deep triode region, VDS ≪VT . Using exp(−ϵ) ≈1−ϵ, determine the on-resistance.
(b) If the device is in saturation, VDS ≫VT . Compute the transconductance.
(c) Find the relation between gm,B and Ron,R in Fig. 5.43(d) using the above results.
5.25. Determine the corner frequency resulting from Cin in Fig. 5.47(d). For simplicity, assume C1 is a short circuit.
5.26. Determine the supply rejection of the circuit shown in Fig. 5.67.
VDD
M4
M1
M2
ISS
Vout
M3
Figure 5.67

CHAPTER
6
Frequency Response of Ampliﬁers
Our analysis of simple ampliﬁers has thus far focused on low-frequency characteristics, neglecting the
effect of device and load capacitances. In most analog circuits, however, the speed trades with many
other parameters such as gain, power dissipation, and noise. It is therefore necessary to understand the
frequency-response limitations of each circuit.
In this chapter, we study the behavior of single-stage and differential ampliﬁers in the frequency
domain. Following a review of basic concepts, we analyze the high-frequency response of common-
source and common-gate stages and source followers. Next, we deal with cascode and differential am-
pliﬁers. Finally, we consider the effect of active current mirrors on the frequency response of differential
pairs.
6.1
General Considerations
Recall that a MOS device exhibits four capacitances: CGS, CGD, CDB, and CSB. For this reason, the
transfer function of CMOS circuits can rapidly become complicated, calling for approximations that
simplify the circuit. In this section, we introduce two such approximations, namely, Miller’s theorem
and association of poles with nodes. We remind the reader that a two-terminal impedance, Z, is deﬁned
as Z = V/I, where V and I denote the voltage across and the current ﬂowing through the device.
For example, Z = 1/(Cs) for a capacitor. Also, the transfer function of a circuit yields the frequency
response if we replace s with jω, i.e., if we assume a sinusoidal input such as A cos ωt. For example,
H( jω) = (RC jω + 1)−1 provides the magnitude and phase of a simple low-pass ﬁlter.
In this chapter, we are primarily interested in the magnitude of the transfer function (with s =
jω). Figure 6.1 shows examples of magnitude response. We should also remark that, even if computed
exactly, some transfer functions do not offer much insight. We therefore study numerous special cases
by considering extreme conditions, e.g., if the load capacitance is very small or very large.
A few basic concepts are used extensively throughout this chapter and merit a brief review. (1) The
magnitude of a complex number a + jb is given by
√
a2 + b2. (2) Zeros and poles are respectively
deﬁned as the roots of the numerator and denominator of the transfer function. (3) According to Bode’s
approximations, the slope of the magnitude of a transfer function increases by 20 dB/decade as ω passes
a pole frequency and decreases by 20 dB/decade as ω passes a zero frequency.
173

174
Chap. 6
Frequency Response of Ampliﬁers
 ω  
Vout
Vin
 ( jω)  
Vout
Vin
 ( jω)  
Vout
Vin
 ( jω)  
 ω  
 ω  
(a)
(b)
(c)
Figure 6.1
(a) Low-pass, (b) band-pass, and (c) high-pass frequency-response examples.
6.1.1 Miller Effect
An important phenomenon that occurs in many analog (and digital) circuits is related to the “Miller
effect,” as described by Miller in a theorem.
Miller’s Theorem
If the circuit of Fig. 6.2(a) can be converted to that of Fig. 6.2(b), then Z1 =
Z/(1 −Av) and Z2 = Z/(1 −A−1
v ), where Av = VY/VX.
Z
X
Y
X
Y
Z1
Z2
(a)
(b)
Figure 6.2
Application of Miller effect to a ﬂoating impedance.
Proof
The current ﬂowing through Z from X to Y is equal to (VX −VY)/Z. For the two circuits to be
equivalent, the same current must ﬂow through Z1. Thus,
VX −VY
Z
= VX
Z1
(6.1)
that is
Z1 =
Z
1 −VY
VX
(6.2)
Similarly,
Z2 =
Z
1 −VX
VY
(6.3)
This decomposition of a “ﬂoating” impedance, Z, into two “grounded” impedances proves useful in
analysis and design.
▲
Example6.1
Consider the circuit shown in Fig. 6.3(a), where the voltage ampliﬁer has a negative gain equal to −A and is otherwise
ideal. Calculate the input capacitance of the circuit.

Sec. 6.1
General Considerations
175
Z1
Z2
CF
X
Y
X
Y
Cin
−A
−A
−A ΔV
ΔV
−A
X
Y
CF
(c)
(a)
(b)
Figure 6.3
Solution
Using Miller’s theorem to convert the circuit to that shown in Fig. 6.3(b), we have Z = 1/(CFs) and Z1 =
[1/(CFs)]/(1 + A). That is, the input capacitance is equal to CF(1 + A). We call this effect “Miller multiplication”
of the capacitor.
Why is CF multiplied by 1+ A? Suppose, as depicted in Fig. 6.3(c), we measure the input capacitance by applying
a voltage step at the input and calculating the charge supplied by the voltage source. A step equal to V at X results
in a change of −AV at Y, yielding a total change of (1 + A)V in the voltage across CF. Thus, the charge drawn
by CF from Vin is equal to (1 + A)CFV and the equivalent input capacitance equal to (1 + A)CF.
▲
▲
Example6.2
A student needs a large capacitor for a ﬁlter and decides to utilize the Miller multiplication of [Fig. 6.4(a)]. Explain
the issues in this approach.
R1
CF
Vin
Vout
Y
X
−A
R1
Vin
Vout
X
M1
CF
Y
(a)
(b)
(A+1) CF
V0
AV0
Figure 6.4
Solution
The issues relate to the ampliﬁer, particularly to its output swing. As exempliﬁed by the implementation in
Fig. 6.4(b), if the voltage at X swings by V0, then Y must accommodate a swing of AV0 without saturating the
ampliﬁer. In addition, the dc level in Vin must be compatible with the input of the ampliﬁer.
▲
It is important to understand that (6.2) and (6.3) hold if we know a priori that the circuit of Fig. 6.2(a)
can be converted to that of Fig. 6.2(b). That is, Miller’s theorem does not stipulate the conditions under
which this conversion is valid. If the impedance Z forms the only signal path between X and Y, then the
conversion is often invalid. Illustrated in Fig. 6.5 for a simple resistive divider, the theorem gives a correct

176
Chap. 6
Frequency Response of Ampliﬁers
R1
R2
X
X
Y
Y
R1 + R2
(a)
(b)
R2
−R2
Figure 6.5
Improper application of Miller’s theorem.
input impedance but an incorrect gain. Nevertheless, Miller’s theorem proves useful in cases where the
impedance Z appears in parallel with the main signal (Fig. 6.6).
Z
−A
Main Signal Path
Figure 6.6
Typical case for valid
application of Miller’s theorem.
▲
Example6.3
Calculate the input resistance of the circuit shown in Fig. 6.7(a).
rO
VDD
Vb
M1
I1
(a)
(b)
Rin
X
Y
VDD
Vb
M1
I1
Rin
X
Y
rO
1 − Av
rO
1 − 1/Av
Figure 6.7
Solution
The reader can prove that the voltage gain from X to Y is equal to 1 + (gm + gmb)rO. As shown in Fig. 6.7(b), the
input resistance is given by the parallel combination of rO/(1 −Av) and 1/(gm + gmb). Since Av is usually greater
than unity, rO/(1 −Av) is a negative resistance. We therefore have
Rin =
rO
1 −[1 + (gm + gmb)rO]

1
gm + gmb
(6.4)
=
−1
gm + gmb

1
gm + gmb
(6.5)
= ∞
(6.6)
This is the same result as obtained in Chapter 3 (Fig. 3.54) by direct calculation.
▲

Sec. 6.1
General Considerations
177
We should also mention that, strictly speaking, the value of Av = VY/VX in (6.2) and (6.3) must be
calculated at the frequency of interest, complicating the algebra signiﬁcantly. To understand this point, let
us return to Example 6.1 and assume an ampliﬁer with a ﬁnite output resistance. Depicted in Fig. 6.8, the
equivalent circuit reveals that VY ̸= −AVX at high frequencies, and hence CF cannot be simply multiplied
by 1+ A to yield the input capacitance. However, in many cases we use the low-frequency value of VY/VX
to gain insight into the behavior of the circuit. We call this approach “Miller’s approximation.”
VX
−AVX
Rout
CF
Ampliﬁer
X
Y
Figure 6.8
Equivalent circuit showing
gain change at high frequencies.
▲
Example6.4
Determine the transfer function of the circuit shown in Fig. 6.9(a) using (a) direct analysis and (b) Miller’s
approximation.
VX −AVX
−AVX
Rout
CF
X
Vin
RS
VX
Rout
X
Vin
RS
(A+1) CF
Vout
Vout
A+1
CF
Y
(a)
(b)
ω
(log scale)
20log
0
Vout
Vin
 ( jω)
ωp
ωz
−20dB/dec
(c)
A
Figure 6.9
Solution
(a) We note that the current ﬂowing through RS is given by (Vin −VX)/RS, yielding a voltage drop across Rout
equal to (Vin −VX)Rout/RS. It follows that
Vin −VX
RS
Rout −AVX = Vout
(6.7)

178
Chap. 6
Frequency Response of Ampliﬁers
We also equate the currents ﬂowing through RS and CF:
Vin −VX
RS
= (VX −Vout)CFs
(6.8)
The reader can ﬁnd VX from the ﬁrst equation and substitute the result in the second, thereby obtaining
Vout
Vin
(s) =
RoutCFs −A
[(A + 1)RS + Rout]CFs + 1
(6.9)
The circuit thus exhibits a zero at ωz = A/(RoutCF) and a pole at ωp = −1/[(A + 1)RSCF + RoutCF].
Figure 6.9(b) plots the response for the case of |ωp| < |ωz|.
(b) Applying Miller’s approximation, we decompose CF into (1+ A)CF at the input and CF/(1+ A−1) at the output
[Fig. 6.9(c)]. Since Vout/Vin = (VX/Vin)(Vout/VX), we ﬁrst write VX/Vin by considering RS and (1 + A)CF as a
voltage divider:
VX
Vin
=
1
(1 + A)CFs
1
(1 + A)CFs + RS
(6.10)
=
1
(1 + A)RSCFs + 1
(6.11)
As for Vout/VX, we ﬁrst amplify VX by −A and subject the result to the output voltage divider,
Vout
VX
=
−A
1
1 + A−1 CF Routs + 1
(6.12)
That is
Vout
Vin
(s) =
−A
[(1 + A)RSCFs + 1]

1
1 + A−1 CF Routs + 1

(6.13)
Sadly, Miller’s approximation has eliminated the zero and predicted two poles for the circuit! Despite these short-
comings, Miller’s approximation can provide intuition in many cases.1
▲
If applied to obtain the input-output transfer function, Miller’s theorem cannot be used simultaneously
to calculate the output impedance. To derive the transfer function, we apply a voltage source to the input
of the circuit, obtaining a value for VY/VX in Fig. 6.2(a). On the other hand, to determine the output
impedance, we must apply a voltage source to the output of the circuit, obtaining a value for VX/VY that
may not be equal to the inverse of the VY/VX measured in the ﬁrst test. For example, the circuit of Fig.
6.7(b) may suggest that the output impedance is equal to
Rout =
rO
1 −1/Av
(6.14)
=
rO
1 −[1 + (gm + gmb)rO]−1
(6.15)
=
1
gm + gmb
+ rO
(6.16)
1Both of these artifacts can be avoided if we multiply CF by 1 + A(s), where A(s) is the actual transfer function from VX to
Vout, but the algebra is as lengthy as that in part (a).

Sec. 6.1
General Considerations
179
whereas the actual value is equal to rO (if X is grounded). Other subtleties of Miller’s theorem are
described in the Appendix C.
In summary, Miller’s approximation divides a ﬂoating impedance by the low-frequency gain and faces
the following limitations: (1) it may eliminate zeros, (2) it may predict additional poles, and (3) it does
not correctly compute the “output” impedance.
6.1.2 Association of Poles with Nodes
Consider the simple cascade of ampliﬁers depicted in Fig. 6.10. Here, A1 and A2 are ideal voltage
ampliﬁers, R1 and R2 modeltheoutputresistanceofeachstage,Cin andCN representtheinputcapacitance
of each stage, and CP denotes the load capacitance. The overall transfer function can be written as
Vout
Vin
(s) =
A1
1 + RSCins ·
A2
1 + R1CNs ·
1
1 + R2CPs
(6.17)
The circuit exhibits three poles, each of which is determined by the total capacitance seen from each node
to ground multiplied by the total resistance seen at the node to ground. We can therefore associate each
pole with one node of the circuit, i.e., ω j = τ −1
j , where τ j is the product of the capacitance and resistance
seen at node j to ground. From this perspective, we may say that “each node in the circuit contributes
one pole to the transfer function.”
M
Cin
RS
Vin
CN
R1
A2
A1
N
CP
R2
P
Vout
Figure 6.10
Cascade of ampliﬁers.
The above statement is not valid in general. For example, in the circuit of Fig. 6.11, the location of
the poles is difﬁcult to calculate because R3 and C3 create interaction between X and Y. Nevertheless,
in many circuits, association of one pole with each node provides an intuitive approach to estimating the
transfer function: we simply multiply the total equivalent capacitance by the total incremental (small-
signal) resistance (both from the node of interest to ground), thus obtaining an equivalent time constant
and hence a pole frequency.
C1
R1
Vin
A1
C2
R2
Vout
R3
C3
X
Y
Figure 6.11
Example of interaction
between nodes.
▲
Example6.5
Neglecting channel-length modulation, compute the transfer function of the common-gate stage shown in
Fig. 6.12(a).

180
Chap. 6
Frequency Response of Ampliﬁers
I1
X
Y
RD
Vout
Vb
VDD
RS
Vin
M1
X
RD
Vout
VDD
RS
Vin
CGD + CDB
CGS + CSB
gmV1
V1
(a)
(b)
Figure 6.12
Common-gate stage with parasitic capacitances.
Solution
In this circuit, the capacitances contributed by M1 are connected from the input and output nodes to ground [Fig.
6.12(b)]. At node X, CS = CGS + CSB, giving a pole frequency
ωin =

(CGS + CSB)

RS

1
gm + gmb
−1
(6.18)
Similarly, at node Y, CD = CDG + CDB, yielding a pole frequency
ωout = [(CDG + CDB)RD]−1
(6.19)
The overall transfer function is thus given by
Vout
Vin
(s) =
(gm + gmb)RD
1 + (gm + gmb)RS
·
1

1 +
s
ωin

1 +
s
ωout

(6.20)
where the ﬁrst fraction represents the low-frequency gain of the circuit. Note that if we do not neglect rO1, the input
and output nodes interact, making it difﬁcult to calculate the poles.
▲
Nanometer Design Notes
Deﬁned as the frequency at which the
small-signal current gain of a device
is unity, the transit frequency,
fT, of
MOSFETs increases with the overdrive,
but ﬂattens out as the vertical electric
ﬁeld reduces the mobility. Plotted below
is the
fT for an NMOS device with
W/L = 5 μm/40 nm and VDS = 0.8 V.
100
200
300
400
500
600
100
150
200
250
300
350
400
450
VGS−VTH (mV)
fT (GHz)
As observed in Example 6.4, Miller’s approximation converts a ﬂoating
impedance to two grounded impedances, allowing us to associate one pole
with each node. We apply this technique to various ampliﬁer topologies in
this chapter—but cautiously and retrospectively to avoid its pitfalls. It is also
helpful to bear in mind that the fT of a MOS transistor is roughly equal to
gm/(2πCGS) and can exceed 300 GHz in today’s technologies. (However,
since fT ∝VGS −VT H, as we push the devices for low-voltage operation, we
tend to reduce their fT ’s.)
6.2
Common-Source Stage
The common-source topology exhibits a relatively high input impedance while
providing voltage gain and requiring a minimal voltage headroom. As such,
it ﬁnds wide application in analog circuits and its frequency response is of
interest.

Sec. 6.2
Common-Source Stage
181
Shown in Fig. 6.13(a) is a common-source stage driven by a ﬁnite source resistance, RS.2 We identify
all of the capacitances in the circuit, noting that CGS and CDB are “grounded” capacitances while CGD
appears between the input and the output. In reality, the circuit also drives a load capacitance, which can
be merged with CDB.
M1
RD
Vout
RS
Vin
CGS
CGD
CDB
VDD
X
M1
RD
Vout
RS
Vin
VDD
X
CGS + (1−Av)CGD
(a)
CDB + CGD
Av
(b)
1
(1 − 
)
Figure 6.13
(a) High-frequency model of a common-source stage, and (b) simpliﬁed circuit using Miller’s
approximation.
Miller’s Approximation
Assuming that λ = 0 and M1 operates in saturation, let us ﬁrst estimate the
transfer function by associating one pole with each node. The total capacitance seen from X to ground is
equal to CGS plus the Miller multiplication of CGD, namely, CGS + (1 −Av)CGD, where Av = −gm RD
[Fig. 6.13(b)]. The magnitude of the “input” pole is therefore given by
ωin =
1
RS[CGS + (1 + gm RD)CGD]
(6.21)
At the output node, the total capacitance seen to ground is equal to CDB plus the Miller effect of CGD,
i.e., CDB + (1 −A−1
v )CGD ≈CDB + CGD (if Av ≫1). Thus,
ωout =
1
RD(CDB + CGD)
(6.22)
M1
RD
CGS
CGD
CDB
VDD
ZX
Figure 6.14
Model for calculation of
output impedance.
Another approximation of the output pole can be obtained if RS is relatively large. Simplifying the
circuit as shown in Fig. 6.14, where the effect of RS is neglected, the reader can prove that
Z X =
1
Ceqs

CGD + CGS
CGD
·
1
gm1

(6.23)
2Note that RS is not deliberately added to the circuit. Rather, it models the output resistance of the preceding stage.

182
Chap. 6
Frequency Response of Ampliﬁers
where Ceq = CGDCGS/(CGD + CGS). Thus, the output pole is roughly equal to
ωout =
1

RD

CGD + CGS
CGD
·
1
gm1

(Ceq + CDB)
(6.24)
We should point out that the sign of ωin and ωout in the above equations is positive because we
eventually write the denominator of the transfer function in the form of (1 + s/ωin)(1 + s/ωout); i.e.,
the denominator vanishes at s = −ωin and s = −ωout. Alternatively, we could express the values of ωin
and ωout with a negative sign and hence write the denominator as (1 −s/ωin)(1 −s/ωout). We adopt the
former notation in this book. We then surmise that the transfer function is
Vout
Vin
(s) =
−gm RD

1 + s
ωin
 
1 +
s
ωout

(6.25)
Note that rO1 and any load capacitance can easily be included here.
The primary error in this estimation is that we have not considered the existence of zeros in the circuit.
Another concern stems from approximating the gain of the ampliﬁer by −gm RD whereas in reality the
gain varies with frequency (for example, due to the capacitance at the output node).
Direct Analysis
We now obtain the exact transfer function, investigating the validity of the above
approach. Using the equivalent circuit depicted in Fig. 6.15, we can sum the currents at each node:
VX −Vin
RS
+ VXCGSs + (VX −Vout)CGDs = 0
(6.26)
(Vout −VX)CGDs + gmVX + Vout
 1
RD
+ CDBs

= 0
(6.27)
gmVX
CDB
RS
Vin
CGS
CGD
X
RD
Vout
VX
Figure 6.15
Equivalent circuit of Fig. 6.13.
From (6.27), VX is obtained as
VX = −
Vout

CGDs + 1
RD
+ CDBs

gm −CGDs
(6.28)
which, upon substitution in (6.26), yields
−Vout
[R−1
S
+ (CGS + CGD)s][R−1
D + (CGD + CDB)s]
gm −CGDs
−VoutCGDs = Vin
RS
(6.29)

Sec. 6.2
Common-Source Stage
183
That is
Vout
Vin
(s) =
(CGDs −gm)RD
RS RDξs2 + [RS(1 + gm RD)CGD + RSCGS + RD(CGD + CDB)]s + 1
(6.30)
where ξ = CGSCGD + CGSCDB + CGDCDB. Note that the transfer function is of second order even
though the circuit contains three capacitors. This is because the capacitors form a “loop,” allowing only
two independent initial conditions in the circuit and hence yielding a second-order differential equation
for the time response.
▲
Example6.6
A student considers only CGD in Fig. 6.13(a) so as to obtain a one-pole response, reasons that the voltage gain drops
by 3 dB (by a factor of =
√
2) at the pole frequency, and concludes that a better approximation of the Miller effect
should multiply CGD by 1 + gm RD
√
2. Explain the ﬂaw in this reasoning.
Solution
Setting CGS and CDB to zero, we obtain
Vout
Vin
(s) = (CGDs −gm)RD
s
ω0
+ 1
(6.31)
where ω0 = RS(1+ gm RD)CGD + RDCGD. We note that CGD is multiplied by 1+ gm RD in this exact analysis. So
where is the ﬂaw in the student’s argument? It is true that the voltage gain in Fig. 6.13(a) falls by
√
2 at ω0, but this
gain would be from Vin to Vout and not the gain seen by CGD. The reader can readily express the transfer function
from node X to Vout as
Vout
VX
(s) = (CGDs −gm)RD
RDCGD + 1
(6.32)
observing that this gain begins to roll off at a higher frequency, namely, at 1/(RDCGD). Thus, the multiplication of
CGD by 1 + gm RD is still justiﬁed.
▲
Special Cases
If manipulated judiciously, Eq. (6.30) reveals several interesting points about the circuit.
While the denominator appears rather complicated, it can yield intuitive expressions for the two poles,
ωp1 and ωp2, if we assume that |ωp1| ≪|ωp2|. This is called the “dominant pole” approximation. Writing
the denominator as
D =
 s
ωp1
+ 1
  s
ωp2
+ 1

(6.33)
=
s2
ωp1ωp2
+
 1
ωp1
+
1
ωp2

s + 1
(6.34)
we recognize that the coefﬁcient of s is approximately equal to 1/ωp1 if ωp2 is much farther from the
origin. It follows from (6.30) that the dominant pole is given by
ωp1 =
1
RS(1 + gm RD)CGD + RSCGS + RD(CGD + CDB)
(6.35)

184
Chap. 6
Frequency Response of Ampliﬁers
How does this compare with the “input” pole given by (6.21)? The only difference results from the term
RD(CGD +CDB), which may be negligible in some cases. The key point here is that the intuitive approach
of associating a pole with the input node provides a rough estimate with much less effort. We also note
that the Miller multiplication of CGD by the low-frequency gain of the ampliﬁer is relatively accurate in
this case. Of course, for a given set of values, we must check to ensure that ωp1 ≪ωp2.
Other special cases are also of interest. We consider the case of CGD = 0 in Problem 6.26 and the
case of RD = ∞below.
▲
Example6.7
The circuit shown in Fig. 6.16(a) is a special case where RD →∞. Calculate the transfer function (with λ = 0) and
explain why the Miller effect vanishes as CDB (or the load capacitance) increases.
M1
Vout
RS
Vin
CGS
CGD
CDB
VDD
X
I1
ω
(log scale)
20log Vout
Vin
 ( jω)
ωp2
0 dB
−20 dB/dec
−40 dB/dec
(a)
(b)
Figure 6.16
Solution
Using (6.30) and letting RD approach inﬁnity, we have
Vout
Vin
(s) =
CGDs −gm
RSξs2 + [gm RSCGD + (CGD + CDB)]s
(6.36)
=
CGDs −gm
s[RS(CGSCGD + CGSCDB + CGDCDB)s + (gm RS + 1)CGD + CDB]
As expected, the circuit exhibits two poles—one at the origin because the dc gain is inﬁnity [Fig. 6.16(b)]. The
magnitude of the other pole is given by
ωp2 ≈
(1 + gm RS)CGD + CDB
RS(CGDCGS + CGSCDB + CGDCDB)
(6.37)
For a large CDB or load capacitance, this expression reduces to
ωp2 ≈
1
RS(CGS + CGD)
(6.38)
indicating that CGD experiences no Miller multiplication. This can be explained by noting that, for a large CDB, the
voltage gain from node X to the output begins to drop even at low frequencies. As a result, for frequencies close to
[RS(CGS + CGD)]−1, the effective gain is quite small and CGD(1 −Av) ≈CGD. Such a case is an example where
the application of the Miller effect using low-frequency gain does not provide a reasonable estimate.
▲

Sec. 6.2
Common-Source Stage
185
Nanometer Design Notes
The high-frequency MOS model de-
veloped in Chapter 2 does not contain
a drain-source capacitance. In reality,
however, the metal contact stacks touch-
ing the source and drain areas form
two “columns” that create a capacitance
between the drain and the source. This
effect has become more pronounced in
modern CMOS technologies because
of the shorter channel length, i.e., less
spacing between the columns, and the
ability to stack many contacts, i.e., taller
columns. The reader is encouraged
to analyze a CG stage while including
CDS.
n+
n+
CDS
Contact
Contact
From (6.30) and applying the dominant pole approximation, we can also
estimate the second pole of the CS stage of Fig. 6.13(a). Since the coefﬁcient
of s2 is equal to (ωp1ωp2)−1, we have
ωp2 =
1
ωp1
·
1
RS RD(CGSCGD + CGSCDB + CGDCDB)
(6.39)
= RS(1 + gm RD)CGD + RSCGS + RD(CGD + CDB)
RS RD(CGSCGD + CGSCDB + CGDCDB)
(6.40)
We emphasize that these results hold only if ωp1 ≪ωp2.
As a special case, if CGS ≫(1+gm RD)CGD + RD(CGD +CDB)/RS, then
ωp2 ≈
RSCGS
RS RD(CGSCGD + CGSCDB)
(6.41)
=
1
RD(CGD + CDB)
(6.42)
the same as (6.22). Thus, the “output” pole approach is valid only if CGS
dominates the response.
The transfer function of (6.30) exhibits a zero given by ωz = +gm/CGD,
an effect not predicted by Miller’s approximation and (6.25). Located in the
right half plane, the zero arises from direct coupling of the input to the output through CGD. As illustrated
in Fig. 6.17, CGD provides a feedthrough path that conducts the input signal to the output at very high
frequencies, resulting in a slope in the frequency response that is less negative than −40 dB/dec. Note
that gm/CGD > gm/CGS because CGD < CGS, implying that the zero lies beyond the transistor’s fT .
However, as explained in Chapter 10, this zero falls to lower frequencies in cases where we deliberately
add a capacitor between the gate and the drain, introducing other difﬁculties.
Feedthrough
Path
Main
Path
ω
ωp1
ωp2 ωz
20log
(log scale)
–20 dB/dec
–40 dB/dec
–20 dB/dec
VDD
RD
Vout
RS
Vout
Vin
 ( jω)
Figure 6.17
Feedforward path through CGD (log-log scale).
The zero, sz, can also be computed by noting that the transfer function Vout(s)/Vin(s) must drop to
zero for s = sz. For a ﬁnite Vin, this means that Vout(sz) = 0, and hence the output can be shorted to
ground at this (possibly complex) frequency with no current ﬂowing through RD or the short (Fig. 6.18).
Therefore, the currents through CGD and M1 are equal and opposite:
V1CGDsz = gmV1
(6.43)
That is, sz = +gm/CGD.3
3This approach is similar to expressing the transfer function as Gm Zout and ﬁnding the zeros of Gm and Zout.

186
Chap. 6
Frequency Response of Ampliﬁers
VDD
CGD
RD
Iout = 0
RS
V1
M1
Vin
CGS
Figure 6.18
Calculation of the zero in
a CS stage.
▲
Example6.8
We have seen that the signals traveling through two paths within an ampliﬁer may cancel each other at one frequency,
creating a zero in the transfer function (Fig. 6.19). Can this occur if H1(s) and H2(s) are ﬁrst-order low-pass circuits?
H1 (s)
Vin
H2 (s)
Vout
Figure 6.19
Solution
Modeling H1(s) by A1/(1 + s/ωp1) and H2(s) by A2/(1 + s/ωp2), we have
Vout
Vin
(s) =

A1
ωp2
+ A2
ωp1

s + A1 + A2

1 +
s
ωp1

1 +
s
ωp2

(6.44)
Indeed, the overall transfer function contains a zero.
▲
▲
Example6.9
Determine the transfer function of the complementary CS stage shown in Fig. 6.20(a).
VDD
Vout
Vout
M2
RS
CGS1 + CGS2
( gm1 + gm2 )V1
CDB1 + CDB2
rO1
rO2
CGD1 + CGD2
RS
M1
V1
Vin
Vin
(a)
(b)
Figure 6.20

Sec. 6.2
Common-Source Stage
187
Solution
Since the corresponding terminals of M1 and M2 are shorted to one another in the small-signal model, we merge
the two transistors, drawing the equivalent circuit as shown in Fig. 6.20(b). The circuit thus has the same transfer
function as the simple CS stage studied above.
▲
In high-speed applications, the input impedance of the common-source stage is also important. With
the aid of Miller’s approximation, we have from Fig. 6.21(a)
Zin =
1
[CGS + (1 + gm RD)CGD]s
(6.45)
M 1
VDD
VDD
VDD
RD
RD
Vout
IX
VX
CGD
CDB
CGS
Zin
M1
M1
Zin
CDB
CDB
RD
CGD
gmVX
Vout
Vout
(a)
(b)
(c)
Figure 6.21
Calculation of input impedance of a CS stage.
But at high frequencies, the effect of the output node capacitance must be taken into account. Ignoring
CGS for the moment and using the circuit of Fig. 6.21(b), we add the voltage drops across RD||(CDBs)−1
and CGD, equating the result to VX:
(IX −gmVX)
RD
1 + RDCDBs +
IX
CGDs = VX
(6.46)
and hence
VX
IX
=
1 + RD(CGD + CDB)s
CGDs(1 + gm RD + RDCDBs)
(6.47)
The actual input impedance consists of the parallel combination of (6.47) and 1/(CGSs).
As a special case, suppose that at the frequency of interest, |RD(CGD +CDB)s| ≪1 and |RDCDBs| ≪
1+gm RD. Then, (6.47) reduces to [(1+gm RD)CGDs]−1 (as expected), indicating that the input impedance
is primarily capacitive. At higher frequencies, however, (6.47) contains both real and imaginary parts. In
fact, if CGD is large, it provides a low-impedance path between the gate and the drain of M1, yielding the
equivalent circuit of Fig. 6.21(c) and suggesting that 1/gm1 and RD appear in parallel with the input.
▲
Example6.10
Explain what happens to Eq. (6.47) if the circuit drives a large load capacitance.
Solution
Merged with CDB, the large load capacitance reduces the numerator to RDCDBs and the denominator
to CGDs(RDCDBs), yielding VX/IX ≈1/(CGDs). In a manner similar to that in Example 6.7, the large load
capacitance lowers the gain at high frequencies, suppressing Miller multiplication of CGD.
▲

188
Chap. 6
Frequency Response of Ampliﬁers
6.3
Source Followers
Nanometer Design Notes
While
characterizing
the
intrinsic
MOSFET, the
fT
overestimates how
fast
typical
circuits
can
operate.
A
more “circuit-centric” measure is the
gain-bandwidth product of a simple CS
ampliﬁer that is loaded by an identical
stage. Shown below is the frequency
response of such an ampliﬁer, revealing
a gain-bandwidth product of about 34
GHz if W/L = 5 μm/40 nm, RD = 5 k,
and the bias current is 130 μA.
109
1010
1011
−2
0
2
4
6
8
10
12
Frequency (Hz)
Gain (dB)
Source followers are occasionally employed as level shifters or buffers,
affecting the overall frequency response. Consider the circuit depicted in
Fig. 6.22(a), where CL represents the total capacitance seen at the output
node to ground, including CSB1. The strong interaction between nodes X and
Y through CGS in Fig. 6.22(a) makes it difﬁcult to associate a pole with each
node in a source follower. Neglecting channel-length modulation and body
effect for simplicity and using the equivalent circuit shown in Fig. 6.22(b), we
sum the currents at the output node:
V1CGSs + gmV1 = VoutCLs
(6.48)
obtaining
V1 =
CLs
gm + CGSs Vout
(6.49)
Also, noting that the voltage across CGD is equal to V1 + Vout and beginning
from Vin, we add the voltage across RS to V1 and Vout:
Vin = RS[V1CGSs + (V1 + Vout)CGDs] + V1 + Vout
(6.50)
Substituting for V1 from (6.49), we have
Vout
Vin
(s) =
gm + CGSs
RS(CGSCL + CGSCGD + CGDCL)s2 + (gm RSCGD + CL + CGS)s + gm
(6.51)
Interestingly, the transfer function contains a zero in the left half plane (and near the fT ). This is because
the signal conducted by CGS at high frequencies adds with the same polarity to the signal produced by
the intrinsic transistor. We study some special cases below.
X
Y
M1
CL
V1
Vout
Vin
gmV1
Vout
CL
(b)
VDD
Vin
RS
RS
CGD
CGS
(a)
Figure 6.22
(a) Source follower; (b) high-frequency equivalent circuit.
▲
Example6.11
Examine the source follower transfer function if CL = 0.

Sec. 6.3
Source Followers
189
Solution
We have
Vout
Vin
=
gm + CGSs
RSCGSCGDs2 + (gm RSCGD + CGS)s + gm
(6.52)
=
gm + CGSs
(1 + RSCGDs)(gm + CGSs)
(6.53)
=
1
1 + RSCGDs
(6.54)
The circuit now has only one pole at the input. Why does CGS disappear here? This is because, in the absence of
channel-length modulation and body effect, the voltage gain from the gate to the source is equal to unity. Since a
change of V at the gate translates to an equal change at the source (Fig. 6.23), no current ﬂows through CGS.
Consequently, CGS contributes neither a zero nor a pole. We say CGS is “bootstrapped” by the source follower. With
λ, γ > 0, the output change is less than V , requiring some change in the voltage across CGS.
Y
VDD
RS
CGS
M1
X
ΔV
ΔV
Figure 6.23
Bootstrapping of CGS in
a source follower.
▲
If the two poles of (6.51) are assumed far apart, then the lower one has a magnitude of
ωp1 ≈
gm
gm RSCGD + CL + CGS
(6.55)
=
1
RSCGD + CL + CGS
gm
(6.56)
Also, if RS = 0, then ωp1 = gm/(CL + CGS)—as expected.
Let us now calculate the input impedance of the circuit, noting that CGD simply shunts the input and
can be ignored initially. Shown in Fig. 6.24, the equivalent circuit includes body effect, but channel-length
modulation can also be added by replacing 1/gmb with (1/gmb)||rO. The small-signal gate-source voltage
of M1 is equal to IX/(CGSs), giving a source current of gm IX/(CGSs). Starting from the input and adding
VDD
CGS
1
gmb
IX
VX
Vout
CL
M1
Figure 6.24
Calculation of source
follower input impedance.

190
Chap. 6
Frequency Response of Ampliﬁers
the voltages, we have
VX =
IX
CGSs +

IX + gm IX
CGSs
  1
gmb

1
CLs

(6.57)
that is
Zin =
1
CGSs +

1 +
gm
CGSs

1
gmb + CLs
(6.58)
We consider some special cases. First, if gmb = 0 and CL = 0, then Zin = ∞, because CGS is
entirely bootstrapped by the source follower and draws no current from the input. Second, at relatively
low frequencies, gmb ≫|CLs| and
Zin ≈
1
CGSs

1 + gm
gmb

+
1
gmb
(6.59)
indicating that the equivalent input capacitance is equal to CGSgmb/(gm + gmb) and hence quite less than
CGS. In other words, the overall input capacitance is equal to CGD plus a fraction of CGS—again because
of bootstrapping.
▲
Example6.12
Apply Miller’s approximation to the above circuit if CL = 0.
Solution
As illustrated in Fig. 6.25, the low-frequency gain from the gate to the source is equal to (1/gmb)/[(1/gm) +
(1/gmb)] = gm/(gm +gmb). The Miller multiplication of CGS at the input is thus equal to CGS[1−gm/(gm +gmb)] =
CGSgmb/(gm + gmb).
Y
X
VDD
VX
CGS
M1
IX
1
gmb
gm
gm+gmb ΔV
ΔV
Figure 6.25
▲
At high frequencies, gmb ≪|CLs| and
Zin ≈
1
CGSs +
1
CLs +
gm
CGSCLs2
(6.60)
For a given s = jω, the input impedance consists of the series combination of capacitors CGS and CL
and a negative resistance equal to −gm/(CGSCLω2) (Fig. 6.26). The negative resistance property can be
utilized in oscillators (Chapter 15). It is important to bear in mind that a source follower driving a load
capacitance exhibits a negative input resistance, possibly causing instability.

Sec. 6.3
Source Followers
191
VDD
CGS
– gm
CGSCLω2
CGS
Zin
CL
Zin
CL
M1
Figure 6.26
Negative resistance seen at the input of a source follower.
▲
Example6.13
Neglecting channel-length modulation and body effect, calculate the transfer function of the circuit shown in
Fig. 6.27(a).
VDD
CL
RS
RS
CX
CXY
Vin
Vin
M2
M1
Y
X
X
gm2V2
gm1V1
CY
V2
V1
Vout
Y
Vout
(a)
(b)
Figure 6.27
Solution
Let us ﬁrst identify all of the capacitances in the circuit. At node X, CGD1 and CDB2 are connected to ground and CGS1
andCGD2 toY.AtnodeY,CSB1,CGS2,andCL areconnectedtoground.SimilartothesourcefollowerofFig.6.22(b),
this circuit has three capacitances in a loop and hence a second-order transfer function. Using the equivalent circuit
shown in Fig. 6.27(b), where CX = CGD1 + CDB2, CXY = CGS1 + CGD2, and CY = CSB1 + CGS2 + CL, we have
V1CXY s + gm1V1 = VoutCY s, and hence V1 = VoutCY s/(CXY s + gm1). Also, since V2 = Vout, the summation of
currents at node X gives
(V1 + Vout)CXs + gm2Vout + V1CXY s = Vin −V1 −Vout
RS
(6.61)
Substituting for V1 and simplifying the result, we obtain
Vout
Vin
(s) =
gm1 + CXY s
RSξs2 + [CY + gm1RSCX + (1 + gm2RS)CXY ]s + gm1(1 + gm2RS)
(6.62)
where ξ = CXCY + CXCXY + CY CXY . As expected, (6.62) reduces to a form similar to (6.51) for gm2 = 0.
▲
The output impedance of source followers is also of interest. In Fig. 6.22(a), the body effect and CSB
simply yield an impedance in parallel with the output. Ignoring this impedance and neglecting CGD, we
note fromtheequivalentcircuitofFig.6.28(a)that V1CGSs+gmV1 = −IX.Also, V1CGSsRS+V1 = −VX.

192
Chap. 6
Frequency Response of Ampliﬁers
ω
ω
gmV1
Zout
Zout
V1
IX
VX
1
gm
1
gm
RS
RS
CGS
RS
(a)
(b)
(c)
Figure 6.28
Calculation of source follower output impedance.
Dividing both sides of these equations gives
Zout = VX
IX
(6.63)
= RSCGSs + 1
gm + CGSs
(6.64)
It is instructive to examine the magnitude of this impedance as a function of frequency. At low frequencies,
Zout ≈1/gm, as expected. At very high frequencies, Zout ≈RS (because CGS shorts the gate and the
source). We therefore surmise that |Zout| varies as shown in Figs. 6.28(b) or (c). Which one of these
variations is more realistic? Operating as buffers, source followers must lower the output impedance, i.e.,
1/gm < RS. For this reason, the characteristic shown in Fig. 6.28(c) occurs more commonly than that in
Fig. 6.28(b).
The behavior illustrated in Fig. 6.28(c) reveals an important attribute of source followers. Since the
output impedance increases with frequency, we postulate that it contains an inductive component. To
conﬁrm this guess, we represent Zout by a ﬁrst-order passive network, noting that Zout equals 1/gm at
ω = 0 and RS at ω = ∞. The network can therefore be realized as shown in Fig. 6.29 because Z1 equals
R2 at ω = 0 and R1 + R2 at ω = ∞. In other words, Z1 = Zout if three conditions hold: R2 = 1/gm,
R1 = RS −1/gm, and L is chosen properly.
L
R1
R2
Z1
Figure 6.29
Equivalent output
impedance of a source follower.
To calculate L, we can simply obtain an expression for Z1 in terms of the three components in Fig. 6.29
and equate the result to Zout found above. Alternatively, since R2 is a series component of Z1, we can
subtract its value from Zout, thereby obtaining an expression for the parallel combination of R1 and L:
Zout −1
gm
=
CGSs

RS −1
gm

gm + CGSs
(6.65)

Sec. 6.4
Common-Gate Stage
193
Inverting the result to obtain the admittance of the parallel circuit, we have
1
Zout −1
gm
=
1
RS −1
gm
+
1
CGSs
gm

RS −1
gm

(6.66)
We can thus identify the ﬁrst term on the right-hand side as the inverse of R1 and the second term as the
inverse of an impedance equal to (CGSs/gm)(RS −1/gm), i.e., an inductor with the value
L = CGS
gm

RS −1
gm

(6.67)
Note that CGS/gm is approximately equal to ωT = 2π fT .
▲
Example6.14
Can we construct a (two-terminal) inductor from a source follower?
Solution
Yes, we can. Called an “active inductor,” such a structure is shown in Fig. 6.30(a), providing an inductance of
(CGS2/gm2)(RS −1/gm2). But the inductor is not ideal because it also incurs a parallel resistance equal to R1 =
RS = 1/gm2 and a series resistance equal to 1/gm2. Figure 6.30(b) depicts an application of active inductors: the
inductance can partially cancel the load capacitance, CL, at high frequencies, thus extending the bandwidth. However,
the voltage headroom consumed by M2 (= VGS2) limits the gain. Also, CGD2, which has been neglected in our
analysis, limits the bandwidth enhancement.
VDD
RS
CGS2
M2
VDD
RS
Vout
CGS2
CL
M1
Vin
M2
(a)
(b)
Figure 6.30
▲
6.4
Common-Gate Stage
As explained in Example 6.5, in a common-gate stage, the input and output nodes are “isolated” if channel-
length modulation is neglected. For a common-gate stage such as that in Fig. 6.31, the calculation of
Example 6.5 suggested a transfer function
Vout
Vin
(s) =
(gm + gmb)RD
1 + (gm + gmb)RS
1

1 +
CS
gm + gmb + R−1
S
s

(1 + RDCDs)
(6.68)

194
Chap. 6
Frequency Response of Ampliﬁers
VDD
RD
CD
CS
RS
Vin
Vout
Vb
M1
Figure 6.31
Common-gate stage at
high frequencies.
An important property of this circuit is that it exhibits no Miller multiplication of capacitances, potentially
achieving a wide band. Note, however, that the low input impedance may load the preceding stage.
Furthermore, since the voltage drop across RD is typically maximized to obtain a reasonable gain, the dc
level of the input signal must be quite low. For these reasons, the CG stage ﬁnds two principal applications:
as an ampliﬁer in cases where a low input impedance is required (Chapter 3) and in cascode stages.
If channel-length modulation is not negligible, the calculations become quite complex. Recall from
Chapter 3 that the input impedance of a common-gate topology does depend on the drain load if λ ̸= 0.
From Eq. (3.117), we can express the impedance seen looking into the source of M1 in Fig. 6.31 as
Zin ≈
ZL
(gm + gmb)rO
+
1
gm + gmb
(6.69)
where ZL = RD∥[1/(CDs)]. Since Zin now depends on ZL, it is difﬁcult to associate a pole with the
input node.
▲
Example6.15
For the common-gate stage shown in Fig. 6.32(a), calculate the transfer function and the input impedance, Zin.
Explain why Zin becomes independent of CL as this capacitance increases.
VDD
gmV1
rO
Vout
RS
Vb
Vout
Vin
Vin
Cin
Cin
CL
CL
rO
I1
V1
RS
(a)
(b)
Figure 6.32
Solution
Using the equivalent circuit shown in Fig. 6.32(b), we can write the current through RS as −VoutCLs + V1Cins.
Noting that the voltage across RS plus Vin must equal −V1, we have
(−VoutCLs + V1Cins)RS + Vin = −V1
(6.70)

Sec. 6.4
Common-Gate Stage
195
That is
V1 = −−VoutCLsRS + Vin
1 + Cin RSs
(6.71)
We also observe that the voltage across rO minus V1 equals Vout:
rO(−VoutCLs −gmV1) −V1 = Vout
(6.72)
Substituting for V1 from (6.71), we obtain the transfer function:
Vout
Vin
(s) =
1 + gmrO
rOCLCin RSs2 + [rOCL + Cin RS + (1 + gmrO)CL RS]s + 1
(6.73)
The reader can prove that body effect can be included by simply replacing gm with gm + gmb. As expected, the gain
at very low frequencies is equal to 1 + gmrO. For Zin, we can use (6.69) by replacing ZL with 1/(CLs), obtaining
Zin =
1
gm + gmb
+
1
CLs ·
1
(gm + gmb)rO
(6.74)
We note that as CL or s increases, Zin approaches 1/(gm + gmb), and hence the input pole can be deﬁned as
ωp,in =
1

RS

1
gm + gmb

Cin
(6.75)
Why does Zin become independent of CL at high frequencies? This is because CL lowers the voltage gain of the
circuit, thereby suppressing the effect of the negative resistance introduced by the Miller effect through rO (Fig. 6.7).
In the limit, CL shorts the output node to ground, and rO affects the input impedance negligibly.
▲
Our analysis of the CG frequency response has assumed a zero impedance in series with the gate. In
practice, the bias network providing the gate voltage exhibits a ﬁnite impedance, altering the frequency
response. Shown in Fig. 6.33(a) is an example in which this impedance is modeled by a resistor, RG.
If all of the device capacitances are included here, the circuit’s transfer function is of third order. For
simplicity, we consider only CGS here and only CGD in Appendix B. From the equivalent circuit in
Fig. 6.33(b),4 we have gmV1 = −Vout/RD, and hence V1 = −Vout/(gm RD). The current ﬂowing through
RS is equal to V1CGSs + gmV1 = −(CGSs + gm)Vout/(gm RD), and that through RG equal to V1CGSs =
−CGSsVout/(gm RD). Writing a KVL around the input network, we have
Vin −(CGS + gm) Vout
gm RD
RS +
Vout
gm RD
−CGSs Vout
gm RD
RG = 0
(6.76)
It follows that
Vout
Vin
=
gm RD
(RG + RS)CGSs + 1 + gm RS
(6.77)
yielding a pole at
ωp =
1 + gm RS
(RG + RS)CGS
(6.78)
Thus, RG directly adds to RS in this case, lowering the pole magnitude.
4Channel-length modulation and body effect are neglected here.

196
Chap. 6
Frequency Response of Ampliﬁers
VDD
RD
RD
RG
V1
CGS
RS
RG
RS
gmV1
Vout
Vout
Vb
Vin
M1
Vin
(a)
(b)
Figure 6.33
(a) CG stage with resistance in series with gate, and (b) equivalent circuit.
If a common-gate stage is driven by a relatively large source impedance, then the output impedance
of the circuit drops at high frequencies. This effect is better described in the context of cascode
circuits.
6.5
Cascode Stage
As explained in Chapter 3, cascoding proves beneﬁcial in increasing the voltage gain of ampliﬁers and
the output impedance of current sources while providing shielding as well. The invention of the cascode
(in the vacuum tube era), however, was motivated by the need for high-frequency ampliﬁers with a
relatively high input impedance. Viewed as a cascade of a common-source stage and a common-gate
stage, a cascode circuit offers the speed of the latter—by suppressing the Miller effect—and the input
impedance of the former.
Let us consider the cascode shown in Fig. 6.34, ﬁrst identifying all of the device capacitances. At node
A, CGS1 is connected to ground and CGD1 to node X. At node X, CDB1, CSB2, and CGS2 are tied to ground,
and at node Y, CDB2, CGD2, and CL are connected to ground. The Miller effect of CGD1 is determined
by the gain from A to X. As an approximation, we use the low-frequency value of this gain, which for
low values of RD (or negligible channel-length modulation) is equal to −gm1/(gm2 + gmb2). Thus, if
M1 and M2 have roughly equal dimensions, CGD1 is multiplied by approximately 2 rather than the large
VDD
CGD2
CGD2
CGD1
CGS1
Vin
Vb
RS
A
CDB2 + CL
CDB1 + CSB2
RD
Y
X
Vout
M2
M1
Figure 6.34
High-frequency model of
a cascode stage.

Sec. 6.5
Cascode Stage
197
voltage gain in a simple common-source stage. We therefore say that the Miller effect is less signiﬁcant
in cascode ampliﬁers than in common-source stages. The pole associated with node A is estimated as
ωp,A =
1
RS

CGS1 +

1 +
gm1
gm2 + gmb2

CGD1

(6.79)
We can also attribute a pole to node X. The total capacitance at this node is roughly equal to 2CGD1 +
CDB1 + CSB2 + CGS2, giving a pole
ωp,X =
gm2 + gmb2
2CGD1 + CDB1 + CSB2 + CGS2
(6.80)
How does this pole compare with 2π fT ≈gm2/CGS2? The other capacitances in the denominator reduce
the magnitude of ωp,X to roughly 2π fT /2. Finally, the output node yields a third pole:
ωp,Y =
1
RD(CDB2 + CL + CGD2)
(6.81)
The relative magnitudes of the three poles in a cascode circuit depend on the actual design parameters,
but ωp,X is typically quite a lot higher than the other two.
But what if RD in Fig. 6.34 is replaced by a current source so as to achieve a higher dc gain? We know
from Chapter 3 that the impedance seen at node X reaches high values if the load impedance at the drain
of M2 is large. For example, Eq. (3.117) predicts that the pole at node X may be quite a lot lower than
(gm2 + gmb2)/CX if RD itself is the output impedance of a PMOS cascode current source. Interestingly,
however, the overall transfer function is negligibly affected by this phenomenon. This can be better seen
by an example.
▲
Example6.16
Consider the cascode stage shown in Fig. 6.35(a), where the load resistor is replaced by an ideal current source.
Neglecting the capacitances associated with M1, representing Vin and M1 by a Norton equivalent as in Fig. 6.35(b),
and assuming γ = 0, compute the transfer function.
VDD
Y
Y
Vout
Vout
CY
CX
rO2
rO2
M2
Vb
Vb
X
X
M2
RS
Vin
Iin
I1
M1
CX
CY
(a)
(b)
Figure 6.35
Simpliﬁed model of a cascode stage.

198
Chap. 6
Frequency Response of Ampliﬁers
Solution
Since the current through CX is equal to −VoutCY s −Iin, we have VX = −(VoutCY s + Iin)/(CXs), and the small-
signal drain current of M2 is −gm2(−VoutCY s −Iin)/(CXs). The current through rO2 is then equal to −VoutCY s −
gm2(VoutCY s + Iin)/(CXs). Noting that VX plus the voltage drop across rO2 is equal to Vout, we write
−rO2

(VoutCY s + Iin) gm2
CXs + VoutCY s

−(VoutCY s + Iin) 1
CXs = Vout
(6.82)
That is
Vout
Iin
= −gm2rO2 + 1
CXs
·
1
1 + (1 + gm2rO2) CY
CX
+ CYrO2s
(6.83)
which, for gm2rO2 ≫1 and gm2rO2CY /CX ≫1 (i.e., CY > CX), reduces to
Vout
Iin
≈−gm2
CXs
1
CY
CX
gm2 + CY s
(6.84)
and hence
Vout
Vin
= −gm1gm2
CY CXs
1
gm2/CX + s
(6.85)
The magnitude of the pole at node X is still given by gm2/CX. This is because at high frequencies (as we approach
this pole), CY shunts the output node, dropping the gain and suppressing the Miller effect of rO2.
▲
If a cascode structure is used as a current source, then the variation of its output impedance with
frequency is of interest. Neglecting CGD1 and CY in Fig. 6.35(a), we have
Zout = (1 + gm2rO2)Z X + rO2
(6.86)
where Z X = rO1||(CXs)−1. Thus, Zout contains a pole at (rO1CX)−1 and falls at frequencies higher than
this value.
6.6
Differential Pair
The versatility of differential pairs and their extensive use in analog systems motivate us to characterize
their frequency response for both differential and common-mode signals.
6.6.1 Differential Pair with Passive Loads
Consider the simple differential pair shown in Fig. 6.36(a), with the differential half circuit and the
common-mode equivalent circuit depicted in Figs. 6.36(b) and (c), respectively. For differential signals,
the response is identical to that of a common-source stage, exhibiting Miller multiplication of CGD. Note
that since +Vin2/2 and −Vin2/2 are multiplied by the same transfer function, the number of poles in
Vout/Vin is equal to that of each path (rather than the sum of the number of poles in the two paths).
For common-mode signals, the total capacitance at node P in Fig. 6.36(c) determines the high-
frequency gain. Arising from CGD3, CDB3, CSB1, and CSB2, this capacitance can be quite substantial if
M1–M3 are wide transistors. For example, limited voltage headroom often necessitates that W3 be so large

Sec. 6.6
Differential Pair
199
Vout
VDD
CGD
CL
CL
VDD
VDD
Vout
Vout1
CDB
CGS
M1
M2
Vin1
Vin1
Vin2
Vin,CM
M1
CP
rO3
P
RD
RD
RD
RD
RD
M3
M1
M2
Vb
(a)
(b)
(c)
Figure 6.36
(a) Differential pair; (b) half-circuit equivalent; (c) equivalent circuit for common-mode inputs.
that M3 does not require a large drain-source voltage for operating in the saturation region. If only the
mismatch between M1 and M2 is considered, the high-frequency common-mode gain can be calculated
with the aid of Eq. (4.53). We replace rO3 with rO3∥[1/(CPs)] and RD by RD∥[1/(CLs)], where CL
denotes the total capacitance seen at each output node.5 Thus,
Av,C M = −
gm

RD

 1
CLs

(gm1 + gm2)

rO3

 1
CPs

+ 1
(6.87)
This result suggests that the common-mode rejection of the circuit degrades considerably at high
frequencies. In fact, writing the CMRR from Chapter 4 for this case gives
CMRR ≈
gm
gm

1 + 2gm

rO3|| 1
CPs

(6.88)
≈
gm
gm
rO3CPs + 1 + 2gmrO3
rO3CPs + 1
(6.89)
where gm = (gm1 + gm2)/2. We observe that this transfer function contains a zero at (1 + 2gm3rO3)/
(rO3CP) and a pole at 1/(rO3CP). Since 2gm3rO3 ≫1, the magnitude of the zero is much greater than
the pole and approximately equal to 2gm3/CP. The CMRR response thus appears as shown in Fig. 6.37.
ω
(log scale)
2g2m rO3
CMRR
(log scale)
0 dB
Δgm
1
rOCP
2gm3
CP
Figure 6.37
CMRR for a differential
pair vs. frequency.
5For simplicity, channel-length modulation, body effect, and other capacitances are neglected.

200
Chap. 6
Frequency Response of Ampliﬁers
As illustrated in Fig. 6.38, if the supply voltage contains high-frequency noise and the circuit
exhibits mismatches, the resulting common-mode disturbance at node P translates to a differential
noise component at the output. This effect becomes more pronounced as the noise frequency exceeds
1/(2πrO3CP).
VDD
VDD
CP
rO3
M1
P
M2
Figure 6.38
Effect of high-frequency supply noise in differential pairs.
We should emphasize that the circuit of Fig. 6.36(a) suffers from a trade-off between voltage headroom
and CMRR. To minimize the headroom consumed by M3, its width is maximized, introducing substantial
capacitance at the sources of M1 and M2 and degrading the high-frequency CMRR. The issue becomes
more serious at low supply voltages.
We now study the frequency response of differential pairs with high-impedance loads. Shown in
Fig. 6.39(a) is a fully differential implementation. As with the topology of Fig. 6.36, this circuit can
be analyzed for differential and common-mode signals separately. Note that here CL includes the drain
junction capacitance and the gate-drain overlap capacitance of each PMOS transistor as well. Also,
G
VDD
VDD
Vout
Vout1
CGD3
CGD1
CGD4
Vin
Vin1
rO1
rO3
CL
M1
M3
M3
M4
M1
ISS
M2
CL
G
CL
M4
(a)
(c)
(b)
Figure 6.39
(a) Differential pair with current-source loads; (b) effect of differential swings at node G;
(c) half-circuit equivalent.

Sec. 6.6
Differential Pair
201
as depicted in Fig. 6.39(b) for differential output signals, CGD3 and CGD4 conduct equal and opposite
currents to node G, making this node an ac ground. (In practice, node G is still bypassed to ground by
means of a capacitor.)
The differential half circuit is depicted in Fig. 6.39(c), with the output resistance of M1 and M3 shown
explicitly. This topology implies that Eq. (6.30) can be applied to this circuit if RL is replaced by rO1∥rO3.
In practice, the relatively high value of this resistance makes the output pole, given by [(rO1∥rO3)CL]−1,
the “dominant” pole. We return to this observation in Chapter 10. The common-mode behavior of the
circuit is similar to that of Fig. 6.36(c).
6.6.2 Differential Pair with Active Load
Let us now consider a differential pair with an active current mirror (Fig. 6.40). How many poles does
this circuit have? In contrast to the fully differential conﬁguration of Fig. 6.39(a), this topology contains
two signal paths with different transfer functions. The path consisting of M3 and M4 includes a pole at
node E, approximately given by gm3/CE, where CE denotes the total capacitance from E to ground.
This capacitance arises from CGS3, CGS4, CDB3, CDB1, and the Miller effect of CGD1 and CGD4. Even if
only CGS3 and CGS4 are considered, the severe trade-off between gm and CGS of PMOS devices results
in a pole that impacts the performance of the circuit. The pole associated with node E is called a “mirror
pole.” Note that, as with the circuit of Fig. 6.39(a), both signal paths shown in Fig. 6.40 contain a pole at
the output node.
In order to estimate the frequency response of the differential pair with an active current mirror,
we construct the simpliﬁed model depicted in Fig. 6.41(a), where all other capacitances are neglected.
VDD
Vout
ISS
Vin
M4
M3
E
M2
M1
Output
Pole
Mirror
Pole
Figure 6.40
High-frequency behavior
of differential pair with active current
mirror.
VDD
M4
M1
M2
ISS
Vin
M3
Vout
VDD
M4
RX
VX
CE
CL
E
CL
rOP
Vout
gmP
1
CE
E
IX
(a)
(b)
Figure 6.41
(a) Simpliﬁed high-frequency model of differential pair with active current mirror; (b) circuit of
(a) with a Thevenin equivalent.

202
Chap. 6
Frequency Response of Ampliﬁers
Replacing Vin, M1, and M2 by a Thevenin equivalent, we arrive at the circuit of Fig. 6.41(b), where
VX = gmNrON Vin and RX = 2rON (why?). Here, the subscripts P and N refer to PMOS and NMOS
devices, respectively, and we have assumed that 1/gmP ≪rO P. The small-signal voltage at E is equal to
VE = (Vout −VX)
1
CEs + gmP
1
CEs + gmP
+ RX
(6.90)
and the small-signal drain current of M4 is gm4VE. Noting that −gm4VE −IX = Vout(CLs+r−1
O P), we have
Vout
Vin
=
gmNrON(2gmP + CEs)rO P
2rO PrONCECLs2 + [(2rON + rO P)CE + rO P(1 + 2gmPrON)CL]s + 2gmP(rON + rO P)
(6.91)
Since the mirror pole is typically much higher in magnitude than the output pole, we can utilize the results
of Eq. (6.34) to write
ωp1 ≈
2gmP(rON + rO P)
(2rON + rO P)CE + rO P(1 + 2gmPrON)CL
(6.92)
Neglecting the ﬁrst term in the denominator and assuming that 2gmPrON ≫1, we have
ωp1 ≈
1
(rON∥rO P)CL
(6.93)
an expected result. The second pole is then given by
ωp2 ≈gmP
CE
(6.94)
which is also expected.
An interesting point revealed by Eq. (6.91) is a zero with a magnitude of 2gmP/CE in the left half
plane. The appearance of such a zero can be understood by noting that the circuit consists of a “slow
path” (M1, M3, and M4) in parallel with a “fast path” (M1 and M2). Representing the two by A0/[(1 +
s/ωp1)(1 + s/ωp2)] and A0/(1 + s/ωp1), respectively, we have
Vout
Vin
=
A0
1 + s/ωp1

1
1 + s/ωp2
+ 1

(6.95)
=
A0(2 + s/ωp2)
(1 + s/ωp1)(1 + s/ωp2)
(6.96)
That is, the system exhibits a zero at 2ωp2. The zero can also be obtained by the method of Fig. 6.18
(Problem 6.15).
Comparing the circuits of Figs. 6.39(a) and 6.40, we conclude that the former entails no mirror pole,
another advantage of fully differential circuits over single-ended topologies.
▲
Example6.17
Not all fully differential circuits are free from mirror poles. Figure 6.42(a) illustrates an example where current
mirrors M3–M5 and M4–M6 “fold” the signal current. Estimate the low-frequency gain and the transfer function of
this circuit.

Sec. 6.7
Gain-Bandwidth Trade-Offs
203
VDD
M1
M2
ISS
Vin
M3
M4
M6
M5
RD
RD
Vout2
CL
CL
Vout1
W/L
W/L
KW/L
KW/L
M1
Vin1
M3
M5
RD
CL
Vout1
VDD
X
(a)
(b)
M1
M5
RD
CL
Vout1
VDD
CGD5
(c)
X
M5
RD
CL
Vout1
gm3
1
CX
gm3
1
X
VDD
(d)
RS
Vin1
M1
RS
Vin1
Figure 6.42
Solution
Neglecting channel-length modulation and using the differential half circuit shown in Fig. 6.42(b), we observe that
M5 multiplies the drain current of M3 by K, yielding an overall low-frequency voltage gain Av = gm1K RD.
To obtain the transfer function, we utilize the equivalent circuit depicted in Fig. 6.42(c), including a source
resistance RS for completeness. To simplify calculations, we assume that RDCL is relatively small so that the Miller
multiplication of CGD5 can be approximated as CGD5(1 + gm5RD). The circuit thus reduces to that in Fig. 6.42(d),
where CX ≈CGS3 + CGS5 + CDB3 + CGD5(1 + gm5RD) + CDB1. The overall transfer function is then equal to
VX/Vin1 multiplied by Vout1/VX. The former is readily obtained from (6.30) by replacing RD with 1/gm3 and CDB
with CX, while the latter is
Vout1
VX
(s) = −gm5RD
1
1 + RDCLs
(6.97)
Note that we have neglected the zero due to CGD5.
▲
6.7
Gain-Bandwidth Trade-Offs
In many applications, we wish to maximize both the gain and the bandwidth of ampliﬁers. For example,
optical communication receivers employ an ampliﬁer that must achieve a high gain and a wide band-
width. This section deals with gain-bandwidth trade-offs encountered in high-speed design. As shown in
Fig. 6.43, we are interested in both the −3-dB bandwidth, ω−3d B, and the “unity-gain” bandwidth, ωu.

204
Chap. 6
Frequency Response of Ampliﬁers
ω
(log scale)
20log Vout
Vin
( jω)
 ω−3dB  
ωu
0 dB
Figure 6.43
Frequency response showing
−3-dB and unity-gain bandwidths.
6.7.1 One-Pole Circuits
In some circuits, the load capacitance seen at the output node produces a dominant pole, allowing a
one-pole approximation. That is, we can say that the −3-dB bandwidth is equal to the pole frequency.
For example, the CS stage of Fig. 6.44 exhibits an output pole given by ωp = [(rO1||rO2)CL]−1 if other
capacitances are neglected. Noting that the low-frequency gain is equal to |A0| = gm1(rO1||rO2), we
deﬁne the “gain-bandwidth” product (GBW) as
GBW = A0ωp
(6.98)
= gm1(rO1||rO2)
1
2π(rO1||rO2)CL
(6.99)
=
gm1
2πCL
(6.100)
M1
VDD
M2
Vout
CL
Vin
Vb
Figure 6.44
CS stage with one pole.
As an example, if gm1 = (100 )−1 and CL = 50 fF, then GBW = 31.8 GHz. For a one-pole system,
the gain-bandwidth product is approximately equal to the unity-gain bandwidth; this can be seen
by writing
A0
	
1 + ( ωu
ωp
)2
= 1
(6.101)
and hence
ωu =

A2
0 −1ωp
(6.102)
≈A0ωp
(6.103)
if A2
0 ≫1.

Sec. 6.7
Gain-Bandwidth Trade-Offs
205
▲
Example6.18
Does cascoding increase the GBW product? Assume that the output pole is dominant.
Solution
No, it does not. Equation (6.100) suggests that the GBW product is independent of the output resistance. More
speciﬁcally, if cascoding in Fig. 6.44 raises the output impedance by a factor of K, then |A0| (= Gm Rout) rises and
ωp falls, both by a factor of K, yielding a constant GBW product.
▲
6.7.2 Multi-Pole Circuits
It is possible to increase the GBW product by cascading two or more gain stages. Consider the ampliﬁer
shown in Fig. 6.45, where, for simplicity, we assume that the two stages are identical and neglect other
capacitances. Associating one pole with each node, we write the transfer function as (Vout/VX)(VX/Vin):
Vout
Vin
=
A2
0
(1 + s
ωp
)2
(6.104)
M1
M2
CL
Vin
Vb
M3
VDD
M4
Vout
CL
VX
Figure 6.45
Cascaded CS stages.
where A0 = gmN(rON||rO P) and ωp = [(rON||rO P)CL]−1. To obtain the −3-dB bandwidth, we equate
the magnitude of Vout/Vin to A2
0/
√
2:
A2
0
1 + ω2
−3d B
ω2p
= A2
0
√
2
(6.105)
and
ω−3d B =

√
2 −1ωp
(6.106)
≈0.64ωp
(6.107)
The GBW product thus rises to
GBW =

√
2 −1A2
0ωp
(6.108)
a factor of 0.64A0 greater than that in Eq. (6.103). Of course, the power consumption is doubled.
While raising the GBW product, cascading reduces the bandwidth, as evidenced by Eq. (6.107). In
fact, we prove in Problem 6.25 that for N identical stages,
ω−3d B =

N√
2 −1ωp
(6.109)

206
Chap. 6
Frequency Response of Ampliﬁers
observing a steady decline in the bandwidth as N increases. Another disadvantage of cascading is
that the resulting multiple poles lead to instability if the circuit is placed in a negative-feedback loop
(Chapter 10).
6.8
Appendix A: Extra Element Theorem
Introduced by Middlebrook [1], the extra element theorem (EET) proves useful in calculating some
transfer functions. Suppose the transfer function of a circuit is known and denoted by H(s). Now, as
shown in Fig. 6.46(a), we add an extra impedance Z1 between two nodes of the circuit. We wish to
determine the new transfer function, G(s). Middlebrook proves that
G(s) = H(s)
1 + Zout,0
Z1
1 + Zin,0
Z1
(6.110)
i.e., the original transfer function is multiplied by a “correction factor.” The terms Zout,0 and Zin,0 are
quantities measured between nodes A and B in the absence of Z1. The former is computed as depicted
in Fig. 6.46(b): we apply a voltage source between A and B while Vin is present and choose their values
so that Vout = 0; then Zout,0 = V1/I1. This calculation appears rather complex and unintuitive, but, as
shown below, it is in fact quite simple. We should also remark that Zout,0 is not an impedance in the
standard sense because it is obtained with a ﬁnite Vin. The latter, Zin,0, is simply equal to the impedance
seen between A and B when Vin = 0 [Fig. 6.46(c)].
Vout
Vin
A
Z1
Vout = 0
Vin
A
B
B
A
B
V1
V1
I1
I1
(c)
(a)
(b)
Figure 6.46
(a) Circuit with extra parallel element, Z1, (b) Zout,0 calculation, and (c) Zin,0 calculation.
This theorem is particularly useful for frequency-response analysis because we can begin with no
capacitances in the circuit, ﬁnd H(s) as the low-frequency gain, add the capacitors one by one, and
calculate the correction factors. Note that H(s) cannot be zero or inﬁnity because the EET’s proof relies
on division by H(s).
▲
Example6.19
Using the EET, ﬁnd the transfer function of the circuit in Fig. 6.47(a).
Solution
We ﬁrst consider the circuit without CF and write H(s) = −gm(RD||rO). Next, we ﬁnd Zout,0 using the setup
shown in Fig. 6.47(b), exploiting the condition that Vout is zero and so is the current through RD. Since Vout = 0,
we have VGS = V1 and I1 = −gmVGS = −gmV1. That is, Zout,0 = −1/gm. Note that we resisted the temptation to

Sec. 6.8
Appendix A: Extra Element Theorem
207
M1
RD
RS
Vin
VDD
A
B
CF
M1
RD
RS
Vin
VDD
A
B
Vout
V1
I1
Vout = 0
M1
RD
RS
VDD
A
B
V1
I1
(a)
(b)
(c)
Figure 6.47
write equations involving Vin. Also, the negative sign of Zout,0 does not imply a negative impedance between A and
B because Vin ̸= 0.
For Zin,0, we have from Fig. 6.47(c), VA = I1RS = VGS. A KCL at node B gives the current through RD as
gm I1RS + I1, and a KVL across RD, V1, and RS leads to I1RD(1 + gm RS) −V1 + I1RS = 0. It follows that
Zin,0 = (1 + gm RS)RD + RS = (1 + gm RD)RS + RD and
G(s) = −gm(RD||rO)
1 −1
gm
CFs
1 + [(1 + gm RD)RS + RD]CFs
(6.111)
We see that the EET beautifully predicts the zero and the pole produced by CF.
▲
▲
Example6.20
Repeat the above example while including both CF and a capacitor, CB, from node B to ground.
Solution
Since we have already obtained the transfer function withCF present, we must seek the Zout,0 and Zin,0 corresponding
to CB. The arrangement depicted in Fig. 6.48(a) suggests that Zout,0 = 0 because the drain voltage must be zero
while V1 is not, requiring an inﬁnite current to ﬂow through V1.
M1
RD
RS
VDD
A
B
CF
V1
I1
M1
RD
RS
VDD
A
B
CF
V1
I1
Vin
(a)
(b)
Figure 6.48
For Zin,0, we note from Fig. 6.48(b) that VGS = V1RSCFs/(RSCFs + 1) and the current ﬂowing through CF
is equal to V1/[(CFs)−1 + RS]. A KCL at the drain node gives
V1
RD
+
V1CFs
RSCFs + 1 + gmV1
RSCFs
RSCFs + 1 = I1
(6.112)

208
Chap. 6
Frequency Response of Ampliﬁers
Thus,
Zin,0 =
RD(RSCFs + 1)
[RS(1 + gm RD) + RD]CFs + 1
(6.113)
Using Eq. (6.111), we write the new transfer function as
G(s) = −gm(RD||rO)
1 −CF
gm
s
1 + [(1 + gm RD)RS + RD]CFs
1
1 +
RD(RSCFs + 1)CBs
[RS(1 + gm RD) + RD]CFs + 1
= −gm(RD||rO)
1 −CF
gm
s
[RS(1 + gm RD) + RD]CFs + RD(RSCFs + 1)CBs + 1
(6.114)
▲
The EET can also be expressed for series elements [1]. That is, if the transfer function of a circuit is
H(s) before we insert an element, Z1, in series with a branch, then the new transfer function is given
by [1]
G(s) = H(s)
1 +
Z1
Zout,0
1 +
Z1
Zin,0
(6.115)
6.9
Appendix B: Zero-Value Time Constant Method
Our analysis of frequency response in this chapter reveals considerable mathematical labor when the
number of poles exceeds two. In some cases, we are content with estimating the dominant pole—if one
exists—or the −3-dB bandwidth of the circuit. The “zero-value time constant” (ZVTC) method provides
an approximation of these quantities. It also proves useful as an additional analysis tool.
Before delving into the ZVTC method, let us make an observation. Suppose a circuit contains one
capacitor and no other storage elements and we wish to determine the pole of the system [Fig. 6.49(a)].
We can derive the transfer function Vout(s)/Vin(s) and examine its denominator, D(s). Alternatively, as
shown in Fig. 6.49(b), we can set the input to zero, compute the resistance, R1, seen by C1, and express
C1
A
Vin
Vout
C1
A
B
B
R1
(a)
(b)
Figure 6.49
(a) General circuit containing one capacitor, and (b) resistance seen by C1.

Sec. 6.9
Appendix B: Zero-Value Time Constant Method
209
the pole as 1/(R1C1). In Problem 6.23, we prove why this is true, but the important point here is that this
method often simpliﬁes the analysis.
▲
Example6.21
A CG stage contains a resistance RG in series with the gate [Fig. 6.50(a)]. If only CGD is considered, determine the
pole frequency.
gmV1
gmV1
RG
RD
Vout
V1
RS
Vin
CGD
RG
RD
Vout
V1
RS
VX
IX
(a)
(b)
Figure 6.50
Solution
As illustrated in Fig. 6.50(b), we remove CGD, set Vin to zero, and apply a voltage (or current) source to measure
the resistance seen by this capacitor. The voltage across RS is equal to gmV1RS, yielding
gmV1RS + V1 = −IX RG
(6.116)
and hence V1 = −IX RG/(1 + gm RS). Since the current ﬂowing through RD is equal to IX −gmV1, we have
−IX RG + VX = (IX −gmV1)RD
(6.117)
Substituting for V1, we obtain
VX
IX
= RD +

gm RD
1 + gm RS
+ 1

RG = Req
(6.118)
The pole is given by 1/(ReqCGD). The reader is encouraged to determine the circuit’s transfer function directly and
compare the mathematical labor.
Interestingly, as a result of RG, the resistance seen by CGD rises from RD to RD plus a multiple of RG, the
multiple given by the low-frequency gain of the CG stage plus 1. It is also interesting to note that the circuit of
Fig. 6.50(a) does not lend itself to Miller’s approximation (why?).
▲
As our ﬁrst step toward developing the ZVTC method, let us determine the transfer function of the
simple second-order circuit shown in Fig. 6.51. Since the current through R2 is equal to VoutC2s, and
hence VX = R2VoutC2s + Vout, we obtain the current through C1 as VXC1s = (1 + R2C2s)C1sVout. This
current and that through R2 ﬂow through R1, producing a voltage drop equal to R1(1+ R2C2s)C1sVout +
R1VoutC2s. Writing a KVL around Vin, R1, R2, and Vout gives
Vin = R1(1 + R2C2s)C1sVout + R1C2sVout + R2VoutC2s + Vout
(6.119)

210
Chap. 6
Frequency Response of Ampliﬁers
C1
R1
C2
R2
Vin
Vout
VX
Figure 6.51
Second-order RC circuit.
It follows that
Vout
Vin
(s) =
1
R1R2C1C2s2 + [R1C1 + (R1 + R2)C2]s + 1
(6.120)
Recall from Sec. 6.2 that, if a dominant pole exists, then it is given by the inverse of the coefﬁcient of s,
Bs. We now focus on this coefﬁcient, noting that it must have a time dimension and is therefore the sum
of time constants. The ﬁrst time constant, R1C1, contains a resistance equal to the resistance seen by C1
as if C2 were zero.6 Similarly, the second time constant, (R1 + R2)C2, arises from the resistance seen
by C2 as if C1 were zero. We call R1C1 and (R1 + R2)C2 “zero-value” time constants because each is
obtained by setting the other capacitor to zero.
Can we generalize this result? That is, can we say that the dominant pole is given by the inverse
of the sum of all of the zero-value time constants? We must ﬁrst prove that, even for higher-order
systems, the dominant pole is equal to the inverse of the coefﬁcient of s in the denominator. Writing the
denominator as
D(s) =

1 +
s
ωp1
 
1 +
s
ωp2

· · ·

1 +
s
ωpn

(6.121)
we recognize that the coefﬁcient of s, Bs, is equal to ω−1
p1 + ω−1
p2 + · · · + ω−1
pn , which reduces to ω−1
p1 if
this pole is dominant.
Next, we must prove that Bs is equal to the sum of the zero-value time constants of the circuit.
Assuming that the circuit contains only capacitors as storage elements,7 we note that, since Bs has a time
dimension, it can be expressed as
Bs = R1C1 + R2C2 + · · · + RnCn
(6.122)
where R1–Rn are unknown. Note that C1–Cn denote the capacitors in the circuit, but R1–Rn may represent
physical resistors or equivalent resistances (e.g., 1/gm). How do we obtain R1–Rn? If C2–Cn are set to
zero, the order of the system falls to 1, i.e., D(s) = Bss +1 = R1C1s +1, where R1 is the resistance seen
by C1. Similarly, if C1 = C3 = · · · = Cn = 0, we have D(s) = R2C2s+1, where R2 is the resistance seen
by C2. Thus, the dominant pole is indeed equal to the inverse of the sum of the zero-value time constants.
The reader is cautioned that, even though, Bs = ω−1
p1 + ω−1
p2 + · · · + ω−n
p1 = R1C1 + R2C2 + · · · + RnCn,
we cannot conclude that ω−1
p1 = R1C1, ω−1
p2 = R2C2, etc. Also, note that this method neglects the effect
of zeros.
The ZVTC method proves useful if we wish to estimate the −3-dB bandwidth of a circuit. Depicted
in Fig. 6.52, the idea is to approximate the frequency response by a one-pole system, and hence the time
response by a single exponential. The following example illustrates this point.
6With Vin = 0.
7The analysis can be repeated for other types of storage elements as well.

Sec. 6.9
Appendix B: Zero-Value Time Constant Method
211
 ω  
H (ω)
Actual
Response
One−Pole
Approximation
t
One−Pole
Approximation
Actual
Response
Step
Response
Figure 6.52
Approximation of the frequency and time responses by one-pole counterparts.
▲
Example6.22
Estimate the −3-dB bandwidth of a resistively-degenerated common-source stage. Assume λ = γ = 0.
Solution
Shown in Fig. 6.53(a), the small-signal model is of third order,8 providing little intuition. The zero-value time
constant method can give a rough estimate of the circuit’s bandwidth, thereby revealing the contribution of each
capacitor.
gmV1
CL
RG
Vin
CGS
CGD
RD
Vout
V1
RS
gmV1
RG
RD
V1
RS
VX
IX
(a)
(b)
Figure 6.53
We begin with the time constant associated with CGS and set CGD and CL to zero. As depicted in Fig. 6.53(b),
the resistance seen by CGS is VX/IX. We denote this resistance by RCGS. Since V1 = VX and the current ﬂowing
through RS is equal to gmV1 −IX = gmVX −IX, we write a KVL as follows:
IX RG = VX + (gmVX −IX)RS
(6.123)
obtaining
RCGS = RG + RS
1 + gm RS
(6.124)
For the resistance seen by CGD, we have from Example 6.21
RCGD = RD +

gm RD
1 + gm RS
+ 1

RG
(6.125)
8This can be seen by observing that it is possible to impose three independent initial conditions across the three capacitors
without violating KVL.

212
Chap. 6
Frequency Response of Ampliﬁers
Finally, the resistance seen by CL is simply equal to RD. It follows that the −3-dB bandwidth is given by
ω−1
−3d B = RG + RS
1 + gm RS
CGS +

RD +

gm RD
1 + gm RS
+ 1

RG

CGD + RDCL
(6.126)
With no degeneration, this result reduces to Eq. (6.35). With a ﬁnite RS, the effect of CGS and RG is reduced by a
factor of 1 + gm RS, albeit at the cost of voltage gain.
▲
▲
Example6.23
Repeat the above example for a common-gate stage containing a gate resistance of RG and a source resistance of RS.
Solution
We draw the small-signal circuit as shown in Fig. 6.54. For the computation of zero-value time constants, the main
input is set to zero. Thus, the resulting equivalent circuits are identical for CS and CG stages, yielding the same time
constants and hence the same bandwidth. After all, the circuits in Figs. 6.53(a) and 6.54 are topologically identical
and contain the same poles.
gmV1
CL
RG
CGS
CGD
RD
Vout
V1
RS
Vin
Figure 6.54
Does this result contradict our earlier assertion that the CG stage is free from the Miller effect? No, it does not.
In a CG stage, we strive to avoid RG, whereas in a CS stage, RG represents the preceding circuit’s output resistance
and is inevitable.
▲
6.10
Appendix C: Dual of Miller’s Theorem
In Miller’s theorem (Fig. 6.2), we readily observe that Z1 + Z2 = Z. This is no coincidence, and it has
interesting implications. Redrawing Fig. 6.2 as shown in Fig. 6.55(a), we surmise that since the point
between Z1 and Z2 can be grounded, then if we “walk” from X toward Y along the impedance Z, the
Z
Za
Zb
Z1
Z2
X
Y
(b)
X
Y
X
Y
VP = 0
Z
(a)
Figure 6.55
Illustration of Miller’s theorem, identifying a local zero potential a long Z.

Sec. 6.10
Appendix C: Dual of Miller’s Theorem
213
local potential drops to zero at some intermediate point [Fig. 6.55(b)]. Indeed, for VP = 0, we have
Za
Za + Zb
(VY −VX) + VX = 0
(6.127)
and, since Za + Zb = Z,
Za =
Z
1 −VY/VX
(6.128)
Similarly,
Zb =
Z
1 −VX/VY
(6.129)
In other words, Z1(= Za) and Z2(= Zb) are such decompositions of Z that provide an intermediate node
having a zero potential. For example, since in the common-source stage of Fig. 6.13, VX and VY have
opposite polarities, the potential falls to zero at some point “inside” CGD.
The above observation explains the difﬁculty with the transformation depicted in Fig. 6.5. Drawing
Fig. 6.55(b) for this case as in Fig. 6.56(a), we recognize that the circuit is still valid before node P is
grounded because the current through R1 + R2 must equal that through −R2. However, if, as shown in
Fig. 6.56(b), node P is tied to ground, then the only current path between X and Y vanishes.
R2
X
Y
X
Y
(a)
(b)
R1 + R2
R2
−R2
R1 + R2
−R2
Figure 6.56
Resistive divider with decomposition of R1.
The concept of a local zero potential along the ﬂoating impedance Z also allows us to develop the
“dual” of Miller’s theorem, i.e., decomposition in terms of admittances and current ratios. Suppose two
loops carrying currents I1 and I2 share an admittance Y [Fig. 6.57(a)]. Then, if Y is properly decomposed
into two parallel admittances Y1 and Y2, the current ﬂowing between the two is zero [Fig. 6.57(b)], and
the connection can be broken [Fig. 6.57(c)]. In Fig. 6.57(a), the voltage across Y is equal to (I1 −I2)/Y,
and in Fig. 6.57(c), the voltage across Y1 is I1/Y1. For the two circuits to be equivalent,
I1 −I2
Y
= I1
Y1
(6.130)
and
Y1 =
Y
1 −I2/I1
(6.131)
Y
I1
I2
I1
I2
Y1
Y2
I = 0
I1
I2
Y1 Y2
(c)
(a)
(b)
Figure 6.57
(a) Two loops sharing admittance Y, (b) decomposition of Y into Y1 and Y2 such that I = 0,
(c) equivalent circuit.

214
Chap. 6
Frequency Response of Ampliﬁers
Note the duality between this expression and Z1 = (1 −VY/VX)Z. We also have
Y2 =
Y
1 −I1/I2
(6.132)
References
[1] R. D. Middlebrook, “Null Double Injection and the Extra Element Theorem,” IEEE Trans. Circuits and Systems,
vol. 32, pp. 167–180, Aug. 1989.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3
V where necessary. Also, assume that all transistors are in saturation. All device dimensions are effective values and
in microns.
6.1.
In the circuit of Fig. 6.3(c), suppose the ampliﬁer has a ﬁnite output resistance Rout.
(a) Explain why the output jumps up by V before it begins to go down. This indicates the existence of a
zero in the transfer function.
(b) Determine the transfer function and the step response without using Miller’s theorem.
6.2.
Repeat Problem 6.1 if the ampliﬁer has an output resistance Rout and the circuit drives a load capacitance CL.
6.3.
The CS stage of Fig. 6.13 is designed with (W/L)1 = 50/0.5, RS = 1 k, and RD = 2 k. If ID1 = 1 mA,
determine the poles and the zero of the circuit.
6.4.
Consider the CS stage of Fig. 6.16, where I1 is realized by a PMOS device operating in saturation. Assume
that (W/L)1 = 50/0.5, ID1 = 1 mA, and RS = 1 k.
(a) Determine the aspect ratio of the PMOS transistor such that the maximum allowable output level is 2.6 V.
What is the maximum peak-to-peak swing?
(b) Determine the poles and the zero.
6.5.
A source follower employing an NFET with W/L = 50/0.5 and a bias current of 1 mA is driven by a source
impedance of 10 k. Calculate the equivalent inductance seen at the output.
6.6.
Neglecting other capacitances, calculate the input impedance of each circuit shown in Fig. 6.58.
M1
C2
C1
M2
VDD
λ = 0
λ = 0
λ ≠ 0
M1
C2
C1
VDD
I1
Zin
Zin
M1
VDD
I1
C1
C2
Zin
(c)
(a)
(b)
Figure 6.58
6.7.
Estimate the poles of each circuit in Fig. 6.59.
6.8.
Calculate the input impedance and the transfer function of each circuit in Fig. 6.60.
6.9.
Calculate the gain of each circuit in Fig. 6.61 at very low and very high frequencies. Neglect all other
capacitances and assume that λ = 0 for circuits (a) and (b) and γ = 0 for all of the circuits.

Problems
215
M1
Vin
RS
I1
M2
VDD
I2
Vout
I1
M2
VDD
I2
Vout
M1
Vb
Vin
RS
(a)
(b)
λ = 0
λ ≠ 0
Figure 6.59
M1
VDD
I1
(c)
(a)
(b)
M2
Vin
RS
Vb
I2
Vout
Zin
M1
VDD
I1
M2
Vin
RS
I2
Vout
Zin
M1
VDD
I1
M2
Vin
RS
I2
Vout
Zin
M1
VDD
I1
Vb
M2
Vin
RS
I2
Zin
Vout
Vb1
VDD
I1
M2
Vin
RS
I2
Vout
Zin
M1
Vb2
VDD
I1
Vin
RS
I2
Vout
Zin
λ = γ = 0 
λ = γ = 0 
λ = γ = 0 
λ ≠ 0 
λ = γ = 0 
λ = γ = 0 
M1
Vb2
M2
(d)
(e)
(f)
Figure 6.60
6.10. Calculate the gain of each circuit in Fig. 6.62 at very low and very high frequencies. Neglect all other
capacitances and assume that λ = γ = 0.
6.11. Consider the cascode stage shown in Fig. 6.63. In our analysis of the frequency response of a cascode stage,
we assumed that the gate-drain overlap capacitance of M1 is multiplied by gm1/(gm2 + gmb2). Recall from
Chapter 3, however, that with a high resistance loading the drain of M2, the resistance seen looking into the
source of M2 can be quite high, suggesting a much higher Miller multiplication factor for CGD1. Explain why
CGD1 is still multiplied by 1 + gm1/(gm2 + gmb2) if CL is relatively large.
6.12. Neglecting other capacitances, calculate Z X in the circuits of Fig. 6.64. Sketch |Z X| versus frequency.
6.13. The common-gate stage of Fig. 6.31 is designed with (W/L)1 = 50/0.5, ID1 = 1 mA, RD = 2 k, and
RS = 1 k. Assuming λ = 0, determine the poles and the low-frequency gain. How do these results compare
with those obtained in Problem 6.9?

216
Chap. 6
Frequency Response of Ampliﬁers
M1
Vin
M2
R1
C1
VDD
R2
C2
M3
Vout
M1
Vin
M2
VDD
M3
Vout
Vb2
Vb2
C1
M1
C2
C1
M2
VDD
(c)
(a)
(b)
Vin
Vout
M1
M2
VDD
Vout
C1
Vin
R2
Vb
R1
C2
(d)
M3
Vb
Figure 6.61
(a)
(b)
M1
M2
VDD
M4
M3
ISS
C1
Vin
Vout
Vout
VDD
M4
M3
R2
R2
M1
M2
ISS
Vin
R1
C1
Vb
C2
M5
M6
Figure 6.62

Problems
217
VDD
I1
M1
M2
Vout
Vb2
CL
CGD1
Figure 6.63
M1
VDD
(a)
M2
I1
ZX
RD
C1
M1
VDD
λ = γ = 0
λ = γ = 0
M2
I1
ZX
RD
C1
(b)
Figure 6.64
6.14. Suppose that in the cascode stage of Fig. 6.34, a resistor RG appears in series with the gate of M2. Including
only CGS2, neglecting other capacitances, and assuming λ = γ = 0, determine the transfer function.
6.15. Apply the method of Fig. 6.18 to the circuit of Fig. 6.41(b) to determine the zero of the transfer function.
6.16. The circuit of Fig. 6.42(a) is designed with (W/L)1,2 = 50/0.5 and (W/L)3,4 = 10/0.5. If ISS = 100 μA,
K = 2, CL = 0, and RD is implemented by an NFET having W/L = 50/0.5, estimate the poles and zeros
of the circuit. Assume the ampliﬁer is driven by an ideal voltage source.
6.17. A differential pair driven by an ideal voltage source is required to have a total phase shift of 135◦at the
frequency where its gain drops to unity.
(a) Explain why a topology in which the load is realized by diode-connected devices or current sources does
not satisfy this condition.
(b) Consider the circuit shown in Fig. 6.65. Neglecting other capacitances, determine the transfer function.
Explain under what conditions the load exhibits an inductive behavior. Can this circuit provide a total
phase shift of 135◦at the frequency where its gain drops to unity?
Vout
M1
M2
ISS
Vin
R1
C1
R2
C2
M3
M4
VDD
Figure 6.65

218
Chap. 6
Frequency Response of Ampliﬁers
6.18. Repeat Example 6.3, but assume that I1 is replaced with a resistor R1.
6.19. A resistively-degenerated common-source stage bootstraps CGS in a manner similar to a source follower.
Estimate the input capacitance of such a stage.
6.20. Determine the transfer function of a CG stage with a resistance RG in series with the gate, including only
CGS and CGD. Assume λ = γ = 0.
6.21. Determine the transfer function of a CG stage with a resistance RG in series with the gate, including only
CGD and CDB. Assume λ = γ = 0.
6.22. Determine the transfer function of a differential pair with current-source loads for differential signals. Assume
that each input is driven by a series resistance of RS.
6.23. Consider a circuit containing only one capacitor, C1. We set the main input to zero and apply a current
source, IX, in parallel with C1, obtaining the voltage across it, VX, and hence VX(s)/IX(s) (Fig. 6.66). This
impedance has the same pole as the main transfer function. Prove that the pole is given by 1/(R1C1), where
R1 is the resistance seen by C1.
C1
A
B
Iin
VX
Figure 6.66
6.24. Repeat Example 6.22, but with λ > 0 and γ > 0.
6.25. Prove that the −3-dB bandwidth of N ﬁrst-order identical gain stages is given by

N√
2 −1ωp, where ωp
denotes the pole of one stage.
6.26. Prove that if CGD = 0, then Eq. (6.30) reduces to the product of two transfer functions that can simply be
obtained by association of poles with the input and output nodes.

CHAPTER
7
Noise
Noise limits the minimum signal level that a circuit can process with acceptable quality. Today’s analog
designers constantly deal with the problem of noise because it trades with power dissipation, speed, and
linearity.
In this chapter, we describe the phenomenon of noise and its effect on analog circuits. The objective is
to provide sufﬁcient understanding of the problem so that further developments of analog circuits in the
following chapters take noise into account as naturally as they do other circuit parameters, such as gain,
input and output impedances, etc. Seemingly a complex subject, noise is introduced at this early stage
so as to accompany the reader for the remainder of the book and become more intuitive through various
examples.
Following a general description of noise characteristics in the frequency and time domains, we intro-
duce thermal and ﬂicker noise. Next, we consider methods of representing noise in circuits. Finally, we
describe the effect of noise in single-stage and differential ampliﬁers along with trade-offs with other
performance parameters.
7.1
Statistical Characteristics of Noise
Noise is a random process. For our purposes in this book, this statement means that the value of noise
cannot be predicted at any time even if the past values are known. Compare the output of a sine-wave
generator with that of a microphone picking up the sound of water ﬂow in a river (Fig. 7.1). While the
value of x1(t) at t = t1 can be predicted from the observed waveform, the value of x2(t) at t = t2 cannot.
This is the principal difference between deterministic and random phenomena.
If the instantaneous value of noise in the time domain cannot be predicted, how can we incorporate
noise in circuit analysis? This is accomplished by observing the noise for a long time and using the
measured results to construct a “statistical model” for the noise. While the instantaneous amplitude of
noise cannot be predicted, a statistical model provides knowledge about some other important properties
of the noise that prove useful and adequate in circuit analysis.
Which properties of noise can be predicted? In many cases, the average power of noise is predictable.
For example, if a microphone picking up the sound of a river is brought closer to the river, the resulting
electrical signal displays, on the average, larger excursions and hence higher power (Fig. 7.2). The reader
may wonder if a random process can be so random that even its average power is unpredictable. Such
processes do exist, but we are fortunate that most sources of noise in circuits exhibit a constant average
power.
219

220
Chap. 7
Noise
t
x1(t)
x2(t)
Signal
Generator
t
(a)
(b)
t1
t2
Figure 7.1
(a) The output of a generator, and (b) the sound of a river.
t
(a)
(b)
t
xA(t)
xB(t)
Figure 7.2
Illustration of the average power of a random signal.
The concept of average power proves essential in our analysis and must be deﬁned carefully. Recall
from basic circuit theory that the average power delivered by a periodic voltage v(t) to a load resistance
RL is given by
Pav = 1
T
 +T/2
−T/2
v2(t)
RL
dt
(7.1)
where T denotes the period.1 Measured in watts, this quantity can be visualized as the average heat
produced in RL by v(t).
1To be more rigorous, v2(t) should be replaced by v(t) · v∗(t), where v∗(t) is the complex conjugate waveform.

Sec. 7.1
Statistical Characteristics of Noise
221
How do we deﬁne Pav for a random signal? In the example of Fig. 7.2, we expect that xB(t) generates
more heat than xA(t) if the microphone drives a resistive load. However, since the signals are not periodic,
the measurement must be carried out over a long time:
Pav = lim
T →∞
1
T
 +T/2
−T/2
x2(t)
RL
dt
(7.2)
where x(t) is a voltage quantity. Figure 7.3 illustrates the operation on x(t): the signal is squared, the
area under the resulting waveform is calculated for a long time T , and the average power is obtained by
normalizing the area to T .2
t
t
(  )2
T
T
Figure 7.3
Average noise power.
To simplify calculations, we write the deﬁnition of Pav as
Pav = lim
T →∞
1
T
 +T/2
−T/2
x2(t)dt
(7.3)
where Pav is expressed in V2 rather than W. The idea is that if we know Pav from (7.3), then the actual
power delivered to a load RL can be readily calculated as Pav/RL. In analogy with deterministic signals,
we can also deﬁne a root-mean-square (rms) voltage for noise as √Pav, where Pav is given by (7.3).
7.1.1 Noise Spectrum
The concept of average power becomes more versatile if deﬁned with regard to the frequency content of
noise. The noise made by a group of men contains weaker high-frequency components than that made
by a group of women, a difference observable from the “spectrum” of each type of noise. Also called the
“power spectral density” (PSD), the spectrum shows how much power the signal carries at each frequency.
More speciﬁcally, the PSD, Sx( f ), of a noise waveform x(t) is deﬁned as the average power carried by
x(t) in a one-hertz bandwidth around f . That is, as illustrated in Fig. 7.4(a), we apply x(t) to a bandpass
ﬁlter with a center frequency of f1 and a 1-Hz bandwidth, square the output, x f 1(t), and calculate the
average over a long time to obtain Sx( f1). Repeating the procedure with bandpass ﬁlters having different
center frequencies, we arrive at the overall shape of Sx( f ) [Fig. 7.4(b)].3 Generally, Sx( f ) is measured
in watts per hertz. The total area under Sx( f ) represents the power carried by the signal (or the noise) at
all frequencies; i.e., the total power.
▲
Example7.1
(a) Sketch the spectrum of voice for men and women. What does the difference imply about their time-domain
waveforms?
(b) Estimate the averaging time, T , in Eq. (7.3) for voice signals.
2Strictly speaking, this deﬁnition holds only for “stationary” processes [1].
3In signal processing theory, the PSD is deﬁned as the Fourier transform of the autocorrelation function of the noise. The two
deﬁnitions are equivalent in most cases of interest to us.

222
Chap. 7
Noise
f
f2
f1
fn
f
f1
1 Hz
Band−Pass
Filter
t
x(t)
( ) 2
t
t
xf1(t)  2
xf1(t)
Sx(f)
(a)
(b)
Figure 7.4
Calculation of noise spectrum.
Solution
(a) The human voice exhibits frequencies from 20 Hz to 20 kHz. Since women’s voice contain stronger high-
frequency components, we expect the two spectra to differ as shown in Fig. 7.5(a). In the time domain, we observe
faster changes in women’s voice [Fig. 7.5(b)].
SX(f )
f
Men’s
Voice
Women’s
Voice
20 Hz
20 kHz
x(t)
x(t)
t
t
Women’s Voice
Men’s Voice
(a)
(b)
Figure 7.5
(a) Spectra of men’s and women’s voices, and (b) corresponding time-domain waveforms.

Sec. 7.1
Statistical Characteristics of Noise
223
(b) The averaging time must be long enough to include a sufﬁcient number of cycles of the lowest frequencies.
That is, the averaging must capture the slowest dynamics in the signal. We must therefore choose T to be at least
about 10 cycles of 20 Hz, i.e., roughly 500 ms.
▲
As with the deﬁnition of Pav in (7.3), it is customary to eliminate RL from Sx( f ). Thus, since each
value on the plot in Fig. 7.4(b) is measured for a 1-Hz bandwidth, Sx( f ) is expressed in V2/Hz rather than
W/Hz. It is also common to take the square root of Sx( f ), expressing the result in V/
√
Hz. For example,
we say that the input noise voltage of an ampliﬁer at 100 MHz is equal to 3 nV/
√
Hz, simply to mean
that the average power in a 1-Hz bandwidth at 100 MHz is equal to (3 × 10−9)2 V2.
f
Sn(f)
Figure 7.6
White spectrum.
An example of a common type of noise PSD is the “white spectrum,” also called white noise. Shown in
Fig. 7.6, such a PSD displays the same value at all frequencies (similar to white light). Strictly speaking,
we note that white noise does not exist because the total area under the power spectral density, i.e., the
total power carried by the noise, is inﬁnite. In practice, however, any noise spectrum that is ﬂat in the
band of interest is usually called white.
The PSD is a powerful tool in analyzing the effect of noise in circuits, especially in conjunction with
the following theorem.
Theorem
If a signal with spectrum Sx( f ) is applied to a linear time-invariant system with transfer
function H(s), then the output spectrum is given by
SY( f ) = Sx( f )|H( f )|2
(7.4)
where H( f ) = H(s = 2π j f ). The proof can be found in textbooks on signal processing or communi-
cations, e.g., [1].
Somewhat similar to the relation Y(s) = X(s)H(s), this theorem agrees with our intuition that the
spectrum of the signal should be “shaped” by the transfer function of the system (Fig. 7.7). For example,
as illustrated in Fig. 7.8, since regular telephones have a bandwidth of approximately 4 kHz, they suppress
the high-frequency components of the caller’s voice. Note that, owing to its limited bandwidth, xout(t)
exhibits slower changes than does xin(t). This bandwidth limitation sometimes makes it difﬁcult to
recognize the caller’s voice.
f
H(f ) 2
f
f
Sx(f )
Sy(f )
Figure 7.7
Noise shaping by a transfer function.
Since Sx( f ) is an even function of f for real x(t) [1], as depicted in Fig. 7.9, the total power carried
by x(t) in the frequency range [ f1 f2] is equal to
Pf 1, f 2 =
 −f1
−f2
Sx( f )d f +
 + f2
+ f1
Sx( f )d f
(7.5)
=
 + f2
+ f1
2Sx( f )d f
(7.6)

224
Chap. 7
Noise
t
xin(t)
xout(t)
Sxin(f)
Sxout(f)
f
H(f )
Telephone
t
f
4 kHz
20 kHz f
4 kHz
Figure 7.8
Spectral shaping by telephone bandwidth.
f
SX(f )
SX(f )
f
0
0
(a)
(b)
–f2
–f1
f1
f2
f1
f2
Figure 7.9
(a) Two-sided and (b) one-sided noise spectra.
In fact, the integral in (7.6) is the quantity measured by a power meter sensing the output of a bandpass
ﬁlter between f1 and f2. That is, the negative-frequency part of the spectrum is folded around the vertical
axis and added to the positive-frequency part. We call the representation of Fig. 7.9(a) the “two-sided”
spectrum and that of Fig. 7.9(b) the “one-sided” spectrum. For example, the two-sided white spectrum
of Fig. 7.6 has the one-sided counterpart shown in Fig. 7.10.
f
f
Sn(f )
Sn(f )
η
2
η
Figure 7.10
Folded white spectrum.
In summary, the spectrum shows the power carried in a small bandwidth at each frequency, revealing
how fast the waveform is expected to vary in the time domain.
7.1.2 Amplitude Distribution
As mentioned earlier, the instantaneous amplitude of noise is usually unpredictable. However, by observ-
ing the noise waveform for a long time, we can construct a “distribution” of the amplitude, indicating
how often each value occurs. Also called the “probability density function” (PDF), the distribution of
x(t) is deﬁned as
pX(x)dx = probability of x < X < x + dx
(7.7)
where X is the measured value of x(t) at some point in time.

Sec. 7.1
Statistical Characteristics of Noise
225
As illustrated in Fig. 7.11, to estimate the distribution, we sample x(t) at many points, construct bins
of small width, choose the bin height equal to the number of samples whose value falls between the two
edges of the bin, and normalize the bin heights to the total number of samples. Note that the PDF provides
no information as to how fast x(t) varies in the time domain. For example, the sound generated by a
violin may have the same amplitude distribution as that produced by a drum even though their frequency
contents are vastly different.
x
Number
of Samples
t
x(t)
Figure 7.11
Amplitude distribution of noise.
An important example of PDFs is the Gaussian (or normal) distribution. The central limit theorem
states that if many independent random processes with arbitrary PDFs are added, the PDF of the sum
approaches a Gaussian distribution [1]. It is therefore not surprising that many natural phenomena exhibit
Gaussian statistics. For example, since the noise of a resistor results from the random “walk” of a very
large number of electrons, each having relatively independent statistics, the overall amplitude follows a
Gaussian PDF.
In this book, we employ the spectrum and average power of noise to a much greater extent than the
amplitude distribution. For completeness, however, we note that the Gaussian PDF is deﬁned as
pX(x) =
1
σ
√
2π
exp −(x −m)2
2σ 2
(7.8)
where σ and m are the standard deviation and mean of the distribution, respectively. For Gaussian
distribution, σ is equal to the rms value of the noise.
7.1.3 Correlated and Uncorrelated Sources
In analyzing circuits, we often need to add the effect of several sources of noise to obtain the total noise.
While for deterministic voltages and currents, we simply use the superposition principle, the procedure
is somewhat different for random noise because we are ultimately interested in the average noise power.
Let us add two noise waveforms and take the average of the resulting power:
Pav = lim
T →∞
1
T
 +T/2
−T/2
[x1(t) + x2(t)]2dt
(7.9)
= lim
T →∞
1
T
 +T/2
−T/2
x2
1(t)dt + lim
T →∞
1
T
 +T/2
−T/2
x2
2(t)dt
+ lim
T →∞
1
T
 +T/2
−T/2
2x1(t)x2(t)dt
(7.10)
= Pav1 + Pav2 + lim
T →∞
1
T
 +T/2
−T/2
2x1(t)x2(t)dt
(7.11)

226
Chap. 7
Noise
where Pav1 and Pav2 denote the average power of x1(t) and x2(t), respectively. Called the “correlation”
between x1(t) and x2(t),4 the third term in (7.11) indicates how “similar” these two waveforms are. If
generated by independent devices, the noise waveforms are usually “uncorrelated” and the integral in
(7.11) vanishes. For example, the noise produced by a resistor has no correlation with that generated by
a transistor. In such a case, Pav = Pav1 + Pav2. From this observation, we say that superposition holds
for the power of uncorrelated noise sources. Of course, superposition also holds for noise voltages and
currents, but this does not help us in most cases.
A familiar analogy is that of the spectators in a sports stadium. Before the game begins, many conver-
sations are in progress, generating uncorrelated noise components [Fig. 7.12(a)]. During the game, the
spectators applaud (or scream) simultaneously, producing correlated noise at a much higher power level
arising from the third term in Eq. (7.11). [Fig. 7.12(b)].
x1(t)
x2(t)
x3(t)
x1(t)
x2(t)
x3(t)
xtot(t)
xtot(t)
t
t
(a)
(b)
t
t
Figure 7.12
(a) Uncorrelated noise and (b) correlated noise generated in a stadium.
In most cases studied in this book, the noise sources are uncorrelated. One exception is studied in
Section 7.3.
Ampliﬁer
Vin
t
Signal
Noise
0
f
20 kHz
1 MHz
Audio
Range
Ampliﬁer Bandwidth
H(ω)  
(a)
(b)
Figure 7.13
(a) Output noise produced by a circuit, and (b) additional noise if bandwidth is excessively wide.
7.1.4 Signal-to-Noise Ratio
Suppose an ampliﬁer receives a sinusoidal signal as shown in Fig. 7.13. The output contains both the
ampliﬁed signal and the noise generated by the circuit. For the output signal to be intelligible, its power,
Psig, must be sufﬁciently higher than that of the noise, Pnoise. We therefore deﬁne the “signal-to-noise
ratio” (SNR) as
SNR =
Psig
Pnoise
(7.12)
4This terminology applies only to stationary signals.

Sec. 7.1
Statistical Characteristics of Noise
227
For example, audio signals require a minimum SNR of about 20 dB (i.e., Psig/Pnoise = 100).5 For a
sinusoid having a peak amplitude of A, Psig = A2/2, but how do we calculate Pnoise? The total average
power carried by noise is equal to the area under its spectrum:
Pnoise =
 +∞
−∞
Snoise( f )d f
(7.13)
Does this mean that Pnoise can be very large if Snoise( f ) spans a wide frequency range? Yes, indeed. As
an example, suppose the above ampliﬁer provides a bandwidth of 1 MHz while sensing an audio signal
[Fig. 7.13(b)]. Then, the signal is corrupted by all of the noise components in the 1-MHz bandwidth.
For this reason, the bandwidth of the circuit must always be limited to the minimum acceptable value so
as to minimize the integrated noise power. The bandwidth can be reduced within the ampliﬁer or by a
low-pass ﬁlter placed thereafter.
▲
Example7.2
An ampliﬁer produces a one-sided noise spectrum given by Snoise( f ) = 5 × 10−16 V2/Hz. Determine the total
output noise in a bandwidth of 1 MHz.
Solution
We have
Pnoise =
 1 MHz
0
Snoise( f )d f
(7.14)
= 5 × 10−10 V2
(7.15)
Note that the total integrated noise is measured in V2 and not in V2/Hz. This noise power corresponds to an rms
voltage of
√
5 × 10−10 V2 = 22.4 μV.
▲
7.1.5 Noise Analysis Procedure
With the tools developed in previous sections, we can now outline a methodology for the analysis of
noise in circuits. The output signal of a given circuit is corrupted by the noise sources within the circuit.
We are therefore interested in the noise observed at the output. Our procedure consists of four steps:
1. Identify the sources of noise (e.g., resistors and transistors) and write down the spectrum of each.
2. Find the transfer function from each noise source to the output (as if the source were a deterministic
signal).
3. Utilize the theorem SY( f ) = Sx( f )|H( f )|2 to calculate the output noise spectrum contributed by
each noise source. (The input signal is set to zero.)
4. Add all of the output spectra, paying attention to correlated and uncorrelated sources.
This procedure gives the output noise spectrum, which must then be integrated from −∞to +∞so
as to yield the total output noise. To carry out the ﬁrst step, we need the noise representation of various
electronic devices, to be described in the next section.
5Since Psig and Pnoise are power quantities, 20 dB = 10 log(Psig/Pnoise).

228
Chap. 7
Noise
7.2
Types of Noise
Analog signals processed by integrated circuits are corrupted by two different types of noise: device
electronic noise and “environmental” noise. The latter refers to (seemingly) random disturbances that
a circuit experiences through the supply or ground lines or through the substrate. We focus on device
electronic noise here and defer the study of environmental noise to Chapter 19.
7.2.1 Thermal Noise
Resistor Thermal Noise
The random motion of electrons in a conductor introduces ﬂuctuations in the
voltage measured across the conductor, even if the average current is zero. Thus, the spectrum of thermal
noise is proportional to the absolute temperature. As shown in Fig. 7.14, the thermal noise of a resistor
R can be modeled by a series voltage source, with the one-sided spectral density
Sv( f ) = 4kT R,
f ≥0
(7.16)
R
V2n
Noiseless
Resistor
f
Sv(f )
4kTR
Figure 7.14
Thermal noise of a resistor.
where k = 1.38 × 10−23 J/K is the Boltzmann constant. Note that Sv( f ) is expressed in V2/Hz. Thus,
we also write V 2n = 4kT R, where the overline indicates averaging.6 We may even say that the noise
“voltage” is given by 4kT R even though this quantity is in fact the noise voltage squared. For example, a
50- resistor held at T = 300 K exhibits 8.28 × 10−19 V2/Hz of thermal noise. To convert this number
to a more familiar voltage quantity, we take the square root, obtaining 0.91 nV/
√
Hz. While the square
root of hertz may appear strange, it is helpful to remember that 0.91 nV/
√
Hz has little signiﬁcance per
se and simply means that the power in a 1-Hz bandwidth is equal to (0.91 × 10−9)2 V2.
The equation Sv( f ) = 4kT R suggests that thermal noise is white. In reality, Sv( f ) is ﬂat for up to
roughly 100 THz, dropping at higher frequencies. For our purposes, the white spectrum is quite accurate.
Since noise is a random quantity, the polarity used for the voltage source in Fig. 7.14 is unimportant.
Nevertheless, once a polarity is chosen, it must be retained throughout the analysis of the circuit so as to
obtain consistent results.
▲
Example7.3
Consider the RC circuit shown in Fig. 7.15. Calculate the noise spectrum and the total noise power in Vout.
R
C
VR
2
R
C
Vout
Vout
Figure 7.15
Noise generated in a low-pass ﬁlter.
6Some books write V 2n = 4kT Rf to emphasize that 4kT R is the noise power per unit bandwidth. To simplify the notation,
we assume that f = 1 Hz, unless otherwise stated. In other words, we use Sv( f ) and V 2n interchangeably.

Sec. 7.2
Types of Noise
229
Solution
We follow the four steps described in Section 7.1.5. The noise spectrum of R is given by Sv( f ) = 4kT R. Next,
modeling the noise of R by a series voltage source VR, we compute the transfer function from VR to Vout:
Vout
VR
(s) =
1
RCs + 1
(7.17)
From the theorem in Section 7.1.1, we have
Sout( f ) = Sv( f )

Vout
VR
( jω)

2
(7.18)
= 4kT R
1
4π2R2C2 f 2 + 1
(7.19)
Thus, the white noise spectrum of the resistor is shaped by a low-pass characteristic (Fig. 7.16). To calculate the total
noise power at the output, we write
Pn,out =
 ∞
0
4kT R
4π2R2C2 f 2 + 1d f
(7.20)
f
Sv(f )
4kTR
R
C
Vn,out
f
Sout(f )
4kTR
Figure 7.16
Noise spectrum shaping by a low-pass ﬁlter.
Note that the integration must be with respect to f rather than ω (why?). Since

dx
x2 + 1 = tan−1 x
(7.21)
the integral reduces to
Pn,out = 2kT
πC tan−1 u|u=∞
u=0
(7.22)
= kT
C
(7.23)
Note that the unit of kT/C is V2. We may also consider √kT/C as the total rms noise voltage measured at the
output. For example, with a 1-pF capacitor, the total noise voltage is equal to 64.3 μVrms at T = 300 K.
Equation (7.23) implies that the total noise at the output of the circuit shown in Fig. 7.15 is independent of the
value of R. Intuitively, this is because for larger values of R, the associated noise per unit bandwidth increases while
the overall bandwidth of the circuit decreases. The fact that kT/C noise can be decreased only by increasing C (if
T is ﬁxed) introduces many difﬁculties in the design of analog circuits (Chapter 13).
▲
The thermal noise of a resistor can be represented by a parallel current source as well (Fig. 7.17).
For the representations of Figs. 7.14 and 7.17 to be equivalent, we have V 2n /R2 = I 2n , that is, I 2n = 4kT/R.
Note that I 2n is expressed in A2/Hz. Depending on the circuit topology, one model may lead to simpler
calculations than the other.

230
Chap. 7
Noise
R
In2
Noiseless
Resistor
Figure 7.17
Representation of resistor
thermal noise by a current source.
▲
Example7.4
Calculate the equivalent noise voltage of two parallel resistors R1 and R2 [Fig. 7.18(a)].
R2
R2
R1
R1
V2n,tot
V2n,tot
I2n2
I2n1
(a)
(b)
Figure 7.18
Solution
As shown in Fig. 7.18(b), each resistor exhibits an equivalent noise current with the spectral density 4kT/R. Since
the two noise sources are uncorrelated, we add the powers:
I 2n,tot = I 2
n1 + I 2
n2
(7.24)
= 4kT

1
R1
+ 1
R2

(7.25)
Thus, the equivalent noise voltage is given by
V 2n,tot = I 2n,tot(R1∥R2)2
(7.26)
= 4kT (R1∥R2)
(7.27)
as intuitively expected. Note that our notation assumes a 1-Hz bandwidth.
▲
The dependence of thermal noise (and some other types of noise) upon T suggests that low-temperature
operation can decrease the noise in analog circuits. This approach becomes more attractive with the
observation that the mobility of charge carriers in MOS devices increases at low temperatures [2].7
Nonetheless, the required cooling equipment limits the practicality of low-temperature circuits.
MOSFETs
MOS transistors also exhibit thermal noise. The most signiﬁcant source is the noise generated
in the channel. It can be proved [4] that for long-channel MOS devices operating in saturation, the channel
noise can be modeled by a current source connected between the drain and source terminals (Fig. 7.19)
with a spectral density:8
I 2n = 4kT γ gm
(7.28)
7At extremely low temperatures, the mobility drops due to “carrier freezeout” [2].
8The actual equation reads I 2n = 4kT γ gds, where gds is the drain-source conductance with VDS = 0, i.e., the same as R−1
on .
For long-channel devices, gds with VDS = 0 is equal to gm in saturation.

Sec. 7.2
Types of Noise
231
In2 = 4kTγgm
Figure 7.19
Thermal noise of a
MOSFET.
The coefﬁcient γ (not to be confused with the body effect coefﬁcient!) is derived to be equal to 2/3
for long-channel transistors and may need to be replaced by a larger value for submicron MOSFETs [5].
It also varies to some extent with the drain-source voltage. As a rule of thumb, we assume γ ≈1.
▲
Example7.5
Find the maximum noise voltage that a single MOSFET can generate.
Solution
As shown in Fig. 7.20, the maximum output noise occurs if the transistor sees only its own output impedance as
the load, i.e., if the external load is an ideal current source. The output noise voltage spectrum is then given by
Sout( f ) = Sin( f )|H( f )|2, i.e.,
V 2n = I 2n r2
O
(7.29)
= (4kT γ gm)r2
O
(7.30)
In2 = 4kTγgm
I1
VDD
ac
V2n,out
M1
Figure 7.20
Let us make three observations. First, (7.30) suggests that the noise current of a MOS transistor decreases if the
transconductance drops. For example, if the transistor operates as a constant current source, it is desirable to minimize
its transconductance.
Second, the noise measured at the output of the circuit does not depend on where the input terminal is because
for output noise calculation, the input is set to zero.9 For example, the circuit of Fig. 7.20 may be a common-source
or a common-gate stage, exhibiting the same output noise.
Third, the output resistance, rO, does not produce noise because it is not a physical resistor.
▲
The ohmic sections of a MOSFET also contribute thermal noise. As conceptually illustrated in the top
view of Fig. 7.21(a), the gate, source, and drain materials exhibit ﬁnite resistivity, thereby introducing
noise. For a relatively wide transistor, the source and drain resistance is typically negligible whereas the
gate distributed resistance may become noticeable.
9Of course, if the input voltage or current source has an output impedance that generates noise, this statement must be interpreted
carefully.

232
Chap. 7
Noise
G
RD
RS
V2n,RD
V2n,RS
V2n,R1
R
RG1
RG2
RGn
D
S
S
D
G
(c)
(a)
(b)
RG1 + RG2
+ RGn = RG
1
Polysilicon
Figure 7.21
(a) Layout of a MOSFET indicating the terminal resistances; (b) circuit model; (c) distributed gate
resistance.
Nanometer Design Notes
The small dimensions of nanometer de-
vices lead to considerable ﬂicker noise.
Plotted
below
are
the
gate-referred
noise spectra for PMOS and NMOS
devices with W/L = 5 μm/40 nm and
I D = 250 μA. We observe that PMOS
devices exhibit less noise, and the
NMOS ﬂicker noise corner is as high
as several hundred megahertz. For low
ﬂicker noise, therefore, the transistor
areas must be increased substantially.
107
108
109
1
2
3
4
5
6
7
Frequency (Hz)
Noise Voltage (nV/Hz1/2)
NMOS
PMOS
In the noise model of Fig. 7.21(b), a lumped resistor R1 represents the
distributed gate resistance. Viewing the overall transistor as the distributed
structure shown in Fig. 7.21(c), we observe that the unit transistors near the
left end see the noise of only a fraction of RG whereas those near the right
end see the noise of most of RG. We therefore expect the lumped resistor in
the noise model to be less than RG. In fact, it can be proved that R1 = RG/3
(Problem 7.3) [3], and hence the noise generated by the gate resistance is given
by V 2
nRG = 4kT RG/3.
While the thermal noise generated in the channel is controlled by only
the transconductance of the device, the effect of RG can be reduced by proper
layout.ShowninFig.7.22aretwoexamples.InFig.7.22(a),thetwoendsofthe
gate are shorted by a metal line, thus reducing the distributed resistance from
RG to RG/4 (why?). Alternatively, the transistor can be folded as described
in Chapter 19 [Fig. 7.22(b)] so that each gate “ﬁnger” exhibits a resistance
of RG/2, yielding a total distributed resistance of RG/4 for the composite
transistor.
(a)
(b)
Metal
S
D
S
W
W
2
Figure 7.22
Reduction of gate resistance by (a) adding contacts to both sides or (b) folding.

Sec. 7.2
Types of Noise
233
▲
Example7.6
A transistor of width W is laid out with one gate ﬁnger and exhibits a total gate resistance of RG [Fig. 7.23(a)]. Now,
we reconﬁgure the device into four equal gate ﬁngers [Fig. 7.23(b)]. Determine the total gate resistance thermal noise
spectrum of the new structure.
W
W
4
(a)
(b)
Figure 7.23
Solution
With a width of W/4, each gate ﬁnger now has a distributed resistance of RG/4 and hence a lumped-model resistance
of RG/12. Since the four ﬁngers are in parallel, the net resistance is given by RG/48, yielding a noise spectrum of
V 2
nRG = 4kT RG
48
(7.31)
(In general, if the gate is decomposed into N parallel ﬁngers, the distributed resistance falls by a factor of N2.)
▲
▲
Example7.7
Find the maximum thermal noise voltage that the gate resistance of a single MOSFET can generate. Neglect the
device capacitances.
Solution
If the total distributed gate resistance is RG, then from Fig. 7.24, the output noise voltage due to RG is given by
V 2n,out = 4kT RG
3 (gmrO)2
(7.32)
An important observation here is that, for the gate resistance noise to be negligible, we must ensure that (7.32) is
much less than (7.30), and thus
RG
3
≪γ
gm
(7.33)
The number of gate ﬁngers is chosen large enough to guarantee this condition.
I1
VDD
M1
3
V2n,RG =  4kT
RG
3
RG
V2n,out
Figure 7.24
▲

234
Chap. 7
Noise
7.2.2 Flicker Noise
The interface between the gate oxide and the silicon substrate in a MOSFET entails an interesting
phenomenon. Since the silicon crystal reaches an end at this interface, many “dangling” bonds appear,
giving rise to extra energy states (Fig. 7.25). As charge carriers move at the interface, some are randomly
trapped and later released by such energy states, introducing “ﬂicker” noise in the drain current. In
addition to trapping, several other mechanisms are believed to generate ﬂicker noise [4].
Polysilicon
Dangling
Bonds
Silicon
Crystal
SiO2
Figure 7.25
Dangling bonds at the
oxide-silicon interface.
Unlike thermal noise, the average power of ﬂicker noise cannot be predicted easily. Depending on the
“cleanness” of the oxide-silicon interface, ﬂicker noise may assume considerably different values and as
such varies from one CMOS technology to another. The ﬂicker noise is more easily modeled as a voltage
source in series with the gate and, in the saturation region, roughly given by
V 2n =
K
CoxW L · 1
f
(7.34)
where K is a process-dependent constant on the order of 10−25 V2F. Note that our notation assumes a
bandwidth of 1 Hz. Interestingly, as shown in Fig. 7.26, the noise spectral density is inversely proportional
to the frequency. For example, the trap-and-release phenomenon associated with the dangling bonds
occurs more often at low frequencies. For this reason, ﬂicker noise is also called 1/f noise. Note that
(7.34) does not depend on the bias current or the temperature. This is only an approximation; in reality,
the ﬂicker noise equation is somewhat more complex [3].
log f
10log V2n
Figure 7.26
Flicker noise spectrum.
The inverse dependence of (7.34) on W L suggests that to reduce 1/f noise, the device area must be
increased. It is therefore not surprising to see devices having areas of several hundred square microns in
low-noise applications. (More fundamentally, the noise power trades with the gate capacitance, W LCox.)
Generally, PMOS devices exhibit less 1/f noise than NMOS transistors because the former carry the
holes in a “buried channel,” i.e., at some distance from the oxide-silicon interface, and hence trap and
release the carriers to a lesser extent.
▲
Example7.8
For an NMOS current source, calculate the total thermal and 1/f noise in the drain current for a band from 1 kHz
to 1 MHz.

Sec. 7.2
Types of Noise
235
Solution
The thermal noise current per unit bandwidth is given by I 2
n,th = 4kT γ gm. Thus, the total thermal noise integrated
across the band of interest is
I 2
n,th,tot = 4kT γ gm(106 −103)
(7.35)
≈4kT γ gm × 106 A2
(7.36)
For 1/f noise, the drain noise current per unit bandwidth is obtained by multiplying the noise voltage at the gate
by the device transconductance:
I 2
n,1/f =
K
CoxW L · 1
f · g2
m
(7.37)
The total 1/f noise is then equal to
I 2
n,1/f,tot =
Kg2
m
CoxW L
 1 MHz
1 kHz
d f
f
(7.38)
=
Kg2
m
CoxW L ln 103
(7.39)
= 6.91Kg2
m
CoxW L
(7.40)
▲
The above example raises an interesting question. What happens to I 2
n,1/f,tot if the lower end of the
band, fL, is zero rather than 1 kHz? Equation (7.39) then yields an inﬁnite value for the total noise. To
overcome the fear of inﬁnite noise, we make two observations. First, extending fL to zero means that we
are interested in arbitrarily slow noise components. A noise component at 0.01 Hz varies signiﬁcantly
in roughly 10 s (one-tenth of the period) and one at 10−6 Hz in roughly one day. Second, the inﬁnite
ﬂicker noise power simply means that if we observe the circuit for a very long time, the very slow
noise components can randomly assume a very large power level. At such slow rates, noise becomes
indistinguishable from thermal drift or aging of devices.
The foregoing observations lead to the following conclusions. First, since the signals encountered in
most applications do not contain very-low-frequency components, our observation window need not be
very long. For example, voice signals display negligible energy below 20 Hz, and if a noise component
varies at a lower rate, it does not corrupt the voice signiﬁcantly. Second, the logarithmic dependence of
the ﬂicker noise power upon fL allows some margin for error in selecting fL. For example, if the integral
in Eq. (7.38) begins from 100 Hz rather than 1 kHz, the coefﬁcient in (7.40) rises from 6.91 to 9.21.
In order to quantify the signiﬁcance of 1/f noise with respect to thermal noise for a given device, we
plot both spectral densities on the same axes (Fig. 7.27). Called the 1/f noise “corner frequency,” the
f (log scale)
f
1
Thermal
fC
Corner
10log V2n
Figure 7.27
Concept of ﬂicker noise
corner frequency.

236
Chap. 7
Noise
intersection point serves as a measure of what part of the band is mostly corrupted by ﬂicker noise. In
the above example, the 1/f noise corner, fC, of the output current is determined as
4kT γ gm =
K
CoxW L · 1
fC
· g2
m
(7.41)
that is,
fC =
K
γ CoxW L gm
1
4kT
(7.42)
This result implies that fC generally depends on the device area and transconductance. Nonetheless, for
a given L, the dependence is weak and the 1/f noise corner is relatively constant, falling in the vicinity
of 10 MHz to 50 MHz for nanometer transistors.
▲
Example7.9
For a 100-μm/0.5-μm MOS device with gm = 1/(100 ), the 1/f noise corner frequency is measured to be 500 kHz.
If tox = 90 A
◦, what is the ﬂicker noise coefﬁcient, K, in this technology?
Solution
For tox = 90 A
◦, we have Cox = 3.84 fF/μm2. Using Eq. (7.42), we write
500 kHz =
K
3.84 × 100 × 0.5 × 10−15 ·
1
100 ·
3
8 × 1.38 × 10−23 × 300
(7.43)
That is, K = 1.06 × 10−25 V2F.
▲
It is important to bear in mind that typical transistor models include thermal and ﬂicker noise but not
the gate resistance noise. The latter must therefore be added to each transistor by the designer.
7.3
Representation of Noise in Circuits
Output Noise
Consider a general circuit with one input port and one output port (Fig. 7.28). How do
we quantify the effect of noise here? The natural approach would be to set the input to zero and calculate
the total noise at the output due to various sources of noise in the circuit. This is indeed how the noise is
measured in the laboratory or in simulations. Our analysis procedure in Section 7.1.5 methodically leads
to the output noise spectrum.
V2n1
I2n2
V2n3
Vin
Vout
Figure 7.28
Noise sources in a circuit.
▲
Example7.10
What is the total output noise voltage of the common-source stage shown in Fig. 7.29(a)? Assume that λ = 0.

Sec. 7.3
Representation of Noise in Circuits
237
ac
M1
RD
Vout
VDD
Vin
M1
RD
VDD
I2n1
V2n,out
I2nRD
(a)
(b)
Figure 7.29
(a) CS stage; (b) circuit including noise sources.
Solution
We must identify the sources of noise, ﬁnd their transfer functions to the output, multiply their spectra by the squared
magnitude of the transfer functions and add the results. We model the thermal and ﬂicker noise of M1 by two current
sources: I 2
n,th = 4kT γ gm and I 2
n,1/f = Kg2
m/(CoxW L f ). We also represent the thermal noise of RD by a current
source I 2
n,RD = 4kT/RD. Since these currents ﬂow through RD, the output noise voltage per unit bandwidth is
equal to
V 2n,out =

4kT γ gm +
K
CoxW L · 1
f · g2
m + 4kT
RD

R2
D
(7.44)
Note that the noise mechanisms are added as “power” quantities because they are uncorrelated. The value given by
(7.44) represents the noise power in 1 Hz at a frequency f . The total output noise is obtained by integration.
▲
Input-Referred Noise
While intuitively appealing, the output-referred noise does not allow a fair
comparison of the performance of different circuits because it depends on the gain. For example, as
depicted in Fig. 7.30, if a common-source stage is followed by a noiseless ampliﬁer having a voltage
gain A1, then the output noise is equal to the expression in (7.44) multiplied by A2
1. Considering only
the output noise, we may conclude that as A1 increases, the circuit becomes noisier, an incorrect result
because a larger A1 also provides a proportionally higher signal level at the output. That is, the output
signal-to-noise ratio does not depend on A1.
M1
RD
Vout
VDD
Vin
A1
Figure 7.30
Addition of gain stage to
a CS stage.
To overcome the above quandary, we usually specify the “input-referred noise” of circuits. Illustrated
conceptually in Fig. 7.31, the idea is to represent the effect of all noise sources in the circuit by a single
V2n,in
V2n1
V2n3
I2n2
Noisy Circuit
(a)
(b)
Noiseless Circuit
V2n,out
V2n,out
Figure 7.31
Determination of input-referred noise voltage.

238
Chap. 7
Noise
source, V 2
n,in, at the input such that the output noise in Fig. 7.31(b) equals that in Fig. 7.31(a). If the
voltage gain is Av, then we must have V 2n,out = A2
vV 2
n,in, that is, the input-referred noise voltage in this
simple case is given by the output noise voltage divided by the gain.
▲
Example7.11
For the circuit of Fig. 7.29, calculate the input-referred noise voltage.
Solution
We have
V 2
n,in = V 2n,out
A2v
(7.45)
=

4kT γ gm +
K
CoxW L · 1
f · g2
m + 4kT
RD

R2
D
1
g2m R2
D
(7.46)
= 4kT γ
gm
+
K
CoxW L · 1
f + 4kT
g2m RD
(7.47)
Note that the ﬁrst term in (7.47) can be viewed as the thermal noise of a resistor equal to γ/(gm) placed in series
with the gate. Similarly, the third term corresponds to the noise of a resistor equal to (g2
m RD)−1. We sometimes say
the “equivalent thermal noise resistance” of a circuit is equal to RT , meaning that the total input-referred thermal
noise of the circuit in unit bandwidth is equal to 4kT RT .
Why does V 2
n,in decrease as RD increases? This is because the noise voltage due to RD at the output is proportional
to √RD while the voltage gain of the circuit is proportional to RD.
▲
At this point of our study, we make two observations. First, the input-referred noise and the input
signal are both multiplied by the gain as they are processed by the circuit. Thus, the input-referred noise
indicates how much the input signal is corrupted by the circuit’s noise, i.e., how small an input the circuit
can detect with acceptable SNR. For this reason, input-referred noise allows a fair comparison of different
circuits. Second, the input-referred noise is a ﬁctitious quantity in that it cannot be measured at the input
of the circuit. The two circuits of Figs. 7.31(a) and (b) are mathematically equivalent but the physical
circuit is still that in Fig. 7.31(a).
In the foregoing discussion, we have assumed that the input-referred noise can be modeled by a single
voltage source in series with the input. This is generally an incomplete representation if the circuit has a
ﬁnite input impedance and is driven by a ﬁnite source impedance. To understand why, let us ﬁrst return
to the CS stage of Fig. 7.29 and observe that the output thermal noise due to M1 is equal to (4kT γ gm)R2
D
regardless of the network driving the gate (i.e., regardless of the preceding stage). Upon dividing this noise
by (gm RD)2, we obtain an input-referred noise voltage of 4kTγ/gm—also independent of the preceding
stage.
Now, consider the common-source stage of Fig. 7.32(a), where the input capacitance is denoted by
Cin. The input-referred noise voltage due to M1 is still given by 4kT γ/gm. Suppose the preceding stage
is modeled by a Thevenin equivalent having an output impedance of R1 [Fig. 7.32(b)]. Simplifying the
circuit for noise calculations as shown in Fig. 7.32(c), we seek the output noise due to M1, hoping to
obtain 4kT γ gm R2
D. Owing to the voltage division between R1 and 1/(Cins), the output noise emerges as
V 2n,out = V 2
n,in

1
R1Cin jω + 1

2
(gm RD)2
(7.48)
= 4kT γ gm R2
D
R2
1C2
inω2 + 1
(7.49)
This result is incorrect; after all, the output noise due to M1 must not diminish as R1 increases.

Sec. 7.3
Representation of Noise in Circuits
239
M1
RD
Vout
VDD
(a)
Cin
M1
RD
Vout
VDD
Cin
Vin
(b)
M1
RD
Vout
VDD
V2n,in
V2n,in
V2n,in
Cin
(c)
R1
Preceding
Stage
R1
Figure 7.32
CS stage including input capacitance; (b) CS stage stimulated by a ﬁnite source impedance;
(c) effect of single noise source.
Let us summarize the problem. If the circuit has a ﬁnite input impedance, modeling the input-referred
noise by merely a voltage source implies that the output noise vanishes as the source impedance becomes
large, an incorrect conclusion. To resolve this issue, we model the input-referred noise by both a series
voltage source and a parallel current source (Fig. 7.33) so that if the output impedance of the preceding
stage assumes large values—thereby reducing the effect of V 2
n,in—the noise current source still ﬂows
through a ﬁnite impedance, producing noise at the input. It can be proved that V 2
n,in and I 2
n,in are necessary
and sufﬁcient to represent the noise of any linear two-port circuit [5].
Noiseless
Circuit
I2n,in
V2n,in
Figure 7.33
Representation of noise
by voltage and current sources.
How do we calculate V 2
n,in and I 2
n,in? Since the model is valid for any source impedance, we consider
two extreme cases: zero and inﬁnite source impedances. As shown in Fig. 7.34(a), if the source impedance
is zero, I 2
n,in ﬂows through V 2
n,in and has no effect on the output. Thus, the output noise measured in this
case arises solely from V 2
n,in. Similarly, if the input is open [Fig. 7.34(b)], then V 2
n,in has no effect and the
output noise is due to only I 2
n,in. Let us apply this method to the circuit of Fig. 7.32.
Noisy
Circuit
Noiseless
Circuit
Noisy
Circuit
Noiseless
Circuit
(a)
(b)
I2n,in
V2n,in
V2n, in
I2n,in
V2n1,out
V2n1,out
V2n2, out
V2n2,out
Figure 7.34
Calculation of input-referred noise (a) voltage and (b) current.
▲
Example7.12
Calculate the input-referred noise voltage and current of Fig. 7.32, including only the thermal noise of M1 and RD.

240
Chap. 7
Noise
Solution
From (7.47), the input-referred noise voltage is simply
V 2
n,in = 4kT γ
gm
+ 4kT
g2m RD
(7.50)
As depicted in Fig. 7.35(a), this voltage generates the same output noise as the actual circuit if the input is shorted.
M1
RD
VDD
Cin
(a)
(b)
M1
RD
VDD
Cin
Input
Shorted
Input
Open
V2n,in
I2n,in
V2n2,out
V2n1,out
Figure 7.35
Toobtaintheinput-referrednoisecurrent,weopentheinputandﬁndtheoutputnoiseintermsof I 2
n,in [Fig.7.35(b)].
The noise current ﬂows through Cin, generating at the output
V 2
n2,out = I 2
n,in

1
Cinω
2
g2
m R2
D
(7.51)
According to Fig. 7.34(b), this value must be equal to the output of the noisy circuit when its input is open:
V 2
n2,out =

4kT γ gm + 4kT
RD

R2
D
(7.52)
From (7.51) and (7.52), it follows that
I 2
n,in = (Cinω)2 4kT
g2m

γ gm +
1
RD

(7.53)
▲
As mentioned earlier, the input noise current, In,in, becomes signiﬁcant if the circuit’s input impedance,
Zin, is not very high. To see whether In,in can be neglected or not, we consider the scenario depicted in
Fig. 7.36, where ZS denotes the output impedance of the preceding circuit. The total noise voltage sensed
by the second stage at node X is equal to
Vn,X =
Zin
Zin + ZS
Vn,in +
Zin ZS
Zin + ZS
In,in
(7.54)
Zin
ZS
X
V2n,in
I2n,in
Figure 7.36
Effect of input noise
current.

Sec. 7.3
Representation of Noise in Circuits
241
If I 2
n,in|ZS|2 ≪V 2
n,in, then the effect of In,in is negligible. In other words, ultimately, it is the output
impedance of the preceding stage—rather than Zin—that determines the signiﬁcance of In,in. We conclude
that the input-referred noise current can be neglected if
|ZS|2 ≪V 2
n,in
I 2
n,in
(7.55)
A difﬁculty in the use of input-referred noise voltages and currents is that they may be correlated.
After all, Vn,in and In,in may contain effects from the same noise source. For example, in Fig. 7.35, if the
noise voltage of RD is increasing at some point in time, then both Vn,in and In,in also inherit this increase.
For this reason, noise calculations must revert to Eq. (7.11) and include the correlation between the two.
Methods of avoiding this correlation are described in Appendix A.
The reader may wonder if the use of both a voltage source and a current source to represent the
input-referred noise “counts the noise twice.” We consider the environment depicted in Fig. 7.37 as
an example and prove that the output noise is correct for any source impedance, ZS. Assuming ZS is
noiseless for simplicity, we ﬁrst calculate the total noise voltage at the gate of M1 due to V 2
n,in and
I 2
n,in. This voltage cannot be obtained by superposition of powers because V 2
n,in and I 2
n,in are correlated.
Nonetheless, superposition still applies to voltages and currents because the circuit is linear and time-
invariant. Equations (7.50) and (7.53) must be respectively rewritten as
Vn,in = Vn,M1 +
1
gm RD
Vn,RD
(7.56)
In,in = CinsVn,M1 + Cins
gm RD
Vn,RD
(7.57)
M1
RD
VDD
Cin
I2n,in
ZS
X
V2n,in
V2n,out
Figure 7.37
CS stage driven by a
source impedance.
where Vn,M1 denotes the gate-referred noise voltage of M1 and Vn,RD the noise voltage of RD. We
recognize that Vn,M1 and Vn,RD appear in both Vn,in and In,in, creating a strong correlation between the
two. Thus, the calculations must use superposition of voltages—as if Vn,in and In,in were deterministic
quantities.
Adding the contributions of Vn,in and In,in at node X in Fig. 7.37, we have
Vn,X = Vn,in
1
Cins
1
Cins + ZS
+ In,in
ZS
Cins
1
Cins + ZS
(7.58)
= Vn,in + In,in ZS
ZSCins + 1
(7.59)

242
Chap. 7
Noise
Substituting for Vn,in and In,in from (7.56) and (7.57), respectively, we obtain
Vn,X =
1
ZSCins + 1

Vn,M1 +
1
gm RD
Vn,RD + CinsZS(Vn,M1 +
1
gm RD
Vn,RD)

= Vn,M1 +
1
gm RD
Vn,RD
(7.60)
Note that Vn,X is independent of ZS and Cin. It follows that
V 2n,out = g2
m R2
DV 2
n,X
(7.61)
= 4kT

γ gm + 1
RD

R2
D
(7.62)
the same as (7.52). Thus, Vn,in and In,in do not “double count” the noise.
Another Approach
In some cases, it is simpler to consider the output short-circuit noise current—
rather than the output open-circuit noise voltage—for these calculations. This current is then multiplied
by the circuit’s output resistance to yield the output noise voltage or simply divided by a proper gain to
give the input-referred quantities. The following example illustrates this approach.
▲
Example7.13
Determine the input-referred noise voltage and current for the ampliﬁer shown in Fig. 7.38(a). Assume that I1 is
noiseless and λ = 0.
I1
VDD
M1
Vout
RF
Vin
M1
RF
I2n,RF
I2n,M1
I2n,M1
I2n1,out
I2n2,out
M1
RF
Iout
M1
RF
V2n,RF
M1
RF
Iout
Iin
(a)
(b)
(c)
(e)
(d)
Vin
Figure 7.38
Solution
To compute the input-referred noise voltage, we must short the input port. In this case, we can also short the output
port as shown in Fig. 7.38(b), and ﬁnd the output noise current due to RF and M1. Since both terminals of RF are
at ac ground, a KVL yields
I 2
n1,out = 4kT
RF
+ 4kT γ gm
(7.63)

Sec. 7.4
Noise in Single-Stage Ampliﬁers
243
The output impedance of the circuit with the input shorted is simply equal to RF, yielding
V 2
n1,out =

4kT
RF
+ 4kT γ gm

R2
F
(7.64)
We can calculate the input-referred noise voltage by dividing (7.64) by the voltage gain or by dividing (7.63) by the
transconductance, Gm. Let us pursue the latter method. As depicted in Fig. 7.38(c),
Gm = Iout
Vin
(7.65)
= gm −1
RF
(7.66)
Dividing (7.63) by G2
m gives
V 2
n,in =
4kT
RF
+ 4kT γ gm
(gm −1
RF
)2
(7.67)
Fortheinput-referrednoisecurrent,weﬁrstcomputetheoutputnoisecurrentwiththeinputleftopen[Fig.7.38(d)].
Since Vn,RF directly modulates the gate-source voltage of M1, producing a drain current of 4kT RFg2
m, we have
I 2
n2,out = 4kT RFg2
m + 4kT γ gm
(7.68)
Next, we must determine the current gain of the circuit according to the arrangement shown in Fig. 7.38(c). Noting
that VGS = Iin RF, and hence ID = gm Iin RF, we obtain
Iout = gm RF Iin −Iin
(7.69)
= (gm RF −1)Iin
(7.70)
Dividing (7.68) by the square of the current gain yields
I 2
n,in = 4kT RFg2
m + 4kT γ gm
(gm RF −1)2
(7.71)
The reader is encouraged to repeat this analysis using the output noise voltage rather than the output noise current.
The above circuit exempliﬁes cases where the output noise voltage is not the same for short-circuit and open-circuit
input ports. The reader can prove that, if the input is left open, then
V 2
n2,out = 4kT γ
gm
+ 4kT RF
(7.72)
▲
7.4
Noise in Single-Stage Ampliﬁers
Having developed basic mathematical tools and models for noise analysis, we now study the noise
performance of single-stage ampliﬁers at low frequencies. Before considering speciﬁc topologies, we
describe a lemma that simpliﬁes noise calculations.
Lemma
The circuits shown in Fig. 7.39(a) and (b) are equivalent at low frequencies if V 2n = I 2n /g2
m
and the circuits are driven by a ﬁnite impedance.

244
Chap. 7
Noise
M1
ZL
ZS
VDD
In2
I2n
I2n,out1
In2,out2
V2n,out
V2n,out
V2n
V2n
M1
ZL
ZS
VDD
M1
ZS
M1
ZS
(c)
(a)
(b)
(d)
Figure 7.39
Equivalent CS stages.
Proof
Since the circuits have equal output impedances, we simply examine the output short-circuit
currents [Figs. 7.39(c) and (d)]. It can be proved (Problem 7.4) that the output noise current of the circuit
in Fig. 7.39(c) is given by
In,out1 =
In
ZS(gm + gmb + 1/rO) + 1
(7.73)
and that of Fig. 7.39(d) is
In,out2 =
gmVn
ZS(gm + gmb + 1/rO) + 1
(7.74)
Equating (7.73) and (7.74), we have Vn = In/gm. We call Vn the “gate-referred” noise of M1.
This lemma suggests that the noise source can be transformed from a drain-source current to a gate
series voltage for arbitrary ZS. We repeat this analysis in the presence of the gate-source capacitance in
Problem 7.29.
▲
Example7.14
Prove the above lemma using Thevenin equivalents.
Solution
We construct a Thevenin model for the circuits in Figs. 7.39(a) and (b) but exclude ZL, as depicted in Figs. 7.40(a)
and (b). With In = 0 and Vn = 0, the two topologies are identical, and hence ZThev1 = ZThev2. We thus need only
ﬁnd the condition under which VThev1 = VThev2.
ToobtaintheTheveninvoltages,wemustreplace ZL withanopencircuit[Fig.7.40(c)].10 Sincethecurrentﬂowing
through ZS is zero in both circuits, we have VThev1 = InrO and VThev2 = gmVnrO. It follows that Vn = In/gm.
▲
7.4.1 Common-Source Stage
From Example 7.11, the input-referred noise voltage per unit bandwidth of a simple CS stage is
equal to
V 2
n,in = 4kT
 γ
gm
+
1
g2m RD

+
K
CoxW L
1
f
(7.75)
10The Thevenin voltage is calculated by disconnecting the port of interest from external loads.

Sec. 7.4
Noise in Single-Stage Ampliﬁers
245
M1
ZL
ZS
I2n
I2n
VThev1
ZThev1
ZL
ZL
ZS
Vn2
Vn2
VThev2
ZThev2
ZL
M1
ZS
VThev1
M1
ZS
VThev2
M1
(a)
(b)
(c)
Figure 7.40
Vin
M1
Vout
M1
Vb
I0
(a)
(b)
Figure 7.41
Voltage ampliﬁcation
versus current generation.
From the above lemma, we recognize that the term 4kT γ/gm is in fact the thermal noise current of M1
expressed as a voltage in series with the gate.
How can we reduce the input-referred noise voltage? Equation (7.75) implies that the transconductance
of M1 must be maximized. Thus, the transconductance must be maximized if the transistor is to amplify
a voltage signal applied to its gate [Fig. 7.41(a)] whereas it must be minimized if the transistor operates
as a constant current source [Fig. 7.41(b)], as illustrated by the following example.
▲
Example7.15
Calculate the input-referred thermal noise voltage of the ampliﬁer shown in Fig. 7.42(a), assuming both transistors
are in saturation. Also, determine the total output thermal noise if the circuit drives a load capacitance CL. What is
the output signal-to-noise ratio if a low-frequency sinusoid of peak amplitude Vm is applied to the input?
Solution
Representing the thermal noise of M1 and M2 by current sources [Fig. 7.42(b)] and noting that they are uncorrelated,
we write
V 2n,out = 4kT (γ gm1 + γ gm2)(rO1∥rO2)2
(7.76)

246
Chap. 7
Noise
M1
Vout
VDD
Vin
Vb
M2
M1
VDD
Vin
Vb
M2
I2n2
I2n1
rO1 rO2
V2n,out
(a)
(b)
Figure 7.42
(In reality, γ may not be the same for NMOS and PMOS devices.) Since the voltage gain is equal to gm1(rO1∥rO2),
the total noise voltage referred to the gate of M1 is
V 2
n,in = 4kT (γ gm1 + γ gm2) 1
g2
m1
(7.77)
= 4kT γ

1
gm1
+ gm2
g2
m1

(7.78)
Equation (7.78) reveals the dependence of V 2
n,in upon gm1 and gm2, conﬁrming that gm2 must be minimized because
M2 serves as a current source rather than a transconductor.11
The reader may wonder why M1 and M2 in Fig. 7.42 exhibit different noise effects. After all, if the noise currents
of both transistors ﬂow through rO1∥rO2, why should gm1 be maximized and gm2 minimized? This is simply because,
as gm1 increases, the output noise voltage rises in proportion to √gm1 whereas the voltage gain of the stage increases
in proportion to gm1. As a result, the input-referred noise voltage decreases. Such a trend does not apply to M2.
To compute the total output noise, we integrate (7.76) across the band:
V 2n,out,tot =
 ∞
0
4kT γ (gm1 + gm2)(rO1∥rO2)2
d f
1 + (rO1∥rO2)2C2
L(2π f )2
(7.79)
Using the results of Example 7.3, we have
V 2n,out,tot = γ (gm1 + gm2)(rO1∥rO2) kT
CL
(7.80)
A low-frequency input sinusoid of amplitude Vm yields an output amplitude equal to gm1(rO1∥rO2)Vm. The output
SNR is equal to the ratio of the signal power and the noise power:
SNRout =

gm1(rO1∥rO2)Vm
√
2
2
·
1
γ (gm1 + gm2)(rO1∥rO2)(kT/CL)
(7.81)
=
CL
2γ kT · g2
m1(rO1∥rO2)
gm1 + gm2
V 2
m
(7.82)
We note that to maximize the output SNR, CL must be maximized, i.e., the bandwidth must be minimized. Of course,
the bandwidth is also dictated by the input signal spectrum. This example indicates that it becomes exceedingly
difﬁcult to design broadband circuits while maintaining low noise.
▲
11A device or a circuit that converts a voltage to a current is called a transconductor or a V/I converter.

Sec. 7.4
Noise in Single-Stage Ampliﬁers
247
▲
Example7.16
Determine the input-referred thermal noise voltage of the complementary common-source stage shown in Fig. 7.43.
M1
VDD
M2
Vout
Vin
Figure 7.43
Solution
With the input signal set to zero, this circuit produces the same output noise voltage as the circuit in Fig. 7.42(a)
does. But the complementary stage provides a higher voltage gain, (gm1 + gm2)(rO1||rO2). The input-referred noise
voltage is thus given by
V 2
n,in =
4kT γ
gm1 + gm2
(7.83)
an expected result because M1 and M2 operate in “parallel,” and hence their transconductances add. Why does this
topology exhibit a lower input noise than the circuit of Fig. 7.42(a)? In both cases, M2 injects noise to the output
node, but in the complementary stage, this device operates as a transconductor and ampliﬁes the input.
▲
For a simple CS stage with resistive load, Eq. (7.75) suggests that the thermal noise can be reduced
by increasing the bias current. But, for a given headroom, this requires that we decrease RD and hence
increase its noise contribution. In order to quantify this trade-off, we express gm as 2ID/(VGS −VT H)
and write the input-referred thermal noise as
V 2
n,in = 4kT
γ (VGS −VT H)
2ID
+ (VGS −VT H)2
4ID · ID RD

(7.84)
This equation suggests that Vn,in falls if ID is increased and ID RD kept constant provided that VGS −VT H
also remains constant, i.e., if the transistor width increases in proportion to ID.
▲
Example7.17
Calculate the input-referred 1/f and thermal noise voltage of the CS stage depicted in Fig. 7.44(a), assuming M1
and M2 are in saturation.
M1
Vout
VDD
Vin
Vb
M2
I2n,R1
V2n,out
(a)
(b)
RD
M1
VDD
M2
RD
V2n2
V2n1
Figure 7.44

248
Chap. 7
Noise
Solution
We model the 1/f and thermal noise of the transistors as voltage sources in series with their gates [Fig. 7.44(b)].
The noise voltage at the gate of M2 experiences a gain of gm2(RD∥rO1∥rO2) as it appears at the output. The result
must then be divided by gm1(RD∥rO1∥rO2) to be referred to the main input. The noise current of RD is multiplied
by RD∥rO1∥rO2 and divided by gm1(RD∥rO1∥rO2). Thus, the overall input-referred noise voltage is given by
V 2
n,in = 4kT γ

gm2
g2
m1
+
1
gm1

+
1
Cox

K Pg2
m2
(W L)2g2
m1
+
KN
(W L)1

1
f +
4kT
g2
m1RD
(7.85)
where K P and KN denote the ﬂicker noise coefﬁcients of PMOS and NMOS devices, respectively. Note that the
circuit reduces to that in Fig. 7.42(a) or 7.29(a) if RD = ∞or gm2 = 0, respectively. How should the bias
current of M2 be chosen to minimize Vn,in if the dc voltage drop across RD is ﬁxed? This is left as an exercise for
the reader.
▲
How do we design a common-source stage for low-noise operation? For thermal noise in the simple
topology of Fig. 7.41, we must maximize gm1 by increasing the drain current or the device width. A
higher ID translates to greater power dissipation and limited output voltage swings while a wider device
leads to larger input and output capacitance. We can also increase RD, but at the cost of limiting the
voltage headroom and lowering the speed.
For 1/f noise, the primary approach is to increase the area of the transistor. If W L is increased while
W/L remains constant, then the device transconductance, and hence its thermal noise, do not change,
but the device capacitances increase. These observations point to the trade-offs between noise, power
dissipation, voltage headroom, and speed.
▲
Example7.18
A student writes the drain ﬂicker noise current of a MOS device as [K/(WLCox f )]g2
m = [K/(WLCox f )]
(√2μnCox(W/L)ID)2 = 2Kμn ID/(L2 f ), concluding that the ﬂicker noise current is independent of W. Explain
the ﬂaw in this argument.
Solution
A fair comparison must keep both the overdrive and ID constant as W changes. (If we allow VGS −VT H to
change, then the drain voltage headroom also changes.). Thus, we can express the drain ﬂicker noise current as
[K/(WLCox f )](4I 2
D)/(VGS −VT H)2, which reveals that the noise current decreases as W L increases.
▲
▲
Example7.19
Design a resistively-loaded common-source stage with a total input-referred noise voltage of 100 μVrms, a power
budget of 1 mW, a bandwidth of 1 GHz, and a supply voltage of 1 V. Neglect channel-length modulation and ﬂicker
noise and assume that the bandwidth is limited by the load capacitance.
Solution
Illustrated in Fig. 7.45(a), the circuit produces noise at the output in a bandwidth given by RD and CL. From the
noise model shown in Fig. 7.45(b), the reader can derive a Thevenin equivalent for the circuit in the dashed box,
obtaining the output noise spectrum as
V 2n,out = (V 2
n,RD + R2
D I 2
n,M1)
1
R2
DC2
Lω2 + 1
(7.86)
= (4kT RD + 4kT γ gm R2
D)
1
R2
DC2
Lω2 + 1
(7.87)

Sec. 7.4
Noise in Single-Stage Ampliﬁers
249
M1
RD
VDD
Vin
Vout
CL
V2n,RD
RD
I2n,M1
CL
V2n,out
(a)
(b)
Figure 7.45
Since we know that the integral of 4kT RD/(R2
DC2
Lω2 + 1) from 0 to ∞yields a value of kT/CL, we manipulate
the transistor noise contribution as follows:
V 2n,out =
4kT RD
R2
DC2
Lω2 + 1 + γ gm RD
4kT RD
R2
DC2
Lω2 + 1
(7.88)
Integration from 0 to ∞thus gives
V 2n,out,tot = kT
CL
+ γ gm RD
kT
CL
(7.89)
= (1 + γ gm RD) kT
CL
(7.90)
This noise must be divided by g2
m R2
D and equated to (100 μVrms)2. We also note that 1/(2π RDCL) = 1 GHz and
kT = 4.14 × 10−21 J at the room temperature, arriving at
1 + γ gm RD
g2m RD
·
2πkT
2π RDCL
= (100 μVrms)2
(7.91)
and hence
1
gm

1
gm RD
+ γ

= 384 
(7.92)
We have some ﬂexibility in the choice of gm and RD here. For example, if gm RD = 3 and γ = 1, then 1/gm = 288 
and RD = 864 . With a drain-current budget of 1 mW/VDD = 1 mA, we can choose W/L so as to obtain this
amount of transconductance.
The above choice of the voltage gain and the resulting values of RD and gm must be checked against the bias
conditions. Since RD ID = 864 mV, VDS,min = 136 mV, leaving little headroom for voltage swings. The reader is
encouraged to try gm RD = 2 or 4 to see how the voltage headroom depends on the choice of the gain.
▲
7.4.2 Common-Gate Stage
Thermal Noise
Consider the common-gate conﬁguration shown in Fig. 7.46(a). Neglecting channel-
length modulation, we represent the thermal noise of M1 and RD by two current sources [Fig. 7.46(b)].
Note that, owing to the low input impedance of the circuit, the input-referred noise current is not negligible
even at low frequencies. To calculate the input-referred noise voltage, we short the input to ground and
equate the output noises of the circuits in Figs. 7.47(a) and (b):

4kT γ gm + 4kT
RD

R2
D = V 2
n,in(gm + gmb)2R2
D
(7.93)

250
Chap. 7
Noise
RD
Vb
VDD
M1
Vout
(a)
(b)
I2nRD
RD
Vb
VDD
M1
I2n1
V2n,out
Vin
Figure 7.46
(a) CG stage; (b) circuit including noise sources.
RD
Vb
VDD
M1
Open
RD
Vb
VDD
M1
In2,in
In2RD
In21
In2RD
In21
RD
Vb
VDD
M1
Vn21,out
Vn21,out
V2n2,out
V2n2,out
Vn2, in
RD
Vb
VDD
M1
(c)
(a)
(b)
(d)
Figure 7.47
Calculation of input-referred noise of a CG stage.
That is
V 2
n,in = 4kT (γ gm + 1/RD)
(gm + gmb)2
(7.94)
Similarly, equating the output noises of the circuits in Figs. 7.47(c) and (d) yields the input-referred noise
current. What is the effect of I 2
n1 at the output in Fig. 7.47(c)? Since the sum of the currents at the source
of M1 is zero, In1 + ID1 = 0. Consequently, In1 creates an equal and opposite current in M1, producing
no noise at the output. The output noise voltage of Fig. 7.46(a) is therefore equal to 4kTRD, and hence
I 2
n,in R2
D = 4kTRD. That is
I 2
n,in = 4kT
RD
(7.95)
Animportantdrawbackofthecommon-gatetopologyisthatitdirectlyrefersthenoisecurrentproduced
by the load to the input. Exempliﬁed by (7.95), this effect arises because such a circuit provides no current
gain, a point of contrast to common-source ampliﬁers.
We have thus far neglected the noise contributed by the bias-current source of a common-gate stage.
Shown in Fig. 7.48 is a simple mirror arrangement establishing the bias current of M1 as a multiple of I1.
Capacitor C0 shunts the noise generated by M0 to ground. We note that if the input of the circuit is shorted
to ground, then the drain noise current of M2 does not ﬂow through RD, contributing no input-referred
noise voltage. On the other hand, if the input is open, all of I 2
n2 ﬂows from M1 and RD (at low frequencies),
producing an output noise equal to I 2
n2R2
D and hence an input-referred noise current of I 2
n2. As a result,
the noise current of M2 directly adds to the input-referred noise current, making it desirable to minimize

Sec. 7.4
Noise in Single-Stage Ampliﬁers
251
RD
Vout
Vb
VDD
M1
M2
In22
I1
M0
C0
Vin
Figure 7.48
Noise contributed by
bias-current source.
the transconductance of M2. For a given bias current, however, this translates to a higher drain-source
voltage for M2 because gm2 = 2ID2/(VGS2−VT H2), requiring a high value for Vb and limiting the voltage
swing at the output node.
▲
Example7.20
Calculate the input-referred thermal noise voltage and current of the circuit shown in Fig. 7.49 assuming that all of
the transistors are in saturation.
I2
Vout
Vb
VDD
M1
M2
In22
I1
M0
M3
M4
Vin
Figure 7.49
Solution
To compute the input-referred noise voltage, we short the input to ground, obtaining
V 2
n1,out = 4kT γ (gm1 + gm3)(rO1∥rO3)2
(7.96)
Thus, the input-referred noise voltage, Vn,in, must satisfy this relationship:
V 2
n,in(gm1 + gmb1)2(rO1∥rO3)2 = 4kT γ (gm1 + gm3)(rO1∥rO3)2
(7.97)
where the voltage gain from Vin to Vout is approximated by (gm1 + gmb1)(rO1||rO3). It follows that
V 2
n,in = 4kT γ (gm1 + gm3)
(gm1 + gmb1)2
(7.98)
As expected, the noise is proportional to gm3.
To calculate the input-referred noise current, we open the input and note that the output noise voltage due to M3
is simply given by I 2
n3R2
out, where Rout = rO3||[rO2 + (gm1 + gmb1)rO1rO2 + rO1] denotes the output impedance

252
Chap. 7
Noise
when the input is open. The reader can prove that, in response to an input current Iin, the circuit generates an output
voltage given by
Vout =
(gm1 + gmb1)rO1 + 1
rO1 + (gm1 + gmb1)rO1rO2 + rO2 + rO3
rO3rO2Iin
(7.99)
Dividing In3Rout by this gain to refer the noise of M3 to the input, we have
In,in|M3 = rO2 + (gm1 + gmb1)rO1rO2 + rO1
rO2[(gm1 + gmb1)rO1 + 1]
In3
(7.100)
which reduces to
In,in|M3 ≈In3
(7.101)
≈4kT γ gm3
(7.102)
if any gmrO product is much greater than unity. Since the noise current of M2 directly adds to the input, we have
I 2
n,in = 4kT γ (gm2 + gm3)
(7.103)
Again, the noise is proportional to the transconductance of the two current sources. In the above calculations, we
have neglected the effect of In1 when the input is left open even though the source of M1 sees a ﬁnite degeneration
(rO2). In Problem 7.31, we refer this noise to the input and prove that it is still negligible.
▲
Flicker Noise
The effect of 1/f noise in a common-gate topology is also of interest. As a typical case,
we compute the input-referred 1/f noise voltage and current of the circuit shown in Fig. 7.49. Illustrated
in Fig. 7.50, each 1/f noise generator is modeled by a voltage source in series with the gate of the
corresponding transistor. Note that the 1/f noise of M0 and M4 is neglected. A more realistic case is
studied in Problem 7.10.
VDD
M1
M3
V2n,out
V2n1
V2n2
V2n3
M2
Vin
Figure 7.50
Flicker noise in a CG
stage.
With the input shorted to ground, we have
V 2
n1,out =
1
Cox f
g2
m1KN
(W L)1
+ g2
m3K P
(W L)3

(rO1∥rO3)2
(7.104)
where KN and K P denote the ﬂicker noise coefﬁcients of NMOS and PMOS devices, respectively.
Approximating the voltage gain as (gm1 + gmb1)(rO1||rO3), we obtain
V 2
n,in =
1
Cox f
g2
m1KN
(W L)1
+ g2
m3K P
(W L)3

1
(gm1 + gmb1)2
(7.105)

Sec. 7.4
Noise in Single-Stage Ampliﬁers
253
With the input open, the output noise voltage is approximately given by
V 2
n2,out =
1
Cox f
g2
m2KN
(W L)2
+ g2
m3K P
(W L)3

R2
out
(7.106)
where it is assumed that the transconductance from the gate of M2 to the output is equal to gm2. It follows
that
I 2
n,in =
1
Cox f
g2
m2KN
(W L)2
+ g2
m3K P
(W L)3

(7.107)
Equations (7.105) and (7.107) describe the 1/f noise behavior of the circuit and must be added to
(7.98) and (7.103), respectively, to obtain the overall noise per unit bandwidth.
7.4.3 Source Followers
Consider the source follower depicted in Fig. 7.51(a), where M2 serves as the bias-current source. Since
the input impedance of the circuit is quite high, even at relatively high frequencies, the input-referred
noise current can usually be neglected for moderate driving source impedances. To compute the input-
referred thermal noise voltage, we employ the representation in Fig. 7.51(b), expressing the output noise
due to M2 as
V 2n,out|M2 = I 2
n2
 1
gm1

1
gmb1
rO1∥rO2
2
(7.108)
V2n1
VDD
VDD
Vin
Vout
M1
M2
Vb
M1
M2
I2n2
V2n,out
Figure 7.51
(a) Source follower; (b) circuit including noise sources.
From Chapter 3,
Av =
1
gmb1
rO1∥rO2
1
gmb1
rO1∥rO2 +
1
gm1
(7.109)
Thus, the total input-referred noise voltage is
V 2
n,in = V 2
n1 + V 2n,out

M2
A2v
(7.110)
= 4kT γ
 1
gm1
+ gm2
g2
m1

(7.111)
Note the similarity between (7.78) and (7.111).

254
Chap. 7
Noise
Since source followers add noise to the input signal while providing a voltage gain of less than unity,
they are usually avoided in low-noise ampliﬁcation. The 1/f noise performance of source followers is
studied in Problem 7.11.
7.4.4 Cascode Stage
Consider the cascode stage of Fig. 7.52(a). Since at low frequencies the noise currents of M1 and RD
mostly ﬂow through RD, the noise contributed by these two devices is quantiﬁed as in a common-source
stage:
V 2
n,in|M1,RD = 4kT
 γ
gm1
+
1
g2
m1RD

(7.112)
Vin
M2
M1
Vb
VDD
RD
Vout
M2
M1
Vb
VDD
RD
X
I2n2
M2
VDD
RD
X
V2n2
(c)
(a)
(b)
X
M1
V2n,out
V2n,out
Figure 7.52
(a) Cascode stage; (b) noise of M2 modeled by a current source; (c) noise of M2 modeled by a
voltage source.
where 1/f noise of M1 is ignored. What is the effect of noise of M2? Modeled as in Fig. 7.52(b), this
noise contributes negligibly to the output, especially at low frequencies. This is because, if channel-length
modulation in M1 is neglected, then In2 + ID2 = 0, and hence M2 does not affect Vn,out. From another
point of view, using the lemma of Fig. 7.39 to construct the equivalent in Fig. 7.52(c), we note that the
voltage gain from Vn2 to the output is quite small if the impedance at node X is large. At high frequencies,
on the other hand, the total capacitance at node X, CX, gives rise to a gain:
Vn,out
Vn2
≈
−RD
1/gm2 + 1/(CXs)
(7.113)
increasing the output noise. This capacitance also reduces the gain from the main input to the output by
shunting the signal current produced by M1 to ground. As a result, the input-referred noise of a cascode
stage may rise considerably at high frequencies.
If RD in Fig. 7.52(c) is large, e.g., if it represents the output resistance of a PMOS cascode load, then
the gain from Vn2 to Vout may not be small. The reader can show that, if RD ≈gmr2
O (for a cascode), then
Vout/Vn is still much greater, making the contribution of Vn negligible.
7.5
Noise in Current Mirrors
The noise produced by the devices in current mirrors may propagate to the output of interest. In Figs. 7.48
and 7.49, for example, the diode-connected device may contribute substantial ﬂicker noise unless an
extremely large bypass capacitor is used. This effect is exacerbated by the bias-current multiplication
factor in the current mirror.

Sec. 7.5
Noise in Current Mirrors
255
IREF
MREF
VDD
M1
ID1
CB
gm,REF V1
V1
V2n,REF
MREF
V2n,REF
gm,REF
1
M1
V2n1
X
I2n,out
CB
(a)
(b)
(c)
Figure 7.53
(a) Current mirror using a capacitor to suppress diode-connected device’s noise, (b) small-signal
model, and (c) overall equivalent circuit.
To appreciate the difﬁculty with current-mirror ﬂicker noise, let us study the simple topology shown in
Fig. 7.53(a), where (W/L)1 = N(W/L)REF. The multiplication factor, N, is in the range of 5 to 10 so as to
minimize the power consumed by the reference branch. We wish to determine the ﬂicker noise in ID1. We
assume that λ = 0 and IREF is noiseless but caution the reader that, as described in Chapter 12, the noise
of the reference (bandgap) current may not be negligible. We ﬁrst construct a Thevenin equivalent for
MREF and its ﬂicker noise, Vn,RE F: as depicted in Fig. 7.53(b), the open-circuit voltage is equal to Vn,RE F
because V1 must be zero (why?). Noting that the Thevenin resistance is equal to 1/gm,RE F, we arrive at
the arrangement in Fig. 7.53(c), where the noise voltage at node X and Vn1 add (without correlation) and
drive the gate of M1, producing
I 2n,out =
	
g2
m,REF
C2
Bω2 + g2
m,REF
V 2
n,REF + V 2
n1

g2
m1
(7.114)
Since (W/L)1 = N(W/L)REF and, typically, L1 = LREF, we observe that V 2
n,REF = NV 2
n1 because the
ﬂicker noise power spectral density is inversely proportional to the channel area, W L. It follows that
I 2n,out =
	
Ng2
m,REF
C2
Bω2 + g2
m,REF
+ 1

g2
m1V 2
n1
(7.115)
For the noise of the diode-connected device to be negligible, we must ensure that the ﬁrst term inside the
parentheses is small:
(N −1)g2
m,REF ≪C2
Bω2
(7.116)
and hence
C2
B ≫(N −1)g2
m,REF
ω2
(7.117)
For example, if N = 5, gm,REF ≈1/(200 ), and the minimum frequency of interest is 1 MHz, we have
C2
B ≫2.533 × 10−18 F. For a tenfold suppression of the MREF noise, this translates to 5.03 nF!
In order to reduce the noise contributed by MREF while avoiding such a large capacitor, we can insert
a resistance between its gate and CB [Fig. 7.54(a)] and revise Eq. (7.114) as
I 2n,out =

g2
m,REF
(1 + gm,REF RB)2C2
Bω2 + g2
m,REF
(V 2
n,REF + V 2
n,RB) + V 2
n1

g2
m1
(7.118)

256
Chap. 7
Noise
IREF
MREF
VDD
M1
ID1
CB
(a)
(b)
RB
IREF
MREF
VDD
M1
ID1
CB
MR
MC
Figure 7.54
(a) Use of a resistor to ﬁlter a diode-connected device’s noise, and (b) realization of the resistor by a
MOSFET.
The series resistance lowers the ﬁlter cutoff frequency to [(1/gm1,REF + RB)CB]−1 but also contributes
its own noise. We can thus increase RB before V 2
n,RB becomes an appreciable fraction of V 2
n,REF.
In practice, RB can be quite large before its thermal noise becomes comparable with the ﬂicker noise
of MREF. The upper bound on RB is therefore dictated by the area trade-off between RB and CB.12 We
thus seek a circuit arrangement that provides a high resistance and occupies a moderate area. Fortunately,
we have developed such a topology in Chapter 5: as shown in Fig. 7.54(b), a MOS device, MR, with a
small, but controlled overdrive serves our purpose. As explained in Chapter 5, MR is chosen narrow and
long, and MC wide and short.
7.6
Noise in Differential Pairs
With our understanding of noise in basic ampliﬁers, we can now study the noise behavior of differential
pairs. Shown in Fig. 7.55(a), a differential pair can be viewed as a two-port circuit. It is therefore possible
to model the overall noise as depicted in Fig. 7.55(b). For low-frequency operation, I 2
n,in is negligible.
M1
M2
RD
VDD
RD
Vin
ISS
Vout
Vn2,in
In2,in
M1
M2
RD
VDD
RD
ISS
V2n,out
(a)
(b)
Figure 7.55
(a) Differential pair; (b) circuit including input-referred noise sources.
To calculate the thermal component of V 2
n,in, we ﬁrst obtain the total output noise with the inputs
shorted together [Fig. 7.56(a)], noting that superposition of power quantities is possible because the noise
12Also, the transistors’ gate leakage currents ﬂow through RB, introducing a signiﬁcant dc error if this resistor is very large.

Sec. 7.6
Noise in Differential Pairs
257
VDD
M1
M2
RD1
VDD
RD2
ISS
In21
In22
In2,RD2
In2,RD1
M1
M2
RD1
VDD
RD2
In21
M1
RD1
In21
gm2 + gmb2
1
gm2 + gmb2
1
(c)
(a)
(b)
Vn,out
P
VDD
M1
RD1
In2,out1
In2,out1
In1
In1
(d)
Figure 7.56
Calculation of input-referred noise of a differential pair.
sources in the circuit are uncorrelated. Since In1 and In2 are uncorrelated, node P cannot be considered
a virtual ground, making it difﬁcult to use the half-circuit concept. Thus, we simply derive the effect of
each source individually. Depicted in Fig. 7.56(b), the contribution of In1 is obtained by ﬁrst reducing the
circuit to that in Fig. 7.56(c). With the aid of this ﬁgure and neglecting channel-length modulation, the
reader can prove that half of In1 ﬂows through RD1 and the other half through M2 and RD2. [As shown
in Fig. 7.56(d), this can also be proved by decomposing In1 into two (correlated) current sources and
calculating their effect at the output.] Thus, the differential output noise due to M1 is equal to
Vn,out|M1 = In1
2 RD1 + In1
2 RD2
(7.119)
Note that the two noise voltages are directly added because they both arise from In1 and are therefore
correlated. It follows that, if RD1 = RD2 = RD,
V 2n,out

M1 = I 2
n1R2
D
(7.120)
Similarly,
V 2n,out

M2 = I 2
n2R2
D
(7.121)

258
Chap. 7
Noise
yielding
V 2n,out

M1,M2 =

I 2
n1 + I 2
n2

R2
D
(7.122)
Taking into account the noise of RD1 and RD2, we have for the total output noise
V 2n,out =

I 2
n1 + I 2
n2

R2
D + 2(4kTRD)
(7.123)
= 8kT

γ gm R2
D + RD

(7.124)
Dividing the result by the square of the differential gain, g2
m R2
D, we obtain
V 2
n,in = 8kT
 γ
gm
+
1
g2m RD

(7.125)
This is simply twice the input noise voltage squared of a common-source stage.
The input-referred noise voltage can also be calculated by exploiting the lemma illustrated in Fig. 7.39.
As shown in Fig. 7.57, the noise of M1 and M2 is modeled as a voltage source in series with their gates,
and the noise of RD1 and RD2 is divided by g2
m R2
D, thereby resulting in (7.125). The reader is encouraged
to repeat these calculations if the tail current source is replaced with a short circuit.
ISS
RD1
VDD
RD2
V2n,RD1
V2n,RD2
M1
M2
V2n2
V2n1
V2n,out
Figure 7.57
Alternative method of
calculating the input-referred noise.
It is instructive to compare the noise performance of a differential pair and a common-source stage,
as expressed by (7.75) and (7.125). We conclude that, if each transistor has a transconductance gm, then
the input-referred noise voltage of a differential pair is
√
2 times that of a common-source stage. This is
simply because the former includes twice as many devices in the signal path, as exempliﬁed by the two
series voltage sources in Fig. 7.57. (Since the noise sources are uncorrelated, their powers add.) It is also
important to recognize that, with the assumption of equal device transconductances, a differential pair
consumes twice as much power as a common-source stage if the transistors have the same dimensions.
The noise modeling of Fig. 7.57 can readily account for 1/f noise of the transistors as well. Placing
the voltage sources given by K/(CoxW L) in series with each gate, we can rewrite (7.125) as
V 2
n,in,tot = 8kT
 γ
gm
+
1
g2m RD

+
2K
CoxW L
1
f
(7.126)
These derivations suggest that the input-referred noise voltage squared of a fully-differential circuit is
equal to twice that of its half-circuit equivalent (because the latter employs half as many devices in the
signal path). The following example reinforces this point.

Sec. 7.6
Noise in Differential Pairs
259
▲
Example7.21
A differential pair with current-source loads can be conﬁgured to act as a large “ﬂoating” resistor [7]. Illustrated
in Fig. 7.58(a), the idea is to bias M1 and M2 at a very small current so as to obtain a high incremental resistance
between A and B, approximately equal to 1/gm1 + 1/gm2. Determine the noise associated with this resistor. Neglect
channel-length modulation.
M1
M2
Vb
VDD
A
B
M3
M4
M1
Vb
A
VDD
M3
(a)
(b)
Figure 7.58
Solution
Viewing A and B as the outputs and modeling the circuit by its Thevenin equivalent, we must determine the noise
voltage that appears between these nodes. To this end, we construct the half circuit shown in Fig. 7.58(b) and write
the noise voltage at A as
V 2
n,A = (4kT γ gm1 + 4kT γ gm3) 1
g2
m1
+
K
(W L)1Cox
1
f +
K
(W L)3Cox
1
f ( gm3
gm1
)2
(7.127)
The noise measured between A and B is thus equal to
V 2
n,AB = 8kT γ (gm1 + gm3) 1
g2
m1
+
2K
(W L)1Cox
1
f +
2K
(W L)3Cox
1
f ( gm3
gm1
)2
(7.128)
We recognize that this resistor is noisier than a simple ohmic resistor of the same value (≈2/gm1). It is also much
less linear (why?).
▲
Does the tail current source in Fig. 7.55 contribute noise? If the differential input signal is zero and
the circuit is symmetric, then the noise in ISS divides equally between M1 and M2, producing only a
common-mode noise voltage at the output. On the other hand, for a small differential input, Vin, we have
ID1 −ID2 = gmVin
(7.129)
=

2μnCox
W
L
 ISS + In
2

Vin
(7.130)
where In denotes the noise in ISS and In ≪ISS. In essence, the noise modulates the transconductance of
each device. Equation (7.130) can be written as
ID1 −ID2 ≈

2μnCox
W
L · ISS
2

1 +
In
2ISS

Vin
(7.131)
= gm0

1 +
In
2ISS

Vin
(7.132)

260
Chap. 7
Noise
where gm0 is the transconductance of the noiseless circuit. Equation (7.132) suggests that as the circuit de-
parts from equilibrium, In is more unevenly divided between M1 and M2, thereby generating differential
noise at the output. This effect is nonetheless usually negligible.
▲
Example7.22
Assuming that the devices in Fig. 7.59(a) operate in saturation and the circuit is symmetric, calculate the input-referred
noise voltage.
(a)
(b)
M1
M2
VDD
Vb
Vout
Vin
M1
M2
VDD
V2n3
V2n1
V2n4
V2n2
X
Y
M3
M4
M3
M4
M1
M2
VDD
V2n3
Y
M3
M4
rO3
RX
X
(c)
Figure 7.59
Solution
Since the thermal and 1/f noise of M1 and M2 can be modeled as voltage sources in series with the input, we need
only refer the noise of M3 and M4 to the input. Let us calculate the output noise contributed by M3. The drain noise
current of M3 is divided between rO3 and the resistance seen looking into the drain of M1 [Fig. 7.59(c)]. From
Chapter 5, this resistance equals RX = rO4 + 2rO1. Denoting the resulting noise currents ﬂowing through rO3 and
RX by InA and InB, respectively, we have
InA = gm3Vn3
rO4 + 2rO1
2rO4 + 2rO1
(7.133)
and
InB = gm3Vn3
rO3
2rO4 + 2rO1
(7.134)
The former produces a noise voltage of gm3Vn3rO3(rO4 + 2rO1)/(2rO4 + 2rO1) at node X with respect to ground
whereas the latter ﬂows through M1, M2, and rO4, generating gm3Vn3rO3rO4/(2rO4 + 2rO1) at node Y with respect

Sec. 7.6
Noise in Differential Pairs
261
to ground. Thus, the total differential output noise due to M3 is equal to
VnXY = VnX −VnY
(7.135)
= gm3Vn3
rO3rO1
rO3 + rO1
(7.136)
(The reader can verify that VnY must be subtracted from VnX.)
Equation (7.136) implies that the noise current of M3 is simply multiplied by the parallel combination of rO1 and
rO3 to produce the differential output voltage. This is of course not surprising because, as depicted in Fig. 7.60, the
effect of Vn3 at the output can also be derived by decomposing Vn3 into two differential components applied to the
gates of M3 and M4 and subsequently using the half-circuit concept. Since this calculation relates to a single noise
source, we can temporarily ignore the random nature of noise and treat Vn3 and the circuit as familiar deterministic,
linear components.
(a)
(b)
M1
M2
VDD
Vn3
Y
M3
M4
X
(c)
M1
M2
VDD
Y
M3
M4
X
− 
M1
Vn3
M3
X
2
Vn3
2
+
Vn3
2
+
VDD
Figure 7.60
Calculation of input-referred noise in a differential pair with current-source loads.
Applying (7.136) to M4 as well and adding the resulting powers, we have
V 2n,out|M3,M4 = g2
m3(rO1∥rO3)2V 2
n3 + g2
m4(rO2∥rO4)2V 2
n4
(7.137)
= 2g2
m3(rO1∥rO3)2V 2
n3
(7.138)
To refer the noise to the input, we divide (7.138) by g2
m1(rO1∥rO3)2, obtaining the total input-referred noise
voltage per unit bandwidth as
V 2
n,in = 2V 2
n1 + 2 g2
m3
g2
m1
V 2
n3
(7.139)
which, upon substitution for V 2
n1 and V 2
n3, reduces to
V 2
n,in = 8kT γ

1
gm1
+ gm3
g2
m1

+
2KN
Cox(W L)1 f +
2K P
Cox(W L)3 f
g2
m3
g2
m1
(7.140)
▲
It is instructive to compare the above input-referred noise to that of a differential pair with active
load (the ﬁve-transistor OTA). We analyze the thermal noise of the latter and leave the ﬂicker noise as
an exercise for the reader. Due to lack of perfect symmetry, we seek the Norton noise equivalent of the
circuit by ﬁrst computing the output short-circuit noise current (Fig. 7.61). This result can be multiplied
by the output resistance and divided by the gain to obtain the input-referred noise voltage.

262
Chap. 7
Noise
VDD
M4
M1
M2
ISS
M3
X
I2n,out
Figure 7.61
OTA output short-circuit
noise current.
We recall from Chapter 5 that the transconductance of the ﬁve-transistor OTA is approximately equal
to gm1,2. Thus, the output noise current due to M1 and M2 is given by this transconductance multiplied
by the gate-referred noises of M1 and M2, i.e., g2
m1,2(4kT γ/gm1 + 4kT γ/gm2).
Let us consider the noise current of M3, 4kT γ gm3. This current primarily circulates through the diode-
connected impedance, 1/gm3, producing a voltage at the gate of M4 with a spectral density of 4kT γ/gm3.
This noise is multiplied by g2
m4 as it emerges from the drain of M4. The noise current of M4 itself also
directly ﬂows through the output short circuit. We therefore have
I 2n,out = 4kT γ (2gm1,2 + 2gm3,4)
(7.141)
Multiplying this noise by R2
out ≈(rO1,2||rO3,4)2 and dividing the result by A2
v = G2
m R2
out, we obtain the
total input-referred noise voltage as
V 2
n,in = 8kT γ
	
1
gm1,2
+ gm3,4
g2
m1,2

(7.142)
which is the same as that of the fully-differential circuit.
An interesting difference between the OTA and the fully-differential topology relates to the noise
contributed by the tail current when Vin1 = Vin2. Recall from Chapter 5 that the output voltage of the
OTA in Fig. 7.62 is equal to VX. If ISS ﬂuctuates, so do VX and Vout. Since the tail noise current, In, splits
equally between M1 and M2, the noise voltage at X is given by I 2n /(4g2
m3), and so is the noise voltage at
the output. (Why does In split equally, even though the impedance seen looking into the source of M2
appears to be higher than that seen looking into the source of M1?)
The effect of noise must be studied for many other analog circuits as well. For example, feedback
systems, op amps, and bandgap references exhibit interesting and important noise characteristics. We
return to these topics in other chapters.
VDD
M4
M1
M2
ISS
M3
X
Vout
Figure 7.62
Effect of tail noise current
in OTA.

Sec. 7.7
Noise-Power Trade-Off
263
7.7
Noise-Power Trade-Off
Inouranalysisoftheinput-referredthermalnoise,wehaveseenthatthenoisecontributedbythetransistors
“in the signal path” is inversely proportional to their transconductance. This dependence suggests a trade-
off between noise and power consumption.
The noise-power trade-off can in fact be generalized to any circuit (so long as the input noise current
is negligible). To understand this point, let us begin with a simple CS stage as shown in Fig. 7.63(a):
we double W/L and the bias current of M1 and halve the load resistor. This transformation maintains
the voltage gain and the output swing regardless of the transistor characteristics. But we note that the
input-referred thermal and ﬂicker noise power is exactly halved (because both the gm and the gate area
of the transistor are doubled). This 3-dB reduction in noise accrues at a cost of doubling the power
consumption (and the input capacitance).
M1
VDD
Vin
ID
W1
L1
W1
L1
W1
L1
RD
M1
VDD
Vin
L1
RD
2
2W1
2ID
Vout
in
V
ID
RD
VDD
ID
RD
out
V
Vout
W1
2W1
WD
2WD
(a)
(b)
(c)
RD
M1
Figure 7.63
(a) Output noise reduction by scaling, (b) equivalent operation, and (c) scaling viewed at layout level.
Called “linear scaling,” the transformation depicted in Fig. 7.63(a) can also be viewed as placing two
instances of the original circuit in parallel, as illustrated in Fig. 7.63(b). Alternatively, we can say that
the widths of the transistor and the resistor are doubled [Fig. 7.63(c)].
In general, if two instances of a circuit are placed in parallel, the output noise power is halved
[Fig. 7.64(a)]. This can be proved by setting the input to zero and constructing a Thevenin noise equivalent
for each [Fig. 7.64(b)]. Since Vn1,out and Vn2,out are uncorrelated, we can use superposition of powers to
write
V 2n,out = V 2
n1,out
4
+ V 2
n2,out
4
(7.143)
= V 2
n1,out
2
(7.144)
Thus, the output noise is traded for power consumption while retaining the voltage gain and output
swings. Note that this can also be proved if the input is left open, revealing that the input-referred noise
current, I 2
n,in, is doubled (why?).

264
Chap. 7
Noise
A
A
Vin
Vout
Zout
V2n1
V2n2
Zout
V2n,out
(a)
(b)
Figure 7.64
(a) General scaling for noise reduction, and (b) equivalent circuit.
We should also remark that noise spectrum must eventually be integrated across the circuit’s band-
width. The foregoing linear scaling assumes that the bandwidth is dictated by the application and hence
constant.
7.8
Noise Bandwidth
The total noise corrupting a signal in a circuit results from all of the frequency components that fall in
the bandwidth of the circuit. Consider a multipole circuit having the output noise spectrum shown in
Fig. 7.65(a). Since the noise components above ωp1 are not negligible, the total output noise must be
evaluated by calculating the total area under the spectral density:
V 2n,out,tot =
 ∞
0
V 2n,outd f
(7.145)
However, as depicted in Fig. 7.65(b), it is sometimes helpful to represent the total noise simply as V 2
0 · Bn,
where the bandwidth Bn is chosen such that
V 2
0 · Bn =
 ∞
0
V 2n,outd f
(7.146)
Called the “noise bandwidth,” Bn allows a fair comparison of circuits that exhibit the same low-frequency
noise, V 2
0 , but different high-frequency transfer functions. As an exercise, the reader can prove that the
noise bandwidth of a one-pole system is equal to π/2 times the pole frequency.
ωp1
ωp2
ω
ωp1
ωp2
ω
V20
Bn
A1
A2
A1 = A2
(a)
(b)
V2n,out
V20
V2n,out
Figure 7.65
(a) Output noise spectrum of a circuit; (b) concept of noise bandwidth.

Sec. 7.10
Appendix A: Problem of Noise Correlation
265
7.9
Problem of Input Noise Integration
In our noise studies thus far, we have computed the output noise spectrum and, by integration, the total
output noise voltage. Is it possible to perform the integration on the input-referred noise instead?
Consider the CS stage shown in Fig. 7.66, where we assume that λ = 0 and M1 exhibits only
thermal noise. For simplicity, let us neglect the noise of RD. We note that the output noise spectrum is
equal to the ampliﬁed and low-pass ﬁltered noise of M1; this spectrum readily lends itself to integration
(Example 7.19). The input-referred noise voltage, on the other hand, is simply equal to V 2
n,M1, carrying
an inﬁnite power and prohibiting integration at the input.
M1
RD
VDD
CL
V2n,M1
V2n,out
f
0
gm
4kTγ
V2n,in
f
0
V2n,out
g2mR2DV2n,M1
γgmRD kT
CL
Figure 7.66
Difﬁculty with referring output noise to input.
The above quandary arises in most circuits, encouraging only output noise integration. After all, the
physical and observable noise appears only at the output, and the input-referred noise remains a ﬁctitious
quantity. However, for a fair comparison of different designs, we can divide the integrated output noise
by the low-frequency (or mid-band) gain of the circuit. For example, the CS stage of Fig. 7.66 can be
characterized by a total input-referred noise equal to
V 2
n,in,tot = γ gm RD
kT
CL
·
1
g2m R2
D
(7.147)
=
γ
gm RD
kT
CL
(7.148)
if the noise of RD is neglected. The reader is encouraged to repeat these calculations with channel-length
modulation and the noise of RD included.
7.10
Appendix A: Problem of Noise Correlation
As explained in Section 7.1.3, the input-referred noise voltage and current are generally correlated, com-
plicating noise calculations. In this appendix, we consider alternative methods that avoid the correlation.
Recall from (7.55) that the input-referred noise current manifests itself only if the magnitude squared of
the impedance driving the circuit is comparable to V 2
n,in/I 2
n,in.
In many circuits, the output noise voltage remains approximately the same as the driving impedance,
ZS, goes from zero to inﬁnity, i.e., the input port termination goes from a short circuit to an open circuit.13
For example, a common-source stage with negligible CGD exhibits this behavior [Fig. 7.67(a)]:
V 2
n1,out = V 2
n2,out = 4kT γ gm R2
D + 4kT RD
(7.149)
13The noise of ZS is excluded here.

266
Chap. 7
Noise
M1
RD
VDD
Cin
V2n1,out
V2n2,out
V2n1,out
V2n2,out
M1
RD
VDD
Cin
M1
RD
VDD
Cin
V2n,in
M1
RD
VDD
Cin
I2n,in
Zin
(a)
(b)
Figure 7.67
(a) Output noise of CS stage with input shorted or open; (b) calculation of input-referred sources.
We now note from Fig. 7.67(b) that
V 2
n1,out = V 2
n,in|H( f )|2
(7.150)
where H(s) = Vout/Vin, and also
V 2
n2,out = I 2
n,in|Zin( f )|2|H( f )|2
(7.151)
It follows that I 2
n,in = V 2
n,in/|Zin( f )|2. Since Zin(s) is a deterministic quantity, we have In,in =
Vn,in/Zin(s), and hence 100% correlation between the two sources. In order to account for both Vn,in and
In,in, we must carry out lengthy calculations similar to those for Fig. 7.37.
Now, consider the arrangement shown in Fig. 7.68(a), where ZS denotes the output impedance of the
preceding stage. We assume that the output noise of the circuit negligibly changes as ZS varies. The noise
voltage at node X is equal to
Vn,X =
Zin
Zin + ZS
Vn,in +
Zin Zs
Zin + ZS
In,in
(7.152)
I2n,in
V 2n,in
V 2n,in
Zin
ZS
X
Zin
ZS
X
(a)
(b)
Figure 7.68
(a) Cascade of two stages, and (b) transformation to omit In,in.

Problems
267
Replacing for In,in from above, we obtain
Vn,X = Vn,in
(7.153)
That is, In,in simply serves to keep Vn,X (with respect to ground) equal to Vn,in for different values of ZS.
This interesting result helps simplify the analysis.
Based on this observation, we modify the arrangement to that in Fig. 7.68(b), where Zin simply loads
the preceding stage but In,in is absent. Here, too, we have Vn,X = Vn,in. Thus, in circuits whose output
noise voltage is a weak function of the input termination, In,in can be omitted if an impedance equal to
Zin is used to load the preceding stage.
If the above condition for Vn,out does not hold, we may simply consider the preceding stage as part of
the circuit and view the two stages as one entity. For example, the ampliﬁer shown in Fig. 7.69 can be
modeled as one stage with input-referred noise sources Vn,in and In,in, thereby avoiding the complications
associated with the second stage’s noise voltage and current.
M1
RD1
VDD
M2
RD2
RF
I 2n,in
V 2n,in
Figure 7.69
Viewing a cascade as a
single circuit.
References
[1] L. W. Couch, Digital and Analog Communication Systems, 4th ed. (New York: Macmillan Co., 1993).
[2] S. M. Sze, Physics of Semiconductor Devices, 2nd ed. (New York: Wiley, 1981).
[3] B. Razavi, Y. Ran, and K. F. Lee, “Impact of Distributed Gate Resistance on the Performance of MOS Devices,”
IEEE Trans. Circuits and Systems, Part I, pp. 750–754, Nov. 1994.
[4] Y. Tsividis, Operation and Modeling of the MOS Transistor, 2nd ed. (Boston: McGraw-Hill, 1999).
[5] A. A. Abidi, “High-Frequency Noise Measurements on FETs with Small Dimensions,” IEEE Trans. Electron
Devices, vol. 33, pp. 1801–1805, Nov. 1986.
[6] H. A. Haus et al., “Representation of Noise in Linear Twoports,” Proc. IRE, vol. 48, pp. 69–74, Jan. 1960.
[7] S. Asai et al, “High-Resistance Resistor Consisting of a Subthreshold CMOS Differential Pair,” IEICE Trans.
Electronics, vol. E93, pp. 741–746, June 2010.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. Also, assume that all transistors are in saturation.
7.1.
A common-source stage incorporates a 50-μm/0.5-μm NMOS device biased at ID = 1 mA along with a load
resistor of 2 k. What is the total input-referred thermal noise voltage in a 100-MHz bandwidth?
7.2.
Consider the common-source stage of Fig. 7.42. Assume that (W/L)1 = 50/0.5, ID1 = ID2 = 0.1 mA,
and VDD = 3 V. If the contribution of M2 to the input-referred noise voltage (not voltage squared) must be
one-ﬁfth of that of M1, what is the maximum output voltage swing of the ampliﬁer?

268
Chap. 7
Noise
7.3.
Using the distributed model of Fig. 7.21(c) and ignoring the channel thermal noise, prove that, for gate noise
calculations, a distributed gate resistance of RG can be replaced by a lumped resistance equal to RG/3. (Hint:
model the noise of RGj by a series voltage source and calculate the total drain noise current. Watch for
correlated sources of noise.)
7.4.
Prove that the output noise current of Fig. 7.39(c) is given by Eq. (7.73).
7.5.
Calculate the input-referred ﬂicker noise voltage of the circuit shown in Fig. 7.70.
M1
M2
VDD
Vin
Vout
Figure 7.70
7.6.
Calculate the input-referred thermal noise voltage of each circuit in Fig. 7.71. Assume that λ = γ = 0.
M1
Vin
RS
VDD
RD
Vout
M1
Vin
RS
VDD
Vout
M1
Vin
RS
Vout
VDD
M2
(c)
(a)
(b)
(d)
VDD
I1
M1
Vout
RS
RF
Vin
VDD
M1
M2
RD
Vin
Vb
Vout
RF
M1
Vin
VDD
RS
Vb
RD
Vout
M2
(e)
(f)
Figure 7.71
7.7.
Calculate the input-referred thermal noise voltage of each circuit in Fig. 7.72. Assume that λ = γ = 0.

Problems
269
VDD
M1
Vout
RS
RF
Vin
M2
Vb
VDD
M1
Vout
RS
RF
Vin
M2
VDD
M1
RS
Vin
RD
M2
Vout
VDD
M1
M2
Vb2
RD
M3
Vin
Vb1
Vout
(a)
(b)
(c)
(d)
Figure 7.72
7.8.
Calculate the input-referred thermal noise voltage and current of each circuit in Fig. 7.73. Assume that
λ = γ = 0.
M1
Vb
VDD
RD
Vout
RG
Vin
M1
Vb
VDD
RD
Vout
Vin
R1
M1
Vin
VDD
RD
Vout
RF
M1
VDD
RD
Vout
Vin
R1
R1
(c)
(a)
(b)
(d)
Figure 7.73
7.9.
Calculate the input-referred thermal noise voltage and current of each circuit in Fig. 7.74. Assume that
λ = γ = 0.
7.10. Calculate the input-referred 1/f noise voltage and current of Fig. 7.49 if the two capacitors are removed.
7.11. Calculate the input-referred 1/f noise voltage of the source follower shown in Fig. 7.51.
7.12. Assuming that λ = γ = 0, calculate the input-referred thermal noise voltage of each circuit in Fig. 7.75. For
part (a), assume that gm3,4 = 0.5gm5,6.
7.13. Consider the degenerated common-source stage shown in Fig. 7.76.
(a) Calculate the input-referred thermal noise voltage if λ = γ = 0.
(b) Suppose linearity requirements necessitate that the dc voltage drop across RS be equal to the overdrive
voltage of M1. How does the thermal noise contributed by RS compare with that contributed by M1?
7.14. Explain why Miller’s theorem cannot be applied to calculate the effect of the thermal noise of a ﬂoating resistor.
7.15. The circuit of Fig. 7.20 is designed with (W/L)1 = 50/0.5 and ID1 = 0.05 mA. Calculate the total rms
thermal noise voltage at the output in a 50-MHz bandwidth.
7.16. For the circuit shown in Fig. 7.77, calculate the total output thermal and 1/f noise in a bandwidth [ fL, fH].
Assume that λ ̸= 0, but neglect other capacitances.
7.17. Suppose in the circuit of Fig. 7.42, (W/L)1,2 = 50/0.5 and ID1 = |ID2| = 0.5 mA. What is the input-referred
thermal noise voltage?
7.18. The circuit of Fig. 7.42 is modiﬁed as depicted in Fig. 7.78.
(a) Calculate the input-referred thermal noise voltage.
(b) For a given bias current and output voltage swing, what value of RS minimizes the input-referred thermal
noise?

270
Chap. 7
Noise
M1
Vin
VDD
RD
Vout
RG
M2
M1
Vin
VDD
RD
Vout
RG
M2
Vb
M1
Vin
VDD
RD
Vout
M2
I1
M1
VDD
I1
M2
Vout
Vin
M1
VDD
Vin
RG
M2
I1
Vout
Vb
(c)
(a)
(b)
(d)
(e)
Figure 7.74
M1
M2
Vout
VDD
M4
M3
M5
M6
M1
M2
VDD
M4
M3
Vin
Vout
Vin
ISS
P
ISS
P
(a)
(b)
Figure 7.75
7.19. A common-gate stage incorporates an NMOS device with W/L = 50/0.5 biased at ID = 1 mA and a load
resistor of 1 k. Calculate the input-referred thermal noise voltage and current.
7.20. The circuit of Fig. 7.48 is designed with (W/L)1 = 50/0.5, ID1 = ID2 = 0.5 mA, and RD = 1 k.
(a) Determine (W/L)2 such that the contribution of M2 to the input-referred thermal noise current (not current
squared) is one-ﬁfth of that due to RD.
(b) Now calculate the minimum value of Vb to place M2 at the edge of the triode region. What is the maximum
allowable output voltage swing?
7.21. Design the circuit of Fig. 7.48 for an input-referred thermal noise voltage of 3 nV/
√
Hz and maximum output
swing. Assume that ID1 = ID2 = 0.5 mA.

Problems
271
M1
RD
VDD
RS
Vin
Vout
Figure 7.76
M1
RD
VDD
Vin
Vout
CL
Figure 7.77
M1
RS
VDD
Vin
Vb
Vout
M2
Figure 7.78
7.22. Consider the circuit of Fig. 7.49. If (W/L)1−3 = 50/0.5 and ID1−3 = 0.5 mA, determine the input-referred
thermal noise voltage and current.
7.23. The circuit of Fig. 7.49 is designed with (W/L)1 = 50/0.5 and ID1−3 = 0.5 mA. If an output swing of 2 V is
required, estimate by iteration the dimensions of M2 and M3 such that the input-referred thermal noise current
is minimum.
7.24. The source follower of Fig. 7.51 is to provide an output resistance of 100  with a bias current of 0.1 mA.
(a) Calculate (W/L)1.
(b) Determine (W/L)2 such that the input-referred thermal noise voltage (not voltage squared) contributed
by M2 is one-ﬁfth of that due to M1. What is the maximum output swing?
7.25. The cascode stage of Fig. 7.52(a) exhibits a capacitance CX from node X to ground. Neglecting other capac-
itances, determine the input-referred thermal noise voltage.
7.26. Determine the input-referred thermal and 1/f noise voltages of the circuits shown in Fig. 7.79 and compare
the results. Assume that the circuits draw equal supply currents.
7.27. Repeat the analysis in Example 7.13 but assume that λ > 0.
7.28. Suppose the circuit of Fig. 7.38(a) is driven by a ﬁnite source impedance, as shown in Fig. 7.80. Assume that
λ = 0, and neglect the noise of RS.
(a) Determine the output noise voltage of the circuit.
(b) In a manner similar to the analysis of Fig. 7.37, compute in terms of Vn,RF and Vn,M1 the input-referred
noise voltage and current, paying close attention to their correlation.

272
Chap. 7
Noise
M3
Vb
(a)
M1
M2
R1
RS
RS
R1
VDD
Vout
Vin
M3
Vb
M1
M2
R1
R1
VDD
Vout
Vin
(b)
M4
2RS
Figure 7.79
I1
VDD
M1
Vout
RF
RS
Vin
Figure 7.80
(c) Using superposition of voltages and currents (not powers), calculate the output noise voltage in terms of
Vn,in and In,in, as obtained in (b). Now make the substitutions V 2
n,RF = 4kT RF and I 2
n,M1 = 4kT γ gm.
Is this result the same as that derived in (a)?
7.29. Consider the circuits in Figs. 7.39(c) and (d), but include CGS and a noiseless impedance Z1 in series with the
gate. Derive expressions for In,out1 and In,out2. Does the lemma hold in this case?
7.30. Repeat Example 7.14 while including CGS and an impedance Z1 in series with the gate. Does the lemma hold
in this case?
7.31. Model the thermal noise of M1 in Fig. 7.49 by a voltage source in series with its gate and assuming the input
is open,
(a) Determine the resulting output voltage. (The voltage gain for a degenerated CS stage was derived in
Chapter 3.)
(b) Now refer this voltage to the input as a current and compare the result with the contributions of M2 and M3.
7.32. Figure 7.81 shows a noiseless ampliﬁer driven by a source resistance of RS. If the ampliﬁer can be modeled
by a low-frequency gain of A0 and a single pole at ω0, determine the total integrated noise at the output
due to RS.
RS
Vin
A0,ω0
Vout
Figure 7.81

Problems
273
7.33. Considering only thermal noise in Fig. 7.82, determine the output noise spectrum and the total integrated
noise. Assume that λ > 0.
M1
RD
VDD
Vin
Vout
CL
RP
Figure 7.82
7.34. Calculate the input-referred thermal and ﬂicker noise of the circuit shown in Fig. 7.83, where the output of
interest is ID3 −ID4. Consider two cases: (a) the current sources are ideal, and (b) the current sources are
realized by MOSFETs. Neglect channel-length modulation and body effect.
M1
M2
M3
M4
VDD
RS
Figure 7.83

CHAPTER
8
Feedback
On a mild August morning in 1927, Harold Black was riding the ferry from New York to New Jersey, where
he worked at Bell Laboratories. Black and many other researchers had been investigating the problem of
nonlinearity in ampliﬁers used in long-distance telephone networks, seeking a practical solution. While
reading the newspaper on the ferry, Black was suddenly struck by an idea and began to draw a diagram
on the newspaper, which would later be used as the evidence in his patent application. The idea is known
to us as the negative-feedback ampliﬁer.
Feedback is a powerful technique that ﬁnds wide application in analog circuits. For example, nega-
tive feedback allows high-precision signal processing, and positive feedback makes it possible to build
oscillators. In this chapter, we consider only negative feedback and use the term feedback to mean that.
We begin with a general view of feedback circuits, describing important beneﬁts that result from
feedback. Next, we study four feedback topologies and their properties. We then deal with difﬁculties
in feedback circuit analysis and introduce the two-port technique, Bode’s technique, and Blackman’s
theorem as possible solutions.
8.1
General Considerations
Figure 8.1 shows a negative-feedback system, where H(s) and G(s) are called the feedforward and the
feedback networks, respectively. Since the output of G(s) is equal to G(s)Y(s), the input to H(s), called
the feedback error, is given by X(s) −G(s)Y(s). That is
Y(s) = H(s)[X(s) −G(s)Y(s)]
(8.1)
Thus,
Y(s)
X(s) =
H(s)
1 + G(s)H(s)
(8.2)
X(s)
H(s)
Y(s)
G(s)
Figure 8.1
General feedback system.
274

Sec. 8.1
General Considerations
275
H(s)
Y(s)
G(s)
Error
Figure 8.2
Similarity between output
of feedback network and input signal.
We call H(s) the “open-loop” transfer function and Y(s)/X(s) the “closed-loop” transfer function. In
most cases of interest in this book, H(s) represents an ampliﬁer and G(s) is a frequency-independent
quantity. In other words, a fraction of the output signal is sensed and compared with the input, generating
an error term. In a well-designed negative-feedback system, the error term is minimized, thereby making
the output of G(s) an accurate “copy” of the input and hence the output of the system a faithful (scaled)
replica of the input (Fig. 8.2). We also say that the input of H(s) is a “virtual ground” because the signal
amplitude at this point is small. In subsequent developments, we replace G(s) by a frequency-independent
quantity β and call it the “feedback factor.”
It is instructive to identify four elements in the feedback system of Fig. 8.1: (1) the feedforward
ampliﬁer, (2) a means of sensing the output, (3) the feedback network, and (4) a means of generating the
feedback error, i.e., a subtractor (or an adder). These elements exist in every feedback system, even though
they may not be obvious in cases such as a simple common-source stage with resistive degeneration.
8.1.1 Properties of Feedback Circuits
Before proceeding to the analysis of feedback circuits, we study some simple examples to describe the
beneﬁts of negative feedback.
Gain Desensitization
Consider the common-source stage shown in Fig. 8.3(a), where the voltage gain
is equal to gm1rO1. A critical drawback of this circuit is the poor deﬁnition of the gain: both gm1 and
rO1 vary with process and temperature. Now suppose the circuit is conﬁgured as in Fig. 8.3(b), where
the gate bias of M1 is set by means not shown here (Chapter 13). Let us calculate the overall voltage
gain of the circuit at relatively low frequencies such that C2 draws a negligible (small-signal) current
from the output node, i.e., Vout/VX = −gm1rO1 because the entire drain current ﬂows through rO1. Since
(Vout −VX)C2s = (VX −Vin)C1s, we have
Vout
Vin
= −
1

1 +
1
gm1rO1
 C2
C1
+
1
gm1rO1
(8.3)
I1
I1
M1
M1
C1
C2
VDD
VDD
Vout
Vout
Vin
Vin
X
(a)
(b)
Figure 8.3
(a) Simple common-source stage; (b) circuit of (a) with feedback.

276
Chap. 8
Feedback
If gm1rO1 is sufﬁciently large, the 1/(gm1rO1) terms in the denominator can be neglected, yielding
Vout
Vin
= −C1
C2
(8.4)
Compared to gm1rO1, this gain can be controlled with much higher accuracy because it is given by the ratio
of two capacitors. If C1 and C2 are made of the same material, then process and temperature variations
do not change C1/C2.
The above example reveals that negative feedback provides gain “desensitization,” i.e., the closed-loop
gain is less sensitive to device parameters than the open-loop gain is. One may also say that negative
feedback “stabilizes” the gain and hence “improves the stability.” But this nomenclature may be confused
with frequency stability (Chapter 10), which typically worsens as a result of negative feedback. Illustrated
for a more general case in Fig. 8.4, gain desensitization can be quantiﬁed by writing
Y
X =
A
1 + β A
(8.5)
≈1
β

1 −1
β A

(8.6)
where we have assumed that β A ≫1. We note that the closed-loop gain is determined, to the ﬁrst order
by the feedback factor, β. More important, even if the open-loop gain, A, varies by a factor of, say, 2,
Y/X varies by a small percentage because 1/(β A) ≪1.
X
Y
A
β
Figure 8.4
Simple feedback system.
Called the “loop gain,” the quantity β A plays an important role in feedback systems.1 We see from
(8.6) that the higher β A is, the less sensitive Y/X will be to variations in A. From another perspective,
the accuracy of the closed-loop gain improves by maximizing β A. Note that as β increases, the closed-
loop gain, Y/X ≈1/β, decreases, suggesting a trade-off between precision and the closed-loop gain. In
other words, we begin with a high-gain ampliﬁer and apply feedback to obtain a low, but less sensitive,
closed-loop gain. Another conclusion here is that the output of the feedback network is equal to βY =
X · β A/(1 + β A), approaching X as β A becomes much greater than unity. This result agrees with the
illustration in Fig. 8.2.
The calculation of the loop gain can proceed as follows. As illustrated in Fig. 8.5, we set the main
input to (ac) zero, break the loop at some point, inject a test signal in the “right direction,” follow the
signal around the loop, and obtain the value that returns to the break point. The negative of the transfer
function thus derived is the loop gain. Note that the loop gain is a dimensionless quantity. In Fig. 8.5,
we have Vtβ(−1)A = VF and hence VF/Vt = −β A. Similarly, as depicted in Fig. 8.6, for the simple
feedback circuit, we can write VX = VtC2/(C1 + C2) and2
Vt
C2
C1 + C2
(−gm1rO1) = VF
(8.7)
1The loop gain, β A, and the open-loop gain, A, must not be confused with each other.
2A common mistake here is to say that C2 does not pass signals at very low frequencies, and hence VX = 0. This is not true
because C1 also has a high impedance at very low frequencies.

Sec. 8.1
General Considerations
277
A
β
Vt
VF
X(s) = 0
Figure 8.5
Computation of loop gain.
I1
C2
C1
M1
VF
Vt
VDD
X
Figure 8.6
Computation of loop gain
in a simple feedback circuit.
That is
VF
Vt
= −
C2
C1 + C2
gm1rO1
(8.8)
Note that the current drawn by C2 from the output is neglected here. This issue will be addressed in
Sec. 8.5.
▲
Example8.1
Determine the loop gain for the feedback common-gate stage shown in Fig. 8.7(a).
C1
C2
C1
C1
C2
C2
VDD
VDD
VDD
M1
M1
M1
Vout
Vout
Vout
(a)
(b)
(c)
Vin
Figure 8.7
Solution
In order to compute the loop gain, we must ﬁrst set the main input to (ac) zero, arriving at the arrangement shown
in Fig. 8.7(b). Redrawing the circuit as in Fig. 8.7(c), we recognize that this topology is identical to the CS stage of
Fig. 8.3(b) with Vin = 0. The loop gain is therefore given by Eq. (8.8).
The important point here is that, when computing the loop gain, we no longer know where the main input and
output terminals are. Thus, seemingly different circuit topologies may have the same loop gain.
▲

278
Chap. 8
Feedback
We should emphasize that the desensitization of gain by feedback leads to many other properties of
feedback systems. Our examination of Eq. (8.6) indicates that large variations in A affect Y/X negligibly
if β A is large. Such variations can arise from different sources: process, temperature, frequency, and
loading. For example, if A drops at high frequencies, Y/X varies to a lesser extent, and the bandwidth is
increased. Similarly, if A decreases because the ampliﬁer drives a heavy load, Y/X is not affected much.
These concepts become clearer below.
Terminal Impedance Modiﬁcation
As a second example, let us study the circuit shown in Fig. 8.8(a),
where a capacitive voltage divider senses the output voltage of a common-gate stage, applying the
result to the gate of current source M2 and hence returning a signal to the input.3 Our objective is to
compute the input resistance at relatively low frequencies with and without feedback. Neglecting channel-
length modulation and the current drawn by C1, we break the feedback loop as shown in Fig. 8.8(b)
and write
Rin,open =
1
gm1 + gmb1
(8.9)
RD
C1
C2
Vb
VDD
P
M2
M1
Rin
RD
C1
C2
C1
C2
Vb
VDD
P
M2
M1
Rin
(c)
(a)
(b)
RD
Vb
VDD
P
M2
M1
VX
IX
Vout
Vout
Vout
Vin
Figure 8.8
(a) Common-gate circuit with feedback; (b) open-loop circuit; (c) calculation of input resistance.
For the closed-loop circuit, as depicted in Fig. 8.8(c), we write Vout = (gm1 + gmb1)VX RD and
VP = Vout
C1
C1 + C2
(8.10)
= (gm1 + gmb1)VX RD
C1
C1 + C2
(8.11)
Thus, the small-signal drain current of M2 equals gm2(gm1 + gmb1)VX RDC1/(C1 + C2). Adding this
current to the drain current of M1 with proper polarity yields IX:
IX = (gm1 + gmb1)VX + gm2(gm1 + gmb1)
C1
C1 + C2
RDVX
(8.12)
= (gm1 + gmb1)

1 + gm2RD
C1
C1 + C2

VX
(8.13)
3The bias network for M2 is not shown.

Sec. 8.1
General Considerations
279
It follows that
Rin,closed = VX/IX
(8.14)
=
1
gm1 + gmb1
1
1 + gm2RD
C1
C1 + C2
(8.15)
We therefore conclude that this type of feedback reduces the input resistance by a factor of 1 +
gm2RDC1/(C1 + C2). The reader can prove that the quantity gm2RDC1/(C1 + C2) is the loop gain.
Let us now consider the circuit of Fig. 8.9(a) as an example of output impedance modiﬁcation by
feedback. Here M1, RS, and RD constitute a common-source stage and C1, C2, and M2 sense the output
voltage,4 returning a current equal to [C1/(C1 + C2)]Voutgm2 to the source of M1. The reader can prove
that the feedback is indeed negative. To compute the output resistance at relatively low frequencies, we
set the input to zero [Fig. 8.9(b)] and write
ID1 = VX
C1
C1 + C2
gm2
RS
RS +
1
gm1 + gmb1
(8.16)
M2
Vout
C1
C2
C1
C2
P
RD
VDD
RD
VDD
M1
M2
M1
(a)
(b)
VX
IX
Vin
RS
RS
P
Figure 8.9
(a) CS stage with feedback; (b) calculation of output resistance.
Since IX = VX/RD + ID1, we have
VX
IX
=
RD
1 + gm2RS(gm1 + gmb1)RD
(gm1 + gmb1)RS + 1
C1
C1 + C2
(8.17)
Equation (8.17) implies that this type of feedback decreases the output resistance. The denominator of
(8.17) is indeed equal to one plus the loop gain.
Bandwidth Modiﬁcation.
The next example illustrates the effect of negative feedback on the band-
width. Suppose the feedforward ampliﬁer has a one-pole transfer function:
A(s) =
A0
1 + s
ω0
(8.18)
4Biasing of M2 is not shown.

280
Chap. 8
Feedback
where A0 denotes the low-frequency gain and ω0 is the 3-dB bandwidth. What is the transfer function of
the closed-loop system? From (8.5), we have
Y
X (s) =
A0
1 + s
ω0
1 + β
A0
1 + s
ω0
(8.19)
=
A0
1 + β A0 + s
ω0
(8.20)
=
A0
1 + β A0
1 +
s
(1 + β A0)ω0
(8.21)
The numerator of (8.21) is simply the closed-loop gain at low frequencies—as predicted by (8.5)—and
the denominator reveals a pole at (1 + β A0)ω0. Thus, the 3-dB bandwidth has increased by a factor of
1 + β A0, albeit at the cost of a proportional reduction in the gain (Fig. 8.10).
X(s)
Y(s)
β
ω
A0
1
β
││
A0
1 + βA0
(1 + βA0) ω0
Y
X
ω0
Figure 8.10
Bandwidth modiﬁcation as a result of feedback.
The increase in the bandwidth fundamentally originates from the gain desensitization property of
feedback. Recall from (8.6) that, if A is large enough, the closed-loop gain remains approximately equal
to 1/β even if A experiences substantial variations. In the example of Fig. 8.10, A varies with frequency
rather than process or temperature, but negative feedback still suppresses the effect of this variation. Of
course, at high frequencies, A drops to such low levels that β A becomes comparable with unity and the
closed-loop gain falls below 1/β.
Equation (8.21) suggests that the “gain-bandwidth product” of a one-pole system is equal to A0ω0 and
does not change much with feedback, making the reader wonder how feedback improves the speed if a
high gain is required. Suppose we need to amplify a 20-MHz square wave by a factor of 100 and maximum
bandwidth, but we have only a single-pole ampliﬁer with an open-loop gain of 100 and 3-dB bandwidth of
10 MHz. If the input is applied to the open-loop ampliﬁer, the response appears as shown in Fig. 8.11(a),
exhibiting a long risetime and falltime because the time constant is equal to 1/(2π f3-dB) ≈16 ns.
Now suppose we apply feedback to the ampliﬁer such that the gain and bandwidth are modiﬁed to
10 and 100 MHz, respectively. Placing two of these ampliﬁers in a cascade [Fig. 8.11(b)], we obtain a
much faster response with an overall gain of 100. Of course, the cascade consumes twice as much power,
but it would be quite difﬁcult to achieve this performance with the original ampliﬁer even if its power
dissipation were doubled.
Nonlinearity Reduction
An important property of negative feedback is the reduction of nonlinearity
in analog circuits. A nonlinear characteristic is one that departs from a straight line, i.e., one whose slope
varies (Fig. 8.12). A familiar example is the input-output characteristic of differential pairs. Note that

Sec. 8.1
General Considerations
281
Vin
Vin
Vin
Vin
Vout
Vout
Vout
Vout
Av = 100
Av = 10
Av = 10
t
t
(a)
(b)
τ
16 ns
τ
1.6 ns
 f3−dB = 10 MHz
 f3−dB = 100 MHz  f3−dB = 100 MHz
Figure 8.11
Ampliﬁcation of a 20-MHz square wave by (a) a 10-MHz ampliﬁer and (b) a cascade of two
100-MHz feedback ampliﬁers.
Vin
Vin
Vout
Vout
A1
A2
β
1
(a)
(b)
Figure 8.12
Input-output characteristic of a nonlinear ampliﬁer (a) before and (b) after applying feedback.
the slope can be viewed as the small-signal gain. We predict that, even though the gain of an open-loop
ampliﬁer varies from A1 to A2 in Fig. 8.12, a closed-loop feedback system incorporating such an ampliﬁer
exhibits less gain variation and hence a higher linearity. To quantify this effect, we note that the open-loop
gain ratio between regions 1 and 2 in Fig. 8.12 is equal to
ropen = A2
A1
(8.22)
For example, ropen = 0.9 means that the gain falls by 10% from region 1 to region 2. Assuming A2 =
A1 −A, we can write
ropen = 1 −A
A1
(8.23)
Let us place this ampliﬁer in a negative-feedback loop. For the closed-loop gain ratio, we have
rclosed =
A2
1 + β A2
A1
1 + β A1
(8.24)
=
1 +
1
β A1
1 +
1
β A2
(8.25)

282
Chap. 8
Feedback
It follows that
rclosed ≈1 −
1
β A2
−
1
β A1
1 +
1
β A2
(8.26)
≈1 −A1 −A2
1 + β A2
1
A1
(8.27)
≈1 −
A
1 + β A2
1
A1
(8.28)
Comparison of (8.23) and (8.28) suggests that the gain ratio is much closer to 1 in the latter if the loop
gain, 1 + β A2, is large.
We study nonlinearity and its behavior in feedback systems more extensively in Chapter 14.
8.1.2 Types of Ampliﬁers
Most of the circuits studied thus far can be considered “voltage ampliﬁers” because they sense a voltage
at the input and produce a voltage at the output. However, three other types of ampliﬁers can also be
constructed such that they sense or produce currents. Shown in Fig. 8.13, the four conﬁgurations have
quite different properties: (1) circuits sensing a voltage must exhibit a high input impedance (a voltmeter
measures a voltage with minimal loading) whereas those sensing a current must provide a low input
impedance (a current meter inserted in a wire must negligibly disturb the current); (2) circuits generating
a voltage must exhibit a low output impedance (as a voltage source) while those generating a current
must provide a high output impedance (as a current source). Note that the gains of transimpedance and
transconductance5 ampliﬁers have a dimension of resistance and conductance, respectively. For example,
a transimpedance ampliﬁer may have a gain of 2 k, which means that it produces a 2-V output in
response to a 1-mA input. Also, we use the sign conventions depicted in Fig. 8.13; for example, the
transimpedance R0 = Vout/Iin if Iin ﬂows into the ampliﬁer.
Vout
Vout
Vout
Vout
Voltage Amp.
Transimpedance Amp.
Iin
Vin
Vin
Vin
Vin
Transconductance Amp.
Iout
Iout
Iin
Current  Amp.
(c)
(a)
(b)
(d)
Iin
Iout
Iin
Iout
Figure 8.13
Types of ampliﬁers along with their idealized models.
5This terminology is standard but not consistent. One should use either transimpedance and transadmittance or transresistance
and transconductance.

Sec. 8.1
General Considerations
283
M1
M1
M1
M1
VDD
RD
VDD
RD
Vin
Vout
Vout
Vb
Iin
Vin
Iout
Iout
Vb
Iin
(c)
(a)
(b)
(d)
Figure 8.14
Simple implementations of four types of ampliﬁers.
Figure 8.14 illustrates simple implementations of each ampliﬁer. In Fig. 8.14(a), a common-source
stage senses and produces Voltages, and in Fig. 8.14(b), a common-gate circuit serves as a transimpedance
ampliﬁer, converting the source current to a voltage at the drain. In Fig. 8.14(c), a common-source
transistor operates as a transconductance ampliﬁer (also called a V/I converter), generating an output
current in response to an input voltage, and in Fig. 8.14(d), a common-gate device senses and produces
currents.
The circuits of Fig. 8.14 may not provide adequate performance in many applications. For example,
the circuits of Figs. 8.14(a) and (b) suffer from a relatively high output impedance. Figure 8.15 depicts
modiﬁcations that alter the output impedance or increase the gain.
M1
RD
Vin
Vout
RD
Vb
M1
M1
Iin
M2
Iout
Vb
M1
Iin
(c)
(a)
(b)
(d)
VDD
M2
Vout
VDD
M2
RD
Vin
M2
Iout
RD
VDD
VDD
X
Figure 8.15
Four types of ampliﬁers with improved performance.
▲
Example8.2
Calculate the gain of the transconductance ampliﬁer shown in Fig. 8.15(c).
Solution
The gain in this case is deﬁned as Gm = Iout/Vin. That is
Gm = VX
Vin
· Iout
VX
(8.29)
= −gm1(rO1∥RD) · gm2
(8.30)
▲
While most familiar ampliﬁers are of the voltage-voltage type, the other three conﬁgurations do ﬁnd
usage. For example, transimpedance ampliﬁers are an integral part of optical ﬁber receivers because they
must sense the current produced by a photodiode, eventually generating a voltage that can be processed
by subsequent circuits.

284
Chap. 8
Feedback
▲
Example8.3
Reconstruct the models of Fig. 8.13 for nonideal ampliﬁers.
Solution
A nonideal voltage ampliﬁer draws current from its input and exhibits a ﬁnite output impedance, as depicted in
Fig. 8.16(a).
Zin
Vin
AvVin
Zout
Vout
Zout
Vout
Zin
Iin
Iin
R0Iin
Zin
Vin
GmVin
Zout
Zin
Iin
Iin
Iout
Zout
Iout
A0Iin
(c)
(a)
(b)
(d)
Figure 8.16
A nonideal transimpedance ampliﬁer may have ﬁnite input and output impedances [Fig. 8.16(b)]. Note that Zin
is in parallel with the input port in Fig. 8.16(a) and in series with the input port in Fig. 8.16(b). This is to ensure a
meaningful result in the ideal case: if Zin goes to inﬁnity in the former or to zero in the latter, the models reduce to
those of Fig. 8.13.
The reader is encouraged to justify the models shown in Figs. 8.16(c) and (d) for the other two ampliﬁer types.
We should mention that these ampliﬁers may also have internal feedback from their output to their input, e.g., due
to CGD, but we neglect that for now.
▲
8.1.3 Sense and Return Mechanisms
Placing a circuit in a feedback loop requires sensing the output signal and returning (a fraction) of the
result to the summing node at the input. With voltage or current quantities as input and output signals,
we can identify four types of feedback: voltage-voltage, voltage-current, current-current, and current-
voltage, where the ﬁrst entry in each case denotes the quantity sensed at the output and the second the
type of signal returned to the input.6
It is instructive to review methods of sensing and summing voltages or currents. To sense a voltage, we
place a voltmeter in parallel with the corresponding port [Fig. 8.17(a)], ideally introducing no loading.
(c)
(a)
(b)
Vout
RL
Iout
Voltmeter
Current Meter
RL
Iout
RS
VS
Figure 8.17
Sensing (a) a voltage by a voltmeter; (b) a current by a current meter; (c) a current by a small resistor.
6Different authors use different orders or terminologies for the four types of feedback.

Sec. 8.1
General Considerations
285
When used in a feedback system, this type of sensing is also called “shunt feedback” (regardless of the
quantity returned to the input).
To sense a current, a current meter is inserted in series with the signal [Fig. 8.17(b)], ideally exhibiting
zero series resistance. Thus, this type of sensing is also called “series feedback.” In practice, a small
resistor replaces the current meter [Fig. 8.17(c)], with the voltage drop across the resistor serving as a
measure of the output current.
The addition of the feedback signal and the input signal can be performed in the voltage domain or
current domain. To add two quantities, we place them in series if they are voltages and in parallel if they
are currents (Fig. 8.18).
Vin
VF
Iin
IF
(a)
(b)
Figure 8.18
Addition of (a) voltages
and (b) currents.
To visualize the methods of Figs. 8.17 and 8.18, we consider a number of practical implementations.
A voltage can be sensed by a resistive (or capacitive) divider in parallel with the port [Fig. 8.19(a)] and a
Vin
R2
R1
Vout
VF
Vin
R1
VF
VDD
Iout
Vin
R1
VF
Iout
Vin
Vin
Vin
R2
R1
R2
R1
R2
R1
Vout
Vout
Vout
VF
VF
VF
M1
M1
(c)
(a)
(b)
(d)
(e)
(f)
Iin
RF
IF
Iin
IF
(g)
(h)
Figure 8.19
Practical means of sensing and adding voltages and currents.

286
Chap. 8
Feedback
current by placing a small resistor in series with the wire and sensing the voltage across it [Figs. 8.19(b)
and (c)]. To subtract two voltages, a differential pair can be used [Fig. 8.19(d)]. Alternatively, a single
transistor can perform voltage subtraction as shown in Figs. 8.19(e) and (f) because ID1 is a function of
Vin −VF. Subtraction of currents can be accomplished as depicted in Fig. 8.19(g) or (h). Note that for
voltage subtraction, the input and feedback signals are applied to two distinct nodes, whereas for current
subtraction, they are applied to a single node. This observation proves helpful in identifying the type of
feedback.
While ideally having no inﬂuence on the operation of the open-loop ampliﬁer itself, the feedback
network in reality introduces loading effects that must be taken into account. This issue is discussed in
Sec. 8.5.
8.2
Feedback Topologies
In this section, we study four “canonical” topologies resulting from placing each of the four ampliﬁer
types in a negative-feedback loop. As depicted in Fig. 8.20, X and Y can be a current or a voltage quantity.
The main ampliﬁer is called the “feedforward” or simply the “forward” ampliﬁer, around which we apply
feedback to improve the performance.
X(s)
H(s)
Y(s)
G(s)
Forward Ampliﬁer
Feedback Network
Figure 8.20
Canonical feedback
system.
We should remark that some feedback circuits do not conform to the four canonical topologies. We
return to this point later in the chapter, but the intuition gained from the analysis of these topologies
proves essential to analog design. For example, we greatly beneﬁt from the knowledge that one type of
feedback lowers the output impedance while another raises it.
8.2.1 Voltage-Voltage Feedback
This topology senses the output voltage and returns the feedback signal as a voltage.7 Following the
conceptual illustrations of Figs. 8.17 and 8.18, we note that the feedback network is connected in parallel
with the output and in series with the input port (Fig. 8.21). An ideal feedback network in this case
exhibits inﬁnite input impedance and zero output impedance because it senses a voltage and generates a
voltage. We can therefore write VF = βVout, Ve = Vin −VF, Vout = A0(Vin −βVout), and hence
Vout
Vin
=
A0
1 + β A0
(8.31)
We recognize that β A0 is the loop gain and that the overall gain has dropped by 1 + β A0. Note that here
both A0 and β are dimensionless quantities.
As a simple example of voltage-voltage feedback, suppose we employ a differential voltage ampliﬁer
with single-ended output as the feedforward ampliﬁer and a resistive divider as the feedback network
7This conﬁguration is also called “series-shunt” feedback, where the ﬁrst term refers to the input connection and the second to
the output connection.

Sec. 8.2
Feedback Topologies
287
Feedforward
Ampliﬁer
Feedback
Network
Vout
High Rin
Vin
VF
A0
β
Low Rout
Ve
Figure 8.21
Voltage-voltage
feedback.
Vout
Vout
R1
R2
R1
R2
Vin
Vin
VF
(a)
(b)
A0
A0
Figure 8.22
(a) Ampliﬁer with output sensed by a resistive divider; (b) voltage-voltage feedback ampliﬁer.
Vin
VF
A0
Ve
Ve
Rout
β
RL Vout
Figure 8.23
Effect of voltage-voltage
feedback on output resistance.
[Fig. 8.22(a)]. The divider senses the output voltage, producing a fraction thereof as the feedback signal
VF. Following the block diagram of Fig. 8.21, we place VF in series with the input of the ampliﬁer to
perform subtraction of voltages [Fig. 8.22(b)].
How does voltage-voltage feedback modify the input and output impedances? Let us ﬁrst consider the
output impedance. Recall that a negative-feedback system attempts to make the output an accurate (scaled)
replica of the input. Now suppose, as shown in Fig. 8.23, we load the output by a resistor RL, gradually
decreasing its value. While in the open-loop conﬁguration, the output would simply drop in proportion to
RL/(RL + Rout), in the feedback system, Vout is maintained as a reasonable replica of Vin even though RL
decreases. That is, so long as the loop gain remains much greater than unity, Vout/Vin ≈1/β, regardless
of the value of RL. From another point of view, since the circuit stabilizes (“regulates”) the output voltage
amplitude despite load variations, it behaves as a voltage source, thus exhibiting a low output impedance.
This property fundamentally originates from the gain desensitization provided by feedback.
In order to formally prove that voltage feedback lowers the output impedance, we consider the simple
model in Fig. 8.24, where Rout represents the output impedance of the feedforward ampliﬁer. Setting the
input to zero and applying a voltage at the output, we write VF = βVX, Ve = −βVX, VM = −β A0VX,

288
Chap. 8
Feedback
A0
Ve
β
Rout
VM
VX
IX
VF
Figure 8.24
Calculation of output
resistance of a voltage-voltage feedback
circuit.
and hence IX = [VX −(−β A0VX)]/Rout (if the current drawn by the feedback network is neglected). It
follows that
VX
IX
=
Rout
1 + β A0
(8.32)
Thus, the output impedance and the gain are lowered by the same factor. In the circuit of Fig. 8.22(b),
for example, the output impedance is lowered by 1 + A0R2/(R1 + R2).
▲
Example8.4
The circuit shown in Fig. 8.25(a) is an implementation of the feedback conﬁguration depicted in Fig. 8.22(b), but
with the resistors replaced by capacitors. (The bias network of M2 is not shown.) Calculate the closed-loop gain and
output resistance of the ampliﬁer at relatively low frequencies.
VDD
VDD
M4
M1
M2
M1
M2
ISS
ISS
ISS
M3
M4
M3
VDD
M4
M3
C1
C2
X
C1
C2
M1
M2
C1
C2
X
X
VF
Vt
(c)
(a)
(b)
Vin
Vin
Vout
Vout
Simple Op Amp
Figure 8.25
Solution
At low frequencies, C1 and C2 draw a negligible current from the output node. To ﬁnd the open-loop voltage gain,
we break the feedback loop as shown in Fig. 8.25(b), grounding the top plate of C1 to ensure zero voltage feedback.
The open-loop gain is thus equal to gm1(rO2∥rO4).
We must also compute the loop gain, β A0. With the aid of Fig. 8.25(c), we have
VF = −Vt
C1
C1 + C2
gm1(rO2∥rO4)
(8.33)
That is
β A0 =
C1
C1 + C2
gm1(rO2∥rO4)
(8.34)

Sec. 8.2
Feedback Topologies
289
and hence
Aclosed =
gm1(rO2∥rO4)
1 +
C1
C1 + C2
gm1(rO2∥rO4)
(8.35)
As expected, if β A0 ≫1, then Aclosed ≈1 + C2/C1.
The open-loop output resistance of the circuit is equal to rO2∥rO4 (Chapter 5). It follows that
Rout,closed =
rO2∥rO4
1 +
C1
C1 + C2
gm1(rO2∥rO4)
(8.36)
It is interesting to note that if β A0 ≫1, then
Rout,closed ≈

1 + C2
C1

1
gm1
(8.37)
In other words, even if the open-loop ampliﬁer suffers from a high output resistance, the closed-loop output resistance
is independent of rO2∥rO4, simply because the open-loop gain scales with rO2∥rO4 as well.
▲
▲
Example8.5
Figure 8.26(a) shows an inverting ampliﬁer using an op amp, and Fig. 8.26(b) illustrates a circuit implementation
incorporating capacitors rather than resistors for the feedback network. Determine the loop gain and output impedance
of the latter at low frequencies.
R1
R2
Vin
Vout
VDD
M3
M1
M2
M4
Vb
C1
C2
Vin
Vout
(a)
(b)
Vin
Vout
C1
C2
Figure 8.26
Solution
With Vin set to zero, this circuit becomes indistinguishable from that in Fig. 8.25(a). Thus, the loop gain is given by
(8.34) and the output impedance by (8.36).
The circuits in Figs. 8.25(a) and 8.26(b) appear similar, but provide different closed-loop gains, approximately
1 + C2/C1 and −C2/C1, respectively. Thus, for a gain of, say, 4, C2/C1 ≈3 in the former and C2/C1 ≈4 in the
latter. Which topology exhibits a higher loop gain in this case?
▲

290
Chap. 8
Feedback
Voltage-voltagefeedbackalsomodiﬁestheinputimpedance.ComparingtheconﬁgurationsinFig.8.27,
we note that the input impedance of the feedforward ampliﬁer sustains the entire input voltage in
Fig. 8.27(a), but only a fraction of Vin in Fig. 8.27(b). As a result, the current drawn by Rin in the
feedback topology is less than that in the open-loop system, suggesting that returning a voltage quantity
to the input increases the input impedance.
A0Ve
Ve
Rout
VF
β
RL
Vout
Rout
Vout
Vin
Ve
Vin
Iin
(a)
(b)
Rin
A0Ve
Rin
Figure 8.27
Effect of voltage-voltage feedback on input resistance.
The foregoing observation can be conﬁrmed analytically with the aid of Fig. 8.28. Since Ve = IX Rin
and VF = β A0IX Rin, we have Ve = VX −VF = VX −β A0IX Rin. Thus, IX Rin = VX −β A0IX Rin, and
VX
IX
= Rin(1 + β A0)
(8.38)
The input impedance therefore increases by the ubiquitous factor 1 + β A0, bringing the circuit closer to
an ideal voltage ampliﬁer.
A0
Ve
β
IX
VF
VX
Rin
Figure 8.28
Calculation of input
impedance of a voltage-voltage feedback
circuit.
▲
Example8.6
Figure 8.29(a) shows a common-gate topology placed in a voltage-voltage feedback conﬁguration. Note that the
summation of the feedback voltage and the input voltage is accomplished by applying the former to the gate and the
latter to the source.8 Calculate the input resistance at low frequencies if channel-length modulation is negligible.
Solution
Breaking the loop as depicted in Fig. 8.29(b), we recognize that the open-loop input resistance is equal to (gm1 +
gmb1)−1. To ﬁnd the loop gain, we set the input to zero and inject a test signal in to the loop [Fig. 8.29(c)], obtaining
VF/Vt = −gm1RDC1/(C1 + C2). The closed-loop input impedance is then equal to
Rin,closed =
1
gm1 + gmb1

1 +
C1
C1 + C2
gm1RD

(8.39)
8This circuit is similar to the right half of the topology shown in Fig. 8.25(a).

Sec. 8.2
Feedback Topologies
291
RD
C1
C2
VDD
P
M1
Vout
RD
VDD
RD
VDD
Vout
Vin
C1
C2
M1
C1
C2
M1
Vin
P
P
Vt
VF
(c)
(a)
(b)
Figure 8.29
The increase in the input impedance can be explained as follows. Suppose the input voltage decreases by V , causing
the output voltage to fall. As a result, the gate voltage of M1 decreases, thereby lowering the gate-source voltage of
M1 and yielding a change in VGS1 that is less than V . This means that the drain current changes by an amount less
than (gm + gmb)V . By contrast, if the gate of M1 were connected to a constant potential, the gate-source voltage
would change by V , resulting in a larger current change.
▲
In summary, voltage-voltage feedback decreases the output impedance and increases the input imped-
ance, thereby proving useful as a “buffer” stage that can be interposed between a high-impedance source
and a low-impedance load.
8.2.2 Current-Voltage Feedback
In some circuits, it is desirable or simpler to sense the output current to perform feedback. The current
is actually sensed by placing a (preferably small) resistor in series with the output and using the voltage
drop across the resistor as the feedback information. This voltage may even serve as the return signal that
is directly subtracted from the input.
Feedforward
Ampliﬁer
Feedback
Network
Vin
VF
Low Rout
Ve
Gm
RF
ZL
Iout
Low Rin
Iout
Figure 8.30
Current-voltage
feedback.
Let us consider the general current-voltage feedback system illustrated in Fig. 8.30.9 Since the feedback
network senses the output current and returns a voltage, its feedback factor, β, has the dimension of
resistance and is denoted by RF. It is important to note that a Gm stage must be loaded (“terminated”)
by a ﬁnite impedance, ZL, to ensure that it can deliver its output current. If ZL = ∞, then an ideal Gm
9This topology is also called “series-series” feedback.

292
Chap. 8
Feedback
stage would sustain an inﬁnite output voltage. We write VF = RF Iout, Ve = Vin −RF Iout, and hence
Iout = Gm(Vin −RF Iout). It follows that
Iout
Vin
=
Gm
1 + Gm RF
(8.40)
An ideal feedback network in this case exhibits zero input and output impedances.
It is instructive to conﬁrm that Gm RF is indeed the loop gain. As shown in Fig. 8.31, we set the input
voltage to zero and break the loop by disconnecting the feedback network from the output and replacing
it with a short at the output (if the feedback network is ideal). We then inject the test signal It, producing
VF = RF It, and hence Iout = −Gm RF It. Thus, the loop gain is equal to Gm RF and the transconductance
of the ampliﬁer is reduced by 1 + Gm RF when feedback is applied.
Gm
RF
ZL
It
Iout
Short
VF
Figure 8.31
Calculation of loop gain
for current-voltage feedback.
Is it realistic to assume that the input impedance of the feedback network is zero? Why do we use
a test current rather than a test voltage? Does the type of test source affect the loop gain calculations?
These questions are addressed later in this chapter.
Sensing the current at the output of a feedback system increases the output impedance. This is because
the system attempts to make the output current a faithful replica of the input signal (with a proportionality
factor if the input is a voltage quantity). Consequently, the system delivers the same current waveform
as the load varies, in essence approaching an ideal current source and hence exhibiting a high output
impedance.
VX
IX
RF
IX
Gm
Rout
VF
Figure 8.32
Calculation of output
resistance of a current-voltage feedback
ampliﬁer.
To prove the above result, we consider the current-voltage feedback topology shown in Fig. 8.32, where
Rout represents the ﬁnite output impedance of the feedforward ampliﬁer.10 The feedback network produces
a voltage VF proportional to IX:VF = RF IX, and the current generated by Gm equals −RF IXGm. As a
10Note that Rout is placed in parallel with the output because the ideal transimpedance ampliﬁer is modeled by a voltage-
dependent current source.

Sec. 8.2
Feedback Topologies
293
result, −RF IXGm = IX −VX/Rout, yielding
VX
IX
= Rout(1 + Gm RF)
(8.41)
The output impedance therefore increases by a factor of 1 + Gm RF.
▲
Example8.7
Rechargeable batteries must be charged by a constant current (rather than a constant voltage) to avoid damage. The
battery charger must therefore generate a constant current from a golden reference, VRE F. As shown in Fig. 8.33(a),
we can insert a small resistor r in the output current path, apply the voltage across r to an ampliﬁer A1, and subtract
the output of A1 from VRE F. Calculate the output current and impedance of this circuit, assuming |ZL| ≪rO (the
output resistance of M1).
r
A1
(a)
(b)
VREF
Iout
M1
M1
r
A1
Vt
VF
ZL
Rechargeable 
Battery
ZL
Figure 8.33
Solution
With a high loop gain, the output voltage of A1 is approximately equal to VRE F, and hence Iout = (VRE F/A1)/r.
Using the circuit of Fig. 8.33(b) to determine the loop gain, we have
VF
Vt
≈−gmr A1
(8.42)
Thus, the open-loop output impedance seen by ZL is multiplied by 1 + gmr A1, yielding
Rout,closed = (1 + gmr A1)(rO + r)
(8.43)
We observe that ZL is now driven by a better current source.
▲
As with voltage-voltage feedback, current-voltage feedback increases the input impedance by a factor
equal to one plus the loop gain. As illustrated in Fig. 8.34, we have IX RinGm = Iout. Thus, Ve =
VX −Gm RF IX Rin and
VX
IX
= Rin(1 + Gm RF)
(8.44)
The reader can show that the loop gain is indeed equal to Gm RF.
In summary, current-voltage feedback increases both the input and the output impedances while
decreasing the feedforward transconductance. As explained in Chapter 9, the high output impedance
proves useful in high-gain op amps.

294
Chap. 8
Feedback
IX
RF Iout
Gm
Rin
VF
VX
Ve
Iout
Figure 8.34
Calculation of input
resistance of a current-voltage feedback
ampliﬁer.
8.2.3 Voltage-Current Feedback
In this type of feedback, the output voltage is sensed and a proportional current is returned to the summing
point at the input.11 Note that the feedforward path incorporates a transimpedance ampliﬁer with gain R0
and the feedback factor has a dimension of conductance.
A voltage-current feedback topology is shown in Fig. 8.35. Sensing a voltage and producing a current,
the feedback network is characterized by a transconductance gmF, ideally exhibiting inﬁnite input and
output impedances. Since IF = gmFVout and Ie = Iin −IF, we have Vout = R0Ie = R0(Iin −gmFVout).
It follows that
Vout
Iin
=
R0
1 + gmF R0
(8.45)
The reader can prove that gmF R0 is indeed the loop gain, concluding that this type of feedback lowers
the transimpedance by a factor equal to one plus the loop gain.
Feedforward
Ampliﬁer
Feedback
Network
Vout
High Rin
R0
gmF
High Rout
IF
Ie
Iin
Figure 8.35
Voltage-current feedback.
▲
Example8.8
Calculate the transimpedance, Vout/Iin, of the circuit shown in Fig. 8.36(a) at relatively low frequencies. Assume
that λ = 0. (The bias network of M1 is not shown.)
Solution
In this circuit, the capacitive divider C1-C2 senses the output voltage, applying the result to the gate of M1 and
producing a current that is subtracted from Iin. The open-loop transimpedance equals that of the core common-gate
stage, RD. The loop gain is obtained by setting Iin to zero and breaking the loop at the output [Fig. 8.36(b)]:
−Vt
C1
C1 + C2
gm1RD = VF
(8.46)
11This topology is also called “shunt-shunt” feedback.

Sec. 8.2
Feedback Topologies
295
RD
C1
C2
Vb
Vb
VDD
RD
VDD
P
M1
M2
C1
C2
M1
M2
(a)
(b)
Iin
Vout
P
Vt
VF
Figure 8.36
Thus, the overall transimpedance is equal to
Rtot =
RD
1 +
C1
C1 + C2
gm1RD
(8.47)
▲
▲
Example8.9
We know from the previous example that
Rin =
1
gm2
1
1 +
C1
C1 + C2
gm1RD
(8.48)
A student repeats the analysis, but with the input driven by a voltage source, concluding that the loop gain is zero
and the input impedance is not affected by the feedback loop. Explain the ﬂaw in the student’s argument.
Solution
Consider the arrangement shown in Fig. 8.37(a). We know that Rin is affected by the feedback because M1 generates
a current in response to Vin. On the other hand, it appears from Fig. 8.37(b) that the loop gain is zero in this case.
How do we reconcile these two views?
RD
C1
C2
C1
C2
Vb
Vb
VF
VDD
RD
VDD
P
M1
M2
M1
M2
(a)
(b)
Vout
P
Vt
Vin
Iin
Rin
Figure 8.37
We must recall that returning current to the input assumes that the circuit is driven by a current source; i.e., our
generic negative-feedback system requires that the returned quantity and the input have the same dimension. In other

296
Chap. 8
Feedback
words, the circuit of Fig. 8.37(a) does not map to our canonical feedback system because it returns a current but is
driven by a voltage. We therefore cannot compute the loop gain by setting the input voltage to zero and breaking the
loop. Of course, the input impedance is still given by Eq. (8.48). We will return to this circuit in Sec. 8.6.4 and apply
Blackman’s theorem to it.
▲
Following our reasoning for the other two types of feedback studied above, we surmise that voltage-
current feedback decreases both the input and the output impedances. As shown in Fig. 8.38(a) and noted
in Example 8.3, the input resistance of R0 appears in series with its input port. We write IF = IX −VX/Rin
and (VX/Rin)R0gmF = IF. Thus,
VX
IX
=
Rin
1 + gmF R0
(8.49)
(a)
(b)
IX
gmF
Ie
R0
Vout
gmF
VX
IF
Vout
Iin = 0
IF
Rout
VX
IX
VM
Rin
Ie
R0
Rin
Figure 8.38
Calculation of (a) input and (b) output impedance of a voltage-current feedback ampliﬁer.
Similarly, from Fig. 8.38(b), we have IF = VXgmF, Ie = −IF, and VM = −R0gmFVX. Neglecting
the input current of the feedback network, we write IX = (VX −VM)/Rout = (VX + gmF R0VX)/Rout.
That is
VX
IX
=
Rout
1 + gmF R0
(8.50)
▲
Example8.10
Calculate the input and output impedances of the circuit shown in Fig. 8.39(a). For simplicity, assume that RF ≫RD.
M1
M1
VDD
RD
VDD
RD
RF
RF
Vout
Iin
Vt
VF
(a)
(b)
Figure 8.39

Sec. 8.2
Feedback Topologies
297
Solution
In this circuit, RF senses the output voltage and returns a current to the input. Breaking the loop as depicted
in Fig. 8.39(b), we calculate the loop gain as gm RD. Thus, the open-loop input impedance, RF, is divided by
1 + gm RD:
Rin,closed =
RF
1 + gm RD
(8.51)
Similarly,
Rout,closed =
RD
1 + gm RD
(8.52)
=
1
gm
||RD
(8.53)
Note that Rout,closed is in fact the parallel combination of a diode-connected transistor and RD.
The reduction of the input impedance agrees with Miller’s prediction: since the voltage gain from the gate of M1
to its drain is approximately equal to −gm RD, the feedback resistor equivalently produces a grounded resistance at
the input equal to RF/(1 + gm RD).
▲
An important application of ampliﬁers with low input impedance is in ﬁber optic receivers, where light
received through a ﬁber is converted to a current by a reverse-biased photodiode. This current is typically
converted to a voltage for further ampliﬁcation and processing. Shown in Fig. 8.40(a), such conversion
can be accomplished by a simple resistor, but at the cost of bandwidth because the diode suffers from
a relatively large junction capacitance. For this reason, the feedback topology of Fig. 8.40(b) is usually
employed, where R1 is placed around the voltage ampliﬁer A to form a “transimpedance ampliﬁer” (TIA).
The input impedance is R1/(1 + A) and the output voltage is approximately −R1ID1. The bandwidth
thus increases from 1/(2π R1CD1) to (1 + A)/(2π R1CD1) if A itself is a wideband ampliﬁer.
D1
CD1
D1
CD1
R1
Optical Fiber
Optical Fiber
R1
(a)
(b)
−A
Vout
Vout
Transimpedance
Ampliﬁer
ID
ID
Figure 8.40
Detection of current produced by a photodiode by (a) resistor R1 and (b) a transimpedance ampliﬁer.
8.2.4 Current-Current Feedback
Figure 8.41 illustrates this type of feedback.12 Here, the feedforward ampliﬁer is characterized by a
current gain, AI, and the feedback network by a current ratio, β. In a fashion similar to the previous
derivations, the reader can easily prove that the closed-loop current gain is equal to AI/(1 + β AI), the
input impedance is divided by 1 + β AI and the output impedance is multiplied by 1 + β AI.
12This topology is also called “shunt-series” feedback, where the ﬁrst term refers to the input connection and the second to the
output connection.

298
Chap. 8
Feedback
AI
β
Feedforward
Ampliﬁer
Feedback
Network
ZL
Iout
Iout
Low Rin
High Rout
IF
Ie
Iin
Figure 8.41
Current-current feedback.
M1
VDD
RD
Iin
M2
RS
RF
Iout
X
Y
Figure 8.42
Figure 8.42 illustrates an example of current-current feedback. Here, since the source and drain currents
of M2 are equal (at low frequencies), resistor RS is inserted in the source network to monitor the output
current. Resistor RF plays the same role as in Fig. 8.39.
8.3
Effect of Feedback on Noise
Feedback does not improve the noise performance of circuits. Let us ﬁrst consider the simple case
illustrated in Fig. 8.43(a), where the open-loop voltage ampliﬁer A1 is characterized by only an input-
referred noise voltage and the feedback network is noiseless. We have (Vin −βVout + Vn)A1 = Vout,
and hence
Vout = (Vin + Vn)
A1
1 + β A1
(8.54)
β
A1
Vn
Vn
β
Vin
Vin
Vout
Vout
A1
(a)
(b)
Figure 8.43
Feedback around a noisy circuit.

Sec. 8.4
Feedback Analysis Difﬁculties
299
Thus, the circuit can be simpliﬁed as shown in Fig. 8.43(b), revealing that the input-referred noise of the
overall circuit is still equal to Vn. This analysis can be extended to all four feedback topologies to prove
that the input-referred noise voltage and current remain the same if the feedback network introduces no
noise. In practice, the feedback network itself may contain resistors or transistors, degrading the overall
noise performance.
It is important to note that in Fig. 8.43(a), the output of interest is the same as the quantity sensed
by the feedback network. This need not always be the case. For example, in the circuit of Fig. 8.44, the
output is provided at the drain of M1 whereas the feedback network senses the voltage at the source
of M1. In such cases, the input-referred noise of the closed-loop circuit may not be equal to that of the
open-loop circuit even if the feedback network is noiseless. As an example, let us consider the topology
of Fig. 8.44 and, for simplicity, take only the noise of RD, Vn,RD, into account. The reader can prove that
the closed-loop voltage gain is equal to −A1gm RD/[1 + (1 + A1)gm RS] if λ = γ = 0, and hence the
input-referred noise voltage due to RD is
Vn,in,closed
 = |Vn,RD|
A1RD
 1
gm
+ (1 + A1)RS

(8.55)
VDD
RD
M1
RS
Vout
Vin
A1
Figure 8.44
Noisy circuit with
feedback sensing the source voltage.
For the open-loop circuit, on the other hand, the input-referred noise is
Vn,in,open
 = |Vn,RD|
A1RD
 1
gm
+ RS

(8.56)
Interestingly, as A1 →∞, |Vn,in,closed| →|Vn,RD|RS/RD whereas |Vn,in,open| →0.
8.4
Feedback Analysis Difﬁculties
Our study of feedback systems has made some simplifying assumptions that may not hold in all circuits. In
this section, we point out ﬁve difﬁculties that arise in the analysis of feedback circuits, and in subsequent
sections, we deal with some of them.
The analysis approach described previously proceeds as follows: (a) break the loop and obtain the
open-loop gain and input and output impedances, (b) determine the loop gain, β A0, and hence the closed-
loop parameters from their open-loop counterparts, and (c) use the loop gain to study properties such as
stability (Chapter 10), etc. However, this approach faces issues in some circuits.
The ﬁrst difﬁculty relates to breaking the loop and stems from the “loading” effects imposed by
the feedback network upon the feedforward ampliﬁer. For example, in the noninverting ampliﬁer of
Fig. 8.45(a) and its simple implementation shown in Fig. 8.45(b), the feedback branch consisting of R1
and R2 may draw a signiﬁcant signal current from the op amp, reducing its open-loop gain. Figure 8.45(c)
depicts another case, in which the open-loop gain of the forward CS stage falls if RF is not very large. In
both cases, this “output” loading results from the nonideal input impedance of the feedback network.

300
Chap. 8
Feedback
Vin
Vout
Vout
Vout
Vout
M4
M1
M1
M1
M2
M2
M3
Vin
Vin
(b)
R2
R1
R2
R1
(a)
Op Amp
VDD
VDD
RF
RS
RD1
Vin
R2
RD2
R1
VF
(c)
(d)
RD
Figure 8.45
(a) Noninverting ampliﬁer, (b) implementation using a differential pair, (c) implementation using a
CS stage, and (d) implementation using a two-stage ampliﬁer.
As another example, consider the arrangement shown in Fig. 8.45(d), where R1 and R2 sense Vout and
return a voltage to the source of M1. Since the output impedance of the feedback network may not be
sufﬁciently small, we surmise that M1 is degenerated appreciably even as far as the open-loop forward
ampliﬁer is concerned. This circuit exempliﬁes “input loading” due to the nonideal output impedance of
the feedback network.
The important question that we must address with regard to loading is, how do we break the loop
while properly including output and input loading effects?
▲
Example8.11
Can the loop be broken at the gate of M2 in Fig. 8.45(d) without concern for loading effects?
Solution
As illustrated in Fig. 8.46, such an attempt provides the loop gain while avoiding loading issues. However, we are
also interested in the open-loop gain and the open-loop input and output impedances, which cannot be obtained from
this conﬁguration. We must therefore develop a methodical approach to constructing the open-loop system such that
the loading effects are included.
▲
The second difﬁculty is that some circuits cannot be clearly decomposed into a forward ampliﬁer
and a feedback network. In the two-stage network of Fig. 8.47, it is unclear whether RD2 belongs to the

Sec. 8.4
Feedback Analysis Difﬁculties
301
M1
VDD
RD1
R2
M2
RD2
R1
Vt
VF
Figure 8.46
M1
VDD
RD1
RD2
RF
Vin
M2
RS
Vout
Figure 8.47
Feedback circuit without
a clearly-distinguishable feedback net-
work.
feedforward ampliﬁer or the feedback network. We might choose the former case, reasoning that M2
needs a load so as to operate as a voltage ampliﬁer, but such a choice seems arbitrary.
The third difﬁculty in feedback analysis is that some circuits do not readily map to the four canonical
topologies studied in the previous sections. For example, a simple degenerated common-source stage
does contain feedback because the source resistance measures the drain current, converts it to voltage,
and subtracts the result from the input [Fig. 8.48(a)]. However, it is not immediately clear which feedback
topology represents this arrangement because the sensed quantity, ID1, is different from the output of
interest, Vout [Fig. 8.48(b)].
M1
RD
Vin
RS
VDD
ID1
β
Vin
ID1
(a)
(b)
Vout
Vout
Forward
Circuit
Figure 8.48
(a) CS stage and (b) block diagram showing the output and sense ports.
The fourth difﬁculty is that the general feedback system analyzed thus far assumes unilateral stages,
i.e., signal propagation in only one direction around the loop. In practice, however, the loop may contain
bilateral circuits, allowing signals to ﬂow from the output toward the input through a path other than the

302
Chap. 8
Feedback
M1
VDD
RD
M2
Vout
Iin
RF
CGS2
Figure 8.49
Example of circuit with
more than one feedback mechanism.
nominal feedback path. In Fig. 8.47, for example, the signal leaks from the drain of M2 to its gate through
CGD2 at high frequencies.
The ﬁfth difﬁculty arises in circuits containing multiple feedback mechanisms (loosely called “mul-
tiloop” circuits). In the topology of Fig. 8.49, for example, RF provides feedback around the circuit,
and CGS2 around M2. We can also say that the source follower itself contains degeneration and hence
feedback. We must then ask, which loop should be broken and what exactly do we mean by “loop gain”
in this case? Table 8.1 summarizes the ﬁve issues described here.
Table 8.1
Feedback analysis difﬁculties.
Loading
Noncanonical
Topologies
Nonunilateral
Loop
Multiple Feedback
Mechanisms
Ambiguous 
Decomposition
In this chapter, we introduce three methods of feedback circuit analysis. Outlined in Table 8.2, the
ﬁrst employs two-port models to analyze the four canonical topologies while including loading effects.
Table 8.2
Three methods of feedback analysis.
Two−Port Method
Bode’s Method
Computes open−loop and closed−loop
Neglects feedforward through
feedback network.
Can be applied recursively to
quantities and the loop gain.
Includes loading effects.
multiple feedback mechanisms.
Does not apply to noncanonical
topologies.
Computes closed−loop quantities
without breaking the loop.
Provides loop gain only if one
feedback mechanism is present.
Applies to any topology.
Computes closed−loop quantities
without breaking the loop.
Applies to any topology.
Middlebrook’s Method
Provides loop gain only if local
and global loops are distinguishable.
Reveals effect of reverse loop
gain in nonunilateral loops.

Sec. 8.5
Effect of Loading
303
This method proves more efﬁcient than direct analysis of the circuit (with no knowledge of feedback)
if the loop is assumed unilateral, i.e., the forward propagation of the input signal through the feedback
network is neglected, and so is the backward propagation of the signal through the forward ampliﬁer.
The other two methods do not attempt to break the loop and yield the closed-loop quantities exactly but
with lengthier algebra.
8.5
Effect of Loading
The problem of loading manifests itself when we need to break the feedback loop so as to identify the
open-loop system, e.g., calculate the open-loop gain and the input and output impedances. To arrive at
the proper procedure for including the feedback network terminal impedances, we ﬁrst review models of
two-port networks.
8.5.1 Two-Port Network Models
The simpliﬁed ampliﬁer and feedback network models employed in the previous sections may not sufﬁce
in general. We must therefore resort to accurate two-port models. For example, the feedback network
placed around the feedforward ampliﬁer can be considered a two-port circuit sensing and producing
voltages or currents. Recall from basic circuit theory that a two-port linear (and time-invariant) network
can be represented by any of the four models shown in Fig. 8.50. The “Z model” in Fig. 8.50(a) consists of
input and output impedances in series with current-dependent voltage sources, whereas the “Y model” in
Fig. 8.50(b) comprises input and output admittances in parallel with voltage-dependent current sources.
The “hybrid models” of Figs. 8.50(c) and (d) incorporate a combination of impedances and admittances
and voltage sources and current sources. Each model is described by two equations. For the Z model, we
have
V1 = Z11I1 + Z12I2
(8.57)
V2 = Z21I1 + Z22I2
(8.58)
Each Z parameter has a dimension of impedance and is obtained by leaving one port open, e.g., Z11 =
V1/I1 when I2 = 0. Similarly, for the Y model,
I1 = Y11V1 + Y12V2
(8.59)
I2 = Y21V1 + Y22V2
(8.60)
Z11
Z12I2
V1
I1
Z22
H22
Z21I1
H12V2 H21I1
I2
Y11
G11
V1
V1
V2
V2
I1
I1
Y12V2
Y22
Y21V1
I1
H11
I2
V2
V1
V2
G12I2
I2
I2
G21V1
G22
(c)
(a)
(b)
(d)
Figure 8.50
Linear two-port network models.

304
Chap. 8
Feedback
where each Y parameter is calculated by shorting one port, e.g., Y11 = I1/V1 when V2 = 0. For the H
model,
V1 = H11I1 + H12V2
(8.61)
I2 = H21I1 + H22V2
(8.62)
and for the G model,
I1 = G11V1 + G12I2
(8.63)
V2 = G21V1 + G22I2
(8.64)
Note that, for example, Y11 may not be equal to the inverse of Z11 because the two are obtained under
different conditions: the output is shorted for the former but left open for the latter.
It is instructive to compare the general two-port models with the simpliﬁed ampliﬁer representations
that we have used in the previous sections. For example, let us consider the voltage ampliﬁer model
in Example 8.3 vis-à-vis the Z model. We observe that (1) absent in the former, Z12I2 represents the
ampliﬁer’s internal feedback, e.g., due to CGD; (2) if Z12 is zero, then Z11 is equal to Zin, the input
impedance calculated with the output left open; and (3) Z22 is not necessarily equal to Zout: the former
is computed with the input port left open and the latter with the input shorted.
The most important drawback of the Z model for our purposes is that its output generator, Z21I1, is
controlled by the input current rather than the input voltage. For a MOS circuit with the input applied to
the gate, this model becomes meaningless if the input capacitance is neglected. The H model entails the
same difﬁculty.
Do any of the two-port models agree with our intuitive picture of voltage ampliﬁers? Yes, the G model
is close. If the internal feedback, G12I2, is neglected, then G11 (= I1/V1 with I2 = 0) represents the
inverse of the input impedance, and G22 (= V2/I2 with V1 = 0) the output impedance. The reader can
try this exercise for the other three types of ampliﬁers.
8.5.2 Loading in Voltage-Voltage Feedback
As mentioned before, the Z and H models fail to represent voltage ampliﬁers if the input current is very
small—as in a simple CS stage. We therefore choose the G model here.13 The complete equivalent circuit
is shown in Fig. 8.51(a), where the forward and feedback network parameters are denoted by upper-case
and lower-case letters, respectively. Since the input port of the feedback network is connected to the
output port of the forward ampliﬁer, g11 and g12Iin are tied to Vout.
It is possible to solve this circuit exactly, but we simplify the analysis by neglecting two quantities:
the ampliﬁer’s internal feedback, G12Vout, and the “forward” propagation of the input signal through
the feedback network, g12Iin. In other words, the loop is “unilateralized.” Figure 8.51(b) depicts the
resulting circuit with our intuitive ampliﬁer notations (Zin, Zout, A0) added to indicate equivalencies. Let
us ﬁrst directly compute the closed-loop voltage gain. Recognizing that g11 is an admittance and g22 an
impedance, we write a KVL around the input network and a KCL at the output node:
Vin = Ve + g22
Ve
Zin
+ g21Vout
(8.65)
g11Vout + Vout −A0Ve
Zout
= 0
(8.66)
13Though allowing simpler algebra, the Y model does not provide intuitive results.

Sec. 8.5
Effect of Loading
305
Ve
G11
G12Vout
Vout
G21Ve
G22
g12Iin
g11
g21Vout
g22
Vin
Iin
Ve
G11
Vout
G22
g11
g21Vout
g22
Vin
Iin
ZinG21Ve
A0Ve
Zout
(a)
(b)
Figure 8.51
Voltage-voltage feedback circuit with (a) feedback network represented by a G model and (b) a
simpliﬁed G model.
Finding Ve from the latter equation and substituting the result in the former, we have
Vout
Vin
=
A0
(1 + g22
Zin
)(1 + g11Zout) + g21A0
(8.67)
It is desirable to express the closed-loop gain in the familiar form, Av,open/(1 + β Av,open). To this end,
we divide the numerator and the denominator by (1 + g22/Zin)(1 + g11Zout):
Vout
Vin
=
A0
(1 + g22
Zin
)(1 + g11Zout)
1 + g21
A0
(1 + g22
Zin
)(1 + g11Zout)
(8.68)
We can thus write
Av,open =
A0
(1 + g22
Zin
)(1 + g11Zout)
(8.69)
β = g21
(8.70)

306
Chap. 8
Feedback
Let us now interpret these results. The equivalent open-loop gain contains a factor A0, i.e., the original
ampliﬁer’s voltage gain (before immersion in feedback). But this gain is attenuated by two factors,
namely, 1 + g22/Zin and 1 + g11Zout. Interestingly, we can write 1 + g22/Zin = (Zin + g22)/Zin,
concluding that A0 is multiplied by Zin/(Zin + g22), which reminds us of a voltage divider. Similarly,
1 + g11Zout = (g−1
11 + Zout)/g−1
11 , whose inverse points to another voltage divider. The loaded forward
ampliﬁer now emerges as shown in Fig. 8.52. Note that this model excludes the two generators G12Vout
and g12Iin, which are generally not negligible.
A0Ve
Ve
Zin
Vin
Zout
Vout
g11
g22
Figure 8.52
Proper method of including loading in a voltage-voltage feedback circuit.
The reader may wonder why we go to the trouble of ﬁnding the open-loop parameters while the
closed-loop circuit in Fig. 8.51(a) can be solved exactly. The key principle here is that the rules depicted
in Fig. 8.52 afford us a quick and intuitive understanding of the circuit that would not be possible from
the direct analysis of Fig. 8.51(a). Speciﬁcally, we recognize that the ﬁnite input and output impedances
of the feedback network reduce the output voltage and the voltage seen by the input of the main ampliﬁer,
respectively.
It is important to note that g11 and g22 in Fig. 8.50 are computed as follows:
g11 = I1
V1

I2=0
(8.71)
g22 = V2
I2

V 1=0
(8.72)
Thus, as illustrated in Fig. 8.53, g11 is obtained by leaving the output of the feedback network open
whereas g22 is calculated by shorting the input of the feedback network.
A0
β
Vout
β
Vin
g11−1
g22
Figure 8.53
Conceptual view of open-
ing a voltage-voltage feedback loop with
proper loading.
Another important result of the foregoing analysis is that the loop gain, i.e., the second term in the
denominator of (8.68), is simply equal to the loaded open-loop gain multiplied by g21. Thus, a separate
calculation of the loop gain is not necessary. Also, the open-loop input and output impedances obtained
from Fig. 8.52 are scaled by 1 + g21Av,open to yield the closed-loop values. Again, we must bear in mind
that this loop gain neglects the effect of G12Vout and g12Iin.

Sec. 8.5
Effect of Loading
307
▲
Example8.12
For the circuit shown in Fig. 8.54(a), calculate the open-loop and closed-loop gains assuming λ = γ = 0.
(a)
(b)
X
M1
M1
RD1
RD2
X
Y
RF
RF
RF
RS
RD2
RS
RS
Vin
Vin
Vout
VDD
VDD
M2
M2
Feedback
Network
Figure 8.54
Solution
The circuit consists of two common-source stages, with RF and RS sensing the output voltage and returning a
fraction thereof to the source of M1. This transistor subtracts the returned voltage from Vin. The reader can prove
that the feedback is indeed negative. Following the procedure illustrated in Fig. 8.53, we identify RF and RS as the
feedback network and construct the open-loop circuit as shown in Fig. 8.54(b). Note that the loading effect in the
input network is obtained by shorting the right terminal of RF to ground and that in the output by leaving the left
terminal of RF open. Neglecting channel-length modulation and body effect for simplicity, we observe that M1 is
degenerated by the feedback network and
Av,open = VY
Vin
=
−RD1
RF∥RS + 1/gm1
{−gm2[RD2∥(RF + RS)]}
(8.73)
To compute the closed-loop gain, we ﬁrst ﬁnd the loop gain as g21 Av,open. Recall from (8.64) that g21 = V2/V1
with I2 = 0. For the voltage divider consisting of RF and RS, g21 = RS/(RF + RS). The closed-loop gain is simply
equal to Av,closed = Av,open/(1 + g21 Av,open).
Can we include RD2 in the feedback network rather than in the forward ampliﬁer? Yes, we can ascribe a ﬁnite
rO to M2 and proceed while considering RD2, RF, and RS as the feedback network. The result is slightly different
from that obtained above.
The above analysis neglects the forward ampliﬁer’s internal feedback (e.g., due to CGD2) and the propagation
of the input signal from the source of M1 and through RF to the output. (Transistor M1 also operates as a source
follower in this case.)
▲
▲
Example8.13
A student eager to understand the approximations leading to the circuit in Fig. 8.51(b) decides to use an H model for
the forward ampliﬁer and obtain an exact solution. Perform this analysis and explain the results.
Solution
Illustrated in Fig. 8.55, this representation is attractive as it allows a simple series connection of voltages and
impedances at the input and a parallel connection at the output. Writing a KVL and a KCL gives
Vin = Iin H11 + H12Vout + Iing22 + g21Vout
(8.74)
H22Vout + H21Iin + g11Vout + g12Iin = 0
(8.75)

308
Chap. 8
Feedback
Ve
g12 Iin
g11
g21Vout
g22
Vin
Iin
H11
H12
H21
H22
Iin
Vout
Vout
Figure 8.55
Finding Iin from the latter and replacing it in the former, we have
Vout
Vin
=
−
H21 + g12
(H22 + g11)(H11 + g22)
1 −(H12 + g21)
H21 + g12
(H22 + g11)(H11 + g22)
(8.76)
We can thus deﬁne
Av,open = −
H21 + g12
(H22 + g11)(H11 + g22)
(8.77)
β = H12 + g21
(8.78)
If we assume that g12 ≪H21 and H12 ≪g21, then
Av,open =
−H21
(H22 + g11)(H11 + g22)
(8.79)
β = g21
(8.80)
and the attenuation factors H22 + g11 and H11 + g22 can be interpreted in the same manner as those in Eq. (8.69).
This approach therefore explicitly reveals the simplifying approximations, namely, g12 ≪H21 and H12 ≪g21.
Unfortunately, however, for a MOS gate input, H21 (the “current gain”) approaches inﬁnity, making the model
difﬁcult to use.
▲
8.5.3 Loading in Current-Voltage Feedback
In this case, the feedback network appears in series with the output so as to sense the current. We
represent the forward ampliﬁer and the feedback network by Y and Z models, respectively (Fig. 8.56),
neglecting the generators Y12Vout and z12Iin. We wish to compute the closed-loop gain, Iout/Vin, and
therefrom determine how the open-loop parameters can be obtained in the presence of loading. Noting
that Iin = Y11Ve and I2 = Iin, we write two KVLs:
Vin = Ve + Y11Vez22 + z21Iout
(8.81)
−Ioutz11 = Iout −Y21Ve
Y22
(8.82)

Sec. 8.5
Effect of Loading
309
Ve
Vin
Iin
I2
Ve
Iout
Iout
Y22
Y21
Y11
z11
z21
z22
Figure 8.56
Current-voltage feedback circuit with loading.
Finding Ve from the latter and substituting in the former, we have
Iout
Vin
=
Y21
(1 + z22Y11)(1 + z11Y22)
1 + z21
Y21
(1 + z22Y11)(1 + z11Y22)
(8.83)
We can thus visualize the open-loop gain and the feedback factor as
Gm,open =
Y21
(1 + z22Y11)(1 + z11Y22)
(8.84)
β = z21
(8.85)
Note that Y21 is in fact the transconductance gain, Gm, of the original ampliﬁer. The two attenuation
factors (1 + z22Y11)−1 and (1 + z11Y22)−1 respectively correspond to voltage division at the input and
current division at the output, allowing us to construct the loaded open-loop forward ampliﬁer as shown in
Fig. 8.57. Since z22 = V2/I2 with I1 = 0 and z11 = V1/I1 with I2 = 0, we arrive at the conceptual picture
depicted in Fig. 8.58 for properly breaking the feedback. Note that the loop gain is equal to z21Gm,open.
Vin
Ve
GmVe
Iout
Y11
Y22
z11
z22
Figure 8.57
Current-voltage feedback
circuit with proper loading of feedback
network.
Vin
Gm
Iout
β
β
z11
z22
Figure 8.58
Conceptual view of open-
ing the loop in current-voltage feedback.

310
Chap. 8
Feedback
▲
Example8.14
A PMOS current source delivers a current to a load, e.g., the rechargeable battery in a cell phone [Fig. 8.59(a)]. We
wish to make this current less PVT-dependent by means of negative feedback. As shown in Fig. 8.59(b), we convert
the output current to voltage by a small series resistor, rM, compare this voltage with a reference by means of an
ampliﬁer, and return the result to the gate of M1. Determine the output current and the impedance seen by the load.
(a)
(b)
(c)
(d)
Load
Feedback
Network
M1
VDD
rM
Vb
Transconductance
Ampliﬁer
A1
X
Y
Load
M1
VDD
rM
Vb
A1
Iout
Load
M1
VDD
Vb
Iout
M1
VDD
rM
Load
Vb
rM
Iout
Zout
A1
Figure 8.59
Solution
We view Vb as the input voltage and recognize that rM sustains a voltage approximately equal to Vb if the loop gain
is high. That is, Iout ≈Vb/rM. But let us analyze this arrangement more accurately. Redrawing the circuit as in
Fig. 8.59(c), we identify A1 and M1 as the forward transconductance ampliﬁer and rM as the feedback network. The
procedure depicted in Fig. 8.58 leads to the open-loop topology of Fig. 8.59(d), and hence
Gm,open = Iout
Vb
(8.86)
≈A1gm
(8.87)
where the current ﬂowing through rO is neglected. The feedback factor β = z21 = rM. Thus, the closed-loop output
current is given by
Iout =
A1gm
1 + A1gmrM
Vb
(8.88)
In the open-loop conﬁguration, the load sees an impedance of rO + rM. Since feedback regulates the output
current, the impedance seen by the load rises by a factor of 1 + A1gmrM, reaching Zout = (1+ A1gmrM)(rO +rM).
A critical point emerging from this example is that the output impedance of a current-voltage feedback topology
must be obtained by breaking the output current path and measuring the impedance between the resulting two nodes
[e.g., X and Y in Fig. 8.59(b)]. In the above calculations, the “impedance seen by the load” is in fact computed by
replacing the load with a voltage source and measuring the current through it.
▲
8.5.4 Loading in Voltage-Current Feedback
In this conﬁguration, the forward (transimpedance) ampliﬁer generates an output voltage in response to
the input current and can thus be represented by a Z model. Sensing the output voltage and returning a
proportional current, the feedback network lends itself to a Y model. The equivalent circuit is shown in
Fig. 8.60, where the effect of Z12 and y12 is neglected. As in previous cases, we compute the closed-loop

Sec. 8.5
Effect of Loading
311
Z11
Ie
Z22
Ie
Vout
Iin
Vout
Z21
y11
y21
y22
Figure 8.60
Voltage-current feedback circuit with loading.
gain, Vout/Iin, by writing two equations:
Iin = Ie + IeZ11y22 + y21Vout
(8.89)
y11Vout + Vout −Z21Ie
Z22
= 0
(8.90)
Eliminating Ie, we obtain
Vout
Iin
=
Z21
(1 + y22Z11)(1 + y11Z22)
1 + y21
Z21
(1 + y22Z11)(1 + y11Z22)
(8.91)
Thus, the equivalent open-loop gain and feedback factor are given by
R0,open =
Z21
(1 + y22Z11)(1 + y11Z22)
(8.92)
β = y21
(8.93)
Interpreting the attenuation factors in R0,open as current division at the input and voltage division at the
output, we arrive at the conceptual view in Fig. 8.61. The loop gain is given by y21R0,open.
R0,open
Vout
Iin
Y22−1
Y11−1
β
β
Figure 8.61
Conceptual view of open-
ing the loop in voltage-current feedback.
▲
Example8.15
Figure 8.62(a) shows a transimpedance ampliﬁer topology commonly used in optical communication systems.
Determine the circuit’s gain and input and output impedances if λ = 0.

312
Chap. 8
Feedback
RF
Vout
Vout
(a)
(b)
Iin
Iin
Iin
M1
M1
VDD
RD
Vout
VDD
RD
RF
RF
RF
Figure 8.62
Solution
We can view the feedback resistor, RF, as a network that senses the output voltage, converts it to current, and returns
the result to the input. Following Figure 8.61, we construct the loaded open-loop ampliﬁer as shown in Fig. 8.62(b),
and express the open-loop gain as
R0,open = −RFgm(RF||RD)
(8.94)
The feedback factor, y21 (= I2/V1 with V2 = 0) is equal to −1/RF. It follows that the closed-loop gain is equal to
Vout
Iin
= −RFgm(RF||RD)
1 + gm(RF||RD)
(8.95)
which, if gm(RF||RD) ≫1, reduces to −RF, an expected result (why?). The closed-loop input impedance is
Rin =
RF
1 + gm(RF||RD)
(8.96)
which is approximately equal to (1+ RF/RD)(1/gm) if the above condition holds. Similarly, the closed-loop output
impedance is given by
Rout =
RF||RD
1 + gm(RF||RD)
(8.97)
which amounts to 1/gm if gm(RF||RD) ≫1. Note that if λ > 0, we can simply replace RD with RD||rO in all of
the foregoing equations.
Thistransconductanceampliﬁerissimpleenoughthatwecansolveitdirectly,andthereaderisencouragedtodoso.
But we can readily identify two inconsistencies. First, breaking the loop at the gate of M1 yields a loop gain of gm RD
rather than gm(RD||RF). Second, the closed-loop output impedance [with Iin set to zero in Fig. 8.62(a)] is simply
equal to RD||(1/gm) = RD/(1+ gm RD). The value derived above can be expressed as RD/(1+ gm RD + RD/RF),
revealing the extra term RD/RF. These errors arise from the approximate nature of the model.
▲
▲
Example8.16
Calculate the voltage gain of the circuit shown in Fig. 8.63(a).
Solution
What type of feedback is used in this circuit? Resistor RF senses the output voltage and returns a proportional current
to node X. Thus, the feedback can be considered as the voltage-current type. However, in the general representation
of Fig. 8.60(a), the input signal is a current quantity, whereas in this example, it is a voltage quantity. For this reason,
we replace Vin and RS by a Norton equivalent [Fig. 8.63(b)] and view RS as the input resistance of the main ampliﬁer.
Opening the loop according to Fig. 8.61 and neglecting channel-length modulation, we write the open-loop gain

Sec. 8.5
Effect of Loading
313
(a)
(b)
M1
M1
M1
VDD
RD
RF
VDD
RD
RF
VDD
RD
RF
Vout
Vout
Vout
IN
RS
IN
Vin
RS
RS
RF
(c)
X
Figure 8.63
from Fig. 8.63(c) as
R0,open = Vout
IN

open
(8.98)
= −(RS∥RF)gm(RF∥RD)
(8.99)
where IN = Vin/RS. We also calculate the loop gain as y21R0,open. Thus, the circuit of Fig. 8.63(a) exhibits a voltage
gain of
Vout
Vin
= 1
RS
·
−(RS∥RF)gm(RF∥RD)
1 + gm(RF∥RD)RS/(RS + RF)
(8.100)
Interestingly, if RF is replaced by a capacitor, this analysis does not yield a zero in the transfer function because
we have neglected the reverse transmission of the feedback network (from the output of the feedback network to its
input). The input and output impedances of the circuit are also interesting to calculate. This is left as an exercise for
the reader. The reader is also encouraged to apply this solution to the circuit of Fig. 8.3(b).
▲
8.5.5 Loading in Current-Current Feedback
The forward ampliﬁer in this case generates an output current in response to the input current and can be
represented by an H model, and so can the feedback network. Shown in Fig. 8.64 is the equivalent circuit
with the H12 and h12 generators neglected. We write
Iin = IeH11h22 + h21Iout + Ie
(8.101)
Iout = −Iouth11H22 + H21Ie
(8.102)
Ie
H21
H22
Ie
H11
h11
h21 Iout
h22
Iin
Iout
Figure 8.64
Equivalent circuit for current-current feedback.

314
Chap. 8
Feedback
and hence
Iout
Iin
=
H21
(1 + h22H11)(1 + h11H22)
1 + h21
H21
(1 + h22H11)(1 + h11H22)
(8.103)
As in previous topologies, we deﬁne the equivalent open-loop current gain and the feedback factor as
AI,open =
H21
(1 + h22H11)(1 + h11H22)
(8.104)
β = h21
(8.105)
The conceptual view of the broken loop is depicted in Fig. 8.65, and the loop gain is equal to h21AI,open.
Iout
AI
β
Iin
h11
h22−1
β
Figure 8.65
Conceptual view of load-
ing in current-current feedback.
▲
Example8.17
Calculate the open-loop and closed-loop gains of the circuit shown in Fig. 8.66(a). Assume that λ = γ = 0.
M1
M1
VDD
RD
RD
Iin
Iin
M2
VDD
M2
RS
(a)
(b)
RF
RS
RS
RF
RF
Iout
Iout
X
Y
Y
X
Figure 8.66
Solution
In this circuit, RS and RF sense the output current and return a fraction thereof to the input. Breaking the loop
according to Fig. 8.65, we arrive at the circuit in Fig. 8.66(b), where we have
AI,open = −(RF + RS)gm1RD
1
RS∥RF + 1/gm2
(8.106)
The loop gain is given by h21 AI,open, where, from (8.62), h21 = I2/I1 with V2 = 0. For the feedback network
consisting of RS and RF, we have h21 = −RS/(RS + RF). The closed-loop gain equals AI,open/(1 + h21 AI,open).
▲

Sec. 8.6
Bodes Analysis of Feedback Circuits
315
8.5.6 Summary of Loading Effects
The results of our study of loading are summarized in Fig. 8.67. The analysis is carried out in three
steps: (1) open the loop with proper loading and calculate the open-loop gain, AOL, and the open-loop
input and output impedances; (2) determine the feedback ratio, β, and hence the loop gain, β AOL; and
(3) calculate the closed-loop gain and input and output impedances by scaling the open-loop values by a
factor of 1 + β AOL. Note that in the equations deﬁning β, the subscripts 1 and 2 refer to the input and
output ports of the feedback network, respectively.
In this chapter, we have described two methods of obtaining the loop gain: (1) by breaking the loop
at an arbitrary point, as shown in Fig. 8.5, and (2) by calculating AOL and β, as illustrated in Fig. 8.67.
The two methods may yield slightly different results due to the issues outlined in Table 8.1.
A0
β
Vout
Vout
β
Vin
Iout
AI
β
R0
Iin
Iin
β
β
β
Vin
Iout
β
Gm
β
V2
V1
β =
I2 = 0
I2
I1
β =
V2 = 0
V2
I1
β =
I2 = 0
I2
V1
β =
V2 = 0
(a)
(b)
(c)
(d)
Figure 8.67
Summary of loading effects.
8.6
Bode’s Analysis of Feedback Circuits
Bode’s approach provides a rigorous solution for a circuit’s closed-loop parameters (whether it includes
feedback or not), but it does not tell us much about the loop gain in the presence of multiple feedback
mechanisms. The analysis presented in this section was originally described by Bode in his 1945 classic
textbook Network Analysis and Feedback Network Design. Since this approach is somewhat less intuitive,
we encourage the reader to be patient and read this section in several sittings.
8.6.1 Observations
Before delving into Bode’s analysis, we should make two simple, yet new observations with regard to
circuit equations.
First, consider the general circuit shown in Fig. 8.68(a), where one transistor is explicitly shown in its
ideal form. We know from our small-signal gain and transfer function analyses in previous chapters that
Vout can eventually be expressed as AvVin or H(s)Vin. But, what happens if we denote the dependent
current source by I1 and do not make the substitution I1 = gmV1 yet? Then, Vout is obtained as a function

316
Chap. 8
Feedback
gmV1
V1
Vout
V1
rO
RD
RS
Vin
gmV1
I1
gmV1
V1
Vin
V1
(c)
(a)
(b)
Vout
Vin
Figure 8.68
(a) Circuit containing a dependent source, (b) circuit example, and (c) V1 as a signal of interest.
of both Vin and I1:
Vout = AVin + BI1
(8.107)
As an example, in the degenerated common-source stage of Fig. 8.68(b), we note that the current ﬂowing
upward through RD (and downward through RS) is equal to −Vout/RD, and hence the voltage drop across
rO is given by (−Vout/RD −I1)rO. A KVL around the output network thus yields
Vout =

−Vout
RD
−I1

rO −Vout
RD
RS
(8.108)
and
Vout =
−rO
1 + rO + RS
RD
I1
(8.109)
In this case, A = 0 and B = −rO RD/(RD + rO + RS).
Second, let us return to the general circuit in Fig. 8.68(a) and consider V1 as the signal of interest, i.e.,
we wish to compute V1 as a function of Vin in the form of AvVin or H(s)Vin. This is always possible by
pretending that V1 is the “output,” as conceptually illustrated in Fig. 8.68(c). In a manner similar to Eq.
(8.107), V1 can be written as
V1 = CVin + DI1
(8.110)
if we temporarily forget that I1 = gmV1. In Fig. 8.68(b), for example, we express the current though RS
(and RD) as (Vin −V1)RS, subtract this current from I1, and let the result ﬂow through rO. A KVL around
the output network gives
Vin −V1 −

I1 −Vin −V1
RS

rO = −Vin −V1
RS
RD
(8.111)
and hence
V1 = Vin −
rO RS
RD + rO + RS
I1
(8.112)
That is, C = 1 and D = −rO RS/(RD + rO + RS).

Sec. 8.6
Bodes Analysis of Feedback Circuits
317
In summary, in a given circuit containing at least one transistor (whether there is feedback or not), we
can eventually reach two equations that express Vout and V1 in terms of Vin and I1. To obtain Vout/Vin,
we solve the two equations while applying the knowledge that I1 is in fact equal to gmV1.
The foregoing developments and, in particular, Eqs. (8.107) and (8.110) appear unnecessarily tedious.
After all, we can directly solve the circuit in Fig. 8.68(b) with less algebra. However, the interpretation
of the coefﬁcients A, B, C, and D affords a simple and elegant approach to feedback analysis.
8.6.2 Interpretation of Coefﬁcients
We now focus on Eqs. (8.107) and (8.110) and ask whether the A–D coefﬁcients can be directly calculated
for a given circuit. We begin with A:
A = Vout
Vin
with I1 = 0
(8.113)
This result implies that A is obtained as the voltage gain of the circuit if the dependent current source is set
to zero, which can be readily accomplished by “disabling” the transistor, i.e., by forcing the transistor’s
gm to zero. We can consider Vout in this case as the “feedthrough” of the input signal (in the absence
of the ideal transistor) [Fig. 8.69(a)]. In the CS example, Vout = 0 if I1 = 0 because no current ﬂows
through RS, rO, and RD. That is, A = 0.
I1
I1
V1
Vout
Vin
V1
rO
RD
RS
Vin
V1
(a)
I1
Vout
V1
Vout
V1
rO
RD
RS
I1
I1
Vout
(b)
V1
V1
rO
RD
RS
Vin
I1
V1
V1
V1
rO
RD
RS
I1
I1
V1
V1
(c)
(d)
Vin
Figure 8.69
Setups for the calculation of (a) A, (b) B, (c) C, and (d) D.
As for the B coefﬁcient in (8.107), we have
B = Vout
I1
with Vin = 0
(8.114)
That is, we set the input to zero and compute Vout as a result of I1 [Fig. 8.69(b)], pretending that I1 is an
independent source.14 In the CS example,

−Vout
RD
−I1

rO −Vout
RD
RS = Vout
(8.115)
14If I1 is kept as a dependent source, the circuit has no external stimulus and, therefore, generates no voltage or current.

318
Chap. 8
Feedback
and hence
Vout =
−rO RD
RD + rO + RS
I1
(8.116)
Thus, B = −rO RD/(RD + rO + RS).
The C coefﬁcient in (8.110) is interpreted as
C = V1
Vin
with I1 = 0
(8.117)
i.e., the transfer function from the input to V1 with the transistor’s gm set to zero [Fig. 8.69(c)]. In the CS
circuit, no current ﬂows through RS under this condition, yielding V1 = Vin and C = 1.
Finally, the D coefﬁcient is obtained as
D = V1
I1
with Vin = 0
(8.118)
which, as illustrated in Fig. 8.69(d), represents the transfer function from I1 to V1 with the input at zero.
In the CS stage, the current ﬂowing through RS (and RD) under this condition is equal to −V1/RS,
producing a voltage drop of (−V1/RS −I1)rO across rO. A KVL around the output network yields
−V1 −
 V1
RS
+ I1

rO = V1
RS
RD
(8.119)
We therefore have
V1 = −
rO RS
RD + rO + RS
I1
(8.120)
and hence D = −rO RS/(RD + rO + RS).
In summary, the A–D coefﬁcients are computed as shown in Fig. 8.70: (1) we disable the transistor
by setting its gm to zero and obtain A and C as the feedthroughs from Vin to Vout and to V1, respectively,
and (2) we set the input to zero and calculate B and D as the gain from I1 to Vout and to V1, respectively.
From another perspective, the former step ﬁnds the responses to Vin with gm = 0, and the latter, to I1
with Vin = 0. We can even say that the circuit is excited each time by one input, either Vin or I1, and
generates two outputs of interest, Vout and V1. The reader may still not see the reason for these derivations,
but patience is a virtue!
V1
V1
Vin
I1
V1
V1
I1
Vout
Vout
C = V1
Vin
D = V1
I1
A = Vout
Vin
B = Vout
I1
(a)
(b)
Figure 8.70
Summary of computations for A–D.

Sec. 8.6
Bodes Analysis of Feedback Circuits
319
▲
Example8.18
Compute the A–D coefﬁcients for the circuit shown in Fig. 8.71(a).
M1
VDD
RD
RF
Vout
(a)
Vin
Vin
RS
VDD
RD
RF
Vout
RS
VDD
RD
RF
Vout
RS
V1
V1
I1
V1
I1
(c)
(b)
Figure 8.71
Solution
Following the procedures illustrated in Fig. 8.70, we ﬁrst set I1 (i.e., gm) to zero and determine the feedthrough
components Vout/Vin and V1/Vin. From Fig. 8.71(b), we have
A = Vout
Vin
(8.121)
=
RD
RD + RS + RF
(8.122)
and
C = V1
Vin
(8.123)
=
RF + RD
RD + RS + RF
(8.124)
Next, we set Vin to zero and calculate the transfer functions from I1 to Vout and to V1 [Fig. 8.71(c)]:
B = Vout
I1
(8.125)
= −RD||(RS + RF)
(8.126)
= −RD(RS + RF)
RD + RS + RF
(8.127)
and
D = V1
I1
(8.128)
=
RS
RS + RF
Vout
I1
(8.129)
= −
RS RD
RD + RS + RF
(8.130)
▲
For our subsequent studies, we must refresh our memory about loop gain calculations.

320
Chap. 8
Feedback
▲
Example8.19
Determine the exact loop gain for the circuit of Fig. 8.71(a).
Solution
We prefer to break the loop at a port that does not entail loading effects. Let us do so at the gate of M1, as depicted
in Fig. 8.72(a). Applying a test voltage, Vt, and calculating the feedback voltage, VF, we have
Loop Gain = −VF
Vt
(8.131)
= gm[RD||(RS + RF)]
RS
RS + RF
(8.132)
=
gm RS RD
RD + RS + RF
(8.133)
Note that the loop gain and the D coefﬁcient in (8.130) differ by only a factor of −gm. We return to this point below.
(a)
VDD
RD
RF
Vout
VDD
RD
RF
Vout
RS
V1
(b)
Vt
VF
RS
VF
gm V1
It
X
Figure 8.72
Alternatively, we can break the loop at the top terminal of the dependent current source. Illustrated in Fig. 8.72(b),
the idea is to draw a test current, It, from node X and measure the resulting feedback voltage, VF, recognizing that
the ratio −VF/It must be multiplied by gm to arrive at the loop gain:
VF = −It[RD||(RS + RF)]
RS
RS + RF
(8.134)
and thus
Loop Gain = −gmVF
It
(8.135)
=
gm RS RD
RD + RS + RF
(8.136)
We see a similarity between the calculation of D in Fig. 8.69(d) and the calculation of the loop gain in Fig. 8.72(b).
In both cases, we set the input to zero, apply I1 or It, and measure the controlling voltage, V1. We therefore surmise
that D and the loop gain may be related. We will keep the reader in suspense for now.
▲
8.6.3 Bode’s Analysis
We have seen in the previous section that the A–D coefﬁcients can be computed relatively easily. We
now express Vout/Vin in terms of these coefﬁcients. Since
Vout = AVin + BI1
(8.137)
V1 = CVin + DI1
(8.138)

Sec. 8.6
Bodes Analysis of Feedback Circuits
321
and, in the actual circuit, I1 = gmV1, we have
V1 =
C
1 −gm D Vin
(8.139)
The closed-loop gain is therefore equal to
Vout
Vin
= A +
gm BC
1 −gm D
(8.140)
As expected, the ﬁrst term represents the input-output feedthrough, manifesting itself when gm = 0. We
can also write
Vout
Vin
= A + gm(BC −AD)
1 −gm D
(8.141)
In contrast to direct analysis of the closed-loop circuit, Bode’s method decomposes the computation into
several simpler steps. While our formulation has assumed a dependent current source, the results are
applicable to dependent voltage sources as well. Let us solve some circuits using Bode’s approach.
▲
Example8.20
Determine the voltage gain of the degenerated CS stage shown in Fig. 8.69.
Solution
Utilizing the results obtained for Fig. 8.69 and noting that A = 0 and C = 1, we have
Vout
Vin
=
gm
−rO RD
RD + rO + RS
1 + gm
rO RS
RD + rO + RS
(8.142)
=
−gmrO RD
RD + rO + (1 + gmrO)RS
(8.143)
The reader is encouraged to repeat this analysis in the presence of body effect.
▲
▲
Example8.21
Determine the voltage gain of the feedback ampliﬁer shown in Fig. 8.71(a) without breaking the loop.
Solution
With the aid of the results obtained in Example 8.18, we obtain
Vout
Vin
=
RD
RD + RS + RF
+
−gm
RD(RS + RF)(RF + RD)
(RD + RS + RF)2
1 +
gm RS RD
RD + RS + RF
(8.144)
=
RD
RD + RS + RF
+
−gm RD(RS + RF)(RF + RD)
(RD + RS + RF + gm RS RD)(RD + RS + RF)
(8.145)
Note that this result is exact, with the ﬁrst term representing the circuit’s direct feedthrough in the absence of transistor
action (gm = 0).

322
Chap. 8
Feedback
Under what condition does the above loop gain reduce to the familiar, ideal form −RF/RS? We may surmise that
RD must be small enough not to “feel” the loading effect of RF. But the condition RD ≪RF does not yield a voltage
gain of −RF/RS. After all, this ideal value also presumes a high open-loop gain. Thus, we need two conditions,
namely, RD ≪RF and gm RD ≫1 for the above result to reduce to −RF/RS.
▲
Let us make a useful observation. If A = 0, Eq. (8.140) yields Vout/Vin = gm BC/(1 −gm D), a
result resembling the generic feedback equation A0/(1 + β A0). We therefore loosely call gm BC the
“open-loop” gain.
Return Ratio and Loop Gain
As mentioned in Example 8.19, the quantity D (= V1/I1 with Vin = 0)
and the loop gain appear to be related. In fact, the closed-loop gain expression in Eq. (8.141) may suggest
that 1−gm D = 1+loop gain, and hence loop gain = −gm D. This is not a coincidence: in both cases, we
set the main input to zero, break the loop by replacing the dependent source with an independent source,
and compute the returned quantity.
In his original treatment of feedback, Bode introduces the term “return ratio” (RR) to refer to −gm D
and ascribes it to a given dependent source in the circuit [1]. Thus, the return ratio, obtained by injecting
a voltage in place of VGS or a current in place of ID, appears to be the same as the true loop gain15 even
if the loop cannot be completely broken. In fact, the return ratio is equal to the loop gain if the circuit
contains only one feedback mechanism and the loop traverses the transistor of interest. We elaborate on
this point later.
▲
Example8.22
DeterminethevoltagegainofthesourcefollowershowninFig.8.73(a)usingBode’smethod.Assumethat λ = γ = 0.
Vin
Vin
RS
RS
VDD
Vout
Vout
M1
V1
V1
gm
(a)
(b)
Figure 8.73
Solution
Figure 8.73(b) depicts the small-signal model. To compute the A and C coefﬁcients, Fig. 8.70 suggests setting gm
to zero, which results in
A = Vout
Vin
= 0
(8.146)
C = V1
Vin
= 1
(8.147)
For the B and and D coefﬁcients, we set Vin to zero and apply a current source I1 in lieu of gmV1:
B = Vout
I1
= RS
(8.148)
D = V1
I1
= −RS
(8.149)
15By the true loop gain, we mean one that is obtained without any approximations, e.g., without neglecting loading or the
propagation of the input signal through the feedback network to the main output.

Sec. 8.6
Bodes Analysis of Feedback Circuits
323
From (8.140) or (8.141), we have
Vout
Vin
=
gm RS
1 + gm RS
(8.150)
The return ratio associated with the dependent source is equal to −gm D = gm RS.
A peculiar result occurs here if RS approaches an ideal current source: the return ratio, gm RS, goes to inﬁnity,
and so does B. Since (8.140) was obtained by dividing by B and D, in general it may give an incorrect value if B or
D is inﬁnite. In the case of the source follower, however, (8.140) produces a correct result.
▲
▲
Example8.23
Figure 8.74(a) shows a circuit in which one transistor, M1, resides outside the feedback loop. Using Bode’s method,
compute Vout/Vin.
Vin
RS
VDD
M1
M2
RD
Vout
V1
Figure 8.74
Solution
We ﬁrst obtain A and C by setting gm1 to zero:
A = Vout
Vin
= 0
(8.151)
C = V1
Vin
=
gm2RS
1 + gm2RS
(8.152)
Next, we set Vin to zero and apply I1 in lieu of M1:
B = Vout
I1
= −RD
(8.153)
D = V1
I1
= 0
(8.154)
As expected, the return ratio for M1 is zero. We thus have
Vout
Vin
= gm1(−RD
gm2RS
1 + gm2RS
)
(8.155)
Alternatively, the gain can be obtained by treating M2 as the dependent source of interest. The return ratio for M2 is
the same as that found for the source follower in the above example. Even though the circuit contains one feedback
mechanism, the two return rations are unequal because the feedback loop does not traverse M1.
▲
▲
Example8.24
Calculate the closed-loop gain of the circuit shown in Fig. 8.75(a). Assume that λ = γ = 0.

324
Chap. 8
Feedback
M2
M2
VDD
RD
RD
M1
RS
RS
Vout
Vout
Iin
V1
V1
I1
(a)
(b)
Figure 8.75
Solution
We calculate the A–D coefﬁcients with the aid of the conceptual diagram in Fig. 8.70. We can select either transistor
as the device of interest. Setting gm1 to zero, we obtain
A = Vout
Iin
with gm1 = 0
(8.156)
= RS
(8.157)
because, in the absence of M1, Iin simply ﬂows through RS, producing a feedthrough component at the output. For
C, we note that V1 = Iin RS(−gm2RD) −Iin RS, and hence
C = V1
Iin
with gm1 = 0
(8.158)
= −(1 + gm2RD)RS
(8.159)
We now set Iin to zero and inject an independent current source in place of M1, as shown in Fig. 8.75(b). Since
Vout = I1RS,
B = Vout
I1
with Iin = 0
(8.160)
= RS
(8.161)
Also, V1 = I1RS(−gm2RD) −I1RS = −I1RS(1 + gm2RD) and
D = V1
I1
with Iin = 0
(8.162)
= −RS(1 + gm2RD)
(8.163)
Equation (8.140) thus gives
Vout
Iin
= A +
gm1BC
1 −gm1D
(8.164)
= RS −
gm1(1 + gm2RD)R2
S
1 + gm1RS(1 + gm2RD)
(8.165)
=
RS
1 + gm1RS(1 + gm2RD)
(8.166)
The reader is encouraged to repeat the derivation with M2 as the dependent source of interest.
▲

Sec. 8.6
Bodes Analysis of Feedback Circuits
325
8.6.4 Blackman’s Impedance Theorem
Continuing our effort to compute the closed-loop parameters of a feedback system without breaking the
loop, we now study Blackman’s theorem, which determines the impedance seen at any port of a general
circuit. This theorem can be proved using Bode’s approach.
Consider the general circuit depicted in Fig. 8.76(a), where the impedance between nodes P and Q is
of interest. As in Bode’s analysis, we have explicitly shown one of the transistors by its ideal model, the
voltage-dependent current source I1. Let us pretend that Iin is the input signal and Vin the output signal
so that we can utilize Bode’s results:
Vin = AIin + BI1
(8.167)
V1 = C Iin + DI1
(8.168)
It follows that
Zin = Vin
Iin
= A +
gm BC
1 −gm D
(8.169)
V1
I1
V1
I1
V1
I1
(a)
(b)
Vin
Iin
P
Q
P
Q
Open
TOC
P
Q
TSC
Short
(c)
Figure 8.76
(a) Arrangement for calculating a port impedance, (b) calculation of Toc, and (c) calculation of Tsc.
where gm denotes the transconductance of the transistor modeled by I1 in Fig. 8.76(a). We now manipulate
this result in three steps so as to obtain a more intuitive expression. First, we recognize from (8.168) that,
if Iin = 0, then V1/I1 = D. We call −gm D the “open-circuit loop gain” (because the port of interest
is left open) and denote it by Toc [Fig. 8.76(b)]. Second, we note from (8.167) that, if Vin = 0, then
Iin = (−B/A)I1, and hence, from (8.168),
V1
I1
= AD −BC
A
(8.170)
We call −gm times this quantity the “short-circuit” loop gain (because Vin = 0) and denote it by Tsc
[Fig. 8.76(c)]. Note that the circuit topology changes in these two cases. Both Toc and Tsc can be viewed
as return ratios associated with I1 for the two circuit topologies. In summary,
Toc = −gm
V1
I1
|Iin=0
(8.171)
Tsc = −gm
V1
I1
|Vin=0
(8.172)

326
Chap. 8
Feedback
In the third step, we use Toc and Tsc to rewrite Eq. (8.169) as
Zin = Vin
Iin
= A −gm(BC −AD)
1 −gm D
(8.173)
= A 1 + Tsc
1 + Toc
(8.174)
Originally derived by Blackman [2], this result lends itself to a great deal of intuition if we recall that
A = Vin/Iin with I1 = 0, i.e., when the transistor under consideration is disabled. We roughly view A as
the “open-loop” impedance because it is obtained without the transistor in the feedback loop. In addition,
we observe that (1) if |Tsc| ≪1, then Zin ≈A/(1 + Toc); that is, the open-loop impedance is divided
by 1 + Toc; and (2) if |Toc| ≪1, then Zin ≈A(1 + Tsc); i.e., the open-loop impedance is multiplied
by 1 + Tsc. Reminiscent of closed-loop input and output impedances derived in previous sections, these
two cases nonetheless reveal that, in general, the closed-loop impedance cannot be expressed as Zin
multiplied or divided by (1 + the loop gain).
▲
Example8.25
Determine the output impedance of a degenerated CS stage [Fig. 8.77(a)]. Assume that γ = 0.
M1
RS
RS
RS
rO
rO
(a)
Rout
I1
V1
rO
I1
V1
(c)
(b)
Figure 8.77
Solution
We must compute three quantities. First, with the transistor disabled,
A = rO + RS
(8.175)
Second, with the port of interest left open [Fig. 8.77(b)], we have
Toc = −gm
V1
I1
(8.176)
= 0
(8.177)
because no current ﬂows through RS. Third, with the port of interest shorted [Fig. 8.77(c)], we obtain
Tsc = −gm
V1
I1
(8.178)
= +gm(RS||rO)
(8.179)
It follows from Eq. (8.174) that
Zout = (rO + RS)[1 + gm(RS||rO)]
(8.180)
= (1 + gmrO)RS + rO
(8.181)
The reader is encouraged to repeat the analysis while including body effect.
▲

Sec. 8.6
Bodes Analysis of Feedback Circuits
327
▲
Example8.26
Compute the output impedance of the circuit shown in Fig. 8.78(a). Assume that γ = 0.
(a)
rO
rO
I1
V1
I1
V1
(c)
(b)
M1
RS
RS
RS
A1
A1
A1
Rout
Figure 8.78
Solution
The difﬁculty with this circuit is that it does not map into one of the four canonical topologies: ampliﬁer A1 senses the
voltage at the source of M1 whereas the output is taken at the drain. Fortunately, Blackman’s theorem is impervious
to such departures. Again, we proceed in three steps. With the transistor disabled,
A = rO + RS
(8.182)
If the output is left open [Fig. 8.78(b)], no current ﬂows through RS, and hence Toc = 0. With the output shorted
[Fig. 8.78(c)],
Tsc = gm(RS||rO)A1
(8.183)
Thus,
Zout = (rO + RS)[1 + gm(RS||rO)A1]
(8.184)
= rO + RS + gmrO RS A1
(8.185)
= (1 + gmrO)A1RS + rO
(8.186)
To the ﬁrst order, the factor 1 + gmrO is “boosted” by another factor of A1.
▲
▲
Example8.27
Determine the output impedance of the source follower shown in Fig. 8.79(a). Assume that λ = γ = 0.
VDD
M1
Vout
Vin
I1
V1
I1
V1
(c)
(a)
(b)
Figure 8.79

328
Chap. 8
Feedback
Solution
With gm = 0, the output impedance, and hence A, are inﬁnity. The two loop gains are obtained from Figs. 8.79(b)
and (c) as Tsc = 0 and Toc = ∞, respectively. These difﬁculties arise because the proof of Blackman’s theorem
divides by A, tacitly assuming that A < ∞. One can avoid this situation by placing a resistor in parallel with the
port of interest and letting it approach inﬁnity in the end result. This is left as an exercise for the reader.
▲
▲
Example8.28
Using Blackman’s theorem, determine the input impedance of the circuit shown in Fig. 8.37(a). Assume that λ =
γ = 0.
Solution
We set gm2 to zero to compute A, observing that A = ∞! Since the derivation of Blackman’s expression relies
on dividing by A, we know that A = ∞may invalidate the result. This is one drawback of Blackman’s approach.
The situation becomes even more interesting if we attempt to compute Toc. As depicted in Fig. 8.80, we apply an
independent small-signal circuit source I1 and seek V1. The voltage at the gate of M1 is equal to −I1RDC1/(C1+C2),
yielding a drain current of −gm1I1RDC1/(C1 + C2). This current must be equal to I1, and hence

1 + gm1RD
C1
C1 + C2

I1 = 0
(8.187)
This relation cannot hold because gm1RDC1/(C1 + C2) is not necessarily zero and I1 itself is an external stimulus
and nonzero. This nonsensical result arises because two ideal current sources, namely, I1 and M1, are placed in
series. Similarly, V1 cannot be calculated because the drain voltage of M1 is not deﬁned.
RD
C1
C2
VDD
M1
I1
V1
P
Figure 8.80
▲
▲
Example8.29
A student wrestling with the above example decides to attach a resistance from the drain of M1 to ground and let its
value go to inﬁnity in the ﬁnal result. Does this rescue Blackman’s theorem?
Solution
As shown in Fig. 8.81, A = RT . Moreover, we can now compute Toc by writing a KCL at the drain of M1:
−gm1I1RD
C1
C1 + C2
−V1
RT
= I1
(8.188)
and hence
Toc = −gm2
V1
I1
= gm2

1 + gm1RD
C1
C1 + C2

RT
(8.189)

Sec. 8.6
Bodes Analysis of Feedback Circuits
329
RD
C1
C2
VDD
M1
I1
V1
P
RT
Figure 8.81
This result suggests that Toc →∞as RT →∞. Since Tsc = 0 (why?), we have
Rin = A 1 + Tsc
1 + Toc
(8.190)
= RT
1
1 + gm2(1 + gm1RD
C1
C1 + C2
)RT
(8.191)
If RT →∞, Rin approaches 1/gm2 divided by the loop gain.
It is peculiar that the return ratio of M2 is not equal to that of M1 even though the circuit appears to have only
one feedback mechanism. But looks can be deceiving: M2 is degenerated by RT , experiencing local feedback. We
can say M2 sees inﬁnite degeneration if RT = ∞, and hence has an inﬁnite return ratio.
▲
▲
Example8.30
Using Blackman’s theorem, determine Rin in Fig. 8.82(a). Assume that γ = 0.
M1
RD
rO
rO
VDD
RD
VDD
Vb
Rin
I1
V1
(a)
(b)
Figure 8.82
Solution
With gm = 0, we have A = RD +rO. If the input port is shorted, no feedback is present and Tsc = 0. With the input
port open [Fig. 8.82(b)], we observe that no current ﬂows through RD, I1 generates a voltage of −I1rO across rO,
and V1 = −I1rO. That is, Toc = gmrO. It follows that
Rin = RD + rO
1 + gmrO
(8.192)
as expected.

330
Chap. 8
Feedback
It is interesting to note that Toc > 0 even though the feedback through rO is positive. This occurs because the
circuit contains two feedback mechanisms, one through rO and another due to degeneration of M1 by an inﬁnite
source resistance. In such a case, the sign of Toc does not reveal the polarity of feedback. This point becomes clearer
in the next example.
▲
▲
Example8.31
Determine the return ratios of M1 and M2 in Fig. 8.83(a), assuming λ = γ = 0.
M1
VDD
M2
M2
M1
V2
I2
Vin
Vout
RD
RD
RS
RS
RD
RS
I1
V1
(c)
(a)
(b)
Figure 8.83
Solution
In this circuit, RS degenerates both M1 and M2, and M2 returns a voltage to the source of M1 with positive
feedback. Injecting a current as shown in Fig. 8.83(b), we note that RS carries a current of −V1/RS, leading to
ID2 = −I1 −V1/RS, and hence VGS2 = (−I1 −V1/RS)/gm2. Adding the voltage drops across RD and RS to VGS2,
we have
I1RD −I1
gm2
−
V1
gm2RS
−V1 = 0
(8.193)
and
RR1 = −gm1
V1
I1
(8.194)
= 1 −gm2RD
1 + gm2RS
gm1RS
(8.195)
For RR2, the arrangement in Fig. 8.83(c) yields ID1 = −I2RS/(RS + 1/gm1) = −I2gm1RS/(1 + gm1RS). Adding
the voltage drops across RD and RS to V2, we obtain
−I2gm1RS
1 + gm1RS
RD + V2 + I2
1/gm1
RS + 1/gm1
RS = 0
(8.196)
It follows that
RR2 = 1 −gm1RD
1 + gm1RS
gm2RS
(8.197)
The return ratios are unequal and can assume positive or negative values independently.
▲

Sec. 8.7
Middlebrook’s Method
331
8.7
Middlebrook’s Method
Middlebrook exploits the “Dissection Theorem” to derive the closed-loop transfer function without
breaking the loop and while revealing the effect of backward (reverse) propagation in non-unilateral
loops [5, 6]. This theorem states that any transfer function, H(s), can be dissected into a product of
the form
H(s) = H∞
1 + 1
T2
1 + 1
T1
(8.198)
where Hinf ty, T1, and T2 are simpler transfer functions corresponding to special cases, e.g., with some
signal in the loop forced to zero. These quantities are computed as follows. As shown in Fig. 8.84, we
insert a voltage source, Vt, in series with a branch of the circuit and inject a current, It, to either side
of Vt. We now have four new quantities, namely, V1, V2, I1, and I2. (Note the polarity of V1.) The key
point here is that the loop is not broken, and hence loading effects are immaterial. The “ideal” transfer
function, H∞, is obtained as follows:
H∞(s) = Vout
Vin
|V 1=0,I1=0
(8.199)
Vout
Vin
Vt
V1
I1
I2
V2
It
Figure 8.84
Illustration of Middle-
brook’s method.
i.e., we choose Vt and It such that V1 and I1 are forced to zero. The other two transfer functions are more
involved. Middlebrook shows that
1
T1
= 1
Ti
+ 1
Tv
+
1
T ′
i T ′v
(8.200)
where Vin = 0 and
Ti = I1
I2
|V 1=0 (Short-circuit forward current loop gain)
(8.201)
Tv = V1
V2
|I1=0 (Open-circuit forward voltage loop gain)
(8.202)
1
T ′
i
= I2
I1
|V 2=0 (Short-circuit reverse current loop gain)
(8.203)
1
T ′v
= V2
V1
|I2=0 (Open-circuit reverse voltage loop gain)
(8.204)

332
Chap. 8
Feedback
The computation of T2 is similar, except that it requires Vout (rather than Vin) to be forced to zero. We
observe that Middlebrook’s approach is generally more laborious than Bode’s method.
Middlebrook’s formulation provides insight regarding the forward (usually desirable) and reverse
(usually undesirable) signal propagation around a nonunilateral loop. With no reverse propagation, we
have 1/T ′
i = 1/T ′
v = 0 and T1 = Ti||Tv, e.g., the parallel combination of the two forward loop gains.
Middlebrook denotes this quantity by T f wd. In a similar fashion, we can deﬁne the total reverse loop gain
as Trev = (1/T ′
i )||(1/T ′
v) and manipulate Eq. (8.200) to reach
T1 =
T f wd
1 + Trev
(8.205)
The interesting observation here is that the equivalent loop gain is degraded if the reverse loop gain,
Trev, becomes comparable to unity—even if it remains much less than T f wd. Middlebrook, however,
recognizes that this interpretation is valid only if (a) Vt and It are injected such that V1 and I1 are the
“error” signal, a vague deﬁnition, and (b) Vt and It are injected inside the major loop and outside any
minor loops, again a vague condition. For example, a degenerated CS stage with λ > 0 eludes both of
these conditions.
8.8
Loop Gain Calculation Issues
8.8.1 Preliminary Concepts
The loop gain plays a central role in feedback systems, as evidenced by the universal factor 1+β A in the
closed-loop expressions of gain, bandwidth, input and output impedances, and nonlinearity. In addition,
if the poles and zeros in the loop are considered, then the loop gain [called the “loop transmission,” T (s),
in this case] reveals the circuit’s stability properties. For these reasons, we must often determine the loop
gain even if we are not interested in the open-loop parameters of the circuit.
According to the procedure illustrated in Fig. 8.5, the loop gain calculation should be straightforward:
we set the input to zero, break the loop at some point, apply a test signal, follow this signal around the
loop (in the proper direction), and obtain the returned signal. However, in some cases, the situation is
more complex, eliciting two questions: (1) Can we break the loop at any arbitrary point? (2) Should the
test signal be a voltage or a current? We remind the reader that in such a test, the actual input and output
disappear; i.e., the loop gain does not depend on where the main input and output ports are.
For example, consider the two-stage ampliﬁer shown in Fig. 8.85(a), where the resistive divider
consisting of R1 and R2 senses the output voltage and returns a fraction thereof to the source of M1.
As illustrated in Fig. 8.85(b), we set Vin to zero, break the loop at node X, apply a test signal to the
right terminal of R1, and measure the resulting VF.16 But is this test setup correct? First, we note that
in Fig. 8.85(a), R1 draws an ac current from RD2, but in Fig. 8.85(b), it does not. That is, the gain
associated with the second common-source stage has been altered. Second, why did we decide to apply
a test voltage? Can we apply a test current and measure a returned current?
To address the ﬁrst issue, we surmise that it is best to break the loop at the gate of a MOSFET. We
can break the loop at the gate of M2 [Fig. 8.85(c)] and thus not alter the gain associated with the ﬁrst
stage—at least at low frequencies. The reader is encouraged to derive the loop gain using Figs. 8.85(b)
and (c) and show that they are not equal.
What if we must include CGS of M2 [Fig. 8.86(a)]? Then, we break the loop after CGS2 [Fig. 8.86(b)]
to ensure that the load seen by M1 remains unchanged. But is it always possible to break the loop at the
16It is clear that, upon breaking the loop, we must apply the test signal to R1 and travel clockwise around the circuit. If we
apply Vt to the drain of M2 and travel counterclockwise, the result is meaningless.

Sec. 8.8
Loop Gain Calculation Issues
333
(b)
(a)
M1
VDD
RD1
Vin
R2
M2
M1
M1
M2
M2
RD2
R1
R2
R2
R1
R1
Vout
VDD
RD1
RD1
RD2
VDD
RD2
Vout
(c)
X
VF
VF
Vt
Vt
Figure 8.85
(a) Two-stage feedback ampliﬁer, (b) breaking the loop at the left terminal of R1, and (c) breaking
the loop at the gate of M2.
Vt
VF
M1
M1
VDD
RD1
Vin
R2
RD1
R2
M2
M2
RD2
VDD
RD2
R1
R1
Vout
X
CGS2
CGS2
(a)
(b)
Figure 8.86
(a) Two-stage ampliﬁer including CGS2, and (b) breaking the loop at the gate of M2.
gate of a MOSFET? Yes, indeed. For the feedback to be negative, the signal must be sensed by at least
one gate in the loop because only the common-source topology inverts signals.
Let us now turn our attention to the second issue, namely, the type of the test signal. In the foregoing
study, we naturally chose a test voltage, Vt, because we replaced the controlling voltage of a MOSFET
with an independent source. Under what condition can we apply a test current? In Fig. 8.85(a), for
example, we can break the loop at the drain of M2, inject a current It, and measure the current returned
by M2 [Fig. 8.87(a)]. The reader can prove that IF/It in this case is the same as VF/Vt in Fig. 8.85(c).
But what exactly should we do with the drain node of M2 in Fig. 8.87(a)? If tied to ac ground, this
node does not experience the voltage excursions present in the closed-loop circuit—an issue when rO2
is taken into account. We can merge rO2 with RD2 in this case, but not if M2 is degenerated. Thus, in
general, we cannot inject It without altering some aspects of the circuit.
Not all hope is lost yet. Suppose we replace the controlled current source of M2 with an independent
current source, It, and compute the returned VGS as VF [Fig. 8.87(b)]. Since in the original circuit,
the dependent source and VGS2 were related by a factor of gm2, we can now write the loop gain as
(−VF/It) × gm2. This approach is feasible even if M2 is degenerated. We recognize that this result is the
same as the return ratio of M2.
At low frequencies, the loop gain can be computed with the aid of the following observation. Since the
circuit incorporates negative feedback, the loop must traverse the gate of a transistor (only the CS stage

334
Chap. 8
Feedback
M1
RD1
R2
M2
RD2
R1
M1
RD1
R2
R1
It
IF
VDD
RD2
VDD
It
VF
(b)
(a)
Figure 8.87
(a) Breaking the loop at the drain of M2, and (b) replacing dependent source of M2 with an
independent source.
inverts).17 We can therefore break the loop at this gate without the need for including loading effects. Of
course, this method applies only if the loop has only one feedback mechanism.
In summary, the “best” place to break a feedback loop is (a) the gate-source of a MOSFET if voltage
injection is desired, or (b) the dependent current source of a MOSFET if current injection is desired
(provided that the returned quantity is VGS of the MOSFET). Of course, these two methods are related
because they differ by only a factor of gm.
Unfortunately, the foregoing techniques face difﬁculties in some cases. For example, suppose we
include CGD2 in Fig. 8.85(a). We inject a test voltage or current as before, but the issue is that CGD2 does
not allow a “clean” break. As shown in Fig. 8.88, even though we provide the gate-source voltage by the
independent source, Vt, CGD2 still creates “local” feedback from the drain of M2 to its gate, raising the
question of whether the loop gain should be obtained by nulling all feedback mechanisms. We should
also mention that the method of current and voltage injection proposed by Middlebrook in [3] applies
only if the loop is unilateral.
M1
RD1
R2
RD2
R1
VDD
CGD2
Vt
gm2
Vt
VF
Figure 8.88
Two-stage ampliﬁer
including CD2.
8.8.2 Difﬁculties with Return Ratio
Bode’s method enables us to compute the closed-loop transfer function in terms of four simpler transfer
functions—without the need for breaking the loop. But we are also interested in the loop gain as it
17One exception are source-degenerated devices (in CS or follower stages).

Sec. 8.8
Loop Gain Calculation Issues
335
VDD
RD1
R2
M2
M1
RD2
VDD
RD1
RD2
R1
R2
R1
I1
V1
I1
V1
(a)
(b)
Figure 8.89
Equivalent circuits for the calculation of the return ratios for (a) M1, and (b) M2.
determines the consequences of applying feedback to a given circuit, e.g., the increase in the bandwidth,
the reduction in the nonlinearity, and the stability behavior.
We may view the return ratio associated with a given dependent source as the loop gain, but circuits
containing more than one feedback mechanism may exhibit different return ratios for different sources.
As an example, we consider again the two-stage ampliﬁer shown in Fig. 8.85(a), recognizing that R1
and R2 provide both “global” feedback and “local” feedback (by degenerating M1). With the aid of the
equivalent circuits shown in Fig. 8.89, the reader can show that the return ratios for M1 and M2 are
respectively given by
Return Ratio|M1 = gm1R2(R1 + RD2 + gm2RD2RD1)
R1 + R2 + RD2
(8.206)
and
Return Ratio|M2 =
gm1gm2R2RD1RD2
(1 + gm1R2)(R1 + RD2) + R2
(8.207)
If, as in our standard loop gain calculations, we break the loop at the gate of M2, we obtain a value equal
to the return ratio for M2. It is unclear which return ratio should be considered the loop gain.
Why are the two return ratios different here? This is because disabling M1 (by making I1 an inde-
pendent source) removes both feedback mechanisms whereas disabling M2 still retains the degeneration
experienced by M1.
Another method of loop gain calculation is to inject a signal without breaking the loop, as shown in
Fig. 8.90, and write Y/W = 1/(1 + β A0), and hence
Loop Gain =
 Y
W
−1
−1
(8.208)
β
A0
W
Y
Figure 8.90
Another method of loop
gain calculation.

336
Chap. 8
Feedback
M1
VDD
RD
RF
RS
M1
VDD
RD
RF
RS
W
Y
W
Y
(a)
(b)
Figure 8.91
Different injection points in a nonunilateral circuit.
But this method tacitly assumes a unilateral loop, yielding different loop gains for different injection
points if the loop is not unilateral. For example, the circuit of Fig. 8.71(a) can be excited as shown in
Figs. 8.91(a) or (b), producing different values for (Y/W)−1 −1.
The exact calculation of the loop gain for non-unilateral or multiloop circuits is beyond the scope of
this book.
8.9
Alternative Interpretations of Bode’s Method
Bode’s results can be manipulated to produce other forms that offer new insights.
Asymptotic Gain Form
Let us return to Vout/Vin = A+gm BC/(1−gm D) and note that Vout/Vin = A
if gm = 0 (the dependent source is disabled) and Vout/Vin = A −BC/D if gm →∞(the dependent
source is very “strong”). We denote these values of Vout/Vin by H0 and H∞, respectively, and −gm D by
T . It is helpful to consider H0 as the direct feedthrough and H∞as the “ideal” gain, i.e., if the dependent
source were inﬁnitely strong (or the loop gain were inﬁnite). It follows that
Vout
Vin
= H0 + gm BC
1 + T
(8.209)
= H0
1 + T
1 + T + gm BC
1 + T
(8.210)
=
H0
1 + T + T (H0 + gm BC/T )
1 + T
(8.211)
Since H0 + gm BC/T = A −gm BC/(gm D) = A −BC/D = H∞, we have
Vout
Vin
= H∞
T
1 + T + H0
1
1 + T
(8.212)
Called the “asymptotic gain equation” [4], this form reveals that the gain consists of an ideal value
multiplied by T/(1+T ) and a direct feedthrough multiplied by 1/(1+T ). The calculations are somewhat
simpler here if we recognize from V1 = CVin + DI1 and I1 = gmV1 that V1 = CVin/(1 −gm D) →0 if
gm →∞(provided that Vin < ∞). This is similar to how a virtual ground is created if the loop gain is
large.
▲
Example8.32
Calculate the voltage gain of the circuit shown in Fig. 8.92(a) using the asymptotic gain method. Assume that
λ = γ = 0.

Sec. 8.9
Alternative Interpretations of Bode’s Method
337
M1
VDD
RD
M2
RS
R2
R2
R2
R1
R1
R1
Vin
Vin
Vin
Vout
Vout
Vout
A0 = −∞
−gm1 RD
+1
(c)
(a)
(b)
X
Figure 8.92
Solution
Suppose M1 is the dependent source of interest. If gm1 = 0, then Vin propagates through R1 and R2 and sees an
impedance of (1/gm2)||RS at the source of M2. Thus,
H0 =
(1/gm2)||RS
(1/gm2)||RS + R1 + R2
(8.213)
If gm1 = ∞, then VGS1 = 0 (like a virtual ground), yielding a current of Vin/R1 through R1 and R2. That is
H∞= −R2
R1
(8.214)
an expected result because M1 and M2 operate as an op amp with an inﬁnite open-loop gain [Fig. 8.92(b)]. To
determine the return ratio for M1, we set Vin to zero, replace M1’s dependent source with an independent source, I1,
and express VX as −I1RD. Since M2 sees a load resistance of RS||(R1 + R2), we have Vout = −I1RD[RS||(R1 +
R2)]/[1/gm2 + RS||(R1 + R2)]. The gate voltage of M1 is equal to Vout R1/(R1 + R2), leading to
T1 = gm1RD
gm2[RS||(R1 + R2)]
1 + gm2[RS||(R1 + R2)]
R1
R1 + R2
(8.215)
We must now substitute for H∞, T, and H0 in Eq. (8.212) to obtain the closed-loop gain—a laborious task left for
the reader. This example suggests that the direct analysis of the circuit (without knowledge of feedback) may in fact
be simpler in some cases, as is true for this circuit.
It is instructive to repeat the foregoing calculations if M2 is the dependent source of interest. For gm2 = 0, Vin is
simply divided according to
H0 =
RS
RS + R1 + R2
(8.216)
For gm2 = ∞, we have VGS2 = 0, VX = Vout, and hence a current of −Vout/RD ﬂowing through M1. It follows
that VGS1 = −Vout/(gm1RD) and [Vin + Vout/(gm1RD)]/R1 = [−Vout/(gm1RD) −Vout]/R2. We therefore have
H∞=
−gm1R2RD
R1 + R2 + gm1R1RD
(8.217)
This result is also expected if we consider M2 an ideal unity-gain buffer (due to its inﬁnite gm) and redraw the circuit
as shown in Fig. 8.92(c).
The return ratio for M2 can be found as
T2 = gm2RS(gm1R1RD + R1 + R2)
RS + R1 + R2
(8.218)
Again, these values must be substituted in (8.212) to compute the closed-loop gain.
▲

338
Chap. 8
Feedback
Double-Null Method
Blackman’s impedance theorem raises an interesting question: Can we write
the transfer function of a circuit in a form similar to A(1 + Tsc)/(1 + Toc)? In other words, can we
generalize the result to a case in which Iin is replaced by an arbitrary input and Vin by an arbitrary output?
To understand the rationale for this question, let us observe that (1) Toc is the return ratio with Iin = 0,
i.e., Toc denotes the RR with the input set to zero in Fig. 8.76(a); and (2) Tsc is the RR with Vin = 0,
i.e., Tsc represents the return ratio with the output forced to zero. Figure 8.93 conceptually illustrates the
setups for these two measurements, with one “nulling” the input and the other, the output. We make a
slight change in our notation and postulate that the transfer function of a given circuit can be written as
Vout
Vin
= A1 + Tout,0
1 + Tin,0
(8.219)
where A = Vout/Vin with the dependent source set to zero, and Tout,0 and Tin,0 respectively denote the
return ratios for Vout = 0 and Vin = 0.
V1
I1
V1
I1
Tin,0
Tout,0
Short
Vin
Vout = 0 
(a)
(b)
Figure 8.93
Conceptual illustration of Tin,0 and Tout,0.
The proof of (8.219) is similar to that of Blackman’s theorem. Beginning from
Vout = AVin + BI1
(8.220)
V1 = CVin + DI1
(8.221)
we recognize that, if Vin = 0, then V1/I1 = D, and hence Tin,0 = −gm D. On the other hand, if Vout = 0,
then Vin = (−B/A)I1, and hence V1/I1 = (AD−BC)/A, i.e., Tout,0 = −gm(AD−BC)/A. Combining
these results indeed yields (8.219). Note that division by A in these calculations assumes that A ̸= 0, a
critical point revisited below.
Equation (8.219) offers interesting insights. The quantity Tout,0 reveals that, even though Vin and I1
are chosen so as to drive Vout to zero, there is still an “internal” feedback loop emanating from I1 and
producing a ﬁnite value for V1. The generic system of Fig. 8.1, on the other hand, does not lend itself to
this perspective because its feedback network, G(s), directly senses the output. The following example
illustrates this point.
▲
Example8.33
Determine Vout/Vin in Fig. 8.94(a), assuming λ = γ = 0. Note that the feedback network does not sense the main
output here.
Solution
If M1 is the dependent source of interest and gm1 = 0, then the voltage at the source of M2 is equal to Vin(RS||g−1
m2)/
(RS||g−1
m2 + R1 + R2), yielding
A = gm2RD2
RS||g−1
m2
RS||g−1
m2 + R1 + R2
(8.222)

Problems
339
M1
M2
RD1
M2
RS
R2
RS
R2
VDD
RD2
RD1
VDD
RD2
R1
R1
Vout
Vin
Vin
I1
V1
0
(a)
(b)
Figure 8.94
To obtain Tout,0, we choose Vin and I1 so as to produce Vout = 0, and hence VGS2 = 0 and ID2 = 0 [Fig. 8.94(b)].
The source voltage of M2 is therefore equal to −I1RD1 and also equal to Vin RS/(R1 + R2 + RS). Similarly,
V1 = Vin(R2 + RS)/(R1 + R2 + RS) and
Tout,0 = −gm1
V1
I1
(8.223)
= gm1RD1
R2 + RS
RS
(8.224)
The nonzero Tout,0 implies that I1 still controls V1 through an internal loop even though Vout = 0. The loop gain
with Vin = 0 is given by Eq. (8.215).
What if M2 is the dependent source of interest? Then, for gm2 = 0, we have Vout = 0, and hence A = 0. Equation
(8.219) thus fails to hold because its derivation has assumed that A ̸= 0. This shortcoming of the double-null method
manifests itself in many CMOS circuits, even in a simple degenerated common-source stage.
▲
References
[1] H. W. Bode, Network Analysis and Feedback Ampliﬁer Design (New York, D. Van Nostrand, Inc., 1945).
[2] R. B. Blackman, “Effect of Feedback on Impedance,” Bell System Tech. J., vol. 23, pp. 269–277, October 1943.
[3] R. D. Middlebrook, “Measurement of Loop Gain in Feedback Systems,” Int. J. Electronics, vol. 38, pp. 485–512,
April 1975.
[4] S. Rosenstark, “A Simpliﬁed Method of Feedback Ampliﬁer Analysis,” IEEE Trans. Education, vol. 17, pp. 192–
198, November 1974.
[5] R. D. Middlebrook, “The General Feedback Theorem: A Final Solution for Feedback Systems,” IEEE Microwave
Magazine, pp. 50–63, April 2006.
[6] R. D. Middlebrook, unpublished chapters available at www.rdmiddlebrook.com.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3
V where necessary. Also, assume that all transistors are in saturation.
8.1.
Consider the circuit of Fig. 8.3(b), assuming that I1 is ideal and gm1rO1 cannot exceed 50. If a gain error of
less than 5% is required, what is the maximum closed-loop voltage gain that can be achieved by this topology?
What is the low-frequency closed-loop output impedance under this condition?

340
Chap. 8
Feedback
8.2.
In the circuit of Fig. 8.8(a), assume that (W/L)1 = 50/0.5, (W/L)2 = 100/0.5, RD = 2 k, and C2 = C1.
Neglecting channel-length modulation and body effect, determine the bias current of M1 and M2 such that
the input resistance at low frequencies is equal to 50 .
8.3.
Calculate the output impedance of the circuit shown in Fig. 8.9(a) at relatively low frequencies if RD is
replaced by an ideal current source.
8.4.
Consider the example illustrated in Fig. 8.11. Suppose an overall voltage gain of 500 is required with maximum
bandwidth. How many stages with what gain per stage must be placed in a cascade? (Hint: ﬁrst ﬁnd the 3-dB
bandwidth of a cascade of n identical stages in terms of that of each stage.)
8.5.
If in Fig. 8.22(b), ampliﬁer A0 exhibits an output impedance of R0, calculate the closed-loop voltage gain
and output impedance, taking into account loading effects.
8.6.
Consider the circuit of Fig. 8.25(a), assuming that (W/L)1,2 = 50/0.5 and (W/L)3,4 = 100/0.5. If ISS =
1 mA, what is the maximum closed-loop voltage gain that can be achieved if the gain error is to remain below
5%?
8.7.
The circuit of Fig. 8.42 can operate as a transimpedance ampliﬁer if Iout ﬂows through a resistor, RD2,
connected to VDD, producing an output voltage. Replacing RS with an ideal current source and assuming
that λ = γ = 0, calculate the transimpedance of the resulting circuit. Also, calculate the input-referred noise
current per unit bandwidth.
8.8.
For the circuit of Fig. 8.51(a), calculate the closed-loop gain without neglecting G12I2. Prove that this term
can be neglected if G12 ≪A0Zin/Zout.
8.9.
Calculate the loop gain of the circuit in Fig. 8.54 by breaking the loop at node X. Why is this result somewhat
different from G21 Av,open?
8.10. Using feedback techniques, calculate the input and output impedance and voltage gain of each circuit in
Fig. 8.95.
M1
M1
VDD
I1
(c)
(a)
(b)
M2
Vin
RS
M2
Vin
RS
Vb
I1
Vout
VDD
I1
Vout
M1
VDD
I1
Vout
Vb2
VDD
I1
Vout
Zin
M2
Vin
RS
I1
Zin
I1
Zin
M2
Vin
RS
I1
Zin
λ = γ = 0
λ = γ = 0
λ = γ = 0
λ = γ = 0
Vb
M1
(d)
Figure 8.95

Problems
341
8.11. Using feedback techniques, calculate the input and output impedances of each circuit in Fig. 8.96.
λ = 0
λ = 0
λ ≠ 0
M1
C2
C1
VDD
I1
(c)
(a)
(b)
Vin
Vout
C2
C2
C1
C1
VDD
VDD
M2
I1
M1
M1
Vin
Vin
Vout
Vout
Figure 8.96
8.12. Consider the circuit of Fig. 8.54(a), assuming that (W/L)1 = (W/L)2 = 50/0.5, λ = γ = 0, and each
resistor is equal to 2 k. If ID2 = 1 mA, what is the bias current of M1? What value of Vin gives such a
current? Calculate the overall voltage gain.
8.13. Suppose the ampliﬁer of the circuit shown in Fig. 8.22 has an open-loop transfer function A0/(1 + s/ω0) and
an output resistance R0. Calculate the output impedance of the closed-loop circuit and plot the magnitude as
a function of frequency. Explain the behavior.
8.14. Calculate the input-referred noise voltage of the circuit shown in Fig. 8.25(a) at relatively low frequencies.
8.15. A differential pair with current-source loads can be represented as in Fig. 8.97(a), where R0 = rON∥rO P and
rON and rO P denote the output resistance of NMOS and PMOS devices, respectively. Consider the circuit
shown in Fig. 8.97(b), where Gm1 and Gm2 are placed in a negative feedback loop.
Gm
R0
R0
R0
R0
R0
R0
Vout
Vout
Vin
Zin
Gm1
Gm2
C1
C1
(a)
(b)
Figure 8.97
(a) Neglecting all other capacitances, derive an expression for Zin. Sketch |Zin| versus frequency.
(b) Explain intuitively the behavior observed in part (a).
(c) Calculate the input-referred thermal noise voltage and current in terms of the input-referred noise voltage
of each Gm stage.
8.16. In the circuit of Fig. 8.98, (W/L)1−3 = 50/0.5, ID1 = |ID2| = |ID3| = 0.5 mA, and RS1 = RF = RD2 =
3 k.

342
Chap. 8
Feedback
M1
VDD
RD2
RF
X
Vin
M3
RS1
Vout
M2
Vb
Figure 8.98
(a) Determine the input bias voltage required to establish the above currents.
(b) Calculate the closed-loop voltage gain and output resistance.
8.17. The circuit of Fig. 8.98 can be modiﬁed as shown in Fig. 8.99, where a source follower, M4, is inserted in
the feedback loop. Note that M1 and M4 can also be viewed as a differential pair. Assume that (W/L)1−4 =
50/0.5, ID = 0.5 mA, for all transistors RS1 = RF = RD2 = 3 k, and Vb2 = 1.5 V. Calculate the
closed-loop voltage gain and output resistance, and compare the results with those obtained in the previous
problem.
M1
VDD
RD2
RF
Vin
M3
RS1
Vout
M2
Vb1
M4
Vb2
Figure 8.99
8.18. Consider the circuit of Fig. 8.100, where (W/L)1−4 = 50/0.5, |ID1−4| = 0.5 mA, and R2 = 3 k.
M1
VDD
Vin
M3
Vb
M2
M4
R2
R1
Vout
Figure 8.100
(a) For what range of R1 are the above currents established while M2 remains in saturation? What is the
corresponding range of Vin?
(b) Calculate the closed-loop gain and output impedance for R1 in the middle of the range obtained in part (a).
8.19. In the circuit of Fig. 8.101, suppose all resistors are equal to 2 k and gm1 = gm2 = 1/(200 ). Assuming
that λ = γ = 0, calculate the closed-loop gain and output impedance.
8.20. A CMOS inverter can be used as an ampliﬁer with or without feedback (Fig. 8.102). Assume that (W/L)1,2 =
50/0.5, R1 = 1 k, R2 = 10 k, and the dc levels of Vin and Vout are equal.
(a) Calculate the voltage gain and the output impedance of each circuit.
(b) Calculate the sensitivity of each circuit’s output with respect to the supply voltage. That is, calculate the
small-signal “gain” from VDD to Vout. Which circuit exhibits less sensitivity?

Problems
343
M1
VDD
RD1
RF1
Vin
RS1
M2
RF2
RD2
Vout
Figure 8.101
M1
M1
Vin
Vin
Vout
M2
M2
VDD
Vout
VDD
R2
R1
(a)
(b)
Figure 8.102
8.21. Calculate the input-referred thermal noise voltage of the circuits shown in Fig. 8.102.
8.22. The circuit shown in Fig. 8.103 employs positive feedback to produce a negative input capacitance. Using
feedback analysis techniques, determine Zin and identify the negative capacitance component. Assume that
λ = γ = 0.
VDD
M3
M2
C1
I1
M1
Zin
Figure 8.103
8.23. In the circuit of Fig. 8.104, assume that λ = 0, gm1,2 = 1/(200 ), R1−3 = 2 k, and C1 = 100 pF.
Neglecting other capacitances, estimate the closed-loop voltage gain at very low and very high frequencies.
M1
Vout
M2
VDD
R3
R2
Vin
R1
Vb
C1
Figure 8.104

CHAPTER
9
Operational Ampliﬁers
Operational ampliﬁers (op amps) are an integral part of many analog and mixed-signal systems. Op amps
with vastly different levels of complexity are used to realize functions ranging from dc bias generation to
high-speed ampliﬁcation or ﬁltering. The design of op amps continues to pose a challenge as the supply
voltage and transistor channel lengths scale down with each generation of CMOS technologies.
This chapter deals with the analysis and design of CMOS op amps. Following a review of perfor-
mance parameters, we describe simple op amps such as telescopic and folded-cascode topologies. Next,
we study two-stage and gain-boosting conﬁgurations and the problem of common-mode feedback. Fi-
nally, we introduce the concept of slew rate and analyze the effect of supply rejection and noise in
op amps. The reader is encouraged to read this chapter before dealing with more advanced designs in
Chapter 11.
9.1
General Considerations
We loosely deﬁne an op amp as a “high-gain differential ampliﬁer.” By “high,” we mean a value that is
adequate for the application, typically in the range of 101 to 105. Since op amps are usually employed to
implement a feedback system, their open-loop gain is chosen according to the precision required of the
closed-loop circuit.
Up to three decades ago, most op amps were designed to serve as “general-purpose” building blocks,
satisfying the requirements of many different applications. Such efforts sought to create an “ideal” op
amp, e.g., with a very high voltage gain (several hundred thousand), high input impedance, and low output
impedance, but at the cost of many other aspects of the performance, e.g., speed, output voltage swings,
and power dissipation.
By contrast, today’s op amp design proceeds with the recognition that the trade-offs between the
parameters eventually require a multi dimensional compromise in the overall implementation, making it
necessary to know the adequate value that must be achieved for each parameter. For example, if the speed
is critical while the gain error is not, a topology is chosen that favors the former, possibly sacriﬁcing the
latter.
9.1.1 Performance Parameters
In this section, we describe a number of op amp design parameters, providing an understanding of why
and where each may become important. For this discussion, we consider the differential cascode circuit
344

Sec. 9.1
General Considerations
345
VDD
M5
M1
M2
ISS
Vin
M8
Vb1
M3
M4
Vout
M7
M6
Vb2
Vb3
Figure 9.1
Cascode op amp.
shown in Fig. 9.1 as a representative op amp design.1 The voltages Vb1−Vb3 are generated by the current
mirror techniques described in Chapter 5.
Gain
The open-loop gain of an op amp determines the precision of the feedback system employing the
op amp. As mentioned before, the required gain may vary by four orders of magnitude according to the
application. Trading with such parameters as speed and output voltage swings, the minimum required
gain must therefore be known. As explained in Chapter 14, a high open-loop gain may also be necessary
to suppress nonlinearity.
▲
Example9.1
The circuit of Fig. 9.2 is designed for a nominal gain of 10, i.e., 1 + R1/R2 = 10. Determine the minimum value of
A1 for a gain error of 1%.
R2
R1
Vin
Vout
A1
Figure 9.2
Solution
The closed-loop gain is obtained from Chapter 8 as
Vout
Vin
=
A1
1 +
R2
R1 + R2
A1
(9.1)
= R1 + R2
R2
A1
R1 + R2
R2
+ A1
(9.2)
1Since op amps of this type have a high output impedance, they are sometimes called “operational transconductance ampliﬁers”
(OTAs). In the limit, the circuit can be represented by a single voltage-dependent current source and called a “Gm stage.”

346
Chap. 9
Operational Ampliﬁers
Predicting that A1 ≫10, we approximate (9.2) as
Vout
Vin
≈

1 + R1
R2

1 −R1 + R2
R2
1
A1

(9.3)
The term (R1 + R2)/(R2 A1) = (1 + R1/R2)/A1 represents the relative gain error. To achieve a gain error less than
1%, we must have A1 > 1000.
▲
It is instructive to compare the circuit of Fig. 9.2 with an open-loop implementation such as that in
Fig. 9.3. While it is possible to obtain a nominal gain of gm RD = 10 by a common-source stage, it
is extremely difﬁcult to guarantee an error less than 1%. The variations in the mobility and gate-oxide
thickness of the transistor and the value of the resistor typically yield an error greater than 20%.
M1
RD
Vout
VDD
Vin
Figure 9.3
Simple common-source
stage.
Small-Signal Bandwidth
The high-frequency behavior of op amps plays a critical role in many appli-
cations. For example, as the frequency of operation increases, the open-loop gain begins to drop (Fig. 9.4),
creating larger errors in the feedback system. The small-signal bandwidth is usually deﬁned as the “unity-
gain” frequency, fu, which can reach several gigahertz in today’s CMOS op amps. The 3-dB frequency,
f3-dB, may also be speciﬁed to allow easier prediction of the closed-loop frequency response.
f(log axis)
Av
f3−dB
0
20log
fu
Figure 9.4
Gain roll-off with
frequency.
▲
Example9.2
In the circuit of Fig. 9.5, assume that the op amp is a single-pole voltage ampliﬁer. If Vin is a small step, calculate
the time required for the output voltage to reach within 1% of its ﬁnal value. What unity-gain bandwidth must the
R2
R1
Vin
Vout
A(s)
t
Vin
Vout
0
Figure 9.5

Sec. 9.1
General Considerations
347
op amp provide if 1 + R1/R2 ≈10 and the settling time is to be less than 5 ns? For simplicity, assume that the
low-frequency gain is much greater than unity.
Solution
Since

Vin −Vout
R2
R1 + R2

A(s) = Vout
(9.4)
we have
Vout
Vin
(s) =
A(s)
1 +
R2
R1 + R2
A(s)
(9.5)
For a one-pole system, A(s) = A0/(1+s/ω0), where ω0 is the 3-dB bandwidth and A0ω0 the unity-gain bandwidth.
Thus,
Vout
Vin
(s) =
A0
1 +
R2
R1 + R2
A0 + s
ω0
(9.6)
=
A0
1 +
R2
R1 + R2
A0
1 +
s

1 +
R2
R1 + R2
A0

ω0
(9.7)
indicating that the closed-loop ampliﬁer is also a one-pole system with a time constant equal to
τ =
1

1 +
R2
R1 + R2
A0

ω0
(9.8)
Recognizing that the quantity R2 A0/(R1 + R2) is the low-frequency loop gain and usually much greater than unity,
we have
τ ≈

1 + R1
R2

1
A0ω0
(9.9)
The output step response for Vin = au(t) can now be expressed as
Vout(t) ≈a

1 + R1
R2

1 −exp −t
τ

u(t)
(9.10)
with the ﬁnal value VF ≈a(1 + R1/R2). For 1% settling, Vout = 0.99VF, and hence
1 −exp −t1%
τ
= 0.99,
(9.11)
yieldingt1% = τ ln 100 ≈4.6τ.Fora1%settlingof5ns,τ ≈1.09ns,andfrom(9.9), A0ω0 ≈(1+R1/R2)/τ = 9.21
Grad/s (1.47 GHz).
▲
The key point in the above example is that the bandwidth is dictated by both the required settling
accuracy (e.g., Vout = 0.99VF) and the closed-loop gain (1 + R1/R2).

348
Chap. 9
Operational Ampliﬁers
▲
Example9.3
A student mistakenly swaps the inverting and non-inverting inputs of the op amp in Fig. 9.5. Explain how the circuit
behaves.
Solution
Positive feedback may destabilize the circuit. For a one-pole op amp, we have

Vout
R2
R1 + R2
−Vin

A0
1 + s
ω0
= Vout
(9.12)
and hence
Vout
Vin
(s) =
A0
1 −
R2
R1 + R2
A0
1 −
s
(1 +
R2
R1 + R2
A0)ω0
(9.13)
Interestingly, the closed-loop ampliﬁer contains a pole in the right half plane, exhibiting a step response that grows
exponentially with time:
Vout(t) ≈a

1 + R1
R2

exp t
τ −1

u(t)
(9.14)
This growth continues until the op amp output saturates.
▲
Large-Signal Behavior
In many of today’s applications, op amps must operate with large transient
signals. Under these conditions, nonlinear phenomena make it difﬁcult to characterize the speed merely
by small-signal properties such as the open-loop response shown in Fig. 9.4. As an example, suppose
the feedback circuit of Fig. 9.5 incorporates a realistic op amp (i.e., with ﬁnite output impedance) while
driving a large load capacitance. How does the circuit behave if we apply a 1-V step at the input? Since the
output voltage cannot change instantaneously, the voltage difference sensed by the op amp itself at t ≥0
is equal to 1 V. Such a large difference momentarily drives the op amp into a nonlinear region of operation.
(Otherwise, with an open-loop gain of, say, 1000, the op amp would produce 1000 V at the output.)
As explained in Sec. 9.9, the large-signal behavior is usually quite complex, calling for careful simu-
lations.
Output Swing
Most systems employing op amps require large voltage swings to accommodate a wide
range of signal amplitudes. For example, a high-quality microphone that senses the music produced
by an orchestra may generate instantaneous voltages that vary by more than four orders of magnitude,
demanding that subsequent ampliﬁers and ﬁlters handle large swings (and/or achieve a low noise).
The need for large output swings has made fully differential op amps popular. Similar to the circuits
described in Chapter 4, such op amps generate “complementary” outputs, roughly doubling the available
swing. Nonetheless, as mentioned in Chapters 3 and 4 and explained later in this chapter, the maximum
voltage swing trades with device size and bias currents and hence speed. Achieving large swings is the
principal challenge in today’s op amp design.
Linearity
Open-loop op amps suffer from substantial nonlinearity. In the circuit of Fig. 9.1, for example,
the input pair M1–M2 exhibits a nonlinear relationship between its differential drain current and its input
voltage. As explained in Chapter 14, the issue of nonlinearity is tackled by two approaches: using fully

Sec. 9.2
One-Stage Op Amps
349
differential implementations to suppress even-order harmonics and allowing sufﬁcient open-loop gain
for the closed-loop feedback system to achieve adequate linearity. It is interesting to note that in many
feedback circuits, the linearity requirement, rather than the gain error requirement, governs the choice of
the open-loop gain.
Noise and Offset
The input noise and offset of op amps determine the minimum signal level that can
be processed with reasonable quality. In a typical op amp topology, several devices contribute noise and
offset, necessitating large dimensions or bias currents. For example, in the circuit of Fig. 9.1, M1–M2
and M7-M8 contribute the most.
We should also recognize a trade-off between noise and output swing. For a given bias current, as
the overdrive voltage of M7 and M8 in Fig. 9.1 is lowered to allow larger swings at the output, their
transconductance increases and so does their drain noise current.
Supply Rejection
Op amps are often employed in mixed-signal systems and sometimes connected to
noisy digital supply lines. Thus, the performance of op amps in the presence of supply noise, especially
as the noise frequency increases, is important. For this reason, fully differential topologies are preferred.
9.2
One-Stage Op Amps
9.2.1 Basic Topologies
All of the differential ampliﬁers studied in Chapters 4 and 5 can be considered op amps. Figure 9.6 shows
two such topologies with single-ended and differential outputs. The small-signal, low-frequency gain of
both circuits is equal to gmN(rON∥rO P), where the subscripts N and P denote NMOS and PMOS, respec-
tively. This value hardly exceeds 10 in nanometer technologies. The bandwidth is usually determined by
the load capacitance, CL. Note that the circuit of Fig. 9.6(a) exhibits a mirror pole (Chapter 6) whereas
that of Fig. 9.6(b) does not, a critical difference in terms of the stability of feedback systems using these
topologies (Chapter 10).
VDD
M4
M1
M2
ISS
M3
(a)
Vout
Vin
CL
VDD
M4
M1
M2
ISS
Vin1
CL
(b)
Vb
M3
Vout1
Vout2
Vin2
CL
Figure 9.6
Simple op amp topologies.
The circuits of Fig. 9.6 suffer from noise contributions of M1–M4, as calculated in Chapter 7. Inter-
estingly, in all op amp topologies, at least four devices contribute to the input noise: two input transistors
and two “load” transistors.
▲
Example9.4
Calculate the input common-mode voltage range and the closed-loop output impedance of the unity-gain buffer
depicted in Fig. 9.7.

350
Chap. 9
Operational Ampliﬁers
Vin
Vout
VDD = 1 V
M4
M1
M2
ISS
M3
Vin
Vout
Figure 9.7
Solution
The minimum allowable input voltage is equal to VI SS + VGS1, where VI SS is the voltage required across the current
source. The maximum voltage is given by the level that places M1 at the edge of the triode region: Vin,max =
VDD −|VGS3| + VT H1. For example, if each device (including the current source) has a threshold voltage of 0.3 V
and an overdrive of 0.1 V, then Vin,min = 0.1 + 0.1 + 0.3 = 0.5 V and Vin,max = 1 −(0.1 + 0.3) + 0.3 = 0.9 V.
Thus, the input CM range equals 0.4 V with a 1-V supply.
Since the circuit employs voltage feedback at the output, the output impedance is equal to the open-loop value,
rO P∥rON, divided by one plus the loop gain, 1 + gmN(rO P∥rON). In other words, for large open-loop gain, the
closed-loop output impedance is approximately equal to (rO P∥rON)/[gmN(rO P∥rON)] = 1/gmN.
It is interesting to note that the closed-loop output impedance is relatively independent of the open-loop output
impedance. This is an important observation, allowing us to design high-gain op amps by increasing the open-loop
output impedance while still achieving a relatively low closed-loop output impedance. We also observe that, if driving
a load capacitance of CL, the op amp incurs a closed-loop output pole approximately given by gmN/CL.
▲
In order to achieve a high gain, the differential cascode topologies of Chapters 4 and 5 can be used.
Shown in Figs. 9.8(a) and (b) for single-ended and differential output generation, respectively, such
circuits display a gain on the order of gmN[(gmNr2
ON)∥(gmPr2
O P)], but at the cost of output swing and
VDD
M6
M1
M2
ISS
M5
Vin
M8
M7
Vb
M3
M4
Vout
X
VDD
M5
M1
M2
ISS
Vin
M8
Vb1
M3
M4
M7
M6
Vb2
Vb3
(a)
(b)
Vout
Y
Figure 9.8
Cascode op amps.

Sec. 9.2
One-Stage Op Amps
351
additional poles. These conﬁgurations are also called “telescopic” cascode op amps to distinguish them
from another cascode op amp described below. The circuit providing a single-ended output suffers from
a mirror pole at node X (and a pole at Y), creating stability issues (Chapter 10).
As calculated in Chapter 4 , the output swings of telescopic op amps are relatively limited. In the fully
differential version of Fig. 9.8(b), for example, the output swing is given by 2[VDD −(VO D1 + VO D3 +
VI SS + |VO D5| + |VO D7|)], where VO Dj denotes the overdrive voltage of M j and VI SS the minimum
allowable voltage across ISS. We must recognize the three conditions necessary for allowing this much
swing: (1) the input CM level, Vin,C M, is chosen low enough and equal to VGS1 + VI SS, (2) Vb1 is also
chosen low enough and equal to VGS3 + (Vin,C M −VT H1), placing M1 at the edge of saturation, and (3)
Vb2 is chosen high enough and equal to VDD −|VO D7| −|VGS5|, placing M7 at the edge of saturation.
Thus, Vin,C M (and Vb1 and Vb2) must be controlled tightly, a serious issue.
Another drawback of telescopic cascodes is the difﬁculty in shorting their inputs and outputs, e.g., to
implement a unity-gain buffer similar to the circuit of Fig. 9.7. To understand the issue, let us consider
the unity-gain feedback topology shown in Fig. 9.9. Under what conditions are both M2 and M4 in
saturation? We must have Vout ≤VX +VT H2 and Vout ≥Vb −VT H4. Since VX = Vb −VGS4, Vb −VT H4 ≤
Vout ≤Vb −VGS4 + VT H2. Depicted in Fig. 9.9, this voltage range is simply equal to Vmax −Vmin =
VT H4 −(VGS4 −VT H2) (one threshold minus one overdrive), maximized by minimizing the overdrive of
M4 but always less than VT H2.
VDD
M6
M1
M2
ISS
M5
Vin
M8
M7
Vb
M3
M4
X
Vout
VGS4 − VTH2
Vb
Vb − VTH4
VTH4
Allowable
Range
Figure 9.9
Telescopic cascode op amp with input and output shorted.
▲
Example9.5
For the circuit of Fig. 9.9, explain in which region each transistor operates as Vin varies from below Vb −VT H4 to
above Vb −VGS4 + VT H2.
Solution
Since the op amp attempts to force Vout to be equal to Vin, for Vin < Vb −VT H4, we have Vout ≈Vin, and M4 is
in the triode region while other transistors are saturated. Under this condition, the open-loop gain of the op amp is
reduced.
As Vin and hence Vout exceed Vb −VT H4, M4 enters saturation and the open-loop gain reaches a maximum. For
Vb −VT H4 < Vin < Vb −(VGS4 −VT H2), both M2 and M4 are saturated, and for Vin > Vb −(VGS4 −VT H2), M2
and M1 enter the triode region, degrading the gain.
▲

352
Chap. 9
Operational Ampliﬁers
While a cascode op amp is rarely used as a unity-gain buffer, some other topologies (such as the
switched-capacitor circuits of Chapter 13) reduce to the conﬁguration shown in Fig. 9.9 for part of their
operation period, as illustrated by the following example.
▲
Example9.6
Figure 9.10(a) shows a closed-loop ampliﬁer utilizing a telescopic op amp.2 Assuming that the op amp has a high
open-loop gain, determine the maximum allowable output voltage swing.
t
VX
VCM
Vb − VTH3,4
M3 and M4
in Triode
Region
t
VX
VCM
Vb − (VGS3,4 −VTH1,2) 
Vb − VTH3,4
(c)
R3
R4
R1
R2
Vb
M1
M2
M3
M4
R3
R4
R1
R2
X
Y
(a)
(b)
(d)
Figure 9.10
Solution
Let us draw the circuit as shown in Fig. 9.10(b), noting that its input and output common-mode levels are equal
(why?). Recall from the foregoing discussion that the voltage at the drains of M3 and M4 is bounded by Vb −VT H3,4
to keep M3 and M4 in saturation and Vb −(VGS3,4 −VT H1,2) to keep M1 and M2 in saturation. How should we set
the output CM level, VC M, in this range to maximize the output swing? If VC M = Vb −VT H3,4, then M3 and M4
reside at the edge of the triode region and cannot tolerate any downward swing [Fig. 9.10(c)]. On the other hand, if
we select VC M = Vb −(VGS3,4 −VT H1,2) (placing M1 and M2 at the edge), then VX or VY can fall to Vb −VT H3,4
while maintaining M3 and M4 in saturation [Fig. 9.10(d)].
With the latter choice, how high can VX or VY go? If the gain of the op amp is large, the gate voltages of M1
and M2 swing negligibly. Thus, VX and VY can arbitrarily rise from VC M = Vb −(VGS3,4 −VT H1,2) without
driving M1 and M2 into the triode region. (Of course, the PMOS loads constrain the upswing.) For symmet-
ric up- and downswings, therefore, the circuit allows a voltage excursion of ±(one threshold −one overdrive)
around VC M.
▲
2The input capacitors ensure that the bias conditions are not disturbed by the preceding stage.

Sec. 9.2
One-Stage Op Amps
353
9.2.2 Design Procedure
At this point, the reader may wonder how exactly we design an op amp. With so many devices and
performance parameters, it may not be clear where the starting point is and how the numbers are chosen.
Indeed, the actual design methodology of an op amp somewhat depends on the speciﬁcations that the
circuit must meet. For example, a high-gain op amp may be designed quite differently from a low-noise
op amp. Nevertheless, in most cases, some aspects of the performance, e.g., output voltage swings and
open-loop gain, are of primary concern, pointing to a speciﬁc design procedure. We will deal extensively
with ﬁve parameters for each transistor: ID, VGS −VT H, W/L, gm, and rO.
In the design of op amps (and many other circuits), it is helpful to begin with a power budget, even
if none is speciﬁed. As seen later in this section, the resulting design can readily be “scaled” for lower
or higher power dissipations. We describe a simple design here and deal with nanometer op amps in
Chapter 11.
▲
Example9.7
Design a fully differential telescopic op amp with the following speciﬁcations: VDD = 3 V, peak-to-peak differential
output swing = 3 V, power dissipation = 10 mW, voltage gain = 2000. Assume that μnCox = 60 μA/V2, μpCox =
30 μA/V2, λn = 0.1 V−1, λp = 0.2 V−1 (for an effective channel length of 0.5 μm), γ = 0, and VT H N = |VT H P| =
0.7 V.
Solution
Figure9.11showstheopamptopologyalongwithtwocurrentmirrorsdeﬁningthedraincurrentsof M7–M9.Webegin
with the power budget, allocating 3 mA to M9 and the remaining 330 μA to Mb1 and Mb2. Thus, each cascode branch
of the opampcarriesacurrentof1.5mA.Next, we consider the required output swings. Each of nodes X and Y must be
able to swing by 1.5 Vpp without driving M3–M6 into the triode region. With a 3-V supply, therefore, the total voltage
available for M9 and each cascode branch is equal to 1.5 V, i.e., |VO D7|+|VO D5|+ VO D3 + VO D1 + VO D9 = 1.5 V.
VDD
M5
M1
M2
Vin
M8
Vb1
M3
M4
M7
M6
Vb2
Mb2
IREF2
M9
Mb1
IREF1
X
Y
Vout
Figure 9.11
Since M9 carries the largest current, we choose VO D9 ≈0.5 V, leaving 1 V for the four transistors in the cascode.
Moreover, since M5–M8 suffer from low mobility, we allocate an overdrive of approximately 300 mV to each,
obtaining 400 mV for VO D1 + VO D3. As an initial guess, VO D1 = VO D3 = 200 mV.
With the bias current and overdrive voltage of each transistor known, we can easily determine the aspect ratios from
ID = (1/2)μCox(W/L)(VGS −VT H)2 or simulated I/V characteristics. To minimize the device capacitances, we
choose the minimum length for each transistor, obtaining a corresponding width. We then have (W/L)1−4 = 1250,
and (W/L)5−8 = 1111, and (W/L)9 = 400.

354
Chap. 9
Operational Ampliﬁers
The reader may think that the above choice of overdrives is arbitrary and leads to a wide design space. However,
we must emphasize that each of the overdrives has but a small range. For example, we can change the allocated
values by only a few tens of millivolts before the device dimensions become disproportionately large.
The design has thus far satisﬁed the swing, power dissipation, and supply voltage speciﬁcations. But, how about the
gain? Using Av ≈gm1[(gm3rO3rO1)∥(gm5rO5rO7)] and assuming minimum channel length for all of the transistors,
we have Av = 1416, quite a lot lower than the required value.
In order to increase the gain, we recognize that gmrO = √2μCox(W/L)ID/(λID). Now, recall that λ ∝1/L,
and hence gmrO ∝√W L/ID. We can therefore increase the width or length or decrease the bias current of the
transistors. In practice, speed or noise requirements may dictate the bias current, leaving only the dimensions as
the variables. Of course, the width of each transistor must at least scale with its length so as to maintain a constant
overdrive voltage.
Which transistors in the circuit of Fig. 9.11 should be made longer? Since M1–M4 appear in the signal path, it
is desirable to keep their capacitances to a minimum. The PMOS devices, M5–M8, on the other hand, affect the
signal to a much lesser extent and can therefore have larger dimensions.3 Doubling the (effective) length and width
of each of these transistors in fact doubles their gmrO because gm remains constant while rO increases by a factor
of 2. Choosing (W/L)5−8 = 2222 μm/1.0 μm and hence λp = 0.1 V−1, we obtain Av ≈4000. Thus, the PMOS
dimensions can be somewhat smaller. Note that with such large dimensions for PMOS transistors, we may revisit
our earlier distribution of the overdrive voltages, possibly reducing that of M9 by 100 to 200 mV and allocating more
to the PMOS devices.
In the op amp of Fig. 9.11, the input CM level and the bias voltages Vb1 and Vb2 must be chosen so as to allow
maximum output swings. The minimum allowable input CM level equals VGS1 +VO D9 = VT H1 +VO D1 +VO D9 =
1.4 V. The minimum value of Vb1 is given by VGS3 + VO D1 + VO D9 = 1.6 V, placing M1–M2 at the edge of the
triode region. Similarly, Vb2,max = VDD −(|VGS5| + |VO D7|) = 1.7 V. In practice, some margin must be included
in the value of Vb1 and Vb2 to allow for process variations. Also, the increase in the threshold voltages due to body
effect must be taken into account. Finally, we should remark that this op amp requires common-mode feedback
(CMFB) (Section 9.7).
▲
9.2.3 Linear Scaling
How do we modify the above design if the power budget is different but all other speciﬁcations remain
the same? Suppose we are allowed to double the power dissipation and hence the bias current of each
transistor. The key concept behind “linear scaling” is to double the widths of all of the transistors in the
circuit while keeping the lengths constant. Returning to our ﬁve device design parameters, we observe
that, in this example, (1) ID is doubled, (2) W/L is doubled, (3) VGS −VT H is constant, and so are the
allowable voltage swings, (4) gm is doubled because both the bias current and the width are doubled (as
if two identical transistors were placed in parallel), and (5) rO is halved (for the same reason that gm
is doubled). We therefore conclude that linear scaling by adjusting the transistor widths simply scales
the power dissipation while retaining the gain and swing values. This concept is used in Chapter 11 to
optimize the performance of op amps.
▲
Example9.8
An engineer seeking a low-power op amp design scales down the transistor widths in Example 9.7 by a factor of 10.
Explain what aspects of the performance degrade.
Solution
Since the gm of each transistor falls by a factor of 10, two aspects are sacriﬁced: (1) the speed of the op amp in
driving a capacitive load (e.g., the output pole in Example 9.4) degrades proportionally, and (2) the input-referred
noise voltage of the op amp rises by a factor of
√
10 (Sec. 9.12).
▲
3This point is studied in Chapter 10.

Sec. 9.2
One-Stage Op Amps
355
In nanometer technologies, op amp design can still follow the above procedure, but with greater
reliance on simulated device characteristics. Unfortunately, the lower supply voltage severely limits the
output swing, making the telescopic cascode less attractive. We return to these points in Chapter 11.
The gate bias voltages Vb1 and Vb2 in the telescopic cascode of Fig. 9.11 must be generated with some
precision. We note that if, for example, Vb1 is less than its nominal value, then M1 and M2 enter the triode
region. The same occurs even if Vb1 is ﬁxed, but the input CM level is slightly higher than expected.
To ensure that Vb1 “tracks” the input CM level, we can generate Vb1 as shown in Fig. 9.12(a). Here, a
small current I1 ﬂows through the diode-connected device, Mb1, producing Vb1 = VP + VGS,b1. Since
VP tracks the input CM level (VP = Vin,C M −VGS1,2), we have
Vb1 = Vin,C M −VGS1,2 + VGS,b1
(9.15)
which should be chosen equal to Vin,C M −VT H1,2 + VGS3,4 to allow M1 and M2 to operate in saturation.
It follows that
VGS,b1 = (VGS1,2 −VT H1,2) + VGS3,4
(9.16)
indicating that Mb1 must be “weak” enough to sustain a VGS equal to one overdrive plus the gate-source
voltage of M3 and M4. This is accomplished by choosing Mb1 to be a narrrow, long device.
Vb1
M1
M2
M4
M3
Mb1
I1
VDD
ISS
P
Figure 9.12
Generation of cascode
gate voltage.
9.2.4 Folded-Cascode Op Amps
In order to alleviate the drawbacks of telescopic cascode op amps, namely, limited output swings and
difﬁculty in choosing equal input and output CM levels, a “folded-cascode” op amp can be used. As
described in Chapter 3 and illustrated in Fig. 9.13, in an NMOS or PMOS cascode ampliﬁer, the input
device is replaced by the opposite type while still converting the input voltage to a current. In the four
circuits shown in Fig. 9.13, the small-signal current generated by M1 ﬂows through M2 and subsequently
the load, producing an output voltage approximately equal to gm1RoutVin. The primary advantage of the
folded structure lies in the choice of the voltage levels because it does not “stack” the cascode transistor
on top of the input device. We will return to this point later.
ThefoldingideadepictedinFig.9.13caneasilybeappliedtodifferentialpairs,andhencetooperational
ampliﬁers as well. Shown in Fig. 9.14, the resulting circuit replaces the input NMOS pair with a PMOS
counterpart. Note two important differences between the two circuits. (1) In Fig. 9.14(a), one bias current,
ISS,providesthedraincurrentofboththeinputtransistorsandthecascodedevices,whereasinFig.9.14(b),
the input pair requires an additional bias current. In other words, ISS1 = ISS/2+ ID3 = ISS/2+ I1. Thus,
the folded-cascode conﬁguration generally consumes more power. (2) In Fig. 9.14(a), the input CM level

356
Chap. 9
Operational Ampliﬁers
M1
DD
Vout
Vb
VDD
M2
M1
Vin
I2
(b)
Vout
I2
VDD
Vin
Vb
I1
I1
M1
Vin
M2
Vb
Vout
VDD
I1
(a)
V
M1
M2
Vb
Vin
I1
Vout
M2
Figure 9.13
Folded-cascode ampliﬁers.
VDD
M1
M2
Vin
Vb1
M3
M4
Vout
(b)
I2
I1
VDD
Vb1
M3
M4
I2
I1
Vout
ISS2
ISS1
ISS
Vin
M1
M2
(a)
ISS
Figure 9.14
(a) Telescopic and (b) folded-cascode op amp topologies.
cannot exceed Vb1 −VGS3 + VT H1, whereas in Fig. 9.14(b), it cannot be less than Vb1 −VGS3 −|VT H P|.
It is therefore possible to design the latter to allow shorting its input and output terminals with negligible
swing limitation. This is in contrast to the behavior depicted in Fig. 9.9. In Fig. 9.14(b), it is possible to
tie the n-wells of M1 and M2 to their common source point. We return to this idea in Chapters 14 and 19.
Let us now calculate the maximum output voltage swing of the folded-cascode op amp shown in
Fig. 9.15, where M5–M10 replace the ideal current sources of Fig. 9.14(b). With proper choice of Vb1 and
Vb2, the lower end of the swing is given by VO D3 + VO D5 and the upper end by VDD −(|VO D7|+|VO D9|).
Thus, the peak-to-peak swing on each side is equal to VDD −(VO D3 + VO D5 + |VO D7| + |VO D9|). In the
telescopic cascode of Fig. 9.14(a), on the other hand, the swing is less by the overdrive of the tail current
source. We should nonetheless note that, carrying a large current, M5 and M6 in Fig. 9.15 may require a
high overdrive voltage if their capacitance contribution to nodes X and Y is to be minimized.
We now determine the small-signal voltage gain of the folded-cascode op amp of Fig. 9.15. Using the
half circuit depicted in Fig. 9.16(a) and writing |Av| = Gm Rout, we must calculate Gm and Rout. As shown
in Fig. 9.16(b), the output short-circuit current is approximately equal to the drain current of M1 because
the impedance seen looking into the source of M3, that is, (gm3 + gmb3)−1∥rO3, is typically much lower
than rO1∥rO5. Thus, Gm ≈gm1. To calculate Rout, we use Fig. 9.16(c), with RO P ≈(gm7 + gmb7)rO7rO9,
to write Rout ≈RO P∥[(gm3 + gmb3)rO3(rO1∥rO5)]. It follows that
|Av| ≈gm1{[(gm3 + gmb3)rO3(rO1∥rO5)]∥[(gm7 + gmb7)rO7rO9]}
(9.17)

Sec. 9.2
One-Stage Op Amps
357
Vb1
M3
M4
ISS
Vin
M1
M2
VDD
M10
Vout
M9
Y
Vb2
Vb3
Vb4
M8
M7
M5
M6
X
Figure 9.15
Folded-cascode op amp with cascode PMOS loads.
Vb1
X
M3
M1
ROP
Vb1
Vout
X
Vb2
Vb3
VDD
M9
M7
M3
Vin
M1
rO5
(a)
rO1
rO5
rO1
rO5
rO1
Vb1
X
M3
Vin
M1
(b)
(c)
Iout
Rout
Figure 9.16
(a) Half circuit of folded cascode op amp, (b) equivalent circuit for Gm calculation, and
(c) equivalent circuit for Rout calculation.
The reader is encouraged to repeat this calculation without neglecting the current drawn by rO5||rO1 in
Fig. 9.16(b).
How does this value compare with the gain of a telescopic op amp? For comparable device dimensions
and bias currents, the PMOS input differential pair exhibits a lower transconductance than does an NMOS
pair. Furthermore, rO1 and rO5 appear in parallel, reducing the output impedance, especially because M5
carries the currents of both the input device and the cascode branch. As a consequence, the gain in (9.17)
is usually two to three times lower than that of a comparable telescopic cascode.
It is also worth noting that the pole at the “folding point,” i.e., the sources of M3 and M4, is quite
closer to the origin than that associated with the source of cascode devices in a telescopic topology. In
Fig. 9.17(a), Ctot arises from CGS3, CSB3, CDB1, and CGD1. By contrast, in Fig. 9.17(b), Ctot contains
additional contributions due to CGD5 and CDB5, typically signiﬁcant components because M5 must be
wide enough to carry a large current with a small overdrive.

358
Chap. 9
Operational Ampliﬁers
M1
ISS
Vin
Vb
M3
Ctot
Vb1
M3
ISS
Vin
M1
Vb4
M5
Ctot
(a)
(b)
Figure 9.17
Effect of device capacitance on the nondominant pole in telescopic and folded-cascode op amps.
A folded-cascode op amp may incorporate NMOS input devices and PMOS cascode transistors.
Illustrated in Fig. 9.18, such a circuit potentially provides a higher gain than the op amp of Fig. 9.15
because of the greater mobility of NMOS devices, but at the cost of lowering the pole at the folding
points. To understand why, note that the pole at node X is given by the product of 1/(gm3 + gmb3) and the
total capacitance at this node (if the output pole is dominant). The magnitude of both of these components
is relatively high: M3 suffers from a low transconductance, and M5 contributes substantial capacitance
because it must be wide enough to carry the drain currents of both M1 and M3. In fact, for comparable
bias currents, M5–M6 in Fig. 9.18 may be several times wider than M5–M6 in Fig. 9.15. For applications
sensitive to ﬂicker noise, the PMOS-input op amp is preferable (Sec. 9.12).
VDD
M3
M1
M2
Vin
M6
Vb1
M7
M8
Vout
M5
M4
Vb2
Mb2
IREF2
M11
Mb1
IREF1
X
Y
Mb3
IREF3
M9
M10
Figure 9.18
Realization of a folded-cascode op amp.
9.2.5 Folded-Cascode Properties
Our study thus far suggests that the overall voltage swing of a folded-cascode op amp is only slightly
higherthanthatofatelescopicconﬁguration.Thisadvantagecomesatthecostofhigherpowerdissipation,
lower voltage gain, lower pole frequencies, and, as explained in Sec. 9.12, higher noise. Nonetheless,
folded-cascode op amps are used more widely for two reasons: (1) their input and output CM levels can
be chosen equal without limiting the output swings, and (2) compared to telescopic cascodes, they can
accommodate a wider input CM range. Let us elaborate on these properties.
Consider the closed-loop ampliﬁer of Fig. 9.19(a), assuming a folded-cascode op amp. We can draw
the circuit as shown in Fig. 9.19(b) or Fig. 9.19(c), noting that the input and output CM levels are equal.
With a high open-loop gain, the gate voltages of M1 and M2 swing negligibly while VX and VY can reach
within two overdrives of ground or VDD. This should be compared with the swings in Fig. 9.10.

Sec. 9.2
One-Stage Op Amps
359
(a)
M1 M2
R3
R1
R4
R2
M3
M4
X
Y
R3
R4
R1
R2
M1 M2
R3
R1
R4
R2
VDD
M3
M10
M6
M9
M4
X
Y
M7
M8
M5
(c)
(b)
Figure 9.19
(a) Feedback ampliﬁer, (b) implementation using a folded-cascode op amp, and (c) alternative
drawing to ﬁnd allowable swings.
In feedback topologies where the input and output CM levels need not be equal, the folded cascode
allows a wider input CM range than does the telescopic cascode. In Fig. 9.18, for example, Vin,C M must
exceed VGS1,2 + (VGS11 −VT H11), but it can be as high as Vb2 + |VGS3| + VT H1,2 before M1 and M2 enter
the triode region. Note that this upper bound can be greater than VDD (why?). Similarly, a PMOS-input
conﬁguration can handle input CM levels as low as zero.
9.2.6 Design Procedure
We now deal with the design of folded-cascode op amps to reinforce the foregoing concepts.
▲
Example9.9
Design a folded-cascode op amp with an NMOS input pair (Fig. 9.18) to satisfy the following speciﬁcations:
VDD = 3 V, differential output swing = 3 V, power dissipation = 10 mW, and voltage gain = 2000. Use the same
device parameters as in Example 9.5.
Solution
As with the telescopic cascode of the previous example, we begin with the power and swing speciﬁcations. Allocating
1.5 mA to the input pair, 1.5 mA to the two cascode branches, and the remaining 330 μA to the three current mirrors,
we ﬁrst consider the devices in each cascode branch. Since M5 and M6 must each carry 1.5 mA, we allow an
overdrive of 500 mV for these transistors so as to keep their width to a reasonable value. To M3–M4, we allocate
400 mV and to M7–M10, 300 mV. Thus, (W/L)5,6 = 400, (W/L)3,4 = 313, and (W/L)7−10 = 278. Since the
minimum and maximum output levels are equal to 0.6 V and 2.1 V, respectively, the optimum output common-mode
level is 1.35 V.
The minimum dimensions of M1–M2 are dictated by the minimum input common-mode level, VGS1 + VO D11.
For example, if the input and the output CM levels are equal (Fig. 9.20), then VGS2 + VO D11 = 1.35 V. With

360
Chap. 9
Operational Ampliﬁers
M1
M2
Vin
M6
M8
M4
M11
Y
M10
VDD
Figure 9.20
Folded-cascode op amp
with input and output shorted.
VO D11 = 0.4 V as an initial guess, we have VGS1 = 0.95 V, obtaining VO D1,2 = 0.95 −0.7 = 0.25 V, and hence
(W/L)1,2 = 400. The maximum dimensions of M1 and M2 are determined by the tolerable input capacitance and
the capacitance at nodes X and Y in Fig. 9.18.
We now calculate the small-signal gain. Using gm = 2ID/(VGS −VT H), we have gm1,2 = 0.006 A/V, gm3,4 =
0.0038 A/V, and gm7,8 = 0.05 A/V. For L = 0.5 μm, rO1,2 = rO7−10 = 13.3 k, and rO3,4 = 2rO5,6 = 6.67 k.
It follows that the impedance seen looking into the drain of M7 (or M8) is equal to 8.8 M whereas, owing to the
limited intrinsic gain of M3 (or M4), that seen looking into the drain of M3 is equal to 66.5 k. The overall gain is
therefore limited to about 400.
In order to increase the gain, we ﬁrst observe that rO5,6 is quite lower than rO1,2. Thus, the length of M5–
M6 must be increased. Also, the transconductance of M1–M2 is relatively low and can be increased by widening
these transistors. Finally, we may decide to double the intrinsic gain of M3 and M4 by doubling both their length
and their width, but at the cost of increasing the capacitance at nodes X and Y. We leave the exact choice of the
device dimensions as an exercise for the reader. Note that the op amp must incorporate common-mode feedback
(Sec. 9.7).
▲
Telescopic and folded-cascode op amps can also be designed to provide a single-ended output. Shown
inFig.9.21(a)isanexample,whereaPMOScascodecurrentmirrorconvertsthedifferentialcurrentsof M3
VDD
M6
M1
M2
ISS
M5
Vin
M8
M7
Vb
M3
M4
Vout
X
(a)
(b)
VDD
M6
M1
M2
ISS
M5
Vin
M8
M7
Vb1
M3
M4
Vout
Vb2
X
Figure 9.21
Cascode op amps with single-ended output.

Sec. 9.3
Two-Stage Op Amps
361
and M4 to a single-ended output voltage. In this implementation, however, VX = VDD −|VGS5|−|VGS7|,
limiting the maximum value of Vout to VDD −|VGS5| −|VGS7| + |VT H6| and “wasting” one PMOS
threshold voltage in the swing (Chapter 5). To resolve this issue, the PMOS load can be modiﬁed to a
low-voltage cascode (Chapter 5), as shown in Fig. 9.21(b), so that M7 and M8 are biased at the edge of
the triode region. Similar ideas apply to folded-cascode op amps as well.
The circuit of Fig. 9.21(a) suffers from two disadvantages with respect to its differential counterpart
in Fig. 9.8(b). First, it provides only half the output voltage swing. Second, it contains a mirror pole
at node X (Chapter 5), thus limiting the speed of feedback systems employing such an ampliﬁer. It is
therefore preferable to use the differential topology, although it requires a feedback loop to deﬁne the
output common-mode level (Sec. 9.7).
9.3
Two-Stage Op Amps
The op amps studied thus far exhibit a “one-stage” nature in that they allow the small-signal current
produced by the input pair to ﬂow directly through the output impedance, i.e., they perform voltage-to-
current conversion only once. The gain of these topologies is therefore limited to the product of the input
pair transconductance and the output impedance. We have also observed that cascoding in such circuits
increases the gain while limiting the output swings.
In some applications, the gain and/or the output swings provided by cascode op amps are not adequate.
For example, a modern op amp must operate with supply voltages as low as 0.9 V while delivering single-
ended output swings as large as 0.8 V. In such cases, we resort to “two-stage” op amps, with the ﬁrst
stage providing a high gain and the second, large swings (Fig. 9.22). In contrast to cascode op amps, a
two-stage conﬁguration isolates the gain and swing requirements.
Stage 1
Stage 2
Vin
Vout
High Gain
High Swing
Figure 9.22
Two-stage op amp.
Each stage in Fig. 9.22 can incorporate various ampliﬁer topologies studied in previous sections,
but the second stage is typically conﬁgured as a simple common-source stage so as to allow maximum
output swings. Figure 9.23 shows an example, where the ﬁrst and second stages exhibit gains equal to
gm1,2(rO1,2∥rO3,4) and gm5,6(rO5,6∥rO7,8), respectively. The overall gain is therefore comparable to that
VDD
M4
M1
M2
ISS
M3
Vb1
Vin
M7
M8
Vb2
M5
M6
Vout2
Vout1
X
Y
Figure 9.23
Simple implementation of a two-stage op amp.

362
Chap. 9
Operational Ampliﬁers
of a cascode op amp, but the swing at Vout1 and Vout2 is equal to VDD −|VO D5,6| −VO D7,8, the highest
possible value.4
To obtain a higher gain, the ﬁrst stage can incorporate cascode devices, as depicted in Fig. 9.24. With
a gain of, say, 10 in the output stage, the voltage swings at X and Y are quite small, allowing optimization
of M1–M8 for higher gain. The overall voltage gain can be expressed as
Av ≈{gm1,2[(gm3,4 + gmb3,4)rO3,4rO1,2]∥[(gm5,6 + gmb5,6)rO5,6rO7,8]}
× [gm9,10(rO9,10∥rO11,12)]
(9.18)
Vb4
M10
Vout2
Vout1
VDD
M5
M1
M2
ISS
Vin
M8
Vb1
M3
M4
M7
M6
Vb2
Vb3
Vb4
M11
M12
M9
X
Y
Figure 9.24
Two-stage op amp employing cascoding.
A two-stage op amp can provide a single-ended output. One method is to convert the differential
currents of the two output stages to a single-ended voltage. Illustrated in Fig. 9.25, this approach maintains
the differential nature of the ﬁrst stage, using only the current mirror M7–M8 to generate a single-ended
output.
VDD
M4
M1
M2
ISS
M3
Vb
Vin
M5
M6
Vout
M7
M8
Figure 9.25
Two-stage op amp with
single-ended output.
4One can replace M7 and M8 with resistors to allow greater swings, but the gain would be limited.

Sec. 9.3
Two-Stage Op Amps
363
Can we cascade more than two stages to achieve a higher gain? As explained in Chapter 10, each
gain stage introduces at least one pole in the open-loop transfer function, making it difﬁcult to guarantee
stability in a feedback system using such an op amp. For this reason, op amps having more than two
stages are rarely used. Exceptions are described in [1, 2, 3].
9.3.1 Design Procedure
The design of two-stage op amps is somewhat more complex. We present a simple example here and
more detailed designs in Chapter 11.
▲
Example9.10
Design the two-stage op amp of Fig. 9.23 for VDD = 1 V, P = 1 mW, a differential output swing of 1 Vpp, and a gain
of 100. Use the same device parameters as in Example 9.7, but assume that VT H N = 0.3 V and VT H P = −0.35 V.
Solution
We allocate a bias current of 960 μA to M1–M8, leaving 40 μA for the bias branches that generate Vb1 and Vb2. Let
us split the current budget equally between the ﬁrst and second stages, i.e., assume that ID1 = · · · = I8 = 120 μA.
Since the second stage is likely to provide a voltage gain of 5 to 10, the output swing of the ﬁrst stage need not
be large. Speciﬁcally, if the second stage is designed for a gain of 5 and a single-ended output swing of 0.5 Vpp,
the ﬁrst stage need only sustain 0.1 Vpp at X (or Y). The choice of overdrive voltages for M1–M4 and ISS is
therefore quite relaxed, i.e., |VO D3| + |VO D1| + VI SS = 1 V −0.1 V = 0.9 V. But we must consider two points: (1)
recall from Chapter 7 that the noise contributed by current sources M3 and M4 is minimized by maximizing their
overdrive voltage, and (2) the gain (and noise) requirements dictate a high gm for M1 and M2 and, inevitably, a low
overdrive voltage. In fact, the latter point typically translates to subthreshold operation for the input devices, yielding
a maximum gm of ID/(ξVT ) ≈(325 )−1 with ξ = 1.5. But, we ignore subthreshold operation in this example.
How large can the overdrive of M3 and M4 be? Since VDS3,4 = VGS5,6 in this case, the upper bound may be
imposed by M5 and M6 rather than by the ﬁrst stage. For example, if the design of the second stage eventually yields
|VGS5,6| = 400 mV, and if VX (or VY ) can rise by 50 mV (for a 100-mVpp swing), then M3 and M4 experience a
minimum |VDS| of 350 mV. We must therefore revisit this allocation after the second stage is designed.
For a single-ended output swing of 0.5 Vpp, we can choose 200 mV and 300 mV for the overdrives of the output
NMOS and PMOS devices, respectively. With ID = 120 μA, we then compute the W/L values of these transistors.
However, this allocation faces two issues: (1) the large overdrive of M5 and M6 may translate to an inadequately
low gm = 2ID/(VGS −VT H), and (2) the small overdrive of M7 and M8 gives them a high noise current. For these
reasons, we swap the overdrive allocation, giving 300 mV to M7 and M8 and 200 mV to M5 and M6. The penalty is
the larger W/L of the latter pair and hence a greater capacitance at X and Y.
We begin the calculations from the output stage. With |ID| = 120 μA and the above overdrives, we have
gm5,6 = 2|ID/(VGS −VT H)| = (833 )−1,rO5,6 = 1/(λ|ID|) = 42 k, and rO7,8 = 83 k (for the minimum
channel length of 0.5 μm). The second stage thus provides a gain of about 33, allowing even smaller voltage swings
for the ﬁrst stage. The corresponding device dimensions are (W/L)5,6 = 200 and (W/L)7,8 = 44.
Returning to the ﬁrst stage in Fig. 9.23, we note that VDS3,4 = |VGS5,6| = 550 mV. Transistors M3 and M4 can
therefore operate with an overdrive as high as 500 mV (if we still assume VX or VY can rise by 50 mV from the bias
value) but require a |VGS| of 500 mV + |VT H P| = 850 mV, and hence Vb1 = 150 mV. Such a low Vb1 may cause
difﬁculty in the design of the current mirror driving M3 and M4. Instead, we choose |VGS3,4 −VT H P| = 400 mV,
obtaining (W/L)3,4 = 50, gm3,4 = 1/(1.7 k), and rO3,4 = 83 k (for L = 0.5 μm).
The input transistors, M1 and M2, exhibit an output resistance of 83 k (with L = 0.5 μm) and can have an
overdrive as large as 0.5 V. However, with such an overdrive, gm1,2/gm3,4 = |VGS3,4 −VT H P|/(VGS1,2 −VT H N) =
4/5, implying that the PMOS devices contribute substantial noise. For this reason, we choose an overdrive of 100
mV for M1 and M2, arriving at gm1,2 = 1/(420 ), (W/L)1,2 = 400, and a voltage gain of gm1,2(rO1||rO3) = 66
for the ﬁrst stage.
This design provides an overall gain of more than 2,000, primarily because of the low bias current and the use of
an older technology. As explained in Chapter 11, nanometer two-stage op amps suffer from much lower gains.
▲

364
Chap. 9
Operational Ampliﬁers
9.4
Gain Boosting
9.4.1 Basic Idea
The limited gain of the one-stage op amps studied in Sec. 9.2 and the difﬁculties in using two-stage op
amps at high speeds have motivated extensive work on new topologies. Recall that in one-stage op amps,
such as telescopic and folded-cascode topologies, the objective is to maximize the output impedance so
as to attain a high voltage gain. The idea behind gain boosting is to further increase the output impedance
without adding more cascode devices [4, 5]. We neglect body effect for simplicity, but it can be readily
included at the end.
First Perspective
Suppose a transistor is preceded by an ideal voltage ampliﬁer as shown in Fig. 9.26(a).
M2
Iout
Vin
A1
M2
Iout
Vin
A1
V1
rO
A1gmV1
Iout
(a)
(b)
Figure 9.26
(a) Transistor preceded by a voltage ampliﬁer, and (b) equivalent circuit.
Wenotethattheoverallcircuitexhibitsatransconductanceof A1gm andavoltagegainof−A1gmrO (why?).
We thus surmise that this arrangement can be viewed as a three-terminal device (a “supertransistor”)
having a transconductance of A1gm and an output resistance of rO [Fig. 9.26(b)]. We neglect body effect
in this section.
Let us now incorporate this new device in a familiar topology and examine the circuit’s behavior.
We begin with the degenerated stage depicted in Fig. 9.27(a) and wish to compute its transconductance
(with the output shorted to ac ground). Since RS carries Iout, the small-signal gate voltage is given
by (Vin −RS Iout)A1, yielding a gate-source voltage of (Vin −RS Iout)A1 −RS Iout and hence Iout =
gm[(Vin −RS Iout)A1 −RS Iout]. It follows that
Iout
Vin
=
A1gm
1 + (A1 + 1)gm RS
(9.19)
M2
Iout
Vin
A1
RS
M2
A1
RS
VX
rO
I0
IX
(a)
(b)
Figure 9.27
Arrangements for calculation of (a) transconductance, and (b) output resistance.

Sec. 9.4
Gain Boosting
365
Without A1,thetransconductancewouldbeequalto gm/(1+gm RS).Interestingly,theequivalenttranscon-
ductance has risen by a factor of A1 in the numerator and A1 + 1 in the denominator, revealing that the
model shown in Fig. 9.26(b) is not quite correct. However, since in practice A1 ≫1, the error introduced
by this model is acceptably low.
How about the output resistance of the degenerated stage? From the setup in Fig. 9.27(b), we can
express the voltage drop across RS as IX RS and the gate voltage of M2 as −A1IX RS. That is, I0 =
(−A1RS IX −RS IX)gm. Also, rO carries a current equal to (VX −RS IX)/rO. We now have
IX = (−A1RS −RS)gm IX + VX −RS IX
rO
(9.20)
and
Rout = rO + (A1 + 1)gmrO RS + RS
(9.21)
Without A1, the output resistance would be equal to rO + gmrO RS + RS.
Equation (9.21) is a remarkable result, suggesting that the output resistance of the circuit is “boosted,”
as if the transconductance of M2 were raised by a factor of A1 +1. This increase in Rout is afforded while
the degenerated stage retains its voltage headroom. We can see that the allowable voltage swing at the
drain of M2 is approximately the same for this structure and a simple degenerated transistor.
▲
Example9.11
Determine the resistance seen at the source of M2 in Fig. 9.28(a) if γ = 0.
M2
Vin
A1
VDD
RD
RX
RD
VX
IX
M2
A1
rO
I0
(a)
(b)
IX
Figure 9.28
Solution
InthesetupshowninFig.9.28(b),thesmall-signalgatevoltageisequalto−A1VX,andhence I0 = (−A1VX−VX)gm.
Also, RD carries a current of IX, generating a voltage equal to IX RD at the drain with respect to ground. Since the
current ﬂowing downward through rO is given by (IX RD −VX)/rO, we have at the source node
IX RD −VX
rO
+ (−A1VX −VX)gm + IX = 0
(9.22)
and
RX =
RD + rO
1 + (A1 + 1)gmrO
(9.23)
Without A1, this resistance would be equal to (RD + rO)/(1 + gmrO). This example too suggests that the transcon-
ductance of M2 is raised by a factor of A1 + 1.
▲

366
Chap. 9
Operational Ampliﬁers
In summary, the addition of the auxiliary ampliﬁer in Fig. 9.26(b) raises the equivalent gm of M2 by a
factor of A1 + 1, thereby boosting the output impedance of the stage. We surmise from Av = −Gm Rout
that the voltage gain can also be boosted, but where should the input be applied? As in a simple cascode
stage, let us replace the degeneration resistor with a voltage-to-current converter (Fig. 9.29), obtaining
an output impedance equal to rO2 + (A1 + 1)gm2rO2rO1 + rO1. The short-circuit transconductance is
nearly equal to gm1 because the resistance seen looking into the source of M2 is obtained from (9.23)
with RD = 0 and is given by rO2/[1 + (A1 + 1)gm2rO2] ≈[(A1 + 1)gm2]−1, a value much less than rO1.
It follows that
|Av| ≈gm1[rO2 + (A1 + 1)gm2rO2rO1 + rO1]
(9.24)
≈gm1gm2rO1rO2(A1 + 1)
(9.25)
As explained later in this section, this “gain-boosting” technique can be applied to cascode differential
pairs and op amps as well.
M2
A1
M1
VDD
Vout
Vb
P
Super Transistor
Vin
Figure 9.29
Basic gain-boosted stage.
Second Perspective
Consider the degenerated stage shown in Fig. 9.30(a). We wish to increase the
output resistance without stacking more cascode devices. Recall from Chapter 3 that if the drain voltage
changes by V , then the source voltage changes by VS = RS/[rO + (1 + gmrO)RS] (with γ = 0),
producing a change in the voltage across RS and hence in the drain current. We can loosely view the
effect as voltage division between RS and gmrO RS.
M2
A1
RS
VX
rO
I0
IX
Vb
ΔV
P
M2
RS
VX
rO
I0
IX
Vb
ΔV
P
ΔVS
(a)
(b)
RS
gm rO RS
VX
ΔV
RS
VX
ΔV
A1 gm rO RS
Figure 9.30
Response of (a) degenerated CS stage and (b) gain-boosted stage to a change in output voltage.
We now make an important observation. The change in the drain current in response to V can be
suppressed if two conditions hold: (a) the voltage across RS remains constant, and (b) the current ﬂowing
through RS remains equal to the drain current.5 How should we keep VP constant? We can compare VP to
5A constant voltage source tied from P to ground allows the former condition but not the latter.

Sec. 9.4
Gain Boosting
367
a “reference” voltage by means of an op amp and return the resulting error to a point in the circuit so as to
ensure that VP “tracks” the reference. Illustrated in Fig. 9.30(b), the idea is to apply the error, A1(Vb−VP),
to the gate of M2, forcing VP to be equal to Vb if the loop gain is large. The above two conditions are thus
satisﬁed. For example, if the drain voltage rises, VP also tends to rise, but, as a result, the gate voltage
falls, reducing the current drawn by M2. As derived below, this effect can be approximately viewed as
voltage division between RS and A1gmrO RS. For A1 →∞, VP is “pinned” to Vb and the drain current is
exactly equal to Vb/RS regardless of the drain voltage. This topology is also called a “regulated cascode”
as ampliﬁer A1 monitors and regulates the output current.
▲
Example9.12
Figure 9.31 shows the regulated cascode subjected to an output impedance test. Determine the small-signal values
of VP, VG, I0, and Iro. Assume that (A1 + 1)gmrO RS is large.
M2
A1
RS
VX
rO
I0
IX
P
VG
Iro
Figure 9.31
Solution
We know from our analysis of Fig. 9.27(b) that
VX = [rO + (A1 + 1)gmrO RS + RS]IX
(9.26)
and hence
VP = IX RS
(9.27)
=
RS
rO + (A1 + 1)gmrO RS + RS
VX
(9.28)
If (A1 + 1)gmrO RS is large, then VP ≈VX/[(A1 + 1)gmrO], implying that the ampliﬁer suppresses the change in
the voltage across RS by another factor of A1 + 1 compared to the case of a simple degenerated transistor. We also
have
VG = −A1VP
(9.29)
=
−A1RS
rO + (A1 + 1)gmrO RS + RS
VX
(9.30)
The small-signal gate-source voltage is equal to VG −VP ≈−VX/(gmrO), yielding I0 ≈−VX/rO. Moreover,
Iro = VX −VP
rO
(9.31)
=
rO + (A1 + 1)gmrO RS
rO + (A1 + 1)gmrO RS + RS
VX
rO
(9.32)
≈VX
rO
(9.33)

368
Chap. 9
Operational Ampliﬁers
Interestingly, I0 and Iro are nearly equal and opposite. That is, the ampliﬁer adjusts the gate voltage such that the
change in the intrinsic drain current, I0, almost cancels the current drawn by rO. We say that the small-signal current
of M2 circulates through rO.
▲
In summary, the above two perspectives portray two principles behind the gain-boosting technique: the
ampliﬁer boosts the gm of the cascode device, or the ampliﬁer regulates the output current by monitoring
and pinning the source voltage.
9.4.2 Circuit Implementation
In this section, we deal with the implementation of the auxiliary ampliﬁer in the regulated cascode and
extendthegain-boostingtechniquetoopamps.Thesimplestrealizationof A1 isacommon-sourcestage,as
showninFig.9.32(a).If I1 isideal,then|A1| = gm3rO3,yielding |Vout/Vin| ≈gm1rO1gm2rO2(gm3rO3+1),
as in a triple cascode. However, this topology limits the output voltage swing because the minimum
voltage at node P is dictated by VGS3 rather than the overdrive of M1. We note that Vout must remain
above VGS3 + (VGS2 −VT H2) here.
I3
M2
M1
Vin
VDD
Vout
P
I1
G
I2
M3
M4
VDD
Vb
A1
(c)
M2
M1
Vin
VDD
Vout
P
I1
A1
G
I2
M3
M2
M1
Vin
VDD
Vout
P
G
I2
M3
VDD
I1
A1
(a)
(b)
Figure 9.32
Gain-boosted ampliﬁer using (a) an NMOS CS stage, (b) a PMOS CS stage, and
(c) a folded-cascode stage.
To avoid this headroom limitation, we consider a PMOS common-source stage for A1 [Fig. 9.32(b)].
The operation and gain-boosting properties remain the same, but VP can now be as low as the overdrive
of M1. Unfortunately, M3 may enter the triode region here because the gate voltage of M2 tends to be too
high for the drain of M3. Speciﬁcally, if we target VP = VGS1 −VT H1, then VG = VGS2 + VGS1 −VT H1,

Sec. 9.4
Gain Boosting
369
revealing that the drain of M3 is higher than its gate by VGS2. If VGS2 > |VT H3|, M3 resides in the triode
region.
The above analysis implies that we must insert one more stage in the feedback loop so as to reach
compatible bias levels between consecutive stages. Let us interpose an NMOS common-gate stage be-
tween M3 and the gate of M2 [Fig. 9.32(c)]. The reader recognizes the resulting A1 topology as a folded
cascode, but we also observe that M4 provides an upward level shift from its source to its drain, allowing
VG to be higher than the drain voltage of M3.
▲
Example9.13
Determine the allowable range for Vb in Fig. 9.32(c).
Solution
The minimum value of Vb places I1 at the edge of the triode region, i.e., Vb,min = VGS4 + VI1. The maximum value
biases M4 at the edge of the triode region, i.e., Vb,max = VGS2 + VP + VT H4. Thus, Vb has a comfortably wide
range and need not be precise.
▲
We now apply gain boosting to a differential cascode stage, as shown in Fig. 9.33(a). Since the signals
at nodes X and Y are differential, we surmise that the two single-ended gain-boosting ampliﬁers A1 and
A2 can be replaced by one differential ampliﬁer [Fig. 9.33(b)]. Following the topology of Fig. 9.32(a), we
implement the differential auxiliary ampliﬁer as shown in Fig. 9.33(c), but noting that the minimum level
at the drain of M3 is equal to VO D3 + VGS5 + VI SS2, where VI SS2 denotes the voltage required across ISS2.
In a simple differential cascode, on the other hand, the minimum would be approximately one threshold
voltage lower.
(c)
(a)
(b)
M1
M2
ISS
Vin
M3
M4
M1
M2
ISS1
Vin
M3
M4
M6
M5
ISS2
I2
I1
M1
M2
ISS
Vin
M3
M4
X
Y
A1
A2
X
Y
X
Y
Figure 9.33
Boosting the output impedance of a differential cascode stage.
The voltage swing limitation in Fig. 9.33(c) results from the fact that the gain-boosting ampliﬁer
incorporates an NMOS differential pair. If nodes X and Y are sensed by a PMOS pair, the minimum
value of VX and VY is not dictated by the gain-boosting ampliﬁer. Now recall from Sec. 9.2 that the
minimum input CM level of a folded-cascode stage using a PMOS input pair can be zero. Thus, we
employ such a topology for the gain-boosting ampliﬁer, arriving at the circuit shown in Fig. 9.34. Here,
the minimum allowable level of VX and VY is given by VO D1,2 + VI SS1.

370
Chap. 9
Operational Ampliﬁers
M1
M2
ISS1
M3
M4
M7
M8
I2
I1
Vb
Vb
ISS2
M5
M6
X
Y
Figure 9.34
Folded-cascode circuit used as auxiliary ampliﬁer.
▲
Example9.14
Calculate the output impedance of the circuit shown in Fig. 9.34.
Solution
Using the half-circuit concept and replacing the ideal current sources with transistors, we obtain the equivalent
depicted in Fig. 9.35. The voltage gain from X to P is approximately equal to gm5Rout1, where Rout1 ≈[gm7rO7
(rO9∥rO5)]∥(gm11rO11rO13). Thus, Rout ≈gm3rO3rO1gm5Rout1. In essence, since the output impedance of a
cascode is boosted by a folded-cascode stage, the overall output impedance is similar to that of a “quadruple”
cascode.
M1
M3
M7
M5
X
Vb1
M11
M13
Vb3
Vb4
Vb2
Vin
Rout
Auxiliary Ampliﬁer
M9
P
Figure 9.35
▲
Regulated cascodes can also be utilized in the load current sources of a cascode op amp. Shown
in Fig. 9.36(a), such a topology boosts the output impedance of the PMOS current sources as well,
thereby achieving a very high voltage gain. To allow maximum swings at the output, ampliﬁer A2 must
employ an NMOS-input folded-cascode differential pair. Similar ideas apply to folded-cascode op amps
[Fig. 9.36(b)].

Sec. 9.4
Gain Boosting
371
M1
M2
ISS
Vin
M3
M4
Vout
M5
M6
M7
M8
Vb
VDD
A2
A1
M1
M2
ISS
Vin
M3
M4
Vout
M5
M6
M7
M8
Vb1
VDD
A2
A1
Vb2
M9
M10
(a)
(b)
Figure 9.36
Gain boosting applied to both signal path and load devices.
9.4.3 Frequency Response
Recall that the premise behind gain boosting is to increase the gain without adding a second stage or
more cascode devices. Does this mean that the op amps of Fig. 9.36 have a one-stage nature? After all,
the gain-boosting ampliﬁer introduces its own pole(s). In contrast to two-stage op amps, where the entire
signal experiences the poles associated with each stage, in a gain-boosted op amp, most of the signal
ﬂows directly through the cascode devices to the output. Only a small “error” component is processed
by the auxiliary ampliﬁer and “slowed down.”
In order to analyze the frequency response of the regulated cascode, we simplify the circuit to that
shown in Fig. 9.37, where the auxiliary ampliﬁer contains one pole at ω0, A1(s) = A0/(1 + s/ω0), and
only the load capacitance, CL, is included. We wish to determine Vout/Vin = −Gm Zout. To compute
Gm(s) (with the output node grounded), we note from Example 9.11 that the impedance seen looking
into the source of M2 is equal to rO2/[1 + (A1 + 1)gm2rO2], and divide the drain current of M1 between
this impedance and rO1:
Gm(s) = gm1
rO1
rO1 +
rO2
1 + (A1 + 1)gm2rO2
(9.34)
=
gm1rO1[1 + (A1 + 1)gm2rO2]
rO1 + (A1 + 1)gm2rO2rO1 + rO2
(9.35)
M2
A1(s)
M1
Vin
Vb
P
CL
Vout
Zout
Figure 9.37
Circuit for analysis of fre-
quency response.

372
Chap. 9
Operational Ampliﬁers
Now, we calculate Zout(s) as the parallel combination of CL and the impedance seen looking into the
drain of M2. From Eq. (9.21), we have
Zout = [rO1 + (A1 + 1)gm2rO2rO1 + rO2]|| 1
CLs
(9.36)
It follows that
Vout
Vin
(s) = −Gm(s)Zout(s)
(9.37)
=
−gm1rO1[1 + (A1 + 1)gm2rO2]
(rO1 + rO2)CLs + (A1 + 1)gm2rO2rO1CLs + 1
(9.38)
While it is tempting to assume that A1 ≫1 and hence neglect some terms, we must bear in mind that A1
falls at high frequencies. Replacing A1 with A0/(1 + s/ω0) yields
Vout
Vin
(s) =
−gm1rO1[(1 + gm2rO2) s
ω0
+ (A0 + 1)gm2rO2 + 1]
(rO1 + rO2)CL
ω0
[1 + gm2(rO2||rO1)]s2 + [(rO1 + rO2)CL + (A0 + 1)gm2rO2rO1CL + 1
ω0
]s + 1
(9.39)
It is interesting to note that, if we had assumed A1 to be large for Gm and Zout calculations, we would
have obtained a ﬁrst-order transfer function. The circuit exhibits a zero in the left half plane given by
|ωz| ≈(A0 + 1)ω0
(9.40)
if gm2rO2 ≫1. Produced by the path through A1, this zero is on the order of the unity-gain bandwidth of
the auxiliary ampliﬁer.
Toestimatepolefrequencies,weassumethatoneismuchgreaterthantheotherandapplythedominant-
pole approximation (Chapter 6). The dominant pole is given by the inverse of the coefﬁcient of s in the
denominator of (9.39):
|ωp1| =
1
[rO1 + (A0 + 1)gm2rO2rO1 + rO2]CL + 1
ω0
(9.41)
≈
1
A0gm2rO2rO1CL
(9.42)
The ﬁrst time constant in the denominator of (9.41) corresponds to the output pole if A1 were ideal, i.e.,
if ω0 = ∞. The nondominant pole is equal to the ratio of the coefﬁcients of s and s2:
|ωp2| =
[rO1 + (A0 + 1)gm2rO2rO1 + rO2]CL + 1
ω0
(rO1 + rO2)CL
ω0
[1 + gm2(rO1||rO2)]
(9.43)
≈(A0 + 1)ω0 +
1
gm2rO2rO1CL
(9.44)
if gm2(rO1||rO2) ≫1 (not necessarily a good approximation, but just to see trends). We observe that
the second pole is somewhat above the unity-gain bandwidth of the original cascode, (gm2rO2rO1CL)−1.
Note that the term 1/(gm2rO2rO1CL) also represents the output pole in the absence of A1.

Sec. 9.6
Output Swing Calculations
373
▲
Example9.15
Is the dominant-pole approximation valid here?
Solution
Assuming (A0 + 1)gm2rO2rO1 ≫rO1, rO2, we ﬁnd the ratio of (9.44) and (9.41):
ωp2
ωp1
≈

(A0 + 1)ω0 +
1
gm2rO2rO1CL

(A0 + 1)gm2rO2rO1CL + 1
ω0

(9.45)
≈(A0 + 1)2gm2rO2rO1CLω0 + 2(A0 + 1) +
1
gm2rO2rO1CLω0
(9.46)
The second term is typically much greater than unity, making the approximation valid.
▲
Figure 9.38 plots the approximate frequency response of the cascode structure before and after gain
boosting. The key point here is that the auxiliary ampliﬁer contributes a second pole located above the
original −3-dB bandwidth by an amount equal to A0ω0.
1
ω
(log scale)
Vout
Vin
(log scale)
0 dB
A0gm1rO1gm2rO2
gm1rO1gm2rO2
A0gm1rO1gm2rO2CL
gm2rO2rO1CL
1
gm2rO2rO1CL
1
 + A0ω0
Regulated
Cascode
Original
Cascode
Figure 9.38
Frequency response of gain-boosted stage.
9.5
Comparison
Our study of op amps in this chapter has introduced four principal topologies: telescopic cascode, folded
cascode, two-stage op amp, and gain boosting. It is instructive to compare various performance aspects
of these circuits to gain a better view of their applicability. Table 9.1 comparatively presents important
attributes of each op amp topology. We study the speed differences in Chapter 10.
9.6
Output Swing Calculations
In today’s low-voltage op amp designs, the output voltage swing proves the most important factor. We
have seen in previous sections how to assume a certain required output swing and accordingly allocate
overdrive voltages to the transistors. But how do we verify that the ﬁnal design indeed accommodates the

374
Chap. 9
Operational Ampliﬁers
Table 9.1
Comparison of performance of various op amp topologies.
Telescopic
Folded−Cascode
Two−Stage
Gain−Boosted
Gain
Output
Swing
Speed
Power
Dissipation
Noise
Medium
Medium
Medium
Medium
High
High
Highest
Medium
Highest
High
Low
Medium
Medium
Low
Medium
Medium
Low
Medium
Low
High
speciﬁed swing? To answer this question, we must ﬁrst ask, what exactly happens if the circuit cannot
sustain the swing? Since the border between the saturation and triode regions begins to diminish in
nanometer devices, we cannot readily decide on the operation region of the transistors at the extremes of
the output swing. A more rigorous approach is therefore necessary.
If the output voltage excursion pushes a transistor into the triode region, then the voltage gain drops. We
can thus use simulations to examine the gain as the output swing grows. Illustrated in Fig. 9.39(a), the idea
is to apply to the input a growing sinusoid (or different sinusoidal amplitudes in different simulations),
monitor the resulting output, and calculate |Vout/Vin| as Vin and Vout grow. The gain begins to drop as
the output swing reaches its maximum “allowable” voltage, V1. We may even choose V1 to allow a small
drop in the gain, say, 10% (about 1 dB). Beyond V1, the gain falls further, causing signiﬁcant nonlinearity.
Vin
Vout
Vin
V1
R2
R1
Vout
(a)
(b)
Figure 9.39
(a) Simulation of gain versus input amplitude, and (b) feedback ampliﬁer.
The reader may wonder how much gain reduction is acceptable. In some applications, the reduction
of the open-loop gain, and hence the gain error of the closed-loop system, are critical (Chapter 13).
In other applications, we are concerned with the output distortion of the closed-loop circuit. In such a
case, we place the op amp in the closed-loop environment of interest, e.g., the inverting conﬁguration
of Fig. 9.39(b), apply a sinusoid to the input, and measure the distortion (harmonics) at the output
in simulations. The maximum output amplitude that yields an acceptable distortion is considered the
maximum output swing.
9.7
Common-Mode Feedback
9.7.1 Basic Concepts
In this and previous chapters, we have described many advantages of fully differential circuits over their
single-ended counterparts. In addition to greater output swings, differential op amps avoid mirror poles,
thus achieving a higher closed-loop speed. However, high-gain differential circuits require “common-
mode feedback” (CMFB).
To understand the need for CMFB, let us begin with a simple realization of a differential ampliﬁer
[Fig. 9.40(a)]. In some applications, we short the inputs and outputs for part of the operation [Fig. 9.40(b)],

Sec. 9.7
Common-Mode Feedback
375
M1
M2
RD
VDD
RD
Vout
ISS
Vin
M1
M2
RD
VDD
RD
Vout
ISS
(a)
(b)
Figure 9.40
(a) Simple differential pair; (b) circuit with inputs shorted to outputs.
providing differential negative feedback. The input and output common-mode levels in this case are fairly
well deﬁned, equal to VDD −ISS RD/2.
Now suppose the load resistors are replaced by PMOS current sources so as to increase the differential
voltage gain [Fig. 9.41(a)]. What is the common-mode level at nodes X and Y? Since each of the input
transistors carries a current of ISS/2, the CM level depends on how close ID3 and ID4 are to this value. In
practice, as exempliﬁed by Fig. 9.41(b), mismatches in the PMOS and NMOS current mirrors deﬁning
ISS and ID3,4 create a ﬁnite error between ID3,4 and ISS/2. Suppose, for example, that the drain currents
of M3 and M4 in the saturation region are slightly greater than ISS/2. As a result, to satisfy Kirchhoff’s
current law at nodes X and Y, both M3 and M4 must enter the triode region so that their drain currents
fall to ISS/2. Conversely, if ID3,4 < ISS/2, then both VX and VY must drop so that M5 enters the triode
region, thereby producing only 2ID3,4.
VDD
M1
M2
ISS
Vb
Vout
VDD
M1
M2
Vout
X
X
Y
Y
M4
M3
M4
M3
M5
Mb1
2
W
L
W
L
W
L
W
L
W
L
Mb2
(a)
(b)
ISS
Figure 9.41
(a) High-gain differential pair with inputs shorted to outputs, and (b) effect of current mismatches.
The above difﬁculties fundamentally arise because in high-gain ampliﬁers, we wish a p-type current
source [e.g., M3 and M4 in Fig. 9.41(b)] to balance an n-type current source (e.g., M5). As illustrated
in Fig. 9.42, the difference between IP and IN must ﬂow through the intrinsic output impedance of the

376
Chap. 9
Operational Ampliﬁers
IP
IN
RP
RN
IP − IN
VDD
Figure 9.42
Simpliﬁed model of high-
gain ampliﬁer.
ampliﬁer, creating an output voltage change of (IP −IN)(RP∥RN). Since the current error depends on
mismatches and RP∥RN is quite high, the voltage error may be large, thus driving the p-type or n-type
current source into the triode region. As a general rule, if the output CM level cannot be determined by
“visual inspection” and requires calculations based on device properties, then it is poorly deﬁned. This
is the case in Fig. 9.41 but not in Fig. 9.40. We emphasize that differential feedback cannot deﬁne the
CM level.
Students often make two mistakes here. First, they assume that differential feedback corrects the output
common-mode level. As explained for the simple circuit of Fig. 9.41(a), differential feedback from X
and Y to the inputs cannot prohibit the output CM level from taking off toward VDD or ground. Second,
they ﬁnely adjust Vb in simulations so as to bring VX and VY to around VDD/2 concluding that the circuit
does not need CM feedback. We have recognized, however, that random mismatches between the top
and bottom current sources cause the CM level to fall or rise considerably. Such mismatches are always
present in actual circuits and cause the op amp to fail if no CMFB is used.
▲
Example9.16
Consider the telescopic op amp designed in Example 9.5 and repeated in Fig. 9.43 with bias current mirrors. Suppose
M9 suffers from a 1% current mismatch with respect to M10, producing ISS = 2.97 mA rather than 3 mA. Assuming
perfect matching for other transistors, explain what happens in the circuit.
VDD
M5
M1
M2
Vin
M8
Vb1
M3
M4
Vout
M7
M6
Vb2
M11
M9
X
Y
R1
300 μA
M10
ISS = 2.97 mA
Figure 9.43
Solution
From Example 9.5, the single-ended output impedance of the circuit equals 266 k. Since the difference between
the drain currents of M3 and M5 (and M4 and M6) is 30 μA/2 = 15 μA, the output voltage error would be
266 k × 15 μA= 3.99 V. Since this large error cannot be produced, VX and VY must rise so much that M5–M6 and
M7–M8 enter the triode region, yielding ID7,8 = 1.485 mA. We should also mention that another important source

Sec. 9.7
Common-Mode Feedback
377
of CM error in the simple biasing scheme of Fig. 9.43 is the deterministic error between ID7,8 and ID11 (and also
between ID9 and ID10) due to their different drain-source voltages. This error can nonetheless be reduced by means
of the current mirror techniques of Chapter 5.
▲
The foregoing study implies that in high-gain ampliﬁers, the output CM level is sensitive to device
properties and mismatches and it cannot be stabilized by means of differential feedback. Thus, a common-
mode feedback network must be added to sense the CM level of the two outputs and adjust one of the
bias currents in the ampliﬁer. Following our view of feedback systems in Chapter 8, we divide the task
of CMFB into three operations: sensing the output CM level, comparison with a reference, and returning
the error to the ampliﬁer’s bias network. Figure 9.44 conceptually illustrates the idea.
M1
M2
VDD
CM Level
Sense
Circuit
VREF
Vout1
Vout2
Figure 9.44
Conceptual topology for
common-mode feedback.
9.7.2 CM Sensing Techniques
In order to sense the output CM level, we recall that Vout,C M = (Vout1+Vout2)/2, where Vout1 and Vout2 are
the single-ended outputs. It therefore seems plausible to employ a resistive divider as shown in Fig. 9.45,
generating Vout,C M = (R1Vout2 + R2Vout1)/(R1 + R2), which reduces to (Vout1 + Vout2)/2 if R1 = R2.
The difﬁculty, however, is that R1 and R2 must be much greater than the output impedance of the op
amp so as to avoid lowering the open-loop gain. For example, in the design of Fig. 9.43, the output
impedance equals 266 k, necessitating a value of several megaohms for R1 and R2. As explained in
Chapter 18, such large resistors occupy a very large area and, more important, suffer from substantial
parasitic capacitance to the substrate.
R1
R2
Vout2
Vout1
Vout,CM
Figure 9.45
Common-mode feedback
with resistive sensing.
To eliminate the resistive loading, we can interpose source followers between each output and its
corresponding resistor. Illustrated in Fig. 9.46, this technique produces a CM level that is in fact lower
than the output CM level by VGS7,8, but this shift can be taken into account in the comparison operation.
Note that R1 and R2 or I1 and I2 must be large enough to ensure that M7 or M8 is not “starved” when

378
Chap. 9
Operational Ampliﬁers
R1
R2
Vout,CM
VDD
M8
M7
I1
I2
M3
M4
M5
M6
Vout1
Vout2
Figure 9.46
Common-mode feedback using source followers.
a large differential swing appears at the output. As conceptually depicted in Fig. 9.47, if, say, Vout2 is
quite higher than Vout1, then I1 must sink both IX ≈(Vout2 −Vout1)/(R1 + R2) and ID7. Consequently, if
R1 + R2 or I1 is not sufﬁciently large, ID7 drops to zero and Vout,C M no longer represents the true output
CM level.
M8
M7
VDD
R1
R2
I1
I2
IX
Vout1
Vout2
Vout,CM
Figure
9.47
Current
starvation
of
source followers for large swings.
The sensing method of Fig. 9.46 nevertheless suffers from an important drawback: it limits the differ-
ential output swings (even if R1,2 and I1,2 are large enough). To understand why, let us determine the min-
imum allowable level of Vout1 (and Vout2), noting that without CMFB, it would be equal to VO D3 + VO D5.
With the source followers in place, Vout1,min = VGS7 + VI1, where VI1 denotes the minimum voltage
required across I1. This is roughly equal to two overdrive voltages plus one threshold voltage. Thus, the
swing at each output is reduced by approximately VT H, a signiﬁcant value in low-voltage design.
Looking at Fig. 9.45, the reader may wonder if the output CM level can be sensed by means of
capacitors, rather than resistors, so as to avoid degrading the low-frequency open-loop gain of the op
amp. This is indeed possible in some cases and will be studied in Chapter 13.
Another type of CM sensing is depicted in Fig. 9.48(a). Here, identical transistors M7 and M8 operate
in the deep triode region, introducing a total resistance between P and ground equal to
Rtot = Ron7∥Ron8
(9.47)
=
1
μnCox
W
L (Vout1 −VT H)

1
μnCox
W
L (Vout2 −VT H)
(9.48)
=
1
μnCox
W
L (Vout2 + Vout1 −2VT H)
(9.49)

Sec. 9.7
Common-Mode Feedback
379
Vout2
Vout1
P
M7
M8
P
M7
M8
Vout1
VTH
Vout2
(a)
(b)
Figure 9.48
(a) Common-mode sensing using MOSFETs operating in the deep triode region, and (b) output
levels placing M7 at the edge of saturation.
where W/L denotes the aspect ratio of M7 and M8. Equation (9.49) indicates that Rtot is a function
of Vout2 + Vout1 but independent of Vout2 −Vout1. From Fig. 9.48(a), we observe that if the outputs rise
together, then Rtot drops, whereas if they change differentially, one Ron increases and the other decreases.
This resistance can thus be utilized as a measure of the output CM level.
In the circuit of Fig. 9.48(a), the use of M7 and M8 limits the output voltage swings. Here, it may seem
that Vout,min = VT H7,8, which is relatively close to two overdrive voltages, but the difﬁculty arises from
the assumption above that both M7 and M8 operate in the deep triode region. In fact, if, say, Vout1 drops
from the equilibrium CM level to about one threshold voltage above ground [Fig. 9.48(b)] and Vout2 rises
by the same amount, then M7 enters the saturation region, thus exhibiting a variation in its on-resistance
that is not counterbalanced by that of M8.
It is important to bear in mind that CM sensing must produce a quantity independent of the differential
signals. The following example illustrates this point.
▲
Example9.17
A student simulates the step response of a closed-loop op amp circuit [e.g., that in Fig. 9.48(a)] and observes the
output waveforms shown in Fig. 9.49. Explain why Vout1 and Vout2 do not change symmetrically.
t
Vout1
Vout2
t1
t2
VCM
Figure 9.49
Solution
As evident from the waveforms, the output CM level changes from t1 to t2, indicating that the CM sensing mechanism
is nonlinear and interprets the CM levels at t1 and t2 differently. For example, if M7 or M8 in Fig. 9.48 does not
remain in the deep triode region at t2, then Eq. (9.49) no longer holds and VC M becomes a function of the differential
signals.
▲

380
Chap. 9
Operational Ampliﬁers
Another CM sensing method is illustrated in Fig. 9.50. Here, the differential pairs compare the inputs
with VREF, generating a current, IC M, in proportion to the input CM level. To prove this point, we write
the small-signal drain currents of M2 and M4 as (gm/2)Vout1 and (gm/2)Vout2, respectively, concluding
that IC M ∝Vout1 + Vout2. This current can be copied to current sources within the op amp with negative
feedback so as to keep Vout,C M approximately equal to VREF.
M1
M2
M4
M3
Vb
Vout1
Vout2
ICM
To Current Sources
in Op Amp
Figure 9.50
CM sensing circuit with high nonlinearity.
The foregoing topology faces serious issues. As Vout1 and Vout2 experience large swings, Iout no longer
remains proportional to Vout1 +Vout2 due to the nonlinearity of the differential pairs. In fact, if ID1 and ID2
are expressed as f (Vout1 −VREF) and f (Vout2 −VREF), respectively, we observe that ID1 + ID2 depends
on the individual values of Vout1 and Vout2 unless f () is a linear function. As a result, the reconstructed
CM level does not remain constant in the presence of large differential output swings.
9.7.3 CM Feedback Techniques
We now study techniques of comparing the measured CM level with a reference and returning the error to
the op amp’s bias network. In the circuit of Fig. 9.51, we employ a simple ampliﬁer to detect the difference
between Vout,C M and a reference voltage, VREF, applying the result to the NMOS current sources with
negative feedback. If both Vout1 and Vout2 rise, so does VE, thereby increasing the drain currents of M3–M4
and lowering the output CM level. In other words, if the loop gain is large, the feedback network forces the
CM level of Vout1 and Vout2 to approach VREF. Note that the feedback can be applied to the PMOS current
sources as well. Also, the feedback may control only a fraction of the current to allow optimization of
R1
R2
Vout2
Vout1
Vout,CM
M1
M2
ISS
Vin
VREF
VDD
M3
M4
VE
Figure 9.51
Sensing and controlling output CM level.

Sec. 9.7
Common-Mode Feedback
381
the settling behavior. For example, each of M3 and M4 can be decomposed into two parallel devices, one
biased at a constant current and the other driven by the error ampliﬁer.
In a folded-cascode op amp, the CM feedback may control the tail current of the input differential pair.
Illustrated in Fig. 9.52, this method increases the tail current if Vout1 and Vout2 rise, lowering the drain
currents of M5–M6 and restoring the output CM level.
R1
R2
Vout2
Vout1
Vout,CM
M1
M2
Vin
VDD
VREF
M5
M6
Figure 9.52
Alternative method of controlling output CM level.
How do we perform comparison and feedback with the sensing scheme of Fig. 9.48? Here, the output
CM voltage is directly converted to a resistance or a current, prohibiting comparison with a reference
voltage. A simple feedback topology utilizing this technique is depicted in Fig. 9.53, where Ron7∥Ron8
adjusts the bias current of M5 and M6. The output CM level sets Ron7∥Ron8 such that ID5 and ID6 exactly
balance ID9 and ID10, respectively. For example, if Vout1 and Vout2 rise, Ron7||Ron8 falls and the drain
currents of M5 and M6 increase, pulling Vout1 and Vout2 down. Assuming that ID9 = ID10 = ID, we must
have Vb −VGS5 = 2ID(Ron7∥Ron8), and hence Ron7∥Ron8 = (Vb −VGS5)/(2ID). From (9.49),
1
μnCox
W
L

7,8
(Vout2 + Vout1 −2VT H)
= Vb −VGS5
2ID
(9.50)
Vout2
P
M7
M8
Vout1
M5
M6
VDD
M9
M10
Vb
Figure 9.53
CMFB using triode
devices.

382
Chap. 9
Operational Ampliﬁers
that is,
Vout1 + Vout2 =
2ID
μnCox
W
L

7,8
1
Vb −VGS5
+ 2VT H
(9.51)
The CM level can thus be obtained by noting that VGS5 = √2ID/[μnCox(W/L)5] + VT H5.
The CMFB network of Fig. 9.53 suffers from several drawbacks. First, the value of the output CM
level is a function of device parameters. Second, the voltage drop across Ron7∥Ron8 limits the output
voltage swings. Third, to minimize this drop, M7 and M8 are usually quite wide devices, introducing
substantial capacitance at the output. The second issue can be alleviated by applying the feedback to the
tail current of the input differential pair (Fig. 9.54), but the other two remain.
Vout2
M7
M8
Vout1
M1
M2
Vin
VDD
Vb
M9
M3
M4
M5
M6
M12
M13
M10
M11
Figure 9.54
Alternative method of controlling output CM level.
How is Vb generated in Fig. 9.54? We note that Vout,C M is somewhat sensitive to the value of Vb: if
Vb is higher than expected, the tail current of M1 and M2 increases and the output CM level falls. Since
the feedback through M7 and M8 attempts to correct this error, the overall change in Vout,C M depends on
the loop gain in the CMFB network. This is studied in the following example.
▲
Example9.18
For the circuit of Fig. 9.54, determine the sensitivity of Vout,C M to Vb, i.e., dVout,C M/dVb.
Solution
Setting Vin to zero and opening the loop at the gates of M7 and M8, we simplify the circuit as shown in Fig. 9.55.
Note that gm7 and gm8 must be calculated in the triode region: gm7 = gm8 = μnCox(W/L)7,8VDS7,8, where VDS7,8
denotes the bias value of the drain-source voltage of M7 and M8. Since M7 and M8 operate in the deep triode region,
VDS7,8 is typically less than 100 mV.
In a well-designed circuit, the loop gain must be relatively high. We therefore surmise that the closed-loop gain
is approximately equal to 1/β, where β represents the feedback factor. We write from Chapter 8:
β = V2
V1
|I2=0
(9.52)
= −(gm7 + gm8)(Ron7∥Ron8)
(9.53)

Sec. 9.7
Common-Mode Feedback
383
Feedback Network
M1 + M2
M5 + M6
M9
Vb
Ron7 Ron8
rO3 rO4
Vout,CM
gm12 rO12 rO10
2
IF
IF = (gm7 + gm8)  Vout,CM 
Vout,CM
Figure 9.55
= −2μnCox

W
L

7,8
VDS7,8 ·
1
2μnCox(W/L)7,8(VGS7,8 −VT H7,8)
(9.54)
= −
VDS7,8
VGS7,8 −VT H7,8
(9.55)
where VGS7,8 −VT H7,8 denotes the overdrive voltage of M7 and M8. Thus,
				
dVout,C M
dVb
				
closed
≈VGS7,8 −VT H7,8
VDS7,8
(9.56)
This is an important result. Since VGS7,8 (i.e., the output CM level) is typically in the vicinity of VDD/2, the above
equation suggests that VDS7,8 must be maximized to minimize this sensitivity, but at the cost of the loop gain.
▲
We now introduce a modiﬁcation to the circuit of Fig. 9.54 that both makes the output level relatively
independent of device parameters and lowers the sensitivity to the value of Vb. Illustrated in Fig. 9.56(a),
the idea is to deﬁne Vb by a current mirror arrangement such that ID9 “tracks” I1 and VREF. For simplicity,
suppose(W/L)15 = (W/L)9 and(W/L)16 = (W/L)7+(W/L)8.Thus, ID9 = I1 onlyif Vout,C M = VREF.
In other words, as with Fig. 9.52, the circuit produces an output CM level equal to a reference but it requires
no resistors in sensing Vout,C M. The overall design can be simpliﬁed as shown in Fig. 9.56(b).
In practice, since VDS15 ̸= VDS9, channel-length modulation results in a ﬁnite error. Figure 9.57 depicts
a modiﬁcation that suppresses this error. Here, transistors M17 and M18 reproduce at the drain of M15 a
voltage equal to the source voltage of M1 and M2, ensuring that VDS15 = VDS9.
To arrive at another CM feedback topology, let us consider the simple differential pair shown in
Fig. 9.58(a). Here, the output CM level, VDD −|VGS3,4|, is relatively well deﬁned, but the voltage gain is
quite low. To increase the differential gain, the PMOS devices must operate as current sources for differ-
ential signals. We therefore modify the circuit as depicted in Fig. 9.58(b), where for differential changes
at Vout1 and Vout2, node P is a virtual ground and the gain can be expressed as gm1,2(rO1,2∥rO3,4∥RF). We
preferably choose RF ≫rO1,2||rO3,4. For common-mode levels, on the other hand, M3 and M4 operate
as diode-connected devices. The circuit proves useful in low-gain applications.

384
Chap. 9
Operational Ampliﬁers
Vout2
M7
M8
Vout1
M1 M2
Vin
M1 M2
Vin
VDD
Vb
M6
M5
Vout2
Vout1
M6
M5
M10
M9
M11
M12
M13
M10
M11
M12
M13
M4
M3
VDD
M4
M3
VDD
M15
M16
Vb
M9
M15
M16
VREF
M7
M8
VREF
(a)
(b)
I1
Figure 9.56
Modiﬁcation of CMFB for more accurate deﬁnition of output CM level.
Vout2
M7
M8
Vout1
M1
M2
Vin
VDD
M6
M5
M4
M3
M12
M13
M10
M9
M11
VREF
M15
M16
Vb
M17
M18
Figure 9.57
Modiﬁcation to suppress error due to channel-length modulation.

Sec. 9.7
Common-Mode Feedback
385
VDD
M4
M1
M2
ISS
I1
M3
VDD
M4
M3
Vin
M1
M2
ISS
Vin
Vout
Vout
RF
RF
P
VDD
M4
M3
RF
RF
P
(c)
(a)
(b)
Figure 9.58
(a) Differential pair using diode-connected loads, (b) resistive CMFB, and (c) modiﬁcation to allow
low-voltage operation.
▲
Example9.19
Determine the maximum allowable output swings in Fig. 9.58(b).
Solution
Each output can fall to two overdrive voltages above ground if Vin,C M is chosen to place ISS at the edge of
the triode region. The highest level allowed at the output is equal to the output CM level plus |VT H3,4|, i.e.,
VDD −|VGS3,4| + |VT H3,4| = VDD −|VGS3,4 −VT H3,4|.
▲
In some applications, we wish to operate the circuit of Fig. 9.58(b) with a low supply voltage, but for
small signals. This stage dictates a minimum VDD of |VGS3,4| plus two overdrive voltages. We modify the
circuit by drawing a small current from the two resistors and PMOS devices as illustrated in Fig. 9.58(c).
Here, VP is still equal to VDD −|VGS3,4|, but the drain voltages are higher than VP by an amount equal
to I1RF/2. For example, if I1RF/2 = |VT H3,4|, then the PMOS devices operate at the edge of saturation,
allowing a minimum VDD of three overdrive voltages.
▲
Example9.20
Facing voltage headroom limitations, a student constructs the circuit shown in Fig. 9.59(a), where the tail current
source is replaced by two triode devices that sense the output CM level, Vout,C M. Determine the small-signal gain
from the input CM level to the output CM level.
M4
M1
M2
M3
VDD
M5
M6
M5 + M6
M5 + M6
M1 + M2
M1 + M2
M3 + M4
VDD
Vin,CM
Vout,CM
P
Vin,CM
Vout,CM
rO3,4
2
Rtail
P
gm,tailVout,CM
(c)
(a)
(b)
P
Figure 9.59

386
Chap. 9
Operational Ampliﬁers
Solution
If the circuit is symmetric, the output nodes can be shorted, leading to the topology in Fig. 9.59(b).6 To model the com-
posite transistor M5 + M6, we deﬁne a transconductance gm,tail = gm5 + gm6 = 2μnCox(W/L)5,6VP, where VP is
the dc voltage at node P. We also approximate their total channel resistance by Rtail = [2μnCox(W/L)5,6(Vout,C M −
VT H5,6)]−1. The circuit therefore reduces to that shown in Fig. 9.59(c).
Assuming for simplicity that λ = γ = 0 for M1 and M2, we express the small-signal current drawn by
M1 + M2 as −Vout,C M/(rO3,4/2). This current translates to a gate-source voltage of −Vout/(2gm1,2rO3,4/2) =
−Vout/(gm1,2rO3,4), yielding a voltage of Vin,C M + Vout/(gm1,2rO3,4) at node P and hence a current of [Vin,C M +
Vout/(gm1,2rO3,4)]/Rtail through Rtail. Since this current and gm,tailVout,C M must add up to −Vout,C M/(rO3,4/2),
we obtain
Vout,C M
Vin,C M
= −
1
2Rtail
rO3,4
+ gm,tail Rtail + (gm1,2rO3,4)−1
(9.57)
It is important to note that all of the three terms in the denominator are less than one (why?), revealing that
Vout,C M/Vin,C M is roughly around unity. That is, an error in the input CM level reaches the output without signiﬁcant
attenuation. This observation suggests a poor CMRR; the reader is encouraged to assume a gm mismatch between
M1 and M2 and compute the CMRR as outlined in Chapter 4.
▲
9.7.4 CMFB in Two-Stage Op Amps
Offering nearly rail-to-rail output swings, two-stage op amps ﬁnd wider application than other topologies
in today’s designs. However, such op amps require more complex common-mode feedback. To understand
the issues, we consider three different CMFB methods in the context of the simple circuit shown in
Fig. 9.60(a).
First, suppose the CM level of Vout1 and Vout2 is sensed and the result is used to control only Vb2; i.e.,
the second stage incorporates CMFB, but not the ﬁrst stage [Fig. 9.60(b)]. In this case, no mechanism
exists that controls the CM level at X and Y. For example, if ISS happens to be less than the sum
of the currents that M3 and M4 wish to draw, then VX and VY rise, driving these transistors into the
triode region so that ID3 + ID4 eventually becomes equal to ISS. This effect also reduces |VGS5,6|,
establishingin M5–M8 acurrentthatmaybewellbelowthenominalvalue.ThisCMFBmethodistherefore
not desired.
Second, we still sense the CM level Vout1 and Vout2 but return the result to the ﬁrst stage, e.g., to ISS
[Fig. 9.60(c)]. Suppose, for example, that Vout1 and Vout2 begin too high. Then, the error ampliﬁer, Ae,
reduces ISS, allowing VX and VY to rise, |ID5| and |ID6| to fall, and Vout1 and Vout2 to go down. It is
interesting to note that here M5 and M6 in fact sense the CM level at X and Y, helping the global loop
control both stages’ CM level. (If M3 and M4 had a tail current, as in a regular differential pair, this
property would vanish and the CMFB loop would fail.)
While used in some designs, the second technique suffers from a critical drawback. Let us draw the
equivalent circuit for common-mode levels (Fig. 9.61). How many poles does the CM feedback loop
contain? We count one pole at X or Y, one at the main output, and at least one associated with the
error ampliﬁer. Moreover, since RC M is so large as not to load the second stage, it forms with the input
capacitance of Ae a pole that may not be negligible. Thus, even if the pole at the source of M1 and M2
is discounted, the CMFB loop still contains three or four poles. As explained in Chapter 10, this many
poles make it difﬁcult for the loop be stable.
Inordertoavoidstabilityissues,wecanemploytwoseparateCMFBloopsfortheﬁrstandsecondstages
of the op amp. Figure 9.62 illustrates a simple example [7], where, in a manner similar to Fig. 9.58(b),
6We use the notation M j + M j+1 to denote the parallel combination of M j and M j+1.

Sec. 9.7
Common-Mode Feedback
387
Vin
VDD
M4
M1
M2
ISS
M3
Vb1
M5
M6
M7
M8
Vb2
Vout1
Vout2
M7
M8
Vout1
Vout2
Y
X
CM Sense
VREF
Ae
VDD
M4
M1
M2
ISS
M3
Vb1
Vin
M5
M6
M7
M8
Vb2
Vout1
Vout2
Y
X
CM Sense
Ae
VREF
(c)
(a)
(b)
Figure 9.60
(a) Two-stage op amp, (b) CMFB around second stage, and (c) CMFB from second stage to ﬁrst
stage.
M1 + M2
M7 + M8
M3 + M4
M5 + M6
X, Y
VDD
RCM
Vout1, Vout2
Ae
VREF
Error Amp.
CM
Sense 
Figure 9.61
Equivalent CMFB loop to determine the number of poles.
R1 and R2 provide CMFB for the ﬁrst stage and R3 and R4 for the second. Interestingly, all of the
drain currents in this topology are copied from ISS. Assuming a symmetric circuit, we recognize that (1)
resistors R1 and R2 adjust VGS3,4 until |ID3| = |ID4| = ISS/2; (2) since VGS3,4 = VGS5,6, M5 and M6
copy their currents from M3 and M4 as in a current mirror; and (3) resistors R3 and R4 adjust VGS7,8 until
ID7 = ID8 = |ID5| = |ID6|. The differential voltage gain is equal to gm1(rO1||rO3||R1)gm5(rO5||rO7||R3).
Another CMFB technique for two-stage op amps is described in Chapter 11.

388
Chap. 9
Operational Ampliﬁers
VDD
M4
M1
M2
ISS
M3
Vin
M5
M6
M7
M8
Vout1
Vout2
Y
X
R1
R2
R3
R4
Q
Figure 9.62
Simple CMFB loops
around each stage.
▲
Example9.21
A student delighted by the simplicity of the op amp in Fig. 9.62 designs the circuit for a given power budget, but
realizes that the output CM level is inevitably well below VDD/2, and hence the output swings are limited. Explain
why and devise a solution.
Solution
The output CM level is equal to VG7,8 (recall that R3 and R4 carry no current in the absence of signals). Since M7
and M8 are chosen wide enough for a small overdrive voltage, VGS7,8 is only slightly greater than one threshold
voltage and far from VDD/2.
This issue can be resolved by drawing a small current from node Q (Fig. 9.63). Now, R3 and R4 sustain a drop
of R3IQ/2 (= R4IQ/2), producing an upward shift of the same amount in the output CM level [7]. Thus, IQ can be
chosen to create an output CM level around VDD/2.
M7
M8
Vout1
Vout2
R3
R4
Q
IQ
Figure 9.63
▲
If the ﬁrst stage incorporates a telescopic cascode to achieve a high gain, then the CMFB loops can
be realized as shown in Fig. 9.64. While not precise, the CM sensing of X and Y avoids loading the high
impedances at these nodes, thereby maintaining a high voltage gain.
9.8
Input Range Limitations
The op amp circuits studied thus far have evolved to achieve large differential output swings. While the
differential input swings are usually much smaller (by a factor equal to the open-loop gain), the input
common-mode level may need to vary over a wide range in some applications. For example, consider the
simple unity-gain buffer shown in Fig. 9.65, where the input swing is nearly equal to the output swing.
Interestingly, in this case the voltage swings are limited by the input differential pair rather than the output

Sec. 9.8
Input Range Limitations
389
Vout1
Vout2
Y
X
VDD
Figure 9.64
CMFB loops around cascode and output stages.
VDD
M3
M1
M2
Vin
M10
M6
Vout
M9
M4
X
Y
M7
M8
M5
ISS
Vin
Vout
Figure 9.65
Unity-gain buffer.
cascode branch. Speciﬁcally, Vin,min ≈Vout,min = VGS1,2 + VI SS, approximately one threshold voltage
higher than the allowable minimum provided by M5–M8.
What happens if Vin falls below the minimum given above? The MOS transistor operating as ISS enters
the triode region, decreasing the bias current of the differential pair and hence lowering the transconduc-
tance. We then postulate that the limitation is overcome if the transconductance can somehow be restored.
A simple approach to extending the input CM range is to incorporate both NMOS and PMOS dif-
ferential pairs such that when one is “dead,” the other is “alive.” Illustrated in Fig. 9.66, the idea is to
combine two folded-cascode op amps with NMOS and PMOS input differential pairs. Here, as the input
CM level approaches the ground potential, the NMOS pair’s transconductance drops, eventually falling
to zero. Nonetheless, the PMOS pair remains active, allowing normal operation. Conversely, if the input
CM level approaches VDD, M1P and M2P begin to turn off, but M1 and M2 function properly.
An important concern in the circuit of Fig. 9.66 is the variation of the overall transconductance of
the two pairs as the input CM level changes. Considering the operation of each pair, we anticipate the
behavior depicted in Fig. 9.67. Thus, many properties of the circuit, including gain, speed, and noise,
vary. More sophisticated techniques of minimizing this variation are described in [8].

390
Chap. 9
Operational Ampliﬁers
VDD
M3
M1
M2
M10
M6
M9
M4
X
Y
M7
M8
M5
ISS1
ISS2
M1p
M2p
Vin1
Vin2
Vout
Figure 9.66
Extension of input CM range.
Vin,CM
Gm,tot
gmp
gmn
0
VDD
Figure 9.67
Variation of equivalent
transconductance with the input CM
level.
9.9
Slew Rate
Op amps used in feedback circuits exhibit a large-signal behavior called “slewing.” We ﬁrst describe
an interesting property of linear systems that vanishes during slewing. Consider the simple RC network
shown in Fig. 9.68, where the input is an ideal voltage step of height V0. Since Vout = V0[1−exp(−t/τ)],
where τ = RC, we have
dVout
dt
= V0
τ exp −t
τ
(9.58)
That is, the slope of the step response is proportional to the ﬁnal value of the output; if we apply a larger
input step, the output rises more rapidly. This is a fundamental property of linear systems: if the input
amplitude is, say, doubled while other parameters remain constant, the output signal level must double
at every point, leading to a twofold increase in the slope.
t
R1
C1
Vout
Vin
Vin
Vout
t
Vin
Vout
Figure 9.68
Response of a linear circuit to an input step.

Sec. 9.9
Slew Rate
391
Rout
R1
R2
A
Vin
Vout
CL
Linear Op Amp
Figure 9.69
Response of linear op amp
to step response.
The foregoing observation applies to linear feedback systems as well. Shown in Fig. 9.69 is an example,
where the op amp is assumed linear. Here, we can write

Vin −Vout
R2
R1 + R2

A −Vout

1
Rout
=
Vout
R1 + R2
+ VoutCLs
(9.59)
Assuming R1 + R2 ≫Rout, we have
Vout
Vin
(s) ≈
A

1 + A
R2
R1 + R2
 
1 +
RoutCL
1 + AR2/(R1 + R2)s

(9.60)
As expected, both the low-frequency gain and the time constant are divided by 1 + AR2/(R1 + R2). The
step response is therefore given by
Vout ≈V0
A
1 + A
R2
R1 + R2
⎡
⎢⎢⎣1 −exp
−t
CL Rout
1 + AR2/(R1 + R2)
⎤
⎥⎥⎦u(t)
(9.61)
indicating that the slope is proportional to the ﬁnal value. This type of response is called “linear settling.”
With a realistic op amp, on the other hand, the step response of the circuit begins to deviate from
(9.61) as the input amplitude increases. Illustrated in Fig. 9.70, the response to sufﬁciently small inputs
follows the exponential of Eq. (9.61), but with large input steps, the output displays a linear ramp having
a constant slope. Under this condition, we say that the op amp experiences slewing and call the slope of
the ramp the “slew rate.”
t
Vin
Vout
Rout
R1
R2
A
Vin
Vout
CL
Actual Op Amp
Exponential
Ramp
Figure 9.70
Slewing in an op amp circuit.

392
Chap. 9
Operational Ampliﬁers
To understand the origin of slewing, let us replace the op amp of Fig. 9.70 by a simple CMOS
implementation (Fig. 9.71), assuming for simplicity that R1 + R2 is very large. We ﬁrst examine the
circuit with a small input step. If Vin experiences a change of V , ID1 increases by gmV/2 and ID2
decreases by gmV/2. Since the mirror action of M3 and M4 raises |ID4| by gmV/2, the total small-
signal current provided by the op amp equals gmV . This current begins to charge CL, but as Vout rises,
so does VX, reducing the difference between VG1 and VG2 and hence the output current of the op amp.
As a result, Vout varies according to (9.61).
VDD
M1
M2
M3
M4
ISS
Vout
CL
R1
R2
X
gmΔV
gmΔV
Vin ΔV
2
gmΔV
2
gmΔV
2
Figure 9.71
Small-signal operation of a simple op amp.
Now suppose V is so large that M1 absorbs all of ISS, turning off M2. The circuit then reduces to
that shown in Fig. 9.72(a), generating a ramp output with a slope equal to ISS/CL (if the channel-length
modulation of M4 and the current drawn by R1 + R2 are neglected). Note that so long as M2 remains off,
the feedback loop is broken and the current charging CL is constant and independent of the input level.
As Vout rises, VX eventually approaches Vin, M2 turns on, and the circuit returns to linear operation.
VDD
M4
M1
M3
CL
R1
R2
X
ISS
ISS
M2
ISS
CL
ISS
CL
Vout
VDD
ISS
ISS
M3
CL
R1
R2
X
ISS
M2
0
M1
Vin
Vin
M4
Vout
(a)
(b)
Figure 9.72
Slewing during (a) low-to-high and (b) high-to-low transitions.
In Fig. 9.71, slewing occurs for falling edges at the input as well. If the input drops so much that M1
turns off, then the circuit is simpliﬁed as in Fig. 9.72(b), discharging CL by a current approximately equal
to ISS. After Vout decreases sufﬁciently, the difference between VX and Vin is small enough to allow M1
to turn on, leading to linear behavior thereafter.
The foregoing observations explain why slewing is a nonlinear phenomenon. If the input amplitude,
say, doubles, the output level does not double at all points because the ramp exhibits a slope independent
of the input.

Sec. 9.9
Slew Rate
393
Slewing is an undesirable effect in high-speed circuits that process large signals. While the small-signal
bandwidth of a circuit may suggest a fast time-domain response, the large-signal speed may be limited
by the slew rate simply because the current available to charge and discharge the dominant capacitor in
the circuit is small. Moreover, since the input-output relationship during slewing is nonlinear, the output
of a slewing ampliﬁer exhibits substantial distortion. For example, if a circuit is to amplify a sinusoid
V0 sin ω0t (in the steady state), then its slew rate must exceed V0ω0.
▲
Example9.22
Consider the feedback ampliﬁer depicted in Fig. 9.73(a), where C1 and C2 set the closed-loop gain. (The bias network
for the gate of M2 is not shown.) (a) Determine the small-signal step response of the circuit. (b) Calculate the positive
and negative slew rates.
VDD
M4
M1
M2
M1
ISS
ISS
ISS
ISS
ISS
M3
Vout
Vout
Vout
C1
C1
C2
Vin
X
C1
C2
C1
C2
X
C2
X
V1
Rout
P
Av
Vin
V1
(a)
(b)
VDD
M4
M1
M3
M2
Vout
X
(c)
(d)
M2
VDD
M4
M1
M3
Figure 9.73
Solution
(a) Modeling the op amp as in Fig. 9.73(b), where Av = gm1,2(rO2∥rO4) and Rout = rO2∥rO4, we have VX =
C1Vout/(C1 + C2), and hence
VP =

Vin −
C1
C1 + C2
Vout

Av
(9.62)
obtaining

Vin −
C1
C1 + C2
Vout

Av −Vout

1
Rout
= Vout
C1C2
C1 + C2
s
(9.63)

394
Chap. 9
Operational Ampliﬁers
It follows that
Vout
Vin
(s) =
Av
1 + Av
C1
C1 + C2
+
C1C2
C1 + C2
Routs
(9.64)
=
Av/

1 + Av
C1
C1 + C2

1 +
C1C2
C1 + C2
Routs/

1 + Av
C1
C1 + C2

(9.65)
revealing that both the low-frequency gain and the time constant of the circuit have decreased by a factor of
1 + AvC1/(C1 + C2). The response to a step of height V0 is thus given by
Vout(t) =
Av
1 + Av
C1
C1 + C2
V0

1 −exp −t
τ

u(t)
(9.66)
where
τ =
C1C2
C1 + C2
Rout/

1 + Av
C1
C1 + C2

(9.67)
(b) Suppose a large positive step is applied to the gate of M1 in Fig. 9.73(a) while the initial voltage across C1 is
zero. Then, M2 turns off and, as shown in Fig. 9.73(c), Vout rises according to Vout(t) = ISS/[C1C2/(C1 + C2)]t.
Similarly, for a large negative step at the input, Fig. 9.73(d) yields Vout = −ISS/[C1C2/(C1 + C2)]t.
▲
As another example, let us ﬁnd the slew rate of the telescopic op amp shown in Fig. 9.74(a). When a
large differential input is applied, M1 or M2 turns off, reducing the circuit to that shown in Fig. 9.74(b).
Thus, Vout1 and Vout2 appear as ramps with slopes equal to ±ISS/(2CL), and consequently Vout1 −Vout2
exhibits a slew rate equal to ISS/CL. (Of course, the circuit is usually used in closed-loop form.)
VDD
M5
ISS
ISS
Vin
M8
M3
M1
M3
M1
M2
M4
out
V
M7
M8
M7
M6
M5
M6
ISS
2
ISS
2
ISS
2
ISS
2
ISS
2
ISS
2
(a)
CL
CL
VDD
CL
CL
(b)
M2
Figure 9.74
Slewing in telescopic op amp.
It is also instructive to study the slewing behavior of a folded-cascode op amp with single-ended output
[Fig. 9.75(a)]. Figures 9.75(a) and (b) depict the equivalent circuit for positive and negative input steps,

Sec. 9.9
Slew Rate
395
X
VDD
M3
M2
M10
M6
M9
M4
Y
M7
M8
M5
ISS
Vout
CL
IP
IP
(a)
(b)
VDD
M3
M1
M10
M6
M9
M4
X
Y
M7
M8
M5
ISS
Vout
CL
IP
IP
ISS
IP – ISS
IP – ISS
ISS
ISS
IP
IP
IP – ISS
ISS
M1
M2
IP
Figure 9.75
Slewing in folded-cascode op amp.
respectively. Here, the PMOS current sources provide a current of IP, and the current that charges or
discharges CL is equal to ISS, yielding a slew rate of ISS/CL. Note that the slew rate is independent of
IP if IP ≥ISS. In practice, we choose IP ≈ISS.
In Fig. 9.75(a), if ISS > IP, then during slewing, M3 turns off and VX falls to a low level such that M1
and the tail current source enter the triode region. Thus, for the circuit to return to equilibrium after M2
turns on, VX must experience a large swing, slowing down the settling. This phenomenon is illustrated
in Fig. 9.76.
M3
M1
M9
X
ISS
IP
ISS
Figure 9.76
Long settling due to overdrive recovery after slewing.
To alleviate this issue, two “clamp” transistors can be added as shown in Fig. 9.77(a) [9]. The idea is
that the difference between ISS and IP now ﬂows through M11 or M12, requiring only enough drop in VX
or VY to turn on one of these transistors. Figure 9.77(b) illustrates a more aggressive approach, where
M11 and M12 clamp the two nodes directly to VDD. Since the equilibrium value of VX and VY is usually
higher than VDD −VT H N, M11 and M12 are off during small-signal operation.
What trade-offs are encountered in increasing the slew rate? In the examples of Figs. 9.74 and 9.75,
for a given load capacitance, ISS must be increased, and to maintain the same maximum output swing,
all of the transistors must be made proportionally wider. As a result, the power dissipation and the
input capacitance are increased. Note that if the device currents and widths scale together, gmrO of each
transistor, and hence the open-loop gain of the op amp, remain constant.
How does an op amp leave the slewing regime and enter the linear-settling regime? Since the point
at which one of the input transistors “turns on” is ambiguous, the distinction between slewing and linear
settling is somewhat arbitrary. The following example illustrates the point.

396
Chap. 9
Operational Ampliﬁers
VDD
M3
M10
M9
M4
(a)
M11
M12
M3
M10
M9
M4
M11
M12
VDD
(b)
X
Y
X
Y
Figure 9.77
Clamp circuit to limit swings at X and Y.
▲
Example9.23
Consider the circuit of Fig. 9.73(a) in the slewing regime [Fig. 9.73(c)]. As Vout rises, so does VX, eventually turning
M2 on. As ID2 increases from zero, the differential pair becomes more linear. Considering M1 and M2 to operate
linearly if the difference between their drain currents is less than αISS (e.g., α = 0.1), determine how long the circuit
takes to enter linear settling. Assume the input step has an amplitude of V0.
Solution
The circuit displays a slew rate of ISS/[C1C2/(C1 + C2)] until |Vin1 −Vin2| is sufﬁciently small. From Chapter 4,
we can write
αISS = 1
2μnCox
W
L (Vin1 −Vin2)




4ISS
μnCox
W
L
−(Vin1 −Vin2)2
(9.68)
obtaining
V 4
G −V 2
G
4ISS
μnCox
W
L
+
⎛
⎜
⎝
2αISS
μnCox
W
L
⎞
⎟
⎠
2
= 0
(9.69)
where VG = Vin1 −Vin2. Thus,
VG ≈α




ISS
μnCox
W
L
(9.70)
(Recall that √ISS/[μnCox(W/L)] is the equilibrium overdrive voltage of each transistor in the differential pair.)
Alternatively, we recognize that for a small difference, αISS, between ID1 and ID2, a small-signal approximation is
valid: αISS = gmVG. Thus, VG = αISS/gm ≈αISS/√μnCox(W/L)ISS. Note that this is a rough calculation
because as M2 turns on, the current charging the load capacitance is no longer constant.
Since VX must rise to V0 −VG for M2 to carry the required current, Vout increases by (V0 −VG)(1+C2/C1),
requiring a time given by
t = C2
ISS
⎛
⎜
⎝V0 −α




ISS
μnCox
W
L
⎞
⎟
⎠
(9.71)
▲

Sec. 9.10
High-Slew-Rate Op Amps
397
In the earlier example, the value of α that determines the onset of linear settling depends, among other
things, on the actual required linearity. In other words, for a nonlinearity of 1%, α can be quite a lot larger
than for a nonlinearity of 0.1%.
The slewing behavior of two-stage op amps is somewhat different from that of the circuits studied
earlier. This case is studied in Chapter 10.
9.10
High-Slew-Rate Op Amps
Our formulation of the slew rate in various op amp topologies implies that, for a given capacitance, slew-
limited settling can be improved only by raising the bias current and hence the power consumption. This
trade-off can be mitigated if the current available to charge the capacitor of interest automatically rises
during slewing and falls back to its original value thereafter. In this section, we study op amp topologies
that exploit this idea.
9.10.1 One-Stage Op Amps
We begin with a simple common-source stage incorporating a current-source load biased at a value of I0
[Fig. 9.78(a)]. In the absence of an input signal, ID1 = I0, but if Vin jumps down to turn M1 off, then I0
ﬂows through CL, yielding a slew rate of I0/CL.7 Can we automatically increase the drain current of M2
during this transient? To this end, we must allow Vb to change and, in fact, follow the jump in Vin. For
example, as shown in Fig. 9.78(b), we can simply apply Vin to both transistors so that a downward jump
in Vin also raises |ID2|. This complementary topology was studied in Chapter 3 and found to suffer from
poor power supply rejection. We pursue other topologies here.
M1
CL
M1
CL
M2
M2
Vb
VDD
VDD
Vout
Vout
I0
Vin
Vin
(a)
(b)
Figure 9.78
Slewing in (a) a simple CS stage and (b) a complementary CS stage.
Let us control M2 in Fig. 9.78(a) by current mirror action, as depicted in Fig. 9.79(a), and ask how Ib
must be controlled by Vin. Can Ib be derived from another common-source device [Fig. 9.79(b)]? No;
as Vin jumps down in this circuit, Ib decreases. We must therefore include an additional signal inversion
in the path controlling Ib. Alternatively, we can consider a differential topology, where both the input
signal, V +
in , and its inverted version, V −
in , are available. Illustrated in Fig. 9.79(c), the idea is to control
the bias current of M2 by V −
in and that of M4 by V +
in . For example, if V +
in jumps down and V −
in jumps up,
then (1) M5 draws less current from M8, lowering |ID4|, (2) M3 draws more current, discharging its load
capacitance, (3) M6 draws more current from M7, raising |ID2|, and (4) M1 draws less current, allowing
its drain capacitance to be charged by M2.
The circuits of Figs. 9.78(b) and 9.79(c) are called “push-pull” stages as they turn the load current
source into an “active” pull-up device. Loosely speaking, we also refer to them as “class-AB” ampliﬁers.8
7If Vin jumps up, M1 must absorb both I0 and the current ﬂowing out of CL.
8By contrast, topologies with a constant bias current are called “class-A” ampliﬁers.

398
Chap. 9
Operational Ampliﬁers
Vout
M1
CL
Vout
M1
M4
CL
M2
VDD
Vin
Vin
Ib
Ib
M3
M2
VDD
M3
M2
M7
M2
M7
M5
CL CL
CL CL
M1
M5
M1
M3
M8
M3
M6
M3
M6
VDD
M4
M8
VDD
Y
X
Y
X
ISS1
ISS2
Vin
Vin
Vin
Vin
(c)
(a)
(b)
(d)
Vout1 Vout2
Figure 9.79
(a) CS stage with current mirror biasing, (b) injection of signal into the mirror with incorrect
polarity, (c) injection of signal into the mirror with ccrrect polarity, and (d) addition of tail current sources.
By virtue of the temporary boost in the slew rate, such circuits alleviate the trade-off between the speed
and the average power consumption.
In order to improve the input common-mode rejection, we add tail current sources to M1 and M3 and
to M5 and M6 [Fig. 9.79(d)]. We now wish to calculate the circuit’s slew rate with a large input step. If,
for example, V +
in jumps up and M1 and M5 absorb all of their respective tail currents, then M2 is off and
Vout1 falls at a rate of ISS1/CL while M3 is off and Vout2 rises at a rate of ISS2(W4/W8)/CL (if L4 = L8).
The differential slew rate is thus equal to [ISS1 + ISS2(W4/W8)]/CL. Without the push-pull action, on
the other hand, this slew rate would be limited to ISS1/CL. If we choose W4/W8 equal to, say, 5 and ISS2
equal to ISS1, then the SR increases by a factor of 6 with a twofold power penalty.9
▲
Example9.24
Calculate the small-signal voltage gain of the class-AB op amp shown in Fig. 9.79(d).
Solution
In addition to the main path, the mirror path contributes gain as well. Since the mirror action ampliﬁes the drain
currents of M5 and M6 by a factor of W4/W8, we approximate the gain in this path as (W4/W8)gm5(rO3||rO4) and
add it to that of the main path:
|Av| ≈gm1(rO3||rO4) + (W4/W8)gm5(rO3||rO4)
(9.72)
≈[gm1 + (W4/W8)gm5](rO3||rO4)
(9.73)
The mirror path thus raises the apparent transconductance from gm1 to gm1 + (W4/W8)gm5.
▲
9One can argue that the ﬁxed tail currents no longer allow class-AB operation, but we disregard this subtlety for now.

Sec. 9.10
High-Slew-Rate Op Amps
399
Let us now determine the transfer function of the above circuit and examine the effect of the mirror
pole. We write the transfer function from the input through the mirror path to the output as
Hmirr(s) = W4
W8
gm5(rO3||rO4)
1
1 +
s
ωp,X
1
1 +
s
ωout
(9.74)
where ωp,X ≈gm8/CY and ωout = [(rO3||rO4)CL]−1. For the main path, we simply have
Hmain(s) = gm1(rO3||rO4)
1
1 +
s
ωout
(9.75)
It follows that
Htot(s) = Hmain(s) + Hmirr(s)
(9.76)
= rO3||rO4
1 +
s
ωout
⎡
⎢⎣W4
W8
gm5
1 +
s
ωp,X
+ gm1
⎤
⎥⎦
(9.77)
= rO3||rO4
1 +
s
ωout
· (W4/W8)gm5 + gm1 + gm1s/ωp,X
1 +
s
ωp,X
(9.78)
As seen in other examples in Chapter 6, the presence of the additional signal path leads to a zero in the
transfer function. This zero frequency is given by
|ωz| =
W4
W8
gm5
gm1
+ 1

ωp,X
(9.79)
Unfortunately, it is not possible to equate ωz to ωp,X because (W4/W8)(gm5/gm1) is typically around
unity or higher. Also, in practice, ωout < ωp,X.
It is tempting to raise the SR in Fig. 9.79(d) by increasing W4/W8, but we must note that, as a result,
the pole frequency associated with the mirror nodes falls. Approximating this pole by gm8/CY and writing
gm8 = √ISS2μnCox(W/L)8 and CY ≈2(W4 + W8)LCox + CDB8 + CDB5, we recognize that the mirror
pole frequency is inversely proportional to W4.
9.10.2 Two-Stage Op Amps
In order to achieve a high slew rate, we can apply push-pull operation to the second stage of a two-
stage op amp. To this end, we view the arrangement shown in Fig. 9.79(c) as the second stage and
precede it with a differential pair, arriving at the topology depicted in Fig. 9.80. This circuit provides a
voltage gain of
|Av| = gm9(rO9||rO11)[gm1 + (W4/W8)gm5](rO1||rO2)
(9.80)
But how about the slew rate? Suppose, for example, Vin1 and Vin2 experience a large differential step such
that the entire ISS ﬂows through node P. If this node is “agile” enough, i.e., if its capacitance is relatively
small, VP rises rapidly, applying a large overdrive to M1 and M5 and creating a high slew rate at the
output. In other words, since VP (or VQ) can reach near VDD when only M9 (or M10) is on, the available
current is much larger than the bias current of the output stage. This behavior stands in contrast to that

400
Chap. 9
Operational Ampliﬁers
M2
M7
M8
M4
M5
CL
M1
M3
M6
 
CL
VDD
Y
X
M9
M10
M11
M12
Vb
Vin1
Vin2
ISS
P
Q
Figure 9.80
Two-stage op amp with slew enhancement.
of the circuit in Fig. 9.79(d), where the available current is a multiple of the tail currents and cannot be
raised further “upon demand.”
We return to this two-stage op amp in Chapter 10 and analyze its slew rate in the presence of frequency
compensation.
9.11
Power Supply Rejection
As with other analog circuits, op amps are often supplied from noisy lines and must therefore “reject” the
noise adequately. For this reason, it is important to understand how noise on the supply manifests itself
at the output of an op amp.
Let us consider the simple op amp shown in Fig. 9.81, assuming that the supply voltage varies slowly.
If the circuit is perfectly symmetric, Vout = VX. Since the diode-connected device “clamps” node X to
VDD, VX and hence Vout experience approximately the same change as does VDD. In other words, the
gain from VDD to Vout is close to unity. The power supply rejection ratio (PSRR) is deﬁned as the gain
from the input to the output divided by the gain from the supply to the output. At low frequencies:
PSRR ≈gmN(rO P∥rON)
(9.81)
VDD
M4
M2
M1
ISS
M3
X
Vout
Figure 9.81
Supply rejection of differ-
ential pair with active current mirror.
▲
Example9.25
Calculate the low-frequency PSRR of the feedback circuit shown in Fig. 9.82(a).

Sec. 9.11
Power Supply Rejection
401
X
VDD
gm3
1
VDD
M4
M1
M2
ISS
M3
Vout
Vout
C1
C2
Vin
P
C1
C2
P
X
V4
gm1
V1
V1 gm2V2
gm4V4
V2
rO4
(a)
(b)
Figure 9.82
Solution
From the foregoing analysis, we may surmise that a change V in VDD appears unattenuated at the output. But, we
should note that if Vout changes, so do VP and ID2, thereby opposing the change. Using Fig. 9.82(b) and neglecting
channel-length modulation in M1–M3 for simplicity, we can write
Vout
C1
C1 + C2
−V2 = −V1
(9.82)
and gm1V1 + gm2V2 = 0. Thus, if the circuit is symmetric,
V2 = Vout
2
C1
C1 + C2
(9.83)
We also have
−gm1V1
gm3
gm4 −VDD −Vout
rO4
+ gm2V2 = 0
(9.84)
It follows that
Vout
VDD
=
1
gm2rO4
C1
C1 + C2
+ 1
(9.85)
Thus,
PSRR ≈(1 + C2
C1
)(gm2rO4
C1
C1 + C2
+ 1)
(9.86)
≈gm2rO4
(9.87)
▲
The denominator of Eq. (9.85) looks like one plus a loop gain. Is that true? Let us set the main
input in Fig. 9.82(a) to zero and view the path from VDD to Vout as an ampliﬁer [Fig. 9.83(a)], omitting
C1 and C2. In this case, the gain, ∂Vout/∂VDD, is equal to unity. Now, as depicted in Fig. 9.83(b), we
sense Vout by means of a capacitive divider and return the result to some node within the ampliﬁer.
We expect the gain to drop by one plus the loop gain associated with the feedback loop. Indeed, this
loop gain is equal to [C1/(C1 + C2)]gm2rO4 if channel-length modulation is neglected for M1–M3. We
therefore recognize that feedback reduces ∂Vout/∂VDD and ∂Vout/∂Vin by the same factor, leaving the
PSRR relatively constant.

402
Chap. 9
Operational Ampliﬁers
VDD
Vout
VDD
Vout
C2
C1
(a)
(b)
Figure 9.83
Equivalent circuits for path from VDD to output.
9.12
Noise in Op Amps
In low-noise applications, the input-referred noise of op amps becomes critical. We now extend the noise
analysis of differential ampliﬁers in Chapter 7 to more sophisticated topologies. With many transistors
in an op amp, it may seem difﬁcult to intuitively identify the dominant sources of noise. A simple rule
for inspection is to (mentally) change the gate voltage of each transistor by a small amount and predict
the effect at the output.
Let us ﬁrst consider the telescopic op amp shown in Fig. 9.84. At relatively low frequencies, the
cascode devices contribute negligible noise, leaving M1–M2 and M7–M8 as the primary noise sources.
The input-referred noise voltage per unit bandwidth is therefore similar to that in Fig. 7.59(a) and given by
V 2n = 4kT

2
γ
gm1,2
+ 2γ gm7,8
g2
m1,2

+ 2
KN
(W L)1,2Cox f + 2
K P
(W L)7,8Cox f
g2
m7,8
g2
m1,2
(9.88)
where KN and K P denote the 1/f noise coefﬁcients of NMOS and PMOS devices, respectively.
VDD
M5
M1
M2
ISS
Vin
M8
Vb1
M3
M4
Vout
M7
M6
Vb2
Vb3
Figure 9.84
Noise in a telescopic
op amp.
Next, we study the noise behavior of the folded-cascode op amp of Fig. 9.85(a), considering only
thermal noise at this point. Again, the noise of the cascode devices is negligible at low frequencies,
leaving M1–M2, M7–M8, and M9–M10 as potentially signiﬁcant sources. Do both pairs M7–M8 and
M9–M10 contribute noise? Using our simple rule, we change the gate voltage of M7 by a small amount
[Fig. 9.85(b)], noting that the output indeed changes considerably. The same observation applies to M8–
M10 as well. To determine the input-referred thermal noise, we ﬁrst refer the noise of M7–M8 to the

Sec. 9.12
Noise in Op Amps
403
M8
M7
Vb1
Vb2
VDD
Vb3
Vb4
(b)
M5
M3
M4
M6
M9
M10
Vout
M1
M2
Vin
M11
VDD
M5
M8
Vb1
M3
M4
M7
M6
Vb2
M9
M10
Vb3
Vb4
(a)
Vout
M1
M2
Vin
M11
Figure 9.85
Noise in a folded-cascode op amp.
output:
V 2n,out
		
M7,8 = 2

4kT
γ
gm7,8
g2
m7,8R2
out

(9.89)
where the factor 2 accounts for the (uncorrelated) noise of M7 and M8 and Rout denotes the open-loop
output resistance of the op amp. Similarly,
V 2n,out
		
M9,10 = 2

4kT
γ
gm9,10
g2
m9,10R2
out

(9.90)
Dividing these quantities by g2
m1,2R2
out and adding the contribution of M1–M2, we obtain the overall noise:
V 2
n,int = 8kT

γ
gm1,2
+ γ gm7,8
g2
m1,2
+ γ gm9,10
g2
m1,2

(9.91)
The effect of ﬂicker noise can be included in a similar manner (Problem 9.15). Note that the folded-
cascode topology potentially suffers from greater noise than its telescopic counterpart. In applications

404
Chap. 9
Operational Ampliﬁers
where ﬂicker noise is critical, we opt for a PMOS-input op amp as PMOS transistors typically exhibit
less ﬂicker noise than do NMOS devices.
As observed for the differential ampliﬁers in Chapter 7, the noise contribution of the PMOS and
NMOS current sources increases in proportion to their transconductance. This trend results in a trade-
off between output voltage swings and input-referred noise: for a given current, as implied by gm =
2ID/(VGS −VT H), if the overdrive voltage of the current sources is minimized to allow large swings,
then their transconductance is maximized.
VDD
M4
M1
M2
ISS
M3
Vb
Vin
M7
M8
Vb
M5
M6
Vout2
Vout1
Figure 9.86
Noise in a two-stage op amp.
As another case, we calculate the input-referred thermal noise of the two-stage op amp shown in
Fig. 9.86. Beginning with the second stage, we note that the noise current of M5 and M7 ﬂows through
rO5∥rO7. Dividing the resulting output noise voltage by the total gain, gm1(rO1∥rO3) × gm5(rO5∥rO7),
and doubling the power, we obtain the input-referred contribution of M5–M8:
V 2n
		
M5−8 = 2 × 4kT γ (gm5 + gm7)(rO5∥rO7)2
1
g2
m1(rO1∥rO3)2g2
m5(rO5∥rO7)2
(9.92)
= 8kT γ
gm5 + gm7
g2
m1g2
m5(rO1∥rO3)2
(9.93)
The noise due to M1–M4 is simply equal to
V 2n
		
M1−4 = 2 × 4kT γ gm1 + gm3
g2
m1
(9.94)
It follows that
V 2n,tot = 8kT γ 1
g2
m1

gm1 + gm3 +
gm5 + gm7
g2
m5(rO1∥rO3)2

(9.95)
Note that the noise resulting from the second stage is usually negligible because it is divided by the gain
of the ﬁrst stage when referred to the main input.
▲
Example9.26
A simple ampliﬁer is constructed as shown in Fig. 9.87. Note that the ﬁrst stage incorporates diode-connected—rather
thancurrent-source—loads.Assumingthatallofthetransistorsareinsaturationand(W/L)1,2 = 50/0.6, (W/L)3,4 =
10/0.6, (W/L)5,6 = 20/0.6, and (W/L)7,8 = 56/0.6, calculate the input-referred noise voltage if μnCox =
75 μA/V2, μpCox = 30 μA/V2, and γ = 2/3.

References
405
VDD
M4
M1
M2
ISS
M3
Vin
M7
M8
Vb
M5
M6
Vout2
Vout1
0.5 mA
Figure 9.87
Solution
We ﬁrst calculate the small-signal gain of the ﬁrst stage:
Av1 ≈gm1
gm3
(9.96)
=

50 × 75
10 × 30
(9.97)
≈3.54
(9.98)
The noise of M5 and M7 referred to the gate of M5 is equal to 4kT (2/3)(gm5 + gm7)/g2
m5 = 2.87 × 10−17 V2/Hz,
which is divided by A2
v1 when referred to the main input: V 2n |M5,7 = 2.29 × 10−18 V2/Hz. Transistors M1 and M3
produce an input-referred noise of V 2n |M1,3 = (8kT/3)(gm3 + gm1)/g2
m1 = 1.10 × 10−17 V2/Hz. Thus, the total
input-referred noise equals
V 2
n,in = 2(2.29 × 10−18 + 1.10 × 10−17)
(9.99)
= 2.66 × 10−17 V2/Hz
(9.100)
where the factor of 2 accounts for the noise produced by both odd-numbered and even-numbered transistors in the
circuit. This value corresponds to an input noise voltage of 5.16 nV/
√
Hz.
▲
The noise-power trade-off described in Chapter 7 is present in op amps as well. Speciﬁcally, the
devices and bias currents in an op amp can be linearly scaled so as to trade power consumption for noise.
For example, if all of the transistor widths and ISS in Fig. 9.87 are halved, then so is the power, while
V 2
n,in is doubled and the voltage gain and swings remain unchanged. This simple scaling can be applied
to all of the op amps studied in this chapter. We exploit this principle in the nanometer op amps designed
in Chapter 11.
References
[1] R. G. Eschauzier, L. P. T. Kerklaan, and J. H. Huising, “A 100-MHz 100-dB Operational Ampliﬁer with
Multipath Nested Miller Compensation Structure,” IEEE J. of Solid-State Circuits, vol. 27, pp. 1709–1717,
December 1992.
[2] R. M. Ziazadeh, H. T. Ng, and D. J. Allstot, “A Multistage Ampliﬁer Topology with Embedded Tracking
Compensation,” CICC Proc., pp. 361–364, May 1998.

406
Chap. 9
Operational Ampliﬁers
[3] F. You, S. H. Embabi, and E. Sanchez-Sincencio, “A Multistage Ampliﬁer Topology with Nested Gm-C
Compensation for Low-Voltage Application,” ISSCC Dig. of Tech. Papers, pp. 348–349, February 1997.
[4] B. J. Hosticka, “Improvement of the Gain of CMOS Ampliﬁers,” IEEE J. of Solid-State Circuits, vol. 14,
pp. 1111–1114, December 1979.
[5] K. Bult and G. J. G. H. Geelen, “A Fast-Settling CMOS Operational Ampliﬁer for SC Circuits with 90-dB DC
Gain,” IEEE J. of Solid-State Circuits, vol. 25, pp. 1379–1384, December 1990.
[6] E. Sackinger and W. Guggenbuhl, “A High-Swing High-Impedance MOS Cascode Circuit,” IEEE J. of Solid-
State Circuits, vol. 25, pp. 289–298, February 1990.
[7] A. Verma and B. Razavi, “A 10-Bit 500-MS/s 55-mW CMOS ADC,” IEEE J. of Solid-State Circuits, vol. 44,
pp. 3039–3050, November 2009.
[8] R. Hogervost et al., “A Compact Power-Efﬁcient 3-V CMOS Rail-to-Rail Input/Output Operational Ampliﬁer
for VLSI Cell Libraries,” IEEE J. of Solid-State Circuits, vol. 29, pp. 1505–1513, December 1994.
[9] D. A. Johns and K. Martin, Analog Integrated Circuit Design (New York; Wiley, 1997).
[10] P. E. Allen, B. J. Blalock, and G. A. Rincon, “A 1-V CMOS Op Amp Using Bulk-Driven MOSFETs,” ISSCC
Dig. of Tech. Papers, pp.192–193, February 1995.
[11] S. Rabii and B. A. Wooley, “A 1.8-V Digital-Audio Sigma-Delta Modulator in 0.8-μm CMOS,” IEEE J. of
Solid-State Circuits, vol. 32, pp. 783–796, June 1997.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. Also, assume that all transistors are in saturation.
9.1.
(a) Derive expressions for the transconductance and output resistance of a MOSFET in the triode region. Plot
these quantities and gmrO as a function of VDS, covering both triode and saturation regions.
(b) Consider the ampliﬁer of Fig. 9.6(b), with (W/L)1−4 = 50/0.5, ISS = 1 mA, and input CM level
of 1.3 V. Calculate the small-signal gain and the maximum output swing if all transistors remain in
saturation.
(c) For the circuit of part (b), suppose we allow each PMOS device to enter the triode region by 50 mV so as
to increase the allowable differential swing by 100 mV. What is the small-signal gain at the peaks of the
output swing?
9.2.
In the circuit of Fig. 9.9, assume that (W/L)1−4 = 100/0.5, ISS = 1 mA, Vb = 1.4 V, and γ = 0.
(a) If M5–M8 are identical and have a length of 0.5 μm, calculate their minimum width such that M3 operates
in saturation.
(b) Calculate the maximum output voltage swing.
(c) What is the open-loop voltage gain?
(d) Calculate the input-referred thermal noise voltage.
9.3.
Design the folded-cascode op amp of Fig. 9.15 for the following requirements: maximum differential swing
= 2.4 V, total power dissipation = 6 mW. If all of the transistors have a channel length of 0.5 μm, what is the
overall voltage gain? Can the input common-mode level be as low as zero?
9.4.
In the op amp of Fig. 9.21(b), (W/L)1−8 = 100/0.5, ISS = 1 mA, and Vb1 = 1.7 V. Assume that γ = 0.
(a) What is the maximum allowable input CM level?
(b) What is VX?
(c) What is the maximum allowable output swing if the gate of M2 is connected to the output?
(d) What is the acceptable range of Vb2?
(e) What is the input-referred thermal noise voltage?
9.5.
Design the op amp of Fig. 9.21(b) for the following requirements: maximum differential swing = 2.4 V, total
power dissipation = 6 mW. (Assume that the gate of M2 is never shorted to the output.)
9.6.
If in Fig. 9.23, (W/L)1−8 = 100/0.5 and ISS = 1 mA,
(a) What CM level must be established at the drains of M3 and M4 so that ID5 = ID6 = 1 mA? How does
this constrain the maximum input CM level?
(b) With the choice made in part (a), calculate the overall voltage gain and the maximum output swing.

Problems
407
9.7.
Design the op amp of Fig. 9.23 for the following requirements: maximum differential swing = 4 V, total power
dissipation = 6 mW, ISS = 0.5 mA.
9.8.
Suppose the circuit of Fig. 9.24 is designed with ISS equal to 1 mA, ID9–ID12 equal to 0.5 mA, and
(W/L)9−12 = 100/0.5.
(a) What CM level is required at X and Y?
(b) If ISS requires a minimum voltage of 400 mV, choose the minimum dimensions of M1–M8 to allow a
peak-to-peak swing of 200 mV at X and at Y.
(c) Calculate the overall voltage gain.
9.9.
In Fig. 9.88, calculate the input-referred thermal noise if I1 and I2 are implemented by PMOS devices.
M2
M3
I1
VDD
M1
Vin
I2
Vout
X
Figure 9.88
9.10. Suppose that in Fig. 9.88, I1 = 100 μA, I2 = 0.5 mA, and (W/L)1−3 = 100/0.5. Assuming that I1 and I2
are implemented with PMOS devices having (W/L)P = 50/0.5,
(a) Calculate the gate bias voltages of M2 and M3.
(b) Determine the maximum allowable output voltage swing.
(c) Calculate the overall voltage gain and the input-referred thermal noise voltage.
9.11. In the circuit of Fig. 9.53, each branch is biased at a current of 0.5 mA. Choose the dimensions of M7 and M8
such that the output CM level is equal to 1.5 V and VP = 100 mV.
9.12. Consider the CMFB network in Fig. 9.51. The ampliﬁer sensing Vout,C M is to be implemented as a different
pair with active current mirror load.
(a) Should the input pair of the ampliﬁer use PMOS devices or NMOS devices?
(b) Calculate the loop gain for the CMFB network.
9.13. Repeat Problem 9.9.12b for the circuit of Fig. 9.52.
9.14. In the circuit of Fig. 9.73(a), assume that (W/L)1−4 = 100/0.5, C1 = C2 = 0.5 pF, and ISS = 1 mA.
(a) Calculate the small-signal time constant of the circuit.
(b) With a 1-V step at the input [Fig. 9.73(c)], how long does it take for ID2 to reach 0.1ISS?
9.15. It is possible to argue that the auxiliary ampliﬁer in a gain-boosting stage reduces the output impedance.
Consider the circuit as drawn in Fig. 9.89, where the drain voltage of M2 is changed by V to measure the
output impedance. It seems that, since the feedback provided by A1 attempts to hold VX constant, the change
in the current through rO2 is much greater than in the original circuit, suggesting that Rout ≈rO2. Explain
the ﬂaw in this argument.
Vb
A1
X
M2
rO2
ΔV
ΔVX
ΔV
rO1
Figure 9.89

408
Chap. 9
Operational Ampliﬁers
9.16. Calculate the CMRR of the circuit shown in Fig. 9.73(a).
9.17. Calculate the input-referred ﬂicker noise of the op amp shown in Fig. 9.85(a).
9.18. In this problem, we design a two-stage op amp based on the topology shown in Fig. 9.90. Assume a power
budget of 6 mW, a required output swing of 2.5 V, and Lef f = 0.5 μm for all devices.
VDD
M6
Vout
M5
Vb
Vin
M4
M3
M1
M2
X
Y
M7
Figure 9.90
(a) Allocating a current of 1 mA to the output stage and roughly equal overdrive voltages to M5 and M6,
determine (W/L)5 and (W/L)6. Note that the gate-source capacitance of M5 is in the signal path, whereas
that of M6 is not. Thus, M6 can be quite a lot larger than M5.
(b) Calculate the small-signal gain of the output stage.
(c) With the remaining 1 mA ﬂowing through M7, determine the aspect ratio of M3 (and M4) such that
VGS3 = VGS5. This is to guarantee that if Vin = 0 and hence VX = VY , then M5 carries the expected
current.
(d) Calculate the aspect ratios of M1 and M2 such that the overall voltage gain of the op amp is equal to 500.
9.19. Consider the op amp of Fig. 9.90, assuming that the second stage is to provide a voltage gain of 20 with a bias
current of 1 mA.
(a) Determine (W/L)5 and (W/L)6 such that M5 and M6 have equal overdrive voltages.
(b) What is the small-signal gain of this stage if M6 is driven into the triode region by 50 mV?
9.20. The op amp designed in Problem 9.9.18d is placed in unity-gain feedback. Assume that |VGS7 −VT H7| =
0.4 V.
(a) What is the allowable input voltage range?
(b) At what input voltage are the input and output voltages exactly equal?
9.21. Calculate the input-referred noise of the op amp designed in Problem 9.9.18d.
9.22. It is possible to use the bulk terminal of PMOS devices as an input [10]. Consider the ampliﬁer shown in
Fig. 9.91 as an example.
M3
M4
M1
M2
Vin
VDD
Vb1
Vb1
Vout
Vb2
Figure 9.91
(a) Calculate the voltage gain.
(b) What is the acceptable input common-mode range?
(c) How does the small-signal gain vary with the input common-mode level?
(d) Calculate the input-referred thermal noise voltage and compare the result with that of a regular PMOS
differential pair having NMOS current-source loads.

Problems
409
9.23. The idea of the active current mirror can be applied to the output stage of a two-stage op amp as well. That is,
the load current source can become a function of the signal. Figure 9.92 shows an example [11]. Here, the ﬁrst
stage consists of M1–M4, and the output is produced by M5–M8. Transistors M7 and M8 operate as active
current sources because their current varies with the signal voltage at nodes Y and X, respectively.
(a) Calculate the differential voltage gain of the op amp.
(b) Estimate the magnitude of the three major poles of the circuit.
X
VDD
Vin
M1
M2
M3
M4
Vb
M8
M6
M12
Vout2
M10
M5
M7
Vout1
M9
M11
Y
Figure 9.92
9.24. The circuit of Fig. 9.93 employs a fast path (M′
1 and M′
2) in parallel with the slow path. Calculate the differential
voltage gain of the circuit. Which transistors typically limit the output swing?
VDD
M3
M4
Vb
M2
M1
M1
M2
Vin
M8
M6
Vout2
Vb
M5
M7
Vout1
Vb
’
’
Figure 9.93
9.25. Calculate the input-referred thermal noise of the op amp in Fig. 9.93.
9.26. Determine the slew rate of a fully-differential folded-cascode op amp.
9.27. Calculate the slew rate in Fig. 9.75 if ISS > IP.

CHAPTER
10
Stability and Frequency
Compensation
Negative feedback ﬁnds wide application in the processing of analog signals. As described in Chapter 8,
feedback suppresses the effect of the variations of the open-loop characteristics. Feedback systems,
however, suffer from potential instability; that is, they may oscillate.
In this chapter, we deal with the stability and frequency compensation of linear feedback systems to the
extent necessary to understand the design issues of analog feedback circuits. Beginning with a review of
stability criteria and the concept of phase margin, we study frequency compensation, introducing various
techniques suited to different op amp topologies. We also analyze the impact of frequency compensation
on the slew rate of two-stage op amps. The chapter ends with a study of Nyquist’s stability criterion.
10.1
General Considerations
Let us consider the negative-feedback system shown in Fig. 10.1(a), where β is assumed constant. Writing
the closed-loop transfer function as
Y
X (s) =
H(s)
1 + βH(s)
(10.1)
we note that if βH(s = jω1) = −1 at ω1 ̸= 0, then the closed-loop “gain” goes to inﬁnity, and the
circuit can amplify its own noise until it eventually begins to oscillate. In other words, if the loop gain
at ω1, βH( jω1), is equal to −1, then the circuit may oscillate at frequency ω1. This condition can be
expressed as
|βH( jω1)| = 1
(10.2)
̸ βH( jω1) = −180◦
(10.3)
X(s)
Y(s)
Y(s)
H(s)
H(s)
X(s)
β
β
180°
180°
(a)
(b)
Figure 10.1
(a) Basic negative-feedback system, and (b) phase shift around the loop at ω1.
410

Sec. 10.1
General Considerations
411
which are called “Barkhausen’s Criteria.” Note that (1) these equations relate only to the loop gain (more
precisely, the loop transmission)1 and are independent of where the input and output are located, and
(2) the total phase shift around the loop at ω1 is 360◦because negative feedback itself introduces 180◦of
phase shift [Fig. 10.1(b)]. The 360◦phase shift is necessary for oscillation since the feedback signal must
add in phase to the original noise to allow oscillation buildup. By the same token, a loop gain of unity
(or greater) is also required to enable growth of the oscillation amplitude. These oscillation requirements
are studied further in Chapter 15. The key point here is that the loop transmission, which can often be
found from the open-loop system, reveals the stability of the closed-loop system.
In summary, a negative-feedback system may oscillate at ω1 if (1) the phase shift around the loop
at this frequency is so great that the feedback becomes positive and (2) the loop gain is still enough to
allow signal buildup. Illustrated in Fig. 10.2(a), the situation can be viewed as excessive loop gain at the
frequency at which the phase shift reaches −180◦or, equivalently, excessive phase at the frequency at
which the loop gain drops to unity. Thus, to avoid instability, we must minimize the total phase shift so
that if |βH| = 1, then ̸ βH is still more positive than −180◦[Fig. 10.2(b)]. In this chapter, we assume
that β is less than or equal to unity and does not depend on the frequency.
0
0
−180°
Unstable
0
0
Stable
(a)
(b)
βH(ω)
−180°
βH(ω)
Excessive
Gain
Excessive
Phase
ω (log scale)
ω (log scale)
ω (log scale)
ω (log scale)
ω1
ω2
20log∣βH(ω)∣
20log∣βH(ω)∣
Figure 10.2
Bode plots of loop transmission for (a) unstable and (b) stable systems.
The frequencies at which the magnitude and phase of the loop gain are equal to unity and −180◦,
respectively, play a critical role in the stability and are called the “gain crossover frequency” and the
“phase crossover frequency,” respectively. In a stable system, the gain crossover must occur well before
the phase crossover. For the sake of brevity, we denote the gain crossover by GX and the phase crossover
by PX. It is helpful to note that the gain crossover frequency is the same as the unity-gain bandwidth of
the loop transmission.
▲
Example10.1
Explain whether the system depicted in Fig. 10.2(a) becomes more or less stable if the feedback is weakened, i.e., if
β is reduced.
1The terms “loop gain” and “loop transmission” [βH(s)], respectively, refer to the low-frequency value and the transfer function
of the gain around the loop, but we sometimes use them interchangeably.

412
Chap. 10
Stability and Frequency Compensation
Solution
As illustrated in Fig. 10.3, a lower β shifts the plot of 20 log |βH(ω)| down and the GX to the left. Since ̸ βH(ω)
does not change, the system becomes more stable. After all, if we apply no feedback around an op amp, the circuit
has no tendency to oscillate. Thus, the worst-case stability corresponds to β = 1, i.e, unity-gain feedback. For this
reason, we often analyze the magnitude and phase plots for βH = H.
log ω
log ω
0
0
Lower β
βH(ω)
20log∣βH(ω)∣
Figure 10.3
▲
Before studying more speciﬁc cases, let us review a few basic rules for constructing Bode plots. A
Bode plot illustrates the asymptotic behavior of the magnitude and phase of a complex function according
to the magnitude of the poles and zeros. The following two rules are used. (1) The slope of the magnitude
plot changes by +20 dB/dec at every zero frequency and by −20 dB/dec at every pole frequency. (2) For a
pole (zero) frequency of ωm, the phase begins to fall (rise) at approximately 0.1ωm, experiences a change
of −45◦(+45◦) at ωm, and approaches a change of −90◦(+90◦) at approximately 10ωm. The key point
here is that the phase is much more signiﬁcantly affected by high-frequency poles and zeros than the
magnitude is.
It is also instructive to plot the location of the poles of a closed-loop system on a complex plane.
Expressing each pole frequency as sp = jωp + σp and noting that the impulse response of the system
includes a term exp( jωp + σp)t, we observe that if sp falls in the right half plane (RHP), i.e., if σp > 0,
then the system oscillates because its time-domain response exhibits a growing exponential [Fig. 10.4(a)].
Even if σp = 0, the system sustains oscillations [Fig. 10.4(b)]. Conversely, if the poles lie in the left half
plane (LHP), all time-domain exponential terms decay to zero [Fig. 10.4(c)].2 In practice, we plot the
location of the poles as the loop gain varies, thereby revealing how close to oscillation the system may
come. Such a plot is called a “root locus.”
We now study a feedback system incorporating a one-pole forward ampliﬁer. Assuming H(s) =
A0/(1 + s/ω0), we have from (10.1)
Y
X (s) =
A0
1 + β A0
1 +
s
ω0(1 + β A0)
(10.4)
2We ignore the effect of zeros for now.

Sec. 10.1
General Considerations
413
jω
jω
σp
+ωp
−ωp
+ωp
−ωp
jω
+ωp
−ωp
t
eσpt
eσpt
σ
t
σ
σp
t
(c)
(a)
(b)
σ
Figure 10.4
Time-domain response of a system versus the position of poles: (a) unstable with growing
amplitude; (b) unstable with constant-amplitude oscillation; (c) stable.
In order to analyze the stability behavior, we plot |βH(s = jω)| and ̸ βH(s = jω) (Fig. 10.5), observing
that a single pole cannot contribute a phase shift greater than 90◦and the system is unconditionally stable
for all nonnegative values of β. Note that ̸ βH is independent of β.
0
0
20logβA0
ω0
ω0
−90°
−45°
βH(ω)
20log∣βH(ω)∣
ω (log scale)
ω (log scale)
Figure 10.5
Bode plots of loop
transmission for a one-pole system.
▲
Example10.2
Construct the root locus for a one-pole system.
Solution
Equation (10.4) implies that the closed-loop system has a pole sp = −ω0(1 + β A0), i.e., a real-valued pole in the
left half plane that moves away from the origin as the loop gain increases (Fig. 10.6).

414
Chap. 10
Stability and Frequency Compensation
σ
jω
β = 0
β
−ω0
Figure 10.6
▲
10.2
Multipole Systems
Our study of op amps in Chapter 9 indicates that such circuits generally contain multiple poles. In two-
stage op amps, for example, each gain stage introduces a “dominant” pole. It is therefore important to
study a feedback system whose core ampliﬁer exhibits more than one pole.
Let us consider a two-pole system ﬁrst. For stability considerations, we plot |βH| and ̸ βH as a
function of the frequency. Shown in Fig. 10.7, the magnitude begins to drop at 20 dB/dec at ω = ωp1
and at 40 dB/dec at ω = ωp2. Also, the phase begins to change at ω = 0.1ωp1, reaches −45◦at ω = ωp1
and −90◦at ω = 10ωp1, begins to change again at ω = 0.1ωp2 (if 0.1ωp2 > 10ωp1), reaches −135◦at
ω = ωp2, and asymptotically approaches −180◦. The system is therefore stable because |βH| drops to
below unity at a frequency where ̸ βH < −180◦.
0
0
ωp1
ωp2
Gain
Crossover 
−180°
−90°
βH(ω)
ω (log scale)
ω (log scale)
20log∣βH(ω)∣
Figure 10.7
Bode plots of loop trans-
mission for a two-pole system.
What happens if the feedback is made “weaker”? To reduce the amount of feedback, we decrease β,
obtaining the gray magnitude plot in Fig. 10.7. As the feedback becomes weaker, the gain crossover point
moves toward the origin while the phase crossover point remains constant, resulting in a more stable
system. The stability is obtained at the cost of weaker feedback.
▲
Example10.3
Construct the root locus for a two-pole system.

Sec. 10.2
Multipole Systems
415
Solution
Writing the open-loop transfer function as
H(s) =
A0

1 +
s
ωp1

1 +
s
ωp2

(10.5)
we have
Y
X (s) =
A0

1 +
s
ωp1

1 +
s
ωp2

+ β A0
(10.6)
=
A0ωp1ωp2
s2 + (ωp1 + ωp2)s + (1 + β A0)ωp1ωp2
(10.7)
Thus, the closed-loop poles are given by
s1,2 = −(ωp1 + ωp2) ±

(ωp1 + ωp2)2 −4(1 + β A0)ωp1ωp2
2
(10.8)
As expected, for β = 0, s1,2 = −ωp1, −ωp2. As β increases, the term under the square root drops, taking on a value
of zero for
β1 = 1
A0
(ωp1 −ωp2)2
4ωp1ωp2
(10.9)
As shown in Fig. 10.8, the poles begin at −ωp1 and −ωp2, move toward each other, coincide for β = β1, and
become complex for β > β1. The closed-loop system does not become unstable because the poles do not reach the
jω axis.
σ
β
jω
β = β1
β = 0
β = 0
−ωp1
−ωp2
Figure 10.8
▲
The foregoing calculations point to the complexity of the algebra required to construct a root locus for
higher-order systems. For this reason, many root locus techniques have been devised so as to minimize
such computations.
We now study a three-pole system. Shown in Fig. 10.9(a) are the Bode plots of the magnitude and
phase of the loop gain. The third pole gives rise to additional phase shift, possibly moving the phase
crossover to frequencies lower than the gain crossover and leading to oscillation.
Since the third pole also decreases the magnitude of the loop gain at a greater rate, the reader may
wonder why the gain crossover does not move as much as the phase crossover does. As mentioned before,
thephasebeginstochangeatapproximatelyone-tenthofthepolefrequency,whereasthemagnitudebegins
to drop only near the pole frequency. For this reason, additional poles (and zeros) affect the phase to a
much greater extent than they do the magnitude.

416
Chap. 10
Stability and Frequency Compensation
0
0
ωp1
ω0
ω0
ω
ωp2
ωp3
β
1
(a)
(b)
0
0
20log∣βH(ω)∣
20log∣βH(ω)∣
−180°
−270°
−180°
−90°
βH(ω)
βH(ω)
ω (log scale)
ω (log scale)
ω (log scale)
ω (log scale)
Y
X (ω)
Figure 10.9
(a) Bode plots of loop transmission for a three-pole system and (b) closed-loop response.
As with a two-pole system, if the feedback factor in Fig. 10.9 decreases, the circuit becomes more
stable because the gain crossover moves toward the origin while the phase crossover remains constant.
For this reason, a feedback ampliﬁer designed for a higher closed-loop gain tends to be more stable
(why?).
It is important not to confuse the βH plots with the closed-loop frequency response, Y/X. As an
example, consider a system with the loop response shown in Fig. 10.9(b), where the gain and phase
crossover frequencies coincide. The closed-loop response, |Y/X|, exhibits inﬁnite gain at ω0, predicting
oscillation at this frequency.
10.3
Phase Margin
We have seen that to ensure stability, |βH| must drop to unity before ̸ βH crosses −180◦. We may
naturally ask: How far should PX be from GX? Let us ﬁrst consider a “marginal” case where, as depicted
in Fig. 10.10(a), GX is only slightly below PX; for example, at GX, the phase equals −175◦. How does
the closed-loop system respond in this case? Noting that at GX, βH( jω1) = 1 × exp(−j175◦), we have
for the closed-loop system
Y
X ( jω1) =
H( jω1)
1 + βH( jω1)
(10.10)
=
1
β exp(−j175◦)
1 + exp(−j175◦)
(10.11)
= 1
β · −0.9962 −j0.0872
0.0038 −j0.0872
(10.12)

Sec. 10.3
Phase Margin
417
0
GX
PX
1
ω
ω
ω
ω
ω
ω
t
y(t)
y(t)
t
(a)
(b)
PM
GX
PX
PM
∣βH(ω)∣
−180°
βH(ω)
0
1
∣βH(ω)∣
−180°
βH(ω)
Y
X (ω)
Y
X (ω)
β
1
Figure 10.10
Closed-loop frequency and time response for (a) small and (b) large margin between gain and
phase crossover points.
and hence

Y
X ( jω1)
 = 1
β ·
1
0.0872
(10.13)
≈11.5
β
(10.14)
Since at low frequencies, |Y/X| ≈1/β, the closed-loop frequency response exhibits a sharp peak in the
vicinity of ω = ω1. In other words, the closed-loop system is near oscillation, and its step response, y(t),
exhibits a very underdamped behavior. This point also reveals that a second-order system may suffer
from ringing although it is stable.
Now suppose, as shown in Fig. 10.10(b), GX precedes PX by a greater margin. Then, we expect a
relatively “well-behaved” closed-loop response in both the frequency domain and the time domain. It
is therefore plausible to conclude that the greater the spacing between GX and PX (while GX remains
below PX), the more stable the feedback system. Alternatively, the phase of βH at the gain crossover
frequency can serve as a measure of stability: the smaller |̸ βH| at this point, the more stable the system.
This observation leads us to the concept of “phase margin” (PM), deﬁned as PM = 180◦+ ̸ βH(ω =
ω1), where ω1 is the gain crossover frequency. We see that stability calls for a positive and large PM.
▲
Example10.4
A two-pole feedback system is designed such that |βH(ωp2)| = 1 and |ωp1| ≪|ωp2| (Fig. 10.11). How much is
the phase margin?

418
Chap. 10
Stability and Frequency Compensation
0
0
PM
20log∣βH(ω)∣
−135°
−180°
βH(ω)
ω (log scale)
ω (log scale)
ωp1
ωp2
Figure 10.11
Solution
Since ̸ βH reaches −135◦at ω = ωp2, the phase margin is equal to 45◦. The key point to remember is that, if the
loop gain drops to unity at a frequency above the second pole, the phase margin is less than 45◦. As explained below,
since PM = 45◦is typically inadequate, we say that the ultimate unity-gain bandwidth cannot exceed the second
pole of the open-loop op amp if a well-behaved time response is desired.
▲
The above example suggests that for a phase margin greater than 45◦, the gain crossover frequency
must lie between the ﬁrst pole and the second (in the absence of zeros). That is, the unity-gain bandwidth
cannot exceed the second pole frequency.
How much phase margin is adequate? It is instructive to examine the closed-loop frequency response
for different phase margins [1]. For PM = 45◦, at the gain crossover frequency ̸ βH(ω1) = −135◦and
|βH(ω1)| = 1 (Fig. 10.12), yielding
Y
X =
H( jω1)
1 + 1 × exp(−j135◦)
(10.15)
=
H( jω1)
0.29 −0.71 j
(10.16)
0
GX
1
∣βH(ω)∣
−135°
βH(ω)
Y
X (ω)
β
1
β
1.3
ω1
ω
ω
ω
Figure 10.12
Closed-loop frequency
response for 45◦phase margin.

Sec. 10.3
Phase Margin
419
It follows that

Y
X
 = 1
β ·
1
|0.29 −0.71 j|
(10.17)
≈1.3
β .
(10.18)
Consequently, the frequency response of the feedback system suffers from a 30% peak at ω = ω1.
It can be shown that for PM = 60◦, Y( jω1)/X( jω1) = 1/β, suggesting a negligible frequency
peaking. This typically means that the step response of the feedback system exhibits little ringing,
providing a fast settling. For greater phase margins, the system is more stable, but the time response
slows down (Fig. 10.13). Thus, PM = 60◦is typically considered the optimum value.
t
y(t)
t
t
PM = 45°
y(t)
PM = 60°
y(t)
PM = 90°
(c)
(a)
(b)
Figure 10.13
Closed-loop time response for 45◦, 60◦, and 90◦phase margins.
Theconceptofphasemarginiswellsuitedtothedesignofcircuitsthatprocesssmallsignals.Inpractice,
the large-signal step response of feedback ampliﬁers does not follow the illustration of Fig. 10.13. This is
not only due to slewing but also because of the nonlinear behavior resulting from large excursions in the
bias voltages and currents of the ampliﬁer. Such excursions in fact cause the pole and zero frequencies
to vary during the transient, leading to a complicated time response. Thus, for large-signal applications,
time-domain simulations of the closed-loop system prove more relevant and useful than small-signal ac
computations of the open-loop ampliﬁer.
As an example of a feedback circuit exhibiting a reasonable phase margin but poor settling behavior,
consider the unity-gain ampliﬁer of Fig. 10.14, where the aspect ratio of all transistors is equal to 50 μm /
0.6 μm. With the choice of the device dimensions, bias currents, and capacitor values shown here, SPICE
yields a phase margin of approximately 65◦and a unity-gain frequency of 150 MHz. The large-signal
step response, however, suffers from signiﬁcant ringing.
VDD
M4
M1
M2
M3
M5
Vin
1.6 pF
0.5 mA
0.3 mA
Vout
1 pF
t
Vin
Vout
Figure 10.14
Unity-gain buffer.

420
Chap. 10
Stability and Frequency Compensation
10.4
Basic Frequency Compensation
Typical op amp circuits contain many poles. In a folded-cascode topology, for example, both the folding
node and the output node contribute poles. For this reason, op amps must usually be “compensated,” that
is, their open-loop transfer function must be modiﬁed such that the closed-loop circuit is stable and the
time response is well behaved.
The need for compensation arises because |βH| does not drop to unity well before ̸ βH reaches
−180◦. We then postulate that stability can be achieved by (1) minimizing the overall phase shift, thus
pushing the phase crossover out [Fig. 10.15(a)]; or (2) dropping the gain with frequency, thereby pushing
the gain crossover in [Fig. 10.15(b)]. The ﬁrst approach requires that we attempt to minimize the number
of poles in the signal path by proper design. Since each additional stage contributes at least one pole, this
means that the number of stages must be minimized, a remedy that yields low voltage gain and/or limited
output swings (Chapter 9). The second approach, on the other hand, retains the low-frequency gain and
the output swings, but it reduces the bandwidth by forcing the gain to fall at lower frequencies.
logω
0
logω
0
Modiﬁed
Design
Modiﬁed
Design
(a)
(b)
20log∣βH(ω)∣
−180°
βH(ω)
logω
0
logω
0
20log∣βH(ω)∣
−180°
βH(ω)
Figure 10.15
Frequency compensation by (a) moving PX out and (b) pushing GX in.
In practice, we ﬁrst try to design an op amp so as to minimize the number of poles while meeting
other requirements. Since the resulting circuit may still suffer from insufﬁcient phase margin, we then
compensate the op amp, i.e., modify the design so as to move the gain crossover toward the origin.
These efforts proceed with the β value chosen according to the ﬁnal design requirements. For example,
a closed-loop gain of 4 in some cases translates to β ≈0.25 if the loop gain is large.3 In other words, we
need not compensate the circuit for β = 1 if the closed-loop gain is always higher.
Let us apply the above concepts to the telescopic-cascode op amp shown in Fig. 10.16, where a PMOS
current mirror performs differential to single-ended conversion. We identify a number of poles in the
signal paths: path 1 contains a high-frequency pole at the source of M3, a mirror pole at node A, and
another high-frequency pole at the source of M7, whereas path 2 contains a high-frequency pole at the
source of M4. The two paths share a pole at the output.
It is instructive to estimate the relative position of these poles. Since the output resistance of the op
amp is much higher than the small-signal resistances seen at the other nodes in the circuit, we expect
3But in “switched-capacitor” circuits, the closed-loop gain changes from one mode to another (Chapter 13).

Sec. 10.4
Basic Frequency Compensation
421
VDD
M7
M1
M2
ISS
Vin
M6
M5
M3
M4
Vout
X
Vb1
Vb2
CL
A
Y
N
Path 1
Path 2
Figure 10.16
Telescopic op amp with
single-ended output.
that, even with a moderate load capacitance, the output pole, ωp,out, is the closest to the origin. Called
the “dominant pole,” ωp,out usually sets the open-loop 3-dB bandwidth.
We also surmise that the ﬁrst “nondominant pole,” i.e., the closest pole to the origin after the dominant
pole, arises at node A. This is because the total capacitance at this node, roughly equal to CGS5 +CGS6 +
CDB5 + 2CGD6 + CDB3 + CGD3, is typically quite a lot larger than that at nodes X, Y, and N, and the
small-signal resistance of M5, approximately 1/gm5, is also relatively large.
Which node yields the next nondominant pole: N or X (and Y)? Recall from Chapter 9 that, to obtain
a low overdrive and consume a reasonable voltage headroom, the PMOS devices in the op amp are
typically wider than the NMOS transistors. Comparing M4 and M7 and neglecting body effect, we note
that since gm = 2ID/|VGS −VT H|, if the two transistors are designed to have the same overdrive, they also
exhibit the same transconductance. However, from square-law characteristics, we have W4/W7 = μp/μn,
which is about 1/2 to 1/3. Thus, nodes N and X (or Y) see roughly equal small-signal resistances to
ground, but node N suffers from much more capacitance. It is therefore plausible to assume that node N
contributes the next nondominant pole. Figure 10.17 illustrates the results, denoting the capacitance at
nodes A, N, and X by CA, CN, and CX, respectively. The poles at nodes X and Y are nearly equal, and
their corresponding terms in the transfer functions of path 1 and path 2 can be factored out. Thus, they
count as one pole rather than two.
σ
jω
gm5
CA
−
gm7
CN
−
gm3
CX
−
RoutCL
1
−
Figure 10.17
Pole locations for the op amp of Fig. 10.16.
With the position of the poles roughly determined, we can construct the magnitude and phase plots
for βH, using β = 1 for the worst case. Shown in Fig. 10.18, such characteristics indicate that the mirror
pole typically limits the phase margin because its phase contribution occurs at lower frequencies than
that of other nondominant poles.

422
Chap. 10
Stability and Frequency Compensation
0
0
20log∣βH(ω)∣
−360°
−270°
−180°
βH(ω)
ω (log scale)
ω (log scale)
ωp,out
ωp,A
ωp,N
ωp,X
Figure 10.18
Bode plots of loop transmission for op amp of Fig. 10.16.
Recall from Chapter 6 that differential pairs using active current mirrors exhibit a left-half-plane zero
located at twice the mirror pole frequency. The circuit of Fig. 10.16 contains such a zero as well. Located
at 2ωp,A, the zero impacts both the magnitude and phase characteristics. The analysis is left to the reader.
Compensation Procedure
How should we compensate the telescopic-cascode op amp? Recall that
our ultimate goal is to ensure a loop gain sufﬁciently less than unity at the phase crossover frequency. Let
us assume that the number and location of the nondominant poles and hence the phase plot at frequencies
higher than roughly 10ωp,out, remain constant. We begin with the original response shown in Fig. 10.19,
which has a negative phase margin. We must force the loop gain to drop such that the gain crossover point
moves toward the origin. To accomplish this, we simply lower the frequency of the dominant pole, ωp1,
by increasing the load capacitance. The key point is that the phase contribution of the dominant pole in
the vicinity of the gain or phase crossover point is close to 90◦and relatively independent of the location
of the pole. That is, as illustrated in Fig. 10.19, translating the dominant pole toward the origin affects the
magnitude plot, but not the critical part of the phase plot. If ωp1 is lowered sufﬁciently, the PM reaches
an acceptable value, but at the cost of bandwidth.
logω
0
logω
0
Original
Response
PM < 0
PM > 0
20log∣βH(ω)∣
−180°
βH(ω)
ωp1
Figure 10.19
Translating the
dominant pole toward the origin.
In order to determine how much the dominant pole must be shifted down as well as arrive at an
important conclusion, let us assume that (1) the second nondominant pole (ωp,N) in Fig. 10.16 is much
higher than the mirror pole so that the phase shift at ω = ωp,A is equal to −135◦, and (2) a phase

Sec. 10.4
Basic Frequency Compensation
423
margin of 45◦(which is usually inadequate) is necessary. To compensate the circuit, we begin from
̸ βH(ω) = −180◦+ PM = −135◦and identify the corresponding gain crossover frequency, in this
case, ωp,A (Fig. 10.20). Since the dominant pole must drop the gain to unity at ωp,A with a slope of
20 dB/dec, we draw a straight line from ωp,A toward the origin with such a slope, thus obtaining the new
magnitude of the dominant pole, ω′
p,out. Therefore, the load capacitance must be increased by a factor of
ωp,out/ω′
p,out.
0
0
−20 dB/dec
ω'p,out
ωp,out
ωp,A
ω (log scale)
ω (log scale)
20log∣βH(ω)∣
−135°
βH(ω)
Figure 10.20
Translating the dominant pole toward the origin for 45◦phase margin.
From the new magnitude plot, we note that the unity-gain bandwidth of the compensated (open-loop)
op amp is equal to the frequency of the ﬁrst nondominant pole (of course with a phase margin of 45◦).
This is a fundamental result, indicating that to achieve a wide bandwidth in a feedback system employing
a multipole op amp, the ﬁrst nondominant pole must be as far as possible. For this reason, the mirror pole
proves undesirable.
We should also mention that although ωp,out = (RoutCL)−1, increasing Rout does not compensate the
op amp. As shown in Fig. 10.21, a higher Rout results in a greater low-frequency loop gain, only affecting
the low-frequency portion of the characteristics. Also, moving one of the nondominant poles toward the
origin does not improve the phase margin. (Why?)
log ω
0
log ω
0
Rout
ωp,out
20log∣βH(ω)∣
−180°
βH(ω)
Figure 10.21
Bode plots of loop gain
for higher output resistance.
In summary, frequency compensation moves the dominant pole of the open-loop ampliﬁer to sufﬁ-
ciently low values so that the unity-gain bandwidth is well below the phase crossover frequency. Also,
the compensated bandwidth cannot exceed the ﬁrst nondominant pole frequency since a phase margin of
greater than 45◦is typically required.

424
Chap. 10
Stability and Frequency Compensation
▲
Example10.5
An op amp is compensated to have a phase margin of 60◦with unity-gain feedback. By what factor can the compen-
sation be relaxed if the circuit is to operate with a feedback factor of β < 1 [Fig. 10.22(a)]?
log ω
0
log ω
0
C
D
Vin
Vout
Vin
Vout
R1
R2
(a)
(b)
β = 1
β < 1
Uncompensated
Response
−120°
βH(ω)
logω′p1 logω″p1 logωp1
20log∣βH(ω)∣
20logA0
20log(βA0)
Figure 10.22
Solution
As illustrated in Fig. 10.22(b), the original compensation identiﬁes the frequency at which ̸ βH = −120◦, draws a
line from this frequency at a slope of 20 dB/dec toward the vertical axis, and hence moves the dominant pole from
ωp1 to ω′
p1. With a feedback factor of β, the uncompensated magnitude response is shifted down by −20 log β,
requiring a dominant pole at ω′′
p1. To obtain this value, we equate the slope of the line C D to 20 dB/dec:
−20 log β
log ω′′
p1 −log ω′
p1
= 20
(10.19)
and hence ω′′
p1 = ω′
p1/β. That is, the compensation capacitor can be reduced by approximately a factor of 1/β. This,
of course, does not mean that the new feedback circuit settles faster; the weaker feedback translates to a proportionally
smaller extension of the bandwidth. In fact, we can write the closed-loop −3-dB bandwidths as (1+A0)ω′
p1 ≈A0ω′
p1
for the original op amp and (1+β A0)ω′′
p1 ≈β A0ω′′
p1 ≈A0ω′
p1 for the newly-compensated counterpart, concluding
that the closed-loop speed remains roughly the same.
A related question that we address in Problem 10.23 is the following: If an op amp is compensated to have
PM = 60◦with unity-gain feedback, by how much does its PM increase if the feedback factor is reduced
to β < 1?
▲
Now consider the fully differential telescopic cascode depicted in Fig. 10.23. In addition to achieving
various useful properties of differential operation, this topology avoids the mirror pole, thereby exhibiting
stable behavior for a greater bandwidth. In fact, we can identify one dominant pole at each output node and
only one nondominant pole arising from node X (or Y). This suggests that fully differential telescopic-
cascode circuits are stable and do not need compensation.
But how about the pole at node N (or K) in Fig. 10.23? Considering one of the PMOS cascodes as
showninFig.10.24(a),wemaythinkthatthecapacitanceatnode N,CN = CGS5 + CSB5 + CGD7 + CDB7,
shunts the output resistance of M7 at high frequencies, thereby dropping the output impedance of the
cascode. To quantify this effect, we ﬁrst determine Zout in Fig. 10.24(a):
Zout = (1 + gm5rO5)Z N + rO5
(10.20)

Sec. 10.4
Basic Frequency Compensation
425
VDD
M5
M1
M2
ISS
Vin
M8
Vb1
M3
M4
Vout
M7
M6
Vb2
Vb3
X
Y
N
K
Figure 10.23
Fully differential
telescopic op amp.
Vb2
Vb3
N
Zout
VDD
M5
M7
CN
Vb2
Vb3
N
Zout
VDD
M5
M7
CN
CL
CLs
1
(a)
(b)
Figure 10.24
Effect of device capacitance at internal node of a cascode current source.
where body effect is neglected and Z N = rO7||(CNs)−1. Assuming the ﬁrst term is much greater than
the second, we have
Zout ≈(1 + gm5rO5)
rO7
rO7CNs + 1
(10.21)
Now, as illustrated in Fig. 10.24(b), we take the output load capacitance into account:
Zout|| 1
CLs =
(1 + gm5rO5)
rO7
rO7CNs + 1 ·
1
CLs
(1 + gm5rO5)
rO7
rO7CNs + 1 +
1
CLs
(10.22)
=
(1 + gm5rO5)rO7
[(1 + gm5rO5)rO7CL + rO7CN]s + 1
(10.23)
Thus, the parallel combination of Zout and the load capacitance still contains a single pole corresponding
to a time constant (1 + gm5rO5)rO7CL + rO7CN. Note that (1 + gm5rO5)rO7CL is simply due to the low-
frequency output resistance of the cascode. In other words, the overall time constant equals the “output”
time constant plus rO7CN. The key point in this calculation is that the pole in the PMOS cascode (at node
N) is merged with the output pole, thus creating no additional pole. It merely lowers the dominant pole

426
Chap. 10
Stability and Frequency Compensation
by a slight amount. For this reason, we loosely say that the signal does not “see” the pole in the cascode
current sources.4
Comparison of the circuits shown in Figs. 10.16 and 10.23 now reveals that the fully differential
conﬁguration avoids both the mirror pole and the pole at node N. With the approximation made in (10.23),
the circuit of Fig. 10.23 contains only one nondominant pole located at relatively high frequencies owing
to the high transconductance of the NMOS transistors. This is a remarkable advantage of fully differential
cascode op amps.
We have thus far observed that nondominant poles give rise to instability, requiring frequency com-
pensation. Is it possible to cancel one or more of these poles by introducing zeros in the transfer function?
For example, following the analysis of Fig. 6.41, we surmise that if a low-gain but fast path is placed in
parallel with the main ampliﬁer, a zero is created that can be positioned atop the ﬁrst nondominant pole.
However, cancellation of a pole by a zero in the presence of mismatches leads to long settling components
in the step response of the closed-loop circuit. This effect is studied in Problem 10.19.
10.5
Compensation of Two-Stage Op Amps
Our study of op amps in Chapter 9 indicates that two-stage topologies may prove inevitable if the output
voltage swing must be maximized. This is especially true in today’s low-voltage op amps. Thus, the
stability and compensation of such op amps is of interest.
Consider the circuit shown in Fig. 10.25. We identify three poles: a pole at X (or Y), another at E (or
F), and a third at A (or B). From our foregoing discussions, we know that the pole at X lies at relatively
high frequencies. But how about the other two? Since node E exhibits a high small-signal resistance,
even the capacitances of M3, M5, and M9 can create a pole relatively close to the origin. At node A, the
small-signal resistance is lower, but CL may be large. Consequently, we say that the circuit contains two
dominant poles.
VDD
M8
M1
M2
ISS
M6
M5
M3
M4
Vout2
X
CL
Y
E
F
M7
M10
M12
M9
M11
A
Vin
B
CL
Vout1
Figure 10.25
Two-stage op amp.
From these observations, we can construct the magnitude and phase plots shown in Fig. 10.26. Here,
ωp,E is assumed more dominant, but the relative positions of ωp,E and ωp,A depend on the design and
the load capacitance. Note that, since the poles at E and A are relatively close to the origin, the phase
4If the second term in Eq. (10.20) is included in subsequent derivations, a pole and a zero that are nearly equal appear in the
overall output impedance. Nonetheless, for gmrO ≫1 and CL > CN, their effect is negligible.

Sec. 10.5
Compensation of Two-Stage Op Amps
427
0
0
−180°
−270°
βH(ω)
ω (log scale)
ω (log scale)
ωp,E
ωp,A
ωp,X
20log∣βH(ω)∣
Figure 10.26
Bode plots of loop gain
of two-stage op amp.
approaches −180◦well below the third pole. In other words, the phase margin may be close to zero even
before the third pole contributes signiﬁcant phase shift.
Let us now investigate the frequency compensation of two-stage op amps. In Fig. 10.26, one of
the dominant poles must be moved toward the origin so as to place the gain crossover well below the
phase crossover. However, recall from Sec. 10.4 that the unity-gain bandwidth after compensation cannot
exceed the frequency of the second pole of the open-loop system for PM > 45◦. Thus, if in Fig. 10.26
the magnitude of ωp,E is to be reduced, the available bandwidth is limited to approximately ωp,A, a low
value. Furthermore, the very small magnitude of the new dominant pole translates to a large compensation
capacitor.
Fortunately, a more efﬁcient method of compensation can be applied to the circuit of Fig. 10.25.
To arrive at this method, we note that, as illustrated in Fig. 10.27(a), the ﬁrst stage exhibits a high
output impedance, Rout1, and the second stage provides a moderate gain, Av2, thereby creating a suitable
environment for Miller multiplication of capacitors. Shown in Fig. 10.27(b), the idea is to create a large
capacitanceatnode E,equalto(1+Av2)CC,movingthecorrespondingpoleto R−1
out1[CE+(1+Av2)CC]−1,
where CE denotes the capacitance at node E before CC is added. As a result, a low-frequency pole can
be established with a moderate capacitor value, saving considerable chip area. This technique is called
“Miller compensation.”
Rout1
Av1
Av2
Av1
Av2
CC
(a)
(b)
E
A
E
A
Figure 10.27
Miller compensation of a two-stage op amp.
In addition to lowering the required capacitor value, Miller compensation entails a very important
property: it moves the output pole away from the origin. Illustrated in Fig. 10.28, this effect is called
“pole splitting.” To understand the underlying principle, we simplify the output stage of Fig. 10.25 as
in Fig. 10.29, where RS denotes the output resistance of the ﬁrst stage and RL = rO9||rO11. From our

428
Chap. 10
Stability and Frequency Compensation
σ
jω
σ
jω
Before
Compensation 
After
Compensation
Figure 10.28
Pole splitting as a result of Miller compensation.
M9
CE
CC
CL
Vin
RS
VDD
Vout
RL
M9
CE
CL
RS
VDD
Vout
RL
(a)
(b)
Figure 10.29
(a) Simpliﬁed circuit of a two-stage op amp, and (b) a rough model at high frequencies.
analysis in Chapter 6, we note that this compensated circuit contains two poles:
ω′
p1 ≈
1
RS[(1 + gm9RL)(CC + CGD9) + CE] + RL(CC + CGD9 + CL)
(10.24)
ω′
p2 ≈RS[(1 + gm9RL)(CC + CGD9) + CE] + RL(CC + CGD9 + CL)
RS RL[(CC + CGD9)CE + (CC + CGD9)CL + CECL)]
(10.25)
These expressions are based on the assumption that |ω′
p1| ≪|ω′
p2|. Before compensation, however, ωp1
and ωp2 are of the same order of magnitude. For CC = 0 and relatively large CL, we may approximate
the magnitude of the output pole as ωp2 ≈1/(RLCL).
To compare the magnitudes of ω′
p2 before and after compensation, we consider a typical case: CC +
CGD9 ≫CE, reducing (10.25) to ω′
p2 ≈gm9/(CE + CL). Noting that typically CE ≪CL, we conclude
that Miller compensation increases the magnitude of the output pole by roughly a factor of gm9RL,
a relatively large value. Intuitively, this is because at high frequencies, CC provides a low impedance
between the gate and drain of M9, reducing the resistance seen by CL from RL to roughly RS||g−1
m9||RL ≈
g−1
m9 [Fig. 10.29(b)]. From another perspective, CC provides feedback around the second stage by sensing
the output voltage; as a result, the output resistance falls and the second pole moves to higher frequencies.5
In summary, Miller compensation moves the interstage pole toward the origin and the output pole
away from the origin, allowing a much greater bandwidth than that obtained by merely connecting the
compensation capacitor from one node to ground. In practice, the choice of the compensation capacitor
for proper phase margin requires some iteration because both poles move. The following example gives
a rough estimate.
▲
Example10.6
The two-stage op amp of Fig. 10.25 incorporates Miller compensation to reach a phase margin of 45◦. Estimate the
compensation capacitor value.
5This capacitor returns a current to the input of the second stage, thus lowering its input impedance as well.

Sec. 10.5
Compensation of Two-Stage Op Amps
429
Solution
After frequency compensation, the dominant pole moves down to approximately (gm9RLCC RS)−1, where RS
denotes the output resistance of the ﬁrst stage, and the second pole moves up to roughly gm9/CL. For a phase margin
of 45◦, the loop gain must drop to unity at the second pole. With a low-frequency loop gain of βgm1RSgm9RL, we
consider the postcompensation plot in Fig. 10.30 (on linear axes) and write
|βH(ω)| ≈βgm1RSgm9RL

1 + ω2/ω,2
p1
(10.26)
where the effect of ω′
p2 on the magnitude is neglected. At ω = ω′
p2, the second term under the square root dominates,
and
βgm1RSgm9RL
ω′
p2/ω′
p1
= 1
(10.27)
ω
βgm1RSgm2RL
1
ω′p1
ω′p2
∣βH(ω)∣
Figure 10.30
Substituting for the pole frequencies and assuming that β = 1, we obtain
CC = gm1
gm9
CL
(10.28)
Note that gm1 and gm9 are the transconductances of the two stages. The reader can prove that, if the effect of ω′
p2 is
included, then CC = [gm1/(
√
2gm9)]CL. Of course, CC must generally be greater than this value so as to establish
a higher phase margin, but this estimate serves as a reasonable starting point in the design.
This result assumes that β = 1; in practice, most op amps are conﬁgured for a closed-loop gain of 2 or higher,
thus requiring a smaller CC.
▲
Ourstudyofstabilityandcompensationhasthusfarneglectedtheeffectofzerosofthetransferfunction.
While in cascode topologies, the zeros are far from the origin, in two-stage op amps incorporating
Miller compensation, a nearby zero appears in the circuit. Recall from Chapter 6 that the circuit of
Fig. 10.29 contains a right-half-plane zero at ωz = gm9/(CC + CGD9). This is because CC + CGD9 forms
a “feedforward” signal path from the input to the output. What is the effect of such a zero? The numerator
of the transfer function reads (1 −s/ωz), yielding a phase of −tan−1(ω/ωz), a negative value because
ωz is positive. In other words, as with poles in the left half plane, a zero in the right half plane contributes
additional negative phase shift, thus moving the phase crossover toward the origin. Furthermore, from
Bode approximations, the zero slows down the drop of the magnitude, thereby pushing the gain crossover
away from the origin. As a result, the stability degrades considerably.
To better understand the foregoing discussion, let us construct the Bode plots for a third-order system
containing a dominant pole ωp1, two nondominant poles ωp2 and ωp3, and a zero in the right half plane
ωz. For two-stage op amps, typically |ωp1| < |ωz| < |ωp2|. As shown in Fig. 10.31, the zero introduces
signiﬁcant phase shift while preventing the gain from falling sufﬁciently.

430
Chap. 10
Stability and Frequency Compensation
0
0
−180°
−270°
βH(ω)
ω (log scale)
ω (log scale)
ωp1
ωp2
ωp3
ωz
20log∣βH(ω)∣
Figure 10.31
Effect of right-half-plane zero.
▲
Example10.7
Noting that the Miller compensation in Fig. 10.29(a) yields ωp2 ≈gm9/CL and ωz ≈gm9/CC, a student decides to
choose CC = CL, aiming to cancel the second pole by the zero. Explain what happens.
Solution
Recall that the zero is located in the right half plane and the poles in the left half plane. The compensated loop
transmission can therefore be expressed as
βH(s) =
β A0(1 −s
ωz
)
(1 +
s
ωp1
)(1 +
s
ωp2
)
(10.29)
We recognize that the zero does not cancel the pole and still affects |βH| and ̸ βH.
▲
The right-half-plane zero in two-stage CMOS op amps, given by gm/(CC + CGD), is a serious issue
because gm is relatively small and CC is chosen large enough to position the dominant pole properly.
Various techniques for eliminating or moving the zero have been invented. Illustrated in Fig. 10.32,
places a resistor in series with the compensation capacitor, thereby modifying the zero frequency. The
output stage now exhibits three poles, but for moderate values of Rz, the third pole is located at high
frequencies and the ﬁrst two poles are close to the values calculated with Rz = 0. Moreover, it can be
M9
CE
CL
Vin
RS
VDD
RL
CC
Rz
Vout
Figure 10.32
Addition of Rz to move
the right-half-plane zero.

Sec. 10.5
Compensation of Two-Stage Op Amps
431
shown (Problem 10.8) that the zero frequency is given by
ωz ≈
1
CC

g−1
m9 −Rz

(10.30)
Thus, if Rz ≥g−1
m9, then ωz ≤0. While Rz = g−1
m9 seems a natural choice, in practice we may even move
the zero well into the left half plane so as to cancel the ﬁrst nondominant pole. This occurs if
1
CC

g−1
m9 −Rz
 =
−gm9
CL + CE
(10.31)
that is
Rz = CL + CE + CC
gm9CC
(10.32)
≈CL + CC
gm9CC
(10.33)
because CE is typically much less than CL + CC.
The possibility of canceling the nondominant pole makes this technique attractive, but in reality
two important drawbacks must be considered. First, it is difﬁcult to guarantee the relationship given
by (10.33), especially if CL is unknown or variable. Mismatch between the pole and zero frequencies
leads to the “doublet problem” (Problem 10.19). For example, as explained in Chapter 13, the load
capacitance seen by an op amp may vary from one part of the period to another in switched-capacitor
circuits, necessitating a corresponding change in Rz and complicating the design. The second drawback
relates to the actual implementation of Rz. Typically realized by a MOS transistor in the triode region
(Fig. 10.33), Rz changes substantially as output voltage excursions are coupled through CC to node X,
thereby degrading the large-signal settling response.
M9
CE
VDD
CC
Rz
Vb
X
Figure 10.33
Effect of large output
swings on Rz.
Generating Vb in Fig. 10.33 is not straightforward because RZ must remain equal to (1+CL/CC)/gm9
despite process and temperature variations. A common approach is illustrated in Fig. 10.34 [2], where
diode-connected devices M13 and M14 are placed in series. If I1 is chosen with respect to ID9 such
that VGS13 = VGS9, then VGS15 = VGS14. Since gm14 = μpCox(W/L)14(VGS14 −VT H14) and Ron15 =
[μpCox(W/L)15(VGS15 −VT H15)]−1, we have Ron15 = g−1
m14(W/L)14/(W/L)15. For pole-zero cancella-
tion to occur,
g−1
m14
(W/L)14
(W/L)15
= g−1
m9

1 + CL
CC

(10.34)

432
Chap. 10
Stability and Frequency Compensation
M9
CE
VDD
CC
RZ
Vb
CL
M13
M14
I1
M15
Vb2
M11
Figure 10.34
Generation of Vb for
proper temperature and process tracking.
and hence
(W/L)15 =

(W/L)14(W/L)9
	
ID9
ID14
CC
CC + CL
(10.35)
If CL is constant, (10.35) can be established with reasonable accuracy because it contains only the ratio
of quantities.
Another method of guaranteeing Eq. (10.33) is to use a simple resistor for RZ and deﬁne gm9 with
respect to a resistor that closely matches RZ [3]. Depicted in Fig. 10.35, this technique incorporates
Mb1–Mb4 along with RS to generate Ib ∝R−2
S . (This circuit is studied in detail in Chapter 12.) Thus,
gm9 ∝√ID9 ∝√ID11 ∝R−1
S . Proper ratioing of RZ and RS therefore ensures that (10.33) is valid even
with temperature and process variations.
Mb1
VDD
Ib
Mb2
Mb4
Mb3
M9
CE
CC
CL
M11
RZ
RS
Figure 10.35
Method of deﬁning gm9
with respect to RS.
The principal drawback of the two methods described above is that they assume square-law charac-
teristics for all of the transistors. As described in Chapter 17, short-channel MOSFETs may substantially
deviate from the square-law regime, creating errors in the foregoing calculations. In particular, tran-
sistor M9 is typically a short-channel device because it appears in the signal path and its raw speed
is critical.
An attribute of two-stage op amps that makes them inferior to “one-stage” op amps is the susceptibility
to the load capacitance. Since Miller compensation establishes the dominant pole at the output of the ﬁrst
stage, a higher load capacitance presented to the second stage moves the second pole toward the origin,
degrading the phase margin. By contrast, in one-stage op amps, a higher load capacitance brings the
dominant pole closer to the origin, improving the phase margin (albeit making the feedback system more
overdamped). Illustrated in Fig. 10.36 is the step response of a unity-gain feedback ampliﬁer employing
a one-stage or a two-stage op amp, suggesting that the response approaches an oscillatory behavior if the
load capacitance seen by the two-stage op amp increases.

Sec. 10.6
Slewing in Two-Stage Op Amps
433
CC
Vout
Vin
Vin
CL
CL
Vout
t
t
Larger CL 
Larger CL 
Figure 10.36
Effect of increased load capacitance on step response of one- and two-stage op amps.
10.6
Slewing in Two-Stage Op Amps
It is instructive to study the slewing characteristics of two-stage op amps. Before delving into the details,
let us consider the simple circuit shown in Fig. 10.37(a), where Iin is a current step given by ISSu(t) and
CF has a zero initial condition. If A is large, node X is a virtual ground and the voltage across CF is
approximately equal to Vout. Receiving a constant current equal to ISS, CF generates an output voltage
given by
Vout(t) ≈ISS
CF
t
(10.36)
A
−
CF
Iin
Vout
Vout
Mout
CF
Iin
I1
VDD
rO
X
X
t
0
gm + rO−1
−ISS
ISS
gmrO
CF(1 +
1
(c)
(a)
(b)
Vout(t)
Figure 10.37
(a) Simpliﬁed circuit for slew study, (b) realization of (a), and (c) output waveform during slewing.
We now consider the implementation depicted in Fig. 10.37(b)6 and write Vout/rO + gmVX + Iin = I1
and CFd(Vout −VX)/dt = Iin. Substituting for VX from the former equation in the latter, we have
CF

1 +
1
gmrO
 dVout
dt
= Iin −CF
gm
dIin
dt
(10.37)
6The bias network for Mout is not shown.

434
Chap. 10
Stability and Frequency Compensation
We consider the terms on the right-hand side as two inputs and apply superposition, obtaining
Vout(t) =
ISS
CF(1 +
1
gmrO
)
tu(t) −
ISS
gm + 1
rO
u(t)
(10.38)
(This voltage, of course, rides on top of a bias value.) As illustrated in Fig. 10.37(c), Vout initially jumps to
−ISS/(gm +r−1
O ) and subsequently ramps up with a slope equal to ISS/[CF(1+g−1
m r−1
O )]. It is interesting
to note that (1) at t = 0+, CF acts as a short circuit, allowing Iin to ﬂow through (1/gm)||rO and
creating a downward step at the output; (2) the slope of the ramp suggests an equivalent capacitance of
CF(1 + g−1
m r−1
O ), revealing the Miller effect of CF at the output; and (3) Eq. (10.38) does not depend on
I1 because this current simply serves as the bias current of Mout. We approximate the output voltage as
Vout(t) ≈(ISS/CF)tu(t).
Let us return to a two-stage op amp and suppose that in Fig. 10.38(a), Vin experiences a large positive
step at t = 0, turning off M2, M4, and M3. The circuit can then be simpliﬁed to that in Fig. 10.38(b),
revealing that CC is charged by a constant current ISS if parasitic capacitances at node X are negligible.
Recognizing that the gain of the output stage makes node X a virtual ground, we write Vout(t) ≈
(ISSt/CC)u(t). Thus, the positive slew rate7 equals ISS/CC. Note that during slewing, M5 must provide
two currents: ISS and I1. If M5 is not wide enough to sustain ISS + I1 in saturation, then VX drops
signiﬁcantly, possibly driving M1 into the triode region.
CC
Vin
Vout
VDD
M4
M1
M2
M3
M5
Vin
Vout
CC
ISS
I1
VDD
Vout
CC
I1
M5
M3
ISS
(a)
(c)
X
VDD
M5
Vout
CC
I1
M1
Vin
ISS
X
(b)
ISS + I1
Figure 10.38
(a) Simple two-stage op amp, (b) simpliﬁed circuit during positive slewing, and (c) simpliﬁed
circuit during negative slewing.
For the negative slew rate, we simplify the circuit as shown in Fig. 10.38(c). Here I1 must support
both ISS and ID5. For example, if I1 = ISS, then VX rises so as to turn off M5. If I1 < ISS, then M3 enters
the triode region and the slew rate is given by ID3/CC.
7The term “positive” refers to the slope of the waveform at the output of the op amp.

Sec. 10.6
Slewing in Two-Stage Op Amps
435
▲
Example10.8
Op amps typically drive a heavy load capacitance. Repeat the slew rate analysis if the circuit of Fig. 10.37(b) sees a
load capacitance of CL. For simplicity, neglect channel-length modulation.
Solution
We consider two cases: Iin ﬂows into or out of node X. With λ = 0, the steady-state gain from VX to Vout is
inﬁnite, forcing X to be a virtual ground node. In the ﬁrst case [Fig. 10.39(a)], Iin = ISSu(t) ﬂows through CF,
generating a ramp voltage across it. Since VX is constant, the voltage at the right terminal of CF, Vout, must fall at
a rate of ISS/CF. This also means that CL is discharged at the same rate, requiring that the transistor draw three
currents: I1, ISS, and CLdVout/dt = (CL/CF)ISS. Thus, so long as Mout remains in saturation, the output slew
rate is approximately equal to ISS/CF.
Mout
CF
Vout
I1
VDD
CF
I1
VDD
X
ISSu(t)
ISSu(t)
ISSu(t)
CL
Mout
Vout
CL
CF
I1
VDD
Vout
CL
X
X
I1 − ISS
(c)
(a)
(b)
Figure 10.39
Now, let us study the second case [Fig. 10.39(b)]. If X is a virtual ground, Vout must rise at a rate of ISS/CF,
and CL must also receive a current of CLdVout/dt = (CL/CF)ISS. We observe that, if I1 > ISS(CL/CF) + ISS,
then Mout remains on, VX varies little, and the output slew rate is equal to ISS/CF. On the other hand, if I1 <
(1 + CL/CF)ISS, Mout turns off, the difference between I1 and ISS charges CL [Fig. 10.39(c)], and the slew rate is
given by (I1 −ISS)/CL, a low value.
▲
Two-Stage Class-AB Op Amps
The two-stage class-AB op amp studied in Chapter 9 can incorporate
Miller compensation as well. Recall, however, that the current mirrors in the signal path contribute an
additional pole, degrading the phase margin. For this reason, two-stage class-AB op amps are typically
slower than their class-A counterparts.
We wish to compute the slew rate of two-stage class-AB op amps. Let us redraw the circuit of
Fig. 10.39(b) for this op amp topology (Fig. 10.40). In this case, too, the slew rate is equal to (I1−ISS)/CL
if Mout turns off, but, by virtue of class-AB operation, I1 itself can be quite large. The current mirror
action yields I1 = (Wp1/Wp2)αIin and hence a slew rate of [α(Wp1/Wp2) −1]ISS/CL.
Mout
CF
Vout
X
CL
Iin = ISSu(t)
VDD
αIin
Mp1
Mp2
I1
Figure 10.40
Simpliﬁed class-AB op
amp.

436
Chap. 10
Stability and Frequency Compensation
10.7
Other Compensation Techniques
The difﬁculty in compensating two-stage CMOS op amps arises from the feedforward path formed by the
compensation capacitor [Fig. 10.41(a)]. If CC could conduct current from the output node to node X but
not vice versa, then the zero would move to a very high frequency. As shown in Fig. 10.41(b), this can be
accomplished by inserting a source follower in series with the capacitor. Since the gate-source capacitance
of M2 is typically much less than CC, we expect the right-half-plane zero to occur at high frequencies.
Assuming that γ = λ = 0 for the source follower, neglecting some of the device capacitances, and
simplifying the circuit as shown in Fig. 10.42, we can write −gm1V1 = Vout(R−1
L + CLs), and hence
V1 = −Vout
gm1RL
(1 + RLCLs)
(10.39)
M1
M1
I1
CC
VDD
X
I1
VDD
X
I2
Vout
Vout
(a)
(b)
M2
CC
Figure 10.41
(a) Two-stage op amp with right-half-plane zero due to CC; (b) addition of a source follower to
remove the zero.
M1
X
gm2
1
CC
Iin
RS
V1
CL
RL
Vout
+1
Figure 10.42
Simpliﬁed equivalent
circuit of Fig. 10.41(b).
We also have
Vout −V1
1
gm2
+
1
CCs
+ Iin = V1
RS
(10.40)
Substituting for V1 from (10.39) yields
Vout
Iin
=
−gm1RL RS(gm2 + CCs)
RLCLCC(1 + gm2RS)s2 + [(1 + gm1gm2RL RS)CC + gm2RLCL]s + gm2
(10.41)
Thus, the circuit contains a zero in the left half plane, which can be chosen to cancel one of the poles.
The zero can also be derived as illustrated in Fig. 6.18.

Sec. 10.7
Other Compensation Techniques
437
We can also compute the magnitudes of the two poles, assuming that they are widely separated. Since
typically 1 + gm2RS ≫1 and (1 + gm1gm2RL RS)CC ≫gm2RLCL, we have
ωp1 ≈
gm2
gm1gm2RL RSCC
(10.42)
≈
1
gm1RL RSCC
(10.43)
and
ωp2 ≈gm1gm2RL RSCC
RLCLCCgm2RS
(10.44)
≈gm1
CL
(10.45)
Thus, the new values of ωp1 and ωp2 are similar to those obtained by simple Miller approximation. For
example, the output pole has moved from (RLCL)−1 to gm1/CL.
The primary issue in the circuit of Fig. 10.41(b) is that the source follower limits the lower end of
the output voltage to VGS2 + VI2, where VI2 is the voltage required across I2. For this reason, it is
desirable to utilize the compensation capacitor to isolate the dc levels in the active feedback stage from
that at the output. Such a topology is depicted in Fig. 10.43, where CC and the common-gate stage M2
convert the output voltage swing to a current, returning the result to the gate of M1 [4]. If V1 changes
by V and Vout by AvV , then the current through the capacitor is nearly equal to AvVCCs because
1/gm2 can be relatively small. Thus, a change V at the gate of M1 creates a current change of AvVCCs,
providing a capacitor multiplication factor equal to Av.
Assuming that λ = γ = 0 for the common-gate stage, we redraw the circuit of Fig. 10.43 in Fig. 10.44,
where we have
Vout + gm2V2
CCs
= −V2
(10.46)
M1
X
V1
I1
CC
VDD
I3
I2
Vb
M2
Vout
RS
First Stage
Figure 10.43
Compensation technique
using a common-gate stage.
Iin
RS
M1
X
V1
CL
RL
Vout
CC
gm2V2
V2
Figure 10.44
Simpliﬁed equivalent
circuit of Fig. 10.43.

438
Chap. 10
Stability and Frequency Compensation
and hence
V2 = −Vout
CCs
CCs + gm2
(10.47)
Also,
gm1V1 + Vout
 1
RL
+ CLs

= gm2V2
(10.48)
and Iin = V1/RS + gm2V2. Solving these equations, we obtain
Vout
Iin
=
−gm1RS RL(gm2 + CCs)
RLCLCCs2 + [(1 + gm1RS)gm2RLCC + CC + gm2RLCL]s + gm2
(10.49)
As with the circuit of Fig. 10.41(b), this topology contains a zero in the left half plane. Using similar
approximations, we compute the poles as
ωp1 ≈
1
gm1RL RSCC
(10.50)
ωp2 ≈gm2Rsgm1
CL
(10.51)
Interestingly, the second pole has considerably risen in magnitude — by a factor of gm2RS with respect
to that of the circuit of Fig. 10.41. This is because at very high frequencies, the feedback loop consisting
of M2 and RS in Fig. 10.43 lowers the output resistance by the same factor. Of course, if the capacitance
at the gate of M1 is taken into account, pole splitting is less pronounced. Nevertheless, this technique can
potentially provide a high bandwidth in two-stage op amps.
The op amp of Fig. 10.43 entails important slewing issues. For positive slewing at the output, the
simpliﬁed circuit of Fig. 10.45(a) suggests that M2 and hence I1 must support ISS, requiring that I1 ≥
ISS + ID1. If I1 is less, then VP drops, turning M1 off, and if I1 < ISS, M0 and its tail current source must
enter the triode region, yielding a slew rate equal to I1/CC.
M1
X
I1
CC
VDD
I3
I2
I2
Vb M2
M1
Vb M2
Vout
I1
CC
VDD
I3
Vout
M0
ISS
ISS
P
ISS
X
P
M00
(a)
(b)
I3 = I2 = I1
I3 = I2 = I1
Figure 10.45
Circuit of Fig. 10.43 during (a) positive and (b) negative slewing.
For negative slewing, I2 must support both ISS and ID2 [Fig. 10.45(b)]. As ISS ﬂows into node P, VP
tends to rise, increasing ID1. Thus, M1 absorbs the current produced by I3 through CC, turning off M2
and opposing the increase in VP. We can therefore consider P a virtual ground node. This means that,

Sec. 10.8
Nyquist’s Stability Criterion
439
for equal positive and negative slew rates, I3 (and hence I2) must be as large as ISS, raising the power
dissipation.
Op amps using a cascode topology as their ﬁrst stage can incorporate a variant of the technique
illustrated in Fig. 10.43. Shown in Fig. 10.46(a), this approach places the compensation capacitor between
the source of the cascode devices and the output nodes. Using the simpliﬁed model of Fig. 10.46(b) and
the method of Fig. 6.18, the reader can prove that the zero appears at (gm4Req)(gm9/CC), a much greater
magnitude than gm9/CC. If other capacitances are neglected, it can also be proved that the dominant
pole is located at approximately (Reqgm9RLCC)−1, as if CC were connected to the gate of M9 rather the
source of M4. The ﬁrst nondominant pole is given by gm4gm9Req/CL, an effect similar to that described
by Eq. (10.51). In reality, the capacitance at X may create a signiﬁcant pole because the resistance seen
at this node is quite large. The analysis of the slew rate is left as an exercise for the reader. (One can also
insert a resistor in series with each CC to move the zero frequency.)
It is possible to combine two compensation techniques. As shown in Fig. 10.46(a), both CC and C′
C
provide greater ﬂexibility in the design.
VDD
M8
M1
M2
ISS
M6
M5
M3
M4
Vout2
X
CL
Y
M7
M9
M10
Vin
CL
Vout1
CC
CC
M4
X
M9
CC
CL
RL
Vout
Req
Iin
(a)
(b)
C′C
C′C
Figure 10.46
(a) Alternative method of compensating two-stage op amps; (b) simpliﬁed equivalent circuit of (a).
10.8
Nyquist’s Stability Criterion8
10.8.1 Motivation
Our analysis of stability in negative-feedback systems has drawn upon Bode’s view of the loop transmis-
sion, namely, the magnitude and phase plots as a function of frequency, but only for s = jω. To understand
the shortcomings of this approach, let us consider the loop transmission plots shown in Fig. 10.47, where
β = 1 and |H| is equal to 3 at the phase crossover frequency, ω0. Our previous studies suggest that such a
feedback system is unstable because it has a negative phase margin. However, if we write the closed-loop
transfer function as Y/X = H(s)/[1 + H(s)] and assume that s = jω0, then we have
Y
X ( jω0) =
−3
1 −3
(10.52)
= 3
2
(10.53)
8This section can be skipped in a ﬁrst reading.

440
Chap. 10
Stability and Frequency Compensation
log ω
log ω
0
1
3
θ
X(s)
Y(s)
H(s)
−180°
ω0
ωu
∣H(ω)∣
(log scale)
H(ω)
Figure 10.47
Unstable system Bode plots.
Since the closed-loop gain is less than inﬁnity at ω0, the circuit cannot oscillate at this frequency. In fact,
for no value of s = jω in Fig. 10.47 can we ﬁnd the condition Y/X = ∞. For example, at ωu, we have
Y/X = exp( jθ)/[1 + exp( jθ)] < ∞if θ ̸= x × 180◦.
Should we conclude that this system does not oscillate?! This difﬁculty arises because Bode plots
conﬁne s to imaginary values, i.e., they predict the behavior with only simple sinusoids. Indeed, this
study shows that no simple sinusoid can circulate around the loop indeﬁnitely. This, however, does not
preclude other unstable waveforms. For example, suppose s is equal to σ1+ jω1 with σ1 > 0, representing
a growing sinusoid. It is possible that in the system of Fig. 10.47, H(s = σ1 + jω1) = −1; that is, Y/X
goes to inﬁnity for a growing sinusoid, allowing such a waveform to survive. Whether or not s = σ1+ jω1
exists is predicted by Nyquist’s theorem but not by Bode plots.
We can exploit Nyquist’s stability analysis, for it provides greater insight and, more important, tackles
complex circuits more clearly. For a loop transmission βH(s), this analysis predicts how many zeros
1+βH(s) has in the right half plane (RHP) or on the jω axis. If it has none, then the closed-loop system
is stable.
Nyquist’s method, however, is less intuitive and demands additional background in complex number
theory. The reader should study this section patiently. We remind the reader that the poles and zeros of a
transfer function can be shown on the complex s plane (Fig. 10.48).
σ
jω
Figure 10.48
The s plane with poles
and zeros.
10.8.2 Basic Concepts
Bode’s approach to stability analysis plots the magnitude and phase of the loop gain versus frequency in
Cartesian coordinates. We can also plot these two parameters in polar coordinates, in which every point
is deﬁned by an angle, θ, and a radius, r, rather than by x and y [Fig. 10.49(a)]. As the frequency varies,
so do ̸ H and |H|, creating a “contour” in these coordinates [Fig. 10.49(b)]. The horizontal and vertical
axes in Fig. 10.49(a) also carry a meaning: the projections of the vector on the two are expressed as

Sec. 10.8
Nyquist’s Stability Criterion
441
P
r = ∣H∣
(a)
(b)
H Contour
Im{H}
Re{H}
Im{H}
Re{H}
H
θ =
Figure 10.49
(a) One value of H(s) shown in polar coordinates, and (b) contour of H(s) as the frequency varies.
|H| cos(̸ H) and |H| sin(̸ H), respectively, with the former being the real part of H and the latter, the
imaginary part. We thus denote the two axes by Re{H} and Im{H}, respectively. We call the polar plot
of H(s) the “H contour.” We initially assume that s = jω, but later allow it to become complex.
As an example, let us plot H(s) = A0/(1 + s/ωp) in polar coordinates if s is replaced with jω
and ω varies from 0 to +∞. The phase, −tan−1(ω/ωp), begins at zero and approaches −90◦while the
magnitude, A0/

1 + ω2/ω2p, varies from A0 to zero. Figure 10.50 sketches both the Bode plots and the
polar plot, highlighting the corresponding points at ω = 0 (M) and ω = ∞(N). The reader may wonder
how we know that the polar plot is a semicircle. It is possible to prove this by calculating Im{H} and
Re{H}, but, as seen later, we do not have any interest in the actual shape. The beauty of Nyquist’s method
is that it primarily considers ω = 0 and ω = ±∞, avoiding the need for lengthy algebra.
0
0
M
A0
N
M
N
Im{H}
Re{H}
M
N
(A0, 0)
−90°
∣H(ω)∣
H(ω)
H = −90°
ω
ω
Figure 10.50
Bode and polar plots of H as s = jω goes from zero to inﬁnity.
This simple example readily demonstrates various decisions that we must make while plotting the H
contour: (1) the contour begins at (A0, 0) for ω = 0 and travels to the left because it must eventually
reach the origin for ω = ∞; (2) the contour falls below the horizontal axis because ̸ H is negative; and
(3) the contour approaches the origin at an angle of −90◦.
Since calculating |H| and ̸ H is generally cumbersome, we wish to construct polar plots by considering
only the poles and zeros of the transfer function. To understand the objective, consider the complex s
plane for the above example, where the pole is real and equal to −ωp (Fig. 10.51). As ω goes from 0 to
+∞, we begin at the origin and travel upward on the jω axis.9 Can we construct the polar plot of H by
examining what happens in the s plane?
Let us ﬁrst see whether ̸ H can be directly computed in the s plane. To this end, we consider one
value for s and denote it by s1 = σ1 + jω1, a complex value. Shown in Fig. 10.52 for a one-pole system,
9Recall that H(ω) is in fact H(s = jω); i.e., the s values are conﬁned to the jω axis and the input is assumed to be a sinusoid.

442
Chap. 10
Stability and Frequency Compensation
σ
jω
–ωp
Figure 10.51
The s plane with
one pole.
 σ
–ωp
σ1
s1
jω1
jω
 θ
σ1 + ωp
Figure 10.52
Phase shift produced by
a pole at frequency s1.
the s plane can yield a value for ̸ H(s = s1). Since
H(s1) =
A0
1 + σ1 + jω1
ωp
(10.54)
=
A0ωp
σ1 + ωp + jω1
(10.55)
we have
̸ H(s1) = −tan−1
ω1
σ1 + ωp
(10.56)
Thus, the angle θ in Fig. 10.52 is equal to −̸ H(s1). That is, to determine ̸ H(s1) in the s plane, we
draw a vector from the pole to s1, measure the angle of this vector with respect to the positive σ axis,
and multiply the result by −1. For the phase contributed by a zero, the procedure is the same, except that
the result is not multiplied by −1. If H contains multiple poles and zeros, then their phase contributions
simply add algebraically.
It is possible to calculate |H| from the s plane as well,10 but, fortunately, the exact knowledge of |H|
is not necessary in Nyquist’s approach.
10.8.3 Construction of Polar Plots
In this section, we study examples of plotting H(s) in polar coordinates so as to prepare ourselves for
Nyquist’s stability criterion.
General First-Order System
Suppose H(s) = A0(1 + s/ωz)/(1 + s/ωp) and ωp > ωz. We ﬁrst plot
H for s = jω as ω varies from 0 to +∞. At ω = 0, |H(s)| = A0. Also, as shown in Fig. 10.53(a),
the vectors going from the pole and the zero to s = 0 contribute equal and opposite angles, yielding
10The magnitude of H can be determined as the product of the lengths of the vectors emanating from the zeros divided by the
product of the lengths of the vectors emanating from the poles.

Sec. 10.8
Nyquist’s Stability Criterion
443
 σ
jω
–ωp  
–ωz  
–ωp  
–ωz  
ωz  
ωp  
ωz  
ωp  
–ωp  
–ωz  
jω
jω
 θp
(a)
(b)
Re{H}   
Im{H}   
A0
H( jω1)  
 σ
θz – θp
s
 j∞
 σ
 ω  
H(ω) 
H(ω) 
0
 ω  
0
A0
Im{H}   
Re{H}
Im{H}   
A0
ωp
ωz
Re{H}
A0
ωp
ωz
A0
s = 0
s = +j∞
s : 0          +j∞
s : 0          –j∞
s = 0
s = 0
s = jω1  
s = jω1  
(c)
(d)
(e)
(f)
(g)
 θz
 θz
 θp
Figure 10.53
(a) Phase shifts contributed by a pole and a zero at s = 0, (b) phase shifts at s = jω1, (c) contour of
H as s goes from zero to jω1, (d) phase shifts as s →j∞, (e) correct contour of H, (f) corresponding Bode plots,
and (g) complete H contour.
̸ H(0) = 0. Now, if s rises to jω1 [Fig. 10.53(b)], the angle contributed by the zero, θz, is greater than
that contributed by the pole, θp. That is, ̸ H = θz −θp remains positive. We have thus far constructed
the H contour shown in Fig. 10.53(c). The reader may wonder whether |H( jω1)| is greater or less than
A0, but we do not concern ourselves at this point.
What happens as s goes toward + j∞? As depicted in Fig. 10.53(d), the angles arising from the
zero and the pole approach 90◦, producing a net value of 0 for ̸ H. The magnitude of H, on the other
hand, approaches A0ωp/ωz > A0. This means that the H contour returns to the σ axis, but at a more
positive real value. Our guess in Fig. 10.53(c) is therefore not quite correct and must be revised to that in
Fig. 10.53(e). For completeness, we also show the Bode plots in Fig. 10.53(f).
It is necessary to repeat this procedure as s = jω goes from 0 to −j∞. Since the s plane contents
are always symmetric with respect to the σ axis for a physical system (due to conjugate symmetry of the
poles and zeros), the polar plot is also symmetric, emerging as shown in Fig. 10.53(g).
What if ωp < ωz? As shown in Fig. 10.54(a), the net angle is now negative as s travels upward on the
jω axis. Moreover, since |H( jω = 0)| = A0 and |H( jω = + j∞)| = A0ωp/ωz < A0, the H contour
begins from A0 on the real axis, rotates downward, and shrinks in magnitude [Fig. 10.54(b)]. For s = 0
to −j∞, this plot is reﬂected around the real axis in a manner similar to that in Fig. 10.53(g). The Bode
plots are also constructed in Fig. 10.54(c) to highlight the correspondences.
We have mostly conﬁned the s values in H(s) to the jω axis. In general, however, s can travel on
an arbitrary path (contour) in the s plane, assuming complex, real, or imaginary values. It is there-
fore beneﬁcial to consider the behavior of the foregoing ﬁrst-order system in such a case. For exam-
ple, suppose s travels clockwise on a closed contour in the right half plane [Fig. 10.55(a)]. How does
H(s) = A0(1 + s/ωz)/(1 + s/ωp) behave if ωp > ωz? At point M, s is real and equal to σM, yielding

444
Chap. 10
Stability and Frequency Compensation
jω
–ωz
s = jω1
(a)
(b)
 σ
 ω  
H(ω)
0
 ω  
0
H(ω)
A0
ωp
ωz
Re{H}
Im{H} 
A0
ωp
ωz
A0
s = 0
s = +j∞
–ωp
(c)
ωp
ωz
Figure 10.54
System with ωp < ωz, (b) contour of H, and (c) corresponding Bode plots.
jω
–ωp
–ωz
Re{H}   
Re{H}   
Im{H}   
s Contour
M
N
M
N
 σ
σN
σM
Re{H}   
Im{H}
M
?
H(σM)
H(σN)
Im{H}
H(σN)
N
M
(c)
(a)
(b)
(d)
H(σM)
Figure 10.55
(a) s contour excluding pole and zero, (b) possible trajectories for H, (c) actual H contour, and
(d) H contour if −ωz < −ωp.
H(s) = A0(1 + σM/ωz)/(1 + σM/ωp), a real point in the polar plot of H [Fig. 10.55(b)]. As s departs
from M, the net angle becomes more positive because the zero contributes more phase than the pole does,
but we do not know whether the H contour rises to the left or to the right. We therefore continue the s
contour to point N, noting that the angle returns to zero and H(s) = A0(1 + σN/ωz)/(1 + σN/ωp),
which is greater than H(s = σM) if ωp > ωz. Thus, the H contour must rise to the right, i.e.,
rotate clockwise. Figure 10.55(c) depicts the complete plot as s traverses clockwise the contour in
the s plane from M to N and from N back to M. For the case of ωp < ωz, H rotates counterclock-
wise [Fig. 10.55(d)] because H(σN) < H(σM). The reader is encouraged to repeat this analysis for
H(s) = A0/(1 + s/ωp).
Let us consider another s contour that encloses the pole and the zero of the transfer function. As
illustrated in Fig. 10.56(a), we begin at point M and observe a net angle of zero and H(σM) = A0(1 +
σM/ωz)/(1 + σM/ωp). Since σM is more negative than −ωz and −ωp, H(σM) > 0, yielding a point on

Sec. 10.8
Nyquist’s Stability Criterion
445
the real axis for the polar plot of H [Fig. 10.56(b)]. As we travel clockwise on the s contour, say to point
s1, the net angle becomes positive (why?), eventually returning to zero as we reach point N. Since σN is
less negative than −ωz and −ωp, H(σN) > 0. The reader can prove that H(σN) > H(σM). If we now
continue on the s contour from N toward M, the polar plot of H becomes negative and returns to zero.
It is important to note that the H contour does not enclose the origin. We say that H does not “encircle”
the origin. The s contours in both Figs. 10.55(a) and 10.56(a) lead to H contours that do not encircle the
origin. The signiﬁcance of this point becomes clear later.
jω
–ωp
Re{H}
–ωz
M
N
σN
σM
M
N
(a)
σ
s1
(b)
Im{H}
Figure 10.56
(a) s contour enclosing pole and zero, and (b) H contour.
What happens if the ﬁrst-order system has no zero? As shown in Fig. 10.57(a), ̸ H is equal to −180◦
at point M, reaching −90◦at s1 and zero at N. Also, H(σM) = A0/(1 + σM/ωp) < 0 and H(σN) > 0
[Fig. 10.57(b)]. We thus observe that H(s) encircles the origin in this case, and that the encirclement is
in the counterclockwise direction. Similarly, if the system has only one zero and no pole, a clockwise
s contour containing the zero maps to an H contour that encircles the origin in the clockwise direction
[Fig. 10.57(c)]. We hereafter assume that the s contours are symmetric around the σ axis, obtaining polar
plots that are symmetric around the real axis.
M
N
jω
–ωp
M
N
σN
σM
(a)
σ
s1
Re{H}
Im{H}
Im{H}
(b)
H(σN)
H(σM)
H(s1)
jω
M
N
σN
σM
σ
s1
Re{H}
M
N
H(σN)
H(σM)
H(s1)
–ωz
(c)
Figure 10.57
(a) System with one pole, (b) H contour, and (c) s and H contours if system has only one zero.

446
Chap. 10
Stability and Frequency Compensation
We now study a ﬁrst-order system that has both a zero and a pole while the s contour encircles only
the pole. We note from Fig. 10.58(a) that the polar plot of H(s) assumes a positive value at M, as it
did in Fig. 10.56(b). As s begins from point M and traverses the contour clockwise, ̸ H becomes more
positive, reaching 180◦at point N [Fig. 10.58(b)]. (It is helpful as a crosscheck to show that H(σN) < 0.)
Thus, the H contour encircles the origin counterclockwise in a manner similar to that in Fig. 10.57(b).
The reader can repeat this exercise with an s contour enclosing only the zero and prove that the plot of
H(s) encircles the origin clockwise.
jω
–ωp
M
N
σM
(a)
σ
Re{H}
Im{H}
(b)
H(σN)
–ωz
N
M
Figure 10.58
(a) s contour enclosing only one pole, and (b) H contour.
Second-Order System
Consider H(s) = A0[(1 + s/ωp1)(1 + s/ωp2)]−1 and assume that s travels
upward on the jω axis [Fig. 10.59(a)]. We recognize that |H(s)| begins at A0 and falls as s →+ j∞.
Also, ̸ H(s) begins at 0 and becomes more negative, reaching −90◦and, asymptotically, −180◦. As
depicted in Fig. 10.59(b), the H contour begins at A0, rotates clockwise, crosses the jω axis when
σ
jω
jω
–ωp1
–ωp2
–ωp1
–ωp2
(a)
(b)
Re{H}   
Im{H}   
A0
s = 0
s = +j∞
H = −90°
M
N
σN
σM
σ
s1
Re{H}   
Im{H}   
M
N
H(σM)
s2
s3
H(s3)
H(s1)
H(s2)
(c)
(d)
Figure 10.59
(a) Two-pole system, (b) H contour as s travels up on the jω axis, (c) s contour chosen to enclose
both poles, and (d) corresponding H contour.

Sec. 10.8
Nyquist’s Stability Criterion
447
̸ H = −90◦, enters the third quadrant, and eventually returns to the origin at a 180◦angle. For s = 0 to
−j∞, this plot is reﬂected around the real axis.
What if the contour of s encloses both poles? From Fig. 10.59(c), we note that ̸ H = −360◦at M and
H(σM) > 0. As we travel clockwise on the s contour to some point s1, the angle becomes less negative,
e.g., equal to −320◦= +40◦. Thus, the H contour rotates counterclockwise [Fig. 10.59(d)]. At some
point, s2, the net angle is around −270◦= +90◦, and at some other point, s3, we have ̸ H(s3) = −180◦.
As s approaches point N, H(s) reaches a real, positive value. The other symmetric half is shown in gray
for clarity. We observe that the polar plot encircles the origin twice in the counterclockwise direction if
the s contour encircles two poles in the clockwise direction.
10.8.4 Cauchy's Principle
From the foregoing studies, we postulate that, if the s contour encircles P poles and Z zeros of H(s) in
the clockwise direction, then the polar plot of H(s) encircles the origin Z −P times in the same direction.
This is known as “Cauchy’s Principle of Argument.” For example, if the s contour encircles clockwise
three zeros and no poles, then the H contour encircles the origin 3 −0 = 3 times clockwise. As seen
earlier, the H contour is constructed primarily from the angles contributed by the poles and zeros, with
little need for the exact knowledge of |H|.
We have thus far assumed that we know the locations of the poles and zeros of a transfer function and
we construct the polar plot to see how many times it encircles the origin. One can embark on a different
task: suppose we know that an s contour contains P poles but do not know the number of zeros within
the contour. If we still manage to draw the polar plot of the transfer function and ﬁnd that it encircles
the origin clockwise N times, we can conclude that the number of zeros within the s contour is equal to
Z = N + P. This is the key to Nyquist’s stability theorem.
10.8.5 Nyquist's Method
Having studied the foregoing concepts patiently, the reader is now ready to learn Nyquist’s stability
analysis. A negative-feedback system whose closed-loop transfer function is given by
Y
X (s) =
H(s)
1 + βH(s)
(10.57)
becomes unstable if it has any poles on the jω axis or in the right half plane, both of which we call herein
the “critical region.” In other words, if 1 + βH(s) has any zeros in this critical region, then the system is
unstable.
How do we determine whether 1 + βH(s) has any zeros in the critical region? Let us construct an
s contour containing this region (Fig. 10.60). From Cauchy’s principle, we know that the polar plot of
σ
jω
Critical
Region
Im{1 + βH(s)}
Re{1 + βH(s)}   
Polar Plot of
1 + βH(s)
Figure 10.60
Critical region in the s plane and the corresponding H contour.

448
Chap. 10
Stability and Frequency Compensation
1 + βH(s) encircles the origin Z −P times, where Z and P respectively denote the number of zeros
and poles that 1 + βH(s) contains within the s contour. We thus proceed as follows: (1) independently
determine P, (2) draw the polar plot of 1 + βH(s) as s traverses the contour shown in Fig. 10.60,
(3) determine the number of times, N, that 1 + βH(s) encircles the origin clockwise, and (4) ﬁnd P + N
as the number of zeros that 1 + βH(s) has in the critical region.
We must recognize a point that simpliﬁes our task. The poles of 1 + βH(s) are in fact the same as the
poles of H(s). If the open-loop system is stable (as is the case in most of our circuits), then H(s) has no
poles in the critical region and N = Z. Unless otherwise stated, we assume this to be true.
Before studying examples of the above procedure, we make one change that leads us to Nyquist’s
theorem: if the polar plot of 1 + βH(s) encircles the origin, then the polar plot of βH(s) encircles the
point (−1, 0) (Fig. 10.61) because the latter is obtained by shifting the former to the left by one unit.
Nyquist’s theorem articulates this result as for a closed-loop system, H(s)/[1 + βH(s)], to be stable,
the polar plot of βH(s) must not encircle the point (−1, 0) clockwise as s traverses a contour around the
critical region clockwise.
Polar Plot of
1+ βH(s)
Polar Plot of
βH(s)
(0, 0)
(–1, 0)
Im  
Im  
Re
Re
Figure 10.61
Polar plots of 1 + βH(s) and βH(s).
In applying Nyquist’s theorem, we must choose the s contour so as to minimize the mathematical
labor. One possibility is depicted in Fig. 10.62: we begin at the origin, travel on the jω axis to + j∞,
go around the RHP on a very large radius, continue to jω = −j∞, and return to the origin on the jω
axis. The reader may wonder what exactly happens now that the contour does not enclose the jω axis.
If 1 + βH(s) has any zeros on this axis, then the polar plot of βH(s) goes through the point (−1, 0)
rather than encircle it. [Recall from Bode plots that 1 + βH( jω1) = 0 translates to |βH( jω1)| = 1 and
̸ H( jω1) = 180◦.] Since the s contour is symmetric around the σ axis, we construct the βH contour
only as s goes from the origin to M and N, and simply reﬂect the result around the real axis to complete
the task.
σ
jω
M
N
Figure 10.62
Simple contour
enclosing the jω axis and RHP.
▲
Example10.9
Study the closed-loop stability if H(s) = A0/(1 + s/ωp1).

Sec. 10.8
Nyquist’s Stability Criterion
449
Solution
For the s contour shown in Fig. 10.63(a), βH(s) begins at β A0 for s = 0. As s = jω moves upward, the phase
becomes more negative. At + j∞, the phase goes to −90◦and the magnitude drops to zero, i.e., the polar plot reaches
the origin at an angle of −90◦[Fig. 10.63(b)]. What happens as s enters the right half plane? Traveling in the RHP
at a very long radius, s keeps βH(s) at zero. That is, the entire RHP contour from M to N maps to the origin. We
reﬂect this polar plot around the real axis to obtain the complete βH contour. Since the contour does not encircle
(−1, 0), the closed-loop system is always stable.
σ
jω
M
N
–ωp
Im{βH(s)}
Re{βH(s)}
s = +j∞
s = 0 
 βA0
(a)
(b)
Figure 10.63
(a) s contour for a one-pole system, and (b) βH contour.
▲
▲
Example10.10
Study the closed-loop stability if H(s) = A0/[(1 + s/ωp1)(1 + s/ωp2)].
Solution
At s = 0, βH(s) = β A0. As s = jω moves upward, the two poles contribute negative phase (Fig. 10.64). At
s = + j∞, the phase goes to −180◦and the magnitude falls to zero, i.e., the polar plot reaches the origin at an angle
of 180◦. The βH contour remains at the origin as s traverses the RHP at a very long radius from M to N. Since the
contour does not encircle (−1, 0), the closed-loop system is stable for any value of the feedback factor, β. The reader
is encouraged to repeat this exercise for increasingly larger values of ωp2.
 σ
jω
M
N
–ωp1
(a)
–ωp2
Im{βH(s)}
s = +j∞ 
s = 0
 βA0
(b)
Re{βH(s)}
Figure 10.64
s plane and βH contours for a two-pole system.
▲
▲
Example10.11
Study the closed-loop stability if H(s) = A0/[(1 + s/ωp1)(1 + s/ωp2)(1 + s/ωp3)].

450
Chap. 10
Stability and Frequency Compensation
Solution
The polar plot of βH(s) begins at β A0 and rotates clockwise, reaching an angle of −270◦= +90◦and a magnitude
of zero at s = + j∞[Fig. 10.65(a)]. The reﬂection of this half around the real axis completes the plot, revealing
that the βH contour can encircle (−1, 0) depending on the location of the intersection point, Q. At this point,
̸ βH = −180◦, i.e., tan−1(ωQ/ωp1) + tan−1(ωQ/ωp2) + tan−1(ωQ/ωp3) = 180◦. With the pole values known,
one can compute ωQ and hence |βH(s = jωQ)| so as to determine whether point Q is to the right or to the left of
(−1, 0). The corresponding calculation on Bode plots is illustrated in Fig. 10.65(b).
What happens to the βH contour in Fig. 10.65(a) if different values of β are chosen? Since the radius at every
point on the plot is proportional to β, the contour contracts as β decreases and expands as β increases. Illustrated in
Fig. 10.65(c), this trend conﬁrms that a higher feedback factor can make a three-pole system unstable.
σ
jω
M
N
(a)
–ωp2
–ωp2
–ωp1
Im{βH(s)} 
Re{βH(s)}
Re{βH(s)}
s = +j∞
s = 0 
βA0
(b)
Q
ω
ω
0
ωp1
ωp2
ωp3
βH(ω)
βH (ω)
–90°
–180°
–270°
<>
?
1
Point Q
Im{βH(s)}
(c)
Larger β 
Smaller β 
Figure 10.65
(a) s and H contours for three-pole system, (b) corresponding Bode plots, and (c) H contour for
different values of β.
▲
In some cases, it may not be straightforward to determine how many times the βH contour encircles
(−1, 0) clockwise. The general procedure for counting the number of encirclements is as follows: (1) draw
a straight line from (−1, 0) to inﬁnity in any direction, (2) count the number of times the contour crosses
this line in clockwise and counterclockwise directions, and (3) subtract the latter from the former.
10.8.6 Systems with Poles at Origin
Some open-loop systems contain one or more poles at the origin. For example, the integrator shown in
Fig. 10.66 has the following transfer function:
H(s) =
−1
R1C1s
(10.58)

Sec. 10.8
Nyquist’s Stability Criterion
451
C1
R1
Vout
Vin
Figure 10.66
Integrator.
if the op amp is ideal. When such systems are placed in a negative-feedback loop, their Nyquist sta-
bility analysis must choose a slightly different s contour. We begin with a one-pole system as depicted
in Fig. 10.67(a) and seek a contour that does not go through the origin so as to avoid an inﬁnite value
for βH(s). Rather than begin at (0, 0), we travel on an inﬁnitesimally small circle around it given by
ϵ exp( jφ) until we reach the jω axis and then move upward. The key point here is that ϵ is very small,
simplifying the calculations.
 σ
jω
Pole at
Origin
εe jϕ
Im{βH(s)}
Re{βH(s)}
ε
A0
βH(εe j90°)
(a)
(b)
s = ε
β
Figure 10.67
(a) s plane contour bypassing pole at origin, and (b) corresponding βH contour.
If H(s) = A0/s and we choose s = ϵ exp( jφ), then βH(s) = β(A0/ϵ) exp(−jφ). At φ = 0, s = ϵ,
and βH is real and very large [Fig. 10.67(b)]. As s traverses the circle, φ rotates toward +90◦and
β(A0/ϵ) exp(−jφ) remains at a very large radius, approaching −90◦. This behavior is indicated by a
dashed curve in Fig. 10.67(b) to emphasize the large radius. Now, s travels upward on the jω axis, still
retaining a phase of −90◦(due to the pole at the origin), while |βH| falls, i.e., βH goes toward the origin
at an angle of −90◦and remains at (0, 0) as s enters the RHP (not shown in the s plane). The other half of
the contour is obtained if s begins from the RHP (not shown), arrives at −j∞, travels toward the origin
on the jω axis, and traverses the circle ϵ exp( jφ) from φ = −90◦to φ = 0. Note that the polar plot of
βH does not encircle (−1, 0).
▲
Example10.12
Analyze the closed-loop stability of H(s) = A0(1 + s/ωz)/s. The zero can be created, for example, by inserting a
resistor in series with C1 in Fig. 10.66.
Solution
With s = ϵ exp( jφ) in Fig. 10.68(a), βH(s) ≈β(A0/ϵ) exp(−jφ) because ϵ is small. Shown in Fig. 10.68(b) is
the βH contour. Even at φ = 90◦, the zero contributes negligible phase because the circle’s radius is very small. As
we travel upward on the jω axis, the zero begins to add positive phase, and βH(s) = β A0(1 + s/ωz)/s approaches
a real value equal to β A0/ωz at s = + j∞. In contrast to the case illustrated in Fig. 10.67, this contour is deﬂected
away from the origin by the zero.

452
Chap. 10
Stability and Frequency Compensation
σ
jω
εe jϕ
s = ε 
A0
β ωz  
A0
β ε
s = + j∞
(a)
(b)
Im{βH(s)}
Re{βH(s)}
βH(εe j90°)
Figure 10.68
▲
▲
Example10.13
A negative-feedback loop employs two ideal integrators, i.e., H(s) = A0/s2. Study the closed-loop stability of the
system.
Solution
We begin with s = ϵ exp( jφ), φ = 0, and hence βH = β A0/ϵ2 (Fig. 10.69). As φ goes to +45◦(point N),
βH(s) = β(A0/ϵ2) exp(−2 jφ) rotates by −90◦, still at a very large radius. For φ = +90◦(point P), βH(s)
returns to the real axis. Now, as s = + jω travels upward, the angle remains unchanged, but the magnitude,
β|H( jω)| = β A0/ω2, falls. That is, βH continues on the real axis toward the origin, passing through (−1, 0) at
ω = √β A0. The closed-loop system therefore contains two poles on the jω axis because it crosses (−1, 0) twice.
After all, we can write H(s)/[1 + βH(s)] = A0/(s2 + β A0), observing two imaginary poles at ± j√β A0. Thus, a
two-pole system can oscillate if it has two poles at the origin.
(a)
(b)
Two Poles at
Origin
M
N
P
Q
ω =
βA0
(−1, 0)
M
N
P
Q
σ
jω
εe jϕ
s = ε
Im{βH(s)}
Re{βH(s)}
−β ε2
A0
β ε2
A0
Figure 10.69
▲
▲
Example10.14
Repeat the previous example if a zero is added to one of the integrators, i.e., H(s) = A0(1 + s/ωz)/s2.

Sec. 10.8
Nyquist’s Stability Criterion
453
Solution
With s = ϵ exp( jφ) and φ = 0, we have βH ≈β A0/ϵ2. The behavior of βH is similar to that in the previous
example up to point P (Fig. 10.70). As s = + jω travels upward, the zero begins to contribute appreciable phase
and |βH( jω)| = β A0

1 + ω2/ω2z/ω2 continues to fall. As s →+ j∞, ̸ βH approaches −90◦, suggesting that
the βH contour must reach the origin at an angle of −90◦. As shown in Fig. 10.70, the zero ensures that βH does
not cross or encircle (−1, 0), stabilizing the closed-loop system.
σ
(a)
(b)
M
N
P
Q
M
N
P
ω =
βA0
jω
εe jϕ
(−1, 0)
s = ε
Im{βH(s)}
Re{βH(s)}
−β ε2
A0
β ε2
A0
Figure 10.70
▲
The foregoing example sheds light on a common paradox that the Bode plots of the two-integrator
system conjure up, especially in the context of phase-locked loops (Chapter 16). As shown in Fig. 10.71,
it appears that the above closed-loop system is capable of oscillation at a frequency ω1, at which |βH|
is greater than unity and ̸ βH = −180◦. But we observe from the Nyquist plot in Fig. 10.70 or from
βH( jω1) = −β A0(1 + jω1/ωz)/ω2
1 that, owing to the zero, the phase of βH never reaches exactly
180◦. That is, at point P in Fig. 10.70, the inﬁnitesimal phase contributed by the zero causes |̸ βH| to
be less than 180◦. Similarly, even though the approximate Bode plots of Fig. 10.71 suggest a phase of
180◦for ω1 ≪ωz, in reality this amount of phase occurs only at ω = 0. The story, however, does not
end here. The next section provides a more fundamental understanding.
20log
log ω  
0
log ω  
0
βH(ω)
βH(ω)
ωz
–40 dB/dec
–20 dB/dec
–180°
–90°
ω1
ω1
Figure 10.71
Bode plots of a system
with two poles at origin and one zero.

454
Chap. 10
Stability and Frequency Compensation
10.8.7 Systems with Multiple 180◦Crossings
Consider a system whose loop transmission has three poles and two zeros as shown in Fig. 10.72(a).
Illustrated in Fig. 10.72(b), the Bode plots reveal that the phase crosses −180◦twice while the gain
remains higher than unity. Is this system stable when placed in a negative-feedback loop?
20log
log ω
log ω
0
0
H(ω)
ωp1
ωp2
ωp3
ωz1
ωz2
–180
σ
jω
 ωp1
 ωp2
 ωp3
ωz1
ωz2
B
C
βH(ω)
Im{βH(s)}
Re{βH(s)}
Re{βH(s)}
Re{βH(s)}
B
C
D
Im{βH(s)}
s = + j∞
s = + j∞ 
s = + j∞ 
B
C
D
(c)
(a)
(b)
(−1, 0)
Im{βH(s)}
B
C
D
(−1, 0)
(d)
(e)
P
Q
A
A
A
A
D
∞
∞
Figure 10.72
(a) System with three poles and two zeros, (b) Bode plots, (c) βH contour, (d) case where C is to
the left of (−1, 0), and (e) case where C is to the right of (−1, 0).
In the absence of the zeros, the βH contour crosses −180◦and approaches the origin at an angle of
−270◦[Fig. 10.65(a)]. We now construct the Nyquist plot as follows. As we begin from the origin in
Fig. 10.72(a) and travel up on the jω axis, the phase starts at zero and the βH contour at point A in
Fig. 10.72(c). Due to the higher number of poles, ̸ βH becomes negative, reaching −180◦(point B) for
some value of jω. As ω increases further, ̸ βH becomes more negative, but, due to the contribution of
the zeros, it deﬂects, forcing the βH contour to return to the real axis (point C). The phase then becomes
more positive and, for ω →∞, approaches −90◦(point D). Drawing the other symmetric half, we
distinguish between two cases.
1. Point C is to the left of (−1, 0) [Fig. 10.72(d)]; if we draw a line from (−1, 0) to inﬁnity, it crosses
the contour twice (at P and Q), but the contour has opposite directions at these two points. The

Problems
455
closed-loop system therefore has no poles in the RHP. Since both B and C are to the right of
(−1, 0), this case corresponds to the Bode plots of Fig. 10.72(b).
2. Point (−1, 0) lies between C and B [Fig. 10.72(e)]. In this case, the system is unstable.
We summarize the above results as follows. If ̸ βH crosses 180◦an even (odd) number of times while
|βH| > 1, then the system is stable (unstable).
References
[1] P. R. Gray and R. G. Meyer, Analysis and Design of Analog Integrated Circuits, 3rd ed. New York: Wiley, 1993.
[2] W. C. Black, D. J. Allstot, and R. A. Reed, “A High Performance Low Power CMOS Channel Filter,” IEEE J.
of Solid-State Circuits, vol. 15, pp. 929–938, December 1983.
[3] R. M. Ziazadeh, H.-T. Ng, and D. J. Allstot, “A Multistage Ampliﬁer Topology with Embedded Tracking
Compensation,” CICC Proc., pp. 361–364, May 1998.
[4] B. K. Ahuja, “An Improved Frequency Compensation Technique for CMOS Operational Ampliﬁers,” IEEE J.
of Solid-State Circuits, vol. 18, pp. 629–633, December 1983.
[5] P. R. Gray and R. G. Meyer, “MOS Operational Ampliﬁer Design—A Tutorial Overview,” IEEE J. of Solid-State
Circuits, vol. 17, pp. 969–982, December 1982.
[6] B. Y. Kamath, R. G. Meyer, and P. R. Gray, “Relationship Between Frequency Response and Settling Time of
Operational Ampliﬁers,” IEEE J. of Solid-State Circuits, vol. 9, pp. 347–352, December 1974.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. Also, assume that all transistors are in saturation.
10.1.
An ampliﬁer with a forward gain of A0 and two poles at 10 MHz and 500 MHz is placed in a unity-gain
feedback loop. Calculate A0 for a phase margin of 60◦.
10.2.
An ampliﬁer with a forward gain of A0 has two coincident poles at ωp. Calculate the maximum value of A0
for a 60◦phase margin with a closed-loop gain of (a) unity and (b) 4.
10.3.
An ampliﬁer has a forward gain of A0 = 1000 and two poles at ωp1 and ωp2. For ωp1 = 1 MHz, calculate
the phase margin of a unity-gain feedback loop if (a) ωp2 = 2ωp1 and (b) ωp2 = 4ωp1.
10.4.
A unity-gain closed-loop ampliﬁer exhibits a frequency peaking of 50% in the vicinity of the gain crossover.
What is the phase margin?
10.5.
Consider the transimpedance ampliﬁer shown in Fig. 10.73, where RD = 1 k, RF = 10 k, gm1 = gm2 =
1/(100 ), and CA = CX = CY = 100 fF. Neglecting all other capacitances and assuming that λ = γ = 0,
compute the phase margin of the circuit. (Hint: break the loop at node X.)
M1
RD
CX
VDD
M2
RF
CA
CY
Vout
Iin
X
A
Y
Figure 10.73
10.6.
In Problem 10.5, what is the phase margin if RD is increased to 2 k?

456
Chap. 10
Stability and Frequency Compensation
10.7.
If the phase margin required of the ampliﬁer of Problem 10.5 is 45◦, what is the maximum value of (a) CY ,
(b) CA, and (c) CX while the other two capacitances remain constant?
10.8.
Prove that the zero of the circuit shown in Fig. 10.32 is given by Eq. (10.30). Apply the technique illustrated
in Fig. 6.18.
10.9.
Consider the ampliﬁer of Fig. 10.74, where (W/L)1−4 = 50/0.5 and ISS = I1 = 0.5 mA.
(a)
Estimate the poles at nodes X and Y by multiplying the small-signal resistance and capacitance to
ground. Assume that CX = CY = 0.5 pF. What is the phase margin for unity-gain feedback?
(b)
If CX = 0.5 pF, what is the maximum tolerable value of CY that yields a phase margin of 60◦for
unity-gain feedback?
M3
M1
M2
Vin
Vb
CX
VDD
M4
CY
Vout
Y
X
ISS
I1
Figure 10.74
10.10. Estimate the slew rate of the op amp of Problem 10.9 for both parts (a) and (b).
10.11. In the two-stage op amp of Fig. 10.75, W/L = 50/0.5 for all transistors except for M5,6, for which W/L =
60/0.5. Also, ISS = 0.25 mA and each output branch is biased at 1 mA.
(a)
Determine the CM level at nodes X and Y.
(b)
Calculate the maximum output voltage swing.
(c)
If each output is loaded by a 1-pF capacitor, compensate the op amp by Miller multiplication for a phase
margin of 60◦in unity-gain feedback. Calculate the pole and zero positions after compensation.
(d)
Calculate the resistance that must be placed in series with the compensation capacitors to position the
zero atop the nondominant pole.
(e)
Determine the slew rate.
M3
M1
M2
Vin
Vb1
VDD
ISS
M4
M8
M7
Vb1
Vb1
Vout2
Vout1
M5
M6
X
Y
Figure 10.75
10.12. In Problem 10.11, the pole-zero cancellation resistor is implemented with a PMOS device as in Fig. 10.34.
Calculate the dimensions of M13–M15 if I1 = 100 μA.
10.13. Calculate the input-referred thermal noise voltage of the op amp shown in Fig. 10.75.

Problems
457
10.14. Figure 10.76 depicts a transimpedance ampliﬁer employing voltage-current feedback. Note that the feedback
factor may exceed unity because of M3. Assume that I1–I3 are ideal, I1 = I2 = 1 mA, I3 = 10 μA,
(W/L)1,2 = 50/0.5, and (W/L)3 = 5/0.5.
(a)
Breaking the loop at the gate of M3, estimate the poles of the open-loop transfer function.
(b)
If the circuit is compensated by adding a capacitor CC between the gate and the drain of M1, what value
of CC achieves a phase margin of 60◦? Determine the poles after compensation.
(c)
What resistance must be placed in series with CC to position the zero of the output stage atop the ﬁrst
nondominant pole?
M1
VDD
Iin
Y
M2
Vout
M3
I2
I1
I3
Figure 10.76
10.15. Repeat Problem 10.14 if the output node is loaded by a 0.5-pF capacitor.
10.16. Suppose that in the circuit of Fig. 10.76, a large negative input current is applied such that M1 turns off
momentarily. What is the slew rate at the output?
10.17. Explain why, in the circuit of Fig. 10.76, the compensation capacitor should not be placed between the gate
and the drain of M2 or M3.
10.18. Determine the input-referred noise current of the circuit shown in Fig. 10.76 and described in Problem 10.14.
10.19. The cancellation of a pole by a zero, e.g., in a two-stage op amp, entails an issue called the “doublet problem”
[5, 6]. If the pole and the zero do not exactly coincide, we say that they constitute a doublet. The step response
of feedback circuits in the presence of doublets is of great interest. Suppose the open-loop transfer function
of a two-stage op amp is expressed as
Hopen(s) =
A0

1 + s
ωz


1 +
s
ωp1

1 +
s
ωp2

(10.59)
Ideally, ωz = ωp2 and the feedback circuit exhibits a ﬁrst-order behavior, i.e., its step response contains a
single time constant and no overshoot.
(a)
Prove that the transfer function of the ampliﬁer in a unity-gain feedback loop is given by
Hclosed(s) =
A0

1 + s
ωz

s2
ωp1ωp2
+

1
ωp1
+
1
ωp2
+ A0
ωz

s + A0 + 1
(10.60)
(b)
Determine the two poles of Hclosed(s), assuming they are widely spaced.

458
Chap. 10
Stability and Frequency Compensation
(c)
Assuming ωz ≈ωp2 and ωp2 ≪(1 + A0)ωp1, write Hclosed(s) in the form
Hclosed(s) =
A

1 + s
ωz


1 +
s
ωpA

1 +
s
ωpB

(10.61)
and determine the small-signal step response of the closed-loop ampliﬁer.
(d)
Prove that the step response contains an exponential term of the form (1 −ωz/ωp2) exp(−ωp2t). This
is an important result, indicating that if the zero does not exactly cancel the pole, the step response
exhibits an exponential with an amplitude proportional to 1−ωz/ωp2 (which depends on the mismatch
between ωz and ωp2) and a time constant of 1/ωz.
10.20. Using the results of the previous problem, determine the step response of the ampliﬁer described in Prob-
lem 10.11 with (a) perfect pole-zero cancellation and (b) 10% mismatch between the pole and the zero
magnitudes.
10.21. It is possible to raise the voltage gain of a folded-cascode op amp by adding a secondary path. As shown in
Fig. 10.77 by the gray section, the input signal can also travel through a differential pair with current-source
loads, I1 and I2, and drive the current sources in the original op amp. Of course, nodes X and Y exhibit a
relatively high impedance, thus contributing a pole that signiﬁcantly degrades the phase margin.
(a)
Neglecting channel-length modulation in I1 and I2, determine the low-frequency gain of the op amp.
(b)
Considering only the capacitances at X, Y, P, Q, and the output nodes, compute the overall transfer
function. Is it possible for the zero to cancel one of the poles?
VDD
M5
M3
M4
M7
M6
M9
M10
Vb4
Vout
M1
M2
I1
I2
M8
P
Q
X
Y
Figure 10.77
10.22. Consider the circuit of Fig. 10.37(b) and assume that Iin = ISSu(t). Also, assume that a load capacitance
of CL is tied from the drain to ground. Write a KCL at the output node and derive a differential equation in
terms of Vout. Taking the Laplace transform and using partial fractions, prove that
Vout(t) = ISS
CF
tu(t) −ISS
gm

1 + CL
CF

u(t) −ISS
gm

1 + CL
CF

exp −t
τ u(t)
(10.62)
where τ = CL/gm. Plot these three terms as a function of time and determine the time at which Vout(t)
reaches a minimum. This result indicates that the output initially falls and then assumes a ramp behavior.
10.23. A two-stage op amp is compensated for a phase margin of 60◦with β = 1. If β is reduced to β1 < 1,
determine the new phase margin.

CHAPTER
11
Nanometer Design Studies
The previous chapters of this book have taken us on a “scenic” route through the world of analog circuits,
presenting important concepts and useful topologies. We have occasionally made design efforts, but only
on a small scale. In this chapter, we embark upon two comprehensive designs so as to appreciate the
mindset that an analog designer must uphold and the multitude of tasks that he or she must complete for
a given circuit. The designs are carried out in 40-nm CMOS technology with a 1-V supply. The reader is
encouraged to review the op amp design examples in Chapter 9 before starting this chapter.
We begin with a brief look at the imperfections of nanometer devices and the design procedures to
achieve certain transistor parameters. We then delve into the design of an op amp and, through simulations,
optimize its performance. Finally, we deal with the design of a high-speed, high-precision ampliﬁer and
pursue various techniques to achieve a low power dissipation.
11.1
Transistor Design Considerations
In Chapter 2, we studied the basic operation of MOSFETs and included a few second-order effects.
Our investigation has produced a large-signal model (consisting of the triode-region quadratic equation
and the saturation-region square-law relation), which becomes necessary in two cases: (1) when the
transistor experiences large voltage (or current) changes due to the input or output signals, disobeying
the small-signal model, or (2) when the transistor must be biased, requiring certain terminal voltages so
as to carry a speciﬁed current. In analog design, the former case occurs occasionally, while the latter
almost always.
The large-signal behavior of nanometer MOSFETs signiﬁcantly departs from the “long-channel”
model that we have developed. As a result of technology scaling, i.e., the shrinkage of MOS dimensions,
several effects besides those studied in Chapter 2 manifest themselves, thereby altering the I/V character-
istics. As an example, Fig. 11.1 plots the actual ID-VDS characteristics of an NFET with W/L = 5 μm/40
nm and VT H ≈300 mV (using a BSIM4 model) against a “best-ﬁt” long-channel square-law approxima-
tion. We observe that the two diverge considerably. Thus, even if we are not interested in the large-signal
analysis of a circuit, we still face the problem of bias calculations using the square-law model.
In this section, we brieﬂy consider a few “short-channel” effects that make the long-channel model
inaccurate. A detailed treatment of short-channel effects is deferred to Chapter 17. It is important to note
that the MOS small-signal model developed in Chapter 2 still holds for short-channel devices and, as
seen throughout this book, sufﬁces for the initial analysis of many analog circuit blocks. However, the
expressions relating gm and rO to the bias conditions must be revised.
459

460
Chap. 11
Nanometer Design Studies
VGS
0
0.2
0.4
0.6
0.8
1
0
0.5
1
1.5
2
2.5
3
3.5
VDS (V)
ID (mA)
700 mV
600 mV
500 mV
400 mV
300 mV
800 mV
Figure 11.1
I-V characteristics of an actual 5-μm/40-nm device (black curves) and a best-ﬁt square-law device
(gray curves). (VGS is incremented from 300 mV to 800 mV in 100-mV steps.)
The characteristics shown in Fig. 11.1 exhibit severe channel-length modulation for the actual 40-
nm devices, making it difﬁcult to distinguish between the triode and saturation regions. But we can
associate a “knee” point with each curve as a rough boundary. Figure 11.2 plots the actual 40-nm device
characteristics for a narrower VGS range, namely, VGS −VT H = 50 mV, 100 mV, · · ·, 350 mV. We observe
knee points below VDS = 0.2 V. (Here, W = 5 μm and VT H ≈200 mV.)
0
0.2
0.4
0.6
0.8
1
0
0.2
0.4
0.6
0.8
1
1.2
VDS (V)
ID (mA)
Figure 11.2
I-V characteristics of a 5-μm/40-nm device for VGS −VT H = 50, · · · , 350 mV.
11.2
Deep-Submicron Effects
Among various short-channel effects, two are particularly important at this stage of our studies; both
relate to the mobility of the carriers in the channel. Recall that we have assumed that the carrier velocity
is given by v = μE, where E denotes the electric ﬁeld. We revisit this assumption here.

Sec. 11.2
Deep-Submicron Effects
461
Velocity Saturation
In a MOSFET, as VDS and hence the electric ﬁeld along the source-drain path
increase, v does not rise proportionally (Fig. 11.3).
E
Ecrit
107 cm/s
Carrier
Velocity
Figure 11.3
Velocity saturation at high
electric ﬁelds.
We say that the carriers experience “velocity saturation” or, equivalently, that the mobility (the slope of
v versus E) falls. This effect has arisen because the length of MOSFETs has shrunk from, say, 1 μm to
40 nm (a factor of 25) while the allowable drain-source voltage has decreased from 5 V to about 1 V. The
lateral electric ﬁeld has thus exceeded Ecrit (≈1 V/μm) in Fig. 11.3.
We deal with the modeling of velocity saturation in Chapter 17, but let us consider an extreme case here:
suppose the charge carriers reach the saturated velocity, vsat, as soon as they depart from the source. Since
I = Qd · v, where Qd is the charge density (per unit length) and given by WCox(VGS −VT H), we have
ID = WCox(VGS −VT H)vsat
(11.1)
Extreme velocity saturation therefore creates three departures from the square-law behavior. First, the de-
vice carries a current that is linearly proportional to the overdrive and independent of the channel length.1
Second, ID reaches saturation even for VDS < VGS −VT H (Fig. 11.4). As evident in Fig. 11.2, the knee
points occur at relatively small VDS’s even as the overdrive reaches 350 mV. Third, the transconductance
of a fully velocity-saturated MOSFET emerges as
gm = ∂ID
∂VGS
|VDSconst
(11.2)
= WCoxvsat
(11.3)
a relatively constant value versus ID or VGS. For example, in the plots of Fig. 11.2, the change in ID is
fairly constant as the overdrive increments from 250 mV to 300 mV and from 300 mV to 350 mV.
VDS
ID
VGS − VTH
Without
Velocity Saturation 
With
Velocity Saturation
VD0
Figure 11.4
Premature saturation of drain current due to velocity saturation.
Mobility Degradation with Vertical Field
The mobility of the charge carriers in the channel also
declines as the gate-source voltage and the vertical ﬁeld increase (Fig. 11.5).
1So long as L is small enough and VDS large enough to cause velocity saturation.

462
Chap. 11
Nanometer Design Studies
VGS − VTH
μ0
μ
Figure 11.5
Reduction of mobility due
to vertical electric ﬁeld.
What is the impact of this mobility degradation on the device transconductance? We intuitively expect
that gm no longer follows the linear relationship, gm = μCox(W/L)(VGS −VT H), with the overdrive
voltage. Figure 11.6 displays this behavior for the 5-μm/40-nm NFET mentioned above.
0
0.1
0.2
0.3
0.4
0.5
0.6
1
2
3
4
5
VGS – VTH (V)
gm (mS)
Figure 11.6
Transconductance as a function of overdrive voltage.
▲
Example11.1
We approximate the mobility plot of Fig. 11.5 by
μ =
μ0
1 + θ(VGS −VT H)
(11.4)
where θ is a proportionality factor with a dimension of (voltage)−1. Determine the transconductance of a MOSFET
that suffers from this type of mobility degradation.
Solution
We write
ID = 1
2
μ0Cox
1 + θ(VGS −VT H)
W
L (VGS −VT H)2
(11.5)
and hence
gm = μ0Cox
W
L
(θ/2)(VGS −VT H)2 + VGS −VT H
[1 + θ(VGS −VT H)]2
(11.6)
As expected, for θ(VGS −VT H) ≪1, we have gm ≈μ0Cox(W/L)(VGS −VT H). At the other extreme, if
(VGS −VT H) ≫2/θ, then gm approaches a constant value: gm ≈(1/2)μ0Cox(W/L)/θ.
▲

Sec. 11.3
Transconductance Scaling
463
In the general case, the degradation of the mobility due to both lateral and vertical ﬁelds (VDS and
VGS, respectively) must be considered. Nonetheless, the simple results derived above sufﬁce for most of
our studies in analog design.
11.3
Transconductance Scaling
Device transconductances manifest themselves in almost every analog circuit. Suppose a transistor op-
erates in the saturation region but does not provide the required transconductance. The gm equations in
Chapter 2,
gm = μnCox
W
L (VGS −VT H)
(11.7)
=

2μnCox
W
L ID
(11.8)
=
2ID
VGS −VT H
(11.9)
suggestthatadjustmentsinthreeparameters,namely, W/L, VGS−VT H,or ID,canscale gm.Westudythese
scenarios, assuming for now a long-channel device and hence ID ≈(1/2)μnCox(W/L)(VGS −VT H)2.
That is, VGS −VT H ≈√2ID/(μnCoxW/L). In each case, we keep one of the parameters constant and
vary the other two.
From (11.7), we can increase W/L while keeping VGS −VT H constant. In this case, both gm and ID
linearly scale with W/L (why?) [Fig. 11.7(a)], and so does the power consumption. Alternatively, we
gm
gm
gm
gm
gm
gm
W
L
W
L
W
L
W
L
ID
ID
ID
ID
ID Constant
ID Constant
VGS − VTH Constant
VGS − VTH Constant
W
L Constant
W
L Constant
ID
(c)
(a)
(b)
(d)
(e)
(f)
ξVT
ID
ξVT
VGS − VTH
VGS − VTH
VGS − VTH
VGS − VTH
Figure 11.7
Dependence of (a) gm and ID upon W/L, (b) gm and ID upon VGS −VT H, (c) gm and VGS −VT H
upon W/L, (d) gm and VGS −VT H upon ID, (e) gm and W/L upon ID, and (f) gm and W/L upon VGS −VT H.

464
Chap. 11
Nanometer Design Studies
can increase VGS −VT H but keep W/L constant [Fig. 11.7(b)], thus requiring a higher drain current. In
the former case, the device capacitances rise whereas in the latter, VDS,min increases. In this chapter, we
use the notations VDS,min, VD,sat, and VGS −VT H interchangeably.
From (11.8), we can raise W/L while ID is constant [Fig. 11.7(c)], as a result of which VGS −VT H
is lowered (why?). Due to subthreshold conduction, however, gm does not climb indeﬁnitely in this
case. If we keep W/L constant and increase ID [Fig. 11.7(d)], then VGS −VT H and hence VDS,min
must rise.
From (11.9), we can increase ID while VGS −VT H is constant [Fig. 11.7(e)]. This requires that W/L
increase. Alternatively, we can lower VGS −VT H and keep ID constant [Fig. 11.7(f)], which means that
W/L must increase. For VGS −VT H ≈0, the device enters the subthreshold region and gm ≈ID/(ξVT ).
In both cases, the device capacitances climb.
Let us now reconsider the foregoing six scenarios for nanometer devices. We note that the plots in
Fig. 11.7 still hold qualitatively, but the gm and overdrive equations are more complex. The case of
Fig. 11.7(a) is particularly interesting and useful and is studied further in the following example.
▲
Example11.2
The linear scaling of gm and ID with W/L, shown in Fig. 11.7(a), holds regardless of the transistor characteristics.
Explain why.
Solution
Consider, as an example, two identical transistors connected in parallel (Fig. 11.8), each having a transconductance
of gm. If VGS changes by V , then the drain current of each device changes by gmV , and hence the current of
the composite device changes by 2gmV . That is, the parallel combination exhibits a transconductance of 2gm. We
conclude that increasing both the width and the drain current of the transistor by a factor of K (> 1) is equivalent
to placing K transistors in parallel and raising the gm by a factor of K. We say that the scaling preserves the device
“current density” (ID/W) in this case. Note that the bias overdrive voltage remains constant in this scenario, and so
does the gm/ID ratio. The latter property proves useful in our studies.
W
L
W
L
VGS
Figure 11.8
▲
Of the six scenarios depicted in Fig. 11.7, which ones are more common in practice? Since modern
analog circuits must operate with low supplies (around 1 V), we often limit VGS −VT H to a few hundred
millivolts. Thus, to obtain a certain transconductance, we ﬁrst keep increasing the width [Fig. 11.7(c)]
to the extent that it raises the gm signiﬁcantly. As gm approaches a constant value (in the subthreshold
region), the width is no longer a determining factor, leaving the drain current as the only parameter
that can increase the gm [Fig. 11.7(d)]. However, as we increase ID in this case, VGS −VT H may
exceed the allotted value, forcing us to resort to the scenario in Fig. 11.7(e) [which is equivalent to that
in Fig. 11.7(a)]. These trials and errors seem rather haphazard, but do not despair! The remainder of
this section is dedicated to developing a methodical approach to transistor design. We begin with an
important example.
▲
Example11.3
A transistor having an aspect ratio of (W/L)RE F exhibits the gm-ID characteristic shown in Fig. 11.9(a).

Sec. 11.3
Transconductance Scaling
465
gm
ID
ID1
gm1
(     )REF
W
L
gm
ID
ID1
gm1
2gm1
2ID1
W
(a)
(b)
gm
ID
ID1
gm1
2gm2
2ID2
W
ID2
gm2
VGS − VTH
(VGS − VTH)2
gm
2gmx
gm0
VGS − VTH
(VGS − VTH)0
(VGS − VTH)2
(VGS − VTH)1
(VGS − VTH)1
W
ID
IDx
ID0
(c)
(d)
Figure 11.9
(I) Suppose the device is ﬁrst biased at ID = ID1. What happens to the transconductance and the drain current if the
width is doubled while VGS −VT H remains constant? (II) Repeat (I) if we begin with a greater overdrive. (III) We
wish to obtain a transconductance of gmx at a drain current of IDx. How should the transistor be scaled?
Solution
(I) With a constant VGS −VT H, doubling the width also doubles the transconductance and the drain current (Example
11.2). Since gm/ID is constant, to obtain this point on the gm-ID plane, we pass a straight line through the origin
and (ID1, gm1), continuing to reach (2ID1, 2gm1) [Fig. 11.9(b)]. Thus, all (ID, gm) combinations resulting from the
scaling of W fall on this line if the overdrive is ﬁxed.
(II) If we begin with a greater overdrive, (VGS −VT H)2, the (ID, gm) point is located elsewhere, at (ID2, gm2), on
the characteristic [Fig. 11.9(c)]. We again draw a straight line through the origin and (ID2, gm2) and continue to
(2ID2, 2gm2). Thus, each such line in the gm-ID plane represents the possible (ID, gm) combinations that can be
obtained by scaling W for a given overdrive.
(III) We draw a line through the origin and the point (IDx, gmx) [Fig. 11.9(d)]. The intersection of the line and the gm
plot yields a “reference” point specifying the proper overdrive voltage, (VGS −VT H)0, and an acceptable (ID, gm)
combination, (ID0, gm0). If the width is scaled up by a factor of gmx/gm0 (= IDx/ID0), and the overdrive remains
equal to (VGS −VT H)0, then the desired transconductance and current are obtained.
▲

466
Chap. 11
Nanometer Design Studies
11.4
Transistor Design
The reader may have noticed by now that a given transistor in a circuit is characterized by a multitude of
parameters. In this section, we assume that transistors operate in saturation and focus on two bias quanti-
ties, ID and VGS −VT H (= VDS,min), one small-signal parameter, gm, and one physical parameter, W/L.
A typical transistor design problem speciﬁes two of the ﬁrst three and seeks the other two (Table 11.1).
We wish to develop methodical approaches to computing these two parameters for nanometer devices.
While not listed here explicitly, the output resistance, rO, also proves important in many circuits and is
eventually included in our studies in Sec. 11.4.5.
Table 11.1
Three scenarios encountered in transistor design.
Case I
Case II
Case III
Given
I D, VDS, mi n
gm, I D
gm, VDS, mi n
To Be Determined
W
L , gm
W
L , VDS, mi n
W
L , I D
Design Revision
gm insufﬁcient;
VDS, mi n too large;
I D too large;
Raise I D and W
L
Raise W
L
Raise W
L ; Lower VGS −VT H
The reader may recognize that the design problems shown in Table 11.1 are “overconstrained,” i.e.,
the two given parameters inevitably lead to certain values for the other two—even though the results may
not always be desirable. For example, a known ID and VDS,min directly give a value for gm that may not
be sufﬁcient for a particular circuit. In such a case, we must modify the design as prescribed in the last
row of the table. We will elaborate on this row in the design studies to be followed, but let us make some
preliminary remarks here. In Case I, an insufﬁcient gm would require a higher ID (possibly exceeding a
power budget) and a greater W/L (to satisfy the speciﬁed VDS,min). In Case II, the given ID and gm may
yield an unacceptably large VDS,min, thereby dictating a greater W/L. In Case III, the necessary ID may
be excessive, demanding a greater W/L and a smaller overdrive.2
11.4.1 Design for Given I D and VDS,min
A common situation that arises in analog design is as follows. For a particular transistor in the circuit, we
have chosen a bias current (perhaps according to a power budget) and a minimum VDS (perhaps according
to the voltage headroom, i.e., the restrictions imposed by the supply voltage and the required swings).3
We now wish to determine the dimensions and the transconductance of the device, recognizing that the
square-law equations are inaccurate. Of course, with the transistor models available, we can simulate
the device and obtain these values, but we seek a more methodical and less laborious procedure. Our
approach proceeds in three steps. We consider ID = 0.5 mA and VDS,min = 200 mV as an example.
Step 1
Select a “reference” transistor, with a width WRE F and a length equal to the minimum allowable
value, Lmin (e.g., Lmin = 40 nm). Let us choose WRE F = 5 μm as an example.
Step 2
Using the actual device models and a circuit simulator, plot the ID-VDS characteristics of the
reference transistor for different values of VGS −VT H. In typical analog circuits, VGS −VT H ranges
from about 50 mV to about 600 mV. We can therefore construct the characteristics with the overdrive
2In cases I and III, raising W/L can relax the gm-ID trade-off only if the device does not enter the subthreshold region.
3We assume that the supply voltage is given.

Sec. 11.4
Transistor Design
467
0
0.2
0.4
0.6
0.8
1
0
0.2
0.4
0.6
0.8
1
1.2
VDS (V)
ID (mA)
Figure 11.10
Drain current for VGS −VT H = 50 mV · · · 350 mV in steps of 50 mV for a reference device.
incrementing in steps of 50 mV.4 Figure 11.10 shows the results for WRE F/Lmin = 5 μm/40 nm. (Here,
VGS −VT H increments from 50 mV to 350 mV for clarity.)
Step 3
Bearing in mind that our example speciﬁes ID = 0.5 mA and VDS,min = 200 mV, we draw a
vertical line at VDS = 200 mV (Fig. 11.10) and ﬁnd its intersection with the plots. Which plot should we
select? If the device obeyed the square law, we would choose the plot for VGS−VT H = VDS,min = 200 mV.
However, the short-channel device remains in saturation even for VGS−VT H = 350 mV at VDS = 200 mV.
The situation is therefore more complex, but let us proceed with VGS −VT H = 200 mV for now.
Step 4
The foregoing procedure has yielded, for the reference transistor, one operating point that
satisﬁes the VDS requirement. The drain current, ID,RE F, however, may not be close to the necessary
value, 0.5 mA in our example. What shall we do here? We must now scale the width of the transistor
and hence its drain current. Since in Fig. 11.10, ID,RE F ≈100 μA, we choose a transistor width of
(500 μA/100 μA)×WRE F = 5WRE F = 25 μm.
How much is the transconductance of the earlier reference transistor? We recognize from the plots of
Fig. 11.10 that, as VGS−VT H is incremented from 200 mV to 250 mV, ID changes by about 100 μA. Thus,
gm ≈100 μA/50 mV= 2 mS. Since the change in the overdrive is not much less than the initial value of
200 mV, we may seek a more accurate value for gm. To this end, let us return to the reference transistor
and, using simulations, plot its transconductance as a function of VGS −VT H with VDS = 200 mV. For a
square-law device, this plot would be a straight line, gm = μnCox(WRE F/Lmin)(VGS −VT H), but with
short-channel effects, gm eventually saturates. Shown in Fig. 11.11, the result predicts gm = 1.5 mS for
VGS −VT H = 200 mV. Now, if both the width and the drain current are scaled up by a factor of 5, then
gm also rises by the same factor (Example 11.2), reaching a value of 7.5 mS. As indicated in Table 11.1,
if this transconductance is insufﬁcient, W/L must be increased further.
With the ID and gm plots obtained for the reference device, we can readily perform scaling to determine
the width and transconductance of other transistors in a circuit. The key point here is that the ID and gm
simulations are performed only once (for a given channel length) but serve most of our design work.
4Our approach deals with only moderate and strong inversion, as is the case in most analog circuits.

468
Chap. 11
Nanometer Design Studies
0
0.1
0.2
0.3
0.4
0.5
0.6
1
2
3
4
5
VGS – VTH (V)
gm (mS)
Figure 11.11
Dependence of gm on overdrive for W/L = 5 μm/40 nm and VDS = 200 mV.
Can we choose a higher overdrive voltage in Fig. 11.10? Suppose we select VGS −VT H = 250 mV,
obtaining ID = 200 μA for the reference transistor and a transconductance of about 2.3 mS from
Fig. 11.11. If scaled up to 12.5 μm so as to carry 500 μA, the transistor exhibits a transconductance
of 2.5 × 2.3 mS = 5.75 mS, a value less than that observed in the previous case (7.5 mS). This occurs
because gm = 2ID/(VGS −VT H) in saturation. To obtain a high transconductance, therefore, we typically
choose VGS −VT H ≈VDS,min even though it translates to a wider transistor.
▲
Example11.4
The circuit shown in Fig. 11.12 must be designed for a power budget of 1 mW and a peak-to-peak output voltage swing
of 0.8 V. Assuming L = 40 nm for M1, compute its required width. Can the transistor provide a transconductance
of 1/(50 )?
M1
RD
VDD = 1 V 
Vout
Vin
1 V 
0.2 V 
Figure 11.12
Solution
The power budget along with VDD = 1 V translates to a drain bias current of 1 mA. For the circuit to accommodate
an output swing of 0.8 V, M1 must remain in saturation as VDS falls to 0.2 V. We return to the ID-VDS characteristics
of Fig. 11.10 and recall that ID,RE F ≈100 μA for VDS = VGS −VT H = 200 mV. We must therefore scale WRE F
up by a factor of 1 mA/0.1 mA, obtaining W/L = 50 μm/40 nm. The transconductance is also multiplied by this
factor, reaching 15 mS = 1/(67 ). Note that these results are independent of the value of RD.
We conclude that, if the transistor is designed simply to satisfy this example’s ID and VDS speciﬁcations, then it
does not necessarily achieve a transconductance of 1/(50 ).
▲
In addition to ID, VGS −VT H, and gm, the output impedance of the transistors also becomes important
in many analog circuits. As explained in Chapter 17, rO cannot be expressed as 1/(λID) for short-channel
devices. The value of rO can be estimated from the slope of the ID characteristics in Fig. 11.2, but for
convenience and accuracy, we use simulations to plot rO for the reference transistor as a function of ID
(Fig. 11.13).

Sec. 11.4
Transistor Design
469
0.1
0.2
0.3
0.4
0.5
2
4
6
8
10
12
ID (mA)
rO (kΩ)
Figure 11.13
Output resistance of a 5-μm/40-nm NMOS device as a function of drain current.
▲
Example11.5
Determine the output resistance of M1 in Example 11.4.
Solution
The reference transistor in Example 11.4 carries a current of 100 μA, exhibiting an output resistance of 8 k. Since
both the width and the drain current are scaled up by a factor of 10, the output resistance drops by the same factor,
falling to 800 .
▲
11.4.2 Design for Given gm and I D
In many analog circuits, a given transistor must provide sufﬁcient transconductance while consuming
minimal power. We thus begin with a speciﬁed transconductance, gm1, and an upper limit for the drain
bias current, ID1, seek the corresponding values of W/L and VGS −VT H. In this section, we assume that
gm1 = 10 mS and ID1 = 1 mA. Of course, our ﬁrst task is to determine whether gm1 can be obtained at
all with ID ≤ID1. The maximum gm occurs in the subthreshold region (if W/L is large) and is given by
ID/(ξVT ), where ξ ≈1.5 (Chapter 2). For example, if ID = 1 mA, then gm cannot exceed 26 mS at the
room temperature.
Since in our example, gm1 < ID1/(ξVT ), we can proceed to design the transistor. The reader is
encouraged to ﬁrst read Example 11.3 carefully.
Step 1
Using simulations, we plot gm as a function of ID for a reference transistor, e.g., with
WRE F/Lmin = 5 μm/40 nm (Fig. 11.14).
Step 2
We identify the point (ID1, gm1) on the gm-ID plane and draw a line through the origin and this
point, obtaining the intersection at (ID,RE F, gm,RE F) = (240 μA, 2.4 mS) and a corresponding overdrive.
Step 3
We multiply WRE F by gm1/gm,RE F = 4.2 so as to travel on the straight line to point (ID1, gm1)
while maintaining the same overdrive (Example 11.3). This completes the design of the transistor.
The above procedure elicits two questions. First, does the straight line passing through the origin and
(ID1, gm1) always intersect the gm-ID plot? If we consider a square-law device in strong inversion, then
gm = √2μnCox(W/L)ID has a slope of inﬁnity at the origin, guaranteeing an intersection point. In the

470
Chap. 11
Nanometer Design Studies
0
0.1
0.2
0.3
0.4
0.5
0
0.5
1
1.5
2
2.5
3
3.5
4
ID (mA)
gm (mS)
Figure 11.14
Transconductance as a function of ID for W/L = 5 μm/40 nm.
gm
ID
ID1
gm1
Strong
Inversion
Weak
Inversion
Figure 11.15
Unachievable gm region.
subthreshold region, on the other hand, gm ∝ID (Fig. 11.15), which means that the (ID, gm) combinations
in the gray region are not achievable.
The second question is, what if (VGS −VT H)RE F is excessively large? As stipulated in Table 11.1,
we must then increase W further, but by what factor? Suppose, as shown in Fig. 11.16, an overdrive
of (VGS −VT H)2 < (VGS −VT H)RE F is desired. We then ﬁnd the corresponding current, ID2, and
transconductance, gm2, on the gm-ID plane. Next, we draw a line through the origin and the point (ID2,
gm2) and continue to ID = ID1, i.e., we multiply WRE F by ID1/ID2. The resulting width guarantees
an overdrive of (VGS −VT H)2 at a drain current of ID1 and provides a transconductance of at least
gm1. The new transconductance, g′
m1, is inevitably greater because the width has been increased beyond
gm1/gm,RE F (= ID1/ID,RE F).
11.4.3 Design for Given gm and VDS,min
In some designs, the transconductance is dictated by some performance requirements (voltage gain, noise,
etc.) and the minimum VDS by the voltage headroom—with no explicit speciﬁcation of ID. Of course,
each circuit eventually faces a power budget and hence an upper bound on its bias current(s).
The design procedure for obtaining a transconductance of gm1 at VDS,min in this case is as follows.
Step 1
We use simulations to plot the gm as a function of VGS −VT H for the reference transistor
(Fig. 11.17). Now, we select (VGS −VT H)1 = VDS,min and obtain the corresponding transconductance,
gm,RE F. In this case, it is helpful to plot ID on the same plane and ﬁnd ID,RE F at (VGS −VT H)1.

Sec. 11.4
Transistor Design
471
gm
ID
ID1
g'm1
ID,REF
ID2
(ID1, gm1)
gm1
gm2
(VGS − VTH)2
VGS − VTH
(VGS − VTH)REF
Figure 11.16
Modiﬁcation of transistor design for a lower overdrive.
gm
ID
gm,REF
ID,REF
(VGS − VTH)1
VGS − VTH
Figure 11.17
Calculation of gm,RE F
for a given overdrive.
Step 2
To reach the required transconductance, gm1, we scale the transistor width up by a factor of
gm1/gm,RE F. Note that ID scales by the same factor.
These two steps complete the design, but what if the resulting ID is excessively large? We can return
to Case II in Sec. 11.4.2 and redesign for a given gm and ID. The device is now wider and has a smaller
transconductance.
As can be seen from our procedures in this section, we have portrayed the overdrive voltage (or VD,sat)
as an indispensable dimension in our device design. This is because today’s low supply voltages have
made the problem of headroom more severe than ever.
11.4.4 Design for a Given gm
Our approach has assumed that the drain current and the overdrive voltage are speciﬁed and the other
device parameters must be determined. Since power consumption and voltage headroom prove critical in
today’s analog design, this assumption holds in most cases. However, suppose a design problem speciﬁes
only the transconductance, and we wish to compute the remaining parameters. How do we select the
transistor’s drain current, overdrive voltage, and dimensions?
Two scenarios must be envisaged. (1) We select a certain W/L and raise ID until we obtain the
desired transconductance, gm1. In this case, the required ID, and hence the power consumption, may
be excessive. More important, the overdrive voltage may be unacceptably large, leaving little headroom
for voltage swings. (2) We select a reasonable value for ID (perhaps according to a power budget) and

472
Chap. 11
Nanometer Design Studies
increase W/L to obtain gm1. In this case, however, we may not be able to reach gm1; increasing W/L
(and hence decreasing VGS) eventually drives the device into the subthreshold region, where gm cannot
exceed ID/(ξVT ). This means that the selected current is insufﬁcient, i.e., we should always brieﬂy check
to see if the upper limit given by ID/(ξVT ) can be met with the current budget.
The above scenarios indicate the need for a systematic approach to the selection of device parameters
when only gm1 is known. To this end, we return to the concept of the reference device and, using
simulations, construct two plots for it. Shown in Fig. 11.18, the two represent gm and VGS −VT H as a
function of ID.5 We begin by selecting a reasonable value for VGS −VT H, e.g., 200 mV, which points to
ID,RE F and gm,RE F. Now, we scale the width and the drain current by a factor of gm1/gm,RE F.
gm
ID
W = WREF
ID,REF
gm,REF
200 mV
VGS − VTH
Figure 11.18
Translation of overdrive
to gm,RE F.
What if the foregoing method yields an unacceptably high ID? We can choose a smaller overdrive,
e.g., 150 mV, and repeat the earlier steps.
11.4.5 Choice of Channel Length
If the selection of ID, VGS −VT H, and gm does not yield a sufﬁciently high rO, we must increase the
length of the transistor. Of course, to maintain the same drain current, overdrive voltage, and gm, the
width must also be increased proportionally. However, such scaling of the length and the width is not
straightforward because, as the drawn length is increased from Lmin to, say, 2Lmin, the effective length
rises from Lmin −2L D to 2Lmin −2L D, i.e., by a factor of less than 2. For this reason, we must use
simulations to construct the ID-VDS, gm and rO characteristics for several channel lengths, e.g., 60 nm,
80 nm, and 100 nm (drawn values).
11.5
Op Amp Design Examples
In this section, we wish to repeat the op amp design examples studied in Chapter 9 in 40-nm technology.
We target the following typical speciﬁcations:
- Differential Output Voltage Swing = 1 Vpp
- Power Consumption = 2 mW
- Voltage Gain = 500
- Supply Voltage = 1 V
5Here, VDS is constant and approximately equal to VDD/2. In nanometer technologies, different VDS values alter these
characteristics to some extent.

Sec. 11.5
Op Amp Design Examples
473
The single-ended output swing of 0.5 Vpp is small enough to make telescopic or folded-cascode op
amps a plausible choice. We therefore explore these topologies before deciding whether a two-stage op
amp is necessary.
A few notes about our transistor sizing methodology are warranted. We wish to begin with the mini-
mum allowable width and length unless otherwise dictated by current, transconductance, VD,sat, output
resistance, or other requirements. Interestingly, in the designs pursued in this chapter, all transistor widths
are greater than the minimum value. Also, for simplicity, we may scale the drawn W and L by the same
factor even though the effective W/L does not remain exactly constant.
11.5.1 Telescopic Op Amp
Can a telescopic-cascode op amp topology meet the above speciﬁcations? In this section, we explore this
possibility. It may not, but we will learn a great deal. Consider the circuit shown in Fig. 11.19. Of the
total supply current of 2 mA, we allow 50 μA for IRE F1, 50 μA for IRE F2, and 0.95 mA for each branch
of the differential pair. We must now allocate the transistor drain-source voltages so as to accommodate
a single-ended peak-to-peak output swing of 0.5 V; i.e., we must distribute the remaining 0.5 V over M9,
M1,2, M3,4, M5,6, and M7,8. Let us allow a VDS of 100 mV for each—even though the PMOS devices
have a lower mobility. With the bias currents and overdrives known, we can determine the W/L’s by
examining the transistor I/V characteristics.
VDD
M8
M1
M2
M6
M5
M3
M4
M7
M9
IREF1
IREF2
Mb1
Mb2
Figure 11.19
Telescopic-cascode op amp.
Before delving into details, however, we should pause and think about the feasibility of the design,
speciﬁcally in terms of the required voltage gain. We make three observations: (1) for L = 40 nm,
the intrinsic gain, gmrO, of NMOS devices is around 7 to 10 and that of PMOS devices around 5 to
7, (2) for reasonable device dimensions, it is difﬁcult to raise gmrO beyond 10 for PFETs (unless we
allow longer lengths and hence lower speeds), and (3) if we approximate gm as 2ID/(VGS −VT H) =
2 × 0.95 mA/100 mV = 19 mS, we estimate rO ≈530  from gmrO ≈10.
Let us now apply the foregoing values to the telescopic topology in Fig. 11.19. If gm1,2 ≈19 mS,
then for the gain, Gm Rout, to reach 500, the op amp output impedance must exceed 26 k. equal to
(gm5,6rO5,6)rO7,8, pointing to a serious limitation. However, with gm3,4rO3,4 ≈10 and rO7,8 ≈530 
(from the third observation above), we have (gm3,4rO3,4)rO1,2 ≈5.3 k, obtaining a voltage gain of only
about 100 even if the PMOS devices have λ = 0! This ﬁvefold deﬁcit makes the telescopic arrangement
impractical for a gain of 500.
Out of curiosity, we still continue with the design and see what performance we can achieve. To this
end, we use simulations to construct the I/V characteristics of NMOS and PMOS devices with L = 40 nm
and 80 nm, predicting that the minimum length exhibits an unacceptably low rO and gmrO. The simulation
parameters must also ensure that the devices remain in saturation for |VDS| ≥100 mV. Given that the

474
Chap. 11
Nanometer Design Studies
threshold and the overdrive elude a clear deﬁnition in nanometer technologies, we must adjust VGS in
simulations to ensure saturation.
The results are plotted in Fig. 11.20(a) for (W/L)N = 5 μm/40 nm and 10 μm/80 nm with VGS =
300 mV, and in Fig. 11.20(b) for (W/L)P = 5 μm/40 nm and 5 μm/80 nm with VGS = −400 mV.6
We should make some remarks. First, it is difﬁcult to distinguish between triode and saturation regions,
especially for PFETs. In fact, the 40-nm PMOS device behaves almost as a resistor and displays a
0
0.1
0.2
0.3
0.4
0
5
10
15
20
25
30
35
40
VDS (V)
ID (μA)
–0.4
–0.3
–0.2
–0.1
0
–60
–50
–40
–30
–20
–10
0
VDS (V)
ID (μA)
(a)
(b)
Figure 11.20
ID-VDS characteristics for (a) an NMOS device with VGS = 300 mV and W/L = 5 μm/40 nm
(black plot) or 10 μm/80 nm (gray plot), and (b) a PMOS device with VGS = −400 mV and W/L = 5 μm/40 nm
(black plot) or 5 μm/80 nm (gray plot).
6The width of the PMOS device is not scaled here to reveal the small change in ID as the drawn L is doubled. This occurs
because VT H falls as L increases from its minimum value (Chapter 17).

Sec. 11.5
Op Amp Design Examples
475
decreasing output impedance as |VDS| approaches 400 mV.7 For the other three characteristics, we can
roughly identify a “knee” point beyond which the slope falls considerably. The gate-source voltages have
been chosen to place this point below |VDS| = 100 mV.
Second, at VDS = 100 mV, the 10-μm/80-nm NMOS transistor provides an output resistance of
22.8 k and a drain current of 16 μA. If scaled up to carry 950 μA with the same terminal voltages, the
device exhibits an rO of 385 ! Similarly, the 5-μm/80-nm PMOS transistor has an rO of 18.45 k at
VDS = −100 mV with ID = 15 μA, thus offering rO = 290  if scaled up to carry 950 μA. These very
low rO values are quite discouraging, but we will continue to explore.
We now scale the NMOS and PMOS device widths to accommodate a drain current of 950 μA with
VGS,N = 300 mV, VGS,P = −400 mV, and |VDS| = 100 mV. The resulting design is shown in Fig. 11.21.8
As a general principle, we prefer to use minimum-length devices in the signal path so as to maximize
their speed (or at least minimize their capacitances for a given gm). It is surprising to see such large widths
in 40-nm technology for a drain current of 950 μA, an inevitable outcome of conﬁning |VDS| to 100 mV.
VDD
M8
M1
M2
B
Y
X
A
D
C
M6
M3
M4
M7
P
1.9 mA
Vb1
Vb2
Vb3
M5
320 μm
80 nm
320 μm
80 nm
300 μm
40 nm
300 μm
40 nm
ISS
Figure 11.21
First design of telescopic-
cascode op amp.
The bias voltages are tentatively chosen as follows: (a) the input common-mode level, VC M,in,
is equal to 100 mV for the tail current source plus VGS1,2(= 300 mV), (b) Vb1 is equal to VD1,2
(= 200 mV) plus VGS3,4(= 300 mV), (c) Vb2 is equal to VDD −|VDS7,8| −|VGS5,6|, and (d) Vb3 is
equal to VDD −|VGS7,8|. Upon simulating the circuit with these values, the reader may encounter a very
low or high output common-mode level. This effect arises from the absence of common-mode feedback
and hence the departure of |ID7,8| from 1.9 mA/2. We avoid this issue by a slight adjustment of Vb3
for now.
We perform a dc sweep simulation of the differential input voltage, Vin, and examine the voltages at
various nodes in Fig. 11.21 to ensure that the transistors are “healthy.” Plotted in Fig. 11.22, the drain
voltages of M1 and M2 are around 220 mV in the middle of the range. Similarly, the drain voltages of
M7 and M8 are close to the targeted value.
Next, we study the output behavior, depicted in Fig. 11.22 by VX and VY. The slope of each single-
ended output is approximately equal to 15 in the vicinity of Vin = 0, yielding a differential gain of 30,
far below our target. Can this design deliver a single-ended peak-to-peak swing of 0.5 V? We note that
the characterisitic becomes very nonlinear as each output rises toward 0.7 V. In fact, around this output
level, the slope gives a differential gain of about 6.4.
7As explained in Chapter 17, the fall in the output impedance arises from drain-induced barrier lowering (DIBL).
8The bulks of M5 and M6 are tied to their respective sources so as to remove body effect. While not essential, this arrangement
reduces |VGS5,6|, providing more comfortable margins in the design.

476
Chap. 11
Nanometer Design Studies
–20
–10
0
10
20
160
170
180
190
200
210
220
230
240
–20
–10
0
10
20
200
300
400
500
600
700
800
–20
–10
0
10
20
885
890
895
900
905
910
Vin (mV)
VC, VD (mV)
VX, VY (mV)
VA, VB (mV)
Figure 11.22
Behavior of the voltages at the drains of input transistors (VA, VB), the output nodes (VX, VY ), and
the drains of PMOS current sources (VC, VD).

Sec. 11.5
Op Amp Design Examples
477
▲
Example11.6
The slope of the characteristics in Fig. 11.22 predicts a differential gain of 3 from the input to nodes A and B. Explain
the reason for such a high gain at the cascode nodes.
Solution
Recall from Chapter 3 that the impedance seen at the source of a cascode device is roughly equal to the impedance
seen at its drain divided by its gmrO. Due to the low gmrO, the impedance seen at A and B is quite a lot higher than
1/gm3,4, leading to a large gain.
▲
Let us raise the gain by increasing (W/L)3,4 to 600 μm/80 nm. Plotted in Fig. 11.23, the characteristics
exhibit a gain of about 54 but still a limited output swing.
Bias Circuit
The op amp of Fig. 11.21 relies on the proper choice of ISS, Vb1, Vb2, and Vb3. We
must therefore design a circuit to generate these bias quantities. We recognize that ISS and Vb3 must be
established by current mirror action (why?) and Vb2 by low-voltage cascode biasing. The bias voltage
Vb1 requires a different approach.
We begin with ISS = 1.9 mA, choosing a channel length of 40 nm and, scaling from Fig. 11.20, a
width of 600 μm for VDS = 100 mV. Utilizing a reference budget current of 25 μA, we arrive at the
arrangement shown in Fig. 11.24(a), where W12 is scaled down from W11 by a factor of 1.9 mA/25 μA.
Since M11 operates with a VDS of 100 mV, we insert R1 in series with the drain of M12 and select its
value such that VDS12 = VGS12 −VR1 = 100 mV.
The above bias design is still sensitive to the CM level sensed by M1 and M2 because VDS11 =
VC M,in −VGS1,2, whereas VDS12 = VGS1,2 −VR1. In other words, we must ensure that the drain voltage
of M12 tracks VC M,in. This can be accomplished as shown in Fig. 11.24(b), where R1 is replaced by a
differentialpairdrivenby Vin1 and Vin2.Withproperscalingofthewidths,wenowhave VGS13,14 = VGS1,2,
and hence VDS12 = VDS11.
Next, we deal with the generation of Vb1 in Fig. 11.21. This voltage must be equal to VGS3,4 +
VDS1,2 + VP, where VDS1,2 = 100 mV. Since Vb1 is higher than VP by VGS3,4 + VDS1,2, we surmise that
a diode-connected device in series with a drain-source voltage added to VP can produce Vb1. Illustrated
in Fig. 11.25, the idea is to match VGS15 to VGS3,4 and VDS16 to VDS1,2. The bias current Ib must be
much less than ISS so as to negligibly affect the power budget. We select Ib = 15 μA, and hence
(W/L)15,16 = 10 μm/80 nm.9 It is important to observe how Vb1 tracks VC M,in: if VC M,in goes up, so do
VP and, consequently, Vb1, thus keeping VDS1,2 constant. That is, M15 and M16 operate as level shifters.
If Vb1 were constant, a rise in VC M,in would inevitably reduce VDS1,2 and the gain.
In order to generate Vb3 and Vb2, we construct a low-voltage cascode bias network as shown in
Fig. 11.26. Here, transistors M17 and M18 are scaled down from M7,8 and M5,6, respectively, ensuring
that VDS17 = VDS7,8. To create Vb2 = VDD −|VDS7,8| −|VGS5,6|, we again employ a diode-connected
device, M20, in series with a VDS (produced by M19).
We should emphasize that the very narrow voltage margins dictated by the low supply make this design
sensitive to mismatches between the bias branches and the core of the circuit. For example, a mismatch
between VGS18 and VGS5,6 can leave less |VDS| for M7,8, pushing these two current sources below the knee
point. Also, note that we still have a few ideal current sources, which would be copied from a bandgap
reference (Chapter 12).
Common-Mode Feedback
With various mismatches present in the above op amp design, the PMOS
currents in Fig. 11.21 are not exactly equal to ISS/2, forcing the output CM level toward VDD or ground
9With the values chosen here, VDS16 < VDS1,2 because VGS16 > 300 mV (why?). For this reason, some adjustment in
simulations is necessary.

478
Chap. 11
Nanometer Design Studies
–20
–10
0
10
20
150
160
170
180
190
200
210
–20
–10
0
10
20
100
200
300
400
500
600
700
800
–20
–10
0
10
20
885
890
895
900
905
910
Vin (mV)
VC, VD (mV)
VX, VY (mV)
VA, VB (mV)
Figure 11.23
Behavior of the voltages at the drains of input transistors (VA, VB), the output nodes (VX, VY ), and
the drains of PMOS current sources (VC, VD).

Sec. 11.5
Op Amp Design Examples
479
M1
M13
M14
M2
M11
M12
VDD
R1
8 kΩ
25 μA
600 μm
40 nm
40 nm
8 μm
300 mV
M1
M2
M11
M12
VDD
25 μA
600 μm
40 nm
40 nm
8 μm
40 nm
4 μm
40 nm
300 μm
1.9 mA
(a)
(b)
Figure 11.24
(a) Simple and (b) more accurate biasing for tail current source.
M1
M2
M4
M3
M15
M16
ISS
Ib
VDD
Vb1
P
X
Y
Figure 11.25
Generation of cascode
gate bias voltage.
VDD
M8
M6
M5
M7
M17
Vb3
M18
15 μA
M19
M20
15 μA
Vb2
(n−wells tied to sources)
X
Y
W
L
80 nm
5 μm
(     )17−20 =
Figure 11.26
Generation of bias for
PMOS cascode current sources.
and hence requiring CMFB. We must sense the output CM level, VC M, and feed the result back to the
NMOS or PMOS current sources.
Recall from Chapter 9 that the CM level can be sensed by resistors, triode transistors, or source
followers. The high output impedance of the op amp dictates very large resistors,10 and the tight voltage
margins demand precise CM control and preclude triode devices. The only solution, source followers,
however, cannot measure the CM level across a wide output swing. As shown in Fig. 11.27(a), if VX
(or VY) falls (in response to differential signals), I1 (or I2) eventually collapses, disabling the source
follower. But, is it possible to complement the NMOS followers by PMOS counterparts? Consider the
arrangement depicted in Fig. 11.27(b), where PMOS followers M23 and M24 also sense the output CM
10In addition to occupying a signiﬁcant area, large resistors also degrade the CM loop stability, as explained later.

480
Chap. 11
Nanometer Design Studies
X
Y
I4
R4
R3
V2
I3
M24
M23
M22
I2
M21
I1
R2
R1
V1
M22
I2
M21
I1
R2
R1
V1
R2
R1
R4
R3
 VCM − VGS22
VCM + ∣VGS24∣
VCM + ∣VGS23∣
 VCM − VGS21
(c)
(a)
(b)
Vtot
M6
M6
M5
M4
X
Y
M3
M5
M4
M3
Figure 11.27
(a) CM level reconstruction using NMOS source followers, (b) CM level reconstruction using
complementary source followers, and (c) combining network.
level and drive R3 and R4, respectively. We recognize that V1 is lower than VC M by VGS21,22 and V2 is
higher than VC M by |VGS23,24|:
V1 = VC M −VGS21,22
(11.10)
V2 = VC M + |VGS23,24|
(11.11)
We therefore surmise that a linear combination of V1 and V2 can remove the VGS terms, yielding a value
in proportion to VC M. That is, if
αV1 + βV2 = (α + β)VC M −αVGS21,22 + β|VGS23,24|
(11.12)
then we must choose αVGS21,22 = β|VGS23,24|, obtaining αV1 + βV2 = (α + β)VC M. We also choose
α + β = 1 so that the reconstructed value is equal to the op amp output CM level.
The weighting factors, α and β, can readily be implemented by R1–R4 in Fig. 11.27(b). In fact, if V1
and V2 are shorted, the weighted sum of V1 and V2 is produced. With the aid of the equivalent circuit in
Fig. 11.27(c), the reader can show that
Vtot = VC M + RN|VGS23,24| −RPVGS21,22
RN + RP
(11.13)
where RN = R1 = R2 and RP = R3 = R4. We therefore choose RN/RP = VGS21,22/|VGS23,24|.
In order to evaluate the feasibility of the above idea, we ﬁrst run a dc sweep in simulations and
examine the behavior of Vtot. We select a bias current of 10 μA (slightly exceeding the power budget),
W/L = 10 μm/40 nm for all of the source followers, and RN = RP = 20 k. The 10-μA bias current
sources are also implemented as transistors (with W/L = 10 μm/40 nm) to ensure a realistic behavior as
VX and VY approach VDD or ground.11 Figure 11.28 plots the outputs, their actual common-mode level,
deﬁned as (VX + VY)/2, and the reconstructed counterpart, Vtot. We note that Vtot closely follows the
CM level of VX and VY.
11Ideal current sources would allow the source voltages to exceed the supply rails.

Sec. 11.5
Op Amp Design Examples
481
–20
–10
0
10
20
0
100
200
300
400
500
600
700
800
Vin (mV)
(mV)
VX
VY
Vtot
(VX + VY)/2
Figure 11.28
Actual CM level, (VX + VY )/2, and reconstructed CM level, Vtot, of cascode op amp as a function
of input differential voltage.
In the next test, let us close the CM feedback loop: we compare Vtot to a reference, amplify the error,
and return the result to control ISS. To this end, we design the error ampliﬁer as a ﬁve-transistor OTA
with W/L = 5 μm/80 nm for all transistors, a tail current of 20 μA, and a voltage gain of 10. The output
of this ampliﬁer controls a fraction of the main tail current, I1 (Fig. 11.29). For example, if we expect
20% mismatch between the PMOS current sources in the op amp and the tail current source, we choose
I1 ≈0.2ISS. Figure 11.29 depicts the result, where the OTA’s input and output connections are chosen
so as to establish negative feedback around the loop.
M1
M2
M3
M4
MT
MG
ISS − I1
I1
Op Amp Core
Vref
Vtot
G
H
20 μA
20 kΩ 
20 kΩ 
20 kΩ 
20 kΩ 
Figure 11.29
CMFB loop around telescopic op amp.
▲
Example11.7
Explain why the OTA in Fig. 11.29 employs PMOS (rather than NMOS) input devices.
Solution
The choice is dictated by two considerations. First, these transistors must sense the CM level while leaving sufﬁcient
VDS for their tail current source. With Vtot ≈VDD/2 in this case, there is no particular preference for NMOS or
PMOS devices. Second, the output of the OTA should have a nominal dc value compatible with that required by MT .

482
Chap. 11
Nanometer Design Studies
Since VH = VG (in the absence of mismatches), and since VG is equal to the gate-source voltage of a diode-connected
NMOS transistor, we expect that MT nominally copies the bias current of MG (with a multiplication factor).
▲
Figure 11.30 shows the closed-loop dc sweep results with Vref = 0.5 V.
−20
−10
0
10
20
500
501
502
503
504
505
506
507
508
(mV)
Vtot
Vin (mV)
(VX+VY)/2
Figure 11.30
Closed-loop behavior of actual CM level, (VX + VY )/2, and reconstructed CM level, Vtot, of
cascode op amp as a function of input differential voltage.
By virtue of feedback, the CM variation is greatly reduced as VX and VY reach high or low values.
Next, we create a 10% mismatch between the PMOS current sources (M7 and M8 in Fig. 11.21) and
ISS/2 = 950 μA and repeat the dc sweep. Figure 11.31 depicts the variations, indicating that CMFB
suppresses the mismatch by adjusting I1.
–20
–10
0
10
20
475
480
485
490
495
Vin (mV)
(mV)
Vtot
(VX+VY)/2
Figure 11.31
Closed-loop behavior of actual CM level, (VX + VY )/2, and reconstructed CM level, Vtot, of
cascode op amp in the presence of mismatch between tail and PMOS current sources.
CMFB Stability
We must investigate the stability of the CM loop. This is accomplished by placing the
overall op amp in its intended feedback system, applying differential pulses at the input, and examining

Sec. 11.5
Op Amp Design Examples
483
the differential and common-mode behavior of the output. Figure 11.32(a) shows a feedback topology
for a nominal closed-loop gain of 2, and Fig. 11.32(b) depicts a more detailed diagram highlighting the
CM feedback loop.12
100 kΩ
R2 
R1
50 kΩ 
R2
100 kΩ 
50 kΩ
R1 
50 mV
50 mV
VDD
M8
M1
M2
M6
M5
M3
M4
M7
M9
CM
Extraction
MT
H
P
Vref
Vtot
Y
X
(a)
(b)
Figure 11.32
(a) Closed-loop ampliﬁer for transient analysis, and (b) detailed view showing the CMFB loop.
Plotted in Fig. 11.33 are the output waveforms in response to an input step, revealing common-mode
instability. As evident from Fig. 11.32(b), the CM loop contains a pole at the input of the error ampliﬁer,
one at node H, one at node P, one at the sources of the NMOS cascode devices, and one at the main
outputs. The loop therefore demands compensation.
0
10
20
30
40
300
350
400
450
500
550
600
650
700
Time (ns)
VX, VY (mV)
Figure 11.33
Transient response revealing CM loop instability.
▲
Example11.8
We wish to study the CM loop frequency response and obtain the phase margin. Should the differential feedback be
present when the CM loop is broken? In other words, which of the two topologies in Fig. 11.34(a) should be used to
determine the CM loop transmission?
12Since a telescopic-cascode op amp does not easily lend itself to equal input and output CM levels, two 1-μA constant current
sources (not shown) are tied from the inputs of the op amp to ground, shifting the input CM level down by 100 mV.

484
Chap. 11
Nanometer Design Studies
H
R1
R2
R2
R1
CM
Extraction
CM
Extraction
CM
Extraction
MT
MT
H
Vref
Vtot
Vref
Vtot
Vref
Vtot
Vref
Vtot
(a)
M1
M2
Vin
VDD
P
VDD
VDD
M1 + M2
M1 + M2
P
Vt
CM
Extraction
C1
VF
Vt
C1
VF
R1‖R1
R2‖R2
(c)
(b)
Figure 11.34
Solution
Common-mode feedback must ultimately behave well with differential feedback present. This is because the actual
environment in which CMFB must be stable incorporates differential feedback. As an example, consider the simple
op amp shown in Fig. 11.34(b). For CM analysis, the two sides can be merged into one, yielding the two possible
scenarios depicted in Fig. 11.34(c) if the differential feedback is absent or present. Obtained as −VF/Vt, the CM
loop transmissions derived for these two cases are not necessarily the same. For example, if the capacitance at the
drain, C1, is considered, the pole associated with this node assumes different values in the two topologies. Thus, we
must maintain differential feedback while studying CM stability.
▲
Let us break the CM loop in Fig. 11.32(b) at node H as shown in Fig. 11.35. Here, the error ampliﬁer
drives a dummy device, Md, identical to MT so as to see the loading effect of the latter. Plotted in
VDD
M8
M1
M2
M6
M5
M3
M4
M7
M9
CM
Extraction
MT
H
P
Vref
Vtot
Y
X
Vt VF
Md
VDD
Error
Ampliﬁer
Figure 11.35
Measurement of CMFB loop transmission.

Sec. 11.5
Op Amp Design Examples
485
Fig. 11.36(a) are the magnitude and phase of −VF/Vt as a function of frequency, revealing a phase of
−190◦at the unity-gain frequency. We seek a convenient node for compensation. Unfortunately, the error
ampliﬁer in Fig. 11.29 does not provide signal inversion from Vtot to H and hence cannot employ Miller
compensation.
–20
0
20
40
Magnitude (dB)
106
107
108
109
–300
–200
–100
0
Frequency (Hz)
Phase (Deg.)
–100
–50
0
50
Magnitude (dB)
106
107
108
109
–300
–200
–100
0
Frequency (Hz)
Phase (Deg.)
(a)
(b)
Figure 11.36
CMFB loop transmission (a) before and (b) after compensation.
Can we compensate the CM loop by adding capacitance from high-impedance nodes X and Y to
ground? Yes, but this also affects the differential response. Instead, we tie a 3-pF capacitor from the error
ampliﬁer output to ground, obtaining the response shown in Fig. 11.36(b) and a phase margin of about
50◦. The closed-loop pulse response depicted in Fig. 11.37(a) implies that the common-mode feedback
loop is now properly compensated and the CM level incurs little ringing.
Differential Compensation
Why do VX and VY in Fig. 11.37(a) exhibit differential ringing? This is
because the pole formed by the large resistors in the feedback network of Fig. 11.32(a) and the input

486
Chap. 11
Nanometer Design Studies
0
10
20
30
40
350
400
450
500
550
600
650
Time (ns)
0
10
20
30
40
400
450
500
550
600
Time (ns)
VX, VY (mV)
VX, VY (mV)
(a)
(b)
Figure 11.37
Transient response with (a) CMFB loop compensation and (b) additional differential compensation.
capacitance of the op amp is located at a low frequency, degrading the phase margin (of differential
feedback). To compensate the differential signal path, we connect two 7-fF capacitors from the outputs
of the op amp to its inputs (in parallel with the feedback resistors) so as to create Miller multiplication.
Shown in Fig. 11.37(b), the resulting response is now well behaved. This pole-zero cancellation technique
is studied in Problem 11.14.
▲
Example11.9
Explain what design modiﬁcations are necessary if the op amp drives a signiﬁcant load capacitance, CL.
Solution
The load capacitance lowers the magnitude of the pole at X (and Y), increasing the differential signal path phase
margin (Chapter 10) while decreasing the CM loop phase margin. For this reason, the capacitance tied to the error

Sec. 11.5
Op Amp Design Examples
487
ampliﬁer output must be increased, or the pole at X and Y must become the dominant pole for the CM loop
as well.
▲
Design Summary
In this section, we have attempted to design a telescopic-cascode op amp for a
voltage gain of 500 and a differential output swing of 1 Vpp. Neither speciﬁcation could be met with a
1-V supply, but we have established the steps that one must complete in order to arrive at the ﬁnal design.
Speciﬁcally, we have dealt with the following general principles:
1. Allocation of VDS and ID to transistors according to required swings and power dissipation,
respectively
2. Characterization and scaling of MOSFETs for allowable VDS and desired current level
3. Quick estimate of the achievable voltage gain
4. Use of dc sweep to study bias conditions and nonlinearity
5. Design of bias circuitry using current mirrors and low-voltage cascodes
6. Common-mode feedback design and compensation
7. Use of closed-loop transient analysis to study CM and differential stability
As seen in subsequent sections, these principles provide a systematic approach to the design of op amps.
The next natural candidate for our op amp design is the folded cascade. However, our gain calculations
for the telescopic cascode roughly apply here as well, predicting that it is extremely difﬁcult to achieve
a gain of 500. For this reason, we do not pursue the folded-cascode topology for these speciﬁcations.
11.5.2 Two-Stage Op Amp
Both the relatively high voltage gain and the 1-Vpp swing point to a two-stage conﬁguration as a feasible
candidate. We note that a gain of 500 dictates the use of cascoding in the ﬁrst stage, encouraging us
to utilize the telescopic design from the previous section (Fig. 11.21). However, two points must be
borne in mind. First, the previous design exhausts the power budget, leaving none for the second stage.
Second, with a gain of about 50 in the ﬁrst stage, the gain of the second stage can be around 10. Thus,
the single-ended peak-to-peak swing at the outputs of the ﬁrst stage can be as small as 50 mV, allowing
us to redesign the cascode for greater VDS’s and hence more robust operation.
We must ﬁrst partition the power budget between the two stages, a task requiring speed and/or noise
speciﬁcations. We split the power equally here; further optimization could be pursued after one round of
complete design. With about 100 μA reserved for the bias network, we allocate 1.9 mA/4 = 475 μA to
each branch of transistors in the ﬁrst and second stages.
First-Stage Design
The telescopic-cascode conﬁguration must accommodate a single-ended swing of
50 mVpp, allowing 0.95 V for the sum of ﬁve VDS’s. With some margin, we choose VDS,N = 150 mV
and VDS,P = 200 mV and simulate our reference transistors (W/L = 5 μm/40 nm and 10 μm/80 nm),
seeking acceptable knee voltages. Shown in Fig. 11.38 for VGS,N = 350 mV and VGS,P = −450 mV,
the characteristics exhibit substantially higher drain currents than those in Sec. 11.5.1. It is interesting to
note that, as a result of velocity saturation, the knee voltage has not increased by 50 mV. The width of
the NMOS transistors in the signal path must be scaled by a factor of 450 μA/50 μA for either L = 40
nm or L = 80 nm. Similarly, the width of the PMOS device must be scaled by a factor of 450 μA/90
μA for L = 80 nm. We also choose for the tail current device W = (900 μA/50 μA) × 10 μm and
L = 80 nm. The cascode-stage devices are thus much narrower than those used in the previous section.
The ﬁrst-stage design is shown in Fig. 11.39(a) and its simulated behavior in Fig. 11.39(b), revealing a
gain of about 50. The biasing of this stage is similar to that described in Sec. 11.5.1.

488
Chap. 11
Nanometer Design Studies
0
0.1
0.2
0.3
0.4
0
20
40
60
80
100
VDS (V)
ID (μA)
ID (μA)
–0.4
–0.3
–0.2
–0.1
0
–120
–100
–80
–60
–40
–20
0
VDS (V)
(a)
(b)
Figure 11.38
ID-VDS characteristics for (a) an NMOS device with VGS = 350 mV and W/L = 5 μm/40 nm
(gray plot) or 10 μm/80 nm (black plot), and (b) a PMOS device with VGS = −450 mV and W/L = 5 μm/40 nm
(gray plot) or 10 μm/80 nm (black plot).
▲
Example11.10
In order to determine, with the aid of simulation, the small-signal resistance seen at node X in Fig. 11.39(a), a student
sets the input signal to zero, ties a unit ac current source from this node to ground, and measures the resulting voltage.
Explain why this test overestimates the resistance.
Solution
The voltage developed at X causes a current to ﬂow through rO3 to the drain of M1 and through rO1 to the source of
M2. In other words, since M1 is degenerated by M2, the resistance at X is overestimated. To avoid this error, a large

Sec. 11.5
Op Amp Design Examples
489
X
Y
VDD
M8
M1
M2
M6
M3
M4
M7
P
Vb1
Vb2
Vb3
M5
80 nm
80 nm
40 nm
80 nm
90 μm
80 nm
180 μm
(a)
(b)
45 μm
50 μm
50 μm
–20
–10
0
10
20
200
300
400
500
600
700
800
Vin (mV)
VX, VY (mV)
Figure 11.39
(a) First stage design, and (b) its input-output characteristics.
capacitance must be tied from the source of M1 to ground to create a short circuit at the test frequency. Alternatively,
we can attach the ac current source between X and Y, measure the resistance, and divide the result by two.
▲
Second-Stage Design
The second stage must provide a voltage gain of about 10, dictating channel
lengths greater than 40 nm for both NMOS and PMOS devices. Do we use an NFET or a PFET for
the input of the second stage? The need for gain may point to an NFET due to its higher gmrO, but we
must examine the situation more closely. Bearing in mind that the output CM level of the ﬁrst stage
is around 0.55 V, let us consider a transistor having W/L = 10 μm/80 nm and determine its gmrO
if it is an NFET with VGS ≈0.55 V or a PFET with |VGS| ≈0.45 V. Using simulations, we obtain
(gmrO)N = 12.8 and rON = 1.86 k at VDS = 0.5 V and ID = 900 μA, and (gmrO)P = 17.5
and rO P = 9.75 k at |VDS| = 0.5 V and |ID| = 110 μA. We therefore select the PFET and scale
its width to (450 μA/110 μA) × 10 μm ≈41 μm to accommodate the nominal bias current. With
W/L = 41 μm/80 nm, such a device exhibits an output resistance of 2.38 k. The drain of the PFET is
tied to an NMOS current source.
The NMOS current source output resistance must not lower the gain of the second stage, |Av2|, below
10. Writing |Av2| = gmP(rO P||rON) ≥10, we have rON ≥1.33rO P = 3.0 k at ID = 475 μA. If the
10-μm/80-nm NFET considered above with rO = 1.86 k and ID = 900 μA is scaled down by a factor
of 2, it yields rON = 3.72 k, which is close to the desired value.
Figure 11.40(a) shows the op amp developed thus far, and Fig. 11.40(b) plots the input-output charac-
teristics. In order to determine the maximum output swing that the op amp can handle, we plot the slope
of the differential characteristic in Fig. 11.40(c), noting that the differential output cannot exceed 450 mV
if the gain must not drop below 500. To resolve this issue, we double the width and length of the output
NFETs, raising the gain and arriving at the results depicted in Fig. 11.41. Now, the single-ended swing
reaches 530 mV for a minimum gain of 500. Of course, the gain variation (nonlinearity) is unabated,
posing difﬁculties in some applications.
Common-Mode Feedback
As explained in Chapter 9, two-stage op amps generally require CMFB for
both stages. For the ﬁrst stage, we can utilize the CMFB scheme illustrated in Fig. 11.29. We therefore
focus on CMFB for the second stage.
The second stage can also incorporate the method of Fig. 11.29 and control the NMOS current sources.
However, the lower output impedance here allows the use of resistors for direct sensing of the CM level,

490
Chap. 11
Nanometer Design Studies
−2
−1
0
1
2
0
200
400
600
800
1000
Vin (mV)
Vout1, Vout2 (mV)
−2
−1
0
1
2
100
200
300
400
500
600
700
Vin (mV)
Gain
(c)
(b)
M8
M1
M2
M6
M3 M4
M7
X
Y
P
Vb1
Vb2
Vb3
M5
VDD
M10
M9
M12
80 nm
41 μm
(a)
5 μm
80 nm
M11
Vout2
Vout1
Figure 11.40
(a) Two-stage op amp design, (b) its input-output characteristics, and (c) its gain variation.
simplifying the design. Consider the topology depicted in Fig. 11.42(a), where R1 and R2 (≈30 k)
reconstruct the CM level at node G, applying the result to the gates of M11 and M12. Under equilibrium,
the resistors draw no current, establishing an output CM voltage equal to VGS11,12. This voltage varies
by about 50 mV with PVT, a value that can be tolerated in this design. Note that this CMFB loop
is stable.
What if VGS11,12 is not close to the desired output CM level? As shown in Fig. 11.42(b), if we inject
a current IB into node G, the output CM level is shifted by IB R1/2(= IB R2/2). For example, a shift of
100 mV requires a current of (100 mV/30 k) × 2 = 6.7 μA. A positive IB shifts the CM level down
and vice versa.
Frequency Compensation
The two-stage op amp designed above contains several poles and most
likely demands compensation. Recall from Chapter 10 that the ﬁrst nondominant pole of two-stage op
amps typically arises from the output node and hence depends on the load capacitance, CL. The stability

Sec. 11.5
Op Amp Design Examples
491
−2
−1
0
1
2
0
200
400
600
800
1000
Vin (mV)
Vout1, Vout2 (mV)
−2
−1
0
1
2
0
100
200
300
400
500
600
700
800
Vin (mV)
Gain
(b)
(a)
Figure 11.41
(a) Input-output characteristics and (b) gain variation of modiﬁed two-stage op amp with
(W/L)11,12 = 10 μm/0.16 μm.
M8
M1
M2
M6
M3
M4
M7
P
Vb1
X
Y
Vb2
Vb3
M5
VDD
M10
M9
M11
M12
R2
R1
G
10 μm
0.16 μm
10 μm
0.16 μm
41 μm
80 μm
Vout2
Vout1
M11
M12
R2
R1
G
IB
(a)
(b)
VDD
Figure 11.42
(a) Simple common-mode feedback around the second stage; (b) injection of current to shift
CM level.
analysis must therefore assume a value of CL, which itself is given by the environment in which the op
amp is used. Let us choose a single-ended load capacitance of 1 pF in this example, obtaining an output
pole frequency of around 90 MHz. We begin the study with the open-loop op amp, bearing in mind that
the feedback network may add its own effects and eventually require further modiﬁcations.
Plotted in Fig. 11.43 are the open-loop (differential) magnitude and phase response of the circuit,
revealing a low-frequency gain of 57 dB (≈700), a unity-gain frequency of 3.2 GHz, and a phase margin
of about −8◦. This bandwidth appears very impressive, but we also note that the phase reaches −120◦at
240 MHz. In other words, after compensation for 60◦phase margin, the unity-gain bandwidth can drop
by a factor of 13!

492
Chap. 11
Nanometer Design Studies
–20
0
20
40
60
Magnitude (dB)
105
106
107
108
109
1010
–250
–200
–150
–100
–50
0
Frequency (Hz)
Phase (Deg.)
Figure 11.43
Frequency response of open-loop op amp.
▲
Example11.11
The above results are rather curious: the output pole is located around 90 MHz, suggesting a phase of about −135◦
at this frequency, but the actual phase is around −85◦at this frequency. Explain the reason for this behavior.
Solution
In the above design, we cannot say that the phase reaches −135◦at the second pole because the poles are not widely
spaced. In fact, the pole at X in Fig. 11.42 is around 95 MHz. The pole at X and the output pole produce at 90 MHz
a phase shift of −tan−1(90/95) −tan−1(90/90) ≈−88◦.
We express the phase shift at 240 MHz due to these two poles as −tan−1(240 MHz/95 MHz)−tan−1(240 MHz/
90 MHz) = −138◦. Why does this result disagree with the simulated value of −120◦? This is because the gate-drain
capacitance of the output PMOS transistor creates some pole splitting, raising the output pole beyond 90 MHz and
lowering the pole at X below 95 MHz.
▲
In order to compensate the op amp, we begin at 240 MHz and 0 dB on the magnitude plot in Fig. 11.43
and draw a straight line toward the y-axis with a slope of −20 dB/dec. The frequency at which this line
intersects the magnitude plot is roughly equal to 240 MHz/700 = 344 kHz (why?), yielding the desired
value for the dominant pole.
Which node should produce the dominant pole: X or the output node? We prefer the former for two
reasons, namely, a smaller compensation capacitance due to Miller multiplication and pole splitting;
neither of these beneﬁts accrues if the dominant pole is established at the output.
With the output resistance of 8 k seen at node X and a voltage gain of about 12 provided by the
output stage, we choose a Miller compensation capacitor, CC, equal to 4.5 pF so as to create a 344-kHz
pole at this node. Figure 11.44 shows the resulting open-loop frequency response, conﬁrming that the
dominant pole is now located around 340 kHz. Unfortunately, the gain crossover occurs at 350 MHz and
the phase margin is only 18◦because the zero introduced by CC, ωz = gm10/CC, is as low as 250 MHz.
As explained in Chapter 10, we can insert a resistor, Rz, in series with CC so as to move the zero to
the second pole, ωp2. The second pole can be roughly estimated from Fig. 11.44 as the frequency at

Sec. 11.5
Op Amp Design Examples
493
–20
0
20
40
60
VDD
M10
M12
CC
Magnitude (dB)
105
106
107
108
109
–300
–200
–100
0
Frequency (Hz)
Phase (Deg.)
4.5 pF
Figure 11.44
Frequency response of compensated open-loop op amp with CC = 4.5 pF.
which ̸ H reaches −135◦and is equal to 185 MHz. Selecting Rz according to (ωp2CC)−1 = 190 , we
observe the response depicted in Fig. 11.45(a). The phase margin rises to 96◦because of the pole-zero
cancellation.
The phase margin revealed by Fig. 11.45(a) suggests that the compensation capacitor can be smaller
and the unity-gain bandwidth larger. By some iteration, we choose CC = 0.8 pF and Rz = 450 , arriving
at the response shown in Fig. 11.45(b). Remarkably, the op amp now exhibits a unity-gain bandwidth of
1.9 GHz with a phase margin of 65◦.
Closed-Loop Behavior
We now conﬁgure the op amp as a closed-loop ampliﬁer having a nominal
gain of 2 and a load capacitance of 1 pF [Fig. 11.46(a)]. The small-signal transient response appears
as shown in Fig. 11.46(b), exhibiting signiﬁcant ringing. Why does this happen despite the 65◦phase
margin obtained above? This is due to the large resistance values used in the feedback network. We draw
the single-ended equivalent as in Fig. 11.47(a) for the loop transmission calculation, observing that an
open-loop pole around [2π(100 k||50 k)Cin]−1 ≈95 MHz is formed at the input of the op amp.
In order to improve the closed-loop stability, we can reduce R1 and R2 in Fig. 11.47(a) to, say,
25 k and 50 k, respectively, before the open-loop gain falls appreciably, but this remedy only doubles
the input pole frequency. Alternatively, we can increase the resistance in series with the compensation
capacitors from 450  to 1500 , arriving at the response shown in Fig. 11.47(b). The circuit now settles
much faster.
We conclude this section with two remarks. First, the op amp has been compensated for unity-gain
feedback, whereas the topology of Fig. 11.46 operates with a feedback factor of 50 k/150 k = 1/3.
Thus, the compensation capacitance can be reduced to lower the phase margin to around 60◦. Second,
the design has assumed the “typical-NMOS, typical-PMOS” (TT) corner of the process, a temperature
of 27◦C, and a constant supply of 1 V. In practice, we must account for other corners (e.g., SS or FF),
the required temperature range (e.g., 0◦C to 75◦C), and supply variations (e.g., by ±5%). To meet the
speciﬁcations under all of these conditions, the design must often be more conservative in terms of gain,
swings, and power consumption than that presented here.

494
Chap. 11
Nanometer Design Studies
–50
0
VDD
CC
Rz
M10
M12
50
100
Magnitude (dB)
105
106
107
108
109
1010
–200
–150
–100
–50
0
Frequency (Hz)
Phase (Deg.)
4.5 pF 190 Ω
VDD
CC
Rz
M10
M12
0.8 pF 450 Ω
–50
0
50
100
Magnitude (dB)
–200
–150
–100
–50
0
Phase (Deg.)
(a)
105
106
107
108
109
1010
Frequency (Hz)
(b)
Figure 11.45
Frequency response of open-loop amp with (a) CC = 4.5 pF and RZ = 190 , and
(b) CC = 0.8 pF and RZ = 450 .

Sec. 11.6
High-Speed Ampliﬁer
495
(a)
(b)
0
10
20
30
40
470
480
490
500
510
520
530
Time (ns)
Vout1, Vout2 (mV)
100 kΩ
R2 
50 kΩ
R1 
R1
50 kΩ 
R2
100 kΩ 
1 pF
1 pF
Figure 11.46
(a) Closed-loop ampliﬁer and (b) its step response.
50kΩ
100 kΩ
Cin
1 pF
50 fF
CL
(a)
(b)
0
10
20
30
40
470
480
490
500
510
520
530
Time (ns)
Vout1, Vout2 (mV)
Figure 11.47
(a) Equivalent circuit of closed-loop ampliﬁer and (b) step response with Rz = 1500 .
11.6
High-Speed Ampliﬁer
Some applications require an ampliﬁer with fast settling and accurate gain. For example, “pipelined”
ADC architectures can tolerate but a small gain error in their constituent ampliﬁers. In this section, we
design a differential ampliﬁer according to the following speciﬁcations:
- Voltage gain = 4
- Gain error ≤1%
- Differential output swing = 1 Vpp
- Load capacitance = 1 pF
- Step response settling time to 0.5% accuracy = 5 nS
- VDD = 1 V

496
Chap. 11
Nanometer Design Studies
As illustrated in Fig. 11.48, the settling time, ts, is deﬁned as the time necessary for the output to reach
within 0.5% of its ﬁnal value. Our objective is to minimize the power consumption of the circuit.
1 pF
1 pF
Ampliﬁer
Vin1
Vin2
Vout1
Vout2
Vout1 – Vout2
Vin1 – Vin2
t
t
VF
tS
0.5% VF
0.5% VF
Figure 11.48
Deﬁnition of settling time.
11.6.1 General Considerations
Precision Issues
With a myriad of ampliﬁer topologies, where do we begin? In this case, the speciﬁca-
tions readily narrow down our choices. The maximum tolerable gain error of 1% indicates a closed-loop
conﬁguration so that the gain can be deﬁned as the ratio of two passive component values and remain
relatively independent of PVT. We must therefore design an ampliﬁer whose open-loop gain is high
enough to yield a closed-loop gain error of less than 1%. This observation along with the required output
swing of 1 Vpp calls for a two-stage op amp.
We have now arrived at the feedback arrangement shown in Fig. 11.49, where the closed-loop gain is
given by
Vout
Vin
= −R2
R1
1
1 + (1 + R2
R1
) 1
A0
(11.14)
≈−R2
R1

1 −

1 + R2
R1
 1
A0

(11.15)
We choose R2/R1 = 4 and ensure that the gain error falls below 1%:

1 + R2
R1
 1
A0
≤0.01
(11.16)
thereby obtaining A0 ≥500. This calculation neglects the loading of the feedback network on the op amp.
R1
R2
R1
R2
CL
CL
Vin
Vout
Figure 11.49
Closed-loop ampliﬁer
with resistive feedback.

Sec. 11.6
High-Speed Ampliﬁer
497
▲
Example11.12
Determine the closed-loop output impedance and bandwidth of the above topology in terms of the open-loop op amp
characteristics.
Solution
Drawing the half-circuit equivalent for loop gain calculation as shown in Fig. 11.50 and applying a test signal, Vt, we
observe that the feedback network senses Vout and returns a fraction equal to β = [R1/(R1 + R2)]Vout to the input.
The loop gain is therefore equal to β A0 = A0R1/(R1 + R2) ≈A0/5 ≈100, indicating that the output resistance
falls by a factor of 100 as a result of feedback. The bandwidth rises by the same factor.
R1
R2
Vt
VF
Vout
– A0
Figure 11.50
▲
The use of a resistive feedback network poses a difﬁculty: as explained in Sec. 11.5.2, if R1 and R2
are large enough not to reduce the open-loop gain of the op amp, then they form a signiﬁcant pole with
the input capacitance, degrading the phase margin. We therefore consider capacitive feedback instead,
conﬁguring the circuit as shown in Fig. 11.51(a). The closed-loop gain is now approximately equal to
C1/C2, or more accurately (Chapter 13):
Vout
Vin
≈−C1
C2

1 −C1 + C2 + Cin
C2
1
A0

(11.17)
where Cin denotes the (single-ended) input capacitance of the op amp. Drawing the single-ended coun-
terpart for the loop transmission calculation [Fig. 11.51(b)], we observe that C1 and C2 do not contribute
additional poles because (C1+Cin)C2/(C1+Cin +C2) simply appears in parallel with CL. (As explained
in Chapter 13, the capacitors also allow sampling and discrete-time operation.)
C2
C2
C1
C1
Y
X
CL
CL
A0
X
C2
Vout
CL
Cin
C1
Vin
VF
Vt
A0 (s)
(a)
(b)
Figure 11.51
(a) Closed-loop ampliﬁer using capacitive feedback, and (b) its simpliﬁed equivalent for loop gain
calculation.
▲
Example11.13
Circuits incorporating capacitive “coupling” typically exhibit a high-pass response. Is that the case for the ampliﬁer
of Fig. 11.51(a)?

498
Chap. 11
Nanometer Design Studies
Solution
No, it is not. Since there is no resistive path to X and Y, the time constant at these nodes is inﬁnite (if leakage currents
are neglected), yielding a frequency response that extends to nearly f = 0. The reader can consider the frequency
response of a simple capacitive divider as an example to appreciate this property.
▲
The circuit of Fig. 11.51(a) provides no bias for the op amp inputs, i.e., the dc levels at X and Y are not
deﬁned and can assume any value. (In the presence of gate leakage at the inputs, these nodes charge to
VDD or discharge to ground.) Illustrated in Fig. 11.52, a simple remedy is to add two feedback resistors
so that the input and output dc levels become equal. However, the ﬁnite time constant at X and Y leads
to a high-pass response; if A0 = ∞, then
Vout
Vin
(s) = −
RF|| 1
C2s
1
C1s
(11.18)
= −
RFC1s
RFC2s + 1
(11.19)
C2
C2
C1
C1
Y
X
A0
RF
RF
ω
0
Vin
Vin
Vout
Vout
RF C2
1
(a)
(b)
Figure 11.52
Addition of feedback resistors to deﬁne input dc levels and the resulting transfer function.
The corner frequency, 1/(2π RFC2), must therefore be chosen less than the minimum input frequency
of interest, a condition that is not practical in all applications. As explained in Chapter 13, RF can be
replaced with a switch, but we proceed here assuming that RFC2 is sufﬁciently large. In other words, we
assume that the circuit reduces to that in Fig. 11.51(a) for the frequencies of interest.
Equation (11.17) indicates that the capacitive-feedback ampliﬁer’s gain error also depends on Cin. For
example, if Cin ≈(C1 + C2)/5, then A0 must be 20% higher than the value dictated by Eq. (11.16). We
can choose C1 + C2 ≫Cin, but at the cost of settling speed.
Speed Issues
The ampliﬁer must settle to 0.5% accuracy in 5 ns. Let us ﬁrst assume a linear, ﬁrst-order
circuit and write the step response as
Vout(t) = V0

1 −exp −t
τ

u(t)
(11.20)
The time necessary for Vout to reach 0.995V0 is ts = −τ ln 0.005 = 5.3τ; i.e., τ must be no more than
0.94 ns. Thus, the closed-loop ampliﬁer must achieve a −3-dB bandwidth of at least 1/(2π × 0.94 ns) ≈
170 MHz.

Sec. 11.6
High-Speed Ampliﬁer
499
If the op amp in Fig. 11.51(a) is modeled simply by a dependent current source, GmVin, and an output
resistance, Rout, then the closed-loop time constant is given by (Chapter 13)
τ = CL(C1 + Cin) + CLC2 + C2(C1 + Cin)
GmC2
(11.21)
where Gm Rout is assumed much greater than unity. This expression can be rewritten as
τ =
C1 + C2 + Cin
C2
 CL + C2(Cin + C1)
C2 + Cin + C1
Gm
(11.22)
suggesting that the op amp sees the series combination of C2 and C1 + Cin in parallel with CL, and its
Gm is reduced by the feedback factor, C2/(C1 + C2 + Cin) (Fig. 11.53) (Chapter 13).
X
C2
C2
Vout
Cin
Vin
C1
CL
Gm
Cin
CL
C2
C1 + C2 + Cin
(Gm                              )–1
C1
Figure 11.53
Representation of closed-loop time constant by an equivalent network.
The foregoing model is not accurate for a two-stage op amp because the internal pole (at the output
of the ﬁrst stage) inevitably affects the response. Let us improve our approximation by considering a
frequency-compensated two-stage op amp. Recall that if the loop gain falls to 1 at the second pole, ωp2,
the phase margin is about 45◦for unity-gain feedback.
How do we compensate the op amp for a closed-loop gain of 4 (rather than 1)? In this case, |βH|
(rather than |H|) must fall to 0 dB at ωp2 (i.e., the circuit is not compensated for unity-gain feedback). As
illustrated in Fig. 11.54(a), we begin at ω = ωp2 and draw a line with a slope of −20 dB/decade toward
the y-axis, seeking its intercept with the plot of |βH|. We calculate the location of the compensated
dominant pole, ω′
p1, as follows. Between ω′
p1 and ωp2, we can approximate the compensated βH(s) as
β A0/(1 + s/ω′
p1); we set its magnitude to 1 at ωp2: |β A0/(1 + jωp2/ω′
p1)| = 1. It follows that
ω′
p1 ≈

ω2
p2
β2A2
0 −1
(11.23)
β < 1
β = 1
log ω
log ω
∣H(ω)∣
(log scale)
∣β H(ω)∣
(log scale)
’
ωp1
ωp2
ω'p1
ωp2
ωp1
A0
A0
βA0
A0
1 + β A0
After
Compensation
Closed−Loop
Response
0 dB
0 dB
(a)
(b)
Figure 11.54
(a) Frequency compensation for loop gain of β A0, and (b) the resulting closed-loop response.

500
Chap. 11
Nanometer Design Studies
and
ω′
p1 ≈ωp2
β A0
(11.24)
As expected, ω′
p1 must be chosen lower in magnitude if β increases, i.e., if the feedback becomes stronger.
▲
Example11.14
We compensate an op amp for β = 1/5 and PM = 45◦. Plot the open-loop frequency response of the op amp, H.
Solution
On a logarithmic scale, the plot of H is obtained if we shift the plot of |βH| up by −20 log β. As shown in Fig. 11.55,
H begins to fall at ω′
p1 and reaches a value of approximately 1/β at ωp2.
log ω
(log scale)
0 dB
1/β
ωp2
ω'p1
βA0
A0
∣H(ω)∣
Figure 11.55
▲
Let us now construct the closed-loop frequency response with this choice of ω′
p1. To this end, we ﬁrst
plot the magnitude of the loop transmission, |βH|, for β = 1 and after compensation [Fig. 11.54(b)]. The
closed-loop response begins at A0/(1 + β A0) at low frequencies and begins to roll off at ω ≈ωp2. From
another perspective, since the ratio of the open-loop and closed-loop gains at ω′
p1 is approximately equal to
β A0 and since the open-loop gain falls at 20 dB/dec (i.e., in proportion to ω), the two responses intersect at
ω ≈β A0ω′
p1 ≈ωp2. We therefore choose this bandwidth equal to 2π(170 MHz)/125 = 2π(1.36 MHz).
In summary, the closed-loop gain and settling speed requirements have translated to a dominant pole
at 1.36 MHz and a second pole at 170 MHz. The open-loop gain must fall from 500 at low frequencies
to 4 at the second pole. These values assume a phase margin of 45◦and must be eventually revisited.
11.6.2 Op Amp Design
Based on the foregoing calculations, we seek a two-stage op amp with an open-loop gain of 500, a
dominant pole at 1.36 MHz, a second pole at 170 MHz, and a differential output swing of 1 Vpp. We
thus return to the prototype designed in Sec. 11.5.2 and see whether it can serve our purpose. Most of
the speciﬁcations of that op amp are the same as those needed here. But, since the compensation can be
relaxed to suit a feedback factor of 1/5, the dominant pole of the op amp need not be as low as 344 kHz.
Equation (11.24) suggests that, if the feedback factor is reduced from 1 to β, then the dominant pole can
increase by roughly a factor of 1/β. We therefore expect that the compensation capacitor leading to the
response in Fig. 11.45(a) can be lowered from 4.5 pF to 0.9 pF, raising the dominant pole frequency from
340 kHz to 1.7 MHz. For the feedforward zero to cancel the second pole, R2 must rise by the same factor,
reaching 950 .
As observed in Sec. 11.5.2, the zero-pole cancellation creates a greater phase margin, allowing us to
reduce CC from 4.5 pF to 0.8 pF. However, in the present design, the feedback network capacitors also

Sec. 11.6
High-Speed Ampliﬁer
501
load the output stage, lowering the nondominant pole, ωp2. Since this effect has not been included in our
calculations, we resist the temptation to reduce CC for now and proceed to study the closed-loop behavior.
11.6.3 Closed-Loop Small-Signal Performance
Figure 11.56 shows the overall op amp and its closed-loop environment. For a nominal gain of 4, we
choose C1 = 1 pF and C2 = 0.25 pF. With Cin ≈50 fF, Eq. (11.17) predicts a gain error of less than
1% if A0 > 520. This gain is slightly greater than that achieved by the op amp at its peak output swings
(Fig. 11.41), but we deal with this issue later. For transient studies, RF must be large enough not to
cause signiﬁcant “droop” during time scales of interest. Speciﬁcally, for a settling time of 5 ns, we select
RFC2 > 10 μs so as to conﬁne the discharge of the capacitors to well below 1%; i.e., RF = 40 M.
(This extremely large value implies that a switched-capacitor solution is more practical.)
80 nm
80 nm
40 nm
80 nm
90 μm
80 nm
180 μm
C2
C2
C1
C1
A0
RF
RF
Vin
1 pF
1 pF
Vout
M1
M2
M6
M3
M4
X
Y
Vb1
Vb2
Vb3
VDD
M10
M9
M11
M12
80 nm
41 μm
10 μm
0.16 μm
M5
M8
M7
20 kΩ 
950 Ω 
20 μA
0.9 pF
Vout1
Vout2
45 μm
50 μm
50 μm
CC
Rz
Figure 11.56
Overall compensated two-stage op amp and the closed-loop environment.
Let us apply a small step to the above circuit and examine the output behavior. With a differential
input step of 25 mV, we expect an output around 99 mV (for 1% gain error). Depicted in Fig. 11.57(a) is
the differential output waveform and in Fig. 11.57(b) a close-up showing the ﬁne settling. We observe a
ﬁnal value equal to 98.82 mV, a result of insufﬁcient open-loop gain.
How do we increase the gain? If we raise the length (and hence the width) of the ﬁrst-stage input
transistors in Fig. 11.56, Cin also increases, counteracting A0 in Eq. (11.17). Instead, we double the
(drawn) width and length of the NMOS cascode transistors, obtaining the output shown in Fig. 11.58.
Now, the gain error is less than 1%.
▲
Example11.15
Is it possible to increase the length of the PMOS devices in the ﬁrst stage to raise the gain?
Solution
Designed to provide a much higher impedance than its NMOS counterpart, the PMOS cascode structures have a
weak effect on the gain of the ﬁrst stage. The NMOS cascode devices, on the other hand, directly determine the
voltage gain (why?).
▲
Let us turn our attention to the settling behavior of the ampliﬁer. If the output reaches 99.1 mV
at t = ∞, how do we deﬁne the settling time to 1% precision? We must ﬁnd the time at which

502
Chap. 11
Nanometer Design Studies
0
10
20
30
40
–20
0
20
40
60
80
100
120
Time (ns)
Vout1 – Vout2 (mV)
5
10
15
97
97.5
98
98.5
99
Time (ns)
Vout1 – Vout2 (mV)
(b)
(a)
Figure 11.57
(a) Closed-loop step response and (b) close-up showing settling to 1% accuracy.
0
10
20
30
40
–20
0
20
40
60
80
100
120
Time (ns)
Vout1 – Vout2 (mV)
Vout1 – Vout2 (mV)
5
10
15
97.5
98
98.5
99
99.5
Time (ns)
(b)
(a)
Figure 11.58
(a) Closed-loop step response and (b) close-up showing settling to 1% accuracy for
(W/L)3,4 = 180 μm/0.16 μm.
Vout = 99.1 mV ± 0.01 × 99.1 mV ≈99.1 mV ± 1 mV. From the waveform in Fig. 11.58(b), we obtain
ts ≈5.8 ns.
In order to improve the ampliﬁer’s speed, we recognize from Fig. 11.58(a) that the circuit is “over-
compensated,” i.e., the output appears overdamped. We can therefore return to our choice of CC and
Rz and adjust them more aggressively. We adjust these two values, patiently explore the design space,
and examine the trends in the output behavior. With CC = 0.3 pF and Rz = 700 , we observe the
settling shown in Fig. 11.59. The settling time drops to 800 ps, a remarkable improvement. Note that Rz
is reduced in this case, thus moving the zero to higher frequencies.
11.6.4 Op Amp Scaling
If the settling time is so much shorter than the required value, can we trade speed for power dissipation?
As explained in Chapter 9, a straightforward approach is to perform “linear scaling.” We begin with the

Sec. 11.6
High-Speed Ampliﬁer
503
0
10
20
30
40
–20
0
20
40
60
80
100
120
Time (ns)
Vout1 – Vout2 (mV)
Vout1 – Vout2 (mV)
5
10
15
97.5
98
98.5
99
99.5
Time (ns)
(b)
(a)
Figure 11.59
(a) Closed-loop step response and (b) close-up showing settling to 1% accuracy.
response shown in Fig. 11.60(a) and scale down all transistor widths and bias currents by a factor of α,
thereby reducing the power by the same factor while retaining the voltage gain and the headroom. But
how about CC and Rz? We make four observations. (1) With the load capacitance ﬁxed, the output pole
(before compensation) is scaled down by a factor of α [Fig. 11.60(b)] because the output resistance of
the second stage is scaled up by this factor (why?). (2) To maintain the same phase margin, the dominant
log ω
0 dB
Original Design
Scaled Design
 α
log ω
ωp1
Scaled Design
log ω
βH(ω)
(log scale)
βH(ω)
(log scale)
βH(ω)
(log scale)
A0
A0
βA0
0 dB
A0
βA0
0 dB
ωp1  
ωp1  
ωp2  
ωp2  
 α
ωp2  
ωp2
Original Design
β < 1
β < 1
ω′p1  
ω′p1  
Compensation for
 α
Compensation for
(c)
(b)
(a)
Figure 11.60
(a) Original op amp reponse and frequency compensation, (b) scaled op amp response, and
(c) compensation of scaled op amp.

504
Chap. 11
Nanometer Design Studies
pole after compensation must also be scaled down by this factor [Fig. 11.60(c)]. (3) Since the output
impedance of the ﬁrst stage is multiplied by α, CC should remain at its original value. (4) To place the
zero introduced by Rz atop ωp2/α, we multiply Rz by α (why?).
Let us try α = 2 and examine the results. Figure 11.61(a) plots the output waveform, revealing the same
ﬁnal values as before and an overdamped response with ts ≈2.5 ns. We can then try scaling by another
factor of 4 (i.e., α = 8 with respect to the original design), observing the heavily overdamped transient
shown in Fig. 11.61(b). Now, we adjust CC and Rz manually to optimize the speed. With CC = 0.15 pF
and Rz = 9 k, the step response appears as in Fig. 11.61(c), exhibiting ts ≈4.5 ns.
2
3
4
5
6
7
8
9
96
96.5
97
97.5
98
98.5
99
Time (ns)
5
10
15
91
92
93
94
95
96
97
98
99
Time (ns)
Vout1 − Vout2 (mV)
Vout1 − Vout2 (mV)
Vout1 − Vout2 (mV)
5
10
15
97
97.5
98
98.5
99
99.5
Time (ns)
(b)
(a)
(c)
Figure 11.61
(a) Step response of op amp with scaling factor of 2, (b) step response of op amp with scaling factor
of 8, and (c) modiﬁed design with CC = 0.15 pF and Rz = 9 k.
It is remarkable that linear scaling along with some adjustment of CC and Rz affords an eightfold
reduction in power (and area of the transistors). This scaling method entails minimal redesign effort
because it does not alter the circuit’s gain and swing values. Of course, the scaling gives rise to longer
settling and higher noise (and offset). Figure 11.62 shows the scaled op amp design.13
13In practice, we do not rely on such precise values as 113 μA and 5.1 μm but round them to 115 μA and 5 μm, respectively.

Sec. 11.6
High-Speed Ampliﬁer
505
80 nm
80 nm
M1
M2
M6
M3
M4
Vb1
X
Y
Vb2
Vb3
VDD
M10
M9
M11
M12
80 nm
0.16 μm
Vout2
Vout1
M5
M8
M7
22.5 μm
0.16 μm
113 μA
5.1 μm
1.25 μm
40 nm
160 kΩ 
2.5 μA
9 kΩ 
0.15 pF
120 μA
5.6 μm
6.3 μm
6.3 μm
Figure 11.62
Scaled op amp design.
11.6.5 Large-Signal Behavior
The ampliﬁer’s ultimate test is with large output swings (1 Vpp,diff). Under this condition, the open-loop
gain may drop as some transistors sustain less VDS, and the speed may suffer as slewing may occur. In the
previous simulations, the differential output begins from zero, jumps to some value, and returns to zero.
For large-signal tests, however, Vout must swing from −0.5 V to +0.5 V, which can be accomplished
by setting the initial differential conditions at the op amp inputs such that Vout = −0.5 V at t = 0. The
result is shown in Fig. 11.63.
0
10
20
30
40
–600
–400
–200
0
200
400
600
Time (ns)
5
10
15
482
484
486
488
490
492
494
496
498
Time (ns)
Vout1 – Vout2 (mV)
Vout1 – Vout2 (mV)
(b)
(a)
Figure 11.63
(a) Large-signal response of closed-loop ampliﬁer, and (b) close-up of (a) showing settling to 1%
accuracy.
We make two observations, First, the total change in Vout from t ≈20 ns to t ≈40 ns is equal to
987.4 mV, about 2.6 mV less than the allowed value for 1% gain error. Second, the settling to 1% from
the ﬁnal value is about 6 ns.

506
Chap. 11
Nanometer Design Studies
Let us ﬁrst deal with the insufﬁcient gain. We can measure the voltage gain of each stage under these
conditions by dividing its differential output swing by its differential input swing (after the voltages have
settled). We obtain Av = 39.5 for the ﬁrst stage and 10.2 for the second. (In small-signal operation, these
values are equal to 46.3 and 11.2, respectively.) The open-loop gain has thus dropped from 518 to 403.
To raise the gain, we double W and L of the NMOS cascode transistors (W/L = 45 μm/0.32 μm) in
the ﬁrst stage and the NMOS current sources in the second, arriving at the output shown in Fig. 11.64.
The gain error is now less than 1%, but the settling has become longer because the pole associated with
the source of the NMOS cascode transistors signiﬁcantly degrades the phase margin.
0
10
20
30
40
–600
–400
–200
0
200
400
600
Time (ns)
5
10
15
470
480
490
500
510
Time (ns)
Vout1 – Vout2 (mV)
Vout1 – Vout2 (mV)
(a)
(b)
Figure 11.64
(a) Large-signal response of closed-loop ampliﬁer, and (b) close-up of (a) showing settling
to 1% accuracy.
▲
Example11.16
Estimate the above pole frequency.
Solution
With Cox ≈15 fF/μm2, the gate-source capacitance of the cascode NMOS transistors amounts to (2/3)(45 μm ×
0.32 μm) × 15 fF/μm2 ≈144 fF. (Our calculation is sloppy because the effective length is less than 0.32 μm and
the overlap capacitance is neglected.) To this value we must add the S/D junction capacitances and the gate-drain
capacitance of the input transistors, obtaining roughly 200 fF. To estimate the transconductance of the cascode
devices, we assume that they operate in weak inversion and write gm ≈ID/(ξVT ) ≈56.5 μA/(1.5 × 26 mV) =
1/(690 ). The pole frequency is thus around 1.15 GHz, contributing substantial phase shift at the open-loop
unity-gain frequency.
▲
To address the settling issue, we consider cascode compensation (Chapter 10). In fact, we can combine
both methods and, with some iteration, reach the design shown in Fig. 11.65(a). Depicted in Fig. 11.65(b),
takes less than 5 ns.14 This performance is achieved with a power consumption of 370 μW.
14In this case, the 1% margin to the ﬁnal value is equal to 490 mV±1 V/100 because the total swing is from −0.5 V to +0.5 V.

Sec. 11.7
Summary
507
80 nm
80 nm
M1
M2
M6
M3
M4
X
Y
Vb1
Vb2
Vb3
VDD
M10
M9
M11
M12
80 nm
0.16 μm
Vout2
Vout1
M5
M8
M7
113 μA
2.5 μA
5.1 μm
1.25 μm
40 nm
160 kΩ 
45 μm
0.32 μm
30 kΩ 
50 fF
8 kΩ 
50 fF
(a)
(b)
5.6 μm
6.3 μm
6.3 μm
5
10
15
475
480
485
490
495
500
Time (ns)
Vout1 − Vout2 (mV)
Figure 11.65
(a) Final op amp design, and (b) its closed-loop large-signal step response.
11.7
Summary
This chapter has portrayed to the reader how the analog designer’s mind works. We have seen that the
design proceeds methodically, assuming an almost arbitrary power budget, and ﬁrst strives to meet the
voltage swing and gain requirements (the toughest issues today). With a reasonable design in hand,
we then aggressively reduce the power by linear scaling, paying attention to parameters that cannot be
scaled (e.g., the load capacitance) and bearing in mind that speed, noise, and offset degrade. Our efforts
exemplify three steps in good analog design. (1) We closely examine the circuit’s behavior and understand
the root cause of the undesired phenomena. (2) We adjust only the circuit parameters that relate to the
root cause—we do not blindly play with any random device. (3) We continue to explore various circuit
techniques and new ideas, sometimes reaching a dead end but many a time improving the performance.
The reader can see that we optimize the circuits “by hand” rather than automate the task using tools found
in simulators. High-performance analog design requires human intelligence.

508
Chap. 11
Nanometer Design Studies
Problems
11.1.
Consider the characteristics shown in Fig. 11.2. Estimate a λ value for VGS −VT H = 350 mV based
on the slope from VDS = 0.2 V to 1 V. [Hint: express the ratio of two currents at VDS1 and VDS2 as
(1 + λVDS1)/(1 + λVDS2)]. Repeat this calculation for VGS −VT H = 200 mV, 250 mV, and 300 mV. What
trend do you observe?
11.2.
Explain why gm falls in Fig. 11.6 as VGS −VT H exceeds 0.5 V.
11.3.
Suppose a hypothetical transistor exhibits a transconductance given by gm = β(VGS −VT H)2.
(a)
Find an expression for ID as a function of VGS −VT H.
(b)
Find two other expressions for gm.
11.4.
Sketch the plots in Fig. 11.7 for the device introduced in the previous problem.
11.5.
We wish to bias a transistor with L = 40 nm at ID = 0.25 mA. Referring to Fig. 11.13, determine which
case yields a higher output impedance: W = 5 μm or W = 10 μm.
11.6.
Explain what happens to the unachievable region in Fig. 11.15 if ξ falls from 1.5 to 1.0. Assume that the
behavior in strong inversion does not change.
11.7.
Modeling the thermal noise of M6 in Fig. 11.21 by a voltage source in series with its gate, determine the gain
that it sees as it reaches node Y. Use the exact expression for the gain of a degenerated CS stage. Compare
this result with the thermal noise contributed by M8.
11.8.
Consider the arrangement shown in Fig. 11.24(b). How high can the input CM level be for M13 and M14 to
remain in saturation? Does ID11/ID12 increase or deacrease beyond this point?
11.9.
Suppose a closed-loop ampliﬁer exhibits ringing at a frequency f1 in its step response [as in Fig. 11.46(b)].
Does this provide any information about the phase response of the open-loop circuit?
11.10. A two-stage op amp contains a nondominant pole, ωp2, at the output and is compensated for PM = 45◦so
that |βH| drops to unity at ωp2. Assume that the dominant pole is much lower than ωp2.
(a)
Estimate the degradation in PM if the load capacitance seen at the output is doubled.
(b)
How should the compensation be modiﬁed to ensure that PM = 45◦again?
11.11. Estimate the closed-loop time constant in Fig. 11.57 and see if it agrees with the open-loop dominant frequency
of 1.7 MHz.
11.12. Suppose that in Fig. 11.60, we scale an op amp up by a factor of α. If the load capacitance is constant, how
much bandwidth improvement can be achieved?
11.13. Modeling the op amp in Fig. 11.51(a) by a voltage-dependent current source equal to GmVXY and an output
resistance equal to Rout, calculate the zero of the closed-loop transfer function. (Hint: the output voltage is
equal to zero at the zero frequency.)
11.14. Consider the situation illustrated in Fig. 11.47(a). Suppose we place a capacitor, CF, in parallel with the
feedback resistor. Prove that CF introduces a zero in the loop transmission and determine its value so as to
cancel the pole created by Cin.

CHAPTER
12
Bandgap References
Analog circuits incorporate voltage and current references extensively. Such references are dc quantities
that exhibit little dependence on supply and process parameters and a well-deﬁned dependence on the
temperature. For example, the bias current of a differential pair must be generated according to a reference,
for it affects the voltage gain and noise of the circuit. We have also seen the need for precise voltages
to deﬁne common-mode levels in op amps. Moreover, in systems such as A/D and D/A converters, a
reference is required to deﬁne the input or output full-scale range.
In this chapter, we deal with the design of reference generators in CMOS technology, focusing on
well-established “bandgap” techniques. First, we study supply-independent biasing and the problem of
start-up. Next, we describe temperature-independent references and examine issues such as the effect of
offset voltages. Finally, we present constant-Gm biasing and study an example of state-of-the-art bandgap
references.
12.1
General Considerations
As mentioned above, the objective of reference generation is to establish a dc voltage or current that
is independent of the supply and process and has a well-deﬁned behavior with temperature. In most
applications,therequiredtemperaturedependenceassumesoneofthreeforms:(1)proportionaltoabsolute
temperature (PTAT); (2) constant-Gm behavior, i.e., such that the transconductance of certain transistors
remains constant; (3) temperature independent. We can therefore divide the task into two design problems:
supply-independent biasing and deﬁnition of the temperature variation.
In addition to supply, process, and temperature variability, several other parameters of reference
generators may be critical as well. These include output impedance, output noise, and power dissipation.
We return to these issues later in this chapter.
12.2
Supply-Independent Biasing
Our use of bias currents and current mirrors in previous chapters has implicitly assumed that a “golden”
reference current is available. As shown in Fig. 12.1(a), if IRE F does not vary with VDD, and channel-
length modulation of M2 and M3 is neglected, then ID2 and ID3 remain independent of the supply voltage.
The question then is—How do we generate IREF?
509

510
Chap. 12
Bandgap References
M2
IREF
M1
M3
VDD
ID2
ID3
M1
VDD
Iout
R1
(a)
(b)
M2
IREF
Figure 12.1
Current mirror biasing using (a) an ideal current source and (b) a resistor.
As an approximation of a current source, we tie a resistor from VDD to the gate of M1 [Fig. 12.1(b)].
However, the output current of this circuit is quite sensitive to VDD:
Iout =
VDD
R1 + 1/gm1
· (W/L)2
(W/L)1
(12.1)
In order to arrive at a less sensitive solution, we postulate that the circuit must bias itself, i.e., IRE F
must be somehow derived from Iout. The idea is that if Iout is to be ultimately independent of VDD, then
IRE F can be a replica of Iout. Figure 12.2 illustrates an implementation where M3 and M4 copy Iout,
thereby deﬁning IRE F. In essence, IRE F is “bootstrapped” to Iout. With the sizes chosen here, we have
Iout = K IRE F if channel-length modulation is neglected. Note that, since each diode-connected device
feeds from a current source, Iout and IRE F are relatively independent of VDD.
M1
VDD
Iout
M2
M3
M4
IREF
W
L
K (     )P
W
L
K (     )N
W
L
(     )P
W
L
(     )N
Figure 12.2
Simple circuit to establish
supply-independent currents.
Since Iout and IRE F in Fig. 12.2 display little dependence on VDD, their magnitude is set by other
parameters. How do we calculate these currents? Interestingly, if M1–M4 operate in saturation and λ ≈0,
then the circuit is governed by only one equation, Iout = K IRE F, and hence can support any current
level! For example, if we initially force IRE F to be 10 μA, the resulting Iout of K × 10 μA “circulates”
around the loop, sustaining these current levels in the left and right branches indeﬁnitely.
To uniquely deﬁne the currents, we add another constraint to the circuit, e.g., as shown in Fig. 12.3(a).
Here, resistor RS decreases the current of M2 while the PMOS devices require that Iout = IRE F because
they have identical dimensions and thresholds. We can write VGS1 = VGS2 + ID2RS, or

2Iout
μnCox(W/L)N
+ VT H1 =

2Iout
μnCox K(W/L)N
+ VT H2 + Iout RS
(12.2)
Neglecting body effect, we have

2Iout
μnCox(W/L)N

1 −
1
√
K

= Iout RS
(12.3)

Sec. 12.2
Supply-Independent Biasing
511
M1
VDD
Iout
M2
M3
M4
IREF
RS
(a)
(b)
M1
VDD
Iout
M2
M3
M4
IREF
RS
W
L
K (     )P
W
L
(     )P
W
L
(     )P
W
L
(     )P
W
L
(     )N
W
L
(     )N
W
L
(     )N
W
L
K (     )N
Figure 12.3
(a) Addition of RS to deﬁne the currents; (b) alternative implementation eliminating body effect.
and hence
Iout =
2
μnCox(W/L)N
· 1
R2
S

1 −
1
√
K
2
(12.4)
As expected, the current is independent of the supply voltage (but still a function of process and
temperature).
The assumption VT H1 = VT H2 introduces some error in the foregoing calculations because the sources
of M1 and M2 are at different voltages. Shown in Fig. 12.3(b) is to place the resistor in the source of M3
while eliminating body effect by tying the source and bulk of each PMOS transistor. Another solution is
described in Problem 12.1.
The circuits of Figs. 12.3(a) and (b) exhibit little supply dependence if channel-length modulation is
negligible. For this reason, relatively long channels are used for all of the transistors in the circuit. This
also helps reduce their ﬂicker noise.
▲
Example12.1
Assuming λ ̸= 0 in Fig. 12.3(a), estimate the change in Iout for a small change VDD in the supply voltage.
Solution
Simplifying the circuit as depicted in Fig. 12.4, where R1 = rO1∥(1/gm1) and R3 = rO3∥(1/gm3), we calculate the
“gain” from VDD to Iout. The small-signal gate-source voltage of M4 equals −Iout R3, and the current through rO4
is (VDD −VX)/rO4. Thus,
VDD −VX
rO4
+ Iout R3gm4 = VX
R1
(12.5)
VDD
M2
M4
RS
R3
rO2
R1
rO4
X
Iout
Figure 12.4

512
Chap. 12
Bandgap References
If we denote the equivalent transconductance of M2 and RS by Gm2 = Iout/VX, then
Iout
VDD
=
1
rO4

1
Gm2(rO4∥R1) −gm4R3
−1
(12.6)
Note from Chapter 3 that
Gm2 =
gm2rO2
RS + rO2 + (gm2 + gmb2)RSrO2
(12.7)
Interestingly, the sensitivity vanishes if rO4 = ∞.
▲
In some applications, the sensitivity given by (12.6) is prohibitively large. Also, owing to various
capacitive paths, the supply sensitivity of the circuit rises at high frequencies. For these reasons, the
supply voltage of the core is often derived from a locally-generated, less sensitive voltage. We return to
this point in Sec. 12.8.
An important issue in supply-independent biasing is the existence of “degenerate” bias points. In the
circuit of Fig. 12.3(a), for example, if all of the transistors carry zero current when the supply is turned
on, they may remain off indeﬁnitely because the loop can support a zero current in both branches. This
condition is not predicted by (12.4) because in manipulating (12.3), we divided both sides by √Iout,
tacitly assuming that Iout ̸= 0. In other words, the circuit can settle in one of two different operating
conditions.
Called the “start-up” problem, the above issue is resolved by adding a mechanism that drives the circuit
out of the degenerate bias point when the supply is turned on. Shown in Fig. 12.5(a) is a simple example,
where the diode-connected device M5 provides a current path from VDD through M3 and M1 to ground
upon start-up. Thus, M3 and M1, and hence M2 and M4, cannot remain off. Of course, this technique is
practical only if VT H1 + VT H5 + |VT H3| < VDD and VGS1 + VT H5 + |VGS3| > VDD, the latter to ensure
that M5 remains off after start-up. Another start-up circuit is analyzed in Problem 12.2.
The problem of start-up generally requires careful analysis and simulation. The supply voltage must be
ramped from zero in a dc sweep simulation (such that parasitic capacitances do not cause false start-up)
as well as in a transient simulation and the behavior of the circuit examined for each supply voltage.
Figure 12.5(b) depicts an example of the observed behavior in the presence of the start-up circuit. In
complex implementations, more than one degenerate point may exist.
M1
VDD
M2
M3
M4
RS
M5
VDD
ID2
Degenerate
Point
(a)
(b)
Figure 12.5
(a) Addition of start-up device to the circuit of Fig. 12.3(a), and (b) illustration of degenerate point.

Sec. 12.3
Temperature-Independent References
513
12.3
Temperature-Independent References
Reference voltages or currents that exhibit little dependence on temperature prove essential in many
analog circuits. It is interesting to note that, since most process parameters vary with temperature, if a
reference is temperature-independent, then it is usually process-independent as well.
How do we generate a quantity that remains constant with temperature? We postulate that if two
quantities having opposite temperature coefﬁcients (TCs) are added with proper weighting, the result
displays a zero TC. For example, for two voltages V1 and V2 that vary in opposite directions with
temperature, we choose α1 and α2 such that α1∂V1/∂T + α2∂V2/∂T = 0, obtaining a reference voltage,
VRE F = α1V1 + α2V2, with zero TC.
We must now identify two voltages that have positive and negative TCs. Among various device
parameters in semiconductor technologies, the characteristics of bipolar transistors have proven the most
reproducible and well-deﬁned quantities that can provide positive and negative TCs. Even though many
parameters of MOS devices have been considered for the task of reference generation [1, 2], bipolar
operation still forms the core of such circuits.
12.3.1 Negative-TC Voltage
The base-emitter voltage of bipolar transistors or, more generally, the forward voltage of a pn-junction
diode exhibits a negative TC. We ﬁrst obtain the expression for the TC in terms of readily-available
quantities.
For a bipolar device, we can write IC = IS exp(VBE/VT ), where VT = kT/q. The saturation current IS
is proportional to μkT n2
i , where μ denotes the mobility of minority carriers and ni is the intrinsic carrier
concentration of silicon. The temperature dependence of these quantities is represented as μ ∝μ0T m,
where m ≈−3/2, and n2
i ∝T 3 exp[−Eg/(kT )], where Eg ≈1.12 eV is the bandgap energy of silicon.
Thus,
IS = bT 4+m exp −Eg
kT
(12.8)
where b is a proportionality factor. Writing VBE = VT ln(IC/IS), we can now compute the TC of the
base-emitter voltage. In taking the derivative of VBE with respect to T , we must know the behavior of IC
as a function of the temperature. To simplify the analysis, we assume for now that IC is held constant.
Thus,
∂VBE
∂T
= ∂VT
∂T ln IC
IS
−VT
IS
∂IS
∂T
(12.9)
From (12.8), we have
∂IS
∂T = b(4 + m)T 3+m exp −Eg
kT
+ bT 4+m

exp −Eg
kT
  Eg
kT 2

(12.10)
Therefore,
VT
IS
∂IS
∂T = (4 + m)VT
T + Eg
kT 2 VT
(12.11)
With the aid of (12.9) and (12.11), we can write
∂VBE
∂T
= VT
T ln IC
IS
−(4 + m)VT
T −Eg
kT 2 VT
(12.12)
= VBE −(4 + m)VT −Eg/q
T
(12.13)

514
Chap. 12
Bandgap References
Equation (12.13) gives the temperature coefﬁcient of the base-emitter voltage at a given temperature T ,
revealing dependence on the magnitude of VBE itself. With VBE ≈750 mV and T = 300 K, we have
∂VBE/∂T ≈−1.5 mV/K.
In old bipolar technologies, where IC/IS was relatively small (because the transistors were large),
VBE ≈700 mV and ∂VBE/∂T ≈−1.9 mV/K at room temperature. Modern bipolar transistors typically
operate at much higher current densities, exhibiting VBE ≈800 mV and hence ∂VBE/∂T ≈−1.5 mV/K
at T = 300 K.
From (12.13), we note that the temperature coefﬁcient of VBE itself depends on the temperature,
creating error in constant reference generation if the positive-TC quantity exhibits a constant temperature
coefﬁcient.
Q2
Q1
I0
nI0
VDD
ΔVBE
Figure 12.6
Generation of PTAT voltage.
12.3.2 Positive-TC Voltage
It was recognized in 1964 [3] that if two bipolar transistors operate at unequal current densities,1 then the
difference between their base-emitter voltages is directly proportional to the absolute temperature. For
example, as shown in Fig. 12.6, if two identical transistors (IS1 = IS2) are biased at collector currents of
nI0 and I0 and their base currents are negligible, then
VBE = VBE1 −VBE2
(12.14)
= VT ln nI0
IS1
−VT ln I0
IS2
(12.15)
= VT ln n
(12.16)
Thus, the VBE difference exhibits a positive temperature coefﬁcient:
∂VBE
∂T
= k
q ln n
(12.17)
Interestingly, this TC is independent of the temperature or behavior of the collector currents.2
▲
Example12.2
How must n be chosen to yield a TC of +1.5 mV/K so as to cancel the TC of the base-emitter voltage at T = 300 K?
Solution
We choose n so that (k/q) ln n = 1.5 mV/K. Since k/q = VT /T = 0.087 mV/K, we have ln n ≈17.2 and hence
n = 2.95 × 107!! We must therefore modify the circuit to avoid such a large disparity between the two currents.
▲
1Current density is deﬁned as the ratio of the collector current, IC, and the saturation current, IS.
2Nonidealities in the characteristics of bipolar transistors introduce a small temperature dependence in this TC.

Sec. 12.3
Temperature-Independent References
515
▲
Example12.3
Calculate VBE in the circuit of Fig. 12.7, where Q2 is formed as the parallel combination of m units, each identical
to Q1.
Q2
Q1
I0
nI0
VDD
ΔVBE
IS
mIS
Figure 12.7
Solution
Neglecting base currents, we can write
VBE = VT ln nI0
IS
−VT ln I0
mIS
(12.18)
= VT ln(nm)
(12.19)
The temperature coefﬁcient is therefore equal to (k/q) ln(nm). In this circuit, the two transistors’ current densities
differ by a factor of nm.
▲
12.3.3 Bandgap Reference
With the negative- and positive-TC voltages obtained above, we can now develop a reference that has
a nominally zero temperature coefﬁcient. We write VRE F = α1VBE + α2(VT ln n), where VT ln n is the
difference between the base-emitter voltages of the two bipolar transistors operating at different current
densities. How do we choose α1 and α2? Since at room temperature, ∂VBE/∂T ≈−1.5 mV/K whereas
∂VT /∂T ≈+0.087 mV/K, we may set α1 = 1 and choose α2 ln n such that (α2 ln n)(0.087 mV/K) = 1.5
mV/K. That is, α2 ln n ≈17.2, indicating that for zero TC
VRE F ≈VBE + 17.2VT
(12.20)
≈1.25 V
(12.21)
Let us now devise a circuit that adds VBE to 17.2VT . First, consider the circuit shown in Fig. 12.8, where
the base currents are assumed to be negligible, transistor Q2 consists of n unit transistors in parallel, and
Q1 is a unit transistor. Suppose we somehow force VO1 and VO2 to be equal. Then, VBE1 = RI + VBE2
and RI = VBE1 −VBE2 = VT ln n. Thus, VO2 = VBE2 + VT ln n, suggesting that VO2 can serve as a
temperature-independent reference if ln n ≈17.2 (while VO1 and VO2 remain equal).
The circuit of Fig. 12.8 requires three modiﬁcations to become practical. First, a mechanism must be
added to guarantee that VO1 = VO2. Second, since ln n = 17.2 translates to a prohibitively large n, the
term RI = VT ln n must be scaled up by a reasonable factor. Third, VO2, which is somehow forced to
be equal to VO1, cannot become temperature-independent because VO2 ≈VBE1 ≈800 mV whereas,
for temperature independence, we must have VO2 = VBE2 + 17.2VT ≈1.25 V. Shown in Fig. 12.9
is an implementation accomplishing all tasks [4]. Here, ampliﬁer A1 senses VX and VY, driving the
top terminals of R1 and R2 (R1 = R2) such that X and Y settle to approximately equal voltages. The

516
Chap. 12
Bandgap References
Q1
A
Q2
nA
VDD
I
I
R
VO1 VO2
VBE1
VBE2
Figure 12.8
Conceptual generation of
temperature-independent voltage.
R3
R2
R1
Vout
Q1
A
Q2
nA
X
Y
A1
VT ln n
Figure 12.9
Actual implementation of
the concept shown in Fig. 12.8.
reference voltage is obtained at the output of the ampliﬁer (rather than at node Y). Following the analysis
of Fig. 12.8, we have VBE1 −VBE2 = VT ln n, arriving at a current equal to VT ln n/R3 through the right
branch and hence an output voltage of
Vout = VBE2 + VT ln n
R3
(R3 + R2)
(12.22)
= VBE2 + (VT ln n)

1 + R2
R3

(12.23)
For a zero TC, we must have (1 + R2/R3) ln n ≈17.2. For example, we may choose n = 31 and
R2/R3 = 4. Note that these results do not depend on the TC of the resistors.
It is interesting to understand how the third issue mentioned above is resolved in the topology of
Fig. 12.9: we do not attempt to make VY (≈VBE1) temperature-independent; rather, we amplify the
PTAT voltage drop across R3 by a factor of 1 + R2/R3 and then add the result to VBE2.
▲
Example12.4
In Fig. 12.9, R1 and R2 are equal and sustain equal voltages, each carrying a current of (VT ln n)/R3. We therefore
have
Vout = VBE1 + (VT ln n) R1
R3
(12.24)
But the second term is not equal to 17.2VT if we have already chosen (VT ln n)(1 + R2/R3) = 17.2VT . Explain this
discrepancy.

Sec. 12.3
Temperature-Independent References
517
Solution
The ﬁrst terms in (12.23) and (12.24) are different. We substitute VBE1 = VBE2 + VT ln n in Eq. (12.13):
∂VBE1
∂T
= VBE2 + VT ln n −(4 + m)VT −Eg/q
T
(12.25)
= ∂VBE2
∂T
+ k
q ln n
(12.26)
Thus,
∂Vout
∂T
= ∂VBE1
∂T
+

k
q ln n

R1
R3
(12.27)
= ∂VBE2
∂T
+

k
q ln n

1 + R1
R3

(12.28)
which is consistent with (12.23).
▲
The circuit of Fig. 12.9 entails a number of design issues. We consider each one below.
Collector Current Variation
The circuit of Fig. 12.9 violates one of our earlier assumptions: the
collector currents of Q1 and Q2, given by (VT ln n)/R3, are proportional to T , whereas ∂VBE/∂T ≈
−1.5 mV/K was derived for a constant current. What happens to the temperature coefﬁcient of VBE
if the collector currents are PTAT? As a ﬁrst-order iterative solution, let us assume that IC1 = IC2 ≈
(VT ln n)/R3. Returning to Eq. (12.9) and including ∂IC/∂T , we have
∂VBE
∂T
= ∂VT
∂T ln IC
IS
+ VT
 1
IC
∂IC
∂T −1
IS
∂IS
∂T

(12.29)
Since ∂IC/∂T ≈(VT ln n)/(R3T ) = IC/T , we can write
∂VBE
∂T
= ∂VT
∂T ln IC
IS
+ VT
T −VT
IS
∂IS
∂T
(12.30)
Equation (12.13) is therefore modiﬁed as
∂VBE
∂T
= VBE −(3 + m)VT −Eg/q
T
(12.31)
indicating that the TC is slightly less negative than −1.5 mV/K. In practice, accurate simulations are
necessary to predict the temperature coefﬁcient.
Compatibility with CMOS Technology
Our derivation of a temperature-independent voltage relies
on the exponential characteristics of bipolar devices for both negative- and positive-TC quantities. We
must therefore seek structures in a standard CMOS technology that exhibit such characteristics.
In n-well processes, a pnp transistor can be formed as depicted in Fig. 12.10. A p+ region (the same
as the S/D region of PFETs) inside an n-well serves as the emitter and the n-well itself as the base. The
p-type substrate acts as the collector and it is inevitably connected to the most negative supply (usually
ground). The circuit of Fig. 12.9 can therefore be redrawn as shown in Fig. 12.11.

518
Chap. 12
Bandgap References
p+
n−well
p−substrate
p+
n+
C
E
B
Figure 12.10
Realization of a pnp bipolar transistor in CMOS technology.
R3
R2
R1
Vout
Q1
A
Q2
nA
X
Y
A1
Figure 12.11
Circuit of Fig. 12.9
implemented with pnp transistors.
Op Amp Offset and Output Impedance
As explained in Chapter 14, owing to asymmetries, op amps
suffer from input “offsets,” i.e., the output voltage of the op amp is not zero if the input is set to zero. The
input offset voltage of the op amp in Fig. 12.9 introduces error in the output voltage. Included in Fig. 12.12,
the effect is quantiﬁed as VBE1 −VOS ≈VBE2 + R3IC2 (if A1 is large) and Vout = VBE2 + (R3 + R2)IC2.
Thus,
Vout = VBE2 + (R3 + R2)VBE1 −VBE2 −VOS
R3
(12.32)
= VBE2 +

1 + R2
R3

(VT ln n −VOS)
(12.33)
where we have assumed that IC2 ≈IC1 despite the offset voltage. The key point here is that VOS is
ampliﬁed by 1+ R2/R3, introducing error in Vout. More important, as explained in Chapter 14, VOS itself
varies with temperature, raising the temperature coefﬁcient of the output voltage.
R3
R2
R1
Vout
X
Y
A1
VOS
Q1
A
Q2
nA
Figure 12.12
Effect of op amp offset
on the reference voltage.

Sec. 12.3
Temperature-Independent References
519
▲
Example12.5
Assuming an ideal op amp, determine the small-signal gain from VOS to Vout in Fig. 12.12.
Solution
In the absence of the op amp offset, the two diode-connected bipolar transistors carry equal bias currents, exhibiting
a transconductance of gm. Replacing Q1 and Q2 with a small-signal resistance equal to 1/gm and noting that
VX −VOS ≈VY , we write the following small-signal equation:
1/gm
1/gm + R1
Vout −VOS =
1/gm + R3
1/gm + R3 + R2
Vout
(12.34)
Since R1 = R2,
Vout
VOS
= −

1 +
1
gm R2
+ (1/gm + R2)2
R2R3

(12.35)
If gm R2 ≫1, then Vout/VOS ≈−(1+R2/R3), agreeing with the results obtained previously. (After all, if 1/gm ≈0,
VOS simply sees a noninverting ampliﬁer with a gain of 1 + R2/R3.)
Why does (12.35) not completely agree with the −VOS(1 + R2/R3) component in (12.33)? Recall that (12.33)
was derived with the assumption that IC1 ≈IC2 despite the offset voltage. Since VX −VOS = VY , we have
IC1R1 −VOS = IC2R2, and hence IC1 = IC2 + VOS/R2. Let us return to (12.32) and write
VBE1 −VBE2 −VOS = VT ln IC1
IS1
−VT ln IC2
IS2
−VOS
(12.36)
= VT ln n −VT ln IC1
IC2
−VOS
(12.37)
= VT ln n −VT ln

1 + VOS
R2IC2

−VOS
(12.38)
≈VT ln n −VT
VOS
R2IC2
−VOS
(12.39)
≈VT ln n −

1 +
1
gm R2

VOS
(12.40)
The output offset contribution therefore amounts to −[1 + 1/(gm R2)](1 + R2/R3)VOS, which is approximately the
same as (12.35).
▲
Several methods are employed to lower the effect of VOS. First, the op amp incorporates large devices
in a carefully chosen topology so as to minimize the offset (Chapter 19). Second, as illustrated in Fig. 12.7,
the collector currents of Q1 and Q2 can be ratioed by a factor of m such that VBE = VT ln(mn). Third,
each branch may use two pn junctions in series to double VBE. Figure 12.13 depicts a realization using
the last two techniques. Here, R1 and R2 are ratioed by a factor of m, producing I1 ≈mI2. Neglecting
base currents and assuming that A1 is large, we can now write VBE1+VBE2−VOS = VBE3+VBE4+ R3I2
and Vout = VBE3 + VBE4 + (R3 + R2)I2. It follows that
Vout = VBE3 + VBE4 + (R3 + R2)2VT ln(mn) −VOS
R3
(12.41)
= 2VBE +

1 + R2
R3

[2VT ln(mn) −VOS]
(12.42)

520
Chap. 12
Bandgap References
R3
R1 = R
Vout
X
Y
A1
VOS
Q1
Q2
Q3
Q4
A
A
nA
nA
I2
I1
R2 = mR
Figure 12.13
Reduction of the effect
of op amp offset.
Thus, the effect of the offset voltage is reduced by increasing the ﬁrst term in the square brackets. The
issue, however, is that Vout ≈2 × 1.25 V = 2.5 V, a value difﬁcult to generate by the op amp at low
supply voltages.
In the circuits studied above, the op amp drives two resistive branches and must therefore provide a
low output impedance. Fortunately, it is possible to avoid this issue by a simple modiﬁcation described
below.
The implementation of Fig. 12.13 is not feasible in a standard CMOS technology because the collectors
of Q2 and Q4 are not grounded. In order to utilize the bipolar structure shown in Fig. 12.10, we modify the
series combination of the diodes as illustrated in Fig. 12.14(a), converting one of the diodes to an emitter
follower. However, we must ensure that the bias currents of both transistors have the same behavior with
temperature. Thus, we bias each transistor by a PMOS current source rather than a resistor [Fig. 12.14(b)].
The overall circuit then assumes the topology shown in Fig. 12.15, where the op amp adjusts the gate
voltage of the PMOS devices so as to equalize VX and VY. Interestingly, in this circuit, the op amp
experiences no resistive loading, but the mismatch and channel-length modulation of the PMOS devices
introduce error at the output (Problem 12.3).
Q1
Q2
VDD
Vb
2VBE
Q1
Q2
2VBE
Q1
Q2
2VBE
(a)
(b)
Figure 12.14
(a) Conversion of series diodes to a topology with grounded collectors; (b) circuit of part (a) biased
by PMOS current sources.
An important concern in the circuit of Fig. 12.15 is the relatively low current gain of the “native” pnp
transistors. Since the base currents of Q2 and Q4 generate an error in the emitter currents of Q1 and Q3,
a means of base current cancellation may be necessary (Problem 12.5).

Sec. 12.3
Temperature-Independent References
521
Q1
Q2
VDD
Q3
R2
R1
Vout
M1
M2
M3
M4
A1
X
Y
A
Q4
A
nA
nA
Figure 12.15
Reference generator
incorporating two series base-emitter
voltages.
Feedback Polarity
In the circuit of Fig. 12.9, the feedback signal produced by the op amp returns to
both of its inputs. The negative-feedback factor is given by
βN =
1/gm2 + R3
1/gm2 + R3 + R2
(12.43)
and the positive-feedback factor by
βP =
1/gm1
1/gm1 + R1
(12.44)
To ensure an overall negative feedback, βP must be less than βN, preferably by roughly a factor of two
so that the circuit’s transient response remains well behaved with large capacitive loads.
Bandgap Reference
The voltage generated according to (12.20) is called a “bandgap reference.” To
understand the origin of this terminology, let us write the output voltage as
VRE F = VBE + VT ln n
(12.45)
and hence:
∂VRE F
∂T
= ∂VBE
∂T
+ VT
T ln n
(12.46)
Setting this to zero and substituting for ∂VBE/∂T from (12.13), we have
VBE −(4 + m)VT −Eg/q
T
= −VT
T ln n
(12.47)
If VT ln n is found from this equation and inserted in (12.45), we obtain
VRE F = Eg
q + (4 + m)VT
(12.48)
Thus, the reference voltage exhibiting a nominally-zero TC is given by a few fundamental numbers: the
bandgap voltage of silicon, Eg/q, the temperature exponent of mobility, m, and the thermal voltage, VT .
The term “bandgap” is used here because as T →0, VRE F →Eg/q.

522
Chap. 12
Bandgap References
▲
Example12.6
Prove directly that, as T →0, VBE →Eg/q, and hence VRE F = VBE + VT ln n →Eg/q.
Solution
From Eq. (12.8), we have
VBE = VT ln IC
IS
(12.49)
= VT

ln IC −ln b −(4 + m) ln T + Eg
kT

(12.50)
Thus, VBE →Eg/q if T →0 and IC is constant.
▲
Supply Dependence and Start-Up
In the circuit of Fig. 12.9, the output voltage is relatively indepen-
dent of the supply voltage so long as the open-loop gain of the op amp is sufﬁciently high. The circuit
may require a start-up mechanism because if VX and VY are equal to zero, the input differential pair of
the op amp may turn off. Start-up techniques similar to those of Fig. 12.5 can be added to ensure that the
op amp turns on when the supply is applied.
The supply rejection of the circuit typically degrades at high frequencies owing to the op amp’s
rejection properties, often mandating “supply regulation.” An example is described in Sec. 12.8.
Curvature Correction
If plotted as a function of temperature, bandgap voltages exhibit a ﬁnite “cur-
vature,” i.e., their TC is typically zero at one temperature and positive or negative at other temperatures
(Fig. 12.16). The curvature arises from temperature variation of base-emitter voltages, collector currents,
and offset voltages.
T
T0
VREF
Figure 12.16
Curvature in temperature
dependence of a bandgap voltage.
Many curvature correction techniques have been devised to suppress the variation of VRE F [5, 6] in
bipolar bandgap circuits, but they are seldom used in CMOS counterparts. This is because, due to large
offsets and process variations, samples of a bandgap reference display substantially different zero-TC
temperatures (Fig. 12.17), making it difﬁcult to correct the curvature reliably.
T
VREF
Figure 12.17
Variation of the zero-TC
temperature for different samples.

Sec. 12.4
PTAT Current Generation
523
12.4
PTAT Current Generation
In the analysis of bandgap circuits, we noted that the bias currents of the bipolar transistors are in fact
proportional to absolute temperature. Useful in many applications, PTAT currents can be generated by a
topology such as that shown in Fig. 12.18. Alternatively, we can combine the supply-independent biasing
scheme of Fig. 12.2 with a bipolar core, arriving at Fig. 12.19.3 Assuming for simplicity that M1-M2
and M3-M4 are identical pairs, we note that for ID1 = ID2, the circuit must ensure that VX = VY. Thus,
ID1 = ID2 = (VT ln n)/R1, yielding the same behavior for ID5. In practice, due to mismatches between
the transistors and, more important, the temperature coefﬁcient of R1, the variation of ID5 deviates from
the ideal equation. For low-voltage operation, the topology of Fig. 12.18 is preferred.
Q1
A
Q2
nA
VDD
R1
PTAT
Current
M4
M3
Figure 12.18
Generation of a PTAT
current.
Q1
A
Q2
nA
VDD
R1
PTAT
Current
X
Y
M2
M1
M3
M4
M5
Figure 12.19
Alternative method of
generating a PTAT current.
The circuit of Fig. 12.18 can be readily modiﬁed to provide a bandgap reference voltage as well.
Illustrated in Fig. 12.20, the idea is to add a PTAT voltage ID5R2 to a base-emitter voltage. The output
therefore equals
VRE F = |VBE3| + R2
R1
VT ln n
(12.51)
3The two circuits in Figs. 12.18 and 12.19 exhibit different supply rejections. With a carefully-designed op amp, the former
achieves a higher rejection.

524
Chap. 12
Bandgap References
X
Y
Q1
A
Q2
nA
R1
M4
M3
VDD
M5
Q3
R2
Vout
Figure 12.20
Generation of a
temperature-independent voltage.
where all of the PMOS transistors are assumed identical. Note that the value of VBE3 and hence the size
of Q3 are somewhat arbitrary so long as the sum of the two terms in (12.51) gives a zero TC. In reality,
mismatches of the PMOS devices introduce error in Vout.
12.5
Constant-Gm Biasing
The transconductance of MOSFETs plays a critical role in analog circuits, determining such performance
parameters as noise, small-signal gain, and speed. For this reason, it is often desirable to bias the transistors
such that their transconductance does not depend on the temperature, process, or supply voltage.
A simple circuit used to deﬁne the transconductance is the supply-independent bias topology of
Fig. 12.3. Recall that the bias current is given by
Iout =
2
μnCox(W/L)N
1
R2
S

1 −
1
√
K
2
(12.52)
Thus, the transconductance of M1 equals
gm1 =

2μnCox
W
L

N
ID1
(12.53)
= 2
RS

1 −
1
√
K

(12.54)
a value independent of the supply voltage and MOS device parameters.
In reality, the value of RS in (12.54) does vary with temperature and process. If the temperature
coefﬁcient of the resistor is known, bandgap and PTAT reference generation techniques can be utilized
to cancel the temperature dependence. Process variations, however, limit the accuracy with which gm1 is
deﬁned.
In systems where a precise clock frequency is available, the resistor RS in Fig. 12.3 can be replaced
by a switched-capacitor equivalent (Chapter 13) to achieve a somewhat higher accuracy. Depicted in
Fig. 12.21, the idea is to establish an average resistance equal to (CS fCK)−1 between the source of M2
and ground, where fCK denotes the clock frequency. Capacitor CB is added to shunt the high-frequency
components resulting from switching to ground. Since the absolute value of capacitors is typically more
tightly controlled and since the TC of capacitors is much smaller than that of resistors, this technique
provides a higher reproducibility in the bias current and transconductance.

Sec. 12.6
Speed and Noise Issues
525
VDD
M2
M1
M3
M4
S1
CS
S2
CK
CK
CB
RS
Figure 12.21
Constant-Gm biasing by
means of a switched-capacitor “resistor.”
The switched-capacitor approach of Fig. 12.21 can be applied to other circuits as well. For ex-
ample, as shown in Fig. 12.22, a voltage-to-current converter with a relatively high accuracy can be
constructed.
M1
IREF
S1
CS
S2
CK
CK
VREF
CB
Figure 12.22
Voltage-to-current
conversion by means of a
switched-capacitor resistor.
12.6
Speed and Noise Issues
Even though reference generators are low-frequency circuits, they may affect the speed of the circuits
that they feed. Furthermore, various building blocks may experience “crosstalk” through reference lines.
These difﬁculties arise because of the ﬁnite output impedance of reference voltage generators, especially
if they incorporate op amps. As an example, let us consider the conﬁguration shown in Fig. 12.23,
assuming that the voltage at node N is heavily disturbed by the circuit fed by M5. For fast changes in VN,
the op amp cannot maintain VP constant, and the bias currents of M5 and M6 experience large transient
changes. Also, the duration of the transient at node P may be quite long if the op amp suffers from a
slow response. For this reason, many applications may require a high-speed op amp in the reference
generator.
In systems where the power consumed by the reference circuit must be small, the use of a high-speed
op amp may not be feasible. Alternatively, the critical node, e.g., node P in Fig. 12.23, can be bypassed
to ground by means of a large capacitor (CB) so as to suppress the effect of external disturbances. This
approach involves two issues. First, the stability of the op amp must not degrade with the addition of
the capacitor, requiring the op amp to be of a one-stage nature (Chapter 10). Second, since CB generally
slows down the transient response of the op amp, its value must be much greater than the capacitance that
couples the disturbance to node P. As illustrated in Fig. 12.24, if CB is not sufﬁciently large, then VP

526
Chap. 12
Bandgap References
VDD
P
N
M5
M6
t
CB
R1
A
B
Figure 12.23
Effect of circuit transients
on reference voltages and currents.
t
CB1 < CB2 < CB3 
CB2
CB3
VP
CB1
Very Large CB
Figure 12.24
Effect of increasing by-
pass capacitor on the response of a ref-
erence generator.
experiences a change and takes a long time to return to its original value, possibly degrading the settling
speed of the circuits biased by the reference generator. In other words, depending on the environment,
it may be preferable to leave node P agile so that it can quickly recover from transients. In general, as
depicted in Fig. 12.25, the response of the circuit must be analyzed by applying a disturbance at the
output and observing the settling behavior.
Reference
Generator
Vout
Figure 12.25
Setup for testing the transient
response of a reference generator.
▲
Example12.7
Determine the small-signal output impedance of the bandgap reference shown in Fig. 12.23 and examine its behavior
with frequency.
Solution
Figure 12.26 depicts the equivalent circuit, modeling the open-loop op amp by a one-pole transfer function A(s) =
A0/(1 + s/ω0) and an output resistance Rout and each bipolar transistor by a resistance 1/gmN. If M1 and M2
are identical, each having a transconductance of gmP, then their drain currents are equal to gmPVX, producing a
differential voltage at the input of the op amp equal to
VAB = −gmPVX
1
gmN
+ gmPVX

1
gmN
+ R1

(12.55)
= gmPVX R1
(12.56)

Sec. 12.6
Speed and Noise Issues
527
VDD
P
VX
IX
Rout
A(s)
A
B
gmN
1
+ R1
gmN
1
M2
M1
gmPVX
gmPVX
Figure 12.26
Circuit for calculation
of the output impedance of a reference
generator.
The current ﬂowing through Rout is therefore given by
IX = VX + gmPVX R1 A(s)
Rout
(12.57)
yielding
VX
IX
=
Rout
1 + gmP R1 A(s)
(12.58)
=
Rout
1 + gmP R1
A0
1 + s/ω0
(12.59)
=
Rout
1 + gmP R1 A0
1 + s
ω0
1 +
s
(1 + gmP R1 A0)ω0
(12.60)
Thus, the output impedance exhibits a zero at ω0 and a pole at (1 + gmP R1 A0)ω0, with the magnitude behavior
plotted in Fig. 12.27. Note that |Zout| is small for ω < ω0, but it rises to a high value as the frequency approaches
the pole. In fact, setting ω = (1 + gmP R1 A0)ω0 and assuming gmP R1 A0 ≫1, we have
|Zout| =
Rout
1 + gmP R1 A0

1 + j(1 + gmP R1 A0)
1 + j

(12.61)
= Rout
√
2
(12.62)
which is only 30% lower than the open-loop value.
2
Rout
1 + gmPR1A0
ω0
Zout
ω
(1 + gmPR1A0)ω0
Rout
Figure 12.27
Variation of the reference generator output impedance with frequency.
▲

528
Chap. 12
Bandgap References
The output noise of reference generators may affect the performance of low-noise circuits considerably.
Figure 12.28 illustrates an example: the load current source of a common-source stage is driven by a
bandgap circuit with a current multiplication factor of N. Thus, the noise current of M1 (or M2) is
ampliﬁed by the same factor as it appears in M3. Note that M1–M3 carry noise due to the op amp A1
as well.
Q1
A
Q2
nA
VDD
R1
Vout
M1
M4
Vin
M2
M3
A1
Figure 12.28
Effect of bandgap circuit
noise on a CS stage.
As another example, if a high-precision A/D converter employs a bandgap voltage as the reference
with which the analog input signal is compared (Fig. 12.29), then the noise in the reference is directly
added to the input.
A/D
Converter
Vin
Reference
Generator
Digital
Output
Figure 12.29
A/D converter using a
reference generator.
As a simple example, let us calculate the output noise voltage of the circuit shown in Fig. 12.30,
taking into account only the input-referred noise voltage of the op amp, Vn,op. Since the small-signal
drain currents of M1 and M2 are equal to Vn,out/(R1 + g−1
mN), we have VP = −g−1
mPVn,out/(R1 + g−1
mN),
obtaining the differential voltage at the input of the op amp as −g−1
mP A−1
0 Vn,out/(R1 + g−1
mN). Beginning
VDD
P
A
B
 + R1
gmN
1
gmN
1
M2
M1
gmPVP
gmPVP
Vn,op
A0
Vn,out
Figure 12.30
Circuit for calculation of
noise in a reference generator.

Sec. 12.7
Low-Voltage Bandgap References
529
from node A, we can then write
Vn,out
R1 + g−1
mN
·
1
gmN
−
Vn,out
gmP A0

R1 + g−1
mN
	 = Vn,op + Vn,out
(12.63)
and hence
Vn,out

1
R1 + g−1
mN
 1
gmN
−
1
gmP A0

−1

= Vn,op
(12.64)
Since typically gmP A0 ≫gmN ≫R−1
1 ,
|Vn,out| ≈Vn,op
(12.65)
suggesting that the noise of the op amp directly appears at the output. Note that even the addition of
a large capacitor from the output to ground may not suppress low-frequency 1/f noise components, a
serious difﬁculty in low-noise applications. The noise contributed by other devices in the circuit is studied
in Problem 12.6.
12.7
Low-Voltage Bandgap References
The bandgap voltage expressed by Eq. (12.20) is around 1.25 V, eluding implementation with today’s
low supplies. The fundamental limitation is that we must add about 17.2VT to one VBE so as to achieve
a net zero temperature coefﬁcient.
Is it possible to add two currents with positive and negative TCs and then convert the result to an
arbitrary voltage that has a zero TC (Fig. 12.31)? Recall from Fig. 12.18 that we can readily generate a
PTAT current given by VT ln n/R. We also envision another current of the form VBE/R serving as that
with a negative TC, but how can we generate such a current with minimal complexity?
I2
I1
R1
VDD
V = (I1 + I2)R1
TC = 0  
TC < 0 
TC > 0 
Figure 12.31
Summation of two
currents with opposite TCs to obtain
a result with zero TC.
Let us return to the circuit of Fig. 12.18, assume that M3 and M4 are identical, and note that |ID4| =
VT ln n/R1 is a PTAT current. We place a resistor in parallel with Q2 as shown in Fig. 12.32(a). We
recognize that R1 now carries an additional current equal to |VBE2|/R2, i.e., a current with a negative
TC. Unfortunately, however, the PTAT behavior is now disturbed because IC1 ̸= IC2. Fortunately, a
simple modiﬁcation resolves this issue: as shown in Fig. 12.32(b), we tie R2 from Y to ground and place
another resistor in parallel with Q1. Proposed by Banba et al. [8], this topology lends itself to low-voltage
implementation, requiring a minimum VDD of VBE1 + |VDS3|.
To analyze the circuit, we observe that VX ≈VY ≈|VBE1| and ID3 = ID4. Thus,
IC1 + |VBE1|
R3
= IC2 + |VBE1|
R2
(12.66)

530
Chap. 12
Bandgap References
Q1
A
Q2
nA
VDD
R1
A1
Y
X
R2
R3
Q1
A
Q2
nA
VDD
R1
M3
M4
M3
M4
A1
Y
X
R2
(a)
(b)
Q1
A
Q2
nA
VDD
R1
M3
M4
A1
Y
X
R2
R4
M5
VBG
(c)
R3
Figure 12.32
(a) Attempt to make drain current of M4 temperature-independent, (b) circuit modiﬁcation
resulting in a zero-TC current, and (c) generation of arbitrarily small voltage with zero TC.
which yields IC1 = IC2 if R2 = R3. We still have |VBE1| = |VBE2|+ IC2R1 and hence IC2 = VT ln n/R1.
This current and the current ﬂowing through R2, |VBE1|/R2, constitute |ID4|:
|ID4| = VT ln n
R1
+ |VBE1|
R2
(12.67)
= 1
R2

|VBE1| + R2
R1
VT ln n

(12.68)
Selecting (R2/R1)VT ln n approximately equal to 17.2VT renders a zero TC for ID4. This current is then
copied and passed through a resistor to generate a zero-TC voltage [Fig. 12.32(c)] [8]:
VBG = R4
R2

|VBE1| + R2
R1
VT ln n

(12.69)
(if M5 is identical to M4). We choose (R2/R1) ln n ≈17.2, observing that VBG has a zero TC and its
value can be lower than the conventional limit of 1.25 V.
▲
Example12.8
If the op amp in Fig. 12.32(c) has an input-referred offset voltage, VOS, determine VBG.

Sec. 12.7
Low-Voltage Bandgap References
531
Q1
A
Q2
nA
VDD
R1
M3
M4
A1
Y
X
R2
R3
R4
M5
VBG
VOS
Figure 12.33
Solution
As shown in Fig. 12.33, we now have VX ≈VY + VOS ≈|VBE1| and
IC1 + |VBE1|
R3
= IC2 + |VBE1| −VOS
R2
(12.70)
which implies that IC1 = IC2 −VOS/R2 if R2 = R3. Since |VBE1| = |VBE2| + R1IC2 + VOS, we have IC2 =
(VT ln n −VOS)/R1. This current and the current ﬂowing through R2, (|VBE1| −VOS)/R2, add up to |ID4|:
|ID4| = VT ln n −VOS
R1
+ |VBE1| −VOS
R2
(12.71)
It follows that
VBG = R4
R2

|VBE1| + R2
R1
VT ln n

−
R4
R1||R2
VOS
(12.72)
revealing that the op amp offset is ampliﬁed by a factor of R4/(R1||R2). Alternatively, we can write
VBG = R4
R2

|VBE1| + R2
R1
VT ln n −

1 + R2
R1

VOS

(12.73)
concluding that the effect of VOS can be minimized only by maximizing n.
▲
It is instructive to estimate the lowest supply voltage with which the circuit of Fig. 12.32(c) can operate
properly. With large bipolar transistors and a small bias current, e.g., 10 μA, the base-emitter voltage
can be as low as 0.7 V. Similarly, wide PMOS devices allow a |VDS| of about 50 mV. The circuit can
thus operate with a minimum VDD of around 0.75 V. In this case, R4 tends to be a large resistor, e.g.,
50 k, producing signiﬁcant noise and requiring a bypass capacitor at the output. Also, if the PMOS
drain currents are copied to generate a larger current, say, 0.5 mA, then their noise is ampliﬁed by the
same factor. This noise contains thermal and ﬂicker components due to the PMOS devices and the noise
of the op amp. In Problem 12.24, we analyze the noise behavior of this circuit, but from Example 12.8,
we observe that the op amp input noise is ampliﬁed by a factor of R4/(R1||R2).
The op amp in Fig. 12.32(c) can be realized as a ﬁve-transistor OTA. Depicted in Fig. 12.34(a) is an
example. The OTA design proceeds according to the following guidelines. (1) Large transistor dimensions
are chosen so as to minimize their ﬂicker noise and offset. (2) The gate-source voltage of Ma and Mb

532
Chap. 12
Bandgap References
Q1
A
Q2
nA
VDD
R1
M3
M4
Y
X
R2
R3
Md
Ma
Mb
Mc
ISS
P
Q1
M3
R3
Ma
Mc
ISS
P
X
Me
(a)
(b)
Figure 12.34
(a) Implementation of low-voltage BG circuit using a ﬁve-transistor OTA, and (b) addition of
start-up device.
plus the headroom required by ISS must not exceed |VBE1|. (3) The transistors are chosen long enough
to yield a reasonable loop gain, e.g., 5 to 10.
The foregoing topology must incorporate a start-up mechanism. Otherwise, the circuit begins with
VX = VY = 0, Ma and Mb remain off, and so do M3 and M4. Since, with VDD < 1 V, the voltage difference
between node P and node X is initially positive but ﬁnally negative (why?), we can tie a diode-connected
NMOS transistor between these two nodes to ensure start-up [Fig. 12.34(b)]. Alternatively, the NMOS
device can be connected between X and VDD.
Another low-voltage bandgap circuit can be derived from the topology of Fig. 12.20 by simply tying
a resistor from the output node to ground [9]. Shown in Fig. 12.35, the circuit now allows some of ID5 to
ﬂow through R3:
|ID5| = Vout
R3
+ Vout −|VBE3|
R2
(12.74)
If the PMOS devices are identical, |ID5| = VT ln n/R1, yielding
Vout =
R3
R2 + R3

|VBE3| + R2
R1
VT ln n

(12.75)
The standard bandgap voltage is thus scaled down by a factor of R3/(R2 + R3). The reader is encouraged
to compute the effect of the op amp offset at the output and compare the result with (12.72).
Q1
A
Q2
nA
VDD
R1
Vout
M3
M4
A1
M5
Q3
R2
R3
Figure 12.35
Alternative low-voltage
BG circuit.

Sec. 12.8
Case Study
533
It is possible to add other bias branches to the foregoing circuits so as to provide curvature correction,
but such schemes typically rely on trimming because the various mismatches within the circuit tend to
shift the zero-TC temperature randomly. Other low-voltage bandgaps are described in [10].
12.8
Case Study
In this section, we study a bandgap reference circuit designed for high-precision analog systems [7]. The
reference generator incorporates the topology of Fig. 12.19, but with two series base-emitter voltages in
each branch so as to reduce the effect of MOSFET mismatches. A simpliﬁed version of the core is depicted
in Fig. 12.36, where the PMOS current mirror arrangement ensures equal collector currents for Q1–Q4.
While requiring a high supply voltage, this design exempliﬁes issues that prove important in practice.
Q3
Q1
VDD
Q4
Q2
M2
M1
M3
M4
nA
nA
A
A
R1
M5
M6
Figure 12.36
Simpliﬁed core of the
bandgap circuit reported in [7].
Channel-length modulation of the MOS devices in Fig. 12.36 still results in signiﬁcant supply de-
pendence. To resolve this issue, each branch can employ both NMOS and PMOS cascode topologies.
Figure 12.37(a) shows an example in which the low-voltage cascode current mirror described in Chapter 5
A
R1
I1
Vb1
Vb2
Q1
Q2
nA
VDD
R1
Q1
A
Q2
nA
VDD
R2
R3
I2
(a)
(b)
Figure 12.37
(a) Addition of cascode devices to improve supply rejection; (b) use of self-biased cascode to
eliminate Vb1 and Vb2.

534
Chap. 12
Bandgap References
M2
VDD
R3
Q4
Q2
A
A
R6
R5
R4
A1
E
F
M10
M9
M11
Vout
Q3
Q1
nA
nA
R1
R2
Figure 12.38
Generation of a ﬂoating reference voltage.
is utilized. To obviate the need for Vb1 and Vb2, this design actually introduces a “self-biased” cascode,
shown in Fig. 12.37(b), where R2 and R3 sustain proper voltages to allow all MOSFETs to remain in
saturation. This cascode topology is analyzed in Problem 12.7.
The bandgap circuit reported in [7] is designed to generate a ﬂoating reference. This is accomplished
by the modiﬁcation shown in Fig. 12.38, where the drain currents of M9 and M10 ﬂow through R4 and
R5, respectively. Note that M11 sets the gate voltage of M9 at VBE4 + VGS11, establishing a voltage equal
to VBE4 across R6 if M9 and M11 are identical. Thus, ID9 = VBE4/R6, yielding VR4 = VBE4(R4/R6).
Also, if M10 is identical to M2, then |ID10| = 2(VT ln n)/R1, and hence VR5 = 2(VT ln n)(R5/R1). Since
the op amp ensures that VE ≈VF, we have
Vout = R4
R6
VBE4 + 2 R5
R1
VT ln n
(12.76)
Proper choice of the resistor ratios and n therefore provides a zero temperature coefﬁcient.
In order to further enhance the supply rejection, this design regulates the supply voltage of the core
and the op amp. Illustrated in Fig. 12.39, the idea is to generate a local supply, VDDL, that is deﬁned
by a reference VR1 and the ratio of Rr1 and Rr2 and hence remains relatively independent of the global
supply voltage. But how is VR1 itself generated? To minimize the dependence of VR1 upon the supply,
Rr1
Rr2
VR1
Core
A1
VDDL
Figure 12.39
Regulation of the supply voltage of the core and op amp to improve supply rejection.

Sec. 12.8
Case Study
535
this voltage is established inside the core, as depicted in Fig. 12.40. In fact, RM is chosen such that VR1
is a bandgap reference.
Figure 12.41 shows the overall implementation, omitting a few details for simplicity. A start-up
circuit is also used. Operating from a 5-V supply, the reference generator produces a 2.00-V output
while consuming 2.2 mW. The supply rejection is 94 dB at low frequencies, dropping to 58 dB at
100 kHz [7].
VR1
VDDL
R3
Q4
Q2
A
A
R6
R5
R4
A1
E
F
M10
M9
M11
Vout
Q3
Q1
nA
nA
RM
R1
R2
Figure 12.40
Generation of VR1, used in Fig. 12.39.
VDDL
R3
Q4
Q2
A
A
R6
R5
R4
A1
E
F
M10
M9
M11
Vout
Q3
Q1
nA
nA
RM
VR1
R1
R2
Rr1
Rr2
VDD
Start−up Circuit
Figure 12.41
Overall circuit of the bandgap generator reported in [7].

536
Chap. 12
Bandgap References
References
[1] R. A. Blauschild et al., “A New NMOS Temperature-Stable Voltage Reference,” IEEE J. of Solid-State Circuits,
vol. 13, pp. 767–774, December 1978.
[2] Y. P. Tsividis and R. W. Ulmer, “A CMOS Voltage Reference,” IEEE J. of Solid-State Circuits, vol. 13, pp. 774–
778, December 1978.
[3] D. Hilbiber, “A New Semiconductor Voltage Standard,” ISSCC Dig. of Tech. Papers, pp. 32–33, February 1964.
[4] K. E. Kujik, “A Precision Reference Voltage Source,” IEEE J. of Solid-State Circuits, vol. 8, pp. 222–226, June
1973.
[5] G. C. M. Meijer, P. C. Schmall, and K. van Zalinge, “A New Curvature-Corrected Bandgap Reference,” IEEE J.
of Solid-State Circuits, vol. 17, pp. 1139–1143, December 1982.
[6] M. Gunawan et al., “A Curvature-Corrected Low-Voltage Bandgap Reference,” IEEE J. of Solid-State Circuits,
vol. 28, pp. 667–670, June 1993.
[7] T. Brooks and A. L. Westwisk, “A Low-Power Differential CMOS Bandgap Reference,” ISSCC Dig. of Tech.
Papers, pp. 248–249, February 1994.
[8] H. Banba et al., “A CMOS Bandgap Reference Circuit with Sub-1-V Operation,” IEEE J. of Solid-State Circuits,
vol. 34, pp. 670–674, May 1999.
[9] H. Neuteboom et al., “A DSP-Based Hearing Instrument IC,” IEEE J. of Solid-State Circuits, vol. 32, pp. 1790–
1806, November 1997.
[10] C. J. B. Fayomi et al., “Sub-1-V CMOS Bandgap Reference Design Techniques: A Survey,” Analog Integrated
Circuits and Signal Processing, vol. 62, pp. 141–157, February 2010.
[11] B. Gilbert, “Monolithic Voltage and Current References: Themes and Variations,” pp. 269–352 in Analog
Circuit Design, J. H. Huijsing, R. J. van de Plassche, and W. M. C. Sansen, eds. (Boston: Kluwer Academic
Publishers, 1996).
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary.
12.1.
Derive an expression for Iout in Fig. 12.42.
M1
VDD
Iout
M2
M3
M4
RS
Figure 12.42
12.2.
Explain how the start-up circuit shown in Fig. 12.43 operates. Derive a relationship that guarantees that
VX < VT H after the circuit turns on.
12.3.
Consider the circuit of Fig. 12.15.
(a)
If M1 and M2 suffer from channel-length modulation, what is the error in the output voltage?
(b)
Repeat part (a) for M3 and M4.
(c)
If M1 and M2 have a threshold mismatch of V , i.e., VT H1 = VT H and VT H2 = VT H + V , what is
the error in the output voltage?
(d)
Repeat part (c) for M3 and M4.

Problems
537
X
M1
VDD
M2
M3
M4
RS
M5
M6
Rb
Ra
Figure 12.43
12.4.
In Fig. 12.15, if the open-loop gain of the op amp A1 is not sufﬁciently large, then |VX −VY | exceeds Ve,
where Ve is the maximum tolerable error. Calculate the minimum value of A1 in terms of Ve such that the
condition |VX −VY | < Ve is satisﬁed.
12.5.
In the circuit of Fig. 12.15, assume that Q2 and Q4 have a ﬁnite current gain β. Calculate the error in the
output voltage.
12.6.
Calculate the output noise voltage of the circuit shown in Fig. 12.30 due to the thermal and ﬂicker noise of
M1 and M2.
12.7.
Consider the self-biased cascode shown in Fig. 12.44. Determine the minimum and maximum values of
RIRE F such that both M1 and M2 remain in saturation.
R
IREF
M2
M1
VDD
Figure 12.44
12.8.
ThecircuitofFig.12.3(a)sometimes turns on even with no explicit start-up mechanism.Identify the capacitive
path(s) that couple the transition on VDD to the internal nodes and hence provide the start-up current.
12.9.
Sketch the temperature coefﬁcient of VBE [Eq. (12.13)] versus temperature. Some iteration may be necessary.
12.10. Determine the derivative of Eq. (12.13) with respect to temperature and sketch the result versus T . This
quantity reveals the curvature of the voltage.
12.11. Suppose that in Fig. 12.9, the ampliﬁer has an output resistance Rout. Calculate the error in Vout.
12.12. The circuit of Fig. 12.9 is designed with R3 = 1 k and a current of 50 μA through it. Calculate R1 = R2
and n for a zero TC.
12.13. In the circuit of Fig. 12.15, Q1 and Q2 are biased at 100 μA and Q3 and Q4 at 50 μA. If R1 = 1 k,
calculate R2 and (W/L)1−4 such that the circuit operates with VDD = 3 V. Which op amp topology can be
used here?
12.14. Since the bandgap of silicon exhibits a small temperature coefﬁcient, Eq. (12.48) suggests that ∂VRE F/∂T ∝
(4 + m)k/q, a relatively large value, whereas we derived VRE F such that it has a zero TC. Explain the ﬂaw
in this argument.

538
Chap. 12
Bandgap References
12.15. A differential pair with resistive loads is designed such that its voltage gain, gm RD, has a zero TC at
room temperature. If only the temperature dependence of the mobility is considered, determine the required
temperature behavior of the tail current. Design a circuit that roughly approximates this behavior.
12.16. In Problem 12.15, assume that the tail current is constant, but the load resistors exhibit a ﬁnite TC. What
resistor temperature coefﬁcient cancels the variation of the mobility at room temperature?
12.17. In the circuit of Fig. 12.32(b), how should R1–R3 be chosen so that the negative-feedback loop is stronger
than the positive-feedback loop?
12.18. Does the ﬁve-transistor OTA in Fig. 12.34(a) impose additional supply voltage constraints?
12.19. Figure 12.45 illustrates a “single-junction” bandgap design [11]. Here, switches S1 and S2 are driven by
complementary clocks.
(a)
What is Vout when S1 is on and S2 is off?
(b)
What is the change in Vout when S1 turns off and S2 turns on?
(c)
How are I1, I2, C1, and C2 chosen to produce a zero-TC output when S1 is off?
X
Q1
A
I1
S2
I2
C1
S1
C2
Vout
VDD
Figure 12.45
12.20. Suppose that in Fig. 12.45, I2/I1 deviates from its nominal value by a small error ϵ. Calculate Vout when S1
is off.
12.21. The circuit of Fig. 12.20 is designed with (W/L)1−4 = 50/0.5, ID1 = ID2 = 50 μA, R1 = 1 k, and
R2 = 2 k. Assume that λ = γ = 0 and Q3 is identical to Q1.
(a)
Determine n and (W/L)5 such that Vout has a zero TC at room temperature.
(b)
Neglecting the noise contribution of Q1–Q3, calculate the output thermal noise.
12.22. Consider the circuit of Fig. 12.21. Assume K = 4, fCK = 50 MHz, and a power budget of 1 mW. Determine
the aspect ratio of M1–M4 and the value of CS such that gm1 = 1/(500 ).
12.23. Suppose (W/L)3 = K(W/L)4 in Fig. 12.32(c). How should R2 and R3 be chosen?
12.24. Determine the output noise voltage of the circuit in Fig. 12.32(c).
12.25. Analyze the circuit of Fig. 12.3(a) if RS is placed in series with the source of M1.

CHAPTER
13
Introduction to Switched-Capacitor
Circuits
Our study of ampliﬁers in previous chapters has dealt only with cases in which the input signal is
continuously available and applied to the circuit and the output signal is continuously observed. Called
“continuous-time” circuits, such ampliﬁers ﬁnd wide application in audio, video, and high-speed analog
systems. In many situations, however, we may sense the input only at periodic instants of time, ignoring
its value at other times. The circuit then processes each “sample,” producing a valid output at the end of
each period. Such circuits are called “discrete-time” or “sampled-data” systems.
In this chapter, we study a common class of discrete-time systems called “switched-capacitor (SC)
circuits.” Our objective is to provide the foundation for more advanced topics such as ﬁlters, comparators,
ADCs, and DACs. Most of our study deals with switched-capacitor ampliﬁers, but the concepts can be
applied to other discrete-time circuits as well. Beginning with a general view of SC circuits, we describe
sampling switches and their speed and precision issues. Next, we analyze switched-capacitor ampliﬁers,
considering unity-gain, noninverting, and multiply-by-two topologies. Finally, we examine a switched-
capacitor integrator.
13.1
General Considerations
In order to understand the motivation for sampled-data circuits, let us ﬁrst consider the simple continuous-
time ampliﬁer shown in Fig. 13.1(a), where Vout/Vin is ideally equal to −R2/R1. Used extensively with
bipolar op amps, this circuit presents a difﬁcult issue if implemented in CMOS technology. Recall
that, to achieve a high voltage gain, the open-loop output resistance of CMOS op amps is maximized,
typically approaching hundreds of kilohms. We therefore suspect that R2 heavily drops the open-loop
gain, degrading the precision of the circuit. In fact, with the aid of the simple equivalent circuit shown in
R2
R1
Vout
Vin
R2
R1
Vout
Vin
–AvVX
Rout
VX
(a)
(b)
Figure 13.1
(a) Continuous-time feedback ampliﬁer; (b) equivalent circuit of (a).
539

540
Chap. 13
Introduction to Switched-Capacitor Circuits
Fig. 13.1(b), we can write
−Av
Vout −Vin
R1 + R2
R1 + Vin

−Rout
Vout −Vin
R1 + R2
= Vout
(13.1)
and hence
Vout
Vin
= −R2
R1
·
Av −Rout
R2
1 + Rout
R1
+ Av + R2
R1
(13.2)
Equation (13.2) implies that, compared to the case where Rout = 0, the closed-loop gain suffers from
inaccuracies in both the numerator and the denominator. Also, the input resistance of the ampliﬁer,
approximately equal to R1, loads the preceding stage while introducing thermal noise.
▲
Example13.1
Using the feedback techniques described in Chapter 8, calculate the closed-loop gain of the circuit of Fig. 13.1(a)
and compare the result with Eq. (13.2).
Solution
With the aid of the approach described in Example 8.16, the reader can prove that
Vout
Vin
=
−R2 Av
R2
2 + R1Rout + R2Rout + (1 + Av)R1R2
(13.3)
= −R2
R1
·
Av
R2
R1
+ Rout
R2
+ Rout
R1
+ 1 + Av
(13.4)
The two results are approximately equal if Rout/R2 ≪Av, a condition required to ensure that the transmission
through R2 is negligible.
▲
In the circuit of Fig. 13.1(a), the closed-loop gain is set by the ratio of R2 and R1. In order to avoid
reducing the open-loop gain of the op amp, we postulate that the resistors can be replaced by capacitors
[Fig. 13.2(a)]. Ideally, the gain of the circuit is equal to the impedance of C2 divided by the impedance
of C1 and multiplied by −1, i.e., equal to −C1/C2.
Vout
Vin
(a)
C2
C1
X
Vout
Vin
C2
C1
X
(b)
RF
Figure 13.2
(a) Continuous-time feedback ampliﬁer using capacitors; (b) use of resistor to deﬁne bias point.

Sec. 13.1
General Considerations
541
t
Vin
Vout
Figure 13.3
Step response of the
ampliﬁer of Fig. 13.2(b).
But, how is the bias voltage at node X set?1 We may add a large feedback resistor as in Fig. 13.2(b),
providing dc feedback while negligibly affecting the ac behavior of the ampliﬁer in the frequency band
of interest. Such an arrangement is indeed practical if the circuit senses only high-frequency signals.
But suppose, for example, the circuit is to amplify a voltage step. Illustrated in Fig. 13.3, the response
contains a step change due to the initial ampliﬁcation by the circuit consisting of C1, C2, and the op amp,
followed by a “tail” resulting from the loss of charge on C2 through RF. From another point of view, the
circuit may not be suited to amplify wideband signals because it exhibits a high-pass transfer function.
In fact, the transfer function is given by
Vout
Vin
(s) ≈−
RF
1
C2s
RF +
1
C2s
÷
1
C1s
(13.5)
= −
RFC1s
RFC2s + 1
(13.6)
indicating that Vout/Vin ≈−C1/C2 only if ω ≫(RFC2)−1.
The above difﬁculty can be remedied by increasing RFC2, but in many applications the required values
of the two components become prohibitively large. We must therefore seek other methods of establishing
the bias while utilizing capacitive feedback networks.
It is possible to replace RF in Fig. 13.2(b) with a switch. Illustrated in Fig. 13.4, the idea is to turn S2
on so as to place the op amp in unity-gain feedback and force VX to VB, an appropriately chosen input
common-mode level for the op amp. After the switch turns off, node X retains this voltage, allowing
proper operation. Of course, when S2 is on, the circuit does not amplify Vin.
Vout
C2
C1
X
S2
Vin
VB
Figure 13.4
Use of feedback switch
to deﬁne dc input level.
Let us now consider the switched-capacitor circuit depicted in Fig. 13.5, where three switches control
the operation: S1 and S3 connect the left plate of C1 to Vin and ground, respectively, and S2 provides
unity-gain feedback. We ﬁrst assume that the open-loop gain of the op amp is very large and study the
circuit in two phases. First, S1 and S2 are on and S3 is off, yielding the equivalent circuit of Fig. 13.6(a).
For a high-gain op amp, VB = Vout ≈0, and hence the voltage across C1 is approximately equal to Vin.
1The bias voltage is given by the initial condition at this node and hence is ambiguous.

542
Chap. 13
Introduction to Switched-Capacitor Circuits
Vout
Vin
C2
C1
S3
S1
S2
A
X
Figure 13.5
Switched-capacitor am-
pliﬁer.
Vout
Vin
C1
Vout
Vin0
X
X
C2
C1
A
A
(a)
(b)
Vin
VA
Vin0
t
t0
Vin0 C1
C2
(c)
Vout
Figure 13.6
Circuit of Fig. 13.5 in (a) sampling mode, (b) ampliﬁcation mode (c) input and output waveforms in
the two modes.
We say that C1 samples the input. Next, at t = t0, S1 and S2 turn off and S3 turns on, pulling node A to
ground. Since the gain is equal to −C1/C2 and since VA changes from Vin0 to 0, the output voltage must
change from zero to Vin0C1/C2.
The output voltage change can also be calculated by examining the transfer of charge. Note that the
charge stored on C1 just before t0 is equal to Vin0C1. After t = t0, the negative feedback through C2 drives
the op amp input differential voltage, and hence the voltage across C1, to zero (Fig. 13.7). The charge
stored on C1 at t = t0 must then be transferred to C2, producing an output voltage equal to Vin0C1/C2.
Thus, the circuit ampliﬁes Vin0 by a factor of C1/C2.
Vout
C2
C1
Vout
C2
C1
Qin0
Qin0
0
0
Figure 13.7
Transfer of charge from C1 to C2.

Sec. 13.2
Sampling Switches
543
Several attributes of the circuit of Fig. 13.5 distinguish it from continuous-time implementations.
First, the circuit devotes some time to “sampling” the input, setting the output to zero and providing no
ampliﬁcation during this period. Second, after sampling, for t > t0, the circuit ignores the input voltage
Vin, amplifying the sampled voltage. Third, the circuit conﬁguration changes considerably from one
phase to another, as seen in Fig. 13.6(a) and (b), raising concern about its stability. Note that S2 must
turn on periodically to compensate for the leakage currents that slowly discharge X. These currents arise
from S2 itself and the gate leakage of the op amp.
What is the advantage of the ampliﬁer of Fig. 13.5 over that in Fig. 13.1? In addition to sampling
capability, we note from the waveforms depicted in Fig. 13.6 that after Vout settles to Vin · C1/C2, the
current through C2 approaches zero. That is, the feedback capacitor does not reduce the open-loop gain
of the ampliﬁer if the output voltage is given enough time to settle. In Fig. 13.1, on the other hand, R2
loads the ampliﬁer continuously.
The switched-capacitor ampliﬁer of Fig. 13.5 lends itself to implementation in CMOS technology
much more easily than in other technologies. This is because discrete-time operations require switches to
perform sampling as well as a high input impedance to sense the stored quantities with no corruption. For
example, if the op amp of Fig. 13.5 incorporates bipolar transistors at its input, the base current drawn
from the inverting input in the ampliﬁcation phase [Fig. 13.6(b)] creates an error in the output voltage.
The existence of simple switches and a high input impedance have made CMOS technology the dominant
choice for sampled-data applications.
The foregoing discussion leads to the conceptual view illustrated in Fig. 13.8 for switched-capacitor
ampliﬁers. In the simplest case, the operation takes place in two phases: sampling and ampliﬁcation.
Thus, in addition to the analog input, Vin, the circuit requires a clock to deﬁne each phase.
Our study of SC ampliﬁers proceeds according to these two phases. First, we analyze various sampling
techniques. Second, we consider SC ampliﬁer topologies.
Vin
Vout
CK
t
Sample
Amplify
CK
Figure 13.8
General view of switched-capacitor ampliﬁer.
13.2
Sampling Switches
13.2.1 MOSFETS as Switches
A simple sampling circuit consists of a switch and a capacitor [Fig. 13.9(a)]. A MOS transistor can serve
as a switch [Fig. 13.9(b)] because it can be on while carrying a zero current.
To understand how the circuit of Fig. 13.9(b) samples the input, ﬁrst consider the simple cases depicted
in Fig. 13.10, where the gate command, CK, goes high at t = t0. In Fig. 13.10(a), we assume that Vin = 0
and the capacitor has an initial voltage equal to VDD. Thus, at t = t0, M1 senses a gate-source voltage
equal to VDD while its drain voltage is also equal to VDD. The transistor therefore operates in saturation,
drawing a current of ID1 = (μnCox/2)(W/L)(VDD −VT H)2 from the capacitor. As Vout falls, at some

544
Chap. 13
Introduction to Switched-Capacitor Circuits
CH
Vout
Vin
CH
Vout
Vin
CK
(a)
(b)
M1
Figure 13.9
(a) Simple sampling circuit; (b) implementation of the switch by a MOS device.
CH
Vout
CH
Vout
Vout
Vin = 0
Vin = +1 V
CK
VDD
VDD
VDD
t
CK
0
Vout
VDD
0
(a)
CK
CK
0
+1 V
M1
M1
ID1
ID1
(b)
t0
t
t0
Figure 13.10
Response of a sampling circuit to different input levels and initial conditions.
point Vout = VDD−VT H, driving M1 into the triode region. The device nevertheless continues to discharge
CH until Vout approaches zero. We note that for Vout ≪2(VDD −VT H), the transistor can be viewed as
a resistor equal to Ron = [μnCox(W/L)(VDD −VT H)]−1.
Now consider the case in Fig. 13.10(b), where Vin = +1 V, Vout(t = t0) = 0 V, and VDD = 3 V.
Here, the terminal of M1 connected to CH acts as the source, and the transistor turns on with VGS = +3
V, but VDS = +1 V. Thus, M1 operates in the triode region, charging CH until Vout approaches +1 V.
For Vout ≈+1 V, M1 exhibits an on-resistance of Ron = [μnCox(W/L)(VDD −Vin −VT H)]−1.
The above observations reveal two important points. First, a MOS switch can conduct current in either
direction simply by exchanging the role of its source and drain terminals. Second, as shown in Fig. 13.11,
when the switch is on, Vout follows Vin, and when the switch is off, Vout remains constant. Thus, the
circuit “tracks” the signal when CK is high and “freezes” the instantaneous value of Vin across CH when
CK goes low.
▲
Example13.2
In the circuit of Fig. 13.10(a), calculate Vout as a function of time. Assume that λ = 0.
Solution
Before Vout drops below VDD −VT H, M1 is saturated and we have
Vout(t) = VDD −ID1t
CH
(13.7)
= VDD −1
2μnCox
W
L (VDD −VT H)2 t
CH
(13.8)

Sec. 13.2
Sampling Switches
545
CH
Vout
Vin
CH
High
CH
Vout
Vin
CH
Low
(a)
(b)
Figure 13.11
Track and hold capabilities of a sampling circuit.
After
t1 =
2VT HCH
μnCox
W
L (VDD −VT H)2
(13.9)
M1 enters the triode region, yielding a time-dependent current. We therefore write
CH
dVout
dt
= −ID1
(13.10)
= −1
2μnCox
W
L

2(VDD −VT H)Vout −V 2
out

t > t1
(13.11)
Rearranging (13.11), we have
dVout
[2(VDD −VT H) −Vout]Vout
= −1
2μn
Cox
CH
W
L dt
(13.12)
which, upon separation into partial fractions, is written as

1
Vout
+
1
2(VDD −VT H) −Vout

dVout
VDD −VT H
= −μn
Cox
CH
W
L dt
(13.13)
Thus,
ln Vout −ln[2(VDD −VT H) −Vout] = −(VDD −VT H)μn
Cox
CH
W
L (t −t1)
(13.14)
that is
ln
Vout
2(VDD −VT H) −Vout
= −(VDD −VT H)μn
Cox
CH
W
L (t −t1)
(13.15)
Taking the exponential of both sides and solving for Vout, we obtain
Vout =
2(VDD −VT H) exp

−(VDD −VT H)μn
Cox
CH
· W
L (t −t1)

1 + exp

−(VDD −VT H)μn
Cox
CH
· W
L (t −t1)

(13.16)
▲

546
Chap. 13
Introduction to Switched-Capacitor Circuits
CH
Vout
Vin = VDD
VDD – VTH
CK
t
CK
0
VDD
Vout
0
M1
Figure 13.12
Maximum output level in an NMOS sampler.
In the circuit of Fig. 13.10(b), we assumed that Vin = +1 V (Fig. 13.12). Now suppose Vin = VDD.
How does Vout vary with time? Since the gate and drain of M1 are at the same potential, the transistor is
saturated, and we have
CH
dVout
dt
= ID1
(13.17)
= 1
2μnCox
W
L (VDD −Vout −VT H)2
(13.18)
where channel-length modulation is neglected. It follows that
dVout
(VDD −Vout −VT H)2 = 1
2μn
Cox
CH
W
L dt
(13.19)
and hence
1
VDD −Vout −VT H

V out
0
= 1
2μn
Cox
CH
W
L t

t
0
(13.20)
where body effect is neglected and Vout(t = 0) is assumed zero. Thus,
Vout = VDD −VT H −
1
1
2μn
Cox
CH
W
L t +
1
VDD −VT H
(13.21)
Equation (13.21) implies that as t →∞, Vout →VDD −VT H. This is because as Vout approaches
VDD −VT H, the overdrive voltage of M1 vanishes, reducing the current available for charging CH to
negligible values. Of course, even for Vout = VDD −VT H, the transistor conducts some subthreshold
current and, given enough time, eventually brings Vout to VDD. Nonetheless, as mentioned in Chapter 3,
for typical operation speeds, it is reasonable to assume that Vout does not exceed VDD −VT H.
The foregoing analysis demonstrates a serious limitation of MOS switches: if the input signal level is
close to VDD, then the output provided by an NMOS switch cannot track the input. From another point
of view, the on-resistance of the switch increases considerably as the input and output voltages approach
VDD −VT H. We may then ask—What is the maximum input level that the switch can pass to the output
faithfully? In Fig. 13.12, for Vout ≈Vin, the transistor must operate in the deep triode region, and hence
the upper bound of Vin equals VDD −VT H. As explained later, in practice, Vin must be quite lower than
this value.
▲
Example13.3
In the circuit of Fig. 13.13, calculate the minimum and maximum on-resistance of M1. Assume that μnCox =
50 μA/V2, W/L = 10/1, VT H = 0.7 V, VDD = 3 V, and γ = 0.

Sec. 13.2
Sampling Switches
547
CH
M1
t
+0.5 V
+3 V
1 pF
fin = 10 MHz
t
+0.5 V
Figure 13.13
Solution
We note that in the steady state, M1 remains in the triode region because the gate voltage is higher than both Vin and
Vout by a value greater than VT H. If fin = 10 MHz, we predict that Vout tracks Vin with a negligible phase shift
due to the on-resistance of M1 and CH. Assuming that Vout ≈Vin, we need not distinguish between the source and
drain terminals, obtaining
Ron1 =
1
μnCox
W
L (VDD −Vin −VT H)
(13.22)
Thus, Ron1,max ≈1.11 k and Ron1,min ≈870 . By contrast, if the maximum input level is raised to 1.5 V, then
Ron1,max = 2.5 k.
▲
MOS devices operating in the deep triode region are sometimes called “zero-offset” switches to
emphasize that they exhibit no dc shift between the input and output voltages of the simple sampling
circuit of Fig. 13.9(b).2 This is evident from the examples of Fig. 13.10, where the output eventually
becomes equal to the input. Nonexistent in bipolar technology, the zero-offset property proves crucial in
precise sampling of analog signals.
We have thus far considered only NMOS switches. The reader can verify that the foregoing principles
apply to PMOS switches as well. In particular, as shown in Fig. 13.14, a PMOS transistor fails to operate
as a switch if its gate is grounded and its drain terminal senses an input voltage of |VT H P| or less. In other
words, the on-resistance of the device rises rapidly as the input and output levels drop to |VT H P| above
ground.
CH
Vout
Vin = 0
VDD
t
CK
0
VDD
VDD
Vout
M1
CK
∣VTHP∣
Figure 13.14
Sampling circuit using PMOS switch.
13.2.2 Speed Considerations
What determines the speed of the sampling circuits of Fig. 13.9? We must ﬁrst deﬁne the speed here.
Illustrated in Fig. 13.15, a simple measure of speed is the time required for the output voltage to go
2We assume the circuit following the sampler draws no input dc current.

548
Chap. 13
Introduction to Switched-Capacitor Circuits
CH
Vout
CK
t
CK
0
VDD
Vout
0
M1
Vin = Vin0
Vin0
0
ΔV
tS
Figure 13.15
Deﬁnition of speed in a sampling circuit.
from zero to the maximum input level after the switch turns on. Since Vout would take inﬁnite time
to become equal to Vin0, we consider the output settled when it is within a certain “error band,” V,
around the ﬁnal value. For example, we say that the output settles to 0.1% accuracy after tS seconds,
meaning that in Fig. 13.15, V/Vin0 = 0.1%. Thus, the speed speciﬁcation must be accompanied by an
accuracy speciﬁcation as well. Note that after t = tS, we can consider the source and drain voltages to
be approximately equal.
From the circuit of Fig. 13.15, we surmise that the sampling speed is given by two factors: the on-
resistance of the switch and the value of the sampling capacitor. Thus, to achieve a higher speed, a large
aspect ratio and a small capacitor must be used. However, as illustrated in Fig. 13.13, the on-resistance
also depends on the input level, yielding a greater time constant for more positive inputs (in the case of
NMOS switches). From Eq. (13.22), we plot the on-resistance of the switch as a function of the input
level [Fig. 13.16(a)], noting the sharp rise as Vin approaches VDD −VT H. For example, if we restrict the
variation of Ron to a range of 4 to 1, then the maximum input level is given by
1
μnCox
W
L (VDD −Vin,max −VT H)
=
4
μnCox
W
L (VDD −VT H)
(13.23)
That is
Vin,max = 3
4(VDD −VT H)
(13.24)
This value falls around VDD/2, translating to severe swing limitations. Note that the device threshold
voltage directly limits the voltage swings.3
Vin
Vin
VDD – VTH
0
Ron,N
∣VTHP∣
0
Ron,P
(a)
(b)
Figure 13.16
On-resistance of (a) NMOS and (b) PMOS devices as a function of input voltage.
3By contrast, the output swing of cascode stages is limited by overdrive voltages rather than by the threshold voltage.

Sec. 13.2
Sampling Switches
549
In order to accommodate greater voltage swings in a sampling circuit, we ﬁrst observe that a PMOS
switch exhibits an on-resistance that decreases as the input voltage becomes more positive [Fig. 13.16(b)].
It is then plausible to employ “complementary” switches so as to allow rail-to-tail swings. Shown in
Fig. 13.17(a), such a combination requires complementary clocks, producing an equivalent resistance:
Ron,eq = Ron,N||Ron,P
=
1
μnCox(W/L)N(VDD −Vin −VT H N)||
1
μpCox(W/L)P(Vin −|VT H P|)
It follows that
Ron,eq =
1
μnCox(W/L)N(VDD −VT H N) −[μnCox(W/L)N −μpCox(W/L)P]Vin −μpCox(W/L)P|VT H P|
Vin
VDD – VTH
Ron,P
CK
CK
CH
Vout
Vin
Ron,N
Ron,eq
(a)
(b)
M1
M2
∣VTHP∣
Figure 13.17
(a) Complementary switch; (b) on-resistance of the complementary switch.
Interestingly, if μnCox(W/L)N = μpCox(W/L)P, then Ron,eq is independent of the input level.4
Figure 13.17(b) plots the behavior of Ron,eq in the general case, revealing much less variation than that
corresponding to each switch alone. We quantify the effect of switch nonlinearity in Chapter 14.
For high-speed input signals, it is critical that the NMOS and PMOS switches in Fig. 13.17(a) turn
off simultaneously so as to avoid ambiguity in the sampled value. If, for example, the NMOS device
turns off t seconds earlier than the PMOS device, then the output voltage tends to track the input for
the remaining t seconds, but with a large, input-dependent time constant (Fig. 13.18). This effect gives
rise to distortion in the sampled value. For moderate precision, the simple circuit shown in Fig. 13.19
provides complementary clocks by duplicating the delay of inverter I1 through the pass gate G2.
13.2.3 Precision Considerations
Our foregoing study of MOS switches indicates that a larger W/L or a smaller sampling capacitor results
in a higher speed. In this section, we show that these methods of increasing the speed degrade the precision
with which the signal is sampled.
Three mechanisms in MOS transistor operation introduce error at the instant the switch turns off. We
study each effect individually.
4In reality, VT H N and VT H P vary with Vin through body effect, but we ignore this variation here.

550
Chap. 13
Introduction to Switched-Capacitor Circuits
CK
CK
Δt
Vin
Vout
t
Ideal
Value
Figure 13.18
Distortion generated if
complementary switches do not turn off
simultaneously.
G2
VDD
CKin
CK
CK
I1
Figure 13.19
Simple circuit generat-
ing complementary clocks.
Channel Charge Injection
Consider the sampling circuit of Fig. 13.20, and recall that for a MOSFET
to be on, a channel must exist at the oxide-silicon interface. Assuming that Vin ≈Vout, we use our
derivations in Chapter 2 to express the total charge in the inversion layer as
Qch = W LCox(VDD −Vin −VT H)
(13.25)
where L denotes the effective channel length. When the switch turns off, Qch exits through the source
and drain terminals, a phenomenon called “channel charge injection.”
CH
Vout
Vin
CK
M1
Figure 13.20
Charge injection when a
switch turns off.
The charge injected to the left side of Fig. 13.20 is absorbed by the input source, creating no error.
On the other hand, the charge injected to the right side is deposited on CH, introducing an error in the
voltage stored on the capacitor. For example, if half of Qch is injected onto CH, the resulting error equals
V = W LCox(VDD −Vin −VT H)
2CH
(13.26)
Illustrated in Fig. 13.21, the error for an NMOS switch appears as a negative “pedestal” at the output.
Note that the error is directly proportional to W LCox and inversely proportional to CH.

Sec. 13.2
Sampling Switches
551
CH
Vout
Vin
CK
M1
ΔV
Figure 13.21
Effect of charge injection.
An important question that arises now is—Why did we assume in arriving at (13.26) that exactly half
of the channel charge is injected onto CH? In reality, the fraction of charge that exits through the source
and drain terminals is a relatively complex function of various parameters, such as the impedance seen at
each terminal to ground and the transition time of the clock [1, 2]. Investigations of this effect have not
yielded any rule of thumb that can predict the charge splitting in terms of such parameters. Furthermore,
in many cases, these parameters, e.g., the clock transition time, are poorly controlled. Also, most circuit
simulation programs model charge injection quite inaccurately. As a worst-case estimate, we can assume
that the entire channel charge is injected onto the sampling capacitor.
How does charge injection affect the precision? Assuming that all of the charge is deposited on the
capacitor, we express the sampled output voltage as
Vout ≈Vin −W LCox(VDD −Vin −VT H)
CH
(13.27)
where the phase shift between the input and the output is neglected. Thus,
Vout = Vin

1 + W LCox
CH

−W LCox
CH
(VDD −VT H)
(13.28)
suggesting that the output deviates from the ideal value through two effects: a nonunity gain equal to
1+W LCox/CH,5 and a constant offset voltage −W LCox(VDD −VT H)/CH (Fig. 13.22). In other words,
since we have assumed that channel charge is a linear function of the input voltage, the circuit exhibits
only gain error and dc offset.
Vin
Sampled
Vout
Ideal
With
Charge
Injection
Offset
Figure 13.22
Input/output character-
istic of sampling circuit in the presence
of charge injection.
In the foregoing discussion, we tacitly assumed that VTH is constant. However, for NMOS switches (in
ann-welltechnology),bodyeffectmustbetakenintoaccount.6 Since VTH=VTH0+γ (√2φB+VSB−√2φB),
5The voltage gain is greater than unity because the pedestal becomes smaller as the input level rises.
6Even for PMOS switches, the n-well is connected to the most positive supply voltage because the source and drain terminals
of the switch may interchange during sampling.

552
Chap. 13
Introduction to Switched-Capacitor Circuits
and VBS ≈−Vin, we have
Vout = Vin −W LCox
CH
	
VDD −Vin −VT H0 −γ

2φB + Vin + γ

2φB

,
(13.29)
= Vin

1 + W LCox
CH

+ γ W LCox
CH

2φB + Vin
−W LCox
CH
	
VDD −VT H0 + γ

2φB

(13.30)
It follows that the nonlinear dependence of VT H upon Vin introduces nonlinearity in the input/output
characteristic.
In summary, charge injection contributes three types of errors in MOS sampling circuits: gain error,
dc offsets, and nonlinearity. In many applications, the ﬁrst two can be tolerated or corrected whereas the
last cannot.
It is instructive to consider the speed-precision trade-off resulting from charge injection. Representing
the speed by a simple time constant τ and the precision by the error V due to charge injection, we
deﬁne a ﬁgure of merit as F = (τV )−1. Writing
τ = RonCH
(13.31)
=
1
μnCox(W/L)(VDD −Vin −VT H)CH
(13.32)
and
V = W LCox
CH
(VDD −Vin −VT H)
(13.33)
we have
F = μn
L2
(13.34)
Thus, to the ﬁrst order, the trade-off is independent of the switch width and the sampling capacitor.
Clock Feedthrough
In addition to channel charge injection, a MOS switch couples the clock transitions
to the sampling capacitor through its gate-drain or gate-source overlap capacitance. Depicted in Fig. 13.23,
the effect introduces an error in the sampled output voltage. Assuming the overlap capacitance is constant,
we express the error as
V = VCK
WCov
WCov + CH
(13.35)
CH
Vout
Vin
M1
VCK
0
Figure 13.23
Clock feedthrough in a
sampling circuit.

Sec. 13.2
Sampling Switches
553
where Cov is the overlap capacitance per unit width. The error V is independent of the input level,
manifesting itself as a constant offset in the input/output characteristic. As with charge injection, clock
feedthrough leads to a trade-off between speed and precision as well.
kT/C Noise
Recall from Example 7.3 that a resistor charging a capacitor gives rise to a total rms noise
voltage of √kT/C. As shown in Fig. 13.24, a similar effect occurs in sampling circuits. The on-resistance
of the switch introduces thermal noise at the output and, when the switch turns off, this noise is stored
on the capacitor along with the instantaneous value of the input voltage. It can be proved that the rms
voltage of the sampled noise in this case is still approximately equal to √kT/C [3, 4].
CH
Vout
Vin
Ron
CH
Vin + Vn
Vin
Figure 13.24
Thermal noise in a sampling circuit.
The problem of kT/C noise limits the performance in many high-precision applications. In order
to achieve low noise, the sampling capacitor must be sufﬁciently large, thus loading other circuits and
degrading the speed.
13.2.4 Charge Injection Cancellation
The dependence of charge injection upon the input level and the trade-off expressed by (13.34) make it
necessary to seek methods of canceling the effect of charge injection so as to achieve a higher F. We
consider a few such techniques here.
To arrive at the ﬁrst technique, we postulate that the charge injected by the main transistor can be
removed by means of a second transistor. As shown in Fig. 13.25, a “dummy” switch, M2, driven by CK
is added to the circuit such that after M1 turns off and M2 turns on, the channel charge deposited by the
former on CH is absorbed by the latter to create a channel. Note that both the source and drain of M2 are
connected to the output node.
CH
Vin
Vout
CK
CK
Δq1
M1
M2
Δq2
Figure 13.25
Addition of dummy de-
vice to reduce charge injection and clock
feedthrough.
How do we ensure that the charge injected by M1, q1, is equal to that absorbed by M2, q2? Suppose
half of the channel charge of M1 is injected onto CH, i.e.,
q1 = W1L1Cox
2
(VCK −Vin −VT H1)
(13.36)
Since q2 = W2L2Cox(VCK −Vin −VT H2), if we choose W2 = 0.5W1 and L2 = L1, then q2 = q1.
Unfortunately, the assumption of equal splitting of charge between source and drain is generally invalid,
making this approach less attractive.

554
Chap. 13
Introduction to Switched-Capacitor Circuits
Interestingly, with the choice W2 = 0.5W1 and L2 = L1, the effect of clock feedthrough is suppressed.
As depicted in Fig. 13.26, the total charge in Vout is zero because
−VCK
W1Cov
W1Cov + CH + 2W2Cov
+ VCK
2W2Cov
W1Cov + CH + 2W2Cov
= 0
(13.37)
CH
CH
Vin
CK
CK
CK
Vout
M1
M2
CK
W1 Cov
2W2 Cov
Figure 13.26
Clock feedthrough suppression by dummy switch.
Another approach to lowering the effect of charge injection incorporates both PMOS and NMOS
devices such that the opposite charge packets injected by the two cancel each other (Fig. 13.27). For
q1 to cancel q2, we must have W1L1Cox(VCK −Vin −VT H N) = W2L2Cox(Vin −|VT H P|). Thus,
the cancellation occurs for only one input level. Even for clock feedthrough, the circuit does not pro-
vide complete cancellation because the gate-drain overlap capacitance of NFETs is not equal to that
of PFETs.
CK
CK
CH
Vout
Vin
M1
M2
Δq2
Holes
Electrons
Δq1
Figure 13.27
Use of complementary
switches to reduce charge injection.
Our knowledge of the advantages of differential circuits suggests that the problem of charge injection
may be relieved through differential operation. As shown in Fig. 13.28, we surmise that charge injection
appears as a common-mode disturbance. But, writing q1 = W LCox(VCK −Vin1 −VT H1) and q2 =
W LCox(VCK −Vin2 −VT H2), we recognize that q1 = q2 only if Vin1 = Vin2. In other words, the
overall error is not suppressed for differential signals. Nevertheless, this technique both removes the
CH
Vin2
CK
Δq1
Vin1
CH
M1
M2
Δq2
Vout2
Vout1
Figure 13.28
Differential
sampling
circuit.

Sec. 13.3
Switched-Capacitor Ampliﬁers
555
constant offset and lowers the nonlinear component. This can be understood by writing
q1 −q2 = W LCox[(Vin2 −Vin1) + (VT H2 −VT H1)]
(13.38)
= W LCox

Vin2 −Vin1 + γ
	
2φF + Vin2 −

2φF + Vin1

(13.39)
Since for Vin1 = Vin2, q1−q2 = 0, the characteristic exhibits no offset. Also, the nonlinearity of body
effect now appears in both square-root terms of (13.39), leading to only odd-order distortion (Chapter 14).
The problem of charge injection continues to limit the speed-precision envelope in sampled-data
systems. Many cancellation techniques have been introduced, but each leads to other trade-offs. One
such technique, called “bottom-plate sampling,” is widely used in switched-capacitor circuits and is
described later in this chapter.
13.3
Switched-Capacitor Ampliﬁers
As mentioned in Sec. 13.1 and exempliﬁed by the circuit of Fig. 13.5, CMOS feedback ampliﬁers are
more easily implemented with a capacitive feedback network than with a resistive one. Having examined
sampling techniques, we are now ready to study a number of switched-capacitor ampliﬁers. Our objective
is to understand the underlying principles as well as the speed-precision trade-offs encountered in the
design of each circuit.
Before studying SC ampliﬁers, it is helpful to look brieﬂy at the physical implementation of capacitors
in CMOS technology. A simple capacitor structure is shown in Fig. 13.29(a), where the “top plate” and the
“bottom plate” are realized by metal layers. An important concern in using this structure is the parasitic
capacitance between each plate and the substrate. In particular, the bottom plate suffers from capacitance,
C p, to the underlying substrate—a value typically 5 to 10% of the main capacitance. For this reason, we
usually model the capacitor as in Fig. 13.29(b). Monolithic capacitors are described in more detail in
Chapters 18 and 19.
CP
CAB
CP
(a)
(b)
A
Metal 9
Dielectric
Metal 8
B
Substrate
Top Plate
Bottom Plate
Figure 13.29
(a) Monolithic capacitor structure; (b) circuit model of (a) including parasitic capacitance to the
substrate.
13.3.1 Unity-Gain Sampler/Buffer
While a unity-gain ampliﬁer can be realized with no resistors or capacitors in the feedback network
[Fig. 13.30(a)], for discrete-time applications, it still requires a sampling circuit. We may therefore
conceive the circuit shown in Fig. 13.30(b) as a sampler/buffer. However, the input-dependent charge
injected by S1 onto CH limits the accuracy here.
Now consider the topology depicted in Fig. 13.31(a), where three switches control the sampling and
ampliﬁcation modes. In the sampling mode, S1 and S2 are on and S3 is off, yielding the topology shown
in Fig. 13.31(b). Thus, Vout = VX ≈0, and the voltage across CH tracks Vin. At t = t0, when Vin = V0,

556
Chap. 13
Introduction to Switched-Capacitor Circuits
Vout
Vin
CH
Vin
Vout
(a)
(b)
S1
Figure 13.30
(a) Unity-gain buffer; (b) sampling circuit followed by unity-gain buffer.
Vout
Vin
S1
S3
S2
Vout
Vin
CH
CH X
X
Vout
CH
X
(c)
(a)
(b)
V0
V0
Figure 13.31
(a) Unity-gain sampler; (b) circuit of (a) in sampling mode; (c) circuit of (a) in ampliﬁcation mode.
S1 and S2 turn off and S3 turns on, ﬂipping the capacitor around the op amp and entering the circuit into
the ampliﬁcation mode [Fig. 13.31(c)]. Since the op amp’s high gain requires that node X still be a virtual
ground and since the charge on the capacitor must be conserved, Vout rises to a value approximately equal
to V0. This voltage is therefore “frozen,” and it can be processed by subsequent stages.
With proper timing, the circuit of Fig. 13.31(a) can substantially alleviate the problem of channel
charge injection. As Fig. 13.32 illustrates in “slow motion,” during the transition from the sampling mode
to the ampliﬁcation mode, S2 turns off slightly before S1 does. We carefully examine the effect of the
charge injected by S2 and S1. When S2 turns off, it injects a charge packet q2 onto CH, producing
an error equal to q2/CH. However, this charge is independent of the input level because node X is a
virtual ground. For example, if S2 is realized by an NMOS device whose gate voltage equals VCK, then
q2 = W LCox(VCK −VT H −VX).
Δq2
Vout
Vin
CH
S1
S2
X
(a)
(b)
Vout
Vin
CH
S1
S2
X
Vout
CH
S3
X
(c)
Figure 13.32
Operation of the unity-gain sampler in slow motion.
The constant magnitude of q2 means that the channel charge of S2 introduces only an offset (rather
than gain error or nonlinearity) in the input/output characteristic. As described below, this offset can
easily be removed by differential operation. But, how about the charge injected by S1 onto CH? Let us
set Vin to zero and suppose that S1 injects a charge packet q1 onto node P (after S2 has turned off)
[Fig. 13.33(a)]. If the capacitance connected from X to ground (including the input capacitance of the
op amp) is zero, VP and VX jump to inﬁnity. To simplify the analysis, we assume a capacitance equal to
CX from X to ground [Fig. 13.33(b)], and we will see shortly that its value does not affect the results. In

Sec. 13.3
Switched-Capacitor Ampliﬁers
557
Vout
Vin
CH
X
(a)
(b)
(c)
S1
Vout
Vin
CH
S1
Δq1
Δq1
X
CX
X
CX
CH
Vout
Av1
P
P
Figure 13.33
Effect of charge injected by S1 with (a) zero and (b) ﬁnite op amp input capacitance; (c) transition
of circuit to ampliﬁcation mode.
Fig. 13.33(b), each of the series capacitors CH and CX carries a charge equal to q1. Now, as shown in
Fig. 13.33(c), we place CH around the op amp, seeking to obtain the resulting output voltage.
To calculate the output voltage, we must make an important observation: the total charge at node X
cannot change after S2 turns off because no path exists for electrons to ﬂow into or out of this node. Thus,
if before S1 turns off, the total charge on the right plate of CH and the top plate of CX is zero, it must still
add up to zero after S1 injects charge because no resistive path is connected to X. The same holds true
after CH is placed around the op amp.
Now consider the circuit of Fig. 13.33(c), assuming that the total charge at node X is zero. We can
write CXVX −(Vout −VX)CH = 0, and VX = −Vout/Av1. Thus, −(CX + CH)Vout/Av1 −VoutCH = 0,
i.e., Vout = 0. Note that this result is independent of q1, capacitor values, or the gain of the op amp,
thereby revealing that the charge injection by S1 introduces no error if S2 turns off ﬁrst.
In summary, in Fig. 13.31(a), after S2 turns off, node X “ﬂoats,” maintaining a constant total charge
regardless of the transitions at other nodes of the circuit. As a result, after the feedback conﬁguration
is formed, the output voltage is not inﬂuenced by the charge injection due to S1. From another point of
view, node X is a virtual ground at the moment S2 turns off, freezing the instantaneous input level across
CH and yielding a charge equal to V0CH on the left plate of CH. After settling with feedback, node X is
again a virtual ground, forcing CH to still carry V0CH and hence the output voltage to be approximately
equal to V0.
The effect of the charge injected by S1 can be studied from yet another perspective. Suppose that in
Fig. 13.33(c), the output voltage is ﬁnite and positive. Then, since VX = Vout/(−Av1), VX must be ﬁnite
and negative, requiring negative charge on the top plate of CX. For the total charge at X to be zero, the
charge on the left plate of CH must be positive and that on its right plate negative, giving Vout ≤0. Thus,
the only valid solution is Vout = 0.
The third switch in Fig. 13.31(a), S3, also merits attention. In order to turn on, S3 must establish an
inversion layer at its oxide interface. Does the required channel charge come from CH or from the op
amp? We note from the foregoing analysis that after the feedback circuit has settled, the charge on CH
equals V0CH, unaffected by S3. The channel charge of this switch is therefore entirely supplied by the
op amp, introducing no error.
Our study of Fig. 13.31(a) thus far suggests that, with proper timing, the charge injected by S1 and S3
is unimportant and the channel charge of S2 results in a constant offset voltage. Figure 13.34 depicts a
simple realization of the clock edges to ensure that S1 turns off after S2 does.
The input-independent nature of the charge injected by the reset switch allows complete cancellation by
differential operation. Illustrated in Fig. 13.35, such an approach employs a differential op amp along with
two sampling capacitors so that the charge injected by S2 and S′
2 appears as a common-mode disturbance
at nodes X and Y. This is in contrast to the behavior of the differential circuit shown in Fig. 13.28, where
the input-dependent charge injection still leads to nonlinearity. In reality, S2 and S′
2 exhibit a ﬁnite charge
injection mismatch, an issue resolved by adding another switch, Seq, that turns off slightly after S2 and
S′
2 (and before S1 and S′
1), thereby equalizing the charge at nodes X and Y.

558
Chap. 13
Introduction to Switched-Capacitor Circuits
Vout
Vin
CH
S1
S3
X
CK
S2
Figure 13.34
Generation of proper clock edges for unity-gain sampler.
Vin
CH
S1
S3
S2
X
S'1
S'3
S'2
CH Y
Seq
Vout
Figure 13.35
Differential realization
of unity-gain sampler.
Precision Considerations
The circuit of Fig. 13.31(a) operates as a unity-gain buffer in the ampliﬁ-
cation mode, producing an output voltage approximately equal to the voltage stored across the capacitor.
How close to unity is the gain here? As a general case, we assume that the op amp exhibits a ﬁnite input
capacitance Cin and calculate the output voltage when the circuit goes from the sampling mode to the
ampliﬁcation mode (Fig. 13.36). Owing to the ﬁnite gain of the op amp, VX ̸= 0 in the ampliﬁcation
mode, giving a charge equal to CinVX on Cin. The conservation of charge at X requires that CinVX
come from CH, raising the charge on CH to CH V0 +CinVX.7 It follows that the voltage across CH equals
(CH V0+CinVX)/CH. We therefore write Vout −(CH V0+CinVX)/CH = VX and VX = −Vout/Av1. Thus,
Vout =
V0
1 +
1
Av1
Cin
CH
+ 1

(13.40)
≈V0

1 −
1
Av1
Cin
CH
+ 1

(13.41)
Vout
Vin
CH
X
Vout
CH
X
V0
Cin
Cin
Av1
Av1
Figure 13.36
Equivalent circuit for accuracy calculations.
7The charge on CH increases because positive charge transfer from the left plate of CH to the top plate of Cin leads to a more
positive voltage across CH.

Sec. 13.3
Switched-Capacitor Ampliﬁers
559
As expected, if Cin/CH ≪1, then Vout ≈V0/(1 + A−1
v1 ). In general, however, the circuit suffers from a
gain error of approximately −(Cin/CH +1)/Av1, suggesting that the input capacitance must be minimized
even if speed is not critical. Recall from Chapter 9 that to increase Av1, we may choose a large width for
the input transistors of the op amp, but at the cost of higher input capacitance. An optimum device size
must therefore yield minimum gain error rather than maximum Av1.
▲
Example13.4
In the circuit of Fig. 13.36, Cin = 0.5 pF and CH = 2 pF. What is the minimum op amp gain that guarantees a gain
error of 0.1%?
Solution
Since Cin/CH = 0.25, we have Av1,min = 1000 × 1.25 = 1250.
▲
Speed Considerations
Let us ﬁrst examine the circuit in the sampling mode [Fig. 13.37(a)]. What is
the time constant in this phase? The total resistance in series with CH is given by Ron1 and the resistance
between X and ground, RX. Using the simple op amp model shown in Fig. 13.37(b), where R0 denotes
the open-loop output impedance of the op amp, we have
(IX −GmVX)R0 + IX Ron2 = VX
(13.42)
that is
RX = R0 + Ron2
1 + Gm R0
(13.43)
Since typically Ron2 ≪R0 and Gm R0 ≫1, we have RX ≈1/Gm. For example, in a telescopic op
amp employing differential to single-ended conversion, Gm equals the transconductance of each input
transistor.
Vout
Vin
CH
S1
X
S2
CK
CK
GmVX
Ron2
VX
IX
R0
X
(a)
(b)
Figure 13.37
(a) Unity-gain sampler in sampling mode; (b) equivalent circuit of (a).
The time constant in the sampling mode is thus equal to
τsam =

Ron1 + 1
Gm

CH
(13.44)
The magnitude of τsam must be sufﬁciently small to allow settling in the test case of Fig. 13.15 to the
required precision.
Now let us consider the circuit as it enters the ampliﬁcation mode. Shown in Fig. 13.38 along with
both the op amp input capacitance and the load capacitance, the circuit must begin with Vout ≈0 and
eventually produce Vout ≈V0. If Cin is relatively small, we can assume that the voltages across CL and

560
Chap. 13
Introduction to Switched-Capacitor Circuits
X
CH
Vout
CL
Cin
t
VX
0
Vout
V0
–V0
t0
Figure 13.38
Time response of unity-gain sampler in ampliﬁcation mode.
CH do not change instantaneously, concluding that if Vout ≈0 and VC H ≈V0, then VX = −V0 at the
beginning of the ampliﬁcation mode. In other words, the input difference sensed by the op amp initially
jumps to a large value, possibly causing the op amp to slew. But, let us ﬁrst assume that the op amp can
be modeled by a linear model and determine the output response.
To simplify the analysis, we represent the charge on CH by an explicit series voltage source, VS, that
goes from zero to V0 at t = t0 while CH carries no charge itself (Fig. 13.39). The objective is to obtain
the transfer function Vout(s)/VS(s) and hence the step response. We have
Vout
 1
R0
+ CLs

+ GmVX = (VS + VX −Vout)CHs
(13.45)
GmVX
R0
X
CH
Vout
CL
Cin
VX
VS
Figure 13.39
Equivalent circuit of
unity-gain circuit in ampliﬁcation mode.
Also, since the current through Cin equals VXCins,
VX
Cins
CHs + VX + VS = Vout
(13.46)
Calculating VX from (13.46) and substituting in (13.45), we arrive at the transfer function:
Vout
VS
(s) = R0
(Gm + Cins)CH
R0(CLCin + CinCH + CHCL)s + Gm R0CH + CH + Cin
(13.47)
Note that for s = 0, (13.47) reduces to a form similar to (13.40). Since typically Gm R0CH ≫CH + Cin,
we can simplify (13.47) as
Vout
VS
(s) =
(Gm + Cins)CH
(CLCin + CinCH + CHCL)s + GmCH
(13.48)
Thus, the response is characterized by a time constant equal to
τamp = CLCin + CinCH + CHCL
GmCH
(13.49)
=
1
Gm

Cin +

1 + Cin
CH

CL

(13.50)

Sec. 13.3
Switched-Capacitor Ampliﬁers
561
which is independent of the op amp output resistance. This is because a higher R0 leads to a greater loop
gain, eventually yielding a constant closed-loop speed. Another interesting interpretation of this result is
described later (Fig. 13.52).
▲
Example13.5
Consider the special cases CL = 0 and Cin = 0 and explain the results intuitively.
Solution
If CL = 0, then τ = Cin/Gm. This occurs because the equivalent resistance seen by Cin is simply equal to 1/Gm
if CL = 0 [Fig. 13.40(a)].
CH
CH
(a)
Cin
CL
Gm
1
Gm
1
(b)
Figure 13.40
If Cin = 0, we have τ = CL/Gm because CL now sees a driving resistance equal to 1/Gm [Fig. 13.40(b)].
▲
We now study the slewing behavior of the circuit, considering a telescopic op amp as an example.
Upon entering the ampliﬁcation mode, the circuit may experience a large step at the inverting input
(Fig. 13.38). As shown in Fig. 13.41, the tail current of the op amp’s input differential pair is then steered
to one side, and its mirror current charges the capacitance seen at the output. Since M2 is off during
slewing, Cin is negligible and the slew rate is approximately equal to ISS/CL. The slewing continues
until VX is sufﬁciently close to the gate voltage of M1, after which point the settling progresses with the
time constant given in (13.50).
Our foregoing studies reveal that the input capacitance of the op amp degrades both the speed and
the precision of the unity-gain sampler/buffer. For this reason, the bottom plate of CH in Fig. 13.31 is
usually driven by the input signal or the output of the op amp, and the top plate is connected to node X
M2
VDD
M5
M1
ISS
M8
M7
M6
ISS
CL
Vb
CH
Vout
M4
M3
V0
X
Off
ISS
Figure 13.41
Unity-gain sampler dur-
ing slewing.

562
Chap. 13
Introduction to Switched-Capacitor Circuits
Vout
Vin
S1
S3
S2
X
Figure 13.42
Connection of capacitor to the unity-gain sampler.
(Fig. 13.42), minimizing the parasitic capacitance seen from node X to ground. This technique is called
“bottom-plate sampling.” Driving the bottom plate by the input or the output also avoids the injection of
substrate noise to node X (Chapter 19).
It is instructive to compare the performance of the sampling circuits shown in Figs. 13.30(b) and
13.31(a). In Fig. 13.30(b), the sampling time constant is smaller because it depends on only the on-
resistance of the switch. More important, in Fig. 13.30(b), the ampliﬁcation after the switch turns off
is almost instantaneous, whereas in Fig. 13.31, it requires a ﬁnite settling time. However, the critical
advantage of the unity-gain sampler is the input-independent charge injection.
13.3.2 Noninverting Ampliﬁer
In this section, we revisit the ampliﬁer of Fig. 13.5, studying its speed and precision properties. Repeated
in Fig. 13.43(a), the ampliﬁer operates as follows. In the sampling mode, S1 and S2 are on and S3
is off, creating a virtual ground at X and allowing the voltage across C1 to track the input voltage
[Fig. 13.43(b)]. At the end of the sampling mode, S2 turns off ﬁrst, injecting a constant charge, q2, onto
node X. Subsequently, S1 turns off and S3 turns on [Fig. 13.43(c)]. Since VP goes from Vin0 to 0, the
output voltage changes from 0 to approximately Vin0(C1/C2), providing a voltage gain equal to C1/C2.
We call the circuit a “noninverting ampliﬁer” because the ﬁnal output has the same polarity as Vin0 and
the gain can be greater than unity.
Vout
C1
Vout
Vin0
C2
C1
(a)
(b)
Vout
Vin
Vin
C2
C1
S3
X
X
S1
S2
P
(c)
X
P
t
C1
C2
Vin0
Figure 13.43
(a) Noninverting ampliﬁer; (b) circuit of (a) in sampling mode; (c) transition of circuit to
ampliﬁcation mode.

Sec. 13.3
Switched-Capacitor Ampliﬁers
563
As with the unity-gain circuit of Fig. 13.31(a), the noninverting ampliﬁer avoids input-dependent
charge injection by proper timing, namely, turning S2 off before S1 (Fig. 13.44). After S2 is off, the
total charge at node X remains constant, making the circuit insensitive to charge injection of S1 or
charge “absorption” of S3. Let us ﬁrst study the effect of S1 carefully. As illustrated in Fig. 13.45,
the charge injected by S1, q1, changes the voltage at node P by approximately VP = q1/C1,
and hence the output voltage by −q1C1/C2. However, after S3 turns on, VP drops to zero. Thus, the
overall change in VP is equal to 0 −Vin0 = −Vin0, producing an overall change in the output equal to
−Vin0(−C1/C2) = Vin0C1/C2.
Δq2
Vout
Vin
S1
S2
X
C2
P C1
Vin0
Figure 13.44
Transition of noninvert-
ing ampliﬁer to ampliﬁcation mode.
ΔVP
Vout
Vin
X
C2
P
C1
C1
C2
Vin0
S1
Δq1
t
Vin0
0
VP
Vout
t
S1 turns off.
S3 turns on.
S3
Figure 13.45
Effect of charge injected by S1.
The key point here is that VP goes from one ﬁxed voltage, V0, to another, 0, with an intermediate
perturbation due to S1. Since the output voltage of interest is measured after node P is connected to
ground, the charge injected by S1 does not affect the ﬁnal output. From another perspective, as shown
in Fig. 13.46, the charge on the right plate of C1 at the instant S2 turns off is approximately equal
0
Vout
Vin
S1
S2
X
C2
P C1
Vin0
Vout
S2
X
C2
P C1
Vin0
0
Figure 13.46
Charge redistribution in noninverting ampliﬁer.

564
Chap. 13
Introduction to Switched-Capacitor Circuits
to −Vin0C1. Also, the total charge at node X must remain constant after S2 turns off. Thus, when node
P is connected to ground and the circuit settles, the voltage across C1, and hence its charge, are nearly
zero, and the charge −Vin0C1 must reside on the left plate of C2. In other words, the output voltage is
approximately equal to Vin0C1/C2 regardless of the intermediate excursions at node P.
The foregoing discussion indicates that two other phenomena have no effect on the ﬁnal output. First,
from the time S2 turns off until the time S1 turns off, the input voltage may change signiﬁcantly (Fig. 13.47)
without introducing any error. In other words, the sampling instant is deﬁned by the turn-off of S2. Second,
when S3 turns on, it requires some channel charge, but since the ﬁnal value of VP is zero, this charge is
unimportant. Neither of these effects introduces error because the total charge at node X is conserved and
VP is eventually set by a ﬁxed (zero) potential. To emphasize that VP is initially and ﬁnally determined
by ﬁxed voltages, we say that node P is “driven” or node P switches from a low-impedance node to
another low-impedance node. Here the term low-impedance distinguishes node P, at which charge is not
conserved, from “ﬂoating” nodes such as X, where charge is conserved.
Vout
Vin
C2
C1
S3
S1
X
P
t
S2
Figure 13.47
Effect of input change after S2 turns off.
In summary, proper timing in Fig. 13.43(a) ensures that node X is perturbed only by the charge
injection of S2, making the ﬁnal value of Vout free from errors due to S1 and S3. The constant offset due
to S2 can be suppressed by differential operation (Fig. 13.48).
Vin
C1
S1
S3
S2
X
C1
Y
Seq
Vout
C2
C2
S'3
S'2
S'1
Figure 13.48
Differential realization
of noninverting ampliﬁer.
▲
Example13.6
In the differential circuit of Fig. 13.48, suppose the equalizing switch is not used and S2 and S′
2 exhibit a threshold
voltage mismatch of 10 mV. If C1 = 1 pF, C2 = 0.5 pF, VT H = 0.6 V, and for all switches W LCox = 50 fF,

Sec. 13.3
Switched-Capacitor Ampliﬁers
565
calculate the dc offset measured at the output assuming that all of the channel charge of S2 and S′
2 is injected onto
X and Y, respectively.
Solution
Simplifying the circuit as in Fig. 13.49, we have Vout ≈q/C2, where q = W LCoxVT H. Note that C1 does
not appear in the result because X is a virtual ground, i.e., the voltage across C1 changes only negligibly. Thus,
the injected charge resides primarily on the left plate of C2, giving an output error voltage equal to Vout =
W LCoxVT H/C2 = 1 mV.
Vin
C1
S1
X
C1 Y
Vout
C2
C2
Δq
S'2
S'1
Figure 13.49
▲
Precision Considerations
As mentioned above, the circuit of Fig. 13.43(a) provides a nominal voltage
gain of C1/C2. We now calculate the actual gain if the op amp exhibits a ﬁnite open-loop gain equal to
Av1. Depicted in Fig. 13.50 along with the input capacitance of the op amp, the circuit ampliﬁes the input
voltage change such that
(Vout −VX)C2s = VXCins + (VX −Vin)C1s
(13.51)
Since Vout = −Av1VX, we have

Vout
Vin
 =
C1
C2 + C2 + C1 + Cin
Av1
(13.52)
For large Av1,

Vout
Vin
 ≈C1
C2

1 −C2 + C1 + Cin
C2
·
1
Av1

(13.53)
implying that the ampliﬁer suffers from a gain error of (C2 +C1 +Cin)/(C2Av1). Note that the gain error
increases with the nominal gain C1/C2.
X
C2
Vout
Cin
Vin
C1
Av1
Figure 13.50
Equivalent circuit of
noninverting ampliﬁer during ampliﬁcation.

566
Chap. 13
Introduction to Switched-Capacitor Circuits
Comparing (13.41) with (13.53), we note that with CH = C2 and for a nominal gain of unity, the
noninverting ampliﬁer exhibits greater gain error than does the unity-gain sampler. This is because the
feedback factor equals C2/(C1 + Cin + C2) in the former and CH/(CH + Cin) in the latter. For example,
if Cin is negligible, the unity-gain sampler’s gain error is half that of the noninverting ampliﬁer.
Speed Considerations
The smaller feedback factor in Fig. 13.50 suggests that the time response of the
ampliﬁer may be slower than that of the unity-gain sampler. This is indeed true. Consider the equivalent
circuit shown in Fig. 13.51(a). Since the only difference between this circuit and that in Fig. 13.39 is the
capacitor C1, which is connected from node X to an ideal voltage source, we expect that (13.50) gives
the time constant of this ampliﬁer as well if Cin is replaced by Cin +C1. But for a more rigorous analysis,
we substitute Vin, C1, and Cin in Fig. 13.51(a) with a Thevenin equivalent as in Fig. 13.51(b), where
α = C1/(C1 + Cin), and Ceq = C1 + Cin and note that
VX = (αVin −Vout)
Ceq
Ceq + C2
+ Vout
(13.54)
GmVX
R0
X
C2
Vout
CL
GmVX
R0
Vout
CL
Cin
VX
C1
Vin
X
C2
Ceq
αVin
VX
(a)
(b)
Figure 13.51
(a) Equivalent circuit of noninverting ampliﬁer in ampliﬁcation mode; (b) circuit of (a) with
Vin, C1, and Cin replaced by a Thevenin equivalent.
Thus,

(αVin −Vout)
Ceq
Ceq + C2
+ Vout

Gm + Vout
 1
R0
+ CLs

= (αVin −Vout) CeqC2
Ceq + C2
s
(13.55)
and hence
Vout
Vin
(s) =
−Ceq
C1
C1 + Cin
(Gm −C2s)R0
C2Gm R0 + Ceq + C2 + R0[CL(Ceq + C2) + CeqC2]s
(13.56)
Note that for s = 0, (13.56) reduces to (13.52). For a large Gm R0, we can simplify (13.56) to
Vout
Vin
(s) ≈
−Ceq
C1
C1 + Cin
(Gm −C2s)R0
R0(CLCeq + CLC2 + CeqC2)s + Gm R0C2
(13.57)

Sec. 13.3
Switched-Capacitor Ampliﬁers
567
obtaining a time constant of
τamp = CLCeq + CLC2 + CeqC2
GmC2
(13.58)
which is the same as the time constant of Fig. 13.38 if Cin is replaced by Cin + C1. Note the direct
dependence of τamp upon the nominal gain, C1/C2.
This expression can be rewritten as
τ = C1 + C2 + Cin
C2
·
CL + C2(Cin + C1)
C2 + Cin + C1
Gm
(13.59)
yielding interesting insights: the time constant is given by an equivalent capacitance, CL + C2(Cin +
C1)/(C2+Cin +C1), and an equivalent resistance, (C1+C2+Cin)/(GmC2) (Fig. 13.52). We can roughly
say that the op amp sees the series combination of C2 and C1 + Cin in parallel with CL, and its Gm is
reduced by the feedback factor, C2/(C1 + C2 + Cin).
X
C2
C2
C2
Vout
Cin
Vin
C1
CL
Gm
Gm
Cin
CL
C1
C1 + C2+ Cin
1
Figure 13.52
Equivalent circuit showing settling time constant.
It is instructive to examine the ampliﬁer’s time constant for the special case CL = 0. Equation (13.58)
yields τamp = (C1 + Cin)/Gm, a value independent of the feedback capacitor. This is because, while a
larger C2 introduces heavier loading at the output, it also provides a greater feedback factor.
The reader may wonder why Eq. (13.56) yields a negative gain for the circuit that we have called a
“noninverting” ampliﬁer. This equation simply means that if the left plate of C1 is stepped down, then
the output goes up. This does not contradict the operation of the original circuit (Fig. 13.43), where the
change in VP is equal to −Vin.
13.3.3 Precision Multiply-by-Two Circuit
The circuit of Fig. 13.43(a) can operate with a relatively high closed-loop gain, but it suffers from speed
and precision degradation due to the low feedback factor. In this section, we study a topology that provides
a nominal gain of two while achieving a higher speed and lower gain error [5]. Shown in Fig. 13.53(a),
the ampliﬁer incorporates two equal capacitors, C1 = C2 = C. In the sampling mode, the circuit is
conﬁgured as in Fig. 13.53(b), establishing a virtual ground at X and allowing the voltage across C1 and
C2 to track Vin. In the transition to the ampliﬁcation mode, S3 turns off ﬁrst, C1 is placed around the op
amp, and the left plate of C2 is switched to ground [Fig. 13.53(c)]. Since at the moment S3 turns off,
the total charge on C1 and C2 equals 2Vin0C (if the charge injected by S3 is neglected), and since the
voltage across C2 approaches zero in the ampliﬁcation mode, the ﬁnal voltage across C1 and hence the
output voltage are approximately equal to 2Vin0. This can also be seen from the slow-motion illustration
of Fig. 13.54.
The reader can show that the charge injected by S1 and S2 and absorbed by S4 and S5 is unimportant,
and that injected by S3 introduces a constant offset. The offset can be suppressed by differential operation.

568
Chap. 13
Introduction to Switched-Capacitor Circuits
X
C2
C1
Vin
Vout
C2
C1
Vout
X
(c)
(a)
(b)
Vout
C2
S1
S3
X
C1
S4
S2
S5
Vin
Figure 13.53
(a) Multiply-by-two circuit; (b) circuit of (a) in sampling mode; (c) circuit of (a) in ampliﬁcation
mode.
Vout
Vout
C1
C2
Vin
S3
Vin
Vin0
C1
C2
Vin0
C1
C2
2Vin0
Vin0
Vin0
Vout
0
Figure 13.54
Transition of multiply-by-two circuit to ampliﬁcation mode in slow motion.
The speed and precision of the multiply-by-two circuit are expressed by (13.58) and (13.53), respec-
tively, but the advantage of the circuit is the higher feedback factor for a given closed-loop gain. Note,
however, that the input capacitance of the multiply-by-two circuit in the sampling mode is higher.
13.4
Switched-Capacitor Integrator
Integrators are used in many analog systems. Examples include ﬁlters and oversampled analog-to-digital
converters. Figure 13.55 depicts a continuous-time integrator, whose output can be expressed as
Vout = −
1
RCF

Vindt
(13.60)
if the op amp gain is very large. For sampled-data systems, we must devise a discrete-time counterpart
of this circuit.
Before studying SC integrators, let us ﬁrst point out an interesting property. Consider a resistor
connected between two nodes [Fig. 13.56(a)], carrying a current equal to (VA −VB)/R. The role of the
resistor is to take a certain amount of charge from node A every second and move it to node B. Can we

Sec. 13.4
Switched-Capacitor Integrator
569
Vout
X
CF
R
Vin
Figure 13.55
Continuous-time integrator.
VA
R
A
B
VB
I
VA
VB
S1
A
CS
S2
B
(a)
(b)
Figure 13.56
(a) Continuous-time and (b) discrete-time resistors.
perform the same function with a capacitor? Suppose that in the circuit of Fig. 13.56(b), capacitor CS is
alternately connected to nodes A and B at a clock rate fCK. The average current ﬂowing from A to B is
then equal to the charge moved in one clock period:
IAB = CS(VA −VB)
f −1
CK
(13.61)
= CS fCK(VA −VB)
(13.62)
Wecanthereforeviewthecircuitasa“resistor”equalto(CS fCK)−1.RecognizedbyJamesClarkMaxwell,
this property formed the foundation for many modern switched-capacitor circuits.
Let us now replace resistor R in Fig. 13.55 by its discrete-time equivalent, arriving at the integrator of
Fig. 13.57(a). We note that in every clock cycle, C1 absorbs a charge equal to C1Vin when S1 is on and
deposits the charge on C2 when S2 is on (node X is a virtual ground). For example, if Vin is constant, the
output changes by VinC1/C2 every clock cycle [Fig. 13.57(b)]. Approximating the staircase waveform
by a ramp, we note that the circuit behaves as an integrator.
Vout
X
C2
Vin
S1
C1
S2
t
Vout
C1
C2
 Vin
(a)
(b)
P
Figure 13.57
(a) Discrete-time integrator; (b) response of circuit to a constant input voltage.
The ﬁnal value of Vout in Fig. 13.57(a) after every clock cycle can be written as
Vout(kTCK) = Vout[(k −1)TCK] −Vin[(k −1)TCK] · C1
C2
(13.63)
where the gain of the op amp is assumed large. Note that the small-signal settling time constant as charge
is transferred from C1 to C2 is given by (13.50).

570
Chap. 13
Introduction to Switched-Capacitor Circuits
The integrator of Fig. 13.57(a) suffers from two important drawbacks. First, the input-dependent
charge injection of S1 introduces nonlinearity in the charge stored on C1 and hence the output voltage.
Second, the nonlinear capacitance at node P resulting from the source/drain junctions of S1 and S2 leads
to a nonlinear charge-to-voltage conversion when C1 is switched to X. This can be understood with the
aid of Fig. 13.58, where the charge stored on the total junction capacitance, C j, is not equal to Vin0C j,
but rather equal to
qcj =
 Vin0
0
C jdV
(13.64)
Since C j is a function of voltage, qcj exhibits a nonlinear dependence on Vin0, thereby creating a nonlinear
component at the output after the charge is transferred to the integration capacitor.
Vout
X
C2
C1
Cj
S2
Vin0
P
Figure 13.58
Effect of junction capac-
itance nonlinearity in SC integrator.
An integrator topology that resolves both of the foregoing issues is shown in Fig. 13.59(a). We study
the circuit’s operation in the sampling and integration modes. As shown in Fig. 13.59(b), in the sampling
mode, S1 and S3 are on and S2 and S4 are off, allowing the voltage across C1 to track Vin while the op
amp and C2 hold the previous value. In the transition to the integration mode, S3 turns off ﬁrst, injecting
a constant charge onto C1; S1 turns off next; and subsequently S2 and S4 turn on [Fig. 13.59(c)]. The
charge stored on C1 is therefore transferred to C2 through the virtual ground node.
Vout
X
C2
Vin
S1
S4
C1
S2
S3
P
Vout
C2
Vin
C1
Vout
C2
C1
(c)
(a)
(b)
Figure 13.59
(a) Parasitic-insensitive integrator; (b) circuit of (a) in sampling mode; (c) circuit of (a) in
integration mode.
Since S3 turns off ﬁrst, it introduces only a constant offset, which can be suppressed by differential
operation. Moreover, because the left plate of C1 is “driven” (Sec. 13.3.2), the charge injection or ab-
sorption of S1 and S2 contributes no error. Also, since node X is a virtual ground, the charge injected or
absorbed by S4 is constant and independent of Vin.

Sec. 13.5
Switched-Capacitor Common-Mode Feedback
571
How about the nonlinear junction capacitance of S3 and S4? We observe that the voltage across this
capacitance goes from near zero in the sampling mode to virtual ground in the integration mode. Since
the voltage across the nonlinear capacitance changes by a very small amount, the resulting nonlinearity
is negligible.
13.5
Switched-Capacitor Common-Mode Feedback
Our study of common-mode feedback in Chapter 9 suggested that sensing the output CM level by means
of resistors lowers the differential voltage gain of the circuit. We also observed that sensing techniques
using MOSFETs that operate as source followers or variable resistors suffer from a limited linear range.
Switched-capacitor CMFB networks provide an alternative that avoids both of these difﬁculties (but the
circuit must be refreshed periodically).
In switched-capacitor common-mode feedback, the outputs are sensed by capacitors rather than re-
sistors. Figure 13.60 depicts a simple example, where equal capacitors C1 and C2 reproduce at node X
the average of the changes in each output voltage. Thus, if Vout1 and Vout2 experience, say, a positive CM
change, then VX and hence ID5 increase, pulling Vout1 and Vout2 down. The output CM level is then equal
to VGS2 plus the voltage across C1 and C2.
M1
M2
Vout1
C1
C2
VDD
Vb
M5
Vout2
M3
M4
Vin
X
Figure 13.60
Simple SC common-
mode feedback.
How is the voltage across C1 and C2 deﬁned? This is typically carried out when the ampliﬁer is in
the sampling (or reset) mode and can be accomplished as shown in Fig. 13.61. Here, during CM level
deﬁnition, the ampliﬁer differential input is zero and switch S1 is on. Transistors M6 and M7 operate as a
linear sense circuit because their gate voltages are nominally equal. Thus, the circuit settles such that the
ouput CM level is equal to VGS6,7 + VGS5. At the end of this mode, S1 turns off, leaving a voltage equal
M1
M2
C1
C2
VDD
Vb
M5
M3
M4
Vin
ID
S1
M6
M7
X
Figure 13.61
Deﬁnition of the voltage
across C1 and C2.

572
Chap. 13
Introduction to Switched-Capacitor Circuits
to VGS6,7 across C1 and C2. In the ampliﬁcation mode, M6 and M7 may experience a large nonlinearity,
but they do not affect the performance of the main circuit because S1 is off.
In applications where the output CM level must be deﬁned more accurately than in the previous
example, the topology shown in Fig. 13.62 may be used. Here, in the reset mode, one plate of C1 and C2
is switched to VC M while the other is connected to the gate of M6. Each capacitor therefore sustains a
voltage equal to VC M −VGS6. In the ampliﬁcation mode, S2 and S3 are on and the other switches are off,
yielding an output CM level equal to VC M −VGS6 + VGS5. This value is equal to VC M if ID3 and ID4 are
copied properly from IRE F so that VGS6 = VGS5.
M1
M2
C1
C2
VDD
Vb
M5
M3
M4
Vin
S3
S2
S5
S4
VCM
VCM
IREF
M6
S1
Figure 13.62
Alternative topology for deﬁnition of output CM level.
With large output swings, the speed of the CMFB loop may in fact inﬂuence the settling of the
differential output [6]. For this reason, part of the tail current of the differential pairs in Figs. 13.61 and
13.62 can be provided by a constant current source so that M5 makes only small adjustments to the circuit.
References
[1] G. Wegmann, E. A. Vittoz, and F. Rahali, “Charge Injection in Analog MOS Switches,” IEEE J. of Solid-State
Circuits, vol. SC-22, pp. 1091–1097, December 1987.
[2] B. J. Sheu and C. Hu, “Switch-Induced Error Voltage on a Switched Capacitor,” IEEE J. of Solid-State Circuits,
vol. SC-19, pp. 519–525, April 1984.
[3] R. Gregorian and G. C. Temes, Analog MOS Integrated Circuits for Signal Processing (New York: John Wiley
and Sons, 1986).
[4] J. H. Fischer, “Noise Sources and Calculation Techniques for Switched Capacitor Filters,” IEEE J. of Solid-State
Circuits, vol. 17, pp. 742–752, August 1982.
[5] B. S. Song, M. F. Tompsett, and K. R. Lakshmikumar, “A 12-Bit 1-Msample/s Capacitor-Averaging Pipelined
A/D Converter,” IEEE J. of Solid-State Circuits, vol. SC-23, pp. 1324–1333, December 1988.
[6] B. Razavi, Principles of Data Conversion System Design (New York: IEEE Press, 1995).
[7] P. C. Yu and H.-S. Lee, “A High-Swing 2-V CMOS Op Amp with Replica-Amp Gain Enhancement,” IEEE J.
of Solid-State Circuits, vol. 28, pp. 1265–1272, December 1993.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3
V where necessary. Also, assume that transistors are in saturation.
13.1.
The circuit of Fig. 13.2(b) is designed with C1 = 2 pF and C2 = 0.5 pF.
13.2.
Assuming that RF = ∞, but the op amp has an output resistance Rout, derive the transfer function Vout(s)/
Vin(s).

Problems
573
13.3.
If the op amp is ideal, determine the minimum value of RF that guarantees a gain error of 1% for an input
frequency of 1 MHz.
13.4.
Suppose that in Fig. 13.6(a), the op amp is characterized by a transconductance Gm and an output resistance
Rout.
13.5.
Determine the transfer function Vout/Vin in this mode.
13.6.
Plot the waveform at node B if Vin is a 100-MHz sinusoid with a peak amplitude of 1 V, C1 = 1 pF,
Gm = 1/(100 ), and Rout = 20 k.
13.7.
In Fig. 13.6(b), node A is in fact connected to ground through a switch (Fig. 13.5). If the switch introduces
a series resistance Ron and the op amp is ideal, calculate the time constant of the circuit in this mode. What
is the total energy dissipated in the switch as the circuit enters the ampliﬁcation mode and Vout settles to its
ﬁnal value?
13.8.
The circuit of Fig. 13.10(a) is designed with (W/L)1 = 20/0.5 and CH = 1 pF.
13.9.
Using Eqs. (13.9) and (13.16), calculate the time required for Vout to drop to +1 mV.
13.10. Approximating M1 by a linear resistor equal to [μnCox(W/L)1(VDD −VT H)]−1, calculate the time required
for Vout to drop to +1 mV and compare the result with that obtained in part (a).
13.11. The circuit of Fig. 13.12 cannot be characterized by a single time constant because the resistance charging
CH (equal to 1/gm1 if γ = 0) varies with the output level. Assume that (W/L)1 = 20/0.5 and CH = 1 pF.
13.12. Using Eq. (13.21), calculate the time required for Vout to reach 2.1 V.
13.13. Sketch the transconductance of M1 versus time.
13.14. In the circuit of Fig. 12.8(b), (W/L)1 = 20/0.5 and CH = 1 pF. Assume that λ = γ = 0 and Vin =
V0 sin ωint + Vm, where ωin = 2π × (100 MHz).
13.15. Calculate Ron1 and the phase shift from the input to the output if V0 = Vm = 10 mV.
13.16. Repeat part (a) if V0 = 10 mV but Vm = 1 V. The variation of the phase shift translates to distortion.
13.17. Describe an efﬁcient SPICE simulation that yields the plot of Ron,eq for the circuit of Fig. 13.17.
13.18. The sampling network of Fig. 13.17 is designed with (W/L)1 = 20/0.5, (W/L)2 = 60/0.5, and CH = 1
pF. If Vin = 0 and the initial value of Vout is +3 V, estimate the time required for Vout to drop to +1 mV.
13.19. In the circuit of Fig. 13.20, (W/L)1 = 20/0.5 and CH = 1 pF. Calculate the maximum error at the output
due to charge injection. Compare this error with that resulting from clock feedthrough.
13.20. The circuit of Fig. 13.63 samples the input on C1 when CK is high and connects C1 and C2 when CK is
low. Assume that (W/L)1 = (W/L)2 and C1 = C2.
C1
CK
M1
C2
M2
Vout
Vin
CK
Figure 13.63
13.21. If the initial voltages across C1 and C2 are zero and Vin = 2 V, plot Vout versus time for many clock cycles.
Neglect charge injection and clock feedthrough.
13.22. What is the maximum error in Vout due to charge injection and clock feedthrough of M1 and M2? Assume
that the channel charge of M2 splits equally between C1 and C2.
13.23. Determine the sampled kT/C noise at the output after M2 turns off.
13.24. For Vin = V0 sin ω0t + V0, where V0 = 0.5 V and ω0 = 2π × (10 MHz), plot the output waveforms of the
circuits shown in Fig. 13.30(b) and 13.31(a). Assume a clock frequency of 50 MHz.

574
Chap. 13
Introduction to Switched-Capacitor Circuits
13.25. In Fig. 13.47, S1 turns off t seconds after S2, and S3 turns on t seconds after S1 turns off. Plot the output
waveform, taking into account the charge injection and clock feedthough of S1–S3. Assume that all of the
switches are NMOS devices.
13.26. The circuit of Fig. 13.50 is designed with C1 = 2 pF, Cin = 0.2 pF, and Av = 1000. What is the maximum
nominal gain, C1/C2, that the circuit can provide with a gain error of 1%?
13.27. In Problem 13.26, what is the maximum nominal gain if Gm = 1/(100 ) and the circuit must achieve a
time constant of 2 ns in the ampliﬁcation mode? Assume that Cin = 0.2 pF, and calculate C1 and C2.
13.28. The integrator of Fig. 13.57 is designed with C1 = C2 = 1 pF and a clock frequency of 100 MHz. Neglecting
charge injection and clock feedthrough, sketch the output if the input is a 10-MHz sinusoid with a peak
amplitude of 0.5 V. Approximating C1, S1, and S2 by a resistor, estimate the output amplitude.
13.29. Consider the switched-capacitor ampliﬁer depicted in Fig. 13.64, where the common-mode feedback is not
shown. Assume that (W/L)1−4 = 50/0.5, ISS = 1 mA, C1 = C2 = 2 pF, C3 = C4 = 0.5 pF, and the output
CM level is 1.5 V. Neglect the transistor capacitances.
M1
M2
C3
C4
C2
C1
ISS
Vb
VDD
M3
M4
Vin
VCM
VCM
Vout
Figure 13.64
13.30. What is the maximum allowable output voltage swing in the ampliﬁcation mode?
13.31. Determine the gain error of the ampliﬁer.
13.32. What is the small-signal time constant in the ampliﬁcation mode?
13.33. Repeat Problem 13.32 if the gate-source capacitance of M1 and M2 is not neglected.
13.34. A differential circuit incorporating a well-designed common-mode feedback network exhibits the open-loop
input-output characteristic shown in Fig. 13.65(a). In some circuits, however, the characteristic appears as in
Fig. 13.65(b). Explain how this effect occurs.
Vin
Vout1
Vout2
0
Vin
Vout1
Vout2
0
(a)
(b)
Figure 13.65
13.35. In the common-mode feedback network of Fig. 13.61, assume that W/L = 50/0.5 for all transistors, ID5 = 1
mA, and ID6,7 = 50 μA. Determine the allowable range of the input common-mode level.
13.36. Repeat Problem 13.35 if (W/L)6,7 = 10/0.5.

Problems
575
13.37. Suppose that in the common-mode feedback network of Fig. 13.61, S1 injects a charge of q onto the gate
of M5. How much do the gate voltage of M5 and the output common-mode level change due to this error?
13.38. In the circuit of Fig. 13.66, each op amp is represented by a Norton equivalent and characterized by Gm and
Rout. The output currents of two op amps are summed at node Y [7]. (The circuit is shown in the ampliﬁcation
mode.) Note that the main ampliﬁer and the auxiliary ampliﬁer are identical and that the error ampliﬁer senses
the voltage variation at node X and injects a proportional current into node Y. The output impedance of the
error ampliﬁer is much greater than Rout. Assume that Gm Rout ≫1.
X
C1
C2
Gm
C1
C2
Rout
Rout
Gm
Gm
Vout
Vin
Main Ampliﬁer
Auxiliary  Ampliﬁer
Error
Ampliﬁer
Y
Figure 13.66
13.39. Calculate the gain error of the circuit.
13.40. Repeat part (a) if the auxiliary and error ampliﬁers are eliminated and compare the results.

CHAPTER
14
Nonlinearity and Mismatch
In Chapters 6 and 7, we dealt with two types of nonidealities, namely, frequency response and noise,
that limit the performance of analog circuits. In this chapter, we study two other imperfections that prove
critical in high-precision analog design and trade off with many other performance parameters. These
effects are nonlinearity and mismatch.
We ﬁrst deﬁne metrics for quantifying the effects of nonlinearity. Next, we study nonlinearity in
differential circuits and feedback systems and examine several linearization techniques. We then deal
with the problem of mismatch and dc offsets in differential circuits. Finally, we consider a number of
offset cancellation methods and describe the effect of offset cancellation on random noise.
14.1
Nonlinearity
14.1.1 General Considerations
As we have observed in the large-signal analysis of single-stage and differential ampliﬁers, circuits usually
exhibit a nonlinear input/output characteristic. Depicted in Fig. 14.1, such a characteristic deviates from
a straight line as the input swing increases. Two examples are shown in Fig. 14.2. In a common-source
stage or a differential pair, the output variation becomes heavily nonlinear as the input level increases. In
other words, for a small input swing, the output is a reasonable replica of the input, but for large swings
the output exhibits “saturated” levels.
The nonlinear behavior of a circuit can also be viewed as variation of the slope, and hence the
small-signal gain, with the input level. Illustrated in Fig. 14.3, this observation means that a given incre-
mental change at the input results in different incremental changes at the output depending on the input
dc level.
Vout
Vin
Ideal
Actual
Figure 14.1
Input/output characteristic
of a nonlinear system.
576

Sec. 14.1
Nonlinearity
577
t
M1
RD
Vout
VDD
Vin
Vout
Vin
Vout
t
t
Vout
Vin
Vout
t
M1
M2
RD
VDD
RD
Vin
Vout
Vout
Vin
t
t
Vout
Vout
Vin
t
t
Vout
(b)
(a)
Figure 14.2
Distortion in (a) a common-source stage and (b) a differential pair.
Vout
Vin
Vout
Vin
t
(a)
(b)
Figure 14.3
Variation of small-signal gain in a nonlinear ampliﬁer.
In many analog circuits, precision requirements mandate relatively small nonlinearities, making it
possible to approximate the input/output characteristic by a polynomial in the range of interest:
y(t) = α1x(t) + α2x2(t) + α3x3(t) + · · ·
(14.1)
For small x, y(t) ≈α1x, indicating that α1 is the small-signal gain in the vicinity of x ≈0.
How is the nonlinearity quantiﬁed? A simple method is to identify α1, α2, etc., in (14.1). Another
metric that proves useful in practice is to specify the maximum deviation of the characteristic from an
ideal one (i.e., a straight line). As shown in Fig. 14.4, for the voltage range of interest, [0 Vin,max], we pass
a straight line through the end points of the actual characteristic, obtain the maximum deviation, V ,
and normalize the result to the maximum output swing, Vout,max. For example, we say that an ampliﬁer
exhibits 1% nonlinearity (V/Vout,max = 0.01) for an input range of 1 V.

578
Chap. 14
Nonlinearity and Mismatch
Vout
Vin
Vout,max
Vin,max
ΔV
Figure 14.4
Deﬁnition of nonlinearity.
▲
Example14.1
The input/output characteristic of a differential ampliﬁer is approximated as y(t) = α1x(t) + α3x3(t). Calculate the
maximum nonlinearity if the input range is from x = −xmax to x = +xmax.
x
y
+xmax
–xmax
y1
+ymax
–ymax
Figure 14.5
Solution
As depicted in Fig. 14.5, we can express the straight line passing through the end points as
y1 = α1xmax + α3x3
max
xmax
x
(14.2)
= 
α1 + α3x2
max

x
(14.3)
The difference between y and y1 is therefore equal to
y = y −y1
(14.4)
= α1x + α3x3 −
α1 + α3x2
max

x
(14.5)
Setting the derivative of y with respect to x to zero, we have x = xmax/
√
3, and the maximum deviation is equal
to 2α3x3
max/(3
√
3). Normalized to the maximum output, the nonlinearity is obtained as
y
ymax
=
2α3x3
max
3
√
3 × 2
α1xmax + α3x3max

(14.6)
Note that the factor of 2 in the denominator is included because the maximum peak-to-peak output swing is equal to
2(α1xmax + α3x3
max). For small nonlinearities, we can neglect α3x3
max with respect to α1xmax, arriving at
y
ymax
≈
α3
3
√
3α1
x2
max
(14.7)
Note that the relative nonlinearity is proportional to the square of the maximum input swing in this example.
▲

Sec. 14.1
Nonlinearity
579
The nonlinearity of a circuit can also be characterized by applying a sinusoid at the input and measuring
the harmonic content of the output. Speciﬁcally, if in (14.1), x(t) = A cos ωt, then
y(t) = α1A cos ωt + α2A2 cos2 ωt + α3 cos3 ωt + · · ·
(14.8)
= α1A cos ωt + α2A2
2
[1 + cos(2ωt)] + α3A3
4
[3 cos ωt + cos(3ωt)] + · · · .
(14.9)
We observe that higher-order terms yield higher harmonics. In particular, even-order terms and odd-order
terms result in even and odd harmonics, respectively. Note that the magnitude of the nth harmonic grows
roughly in proportion to the nth power of the input amplitude. Called “harmonic distortion,” this effect
is usually quantiﬁed by summing the power of all of the harmonics (except that of the fundamental)
and normalizing the result to the power of the fundamental. Such a metric is called the “total harmonic
distortion” (THD). For a third-order nonlinearity,
THD = (α2A2/2)2 + (α3A3/4)2
(α1A + 3α3A3/4)2
(14.10)
Harmonic distortion is undesirable in most signal processing applications, including audio and video
systems. High-quality audio products such as compact disc (CD) players require a THD of about 0.01%
(−80 dB), and video products, about 0.1% (−60 dB).
14.1.2 Nonlinearity of Differential Circuits
Differential circuits exhibit an “odd-symmetric” input/output characteristic, i.e., f (−x) = −f (x). For
the polynomial of (14.1) to be an odd function, all of the even-order terms, α2 j, must be zero:
y(t) = α1x(t) + α3x3(t) + α5x5(t) + · · ·
(14.11)
indicating that a differential circuit driven by a differential signal produces no even harmonics. This is
another very important property of differential operation.
In order to appreciate the reduction of nonlinearity obtained by differential operation, let us consider
the two ampliﬁers shown in Fig. 14.6, each of which is designed to provide a small-signal voltage
gain of
|Av| ≈gm RD
(14.12)
= μnCox
W
L (VGS −VT H)RD
(14.13)
M0
RD
Vout
VDD
Vin
M1
M2
RD
VDD
RD
Vin
Vout
W/L
I
ISS = 2I
W/L
W/L
Figure 14.6
Single-ended and differen-
tial ampliﬁers providing the same
voltage gain.

580
Chap. 14
Nonlinearity and Mismatch
Suppose a signal Vm cos ωt is applied to each circuit. Examining only the drain currents for simplicity,
we can write for the common-source stage:
ID0 = 1
2μnCox
W
L (VGS −VT H + Vm cosωt)2
= 1
2μnCox
W
L (VGS −VT H)2 + μnCox
W
L (VGS −VT H)Vm cos ωt
+ 1
2μnCox
W
L V 2
m cos2 ωt
= I + μnCox
W
L (VGS −VT H)Vm cos ωt + 1
4μnCox
W
L V 2
m[1 + cos(2ωt)]
(14.14)
Thus, the amplitude of the second harmonic, AH D2, normalized to that of the fundamental, AF, is
AH D2
AF
=
Vm
4(VGS −VT H)
(14.15)
On the other hand, for M1 and M2 in Fig. 14.6, we have from Chapter 4
ID1 −ID2 = 1
2μnCox
W
L Vin




4ISS
μnCox
W
L
−V 2
in
(14.16)
= 1
2μnCox
W
L Vin

4(VGS −VT H)2 −V 2
in
(14.17)
If |Vin| ≪VGS −VT H, then
ID1 −ID2 = μnCox
W
L Vin(VGS −VT H)

1 −
V 2
in
4(VGS −VT H)2
(14.18)
≈μnCox
W
L Vin(VGS −VT H)
	
1 −
V 2
in
8(VGS −VT H)2

(14.19)
= μnCox
W
L (VGS −VT H)
	
Vm cos ωt −
V 3
m cos3 ωt
8(VGS −VT H)2

(14.20)
Since cos3 ωt = [3 cos ωt + cos(3ωt)]/4, we obtain
ID1 −ID2 = gm
	
Vm −
3V 3
m
32(VGS −VT H)2

cos ωt −gm
V 3
m cos(3ωt)
32(VGS −VT H)2
(14.21)
If Vm ≫3V 3
m/[8(VGS −VT H)2], then
AH D3
AF
≈
V 2
m
32(VGS −VT H)2
(14.22)
Comparison of (14.15) and (14.22) indicates that the differential circuit exhibits much less distortion
than its single-ended counterpart while providing the same voltage gain and output swing. For example,
if Vm = 0.2(VGS −VT H), (14.15) and (14.22) yield a distortion of 5% and 0.125%, respectively.

Sec. 14.1
Nonlinearity
581
While achieving a lower distortion, the differential pair consumes twice as much power as the CS
stage because ISS = 2I. The key point, however, is that even if the bias current of M0 is raised to 2I,
(14.15) predicts that the distortion decreases by only a factor of
√
2 (with W/L maintained constant).
14.1.3 Effect of Negative Feedback on Nonlinearity
In Chapter 8, we observed that negative feedback makes the closed-loop gain relatively independent
of the op amp’s open-loop gain. Since nonlinearity can be viewed as variation of the small-signal gain
with the input level, we expect that negative feedback suppresses this variation as well, yielding higher
linearity for the closed-loop system.
Analysis of nonlinearity in a feedback system is quite complex. Here, we consider a simple, “mildly
nonlinear” system to gain more insight. The reason is that, if properly designed, a feedback ampliﬁer
exhibits only small distortion components, lending itself to this type of analysis.
y(t)
x(t)
β
α1x + α2x2 
yS
Figure 14.7
Feedback system incorpora-
ting a nonlinear feedforward ampliﬁer.
Let us assume that the core ampliﬁer in the system of Fig. 14.7 has an input-output characteristic
y ≈α1x + α2x2. We apply a sinusoidal input x(t) = Vm cos ωt, postulating that the output contains
a fundamental component and a second harmonic and hence can be approximated as y ≈a cos ωt +
b cos 2ωt.1 Our objective is to determine a and b. The output of the subtractor can be written as
yS = x(t) −βy(t)
(14.23)
= Vm cos ωt −β(a cos ωt + b cos 2ωt)
(14.24)
= (Vm −βa) cos ωt −βb cos 2ωt
(14.25)
This signal experiences the nonlinearity of the feedforward ampliﬁer, thereby producing an output
given by
y(t) = α1[(Vm −β) cos ωt −βb cos 2ωt]
+ α2[(Vm −βa) cos ωt −βb cos 2ωt]2
(14.26)
= [α1(Vm −βa) −α2(Vm −βa)βb] cos ωt
+
	
−α1βb + α2(Vm −βa)2
2

cos 2ωt + · · ·
(14.27)
The coefﬁcients of cos ωt and cos 2ωt in (14.27) must be equal to a and b, respectively:
a = (α1 −α2βb)(Vm −βa)
(14.28)
b = −α1βb + α2(Vm −βa)2
2
(14.29)
1Note that higher harmonics and phase shifts through the system are neglected.

582
Chap. 14
Nonlinearity and Mismatch
The assumption of small nonlinearity implies that both α2 and b are small quantities, yielding
a ≈α1(Vm −βa) and hence
a =
α1
1 + βα1
Vm
(14.30)
which is to be expected because βα1 is the loop gain. To calculate b, we write
Vm −βa ≈a
α1
(14.31)
thus expressing (14.29) as
b = −α1βb + 1
2α2
 a
α1
2
(14.32)
That is
b(1 + α1β) = α2
2
 a
α1
2
(14.33)
= α2
2α2
1
α2
1
(1 + βα1)2 V 2
m
(14.34)
It follows that
b = α2V 2
m
2
1
(1 + βα1)3
(14.35)
For a meaningful comparison, we normalize the amplitude of the second harmonic to that of the
fundamental:
b
a = α2Vm
2
1
α1
1
(1 + βα1)2
(14.36)
Without feedback, on the other hand, such a ratio would be equal to (α2V 2
m/2)/α1Vm = α2Vm/(2α1).
Thus, the relative magnitude of the second harmonic has dropped by a factor of (1 + βα1)2. Nega-
tive feedback therefore reduces the relative second harmonic by a factor of (1 + βα1)2 and the gain
by 1 + βα1.
As described in Chapter 8, a feedback circuit employing a feedforward ampliﬁer with a ﬁnite gain
suffers from gain error. For a feedforward gain of A0 and a feedback factor of β, the relative gain error
is approximately equal to 1/(β A0). If the feedforward ampliﬁer exhibits nonlinearity, it is possible to
derive a simple relationship between the gain error and the maximum nonlinearity of the overall feedback
circuit. As illustrated in Fig. 14.8, we draw two straight lines, one representing the ideal characteristic
(with a slope of 1/β) and another passing through the end points of the actual characteristic. We note
that with this construction, the nonlinearity, y2, is always smaller than the gain error, y1. This is, of
course, true only if the small-signal gain drops monotonically as x goes from 0 to xmax, a typical behavior
in most analog circuits. Thus, a sufﬁcient condition to ensure that y2 < ϵ is to guarantee that y1 < ϵ
by choosing a high open-loop gain for the ampliﬁer.
The above condition is often applied in analog design because it is much easier to predict the open-loop
gain than its nonlinearity. Of course, this simpliﬁcation is obtained at the cost of a pessimistic choice of
the ampliﬁer’s gain, an issue that becomes more serious as short-channel devices limit the voltage gain
that can be achieved.

Sec. 14.1
Nonlinearity
583
Δy2
x
y
xmax
Δy1
x
β
Figure 14.8
Gain error and nonlinearity
in a feedback system.
14.1.4 Capacitor Nonlinearity
In switched-capacitor circuits, the voltage dependence of capacitors may introduce substantial distor-
tion. While for a linear capacitor we have Q = CV , for a voltage-dependent capacitor we must write
dQ = C dV . Thus, the total charge on a capacitor sustaining a voltage V1 is
Q(V1) =
 V1
0
C dV
(14.37)
This means that the charge depends on the “history” of the voltage rather than its instantaneous value. In
other words, we cannot write Q(V1) = CV1 even if C is evaluated for a voltage V1 across the capacitor. To
study the effect of capacitor nonlinearity, we express each capacitor as C = C0(1 + α1V + α2V 2 + · · ·).
Vout
Vin0
C2
C1
X
P
t
Figure 14.9
Effect of capacitor nonlinearity.
Let us consider the noninverting ampliﬁer of Fig. 13.43(a), repeated in Fig. 14.9, as an example. At the
beginning of the ampliﬁcation mode, C1 has a voltage equal to Vin0 and C2 a voltage of zero. Assuming
that C1 ≈MC0(1 + α1V ), where M is the nominal closed-loop gain (C1 = MC2), we obtain the charge
across C1 as
Q1 =
 Vin0
0
C1 dV
(14.38)
=
 Vin0
0
MC0(1 + α1V ) dV
(14.39)
= MC0Vin0 + MC0
α1
2 V 2
(14.40)
Similarly, if C2 ≈C0(1 + α1V ), then the charge on this capacitor at the end of the ampliﬁcation mode is
Q2 =
 Vout
0
C2 dV
(14.41)
= C0Vout + C0
α1
2 V 2
out
(14.42)

584
Chap. 14
Nonlinearity and Mismatch
Equating Q1 and Q2 and solving for Vout, we have
Vout = 1
α1

−1 +

1 + Mα2
1V 2
in0 + 2Mα1Vin0

(14.43)
The last two terms under the square root are usually much less than unity and, since for ϵ ≪1, √1 + ϵ ≈
1 + ϵ/2 −ϵ2/8, we can write
Vout ≈MVin0 + (1 −M) Mα1
2
V 2
in0
(14.44)
The second term in the above equation represents the nonlinearity resulting from the voltage dependence
of the capacitor.
14.1.5 Nonlinearity in Sampling Circuits
Recall from Chapter 13 that the on-resistance of MOS switches in a sampling circuit varies with the input
and output levels. For example, the NMOS switch in Fig. 14.10(a) exhibits a rising resistance as Vin and
Vout increase. Similarly, the complementary topology in Fig. 14.10(b) displays an equivalent resistance
that varies considerably as Vin and Vout go from 0 to VDD. In contrast to the monotonic behavior derived
in Chapter 13, Ron reaches a peak here due to the dependence of the mobility upon the vertical ﬁeld in
the channel. We wish to examine the harmonic distortion observed in the output due to this effect.
C1
Vout
Vin
CK
C1
Vout
Vin
CK
CK
C1
Vin
Ron
Vout
Vin
Ron
VDD
t
Vin
Ron
t
Ron
(c)
(a)
(b)
(d)
Figure 14.10
(a) Sampling circuit using NMOS switch, (b) sampling circuit using complementary devices,
(c) representation of switch on-resistance by a nonlinear resistor, and (d) time-domain behavior.
As shown in Fig. 14.10(c), we apply a large sinusoid to the input, Vin = V0 cos ω0t + V0, where
V0 = VDD/2, and seek the harmonics at the output. How do we analyze this circuit? The nonlinear
dependence of Ron upon Vin or Vout presents a formidable challenge. Let us ﬁrst assume that the resistance

Sec. 14.1
Nonlinearity
585
is linear and write the output as
Vout(t) =
V0

R2onC2
1ω2
0 + 1
cos[ω0t −tan−1(RonC1ω0)] + V0
(14.45)
In practice, the bandwidth must be large enough to negligibly attenuate the signal, i.e., RonC1ω0 ≪1,
leading to
Vout(t) ≈V0 cos(ω0t −RonC1ω0) + V0
(14.46)
We now assume that this expression also holds for the nonlinear circuit if Ron is represented properly. It
is interesting to note that Ron, and hence the phase shift from the input to the output, vary as Vin and Vout
go up and down, thus creating distortion.
A key observation that simpliﬁes our analysis is that, with a periodic input, Ron also varies periodically
and can therefore be approximated by a Fourier series:
Ron(t) = R0 + R1 cos ω0t + R2 cos(2ω0t) + · · ·
(14.47)
If we assume a roughly symmetric behavior for Ron in Fig. 14.10(b), we observe the time-domain behavior
depicted in Fig. 14.10(d), where Ron varies at a rate equal to twice the input frequency. In this special
case, R1 ≈0, but we continue with the general case. Replacing for Ron in Eq. (14.46), we have
Vout(t) ≈V0 cos[ω0t −R0C1ω0 −R1C1ω0 cos ω0t −R2C1ω0 cos(2ω0t) −· · ·] + V0
(14.48)
If the cosine terms in the argument have amplitudes much less than 1 rad,
Vout(t) ≈V0 cos(ω0t −R0C1ω0) +
[R1C1ω0 cos ω0t + R2C1ω0 cos(2ω0t) + · · ·]V0 sin(ω0t −R0C1ω0) + V0
We observe that the products cos ω0t sin(ω0t −R0C1ω0), cos(2ω0t) sin(ω0t −R0C1ω0), etc., give rise
to harmonics. For example, the ﬁrst two products respectively translate to a second harmonic and a third
harmonic having peak amplitudes of V0R1C1ω0/2 and V0R2C1ω0/2, respectively. If we retain only these
two harmonics, then
THD = R2
1 + R2
2
4
C2
1ω2
0
(14.49)
In a differential sampling switch, the even-order harmonics are suppressed.
14.1.6 Linearization Techniques
While ampliﬁers using “global” feedback (e.g., the switched-capacitor topologies of Chapter 13) can
achieve a high linearity, stability and settling issues of feedback circuits limit their usage in high-speed
applications. For this reason, many other techniques have been invented to linearize ampliﬁers with less
compromise in speed.
The principle behind linearization is to reduce the dependence of the circuit’s gain upon the in-
put level. This usually translates into making the gain relatively independent of the transistor bias
currents.
The simplest linearization method is source degeneration by means of a linear resistor. As shown
in Fig. 14.11 for a common-source stage and revealed by the observations in the previous section,
degeneration reduces the signal swing applied between the gate and the source of the transistor, thereby

586
Chap. 14
Nonlinearity and Mismatch
RD
Vout
VDD
Vin
M1
RS
Vin
ID1
RS = 0
RS ≠ 0
Figure 14.11
Common-source stage
with resistive degeneration.
making the input/output characteristic more linear. From another point of view, neglecting body effect,
we can write the overall transconductance of the stage as
Gm =
gm
1 + gm RS
(14.50)
which for large gm RS approaches 1/RS, an input-independent value.
Note that the amount of linearization depends on gm RS rather than on RS alone. With a relatively
constant Gm, the voltage gain, Gm RD, is also relatively independent of the input and the ampliﬁer is
linearized.
▲
Example14.2
A common-source stage biased at a current I1 experiences an input voltage swing that varies the drain current from
0.75I1 to 1.25I1. Calculate the variation of the small-signal voltage gain (a) with no degeneration and (b) with
degeneration such that gm RS = 2, where gm denotes the transconductance at ID = I1.
Solution
Assuming square-law behavior, we have gm ∝√ID. For the case of no degeneration,
gm,high
gm,low
=

1.25
0.75
(14.51)
With gm RS = 2,
Gm,high
Gm,low
=
√
1.25gm
1 +
√
1.25gm RS
√
0.75gm
1 +
√
0.75gm RS
(14.52)
=

1.25
0.75 · 1 + 2
√
0.75
1 + 2
√
1.25
(14.53)
= 0.84

1.25
0.75
(14.54)
Thus, degeneration decreases the variation of the small-signal gain by approximately 16% in this case.
▲
Resistive degeneration presents trade-offs among linearity, noise, power dissipation, and gain. For
large input voltage swings (e.g., 0.5 Vpp), it may be difﬁcult to achieve even a voltage gain of 2 in a
common-source stage if the nonlinearity is to remain below 1%.

Sec. 14.1
Nonlinearity
587
M1
M2
RD
VDD
RD
Vin
Vout
RS
RS
ISS
M1
M2
RD
VDD
RD
Vin
Vout
2RS
ISS
2
ISS
2
(a)
(b)
Figure 14.12
Source degeneration applied to a differential pair.
A differential pair can be degenerated as shown in Figs. 14.12(a) and (b). In Fig. 14.12(a), ISS ﬂows
through the degeneration resistors, thereby consuming a voltage headroom of ISS RS/2, an important
issue if a high level of degeneration is required. The circuit of Fig. 14.12(b), on the other hand, does
not involve this issue, but it suffers from a slightly higher noise (and offset voltage) because the two tail
current sources introduce some differential error. The reader can prove that if the output noise current of
each current source is equal to I 2n , then the input-referred noise voltage of the circuit of Fig. 14.12(b) is
higher than that of Fig. 14.12(a) by 2I 2n R2
S.
As depicted in Fig. 14.13, the resistor can be replaced by a MOSFET operating in the deep triode
region.However,forlargeinputswings, M3 maynotremaininthedeeptrioderegion,therebyexperiencing
substantial change in its on-resistance. Furthermore, Vb must track the input common-mode level so that
Ron3 can be deﬁned accurately.
M1
M2
Vin
ISS
2
ISS
2
Vb
M3
Figure 14.13
Differential pair
degenerated by a MOSFET operating in
the deep triode region.
A more practical variant of the above idea is illustrated in Fig. 14.14 [1]. Here, M3 and M4 are in the
deep triode region if Vin = 0. As the gate voltage of M1 becomes more positive than the gate voltage of
M2, transistor M3 stays in the triode region because VD3 = VG3 −VGS1, whereas M4 eventually enters
M1
M2
Vin
M3
M4
ISS
2
ISS
2
Figure 14.14
Differential pair
degeneratedbytwoMOSFETsoperating
in the triode region.

588
Chap. 14
Nonlinearity and Mismatch
the saturation region because its drain voltage rises and its gate and source voltages fall. Thus, the circuit
remains relatively linear even if one degeneration device goes into saturation. For the widest linear region,
[1] suggests that (W/L)1,2 ≈7(W/L)3,4.
▲
Example14.3
Using the offset mechanism introduced in Fig. 4.19, devise another linearization technique.
Solution
From Example 4.6, we know that the mismatch between the transistors’ widths shifts the characteristics horizontally.
Let us create a negative shift and a positive shift (equal in magnitude) in two differential pairs [Fig. 14.15(a)],
observing that their Gm plots are offset by equal and opposite amounts. We now add the output currents by simply
shorting the corresponding drains as shown in Fig. 14.15(b). The Gm plots also add (why?), yielding a result
that is relatively constant for a wider range of Vin1 −Vin2 and represents a more linear circuit. The ratio of 2
between the two widths is merely an example to illustrate the technique and may need to be modiﬁed for optimum
linearity.
ΔVin
Gm
M1
M2
ISS
Vin1
Vin2
M3
M4
ISS
Vin1
Vin2
W
2W
2W
W
ΔVin
Gm
M1
M2
ISS
Vin1
Vin2
M3
M4
ISS
Vin1
Vin2
W
2W
W
2W
ΔVin
Gm
(a)
(b)
Figure 14.15
▲
A linearization technique that avoids the use of resistors is based on the observation that a MOSFET
operating in the triode region can provide a linear ID/VGS characteristic if its drain-source voltage is held
constant: ID = (1/2)μCox(W/L)[2(VGS −VT H)VDS −V 2
DS]. Illustrated in Fig. 14.16, the technique
employs ampliﬁers A1 and A2 along with cascode devices M3 and M4 to force VX and VY to be equal to
Vb for varying input levels.
M3
M1
Vb
A1
X
M2
Vb
A2
M4
Y
Vin1
Vin2
Figure 14.16
Differential pair using input devices operating in the triode region.

Sec. 14.1
Nonlinearity
589
This circuit suffers from several drawbacks. First, the transconductance of M1 and M2, equal to
μnCox(W/L)VDS, is relatively small because VDS must be low enough to ensure that each input transistor
remains in the triode region. Second, the input common-mode level must be tightly controlled, and it
must track Vb so as to deﬁne ID1 and ID2. Third, M3, M4, and the two auxiliary ampliﬁers contribute
substantial noise to the output.
Another approach to linearizing voltage ampliﬁers is to perform “post correction.” Illustrated in
Fig. 14.17, the idea is to view the ampliﬁer as a voltage-to-current (V/I) converter followed by a current-
to-voltage (I/V) converter. If the V/I converter can be described as Iout = f (Vin) and the I/V converter
as Vout = f −1(Iin), then Vout is a linear function of Vin. That is, the second stage corrects the nonlin-
earity introduced by the ﬁrst stage. As an example, recall from Chapter 4 that for the circuit shown in
Fig. 14.18(a), we have
Vin
Iout
Vout
Figure 14.17
Voltage ampliﬁer
viewed as a cascade of two nonlinear
stages.
M1
M2
Vin
I1
I2
M3
M4
VDD
I3
I4
(c)
(a)
(b)
M1
M2
Vin
M3
M4
VDD
Vout
Vout
Figure 14.18
(a) Differential pair with nonlinear I/V characteristic; (b) diode-connected devices with nonlinear
V/I characteristic; (c) circuit having linear input/output characteristic.
Vin1 −Vin2 = VGS1 −VGS2
(14.55)
=





2ID1
μnCox
W
L

1,2
−





2ID2
μnCox
W
L

1,2
(14.56)
We also note that for the circuit shown in Fig. 14.18(b),
Vout = VGS3 −VGS4
(14.57)
=





2I3
μnCox
W
L

3,4
−





2I4
μnCox
W
L

3,4
(14.58)

590
Chap. 14
Nonlinearity and Mismatch
where channel-length modulation and body effect are neglected. It follows that for the circuit shown in
Fig. 14.18(c),
Vout =





2ID1
μnCox
W
L

3,4
−





2ID2
μnCox
W
L

3,4
(14.59)
=
1
W
L

3,4
(Vin1 −Vin2) sqrt
W
L

1,2
(14.60)
Thus, as derived in Chapter 4, the voltage gain is equal to
Av =








W
L

1,2
W
L

3,4
(14.61)
a quantity independent of the bias currents of the transistors.
In practice, body effect and other nonidealities in short-channel devices give rise to nonlinearity in
this circuit. Furthermore, as the differential input level increases, driving M1 or M2 into the subthreshold
region, Eqs. (14.56) and (14.58) no longer hold and the gain drops sharply.
It is possible to add local feedback to a degenerated differential pair to linearize it further. Illustrated
in Fig. 14.19(a), the idea is to sense the output voltage of the differential pair by means of M3 and M4 and
return a proportional current to the sources of M1 and M2. The reader can readily prove that the feedback
is negative. We assume that the circuit is symmetric and I1 = · · · = I4.
M1
M2
RS
I1
VDD
Y
X
Local Feedback
Network
Isig
I3
I2
I4
Vin1
Vin2
M1
M2
RS
I1
VDD
Y
X
Isig
I3
I2
I4
Vin1
Vin2
RD
RD
Vout
(a)
(b)
M5
M6
M3 M4
M3 M4
Figure 14.19
(a) Differential pair with local feedback, and (b) use of (a) in voltage ampliﬁcation.
If channel-length modulation and body effect are neglected, we observe that ID1 = I3 and ID2 = I4
regardless of the input signal. Thus, the input transistors maintain a constant VGS as Vin = Vin1 −Vin2
varies. Moreover, since I1 = I3 = ID1 and I2 = I4 = ID2, the current ﬂowing through RS must be
provided by only M3 and M4. Denoting this current by Isig, we have
Vin = VGS1 + Isig RS −VGS2
(14.62)
= Isig RS
(14.63)

Sec. 14.2
Mismatch
591
Interestingly, the currents produced by M3 and M4 are linearly proportional to Vin because the feedback
from their drains to their sources guarantees a constant VGS. Note, however, that VX −VY is not.
The reader may wonder where this topology’s output is! As depicted in Fig. 14.19(b), we copy the
PMOS currents onto M5 and M6 and allow the results to ﬂow through (linear) resistors. Since ID3 and
ID4 are equal and opposite, it follows from (14.63) that
Vout = 2RD
RS
Vin
(14.64)
where the PMOS devices are assumed identical. The circuit excluding the RD’s operates as a linear
voltage-to-current converter (“transconductor”).
The above topology entails two issues. First, the large number of devices in the signal path produces
substantial noise. In addition to M1–M4, the top and bottom current sources also contribute differential
noise. Second, due to the dependence of rO upon VDS in short-channel devices (Chapter 17), the output
stage introduces some nonlinearity.
14.2
Mismatch
Our study of differential ampliﬁers in the previous chapters has mostly assumed that the circuits are
perfectly symmetric, i.e., the two sides exhibit identical properties and bias currents. In reality, however,
nominally-identical devices suffer from a ﬁnite mismatch due to uncertainties in each step of the man-
ufacturing process. For example, as illustrated in Fig. 14.20, the gate dimensions of MOSFETs suffer
from random, microscopic variations, introducing mismatches between the equivalent lengths and widths
of two transistors that are identically laid out. Also, MOS devices exhibit threshold voltage mismatch
because, from Eq. (2.1), VT H is a function of the doping levels in the channel and the gate, and these
levels vary randomly from one device to another.
Figure 14.20
Random mismatches due to microscopic variations in device dimensions.
Study of mismatch consists of two steps: (1) identify and formulate the mechanisms that lead to
mismatch between devices; and (2) analyze the effect of device mismatches upon the performance of
circuits. Unfortunately, the ﬁrst step is quite complex and heavily dependent on the fabrication technology
and the layout, often requiring actual measurements of mismatches. For example, the achievable mismatch
between capacitors is typically quoted to be 0.1%, but this value is not derived from any fundamental
quantities. Layout techniques for minimum mismatch are described in Chapter 19.
Expressing the characteristics of a MOSFET in saturation as ID = (1/2)μCox(W/L)(VGS −VT H)2,
we observe that mismatches between μ, Cox, W, L, and VT H result in mismatches between drain currents
(for a given VGS) or gate-source voltages (for a given drain current) of two nominally-identical transistors.
Intuitively, we expect that as W and L increase, their relative mismatches, W/W and L/L, respec-
tively, decrease, i.e., larger devices exhibit smaller mismatches. A more important observation is that
all of the mismatches decrease as the area of the transistor, W L, increases. For example, increasing W

592
Chap. 14
Nonlinearity and Mismatch
ΔL2
(a)
(b)
ΔL1
Figure 14.21
Reduction of length mismatch as a result of increasing the width.
reduces both W/W and L/L. This is because as W L increases, random variations experience greater
“averaging,” thereby falling in magnitude. For the case depicted in Fig. 14.21, L2 < L1 because,
if the device is viewed as many small parallel transistors (Fig. 14.22), each having a width of W0, then
we can write the equivalent length as Leq ≈(L1 + L2 + · · · + Ln)/n. The overall variation is therefore
given by
Leq ≈

L2
1 + L2
2 + · · · + L2
n
1/2
n
(14.65)
=

nL2
0
1/2
n
(14.66)
= L0
√n
(14.67)
where L0 is the statistical variation of the length for a transistor with width W0. Equation (14.67) reveals
that for a given W0, as n increases, the variation of Leq decreases.
W
W0
Figure 14.22
Wide MOSFET viewed as a parallel combination of narrow devices.
The above result can be extended to other device parameters as well. For example, we postulate that
μCox and VT H suffer from less mismatch if the device area increases. Illustrated in Fig. 14.23, the reason
is that a large transistor can be decomposed into a series and parallel combination of small unit transistors
with dimensions W0 and L0, each exhibiting (μCox) j and VT H j. For given W0 and L0, as the number
of unit transistors increases, μCox and VT H experience greater averaging, leading to smaller mismatch
between two large transistors.
W
W0
L0
Figure 14.23
Large MOSFET viewed as a combination of small devices.

Sec. 14.2
Mismatch
593
The foregoing qualitative observations have been veriﬁed mathematically and experimentally [2, 3].
Here, we state without proof that
VT H = AV T H
√
W L
(14.68)


μCO X
W
L

=
AK
√
W L
(14.69)
where AV T H and AK are proportionality factors and obtained from measurements.
▲
Example14.4
A differential pair incorporates transistors having a length of 40 nm. If AV T H = 4 mV · μm for 40-nm technology,
what is the minimum device width that guarantees VT H ≤2 mV?
Solution
We write
W =
A2
V T H
LV 2
T H
(14.70)
= 100 μm
(14.71)
We observe the very large W/L necessary for low offsets in nanometer technologies.
▲
Since the channel capacitance is proportional to W LCox, we note that VT H and the channel
capacitance bear a trade-off.
14.2.1 Effect of Mismatch
We now study the effect of device mismatch upon the performance of circuits. Mismatches lead to three
signiﬁcant phenomena: dc offsets, ﬁnite even-order distortion, and lower common-mode rejection. The
last phenomenon was studied in Chapter 4.
DC Offsets
Consider the differential pair shown in Fig. 14.24(a). With Vin = 0 and perfect symmetry,
Vout = 0, but in the presence of mismatches, Vout ̸= 0. We say that the circuit suffers from a dc “offset”
equal to the observed value of Vout when Vin is set to zero. In practice, it is more meaningful to specify
the input-referred offset voltage, deﬁned as the input level that forces the output voltage to go to zero
M1
M2
R1
VDD
R2
M1
M2
R1
VDD
R2
VOS,in
(a)
(b)
0
Vout
Vin
Figure 14.24
(a) Differential pair with offset measured at the output; (b) circuit of (a) with its offset referred
to the input.

594
Chap. 14
Nonlinearity and Mismatch
[Fig. 14.24(b)]. Note that |VOS,in| = |VOS,out|/Av. As with random noise, the polarity of random offsets
is unimportant.
How does offset limit the performance? Suppose the differential pair of Fig. 14.24 is to amplify a
small input voltage. Then, as depicted in Fig. 14.25, the output contains ampliﬁed replicas of both the
signal and the offset. In a cascade of direct-coupled ampliﬁers, the dc offset may experience so much
gain that it drives the latter stages into nonlinear operation.
t
t
VOS,in
V0
Av
AvV0
AvVOS,in
Figure 14.25
Effect of offset in an ampliﬁer.
A more important effect of offset is the limitation on the precision with which signals can be measured.
For example, if an ampliﬁer is used to determine whether the input signal is greater or less than a reference,
VRE F (Fig. 14.26), then the input-referred offset imposes a lower bound on the minimum Vin −VRE F
that can be detected reliably.
t
VOS,in
Av
Vin
VREF
Vin
VREF
Vout
Figure 14.26
Accuracy limitation of an ampliﬁer due to offset.
Let us now calculate the offset voltage of a differential pair, assuming that both the input transistors
and the load resistors suffer from mismatch. As illustrated in Fig. 14.24(b), our objective is to ﬁnd the
value of VOS,in such that Vout = 0. The device mismatches are incorporated as VT H1 = VT H, VT H2 =
VT H +VT H; (W/L)1 = W/L, (W/L)2 = W/L+(W/L); R1 = RD, R2 = RD +R. For simplicity,
λ = γ = 0, and mismatches in μnCox are neglected. For Vout = 0, we must have ID1R1 = ID2R2,
concluding that ID1 cannot be equal to ID2. Thus, we assume that ID1 = ID, ID2 = ID + ID.
Since VOS,in = VGS1 −VGS2, we have
VOS,in =





2ID1
μnCox
W
L

1
+ VT H1 −





2ID2
μnCox
W
L

2
−VT H2
(14.72)
=

2
μnCox
⎡
⎢⎢⎢⎣




ID
W
L
−





ID + ID
W
L + 
W
L

⎤
⎥⎥⎥⎦−VT H
(14.73)
=

2
μnCox

ID
W/L
⎡
⎢⎢⎢⎣1 −







1 + ID
ID
1 + 
W
L
  W
L

⎤
⎥⎥⎥⎦−VT H
(14.74)

Sec. 14.2
Mismatch
595
Assuming that ID/ID and (W/L)/(W/L) ≪1, and noting that for ϵ ≪1 we can write √1 + ϵ ≈
1 + ϵ/2 and (√1 + ϵ)−1 ≈1 −ϵ/2, we reduce (14.74) to
VOS,in =





2ID
μnCox
W
L


1 −

1 + ID
2ID
 	
1 −(W/L)
2(W/L)


−VT H
(14.75)
=





2ID
μnCox
W
L

	−ID
2ID
+ (W/L)
2(W/L)

−VT H
(14.76)
where the product of two small quantities is neglected. Recall that ID1R1 = ID2R2, and hence ID RD =
(ID + ID)(RD + RD) ≈ID RD + RDID + IDRD. Consequently, ID/ID ≈−RD/RD, and
VOS,in = 1
2





2ID
μnCox
W
L

	RD
RD
+ (W/L)
(W/L)

−VT H
(14.77)
We also recognize that the square-root quantity is approximately equal to the equilibrium overdrive
voltage of each transistor, VGS −VT H, and
VOS,in = VGS −VT H
2
	RD
RD
+ (W/L)
(W/L)

−VT H
(14.78)
Equation (14.78) is an important result, revealing the dependence of VOS,in on device mismatches
and bias conditions. We note that (1) the contribution of load resistor mismatch and transistor dimension
mismatch increases with the equilibrium overdrive, and (2) the threshold voltage mismatch is directly
referred to the input. Thus, it is desirable to minimize VGS −VT H by lowering the tail current or increas-
ing the transistor widths. In reality, since mismatches are independent statistical variables, we express
(14.78) as2
V 2
OS,in =
VGS −VT H
2
2 RD
RD
2
+
	(W/L)
(W/L)

2
+ V 2
T H
(14.79)
where squared quantities represent standard deviations.
To gain more insight into the effect of offset, let us establish an analogy between offset and noise.
If the two inputs of a differential pair are shorted, the output voltage exhibits a ﬁnite noise, that is, a
voltage that varies with time. We may therefore say that the offset voltage of a differential pair resembles
a very low-frequency noise component, varying so slowly that it appears constant in our measurements.
Viewed as such, offsets can be incorporated as noise sources, allowing us to utilize the analysis techniques
developed in Chapter 7. To this end, we represent the offset of two nominally-identical transistors by a
voltage source equal to (14.79) in series with the gate of one of the transistors.
2As mentioned earlier, VT H does depend on W, an effect that can be added as a cross-correlation term. We neglect this term
here for simplicity.

596
Chap. 14
Nonlinearity and Mismatch
▲
Example14.5
Calculate the input-referred offset voltage of the circuit shown in Fig. 14.27(a). Assume all of the transistors operate
in saturation.
M1
M2
VDD
Vout
VOS,P
Vb
VOS,N
M1
M2
VDD
Vout
Vb
Vin
M3
M4
M3
M4
(a)
(b)
Figure 14.27
Solution
We insert the offsets of the NMOS and PMOS pairs as in Fig. 14.27(b). To obtain ID1 = ID2 and ID3 = ID4, we
have from (14.78)
VOS,N = (VGS −VT H)N
2
	
(W/L)
W/L

N
+ VT H,N
(14.80)
VOS,P = |VGS −VT H|P
2
	
(W/L)
W/L

P
+ VT H,P
(14.81)
From the noise analysis in Chapter 7, VOS,P is ampliﬁed by a gain of gmP(rON||rO P) and divided by gmN(rON||rO P)
when referred to the main input. As a result,
VOS,in =

|VGS −VT H|P
2
	
(W/L)
W/L

P
+ VT H,P

gmP
gmN
+ (VGS −VT H)N
2
	
(W/L)
W/L

N
+ VT H,N
(14.82)
In practice, we add the “power” of these terms, as exempliﬁed by (14.79). Note that, as with noise, the contribution
of the offset of the PMOS pair is proportional to gmP/gmN.
▲
The foregoing example can be better understood if we study the offset behavior of current sources.
Consider the nominally-identical current sources M1 and M2 in Fig. 14.28. Neglecting channel-length
modulation, we determine the total mismatch between ID1 and ID2 by calculating the total differential.
M1
M2
M0
ID
VDD
ID1
ID2
Figure 14.28
Mismatch between two
current sources.

Sec. 14.2
Mismatch
597
Recall from calculus that if y = f (x1, x2, . . .), then the total differential is given by
y = ∂f
∂x1
x1 + ∂f
∂x2
x2 + · · ·
(14.83)
Equation (14.83) simply means that each mismatch component x j is weighted by the corresponding
sensitivity ∂f/∂x j as it contributes to the total mismatch. Since ID = (1/2)μnCox(W/L)(VGS −VT H)2,
we have
ID =
∂ID
∂(W/L)
W
L

+
∂ID
∂(VGS −VT H)(VGS −VT H)
(14.84)
where mismatches in μnCox are neglected. It follows that
ID = 1
2μnCox(VGS −VT H)2
W
L

−μnCox
W
L (VGS −VT H)VT H
(14.85)
Unlike the input-referred offset voltage, current mismatch is usually normalized to the average value
to allow a meaningful comparison:
ID
ID
= (W/L)
W/L
−2
VT H
VGS −VT H
(14.86)
This result suggests that, to minimize current mismatch, the overdrive voltage must be maximized, a trend
opposite to that in (14.78). This is because as VGS −VT H increases, threshold mismatch has a lesser
effect on the device currents.
The dependence of offset voltage and current mismatches upon the overdrive voltage is similar to our
observations in Chapter 7 for corresponding noise quantities. For a given current, the input noise voltage
of a differential pair increases as the overdrive increases because gm = 2ID/(VGS −VT H). Also, the
output noise current of current sources is proportional to gm and hence proportional to VGS −VT H.
Even-Order Distortion
Our study of nonlinearity in Sec. 14.1 implies that, by virtue of odd symmetry,
differential circuits are free from even-order distortion. In reality, however, mismatches degrade the
symmetry, thereby introducing a ﬁnite even-order nonlinearity.
Analysis of the even-order distortion in the presence of mismatches is generally quite complex, often
necessitating simulations. Here, we consider a simple case to gain some insight. Suppose the two signal
paths in a differential circuit are represented by y1 ≈α1x1 + α2x2
1 + α3x3
1 and y2 ≈β1x2 + β2x2
2 + β3x3
2
(Fig. 14.29). The differential output is given by
y1 −y2 = (α1x1 −β2x2) +

α2x2
1 −β2x2
2

+

α3x3
1 −β3x3
2

(14.87)
x1 (t)
y1 (t)
y2 (t)
y2 (t)
β1x + β2x2 + β3x3
α1x + α2x2 + α3x3
Figure 14.29
Effect of mismatch on
second-order distortion.

598
Chap. 14
Nonlinearity and Mismatch
which, for x1 = −x2, reduces to
y1 −y2 = (α1 + β1)x1 + (α2 −β2)x2
1 + (α3 + β3)x3
1
(14.88)
If x1(t) = A cos ωt, then the second harmonic has an amplitude equal to (α2 −β2)A2/2, i.e., proportional
to the mismatch between the second-order coefﬁcients of the input/output characteristic.
We should also mention that since at high frequencies, signals experience considerable phase shift,
even-order distortion may arise from phase mismatch. This point is considered in Problem 14.14.1.
In circuits dissipating a high power, thermal gradients across the chip may create asymmetries.
For example, if one transistor of a differential pair is closer to a high-power output stage than the
other transistor, then mismatches arise between the threshold voltages and the mobilities of the two
transistors.
14.2.2 Offset Cancellation Techniques
As mentioned above, the threshold voltage mismatch of MOSFETS trades with the channel capacitance.
For example, a threshold mismatch of 1 mV translates to roughly 300 fF of channel capacitance for
each transistor in a 0.6-μm technology. If many differential pairs are connected in parallel (e.g., in an
A/D converter), the input capacitance becomes prohibitively large, severely degrading the speed and/or
demanding high power dissipation in the preceding stage. Another difﬁculty is that mechanical stress may
increase the offset voltages after a circuit is packaged. For these reasons, many high-precision systems
require electronic cancellation of the offsets. As explained below, offset cancellation can also reduce 1/f
noise of ampliﬁers considerably.
As our ﬁrst step toward understanding the principle of offset cancellation, let us consider the circuit
of Fig. 14.30(a), where a differential ampliﬁer having an input-referred offset voltage VOS is followed by
two series capacitors. Now suppose, as shown in Fig. 14.30(b), the inputs are shorted together, driving
the ampliﬁer output to Vout = AvVOS. Furthermore, assume that during this period, nodes X and Y are
shorted together as well. We note that when all of the node voltages are settled and AvVOS is stored across
C1 and C2, a zero differential input results in a zero difference between VX and VY. Thus, after S1 and S2
turn off, the circuit consisting of the ampliﬁer and C1 and C2 exhibits a zero offset voltage, amplifying
only changes in the differential input voltage. In practice, the inputs and outputs must be shorted to proper
common-mode voltages [Fig. 14.30(c)].
VOS
Av
C1
C2
X
Y
VOS
C1
C2
X
Y
S1
S2
Av
AvVOS
(a)
(b)
VOS
C1
C2
X
Y
S1
Av
S2
VCM
S3
S4
VCM
(c)
Figure 14.30
(a) Simple ampliﬁer with capacitive coupling at the output; (b) circuit of (a) with its inputs and
outputs shorted; (c) proper setting of the common-mode level during offset cancellation.
In summary, this type of offset cancellation “measures” the offset by setting the differential input
to zero and stores the result on capacitors in series with the output. The circuit therefore requires a
dedicated offset cancellation period, during which the actual input is disabled. Figure 14.31 depicts the
ﬁnal topology, where CK denotes the offset cancellation command. Called “output offset storage,” this

Sec. 14.2
Mismatch
599
VOS
C1
C2
X
Y
S1
Av
S2
VCM
Vin
S3
S4
VCM
CK
CK
Figure 14.31
Control of ampliﬁcation
and offset cancellation modes by a clock.
technique reduces the overall offset to zero if S3-S4 exhibit no charge injection mismatch. Note, however,
that if Av is large, AvVOS may “saturate” the ampliﬁer output. For this reason, Av is typically chosen to
be less than roughly 10.
In applications where a high voltage gain is required, the topology of Fig. 14.32(a) may be employed.
Called “input offset storage,” this approach incorporates two series capacitors at the input and places the
S1
S2
VCM
Vin
C1
C2
X
Y
S3
S4
Vout
C1
C2
X
Y
S3
S4
Vout
VOS
(a)
(b)
Av
Av
Figure 14.32
(a) Input offset storage; (b) circuit of (a) in the offset cancellation mode.
ampliﬁer in a unity-gain negative-feedback loop during offset cancellation. Thus, from Fig. 14.32(b),
Vout = VXY and (Vout −VOS)(−Av) = Vout. That is
Vout =
Av
1 + Av
VOS
(14.89)
≈VOS
(14.90)
In essence, the circuit reproduces the ampliﬁer’s offset at nodes X and Y, storing the result on C1 and C2.
Note that for a zero differential input, the differential output is equal to VOS. Therefore, the input-referred
offset voltage of the overall circuit (after S3 and S4 turn off) equals VOS/Av if S3 and S4 match perfectly
(and the input capacitance of the ampliﬁer is much less than C1 and C2). In reality, however, when S3
and S4 turn off, their charge injection mismatch may saturate the ampliﬁer if Av is very large.
The general drawback of input and output storage techniques is that they introduce capacitors in the
signal path, a particularly serious issue in op amps and feedback systems. The bottom-plate parasitic of
the capacitors may reduce the magnitude of the poles in the circuit, thereby degrading the phase margin.
Even in open-loop ampliﬁers, this parasitic may limit the settling speed, intensifying the speed-power
trade-off.

600
Chap. 14
Nonlinearity and Mismatch
To resolve the above issues, the offset cancellation scheme can isolate the signal path from the offset
storage capacitors though the use of an “auxiliary” ampliﬁer. Consider the topology shown in Fig. 14.33,
where Aaux ampliﬁes the differential voltage V1 stored across C1 and C2 and subtracts the result from
the output of A1. We note that if VOS1A1 = V1Aaux, then for Vin = 0, Vout = 0, and the circuit is free
from offsets. The key point here is that C1 and C2 do not appear in the signal path.
VOS1
A1
Vin
Aaux
C2
C1
V1
Vout
Figure 14.33
Addition of an auxiliary
stage to remove the offset of an ampliﬁer.
How is V1 generated in Fig. 14.33? This is accomplished as illustrated in Fig. 14.34. Here, a second
stage, A2, is added and its output is sensed by Aaux during offset cancellation. To understand the operation,
suppose that ﬁrst only S1 and S2 are on, yielding Vout = VOS1A1A2. Now, assume that S3 and S4 turn on,
placing A2 and Aaux in a negative-feedback loop. The reader can show that Vout then drops by a factor
approximately equal to the loop gain: VOS1A1A2/(A2Aaux) = VOS1A1/Aaux. Stored across C1 and C2,
this value is indeed the required V1 in Fig. 14.33 because (VOS1A1/Aaux)Aaux = VOS1A1.
VOS1
A1
Vout
Aaux
C2
C1
A2
S1
S2
VCM
Vin
S3
S4
Figure 14.34
Auxiliary ampliﬁer placed in a feedback loop during offset cancellation.
The topology of Fig. 14.34 suffers from two drawbacks. First, two voltage gain stages in the signal
path may not be desirable in a high-speed op amp. Second, addition of the output voltages of A1 and A2
is quite difﬁcult. For these reasons, the technique is usually realized as shown in Fig. 14.35(a), where
each Gm stage is simply a differential pair and the R stage represents a transimpedance ampliﬁer. As
exempliﬁed by Fig. 14.35(b), Gm1 and R may in fact constitute a one-stage op amp, while Gm2 adds an
offset correction current at the low-impedance nodes X and Y.
Let us now examine the offset cancellation in Fig. 14.35(a) carefully, taking the offset voltage of Gm2
into account as well. As depicted in Fig. 14.36, we can write
[Gm1VOS1 −Gm2(Vout −VOS2)]R = Vout
(14.91)
Thus,
Vout = Gm1RVOS1 + Gm2RVOS2
1 + Gm2R
(14.92)

Sec. 14.2
Mismatch
601
VOS1
Vout
C2
C1
S1
S2
VCM
Vin
S3
S4
Gm1
Gm2
R
M1
M2
VDD
M3
M4
S1
S2
VCM
Vin
S3
S4
C1
C2
Gm1
R
Gm2
(a)
(b)
X
Y
Figure 14.35
(a) Circuit of Fig. 14.34 using Gm and R stages; (b) realization of (a) in a folded-cascode op amp.
VOS1
Vout
Gm1
Gm2
R
VOS2
Figure 14.36
Circuit of Fig. 14.35(a) including offset of Gm2.
This voltage is stored on C1 and C2 after S3 and S4 turn off. The offset voltage referred to the main input
is therefore given by
VOS,tot =
Vout
Gm1R
(14.93)
=
VOS1
1 + Gm2R + Gm2
Gm1
VOS2
1 + Gm2R
(14.94)
≈VOS1
Gm2R + VOS2
Gm1R
(14.95)

602
Chap. 14
Nonlinearity and Mismatch
where we have assumed that Gm2R ≫1. If Gm2R and Gm1R are large, as in the op amp of Fig. 14.35(b),
then VOS,tot is very small.
The offset cancellation of Fig. 14.35 warrants a cautionary note. Upon turning off, S3 and S4 may
inject slightly unequal charges onto C1 and C2, respectively, creating an error voltage that is not corrected
because the feedback loop is opened. The reader can prove that for a differential injection-induced error
voltage of V , the resulting input-referred offset voltage equals (Gm2/Gm1)V . For this reason, Gm2
is usually chosen to be on the order of 0.1Gm1.
We should also mention that the unity-gain and precision multiply-by-two circuits described in Chap-
ter 13 cancel the offset of the op amp as well. The proof is left to the reader.3
It is important to note that the offset cancellation techniques studied here require periodic refreshing
because the junction and subthreshold leakage of the switches eventually corrupts the correction voltage
stored across the capacitors. In a typical design, the offset must be refreshed at a rate of at least a few
kilohertz.
14.2.3 Reduction of Noise by Offset Cancellation
Recall from previous sections that the offset of a differential ampliﬁer can be viewed as a noise component
having a very low frequency. We therefore expect that periodic offset cancellation can potentially reduce
the (low-frequency) noise of the circuit as well.
Consider a simple differential ampliﬁer that is to be used in the front end of a sampling system
[Fig. 14.37(a)]. Here, the noise of A1 directly corrupts Vin. The 1/f noise of A1 proves especially
problematic if the signal spectrum extends from zero to only a few megahertz, because the 1/f noise
corner frequency is typically around 500 kHz to 1 MHz.
A1
Vin
Vout
C1
C2
S1
A1
S2
VCM
Vin
S3
S4
VCM
Vout
X
Y
C3
C4
(a)
(b)
Figure 14.37
(a) Front end of a sampler; (b) circuit of (a) with offset cancellation applied to the ﬁrst stage.
Now suppose the ampliﬁer undergoes offset cancellation before every sampling operation
[Fig. 14.37(b)]. That is, as depicted in Fig. 14.38, the input is disabled; the offset of A1 is stored on
C1 and C2; the input is enabled and ampliﬁed by A1 and A2 and stored on C3 and C4; and ﬁnally the
sampling switches are turned off. How does the noise of A1 affect the ﬁnal output? Denoting the time
elapsed from the end of offset cancellation to the end of sampling by t = t2 −t1, we recall that at t = t1,
VXY = 0. Thus, from t1 to t2, only high-frequency noise components of A1, on the order of > 1/t,
change VXY signiﬁcantly. In other words, offset cancellation suppresses noise frequencies below roughly
1/t.
To better understand this concept, let us consider a numerical example. Assuming that t = 10 ns, we
examine two noise components, one at 1 MHz and another at 10 MHz, approximating each with a sinusoid
(Fig. 14.39). For a sinusoid of amplitude A and frequency f , the maximum slew rate is equal to 2π f A,
3If, as shown in Fig. 13.35, an equalizing switch is added to the circuit, then the op amp offset may not be removed.

Sec. 14.2
Mismatch
603
C1
C2
A1
Vout
C3
C4
C1
C2
A1
Vin
A2
C1
C2
A1
Vout
C3
C4
Vin
A2
t
t1
t2
End of Offset Cancellation
End of Sampling
Figure 14.38
Sequence of operations in the sampler.
t
t1
t2
ΔV1
ΔV2
1 MHz
10 MHz
Figure 14.39
Variation of 1-MHz and 10-MHz noise components in a time interval of 10 ns.
and hence the maximum variation in t seconds is 2π f At. Normalizing this value to the amplitude,
we obtain the change for the 1-MHz and 10-MHz components as V1/A = 6.3% and V2/A = 63%,
respectively. We therefore conclude that noise frequencies below a few megahertz do not have sufﬁcient
time to change if the sampling occurs only 10 ns after the end of offset cancellation.
Originally utilized in charge-coupled devices (CCDs), the foregoing property of offset cancellation is
called “correlated double sampling” (CDS) because it involves two consecutive sampling operations (the
ﬁrst being offset storage) that are so tightly spaced in time that they do not allow (low-frequency) noise
components to vary signiﬁcantly. A powerful technique, CDS ﬁnds wide usage in suppressing the 1/f
noise of MOS circuits. Nonetheless, it leads to aliasing of wideband noise [5].
14.2.4 Alternative Deﬁnition of CMRR
Recall from Chapter 4 that common-mode rejection is represented by the change in the differential output
divided by the change in the input common-mode level, and the CMRR is deﬁned as the differential gain
divided by this quantity. We also noted that in fully differential circuits, the ﬁnite output impedance of
the tail current source and asymmetries limit the common-mode rejection.
Now consider a differential circuit sensing an input CM change, Vin,C M. If the differential output
voltage changes by Vout while the differential input voltage is zero, we can say that the output offset
voltage of the circuit has changed by Vout. In other words, common-mode rejection can be viewed as
the change in the output offset divided by the change in the input CM level. Following the notation in

604
Chap. 14
Nonlinearity and Mismatch
Chapter 4, we write
AC M−DM = VOS,out
VC M,in
(14.96)
Since CMRR = ADM/AC M−DM, we have
CMRR =
ADM
VOS,out
VC M,in
(14.97)
= VC M,in
VOS,out
ADM
(14.98)
Noting that VOS,out/ADM is in fact the input-referred offset voltage, we have
CMRR = VC M,in
VOS,in
(14.99)
The above result proves useful in analyzing the behavior of circuits. For example, suppose an op amp
incorporates a PMOS differential pair at the input. Which one of the topologies shown in Fig. 14.40 yields
a higher CMRR? In Fig. 14.40(a), body effect is eliminated and the threshold voltages of M1 and M2 are
independent of the input CM level. In Fig. 14.40(b), on the other hand, M1 and M2 experience body effect
and if they suffer from mismatches in their body effect coefﬁcients, then the difference between VT H1
and VT H2, i.e., the input offset voltage, varies with the input CM level, degrading the common-mode
rejection.
Vin
M1
M2
VDD
Vin
M1
M2
VDD
(a)
(b)
Figure 14.40
PMOS differential pair (a) without and (b) with body effect.
References
[1] F. Krummenacher and N. Joehl, “A 4-MHz CMOS Continuous-Time Filter with On-Chip Automatic Tuning,”
IEEE J. of Solid-State Circuits, vol. 23, pp. 750–758, June 1988.
[2] K. R. Lakshmikumar, R. A. Hadaway, and M. A. Copeland, “Characterization and Modeling of Mismatches
in MOS Transistors for Precision Analog Design,” IEEE J. of Solid-State Circuits, vol. 21, pp. 1057–1066,
December 1986.
[3] M. J. M. Pelgrom, A. C. J. Duinmaiger, and A. P. G. Welbers, “Matching Properties of MOS Transistors,” IEEE
J. of Solid-State Circuits, vol. SC-24, pp. 1433–1439, October 1989.
[4] M. J. M. Pelgrom, H. P. Tuinhout, and M. Vertregt, “Transistor Matching in Analog CMOS Applications,” IEDM
Dig. of Tech. Papers, pp. 34.1.1–34.1.4, December 1998.
[5] C. C. Enz and G. C. Temes, “Circuit Techniques for Reducing the Effects of Op-Amp Imperfections: Autozeroing,
Correlated Double Sampling, and Chopper Stabilization,” Proc. IEEE, vol. 84, pp. 1584–1614, November 1996.

Problems
605
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that
VDD = 3 V where necessary. Also, assume that all transistors are in saturation.
14.1.
The input-output characteristic of an ampliﬁer is approximated as y(t) = α1x(t) + α2x2(t) in the range
x = [0 xmax].
(a) What is the maximum nonlinearity?
(b) What is the THD for x(t) = (xmax cos ωt + xmax)/2.
14.2.
In the circuits of Fig. 14.6, W/L = 20/0.5 and I = 0.5 mA. Calculate the harmonic distortion in each circuit
if the input signal has a peak amplitude of 100 mV. How do the results change if we double W/L or I?
14.3.
For the circuits of Fig. 14.6, plot the THD and the input-referred thermal noise as a function of (a) W/L,
(b) I. Identify the trade-offs among noise, linearity, and power dissipation.
14.4.
In Fig. 14.6, two effects lead to a trade-off between nonlinearity and voltage gain. Describe these effects.
14.5.
The circuit of Fig. 14.6(a) is designed with W/L = 50/0.5, I = 1 mA, and RD = 2 k. The circuit is
placed in a feedback loop similar to that of Fig. 14.7 with β = 0.2 and senses an input sinusoid with a peak
amplitude of 10 mV. Calculate the THD at the output.
14.6.
Suppose that in Fig. 14.16, A1 and A2 have an input-referred noise voltage Vn. Neglecting other sources of
noise, calculate the input-referred noise voltage of the overall circuit.
14.7.
Equation 14.36 suggests that if the open-loop gain, α1, increases while other parameters remain constant,
then the harmonic distortion drops sharply. Repeat Problem 14.14.5 with W/L = 200/0.5 to achieve a higher
open-loop gain and explain the results.
14.8.
Equation 14.36 suggests that if βα1 ≫1, then b/a ∝β−2. Repeat Problem 14.14.5 with β = 0.4.
14.9.
Suppose the nonlinear feedforward ampliﬁer in Fig. 14.7 is characterized by y(t) = α1x(t) + α3x3(t).
Estimate the magnitude of the third harmonic at the output of the overall system.
14.10. As mentioned in Chapter 2, MOS devices operating in the subthreshold region exhibit an exponential behavior:
ID = I0 exp[VGS/(ζ VT )]. Suppose both of the circuits shown in Fig. 14.6 operate in the subthreshold region.
Derive expressions for the harmonic amplitudes if the input signal is much less than ζ VT . For the differential
pair, ﬁrst prove that ID1 −ID2 ∝tanh[Vin/(2ζ VT )] and then write the Taylor expansion of the hyperbolic
tangent.
14.11. The mobility of MOSFETs is in fact a function of the gate-source voltage and expressed as μ = μ0/[1 +
θ(VGS −VT H)], where θ is an empirical factor (Chapter 17). Assuming that θ(VGS −VT H) ≪1 and using
the relationship (1 + ϵ)−1 ≈1 −ϵ for ϵ ≪1, calculate the third harmonic in the circuit of Fig. 14.6(a).
14.12. The input devices of a differential pair have an effective length of 0.5 μm.
(a)
Assuming that VT H = 0.1tox/
√
W L and neglecting other mismatches, determine the minimum width
of the transistors such that VOS ≤5 mV.
(b)
If the tail current is 1 mA, what is the maximum input swing that gives a THD of 1%?
14.13. Repeat Problem 14.14.12 if the tolerable input offset is 2 mV and compare the results.
14.14. Determine the dimensions of M1 and M2 in Fig. 14.28 such that ID1 ≈ID2 = 0.5 mA, ID/ID = 2%, and
VGS −VT H = 0.5 V. Assume that VT H = 0.1tox/
√
W L and neglect other mismatches.
14.15. Source degeneration can improve the matching between current sources if resistor mismatches are small.
Prove that in the circuit of Fig. 14.41,
ID
ID
=
1
1 + gm RS
	
(μnCox)
μnCox
+ (W/L)
(W/L) −
2VT H
VGS −VT H
−gmRS

(14.100)
where RS denotes the mismatch between RS1 and RS2. Note that for an appreciable reduction of I/ID,
RS must be greater than 1/gm.

606
Chap. 14
Nonlinearity and Mismatch
M1
RS1
ID1
M2
RS2
ID2
Vb
Figure 14.41
14.16. In the circuit of Fig. 14.29, assume that α j = β j but x1(t) = A cos ωt and x2(t) = A cos(ωt + θ), where θ
denotes a small phase mismatch. Calculate the magnitude of the second harmonic at the output.
14.17. In the circuit of Fig. 14.42, M3 and M4 suffer from a threshold mismatch of VT H and the circuit is otherwise
symmetric. Assuming that λ ̸= 0 but γ = 0, calculate the input-referred offset voltage. What happens as
RD →∞?
Vin
RD
VDD
RD
Vout
Vb
M1
M2
M1
M2
Figure 14.42
14.18. In the circuit of Fig. 14.32, the ampliﬁer has an input capacitance (between X and Y) equal to Cin. Calculate
the input offset voltage after offset compensation.
14.19. The circuit of Fig. 14.32 is designed for an input offset voltage of 1 mV. If the width of the transistors in the
input differential pair of the ampliﬁer is doubled, what is the overall input offset voltage? (Neglect the input
capacitance of the ampliﬁer.)
14.20. Explain why the circuit of Fig. 14.27 suffers from a trade-off between the input offset and the output voltage
swing (for a given tail current).

CHAPTER
15
Oscillators
Oscillators are an integral part of many electronic systems. Applications range from clock generation in
microprocessors to carrier synthesis in cellular telephones, requiring vastly different oscillator topologies
and performance parameters. Robust, high-performance oscillator design in CMOS technology continues
to pose interesting challenges. As described in Chapter 16, oscillators are usually embedded in a phase-
locked system.
This chapter deals with the analysis and design of CMOS oscillators, more speciﬁcally, voltage-
controlled oscillators (VCOs). Beginning with a general study of oscillation in feedback systems, we
introduce ring oscillators and LC oscillators along with methods of varying the frequency of oscilla-
tion. We then describe a mathematical model of VCOs that will be used in the analysis of PLLs in
Chapter 16.
15.1
General Considerations
A simple oscillator produces a periodic output, usually in the form of voltage. As such, the circuit has
no input while sustaining the output indeﬁnitely. How can a circuit oscillate? Recall from Chapter 10
that negative-feedback systems may oscillate, i.e., an oscillator is a badly-designed feedback ampliﬁer!1
Consider the unity-gain negative-feedback circuit shown in Fig. 15.1, where
Vout
Vin
(s) =
H(s)
1 + H(s)
(15.1)
As mentioned in Chapter 10, if the ampliﬁer itself experiences so much phase shift at high frequen-
cies that the overall feedback becomes positive, then oscillation may occur. More accurately, if for
s = jω0, H( jω0) = −1, then the closed-loop gain approaches inﬁnity at ω0. Under this condition,
the circuit ampliﬁes its own noise components at ω0 indeﬁnitely. In fact, as conceptually illustrated in
Fig. 15.2, a noise component at ω0 experiences a total gain of unity and a phase shift of 180◦, returning
to the subtractor as a negative replica of the input. Upon subtraction, the input and the feedback sig-
nals give a larger difference. Thus, the circuit continues to “regenerate,” allowing the component at ω0
to grow.
1It is said, “In the high-frequency world, ampliﬁers oscillate and oscillators don’t.”
607

608
Chap. 15
Oscillators
H(s)
Vout
Vin
Figure 15.1
Feedback system.
H(s)
X
X
X
H(s)
H(s)
V0
Figure 15.2
Evolution of oscillatory system with time.
For the oscillation to begin, a loop gain of unity or greater is necessary. This can be seen by following
the signal around the loop over many cycles and expressing the amplitude of the subtractor’s output in
Fig. 15.2 as a geometric series (if ̸ H( jω0) = 180◦):
VX = V0 + |H( jω0)|V0 + |H( jω0)|2V0 + |H( jω0)|3V0 + · · ·
(15.2)
If |H( jω0)| > 1, the above summation diverges, whereas if |H( jω0)| < 1, then
VX =
V0
1 −|H( jω0)| < ∞
(15.3)
In summary, if a negative-feedback circuit has a loop gain that satisﬁes two conditions:
|H( jω0)| ≥1
(15.4)
̸ H( jω0) = 180◦
(15.5)
then the circuit may oscillate at ω0. Called “Barkhausen criteria,” these conditions are necessary but not
sufﬁcient [1].2 In order to ensure oscillation in the presence of temperature and process variations, we
typically choose the loop gain to be at least twice or three times the required value.
We may state the second Barkhausen criterion as ̸ H( jω) = 180◦or a total phase shift of 360◦. This
should not be confusing: if the system is designed to have low-frequency negative feedback, it already
produces 180◦of phase shift in the signal traveling around the loop (as represented by the subtractor in
Fig. 15.1), and ̸ H( jω) = 180◦denotes an additional frequency-dependent phase shift that, as illustrated
in Fig. 15.2, ensures that the feedback signal enhances the original signal. Thus, the three cases illustrated
in Fig. 15.3 are equivalent in terms of the second criterion. We say that the system of Fig. 15.3(a) exhibits
a frequency-dependent phase shift of 180◦(denoted by the arrow) and a dc phase shift of 180◦. The
difference between Figs. 15.3(b) and (c) is that the open-loop ampliﬁer in the former contains enough
stages with proper polarities to provide a total phase shift of 360◦at ω0, whereas that in the latter produces
no phase shift at ω0. Examples of these topologies are presented later in this chapter.
2We only know that, if the gain crossover frequency is less than the phase crossover frequency, then the system is stable.

Sec. 15.2
Ring Oscillators
609
(c)
(a)
(b)
180°
H( jω)
360°
H( jω)
0°
H( jω)
Figure 15.3
Various views of oscillatory feedback system.
CMOS oscillators in today’s technology are typically implemented as “ring oscillators” or “LC oscil-
lators.” We study each type in the following sections.
15.2
Ring Oscillators
A ring oscillator consists of a number of gain stages in a loop. To arrive at the actual implementation, we
begin by attempting to make a single-stage feedback circuit oscillate.
▲
Example15.1
Explain why a single common-source stage does not oscillate if it is placed in a unity-gain loop.
Solution
From Fig. 15.4, it is seen that the open-loop circuit contains only one pole, thereby providing a maximum frequency-
dependent phase shift of 90◦(at a frequency of inﬁnity). Since the common-source stage exhibits a dc phase shift of
180◦due to the signal inversion from the gate to the drain, the maximum total phase shift is 270◦. The loop therefore
fails to sustain oscillation growth.
CL
M1
RD
VDD
Vout
Figure 15.4
▲
The above example suggests that oscillation may occur if the circuit contains multiple stages and
hence multiple poles. Indeed, such a topology was considered undesirable in Chapter 10 because it led to
inadequate phase margin in op amps. We therefore surmise that if the circuit of Fig. 15.4 is modiﬁed as
shown in Fig. 15.5, then two signiﬁcant poles appear in the signal path, allowing the frequency-dependent
CL
CL
M2
M1
RD
RD
VDD
Vout
F
E
Figure 15.5
Two-pole feedback system.

610
Chap. 15
Oscillators
phase shift to approach 180◦. Unfortunately, this circuit exhibits positive feedback near zero frequency
due to the signal inversion through each common-source stage. As a result, it simply “latches up” rather
than oscillates. That is, if VE rises, VF falls, thereby turning M1 off and allowing VE to rise further. This
may continue until VE reaches VDD and VF drops to near zero, a state that will remain indeﬁnitely.
To gain more insight into the oscillation conditions, let us assume that an ideal inverting stage (with
zero phase shift at all frequencies) is inserted in the loop of Fig. 15.5, providing negative feedback near
zero frequency and eliminating the problem of latch-up (Fig. 15.6). Does this circuit oscillate? We note
that the loop contains only two poles: one at E and another at F. The frequency-dependent phase shift can
therefore reach 180◦, but at a frequency of inﬁnity. Since the loop gain vanishes at very high frequencies,
we observe that the circuit does not satisfy both of Barkhausen’s criteria at the same frequency (Fig. 15.7),
and thus fails to oscillate.
CL
CL
M2
RD
RD
VDD
Vout
M1
E
F
–1
Ideal
Figure 15.6
Two-pole feedback system
with additional signal inversion.
0
0
–40 dB/dec
ω (log axis)
ω (log axis)
–180°
–90°
H(ω)
ωp,E = ωp,F
20log∣H(ω)∣
Figure 15.7
Loop gain characteristics of a two-pole system.
The foregoing discussion points to the need for greater phase shift around the loop, suggesting the
possibility of oscillation if the third inverting stage in Fig. 15.6 contains a pole that contributes signiﬁcant
phase. We then arrive at the topology depicted in Fig. 15.8. If the three stages are identical, the total
phase shift around the loop, φ, reaches −135◦at ω = ωp,E(= ωp,F = ωp,G) and −270◦at ω = ∞.
Consequently, φ equals −180◦at ω < ∞, where the loop gain can still be greater than or equal to unity.
This circuit indeed oscillates if the loop gain is sufﬁcient and it is an example of a ring oscillator.
It is instructive to calculate the minimum voltage gain per stage in Fig. 15.8 that is necessary for
oscillation. Neglecting the effect of the gate-drain overlap capacitance and denoting the transfer function
of each stage by −A0/(1 + s/ω0), we have for the loop gain
H(s) = −
A3
0

1 + s
ω0
3
(15.6)

Sec. 15.2
Ring Oscillators
611
CL
M2
RD
CL
M1
RD
CL
M3
RD
VDD
Vout
G
F
E
Figure 15.8
Three-stage ring oscillator.
The circuit oscillates only if the frequency-dependent phase shift equals 180◦, i.e., if each stage contributes
60◦. The frequency at which this occurs is given by
tan−1 ωosc
ω0
= 60◦
(15.7)
and hence
ωosc =
√
3ω0
(15.8)
The minimum voltage gain per stage must be such that the magnitude of the loop gain at ωosc is equal
to unity:
A3
0

1 +
ωosc
ω0
2
3 = 1
(15.9)
It follows from (15.8) and (15.9) that
A0 = 2
(15.10)
In summary, a three-stage ring oscillator requires a low-frequency gain of 2 per stage, and it oscillates at
a frequency of
√
3ω0, where ω0 is the 3-dB bandwidth of each stage.
Let us now examine the waveforms at the three nodes of the oscillator of Fig. 15.8. Since each stage
contributes a frequency-dependent phase shift of 60◦as well as a low-frequency signal inversion, the
waveform at each node is 240◦(or 120◦) out of phase with respect to its neighboring nodes (Fig. 15.9).
The ability to generate multiple phases is a very useful property of ring oscillators.
t
VE
VF
VG
Figure 15.9
Waveforms of a three-
stage ring oscillator.

612
Chap. 15
Oscillators
Vout
Vin
1 + s
ω0
(            )3
–A3
0
Figure 15.10
Linear model of three-stage ring oscillator.
Amplitude Limiting
The natural question at this point is—What happens if in the three-stage ring of
Fig. 15.8, A0 ̸= 2? We know from Barkhausen’s criteria that if A0 < 2, the circuit fails to oscillate,
but what if A0 > 2? To answer this question, we ﬁrst model the oscillator by a linear feedback system,
as depicted in Fig. 15.10. Note that the feedback is positive (i.e., Vout is added to Vin) because H(s) in
Eq. (15.6) already includes the negative polarity resulting from three inversions in the signal path. The
closed-loop transfer function is
Vout(s)
Vin(s) =
−A3
0
(1 + s/ω0)3
1 +
A3
0
(1 + s/ω0)3
(15.11)
=
−A3
0
(1 + s/ω0)3 + A3
0
(15.12)
The denominator of (15.12) can be expanded as

1 + s
ω0
3 + A3
0 =

1 + s
ω0
+ A0
 
1 + s
ω0
2 −

1 + s
ω0

A0 + A2
0

(15.13)
Thus, the closed-loop system exhibits three poles:
s1 = (−A0 −1)ω0
(15.14)
s2,3 =
 A0(1 ± j
√
3)
2
−1

ω0
(15.15)
Since A0 itself is positive, the ﬁrst pole leads to a decaying exponential term: exp[(−A0 −1)ω0t], which
can be neglected in the steady state. Figure 15.11 illustrates the locations of the poles for different values
of A0, revealing that for A0 > 2, the two complex poles exhibit a positive real part and hence give rise
to a growing sinusoid. Neglecting the effect of s1, we express the output waveform as
Vout(t) = a exp
 A0 −2
2
ω0t

cos
 A0
√
3
2
ω0t

(15.16)
Thus, if A0 > 2, the exponential envelope grows to inﬁnity.
In practice, as the oscillation amplitude increases, the stages in the signal path experience nonlinearity
and eventually “saturation,” limiting the maximum amplitude. We may say that the poles begin in the
right half plane and eventually move to the imaginary axis to stop the growth. If the small-signal loop

Sec. 15.2
Ring Oscillators
613
σ
σ
σ
jω
jω
jω
–3ω0
–3ω0
–3ω0
0 < A0 < 2
A0 = 2
A0 > 2
Figure 15.11
Poles of three-stage ring oscillator for various values of gain.
gain is greater than unity, the circuit must spend enough time in saturation so that the “average” loop gain
is still equal to unity.3
▲
Example15.2
Shown in Fig.15.12 is a differential implementation of the oscillator of Fig. 15.8. What is the maximum voltage
swing of each stage?
M3
M4
M1
M2
ISS
ISS
ISS
R1
R1
R1
R1
R1
R1
M5
M6
VDD
t
X
Y
VX
VY
VDD
VDD – R1ISS
Figure 15.12
Solution
If the gain per stage is well above 2, then the amplitude grows until each differential pair experiences complete
switching, that is, until ISS is completely steered to one side every half cycle. As a result, the swing at each node is
equal to ISS R1. From the waveforms shown in Fig. 15.12, we also observe that each stage is in its high-gain region
for only a fraction of the period, (e.g., when |VX −VY | is small).
▲
3While intuitive, these statements are not rigorous. The concepts of transfer function, poles, and loop gain are difﬁcult to apply
to a nonlinear circuit.

614
Chap. 15
Oscillators
Y
Z
X
t
VX
VY
VZ
Figure 15.13
Ring oscillator using
CMOS inverters.
A simple implementation of ring oscillators that does not require resistors is depicted in Fig. 15.13.
Suppose the circuit is released with an initial voltage at each node equal to the trip point of the inverters,
Vtrip.4 With identical stages and no noise in the devices, the circuit would remain in this state indeﬁnitely,5
but noise components disturb each node voltage, yielding a growing waveform. The signal eventually
exhibits rail-to-rail swings.
TD
TD
TD
t
VX
VY
VZ
VDD
Figure 15.14
Waveforms of ring oscillator when one node is initialized at VDD.
Let us now assume that the circuit of Fig. 15.13 begins with VX = VDD (Fig. 15.14). Under this
condition, VY = 0 and VZ = VDD. Thus, when the circuit is released, VX begins to fall to zero (because
the ﬁrst inverter senses a high input), forcing VY to rise to VDD after one inverter delay, TD, and VZ
to fall to zero after another inverter delay. The circuit therefore oscillates with a delay of TD between
consecutive node voltages, yielding a period of 6TD.
The above small-signal and large-signal analyses raise an interesting question. While the small-signal
oscillation frequency is given by A0
√
3ω0/2 [from Eq. (15.16)], the large-signal value is 1/(6TD). Are
these two values equal? Not necessarily. After all, ω0 is determined by the small-signal output resistance
and capacitance of each inverter near the trip point, whereas TD results from the large-signal, nonlinear
4The trip point of an inverter is the input voltage that results in an equal output voltage.
5This is indeed how SPICE predicts the circuit’s behavior. To start the oscillation in SPICE, one of the nodes must be initialized
at a different voltage.

Sec. 15.2
Ring Oscillators
615
X1
X2
X3
X4
Y1
Y2
Y3
Y4
(a)
(b)
Figure 15.15
(a) Five-stage single-ended ring oscillator; (b) four-stage differential ring oscillator.
current drive and capacitances of each stage. In other words, when the circuit is released with all inverters
at their trip point, the oscillation begins with a frequency of
√
3A0ω0/2, but, as the amplitude grows and
the circuit becomes nonlinear, the frequency shifts to 1/(6TD) (which is a lower value).
Ring oscillators employing more than three stages are also feasible. The total number of inversions
in the loop must be odd so that the circuit does not latch up. For example, as shown in Fig. 15.15(a), a
ring can incorporate ﬁve inverters, providing a frequency of 1/(10TD). On the other hand, the differential
implementation can utilize an even number of stages by simply conﬁguring one stage such that it does not
invert. Illustrated in Fig. 15.15(b), this ﬂexibility demonstrates another advantage of differential circuits
over their single-ended counterparts.
▲
Example15.3
What is the minimum required voltage gain per stage in the four-stage oscillator of Fig. 15.15(b)? How many signal
phases are provided by the circuit?
Solution
Using a notation similar to that for Fig. 15.8, we have
H(s) = −
A4
0

1 + s
ω0
4
(15.17)
For the circuit to oscillate, each stage must contribute a frequency-dependent phase shift of 180◦/4 = 45◦. The
frequency at which this occurs is given by tan−1 ωosc/ω0 = 45◦and hence ωosc = ω0. The minimum voltage gain
is therefore derived as
A0

1 + ωosc
ω0
2
= 1
(15.18)
That is, A0 =
√
2. As expected, this value is lower than that required in a three-stage ring.
With 45◦of phase shift per stage, the oscillator provides four phases and their complements. This is illustrated in
Fig. 15.16.
▲
The number of stages in a ring oscillator is determined by various requirements, including speed, power
dissipation, noise immunity, etc. In most applications, three to ﬁve stages provide optimum performance
(for differential implementations).

616
Chap. 15
Oscillators
t
VX1
VY1
VY2
VX2
VX3
VY3
VX4
VY4
TD
Figure 15.16
▲
Example15.4
Determinethemaximumvoltageswingsandtheminimumsupplyvoltageofaringoscillatorincorporatingdifferential
pairs with resistive loads (e.g., as in Fig. 15.12) if no transistor must enter the triode region. Assume that each stage
experiences complete switching.
Solution
Figure 15.17(a) shows two stages in cascade. If each stage experiences complete switching, then each drain voltage,
e.g., VX or VY , varies between VDD and VDD −ISS RP. Thus, when M1 is fully on, its gate and drain voltages are
equal to VDD and VDD −ISS RP, respectively. For this transistor to remain in saturation, we have ISS RP ≤VT H,
i.e., the peak-to-peak swing at each drain must not exceed VT H.
X
Y
Vb
M1
M2
M1
M2
RP
RP
RP
RP
RP
RP
VDD
VDD
P
V1
V2
M3
V1
V2
VP
P
t
VX
VY
VP
(c)
(a)
(b)
ISS
ISS
ISS
Figure 15.17
How is the minimum supply voltage determined? If VDD is lowered, the voltage at the common source node of
each differential pair, e.g., VP in Fig. 15.17(a), falls, eventually driving the tail transistor into the triode region. We
must therefore calculate VP for the worst case, noting that VP does vary with time because M1 and M2 carry unequal
currents when the input difference becomes large.

Sec. 15.2
Ring Oscillators
617
Now consider the stand-alone circuit of Fig. 15.17(b), assuming that the inputs vary between VDD and VDD −
ISS RP. How does VP vary? When the gate voltage of M1, V1, is equal to VDD and M1 carries all of ISS,
VP = VDD −

2ISS
μnCox(W/L)1,2
−VT H
(15.19)
As V1 falls and V2 rises, so does VP because, so long as M2 is off, M1 operates as a source follower. When the
difference between V1 and V2 reaches
√
2(VGS,eq −VT H), where VGS,eq denotes the equilibrium overdrive of each
transistor, M2 turns on. To calculate VP after this point, we note that ID1 + ID2 = ISS, VGS1 = V1 −VP, and
VGS2 = V2 −VP. Thus,
1
2μnCox
 W
L

1,2(V1 −VP −VT H)2 + 1
2μnCox
 W
L

1,2(V2 −VP −VT H)2 = ISS
(15.20)
Expanding the quadratic terms and rearranging the result, we have
2V 2
P −2(V1 −VT H + V2 −VT H)VP + (V1 −VT H)2 + (V2 −VT H)2 −
2ISS
μnCox(W/L)1,2
= 0
(15.21)
It follows that
VP = 1
2

V1 + V2 −2VT H ±

−(V1 −V2)2 +
4ISS
μnCox(W/L)1,2

(15.22)
If V1 and V2 vary differentially, they can be expressed as V1 = VC M + V and V2 = VC M −V , where
VC M = VDD −ISS RP/2, yielding
VP = VC M −VT H ± 1
2

−(2V )2 +
4ISS
μnCox(W/L)1,2
(15.23)
This expression reveals why node P is considered a virtual ground in small-signal operation: if |V | is much less
than the maximum overdrive voltage, then VP is relatively constant. Since the term under the square root reaches a
maximum for V = 0 (equilibrium condition),
VP,min = VC M −VT H −

ISS
μnCox(W/L)1,2
(15.24)
As expected, the last term in (15.24) represents the overdrive voltage of each transistor in equilibrium (where
ID1 = ID2 = ISS/2).
Figure 15.17(c) shows typical waveforms in the oscillator. Note that VP varies at twice the oscillation frequency.
This property is sometimes exploited in “frequency doublers.”
To determine the minimum supply voltage, we write VP,min ≥VI SS, where VI SS denotes the minimum required
voltage across ISS. Thus,
VDD −RP ISS
2
−VT H −

ISS
μnCox(W/L)1,2
≥VI SS
(15.25)
and
VDD ≥VI SS + VT H +

ISS
μnCox(W/L)1,2
+ RP ISS
2
(15.26)
The terms on the right are the voltage headroom consumed by a current source, one threshold voltage, the equilibrium
overdrive, and half of the swing at each node.
▲

618
Chap. 15
Oscillators
In CMOS technologies lacking high-quality resistors, the implementation of Fig. 15.17(a) must be
modiﬁed. While a PMOS transistor operating in the deep triode region can serve as the load [Fig.
15.18(a)], the gate voltage must be set so as to deﬁne the on-resistance accurately. Alternatively, a diode-
connected load can be utilized [Fig. 15.18(b)], but at the cost of one threshold voltage in the headroom.
Figure 15.18(c) shows a more efﬁcient load where an NMOS source follower is inserted between the
drain and gate of each PMOS transistor. With the output sensed at nodes X and Y, M3 and M4 consume
only a voltage headroom equal to |VDS3,4|. If VGS5 ≈VT H3, then M3 operates at the edge of the triode
region and the small-signal resistance of the load is roughly equal to 1/gm3 (with the assumption that
λ = γ = 0) (Problem 15.4).
VDD
M1
X
Y
M2
Vout
Vin
M3
M4
ISS
M5
M6
(c)
VDD
M1
M2
Vb
Vout
M1
M2
Vout
Vin
M3
M4
VDD
M3
M4
ISS
Vin
ISS
(a)
(b)
Figure 15.18
Differential stages using PMOS loads.
The load of Fig. 15.18(c) exhibits another interesting property as well. Since the gate-source capaci-
tance of M3 is driven by the source follower, the time constant associated with the load is smaller than that
of a diode-connected transistor. Also, the ﬁnite output resistance of the follower may yield an inductive
behavior for the load (Problem 15.5).
15.3
LC Oscillators
Monolithic inductors have become common in CMOS technologies, making it possible to design oscil-
lators based on passive resonant circuits. Before delving into such oscillators, it is instructive to review
the basic properties of RLC circuits.
15.3.1 Basic Concepts
As shown in Fig. 15.19(a), an inductor L1 placed in parallel with a capacitor C1 resonates at a frequency
ωres = 1/√L1C1. At this frequency, the impedances of the inductor, j L1ωres, and the capacitor,
1/( jC1ωres), are equal and opposite, thereby yielding an inﬁnite impedance. We say that the circuit
has an inﬁnite quality factor, Q. In practice, inductors (and capacitors) suffer from resistive components.
For example, the series resistance of the metal wire used in the inductor can be modeled as shown in
Fig. 15.19(b). We deﬁne the Q of the inductor as L1ω/RS. For this circuit, the reader can show that the
equivalent impedance is given by
Zeq(s) =
RS + L1s
1 + L1C1s2 + RSC1s
(15.27)

Sec. 15.3
LC Oscillators
619
L1
C1
L1
C1
RS
(a)
(b)
Figure 15.19
(a) Ideal and (b) realistic
LC tanks.
and hence,
|Zeq(s = jω)|2 =
R2
S + L2
1ω2
(1 −L1C1ω2)2 + R2
SC2
1ω2
(15.28)
That is, the impedance does not go to inﬁnity at any s = jω. We say that the circuit has a ﬁnite Q. The
magnitude of Zeq in (15.28) reaches a peak in the vicinity of ω = 1/√L1C1, but the actual resonance
frequency has some dependency on RS.
The circuit of Fig. 15.19(b) can be transformed to an equivalent topology that more easily lends itself
to analysis and design. To this end, we ﬁrst consider the series combination shown in Fig. 15.20(a). For a
narrow frequency range, it is possible to convert the circuit to the parallel conﬁguration of Fig. 15.20(b).
LP
L1
RS
(a)
(b)
RP
Figure 15.20
Conversion of a series
combination to a parallel combination.
For the two impedances to be equivalent,
L1s + RS =
RP L Ps
RP + L Ps
(15.29)
Considering only the steady-state response, we assume that s = jω and rewrite (15.29) as
(L1RP + L P RS) jω + RS RP −L1L Pω2 = RP L P jω
(15.30)
This relationship must hold for all values of ω (in a narrow range), dictating that
L1RP + L P RS = RP L P
(15.31)
RS RP −L1L Pω2 = 0
(15.32)
Calculating RP from the latter and substituting in the former, we have
L P = L1

1 +
R2
S
L2
1ω2

(15.33)

620
Chap. 15
Oscillators
Recall that L1ω/RS = Q, a value typically greater than 3 for monolithic inductors. Thus,
L P ≈L1
(15.34)
and
RP ≈L2
1ω2
RS
(15.35)
≈Q2RS
(15.36)
In other words, the parallel network has the same reactance but a resistance Q2 times the series resistance.
This concept holds valid for a ﬁrst-order RC network as well if the Q of the series combination is deﬁned
as 1/(Cω)/RS.
LP
RP
L1
C1
RS
CP
Figure 15.21
Conversion of a tank to
three parallel components.
The above transformation allows the conversion illustrated in Fig. 15.21, where CP = C1. The
equivalence of course breaks down as ω departs substantially from the resonance frequency. The insight
gained from the parallel combination is that at ω1 = 1/	L pC p, the tank reduces to a simple resistor; i.e.,
the phase difference between the voltage and current of the tank drops to zero. Plotting the magnitude of
the tank impedance versus frequency [Fig. 15.22(a)], we note that the behavior is inductive for ω < ω1
and capacitive for ω > ω1. We then surmise that the phase of the impedance is positive for ω < ω1 and
negative for ω > ω1 [Fig. 15.22(b)]. These observations prove useful in studying LC oscillators. (Why do
we expect the phase shift to approach +90◦at very low frequencies and −90◦at very high frequencies?)
ω1
ω
ω1
ω
Z
(a)
(b)
–90°
+90°
∣Z∣
Figure 15.22
(a) Magnitude and
(b) phase of the impedance of an LC tank
as a function of frequency.

Sec. 15.3
LC Oscillators
621
Let us now consider the “tuned” stage of Fig. 15.23(a), where an LC tank operates as the load. At
resonance, j L pω = 1/( jC pω) and the voltage gain equals −gm1RP. (Note that the gain of the circuit
is very small at frequencies near zero.) Does this circuit oscillate if the output is connected to the input
[Fig. 15.23(b)]? At resonance, the total phase shift around the loop is equal to 180◦(rather than 360◦).
Also, from Fig. 15.22(b), the frequency-dependent phase shift of the tank never reaches 180◦. Thus, the
circuit does not oscillate.
LP
RP
CP
M1
Vout
Vin
VDD
LP
RP
CP
M1
Vout
VDD
(a)
(b)
Figure 15.23
(a) Tuned gain stage; (b) stage of (a) in feedback.
Before modifying the circuit for oscillatory behavior, let us observe another interesting property of the
gain stage of Fig. 15.23(a) that distinguishes it from a common-source topology using a resistive load.
Suppose, as shown in Fig. 15.24, the stage is biased at a drain current I1. If the series resistance of L p
is small, the dc level of Vout is close to VDD. How does Vout vary if a small sinusoidal voltage at the
resonance frequency is applied to the input? We expect Vout to be an inverted sinusoid with an average
value near VDD because the inductor cannot sustain a large dc drop. In other words, if the average value
of Vout deviates signiﬁcantly from VDD, then the inductor series resistance must carry an average current
greater than I1. Thus, the peak output level in fact exceeds the supply voltage, an important and often
useful attribute of the LC load. For example, with proper design, the output peak-to-peak swing can be
larger than VDD.
LP
RP
CP
M1
Vout
Vin
VDD
VDD
Figure 15.24
Output signal levels in a tuned stage.
We now study two types of LC oscillators.
15.3.2 Cross-Coupled Oscillator
Suppose we place two stages of Fig. 15.23(a) in a cascade, as depicted in Fig. 15.25. While similar to the
topology of Fig. 15.5, this conﬁguration does not latch up because its low-frequency gain is very small.
Furthermore, at resonance, the total phase shift around the loop is zero because each stage contributes
zero frequency-dependent phase shift. That is, if gm1RPgm2RP ≥1, then the loop oscillates. Note that
VX and VY are differential waveforms. (Why?)

622
Chap. 15
Oscillators
LP
LP
RP
CP
RP
CP
M2
VDD
M1
Vout
X
Y
Figure 15.25
Two tuned stages in a
feedback loop.
▲
Example15.5
Sketch the open-loop voltage gain and phase of the circuit shown in Fig. 15.25. Neglect transistor capacitances.
Solution
The magnitude of the transfer function has a shape similar to that in Fig. 15.22(a), but with a sharper rise and fall
because it results from the product of those of the two stages. The total phase at low frequencies is given by signal
inversion by each common-source stage plus a 90◦phase shift due to each tank. A similar behavior occurs at high
frequencies. The gain and phase are sketched in Fig. 15.26. From these plots, the reader can prove that the circuit
cannot oscillate at any other frequency.
ω1
ω
ω
ω1
H1
+90°
–90°
ω
ω1
–90°
ω
ω1
–180°
H2
+90°
H1 H2
+180°
∣H1∣
ω1
ω
∣H2∣
ω1
ω
∣H1 H2∣
×
+
=
=
Figure 15.26
Loop gain characteristics of the circuit shown in Fig. 15.25.
▲
The circuit of Fig. 15.25 serves as the core of many LC oscillators and is sometimes drawn as in
Fig. 15.27(a) or (b). However, the drain currents of M1 and M2, and hence the output swings, heavily
depend on the supply voltage. Since the waveforms at X and Y are differential, the drawing in Fig.
15.27(b) suggests that M1 and M2 can be converted to a differential pair as depicted in Fig. 15.27(c),
where the total bias current is deﬁned by ISS.
▲
Example15.6
For the circuit of Fig. 15.27(c), plot VX and VY and ID1 and ID2 as the oscillation begins.

Sec. 15.3
LC Oscillators
623
LP
RP
CP
M2
VDD
VDD
RP
LP
CP
LP
RP
CP
RP
LP
CP
VDD
LP
RP
CP
RP
LP
CP
M1
M1
X
Y
X
Y
M2
M1
X
Y
M2
ISS
(c)
(a)
(b)
Figure 15.27
(a) Redrawing of the oscillator shown in Fig. 15.25; (b) another redrawing of the circuit;
(c) addition of tail current source to lower supply sensitivity.
Solution
If the circuit begins with zero difference between VX and VY , then VX = VY ≈VDD. The two transistors share the
tail current equally. If (gm1,2RP)2 ≥1, where RP is the equivalent parallel resistance of the tank at resonance, then
noise components at the resonance frequency are ampliﬁed by M1 and M2, allowing the oscillation to grow. The
drain currents of M1 and M2 vary according to the instantaneous value of VX −VY (as in a differential pair).
As shown in Fig. 15.28, the oscillation amplitude grows until the loop gain drops at the peaks. In fact, if gm1,2RP
is large enough, the difference between VX −VY reaches a level that steers the entire tail current to one transistor,
turning the other off. Thus, in the steady state, ID1 and ID2 vary between zero and ISS.
t
VDD
2
ISS
VX
VY
ID2
ID1
Figure 15.28
▲
The oscillator of Fig. 15.27(c) is constructed in fully differential form. The supply sensitivity of the
circuit, however, is nonzero even with perfect symmetry. This is because the drain junction capacitances
of M1 and M2 vary with the supply voltage. We return to this issue in Example 15.9.

624
Chap. 15
Oscillators
15.3.3 Colpitts Oscillator
An LC oscillator may be realized with only one transistor in the signal path. Consider the gain stage of
Fig. 15.23(a) again and recall that the drain voltage cannot be applied to the gate because the overall phase
shift at resonance equals 180◦rather than 360◦. Also, recall that in a common-gate stage, the phase shift
from the source to the drain is zero. We then surmise that if, as shown in Fig. 15.29(a), the drain voltage
is returned to the source rather than the gate, the circuit may oscillate. The coupling must incorporate a
capacitor to avoid disturbing the bias point of M1.
(a)
(b)
LP
RP
CP
M1
Vout
VDD
Ib
C2
Vb
Iin
LP
RP
CP
M1
Vout
VDD
Ib
C2
Vb
Figure 15.29
(a) Tuned stage with feedback applied from drain to source; (b) addition of input current to
calculate closed-loop gain.
Unfortunately, owing to insufﬁcient loop gain, the circuit of Fig. 15.29(a) does not oscillate. To prove
this point, we invoke the view of Fig. 15.1, where an oscillator is considered a feedback system with
inﬁnite closed-loop gain. Applying an input current as depicted in Fig. 15.29(b) and neglecting transistor
parasitics, we obtain the closed-loop gain as
Vout
Iin
= L Ps


 1
CPs


RP
(15.37)
because M1 and C2 directly conduct the input current to the tank. Since the closed-loop gain cannot be
equal to inﬁnity at any frequency, the circuit fails to oscillate.
▲
Example15.7
The reader may wonder why the input to the feedback system is realized as a current source applied to the source of
the transistor rather than a voltage source applied to its gate. Perform the analysis with the latter stimulus.
Solution
From Fig. 15.30, we note that with a ﬁnite variation of Vin, the change in Ib is still zero if the bias current source
is ideal. Thus, if the source-bulk junction capacitance of M1 is neglected, the change in the tank current is zero,
yielding Vout/Vin = 0. Interestingly, VX does vary with Vin, but M1 generates a small-signal current that cancels
that through C2. The reader can prove that VX/Vin = gm/(gm + C2s).
▲
The above example reveals two important points. First, to excite a circuit into oscillation, the stim-
ulus can be applied at different points. (That is, the noise of any device in the loop can initiate the

Sec. 15.3
LC Oscillators
625
X
LP
RP
CP
M1
Vout
VDD
Ib
C2
Vin
Figure 15.30
oscillation.6) Second, in Fig. 15.30, Vout/Vin is zero because the impedance connected between the
source of M1 and ground is inﬁnity. We then add a capacitor from this node to ground as shown in
Fig. 15.31(a), seeking conditions of oscillation. Note that the capacitor in parallel with L P is removed.
The reason will become clear later.
LP
RP
M1
Vout
VDD
C2
Vb
C1
C1
C2
gmV1
V1
LP
RP
Iin
Vout
(a)
(b)
Figure 15.31
(a) Colpitts oscillator; (b) equivalent circuit of (a) with input stimulus.
Approximating M1 by a single voltage-dependent current source, we construct the equivalent circuit of
Fig. 15.31(b). Since the current through the parallel combination of L P and RP is given by Vout/(L Ps)+
Vout/RP, the total current through C1 is equal to Iin −Vout/(L Ps) −Vout/RP, yielding
V1 = −

Iin −Vout
L Ps −Vout
RP
 1
C1s
(15.38)
Writing the current through C2 as (Vout + V1)C2s, we sum all of the currents at the output node:
−gm

Iin −Vout
L Ps −Vout
RP
 1
C1s +

Vout −

Iin −Vout
L Ps −Vout
RP
 1
C1s

C2s + Vout
L Ps + Vout
RP
= 0
(15.39)
It follows that
Vout
Iin
=
RP L Ps(gm + C2s)
RPC1C2L Ps3 + (C1 + C2)L Ps2 + [gmL P + RP(C1 + C2)]s + gm RP
(15.40)
6This is because the natural frequencies of a linear (observable) system do not depend on the location of the stimulus. Of course,
the type of stimulus (voltage or current) must be chosen such that when it is set to zero, the circuit returns to its original topology.
For example, driving the gate of M1 in Fig. 15.30 by a current changes the natural frequencies of the circuit.

626
Chap. 15
Oscillators
Note that, as expected, (15.40) reduces to (L Ps||RP) if C1 = 0. The circuit oscillates if the closed-loop
transfer function goes to inﬁnity at an imaginary value of s, sR = jωR. Consequently, both the real and
imaginary parts of the denominator must drop to zero at this frequency:
−RPC1C2L Pω3
R + [gmL P + RP(C1 + C2)]ωR = 0
(15.41)
−(C1 + C2)L Pω2
R + gm RP = 0
(15.42)
Since with typical values, gmL P ≪RP(C1 + C2), Eq. (15.41) yields,
ω2
R =
1
L P
C1C2
C1 + C2
(15.43)
and Eq. (15.42) results in
gm RP = (C1 + C2)2
C1C2
(15.44)
= C1
C2

1 + C2
C1
2
(15.45)
Recognizing that gm RP is the voltage gain from the source of M1 to the output (if gmb = 0), we
determine the ratio C1/C2 for the minimum required gain. The reader can prove that the minimum occurs
for C1/C2 = 1, requiring
gm RP ≥4
(15.46)
Equation (15.46) demonstrates an important disadvantage of the Colpitts oscillator with respect to the
cross-coupled topology of Fig. 15.27(c). The former demands a voltage gain of at least 4 at resonance,
and the latter, only unity. This issue is critical if the inductor suffers from a low Q and hence a small RP,
a common situation in CMOS technologies. As a consequence, the cross-coupled scheme is used more
widely.
The foregoing analysis neglected the capacitance that appears in parallel with the inductor. As sug-
gested in Problem 15.10, if this capacitance, CP, is included in the equivalent circuit, Eq. (15.43) is
modiﬁed as
ω2
R =
1
L P

CP +
C1C2
C1 + C2

(15.47)
whereas (15.46) remains unchanged. Thus, CP is simply included in parallel with the series combination
of C1 and C2.
15.3.4 One-Port Oscillators
Our development of oscillators thus far has been based on feedback systems. An alternative view that
provides more insight into the oscillation phenomenon employs the concept of “negative resistance.” To
arrive at this view, let us ﬁrst consider a simple tank that is stimulated by a current impulse [Fig. 15.32(a)].
The tank responds with a decaying oscillatory behavior because, in every cycle, some of the energy that
reciprocates between the capacitor and the inductor is lost in the form of heat in the resistor. Now suppose
a resistor equal to −RP is placed in parallel with RP and the experiment is repeated [Fig. 15.32(b)].

Sec. 15.3
LC Oscillators
627
t
LP
RP
CP
Vout
Iin
LP
RP
–RP
–RP
CP
Vout
Iin
t
LP
RP
Active
Circuit
(c)
(a)
(b)
CP
Figure 15.32
(a) Decaying impulse response of a tank; (b) addition of negative resistance to cancel loss in RP;
(c) use of an active circuit to provide negative resistance.
Since RP||(−RP) = ∞, the tank oscillates indeﬁnitely. Thus, if a one-port circuit exhibiting a negative
resistance is placed in parallel with a tank [Fig. 15.32(c)], the combination may oscillate. Such a topology
is called a one-port oscillator.
How can a circuit provide a negative resistance? Recall that feedback multiplies or divides the input
and output impedances of circuits by a factor equal to one plus the loop gain. Thus, if the loop gain
is sufﬁciently negative (i.e., the feedback is sufﬁciently positive), a negative resistance is achieved. As
a simple example, let us apply positive feedback around a source follower. The follower introduces no
signal inversion, and neither must the feedback network. As depicted in Fig. 15.33(a), we implement the
feedback by a common-gate stage and add the current source Ib to provide the bias current of M2.7 From
the equivalent circuit in Fig. 15.33(b) (where channel-length modulation and body effect are neglected),
(a)
(b)
M1
M2
Vb
VDD
Ib
Rin
gm2V2
gm1V1
V2
V1
VX
IX
Figure 15.33
(a) Source follower with positive feedback to create negative input impedance; (b) equivalent
circuit of (a) to calculate the input impedance.
7This circuit can also be viewed as a CG stage with the source follower providing feedback.

628
Chap. 15
Oscillators
we have
IX = gm2V2 = −gm1V1
(15.48)
and
VX = V1 −V2
(15.49)
= −IX
gm1
−IX
gm2
(15.50)
Thus,
VX
IX
= −
 1
gm1
+
1
gm2

(15.51)
and, if gm1 = gm2 = gm, then
VX
IX
= −2
gm
(15.52)
Negative resistance becomes more intuitive if we bear in mind that it is an incremental quantity; that
is, negative resistance indicates that if the applied voltage increases, the current drawn by the circuit
decreases. In Fig. 15.33(a), for example, if the input voltage increases, so does the source voltage of M1,
decreasing the drain current of M2 and allowing part of Ib to ﬂow to the input source.
M1
M2
Vb
VDD
LP
RP
CP
Figure 15.34
Oscillator using the
negative input resistance of a source
follower with positive feedback.
Withanegativeresistanceavailable,wecannowconstructanoscillatorasillustratedinFig.15.34.Here,
RP denotes the equivalent parallel resistance of the tank and, for oscillation build-up, RP −2/gm ≥0.
Note that the inductor provides the bias current of M2, obviating the need for a current source. If the
small-signal resistance presented by M1 and M2 to the tank is less negative than −RP, then the circuit
experiences large swings such that each transistor is nearly off for part of the period, thereby yielding an
“average” resistance of −RP.
The circuit of Fig. 15.34 is similar to the stage of Fig. 15.29(a), but with the feedback capacitor
replaced by a source follower. More interestingly, the circuit can be redrawn as in Fig. 15.35(a), bearing
a resemblance to Fig. 15.27(c). In fact, if the drain current of M1 ﬂows through a tank and the resulting
voltage is applied to the gate of M2, the topology of Fig. 15.35(b) is obtained. Ignoring bias paths and
merging the two tanks into one (Fig. 15.36), we note that the cross-coupled pair must provide a negative
resistance of −RP between nodes X and Y to enable oscillation. The reader can prove that this resistance
is equal to −2/gm and hence it is necessary that RP ≥1/gm. Thus, the circuit can be viewed as either
a feedback system or a negative resistance in parallel with a lossy tank. This topology is also called a
“negative-Gm oscillator.”

Sec. 15.3
LC Oscillators
629
M1
VDD
M2
LP
RP
CP
Vb
VDD
M1
M2
LP
RP
CP
CP
RP
LP
(a)
(b)
Figure 15.35
(a) Redrawing of the topology shown in Fig. 15.34; (b) differential version of (a).
M1
M2
X
Y
X
Y
LP
CP
RP
LP
CP
RP
M1
M2
CP/2
2LP
2RP
–2 /gm
Figure 15.36
Equivalent circuit of Fig. 15.35(b).
As another method of creating negative resistance, consider the topology depicted in Fig. 15.37(a),
where none of the nodes is grounded and channel-length modulation, body effect, and transistor capaci-
tances are neglected. Since the drain current of M1 is equal to (−IX/C1s)gm, we have
VX =

IX −−IX
C1s gm
 1
C2s + IX
C1s
(15.53)
ZX
–gm
C1 C2
C1 C2ω2
C1 + C2
C2
M1
C1
LP
RP
(c)
(a)
(b)
C2
VX
IX
M1
C1
–IX
Figure 15.37
(a) Circuit topology providing negative resistance; (b) equivalent circuit of (a); (c) oscillator
using (a).

630
Chap. 15
Oscillators
and hence
VX
IX
=
gm
C1C2s2 +
1
C2s +
1
C1s
(15.54)
For s = jω, this impedance consists of a negative resistance equal to −gm/(C1C2ω2) in series with the
series combination of C1 and C2 [Fig. 15.37(b)]. Thus, as shown in Fig. 15.37(c), if an inductor is placed
between the gate and drain of M1, the circuit may oscillate. Of the three nodes in the circuit, one can be an
ac ground, resulting in the three different topologies illustrated in Fig. 15.38. The circuit of Fig. 15.38(a)
is in fact based on a source follower, whose input impedance was found in Chapter 6 to contain a negative
real part. The conﬁguration of Fig. 15.38(b) is a Colpitts oscillator.
C2
C1
L1
M1
M1
L1
C1
C2
M1
C2
C1
L1
(c)
(a)
(b)
Figure 15.38
Oscillator topologies derived from the circuit of Fig. 15.37(c).
▲
Example15.8
Redraw the circuits of Fig. 15.38 with proper biasing.
Solution
The circuits are redrawn in Fig. 15.39.
(c)
(a)
(b)
C2
L1
M1
C1
Vb
I1
VDD
M1
L1
C1
C2
Vb
I1
VDD
C2
M1
C1
L1
I1
VDD
Figure 15.39
▲
15.4
Voltage-Controlled Oscillators
Most applications require that oscillators be “tunable,” i.e., that their output frequency be a function of a
control input, usually a voltage. An ideal voltage-controlled oscillator is a circuit whose output frequency

Sec. 15.4
Voltage-Controlled Oscillators
631
Voltage−Controlled
Oscillator
ωout  
ωout
ω2
ω1 
ω0
Vcont
Vcont
V2
V1
KVCO
Figure 15.40
Deﬁnition of a VCO.
is a linear function of its control voltage (Fig. 15.40):
ωout = ω0 + KVCOVcont
(15.55)
Here, ω0 represents the intercept corresponding to Vcont = 0 and KVCO denotes the “gain” or “sensitivity”
of the circuit (expressed in rad/s/V).8 The achievable range, ω2 −ω1, is called the “tuning range.”
▲
Example15.9
In the negative-Gm oscillator of Fig. 15.27(c), assume that CP = 0, consider only the drain junction capacitance,
CDB, of M1 and M2, and explain why VDD can be viewed as the control voltage. Calculate the gain of the VCO.
Solution
Since CDB varies with the drain-bulk voltage, if VDD changes, so does the resonance frequency of the tank. Noting
that the average voltage across CDB is approximately equal to VDD, we write
CDB =
CDB0

1 + VDD
φB
m
(15.56)
and
KVCO = ∂ωout
∂VDD
(15.57)
= ∂ωout
∂CDB
· ∂CDB
∂VDD
(15.58)
With ωout = 1/√L PCDB, we have
KVCO =
−1
2√L PCDBCDB
·
−mCDB
φB

1 + VDD
φB

(15.59)
=
m
2φB

1 + VDD
φB
 · ωout
(15.60)
Note that the relationship between ωout and Vcont is nonlinear because KVCO varies with VDD and ωout.
▲
8A more familiar unit is Hz/V, but one must be careful with the dimension of KVCO in the context of phase-locked loops.

632
Chap. 15
Oscillators
Before modifying the oscillators studied in the previous sections for tunability, we summarize the
important performance parameters of VCOs.
Center Frequency
The center frequency (i.e., the midrange value in Fig. 15.40) is determined by the
environment in which the VCO is used. For example, in the clock generation network of a microprocessor,
the VCO may be required to run at the clock rate or even twice that. Today’s CMOS VCOs achieve center
frequencies as high as hundreds of gigahertz.
Tuning Range
The required tuning range is dictated by two parameters: (1) the variation of the VCO
center frequency with process and temperature, and (2) the frequency range necessary for the application.
The center frequency of some CMOS oscillators may vary by a factor of two at the extremes of process and
temperature, thus mandating a sufﬁciently wide (≥2×) tuning range to guarantee that the VCO output
frequency can be driven to the desired value. Also, some applications incorporate clock frequencies
that must vary by one to two orders of magnitude depending on the mode of operation, demanding a
proportionally wide tuning range.
An important concern in the design of VCOs is the disturbance of the output phase and frequency as
a result of noise on the control line. For a given noise amplitude, the noise in the output frequency is
proportional to KVCO because ωout = ω0 + KVCOVcont. Thus, to minimize the effect of noise in Vcont,
the VCO gain must be minimized, a constraint in direct conﬂict with the required tuning range. In fact,
if, as shown in Fig. 15.40, the allowable range of Vcont is from V1 to V2 (e.g., from 0 to VDD) and the
tuning range must span at least ω1 to ω2, then KVCO must satisfy the following requirement:
KVCO ≥ω2 −ω1
V2 −V1
(15.61)
Note that, for a given tuning range, KVCO increases as the supply voltage decreases, making the oscillator
more sensitive to noise on the control line.
Tuning Linearity
As exempliﬁed by Eq. (15.60), the tuning characteristics of VCOs exhibit nonlin-
earity, i.e., their gain, KVCO, is not constant. As explained in Chapter 16, such nonlinearity degrades the
settling behavior of phase-locked loops. For this reason, it is desirable to minimize the variation of KVCO
across the tuning range.
Actual oscillator characteristics typically exhibit a high-gain region in the middle of the range and a
low gain at the two extremes (Fig. 15.41). Compared to a linear characteristic (the gray line), the actual
behavior displays a maximum gain greater than that predicted by (15.61), implying that, for a given
tuning range, nonlinearity inevitably leads to higher sensitivity for some region of the characteristic.
Vcont
V2
V1
ωout
ω2
ω1
Figure 15.41
Nonlinear VCO
characteristic.
Output Amplitude
It is desirable to achieve a large output oscillation amplitude, thus making the
waveform less sensitive to noise. The amplitude trades with power dissipation, supply voltage, and (as
explained in Sec. 15.4.2) even the tuning range. Also, the amplitude may vary across the tuning range,
an undesirable effect.

Sec. 15.4
Voltage-Controlled Oscillators
633
Power Dissipation
As with other analog circuits, oscillators suffer from trade-offs among speed, power
dissipation, and noise. Typical oscillators drain 1 to 10 mW of power.
Supply and Common-Mode Rejection
Oscillators are quite sensitive to noise, especially if they are
realized in single-ended form. As seen in Example 15.9, even differential oscillators exhibit supply
sensitivity. The design of oscillators for high noise immunity is a difﬁcult challenge.
Output Signal Purity
Even with a constant control voltage, the output waveform of a VCO is not
perfectly periodic. The electronic noise of the devices in the oscillator and supply noise lead to noise in
the output phase and frequency. These effects are quantiﬁed by “jitter” and “phase noise” and determined
by the requirements of each application.
15.4.1 Tuning in Ring Oscillators
Recall from Sec. 15.2 that the oscillation frequency, fosc, of an N-stage ring equals (2NTD)−1, where
TD denotes the large-signal delay of each stage. Thus, to vary the frequency, TD can be adjusted.
VDD
M1
M2
Vcont
Vout
Vin
M3
M4
ISS
CL
CL
Figure 15.42
Differential pair with
variable output time constant.
As a simple example, consider the differential pair of Fig. 15.42 as one stage of a ring oscillator. Here,
M3 and M4 operate in the triode region, each acting as a variable resistor controlled by Vcont. As Vcont
becomes more positive, the on-resistance of M3 and M4 increases, thus raising the time constant at the
output, τ1, and lowering fosc. If M3 and M4 remain in the deep triode region,
τ1 = Ron3,4CL
(15.62)
=
CL
μpCox
W
L

3,4(VDD −Vcont −|VT H P|)
(15.63)
In the above equation, CL denotes the total capacitance seen at each output to ground (including the input
capacitance of the following stage). The delay of the circuit is roughly proportional to τ1, yielding
fosc ∝1
TD
(15.64)
∝
μpCox
W
L

3,4(VDD −Vcont −|VT H P|)
CL
(15.65)
Interestingly, fosc is linearly proportional to Vcont.
▲
Example15.10
For the given device dimensions and bias currents in Fig. 15.42, determine the maximum allowable value of Vcont.
What happens if M3 and M4 enter saturation?

634
Chap. 15
Oscillators
Solution
Let us assume (somewhat arbitrarily) that M3 and M4 remain in the deep triode region if |VDS3,4| ≤0.2×2|VGS3,4−
VT H P|. If each stage in the ring experiences complete switching, then the maximum drain current of M3 and M4 is
equal to ISS. To satisfy the above condition, we must have ISS Ron3,4 ≤0.4(VDD −Vcont −|VT H P|), and hence
ISS
μpCox
 W
L

3,4(VDD −Vcont −|VT H P|)
≤0.4(VDD −Vcont −|VT H P|)
(15.66)
It follows that
Vcont ≤VDD −|VT H P| −




ISS
0.4μpCox
 W
L

3,4
(15.67)
If Vcont exceeds this level by a large margin, M3 and M4 eventually enter saturation. Each stage then requires
common-mode feedback to produce the output swings around a well-deﬁned CM level.
▲
The differential pair of Fig. 15.42 suffers from a critical drawback: the output swing of the circuit
varies considerably across the tuning range. With complete switching, each stage provides a differential
output swing of 2ISS Ron3,4. Thus, a tuning range of, say, two to one translates to a twofold variation in
the swing.
In order to minimize the swing variation, the tail current can be adjusted by Vcont as well such that,
as Vcont becomes more positive, ISS decreases. The circuit nonetheless requires a means of maintaining
ISS Ron3,4 relatively constant. To this end, let us consider the circuit in Fig. 15.43(a), where M5 operates
in the deep triode region and ampliﬁer A1 applies negative feedback to the gate of M5. If the loop
gain is sufﬁciently large, the differential input voltage of A1 must be small, giving VP ≈VRE F and
|VDS5| ≈VDD −VRE F. Thus, the feedback ensures a relatively constant drain-source voltage even if I1
varies. In fact, as I1, say, decreases, A1 raises the gate voltage of M5 such that Ron5I1 ≈VDD −VRE F.
VDD
VREF
I1
P
A1
M5
VDD
M1
M2
M3
M4
ISS
VREF
A1
I1
P
X
Y
M5
Vcont
(a)
(b)
Figure 15.43
(a) Simple feedback circuit deﬁning VP; (b) replica biasing to deﬁne voltage swings in a ring
oscillator.
The topology of Fig. 15.43(a) can serve as a “replica circuit” for the stages of a ring oscillator, thereby
deﬁning the oscillation amplitude. Illustrated in Fig. 15.43(b), the idea is to “servo” the on-resistance of
M3 and M4 to that of M5 and vary the frequency by adjusting I1 and ISS simultaneously [2]. If M3 and
M4 are identical to M5 and ISS to I1, then VX and VY vary from VDD to VDD −VRE F as M1 and M2 steer
the tail current to one side or the other. Thus, if process and temperature variations, say, decrease I1 and
ISS, then A1 increases the on-resistance of M3–M5, forcing VP and hence VX and VY (when M1 or M2 is
fully on) equal to VRE F.

Sec. 15.4
Voltage-Controlled Oscillators
635
The bandwidth of the op amp A1 in Fig. 15.43(b) is of some concern. If a change in Vcont takes a long
time to change ωout, then the settling speed of a PLL using this VCO degrades signiﬁcantly (Chapter 16).
▲
Example15.11
How does the oscillation frequency depend on ISS for a VCO incorporating the stage of Fig. 15.43(b)?
Solution
Noting that Ron3,4ISS ≈VDD −VRE F, we have Ron3,4 ≈(VDD −VRE F)/ISS, and hence
fosc ∝
1
Ron3,4CL
(15.68)
∝
ISS
(VDD −VRE F)CL
(15.69)
Thus, the characteristic is relatively linear.
▲
Delay Variation by Positive Feedback
To arrive at another tuning technique, recall that a cross-
coupled transistor pair such as that of Fig. 15.36 exhibits a negative resistance of −2/gm, a value that can
be controlled by the bias current. A negative resistance −RN placed in parallel with a positive resistance
+RP gives an equivalent value +RN RP/(RN −RP), which is more positive if | −RN| > | +RP|. This
idea can be applied to each stage of a ring oscillator as illustrated in Fig. 15.44(a). Here, the load of the
differential pair consists of resistors R1 and R2 (R1 = R2 = RP) and the cross-coupled pair M3–M4.
As I1 increases, the small-signal differential resistance −2/gm3,4 becomes less negative and, from the
half circuit of Fig. 15.44(b), the equivalent resistance RP||(−1/gm3,4) = RP/(1 −gm3,4RP) increases,
thereby lowering the frequency of oscillation.
M1
M2
Vin
ISS
R1
VDD
R2
M3
M4
I1
Vcont
Vout
M1
RP
VDD
Vin
Vout
gm3,4
–1
(a)
(b)
Figure 15.44
(a) Differential stage with variable negative-resistance load; (b) half-circuit equivalent of (a).
An important issue in the circuit of Fig. 15.44(a) is that as I1 varies, so do the currents steered by M3
and M4 to R1 and R2. Thus, the output voltage swing is not constant across the tuning range. To minimize
this effect, ISS can be varied in the opposite direction such that the total current steered between R1 and
R2 remains constant. In other words, it is desirable to vary I1 and ISS differentially while their sum is
ﬁxed, a characteristic provided by a differential pair. Illustrated in Fig. 15.45, the idea is to employ a
differential pair M5–M6 to steer IT to M1–M2 or M3–M4 so that ISS + I1 = IT . Since IT must ﬂow
through R1 and R2, if M1–M4 experience complete switching in each cycle of oscillation, then IT is
steered to R1 (through M1 and M3) in half a period and to R2 (through M2 and M4) in the other half,
giving a differential swing of 2RP IT .

636
Chap. 15
Oscillators
M1
M2
Vin
R1
VDD
R2
M3
M4
Vout
M5
M6
IT
Vcont1
Vcont2
IH
ISS
I1
P
Figure 15.45
Use of a differential pair
to steer current between M1–M2 and
M3–M4.
In the circuit of Fig. 15.45, Vcont1 and Vcont2 can be viewed as differential control lines if they vary
by equal and opposite amounts. Such a topology provides higher noise immunity for the control input
than if Vcont is single-ended. Now, note that as Vcont1 decreases and Vcont2 increases, the cross-coupled
pair exhibits a greater transconductance, thereby raising the time constant at the output nodes. But what
happens if all of IT is steered by M6 to M3 and M4? Since M1 and M2 carry no current, the gain of the
stage falls to zero, prohibiting oscillation. To avoid this effect, a small constant current source, IH, can
be connected from node P to ground, thereby ensuring that M1 and M2 always remain on. With typical
values, this ring oscillator provides a two-to-one tuning range and reasonable linearity.
▲
Example15.12
Calculate the minimum value of IH in Fig. 15.45 to guarantee a low-frequency gain of 2 when all of IT is steered to
the cross-coupled pair.
Solution
The small-signal voltage gain of the circuit equals gm1,2RP/(1 −gm3,4RP). Assuming square-law devices, we have

μnCox
 W
L

1,2IH
RP
1 −

μnCox
 W
L

3,4IT RP
≥2
(15.70)
That is
IH ≥
4

1 −

μnCox
 W
L

3,4IT RP
2
μnCox
 W
L

1,2R2
P
(15.71)
▲
An important drawback of using the differential pair M5–M6 in the circuit of Fig. 15.45 is the additional
voltage headroom that it consumes. As depicted in Fig. 15.46, for M5 to remain in saturation, VP must be
sufﬁciently higher than VN. When Vcont1 = Vcont2, the minimum allowable drain-source voltage of M5
is equal to its equilibrium overdrive voltage, implying that, compared to that calculated in Example 15.4,

Sec. 15.4
Voltage-Controlled Oscillators
637
M1
M2
Vin
M5
M6
Vcont1
Vcont2
P
N
M7
Vb
Figure 15.46
Headroom calculation
for a current-steering topology.
the supply voltage must be higher by this value. Note also that if Vcont1 or Vcont2 is allowed to vary above
its equilibrium value by more than VT H, then M5 or M6 enters the triode region.
The previous observation reveals a trade-off between voltage headroom and the sensitivity of the VCO.
In order to minimize the sensitivity with a given tuning range, the transconductance of M5–M6 must be
minimized. (That is, to steer all of the tail current, the differential pair must require a large Vcont1−Vcont2.)
However, for a given tail current, gm = 2ID/(VGS −VT H), indicating a large equilibrium overdrive for
M5–M6 and a correspondingly higher value for the minimum required supply voltage.
We should mention that the pair M5–M6 need not remain in complete saturation. If the drain voltages
are low enough to drive these transistors into the triode region, then the equivalent transconductance of
the differential pair drops, demanding a greater Vcont1 −Vcont2 to steer the tail current. This phenomenon
in fact translates to a lower VCO sensitivity. In practice, careful simulations are required to ensure that
the VCO characteristic remains relatively linear across the range of interest.9
ISS
VDD
Vin1
Vin2
Iout2
Iout1
I1
I2
L
W
L
W
L
W
K
L
W
K
ISS
M1
M2
R1
VDD
R2
M3
M4
Vcont1
To Other
Stages
(a)
(b)
Vcont2
Figure 15.47
(a) Current folding topology; (b) application of current folding to current steering.
Atlowsupplyvoltages,itisdesirabletoavoidthevoltageheadroomconsumedby M5–M6 inFig.15.45.
The issue can be resolved by means of “current folding.” Suppose, as illustrated in Fig. 15.47(a), a
differential pair drives two current mirrors, generating Iout1 and Iout2. Since I1 + I2 = ISS, Iout1 = K I1,
and Iout2 = K I2, we have Iout1 + Iout2 = K ISS. Thus, as Vin1 −Vin2 goes from a very negative value to
a very positive value, Iout1 varies from K ISS to zero and Iout2 from zero to K ISS while their sum remains
constant—a behavior similar to that of a differential pair.
9If both M5 and M6 are in the triode region and Vcont1 ̸= Vcont2, then supply voltage variations affect the current steered
between the two transistors, introducing noise in the frequency of oscillation.

638
Chap. 15
Oscillators
We now utilize the topology of Fig. 15.47(a) in the gain stage of Fig. 15.44(a). Shown in Fig. 15.47(b),
the resulting circuit operates from a low supply voltage. However, the devices in the control path contribute
substantial noise, modulating the oscillation frequency.
Delay Variation by Interpolation
Another approach to tuning ring oscillators is based on “interpo-
lation” [3, 4]. As illustrated in Fig. 15.48(a), each stage consists of a fast path and a slow path whose
outputs are summed and whose gains are adjusted by Vcont in opposite directions. At one extreme of the
control voltage, only the fast path is on and the slow path is disabled, yielding the maximum oscillation
frequency [Fig. 15.48(b)]. Conversely, at the other extreme, only the slow path is on and the fast path is
off, providing the minimum oscillation frequency [Fig. 15.48(c)]. If Vcont lies between the two extremes,
each path is partially on, and the total delay is a weighted sum of their delays.
Vcont
Vout
Vin
Fast Path
Slow Path
(a)
(c)
(b)
Figure 15.48
(a) Interpolating delay stage; (b) smallest delay; (b) largest delay.
To better understand the concept of interpolation, let us implement the topology of Fig. 15.48(a) at
the transistor level. Each stage can be simply realized as a differential pair whose gain is controlled by
its tail current. But how are the two outputs summed? Since the two transistors in a differential pair
provide output currents, the outputs of the two pairs can be added in the current domain. As depicted
in Fig. 15.49(a), simply shorting the outputs of two pairs performs the current addition, e.g., for small
signals, Iout = gm1,2Vin1 + gm3,4Vin2. The overall interpolating stage therefore assumes the conﬁguration
shown in Fig. 15.49(b), where V +
cont and V −
cont denote voltages that vary in opposite directions (so that
when one path turns on, the other turns off). The output currents of M1–M2 and M3–M4 are summed at
X and Y and ﬂow through R1 and R2, producing Vout.
In the circuit of Fig. 15.49(b), the gain of each stage is varied by the tail current to achieve interpolation.
But it is desirable to maintain constant voltage swings. We also recognize that the gain of the differential
pair M5–M6 need not be varied because even if only the gain of M3–M4 drops to zero, the slow path is
fully disabled. We then surmise that if the tail currents of M1–M2 and M3–M4 vary in opposite directions
such that their sum remains constant, we achieve both interpolation between the two paths and constant
output swings. Illustrated in Fig. 15.50, the resulting circuit employs the differential pair M7–M8 to steer
ISS between M1–M2 and M3–M4. If Vcont is very negative, M8 is off and only the fast path ampliﬁes
the input. Conversely, if Vcont is very positive, M7 is off and only the slow path is enabled. Since the

Sec. 15.4
Voltage-Controlled Oscillators
639
M1
M2
Vin1
ISS
ISS
M3 M4
Vin2
Iout
Iout1
Iout2
M1
M2
Vin
M3 M4
R1
VDD
R2
Vout
V+cont
M5 M6
V–cont
V–cont
VDD
(a)
(b)
X
Y
Figure 15.49
(a) Addition of currents of two differential pairs; (b) interpolating delay stage.
M1
M2
Vin
M3 M4
R1
VDD
R2
Vout
M5 M6
VDD
M7 M8
Vcont
ISS
E
F
Figure 15.50
Interpolating delay stage with current steering.
slow path in this case employs one more stage than the fast path, the VCO achieves a tuning range of
roughly two to one. For operation with low supply voltages, the control pair M7–M8 can be replaced by
the current-folding topology of Fig. 15.47(a).
▲
Example15.13
Combine the tuning techniques of Figs. 15.45 and 15.50 to achieve a wider tuning range.
Solution
We begin with the interpolating stage of Fig. 15.50 and add a cross-coupled pair to the output nodes [Fig. 15.51(a)].
However, in order to obtain constant voltage swings, the total current through the load resistors must remain

640
Chap. 15
Oscillators
M1
M2
Vin
M3 M4
R1
VDD
R2
Vout
R1
VDD
R2
Vout
M5 M6
VDD
M1
M2
Vin
VDD
M7 M8
M3 M4
M5 M6
Vcont
Vcont
ISS
M10
M11
I1
M10
M11
VDD
Vcont
(a)
(b)
ISS1
ISS2
ISS3
L
W
L
W
L
W
2
Figure 15.51
constant.Thisisaccomplishedbyreplacingthecontroldifferentialpairwiththecurrent-foldingcircuitofFig.15.47(a).
Depicted in Fig. 15.51(b), the resulting conﬁguration steers the current to M1–M2 to speed up the circuit and
to M3–M4 and M10–M11 to slow down the circuit. The tail current source dimensions are chosen such that
ISS1 = ISS2 + ISS3.
▲
Wide-Range Tuning
Except for the circuit of Fig. 15.43(b), the ring oscillator tuning techniques
presented thus far achieve a tuning range of typically no more than three to one. In applications where
the frequency must be varied by orders of magntitude, the topology shown in Fig. 15.52 can be used.
Driven by the input, the additional PMOS transistors M5 and M6 pull each output node to VDD, creating
a relatively constant output swing even with large variations in ISS. The oscillation frequency of a ring
incorporating this stage can be varied by more than four orders of magnitude with less than a twofold
variation in the amplitude.

Sec. 15.4
Voltage-Controlled Oscillators
641
VDD
M1
M2
ISS
Vcont
M4
M3
M5
M6
Vout
Vin
Figure 15.52
Differential stage with
wide tuning range.
15.4.2 Tuning in LC Oscillators
The oscillation frequency of LC topologies is equal to fosc = 1/(2π
√
LC), suggesting that only the
inductor and capacitor values can be varied to tune the frequency, and other parameters such as bias
currents and transistor transconductances affect fosc negligibly. Since it is difﬁcult to vary the value of
monolithic inductors, we simply change the tank capacitance to tune the oscillator. Voltage-dependent
capacitors are called “varactors.”10
A reverse-biased pn junction can serve as a varactor. The voltage dependence is expressed as
Cvar =
C0

1 + VR
φB
m
(15.72)
where C0 is the zero-bias value, VR the reverse-bias voltage, φB the built-in potential of the junction,
and m a value typically between 0.3 and 0.4.11 Equation (15.72) reveals an important drawback of LC
oscillators: at low supply voltages, VR has a very limited range, yielding a small range for Cvar and
hence for fosc. We also note that to maximize the tuning range, constant capacitances in the tank must
be minimized.
▲
Example15.14
Suppose that in Eq. (15.72), φB = 0.7 V, m = 0.35, and VR can vary from zero to 2 V. How much tuning range can
be achieved?
Solution
For VR = 0, C j = C0 and fosc,min = 1/(2π√LC0). For VR = 2 V, C j ≈0.62C0 and fosc,max = 1/
(2π√L × 0.62C0) ≈1.27 fosc,min. Thus, the tuning range is approximately equal to 27%. As explained later,
the parasitic capacitances of the inductor and the transistor(s) further limit this range because they cannot be varied
by the control voltage.
▲
Let us now add varactor diodes to a cross-coupled LC oscillator (Fig. 15.53). To avoid forward-biasing
D1 and D2 signiﬁcantly, Vcont must not exceed VX or VY by more than a few hundred millivolts. Thus,
if the peak amplitude at each node is A, then 0 < Vcont < VDD −A + 300 mV, where it is assumed
that a forward bias of 300 mV creates negligible current. Interestingly, the circuit suffers from a trade-off
between the output swing and the tuning range. This effect appears in most LC oscillators.
10The term “varicap” is also used.
11Note that m = 0.5 for an abrupt junction, but pn junctions in CMOS technology are not abrupt.

642
Chap. 15
Oscillators
LP
VDD
LP
Vcont
X
Y
D1
D2
VX
VY
VDD
0
A
Allowable Range of
Vcont
Figure 15.53
LC oscillator using varactor diodes.
Note that, since the swings at X and Y are typically large (e.g., 1 Vpp at each node), the capacitance
of D1 and D2 varies with time. Nonetheless, the “average” value of the capacitance is still a function of
Vcont, providing the tuning range.
How are varactor diodes realized in CMOS technology? Illustrated in Fig. 15.54 are two types of pn
junctions. In Fig. 15.54(a), the anode is inevitably grounded whereas in Fig. 15.54(b), both terminals are
ﬂoating. For the circuit of Fig. 15.53, only the ﬂoating diode can be used. To increase the capacitance of
the junction, the p+ and n+ areas (and hence the n-well) are enlarged.
n−well
p+
p−substrate
n+
p+
p−substrate
n+
(a)
(b)
p+
n+
Side
View
Top
View
p+
n+
Figure 15.54
Diodes realized in CMOS technology.
Upon closer examination, the structure of Fig. 15.54(b) suffers from a number of drawbacks. First,
the n-well material has a high resistivity, creating a resistance in series with the reverse-biased diode
and lowering the quality factor of the capacitance. Second, the n-well displays substantial capacitance to
the substrate, contributing a constant capacitance to the tank and limiting the tuning range. The diode is
therefore represented as shown in Fig. 15.55, where Cn represents the (voltage-dependent) capacitance
between the n-well and the substrate.12
Cn
RS
Figure 15.55
Circuit model of the
varactor shown in Fig. 15.54(b).
12In circuit simulations, Cn is replaced by a diode having proper junction capacitance.

Sec. 15.4
Voltage-Controlled Oscillators
643
In order to decrease the series resistance of the structure shown in Fig. 15.54(b), the p+ region can
be surrounded by an n+ ring so that the displacement current ﬂowing through the junction capacitance
sees a low resistance in all four directions [Fig. 15.56(a)]. Since a single minimum-size p+ area has a
small capacitance, many of these units can be placed in parallel [Fig. 15.56(b)]. The n-well, however,
must accommodate the entire set, exhibiting a large capacitance to the substrate.
(a)
(b)
p+
n+
n+
Figure 15.56
(a) Reduction of series resistance by surrounding the p+ region by an n+ ring; (b) several diodes in
parallel.
It is instructive at this point to examine the unwanted capacitances in the circuit of Fig. 15.53, i.e.,
the components that are not varied by Vcont. We identify three such capacitances: (1) the capacitance
between the n-well and the substrate associated with D1 and D2; (2) the capacitances contributed by the
transistors to each node, i.e., CGD, 2CGD (the factor of 2 arising from the Miller effect13), and CDB; and
(3) the parasitic capacitance of the inductor itself. Monolithic inductors are typically implemented as
metal spiral structures (Fig. 15.57) having relatively large dimensions (S ≈100−200 μm).
I
I
S
Figure 15.57
Spiral inductor
structure.
In Fig. 15.53, it is desirable to connect the anode of the diodes to nodes X and Y, thereby eliminating
the parasitic n-well capacitances from the tank. Shown in Fig. 15.58 is a topology allowing such a
modiﬁcation. Here, the cross-coupled pair incorporates PMOS devices, providing swings around the
ground potential. The use of PMOS devices also leads to less ﬂicker noise, an important advantage
because this noise may be “upconverted,” appearing around the oscillation frequency.
In modern LC VCO design, we employ MOS varactors. Recall from Chapter 2 that the gate-channel
capacitance of MOSFETs varies with the gate-source voltage [Fig. 15.59(a)]. However, the nonmonotonic
dependence proves undesirable in VCO design (why?). To resolve this issue, an NMOS transistor can be
placed inside an n-well, forming an “accumulation-mode” varactor [Fig. 15.59(b)]. The source, drain,
and n-well are ohmically connected and serve as one terminal, and the gate as the other. The capacitance
of this structure varies monotonically with VGS, as shown in Fig. 15.59(c).
13If the gate and drain voltages vary by equal and opposite amounts, the Miller multiplication factor is equal to 2 regardless of
the small-signal gain.

644
Chap. 15
Oscillators
LP
LP
Vcont
D1
X
Y
D2
VDD
Figure 15.58
Negative-Gm oscillator
using PMOS devices to eliminate n-well
capacitance from the tanks.
VGS
CGS
0 VTH
Accumulation
Strong Inversion
G
S
n−well
p−substrate
n+
n+
VG
VS
(c)
(a)
(b)
VGS
CGS
0
Cmin
Cmax
Figure 15.59
(a) Voltage dependence of a MOS gate capacitance, (b) MOS varactor formed as an NFET inside
an n-well, and (c) resulting characteristic.
An important advantage of the MOS varactor over the pn junction is that the former does not experience
forward bias and can therefore tolerate both positive and negative voltages. The design of LC VCOs entails
numerous interesting concepts and issues. The reader is referred to [5] and the vast literature on the subject
for details.
15.5
Mathematical Model of VCOs
The deﬁnition of the voltage-controlled oscillator given by Eq. (15.55) speciﬁes the relationship between
the control voltage and the output frequency. The dependence is “memoryless” because a change in Vcont
immediately results in a change in ωout. But how is the output signal of the VCO expressed as a function
of time? To answer this question, we must review the concepts of phase and frequency.
Consider the waveform V0(t) = Vm sin ω0t. The argument of the sinusoid is called the “total phase”
of the signal. In this example, the phase varies linearly with time, exhibiting a slope equal to ω0. Note
that, as depicted in Fig. 15.60, every time ω0t crosses an integer multiple of π, V0(t) crosses zero.

Sec. 15.5
Mathematical Model of VCOs
645
π
2π
4π
3π
Phase
V0(t)
t
t
ω0
Figure 15.60
Illustration of phase of a
signal.
Now consider two waveforms V1(t) = Vm sin[φ1(t)] and V2(t) = Vm sin[φ2(t)], where φ1(t) =
ω1t, φ2(t) = ω2t, and ω1 < ω2. As illustrated in Fig. 15.61, φ2(t) crosses integer multiples of π faster
than φ1(t) does, yielding faster variations in V2(t). We say that V2(t) accumulates phase faster.
π
2π
4π
3π
5π
t
t
V1
V2
ϕ1
ϕ2
Figure 15.61
Variation of phase for
two signals.
The above study reveals that the faster the phase of a waveform varies, the higher the frequency of the
waveform, suggesting that the frequency14 can be deﬁned as the derivative of the phase with respect to
time:
ω = dφ
dt
(15.73)
▲
Example15.15
Figure 15.62(a) shows the phase of a sinusoidal waveform with constant amplitude as a function of time. Plot the
waveform in the time domain.
14The quantity ω = 2π f is called the “radian frequency” (and expressed in rad/s) to distinguish it from f (expressed in Hz).
In this book, we call both the frequency, but use ω more often to avoid the factor 2π.

646
Chap. 15
Oscillators
t
t
t
ϕ(t)
ω(t)
V0(t)
(c)
(a)
(b)
ω1
ω1
ω2
ω2
Figure 15.62
Solution
Taking the time derivative of φ(t), we obtain the behavior illustrated in Fig. 15.62(b). The frequency therefore
periodically toggles between ω1 and ω2, yielding the waveform shown in Fig. 15.62(c). (This is a simple example
of binary frequency modulation, called “frequency shift keying” and utilized in wireless pagers and many other
communication systems.)
▲
Equation (15.73) indicates that, if the frequency of a waveform is known as a function of time, then
the phase can be computed as
φ =

ωdt + φ0
(15.74)
In particular, since for a VCO, ωout = ω0 + KVCOVcont, we have
Vout(t) = Vm cos
 
ωoutdt + φ0

(15.75)
= Vm cos

ω0t + KVCO

Vcontdt + φ0

(15.76)
Equation (15.76) proves essential in the analysis of VCOs and PLLs.15 The initial phase φ0 is usually
unimportant and is assumed zero hereafter.
▲
Example15.16
The control line of a VCO senses a rectangular signal toggling between V1 and V2 at a period Tm. Plot the frequency,
phase, and output waveform as a function of time.
15Note that KVCO cannot be brought out of the integral if the characteristic is nonlinear.

Sec. 15.5
Mathematical Model of VCOs
647
Solution
Since ωout = ω0+KVCOVcont, the output frequency toggles between ω1 = ω0+KVCOV1 and ω2 = ω0+KVCOV2
(Fig. 15.63). The phase is equal to the time integral of this result, rising linearly with time at a slope of ω1 for half
the input period and ω2 for the other half. The output waveform of the VCO is similar to that shown in Fig. 15.62.
Thus, a VCO can operate as a frequency modulator.
t
t
t
V0(t)
Tm
0
ϕ(t)
ω(t)
ω1
ω2
Figure 15.63
▲
As explained in Chapter 16, if a VCO is placed in a phase-locked loop, then only the second term of
the total phase in Eq. (15.76) is of interest. This term, KVCO

Vcontdt, is called the “excess phase,” φex.
In fact, in the analysis of PLLs, we view the VCO as a system whose input and output are the control
voltage and the excess phase, respectively:
φex = KVCO

Vcontdt
(15.77)
That is, the VCO operates as an ideal integrator, providing a transfer function:

ex
Vcont
(s) = KVCO
s
(15.78)
▲
Example15.17
A VCO senses a small sinusoidal control voltage Vcont = Vm cos ωmt. Determine the output waveform and its
spectrum.
Solution
The output is expressed as
Vout(t) = V0 cos
ω0t + KVCO

Vcontdt
(15.79)
= V0 cos
ω0t + KVCO
Vm
ωm
sin ωmt
(15.80)
= V0 cos ω0t cos
KVCO
Vm
ωm
sin ωmt
(15.81)
−V0 sin ω0t sin
KVCO
Vm
ωm
sin ωmt

648
Chap. 15
Oscillators
If Vm is small enough that KVCOVm/ωm ≪1 rad, then
Vout(t) ≈V0 cos ω0t −V0(sin ω0t)(KVCO
Vm
ωm
sin ωmt)
(15.82)
= V0 cos ω0t −KVCOVmV0
2ωm
[cos(ω0 −ωm)t −cos(ω0 + ωm)t]
(15.83)
The output therefore consists of three sinusoids having frequencies of ω0, ω0 −ωm, and ω0 + ωm. The spectrum is
shown in Fig. 15.64. The components at ω0 ± ωm are called “sidebands.”
ω
ω0
ω0 – ωm
ω0 + ωm
Figure 15.64
▲
The above example reveals that variation of the control voltage with time may create unwanted
components at the output. Indeed, when a VCO operates in the steady state, the control voltage must
experience very little variation.16 This issue is studied in Chapter 16.
A common mistake in expressing the phase of signals arises from the familiar form Vm cos ω0t. Here,
the phase is equal to the product of frequency and time, creating the impression that such equality holds in
all conditions. We may even deduce that, since the output frequency of a VCO is given by ω0+KVCOVcont,
the output waveform can be written as Vm cos[(ω0 + KVCOVcont)t]. To understand why this is incorrect,
let us compute the frequency as the derivative of the phase:
ω = d
dt [(ω0 + KVCOVcont)t]
(15.84)
= KVCO
dVcont
dt
t + ω0 + KVCOVcont
(15.85)
The ﬁrst term in this expression is redundant, vanishing only if dVcont/dt = 0. Thus, in the general case,
the phase cannot be written as the product of time and frequency.
Our study of VCOs in this section has assumed sinusoidal output waveforms. In practice, depending
on the type and speed of the oscillator, the output may contain signiﬁcant harmonics, even approaching
a rectangular waveform. How should Eq. (15.76) be modiﬁed in this case? We expect that Vout(t) can be
expressed as a Fourier series:
Vout(t) = V1 cos(ω0t + φ1) + V2 cos(2ω0t + φ2) + · · ·
(15.86)
We also note that if the (fundamental) frequency of a rectagular waveform is changed by f , the frequency
of its second harmonic must change by 2f , etc. Thus, if Vcont varies by V, then the frequency
of the ﬁrst harmonic varies by KVCOV , the frequency of the second harmonic by 2KVCOV, etc.
That is
Vout(t) = V1 cos(ω0t + KVCO

Vcontdt + θ1) + V2 cos(2ω0t + 2KVCO

Vcontdt + θ2) + · · ·
(15.87)
16Except when the VCO senses a signal to perform frequency modulation.

Problems
649
where θ1, θ2, · · · are constant phases necessary for the representation of each harmonic in the Fourier
series expansion.
Equation (15.87) suggests that the harmonics of an oscillator output can be readily taken into account.
For this reason, we often limit our calculations to the ﬁrst harmonic, even though we may draw the
waveforms in rectangular shape rather than sinusoidal shape.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. Also, assume that all transistors are in saturation.
15.1.
For the circuit of Fig. 15.6, determine the open-loop tranfer function and calculate the phase margin. Assume
that gm1 = gm2 = gm and neglect other capacitances.
15.2.
In the circuit of Fig. 15.8, assume that gm1 = gm2 = gm3 = (200 )−1.
(a) What is the minimum value of RD that ensures oscillation?
(b) Determine the value of CL for an oscillation frequency of 1 GHz and a total low-frequency loop gain
of 16.
15.3.
For the circuit of Fig. 15.12, determine the minimum value of ISS that guarantees oscillation. (Hint: if the
circuit is at the edge of oscillation, the swings are quite small.)
15.4.
Prove that the small-signal resistance of the composite load in Fig. 15.18(c) is roughly equal to 1/gm3.
15.5.
Including only the gate-source capacitance of M3 in Fig. 15.18(c), explain under what condition the impedance
of the composite load (seen at the drain of M3) becomes inductive.
15.6.
If each inductor in Fig. 15.25 exhibits a series resistance of RS, how low must RS be to ensure that the
low-frequency loop gain is less than unity? (This condition is necessary to avoid latch-up.)
15.7.
Explain why the VX and VY waveforms in Fig. 15.28 are closer to sinusoids (i.e., they contain smaller
harmonics) than are the ID1 and ID2 waveforms do.
15.8.
Determine the minimum value of ISS in Fig. 15.47(c) that guarantees oscillation. Estimate the maximum
value of ISS that guarantees that M1 and M2 do not enter the triode region.
15.9.
Repeat Example 15.7 by applying a current stimulus to the drain of M1.
15.10. Prove that if a capacitor CP is placed in parallel with L P in Fig. 15.31(a), then Eq. (15.47) results.
15.11. The Colpitts oscillator of Fig. 15.31(a) was analyzed and its oscillation conditions were derived by applying
a current stimulus to the source. Repeat the analysis by applying a voltage stimulus to the gate of M1.
15.12. Repeat the analysis of the Colpitts oscillator for the topologies in Figs. 15.38(a) and (c). Determine the
oscillation condition and the frequency of oscillation.
15.13. The stage of Fig. 15.45 is designed with IT = 1 mA and (W/L)1,2 = 50/0.5. Assume that IH ≪I1.
(a) Determine the minimum value of R1 = R2 = R to ensure oscillation in a three-stage ring.
(b) Determine (W/L)3,4 such that gm3,4R = 0.5 when each of M3 and M4 carries IT /2.
(c) Calculate the minimum value of IH to guarantee oscillation.
(d) If the common-mode level of Vcont1 and Vcont2 is 1.5 V, calculate (W/L)5,6 such that IT sustains 0.5 V
when Vcont1 = Vcont2.
15.14. Repeat Example 15.14 if each inductor in the circuit contributes a constant capacitance equal to C1.
15.15. The VCO of Fig. 15.53 is designed for operation at 1 GHz.
(a) If L P = 5 nH and the total (ﬁxed) parasitic capacitance seen at X (and Y) to ground is 500 fF, determine
the maximum capacitance that D1 and D2 can add to the circuit.
(b) If the tail current is equal to 1 mA and the Q of each inductor at 1 GHz is equal to 4, estimate the output
voltage swing.

650
Chap. 15
Oscillators
References
[1] N. M. Nguyen and R. G. Meyer, “Start-up and Frequency Stability in High-Frequency Oscillators,” IEEE J. of
Solid-State Circuits, vol. 27, pp. 810–820, May 1992.
[2] I. A. Young, J. K. Greason, and K. L. Wong, “A PLL Clock Generator with 5 to 110 MHz of Lock Range for
Microprocessors,” IEEE J. of Solid-State Circuits, vol. SC-27, pp. 1599–1607, November 1992.
[3] B. Lai and R. C. Walker, “A Monolithic 622 Mb/sec Clock Extraction and Data Retiming Circuit,” ISSCC Dig.
of Tech. Papers, pp. 144–145, February 1991.
[4] S. K. Enam and A. A. Abidi, “NMOS ICs for Clock and Data Regeneration in Gigabit-per-Second Optical-Fiber
Receivers,” IEEE J. of Solid-State Circuits, vol. SC-27, pp. 1763–1774, December 1992.
[5] B. Razavi, RF Microelectronics, 2nd ed. (Upper Saddle River, NJ: Prentice-Hall, 2012).

CHAPTER
16
Phase-Locked Loops
The concept of phase locking was invented in the 1930s and swiftly found wide usage in electronics
and communication. While the basic phase-locked loop has remained nearly the same since then, its
implementation in different technologies and for different applications continues to challenge designers.
A PLL serving the task of clock generation in a microprocessor appears quite similar to a frequency
synthesizer used in a cellphone, but the actual circuits are designed quite differently.
This chapter deals with the analysis and design of PLLs, with particular attention to implementations
in VLSI technologies. A thorough study of PLLs would require an entire book by itself, but our objective
here is to lay the foundation for more advanced work. Beginning with a simple PLL architecture, we
study the phenomenon of phase locking and analyze the behavior of PLLs in the time and frequency
domains. We then address the problem of lock acquisition and describe charge-pump PLLs (CPPLLs)
and their nonidealities. Finally, we examine jitter in PLLs, study delay-locked loops (DLLs), and present
a number of PLL applications.
16.1
Simple PLL
A PLL is a feedback system that compares the output phase with the input phase. The comparison is
performed by a “phase comparator” or “phase detector” (PD). It is therefore beneﬁcial to deﬁne the PD
rigorously.
16.1.1 Phase Detector
A phase detector is a circuit whose average output, Vout, is linearly proportional to the phase difference,
φ, between its two inputs (Fig. 16.1). In the ideal case, the relationship between Vout and φ is linear,
crossing the origin for φ = 0. Called the “gain” of the PD, the slope of the line, K P D, is expressed in
V/rad.
Phase
Detector
V1(t)
V2(t)
Vout(t)
Δϕ
Vout
Figure 16.1
Deﬁnition of phase detector.
651

652
Chap. 16
Phase-Locked Loops
t
V1(t)
V1(t)
V2(t)
V2(t)
Vout(t)
Vout(t)
Δϕ
Figure 16.2
Exclusive OR gate as phase detector.
A familiar example of a phase detector is the exclusive OR (XOR) gate. As shown in Fig. 16.2, as the
phase difference between the inputs varies, so does the width of the output pulses, thereby providing a dc
level proportional to φ. While the XOR circuit produces error pulses on both rising and falling edges,
other types of PD may respond only to positive or negative transitions.
▲
Example16.1
If the output swing of the XOR in Fig. 16.2 is V0 volts, what is the gain of the circuit as a phase detector? Plot the
input-output characteristic of the PD.
Solution
If the phase difference increases from zero to φ radians, the area under each pulse increases by V0 ·φ. Since each
period contains two pulses, the average value rises by 2[V0 · φ/(2π)], yielding a gain of V0/π. Note that the gain
is independent of the input frequency.
To construct the input-output characteristic, we examine the circuit’s response to various input phase differences.
As illustrated in Fig. 16.3, the average output voltage rises to [V0/π] × π/2 = V0/2 for φ = π/2 and V0 for
t
t
t
Δϕ ≈ π
Δϕ ≈ 
Δϕ
Δϕ ≈ 0
t
2
3π
Δϕ ≈ 2
π
0
2π
π
–2π
–π
Vout
V1
V2
Vout
V1
V2
Vout
V1
V2
Vout
V1
V2
Vout
V0
Figure 16.3

Sec. 16.1
Simple PLL
653
φ = π. For φ > π, the average begins to drop, falling to V0/2 for φ = 3π/2 and zero for φ = 2π. The
characteristic is therefore periodic, exhibiting both negative and positive gains.
▲
16.1.2 Basic PLL Topology
To arrive at the concept of phase locking, let us consider the problem of aligning the output phase of a
VCO with the phase of a reference clock. (The reader is encouraged to review the VCO mathematical
model in the previous chapter.) As illustrated in Fig. 16.4(a), the rising edges of Vout are “skewed” by t
seconds with respect to VCK, and we wish to eliminate this error. Assuming that the VCO has a single
control input, Vcont, we note that to vary the phase, we must vary the frequency and allow the integration
φ =

(ω0 + KVCOVcont)dt to take place. For example, suppose that, as shown in Fig. 16.4(b), the VCO
frequency is stepped to a higher value at t = t1. The circuit then accumulates phase faster, gradually
decreasing the phase error. At t = t2, the phase error drops to zero and, if Vcont returns to its original
value, VVCO and VCK remain aligned. Interestingly, the alignment can be accomplished by stepping the
VCO frequency to a lower value for a certain time interval as well (Problem 16.2). Thus, phase alignment
can be achieved only by a (temporary) frequency change.
t
VCK
Vout
t
t1
t2
Vcont
(a)
(b)
Δt
VCK
Vout
Figure 16.4
(a) Two waveforms with a skew; (b) change of VCO frequency to eliminate the skew.
The foregoing experiment suggests that the output phase of a VCO can be aligned with the phase
of a reference if (1) the frequency of the VCO is changed momentarily, and (2) a means of comparing
the two phases, i.e., a phase detector, is used to determine when the VCO and the reference signals are
aligned. The task of aligning the output phase of the VCO with the phase of the reference is called “phase
locking.”
From the above observations, we surmise that a PLL simply consists of a PD and a VCO in a feedback
loop [Fig. 16.5(a)]. The PD compares the phases of Vout and Vin, generating an error that varies the VCO
frequency until the phases are aligned, i.e., the loop is locked. This topology, however, must be modiﬁed
PD
VCO
Vin
Vout
PD
VCO
Vin
Vout
ϕout
LPF
(a)
(b)
VPD
VPD
Vcont
ϕin
Figure 16.5
(a) Feedback loop comparing input and output phases; (b) simple PLL.

654
Chap. 16
Phase-Locked Loops
because (1) as exempliﬁed by the waveforms of Fig. 16.2, the PD output, VP D, consists of a dc component
(desirable) and high-frequency components (undesirable), and (2) as mentioned in Chapter 15, the control
voltage of the oscillator must remain quiet in the steady state, i.e., the PD output must be ﬁltered. We
therefore interpose a low-pass ﬁlter (LPF) between the PD and the VCO [Fig. 16.5(b)], suppressing the
high-frequency components of the PD output and presenting the dc level to the oscillator. This forms the
basic PLL topology. For now, we assume that the LPF has a gain of unity at low frequencies (e.g., as in
a ﬁrst-order RC section).
It is important to bear in mind that the feedback loop of Fig. 16.5(b) compares the phases of the
input and output. Unlike the feedback topologies studied in the previous chapters, PLLs typically require
no knowledge of voltages or currents in their feedback operation. If the loop gain is large enough, the
difference between the input phase, φin, and the output phase, φout, falls to a small value in the steady
state, providing phase alignment.
For subsequent analyses of PLLs, we must deﬁne the phase-lock condition carefully. If the loop of
Fig. 16.5(b) is locked, we postulate that φout −φin is constant and preferably small. We therefore deﬁne
the loop to be locked if φout −φin does not change with time. An important corollary of this deﬁnition
is that
dφout
dt
−dφin
dt
= 0
(16.1)
and hence
ωout = ωin
(16.2)
This is a unique property of PLLs and will be revisited more closely later.
In summary, when locked, a PLL produces an output that has a small phase error with respect to the
input but exactly the same frequency. The reader may then wonder why a PLL is used at all. A short piece
of wire would seem to perform the task even better! We answer this question in Sec. 16.5.
▲
Example16.2
Implement a simple PLL in CMOS technology.
Solution
Figure 16.6 illustrates an implementation utilizing an XOR gate as the phase detector. The VCO is conﬁgured as a
negative-Gm LC oscillator whose frequency is tuned by varactor diodes.
VDD
D1
D2
Vin
Vout
Figure 16.6
▲

Sec. 16.1
Simple PLL
655
PLL Waveforms in Locked Condition
In order to familiarize ourselves with the behavior of PLLs, we
begin with the simplest case: the circuit is locked and we wish to examine the waveforms at each point
around the loop. As illustrated in Fig. 16.7(a), Vin and Vout exhibit a small phase difference but equal
frequencies. The PD therefore generates pulses as wide as the skew between the input and the output,1
and the low-pass ﬁlter extracts the dc component of VP D, applying the result to the VCO. We assume
that the LPF has a gain of unity at low frequencies. The small pulses in VL P F are called “ripple.”
(a)
t
Vin
Vout
VPD
ϕ0
Vcont
Vout
ωout
Vcont
V1
ω1
Δϕ
V1
ϕ0
(b)
ω0
Ripple
Figure 16.7
(a) Waveforms in a PLL in locked condition; (b) calculation of phase error.
In the waveforms of Fig. 16.7(a), two quantities are unknown: φ0 and the dc level of Vcont. To
determine these values, we construct the VCO and PD characteristics [Fig. 16.7(b)]. If the input and
output frequencies are equal to ω1, then the required oscillator control voltage is unique and equal to V1.
This voltage must be produced by the phase detector, demanding a phase error determined by the PD
characteristic. More speciﬁcally, since ωout = ω0 + KVCOVcont and VP D = K P Dφ, we can write
V1 = ω1 −ω0
KVCO
(16.3)
and
φ0 =
V1
K P D
(16.4)
=
ω1 −ω0
K P DKVCO
(16.5)
Equation (16.5) reveals two important points: (1) as the input frequency of the PLL varies, so does the
phase error; and (2) to minimize the phase error, K P DKVCO must be maximized.
▲
Example16.3
A PLL incorporates a VCO and a PD having the characteristics shown in Fig. 16.8. Explain what happens as the
input frequency varies in the locked condition.
1In this example, the PD produces pulses only on the rising transitions.

656
Chap. 16
Phase-Locked Loops
Vout
ωout
Vcont
V0
Δϕ
V0
ωX
π
2
π
2
– 
–V0 
ω0
Figure 16.8
Solution
The PD characteristic is relatively linear near the origin but exhibits a small-signal gain of zero if the phase difference
equals ±π/2, at which point the average output is equal to ±V0. Now suppose the input frequency increases from
ω0, requiring a greater control voltage. If the frequency is high enough (= ωx) to dictate Vcont = V0, then the PD
must operate at the peak of its characteristic. However, the PD gain drops to zero here and the feedback loop fails.
Thus, the circuit cannot lock if the input frequency reaches ωX.
▲
With the basic understanding of PLLs developed thus far, we now return to Eq. (16.2). The exact
equality of the input and output frequencies of a PLL in the locked condition is a critical attribute. The
signiﬁcance of this property can be seen from two observations. First, in many applications, even a very
small (deterministic) frequency error may prove unacceptable. For example, if a data stream is to be
processed synchronously by a clocked system, even a slight difference between the data rate and the
clock frequency results in a “drift,” creating errors (Fig. 16.9). Second, the equality would not exist if the
PLL compared the input and output frequencies rather than phases. As illustrated in Fig. 16.10(a), a loop
employing a frequency detector (FD) would suffer from a ﬁnite difference between ωin and ωout due to
various mismatches and other nonidealities. This can be understood by an analogy with the unity-gain
feedback circuit of Fig. 16.10(b). Even if the op amp’s open-loop gain is inﬁnity, the input-referred offset
voltage leads to a ﬁnite error between Vin and Vout.
Small Transients in Locked Condition
Let us now analyze the response of a PLL in the locked
condition to small phase or frequency transients at the input.
t
Data
Clock
Figure 16.9
Drift of data with respect to clock in the presence of small frequency error.
VCO
Vin
Vout
LPF
FD
Vout
Vin
(a)
(b)
Figure 16.10
(a) Frequency-locked loop; (b) unity-gain feedback ampliﬁer.

Sec. 16.1
Simple PLL
657
Consider a PLL in the locked condition and assume that the input and output waveforms can be
expressed as
Vin(t) = VA cos ω1t
(16.6)
Vout(t) = VB cos(ω1t + φ0)
(16.7)
where higher harmonics are neglected and φ0 is the static phase error. Suppose, as shown in Fig. 16.11,
the input experiences a phase step of φ1 at t = t1, i.e., φin = ω1t +φ1u(t −t1).2 The phase step manifests
itself as a rising edge in Vin that occurs earlier (or later) than the periodicity would dictate. Alternatively,
we can say that the phase step results in a shorter (or longer) period just before t1. Since the output of
the LPF does not change instantaneously, the VCO initially continues to oscillate at ω1. The growing
phase difference between the input and the output then creates wide pulses at the output of the PD,
forcing VL P F to rise gradually. As a result, the VCO frequency begins to change, attempting to minimize
the phase error. Note that the loop is not locked during the transient because the phase error varies
with time.
PD
VCO
Vin
ωin
ϕin
Vout
ωout
ϕout
LPF
t
Vin
Vout
VPD
VLPF
ωout
VPD
VLPF
t1
ϕin
ω1
ϕ1
ϕout
ω1
Figure 16.11
Response of a PLL to a phase step.
What happens after the VCO frequency begins to change? If the loop is to return to lock, ωout must
eventually go back to ω1, requiring that VL P F and hence φout −φin also return to their original values.
Since φin has changed by φ1, the variation in the VCO frequency is such that the area under ωout provides
an additional phase of φ1 in φout:
 ∞
t1
ωoutdt = φ1
(16.8)
2In this example, φin and φout denote the total phases of the input and output, respectively.

658
Chap. 16
Phase-Locked Loops
Thus, when the loop settles, the output becomes equal to
Vout(t) = VB cos[ω1t + φ0 + φ1u(t −t1)]
(16.9)
Consequently, as shown in Fig. 16.11, φout gradually “catches up” with φin.
It is important to make two observations. (1) After the loop returns to lock, all of the parameters
(except for the total input and output phases) assume their original values. That is, φin −φout, VL P F,
and the VCO frequency remain unchanged—an expected result because these three parameters bear
a one-to-one relationship and the input frequency has stayed the same. (2) The control voltage of the
oscillator can serve as a suitable test point in the analysis of PLLs. While it is difﬁcult to measure the time
variations of phase and frequency in Fig. 16.11, Vcont(= VL P F) can be readily monitored in simulations
and measurements.
The reader may wonder whether an input phase step always gives rise to the response shown in
Fig. 16.11. For example, is it possible for VL P F to ring before settling to its ﬁnal value? Such behavior
is indeed possible and will be quantiﬁed in Sec. 16.1.3.
Let us now examine the response of PLLs to a small input frequency step ω at t = t1 (Fig. 16.12).
As with the case of a phase step, the VCO continues to oscillate at ω1 immediately after t1. Thus, the PD
generates increasingly wider pulses, and VL P F rises with time. As ωout approaches ω1 + ω, the width
of the pulses generated by the PD decreases, eventually settling to a value that produces a dc component
equal to (ω1 + ω −ω0)/KVCO. In contrast to the case of a phase step, the response of a PLL to a
frequency step entails a permanent change in both the control voltage and the phase error. If the input
frequency is varied slowly, ωout simply “tracks” ωin.
Vin
Vout
VPD
VLPF
ωout
ϕin
t1
ω1
ω2 = ω1 + Δω   
t
ϕout
ω1
Figure 16.12
Response of a PLL to a small frequency step.
The exact settling behavior of PLLs depends on the various loop parameters and will be studied in
Sec. 16.1.3. But, to arrive at an important observation, we consider the phase step response depicted in
Fig. 16.13, where Vcont rings before settling to its ﬁnal value. Consider the state of the loop at t = t2. At
this point, the output frequency is equal to its ﬁnal value (because Vcont is equal to its ﬁnal value), but
the loop continues the transient because the phase error deviates from the required value. Similarly, at
t = t3, the phase error is equal to its ﬁnal value, but the output frequency is not. In other words, for the
loop to settle, both the phase and the frequency must settle to their proper values.

Sec. 16.1
Simple PLL
659
t
Vin
Vout
Vcont
t1
t2
t3
Figure 16.13
Example of phase step response.
▲
Example16.4
In the PLL shown in Fig. 16.14, an external voltage Vex is added to the output of the low-pass ﬁlter.3 (a) Determine
the phase error and VL P F if the loop is locked and Vex = V1. (b) Suppose Vex steps from V1 to V2 at t = t1. How
does the loop respond?
PD
VCO
Vin
Vout
LPF
VPD
VLPF
Vex
Vcont
Vin
Vout
VLPF
t
Vex
ωout
V1
V2
t1
V1 – V2
Figure 16.14
Solution
(a) If the loop is locked, ωout = ωin and Vcont = (ωin −ω0)/KVCO. Thus, VL P F = (ωin −ω0)/KVCO −V1 and
φ = VL P F/K P D = (ωin −ω0)/(K P DKVCO) −V1/K P D.
(b) When Vex steps from V1 to V2, Vcont immediately goes from (ωin −ω0)/KVCO to (ωin −ω0)/KVCO +(V2−V1),
changing the VCO frequency to ωin −KVCO(V1 −V2). Since VL P F cannot change instantaneously, the PD begins to
3This topology is used for some types of frequency modulation in wireless communication.

660
Chap. 16
Phase-Locked Loops
generate increasingly wider pulses, raising VL P F and increasing ωout. When the loop returns to lock, ωout becomes
equal to ωin and VL P F = (ωin −ω0)/KVCO −V2. The phase error also changes to (ωin −ω0)/(K P DKVCO) −
V2/K P D. Note that the area under ωout during the transient is equal to the change in the output phase and hence the
change in the phase error:
 ∞
t1
ωoutdt = V1 −V2
K P D
(16.10)
▲
From our study thus far, we conclude that phase-locked loops are “dynamic” systems, i.e., their
response depends on the past values of the input and output. This is to be expected because the low-pass
ﬁlter and the VCO introduce poles (and possibly zeros) in the loop transfer function. Moreover, we note
that, so long as the input and the output remain perfectly periodic (i.e., φin = ωint and φout = ωint +φ0),
the loop operates in the steady state, exhibiting no transient. Thus, the PLL responds only to variations
in the excess phase of the input or output. For example, in Fig. 16.11, φin = ω1t + φ1u(t −t1), and in
Fig. 16.12, φin = ω1t + ω · tu(t −t1).
16.1.3 Dynamics of Simple PLL
With the qualitative analysis of PLLs in the previous section, we can now study their transient behavior
more rigorously. Assuming that the loop is initially locked, we treat the PLL as a feedback system but
recognize that the output quantity in this analysis must be the (excess) phase of the VCO because the “error
ampliﬁer” can only compare phases. Our objective is to determine the transfer function out(s)/in(s)
for both open-loop and closed-loop systems and subsequently study the time-domain response. Note that
the dimensions change from phase to voltage through the PD and from voltage to phase through the VCO.
What does out(s)/in(s) signify? An analogy with more familiar transfer functions proves useful
here. A circuit having a transfer function Vout(s)/Vin(s) = 1/(1 + s/ω0) is considered a low-pass ﬁlter
because if Vin varies rapidly, Vout cannot fully track the input variations. Similarly, out(s)/in(s) reveals
how the output phase tracks the input phase if the latter changes slowly or rapidly.
To visualize the variation of the excess phase with time, consider the waveforms in Fig. 16.15. The
period varies slowly in Fig. 16.15(a) and rapidly in Fig. 16.15(b). Thus, y2(t) experiences faster phase
variations than does y1(t).
t
t
y1(t)
y2(t)
(a)
(b)
Figure 16.15
Slow and fast variation of the excess phase.
Let us construct a linear model of the PLL, assuming a ﬁrst-order low-pass ﬁlter for simplicity. The
PD output contains a dc component equal to K P D(φout −φin) as well as high-frequency components.
Since the latter are suppressed by the LPF, we simply model the PD by a subtractor whose output is
“ampliﬁed” by K P D. Illustrated in Fig. 16.16, the overall PLL model consists of the phase subtractor,
the LPF transfer function 1/(1 + s/ωL P F), where ωL P F denotes the −3-dB bandwidth, and the VCO
transfer function KVCO/s (Chapter 15). Here, in and out denote the excess phases of the input and

Sec. 16.1
Simple PLL
661
LPF
KPD
s
KVCO
VCO
1
s
1 + ωLPF
PD
Φout
Φin
Figure 16.16
Linear model of type I PLL.
output waveforms, respectively. For example, if the total input phase experiences a step change, φ1u(t),
then in(s) = φ1/s.
The open-loop transfer function is given by
H(s)|open = out
in
(s)|open
(16.11)
= K P D ·
1
1 +
s
ωL P F
· KVCO
s
(16.12)
revealing one pole at s = −ωL P F and another at s = 0. Note that the loop gain is equal to H(s)|open
because of the unity feedback factor. Since the loop gain contains a pole at the origin, the system is called
“type I.”
Before computing the closed-loop transfer function, let us make an important observation. What is
the loop gain if s is very small, i.e., if the input excess phase varies very slowly? Owing to the pole at
the origin, the loop gain goes to inﬁnity as s approaches zero, a point of contrast to the feedback circuits
studied in Chapters 8 and 10. Thus, the phase-locked loop (under closed-loop, locked condition) ensures
that the change in φout is exactly equal to the change in φin as s goes to zero. This result predicts two
interesting properties of PLLs. First, if the input excess phase varies very slowly, the output excess phase
“tracks” it. (After all, φout is “locked” to φin.) Second, if the transients in φin have decayed (another case
corresponding to s →0), then the change in φout is precisely equal to the change in φin. This is indeed
true in the example depicted in Fig. 16.11.
From (16.12), we can write the closed-loop transfer function as
H(s)|closed =
K P DKVCO
s2
ωL P F
+ s + K P DKVCO
(16.13)
For the sake of brevity, we hereafter denote H(s)|closed simply by H(s) or out/in. As expected, if
s →0, H(s) →1 because of the inﬁnite loop gain.
In order to analyze H(s) further, we derive a relationship that allows a more intuitive understanding of
the system. Recall from Chapter 15 that the instantaneous frequency of a waveform is equal to the time
derivative of the phase: ω = dφ/dt. Since the frequency and the phase are related by a linear operator,
the transfer function of (16.13) applies to variations in the input and output frequencies as well:
ωout
ωin
(s) =
K P DKVCO
s2
ωL P F
+ s + K P DKVCO
(16.14)
For example, this result predicts that if ωin changes very slowly (s →0), then ωout tracks ωin, again an
expected result because the loop is assumed locked. Equation (16.14) also indicates that if ωin changes

662
Chap. 16
Phase-Locked Loops
abruptly, but the system is given enough time to settle (s →0), then the change in ωout equals that in ωin
(as illustrated in the example of Fig. 16.12).
The above observation aids the analysis in two directions. First, some transient responses of the closed-
loop system may be simpler to visualize in terms of changes in the frequency quantities rather than the
phase quantities. Second, since a change in ωout must be accompanied by a change in Vcont, we have
H(s) = KVCO · Vcont
ωin
(s)
(16.15)
That is, monitoring the response of Vcont to variations in ωin indeed yields the response of the closed-loop
system.
The second-order transfer function of (16.13) suggests that the step response of the type I system can
be overdamped, critically damped, or underdamped. To derive the condition for each case, we rewrite the
denominator in a familiar form used in control theory, s2 + 2ζωns + ω2
n, where ζ is the “damping factor”
and ωn is the “natural frequency.” That is
H(s) =
ω2
n
s2 + 2ζωns + ω2n
(16.16)
where
ωn =

ωL P F K P DKVCO
(16.17)
ζ = 1
2

ωL P F
K P DKVCO
(16.18)
The two poles of the closed-loop system are given by
s1,2 = −ζωn ±

(ζ 2 −1)ω2n
(16.19)
= (−ζ ±

ζ 2 −1)ωn
(16.20)
Thus, if ζ > 1, both poles are real, the system is overdamped, and the transient response contains two
exponentials with time constants 1/s1 and 1/s2. On the other hand, if ζ < 1, the poles are complex and
the response to an input frequency step ωin = ωu(t) is equal to
ωout(t) =

1 −e−ζωnt[cos(ωn

1 −ζ 2t) +
ζ

1 −ζ 2 sin(ωn

1 −ζ 2t)]

ωu(t)
(16.21)
= [1 −
1

1 −ζ 2 e−ζωnt sin(ωn

1 −ζ 2t + θ)]ωu(t)
(16.22)
where ωout denotes the change in the output frequency and θ = sin−1 
1 −ζ 2. Thus, as shown in
Fig. 16.17, the step response contains a sinusoidal component with a frequency ωn

1 −ζ 2 that decays
with a time constant (ζωn)−1. Note that the system exhibits the same response if a phase step is applied
to the input and the output phase is observed.
The settling speed of PLLs is of great concern in most applications. Equation (16.22) indicates that
the exponential decay determines how fast the output approaches its ﬁnal value, implying that ζωn must
be maximized. For the type I PLL under study here, (16.17) and (16.18) yield
ζωn = 1
2ωL P F
(16.23)

Sec. 16.1
Simple PLL
663
t
e−ζωnt
ωin
ωout
Figure 16.17
Underdamped response
of PLL to a frequency step.
This result reveals a critical trade-off between the settling speed and the ripple on the VCO control line:
the lower the ωL P F, the greater the suppression of the high-frequency components produced by the PD,
but the longer the settling time constant.
▲
Example16.5
A cellular telephone incorporates a 900-MHz phase-locked loop to generate the carrier frequencies. If ωL P F =
2π × (20 kHz) and the output frequency is to be changed from 901 MHz to 901.2 MHz, how long does the PLL
output frequency take to settle within 100 Hz of its ﬁnal value?
Solution
Since the step size is 200 kHz, we have
[1 −e−ζωnts sin(ωn

1 −ζ 2ts + θ)] × 200 kHz = 200 kHz −100 Hz
(16.24)
Thus,
e−ζωnts sin(ωn

1 −ζ 2ts + θ) = 100 Hz
200 kHz
(16.25)
In the worst case, the sinusoid is equal to unity and
e−ζωnts = 0.0005
(16.26)
That is
ts = 7.6
ζωn
(16.27)
=
15.2
ωL P F
(16.28)
= 0.12 ms
(16.29)
▲
In addition to the product ζωn, the value of ζ itself is also important. Illustrated in Fig. 16.18 for
several values of ζ and a constant ωn, the step response exhibits severe ringing for ζ < 0.5. In view of
process and temperature variation of the loop parameters, ζ is usually chosen to be greater than
√
2/2 or
even 1 to avoid excessive ringing.4
4A low ζ may also produce peaking in the transfer function. Thus, some applications require a ζ of 5 to 10 to avoid this effect.

664
Chap. 16
Phase-Locked Loops
ζ = 0.2
ζ = 0.5
ζ =  
2
2
t
Figure 16.18
Underdamped response of a second-order system for various values of ζ.
The choice of ζ entails other trade-offs as well. First, (16.18) implies that as ωL P F is reduced to
minimize the ripple on the control voltage, the stability degrades. Second, (16.5) and (16.18) indicate that
both the phase error and ζ are inversely proportional to K P DKVCO; lowering the phase error inevitably
makes the system less stable. In summary, the type I PLL suffers from trade-offs among the settling speed,
the ripple on the control voltage (i.e., the quality of the output signal), the phase error, and the stability.
The stability behavior of PLLs can also be analyzed graphically, providing more insight. Recall from
Chapter 10 that the Bode plots of the magnitude and phase of the loop gain readily yield the phase margin.
Let us utilize (16.12) to construct such plots. As shown in Fig. 16.19, the loop gain begins from inﬁnity
at ω = 0 and falls at a rate of 20 dB/dec for ω < ωL P F and at a rate of 40 dB/dec thereafter. The phase
begins at −90◦and asymptotically reaches −180◦.
ω (log scale)
Hopen
20log
0
ω (log scale)
0
–180°
–20 dB/dec
–40 dB/dec
Hopen
–90°
–135°
ωLPF
Figure 16.19
Bode plots of type I PLL.
What happens if a higher K P DKVCO is chosen so as to minimize φout −φin? Since the entire gain
plot in Fig. 16.19 is shifted up, the gain crossover moves to the right, thus degrading the phase margin.
This is consistent with the dependence of ζ upon K P DKVCO.
As observed thus far, K P DKVCO affects many important parameters of PLLs. This quantity is
sometimes called the loop gain (even though it is not dimensionless) because of the resemblance of
φ = (ωout −ω0)/(K P DKVCO) to the error equation in a feedback system.
The stability behavior of type I PLLs can also be analyzed by the locus of their poles in the complex
plane as the parameter K P DKVCO varies (Fig. 16.20). With K P DKVCO = 0, the loop is open, ζ = ∞, and
the two poles are given by s1 = −ωL P F and s2 = 0. As K P DKVCO increases (i.e., the feedback becomes

Sec. 16.1
Simple PLL
665
φ
σ
jω
ωLPF
2
–ωLPF
Figure 16.20
RootlocusoftypeIPLL.
stronger), ζ drops and the two poles, given by s1,2 = (−ζ ±

ζ 2 −1)ωn, move toward each other on
the real axis. For ζ = 1 (i.e., K P DKVCO = ωL P F/4), s1 = s2 = −ζωn = −ωL P F/2. As K P DKVCO
increases further, the two poles become complex, with a real part equal to −ζωn = −ωL P F/2, moving
in parallel with the jω axis.
We recognize from Fig. 16.20 that, as s1 and s2 move away from the real axis, the system becomes
less stable. In fact, the reader can prove that cos ψ = ζ (Problem 16.8), concluding that as ψ approaches
90◦, ζ drops to zero.
Another transfer function that reveals the settling behavior of PLLs is that of the error at the output
of the phase subtractor in Fig. 16.16. Deﬁned as He(s) = (φin −φout)/φin, this transfer function can be
obtained by noting that φout/φin = H(s) and, from (16.13),
He(s) = 1 −H(s)
(16.30)
=
s2 + 2ζωns
s2 + 2ζωns + ωn
(16.31)
As expected, He(s) →0 if s →0 because the output tracks the input when the input varies very slowly
or the transient has settled.
▲
Example16.6
Suppose a type I PLL experiences a frequency step ω at t = 0. Calculate the change in the phase error.
Solution
The Laplace transform of the frequency step equals ω/s. Since He(s) relates the phase error to the input phase,
we write in(s) = (ω/s)/s = ω/s2. Thus, the Laplace transform of the phase error is
e(s) = He(s) · ω
s2
(16.32)
=
s2 + 2ζωns
s2 + 2ζωns + ω2n
· ω
s2
(16.33)
From the ﬁnal value theorem,
φe(t = ∞) = lim
s→0 se(s)
(16.34)
= 2ζ
ωn
ω
(16.35)
=
ω
K P DKVCO
(16.36)
which agrees with (16.5).
▲

666
Chap. 16
Phase-Locked Loops
16.2
Charge-Pump PLLs
While type I PLLs have been realized widely in discrete form, their shortcomings often prohibit usage in
high-performance integrated circuits. In addition to the trade-offs among ζ, ωL P F, and the phase error,
type I PLLs suffer from another critical drawback: limited acquisition range.
16.2.1 Problem of Lock Acquisition
Suppose that when a PLL circuit is turned on, its oscillator operates at a frequency far from the input
frequency, i.e., the loop is not locked. Under what conditions does the loop “acquire” lock? The transition
of the loop from an unlocked to a locked condition is a very nonlinear phenomenon because the phase
detector senses unequal frequencies. The problem of lock acquisition in type I PLLs has been studied
extensively [1, 2], but we state without proof that the “acquisition range”5 is on the order of ωL P F; that
is, the loop locks only if the difference between ωin and ωout is less than roughly ωL P F.6
The problem of lock acquisition further tightens the trade-offs in type I PLLs. If ωL P F is reduced to
suppress the ripple on the control voltage, the acquisition range decreases. Note that even if the input
frequency has a precisely-controlled value, a wide acquisition range is often necessary because the VCO
center frequency may vary considerably with process and temperature. In most of today’s applications,
the acquisition range of the simple PLL studied thus far proves inadequate.
PD
VCO
LPF1
LPF2
FD
ωout
Vin
ωin
Vout
VLPF2
Phase Feedback
Frequency Feedback
Figure 16.21
Addition of frequency
detection to increase the acquisition
range.
In order to remedy the acquisition problem, modern PLLs incorporate frequency detection in addition
to phase detection. Called “aided acquisition” and illustrated in Fig. 16.21, the idea is to compare ωin and
ωout by means of a frequency detector, generate a dc component VL P F2 proportional to ωin −ωout, and
apply the result to the VCO in a negative-feedback loop. At the beginning, the FD drives ωout toward ωin
while the PD output remains “quiet.” When |ωout −ωin| is sufﬁciently small, the phase-locked loop takes
over, acquiring lock. Such a scheme increases the acquisition range to the tuning range of the VCO.7
5Acquisition range, tracking range, lock range, capture range, and pull-in range are often used to describe the behavior of PLLs
in the presence of input or VCO frequency variation. For our purposes, the acquisition range, the capture range, and the pull-in
range are the same. The tracking range refers to the input frequency range across which a locked PLL can track the input. With the
addition of frequency detection, the acquisition range becomes equal to the tracking range (for periodic signals).
6This is a very rough estimate. In practice, the acquisition range may be several times narrower or wider. It is also assumed that
the tuning range of the VCO is large enough not to limit the acquisition range.
7This may not be true if the input is not periodic.

Sec. 16.2
Charge-Pump PLLs
667
16.2.2 Phase/Frequency Detector
For periodic signals, it is possible to merge the two loops of Fig. 16.21 by devising a circuit that can
detect both phase and frequency differences. Called a phase/frequency detector (PFD) and illustrated
conceptually in Fig. 16.22, the circuit employs sequential logic to create three states and respond to the
rising (or falling) edges of the two inputs. If initially Q A = Q B = 0, then a rising transition on A leads to
Q A = 1, Q B = 0. The circuit remains in this state until B goes high, at which point Q A returns to zero.
In other words, if a rising edge on A is followed by a rising edge on B, then Q A goes high and returns to
low. The behavior is similar for the B input.
A
B
QA
QB
A
B
QA
QB
t
t
PFD
A
B
QA
QB
(a)
(b)
ϕA ≠ ϕB 
ωA ≠ ωB 
Figure 16.22
Conceptual operation of a PFD.
In Fig. 16.22(a), the two inputs have equal frequencies, but A leads B. The output Q A continues to
produce pulses whose width is proportional to φA −φB while Q B remains at zero. In Fig. 16.22(b), A
has a higher frequency than B, and Q A generates pulses while Q B does not. By symmetry, if A lags B
or has a lower frequency than B, then Q B produces pulses and Q A remains quiet. Thus, the dc contents
of Q A and Q B provide information about φA −φB or ωA −ωB. The outputs Q A and Q B are called the
“UP” and “DOWN” pulses, respectively.
▲
Example16.7
Explain whether a master-slave D ﬂipﬂop can operate as a phase detector or a frequency detector. Assume that the
ﬂipﬂop provides differential outputs.
Solution
As shown in Fig. 16.23(a), we ﬁrst apply inputs having equal frequencies and a ﬁnite phase difference, assuming
that the output changes on the rising edge of the clock input. If A leads B, then Vout remains at a logical ONE
indeﬁnitely because the ﬂipﬂop continues to sample the high levels of A. Conversely, if A lags B, then Vout remains
low. Plotted in Fig. 16.23(b), the input-output characteristic of the circuit displays a very high gain at φ =
0, ±π, · · · and a zero gain at other values of φ. The D ﬂipﬂop is sometimes called a “bang-bang” phase detector to
emphasize that the average value of Vout jumps from −V1 to +V1 as φ varies from slightly below zero to slightly
above zero.
Now let us assume unequal frequencies for A and B. If the ﬂipﬂop is to behave as a frequency detector, then
the average value of Vout must exhibit different polarities for ωA > ωB and ωA < ωB. However, as illustrated in
Fig. 16.23(c), the average value is zero in both cases.

668
Chap. 16
Phase-Locked Loops
t
A
B
Vout
(a)
(b)
D
CK
Q
Q
A
B
Vout
t
A
B
Vout
+V1
–V1
A
B
Vout
A
B
Vout
t
(c)
Δϕ
0
–π
π
+V1
–V1
Time Average
of Vout
Figure 16.23
(a) D ﬂipﬂop as a phase detector; (b) input-output characteristic; (c) response of D ﬂipﬂop to
unequal input frequencies.
▲
The circuit of Fig. 16.22 can be realized in various forms. Figure 16.24(a) shows a simple implemen-
tation consisting of two edge-triggered, resettable D ﬂipﬂops with their D inputs tied to a logical ONE.
D
CK
QA
Q
D
CK
Q
QB
A
B
QA
QB
t
CK
Reset
Reset
Q
(a)
(b)
VDD
VDD
Latch 1
Latch 2
A
B
Figure 16.24
(a) Implementation of PFD; (b) implementation of D ﬂipﬂop.

Sec. 16.2
Charge-Pump PLLs
669
The inputs of interest, A and B, serve as the clocks of the ﬂipﬂops. If Q A = Q B = 0 and A goes high,
Q A rises. If this event is followed by a rising transition on B, Q B goes high and the AND gate resets both
ﬂipﬂops. In other words, Q A and Q B are simultaneously high for a short time, but the difference between
their average values still represents the input phase or frequency difference correctly. Each ﬂipﬂop can
be implemented as shown in Fig. 16.24(b), where two RS latches are cross-coupled. Latch 1 and Latch 2
respond to the rising edges of CK and Reset, respectively.
▲
Example16.8
Determine the width of the narrow reset pulses that appear in the QB waveform in Fig. 16.24(a).
Solution
Figure 16.25(a) illustrates the overall PFD at the gate level. If the circuit begins with A = 1, Q A = 1, and QB = 0,
a rising edge on B forces QB to go low and, one gate delay later, QB to go high. As shown in Fig. 16.25(b), this
transition propagates to Reset, E and F, E and F, and ﬁnally to Q A and QB. Thus, the width of the pulse on QB is
approximately equal to 5 gate delays.8
Reset
A
B
QA
QB
QA
QB
E
E
F
F
(a)
B
QB
QB
Reset
F
F
(b)
Figure 16.25
▲
It is instructive to plot the input-output characteristic of the above PFD. Deﬁning the output as the
difference between the average values of Q A and Q B when ωA = ωB and neglecting the effect of the
narrow reset pulses, we note that the output varies symmetrically as |φ| begins from zero (Fig. 16.26).
For φ = ±360◦, Vout reaches its extrema and subsequently changes sign. The slope of the characteristic
can be viewed as the gain.
How is the PFD of Fig. 16.24(a) utilized in a phase-locked loop? Since the difference between the
average values of Q A and Q B is of interest, the two outputs can be low-pass ﬁltered and sensed differ-
entially (Fig. 16.27). A PLL employing such a topology always locks, but, due to the ﬁnite “loop gain,”
K PFDKVCO, it suffers from a ﬁnite phase error.
16.2.3 Charge Pump
In order to avoid the ﬁnite phase error present in type I PLLs, we wish to raise the loop gain to inﬁnity,
perhaps by means of an integrator. As our ﬁrst step, we interpose a “charge pump” (CP) between the PFD
8This is a rough approximation because the NAND gate, the inverter, and the NOR gates have different delays and fanouts.

670
Chap. 16
Phase-Locked Loops
Δϕ
Vout
+ 360°
–360°
Figure 16.26
Input-output characteristic of the three-state PFD.
D
A
B
CK
Q
D
CK
Q
Reset
Vout
Figure 16.27
PFD followed by low-pass ﬁlters.
A
B
QA
QB
D
A
B
CK
QA
Q
D
CK
Q
QB
Reset
VDD
S1
S2
I2
I1
CP
Vout
Vout
t
Figure 16.28
PFD with charge pump.
and the loop ﬁlter. A charge pump consists of two switched current sources that pump charge into or out
of the loop ﬁlter according to two logical inputs. Figure 16.28 illustrates a charge pump driven by a PFD
and driving a capacitor. The circuit has three states. If Q A = Q B = 0, then S1 and S2 are off and Vout
remains constant. If Q A is high and Q B is low, then I1 charges CP. Conversely, if Q A is low and Q B is
high, then I2 discharges CP. Thus, if, for example, A leads B, then Q A continues to produce pulses and
Vout rises steadily. Called UP and DOWN currents, respectively, I1 and I2 are nominally equal.

Sec. 16.2
Charge-Pump PLLs
671
▲
Example16.9
What is the effect of the narrow pulses that appear in the QB waveform in Fig. 16.28?
Solution
Since Q A and QB are simultaneously high for a ﬁnite period (approximately 5 gate delays from Example 16.8),
the current supplied by the charge pump to CP is affected. In fact, if I1 = I2, the current through S1 simply ﬂows
through S2 during the narrow reset pulse, leaving no current to charge CP. As shown in Fig. 16.29, Vout remains
constant after QB goes high.
t
A
B
QA
Vout
QB
Figure 16.29
▲
The PFD/CP/LPF cascade shown in Fig. 16.28 has an interesting property. If A, say, leads B by a ﬁnite
amount, Q A produces pulses indeﬁnitely, allowing the charge pump to inject I1 into CP and forcing Vout
to rise steadily. In other words, for a ﬁnite input error, the output eventually goes to +∞or −∞, i.e., the
“gain” of the circuit is inﬁnity. In this cascade, the PFD converts the input phase error to a pulse width
on Q A or Q B, the charge pump translates this pulse width to charge, and the capacitor accumulates this
charge.
16.2.4 Basic Charge-Pump PLL
Let us now construct a PLL using the circuit of Fig. 16.28. Shown in Fig. 16.30 and called a charge-pump
PLL, such an implementation senses the transitions at the input and output, detects phase or frequency
differences, and activates the charge pump accordingly. When the loop is turned on, ωout may be far from
ωin, and the PFD and the charge pump adjust the control voltage such that ωout approaches ωin. When the
input and output frequencies are sufﬁciently close, the PFD operates as a phase detector, performing phase
lock. The loop locks when the phase difference drops to zero and the charge pump remains relatively
idle.
As observed above, the gain of the PFD/CP/LPF combination is inﬁnite, i.e., a nonzero (deterministic)
difference between φin and φout leads to indeﬁnite charge buildup on CP. What is the consequence of
this attribute in a charge-pump PLL? When the loop of Fig. 16.30 is locked, Vcont is ﬁnite. Therefore, the
input phase error must be exactly zero.9 This is in contrast to the behavior of the type I PLL, in which
the phase error is ﬁnite and a function of the output frequency.
9As explained in Sec. 16.3.1, mismatches still yield a ﬁnite phase error.

672
Chap. 16
Phase-Locked Loops
VCO
D
CK
QA
Q
D
CK
Q
QB
Reset
VDD
S1
S2
I2
I1
CP
Vin
ϕin
ωin
Vout
ϕout
ωout
Vcont
Figure 16.30
Simple charge-pump PLL.
To gain more insight into the operation of the PLL shown in Fig. 16.30, let us ignore the narrow
reset pulses on Q A and Q B and assume that after φout −φin drops to zero, the PFD simply produces
Q A = Q B = 0. The charge pump thus remains idle, and CP sustains a constant control voltage. Does this
mean that the PFD and the CP are no longer needed?! If Vcont remains constant for a long time, the VCO
frequency and phase begin to drift. In particular, the noise sources in the VCO create random variations
in the oscillation frequency that can result in a large accumulation of phase error. The PFD then detects
the phase difference, producing a corrective pulse on Q A or Q B that adjusts the VCO frequency through
the charge pump and the ﬁlter. This is why we stated earlier that the PLL responds only to the excess
phase of waveforms. We also note that, since in Fig. 16.30 phase comparison is performed in every cycle,
the VCO phase and frequency cannot drift substantially.
Dynamics of CPPLL
In order to quantify the behavior of charge-pump PLLs, we develop a linear model
for the combination of the PFD, the charge pump, and the low-pass ﬁlter, thereby obtaining the transfer
function. We raise two questions: (1) Is the PFD/CP/LPF combination in Fig. 16.28 a linear system? (2) If
so, how can its transfer function be computed?
To answer the ﬁrst question, we test the system for linearity. For example, as illustrated in Fig. 16.31(a),
we double the input phase difference and see if Vout exactly doubles. Interestingly, the ﬂat sections of Vout
double, but not the ramp sections. After all, the current charging or discharging CP is constant, yielding a
constant slope for the ramp—an effect similar to slewing in op amps. Thus, the system is not linear in the
strict sense. To overcome this quandary, we approximate the output waveform by a ramp [Fig. 16.31(b)],
arriving at a linear relationship between Vout and φ. In a sense, we approximate a discrete-time system
by a continuous-time model.
To answer the second question, we recall that the transfer function is the Laplace transform of the
impulse response, requiring that we apply a phase difference impulse and compute Vout in the time
domain. Since a phase difference impulse is difﬁcult to visualize, we apply a phase difference step, obtain
Vout, and differentiate the result with respect to time.
Let us assume that the input period is Tin and the charge pump provides a current of ±IP to the
capacitor. As shown in Fig. 16.32, we begin with a zero phase difference and, at t = 0, step the phase
of B by φ0, i.e., φ = φ0u(t). As a result, Q A or Q B continues to produce pulses that are φ0Tin/(2π)
seconds wide, raising the output voltage by (IP/CP)φ0Tin/(2π) in every period.10 Approximated by a
ramp, Vout thus exhibits a slope of (IP/CP)φ0/(2π) and can be expressed as
Vout(t) =
IP
2πCP
t · φ0u(t)
(16.37)
10We neglect the effect of the narrow reset pulses that appear in the other output.

Sec. 16.2
Charge-Pump PLLs
673
t
t
A
B
Vout
A
B
Vout
t
Vout
(a)
(b)
Δϕ
2Δϕ
Figure 16.31
(a) Test of linearity of PFD/CP/LPF combination; (b) ramp approximation of the response.
t
A
B
QA
Vout
IP
2πCP
 ϕ0
ϕ0
0
Tin
Figure 16.32
Step response of PFD/CP/LPF combination.
The impulse response is therefore given by
h(t) =
IP
2πCP
u(t)
(16.38)
yielding the transfer function
Vout
φ (s) =
IP
2πCP
· 1
s
(16.39)
Consequently, the PFD/CP/LPF combination contains a pole at the origin, a point of contrast to the
PD/LPF circuit used in the type I PLL. In analogy with the expression KVCO/s, we call IP/(2πCP) the
“gain” of the PFD and denote it by K PFD.

674
Chap. 16
Phase-Locked Loops
▲
Example16.10
Suppose the output quantity of interest in the circuit of Fig. 16.28 is the current injected by the charge pump into the
capacitor. Determine the transfer function from φ to this current, Iout.
Solution
Since Vout(s) = Iout/(CPs), we have
Iout
φ (s) = IP
2π
(16.40)
▲
Let us now construct a linear model of charge-pump PLLs. Shown in Fig. 16.33, the model gives an
open-loop transfer function
out
in
(s)|open =
IP
2πCP
KVCO
s2
(16.41)
Since the loop gain has two poles at the origin, this topology is called a “type II” PLL. The closed-loop
transfer function, denoted by H(s) for the sake of brevity, is thus equal to
H(s) =
IP KVCO
2πCP
s2 + IP KVCO
2πCP
(16.42)
This result is alarming because the closed-loop system contains two imaginary poles at s1,2 =
± j√IP KVCO/(2πCP) and is therefore unstable. The instability arises because the loop gain has only
two poles at the origin (i.e., two ideal integrators). As shown in Fig. 16.34(a), each integrator contributes
a constant phase shift of 90◦, allowing the system to oscillate at the gain crossover frequency.
ϕin
s
KVCO
VCO
ϕout
PFD/CP/LPF
IP
2πCP s
1
Figure 16.33
Linear model of simple charge-pump PLL.
In order to stabilize the system, we must modify the phase characteristic such that the phase shift is
less than 180◦at the gain crossover. As shown in Fig. 16.34(b), this is accomplished by introducing a zero
in the loop gain, i.e., by adding a resistor in series with the loop ﬁlter capacitor (Fig. 16.35). Using the
result of Example 16.10, the reader can prove (Problem 16.11) that the PFD/CP/LPF now has a transfer
function
Vout
φ (s) = IP
2π
	
RP +
1
CPs

(16.43)
It follows that the PLL open-loop transfer function is equal to
out
in
(s)|open = IP
2π
	
RP +
1
CPs

 KVCO
s
(16.44)

Sec. 16.2
Charge-Pump PLLs
675
Hopen
20log
log ω
0
log ω
0
–180°
–40 dB/dec
Hopen
Hopen
20log
log ω
0
log ω
0
–180°
Hopen
–90°
–135°
–40 dB/dec
–20 dB/dec
(a)
(b)
Figure 16.34
(a) Loop gain characteristics of simple charge-pump PLL; (b) addition of zero.
VCO
Vout
D
CK
QA
Q
D
CK
Q
QB
Reset
VDD
S1
S2
I2
I1
CP
Vin
RP
Figure 16.35
Addition of zero to charge-pump PLL.
and hence
H(s) =
IP KVCO
2πCP
(RPCPs + 1)
s2 + IP
2π KVCO RPs +
IP
2πCP
KVCO
(16.45)
The closed-loop system contains a zero at sz = −1/(RPCP). Using the same notation as that for the
type I PLL, we have
ωn =

IP KVCO
2πCP
(16.46)
ζ = RP
2

IPCP KVCO
2π
(16.47)
As expected, if RP = 0, then ζ = 0. With complex poles, the decay time constant is given by 1/(ζωn) =
4π/(RP IP KVCO).

676
Chap. 16
Phase-Locked Loops
Stability Issues
The stability behavior of type II PLLs is quite different from that of type I PLLs. We
begin the analysis with the Bode plots of the loop gain (the loop transmission) [Eq. (16.44)]. Shown in
Fig. 16.36, these plots suggest that if IP KVCO decreases, the gain crossover frequency moves toward the
origin, degrading the phase margin. Predicted by (16.47), this trend is in sharp contrast to that expressed
by (16.18) and illustrated in Fig. 16.19.
Hopen
20log
log ω
0
log ω
0
Hopen
–90°
–180°
Lower IP KVCO 
ω1
Figure 16.36
Stability degradation of
charge-pumpPLLas IP KVCO decreases.
It is also possible to construct the root locus of the closed-loop system in the complex plane. For
IP KVCO = 0 (e.g., IP = 0), the loop is open and both poles lie at the origin. For IP KVCO > 0, we
have s1,2 = −ζωn ± ωn

ζ 2 −1, and, since ζ ∝√IP KVCO, the poles are complex if IP KVCO is small.
The reader can prove (Problem 16.14) that as IP KVCO increases, s1 and s2 move on a circle centered
at σ = −1/(RPCP) with a radius 1/(RPCP) (Fig. 16.37). The poles return to the real axis at ζ = 1,
assuming a value of −2/(RPCP). For ζ > 1, the poles remain real, one approaching −1/(RPCP) and
the other going to −∞as IP KVCO →+∞. Since for complex s1 and s2, ζ = cos ψ, we observe that as
IP KVCO exceeds zero, the system becomes more stable.
φ
σ
jω
RPCP
1
– 
RPCP
2
– 
Figure 16.37
Root locus of type II PLL.
▲
Example16.11
A student considers the Bode plots in Fig. 16.36 and observes that at ω1, the loop gain exceeds unity and the phase
shift is −180◦. The student then reasons that the PLL must oscillate at this frequency! Explain the ﬂaw in this
reasoning.
Solution
The phase shift is in fact slightly less than zero unless ω1 = 0. As explained using Nyquist’s approach in Chapter 10,
a system containing two integrators and one zero does not oscillate.
▲

Sec. 16.3
Nonideal Effects in PLLs
677
The compensated type II PLL of Fig. 16.35 suffers from a critical drawback. Since the charge pump
drives the series combination of RP and CP, each time a current is injected into the loop ﬁlter, the control
voltage experiences a large jump. Even in the locked condition, the mismatches between I1 and I2 and
the charge injection and clock feedthrough of S1 and S2 introduce voltage jumps in Vcont. The resulting
ripple severely disturbs the VCO, corrupting the output phase. To relax this issue, a second capacitor is
usually added in parallel with RP and CP (Fig. 16.38), suppressing the initial step. The loop ﬁlter now
is of second order, yielding a third-order PLL and creating stability difﬁculties [4]. Nonetheless, if C2
is about one-ﬁfth to one-tenth of CP, the closed-loop time and frequency responses remain relatively
unchanged.
VCO
Vout
D
CK
QA
Q
D
CK
Q QB
Reset
VDD
S1
S2
I2
I1
CP
Vin
RP
C2
Figure 16.38
Addition of C2 to reduce ripple on the control line.
Equation (16.47) implies that the loop becomes more stable as RP increases. In reality, as RP becomes
very large, the stability degrades again. This effect is not predicted by the foregoing derivations because
we have approximated the discrete-time system by a continuous-time loop. A more accurate analysis is
given in [2], but simulations are often necessary to determine the stability bounds of CPPLLs.
16.3
Nonideal Effects in PLLs
16.3.1 PFD/CP Nonidealities
Several imperfections in the PFD/CP circuit lead to high ripple on the control voltage even when the loop
is locked. As mentioned earlier, the ripple modulates the VCO frequency, producing a waveform that is
no longer periodic. In this section, we study these nonidealities.
The PFD implementation of Fig. 16.24(a) generates narrow, coincident pulses on both Q A and Q B
even when the input phase difference is zero. As illustrated in Fig. 16.39, if A and B rise simultaneously,
so do Q A and Q B, thereby activating the reset. That is, even when the PLL is locked, Q A and Q B
simultaneously turn on the charge pump for a ﬁnite period TP ≈5TD, where TD denotes the gate delay
(Example 16.8).
What are the consequences of the reset pulses on Q A and Q B? To understand why these pulses are
desirable, we consider a hypothetical PFD that produces no pulses for a zero input phase difference
[Fig. 16.40(a)]. How does such a PFD respond to a small phase error? As shown in Fig. 16.40(b), the
circuit generates very narrow pulses on Q A or Q B. However, owing to the ﬁnite rise time and fall time
resulting from the capacitance seen at these nodes, the pulse may not ﬁnd enough time to reach a logical
high level fail to turn on the charge pump switches. In other words, if the input phase difference, φ,
falls below a certain value φ0, then the output voltage of the PFD/CP/LPF combination is no longer a

678
Chap. 16
Phase-Locked Loops
A
B
QA
QB
t
TP
Figure 16.39
Coincidentpulsesgener-
ated by PFD with zero phase difference.
A
B
QA
QB
t
A
B
QA
QB
t
(a)
(b)
Figure 16.40
Output waveforms of a hypothetical PD with (a) zero input phase difference, and (b) a small input
phase difference.
function of φ. Since, as depicted in Fig. 16.41, for |φ| < φ0 the charge pump injects no current,
Eq. (16.41) implies that the loop gain drops to zero and the output phase is not locked. We say that the
PFD/CP circuit suffers from a dead zone equal to ±φ0 around φ = 0.
Δϕ
Charge Pump
Current
–ϕ0 
ϕ0 
+IP
–IP
Figure 16.41
Dead zone in the charge-
pump current.
The dead zone is highly undesirable because it allows the VCO to accumulate as much random
phase error as φ0 with respect to the input while receiving no corrective feedback. Thus, as illustrated
in Fig. 16.42, the zero crossing points of the VCO output experience substantial random variations, an
effect called “jitter.”
Interestingly, the coincident pulses on Q A and Q B can eliminate the dead zone. This is because, for
φ = 0, the pulses always turn on the charge pump if they are sufﬁciently wide. Consequently, as shown
in Fig. 16.43, an inﬁnitesimal increment in the phase difference results in a proportional increase in the
net current produced by the charge pump. In other words, the dead zone vanishes if TP is long enough to
allow Q A and Q B to reach a valid logical level and turn on the switches in the charge pump.

Sec. 16.3
Nonideal Effects in PLLs
679
VCO Output
t
Input
Figure 16.42
Jitter resulting from the dead zone.
QA
QB
TP
QA
QB
t
Δϕ = 0
Δϕ ≠ 0
t
Figure 16.43
Response of actual PD to a small input phase difference.
While eliminating the dead zone, the reset pulses on Q A and Q B introduce other difﬁculties. Let us
ﬁrst implement the charge pump using MOS transistors [Fig. 16.44(a)]. Here, M1 and M2 operate as
current sources and M3 and M4 as switches. The output Q A is inverted so that when it goes high, M4
turns on.
The ﬁrst issue in the circuit of Fig. 16.44(a) stems from the delay difference between Q A and Q B in
turning on their respective switches. As shown in Fig. 16.44(b), the net current injected by the charge
pump into the loop ﬁlter jumps to +IP and −IP, disturbing the oscillator control voltage periodically
even if the loop is locked. To suppress this effect, a complementary pass gate can be interposed between
Q B and the gate of M3, equalizing the delays [Fig. 16.44(c)].
The second issue in the CP of Fig. 16.44(c) relates to the mismatch between the drain currents of M1
and M2. As depicted in Fig. 16.45(a), even with perfect alignment of the UP and DOWN pulses, the net
current produced by the charge pump is nonzero, changing Vcont by a constant increment at each phase
comparison instant. How does the PLL respond to this error? For the loop to remain locked, the average
value of the control voltage must remain constant. The PLL therefore creates a phase error between the
input and the output such that the net current injected by the CP in every cycle is zero [Fig. 16.45(b)].
The relationship between the current mismatch and the phase error is determined in Problem 16.12. It
is important to note that (1) the control voltage still experiences a periodic ripple; (2) owing to the low
output impedance of short-channel MOSFETs, the current mismatch varies with the output voltage (i.e.,
with the VCO frequency); and (3) the clock feedthrough and charge injection mismatch between M3 and
M4 further increase both the phase error and the ripple.
The third issue in the circuit of Fig. 16.44(c) originates from the ﬁnite capacitance seen at the drains of
the current sources. Suppose, as illustrated in Fig. 16.46(a), S1 and S2 are off, allowing M1 to discharge
X to ground and M2 to charge Y to VDD. At the next phase comparison instant, both S1 and S2 turn on,
VX rises, VY falls, and VX ≈VY ≈Vcont if the voltage drop across S1 and S2 is neglected [Fig. 16.46(b)].
If the phase error is zero and ID1 = |ID2|, does Vcont remain constant after the switches turn on? Even if
CX = CY, the change in VX is not equal to that in VY. For example, if Vcont is relatively high, VX changes
by a large amount and VY by a small amount. The difference between the two changes must therefore be
supplied by CP, leading to a jump in Vcont.

680
Chap. 16
Phase-Locked Loops
Vcont
QA
QB
C
Vb2
Vb1
VDD
PFD
QA
A
B
QB
QA
QA
M1
M2
M3
M4
ID4
ID3
Net
Current
Vcont
t
TD
QA
QB
PFD
QA
A
B
QBΔ
VDD
(c)
(a)
(b)
IP
IP
+IP
−IP
Vcont
C
Vb2
Vb1
VDD
M1
M2
M3
M4
TD
Figure 16.44
(a) Implementation of charge pump; (b) effect of skew between Q A and QB; (c) suppression of
skew by a pass gate.
The above charge-sharing phenomenon can be suppressed by “bootstrapping.” Illustrated in Fig. 16.47
[3], the idea is to “pin” VX and VY to Vcont after phase comparison is ﬁnished. When S1 and S2 turn off,
S3 and S4 turn on, allowing the unity-gain ampliﬁer to hold nodes X and Y at a potential equal to Vcont.
Note that the ampliﬁer need not provide much current because I1 ≈I2. At the next phase comparison
instant, S1 and S2 turn on, S3 and S4 turn off, and VX and VY begin with a value equal to Vcont. Thus, no
charge sharing occurs between CP and the capacitances at X and Y.
QBΔ
QA
ID4
ID3
Vcont
t
QBΔ
QA
ID4
ID3
Net
Current
Net
Current
Vcont
t
(a)
(b)
Figure 16.45
Effect of UP and DOWN current mismatch.

Sec. 16.3
Nonideal Effects in PLLs
681
t
Vcont
Vb2
Vb1
M1
M2
(a)
(b)
S2
S1
CY
CX
X
Y
CP
Vcont
Vb2
Vb1
M1
M2
S2
S1
CY
CX
X
Y
CP
VY
VX
Vout
VDD
VDD
Figure 16.46
Charge sharing between CP and capacitances at X and Y.
VDD
S2
S1
I2
CP
X
Y
+1
I1
S3
S4
Vcont
Figure 16.47
Bootstrapping X and Y
to minimize charge sharing.
16.3.2 Jitter in PLLs
The response of phase-locked loops to jitter is of extreme importance in most applications. We ﬁrst
describe the concepts of jitter and the rate of change of jitter.
As shown in Fig. 16.48, a strictly periodic waveform, x1(t), contains zero crossings that are evenly
spaced in time. Now consider the nearly periodic signal x2(t), whose period experiences small changes,
displacing the zero crossings from their ideal points. We say that the latter waveform suffers from jitter.11
Plotting the total phase, φtot, and the excess phase, φex, of the two waveforms, we observe that jitter
manifests itself as variation of the excess phase with time. In fact, ignoring the harmonics above the
fundamental, we can write x1(t) = A cos ωt and x2(t) = A cos[ωt + φn(t)], where φn(t) models the
variation of the period.12
The rate at which the jitter varies is also important. Consider the two jittery waveforms depicted in
Fig. 16.49. The ﬁrst signal, y1(t), experiences “slow jitter” because its instantaneous frequency varies
slowly from one period to the next. The second signal, y2(t), experiences “fast jitter.” The rate of change
is also evident from the excess phase plots of the two waveforms.
11Jitter is quantiﬁed by several different mathematical deﬁnitions, e.g., as in [5].
12The quantity φn(t) (or more commonly its spectrum) is called the “phase noise.” In this book, we assume that the jitter is
uniquely represented by φn(t).

682
Chap. 16
Phase-Locked Loops
t
x1(t)
x2(t)
t
TB
TB + ΔT1 TB + ΔT2
t
ϕtot1
ϕtot2
t
ϕex2
ϕex1
Total
Phase
Excess
Phase
Figure 16.48
Ideal and jittery waveforms.
t
t
t
ϕex2
ϕex1
Excess
Phase
y2(t)
y1(t)
Figure 16.49
Illustration of slow and fast jitter.
Two jitter phenomena in phase-locked loops are of great interest: (1) the input exhibits jitter, and
(2) the VCO produces jitter. Let us study each case, assuming that the input and output waveforms are
expressed as xin(t) = A cos[ωt + φin(t)] and xout(t) = A cos[ωt + φout(t)].
The transfer functions derived for type I and type II PLLs have a low-pass characteristic, suggesting
that if φin(t) varies rapidly, then φout(t) does not fully track the variations. In other words, slow jitter at
the input propagates to the output unattenuated, but fast jitter does not. We say the PLL low-pass ﬁlters
φin(t).
Now suppose the input is strictly periodic, but the VCO suffers from jitter. Viewing jitter as random
phase variations, we construct the model depicted in Fig. 16.50, where the input excess phase is set to zero
 + RP
s
KVCO
VCO
PFD/CP/LPF
IP
CPs
2π
1
(                )
Φin = 0
ΦVCO
Φout
Figure 16.50
Effect of VCO jitter.

Sec. 16.4
Delay-Locked Loops
683
[i.e., xin(t) = A cos ωt] and a random component VCO is added to the output of the VCO to represent
its jitter. The reader can show that the transfer function from VCO to out for a type II PLL is equal to
out
VCO
(s) =
s2
s2 + 2ζωns + ω2n
(16.48)
Interestingly, the characteristic has a high-pass nature, indicating that slow jitter components generated
by the VCO are suppressed, but fast jitter components are not. This can be understood with the aid
of Fig. 16.50: if φVCO(t) changes slowly (e.g., the oscillation period drifts with temperature), then the
comparison with φin = 0 (i.e., a perfectly periodic signal) generates a slowly-varying error that propagates
through the LPF and adjusts the VCO frequency, thereby counteracting the change in φVCO. On the other
hand, if φVCO varies rapidly (e.g., high-frequency noise modulates the oscillation period), then the error
produced by the phase detector is heavily attenuated by the poles in the loop, failing to correct for the
change.
Figure 16.51 conceptually summarizes the response of PLLs to input jitter and VCO jitter. Depending
on the application and the environment, one or both sources may be signiﬁcant, requiring an optimum
choice of the loop bandwidth.
Rate of Change
of ϕin 
Rate of Change
of ϕVCO 
ϕout
ϕVCO
ϕout
ϕin
Figure 16.51
Transfer functions of jitter from input and VCO to the output.
16.4
Delay-Locked Loops
A variant of PLLs that ﬁnds usage in many applications is the “delay-locked loop.” To arrive at the
concept, let us begin with an example. Suppose an application requires four clock phases with a precise
spacing of T = 1 ns between consecutive edges [Fig. 16.52(a)]. How should these phases be generated?
We can use a two-stage differential ring oscillator13 to produce the four phases, but how do we guarantee
that T = 1 ns despite process and temperature variations? This requires that the oscillator be locked to
a 250-MHz reference so that the output period is exactly equal to 4 ns [Fig. 16.52(b)].
An alternative approach to generating the clock phases of Fig. 16.52(a) is to apply the input clock to
four delay stages in a cascade. Illustrated in Fig. 16.53(a), this technique nonetheless does not produce
a well-deﬁned edge spacing because the delay of each stage varies with process and temperature. Now
consider the circuit shown in Fig. 16.53(b), where the phase difference between CKin and CK4 is sensed
by a phase detector, a proportional average voltage, Vcont, is generated, and the delay of the stages is
adjusted with negative feedback. For a large loop gain, the phase difference between CKin and CK4 is
small; that is, the four stages delay the clock by almost exactly one period, thereby establishing precise
edge spacing.14 This topology is called a delay-locked loop to emphasize that it incorporates a voltage-
controlled delay line (VCDL) rather than a VCO. In practice, a charge pump is interposed between the PD
13As explained in Chapter 15, a simple two-stage CMOS ring oscillator may not oscillate. This example is merely for illustration
purposes.
14The total delay through the four stages may be equal to two or more periods. We return to this issue later.

684
Chap. 16
Phase-Locked Loops
1 ns
CK1
CK2
CK3
CK4
t
PFD/CP/LPF
Vcont
CK1
CK2
CK4
fin
250 MHz
(a)
(b)
CK3
Figure 16.52
(a) Clock phases with edge-to-edge delay of 1 ns; (b) use of a phase-locked ring oscillator to
generate the clock phases.
and the LPF to achieve an inﬁnite loop gain. Each delay stage may be based on one of the ring oscillator
stages described in Chapter 15.
(a)
(b)
Vcont
PD/LPF
CK1
CK2
CK3
CK4
CKin
CK1
CK2
CK3
CK4
CKin
Figure 16.53
(a) Generation of clock edges by delay stages; (b) simple delay-locked loop.
The reader may wonder about the advantages of DLLs over PLLs. First, delay lines are generally less
susceptible to noise than are oscillators because corrupted zero crossings of a waveform disappear at the
end of a delay line, whereas they are recirculated in an oscillator, thereby experiencing more corruption.
Second, in the VCDL of Fig. 16.53(b), a change in the control voltage immediately changes the delay;
that is, the transfer function out(s)/Vcont(s) is simply equal to the gain of the VCDL, KVC DL. Thus,
the feedback system of Fig. 16.53(b) has the same order as the LPF, and its stability and settling issues
are more relaxed than those of a PLL.
▲
Example16.12
Explain qualitatively what type of transfer function the DLL of Fig. 16.54 has.
Solution
Suppose the input exhibits slow phase ﬂuctuations. Then, the phase error sees a high gain through the PD/CP/LPF
combination, and the delay of the line is adjusted so as to minimize this error. That is, φout tracks φin, and the
gain is about unity. Now, suppose the input exhibits very fast phase changes. The feedback loop thus has little gain,
providing little correction at the control of the delay line; i.e., Vcont remains relatively constant. As a result, the input
phase variations directly propagate to the output, yielding a gain of about unity. We conclude that the DLL exhibits
an all-pass response, but that for moderately fast phase ﬂuctuations, the response may have a dip or a peak.

Sec. 16.5
Applications
685
CP
RP
C2
Vcont
ϕin
PD
CP
ϕout
Figure 16.54
▲
The principal drawback of DLLs is that they cannot generate a variable output frequency. This issue
becomes clearer when we study the frequency synthesis capabilities of PLLs in Sec. 16.5.1. DLLs may
also suffer from locked delay ambiguity. That is, if the total delay of the four stages in Fig. 16.53(b)
can vary from below Tin to above 2Tin, then the loop may lock with a CKin-to-CK4 delay equal to
either Tin or 2Tin. This ambiguity proves detrimental if the DLL must provide precisely-spaced clock
edges because the edge-to-edge delay may settle to 2Tin/4 rather than Tin/4. In such cases, additional
circuitry is necessary to avoid the ambiguity. Also, mismatches between the delay stages and their load
capacitances introduce error in the edge spacing, requiring large devices and careful layout.
16.5
Applications
After nearly 90 years since its invention, phase locking continues to ﬁnd new applications in electronics,
communication, and instrumentation. Examples include memories, microprocessors, hard disk drive
electronics, RF and wireless transceivers, and optical ﬁber receivers.
The reader may recall from Sec. 16.1.2 that a PLL appears no more useful than a short piece of wire
because both guarantee a small phase difference between the input and the output. In this section, we
present a number of applications that demonstrate the versatility of phase locking. The concepts described
below have been the topic of numerous books and papers, e.g., [6, 7].
16.5.1 Frequency Multiplication and Synthesis
Frequency Multiplication
A PLL can be modiﬁed such that it multiplies its input frequency by a factor
of M. To arrive at the implementation, we exploit an analogy with voltage multiplication. As depicted
in Fig. 16.55(a), a feedback system ampliﬁes the input voltage by a factor of M if the output voltage is
divided by M [i.e., if R2/(R1 + R2) = 1/M] and the result is compared with the input. Thus, as shown
in Fig. 16.55(b), if the output frequency of a PLL is divided by M and applied to the phase detector, we
have fout = M fin. From another point of view, since fD = fout/M and fD and fin must be equal in the
PFD
CP/LPF
÷ M
fin
fout
fD
VCO
Vout
Vin
R1
R2
(a)
(b)
Figure 16.55
(a) Voltage ampliﬁcation and (b) frequency multiplication.

686
Chap. 16
Phase-Locked Loops
locked condition, the PLL multiplies fin by M. The ÷M circuit is realized as a counter that produces
one output pulse for every M input pulses.
As with voltage division in Fig. 16.55(a), the feedback divider in the loop of Fig. 16.55(b) alters the
system characteristics. Using (16.44), we rewrite (16.45) as
H(s) =
IP
2π
	
RP +
1
CPs

 KVCO
s
1 + 1
M
IP
2π
	
RP +
1
CPs

 KVCO
s
(16.49)
=
IP KVCO
2πCP
(RPCPs + 1)
s2 + IP
2π
KVCO
M
RPs +
IP
2πCP
KVCO
M
(16.50)
Note that H(s) →M as s →0, i.e., phase or frequency changes at the input result in an M-fold change
in the corresponding output quantity. Comparing the denominators of (16.45) and (16.50), we observe
that frequency division in the loop manifests itself as division of KVCO by M. In other words, as far
as the poles of the closed-loop system are concerned, we can assume that the oscillator and the divider
form a VCO with an equivalent gain of KVCO/M. This is, of course, to be expected because, for the
VCO/divider cascade shown in Fig. 16.56, we have
ωout = ω0 + KVCOVcont
M
(16.51)
= ω0
M + KVCO
M
Vcont
(16.52)
Thus, the combination cannot be distinguished from a VCO having an intercept frequency of ω0/M and
a gain of KVCO/M.
Vcont
VCO
÷ M
ωout
Figure 16.56
Equivalency of VCO/divider combination to a single VCO.
The foregoing discussion suggests that (16.46) and (16.47) can be respectively rewritten as
ωn =

IP
2πCP
KVCO
M
(16.53)
ζ = RP
2

IPCP
2π
KVCO
M
(16.54)
Also, the decay time constant is modiﬁed to (ζωn)−1 = 4π M/(RP IP KVCO). It follows that inserting
a divider in a type II loop degrades both the stability and the settling speed, requiring a proportional
increase in the charge-pump current.
The frequency-multiplying loop of Fig. 16.55(b) exhibits two interesting properties. First, unlike the
voltage ampliﬁer of Fig. 16.55(a), the PLL provides a multiplication factor exactly equal to M, a unique
attribute resulting from phase locking. Second, the output frequency can be varied by changing the divide
ratio M, an extremely useful property in synthesizing frequencies. Note that DLLs cannot perform such
synthesis.

Sec. 16.5
Applications
687
Frequency Synthesis
Some systems require a periodic waveform whose frequency (1) must be very
accurate (e.g., exhibit an error less than 10 ppm), and (2) can be varied in very ﬁne steps (e.g., in steps of
30 kHz from 900 MHz to 925 MHz). Commonly encountered in wireless transceivers, such requirements
can be met through frequency multiplication by PLLs.
Figure 16.57 shows the architecture of a phase-locked frequency synthesizer. The channel control
input is a digital word that deﬁnes the value of M. Since fout = M fRE F, the relative accuracy of fout is
equal to that of fRE F. For this reason, fRE F is derived from a stable, low-noise crystal oscillator. Note
that fout varies in steps equal to fRE F if M changes by one each time.
PFD
CP/LPF
fREF
fout
VCO
Channel
Control
÷ M
Figure 16.57
Frequency synthesizer.
CMOS frequency synthesizers achieving gigahertz output frequencies have been reported. Issues
such as noise, sidebands, settling speed, frequency range, and power dissipation continue to challenge
synthesizer designers.
16.5.2 Skew Reduction
The earliest usage of phase locking in digital systems was for skew reduction. Suppose a synchronous pair
of data and clock lines enter a large digital chip, as shown in Fig. 16.58. Since the clock typically drives
a large number of transistors and long interconnects, it is ﬁrst applied to a large buffer. Thus, the clock
distributed on the chip may suffer from substantial skew, T , with respect to the data, an undesirable
effect because it reduces the timing budget for on-chip operations.
ΔT
Digital Chip
CL
CKin
Din
CKB
CKin
Din
CKB
t
Buffer
Figure 16.58
Skew between data and buffered clock.
Now consider the circuit shown in Fig. 16.59, where CKin is applied to an on-chip PLL and the buffer
is placed inside the loop. Since the PLL guarantees a nominally-zero phase difference between CKin
and CK B, the skew is eliminated. From another point of view, the constant phase shift introduced by the
buffer is divided by the inﬁnite loop gain of the feedback system. Note that the VCO output, VVCO, may
not be aligned with CKin, a nonetheless unimportant issue because VVCO is not used.

688
Chap. 16
Phase-Locked Loops
PFD
CP/LPF
VCO
CL
CKB
CKin
Buffer
VVCO
Figure 16.59
Use of a PLL to eliminate skew.
▲
Example16.13
Construct the voltage-domain counterpart of the loop shown in Fig. 16.59.
Solution
The buffer creates a constant phase shift in the signal generated by the VCO. The voltage-domain counterpart
therefore assumes the topology shown in Fig. 16.60. We have
(Vin −Vout)A + VM = Vout
(16.55)
and hence
Vout = AVin + VM
1 + A
(16.56)
As A →∞, Vout →Vin.
A
VM
Vout
Vin
Figure 16.60
▲
We should note that the skew can be suppressed by a delay-locked loop as well. In fact, if frequency
multiplication is not required, DLLs are preferred because they are less susceptible to noise.
16.5.3 Jitter Reduction
Recall from Sec. 16.3.2 that PLLs suppress fast jitter components at the input. For example, if a 1-GHz
jittery signal is applied to a PLL having a bandwidth of 10 MHz, then input jitter components that vary
faster than 10 MHz are attenuated. In a sense, the phase-locked loop operates as a narrowband ﬁlter
centered around 1 GHz with a total bandwidth of 20 MHz. This is another important and useful property
of PLLs.
Many applications must deal with jittery waveforms. Random binary signals experience jitter because
of (1) crosstalk on the chip and in the package (Chapter 19), (2) package parasitics (Chapter 19), (3) addi-
tive electronic noise of devices, etc. Such waveforms are typically “retimed” by a low-noise clock so as to
reduce the jitter. Illustrated in Fig. 16.61(a), the idea is to resample the midpoint of each bit by a D ﬂipﬂop
that is driven by the clock. However, in many applications, the clock may not be available independently.
For example, an optical ﬁber carries only the random data stream, providing no separate clock waveform
at the receive end. The circuit of Fig. 16.61(a) is therefore modiﬁed as shown in Fig. 16.61(b), where
a “clock recovery circuit” (CRC) produces the clock from the data. Employing phase locking with a
relatively narrow loop bandwidth, the circuit minimizes the effect of the input jitter on the recovered
clock.

Problems
689
D
CK
Q
Vout
D
CK
Q
Vout
Clock Recovery
Circuit
Din
(a)
(b)
Figure 16.61
(a) Retiming data with D ﬂipﬂop driven by a low-noise clock; (b) use of a phase-locked clock
recovery circuit to generate the clock.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. Also, assume that all transistors are in saturation.
16.1.
The Gilbert cell (Chapter 4) operates as an XOR gate with large input swings and as an analog multiplier
with small input swings. Prove that an analog multiplier can be used to detect the phase difference between
two sinusoids. Is the input-output characteristic of such a phase detector linear?
16.2.
Redraw the waveforms of Fig. 16.4(b) if the VCO frequency is lowered at t = t1. If the phase error between
VCK and VVCO before t = t1 is equal to φ0 and fVCO is lowered from fH to fL, determine the minimum
t2 −t1 that is sufﬁcient for phase alignment.
16.3.
Explain why the low-pass ﬁlter in Fig. 16.5(b) cannot be replaced by a high-pass ﬁlter.
16.4.
A PLL using an XOR gate as a phase detector locks with φin −φout ≈90◦if K P DKVCO is large. Explain
why.
16.5.
Using the characteristic of Fig. 16.3 as an example, explain why the polarity of feedback in a PLL (without
frequency detection) is unimportant. (Hint: prove that the loop locks regardless of whether the initial phase
difference falls in the positive-slope region or the negative-slope region.)
16.6.
Assuming a ﬁrst-order LPF in Fig. 16.14, determine the transfer function out/ex, where out denotes the
excess phase of Vout.
16.7.
A VCO used in a type I PLL exhibits nonlinearity in its input-output characteristic, i.e., KVCO varies across
the tuning range. If the damping ratio must remain between 1 and 1.5, how much variation can be tolerated
in KVCO?
16.8.
Prove that in the root locus of Fig. 16.20, cos θ = ζ.
16.9.
A type I PLL incorporates a VCO with KVCO = 100 MHz/V, a PD with K P D = 1 V/rad, and an LPF with
ωL P F = 2π(1 MHz). Determine the step response of the PLL.
16.10. Explain why in the charge-pump PLL of Fig. 16.35, the control voltage of the VCO cannot be connected to
the top plate of CP.
16.11. Prove that the transfer function of the PFD/CP/LPF circuit in Fig. 16.35 is given by Eq. (16.43).
16.12. As illustrated in Fig. 16.45, mismatches between the UP and DOWN currents translate to phase offset at the
input of a CPPLL. With the aid of the waveforms in Fig. 16.45, calculate the phase offset in terms of current
mismatch.

690
Chap. 16
Phase-Locked Loops
16.13. For a VCO, we have ωout = ω0 + KVCOVcont. The control line experiences a small sinusoidal ripple,
Vcont = Vm cos ωmt. If the VCO is followed by a ÷M circuit, determine the output spectrum of the divider.
Consider two cases: ω0/M > ωm and ω0/M < ωm.
16.14. Prove that the root locus of a type II PLL is as shown in Fig. 16.37.
16.15. Determine the transfer function out/ex for the circuit of Fig. 16.14 if the PLL is modiﬁed to the architecture
of Fig. 16.35.
16.16. When a charge-pump PLL incorporating a PFD is turned on, the VCO frequency may be far from the input
frequency. Explain why the order of the PLL transfer function is lower by one while the PFD operates as a
frequency detector.
References
[1] R. E. Best, Phase-Locked Loops, 2nd ed. (New York: McGraw-Hill, 1993).
[2] F. M. Gardner, Phaselock Techniques, 2nd ed. (New York: John Wiley & Sons, 1979).
[3] M. G. Johnson and E. L. Hudson, “A Variable Delay Line PLL for CPU-Coprocessor Synchronization,” IEEE
J. of Solid-State Circuits, vol. 23, pp. 1218–1223, October 1988.
[4] F. M. Gardner, “Charge-Pump Phase-Locked Loops,” IEEE Trans. Comm., vol. COM-28, pp. 1849–1858,
November 1980.
[5] F. Herzel and B. Razavi, “A Study of Oscillator Jitter Due to Supply and Substrate Noise,” IEEE Transactions
on Circuits and Systems, Part II, vol. 46, pp. 56–62, January 1999.
[6] W. F. Egan, Frequency Synthesis by Phase Lock (New York: John Wiley & Sons, 1981).
[7] J. A. Crawford, Frequency Synthesizer Design Handbook (Boston: Artech House, 1994).

CHAPTER
17
Short-Channel Effects and
Device Models
The square-law characteristics derived for MOSFETs in Chapter 2 provide moderate accuracies for
devices with minimum channel lengths of greater than several microns, a value corresponding to tech-
nologies in production in the early 1980s. As device dimensions continue to scale down, reaching be-
low 12 nm, higher-order effects necessitate more complex models so as to attain enough accuracy in
simulations.
The problem of device models in CMOS technology has constantly haunted analog designers, man-
ifesting itself as substantial discrepancies between simulated and measured results. A number of com-
prehensive books [1, 2, 3] and hundreds of papers deal with the subject in great detail, but our objective
here is to provide a basic understanding of short-channel effects and review some of the SPICE models
developed to reﬂect such phenomena. Knowledge of these issues also proves useful in interpreting the
anomalies that the designer may encounter in SPICE simulations.
We ﬁrst describe the ideal scaling theory of MOS transistors. Next, we study short-channel effects
such as threshold voltage variation, velocity saturation, and the dependence of the output impedance on
the drain-source voltage. We then review MOS device models, including Levels 1–3 and the BSIM series.
Finally, we discuss charge and capacitance modeling, temperature dependence, and process corners.
17.1
Scaling Theory
The two principal reasons for the dominance of CMOS technology in today’s semiconductor industry are
the zero static power dissipation of CMOS logic and the scalability of MOSFETs. In a paper published
in 1974 [4], Dennard et al. recognized the tremendous potential of scaling MOS transistors, making
predictions about speed and power dissipation of digital CMOS circuits as devices are shrunk.
The ideal scaling theory follows three rules: (1) reduce all lateral and vertical dimensions by α(> 1);
(2) reduce the threshold voltage and the supply voltage by α; (3) increase all of the doping levels by α
(Fig. 17.1). Since the dimensions and voltages scale together, all electric ﬁelds in the transistor remain
n+
n+
p−substrate
n++
n++
p−substrate
Figure 17.1
Ideal scaling of MOS transistor.
691

692
Chap. 17
Short-Channel Effects and Device Models
constant, hence the name “constant-ﬁeld scaling.” Note that W, L, tox, VDD, VT H, and the depth and
perimeter of the source and drain junctions scale down by α.
Let us examine the saturation drain current of a square-law device after scaling. Writing
ID,scaled = 1
2μn(αCox)
W/α
L/α
 VGS
α
−VT H
α
2
(17.1)
= 1
2μnCox
W
L (VGS −VT H)2 1
α
(17.2)
we observe that the current capability of the transistor drops by a factor of α. Note that the same result
applies for the drain current in the triode region. The advantage of scaling, however, lies in the reduction
of capacitances and power dissipation. The total channel capacitance is
Cch,scaled = W
α
L
α (αCox)
(17.3)
= 1
α W LCox
(17.4)
To calculate the source/drain junction capacitance, we ﬁrst analyze the effect of ideal scaling on the
total width of the depletion region. Recall that this width is given by
Wd =

2ϵsi
q
 1
NA
+ 1
ND

(φB + VR)
(17.5)
where NA and ND denote the doping levels of the two sides of the junction, φB = VT ln(NAND/n2
i ),
and VR is the reverse-bias voltage. The built-in potential, φB, is a weak function of NAND, and in fact it
increases if NAND is scaled up by α2. For now, we assume VR ≫φB so that
Wd,scaled ≈

2ϵsi
q

1
αNA
+
1
αND
 VR
α
(17.6)
≈1
α

2ϵsi
q
 1
NA
+ 1
ND

VR
(17.7)
Thus, as with other dimensions, the width of each depletion region scales down by α, increasing the
depletion-region capacitance per unit area by the same factor.
AsillustratedinFig.17.2,thebottom-platecapacitanceoftheS/Djunction(perunitarea),C j,increases
by a factor of α. The sidewall capacitance (per unit width), C jsw, on the other hand, remains constant
because the depth of the junction is reduced by α. It follows that
CS/D,scaled = W
α
E
α (αC j) + 2
W
α + E
α

(C jsw)
(17.8)
= [W EC j + 2(W + E)C jsw] 1
α
(17.9)
All of the capacitances therefore decrease by the scaling factor.

Sec. 17.1
Scaling Theory
693
Cj
Cjsw
n+
W
p−substrate
Depletion
Region 
W
p−substrate
n++
α
α
E
E
Figure 17.2
Scaling of S/D junction capacitances.
VDD
C
Vout
Vin
I
Figure 17.3
CMOS inverter.
In digital applications, the scaling of the gate delay and power dissipation is of interest. Approximating
the delay of a CMOS inverter by Td = (C/I)VDD (Fig. 17.3), we have
Td,scaled = C/α
I/α
VDD
α
(17.10)
=
C
I VDD
 1
α
(17.11)
We conclude that the speed of digital circuits can potentially increase by the scaling factor. For power dissi-
pation, we write P = f CV 2
DD, where f is the operating frequency. Thus, Pscaled = f (C/α)(VDD/α)2 =
f CV 2
DD/α3 if f and the number of gates in the circuit remain constant. Note that the layout density, i.e.,
the number of transistors per unit area, also scales by α2.
The reduction of power and delay and the increase in circuit density make scaling extremely attractive
for digital systems. Based on these observations, Gordon Moore predicted in 1975 [5] that MOS device
dimensions would continue to scale down by a factor of two every three years and the number of
transistors per chip would double every one to two years. Such trends have indeed persisted over the past
40 years.
Let us now consider the effect of ideal scaling in analog circuits. Writing the transconductance as
gm,scaled = μ(αCox)W/α
L/α
VGS −VT H
α
(17.12)
= μCox
W
L (VGS −VT H)
(17.13)
we note that the transconductance remains constant if all of the dimensions and voltages (and currents)
scale down. To calculate the output impedance in saturation, we ﬁrst observe from Fig. 17.4 and Eq.
(17.7) that the width of the depletion region around the drain decreases by α, and hence L/L remains

694
Chap. 17
Short-Channel Effects and Device Models
n+
n+
p−substrate
n++
n++
p−substrate
Pinch−Off
Depletion Region
Figure 17.4
Effect of scaling on pinch-off.
constant. Since λ = (L/L)/VDS (Chapter 2), λ increases by α and
rO,scaled =
1
αλ ID
α
(17.14)
=
1
λID
(17.15)
Thus, the intrinsic gain, gmrO, remains constant. Unfortunately, in practice, gmrO has dropped
considerably.
The greatest impact of scaling on analog circuits is the reduction of the supply voltage. With ideal
scaling, the maximum allowable voltage swings decrease by a factor of α, lowering the dynamic range1
of the circuit. For example, if the lower end of the dynamic range is limited by thermal noise, then scaling
VDD by α decreases the dynamic range by the same factor because gm and hence thermal noise remain
constant. Of course, since for analog circuits (VDD/α)(IDD/α) = (VDD IDD/α)2, the power dissipation
drops by α2.
In order to restore the dynamic range, the transconductance of the transistors must be increased by
a factor of α2 because thermal noise voltages and currents scale with √gm. Thus, since voltage scaling
requires that VGS −VT H decrease by a factor of α, we note from gm = 2ID/(VGS −VT H) that ID
must increase by the same factor, leading to a power dissipation of (VDD/α)(αID) = VDD ID. Also, from
gm = μCox(W/L)(VGS−VT H), we conclude that if Cox is scaled up by α and L and VGS−VT H are scaled
down by α, then W must increase by α (whereas in ideal scaling, it would decrease by this factor). That
is, for a constant (thermal-noise limited) dynamic range, ideal scaling of linear analog circuits requires
a constant power dissipation and a higher device capacitance, e.g., (αW)(L/α)(αCox) = αW LCox.
Interestingly, if the lower end of the dynamic range is determined by kT/C noise, then to maintain a
constant slew rate in switched-capacitor circuits, the bias current must scale up by a factor of α2, resulting
in an increase in the power dissipation. (Problem 17.17.3).
In practice, technology scaling has deviated from the ideal, constant-ﬁeld scenario considerably. The
supply voltage and MOS threshold voltage have not scaled as rapidly as device dimensions. For example,
VDD has decreased from 5 V to 2.5 V and VT H from 0.8 V to 0.4 V as minimum channel length has
dropped from 1 μm to 0.25 μm. Furthermore, many “short-channel” effects have plagued the transistors,
making it difﬁcult to obtain all of the beneﬁts that would accrue with ideal scaling.
The reluctance of circuit designers to use a lower supply voltage and the fundamental limitations in
decreasing the MOS threshold voltage have led to another scaling scenario: constant-voltage scaling. In
this case, the device dimensions shrink by α, the doping levels increase by α, and the voltages remain
constant, thereby increasing the electric ﬁelds by α. Such high electric ﬁelds both raise the possibility
of device breakdown and exacerbate short-channel effects. In reality, technology scaling has followed a
1Dynamic range is loosely deﬁned as the maximum allowable voltage swing divided by the total noise voltage in the band of
interest.

Sec. 17.2
Short-Channel Effects
695
mixture of constant-ﬁeld and constant-voltage trends, thus demanding innovative device design so as to
achieve reliability and performance.
17.2
Short-Channel Effects
In order to appreciate the need for sophisticated device models, we brieﬂy study some of the phenomena
that manifest themselves for short channels. As we will see, a basic understanding of these effects also
proves essential to the design of analog (and digital) circuits.
Small-geometry effects arise because ﬁve factors deviate the scaling from the ideal scenario: (1) the
electric ﬁelds tend to increase because the supply voltage has not scaled proportionally; (2) the built-in
potential term in Eq. (17.5) is neither scalable nor negligible; (3) the depth of S/D junctions cannot be
reduced easily; (4) the mobility decreases as the substrate doping increases; and (5) the subthreshold
slope (described below) is not scalable.
17.2.1 Threshold Voltage Variation
The choice of the threshold voltage is based on the device performance in typical circuit applications.
The upper bound is roughly equal to VDD/4 to avoid degrading the speed of digital CMOS gates. The
lower bound is determined by several factors: the subthreshold behavior, variation with temperature and
process, and dependence upon the channel length [6].
Let us ﬁrst consider the subthreshold behavior. For long-channel devices, the subthreshold drain current
can be expressed as
ID = μCd
W
L V 2
T

exp VGS −VT H
ζ VT
 
1 −exp −VDS
VT

(17.16)
where Cd = √ϵsiqNsub/(4φB) denotes the capacitance of the depletion region under the gate area,
VT = kT/q, and ζ = 1 + Cd/Cox [6]. Equation (17.16) reveals two interesting properties. First, as VDS
exceeds a few VT , ID becomes independent of the drain-source voltage and the relationship reduces to
Eq. (2.33). Second, under this condition, the slope of ID on a logarithmic scale equals
∂(log10 ID)
∂VGS
= (log10 e) 1
ζ VT
(17.17)
The inverse of this quantity is usually called the “subthreshold slope,” S:
S = 2.3VT

1 + Cd
Cox

V/dec
(17.18)
For example, if Cd = 0.67Cox, then S = 100 mV/dec, suggesting that a change of 100 mV in VGS leads
to a tenfold reduction in the drain current. In order to turn off the transistor by lowering VGS below VT H,
S must be as small as possible, i.e., Cd/Cox must be minimized.
The relatively constant magnitude of S severely limits the scaling of the threshold voltage. For example,
a subthreshold slope of 80 mV/dec imposes a lower bound of 400 mV for VT H if the “off current” must
be roughly ﬁve orders of magnitude lower than the “on current.”
The difﬁculty in scaling VT H becomes even more serious if we take into account the variation of VT H
with temperature and process. The threshold voltage exhibits a temperature coefﬁcient of approximately

696
Chap. 17
Short-Channel Effects and Device Models
−1 mV/K, yielding a 50-mV change across the commercial temperature range (0 to 50◦C).2 Process-
induced variation is also in the vicinity of 50 mV, raising the margin to approximately 100 mV. Thus, it
is difﬁcult to reduce VT H below several hundred millivolts.
Leff
VTH
Figure 17.5
Variation of threshold
with channel length.
An interesting phenomenon observed in scaled transistors is the dependence of the threshold voltage
on the channel length. As shown in Fig. 17.5, transistors fabricated on the same wafer but with different
lengths yield lower VT H as L decreases. This is because the depletion regions associated with the source
and drain junctions protrude into the channel area considerably, thereby reducing the immobile charge
that must be imaged by the charge on the gate (Fig. 17.6). In other words, part of the immobile charge in
the substrate is now imaged by the charge inside the source and drain areas rather than by the charge on
the gate. As a result, the gate voltage required to create an inversion layer decreases. Since the channel
length cannot be controlled accurately during fabrication, this effect introduces additional variations in
VT H. The implication of this phenomenon in analog design is that if the length of a device is increased
so as to achieve a higher output impedance, then the threshold voltage also increases by as much as 100
to 200 mV.
n+
n+
p−substrate
−−−−−−−
−−−−−
−
−
−
−
−
−
++++++++++
Imaged by
S/D
Imaged by
Gate
+++
+++
Figure 17.6
Charge sharing between
source/drain depletion regions and the
channel depletion region.
Anothershort-channelphenomenonrelatedtothethresholdvoltageis“drain-inducedbarrierlowering”
(DIBL). Recall from Chapter 2 that in weak inversion, as the gate voltage rises, the surface potential
becomes more positive [Fig. 17.7(a)], attracting carriers from the source region. In short-channel devices,
the drain voltage also makes the surface more positive by creating a two-dimensional ﬁeld in the depletion
region [6]. In essence, the drain introduces a capacitance C′
d that raises the surface potential in a manner
similar to Cd. As a result, the barrier to the ﬂow of charge and hence the threshold voltage are decreased.
This effect manifests itself if the plot of Fig. 2.28 is drawn in both deep triode and saturation regions
[Fig. 17.7(b)].
The principal impact of DIBL on circuit design is the degraded output impedance. This point is
explained in Sec. 17.2.5.
Reverse Short-Channel Effect
In nanometer CMOS technologies, the threshold voltage decreases as
the channel length increases from its minimum value. To analyze this effect, let us consider the cross
2Interestingly, as the temperature rises, so does S, further exacerbating the situation.

Sec. 17.2
Short-Channel Effects
697
VGS
log ID
VTH2
n+
n+
p−substrate
VG
Cox
Cd
VDS
(a)
(b)
VTH1
Large VDS
Small VDS
C′d
Figure 17.7
(a) DIBL in a short-channel device; (b) effect of DIBL on current characteristic.
n+
n+
p+
p+
p−substrate
Halo
Implant
Figure 17.8
MOS structure with halo implant.
section of a modern device, shown in Fig. 17.8, wherein a “halo” implant of heavy doping surrounds the
source and drain junctions. This implant reduces the penetration of the drain depletion region into the
channel area, thereby improving the device characteristics.
Now recall from Chapter 2 that the threshold voltage is a function of the substrate doping level, Nsub.
We have
VT H = φMS + 2φF + Qdep
Cox
(17.19)
where both φF = (kT/q) ln(Nsub/ni) and Qdep = √4qϵsi|φF|Nsub increase as Nsub increases. Due to
the nonuniform substrate doping along the channel in Fig. 17.8, the “local” threshold voltage also varies
from the source to the drain. We can take the average along the channel to obtain an overall threshold
for a given device structure. We then observe that, as the channel length increases, the average substrate
doping decreases, and so does the threshold voltage.
17.2.2 Mobility Degradation with Vertical Field
At large gate-source voltages, the high electric ﬁeld developed between the gate and the channel conﬁnes
the charge carriers to a narrower region below the oxide-silicon interface, leading to more carrier scattering
and hence lower mobility. Since scaling has substantially deviated from the constant-ﬁeld scenario, small-
geometry devices experience signiﬁcant mobility degradation. An empirical equation modeling this
effect is
μef f =
μ0
1 + θ(VGS −VT H)
(17.20)
where μ0 denotes the “low-ﬁeld” mobility and θ is a ﬁtting parameter roughly equal to (10−7/tox) V−1
[7]. For example, if tox = 100 A
◦, then θ ≈1 V−1 and the mobility begins to fall considerably as the
overdrive exceeds 100 mV. Note that θ rises as tox drops because the electric ﬁeld in the oxide becomes
stronger.

698
Chap. 17
Short-Channel Effects and Device Models
In addition to lowering the current capability and transconductance of MOSFETs, mobility degradation
causes the I/V characteristic to deviate from the simple square-law behavior. Speciﬁcally, whereas a
square-law device generates only even harmonics in its drain current in response to a sinusoidal gate-
source voltage, Eq. (17.20) predicts odd harmonics as well. In fact, writing
ID = 1
2
μ0Cox
1 + θ(VGS −VT H)
W
L (VGS −VT H)2
(17.21)
and assuming that θ(VGS −VT H) ≪1, we obtain
ID ≈1
2μ0Cox
W
L [1 −θ(VGS −VT H)](VGS −VT H)2
(17.22)
≈1
2μ0Cox
W
L

(VGS −VT H)2 −θ(VGS −VT H)3
(17.23)
This is a rough approximation, but it reveals the existence of higher harmonics in the drain current.
The mobility degradation with the vertical ﬁeld affects the device transconductance as well. This is
studied in Problem 17.9.
17.2.3 Velocity Saturation
The mobility of carriers also depends on the lateral electric ﬁeld in the channel, which is beginning to
drop as the ﬁeld reaches levels of 1 V/μm. Since the carrier velocity v = μE, we note that v approaches
a saturated value, about 107 cm/s, for sufﬁciently high ﬁelds. Thus, as carriers enter the channel from
the source and accelerate toward the drain, they may eventually reach a saturated velocity at some point
along the channel.3 In the extreme case, where carriers experience velocity saturation along the entire
channel, we can rewrite Eq. (2.2) as
ID = vsat Qd
(17.24)
= vsatWCox(VGS −VT H)
(17.25)
Interestingly, the current is linearly proportional to the overdrive voltage and does not depend on the
length. In fact, as shown in Fig. 17.9, ID-VDS characteristics of devices with L < 1 μm reveal velocity
saturation because equal increments in VGS −VT H result in roughly equal increments in ID. We also note
that gm = vsatWCox, concluding that the transconductance is a weak function of the drain current and
channel length in the velocity-saturation regime.
VDS
ID
VGS0
VGS0 + ΔV 
VGS0 + 2ΔV 
VGS0 + 3ΔV 
Figure 17.9
Effect of velocity saturation on drain-current characteristics.
3Even in long-channel devices, carriers experience velocity saturation if the drain-source voltage is high enough to pinch off
the channel. At the pinch-off point, the mobile charge density is near zero, the electric ﬁeld is very large, and hence the velocity of
carriers is saturated.

Sec. 17.2
Short-Channel Effects
699
Under typical bias conditions, MOSFETs experience some velocity saturation, displaying a charac-
teristic between linear and square-law behavior. An important consequence is that, as VGS increases, the
drain current saturates well before pinch-off occurs. As shown in Fig. 17.10(a), carriers reach velocity
saturation if VDS exceeds VD0 < VGS −VT H, yielding a constant current quite a lot lower than that ob-
tained if the device saturated for VDS > VGS −VT H. Furthermore, as illustrated in Fig. 17.10(b), since an
increment in VGS gives a smaller increment for ID when velocity saturation occurs, the transconductance
is also lower than that predicted by the square law.
VDS
ID
VGS – VTH
Without
Velocity Saturation 
With
Velocity Saturation
VD0
VDS
ID
VGS0
VGS0 + ΔV
Without
Velocity Saturation 
VGS0 + ΔV
(a)
(b)
Figure 17.10
Effect of velocity saturation: (a) premature drain current saturation; (b) reduction of
transconductance.
A compact and versatile equation developed to represent velocity saturation (in the saturation region) is
ID = WCoxvsat
(VGS −VT H)2
VGS −VT H + 2vsat L
μef f
(17.26)
where μef f is given by Eq. (17.20) [7, 8]. The same work provides the following equation for the
drain-source voltage at the onset of premature saturation [VD0 in Fig. 17.10(a)]:
VDS,sat = 2μef f L(VGS −VT H)
2μef f L + VGS −VT H
(17.27)
Equation (17.26) provides two interesting results. First, if L or vsat is large, the expression reduces to
the square-law relationship. Second, if the overdrive voltage is so small that the denominator of (17.26)
is approximated as 2vsat L/μef f and μef f ≈μ0, then the device still follows the square-law behavior
even if L is relatively small. For example, if vsat ≈107 cm/s, L = 0.25 μm, and μ0 ≈350 cm2/V/s,
we have 2vsat L/μ0 ≈1.43 V, recognizing that for overdrive voltages of a few hundred millivolts, the
transistor operation is somewhat close to the square law. Thus, the simpliﬁed treatment of Chapter 2 can
still provide insight for many analog applications.
Equation (17.26) can be further simpliﬁed to yield additional results. Substituting for μef f from Eq.
(17.20), we have
ID = WCoxvsat
(VGS −VT H)2
VGS −VT H + 2vsat L
μ0
[1 + θ(VGS −VT H)]
(17.28)
= WCoxvsat
(VGS −VT H)2
2vsat L
μ0
+

1 + 2vsat Lθ
μ0

(VGS −VT H)
(17.29)
= 1
2μ0Cox
W
L
(VGS −VT H)2
1 +

μ0
2vsat L + θ

(VGS −VT H)
(17.30)

700
Chap. 17
Short-Channel Effects and Device Models
This equation is similar to (17.21), implying that the degradation of the mobility with both lateral and
vertical ﬁelds can be represented by adding the terms μ0/(2vsat L) and θ. Thus, the results obtained from
(17.21) apply here as well. For example, the drain current contains high-order nonlinear terms. Equation
(17.30) can also predict the transconductance (Problem 17.10).
17.2.4 Hot Carrier Effects
Short-channel MOSFETs may experience high lateral electric ﬁelds if the drain-source voltage is large.
While the average velocity of carriers saturates at high ﬁelds, the instantaneous velocity and hence the
kinetic energy of the carriers continue to increase, especially as they accelerate toward the drain. These
are called “hot” carriers [2].
In the vicinity of the drain region, hot carriers may “hit” the silicon atoms at high speeds, thereby
creating impact ionization. As a result, new electrons and holes are generated, with the electrons absorbed
by the drain and the holes by the substrate. Thus, a ﬁnite drain-substrate current appears. Also, if the
carriers acquire a very high energy, they may be injected into the gate oxide and even ﬂow out the gate
terminal, introducing a gate current. The substrate and gate currents are often measured to study hot
carrier effects.
The scaling of technologies proceeds so as to minimize hot carrier effects. This limitation and other
breakdown phenomena make the supply voltage scaling inevitable.
In nanometer technologies, hot carrier effects have subsided. This is because the energy required to
create an electron-hole pair, Eg ≈1.12 eV, is simply not available if the supply voltage is around 1 V.
That is, for an arbitrarily short channel and even in the absence of any lattice, an electron cannot attain
1.2 eV by traveling from 0 V at the source to 1 V at the drain. (Statistically, a small fraction of electrons
may reach Eg at a ﬁnite temperature, but the effect is negligible.)
17.2.5 Output Impedance Variation with Drain-Source Voltage
Inmodelingchannel-lengthmodulationbyasingleconstant λ,wehaveassumedthattheoutputimpedance
of the transistor, rO, is constant in the saturation region. In reality, however, rO varies with VDS. As VDS
increases and the pinch-off point moves toward the source, the rate at which the depletion region around
the source becomes wider decreases, resulting in a higher incremental output impedance. Illustrated
in Fig. 17.11, this effect is somewhat similar to the variation of the capacitance of a reversed-biased
pn junction: with a small reverse bias, the width of the depletion region is a strong function of the voltage
applied to the junction and with a large reverse bias, a weak function.
In this regime, the output impedance can be approximated as
rO =
2L
1 −L
L
1
ID

qNB
2ϵsi
(VDS −VDS,sat)
(17.31)
where VD,sat is the drain-source voltage at the onset of pinch-off [9]. Another approximation developed
in conjunction with (17.26) and (17.27) is described in [8].
In short-channel devices, as VDS increases further, drain-induced barrier lowering becomes signiﬁcant,
reducing the threshold voltage and increasing the drain current. This effect roughly cancels that expressed
by (17.31), giving a relatively constant output impedance. At sufﬁciently high drain voltages, impact
ionization near the drain produces a large current (ﬂowing from the drain into the substrate), in essence
lowering the output impedance. The overall behavior of rO is plotted in Fig. 17.12.
The variation of rO gives rise to nonlinearity in many circuits. In an op amp, for example, as the output
voltage varies, so does the output impedance and hence the voltage gain of the circuit. Furthermore, impact

Sec. 17.3
MOS Device Models
701
n+
n+
VG
VDS1
n+
n+
VG
VDS1 + ΔV
n+
n+
VG
n+
n+
VG
VDS2 + ΔV
ΔL2
ΔL1
(a)
(b)
VDS2 > VDS1
ID
VDS
VDS1 + ΔV
VDS2 + ΔV
VDS1
VDS2
(c)
Figure 17.11
Decrement in channel length for (a) small VDS and (b) large VDS and (c) the resulting slope change.
VDS
rO
Channel−Length
Modulation
Impact
Ionization
Channel−Length
Modulation and DIBL
Figure 17.12
Overall variation of output resistance as a function of VDS.
ionization limits the maximum gain that can be obtained from cascode structures because it introduces a
small-signal resistance from the drain to the substrate rather than to the source.
17.3
MOS Device Models
Since the introduction of the ﬁrst MOS model in the mid-1960s [10], a tremendous amount of research
has been expended on improving the accuracy of models as device dimensions scale down. Developed
between the mid-1960s and the late 1970s, the Level 1, 2, and 3 models consecutively included higher-
order effects so as to provide reasonable accuracy with respect to measured transistor characteristics for

702
Chap. 17
Short-Channel Effects and Device Models
channel lengths as small as 1 μm. Following this set were the Compact Short-Channel IGFET Model
(CSIM) from AT&T Bell Laboratories and the Berkeley Short-Channel IGFET Model (BSIM) from
University of California, Berkeley, in the mid-1980s. These models proved inadequate for analog design
and were followed by BSIM2, HSPICE level 28, BSIM3, BSIM4, and a number of others in the 1980s
and 1990s.
MOS device modeling continues to pose a challenge—especially for high-frequency operation. Our
objective is to develop a basic understanding of some of the models to the extent necessary for simulations.
We should also mention that the utility of a model is given by the accuracy it provides in various regions
of operation for different device dimensions, the ease with which its parameters can be measured, and
the efﬁciency that it allows in simulations. The interested reader is referred to [1] for in-depth coverage.
17.3.1 Level 1 Model
Also known as the Shichman and Hodges Model [10], this representation uses the parameters listed in
Table 2.1 and is based on the following equations:
ID = 1
2 K P
W
L −2L D

2(VGS −VT H)VDS −V 2
DS

(1 + λVDS) Triode Region
(17.32)
ID = 1
2 K P
W
L −2L D
(VGS −VT H)2(1 + λVDS) Saturation Region
(17.33)
where K P = μCox and VT H = VT H0 + γ (√2φB −VBS −√2φB). Note that this model does not include
subthreshold conduction or any short-channel effects.
The device capacitances are represented according to the simple model described in Chapter 2, but with
one modiﬁcation. Since in that model, CGS abruptly changes from (2/3)W LCox + WCov in saturation
to (1/2)W LCox + WCov in the triode region [and CGD from WCov to (1/2)W LCox + WCov], most
computation algorithms experience convergence difﬁculties here. For this reason, CGS and CGD in the
triode region are formulated as
CGS = 2
3W LCox

1 −
(VGS −VDS −VT H)2
[2(VGS −VT H) −VDS]2

+ WCov
(17.34)
CGD = 2
3W LCox

1 −
(VGS −VT H)2
[2(VGS −VT H) −VDS]2

+ WCov
(17.35)
CGB = 0.
(17.36)
We note that if the device operates at the edge of saturation, VGS −VDS = VT H, CGS = (2/3)W LCox +
WCov, and CGD = WCov. Thus, the capacitance values change continuously from one region to another.
The Level 1 model maintains reasonable I/V accuracy for channel lengths as small as roughly 4 μm,
but it still predicts the output impedance of transistors in saturation quite poorly.
17.3.2 Level 2 Model
The Level 1 model began to manifest its shortcomings as channel lengths fell below approximately 4
μm. The Level 2 model was then developed to represent many high-order effects.
An assumption that we made in Chapter 2 in deriving the square-law characteristics was a constant
threshold voltage along the channel. This assumption is not correct even for long-channel devices because
the charge in the depletion region under the channel varies according to the local voltage (Fig. 17.13).
Since the inversion layer and the depletion region must image the charge on the gate, as the inversion layer

Sec. 17.3
MOS Device Models
703
n+
n+
VG
VDS1
x
Local Threshold
Figure 17.13
Variation of threshold along the channel.
vanishes in the direction toward the drain, the depletion region must enclose more charge. Performing
the integration in Sec. 2.2.2 with a varying threshold voltage yields [1]
ID = μCox
W
L {(VGS −VT H0)VDS −V 2
DS
2
−2
3γ [(VDS −VBS + 2φF)3/2 −(−VBS + 2φF)3/2]}
(17.37)
Interestingly, even for VBS = 0, ID exhibits some dependence on γ . Moreover, for small VDS, the equation
reduces to that of the Level 1 model, but for large VDS, the drain current is less than that predicted by the
square law. It can also be shown that the edge of the saturation region is given by [1]
VD,sat = VGS −VT H0 −φF + γ 2
	
1 −

1 + 2
γ 2 (VGS −VT H0 + φF)

(17.38)
In the saturation region, the drain current is
IDS = ID,sat
1
1 −λVDS
(17.39)
where ID,sat is calculated from (17.37) for VDS = VDS,sat.
Modeling channel-length modulation or, more generally, the ﬁnite output impedance has always
remained a difﬁcult problem. Representing such phenomena by only λ is far from accurate. In the Level
2 implementation, if λ is not speciﬁed, it is obtained by calculating the width of the depletion region
between the pinch-off point and the edge of the drain. Using simple relationships for the depletion region
of a pn junction, we can write
L =

2ϵsi
qNsub
[φB + (VDS −VD,sat)]
(17.40)
where VD,sat denotes the pinch-off voltage.4
The principal difﬁculty with the above approach is that both the drain current and its derivative are
discontinuous at the edge of the triode region [1]! To resolve this issue, L is actually obtained by a
4The junction is considered “one-sided” here; i.e., the drain doping level is much higher.

704
Chap. 17
Short-Channel Effects and Device Models
“ﬁxed-up” equation:
L =

2ϵsi
qNsub

V1 +

1 + V 2
1

(17.41)
where V1 = (VDS −VD,sat)/4. The channel-length modulation coefﬁcient is then expressed as λ =
L/(LVDS). An attribute of (17.41) is that the output conductance of the transistor varies as VDS
increases, an effect not represented by the ﬁrst-order model using a constant λ.
The Level 2 model also includes the degradation of the mobility with the vertical ﬁeld in the channel.
The mobility is calculated from
μs = μ0
 ϵsi
Cox
·
Uc
VGS −VT H −UtVDS
Ue
(17.42)
where Uc denotes the gate-channel critical electric ﬁeld, Ut is a ﬁtting parameter between 0 and 0.5, and
Ue is an exponent in the vicinity of 0.15.
The subthreshold behavior implemented in the Level 2 model deﬁnes a voltage Von as Von = VT H +
ζ VT , where ζ = 1 + (qNFS/Cox) + Cd/Cox, and NFS is an empirical constant. The drain current is then
expressed as
IDS = Ion exp VGS −Von
ζ VT
(17.43)
where Ion is the drain current calculated in strong inversion [Eq. (17.37)] for VGS = Von. An important
drawback of this representation is the discontinuity in the slope of ID as the device goes from the
subthreshold region to strong inversion (Fig. 17.14), leading to various difﬁculties and errors in simulation.
VGS
log ID
VTH
Figure 17.14
Kink in drain current
characteristic in Level 2 model.
In addition to the above effects, the Level 2 model represents two other short-channel phenomena: the
variation of VT H with L, and velocity saturation. The implementation of these effects is quite involved
and can be found in [1].
Measured data [1] indicate that the Level 2 model provides reasonable I/V accuracy for wide, short
devices in the saturation region with L ≈0.7 μm, but it suffers from substantial error in representing the
output impedance and the transition point between the saturation and triode regions. For narrow or long
devices, the model is inaccurate.
17.3.3 Level 3 Model
The Level 3 model realization is somewhat similar to the Level 2 model, with some equations simpliﬁed
and many empirical constants introduced to improve the accuracy for channel lengths as small as 1 μm.

Sec. 17.3
MOS Device Models
705
This model expresses the threshold voltage as
VT H = VT H0 + Fsγ

2φF −VBS + Fn(2φF −VBS) + ξ 8.15 × 10−22
Cox L3
ef f
VDS
(17.44)
where Fs and Fn represent short-channel and narrow-channel effects,5 respectively, and ξ models drain-
induced barrier lowering.
The mobility equation involves both vertical and lateral ﬁeld effects and is expressed as
μ1 =
μef f
1 + μef f VDS
vmax L1
(17.45)
where
μef f =
μ0
1 + θ(VGS −VT H)
(17.46)
and vmax denotes the maximum velocity of the carriers in the channel. As can be seen from (17.45) and
(17.46), μef f models the effect of the vertical ﬁeld while μ1 adds that of the lateral ﬁeld as well.
The drain current is realized as
ID = μ1Cox
Wef f
Lef f

VGS −VT H0 −

1 +
Fsγ
4√2φF −VBS
+ Fn
 V ′
DS
2

V ′
DS
(17.47)
where V ′
DS = VD,sat if the device is in saturation. The quantity VD,sat represents both channel pinch-off
and velocity saturation (Fig. 17.10) and is expressed by relatively complex equations [1].
The subthreshold current relations are similar to those of the Level 2 model, still suffering from
derivative discontinuity near strong inversion.
The Level 3 model employs more sophisticated methods of computing channel-length modulation as
well as charge and capacitance parameters. The details can be found in [1]. Comparison with measured
data [1] suggests that the Level 3 model, as with the Level 2 model, exhibits moderate accuracy for wide,
short transistors, but suffers from large errors for longer channels.
An important drawback of the Level 3 model is the discontinuity of the derivative of ID with respect
to VDS at the edge of the triode region, leading to large errors in the calculation of the output impedance.
Shown in Fig. 17.15 for a short-channel device, the variation of rO with VDS is quite poorly modeled.
VDS
rO
Figure 17.15
Kink in output resistance in Level 3 model.
5For narrow-channel devices, the threshold voltage increases if the width is reduced [6].

706
Chap. 17
Short-Channel Effects and Device Models
17.3.4 BSIM Series
The philosophy behind the Level 1–3 models was to express the device behavior by means of equations
that originated from the physical operation. However, as transistors were scaled to submicron dimen-
sions, it became increasingly more difﬁcult to introduce physically meaningful equations that would be
both accurate and computationally efﬁcient. BSIM adopted a different approach: numerous empirical
parameters were added so as to simplify the equations—but at the cost of losing touch with the actual
device operation.
An interesting feature of BSIM is the addition of a simple equation to represent the geometry depen-
dence of many of the device parameters. The general expression is of the form
P = P0 + αP
Lef f
+ βP
Wef f
(17.48)
where P0 is the value of the parameter for a long, wide transistor (P = P0 if Lef f , Wef f →∞), and αP
and βP are ﬁtting factors. For example, the mobility is computed as
μ = μ0 + αμ
Lef f
+
βμ
Wef f
(17.49)
The formulation of (17.48) nonetheless becomes less accurate at small dimensions [1].
The device equations and ﬁtting parameters used in BSIM are beyond the scope of this book. Using
approximately 50 parameters, this model provides the following improvements over the Level 3 version
[1]: (1) the dependence of mobility upon the vertical ﬁeld includes the substrate voltage; (2) the threshold
voltageismodiﬁedforsubstrateswithnonuniformdoping;(3)thecurrentsintheweakandstronginversion
regions are derived such that their values and ﬁrst derivatives are continuous; and (4) to simplify the drain
current equations, new expressions are devised for velocity saturation, dependence of mobility upon the
lateral ﬁeld, and the saturation voltage.
Measured results in a 0.7-μm technology [1] indicate that BSIM avoids gross errors in the I/V char-
acteristics for various device dimensions, but its accuracy for narrow, short transistors is somewhat poor.
In addition to shortcomings at channel lengths below approximately 0.8 μm, BSIM suffers from
other subtle inaccuracies. For example, at large drain-source voltages, BSIM predicts a negative output
resistance for saturated MOSFETs. Furthermore, in the deep triode region, BSIM still exhibits slight
discontinuities in the drain current [1].
The next model in the BSIM series is BSIM2. Requiring approximately 70 parameters, this version
employs new expressions for mobility, drain current, and subthreshold conduction. It also represents the
output impedance more accurately by incorporating both channel-length modulation and drain-induced
barrier lowering. Nevertheless, measured results indicate that the overall accuracy of the model is only
marginally higher than that of BSIM. For short, narrow transistors, BSIM2 suffers from large errors in
the triode region and even substantial “kinks” in the saturation region [1].
The trend in BSIM and BSIM2, namely, expressing the device behavior by means of empirical equa-
tions that bear little relation to the physical phenomena, eventually created difﬁculties in modeling
short-channel devices. Parameter extraction, modeling process variations, and the need for extensive use
of polynomials made the generation and application of these models quite difﬁcult. Consequently, the
next generation, BSIM3, has returned to the physical principles of device operation while maintaining
many of the useful features of BSIM and BSIM2. BSIM3 itself has rapidly gone through several versions,
requiring approximately 180 parameters in the third one. For channel lengths as low as 0.25 μm, BSIM3
provides reasonable accuracy for subthreshold and strong inversion operation while still suffering from
large errors in predicting the output impedance. BSIM4 has overcome many of these issues and serves
modeling needs in 40-nm and 28-nm generations.

Sec. 17.3
MOS Device Models
707
17.3.5 Other Models
In addition to the Level 1–3 models and the four generations of BSIM, a number of other MOS models
have been introduced. Among these, HSPICE Level 28, MOS9, and the Enz-Krummenacher-Vittoz
(EKV) model are the most notable, for they provide new approaches to representing the behavior of
MOSFETs [1]. For example, the HSPICE Level 28 model improves the dependence of accuracy upon
device dimensions by expressing the parameters as
P = P0 + α
 1
L −
1
Lref

+ β
 1
W −
1
Wref

+ γ
 1
L −
1
Lref
  1
W −
1
Wref

(17.50)
where Lref and Wref denote the dimensions of a “reference” device, i.e., a transistor whose character-
istics have been measured. Thus, the dependence is expressed in terms of increments with respect to
characterized transistors rather than the absolute value of the dimensions, yielding a potentially higher
accuracy. Also, the term proportional to the product of the length and width increments facilitates curve
ﬁtting.
The EKV model [11] substantially departs from traditional views of MOSFET operation by con-
sidering the bulk, rather than the source, as the reference point for all voltages. This approach thus
avoids distinguishing between the source and drain terminals and, more important, introduces a single
drain-source current equation that is valid for both subthreshold and saturation regions.
The reader is referred to [1] for an extensive study of these models.
17.3.6 Charge and Capacitance Modeling
The simple gate capacitance model described in Chapter 2 for the Level 1 model, called the Meyer
capacitance model [1], suffers from many shortcomings even for long-channel devices. In transient
SPICE analyses, such a model does not conserve charge (!), thereby introducing errors in the simulation.
For example, as illustrated in Fig. 17.16, a periodic rectangular waveform applied to a voltage divider
consisting of an ideal capacitor and a MOSFET experiences “droop” at the output because in every
period, some charge at node X is lost. This effect arises from the calculation of charge by integrating
capacitor voltages with respect to time, an operation that accumulates small errors in the simulation.6
To minimize this type of error, the simulation algorithm can be modiﬁed such that it ﬁrst computes the
charge in the inversion layer and the depletion region and subsequently partitions the charge among the
device capacitances.
C1
M1
Vin
Vout
t
Vin
t
Vout
X
Figure 17.16
Annihilation of charge in simulation.
Another issue in the Meyer charge model relates to partitioning of the channel charge between the
source and drain terminals. The assumption that in the triode region, CGS = CGD = (1/2)W LCox +
WCov, and in the saturation region, CGS = (2/3)W LCox + WCov and CGD = WCov is inaccurate for
6Another source of error here is the assumption that the device capacitances are reciprocal, e.g., CGS = CSG [1].

708
Chap. 17
Short-Channel Effects and Device Models
short-channel devices, requiring ﬂexible partitioning for ease of curve ﬁtting. In BSIM and BSIM3, for
example, three different charge partitioning scenarios (40%/60%, 50%/50%, and 0%/100%) are available.
Recent efforts have created more sophisticated charge and capacitance models for MOS devices so
as to improve the accuracy, especially for analog applications. However, as with many other modeling
improvements, the resulting equations are quite cumbersome, imparting little intuition. The reader is
referred to [1] for details.
17.3.7 Temperature Dependence
Many parameters of MOS transistors vary with temperature, making it difﬁcult to maintain a reasonable
ﬁt between measured and simulated behavior across a wide temperature range. In the Level 1–3 models
as well as BSIM and BSIM2, the following parameters have temperature dependence: VT H, built-in
potential of S/D junctions, the intrinsic carrier concentration of silicon (ni), the bandgap energy (Eg),
and the mobility. Most equations are empirical, e.g.,
Eg = 1.16 −7.02 × 10−4T 2
T + 1108
(17.51)
and
μ = μ0
300
T
3/2
(17.52)
where μ0 = μ(T = 300 K).
BSIM3 incorporates a few more parameters to represent the temperature dependence of phenomena
such as velocity saturation and the effect of subthreshold voltage on VT H. It is unclear at this point how
accurately BSIM3 expresses the temperature variation of MOS devices and circuits.
17.4
Process Corners
Unlike bipolar transistors, MOSFETs suffer from substantial parameter variations from wafer to wafer
and from lot to lot. Despite decades of technology advancement, the large variability of CMOS circuits
remains a fact with which digital and analog designers must cope.
Inordertofacilitatethetaskofcircuitdesigntosomeextent,processengineersguaranteeaperformance
envelope for the devices, in essence tightening the anticipated parameter variations by discarding wafers
that fall out of the envelope (Fig. 17.17). Of course, in their eternal battle, circuit designers insist on
a tighter variability space so that they can design more aggressively, whereas process engineers tend
Performance
Process
Parameter 2 
Process
Parameter 1 
Acceptable
Envelope
Figure 17.17
Performance envelope as a function of process parameters.

Problems
709
to enlarge the envelope as much as possible so as to increase the yield. For example, it is common in
today’s CMOS technologies to obtain a gate delay that varies by a factor of two to one with process and
temperature.
The performance envelope furnished to designers has traditionally been one suited to digital circuits
and constructed in the form of “process corners.” Illustrated in Fig. 17.18, the idea is to constrain the
speed envelope of the NMOS and PMOS transistors to a rectangle deﬁned by four corners: fast NFET
and fast PFET; slow NFET and slow PFET; fast NFET and slow PFET; and slow NFET and fast PFET.
For example, transistors having a thinner gate oxide and lower threshold voltage fall near the fast corner.
The device models corresponding to each corner are extracted from wafers whose NMOS or PMOS
test structures display a large or small gate delay, and the actual corners are chosen so as to obtain an
acceptable yield. Thus, only wafers satisfying these speciﬁcations are considered acceptable. Simulation
of circuits for various process corners and temperature extremes is essential to determining the yield.
NFET
Speed
PFET
Speed
Acceptable
Wafers
Figure 17.18
Processcornersbasedon
speed of NMOS and PMOS devices.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3
V where necessary. Also, assume that all transistors are in saturation.
17.1. Silicon dioxide breaks down at high electric ﬁelds. Explain what happens if ideal scaling is performed while
keeping the gate oxide thickness constant.
17.2. The maximum doping level that can be established in the source and drain regions is limited by the “solid
solubility” of silicon. Explain what happens to the S/D junction capacitance and series resistance as ideal
scaling occurs, but the S/D doping level remains constant. Does DIBL become more or less signiﬁcant?
17.3. Suppose the supply voltage of a switched-capacitor ampliﬁer is reduced by a factor of two and so is the
maximum allowable output voltage swing. In order to maintain the dynamic range constant, the noise voltage
must scale down by the same factor.
(a) If the noise is only of kT/C type, how should the capacitors in the circuit be scaled?
(b) If the time constant is given by Gm/C, where Gm denotes the transconductance of a one-stage op amp,
how should Gm be scaled to maintain the same small-signal time constant?
(c) How should the dimensions and tail current of the input differential pair of the op amp be scaled?
(d) Repeat parts (b) and (c) where the slew rate must remain constant.
17.4. Explain how each parameter in Eq. (17.16) scales in an ideal constant-ﬁeld scaling scenario. What happens
to the subthreshold slope?
17.5. A common-gate stage designed for an input impedance of 50  undergoes ideal scaling. If λ = γ = 0, what
is the input impedance?
17.6. Repeat Problem 17.5 if λ ̸= 0, γ ̸= 0, and the load is a MOS current source that is also scaled.
17.7. For power-conscious applications, a ﬁgure of merit is deﬁned as the transconductance of devices normalized
to their bias current. Determine this quantity for long-channel devices operating in strong inversion or the
subthreshold region. At what drain current are these two equal?

710
Chap. 17
Short-Channel Effects and Device Models
17.8. Explain why the mobile charge density cannot drop to exactly zero at any point along the channel. What
happens beyond the pinch-off point?
17.9. Using Eq. (17.21), calculate the transconductance of a MOSFET. What happens if the overdrive voltage is
very small or very large?
17.10. Using Eq. (17.30), calculate the transconductance of a MOSFET. Prove that
gm =
ID
VGS −VT H
⎡
⎢⎢⎣1 +
1
1 +

μ0
2vsat L + θ

(VGS −VT H)
⎤
⎥⎥⎦
(17.53)
17.11. Suppose the channel-length modulation coefﬁcient λ is modiﬁed as λ/(1 + κVDS), where κ is a constant,
to represent the dependence of the output impedance upon VDS. Calculate rO. Explain how a current source
with such behavior introduces distortion in the voltage across it.
17.12. Assuming that the devices in Fig. 17.19 experience complete velocity saturation, derive expressions for the
voltage gain of each circuit in terms of W and vsat. Assume that λ = γ = 0.
VDD
M1
M2
ISS
Vout
M3
M4
Vin
M1
Vin
VDD
Vout
RD
(a)
(b)
Figure 17.19
17.13. Using Eq. (17.37), calculate gmb and compare the result with that derived in Chapter 2.
17.14. From Eq. (17.51), determine ∂Eg/∂T at room temperature and explain how it affects bandgap reference
voltages.
17.15. Suppose the fast corners of a process result from a higher μCox. Explain what happens to the voltage gain and
the input thermal noise of the circuits shown in Fig. 17.20 at the four corners of the process if the transistors
are biased at a constant current in saturation.
M1
Vin
VDD
M2
Vout
Vb
M1
Vin
VDD
M2
Vout
(a)
(b)
Figure 17.20
17.16. Repeat Problem 17.15 if each transistor is biased with a ﬁxed VGS.

References
711
References
[1] D. P. Foty, MOSFET Modeling with SPICE (Upper Saddle River, NJ: Prentice-Hall, 1997).
[2] Y. Tsividis, Operation and Modeling of the MOS Transistor, 2nd ed. (Boston: McGraw-Hill, 1999).
[3] P. Antognetti and G. Massobrio, eds., Semiconductor Device Modeling with SPICE (New York: McGraw-Hill,
1988).
[4] R. H. Dennard et al., “Design of Ion-Implanted MOSFETs with Very Small Physical Dimensions,” IEEE J. of
Solid-State Circuits, vol. 9, pp. 256–268, October 1974.
[5] G. E. Moore, “Progress in Digital Integrated Circuits,” IEDM Tech. Dig., pp. 11–14, December 1975.
[6] Y. Taur and T. H. Ning, Fundamentals of Modern VLSI Devices (New York: Cambridge University Press, 1998).
[7] C. G. Sodini, P. K. Ko, and J. L. Moll, “The Effect of High Fields on MOS Device and Circuit Performance,”
IEEE Tran. on Electron Devices, vol. 31, pp. 1386–1393, October 1984.
[8] P. K. Ko, “Approaches to Scaling,” in N. G. Einspruch and G. Gildenblat, eds., Advanced MOS Device Physics,
pp. 1–35 (San Diego: Academic Press, 1998).
[9] S. Wong and A. T. Salama, “Impact of Scaling on MOS Analog Performance,” IEEE J. of Solid-State Circuits,
vol. 18, pp. 106–114, February 1983.
[10] H. Shichman and D. A. Hodges, “Modeling and Simulation of Insulated Field Effect Transistor Switching
Circuits,” IEEE J. of Solid-State Circuits, vol. 3, pp. 285–289, September 1968.
[11] C. C. Enz, F. Krummenacher, and E. Vittoz, “An Analytical MOS Transistor Model Valid in All Regions of
Operation and Dedicated to Low Voltage and Low Current Applications,” Analog Integrated Circuits and Signal
Processing, vol. 8, pp. 83–114, 1995.
[12] Y. Tsividis and K. Suyama, “MOSFET Modeling for Analog Circuit CAD: Problems and Prospects,” IEEE J.
of Solid-State Circuits, vol. 29, pp. 210–216, March 1994.
[13] B. Razavi, “CMOS Technology Characterization for Analog and RF Design,” IEEE J. of Solid-State Circuits,
vol. 34, pp. 268–276, March 1999.

CHAPTER
18
CMOS Processing Technology
With the high-order effects of MOS devices covered in Chapter 17, we now study the fabrication of
CMOS technologies. A solid understanding of device processing proves essential in the design and lay-
out of ICs because many limitations imposed on the performance of circuits are related to fabrication
issues. Furthermore, today’s semiconductor technology demands that process engineers and circuit de-
signers interact regularly so as to understand each other’s needs, necessitating a good knowledge of each
discipline.
In this chapter, we deal with the processing technology of CMOS devices, aiming to provide a simple
view of the fabrication steps and their relevance to circuit design and layout. We begin with a brief descrip-
tion of basic fabrication steps, such as wafer processing, photolithography, oxidation, ion implantation,
deposition, and etching. Next, we study the fabrication sequence of MOS transistors in detail. Finally,
we describe the processing of passive devices and interconnections.
18.1
General Considerations
Before delving into a detailed study of fabrication, it is instructive to consider the basic structure of NMOS
and PMOS transistors and predict the required processing steps. As shown in Fig. 18.1, a p-type substrate
(wafer) serves as the foundation upon which n-wells, source/drain regions, gate dielectric, polysilicon, n-
well and substrate ties, and metal interconnects are built. Considering both the side view and the top view,
we may raise the following questions: (1) How are various regions deﬁned so accurately? For example,
how is a gate polysilicon line with a minimum dimension of 0.25 μm fabricated while maintaining
a distance of 0.25 μm from another polysilicon line? (2) How are the n-wells and S/D regions built?
(3) How are the gate oxide and polysilicon fabricated? (4) How are the gate oxide and polysilicon aligned
with the S/D regions? (5) How are the contact windows created? (6) How are the metal interconnect
layers deposited?
Modern CMOS technologies involve more than 200 processing steps, but for our purposes, we can
view the sequence as a combination of the following operations: (1) wafer processing to produce the
proper type of substrate; (2) photolithography to precisely deﬁne each region; (3) oxidation, deposi-
tion, and ion implantation to add materials to the wafer; and (4) etching to remove materials from the
wafer. Many of these steps require “heat treatment,” i.e., the wafer must undergo a thermal cycle inside
a furnace.
712

Sec. 18.2
Wafer Processing
713
n+
n+
p−substrate
p+
p+
n+
p+
Metal 1
n−well
Top View
Dielectric
A
A′
AA′ Cross Section
Figure 18.1
Side view and top view of MOS devices.
In semiconductor processing and characterization, we often refer to the “sheet resistance” of a layer.
The total resistance of a rectangular bar is R = ρL/(W · t), where ρ is the resistivity of the material
and L, W, and t denote the length, width, and thickness of the bar, respectively. In integrated circuits,
the resistivity and thickness of the layers are set by fabrication materials and processing steps and cannot
be changed in the layout. The quantity R□= ρ/t is thus deﬁned as the sheet resistance, combining two
constants of the technology. Since R = R□for W = L, i.e., for a square geometry, we express R□in terms
of ohms per square. For example, for a sheet resistance of 10 /□, a geometry with W = 2 μm and
L = 20 μm has a resistance of R = 10 /□×(20/2) = 100 . In fact, we may say “this line is 10 squares
long,” meaning that L/W = 10 and R = 10R□.
18.2
Wafer Processing
The starting wafer in a CMOS technology must be created with a very high quality. That is, the wafer
must be grown as a single-crystal silicon body having a very small number of “defects,” e.g., dislocations
in the crystal or unwanted impurities. Furthermore, the wafer must contain the proper type and level of
doping so as to achieve the required resistivity.
This is accomplished by the “Czochralski method,” whereby a seed of crystalline silicon is immersed
in molten silicon and gradually pulled out while rotating. As a result, a large single-crystal cylindrical
“ingot” is formed that can be sliced thin into wafers. The diameter of the wafer has scaled up with new
technology generations, exceeding 30 cm (12 in) today. Note that dopants are added to the molten silicon
to obtain the desired resistivity. The wafers are then polished and chemically etched, thereby removing
damages on the surface that are created during slicing. In most CMOS technologies, the wafer has a
resistivity of 0.05 to 0.1 ·cm and a thickness of approximately 500 to 1,000 μm (which is reduced to a
few hundred microns after all of the processing steps).

714
Chap. 18
CMOS Processing Technology
18.3
Photolithography
Photolithography, or simply lithography, is the ﬁrst step in transferring the circuit layout information to
the wafer. As shown in the top view of Fig. 18.1 and explained in Chapter 19 in more detail, the layout
consists of polygons representing different types of “layers,” e.g., n-well, S/D regions, polysilicon, contact
windows, etc. For fabrication purposes, we decompose the layout into these layers. For example, the layout
of Fig. 18.1 can be viewed as the ﬁve different layers shown in Fig. 18.2, each of which must be created on
the wafer with a very high precision. Note that the “active” (or “diffusion”) layer includes the source/drain
regions and the p+ and n+ openings serving as the substrate and well ties.
(c)
(a)
(b)
(d)
(e)
n−well
Poly
Contact
Metal 1
Active
Figure 18.2
Layers comprising the structures of Fig. 18.1.
To understand how a layer is transferred from the layout to the wafer, let us consider the n-well pattern
of Fig. 18.2(a) as an example. This pattern is “written” to a transparent glass “mask” by a precisely
controlled electron beam [Fig. 18.3(a)]. Also, as depicted in Fig. 18.3(b), the wafer is covered by a thin
layer of “photoresist,” a material whose etching properties change upon exposure to light.1 Subsequently,
the mask is placed on top of the wafer and the pattern is projected onto the wafer by ultraviolet (UV)
light [Fig. 18.3(c)]. The photoresist “hardens” in the regions exposed to light and remains “soft” under
the opaque rectangle. The wafer is then placed in an etchant that dissolves the “soft” photoresist area,
thereby exposing the silicon surface [Fig. 18.3(d)]. Now, an n-well can be created in the exposed area.
We call this set of operations a lithography sequence.
In summary, the sequence associated with the lithography of each layer involves one mask and three
processing steps: (1) cover wafer with photoresist; (2) align mask on top and expose to light; (3) etch
exposed photoresist. The example of Fig. 18.2 therefore requires at least ﬁve masks and hence ﬁve
lithography sequences.
1In practice, a thin layer of oxide is grown before depositing the photoresist to protect the surface.

Sec. 18.4
Oxidation
715
UV Light
Substrate
(a)
(b)
(c)
(d)
Substrate
Substrate
Opaque
Polygon 
Transparent
Glass
Mask
Photoresist
Exposed
Silicon
Figure 18.3
(a) Glass mask used in lithography; (b) coverage of wafer by photoresist; (c) selective exposure of
photoresist to UV light; (d) exposed silicon after etching.
We should mention that two types of photoresists are used in processing. A “negative” photoresist
hardens in the areas exposed to light, and a “positive” photoresist hardens in the areas not exposed to
light. As explained later in this chapter, both types prove useful in fabrication.
The number of masks in a process heavily affects the overall cost of fabrication, eventually inﬂuencing
the unit price of the chip. This is so for two reasons: each mask costs tens of thousands of dollars, and,
owing to the necessary precision, lithography is a slow and expensive task. In fact, CMOS technology
originally became attractive by virtue of the relatively small number of masks—about seven—that it
required. Although in modern CMOS processes this number is around 30, the cost of each IC has
nonetheless remained low because both the number of transistors per unit area and the size of the wafer
have steadily increased.
18.4
Oxidation
A unique property of silicon is that it can produce a very uniform oxide layer on the surface with little
strain in the lattice, allowing the fabrication of gate-oxide layers as thin as a few tens of angstroms (only
several atomic layers). In addition to serving as the gate dielectric, silicon dioxide can act as a protective
coating in many steps of fabrication. Also, in areas between the devices, a thick layer of SiO2, called
the “ﬁeld oxide” (FOX) is grown, providing the foundation for interconnect lines that are formed in
subsequent steps (Fig. 18.4).
n+
n+
p−substrate
n+
n+
FOX
FOX
FOX
Figure 18.4
Field oxide.

716
Chap. 18
CMOS Processing Technology
Silicon dioxide is “grown” by placing the exposed silicon in an oxidizing atmosphere such as oxygen
at a temperature around 1, 000◦C. The rate of growth depends on the type and pressure of the atmosphere,
the temperature, and the doping level of the silicon.
The growth of the gate oxide is a very critical step in the process. Since the oxide thickness, tox,
determines both the current handling and the reliability of the transistors, it must be controlled to within
a few percent. For example, the oxide thicknesses of two transistors separated by 20 cm on a wafer must
differ by less than a few angstroms, requiring extremely high uniformity across the wafer and hence a
slow growth of the oxide. Also, the “cleanness” of the silicon surface under the oxide affects the mobility
of the charge carriers and thus the current drive, transconductance, and noise of the transistors.
18.5
Ion Implantation
In many fabrication steps, dopants must be selectively introduced into the wafer. For example, after the
lithography sequence of Fig. 18.3 is completed, the n-well is formed by entering dopants into the exposed
silicon area. Similarly, the source and drain regions of transistors require selective addition of dopants to
the wafer.
The most common method of introducing dopants is “ion implantation,” whereby the doping atoms
are accelerated as a high-energy focused beam, hitting the surface of the wafer and penetrating the
exposed areas [Fig. 18.5(a)]. The doping level (dosage) is determined by the intensity and duration of the
implantation, and the depth of the doped region is set by the energy of the beam. As shown in Fig. 18.5,
with a high energy, the peak of the doping concentration in fact occurs well below the surface, thereby
creating a “retrograde” proﬁle. Such a proﬁle is desirable for the n-well because it establishes a low
resistivity near the bottom, reducing susceptibility to latch-up (Sec. 18.8), and a low doping level at the
surface, decreasing the S/D junction capacitance of PMOS devices.
n−well
Substrate
Protective
Layer
Ion Implant
Substrate
Doping
Concentration
y
(a)
(b)
Figure 18.5
(a) Ion implantation; (b) retrograde proﬁle.
Another important application of implantation is to create “channel-stop” regions between transistors.
Consider the ﬁeld oxide and the S/D junctions of M1 and M2 in Fig. 18.6(a), assuming that an interconnect
line passes on top of the ﬁeld oxide. Interestingly, the two n+ regions and the FOX form a MOS transistor
having a thick gate oxide and hence a large threshold voltage. Nonetheless, with a sufﬁciently positive
potential on the interconnect line, this transistor may turn on slightly, creating a leakage path between

Sec. 18.5
Ion Implantation
717
n+
n+
p−substrate
n+
n+
FOX
M1
M2
Poly
Interconnect
–– – – – – ––
Inversion Layer
n+
n+
p−substrate
n+
n+
M1
M2
Channel−Stop
Implant
(a)
(b)
FOX
FOX
FOX
FOX
FOX
Figure 18.6
(a) Unwanted conduction due to inversion of ﬁeld area; (b) channel-stop implant.
M1 and M2. To resolve this issue, a channel-stop implant (also called a ﬁeld implant) is performed before
the ﬁeld oxide deposition [Fig. 18.6(b)], thereby raising the threshold voltage of the ﬁeld oxide transistor
to a very large value.
Ion implantation damages the silicon lattice extensively. For this reason, the wafer is subsequently
heated to approximately 1, 000◦C for 15 to 30 minutes, allowing the lattice bonds to form again. Called
“annealing,” this operation also leads to diffusion of dopants, broadening the proﬁle in all directions. For
example, annealing results in side diffusion of S/D regions, creating overlap with the gate area. The wafer
is therefore usually annealed only once, after all implantations have been completed.
An interesting phenomenon in ion implantation is “channeling.” As shown in Fig. 18.7(a), if the
implant beam is aligned with the crystal axis, the ions penetrate the wafer to a great depth. For this reason,
the implant (or the wafer) is tilted by 7–9◦[Fig. 18.7(b)], avoiding such an alignment and ensuring a
predictable proﬁle. As explained in Chapter 19, this tilt affects the matching of transistors, necessitating
precautions in the layout.
Substrate
Ion Implant
Substrate
Doping
Concentration
y
(a)
(b)
Doping
Concentration
y
Ion Implant
Figure 18.7
(a) Effect of channeling; (b) tilt in implant to avoid channeling.

718
Chap. 18
CMOS Processing Technology
18.6
Deposition and Etching
As suggested by the structures of Fig. 18.1, device fabrication requires the deposition of various materials.
Examples include polysilicon, dielectric materials separating interconnect layers, and metal layers serving
as interconnects.
A common method of forming polysilicon on thick dielectric layers is “chemical vapor deposi-
tion” (CVD), whereby wafers are placed in a furnace ﬁlled with a gas that creates the desired material
through a chemical reaction. In modern processes, CVD is performed at a low pressure to achieve more
uniformity.
The etching of the materials is also a crucial step. For example, contact windows with very small
dimensions, e.g., 0.3 μm × 0.3 μm, and relatively large depths, e.g., 2 μm, must be etched with high
precision. Depending on the speed, accuracy, and selectivity required in the etching step, and the type
of material to be etched, one of these methods may be used: (1) “wet” etching, i.e., placing the wafer in
a chemical liquid (low precision); (2) “plasma” etching, i.e., bombarding the wafer with a plasma gas
(high precision); (3) reactive ion etching (RIE), where ions produced in a gas bombard the wafer.
18.7
Device Fabrication
With the processing operations described in the previous section, we now study the fabrication sequence
and device structures in typical CMOS technologies. We consider three categories: active devices, passive
devices, and interconnects.
18.7.1 Active Devices
Basic Transistor Fabrication
The fabrication begins with a p-type silicon wafer approximately 1 mm
thick. Following the cleaning and polishing steps, a thin layer of silicon dioxide is grown as a protective
coating on top of the wafer [Fig. 18.8(a)]. Next, to create the n-wells, a lithography sequence consisting
of photoresist deposition, exposure to UV light using the n-well mask, and selective etching is carried
out, and the n-wells are implanted [Fig. 18.8(b)]. The remaining photoresist and oxide layers are then
removed [Fig. 18.8(c)].
Recall from the previous section that a ﬁeld implant and a ﬁeld oxide growth are necessary in the
areas between the transistors. At this point in the sequence, a stack consisting of a silicon oxide layer, a
silicon nitride (Si3N4) layer, and a positive photoresist layer is created. Next, the “active” mask is used
for lithography so that only the regions between the transistors are exposed [Fig. 18.8(d)].2 Subsequently,
the channel-stop implant is performed, the photoresist is removed, and a thick oxide layer is grown in the
exposed silicon areas, producing the ﬁeld oxide. The protective nitride and oxide layers are then removed
[Fig. 18.8(e)], thereby exposing all areas where transistors are to be formed. In the subsequent diagrams,
the channel-stop implant will be omitted for the sake of clarity.
The next step involves the growth of the gate oxide, a critical operation requiring slow, low-pressure
CVD [Fig. 18.8(f)]. As explained in Chapter 2, the “native” threshold voltage of the transistors is typically
far from the desired value, necessitating a threshold-adjust implant. (The native threshold of both PMOS
and NMOS is usually more negative than desired, e.g., VT H N ≈0, and VT H P ≈−1 V.) Such an implant
is performed following the growth of the gate oxide, creating a thin sheet of dopants near the surface and
making the threshold of both NMOS and PMOS devices more positive than their nominal values.
2The n-wells are not shown for clarity.

Sec. 18.7
Device Fabrication
719
SiO2
Si3N4
N−Type Implant
n−well
p−substrate
p−substrate
p−substrate
n−well
p−substrate
Channel−Stop
Implant
(a)
(b)
(c)
(d)
p−substrate
p−substrate
Gate
Oxide
Threshold−Adjust
Implant
Threshold−Adjust
Implant
(f)
n−well
p−substrate
Poly
Poly
n−well
p−substrate
(e)
(g)
(h)
N−Type Implant
N−Type Implant
Photoresist
Regions where transistors
are to be formed.
FOX
Photoresist
FOX
FOX
Photoresist
n+
n−well
Photoresist
P−Type Implant
P−Type Implant
p−substrate
(i)
p+
p+
p+
n+
n+
n+
n+
n+
FOX
FOX
Figure 18.8
Fabrication sequence of MOS devices.

720
Chap. 18
CMOS Processing Technology
With the gate oxide in place, the polysilicon layer is deposited and the “poly mask” lithography is
carried out, resulting in the structure shown in Fig. 18.8(g). We should note that polysilicon is simply
noncrystalline (“amorphous”) silicon, a property that arises because this layer grows on top of silicon
dioxide and hence cannot form a crystal. Since polysilicon serves as a conductor, its amorphous nature
is unimportant. To reduce the resistivity of this layer, an additional implant is typically used, yielding a
sheet resistance of a few tens of ohms per square.
In the next step, the source/drain junctions of the transistors and the substrate and n-well ties are
formed by ion implantation. This step requires a “source/drain mask” and two lithography sequences.
As illustrated in Fig. 18.8(h), the ﬁrst sequence incorporates a negative photoresist, exposing the areas
to receive an n+ implant (the S/D junctions of NMOS transistors and the n-well ties). In the second
sequence [Fig. 18.8(i)], the same mask and a positive photoresist are used, exposing the areas to receive a
p+ implant (the S/D junctions of PMOS transistors and the substrate ties). Note that these implants also
dope the polysilicon layer, reducing its sheet resistance. This step completes the fabrication of the basic
transistors.
The reader may wonder why the source/drain junctions are formed after the gate oxide and polysilicon.
Suppose, as depicted in Fig. 18.9(a), these junctions were created ﬁrst. Then, the alignment of the gate
poly mask with respect to the S/D areas would become extremely critical. Even if the misalignment were
a small fraction of the minimum channel length, a gap might appear between the source (or drain) and
the gate area, prohibiting the formation of a continuous channel in the transistor. By contrast, the sequence
shown in Fig. 18.8 yields a “self-aligned” structure because the source/drain regions are implanted at
precisely the edges of the gate area and a misalignment in lithography simply makes one junction slightly
narrower than the other [Fig. 18.9(b)]. Interestingly, the ﬁrst few generations of CMOS technology were
based on the approach shown in Fig. 18.9(a), but it was soon discovered that the self-aligned structure
would lend itself to scaling much more easily.
n+
n+
p−substrate
n+
n+
p−substrate
p−substrate
n+
n+
p−substrate
N−Type Implant
(a)
(b)
Figure 18.9
(a) Formation of n+ regions before deposition of poly; (b) self-aligned structure.
Back-End Processing
With the basic transistors fabricated, the wafers must next undergo “back-end”
processing, a sequence primarily providing various electrical connections on the chip through contacts and
wires. The ﬁrst step in this sequence is “silicidation.” Since the sheet resistance of doped polysilicon and
S/D regions is typically several tens of ohms per square, it is desirable to reduce their resistance by about
an order of magnitude. Silicidation accomplishes this by covering the polysilicon layer and active areas
(S/D regions and substrate and n-well ties) with a thin layer of a highly conductive material, e.g., titanium
silicide or tungsten. Illustrated in Fig. 18.10, this step in fact begins with creating an “oxide spacer” at

Sec. 18.7
Device Fabrication
721
n+
n+
n−well
n+
p+
p+
n+
n+
p+
Oxide Spacer
Silicide
(a)
(b)
FOX
p+
n−well
n+
p+
p+
FOX
Figure 18.10
(a) Oxide spacers and (b) silicide.
the edges of the polysilicon gate such that the deposition of the silicide becomes a self-aligned process
as well.3 Without the spacer, the silicide layer on the gate may be shorted to that on the source/drain.
The next step in back-end processing is to produce contact windows on top of the polysilicon and
active regions. This is carried out by ﬁrst covering the wafer with a relatively thick (0.3- to 0.5-μm) layer
of oxide and subsequently performing a lithography sequence using the “contact mask.” The contact
holes are then created by plasma etching [Fig. 18.11(a)]. Owing to reliability issues, contacts to the gate
polysilicon are not placed on top of the gate area.
Following the contact windows, the ﬁrst layer of metal interconnect (called “metal 1”) (using aluminum
or copper) is deposited over the entire wafer. A lithography sequence using the “metal 1 mask” is then
carried out, and the metal layer is selectively etched [Fig. 18.11(b)].
The higher levels of interconnect are fabricated using the same procedure [Fig. 18.11(c)]. For each
additional metal layer, two masks are required: one for the contact windows and another for the metal
itself. Thus, a CMOS process having ﬁve layers of metal contains 10 masks for the back end. The contact
windows between metal layers are sometimes called “vias” to distinguish them from the ﬁrst level of
contacts to active areas and polysilicon.
We should mention that if a large area must be contacted, many small windows—rather than a large
window—are usually used. Dictated by reliability issues, the dimensions of each contact or via are ﬁxed
and cannot be decreased or increased by the layout designer. An interesting phenomenon related to large
active areas is “contact spiking.” If a large contact window allows aluminum to touch the active area, then,
as depicted in Fig. 18.12(a), the metal may “eat” and penetrate the doped region, eventually crossing the
junction to the bulk and shorting the diode. With small windows, on the other hand, this effect is avoided
[Fig. 18.12(b)].
The ﬁnal step in back-end processing is to cover the wafer with a “glass” or “passivation” layer,
protecting the surface against damages caused by subsequent mechanical handling and dicing. After a
lithography sequence using the “passivation mask,” the glass is opened only on top of the bond pads to
allow connection to the external environment (e.g., the package).
18.7.2 Passive Devices
Passive components such as resistors and capacitors ﬁnd wide usage in analog design, making it desirable
to add these devices to standard CMOS technologies. In practice, however, CMOS processes target
3Self-aligned silicide is sometimes called “salicide.”

722
Chap. 18
CMOS Processing Technology
SiO2
Contact Holes
Metal 1 
(a)
(b)
SiN3
(c)
n+
n+
n−well
n+
p+
p+
p+
p−substrate
Metal 2 
FOX
n+
n+
n−well
n+
p+
p+
p+
p−substrate
FOX
n+
n+
n−well
n+
p+
p+
p+
p−substrate
FOX
Figure 18.11
Contact and metal fabrication.
n+
p−substrate
Metal 1 
n+
p−substrate
Metal 1 
(a)
(b)
Gate
Gate
Figure 18.12
(a) Spiking due to large contact areas; (b) use of small contacts to avoid spiking.
primarily digital applications and hence provide only NMOS and PMOS transistors. A new generation of
CMOS technology may take one to two years and many iterations before it becomes an “analog process,”
i.e., one offering high-quality passive devices. If a digital CMOS process is to be used for analog design,
we must seek structures that can serve as passive components. The principal issue in using such structures
is the variability of the component value from wafer to wafer because the process ﬂow does not assume
such structures are used in circuits.

Sec. 18.7
Device Fabrication
723
Resistors
A CMOS process may be modiﬁed so as to provide resistors suited to analog design. A
common method is to selectively “block” the silicide layer that is deposited on top of the polysilicon,
thereby creating a region having the resistivity of the doped polysilicon (Fig. 18.13). This means that the
fabrication requires an additional mask and a corresponding lithography sequence. Since the poly doping
level is determined by various implants in the process, the resistivity obtained here is not necessarily a
target value, but it usually falls in the range of ﬁfty to a few hundred ohms per square. For the same
reason, the resistance value may vary by as much as ±20% from wafer to wafer or lot to lot.
p−substrate
FOX
Silicide Block
Silicided Poly
Poly
Figure 18.13
Poly resistor using
silicide block.
The use of silicide on the two ends of the resistor in Fig. 18.13 results in a much lower contact resistance
than that obtained by directly connecting the metal layer to doped polysilicon. This improves both the
deﬁnition of the resistor value and the matching with identical structures. Also, for a given resistance,
poly resistors typically exhibit much less capacitance to the substrate than other types—on the order of
90 aF/μm2 for the bottom plate capacitance and 100 aF/μm for the fringing capacitance. These resistors
are quite linear, especially if they are long. The primary difﬁculties with silicide-block poly resistors are
variability, mask cost, and process complexity.
In a purely digital process, silicided poly, silicided p+ or n+ active areas, n-well, and metal layers can
be used as resistors. An n-well resistor can be formed as shown in Fig. 18.14, but the n-well resistivity
may vary by several tens of percent with process. With typical sheet resistivities of about 1 k/□, n-well
resistors can prove useful where their absolute value is not critical. For example, Fig. 18.15 shows a
common-source stage that is biased by means of M0 and I0 while employing C1 to block the dc level of
the preceding stage. In order to isolate the signal path from the low impedance (and the noise) introduced
by M0, resistor R1 is inserted between X and Y. Here, the value of R1 is not critical so long as it is
sufﬁciently large.
We should mention that, due to the depletion region formed between the n-well and the p-substrate,
n-well resistors suffer from both a large parasitic capacitance and signiﬁcant voltage dependence. Fig-
ure 18.16 illustrates a typical case, where one terminal of the n-well resistor is tied to VDD. Since the
capacitance to the substrate is distributed (nonuniformly) along the resistor, a lumped model may not be
accurate enough, but as a rough approximation, we place half of the total capacitance on each side of the
resistor. We also note that as Vout varies, so do the width of the depletion region and hence the value of
the resistor.

724
Chap. 18
CMOS Processing Technology
p−substrate
FOX
n−well
n+
n+
n−well
Figure 18.14 Resistor made of n-well.
M1
C1
R1
Vin
M0
VDD
M2
Vout
I0
C0
X
Y
Figure 18.15
Use of an n-well resistor
in a coupling network.
M1
VDD
Vout
R1
Vin
n−well n+
n+
M1
VDD
Vout
R1
Vin
Depletion
Region
M1
VDD
Vout
R1
Vin
C1
C2
Figure 18.16
Common-source stage using n-well resistors.
The metal layers available in CMOS technologies exhibit sheet resistances on the order of 100 m/□
(for bottom layers) to 30 m/□(for top layers). Thus, for resistor values common in analog design, metal
layers are rarely used.
Capacitors
Capacitors prove indispensible in most of today’s analog CMOS circuits. Several parame-
ters of capacitors are critical in analog design: parasitic capacitance to the substrate, capacitance per unit
area (density), and nonlinearity.

Sec. 18.7
Device Fabrication
725
Perhaps the simplest capacitor structure in CMOS technology is that implemented by a MOSFET.
Illustrated in Fig. 18.17(a), the device has a capacitance that varies from a small value at low voltages
(where no channel exists and the equivalent capacitance is the series combination of the oxide capacitance
and the depletion region capacitance) to a large value (Cox) if the voltage difference exceeds VT H. Since
the gate oxide is typically the thinnest layer in the process, MOS capacitors biased in strong inversion
are quite dense, saving substantial area if large values are required. For the same reason, the bottom-
plate parasitic, i.e., that due to drain and source junctions, is a relatively small percentage of the gate
capacitance—typically 10 to 20%.
n+
n+
p−substrate
VC
VC
VC
Cch
(a)
(b)
Figure 18.17
(a) MOSFET conﬁgured as a capacitor; (b) nonlinear C/V characteristic.
Unfortunately,thevoltagedependenceofMOScapacitors,eveninstronginversion,makesthestructure
less attractive for precision charge transfer.
▲
Example18.1
Consider the multiply-by-two ampliﬁer of Sec. 13.3.3, shown in Fig. 18.18(a) as an implementation using a MOS
capacitor C1 and a linear capacitor C2. Explain how the output voltage in the ampliﬁcation mode is distorted.
Vin
Vout
C1
Vout
C1
VC
Cch
(b)
(a)
C2
C2
Figure 18.18
Precision multiply-by-two circuit using a MOS capacitor.
Solution
Suppose for simplicity that Vin is below ground by more than VT H, so that the NMOS capacitors are in strong
inversion during sampling. As the circuit enters the ampliﬁcation mode, the voltage across C1 approaches zero and
the total charge stored on C1 is transferred to C2. How much is this charge? If C1 were linear, we would have
Q = C1V , but here we must write dQ = C1dV . Thus, as shown in Fig. 18.18(b), the total transferred charge when
the voltage across the capacitor goes from Vin to zero is equal to the area under the C/V characteristic, a value
substantially less than that in the linear case. The output voltage is then given by
Vout ≈Vin + 1
C2
 Vin
0
C1dV
(18.1)
▲

726
Chap. 18
CMOS Processing Technology
n+
n+
Rtot
Rtot
2
Rtot
2
Cch
RS
Figure 18.19
Channel resistance of MOS capacitor.
Another issue related to MOS capacitors is their series resistance, an effect arising from the gate
material and, more important, the channel resistance. Assuming that proper layout minimizes the gate
resistance, we view the channel resistance as shown in Fig. 18.19, estimating the equivalent series
resistance as (Rtot/2)∥(Rtot/2) = Rtot/4, where Rtot = [μCox(W/L)(VGS −VT H]−1. The intrinsic time
constant of the capacitor is therefore equal to
τ = Rtot
4 Cch
(18.2)
=
1
4μCox(W/L)(VGS −VT H) · W LCox
(18.3)
=
L2
4μ(VGS −VT H)
(18.4)
In reality, the distributed nature of the resistance and the capacitance along the channel results in a
time constant equal to one-third of that given above [2]. Another ﬁgure of merit for such a capacitor is
Q = [1/(Cω)]/RS. As a rule of thumb, we choose RS < 0.1/(Cω).
Equation (18.4) indicates that for a given overdrive, to minimize the series resistance of a MOS
capacitor, L must be minimized. Consequently, MOS capacitors are usually designed as a parallel com-
bination of wide, short devices rather than as a square block (Fig. 18.20). The penalty is a higher junction
capacitance to the substrate and somewhat greater area.
Poly
Poly
Figure 18.20
Use of wide, short MOS ﬁngers to reduce channel resistance.
In applications requiring linear capacitors, a “sandwich” of conductive layers can be formed in CMOS
technology. Shown in Fig. 18.21 is an example, where the capacitance between metal layers is exploited
to increase the density. Since the dielectrics between the layers are relatively thick, this structure still
requires a large area. More important, the bottom-plate parasitic (e.g., the capacitance between the lowest
layer and the substrate in Fig. 18.21) is signiﬁcant, about 5 to 10% of the total interplate capacitance.
This structure is studied in detail in Chapter 19.

Sec. 18.7
Device Fabrication
727
C1
Substrate
Cp
C2
C3
C4
C= C1 + … + C4 
Metal 9 
Metal 8 
Metal 7 
Metal 6 
Metal 5 
Figure 18.21
Linearcapacitormadeof
native conductive layers.
▲
Example18.2
An ampliﬁer with an input capacitance of Cin is to be ac-coupled to a preceding stage having an output resistance
Rout. Considering both of the topologies depicted in Fig. 18.22 and allowing a maximum signal attenuation of
20%, determine the minimum value of the coupling capacitor and the resulting time constant if CP = 0.5CC or
CP = 0.2CC.
Rout
CC
CP
Cin
Rout CC
CP
Cin
(a)
(b)
X
X
Figure 18.22
Solution
In Fig. 18.22(a), the attenuation is given by Av = CC/(CC + Cin), yielding CC ≥4Cin for a 20% signal loss. The
total capacitance seen from node X to ground is therefore equal to CP + CCCin/(CC + Cin) = CP + 0.8Cin. It
follows that the time constant is 2.8RoutCin for CP = 0.5CC and 1.6RoutCin for CP = 0.2CC.
In Fig. 18.22(b), CP itself attenuates the signal: Av = CC/(CC + Cin + CP), indicating that no value of CC can
yield a signal loss of 20% if CP ≥0.25CC.
These calculations yield two important results. First, the topology of Fig. 18.22(a) is generally preferable. Second,
the addition of a coupling capacitor, e.g., to isolate the bias levels, substantially degrades the speed.
▲
18.7.3 Interconnects
The performance of today’s complex integrated circuits heavily depends on the quality of the available
interconnects, requiring more metal layers in new generations of the technology.4 Proper modeling of
interconnects in a high-performance circuit is still a topic of active research, but our objective is to provide
a basic understanding of the interconnect issues.
4At the time of this writing, ﬁve layers of metal are in production.

728
Chap. 18
CMOS Processing Technology
Two properties of interconnects, namely, series resistance and parallel capacitance, affect the per-
formance, often calling for iteration between layout and circuit design. The series resistance becomes
especially problematic in supply and ground lines, creating dc and transient voltage drops. Also, for long
signal lines, the distributed resistance and capacitance of the wire may result in a signiﬁcant delay.
The resistance of metal wires can be easily estimated at low frequencies, at which skin effect is
negligible. Typical sheet resistances are 30 m/□for the topmost (thickest) layer and 100 m/□for lower
layers. The ﬁnite resistance of wires inﬂuences the choice of line widths for high-current interconnects
such as supply and ground buses, as illustrated by the following example.
▲
Example18.3
A D/A converter incorporates N equal current sources implemented as NMOS devices, each having an aspect ratio
of W/L [Fig. 18.23(a)]. Assuming that the interconnect between every two consecutive current sources has a small
resistance, r, estimate the mismatch between IN and I1.
M1
M2
MN
I1
I2
Vb
r
r
r
r
r
r
I1
I2
IN
1
2
N
(a)
(b)
IN
Figure 18.23
Effect of ground resistance in a D/A converter.
Solution
If r is sufﬁciently small, the circuit can be modeled as shown in Fig. 18.23(b), where I1 ≈I2 ≈· · · ≈IN = I. The
voltage at node N is obtained by superposition of currents:
VN = Ir + I (2r) + · · · + I (Nr)
(18.5)
= N(N + 1)
2
Ir
(18.6)
If VN is relatively small, the assumption that I1 ≈I2 ≈· · · ≈IN used in the above calculation is reasonable and
M1–MN exhibit roughly equal transconductances. Thus,
IN = I −gmVN
(18.7)
= I −gmr N(N + 1)
2
I
(18.8)
= I

1 −gmr N(N + 1)
2

(18.9)
Since V1 ≈N · I · r, we have I1 = I −gm N · I · r, and the relative mismatch between I1 and IN is

I1 −IN
I
 = gmr N(N −1)
2
(18.10)
The key point here is that the error grows in proportion to N2. The ground bus must therefore be sufﬁciently wide
to minimize r.
▲

Sec. 18.7
Device Fabrication
729
Another factor determining the width of interconnects is “electromigration.” At high current densities,
the aluminum atoms in a wire tend to “migrate,” leaving a void that eventually (after some years of
operation) grows to a discontinuity. For this reason, long-term reliability considerations restrict the
maximum current density of interconnects. As a rule of thumb, a current density of 2 mA per micron of
width is acceptable, but the actual value varies according to the thickness of the metal. Also, for transient
currents, the peak value may be quite a lot higher.
The problem of interconnect capacitance is much more complicated. We begin with a single wire on
top of a substrate (Fig. 18.24), identifying a “parallel-plate” capacitance and a “fringe” capacitance. For
narrow lines, the two are comparable.
Substrate
Fringe
Capacitance
t
W
h
Figure 18.24
Parallel-plate and fringe capacitance of an interconnect.
A simple empirical relationship for calculating the total wire capacitance per unit length on top of a
conducting substrate is
C = ϵ

W
h + 0.77 + 1.06
W
h
0.25
+ 1.06
 t
h
0.5	
(18.11)
where W, h, and t denote the dimensions shown in Fig. 18.24 [3]. For typical dimensions, this equation
predicts the capacitance with a few percent of error.
While upper levels of metal in a process exhibit less capacitance per unit width and length, their
minimum allowable width is usually greater than that of the lower layers. Thus, the minimum capacitance
for a given length may be only slightly smaller for the topmost layer(s). Table 18.1 depicts typical values
of minimum widths and parallel-plate and fringe capacitances (to the substrate) in a four-metal 0.25-μm
process.
Table 18.1
Minimum widths and capacitances of interconnects in a 0.25-μm
technology.
Poly
Metal 1 
Minimum Width
(μm)
Metal 2
Metal 4 
Bottom−Plate
Capacitance
(aF/μm2)
0.25
0.35
0.45
0.50
0.60
90
30
15
9.0
7.0
110
80
50
40
30
Fringe Capacitance
(Two Sides)
(aF/μm)
Metal 3
Wires also suffer from parallel and fringe capacitances between them. Illustrated in Fig. 18.25, this
effect is difﬁcult to quantify for a complex layout, often necessitating the use of computer programs. In

730
Chap. 18
CMOS Processing Technology
Substrate
Figure 18.25
Complex interconnect structure.
practice, the capacitances between the layers are calculated by “electromagnetic ﬁeld solvers,” measured
experimentally, and tabulated in the process design manual.
18.8
Latch-Up
Owing to manufacturing difﬁculties, the ﬁrst few generations of MOS technologies provided only NMOS
devices. In fact, many of the early microprocessors and analog circuits were fabricated in NMOS pro-
cesses, but they consumed substantial power. The advent of CMOS technology was motivated by the zero
static power dissipation of CMOS logic—although CMOS devices required a greater number of masks
and fabrication steps. Another issue that did not exist in NMOS implementations but arose in CMOS
circuits was latch-up.
Consider the NMOS and PMOS devices shown in Fig. 18.26(a). Recall from Chapter 12 that a parasitic
pnp bipolar transistor, Q1, is associated with the PFET, the n-well, and the substrate. By the same token,
a parasitic npn device, Q2, can be identiﬁed in conjunction with the NFET. We make two observations:
(1) the base of each bipolar transistor is inevitably tied to the collector of the other; and (2) owing to
the ﬁnite resistance of the n-well and the substrate, the bases of Q1 and Q2 see a nonzero resistance to
VDD and ground, respectively. The parasitic circuit can therefore be drawn as in Fig. 18.26(b), revealing
a positive feedback loop around Q1 and Q2. In fact, if a current is injected into node X such that VX
rises, then IC2 increases, VY falls, |IC1| increases, and VX rises further. If the loop gain is greater than or
equal to unity, this phenomenon continues until both transistors turn on completely, drawing an enormous
current from VDD. We say that the circuit is latched up.
n+
n+
n+
p+
p+
p+
VDD
VDD
Q2
Q1
X
Y
M1
M2
R1
R2
Q2
Q1
R2
R1
VDD
Y
X
(a)
(b)
Drain
Drain
Figure 18.26
(a) Parasitic bipolar transistors in a CMOS process; (b) equivalent circuit.
The initial current required to trigger latch-up may be produced by various sources in an integrated
circuit. For example, in Fig. 18.26(a), the bases of Q1 and Q2 are capacitively coupled to the drains of M1
and M2, respectively. A large voltage swing at the drains can therefore inject a signiﬁcant displacement
current into the n-well or the substrate, initiating latch-up.

References
731
A common case of latch-up occurs with the use of large digital output buffers (inverters). These circuits
inject high currents into the substrate through the large drain junction capacitance of the transistors and
by forward-biasing the source-bulk junction diodes. The latter arises because of the substantial transient
voltages produced across the bond wires connected to the ground (Chapter 19).
In order to prevent latch-up, both process engineers and circuit designers take precautions to ensure
that the loop gain of the equivalent circuit shown in Fig. 18.26(b) remains well below unity. Proper
choice of the doping levels and proﬁles as well as layout design rules ensure a low value for both the
parasitic resistances and the current gain of the bipolar transistors. Furthermore, the layout of the circuit
incorporates substrate and n-well contacts with sufﬁciently small spacing to minimize the resistance. The
design manual of each technology typically provides an extensive set of layout rules recommended for
latch-up prevention.
References
[1] C. Kaya et al., “Polycide/Metal Capacitors for High Precision A/D Converters,” IEDM Dig. of Tech. Papers,
pp. 782–785, December 1988.
[2] P. Larsson, “Parasitic Resistance in an MOS Transistor Used as On-Chip Decoupling Capacitor,” IEEE J. Solid-
State Circuits, vol. 32, pp. 574–576, April 1997.
[3] E. Barke, “Line-to-Ground Capacitance Calculations for VLSI: A Comparison,” IEEE Trans. on Commputer-
Aided Design, vol. 7, pp. 195–298, February 1988.
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3 V
where necessary. Also, assume that all transistors are in saturation.
18.1. A MOS technology is designed to provide only n-type transistors and two metal layers. Sketch the fabrication
steps and determine the minimum number of masks required in this technology.
18.2. During a threshold-adjust implant, the wafer was not tilted, leading to severe channeling. Explain whether the
resulting threshold voltage is higher or lower than the target value.
18.3. The circuits of Fig. 18.27 have been fabricated with a longer-than-expected gate oxidation cycle. If the threshold
voltages are still equal to the desirable value, sketch Vout versus Vin and compare the results to the target
case.
M
VDD
M2
1
Vout
M1
Vin
VDD
M2
Vout
(a)
(b)
Vin
Figure 18.27
18.4. The circuits of Fig. 18.27 have been fabricated without a threshold-adjust implant. Sketch Vout versus Vin and
compare the results to the target case.
18.5. Due to a layout error, the circuit shown in Fig. 18.28 suffers from contact spiking in one of the junctions.
Identify the faulty junction if (a) the voltage gain is higher than expected, (b) the output voltage is near VDD.

732
Chap. 18
CMOS Processing Technology
M1
Vin
VDD
M2
Vout
RS
Figure 18.28
18.6. An NMOS cascode current source used in a large circuit exhibits a substantially lower output impedance than
expected. Determine which fabrication error may have led to this effect: (a) channeling during S/D implant,
(b) omission of the channel-stop implant, or (c) insufﬁcient gate-oxide growth.
18.7. An NMOS cascode current source has a zero output current. If a single (small) lithography misalignment has
caused this error, determine in which fabrication step(s) this may have occurred.
18.8. A differential pair using an active current mirror as load suffers from a low small-signal voltage gain. If the
bias current is equal to the target value, determine which fabrication error may have led to this effect: (a) heavy
n-well implantation, (b) heavy threshold-adjust implantation, or (c) long gate oxidation cycle.
18.9. The switched-capacitor ampliﬁer of Fig. 18.29 exhibits a large gain error. If the bias current of the op amp
is equal to the desired value, which fabrication error is likely to have happened: (a) heavy threshold-adjust
implantation, (b) very heavy doping in the bottom plate of C1 (placed at node P), or (c) channeling during the
S/D implantation?
Vout
Vin
C1
S1
S3
S2
P
Figure 18.29
18.10. In Fig. 18.30, the digital circuit draws large transient currents from VDD. Without M1, the inductor Lb would
sustain a large transient voltage LbdIDD/dt. Transistor M1 with W/L = 100/0.5 is added to suppress this
effect.
M1
Digital
Circuit
IDD
X
Lb
VDD
Figure 18.30
(a) Calculate the equivalent series resistance of M1.
(b) Calculate the maximum value of Lb that results in a critically-damped response at node X. Model the
digital circuit by a transient current source.
18.11. In the circuit of Fig. 18.23, Vb = 1.2 V, N = 32, and (W/L)1−N = 20/0.5. Determine the maximum value
of r for a maximum current mismatch of 1%.
18.12. Suppose that in Eq. (18.11), t = 1 μm and h = 3 μm. For what value of W are the parallel-plate and fringe
capacitances equal? What if h = 5 μm?

CHAPTER
19
Layout and Packaging
In the past 40 years, analog CMOS circuits have evolved from low-speed, low-complexity, small-signal,
high-voltage topologies to high-speed, high-complexity, low-voltage “mixed-signal” systems containing
a great deal of digital circuitry. While device scaling has enhanced the raw speed of transistors, unwanted
interaction between different sections of integrated circuits as well as nonidealities in the layout and
packaging are increasingly limiting both the speed and the precision of such systems. Today’s analog
circuit design is very heavily inﬂuenced by layout and packaging.
In this chapter, we study principles of layout and packaging, emphasizing the effects that manifest
themselves when analog and digital circuits coexist on a chip. For the sake of brevity, we use the term
“analog” to mean both “analog” and “mixed-signal.” Beginning with an overview of layout design rules,
we study a number of topics related to the layout of analog circuits, including multiﬁnger transistors,
symmetry, reference distribution, passive device layout, and interconnects. Next, we deal with the problem
of substrate coupling. Finally, we describe packaging issues, analyzing the effect of self- and mutual
inductance and capacitance of external connections to integrated circuits.
19.1
General Layout Considerations
The layout of an integrated circuit deﬁnes the geometries that appear on the masks used in fabrication.
From Chapter 18, the geometries include n-well, active, polysilicon, n+ and p+ implants, interlayer
contact windows, and metal layers.
Figure 19.1 shows an example, where the mask geometries required for a PMOS transistor are drawn.
It is important to note the following: (1) the n-well surrounds the device with enough margin to ensure
that the transistor is contained in the well for all expected misalignments during fabrication; (2) each
n−well
Poly
n+ Implant
p+ Implant
Active
Metal 1 
Contact
Figure 19.1
Layout of a PMOS
transistor.
733

734
Chap. 19
Layout and Packaging
“active” area (S/D regions and n+ contact to the well) is surrounded by a proper implant geometry
with enough margin; (3) from the fabrication steps described in Chapter 18, the gate requires its own
mask; (4) the contact windows mask provides connection from active and poly regions to the ﬁrst layer
of metal.
In most modern layout tools, the implants and even the n-wells are automatically generated from the
remainder of the transistor geometries, reducing the number of layers that the layout designer draws or
sees on the computer screen and simplifying the task.
19.1.1 Design Rules
While the width and length of each transistor are determined by circuit design, most of the other dimen-
sions in a layout are dictated by “design rules,” i.e., a set of rules that guarantees proper transistor and
interconnect fabrication despite various tolerances in each step of processing. Most design rules can be
categorized under one of the four groups described here.
Minimum Width
Thewidths(andlengths)ofthegeometriesdeﬁnedonamaskmustexceedaminimum
value imposed by both lithography and the processing capabilities of the technology. For example, if a
polysilicon rectangle is excessively narrow, then, owing to fabrication tolerances, it may simply break
or at least suffer from a large local resistance (Fig. 19.2). In general, the thicker a layer, the greater
its minimum allowable width, indicating that as technologies scale, the thickness must be decreased
proportionally. Figure 19.3 depicts examples of minimum widths in a 40-nm technology. Note that the
thickness of the layers is not under the control of the layout designer.
W1
Figure 19.2
Excessive width variation
in a narrow poly line.
Poly
Metal 1 
Substrate
150 nm
100 nm
40 nm
80 nm
Figure 19.3
Widths and thicknesses of poly and metal lines.
Minimum Spacing
The geometries built on the same mask or, in some cases, different masks must
be separated by a minimum spacing. For example, as shown in Fig. 19.4(a), if two polysilicon lines
are placed too close to each other, they may be shorted. As another example, consider the case shown
in Fig. 19.4(b), where a polysilicon line runs close to the S/D area of a transistor. A minimum spac-
ing is required here to ensure that the implant surrounding the transistor does not overlap with the
poly line.
Minimum Enclosure
We mentioned earlier that in the layout of Fig. 19.1, the n-well and the p+
implant must surround the transistor with sufﬁcient margin to guarantee that the device is contained by
these geometries despite tolerances. These are examples of minimum enclosure rules. Figure 19.5 depicts

Sec. 19.1
General Layout Considerations
735
S1
n+ Implant
S2
 Poly Line
(a)
(b)
Figure 19.4
(a) Short between two excessively close poly lines; (b) minimum spacing between active and poly.
 Poly 
Metal 1 
E2
E1
Figure 19.5
Enclosure rule for poly
and metal surrounding a contact.
another example, where a poly contact window connects a poly line to a metal 1 line. To ensure that
the contact remains inside the poly and metal 1 squares, both geometries must enclose the contact with
enough margin.
Minimum Extension
Some geometries must extend beyond the edge of others by a minimum value.
For example, as shown in Fig. 19.6, the gate polysilicon must have a minimum extension beyond the
active area to ensure proper transistor action at the edge.
A
A′
X1
p−substrate
Gate Oxide
AA′ Cross Section
FOX
FOX
Figure 19.6
Extension of poly beyond
the gate area.
In addition to the minimum dimensions speciﬁed in the previous four categories, some maximum
allowable dimensions may also be enforced. For example, for long metal wires, the minimum width is
typically larger than that for short wires to avoid “liftoff” problems. Other such rules relate to the “antenna
effect,” described in the next section.
Figure 19.7 summarizes a small subset of design rules governing the layout of an NMOS differential
pair with PMOS current-source loads. Modern CMOS technologies typically involve several hundred
layout design rules.

736
Chap. 19
Layout and Packaging
A1
A7
A2
A3
A4
A5
A6
A8
A1 : Active−Active Spacing
A2 : Metal Width
A4 : Enclosure of Contact by Active
A3 : Metal−Metal Spacing
A5 : Poly−Active Spacing
A6 : Active−Well Spacing
A8 : Poly−Poly Spacing
A7 : Enclosure of Active by Well
Figure 19.7
Layout of a differential pair with PMOS current-source loads.
19.1.2 Antenna Effect
Suppose the gate of a small MOSFET is tied to a metal 1 interconnect having a large area [Fig. 19.8(a)].
During the etching of metal 1, the metal area acts as an “antenna,” collecting ions and rising in potential.
It is therefore possible that the gate voltage of the MOS device increases so much that the gate oxide
breaks down (irreversibly) during fabrication.
Metal 2 
Metal 1 
Metal 1 
(a)
(b)
Figure 19.8
(a) Layout susceptible to antenna effect; (b) discontinuity in metal 1 layer to avoid antenna effect.
The antenna effect may occur for any large piece of conductive material tied to the gate, including
polysilicon itself. For this reason, submicron CMOS technologies typically limit the total area of such
geometries, thereby minimizing the probability of gate-oxide damage. If large areas are inevitable, then a
discontinuity can be created as illustrated in Fig. 19.8(b) so that, when metal 1 is being etched, the large
area is not connected to the gate.
19.2
Analog Layout Techniques
The extensive sets of design rules enforced by mainstream CMOS processes aim to maximize the yield
of digital ICs while allowing moderately aggressive circuit design. Analog systems, on the other hand,
demand many more layout precautions so as to minimize effects such as crosstalk, mismatches, noise, etc.

Sec. 19.2
Analog Layout Techniques
737
19.2.1 Multiﬁnger Transistors
As mentioned in Chapter 2, wide transistors are usually “folded” so as to reduce both the S/D junction area
and the gate resistance. A simple folded structure such as that in Fig. 19.9(a) may prove inadequate for
very wide devices, necessitating the use of multiple “ﬁngers” [Fig. 19.9(b)]. As a rule of thumb, the width
of each ﬁnger is chosen such that the resistance of the ﬁnger is less than the inverse transconductance
associated with the ﬁnger. In low-noise applications, the gate resistance must be one-ﬁfth to one-tenth
of 1/gm.
(a)
(b)
S
D
D
S
Figure 19.9
(a) Simple folding of a MOSFET; (b) use of multiple ﬁngers.
▲
Example19.1
A 5-μm/40-nm MOSFET biased at 1 mA exhibits a transconductance of 1/(100 ). If the sheet resistance of the
gate polysilicon is equal to 30 /□, what is the widest ﬁnger that the structure can incorporate while ensuring that
the gate thermal noise voltage is one-ﬁfth of the gate-referred channel thermal noise voltage?
Solution
If the transistor is laid out as N parallel ﬁngers, each ﬁnger exhibits a distributed resistance of 30  × (5/0.04)/N.
Using the gate-referred channel thermal noise from Chapter 7, we have for the overall transistor
Channel Noise =

4kT γ (100) V/
√
Hz
(19.1)
Gate Noise =

4kT
150
0.04N2
1
3 V/
√
Hz
(19.2)
where the factor 1/3 on the right-hand side of (19.2) accounts for the distributed nature of the resistance (Chapter 7).
Equating (19.1) to ﬁve times (19.2) and assuming that γ = 1, we have
N = 17.7
(19.3)
Thus, a minimum of 18 ﬁngers is required.
▲
While the gate resistance can be reduced by decomposing the transistor into more parallel ﬁngers,
the capacitance associated with the perimeter of the source/drain areas increases. As exempliﬁed by the
structures depicted in Fig. 19.10,1 with three ﬁngers, the total perimeter of the source or the drain is equal
to 2(2E + 2W/3) = 4E + 4W/3, whereas with ﬁve ﬁngers, it is equal to 3(2E + 2W/5) = 6E + 6W/5.
1The use of multiple ﬁngers is sometimes called “interdigitization.”

738
Chap. 19
Layout and Packaging
D
D
S
S
W
3
W
5
(a)
(b)
E
Figure 19.10
Layout of a transistor using (a) three ﬁngers and (b) ﬁve ﬁngers.
In general, for an odd number of ﬁngers N, the S/D perimeter capacitance is given by
CP = N + 1
2

2E + 2W
N

C jsw
(19.4)
=

(N + 1)E + N + 1
N
W

C jsw
(19.5)
Thus, the number of ﬁngers multiplied by E must be much less than W so as to minimize the S/D
perimeter capacitance contribution. In practice, this requirement may conﬂict with that for minimizing
the gate resistance noise, demanding a compromise between the two or contacting the gate on both ends
to reduce the resistance.
For transistors having a large number of gate ﬁngers, the structure may be modiﬁed to that shown in
Fig. 19.11, thereby avoiding long geometries and hence disproportionate dimensions in the layout of the
overall circuit.
Figure 19.11
Layout of a wide transis-
tor with many ﬁngers.
The layout of a cascode circuit can be simpliﬁed if the input device M1 and the cascode device M2
have equal widths. As shown in Fig. 19.12(a), the drain of M1 and the source of M2 can share the same
junction. More important, since this junction is not connected to any other node, it need not accommodate
a contact window and can therefore be quite a lot smaller [Fig. 19.12(b)]. Consequently, the capacitance at

Sec. 19.2
Analog Layout Techniques
739
M1
M2
(c)
(a)
(b)
M1
M2
M1
M2
Figure 19.12
Layout of cascode devices having the same width.
the drain of M1 is reduced substantially, improving the high-frequency performance. For wide transistors,
each transistor may use two or more ﬁngers [Fig. 19.12(c)].
19.2.2 Symmetry
Recall from Chapter 14 that asymmetries in fully differential circuits introduce input-referred offsets, thus
limiting the minimum signal level that can be detected. While some mismatch is inevitable, inadequate
attention to symmetry in the layout may result in large offsets—much greater than the values predicted
by the statistical treatment of Chapter 14. Symmetry also suppresses the effect of common-mode noise
and even-order nonlinearity. It is important to note that symmetry must be applied to both the devices of
interest and their surrounding environment. We return to this point later.
Let us consider the differential pair of Fig. 19.13(a) as the starting point. If, as depicted in Fig. 19.13(b),
the two transistors are laid out with different orientations, the matching suffers greatly because many
steps in lithography and wafer processing behave differently along different axes.
M1
M2
(c)
(a)
(b)
(d)
Figure 19.13
(a) Differential pair; (b) layout of M1 and M2 with different orientations; (c) layout with
gate-aligned devices; (d) layout with parallel-gate devices.
Thus, one of the conﬁgurations in Fig. 19.13(c) and (d) provides a more plausible solution. The choice
between these two is determined by a subtle effect called “gate shadowing.” Illustrated in Fig. 19.14, the

740
Chap. 19
Layout and Packaging
Source/Drain Implant
Shadowed
Region
Asymmetry
n+
n+
Figure 19.14
Shadowing due to implant tilt.
shadowing is caused by the gate polysilicon during the source/drain implantation because the implant (or
the wafer) is tilted by about 7◦to avoid channeling (Chapter 18). As a result, a narrow strip in the source
or drain region receives less implantation, creating a small asymmetry between the source and drain side
diffusions after the implanted areas are annealed.
Now consider the structures of Figs. 19.13(c) and (d) in the presence of gate shadowing (Fig. 19.15). In
Fig. 19.15(a), if the shadowed terminal is distinguished as the drain (or the source), then the two devices
sustain no asymmetry resulting from shadowing. In Fig. 19.15(b), on the other hand, the transistors are
not identical even if the shadowed terminals are distinguished because the source region of M1 “sees”
M2 to its right, whereas the source region of M2 sees only the ﬁeld oxide. Similarly, the drains of M1
and M2 see different structures to their left. In other words, the surrounding environment of M1 is not
identical to that of M2. For this reason, the topology of Fig. 19.15(a) is preferable.
D
S
D
S
(a)
S
(b)
D
S
D
M1
M2
M1
M2
Figure 19.15
Effect of shadowing on (a) gate-aligned and (b) parallel-gate transistors.
The asymmetry inherent in the structures of Fig. 19.15(b) can be ameliorated by adding “dummy”
transistors to the two sides so that M1 and M2 see approximately the same environment (Fig. 19.16).
However, in more complex circuits, e.g., in a folded-cascode op amp, such measures cannot be easily
applied. We will see later that a simpler version of dummies proves useful and essential in today’s
technologies.
S
D
S
D
M1
M2
Dummy
Dummy
Figure 19.16
Addition of dummy devices to improve symmetry.
We should emphasize the importance of maintaining the same environment on the two sides of the
axis of symmetry. For example, in the structure of Fig. 19.17, an unrelated metal line passing over only

Sec. 19.2
Analog Layout Techniques
741
(a)
(b)
M1
M2
M1
M2
Figure 19.17
(a) Asymmetry resulting from a metal line passing over M2; (b) removing the asymmetry by
replicating the line on top of M1.
one transistor indeed degrades the symmetry, increasing the mismatch between M1 and M2. In such
cases, either a replica must be produced on the other side [Fig. 19.17(b)] (even though the replica may
be grounded) or, preferably, the source of asymmetry must be removed.
M1
M2
Gradient
Figure 19.18
Effect of gradient in a differential pair.
Symmetry becomes more difﬁcult to establish for large transistors. In the differential pair of Fig. 19.18,
for example, the two transistors have a large width so as to achieve a small input offset voltage, but
gradients along the x axis give rise to appreciable mismatches. To reduce the error, a “common-centroid”
conﬁguration may be used such that the effect of ﬁrst-order gradients along both axes is canceled.
Illustrated in Fig. 19.19, the idea is to decompose each transistor into two halves that are placed diagonally
M1
2
1
M2
2
1
M1
2
1
M2
2
1
Figure 19.19
Common-centroid layout.

742
Chap. 19
Layout and Packaging
M1b
M2b
M3b
M4b
M1a
M2a
M3a
M4a
(a)
(b)
Cox
Cox + ΔCox
Cox + 2ΔCox Cox + 3ΔCox
Cox
Cox + ΔCox
Cox + 2ΔCox Cox + 3ΔCox
Figure 19.20
One-dimensional cross-coupling.
opposite each other and connected in parallel.2 However, the routing of interconnects in this layout is
quite difﬁcult, often leading to systematic asymmetries of the type depicted in Fig. 19.17(a) or in the
capacitances from the wires to ground and between the wires. For a larger circuit, e.g., an op amp, the
routing may become prohibitively complex. We thus seek simpler solutions.
The effect of linear gradients can be suppressed by “one-dimensional” cross-coupling, as depicted in
Fig. 19.20. Here, all four half transistors are placed along the same axis, and M1 and M2 are formed
by connecting either the near ones and the far ones [Fig. 19.20(a)] or every other one [Fig. 19.20(b)].
(For clarity, the connections between the sources and the drains are not shown.) To analyze the effect of
gradients in these structures, let us assume that, for example, the gate-oxide capacitance varies by Cox
from each half transistor to the next.3 Placing M1a and M4a in parallel, we have
ID1a + ID4a = 1
2μn(Cox + Cox + 3Cox)W
L (VGS −VT H)2
(19.6)
and for M2a and M3a,
ID2a + ID3a = 1
2μn(Cox + Cox + Cox + 2Cox)W
L (VGS −VT H)2
(19.7)
2The interconnect lines shown in this ﬁgure are only conceptually correct.
3In reality, variation of Cox inﬂuences the threshold voltage as well. We neglect this effect here.

Sec. 19.2
Analog Layout Techniques
743
This type of cross-coupling therefore cancels the effect of the gradient. Now, for the conﬁguration of
Fig. 19.20(b), we have
ID1b + ID3b = 1
2μn(Cox + Cox + 2Cox)W
L (VGS −VT H)2
(19.8)
and
ID2b + ID4b = 1
2μn(Cox + Cox + Cox + 3Cox)W
L (VGS −VT H)2
(19.9)
Equations (19.8) and (19.9) suggest that this approach removes the error to a lesser extent.
The reader can prove that for small gradients in other device parameters, similar results are obtained,
concluding that the topology of Fig. 19.20(a) contains smaller errors than that of Fig. 19.20(b). However,
since the environment seen by M2a + M3a differs from that seen by M1a + M4a, dummy transistors must
be added to the left of M1a and the right of M4a.
19.2.3 Shallow Trench Isolation Issues
Modern MOS devices are surrounded by a shallow “trench” so as to avoid the formation of a channel
between adjacent transistors [Fig. 19.21(a)]. Called “shallow trench isolation” (STI) and created automat-
ically, this structure is ﬁlled with oxide and exhibits a different thermal expansion coefﬁcient from that
of silicon. As a result, during fabrication steps, the STI and the enclosed silicon area expand and contract
differently. This STI-induced “stress” alters the electrical properties of the MOS transistor, introducing
substantial error in its I/V characteristics.
G
S
D
Shallow
Trench
G
D
S
Dummy
Fingers
G
S
D
G
D
S
S
D
(c)
(a)
(b)
Figure 19.21
(a) Shallow trench isolation surrounding a device, (b) use of dummy ﬁngers to reduce STI-induced
stress, and (c) multiﬁnger transistor example.

744
Chap. 19
Layout and Packaging
In order to alleviate this issue, we must minimize the propagation of the stress toward the gate area.
To this end, we insert two ﬁngers on the two sides of the main device [Fig. 19.21(b)]. These “dummy”
ﬁngers and their associated S/D junctions are typically grounded to ensure that they do not interfere with
the operation of the main transistor. Note, however, that the dummy gates increase the S/D capacitances
to ground.
For transistors employing multiple ﬁngers, the dummy gates can be simply added to the two ends of
the array [Fig. 19.21(c)].
19.2.4 Well Proximity Effects
As explained in Chapter 18, an n-well is formed by an N-type implant onto the exposed areas of silicon.
The unexposed areas are covered by a thick layer consisting of oxide and photoresist [Fig. 19.22(a)].
Unfortunately, the implant does not occur at a 90◦angle with respect to the wafer, thus reﬂecting from
the walls formed by oxide and photoresist and creating nonuniform doping in the n-well. That is, the
border areas of the n-well receive a different doping density from those in the middle of the n-well.
Consequently, the PMOS devices located near the edges of the n-well have different I/V characteristics
compared to those in the middle. We call this effect the “well proximity” error. For example, the current
mirror arrangement shown in Fig. 19.22(b) exhibits mismatches between M1 and M2 or M3 because M1
is more heavily inﬂuenced by the implant reﬂections.
p−substrate
Photoresist
Oxide
VDD
n−well
n−well
A
M1
M2
M3
(a)
(b)
Figure 19.22
(a) Effect of implant reﬂection on n-well doping uniformity, and (b) current mirror arrangement
showing the effect of n-well edges.
To reduce the well proximity effect, the n-well must extend well beyond the PMOS devices. For
example, A in Fig. 19.22(b) can be chosen greater than several microns.
19.2.5 Reference Distribution
In analog systems, the bias currents and voltages of various building blocks are derived from one or
more bandgap reference generators. The distribution of such references across a large chip entails a
number of important issues. Consider the example depicted in Fig. 19.23, where IRE F is produced
by a bandgap reference and M1–Mn serve as bias current sources of building blocks that are located
far from MRE F and from each other. If the matching between ID1–IDn and IRE F is critical, then the
voltage drop along the ground line must be taken into account. In fact, for a large number of circuits
connected to the same ground line, the systematic mismatch between the current sources and IRE F may be
unacceptable.
To remedy the above difﬁculty, the reference can be distributed in the current domain rather than in
the voltage domain. Illustrated in Fig. 19.24, the idea is to route the reference current to the vicinity of the

Sec. 19.2
Analog Layout Techniques
745
MREF
M1
M2
Circuit 1
Circuit 2 
Mn
Circuit n 
M0
IREF
Wire Resistance
Figure 19.23
Distribution of a reference voltage for current mirror biasing.
MREF1
M1
Circuit 1 
M0a
IREF1
VDD
M0b
IREF2
MREF2
M2
Circuit 2 
Wire Resistance
Figure 19.24
Distribution of current to reduce the effect of interconnect resistance.
building blocks and perform the current mirror operation locally. At the destination, bypass capacitors
suppress any noise that the long interconnects may pick up. Placing the interconnect resistance in series
with current sources, this approach lowers systematic errors if the building blocks appear in dense groups
in different regions on the chip. However, mismatches between IRE F1 and IRE F2 and between MRE F1
and MRE F2 introduce error. In large systems, it may be advantageous to employ several local bandgap
reference circuits so as to alleviate routing problems.
Another issue in the circuits of Figs. 19.23 and 19.24 relates to the orientation of the transistors. As
mentioned in Sec. 19.2.2, if, for example, MRE F and M1–Mn in Fig. 19.23 have different orientations, then
substantial mismatches arise. Since circuits 1, 2, . . . , n may be laid out individually, particular attention
must be paid to the orientation of their current sources while the entire chip is assembled.
The scaling of currents in Figs. 19.23 and 19.24 also demands careful choice of device dimensions
and layout. Suppose the circuit of Fig. 19.23 requires ID1 = 0.5IRE F and ID2 = 2IRE F. How do we
choose (W/L)1 and (W/L)2 with respect to (W/L)RE F? Recall from Chapter 2 that, owing to the side
diffusion of the source/drain regions, the effective channel length is less than the drawn length by 2L D, a
poorly controlled quantity. Thus, to avoid large mismatches, the lengths of the transistors must be equal
and the currents must be scaled by proper choice of the widths. We then choose that W1 = 0.5WRE F
and W2 = 2WRE F. Figure 19.25 shows how MRE F, M1, and M2 in this example are laid out to ensure
reasonable matching. Note that all equivalent widths are integer multiples of a unit value, Wu. Transistor
M1 is identical to MRE F except that half of its source remains ﬂoating (or connected to the drain). To
improve the matching, the array can be surrounded by dummy devices.

746
Chap. 19
Layout and Packaging
MREF
M1
 M2
2
1
 M2
2
1
IREF1
I1
I2
Floating Source
Wu
Figure 19.25
Proper scaling of device dimensions for adequate matching of current sources.
19.2.6 Passive Devices
Resistors
Polysilicon resistors using a silicide block exhibit high linearity, low capacitance to the
substrate, and relatively small mismatches. The linearity of these resistors in fact depends on their length
[1], necessitating accurate measurement and modeling for high-precision applications. Figure 19.26
depicts an example in which the nonlinearity of the resistor is critical. Since Vout = −Iin RF, the accuracy
of current-to-voltage conversion depends on the linearity of RF. In practice, however, the op amp limits
the linearity.
Iin
RF
Vout
Figure 19.26
Feedback ampliﬁer
converting a voltage to current.
As with other devices, the matching of polysilicon resistors is a function of their dimensions. For
example, resistors having a length and width of a few microns display typical mismatches on the order
of 0.2%. Most of the symmetry rules described for the layout of MOS devices apply to resistors as well.
For example, resistors that are required to bear a well-deﬁned ratio must consist of identical units placed
in parallel or in series (with the same orientation).
▲
Example19.2
Consider the bandgap circuit shown in Fig. 19.27. Choose the values of n, R1, and R2 such that Vout exhibits a zero
temperature coefﬁcient and the layout can be designed for high precision.
Solution
Since Vout = VBE3+VT (R2/R1) ln n, we must ﬁnd convenient values of n, R1, and R2 such that (R2/R1) ln n ≈17.2
(Chapter 12). If n = 31, then R2/R1 ≈5, yielding the layout of Fig. 19.28(a). Note that R1 is placed in the middle
to partially cancel the effect of gradients.
Now suppose we choose n = 25, obtaining R2/R1 = 5.34. Such a value cannot be accurately established by
simply adjusting the dimensions of R2 and R1. Rather, we write R2/R1 = 16/3 and construct the resistors as shown
in Fig. 19.28(b).

Sec. 19.2
Analog Layout Techniques
747
Q1
A
Q2
nA
VDD
R1
M2
M1
M3
M4
M5
Q3
R2
Vout
Figure 19.27
R2
R1
Dummy
Dummy
1
3 R1
1
3 R1
1
3 R1
4 Series Units
4 Series Units
4 Series Units
4 Series Units
Dummy
Dummy
(a)
(b)
1 R2
4
1 R2
4
1 R2
4
1 R2
4
Figure 19.28
Layout of R1 and R2 with (a) R2/R1 = 5 and (b) R2/R1 = 5.34 ≈16/3.
▲
The resistance of the polysilicon structure studied above consists of two components: that due to the
unsilicided region and the resistance associated with the two contacts. As depicted in Fig. 19.29(a), the
Substrate
Poly
Interface
Resistance
Resistor Layout
(a)
(b)
Metal 1 
Silicide
Figure 19.29
(a) Top view and cross section of a poly resistor, and (b) doubling the width and length to reduce
the effect of contact resistance.

748
Chap. 19
Layout and Packaging
narrow contact window (about 80 nm×80 nm in 40-nm technology) results in a high interface resistance
between metal 1 and the silicide area. This component is poorly controlled and must preferably remain
much less than the ﬁrst. For example, the length and width of the structure in Fig. 19.29(a) can be doubled
so as to halve the total contact resistance while keeping the unsilicided region’s resistance approximately
constant [Fig. 19.29(b)].
For large values, resistors are usually decomposed into shorter units that are laid out in parallel and
connected in series [Fig. 19.30(a)]. From the viewpoint of matching and reproducibility, this struc-
ture is preferable to “serpentine” topologies [Fig. 19.30(b)], where the corners contribute signiﬁcant
resistance.
(a)
(b)
Figure 19.30
(a) Layout of large resistors; (b) serpentine topology.
The sheet resistance, R□, of polysilicon resistors varies with temperature and process, necessitating
provisions in the design for this variation. The temperature coefﬁcient depends on the doping type and
level and must be measured for each technology. Typical values are +0.1% /◦C and −0.1% /◦C for p+
and n+ doping, respectively. The variation with process is usually less than ±20%.
Width
(μm)
R
800
600
(Ω
)
1
5
/
Figure 19.31
Dependence of n-well
sheet resistance upon resistor width.
In technologies lacking a silicide block mask, resistors may be made of n-well, source/drain p+ or n+
material, silicided polysilicon, or metal, with R□decreasing in this order. The sheet resistance of n-well
is typically around 1 k, but it may vary by a large fraction, e.g., ±40%, with process. Furthermore, R□
depends on the width of the resistor, as exempliﬁed by the plot of Fig. 19.31. This is because, with a depth
of several microns, n-well regions exhibit width-dependent diffusion at the edges. Also, R□is a strong
function of the n-well–substrate voltage difference, giving rise to both nonlinearity and poor deﬁnition
of the value of the resistor. For example, in the circuit of Fig. 19.32, resistors RS and RD suffer from
large mismatches in R□because the depletion region below RS is quite a lot narrower than that below
RD. Also, as Vout varies, so does the sheet resistance of RD, introducing nonlinearity. Resistors made of
n-well display a TC of +0.2% to +0.5% /◦C.
▲
Example19.3
An A/D converter incorporates a resistor ladder consisting of 128 units made of n-well to generate equally-spaced
reference voltages (Fig. 19.33). If the two ends of the ladder are connected to V1 = +1 V and V2 = +2 V, calculate
the ratio R128/R1.

Sec. 19.2
Analog Layout Techniques
749
M1
RD
Vout
RS
Vin
VDD
X
Y
n+
n+
p−substrate
n−well
X
n+
n+
n−well
VDD
Y
Depletion Region
RD
RS
Figure 19.32
Common-source stage using n-well resistors.
R128
R127
VREF128
VREF127
R1
V2
V1
Figure 19.33
Resistor ladder used in
an A/D converter.
Solution
The width of the depletion region inside the n-well is given by xd = √2ϵsi(φB + VR)/(qNwell), where Nwell
denotes the n-well doping level and VR the reverse bias voltage. Assuming that the zero-bias depth of the n-well is
equal to t0, we have
R128
R1
=
t0 −

2ϵsi
qNwell
(φB + V1) +

2ϵsi
qNwell
φB
t0 −

2ϵsi
qNwell
(φB + V2) +

2ϵsi
qNwell
φB
(19.10)
=
t0 +

2ϵsi
qNwell
φB

1 −

1 + V1
φB

t0 +

2ϵsi
qNwell
φB

1 −

1 + V2
φB

(19.11)

750
Chap. 19
Layout and Packaging
If the difference between R1 and R128 is small, we can divide the numerator and denominator of (19.11) by t0 and
approximate the result as
R128
R1
≈

1 + 1
t0

2ϵsi
qNwell
φB

1 −

1 + V1
φB

1 −1
t0

2ϵsi
qNwell
φB

1 −

1 + V2
φB

(19.12)
≈1 + 1
t0

2ϵsi
qNwell
φB

1 + V2
φB
−

1 + V1
φB

(19.13)
For example, if t0 = 2 μm, Nwell = 1016 cm−1, and φB = 0.7 V, the mismatch between R128 and R1 is nearly 60%.
▲
The p+ and n+ source/drain regions can also be used as resistors. With a sheet resistance of 20 to 30
ohms per square, silicided S/D regions are suited only to low-value resistors. Furthermore, the junction
between these areas and the bulk introduces capacitance and voltage dependence.4
Silicided polysilicon has a sheet resistance of 20 to 30 ohms per square and can be utilized for low
resistor values. While suffering from less capacitance to the substrate than n+ or p+ resistors, silicided
polysilicon has a process-dependent R□, with variations as high as 20 to 30%. Thus, it can be used only
if its absolute value is not critical, for example, in the resistor ladder of Fig. 19.33. The temperature
coefﬁcient of this type of resistor is between +0.2 and +0.4%/◦C.
The metal layers in a process can provide very low resistor values. For example, in extremely high-
speed A/D converters, the ladder of Fig. 19.33 may be constructed as simply a long metal line having
equally spaced taps (Fig. 19.34). Note, however, that if the width of the metal resistor is small, matching
suffers. The temperature coefﬁcient of the resistance is about 0.3%/◦C for aluminum.
VREF128
VREF127
VREF126
VREF1
V1
V2
Figure 19.34
Resistor ladder made of
metal.
Capacitors
As explained in Chapter 18, linear capacitors are designed using sandwiches made of the
available conductive layers. For example, in a process having nine layers of metal, the capacitors can be
formed as shown in Fig. 19.35. The choice of one topology over another is determined by two factors:
(1) the area occupied by the capacitor and (2) the ratio of the bottom-plate parasitic capacitance to the
4The nonlinearity of n-well resistors is much higher because the low doping level in the n-well results in a greater sensitivity
to the voltage with respect to the substrate.

Sec. 19.2
Analog Layout Techniques
751
interplate capacitance, CP/C. In typical technologies, the capacitance between consecutive metal layers
(e.g., C1 or C2) in Fig. 19.35(d) is on the order of 35 to 40 aF/μm2, and that between metal 1 and
polysilicon is about 60 aF/μm2. Thus, the structure of Fig. 19.35(d) provides more than nine times the
density of that in Fig. 19.35(a). On the other hand, the value of CP increases from Fig. 19.35(a) to
Fig. 19.35(d). With typical values, CP/C reaches a minimum—about 5 to 10%—for the structure of
Fig. 19.35(b) or (c) and increases to about 20% for the sandwich of Fig. 19.35(d).
Since the absolute value of interlayer capacitances is poorly controlled in digital technologies, the
capacitors of Fig. 19.35 may experience process variations as high as 20%. By contrast, the gate-oxide
capacitance is typically controlled with less than 5% error. Interestingly, the structure of Fig. 19.35(d)
may suffer from less variation than the others because random variations in the capacitances between
various layers tend to “average out.”
C1
Substrate
Cp
C1
Substrate
Cp
C2
C1
Substrate
Cp
C2
C3
C1
Substrate
Cp
C2
Poly
(c)
(a)
(b)
(d)
C = C1 
C = C1 + C2 
C = C1 + C2 + C3
C = C1 + … + C9
Metal 9
Metal 8
Metal 9
Metal 8
Metal 7
Metal 9
Metal 8
Metal 7
Metal 6
Metal 9
Metal 8
Metal 7
C9
Figure 19.35
Capacitor structures using various conductive layers.
We have thus far neglected the fringe capacitance. As depicted in Fig. 19.36, the electric ﬁeld lines
emanating from the edge of each plate must terminate on the edge of the other plate or on the substrate,

752
Chap. 19
Layout and Packaging
Substrate
Fringe
Lines
Figure 19.36
Fringe component of
capacitance.
giving rise to a fringe capacitance that must be taken into account. The fringe capacitance can be calculated
using Eq. (18.11) or from tabulated values in the process design manual.
As explained in Chapter 18, a MOS transistor with its source and drain tied together can act as a
capacitor if the gate-source potential is sufﬁcient to establish an inversion layer. However, the voltage
dependence of the capacitance limits the use of this structure.
The layout of capacitors for high-precision circuits must follow the principles described earlier for
transistors and resistors. For example, in applications where an array of well-matched capacitors is
required, dummy devices must be placed on the perimeter of the array.
▲
Example19.4
The circuit of Fig. 19.37(a) is designed for a nominal gain of C1/C2 = 8. How should C1 and C2 be laid out to
ensure precise deﬁnition of the gain?
C2
C1
Vout
Vin
C1
C2
Dummy
Units
(a)
(b)
Figure 19.37
Solution
We form C1 as 8 unit capacitors, each equal to C2, and place all of the units in a square array [Fig. 19.37(b)]. Note that
(1) C2 is symmetrically surrounded by the units comprising C1 so that the effect of vertical or horizontal gradients is
canceled to the ﬁrst order; and (2) dummy capacitor units are placed around the main array, creating approximately
the same environment for the units of C1 as that seen by C2.
▲
For large capacitor arrays, cross-coupling techniques such as those illustrated in Figs. 19.20 and 19.27
can be applied. However, unlike transistors and resistors, capacitors are quite sensitive to the wiring capac-
itance, demanding great care in the interconnection of the units. Even in the simple array of Fig. 19.37(b),
it is difﬁcult to route all of the top-plate and bottom-plate connections while introducing no additional
capacitance. As the layout of Fig. 19.38 exempliﬁes, the wiring inevitably leads to some error in the ratio
C1/C2.

Sec. 19.2
Analog Layout Techniques
753
Figure 19.38
Layout of capacitors
along with interconnections.
Diodes
Two types of pn junctions can be formed in a standard CMOS technology: one in the p-
substrate and another in an n-well (Fig. 19.39). The former must remain reverse biased and can therefore
serve only as a voltage-dependent capacitor (varactor), e.g., in voltage-controlled oscillators.
n+
p−substrate
n−well
p+
n+
p+
Figure 19.39
Diodes in CMOS technology.
The diode formed in an n-well also faces difﬁculties if forward biased. Recall from Chapter 12 that the
p+ region in the n-well, the n-well itself, and the p-substrate constitute a bipolar pnp transistor whose
collector is typically grounded. Thus, if the pn junction in the n-well is forward biased, substantial current
ﬂows from the p+ terminal to the substrate. In other words, the structure must not be viewed as merely
a two-terminal ﬂoating diode. Nonetheless, if reverse-biased, the device can serve as a varactor.
Owing to these difﬁculties, analog CMOS circuits rarely incorporate forward-biased diodes (except
in bandgap circuits).
19.2.7 Interconnects
Modern CMOS processes offer a dozen metal layers for interconnection, but the cost may dictate the use
of eight or nine. Many effects related to wires must be taken into account when a high-precision and/or
high-speed circuit is laid out.
Capacitance
The parallel-plate and fringe capacitance of wires may degrade the speed if long intercon-
nects are required. For example, in a mixed-signal system (e.g., using many switched-capacitor circuits),
the clock signal must be distributed over long wires to access various building blocks, thereby experi-
encing signiﬁcant line capacitance. More important, the capacitance between lines introduces substantial
coupling of signals.
Figure 19.40 illustrates an example of cross talk between signals. Here, a common-source stage and
a NAND gate are located next to each other, and the two inputs to the gate, VA and VB, cross over the
analog signal, Vin. Furthermore, the clock wire, CK, is laid out in parallel with Vin, and the output of
the NAND gate has some overlap with the output of the common-source stage. Each of the coupling
capacitances in this layout may corrupt Vin or Vout. Note that, even though the coupling capacitances are

754
Chap. 19
Layout and Packaging
VDD
M1
Vout
VA
VB
VA·B  
Vin
CK
Figure 19.40
Capacitive coupling
between various lines in a typical layout.
small, the signal corruption may be appreciable because the voltage swings on VA, VB, VA·B, and CK
are large. For example, if the capacitance between CK and Vin is 50 aF, and the total capacitance seen
from Vin to ground 10 fF, then a 1-V change in CK corrupts Vin by 5 mV.
Crosstalk can be reduced through the use of two techniques. First, differential signaling converts most
of the crosstalk to common-mode disturbance. For example, if the circuit of Fig. 19.40 is modiﬁed to that
shown in Fig. 19.41, the coupling of VA and VB to V +
in and V −
in produces no differential error if C1 = C′
1
and C2 = C′
2. Even for 10% mismatch between the capacitances, the differential corruption is one order
of magnitude less than that in Fig. 19.40. Note that a dummy wire is added to the layout so as to create an
overlap capacitance between CK and V −
in equal to that between CK and V +
in . As mentioned in Chapter 4,
it is desirable to employ differential clocks as well to suppress the net coupling further.
VDD
M1
V−in
CK
VA
VB
VA·B
M2
Vout
V+
in
Dummy 
Line
C1
C2
C′2
C′1
Figure 19.41
Reduction of capacitive coupling through the use of differential signaling.
Second, sensitive signals can be “shielded” in the layout. Depicted in Fig. 19.42(a), one approach
places ground lines on the two sides of the signal, forcing most of the electric ﬁeld lines emanating from
the “noisy” lines to terminate on ground rather than on the signal. Note that this method proves more

Sec. 19.2
Analog Layout Techniques
755
Vin
VA
VB
Vin
VA
VB
(a)
(b)
Figure 19.42
(a) Shielding sensitive signals by additional ground lines; (b) greater spacing between lines to
reduce coupling.
effective than simply allowing more space between the signal and the noisy lines [Fig. 19.42(b)]. The
shielding, however, is obtained at the cost of more complex wiring and greater capacitance between the
signals and ground.
Another shielding technique is shown in Fig. 19.43. Here, the sensitive line in metal 6 is surrounded
by a grounded shield consisting of a higher and a lower metal layer and hence fully isolated from external
electric ﬁeld lines.5 However, the signal experiences higher capacitance to ground, and the use of three
metal layers here complicates the routing of other signals.
Contact
Metal 9
Metal 6
Metal 3
Figure 19.43
Shielding a sensitive line
(metal 2) by lower and upper ground
planes.
Resistance
Theresistanceofinterconnectsalsorequiresattention.Inlow-noiseapplications,longsignal
wires—with sheet resistances of 40 to 80 m/□—may introduce substantial thermal noise. Furthermore,
the contacts and vias also suffer from a high resistance. For example, an 80-nm × 80-nm metal contact
to silicided polysilicon exhibits a resistance of 30 to 40 , and a via between metal 1 and metal 2, a
resistance of 5 to 10 .
▲
Example19.5
In the layout of Fig. 19.44, a 100-μm metal 4 line is connected to a sequence of vias and contacts to reach the gate
of a transistor. Calculate the thermal noise contributed by the line and the contacts.
Solution
Assuming R□= 40 m/□for metal 4, a via resistance of 5 , and a poly contact resistance of 30 , we have
Rtot = 2 + 2.5 + 2.5 + 2.5 + 15 = 24.5 . The thermal noise voltage is thus equal to 0.64 nV/
√
Hz at room
5We assume that the ground connection itself does not contain noise. We return to this issue in Sec. 19.4.

756
Chap. 19
Layout and Packaging
Metal 4
Metal 3
Metal 2
Metal 1
2 μm 
Figure 19.44
temperature. If guiding the input signal to a low-noise ampliﬁer, this interconnect arrangement considerably raises
the input-referred noise.
▲
Vin
Vout
t
Vin
Vout
TD
Figure 19.45
Delay and dispersion of a signal in a long line.
The distributed resistance and capacitance of long interconnects may introduce signiﬁcant delay and
“dispersion” in signals. Illustrated in Fig. 19.45, the delay can be approximated as
TD = 1
2 RuCuL2
(19.14)
where Ru and Cu denote the resistance and capacitance per unit length, respectively, and L is the total
length. For example, consider the circuit shown in Fig. 19.46, where an array of samplers senses the
analog input Vin and is activated by CK. If the delays experienced by CK and Vin from the left side to the
right side are unequal, then so are the levels sampled by C1, . . . , Cn, distorting the sampled waveform.
Even if the clock and signal lines and their capacitive loading are identical, CK and Vin may still suffer
from unequal delays because the former is a rectangular wave and the latter is not.
S1
C1
S2
C2
Sn
Cn
CK
Vin
Figure 19.46
An array of sampling circuits sensing an input.
Theterm“dispersion”referstothesigniﬁcantincreaseinthetransitiontimeofthesignalasitpropagates
through a line, a particularly troublesome effect if a clock edge is to deﬁne a sampling point. In the example
of Fig. 19.46, the clock waveform applied to Sn displays long rise and fall times, making the sampling
susceptible to both noise and distortion [4]. The clock edges can be sharpened by inserting an inverter

Sec. 19.2
Analog Layout Techniques
757
between CK and every switch, but at the cost of greater uncertainty in the delay difference between CK
and Vin.
As mentioned in Chapter 18, the design of power and ground buses on a chip requires attention
to a number of issues. In large ICs, the dc or transient voltage drop along the buses may be signiﬁcant,
affecting sensitive circuits supplied by the same lines. Furthermore, electromigration calls for a minimum
line width to guarantee long-term reliability. With the multiple interconnect levels available in today’s
CMOS technology, it is possible to connect two or more layers in parallel, thereby reducing the series
resistance and alleviating electromigration constraints. Since the thickness of the top metal layer is
typically twice that of the lower ones, at least three layers must be placed in parallel to relax these issues
by a factor of two. As a result, routing signals and bias lines across the buses may become difﬁcult if
only one or two more layers of metal are available.
If the bias currents drawn from a long bus are relatively well deﬁned, then the bus width can be
“tapered” from one end to the other so as to create a relatively constant voltage drop along the line.
Illustrated in Fig. 19.47, this technique can be used if the metal resistance and its temperature coefﬁcient
are known.
Ground Bus
Figure 19.47
Tapered ground line for
reduction of voltage drops.
19.2.8 Pads and ESD Protection
The interface between an integrated circuit and the external environment involves a number of important
issues. In order to attach bond wires to the die, large “pads” are placed on the perimeter of the chip and
connected to the corresponding nodes in the circuit (Fig. 19.48).
Bond Pads
Circuit Core
Bond 
Wires
Figure 19.48
Addition of bonding pads to a chip.
The pad dimensions and structure are dictated by the reliability issues and margin for manufacturing
tolerances in the wire-bonding process. With bond wire diameters ranging from 25 μm to 50 μm, the
minimum pad size falls between roughly 70 μm × 70 μm and 100 μm × 100 μm. Adjacent pads are
usually separated by at least 25 μm. From the circuit design point of view, the pad dimensions must be
minimized so as to reduce both the capacitance of the pad to the substrate and the total die area.
A simple pad would consist of only a square made of the top metal layer. However, such a structure is
susceptible to “lift-off” during bonding. For this reason, each pad is typically formed by the two topmost
metal layers, connected to each other by many small vias on the perimeter (Fig. 19.49). Note that this
structure suffers from a larger capacitance to the substrate than a pad made of only the top layer.

758
Chap. 19
Layout and Packaging
Substrate
Metal 9
Metal 8
Figure 19.49
Structure of a typical
bonding pad.
▲
Example19.6
Calculate the capacitance of a metal 4 pad and a metal 4/metal 3 pad. Assume dimensions of 75 μm × 75 μm and
use the capacitance data shown in Fig. 19.50.
Metal 4
Metal 3
Substrate
9 aF/μm2
17 aF/μm
6 aF/μm2
15 aF/μm
15 aF/μm
Metal 4
Figure 19.50
Solution
For a metal 4 pad,
Ctot = 752 × 6 + 75 × 4 × 15
(19.15)
= 38.25 fF
(19.16)
For a metal 4/metal 3 pad,
Ctot = 752 × 9 + 75 × 4 × (17 + 15)
(19.17)
= 60.22 fF
(19.18)
Note that the fringe capacitances of metal 4 and metal 3 are directly added here. This is a rough approximation.
▲
The pads carrying high-frequency signals can be conﬁgured as octagons so as to reduce their capac-
itance. Depicted in Fig. 19.51, such a structure is obtained by removing the corner areas of a square
pad—without making the task of bonding more difﬁcult. If a = b, then both the area and the perimeter
of the pad fall by about 20%.
The interface between an IC and the external world also entails the problem of electrostatic discharge
(ESD). This effect occurs when an external object having a high potential touches one of the connections
to the circuit. Since the capacitance seen at each input or output is small, the ESD produces a large
voltage, damaging the devices fabricated on the chip.
A common case of ESD arises when ICs are handled by human beings. For this effect, the human body
can be modeled by a capacitance of a few hundred picofarads in series with a resistance of a few kilohms.

Sec. 19.2
Analog Layout Techniques
759
a
b
Figure 19.51
Use of octagonal pad to
reduce capacitance.
Depending on the environment, the voltage across the capacitance ranges from a few hundred volts to
several thousand volts. Thus, if a person touches a line connecting to the chip, the chip is easily damaged.
Interestingly, electrostatic discharge may occur even without actual contact because at high electric ﬁelds,
the person’s ﬁnger “arcs” to the connection through the air if the ﬁnger is sufﬁciently close to the line.
It is important to note that ESD may occur even without human intervention. If not properly grounded,
various objects in a typical chip assembly line accumulate charge, rising to high potential levels. Further-
more, charge in dry air may create substantial potential gradients with respect to ground.
MOS devices sustain two types of permanent damage as a result of ESD. First, the gate oxide may
break down if the electric ﬁeld exceeds roughly 107 V/cm (e.g., 2 V for an oxide thickness of 20
◦
A),
typically leading to a very low resistance between the gate and the channel. Second, the source/drain
junction diodes may melt if they carry a large current in forward or reverse bias, creating a short to the
bulk. For today’s short-channel devices, both of these phenomena are likely to occur.
In order to alleviate the problem of electrostatic discharge, CMOS circuits incorporate ESD protection
devices. Illustrated in Fig. 19.52, such devices clamp the external discharge to ground or VDD, thereby
limiting the potential applied to the circuit. Resistor R1 is usually necessary so as to avoid damaging D1
or D2 due to large currents that would otherwise ﬂow from the external source.
VDD
Pad
To Circuit
R1
D1
D2
Figure 19.52
Simple ESD protection
circuit.
The use of ESD protection structures involves three critical issues. First, the devices introduce substan-
tial capacitances from the node to ground and VDD, degrading the speed and the matching of impedances
at the input and output ports of the circuit. Since the protection devices, such as D1 and D2 in Fig. 19.52,
must be large enough so that the chip sustains a high ESD voltage without damage, their capacitance
may reach several picofarads. The thermal noise of R1 may also become signiﬁcant.
Second, the parasitic capacitance of the ESD devices may couple noise on VDD to the input of the
circuit, corrupting the signal. We return to this issue in Sec. 19.4.
Third, if not properly designed, ESD structures may lead to latch-up in CMOS circuits when electro-
static discharge occurs during actual circuit operation (or even when the circuit is turned on). For this
reason, process engineers fabricate and characterize many different ESD structures for each generation
of a technology, eventually providing a few reliable conﬁgurations that can be used in circuits.6
6In general, a circuit designer should not use an ESD structure that has not been tested and qualiﬁed for the technology.
Uncharacterized ESD devices are likely to cause latch-up.

760
Chap. 19
Layout and Packaging
19.3
Substrate Coupling
Most modern CMOS technologies use a heavily-doped p+ substrate to minimize latch-up susceptibility.
However, the low resistivity of the substrate (on the order of 0.1 ·cm) creates unwanted paths be-
tween various devices in the circuit, thereby corrupting sensitive signals. Called “substrate coupling” or
“substrate noise,” this effect has become a serious issue in today’s mixed-signal ICs [2].
To understand this phenomenon, suppose a CMOS inverter sensing a clock is laid out next to a
common-source stage amplifying an analog signal [Fig. 19.53(a)]. Note that the substrate is connected
M1
RD
Vout
Vin
VDD
VDD
CK
CDB2
M2
M3
Distributed 
Substrate
Model
Lb
Vsub
n+
n+
p−substrate
n+
n+
p+
Lb
M1
M2
CDB2
t
CK
Vsub
Vsub
ID1
(c)
(a)
(b)
Figure 19.53
(a) Mixed-signal circuit including the effect of substrate coupling; (b) side view of device layout;
(c) signal waveforms.

Sec. 19.3
Substrate Coupling
761
to ground through a bond wire that exhibits an (unwanted) inductance of Lb. With the aid of the cross
section depicted in Fig. 19.53(b), we observe that the large voltage excursions at the drain of M2 are
coupled to the substrate through the drain junction capacitance, disturbing the substrate voltage because
of the ﬁnite impedance of Lb.
How does the substrate noise inﬂuence M1? The principal coupling mechanism here occurs through
body effect, varying the threshold voltage of M1 with the substrate voltage. Since the drain current of M1
depends on Vin −VT H1, variations in VT H1 are indistinguishable from those in Vin. In other words, as
illustrated in Fig. 19.53(c), every transition of CK disturbs the analog output.
The problem of substrate coupling becomes more noticeable as the number of “noise” generators
increases. In a mixed-signal environment, thousands of digital gates may inject noise into the substrate—
especially during clock transitions—introducing hundreds of millivolts of disturbance in the substrate
potential. The disturbance is also proportional to the size of the noise-injecting devices, an important
issue if large transistors are used as buffers driving heavy external loads.
It may seem that substrate coupling can be decreased by increasing the physical spacing between
sensitive building blocks and digital sections of a chip. In practice, however, this remedy may not be
effective or feasible. If heavily doped, the substrate operates as a low-resistance plane, distributing
a relatively uniform potential across the chip regardless of the position of the noise generators [3].
Furthermore, in many mixed-signal systems, the analog and digital functions are so heavily blended that
it is difﬁcult to separate their corresponding circuits. Figure 19.54 shows a slice of an A/D converter
consisting of a comparator, a ﬂipﬂop, a NAND gate, and a read-only memory (ROM). Various logical
swings in the comparator and the digital circuits generate substrate noise, but increasing the distance
between any two blocks necessitates long interconnects, degrading the performance.
Flipﬂop
Vin
CK
ROM
Figure 19.54
A slice of an A/D converter.
In order to minimize the effect of substrate noise, the following methods can be applied. First, dif-
ferential operation should be used throughout the circuit, making the analog section less sensitive to
common-mode noise. Second, digital signals and clocks should be distributed in complementary form,
thereby reducing the net amount of the coupled noise. Third, critical operations, e.g., sampling a signal
or transferring charge from one capacitance to another, should be performed well after clock transitions
so that the substrate voltage settles. Fourth, the inductance of the bond wire connected to the substrate
should be minimized (Sec. 19.4). Also, op amps using a PMOS differential input are preferred be-
cause the well of the transistors can be tied to their common source, reducing the effect of substrate
noise.
In circuits fabricated on lightly-doped substrates, “guard rings” can be employed to isolate the sensitive
sections from the substrate noise produced by other sections. A guard ring may be simply a continuous
ring made of substrate ties that surrounds the circuit, providing a low-impedance path to ground for the
charge carriers produced in the substrate. With its large depth, the n-well can also augment the operation
of a guard ring by stopping the noise currents ﬂowing near the surface (Fig. 19.55).
In large mixed-signal ICs, it may not be possible to avoid substrate “bounce” with respect to the
external ground because of the high transient currents drawn by the devices and the ﬁnite impedance of

762
Chap. 19
Layout and Packaging
Sensitive Circuit
n−well
Substrate Ties ( p+ Contacts)
Figure 19.55
Use of guard ring to protect sensitive circuits.
the bond wire connected to the substrate. However, we recognize that if the ground of the chip bounces
in unison with the substrate, then the transistors experience no noise. Illustrated in Fig. 19.56, this idea
suggests that the ground and the substrate should be connected on the chip and brought out through a
single wire.
n+
n+
p−substrate
n+
n+
p+
Lb
Global
Ground
Chip Ground
Packaged IC
Figure 19.56
Substrate bounce.
Analog
Section
LA
GNDA
LD
GNDD
Digital
Section
Figure
19.57
Analog
and
digital
grounds.
The connection of the substrate to the chip ground nonetheless faces two difﬁculties. The ﬁrst relates to
“ground bounce.” As shown in Fig. 19.57 and explained in Sec. 19.4, most mixed-signal circuits employ
at least one “analog ground” and one “digital ground” so as to avoid corrupting the analog section by the
large transient noise produced by the digital section. To which ground should the substrate be connected?
If the analog ground is used, then the large substrate noise current must ﬂow through L A, creating noise
on GNDA [Fig. 19.58(a)], and if the digital ground is used, then the substrate voltage is heavily disturbed
by the large noise on GNDD [Fig. 19.58(b)]. Of course, connecting the substrate to both GNDA and
GNDD gives rise to a low-resistance path between the two, defeating the purpose of separating the analog
and digital grounds.

Sec. 19.3
Substrate Coupling
763
Analog
Section
LA
GNDA
GNDD
Digital
Section
LD
p−substrate
p−substrate
p+
Substrate
Current
Analog
Section
Digital
Section
LA GNDA
GNDD
LD
p+
Current
Switching
(a)
(b)
Figure 19.58
Connection of substrate contact to (a) analog ground and (b) digital ground.
The choice between the conﬁgurations shown in Figs. 19.58(a) and (b) depends on the transient
currents drawn by the digital section from the substrate and the ground as well as the magnitudes of
L A and L D. In most cases, the topology of Fig. 19.58(a) is preferred because it ensures that the analog
ground voltage and the substrate potential vary in unison. As illustrated in Fig. 19.59(a), if the analog
ground and the substrate experience unequal bounce, then the drain current of M1 is corrupted by the
substrate noise. The conﬁguration of Fig. 19.59(b), on the other hand, introduces less noise in ID1. In
general, careful, realistic simulations of the overall environment (including the package) are necessary
to determine which approach yields less noise.
LA
GNDA
RD
Vout
Vin
Lb
Vsub
LA
GNDA
RD
Vout
Vin
Vsub
(a)
(b)
M1
M1
Figure 19.59
(a) Large source-bulk noise voltage due to separating substrate contact from analog ground; (b)
suppression of the effect.
The second issue in allowing the substrate and a chip ground to bounce together is the difﬁculty in
deﬁning a reference potential for the input signals. As shown in Fig. 19.60(a), a single-ended input is
heavily corrupted as its reference point changes from the off-chip ground to the on-chip ground. That is,
V ′
in ̸= Vin, even though the substrate and the ground bounce in unison. For the differential structure of
Fig. 19.60(b), the effect is much less pronounced, but in high-precision applications, asymmetries in the
circuit and interconnections convert a fraction of the common-mode noise to a differential component.

764
Chap. 19
Layout and Packaging
LA
GNDA
RD
Vout
Vin
Vsub
M1
M2
RD
VDD
RD
Vin
Vout
LA
GNDA
Vsub
(a)
(b)
V′in
Figure 19.60
(a) Input signal corruption due to ground and substrate bounce; (b) less corruption in a differential
environment.
19.4
Packaging
After fabrication and dicing, integrated circuits are packaged. The parasitics associated with the package
and connections to the chip introduce many difﬁculties in the evaluation of the actual performance of the
circuit at high speeds and/or high accuracies.
Let us ﬁrst consider a simple dual-in-line package (DIP) [Fig. 19.61(a)]. Here, the die is mounted in
the center cavity and bonded to the pads on the perimeter of the cavity. These pads are in fact the tip of
each trace that ends in each package pin. Such a structure exhibits the following parasitics: bond wire
self-inductance, trace self-inductance, trace-to-ground capacitance, trace-to-trace mutual inductance, and
trace-to-trace capacitance. Thus, as shown in Fig. 19.61(b), the connections between the circuit and the
external world are far from ideal.
Integrated 
Circuit
(a)
(b)
Figure 19.61
(a) Dual-in-line package; (b) electrical model of the package.
While, owing to both circuit innovations and device scaling, the speed and accuracy of integrated
circuits have steadily increased, the performance of packages, especially for low-cost applications, has
not improved signiﬁcantly. This limitation originates from the unscalable nature of packages and the
environment in which they are used. For example, the diameter of the bond wires, the width and spacing

Sec. 19.4
Packaging
765
of package pins, and the width and spacing of the traces in printed circuit (PC) boards are determined by
mechanical stress, ease and cost of assembly, series resistance at high frequencies (skin effect), etc. In
the past 20 years, these dimensions have scaled by less than a factor of ﬁve, whereas the speed of many
mixed-signal circuits has increased by two orders of magnitude. As a result, packaging continues to limit
the achievable performance of today’s high-performance ICs.
The foregoing issues dictate that the package parasitics be taken into account in the design of integrated
circuits—sometimes from the very beginning. Thus, simulations must include a reasonable circuit model
of the package, and the design and layout must take many measures to minimize the effect of package
parasitics.
r
h
d
h
(a)
(b)
(c)
d
W
Figure 19.62
Common geometries in packaging.
Since some package manufacturers do not provide circuit models for their products, IC designers
often develop the models themselves by calculations and measurements. Figure 19.62 depicts three
common cases of self- and mutual inductance. From [6], we have for a round wire above a ground plane
[Fig. 19.62(a)]
L ≈0.2 ln 2h
r
nH/mm
(19.19)
which amounts to roughly 1 nH/mm for typical bond wires. For a ﬂat trace above a ground plane
[Fig. 19.62(b)],
L ≈1.6
K f
· d
W nH/mm
(19.20)
where K f denotes the fringe factor and from the data in [6] can be approximated as 0.72(d/W) + 1. For
two round wires above a ground plane, the mutual inductance is [6]
Lm = 0.1 ln

1 +
2h
d
2	
nH/mm
(19.21)

766
Chap. 19
Layout and Packaging
The parasitic capacitances can be calculated with the simple interplate equation and Eq. (18.11). In
practice, the bond wires are not simply straight, parallel lines, requiring electromagnetic ﬁeld simulations
for proper modeling.
Let us now study the effect of each type of package parasitic. We categorize the connections to the chip
into ﬁve groups: power and ground lines, analog and clock inputs, outputs, reference lines, and substrate
connection(s).
Self-Inductance
Each bond wire and its corresponding package trace exhibit a ﬁnite self-inductance,
with a total value between approximately 2 nH and 20 nH depending on the length of the wire and
the type of the package. To understand how the self-inductance of supply and ground lines affects the
performance, suppose a mixed-signal circuit incorporates a CMOS inverter as a clock buffer to drive
a moderate on-chip capacitance, e.g., 0.5 pF (Fig. 19.63). Also, assume that the buffered clock must
have transition times less than 0.5 ns, thereby demanding a current of CV/t = 3 mA. Since this
current is drawn from VDD1 and GND1 in 0.5 ns, we can estimate the voltage drop across L D or LG as7
LI/t = 6 × 106L. For example, if L D = LG = 5 nH, then the transient voltage across each inductor
equals 30 mV. This effect is called supply and ground “bounce” or “noise.” Note that if the inverter is
replaced by a differential pair, the supply bounce decreases substantially (why?), another advantange of
differential operation.
LD
VDD
LG
IDD
IGND
CL
Vout
Vin
t
VDD1
GND1
Vin
Vout
IDD
IGND
VDD1
GND1
Figure 19.63
CMOS inverter driving a load capacitance.
A supply noise of 30 mV may seem quite benign, especially if the analog circuits feeding from the
same supply line are fully differential. However, in a typical mixed-signal IC, hundreds or thousands
of digital gates may switch during each clock transition, creating enormous noise on their supply and
ground connections. For this reason, most such systems employ separate supply and ground lines for the
analog and digital sections; hence the terminology “analog supply” and “digital supply.”
Separating power lines into analog and digital groups is not always straightforward. As an example,
suppose a sampling circuit is clocked by an inverter (Fig. 19.64). Should the inverter be supplied from
analog or digital power lines? If the inverter is connected to the digital supply, then the large noise on
VDD couples through the gate-drain overlap capacitance of M1, corrupting Vout when the transistor is off.
On the other hand, if many such inverters are supplied from the analog VDD, they collectively draw large
transient currents, corrupting the supply voltage. These cases may require a third type of power line so
that it remains less noisy than the digital supplies.
For characterization and troubleshooting purposes, it is sometimes desirable to monitor the supply
noise. Figure 19.65 illustrates a simple method whereby a PMOS device sensing the noise between the
on-chip supply and ground lines injects a current into an external 50- transmission line and measurement
7This calculation is quite rough because the current produced by the buffer varies during the transition.

Sec. 19.4
Packaging
767
CH
Vout
VDD
GND
Vin
CK
CGD
M1
Figure 19.64
Noise in a sampling cir-
cuitresultingfromtheclockbuffer’ssup-
ply bounce.
apparatus [2]. Since the transconductance of M1 can be determined by a small, static change in VDD, the
measurement readily reveals both the magnitude and the shape of the supply noise.
VDD
M1
50 Ω
Figure 19.65
Measurement of supply noise.
In cases where a single connection to the chip sustains a prohibitively large transient voltage (e.g., if
in Fig. 19.63 or 19.64 many inverters switch simultaneously), multiple pads, bond wires, and package
pins are used so as to reduce the equivalent inductance (Fig. 19.66).
Integrated 
Circuit
VDD
VDD
VDD
GND
GND
GND
Figure 19.66
Use of multiple wires to
reduce overall inductance.
▲
Example19.7
In a 600-MHz, 2-V CMOS microprocessor containing 15 million transistors, the supply current varies by 25 A in
approximately 5 ns [5]. If the processor provides 200 bond wires for ground and 200 for VDD, estimate the resulting
supply bounce.

768
Chap. 19
Layout and Packaging
Solution
Assuming a total inductance of 5 nH for each bond wire and its corresponding package trace and pin, we have
V = L I
t
(19.22)
= 5 × 10−9
200
·
25
5 × 10−9
(19.23)
= 125 mV
(19.24)
In the worst case, the supply bounce and the ground bounce add in-phase, yielding a total noise of roughly 250 mV,
greater than 10% of the nominal supply voltage. To further suppress the noise, an external 1-μF MOS capacitor is
placed on top of the chip and another 160 supply and ground bond wire pairs are connected from the chip to the
capacitor [5].
▲
In some applications, high transient currents drawn from the supply make it difﬁcult to maintain a
small bounce on the supply and ground individually. In such cases, a large on-chip capacitor may be
used to stabilize the difference between VDD and ground. Illustrated in Fig. 19.67, the idea is that if C1
is sufﬁciently large, then VDD1 and GND1 bounce in unison. As mentioned earlier, the residual noise on
GND1 may be negligible if the input signals are differential.
Integrated 
Circuit
LD
VDD
LG
VDD1
GND1
C1
Figure 19.67
On-chip capacitor used
to lower supply-ground noise voltage.
This remedy nonetheless involves several issues. First, the value of the capacitor must be chosen
carefully because it may otherwise resonate with the package inductance at the operating frequency of
the chip (e.g., the clock frequency or its harmonics or subharmonics), thereby amplifying the supply and
ground noise. For this reason, some resistance is added in series with the capacitor (or a MOS capacitor is
sized such that its channel resistance dampens the resonance) [5]. Even in the absence of exact resonance,
an insufﬁcient value of the decoupling capacitor may simply give rise to slower ringing on the power lines.
Second, since the capacitor is usually formed by a very large MOS transistor (actually, as explained in
Sec. 18.7.2, a large number of MOSFETs in parallel), the yield of the circuit may suffer. This is because,
for the capacitor to be effective, its total area is typically comparable with the total gate area of all of the
transistors in the circuit; e.g., it is as if the number of transistors on the chip were doubled.
Self-inductance also manifests itself in the connection to the substrate. As mentioned in Sec. 19.3,
with the large transient currents injected by the devices into the substrate, a low-impedance connection
is necessary to minimize the substrate bounce. As shown in Fig. 19.68, some modern packages contain
a metal ground plane to which the die can be attached by conductive epoxy. The plane ends in several
package pins that are tied to the board ground. Avoiding bond wires and long, narrow traces in the
substrate connection, such packages substantially reduce the substrate noise with no additional assembly
cost. In more expensive packages, the ground plane is exposed on the bottom and can be directly attached

Sec. 19.4
Packaging
769
Chip
Conductive
Epoxy
Ground
Plane
Package
Backside
Downbond
Figure 19.68
Package using a ground plane for substrate connection.
to the board ground, thus avoiding the inductance of the package pins. Also, the ground pads of the
circuit can be “downbonded” to the underlying plane to minimize their inductance (while increasing
the cost).
The effect of self-inductance must also be considered for input signals. The inductance, along with the
pad capacitance and the circuit’s input capacitance, forms a low-pass ﬁlter, attenuating high-frequency
components and/or creating severe ringing in transient waveforms. For example, in the precision multiply-
by-two circuit described in Sec. 13.3.3, when the two capacitors are switched to the input, the package
inductance may limit the settling speed.
Some ICs require constant voltages that must be provided externally. Such voltages may serve as
an accurate reference, e.g., in A/D or D/A converters, or to deﬁne some bias points on the chip. The
package inductance degrades the settling behavior if the circuit injects signiﬁcant switching noise into
the reference.
▲
Example19.8
Differential pairs are often used as “current switches.” As shown in Fig. 19.69, the circuit routes its tail current to
either of the outputs according to the large swings controlling the gates of M1 and M2. Explain what happens at node
X during switching. If the tail currents of a large number of differential pairs feed from node X, should this voltage
be provided externally?
M1
M2
M0
Iout1
Iout2
P
X
M3
CGD3
V1
V2
Figure 19.69
Differential pair operat-
ing as a current switch.
Solution
Recall from Chapter 4 that for the differential pair to experience complete switching, the differential swing |V2 −V1|
must exceed
√
2(VGS −VT H)eq, where (VGS −VT H)eq is the overdrive of M1 and M2 in equilibrium, i.e., if
ID1 = ID2. We denote the voltage at node P when the pair is completely switched by VP1, and in equilibrium by
VP2. Thus,
VP1 = V2 −
√
2(VGS −VT H)eq
(19.25)

770
Chap. 19
Layout and Packaging
In equilibrium,
VP2 = V1 + V2
2
−(VGS −VT H)eq
(19.26)
Assuming that V2 −V1 =
√
2(VGS −VT H)eq, and hence V1 = V2 −
√
2(VGS −VT H)eq, we have
VP2 = V2 −

1 +
√
2
2

(VGS −VT H)eq
(19.27)
Thus, VP2 is lower than VP1 by (1 −
√
2/2)(VGS −VT H)eq, indicating that during switching, VP drops by this
amount. This voltage change is coupled to node X through the gate-drain overlap capacitance of M3, disturbing ID3
and hence Iout1 or Iout2.
▲
M0
X
CGD
CGD
CX
t
CX = 0
VX
CX = CX2 > CX1
CX = CX1
Figure 19.70
Addition of on-chip bypass capacitor to suppress noise at node X.
With a large number of current switches connected to node X, the disturbance may be quite signiﬁcant,
demanding that a decoupling capacitor be connected from node X to ground (Fig. 19.70). However, such
a capacitor along with the small-signal resistance of M0 introduces a long settling time at node X, possibly
degrading the overall speed. To avoid this effect, CX may need to be 100 to 1,000 times the total gate-
drain overlap capacitance that injects noise into X. If such a large capacitor is placed off-chip, it actually
appears in series with the package inductance (Fig. 19.71). In general, careful simulations are necessary
to determine the preferable choice here. In many cases, leaving node X agile yields the fastest settling.
Lb
X
CGD
CGD
CX
Figure 19.71
Addition of bypass capacitor externally.
The self-inductance of package connections also affects the performance of digital output buffers. In
high-speed systems, these drivers must deliver tens of milliamps of current to the load with fast transitions.
With many such buffers operating in a mixed-signal circuit, the resulting voltage drops on the power lines
may become very large, increasing the rise time and fall time of the digital outputs and corrupting their
timing.

Sec. 19.4
Packaging
771
Mutual Inductance
While dedicating separate power lines to analog and digital sections reduces the
noise on the analog supply, some noise may still couple to sensitive signals through the mutual inductance
of bond wires and package traces. As illustrated in Fig. 19.72, both analog supplies and analog inputs
are susceptible to noise or transitions on digital supplies, clock lines, or output buffers. With an arbitrary
pad conﬁguration, even differential signaling cannot eliminate this effect because the noisy lines may not
surround the sensitive lines symmetrically. Thus, the design of the pad frame and the position of the pads
play a critical role in the performance that can be achieved.
VDD
Vin
CK
VDD,A
VDD,D
Figure 19.72
Coupling due to mutual inductance between wires.
Mutual inductance also manifests itself in parallel bond wires used to lower the overall self-inductance
of a connection (Fig. 19.73). For two such wires, the equivalent inductance is equal to (L S + M)/2, where
M denotes the mutual inductance, rather than L S/2.
VDD
VDD
VDD
Figure 19.73
Multiple supply bond
wires with mutual coupling.
Two methods can reduce the mutual coupling between inductors. First, the wires can be connected
such that they are perpendicular to each other, i.e., they terminate on perpendicular sides of the chip
[Fig. 19.74(a)]. Second, (quiet) ground or supply lines can be interposed between critical bond wires
[Fig. 19.74(b)]. As shown in Fig. 19.74(c), even if several parallel lines are surrounded by ground wires,
the effect of mutual inductance drops to negligible values.
V1
V2
V1
V2
(c)
(a)
(b)
V1
V2
Figure 19.74
Reduction of mutual coupling by (a) perpendicular lines, (b) additional ground lines, and (c)
occasional ground lines.
It is also interesting to note that mutual inductance reduces the self-inductance of two wires if they
carry currents in opposite directions. If, as shown in Fig. 19.75, the supply and ground lines of a circuit

772
Chap. 19
Layout and Packaging
are in parallel, then the total inductance equals 2L S −M rather than 2L S. This observation proves useful
in designing the pad frame and determining the package connections.
VDD
GND
IDD
IDD
Figure 19.75
Reduction of mutual in-
ductance between two wires carrying
equal and opposite currents.
Self- and Mutual Capacitance
The capacitance seen from each trace of the package to ground may
limit the input bandwidth of the circuit or load the preceding stage. More important, this capacitance and
the total inductance of the bond wire and the package trace yield a ﬁnite resonance frequency that may be
stimulated by various transient currents drawn by the circuit. Since the wires and traces exhibit a small
series resistance, a high quality factor (Q) results, giving rise to a sharp resonance and amplifying the
noise considerably. The capacitance between the traces leads to additional coupling between lines and
must be included in simulations.
References
[1] N. C. C. Lu et al., “Modeling and Optimization of Monolithic Polycrystalline Silicon Resistors,” IEEE Trans.
Electron Devices, vol. ED-28, pp. 818–830, July 1981.
[2] D. Su et al., “Experimental Results and Modeling Techniques for Substrate Noise in Mixed-Signal Integrated
Cicuits,” IEEE J. of Solid-State Circuits, vol. 28, pp. 420–430, April 1993.
[3] T. Blalack and B. A. Wooley, “The Effects of Switching Noise on an Oversampling A/D Converter,” ISSCC Dig.
of Tech. Papers, pp. 200–201, February 1995.
[4] B. Razavi, Principles of Data Conversion System Design (New York: IEEE Press, 1995).
[5] D. W. Dobberpuhl, “Circuits and Technology for Digital’s StrongARM and ALPHA Microprocessors,” Proc. of
17th Conference on Advanced Research in VLSI, pp. 2–11, September 1997.
[6] N. K. Verghese, T. J. Schmerbeck, and D. J. Allstot, Simulation Techniques and Solutions for Mixed-Signal
Coupling in Integrated Circuits (Boston: Kluwer Academic Publishers, 1995).
Problems
Unless otherwise stated, in the following problems, use the device data shown in Table 2.1 and assume that VDD = 3
V where necessary. Also, assume that all transistors are in saturation.
19.1. In Fig. 19.3, polysilicon has a sheet resistance of 30 /□(before silicidation) and metal 1 a sheet resistance
of 80 m/□. What is the ratio of the resistivities of the two materials?
19.2. A MOSFET with W/L = 100 μm/0.5 μm undergoes ideal scaling by a factor of two. What happens to the
sheet resistivity and the total resistance of the gate?
19.3. A cascode structure uses W/L = 100 μm/0.5 μm for both the input device and the cascode device. If the
sheet resistance of polysilicon is 5 /□and the maximum tolerable gate resistance 10 , draw the layout of
the structure while minimizing the drain junction capacitances.
19.4. In Fig. 19.7, explain what happens to the differential ampliﬁer if each of the design rules A1–A8 is violated.
19.5. The input differential pair of an ampliﬁer is to be laid out as in Fig. 19.19, but with each half device (e.g.,
1/2M1) using four gate ﬁngers. What is the minimum number of interconnect layers required here?
19.6. Large integrated circuits may suffer from signiﬁcant temperature gradients. Compare the performance of the
circuits shown in Figs. 19.23 and 19.24 in such an environment.

Problems
773
19.7. Suppose polysilicon with silicide block has a sheet resistance of 60 /□and a parallel-plate capacitance of
100 aF/μm2 to the substrate. Also, assume that these parameters are respectively equal to 2 k/□and 1,000
aF/μm2 for the n-well. Determine which material should be used to construct a 500- resistor if matching
considerations require a minimum poly width of 3 μm and a minimum n-well length of 6 μm. Neglect fringe
capacitances.
19.8. Using the data in Table 18.1, calculate C and CP for each structure in Fig. 19.35 and identify the one with
minimum CP/C. Neglect fringe capacitances.
19.9. A metal 4 wire with a length of 1,000 μm and width of 1 μm is driven by a source impedance of 500 . Using
the data in Table 18.1 and assuming a sheet resistance of 40 m/□, calculate the delay through the wire and
compare the result with the lumped time constant obtained by multiplying the source impedance by the total
wire capacitance.
19.10. Repeat Problem 19.9 if the width of the wire is increased to 2 μm.
19.11. An interconnect having a length of 1,000 μm is required in a circuit. Using the data in Table 15.1 and assuming
that the sheet resistance of metals 1–3 is 80 m/□and that of metal 4 is 40 m/□, determine which metal
layer must be used to obtain the minimum delay.
19.12. Some new technologies use copper for interconnects because its resistivity is about half that of aluminum.
Repeat Problem 19.11 with copper interconnects.
19.13. In the circuit of Fig. 19.53(a), (W/L)1 = 100/0.5 and ID1 = 1 mA. If the substrate noise, Vsub, has a
peak-to-peak amplitude of 50 mV, what is the effect referred to the gate of M1?
19.14. Suppose two bond wires are placed 5 mm above ground with a center-to-center spacing of 1 mm.
(a) What is the total mutual inductance if each wire is 4 mm long?
(b) If one wire carries a 100-MHz sinusoidal current with a peak amplitude of 1 mA, what is the voltage
induced across the other wire?
19.15. In Problem 14, what center-to-center spacing is required to decrease the induced voltage by a factor of four?
19.16. In order to reduce the total bond wire inductance, a package uses 4 supply pads and 4 ground pads. Suppose
the self-inductance of each wire is 4 nH and the mutual inductance between adjacent lines is 2 nH. Neglecting
mutual inductance between nonadjacent lines, calculate the equivalent inductance of the supply and ground
connections if (a) all of the supply wires are placed next to each other and so are the ground wires, and (b)
every supply wire is placed next to a ground wire.
19.17. The input bandwidth of high-speed circuits may be limited by the bond wire inductance and the pad capacitance.
Consider two cases: (a) the bond wire diameter is 50 μm and the pad size 100 μm × 100 μm; (b) the bond
wire diameter is 25 μm and the pad size 50 μm × 50 μm. If all other dimensions are constant, which case is
preferable?

Index
A
abstraction levels, circuit design, 5–6
active current mirrors, 146–60; common-mode properties,
156–59; large-signal analysis of, 149–52;
small-signal analysis of, 152–56; small-signal
behavior in, 146–49
active devices, 718–21; back-end processing, 720–21; basic
transistor fabrication, 718–20; fabrication, 718–21
active load, common-source stage with, 59–60
ADC. See analog-to-digital converter (ADC)
ampliﬁcation mode: noninverting ampliﬁers, 562, 566;
unity-gain sampler/buffer, 555–56, 559–60
ampliﬁers: applications, 45; auxiliary, 366, 368–69; cascade
of, 179; categories, 47; continuous-time feedback,
539–40; current, 282–84; differential. See differential
ampliﬁers; frequency response of, 173–214;
high-speed, 495–507; low-noise, 45; noninverting,
562–67; nonlinear. See nonlinearity; nonlinear,
input-output characteristic of, 281; one-pole
feedforward, 412; operational. See operational
ampliﬁers (op amps); power, 45; single-stage. See
single-stage ampliﬁers; single-stage, noise in, 243–54;
switched-capacitor, 555–68; transconductance,
282–84; transimpedance, 282–84; two-stage feedback,
332–33; types of, 282–84; variable gain, 126–28;
voltage, 282–84, 589
amplitude: distribution, 224–25; limiting, 612–18;
output, 632
analog design: challenges, 4; demand for, 3–4;
introduction to, 1–6; octagon, 46, 47
analog layout techniques, 736–59; multiﬁnger transistors,
737–39; passive devices, 746–53; reference
distribution, 744–46; shallow trench isolation issues,
743–44; symmetry, 739–43; well proximity
effects, 744
analog-to-digital converter (ADC), 1–2
antenna effect, 736
asymmetry, 119–23, 152. See also symmetry
auxiliary ampliﬁers, 366, 368–69
average power, 220
B
back-end processing, 720–21
bandgap references, 509–35. See also reference distribution;
case study, 533–35; deﬁned, 521; ﬂoating, 534; general
considerations, 509; low-voltage, 529–33; speed and
noise issues, 525–29; temperature-independent
references, 515–22
bandwidth: modiﬁcation, 279–80; noise, 264; small-signal,
346–49
Barkhausens Criteria, 411, 608, 612
biasing, 160–66; circuit, 477; common-gate, 164–65;
common-source, 161–64; constant-Gm, 524–25;
differential pair, 166; source followers, 165–66;
supply-independent, 509–12
binary data, 2–3
Blackmans theorem, 325–30, 338–39
Bode plots, 411, 413, 422, 423, 427, 439–40, 664
Bodes analysis of feedback circuits, 315–31
body effect, 20–22; source follower, 71
bonding pads, 757–59
bootstrapping, 680, 681
bottom-plate sampling, 555
BSIM (Berkeley Short-Channel IGFET Model ), 702, 706
bulk, 8; NFETs/PFETs, 34
bulk voltage, 20–22
C
cancellation, offset, 598–602
capacitance modeling, MOS device models, 707–8
capacitances: fringe, 729; MOS devices, 27–31; parallel, 729;
parasitic, 180
capacitor nonlinearity, 583–84
capacitors. See also switched-capacitor circuits: behavior of
MOS devices as, 37–38; layout in passive devices,
750–53; monolithic, 555; in passive MOS devices,
724–27
cascode current mirrors, 139–46
cascode current source, 140–46
cascode devices, layout, 739
cascode differential pair, 126
774

Index
775
cascode gate voltage, 355
cascode operational ampliﬁer, 345; folded, 355–61; telescopic,
351–52
cascodes: folded, 90–92; low-voltage, 144–46; poor mans,
88–89
cascode stage, 82–92; frequency response, 196–98;
input-output characteristic of, 84; model, 197; output
impedance, 85–86; poor mans cascode, 88–89;
shielding property, 89–90; single-stage ampliﬁers, 254;
small-signal characteristics, 84
Cauchys Principle of Argument, 447
center frequency, in voltage-controlled oscillators, 632
CG stage. See common-gate (CG) stage
channel charge injection, 550–52; cancellation, 553–55
channeling, 717
channel-length modulation, 23–24
charge injection, channel, 550–52, 553–55
charge modeling, MOS device models, 707–8
charge-pump phase-locked loops, 666–77; basic, 671–77;
charge pump, 669–71; dynamics, 672–77; lock
acquisition, 666–77; phase/frequency detector, 667–69;
transfer function, 672–77
charge pumps: in charge-pump phase-locked loops, 669–71;
PFD/CP nonidealities, 677–81
charge redistribution, in noninverting ampliﬁer, 563
chemical vapor deposition (CVD), 718
circuit design, abstraction levels, 5–6
circuits: bandgap reference. See bandgap reference; bias, 477;
common-gate, 278; differential, 103, 579–81;
feedback, 275–82; half, 113–15; multi-pole, 205–6;
noise representation in, 236–43; one-pole, 204;
open-loop, 278; precision multiply-by-two, 567–68;
sampling, 543–47; switched-capacitor. See
switched-capacitor circuits
clamp transistors, 395–96
clock: feedthrough, 552–53
closed-loop behavior, of two-stage operational ampliﬁers,
493–95
closed-loop frequency response, 416–19
closed-loop gain, 276–77
closed-loop small-signal performance, high-speed ampliﬁers,
501–2
closed-loop transfer function, 275
CMFB. See common-mode feedback (CMFB)
CMOS (complementary MOS) devices, 5; processing
technology, 712–31
CMOS inverters, 693; ring oscillators using, 614
CMOS oscillators. See oscillators
CMOS technology: compatibility with bandgap references,
517–18; processing, 712–31
collector current variation, 517
Colpitts oscillators, 624–26
common-centroid layout, 741
common-drain stage. See source follower
common-gate circuit, with feedback, 278
common-gate (CG) stage, 75–82, 164–65; frequency
compensation using, 437–38; and frequency response,
193–96; at high frequencies, 194; input impedance, 77,
79–82; input-output characteristic, 76; input-referred
noise, 249–52; output impedance, 79–82; with parasitic
capacitance, 180; single-stage ampliﬁers, 249–52;
transfer function, 180
common-mode behavior, differential pairs, 106
common-mode feedback (CMFB), 477–82; operational
ampliﬁers, 374–88; sensing techniques, 377–80;
switched-capacitor, 571–72; topology, 377; in
two-stage op amps, 386–88, 489–90
common-mode input-output characteristic, 105
common-mode properties, active current mirrors, 156–59
common-mode rejection, 101; in voltage-controlled
oscillators, 633
common-mode rejection ratio (CMRR), 123; alternative
deﬁnition of, 603–4
common-mode response, differential ampliﬁers, 118–23
common-source (CS) stage, 47–67, 161–62; with active load,
59–60; complementary, 164; with current-source load,
58–59, 162–63; with diode-connected load, 52–58;
distortion in, 577; with feedback, 275; frequency
response, 180–87; gain stage added to, 237;
high-frequency model, 181; input impedance in, 187;
NMOS, 368, 369; output noise of, 266; PMOS,
368–69; with resistive degeneration, 585–86; with
resistive load, 47–52; single-stage ampliﬁers, 244–49;
slewing in, 397; small-signal model of, 51; with
source degeneration, 61–67; transfer function,
181–87; with triode load, 60–61; zero calculated in,
185–86
compensation: differential, 485–87; frequency, 420–26,
490–93
complementary common-source stage, 164
complementary switches, 554
conduction, subthreshold, 24–25
constant-ﬁeld scaling, 692
constant-Gm biasing, 524–25
contact spiking, 721
contact windows, 721
continuous-time: integrator, 568, 569; resistors, 568, 569
continuous-time: feedback ampli?ers, 539–40
control voltage, 126–28
conversion, differential, 120–23
corner frequency, ﬂicker noise, 235–36
correlated sources, of noise, 225–26
coupling: one-dimensional cross, 742–43; substrate,
760–64
cross-coupled oscillators, 621–23
CS stage. See common-source (CS) stage
current. See also biasing: ampliﬁers, 282–84; copying, 136;
drain, 148–49; generation vs. voltage ampliﬁcation,
245; meters, 284–86; mismatch, 596–97, 679, 680;
PTAT, 523–24; resistive biasing, 135; scaling, 745–46;
tail, 120–21
current-current feedback, 297–98; loading in, 313–14
current mirrors, 134–66; active. See active current mirrors;
basic, 134–39; cascode, 139–46; noise in, 254–56
current-source load: common-source stage with, 58–59;
differential pair with, 147

776
Index
current-source load, common-source stage with, 162–63
current sources: applications of, 134; cascode, 140–46; NMOS
device used by source follower as, 69
current-voltage feedback, 291–94; loading in, 308–10
curvature correction, 522
CVD. See chemical vapor deposition (CVD)
Czochralski method, 713
D
dangling bonds, 234
data: binary, 2–3
dead zone in phase-locked loops, 678–79
deep-submicron effects, 460–63
degeneration, resistive, 585–91
delay-locked loops (DLLs), 683–85
delay variation: by interpolation, 638–40; by positive
feedback, 636–38
deposition, 718
designing operational ampliﬁers, 353–54
design rules, 734–36
device models, choice of, 92–93
devices. See active devices; MOS devices; NMOS (n-type
MOS) devices; passive devices; PMOS (p-type MOS)
devices
differential ampliﬁers, 100–128; biased by current mirrors,
137–38; common-mode response, 118–23; Gilbert cell,
126–28
differential circuits, 103; nonlinearity of, 579–81
differential compensation, 485–87
differential conversion, 120–23
differential pairs: basic, 103–17; biasing, 166; cascode, 126;
common-mode behavior of, 106; with current-source
load, 147; degenerated, 116–17; distortion in, 577;
frequency response, 198–203; high-gain, 375;
input-output characteristic, 104; large-signal behavior,
106–9; layout, 739–41; lemma, 113–14; with MOS
loads, 123–26; noise in, 256–62; with offset, 593–97;
output voltage, 106; with passive load, 146–48; PMOS,
604; qualitative analysis, 104–6; quantitative analysis,
106–17; small-signal behavior, 110–13; used in tuning
ring oscillators, 633–41
differential realization, in noninverting ampliﬁer, 564
differential sampling circuits, 554–55
differential signals: response of differential pairs to, 198–203;
single-ended signals vs., 100–102
diode-connected device, 136
diode-connected load, CS stage with, 52–58
diodes: layout in passive devices, 753
DIP. See dual-in-line package (DIP)
discrete-time: integrators, 569; resistors, 569
dissipation, power, 632
distortion: in common-source stage, 577; in differential pair,
577; even-order, 597–98
distribution: amplitude, 224–25; reference, 744–46
double-null method, 338–39
drain, 7, 8
drain current, 12–15, 148–49; combining, 149; of
common-source device, 63; saturation of, 17
drain-source voltage, output impedance variation with,
700–701
dual-in-line package (DIP), 764
dummy switches, 553–54
dummy transistors, 740
E
EET. See extra element theorem (EET)
electromigration, 729
enclosure, 734–35
etching, 718
even-order distortion, 597–98
exclusive OR (XOR) gate, 652
extension, 735–36
extra element theorem (EET), 206–8
F
fabrication: active devices, 718–21; CMOS devices, 718–30;
interconnects, 727–30; passive devices, 721–27;
transistor, 718–20
feedback, 274–339. See also feedback circuits; analysis,
difﬁculties associated with, 299–303; Bodes analysis
of circuits, 315–31; circuits, 275–82; common-gate
circuit with, 278; common-mode, 374–88;
common-source stage with, 275; current-current,
297–98, 313–14; current-voltage, 291–94, 308–10;
effect on noise, 298–99; error, 274; general
considerations, 274–86; negative, 410–11; network,
274; oscillatory, 609; polarity, 521; positive, delay
variation by, 636–38; topologies, 286–98; two-pole,
609–10; voltage-current, 294–97, 310–13;
voltage-voltage, 286–91, 304–8
feedback circuits: bandwidth modiﬁcation, 279–80; gain
desensitization, 275–78; impedance modiﬁcation,
278–79; nonlinearity reduction, 280–82; sense and
return mechanisms, 284–86
feedforward: ampliﬁers, one-pole, 412; network, 274
ﬁeld oxide (FOX), 715
ﬁlter, low-pass, 228–29
FinFET, 36–37
ﬁve-stage ring oscillators, 615
ﬂicker noise, 234–36, 252–53; corner frequency, 235–36
ﬂoating: impedance, 174; references, 534
folded-cascode operational ampliﬁer, 355–61; noise in,
402–3; slewing in, 394–95
folded cascodes, 90–92
folded structures, 29
folding, 33; reduction of gate resistance by, 232; white
noise, 224
four-stage ring oscillators, 615
frequency. See also phase/frequency detectors (PFDs):
compensation. See frequency compensation; corner,
235–36; multiplication, 685–86; response. See
frequency response; synthesis, 687
frequency compensation, 410–14, 420–26; common-gate stage
used in, 437–38; Miller compensation, 427–28, 432;
other techniques, 436–39; stability and, 410–55;
two-stage operational ampliﬁers, 426–33

Index
777
frequency response: ampliﬁers, 173–214; cascode stage,
196–98; closed-loop, 416–19; common-gate stage,
193–96; common-source stage, 180–87; differential
pairs, 198–203; gain-bandwidth trade-offs, 203–6; gain
boosting, 371–73; general considerations, 173–80;
Miller effect, 174–79, 181, 183, 184
fringe capacitance, 729
G
gain: asymptotic form, 336–37; boosting, 364–73; closed-loop,
276–77; common-mode, 156–59; crossover frequency,
411, 417; desensitization, 275–78; open-loop, 303,
306–8, 345–46; small-signal, 146–52; stage, added to
common-source stage, 237; voltage, 152–55
gain-bandwidth trade-offs, 203–6
gate, 7; cascode voltage, 355; exclusive OR, 652; resistance,
232; shadowing, 740; voltage, 145
Gilbert cell, 126–28
gradient, 741
H
half circuit, 113–15; differential pair, 126; folded cascode
operational ampliﬁers, 357
half-circuit concept, 152
high frequencies, common-gate stage at, 194
high-frequency model: cascode stage, 196; common-source
stage, 181
high-slew-rate operational ampliﬁers, 397–400
high-speed ampliﬁers, 495–507; closed-loop small-signal
performance, 501–2; design, 500–501; general
considerations, 496–500; large-signal behavior, 505–7;
precision issues in, 496–98; scaling, 502–5; speed
issues in, 498–500
hot carrier effects, 700
hybrid models, 303–4
I
impedance: Blackmans theorem, 325–30, 338–39; ﬂoating,
174; input, 187, 189, 290–91, 296–97; modiﬁcation,
278–79; output, 181, 287–88, 292–93, 296–97, 369,
518–21, 525–29, 700–701; source, 241
inductance: mutual, 770–71; self, 766–70
inductors, monolithic, 618
injection, channel charge, 550–52
input impedance: common-gate stage, 77, 79–82; in
common-source stage, 187; source follower, 73, 189;
and voltage-current feedback, 296–97; voltage-voltage
feedback, 290–91
input nodes. See also nodes; output nodes: in cascode stage,
196–98; in common-gate stage, 193–96; in
common-source stage, 181–87; and differential pairs,
198–203; and source followers, 188–93
input-output characteristic, 46, 48; cascode stage, 84;
common-gate stage, 76; common-mode, 105;
common-source stage with diode-connected load, 54,
55; differential pairs, 104; large-signal, 151–52; of
nonlinear ampliﬁer, 281; of nonlinear system, 576; of
sampling circuits, 551; source follower, 68
input-output transfer function, 178
input poles. See also output poles; poles: in cascode stage,
196–98; in common-gate stage, 193–96; in
common-source stage, 181–87; and differential pairs,
198–203; and source followers, 188–93
input range limitations, 388–90
input-referred noise, 237–42; of differential pair, 256–62
input-referred thermal noise: common-gate stage, 249–52;
voltage, 244–49
input voltage: vs. voltage gain of source follower, 69
integrated circuits, 4; layout. See layout; packaging. See
packaging
integrators: discrete-time, 569; parasitic-insensitive, 570;
switched-capacitor, 568–71
interconnects: fabrication, 727–30; layout in passive devices,
753–58; parallel capacitance, 729; series resistance,
728
International Solid-State Circuits Conference (ISSCC), 3–4
interpolation, delay variation by, 638–40
inverters. See CMOS inverters
ion implantation, 716–17
I/V characteristics, MOS, 10–20; derivation, 12–19; threshold
voltage, 10–12
J
jitter: in phase-locked loops, 678–79, 681–83; reducing in
phase-locked loops, 688–89
junction capacitances, scaling, 692–93
K
kT / C noise, 553
L
large-signal analysis, of active current mirrors, 149–52
large-signal behavior: cascode current source, 140–46;
folded-cascode stage, 91; high-speed ampliﬁers,
505–7; op amps, 348
large-signal input-output characteristic, 151–52
latch-up, 730–31
layout, 733–64; analog techniques. See analog layout
techniques; antenna effect, 736; cascode devices, 739;
common-centroid, 741; design rules, 734–36;
differential pairs, 739–41; general considerations,
733–36; minimum enclosure, 734–35; minimum
extension, 735–36; minimum spacing, 734; minimum
width, 734; multiﬁnger transistors, 737–39; PMOS
device, 733
LC oscillators, 618–30; Colpitts, 624–26; cross-coupled,
621–23; one-port, 626–30; tuning in, 641–44
lemma: differential pair, 113–14; noise calculation, 243–44;
voltage gain, 67
level shifters, source followers as, 188–93
linearity. See also nonlinearity: operational ampliﬁers, 348–49;
tuning, 632
linearization, 62; techniques of, 585–91
linear scaling, 354–55
linear settling, 391
lithography sequence, 714–15

778
Index
loading, effect of, 303–15; in current-current feedback,
313–14; in current-voltage feedback, 308–10;
summarizing effects of, 315; two-port network models,
303–4; in voltage-current feedback, 310–13; in
voltage-voltage feedback, 304–8
loads, MOS, differential pair with, 123–26
lock acquisition, in charge-pump phase-locked loops, 666–77
long-channel MOSFET devices vs. short-channel MOSFET
devices, 35–36
loop gain, 276. See also closed-loop gain; open-loop gain;
Bode plots. See Bode plots; calculation issues, 332–36;
in charge-pump phase-locked loops, 674–77;
computation, 277; and current-voltage feedback, 292,
308–10; return ratio and, 322–24
loops, phase-locked. See phase-locked loops (PLLs)
low-noise ampliﬁers (LNA), 45
low-pass ﬁlter, 228–29
low-voltage bandgap references, 529–33
low-voltage cascode, 144–46
M
mathematical model, of voltage-controlled oscillators, 644–49
metal-oxide-silicon ﬁeld-effect transistors. See MOSFETs
meters, current/voltage, 284–86
Middlebrooks method, 331–32
Miller compensation, 427–28, 432
Miller effect, 174–79, 181, 183, 184, 196
Millers theorem, 174–79, 212–14
mismatch, 120–23, 591–604; and common-mode gain, 159;
current, 596–97, 679, 680; DC offsets, 593–97;
MOSFET, 591–604
mobility degradation with vertical ﬁeld, 461–63, 697–98
models: cascode stage, 197; choice of, 92–93; high-frequency,
181, 196; hybrid, 303–4; MOS devices, 26–36, 701–8;
MOS SPICE, 34–35; small-signal, 31–34, 51, 62,
65–66; two-port network, 303–4; Y, 303–4; Z, 303–4,
310
monolithic: capacitors, 555; inductors, 618
MOS: circuit symbols, 9–10; I/V characteristics, 10–20
MOS devices. See also NMOS (n-type MOS) devices; PMOS
(p-type MOS) devices: active, 718–21; behavior as
capacitor, 37–38; capacitances, 27–31; fabricating,
718–30; layout, 26–27; passive, 721–27; processing
technology, 712–31; small-signal model, 31–34;
subthreshold conduction, 24–25; as switches, 547–55;
transconductance, 19–20
MOS devices models, 26–36, 701–8; BSIM series, 706;
charge/capacitance modeling, 707–8; Level 1, 702;
Level 2, 702–4; Level 3, 704–5; temperature
dependence, 708
MOSFETs (metal-oxide-silicon ﬁeld-effect transistors), 5;
common-mode sensing using, 379; as controllable
resistors, 16; layout, 26–27; long-channel vs.
short-channel, 35–36; mismatches in, 591–604; noise,
230–33; ohmic sections, 231–32; parameter variations,
708–9; physics, 7–38; reducing effect of mismatched,
533–35; relationship between drain current and
terminal voltage, 12–15; saturated, 16–18; scaling,
691–95; small-signal model, 31–34; structure of, 8–9;
as switch, 7–8; as switches, 543–47; transconductance,
524; velocity saturation, 461
MOS loads, differential pair with, 123–26
MOS SPICE models, 34–35
multiﬁnger transistors, 737–39
multiply-by-two circuits, 567–68
multipole systems, 414–16
mutual inductance, 770–71
N
nanometer design studies, 459–507; deep-submicron effects,
460–63; transconductance scaling, 463–65; transistor
design considerations, 459–60, 466–72
natural signals, processing of, 1–2
negative feedback, 410–11. See also feedback; effect on
nonlinearity, 581–84
negative resistance, 626–30
negative-TC (temperature coefﬁcient) voltage, 513–14
NFETs: bulk, 34; threshold voltage, 11
NMOS (n-type MOS) devices: bulk voltage, 20–22;
common-source stage, 368, 369; large-signal behavior
of, 17; latch-up in, 730–31; in operational ampliﬁers,
355–58; parameters of Level 1 SPICE models, 35;
processing technology, 712–31; structure, 8–9; as
switches, 548; used by source follower as current
source, 69; vs. PMOS Devices, 35
nodes: association with poles, 179–80; in cascode stage,
196–98; in common-gate stage, 193–96; and
differential pairs, 198–203; input. See input nodes;
interaction between, 179; output. See output nodes; and
source followers, 188–93
noise, 219–67; amplitude distribution, 224–25; analysis
procedure, 227; average power, 220; bandwidth, 264;
cascode stage, 254; common-gate stage, 249–52;
common-mode, 101; common-source stage, 244–49;
corner frequency, 235–36; correlated/uncorrelated
sources of, 225–26; correlation, problem of, 265–67; in
current mirrors, 254–56; in differential pairs, 256–62;
effect of feedback on, 298–99; ﬂicker, 234–36, 252–53;
input integration, problem of, 265; input-referred,
237–42; kT / C, 553; noise-power trade-off, 263–64;
operational ampliﬁers, 349; in operational ampliﬁers,
402–5; output, 236–37; predicting properties of, 219;
reduced by offset cancellation, 602–3; reference
generator, 525–29; representation in circuits, 236–43;
signal-to-noise ratio, 226–27; in source followers,
253–54; spectrum, 221–24; statistical characteristics,
219–27; in telescopic operational ampliﬁers, 402;
thermal, 228–33, 249–52; types of, 228–36; white, 223
noise-power trade-off, 263–64
noisy lines, 101
noninverting ampliﬁers, 562–67; precision considerations,
565–66; speed considerations, 566–67
nonlinearity, 576–91. See also linearity; capacitor, 583–84;
deﬁnition of, 578; of differential circuits, 579–81;
effect of negative feedback on, 581–84; general
considerations, 576–79; reduction, 280–82; in

Index
779
sampling circuits, 584–85
nonlinear systems, input-output characteristic, 46
Norton equivalent, 67
Nyquists stability criterion, 439–55; construction of polar
plots, 442–47
O
offset: DC, 593–97; operational ampliﬁer, 518–21
offset cancellation, 598–602; reduction of noise by, 602–3
ohmic sections, MOSFET, 231–32
one-dimensional cross-coupling, 742–43
one-pole feedforward ampliﬁers, 412
one-pole systems, 279–80
one-port oscillators, 626–30
one-stage operational ampliﬁers, 349–61, 397–99
op amps. See operational ampliﬁers (op amps)
open-loop circuits, 278
open-loop gain, 276–77, 303; in operational ampliﬁers,
345–46; and voltage-voltage feedback, 306–8
open-loop transfer function, 275
operational ampliﬁers (op amps), 344–405; cascode, 345;
design examples, 472–95; design procedure, 353–54;
folded-cascode, 355–61, 394–95, 402–3; gain, 345–46;
gain boosting, 364–73; high-slew-rate, 397–400; input
range limitations, 388–90; large-signal behavior, 348;
linearity, 348–49; linear scaling, 354–55; noise and
offset of, 349; noise in, 402–5; offset and output
impedance, 518–21; one-stage, 349–61, 397–99;
open-loop gain, 345–46; output swing, 348, 373–74;
performance parameters, 344–49; power supply
rejection, 400–402; slew rate, 390–400; small-signal
bandwidth, 346–49; supply rejection, 349; telescopic,
394, 473–87; telescopic cascode, 351–52, 356, 360,
420–26; topology comparison, 373; two-stage, 361–63,
399–400, 426–36, 487–95
operational transconductance ampliﬁer (OTA), 146
oscillators, 607–49; Colpitts, 624–26; cross-coupled, 621–23;
general considerations, 607–9; LC, 618–30, 641–44;
one-port, 626–30; ring, 609–18; voltage controlled. See
voltage-controlled oscillators (VCOs)
output impedance, 181; boosting, 369; cascode stage, 85–86;
common-gate stage, 79–82; and current-voltage
feedback, 292–93; operational ampliﬁer, 518–21;
reference generator, 525–29; source follower, 71, 73,
191–93; variation with drain-source voltage, 700–701;
and voltage-current feedback, 296–97; voltage-voltage
feedback, 287–88
output nodes: in cascode stage, 196–98; in common-gate stage,
193–96; in common-source stage, 181–87; and
differential pairs, 198–203; and source followers,
188–93
output noise, 236–37
output phase, in phased-locked loops, 653–54
output poles. See also input poles; poles: in cascode stage,
196–98; in common-gate stage, 193–96; in
common-source stage, 181–87; and differential pairs,
198–203; and source followers, 188–93
output resistance, 64–67, 70
output spectrum theorem, 223–24
output swing, 348, 373–74
output voltage, 150; swing, 106
oxidation, 715–16
oxide spacers, 720–21
P
packaging, 764–72; dual-in-line package, 764; mutual
inductance, 770–71; parasitics, 765–66;
self-inductance, 766–70
pads, bonding, 757–59
parallel capacitance, of interconnects, 729
parameter variations, in MOSFETs, 708–9
parasitic: capacitance, 180; packaging, 765–66
passive devices: analog layout techniques, 746–53; capacitor
layout, 750–53; diode layout, 753; fabrication, 721–27;
interconnect layout, 753–58; MOS, 721–27; pads and
electrostatic discharge (ESD) protection, 757–59;
resistor layout, 746–50
PDs. See phase detectors (PDs)
PFDs. See phase/frequency detectors (PFDs)
PFETs, bulk, 34. See also PMOS (p-type MOS) devices
phase crossover frequency, 411, 417
phase detectors (PDs), 651–52
phase/frequency detectors (PFDs): in charge-pump
phase-locked loops, 667–69; PFD/CP nonidealities,
677–81
phase-locked loops (PLLs), 651–89; applications, 685–89;
dynamics, 660–65; frequency multiplication, 685–86;
frequency synthesis, 687; jitter, 678–79, 681–83; jitter
reduction, 688–89; nonideal effects, 677–83; phase
detectors, 651–52; simple, 651–65; skew reduction,
687–88; small transients in locked condition, 656–60;
waveforms in locked condition, 655–56
phase margin, 416–19
photolithography, 714–15
photoresists, 715
pinch-off behavior, 16–17, 23; effect of scaling on, 694
PLLs. See phase-locked loops (PLLs)
PMOS (p-type MOS) devices: common-source stage, 368–69;
differential pair, 604; diode-connected, 56; latch-up in,
730–31; layout, 733; NMOS devices vs., 35; in
operational ampliﬁers, 355–58; parameters of Level 1
SPICE models, 35; processing technology, 712–31; in
ring oscillators, 618; small-signal model, 34; source
follower, 73; structure, 8–9; as switches, 547, 548;
turn-on phenomenon in, 12
poles: association with nodes, 179–80; in cascode stage,
196–98; in common-gate stage, 193–96; and
differential pairs, 198–203; dominant, 421–26; input.
See input poles; multipole systems, 414–16; at origin,
450–53; output. See output poles; plotting location of,
412; and source followers, 188–93; two-pole feedback
systems, 609–10
poor mans cascode, 88–89
positive feedback, delay variation by, 636–38
positive-TC (temperature coefﬁcient) voltage, 514–15
power ampliﬁer (PA), 45

780
Index
power dissipation, in voltage-controlled oscillators, 632
power spectral density (PSD), 223
power supply rejection, operational ampliﬁers, 400–402
precision: in high-speed ampliﬁers, 496–98; in noninverting
ampliﬁers, 565–66; in sampling circuits, 549–53; in
unity-gain sampler/buffers, 558–59
precision multiply-by-two circuits, 567–68
process corners, 708–9
processing: back-end, 720–21; CMOS devices, 712–31;
deposition and etching, 718; ion implantation, 716–17;
latch-up, 730–31; oxidation, 715–16; photolithography,
714–15; wafer, 713
proportional to absolute temperature (PTAT), 509
PTAT (proportional to absolute temperature) current
generation, 523–24
punchthrough effect, 26
Q
qualitative analysis, differential pairs, 104–6
quantitative analysis, differential pairs, 106–17
R
reduction, nonlinearity, 280–82
reference distribution, 744–46. See also bandgap references
reference generator, output impedance, 525–29
rejection: common-mode noise, 101; power supply, 400–402;
supply, 349
resistance, 33; gate, 232; negative, 626–30; output, 64–67, 70;
series, 728; sheet, 713
resistive biasing, 135
resistive degeneration, 585–91
resistors: continuous-time, 568, 569; discrete-time, 569; layout
in passive devices, 746–50; mismatched, 120–23;
n-well, 724; passive MOS device, 723–24; thermal
noise, 228–30
return ratio (RR): difﬁculties with, 334–36; and loop gain,
322–24
ring oscillators, 609–18; amplitude limiting, 612–18;
ﬁve-stage, 615; four-stage, 615; three-stage, 610–12;
tuning in, 633–41
root locus, 412
S
samplers: and offset cancellation, 602–3; unity-gain, 555–62
sampling: bottom-plate, 555
sampling circuits: differential, 554–55; nonlinearity in,
584–85; precision considerations, 549–53; speed
considerations, 547–49
sampling mode: noninverting ampliﬁers, 562;
switched-capacitor circuits, 541–42; unity-gain
sampler/buffer, 555, 559
sampling switches, 543–55
saturation, 47; region, 16–18; velocity, 698–700
scaling: constant-ﬁeld, 692; current, 745–46; high-speed
ampliﬁers, 502–5; theory, 691–95; transconductance,
463–65
second-order effects, 20–26
self-inductance, 766–70
sense and return mechanisms, 284–86
sensing techniques, common-mode feedback, 377–80
series resistance, of interconnects, 728
settling time, deﬁnition of, 496
shadowing, 740
shallow trench isolation issues, 743–44
sheet resistance, 713
shielding, 755
shielding property: cascode stage, 89–90
short-channel effects, 695–701; hot carrier effects, 700;
mobility degradation with vertical ﬁeld, 697–98;
threshold voltage variation, 695–97; velocity
saturation, 698–700
short-channel MOSFET devices, long-channel MOSFET
devices vs., 35–36
signals: natural, processing of, 1–2; single-ended vs.
differential, 100–102
signal-to-noise ratio, 226–27
silicide, 721, 723–24
single-ended signals, differential signals vs., 100–102
single-pole system, 279–80
single-stage ampliﬁers, 45–93, 243–54; basic concepts, 45;
cascode stage, 82–92, 254; common-gate stage, 75–82,
249–52; common-source stage, 47–67, 244–49; device
models, choice of, 92–93; source follower, 68–75;
source followers, 253–54
skew: eliminating in voltage-controlled oscillators, 653–54;
reducing in phase-locked loops, 687–88
slewing: negative, 438; positive, 438; in two-stage operation
ampliﬁers, 433–36; in unity-gain sampler/buffer, 561
slew rate, operational ampliﬁers, 390–400
small-signal analysis, of active current mirrors, 152–56
small-signal bandwidth, operational ampliﬁers, 346–49
small-signal behavior: in active current mirrors, 146–49;
differential pairs, 110–13
small-signal characteristics, cascode stage, 84
small-signal gain, 146–52; calculating, 68; in nonlinear
ampliﬁer, 577, 579–81
small-signal models, 31–34, 62, 65–66; of CS stage, 51
small-signal output resistance, calculating, 70–72
source degeneration, common-source stage with, 61–67
source/drain junction capacitance, 692–93
source followers, 68–75; biasing, 165–66; common-mode
feedback using, 378; drawbacks of, 73–74; input
impedance, 73, 189; input-output characteristic, 68;
intrinsic, 72; as level shifters, 188–93; output
impedance, 71, 73, 191–93; single-stage ampliﬁers,
253–54; small-signal equivalent circuit, 69
source impedance, 241
sources, 7, 8
spacers, oxide, 721
spacing, layout, 734
spectral shaping, 223–24
speed: in high-speed ampliﬁers, 498–500; in noninverting
ampliﬁers, 566–67; reference generator, 525–29; in
sampling circuits, 547–49; in unity-gain
sampler/buffers, 559–62
SPICE models, 34–35

Index
781
stability: and frequency compensation, 410–55; general
considerations, 410–14; Nyquists criterion, 439–55
start-up, 522
statistical characteristics, of noise, 219–27
step response, 390–91
structure, MOSFET, 8–9
substrate, 8–9; coupling, 760–64
subthreshold conduction, 24–25
supply: dependence, 522; rejection, 349
supply-independent biasing, 509–12
switched-capacitor ampliﬁers, 555–68
switched-capacitor circuits, 539–72; general consideration,
539–43; in sampling mode, 541–42
switched-capacitor integrator, 568–71
switches: complementary, 554; dummy, 553–54; MOSFETs
as, 7–8, 543–47; sampling, 543–55; zero-offset, 547
symbols, MOS, 9–10
symmetry, 112, 150. See also asymmetry; in layouts,
739–43
T
tail current, 120–21
telephone bandwidth, and spectral shaping, 223–24
telescopic cascode, 82
telescopic operational ampliﬁers: bias circuit, 477; cascode,
351–52, 356, 420–26; common-mode feedback,
477–82; design of, 473–87; differential compensation,
485–87; noise in, 402; slewing in, 394
temperature dependence: in MOS device models, 708
temperature-independent references, 513–22; bandgap
references, 515–22; negative-TC (temperature
coefﬁcient) voltage, 513–14; positive-TC (temperature
coefﬁcient) voltage, 514–15
temperature-independent voltage, 515–16
terminal, 9
terminal impedance modiﬁcation, 278–79
thermal noise, 228–33, 249–52; MOSFETs, 230–33; resistors,
228–30; voltage, 244–49
Thevenin equivalent, 71–72, 79, 111, 202, 566
three-pole system, 415–16
three-stage ring oscillators, 610–12
threshold voltage, 10–12, 25, 150; variation, 695–97
time-domain response, 412, 413
topologies: common-mode feedback, 377; comparison of
operational ampliﬁer, 373; feedback, 286–98;
operational ampliﬁers, 349–52; phase-locked loops,
653–60
transconductance, 19–20, 48; ampliﬁers, 282–84; calculation
of, 364; of common-source device, 63; as function of
overdrive voltage, 462; MOSFET, 524; scaling, 463–65
transfer function: in charge-pump phase-locked loops, 672–77;
closed-loop, 275; common-gate stage, 180; in
common-source stage, 181–87; input-output, 178;
Middlebrooks method, 331–32; open-loop, 275; in
phase-locked loops, 660–65; and spectral shaping,
223–24
transients in locked condition, response of phase-locked loops,
656–60
transimpedance ampliﬁers, 282–84
transistors. See also CMOS devices; MOSFETs
(metal-oxide-silicon ﬁeld-effect transistors): clamp,
395–96; design, 459–60, 466–72; dummy, 740;
fabrication of, 718–20; multiﬁnger, 737–39
triode load, common-source stage with, 60–61
triode region, 14–15, 18, 49, 150; common-mode sensing
using MOSFETs in, 379
tuned stages, 621
tuning: delay variation by interpolation, 638–40; delay
variation by positive feedback, 636–38; in LC
oscillators, 641–44; linearity, 632; range, in
voltage-controlled oscillators, 632; in ring oscillators,
633–41; wide-range, 640–41
turn-on phenomenon, 11–12
two-pole systems, 414–15
two-stage operational ampliﬁers, 361–63, 399–400;
closed-loop behavior, 493–95; common-mode
feedback in, 386–88, 489–90; design, 487–95;
frequency compensation, 426–33; slewing in, 433–36
U
uncorrelated sources, of noise, 225–26
unity-gain sampler/buffer, 388, 389, 419, 555–62; precision
considerations, 558–59; slewing behavior, 561; speed
considerations, 559–62
V
variable-gain ampliﬁers (VGAs), 126–28
velocity saturation, 461, 698–700
vertical ﬁeld, mobility degradation with, 461–63, 697–98
VGAs. See variable-gain ampliﬁers (VGAs)
vias, 721
voltage: ampliﬁers, 282–84, 589; bulk, 20–22; control,
126–28; drain-source, 700–701; ﬂoating reference,
534; gate, 145; input, 69; input-referred thermal noise,
244–49; limitations, 26; meters, 284–86; negative-TC
(temperature coefﬁcient), 513–14; output, 106, 150;
positive-TC (temperature coefﬁcient), 514–15;
temperature-independent, 515–16; threshold, 10–12,
25, 150, 695–97
voltage-controlled oscillators (VCOs), 630–49. See also
oscillators; center frequency, 632; deﬁnition of, 631;
eliminating skew in, 653–54; jitter in, 682–83;
mathematical model of, 644–49; output amplitude,
632; output signal purity, 633; power dissipation, 632;
supply and common-mode rejection, 633; tuning
range, 632
voltage-current feedback, 294–97; and input impedance,
296–97; loading in, 310–13; and output impedance,
296–97
voltage gain, 86–87, 152–55; lemma, 67; small-signal, 579–81
voltage-voltage feedback, 286–91; loading in, 304–8; and
open loop gain, 306–8
W
wafers: in device fabrication, 718–21; processing, 713
waveforms: in locked condition, 655–56

782
Index
well proximity effects, 744
white noise, 223
wide-range tuning, 640–41
width, layout, 734
Y
Y model, 303–4
Z
zero: calculation in common-source stage, 185–86; in right
half plane, 430–31, 436
zero-offset switches, 547
zero-value time constant (ZVTC) method, 208–12
Z model, 303–4, 310
ZVTC method. See zero-value time constant (ZVTC) method

