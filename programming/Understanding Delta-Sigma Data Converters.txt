Understanding Delta-Sigma
Data Converters
Richard Schreier
Analog Devices, Inc.
Gabor C. Temes
Oregon State UniversIty
+IEEE
IEEE Press
rnWILEY-
~INTERSCIENCE
A JOHN WILEY & SONS. INC.• PUBLICATION

CHAPTER 1
CHAPTER 2
Contents
Foreword
xi
References
xii
Introduction
I
1.1 The Need for Oversampling Converters
1
1.2 Delta and Delta-Sigma Modulation
4
1.3 Higher-Order Single-Stage Noise-Shaping Modulators
9
1.4 Multi-Stage (Cascade. MASH) Modulators
10
1.5 Bandpass 8.:E Modulators
13
1.6 ~ Modulators with Multj·Bit Quantizers
15
1.7 Delta-Sigma Digital·to-Analog Converters
16
1.8 History; Performance and Architecture Trends
17
The First-Order Delta Sigma Modulator
2/
2.1 Quantizers and Quantization Noise
21
2.1.1 Binary Quantization
28
v

vi
CHAPTER 3
CHAPTER 4
Contents
2.2 MODI as an ADC
19
2.3 MODI as a DAC
34
2.4 MODI Linear Model
36
2.5 Simulation ofMODl
38
2.6 MOOt under DC Excitation
41
2.6./ldle Tone Generation
42
2.62 Graphical Visualization
45
2.7 Stability ofMODt
49
2.8 The Effects ofFinite Op-Amp Gain
50
2.8.1 Linear Systems Perspective- Degraded Noise Shaping
50
2.8.2 Nonlinear Systems Perspective- Dead ames
51
2.9 Decimation Filters for MODI
54
2.9.1 The Sine Filter[9j
55
2.9.2 The Sinc2Filter
58
2.10 ConclusionS
60
The Second-Order Delta-Sigma Modulator
63
3.1 The Second-Order Modulator: MOD2
63
3.2 Simulation of MOD2
67
3.3 Nonlinear Effects in MOD2
71
3.31 Signal-dependent quantizer gain
7/
3.3.2 StabilIty a/MOD2
74
3.3.3 Dead-band behaVIor
77
3.4 Alternative Second-Order Modulator Structures
79
3.4.1 The Boser-Wooley Modulator
79
3.4.2 The Silvo-Steensgaard Structure
80
3,4.3 The Error-Feedback Structure
81
3.4.4 Generalized Second-Order Structures
82
3.4.5 Optimal Second-Order Modulator
84
3.5 Decimation Filtering for Second-Order AL Modulators
86
3.6 Conclusions
89
Higher-Order Delta-Sigma Modulation
91
4.1 High-Order Single-Quantizer Modulators
91
4.2 Stability Considerations in High-Order Modulators
97

CHAPTER 5
CHAPTER 6
Contents
4.2.1 Single-Bit Modulators
98
4.2.2 Multi-Bit Modulators {J2J
104
4.3 Optimization of the NTF Zeros and Poles
107
4.3.1 NTF Zero Optimization
107
4.3.2 NTF Pole Optimization
111
4.4 Loop Filter Architectures
115
4.4.1 Loop Filters with DistribUled Feedback and Input Coupling- The CJFB
and CRFB Structures
I1S
4.4.2 Loop Filters with DistribUled Feedforward and Input Coupling- The
ClFF and CRFF Structures
121
4.5 Multi-Stage Modulators
122
4.5.1 The Leslie-Singh (L-D Cascade) Structure {16J
123
4.5.2 Cascade (MASH) Modulators
127
4.5.3 Noise Leakage in Cascade Modulators
132
4.6 Conclusions
136
Bandpass and Quadrature Delta-Sigma
Modulation
139
5.1 The Need for Bandpass and Quadrature Modulation
139
5.2 Bandpass NfF Selection
145
5.2.1 Pseudo N-path transformation
149
5.3 Architectures for Bandpass Delta-Sigma Modulators
151
5.3.1 Topology Choices
151
5.3.2 Resonator Implementations
154
5.4 Bandpass Modulator Example
161
5.5 Quadrature Signals
166
5.6 Quadrature Modulation
172
5.7 Conclusions
176
Implementation Considerations For !1L ADCs
179
6.1 Modulators with Multi-Bit Internal Quantizers
179
6_2 Dual-Quantizer Modulators
182
6.2.1 Dual-Quantization MASH Structure
182
6.2.2 Dual-Quantization Single-Stage Structure
183
6.3 Dynamic Element Randomization
184
vii

viii
CHAPTER 7
CHAPTER 8
Contents
6.4 Mismatch Error Shaping
186
6.4.1 Element Rotation or Data-Weighted Averaging
189
6.4.2 Individual Level Averaging
191
6.4.3 Vector-Based Mismatch Shaping
192
6.4.4 Element Selection Using a Tree Structure
196
6.5 Digital Correction ofDAC Nonlinearity
199
6.5.1 Digitally-Corrected Multi-Bit IU: Modulator with Power-Up
Calibration
200
6.5.2 Digitally-Corrected Multi-Bit IU: ADC with Background
Calibration
202
6.6 Continuous-Time Implementations
205
6.6.1 A Continuous-Time Implementation 0/MOD2
207
6.6.2 Inherent Anti-Aliasing in cr o.I: ADCs
212
6.6.3 Designlssuesjor COl1linUOus-ume Modulators
213
6.7 Conclusions
216
Delta-Sigma DACs
219
7.1 System Architectures for ~ DACs
220
7.2 Loop configurations for llE DACs
222
7.2.1 Single-Stage Delta-Sigma Loops
223
7.2.2 The Error Feedback Structure
224
7.2.3 Cascade (MASH) Structures
226
7.3 .6.I: DACs Using Multi-Bit Internal DACs
229
7.3.1 Dual-Truncation DAC Structures
230
7.3.2 Multi-bit Delta-Sigma DACs with Mismatch Error Shaping
232
7.3.3 Digital Correction o/Multi-Bit Delta·Sigma DACs
236
7.3.4 Comparison ofSingle-Bit and Multi·BitlU: DACs
238
7.4 Interpolation Filtering for li1: DACs
239
7.5 Analog Post-Filters for ~ DACs
243
7.5.1 Analog Post-Filtering in Single-Blt.6.1: DACs
244
7.5.2 Analog Post-Filtering in Multi-Bit tI.:E DACs
251
7.6 Conclusions
253
High-Level Design and Simulation
257
8.1 NTF Synthesis
257
8.1.1 How synthes izeNTF works
260

CHAPTER 9
Contents
8.1.2 limitations ofsynthesizeNTF
261
8.2 NTF Simulation, SQNR Calculation and Spectral Estimation
263
8.3 NTF Realization and Dynamic Range Scaling
266
83.1 The ABCD Matrix
271
8.4 Creating a SPICE-Simulatable Schematic
273
804.1 Voltage Scaling
273
804.2 Timing
274
8.43 kr/C Noise
280
8.5 Conclusions
281
Example Modulator Systems
283
9.1 SCMOD2: General-Purpose Second-Order Switched-Capacitor
ADC
283
9.1.J System Design
284
9.1.2 Tuning
186
9.1.3 Scaling
188
9.104 Verification
289
9.1.5 Capacitor Sizing
292
9.1.6 Circuit Design
294
9.2 SCMOD5: A Fifth~Order Single-Bit Noise-Shaping Loop
298
9.2.1 NTF and Architecture Selection
298
9.2.2Implementation
302
9.23 1nstability and Reset
311
9.3 A Wideband 2-0 Cascade System
311
93.1 Architecture
312
9321mplementation
315
9.4 A Micropower Continuous-Time ADC
317
9.4.1 High-Level Design
318
904.2 Circuit Design
322
9.5 A Continuous-Time Bandpass ADC
326
9.5.1 Architecture/Analysis
318
9.5.2 Subcircuits
333
9.6 Audio DAC
337
9.6.1 Modulator Design
338
9.6.2 1nterpolation Filter Design
344
9.6.3 DAC and Reconstruction Filter Design
355
9.7 Conclusions
357
9.7.1 The ADC State-of-the-Art
357
ix

x
APPENDIX A
APPENDIX B
APPENDIX C
Contents
9.7.2 FOMJustification
359
9.7.2 References
362
Spectral Estimation
365
A.I Windowing
366
A.2 Scaling and Noise Bandwidth
373
A.3 Averaging
377
AA An Example
379
A.S Mathematical Background
383
The Delta-Sigma Toolbox
389
Demonstrations and Examples
390
Summary of Key Functions
391
synthesizeNTF
393
predictSNR
395
simulateDSM
396
simulateSNR
398
realizeNTF
400
stuffABCD, mapABCD
401
scaleABCD
402
calculateTF
403
simulateESL
404
designHBF
405
simulateHBF
408
findPIS
409
Modulator Model Details
410
Noise in Switched-Capacitor Delta-Sigma Data
Converters
417
C.I Noise Effects in CMOS Op Amps
419
C.2 Sampled Thennal Noise
423
C.3 Noise Effects in an SC Integrator
425
C.4 Integrator Noise Analysis Example
433
C.S Noise Effects in Delta-Sigma ADC Loops
435

Foreword
In the next few remarks, we shall explain our reasons for writing this book. Since
its inception in the early 19605, delta-sigma modulation has evolved through a
number of generations and now stands as one of the more popular methods for
constructing high-perlormance analog-la-digital and digital-ta-analog converters.
The concept of noise-shaping, which is central to delta-sigma modulation, contin-
ues to be refined and to be applied to new areas. The technical literature contains a
wealth of infonnation regarding various aspects of delta-sigma modulation, but the
sheer volume of this material acts as a barrier to the designer who is embarking on
his first trip into the land of delta-sigma.
Earlier works to which we contributed served the need for a guide by cataloging
publications and republishing a subset of them [1], or by enlisting the help of a col-
lection of authors [2]. This book, in contrast, provides a coherent and consistent
entry-level reference into the world of delta-sigma. The introductory chapter is, in
essence, a generalist's guide. That chapter is devoted to introducing main roads
and to identifying major landmarks, and so should chart some tenitory which is
unfamiliar to the reader. Do not despair if you feel a little lost, since if you under-
stand that chapter completely you do not deserve to be called a beginner! The
remainder of the text plots a more deliberate course through the countryside, one
xi

Foreword
which allows time for exploring some of the side roads and for pondering a num-
ber of the more remarkable edifices which dot the landscape.
Unfortunately, the text is by no means all-inclusive. In order to have a non-zero
probability of completing this work in a reasonable amount of time, we have had to
make difficult decisions regarding what material would be appropriate for an intro-
ductory text and what material could be omitted. We hope that the reader will find
the route we have chosen makes a pleasant and satisfying journey, and we trust that
the many researchers and designers who cut roads through the wilderness will find
their hard work adequately acknowledged. As always, the blame for any omissions
or misdirections lies with us. Let us know if you encounter any.
Bon voyage!
References
[1]
Oversampling Delta-Sigma Data Converters, J. C. Candy and G. C. Ternes, Eds. New York:
IEEE Press, 1991.
(2]
Delta-Sigma Data Converters, S. R. Norsworthy, R. Schreier and G. C. Ternes, Eds.,
Piscataway NJ: IEEE Press, 1997.
xii

CHAPTER 1
Introduction
In this introductory chapter, the need for oversarnpling data converters will be dis-
cussed, and their performance contrasted with that of NyquistMcate converters.
Delta modulation and delta-sigma modulation will be described and compared.
The basic architectures for delta-sigma
(A~) modulators will be presented, and
newer trends identified.
1.1 The Need for Oversampling Converters
Computational and signal processing tasks are now performed predominantly by
digital means, since digital circuits are robust and can be realized by extremely
small and simple structures which can in turn be combined to obtain very complex,
accurate and fast systems. Every year, the speed and density of digital integrated
circuits (Ies) is increased, enhancing the dominance of digital methods in almost
all areas of communications and consumer products. Since the physical world nev-
ertheless remains stubbornly analog, data converters are needed to interface with
the digital signal processing (DSP) core. As the speed and capability of DSP cores
increases, so too must the speed and accuracy of the converters associated with
them.
1

1 Introduction
Fig. 1.1 illustrates the block diagram of a signal processing system with analog
input and output signals, plus a central digital engine. As shown, the analog input
signal (usually after some amplification and filtering) enters an analog-to-digital
converter (ADC) which transforms it into a digital data stream. This stream is pro-
cessed by the DSP core, and the resulting digital output signal is reconverted into
analog form by a digital-to-analog converter (DAC). The DAC output is usually
also filtered and amplified to obtain the final analog output signal.
Data converters (both ADCs and DACs) can be classified into two main categories:
Nyquist-rate and oversampled converters. In the former category, there ex.ists a
one-to-one correspondence between the input and output samples. Each input sam-
ple is separately processed, regardless of the earlier input samples; the converter
has no memory. Thus, applying a digital input word containing bits bI , b2, ... bN to
a Nyquist-rate DAC ideally results in an analog output
Vou' = V,,/b 1Z-1 + bzZ-Z+ ... + bNZ-N),
(1.1)
(where Vref is the reference voltage) regardless of any previous input word. The
accuracy of conversion can be evaluated by comparing the actual value of VOu! with
the ideal value given by (1.1).
As the name implies, the sampling rateIs of Nyquist-rate converters can be as low
as Nyquist's criterion requires, i.e., twice the bandwidthfB of the input signal. (For
practical reasonS, the actual rate is usually somewhat higher than this minimum
value.)
In most cases, the linearity and accuracy of NyqUist-rate converters is determined
by the matching accuracy of the analog components (resistors, current sources or
Figure 1.1: A modern signal processing system contains a DSP core
bracketed by data converters.
Z

The Need for OYersampling Converters
capacitors) used in the implementation. For example, in the N-bit resistor-string
DAC shown in Fig. 1.2, the resistors must have a relative matching error less than
2-N to guarantee an integral nonlinearity INL less than 0.5 LSB. Similar matching
requirements prevail for ADCs and DACs constructed from current sources or
switched~capacitor(SC) branches. Practical conditions restrict the matching accu-
racy to about 0.02%, and hence the effective number ofbits (ENOB) to about 12,
for such converters.
In many applications (such as digital audio), higher resolution and linearity is
required, perhaps as much as 18 or even 20 bits. The only Nyquist-rate converters
capable of such accuracy are the integrating or counting ones. These, however,
require at least 2N clock periods to convert a single sample, and hence are too slow
for most signal-processing applications.
Oversampling data converters are able to achieve over 20 ENOB resolution at rea-
sonably high conversion speeds by relying on a trade~off. They use sampling rates
much higher than the Nyquist rate, typically higher by a factor between 8 and 512,
VREF
LSB~
LSB+1 __
•••
MSB __
~
DIGITAL
INPUT WORD
o
--1
VOUT
Figure 1.2: A resislor-string DAC. LSB denoles Ihe least significant bit and
MSB Ihe most significant bit of Ihe digital inpuI.
3

1 Introduction
and generate each output utilizing all preceding input values. Thus, the converter
incorporates memory elements in its structure. This property destroys the one-to-
one relation between input and output samples. Now only a comparison of the
complete input and output waveforms can be used to evaluate the converter's accu-
racy, either in the time or in the frequency domain.
A common measure of a converter's accuracy is the signal-to-noise ratio (SNR) for
a sine-wave input. The relationship between ENOB and SNR for an ideal Nyquist
converter with sine-wave excitation is SNR = 6.02ENOB + 1.76. The inverse
relationship is often applied to oversampling converters to convert an SNR into an
effective number of bits.
As will be shown in later chapters, the implementation of oversampling converters
requires a considerable amount of digital circuitry, in addition to some analog
stages. Both need to be operated faster than the Nyquist rate. However, the accu-
racy requirements on the analog components are relaxed compared to those associ-
ated with Nyquist-rate converters. The cost paid for high accuracy thus includes
faster operation and added digital circuitry; both of these are getting cheaper as
digital IC technology advances. Hence, oversampling converters are gradually tak-
ing over in many applications previously dominated by Nyquist-rate ones.
1.2 Delta and Delta-Sigma Modulation
Next, oversampling analog-to-digital converters processing baseband signals (i.e.
signals with spectra centered around dc) will be discussed. Such data converters
contain several stages. Analog and digital filter stages may be used before and after
the stage (called the modulator, or converter loop) which performs the actual ana-
log-to-digital conversion. The two main types of oversampling modulators are the
delta modulator and the delta-sigma modulator. Fig. 1.3a shows a basic delta mod-
ulator used as an ADC. It is a feedback loop, containing an intemallow-resolution
ADC and DAC, as well as a loop filter (here, an integrator). It is a nonlinear system
(due to the quantizing effect of the ADC) as well as a dynamic one (due to the
memory in the integrator), and hence its analysis is a difficult mathematical task.
Simple qualitative understanding of its operation can, however, be gained by using
a linearized model of the internal ADC which consists of a unity-gain buffer and
4

Delta and Delta-Sigma Modulation
an additive quantization noise e. Assuming perfect operation of the DAC as well as
a reference voltage Vref=- 1 V and a sampling rate Is =- 1 Hz, the discrete-time lin·
ear system of Fig. 1.3b results. Analyzing this, it can easily be shown that the (dig-
ital) output signal at time n (i.e. t =- n/Is) is
v(n) = urn) - urn -I) + ern) - ern - I).
(1.2)
The name delta modulator is derived from the fact that the output is based on the
difference (delta) between a sample of the input and a predicted value of that sam-
ple. In the general case, the loop filter may be a higher-order circuit, which gener-
ates a more accurate prediction of the input sample u(n) than u(n-I), to subtract
from the actual u(n). This type of modulator is sometimes called a predictive
encoder.
The advantage of this structure is that for oversampled signals the difference
(u(n) - u(n - 1)) is much smaller than u(n) itself, on average, and hence larger
input signals can be allowed. There are, however, several disadvantages. The loop
filter (integrator for the first-order loop shown) is in the feedback path, and hence
its nonidealities limit the achievable linearity and accuracy. Also, in the demodula-
tor, a DAC and a demodulation filter (for first-order modulators, an integrator) are
(a)
(b)
u--{
U-'-(
§-r-v
H-----l~V
Figure 1.3: (a) A delta mudulator used as au ADC and
(b) its linear z·domain mudel.
5

1 Introduction
needed. The filter has a high gain in the signal band, and hence will amplify the
nonlinear distortion of the DAC as well as any noise picked up by the signal
between the modulator and demodulator.
An alternative oversampling structure which avoids the shortcomings of the pre-
dictive modulator is shown in Fig. 1.4a. It is again a feedback loop, containing a
loop filter as well as an intemallow-resolution ADC and DAC, but the loop filter is
now in the forward path of the loop. Replacing as before the quantizer (ADC) by
its linear model, the linear sampled-data system of Fig. lAb results. Analysis gives
v(n)
~ u(n-1)+e(n)-e(n-1).
(1.3)
Thus. the digital output contains a delayed, but otherwise unchanged replica of the
analog input signal u, and a differentiated version of the quantization error e. Since
the signal is not changed by the modulation process, the demodulation operation
does not need an integrator as was the case for the delta modulator. Hence, the
amplification of in-band noise and distortion at the receiver does not take place.
Furthennore, the differentiation of the error e suppresses it at frequencies which
are small compared to the sampling ratefs. In general, if the loop filter has a high
gain in the signal band, the in-band quantization "noise" is strongly attenuated, a
process now commonly called noise shaping.
(a)
u "trn=:J
.. v
DAC
(b)
~'
U(z)
.. V(z)
"~A~
Figure 1.4: (a) A delta.sigma modulator used as an ADC and
(b) its linear z~domainmodel.
6

e
J
Delta and Delta-Sigma Modulation
Any nonlinearity of the ADC is simply combined with the quantization error e, and
is thus suppressed in-band along with e. Nonlinear distortion in the DAC, however,
affects the output signal without any shaping, and hence it represents a major limi-
tation on the attainable performance. This effect can be handled in various ways.
The simplest, and historically earliest, method is to use single-bit quantization. In
this case, the input/output characteristic of the DAC consists of only two points,
and hence the DAC's operation is inherently linear.t For multi-bit (typically, 2-5
bit) quantization, digital correction or dynamic matching techniques may be used.
These will be discussed in Chapter 5.
It can be shown that the system of Fig. 1.4 can be obtained from that of Fig. 1.3 by
cascading an integrator or summing block with the delta modulator. Hence, the
structure of Fig. 1.4 came to be called a sigma.delta (.r.~) modulator. Alternatively,
one can observe the differencing at the input, followed by the summation in the
loop filter, and hence call the structure a delta·sigma (Ak) modulator. Both terms
have been used in the past to denote the first-order system of Fig. 1.4 with a single-
bit quantizer. Other systems with higher-order loop filters, multi-bit quantizers,
etc. are most properly called noise.shaping modulators, but it is common to extend
the term ~k modulator (or k~ modulator) to these systems as well. This text fol-
lows the accepted usage. Examples of these general Ak modulator systems will be
briefly discussed in the next section.
The
output
noise
due
to
the quantization error in
the
A~ modulator is
q(n) = e(n) - e(n -I),
as
(1.3)
shows.
In
the
z-domain,
this
becomes
Q(z) = (1 - z-1 )E(z) , and in the frequency domain, after z is replaced by ej2nrr ,
the power spectral density (PSD) of the output noise is found to be
(1.4)
t. More precisely, the DAC operation is affine, rather than linear. Since the input-output behavior
ofa memoryless binary DAC can be represented exactly by w = kv + C , where k is the DAC gain
and c is the DAC offset, a binary DAC is linear (in the strict sense of the term) only if c = O.
However, since the dc offset of a converter is often immaterial, the distinction between an affine
DAC and a truly linear DAC is usually unimportant.
7

1 Introduction
Here, T ;
11f, is the sampling period, and S/l) is the I-sided PSD of the
quantization error (noise) of the internal ADe. For "busy" (i.e., rapidly and ran-
domly varying) input signals, one may approximate e with white noise of mean-
square value e;ms = 8.2/12 where 8. is the step size of thequantizer, and thus
(1.5)
The filtering function 1 - z-l is called the noise transfer function (NTF). The
squared magnitude of the NTF as a function of frequency is illustrated in Fig. 1.5.
As Fig. 1.5 illustrates, the NTF of the 8.L modulator is a highpass filter function. It
suppresses e at frequencies around 0, but the NTF also enhances e at higher fre-
quencies around/,/2.
We introduce next the oversampling ratio
f,
OSR; 2f
B
'
(1.6)
where fB is the maximum signal frequency, i.e. the signal bandwidth. OSR defines
how much faster we sample in the oversampled modulator than in a Nyquist-rate
converter.
1 ......
... ,...
3
.
.
.
.
iNiF(~ji"j)i2:
.
4·
2·
00
6.1
0~2
0.3' "6.4
0.5
Normalized Frequency (fIls)
Figure 1.5: Noise-shaping function for the ~ modulator shown in Fig. 1.4.
8

(1.7)
Hlgher-Order Slngle-8tage Noise-Shaping Modulators
Integrating S (j) between 0 andlB gives the in-band noise power. By (1.4)-(1.6),
and assumin: OSR » 1, to a good approximation
n2e2
q2
=
rms.
,m,
3(OSR)3
As expected, the in-band noise decreases with increasing OSR. However, this
decrease is relatively slow; doubling the OSR reduces the noise only by 9 dB, and
hence enhances the ENOB by only about 1.5 bits. Even for OSR ~ 256,
ENOB < 13 bits results, assuming single-bit quantization is used.
1.3 Higher-Order Single-Stage Noise-Shaping Modulators
An obvious way to increase the resolution (i.e., the ENOB) of the tt.~ modulator is
to use a higher-order loop filter. By adding another integrator and feedback path to
the circuit of Fig. lA, the structure of Fig. 1.6 results. Linearized analysis gives
(1.8)
This indicates that the NTF is now (1 - z-t)2 in the z-domain, which applies a
shaping function of (2sin(1tjT))4 to the PSD of e. It follows that the in-band
noise power is (to a good approximation for OSR» 1)
(1.9)
LJ(z)-------..(-1-
z
z-1
V(z)
Figure 1.6: A second-order delta-sigma modulator.
9

(1.10)
1 Introduction
Hence, doubling OSR results in about 2.5 bits of additional resolution. This is a
much more favorable trade-off than that of the tirst-order modulator. For example,
if we assume that single-bit quantization with I!J. = 2 results in e;ms = 1/3, (1.9)
indicates that ENOB is about 19 bits for OSR = 256, whereas a first-order modula-
tor only achieves an ENOB of about 13 bits under the same assumptions.
(Chapter 3 will show that this simple comparison is slightly flawed because a sec-
ond-order single-bit
modulator
exhibits
quantizer overload and
thus
has
e;ms > 1/3. A more accurate value is 17 ENOB for OSR = 256. Despite this 2-bit
discrepancy, the ENOB of a second-order modulator does increase by 2.5 bits for
each doubling of OSR.)
In prinCiple, by adding more integrators and feedback branches to the loop, even
higher-order NTFs can be obtained. For an Lth-order loop filter resulting in
NTF(z) = (I - z-l)L, the in-band noise power is approximately
n2Le2
2
'm,
q
-
""
(2L+ 1)(OSR)2L+ I
and the number of bits added to the resolution by doubling the OSR is given by
L + 0.5. The in-band noise as a function of OSR based on (1.10) is plotted in
Fig. 1.7. Here 0 dB corresponds to a quantization noise power of e;ms'
For high-order loops, stability considerations, which have thus far been ignored,
reduce the achievable resolution to a lower value than that given by the above
equations and Fig. 1.7. For high-order, single-bit modulators the difference is sub-
stantial, amounting to more than 60 dB for a 5th-order modulator. This topic will
be discussed in detail in Chapter 4.
1.4 Multi-Slage (Cascade, MASH) Modulators
An increasingly popular structure, which eases the stability problems associated
with high-order modulators, is the cascade modulator, also called the multi-stage
or MASH (for Multi-stAge noise-SHaping) modulator. The basic concept is illus-
trated in Fig. 1.8. The output signal of the first stage is given by
10

•
Multl~Stage (Cascade, MASH) Modulators
-40·
--60
-80
-100 ..
L=1
Figure 1.7: Theoretical in-band noise power for Llh.order 6L modulators.
LU: Modulator #1
u
DACI--
r0~--'
E
r----------------------
':
fir. Modulator #2
:
,
'
Loop
: V2
jr
Filter
ADC:
:
DAC!--
:
1-
!
Figure 1.8: A multi-stage delta-sigma modulator.
Il

1 Introduction
(1.11)
where STFl and NTF1 are the signal and noise transfer functions, respectively, of
the first stage. The second stage is added to improve the SNR beyond what NTFl
can provide.
As shown in Fig. 1.8, the quantization error E 1 of the input stage is found in analog
form by subtracting the input to its internal quantizer from its output. E1is then fed
to another LU: loop fonning the second stage of the modulator, and converted into
digital fonn. Hence, the output signal of the second stage in the z-domain is given
by
(1.12)
where STF2 and NTF2 are the signal and noise transfer functions, respectively, of
the second stage. The digital filter stages HI and H2 at the outputs of the two
modulator loops are designed such that in the overall output V(z) of the system the
first-stage error E 1(z) is cancelled. By (1.11) and (1.12), this is achieved if the
condition
(1.13)
holds. The simplest (and usually most practical) choice for HI and H2 which sat-
isfies (1.13) is HI ::; k· STF2 and H2 = k· NTFI , where kis constant chosen to
give unity signal gain. Since STF2 is often just a delay, HI is easily realized.
The overall output is then given by
(1.14)
In a typical case. both stages of the MASH modulator may contain a second-order
loop, and their transfer functions may be given by
(1.15)
12

Bandpass AL Modulators
(116)
and
(117)
Choosing k = 2, the output is then
(118)
Thus, the noise-shaping perfonnance is essentially that of a fourth-order single-
loop converter, but the stability behavior is that of a second-order one.
If the condition (1.13) is not exactly satisfied, for example due to imperfections in
the realization of the analog transfer functions, then E1 will appear at the output
multiplied by k[STF2NTFla - NTF ISTF2a], where subscript "a" denotes the
actual value of the analog transfer function. As will be shown in Chapter 4, this
may result in a serious deterioration of the noise performance of the converter.
1.5 Bandpass t!.L Modulators
Up to now, it was assumed that the signal energy was concentrated in a narrow
band at low frequencies, centered at de. In applications such as RF communication
systems, the signal is concentrated in a narrow band of width Is around a center
frequency 10, where Is is. much smaller than Is while 10 is not. In such cases, 6.:[
modulation may still be effective, but now the noise transfer function NTF must
have a bandstop, rather than highpass, character, with zeros located at or around/o.
Fig. 1.9 compares the conceptual output spectra of a lowpass and a bandpass 6.:[
modulator.
A simple way to obtain the NTF of a bandpass 6.~ modulator is to find first an
appropriate lowpass NTF, and then perfonn a z-domain mapping on it. For exam-
ple, the transformation z ~ _z2 maps the frequency range around de (i.e., z = 1)
to the ranges around ±ls/4 (z = tj). Hence, the resulting NTF will have small
13

f
Introduction
values near 10 = 1/4, and will suppress the quantization noise there. This band-
stop noise-shaping makes it possible to achieve a high signal-to-noise ratio (SNR)
for signals whose energy is restricted to frequencies near I s/4.
Note that the z --7 _z2 mapping doubles the order of the lowpass NTF and trans-
fonns the zeros of the NTF from near z = 1 to the vicinity of the z = ±j points,
as illustrated in Fig. 1.10.
o
0.25
0.5
Normalized Frequency
o r---.
en
11.
o
0.25
0.5
Normalized Frequency
Figure 1.9:
Conceptnal output spectra for lowpass andf,l4 bandpass
modulators.
f /2
OSR = -'-
f B
Figure 1.10:
Pole-zero locations of a lowpass NTF and a bandpass NTF.
14

1-
:)
'.
AI Modulators with Multl·Bit Quantlzers
Other techniques for finding the NTF of bandpass ~~ modulators will be discussed
in detail in Chapter 5 along with circuit design techniques for bandpass ~ modu-
lators.
1.6 LU Modulators with Multi-Bit Quantizers
As explained earlier, nonlinearities in the feedback DAC of a .6.1: ADe result in
comparable nonlinearities for the overall conversion. This occurs because the io-
band part of tbe DAC output signal is forced by tbe feedback loop to follow tbe
input signal u very accurately. Hence, if the DAC is nonlinear, its input must be
distorted to give an accurate output. But the DAC input is the overall output of the
loop. which is thus also distorted.
It was this fact which forced early designers of LU: modulators to use single-bit
internal ADCs and DACs in the .6.~ loops. However, single-bit ADCs (which are
essentially comparators) have an
ilI~defined gain factor, as will be shown in
Chapter 2. Also as Chapters 3 and 4 will show, loops containing one-bit quantizers
must remain stable over a wide range of loop gains. This consideration results in a
reduction of the allowable input signal swing, and hence a reduction in the achiev-
able SNR.
For a multi-bit quantizer, the loop is inherently more stable since the quantizer gain
is well-defined, and the no-overload range of the quantizer is increased. In fact, lin-
ear analysis can be used to design the modulator so that its stability is guaranteed.
Furthennore, since the quantization noise decreases by 6 dB for each bit added to
the quantizer and since aggressive high-order noise-shaping functions may be
used, multi-bit modulators may have very high ENOB even at low OSR values.
Hence, there is strong motivation to solve the problem of DAC nonlinearity inher-
ent in the use of multi-bit quantization. While brute-force techniques, such as ele-
ment trimming, have been used earlier, the techniques currently in favor use
auxiliary digital circuitry to manipulate the elements of the DAC so as to reduce
the in-band portion of the error signal introduced by DAC nonlinearities. These
techniques are conceptually very similar to the noise shaping used in 8:E modula-
tors, and are often described with the tenn mismatch shaping. As with noise shap-
ing, the effectiveness of mismatch shaping increases with increasing OSR. For very
15

1 Introduction
low OSR values (OSR < 8), digital techniques can be used to acquire and then cor-
rect the nonlinearity parameters of the DAC.
The topic of multi-bit ~ modulators will be covered in detail in Chapter 4.
1.7 Delta-Sigma Digital-to.Analog Converters
The motivation for using ~ modulation to realize high-performance DACs is the
same as for ADCs: it is difficult if not impossible to achieve a linearity and accu-
racy better than about 14 bits for DACs operated at Nyquist rate. Using ~ modu-
lation, this task becomes feasible. A tt.~ DAC system is illustrated in Fig. 1.11. By
operating a fully digital
tt.~ modulator loop at an oversampled clock rate, a data
stream with (say) 18-bit word length may be changed into a single-bit digital sig-
nal such that the baseband spectrum is preserved. The large amount of truncation
noise generated in the loop is shaped in order to make the in-band noise negligible.
The single-bit digital output signal can then be converted with high (ideally, per-
feet) linearity into an analog signal using a simple two-level DAC circuit. The out-
of-band truncation noise can be subsequently removed using analog lowpass fil-
ters.
As in the case of analog tt.:L loops, using single-bit truncation may lead to instabil-
ity, and hence limits the effectiveness of the noise shaping. Using multi-bit (typi-
cally, 2-5 bit) truncation improves the noise shaping and makes the task of the
analog post filter much easier. The linearity of the DAC for in-band signals can be
achieved by using the same mismatch shaping techniques used in the internal
DACs of analog multi-bit ~:E ADCs.
Also as in the case of ADCs, bandpass tt.:L DACs can be designed. Noise shaping
now suppresses the truncation noise in a narrow frequency band located around a
Multi-bit 18
Digital
Input
Interpolation
~ilter
Digital
AL
Modulator
Simple
Analog
Filter
Analog
Outpul
16
Figure 1.11: A d1: DAC system.

Ie
I-
I-
y
a
,
History; Performance and Architecture Trends
nonzero center frequency 1o. which need not be much smaller than the clock fre-
quencyIs.
~ DACs will be discussed in detail in Chapter 7.
1.8 History; Performance and Architecture Trends
Although the basic idea of using feedback to improve the accuracy of data conver-
sion has been around for about 50 years, the concept of noise shaping was proba-
bly first proposed (along with the name delta-sigma modulation) in 1962 by Inose
et a1. [1]. They described a system containing a continuous-time integrator as the
loop filter, and a Schmitt trigger as the quantizer, which achieved (nearly) 40 dB
SNR, and had a signal bandwidth of about 5 kHz. Since the tracle-off between ana-
log accuracy and higher speed plus additional digital hardware was not particularly
attractive at the time, further research on this topic was relatively sparse for a
while.
Twelve years later, Ritchie proposed the use of higher-order loop filters [2], and in
1986 Adams described an IS-bit ~ ADC which used a third-order continuous-
time loop filter, and a 4-bit quantizer with trinuned resistors performing as the
DAC [3]. Useful theory, as well as analysis and design techniques were developed
by Candy and his collaborators at Bell Laboratories [4J-[8J. Candy and Huynh also
proposed the MASH concept for the digital modulators used in ,6l; DACs [9].
MASH was first applied in l>~ ADCs by Hayashi et al. [10] in 1986.
Using a multi-bit internal quantizer in a ~ loop with digital linearity correction
was proposed by Larson et al. [11] in 1988; the use of dynamic matching (random-
ization) was also introduced for the internal DAC of a 8~ ADC by Carley and Ken-
ney
in
1988 [12].
Various
mismatch-shaping
algorithms
were
suggested
subsequently by Leung and Sutarja [13J, Story [14J, Redman-White and Boumer
[15J, Jackson [16J, Adams and Kwan [17J, Baird and Fiez [18J, Schreier and
Zhang [19J, and Galton [20].
Bandpass .6I modulators were motivated for their potential applications in wire-
less communications, and emerged in the late 1980s [21]-[23].
17

1 IntroductIon
Current design trends in ~~ converters are aimed at extending the signal frequency
range without any reduction in SNR. This will open up new applications in digital
video, wireless and wired communications, radar, etc. Higher speed can often be
achieved by using high-resolution (typically, 5-bit) internal quantizers, and a mul-
tistage (2- or 3-stage) MASH architecture. To correct for the nonlinearity of the
internal DAC and for quantization noise leakage, digital correction algorithms
have been proposed [24] for l!.L ADCs. A great deal of effort is also being applied
to improving the perfortnance of bandpass l!.L ADCs [25]-[28].
Technological trends (finer line widths, accompanied with lower breakdown volt-
ages)
stimulated
research
into
~
modulators
needing only
low
supply
voltages [29]. Also, applications opening up in portable devices motivated the
development of low-power design techniques for ~~ data converters [30],[31]. As
noise-shaping theory and practice continue to mature, 6.~ data converters can be
expected to expand their range of application further.
References
[I]
H. Inose, Y. Yasuda and J. Murakami, ''A te1emetering system by code modulation- d-1:
modulation," IRE Trans. Space Electron. Telemetry, vol. 8, pp. 204-209, Sept. 1962.
[2]
G. R. Ritchie, J. C. Candy and W. H. Ninke. "Interpolative digital to analog converters,"
IEEE Transactions on Communications, vol. 22, pp. 1797-1806, Nov. 1974.
[3]
R. W. Adams, "Design and implementation of an audio 18-bit analog-to-digital converter
using oversampling techniques," Journal o/the Audio Engineering Society, vol. 34, pp. 153~
166, March 1986.
[4]
J. C. Candy, "A use of limit cycle oscillations to obtain robust analog-to-digital converters,"
IEEE Transactions on Communications, vol. 22, no. 3, pp. 298-305, March 1974.
[5)
J. C. Candy, B. A. Wooley and O. J. Benjamin, "A vOiceband codec with digital fillering."
IEEE Transactions on Communications, vol. 29, no. 6, pp. 815-830. June 1981.
[6]
J. C. Candy and O. J. Benjamin, "The structure of quantization noise from sigma-delta
modulation," IEEE Transactions on Communications, vol. 29, no. 9, pp. 1316-1323, Sept.
1981.
[7]
J. C. Candy, "A use of double integration in sigma-delta modulation," IEEE Transactions on
Communications. vol. 33. no. 3, pp. 249-258, March 1985.
[8]
J.
C.
Candy,
"Decimation
for
sigma-delta
modulation,"
IEEE
Transactions
on
Communications, vol. 34. no. I, pp. 72·76, Jan. 1986.
[9]
1. C. Candy and A. Huynh, "Double integration for digital·to-analog conversion." IEEE
Transactions on Communications, vol. 34, no. 1, pp. 77-81, Jan. 1986.
[10]
T. Hayashi, Y. Inabe, K. Uchimura and A. Iwata, "A multistage delta-sigma modulator
without double integration loop," ISSCC Digest ofTechnical Papers, pp. 182-183, Feb. 1986.
18

y
[11 J
~
e
[12J
i-
[13J
e
s
j
[l4J
[lS]
[16J
[17J
[18J
[l9J
[20J
[21]
[22]
[23J
[24J
[2SJ
[26J
[27]
History; Performance and Archltectul1I TAlnds
L E. Larson, T. Cataltepe and G. C. Ternes, "Multi-bit oversampled U
AfD converter with
digital error correction," Electronics Letters. vol. 24, pp. 1051-1052, Aug. 1988.
R. Carley and J. Kenney, "A 16-bit 4'th order noise-shaping D/A converter," IEEE
Proceedings ofthe Custom Integrated Circuits Conference, pp. 21.7.1-21.7.4, 1988.
B. H. Leung and S. Sutatja, "Multi-bit E-Li. AID converter incorporating a novel class of
dynamic element matching," IEEE Transactions on Circuits and Systems Il, vol. 39, pp. 35-
51, Jan. 1992.
M. J. Story, "Digital to analogue converter adapted to select input sources based on a
preselected algorithm once per cycle of a sampling signal," U.S. patent number 5138317,
Aug. 11 1992 (filed Feb. 10 1989).
W. Redman-White and D. J. L. Boumer, "Improved dynamic linearity in multi-level 1:.1
converters by spectral dispersion of 0/A distortion products," lEE Conference Publication
European Conference on Circuit Theory and Design, pp. 205-208, Sept. 5-8 1989.
H. S. Jackson, "Circuit and method for cancelling nonlinearity error associated with
component value mismatches in a data converter," U.S. patent number 5221926, June 22
1993 (filed July 1 1992).
R. W. Adams and T. W. Kwan, "Data-directed scrambler for multi-bit noise-shaping D/A
converters," U.S. patent number 5404142, April 4 1995 (filed Aug. 1993).
R. T. Baird and T. S. Fiez, "Linearity enhancement of multibit &I: AID and DIA converters
using data weighted averaging," IEEE Transactions on Circuits and Systems II, vol. 42,
no. 12, pp. 753-762, Dec. 1995.
R. Schreier and B. Zhang, "Noise-shaped multibit D/A convertor employing unit elements,"
Electronics Letters, vol. 31, no. 20, pp. 1712·1713, Sept. 28 1995.
I. Galton, ''Noise-shaping D/A converters for &I: modulation," IEEE Transactions on
Circuits and Systems Il, Proceedings ofthe 1996 IEEE International Symposium on Circuits
and Systems, vol. I, pp. 441-444, May 1996.
T. H. Pearce and A. C. Baker, "Analogue to digital conversion requirements for HF radio
receivers," Proceedings ofthe lEE Colloquium on system aspects and applications ofADCs
for radar, sonar and communications, London, Nov. 1987, Digest No 1987/92.
P. H. Gailus, W. J. Turney and F. R. Vester, Jr., "Method and arrangement for a sigma delta
converter for bandpass signals," US Patent number 4,857,928, Aug. 1989 (filed Jan. 1988).
R. Schreier and W. M. Snelgrove, "Bandpass sigma-delta modulation," Electronics Letters,
vol. 25, no. 23, pp. 1560-1561, Nov. 91989.
X. Wang, U. Moon, M. Liu and G. C.Temes, "Digital correlation technique for the
estimation and correction of DAC errors in multibit MASH .6E ADCs," 2002 IEEE
International Symposium on Circuits and Systems, vo!. 4, pp. 691-694, May 2002.
W. Gao and W. M. Snelgrove, "A 950-MHz IF second-order integrated LC bandpass delta-
sigma modulator," IEEE Journal of Solid·State Circuits, vol. 33, no. 5, pp. 723-732, May
1998.
G. Raghavan, J.P. Jensen, J. Laskowski, M. Kardos, M. G. Case, M. Sokolich and S. Thomas
III, "Architecture, design, and test of continuous-time tunable intennediate-frequency
bandpass delta-sigma modulators," IEEE Journal ofSolid-State Circuits, vo!. 36, no. I, pp.
5-13, Jan. 2001.
P. Cusinato, D. Tonietto, F. Stefani and A. Baschirotto, "A 3.3-V CMOS 10.7-MHz sixth-
order bandpass E.6 modulator with 74-dB dynamic range," IEEE Journal of Solid-State
Circuits, vo!. 36, no. 4, pp. 629-638, April 2001.
19

1 Introduction
[28]
R. Schreier, J. Lloyd, L. Singer, D. Paterson, M. Timko, M. Hensley, G. Patterson, K. Behel,
J. Zhou and W. J, Martin, "A 50 mW Bandpass LA ADC with 333 kHz BW and 90 dB DR,"
[nternatioMI Solid-State Circuits Conference Digest o/Technical Papers, pp. 216-217, Feb.
2002.
[29]
M. Keskin, Un-Ku Moon and G. C. Ternes, "A I-V IO-MHz clock-rate 13-bit CMOS.liI:
modulator using unity-gain-reset oparnps, "IEEE Journal of Solid-State Circuits, vol. 37,
no. 7, pp. 817 -824, July 2002.
[30]
E. van der Zwan and E. Dijkmans and J. Huijsing, "A 0.2 mW U
modulator for speech
coding with 80 dB dynamic range," IEEE Journal 0/ Solid-State Circuits, vol. 31, no. 12,
pp. 1873-1880,Dec. 1996.
[31]
M. Annovazzi, V. Colonna, G. Gandolfi, F. Stefani and A. Baschirotto, "A low-power 98-dB
multibit audio DAC in a standard 3.3-V 0.35J.1m CMOS technology," IEEE Jourlw.I o/Solid-
State Circuits, vol. 37, no. 7, pp. 825-834, July 2002.
20
i
c

b.
E
"
h
CHAPTER 2
The First-Order Delta
Sigma Modulator
After a brief review of quantizers and quantization noise, this chapter examines the
firstMorder modulator, which we designate MOD1, from a variety of perspectives.
MODI exhibits many of the features found in more complex systems and thus a
good grasp of its properties provides the background necessary for understanding
many important aspects of the most advanced ill: architectures.
2.1 Quantizers and Quantization Noise
To convert a continuous-time analog signal into a digital one, two operations need
to be performed: sampling the analog signal (usually with a constant sampling
period n and quantizing its amplitude so that it assumes one of a finite number of
allowable values. Quantization is usually unifonn, so that any two adjacent quan·
tized values differ by a fixed level spacing 8. The device carrying out the quantiza-
tion (Fig. 2.1) is called a quantizer or ideal AID converter. It is assumed to be a
memoryless nonlinear device completely defined by its static input/output charac-
teristics, i.e., by its y-v transfer curvet. An example of such a curve is given in
t
A mnemonic for the notation that y is the quantizer input and v is its output is to think of the
quantizer as losing infonnation and to picture the letter v as being the letter y minus its tail.
21

2 The Flrst-Qrder Delta Sigma Modulator
Fig. 2.2, where it is assumed that only positive input values need to be processed
(hence the name unipolar quantizer) and where the step size, 11, is 1. A bipolar
transfer curve, suitable for negative as well as positive inputs, is shown in Fig. 2.3.
In this curve, y::: 0 coincides with a step (rise) of v, and hence it is called a mid~rise
characteristic. In the curve of Fig. 2.4, by contrast, y ;:;:: 0 occurs in the middle of a
flat portion (tread) of the curve. Such devices are called mid-tread quantizers. The
step size is !1. ;:;:: 2 in both cases. This common value for!1. allows the quantization
levels of both quantizers to be integer values: odd integers for the mid-rise quari-
tizer and even integers for the mid-tread quantizer. Unless otherwise noted, the
quantizers considered in this text will be symmetric bipolar quantizers with !1. ::: 2
and a sampling period of T;:;:: 1 second.
It is often desirable to approximate the transfer curve with a straight line v = ky,
where k is the equivalent gain of the quantizer. The deviation of the actual charac-
Quantizer
An~IO-9--J·~1 f
I--"·~Di;ital
Input
.
Output
Figure 2.1: Quantization.
v
2
N
.1i
..~
2k· :
,
'
1
~
:
"
,
o
',1
.. Y
i
.~
o 1
2
2 -,
Figure 2.2: Transfer curve of a unipolar N·bit quantizer.
22

:ct
"3.
"a
Ie
,n
I-
e
2
Quanlizers and Quantization Noise
teristics from the approximate one is called the quantization error, or (not entirely
correctly) the quantization noise, Figs 2.3 and 2.4 illustrate the straight-line
approximation and the quantization error e. Here, k = 1 was used, and thus the dif¥
ference between input thresholds, also known as the least-significant bit size or
LSB size, is also 2.
a)
v
~=ky
b)
8= v· Y
M
M
,,
3
-M
3
1
step size 1:1 =2
1
-4
Y
·M-1
2 4
M+1
·M-1
·4
·3 -
,
LSB size = 2
,
-T
·M
·M
Figure 2.3: (a) Transfer curve and (b) error function of a symmetric
M-step mid-rise quantizer. (M is odd.)
a)
M
v
v= ky
..o;L
b)
M
-3 -1
1 3 5
+
-4
no·overfoad
'Mi ',p,,"""
Figure 2.4: (a) Transfer curve and (b) error function of a symmetric
M-step mid-tread quantizer. (M is even.)
23

2
The Flrst·Order Delta Sigma Modulator
It can be seen from the figures that as long as y is between -(M + 1) and (M + 1),
the error e is between -1 and 1. We call the range of y where this condition is satis-
fied the no-overload input range, or simply input range. The difference between
the lowest and highest levels is called thejUll scale (FS) of the quantizer. Table 2.1
summarizes these and other properties of the quantizers of Figs 2.3 and 2.4.
The ideal quantizer is a deterministic device; v, and hence also the error e, are fully
determined by the input y. However, if y stays within the input range of the quan-
tizer, and changes by sufficiently large amounts from sample to sample so that its
position within a quantization interval is essentially random, then it is permissible
to assume that e is a white noise process with samples uniformly distributed
between -!!J./2 and !!J./2. From the assumed uniform distribution, it is easy to
derive that e has mean zero and mean-square value 0'; = !!J.2/12 [1]. This "noise"
is simply added to the scaled input y to give the output
v = ky+e
Parameter
Value
input step size (LSB size)
2
output step size
2
number of steps
M
number of levels
M+I
number of bits
f!0g2(M + I)1
no-overload input range
[-(M + I),M + IJ
futl·scale
2M
input thresholds
0, ±2, ..., ±(M -I), M odd
±I, ±3, ..., ±(M -I), M even
output levels
±I, ±3, ..., ±M, M odd
0, ±2, ±4, .. " ±M, M even
(2.1)
Table 2.1. Properties of the symmetric quantizers of Figs. 2.3 and 2.4.
24

) ,
s-
.1
ly
1-
ts
Ie
d
o
"
)
Quantlzers and Quantization Noise
Note that (2.1) is always valid; an approximation is only made when e is assumed
to have specified properties such as a uniform distribution or a white spectrum!
Again, such approximations are only justifiable under the conditions stated above.
Inputs for which these conditions are not satisfied, and hence for which the
approximation gives wildly wrong results, include a constant y, or a periodic y with
a frequency hannonically related toIs. especially if y changes from sample to sam-
ple by rational fractions of 8..
To illustrate these points, Fig. 2.5 shows a full-scale sine wave sampled and then
quantized by a 16-step symmetrical bipolar quantizer with 8. = 2. The frequency
fof the input is moderately high compared tois and does not have a simple har-
monic relation toIs. As a result, the quantization error sequence plotted in Fig. 2.6
appears fairly random, although a careful examination of the error sequence as the
input passes through its peaks does reveal a non-zero correlation between adjacent
samples. The mean-square value of the error in this example is found to be 0.30,
which is close to the expected value of 6.2/12 = 1/3.
A fast Fourier-transform (FFI') of v is plotted in Fig. 2.7. The spectrum consists of
one large spike representing the input sine wave, plus many smaller spikes distrib-
uted evenly along the frequency axis, representing the frequency components of
the quantization error. Judging by these results, the white-noise approximation
appears to be reasonable in this situation.
..'.. '" ., .
16 "'-'--'-'--':~~=-'-rT-'--'-rT-'--"---'-'.---'-, '.--r.,.-,--.,-,,-,
.... , .,
, -
. - - -,. .., - -.- .
; -
'.'
.'
, ..'.. '
'
,
.'...
.'
.
8
o
-8
.-
, .., ",'
-' .. ' ..'.. ' .. '
. . . .
., ..:.
.: ..,. -:.. ; .. '...' .. : .. '.
.,.
.,.. ,.
Figure 2,5:
, . .
, .
',' ..... ,. ·.··t··.· ",'"
-
.,.
.
r'
.. ,.
--'- ..... ,
,. ,'.. .'.
-' .• ' ..•.. I .. '.....
-16 O!;-'-'--"--'-·~5-'-'-J·-'---'--1;1O;-'--..L..L.l-:1!<5--'---'-L..l:~O+-I.d="ii25;o-'---'---'-'-;!3·0
Sample Number
A sine wave quantized by a symmetrical 16-step quantizer.
25

2 The Flrst-order Delta Sigma Modulator
Now consider what happens when the full-scale sine wave with frequency
f = I s/8 shown in Fig. 2.8 is quantized by the same 16-step quantizer. The
quantization error, shown in Fig. 2.9, is now periodic and, since it assumes only 3
values, its distribution is far from uniform. The mean-square value of this error
sequence is found to be 0.23. or only about 70% of the expected value. The FFT
shown in Fig. 2.10 represents an even more serious departure from our normal
assumptions in that the spectrum now consists of only two spikes! The quantiza-
tion noise energy is fully concentrated in one tone at I s /8 (coincident with the
signal itself) and a second tone at 31s/8 (the third harmonic of the signal).
;
"
;;
;
-, oLJ-L-'----'--'5:-'---'--'-'--:"0-L-'---L.1-'.L5-'----'-L-L~2LO-l-L..l-L-'25':-'--4-l--'-o3Q
Sample Number
Figure 2.6: Quantization error sequence for the sine wave of Fig. 2.5.
BO,----,--,---,--r--,--,.-----,--,---,---,
dB
60
.
.
. . . - . . . . , .
40
.
.
'..
--
-
-'1
. ;
:
.. : -.... "c'" ....:..
-··c··· .. - .....
.....: .
0.5
0.4
0.1
0.2 .
0.3
Normalized Frequency
A 256-point FFT of the quantized sine wave of Fig. 2.5.
Figure 2.7:
20
26

Quantizers and Quantization Noise
." "
'.'
.'•• '-
_ C • J ••••
...
,
,
. '.' . ,. '.' . '.' " .
. ... - '- _. -
~ - -..
•.••. , ..••. I. .•..
., .•' .
"
- '.'
.. .....
-,'
."
10
15
20
25
30
Sample Number
Figure 2.S: An f = f siS sine wave quantized by a 16·step quantizer.
oy
16
1e
3
.....
8
or
'f
0
.1
.'..
,-
-8
.... . '.' . ,.
Ie
... . ..
..
. ....
-16 0
5
..
.
~ ..
.
~ .
.
.1,l'I'j.1'!'rl,1.1:,.pLU,
-1
~L.J.--'-J....-'---L-.i-'---L-":-LJL.J.--'--":--'---L-.i-'--!-:--'--LJ---'.--'=J....-'---L.J.__:'.
o
5
10
15
20
25
30
Sample Number
Figure 2.9: Quantization error sequence for the sine wave of Fig. 2.8.
-...
.. - .. ~.
-- .... -:....
80,---,---,---,---,---,----.----,-----,-----,----,
dB
60
40
20
....
.
. - - - - - - - - - . . , .
..•.....
.
_.
-.-. -
.
.
.
............
Figure 2.10:
oo!:---.l.....--;:':-.L--.J.....--:,J::---'--;;';:--...L..L~-...l.--~
0.1
0.2
0.3
0.4
0.5
Normalized Frequency
A 256-point FIT of the quantized sine wave of Fig. 2.8.
27

2 The First·Order Delta Sigma Modulator
2.1.1 Binary Quantization
As illustrated in Figs. 2.3-2.4, the gain k of the linear model for multi-bit quantiz~
ers is naturally detennined by the ratio of the step size to the distance between
adjacent thresholds. However, as depicted in Fig. 2.11, the gain of a binary quan-
tizer is not defined so easily because a binary quantizer has only one threshold.
The two approximating lines shown are both possible, and they both result in the
same maximum error /1/2 = 1, although with different no-overload ranges.
If the statistical properties of y are known, an obvious optimality criterion for k is
to minimize the mean square value (also called the average power) of the error
sequence e. This is defined as the expected (or mean) value of e2;t
N
lim
N.! ~ e(n)2
N --+ 00
L.J
n=-Q
(2.2)
A convenient notation is possible by introducing the innerproduct, or scalar prod-
uct. For real sequences a and b, the inner product is defined as
Figure 2.11: A binary quantizer has an ambiguous gain.
,ov=-y/2?
-_.
...
.v=-2y?
••
1
•
~ ~ ..........
....--~--.--.,.,....jO..:..=-. ~~--...y
.- .
.... ,o..
~
-1
•.•.
...
..
...
t
Since we assume that e has zero mean, the variance of e equals its mean-square value, and we
are justified in using 0; to represent the mean-square value of e. If e has a non-zero mean, but is
otherwise white, the variance of e is the appropriate quantity to use in the formulae relating the
in-band noise power to the quantization noise power.
28
•

z-
en
n-
d.
1e
is
1f
(a, b) =
lim [.!. ~ a(n)b(n)] = E[ab]
N~oo N LJ
n=O
Since e = v - ky, the average power of e can be written as
(e, e)
= (v-ky,v-ky)
= (v, v) - 2k(v, y) + k2(y, y)
This is minimized for
MOD1 as an ADC
(2.3)
(2.4)
!)
k = (v, y)
(y, y)
(2.5)
1-
The last part of (2.5) follows since v(n)y(n) = sign[y(n)]y(n) = ly(n)l.
Clearly, the optimal value of k for the linear model of a binary quantizer is depen-
dent on the statistics of its input y. As a sanity check, let k be the gain associated
with an input y according to (2.5). If y' = lOy, then E[Jy'I] = IOE[lyl] and
E[y'2] = IOO(E[y2J), so that k' = k/IO. Thus, the effective gain of a binary
quantizer is reduced by a factor of 10 when its input is amplified by a factor of 10.
This makes physical sense, since v remains the same while y is increased tenfold.
When a system containing a binary quantizer is replaced by its linear model, the
estimate of the quantizer gain k should be found from extensive numerical simula-
tions. Otherwise, misleading results may be obtained from the linear model.
2,2 MODI as an ADC
As already introduced in Fig. 1.4 (repeated here as Fig. 2.12) the simplest analog
dL modulator is a first-order loop containing an integrator, a I-bit ADC and a I-bit
DAC. We use the tenn delta-sigma (LU:) modul4tor to describe a system (analog or
digital) which transforms its input, be it continuous or finely-quantized, into a
29

2 The Flrst-Qrder Delta Sigma Modulat-or
coarsely-quantized output possessing a noise-shaped spectrum. As described in
Chapter 1, 81: modulators can be used to create ADCs or DACs, but since the
underlying dynamics and describing equations are essentially independent of
whether the modulator is being used to create an ADC system or a DAC system,
we use the tenn "modulator" to encompass both applications. Thus the first-order
modulator, MODI, has a variety of uses and implementations and so the use of
MOD1 as an ADC is just the first of several which we shall study.
Fig. 2.13 shows a possible continuous-time (CT) realization of MODI, while
Fig. 2.14 shows a switched-capacitor (SC) one. In the CT system, the I-bit ADC is
simply a comparator followed by a D flip-flop (DFF), while the DAC function is
perfonned by the Rf resistors which connect the DFF outputs to the opamp inputs.
Note that since the reference voltage for the DAC is thus the (noisy) power supply
of the DFF, this circuit is intended for low-perfonnance applications, where circuit
simplicity is more important than modulation accuracy.
In the SC realization, the I-bit ADC is implemented with a clocked comparator
while the DAC is fonned by the (\)2 switches and the C1capacitors. Since the DAC
in this circuit uses a dedicated reference voltage and operates in discrete time, this
implementation is inherently more accurate than the simple CT implementation
shown in Fig. 2.13.
(a)
u
~tOJ=:J
~ v
DAC
(b)
r®j'
"tl
1
U(z)
z-1
~ V(z)
Figure 2,12: (a) A della-sigma modulator used as an ADC and
(b) its linear z-domain model.
30
I
iii
-
~-....iiI

MOD1 as an ADC
in
:he
of
m,
ler
of
Consider the operation of the CT circuit. In order to simplify the discussion, the
high and low output voltages of the flip-flop will be assumed to be +1 and -1 V,
respectively. so that the output v equals sgn{y) in volts. The clocked comparator
feeds back a positive charge through Rf in those clock periods when the sampled
output voltage y(n) of the integrator is positive. thereby driving the output of the
integrator down. If y(n) is negative, a negative charge is fed to the virtual ground
and the output of the integrator rises.
fiD)CQi}.li-~v
DFF
eKQS
clock
r-------
Latched
I
Comparator
I
I~YI I
I
I
r"\/'Ir--+..---j II---' I
I
I
L
_
Ie
is
is
s.
Iy
lit
s
n
L
_
Figure 2.13: An active-RC (continuous-time) implementation ofMODt.
v
C2
...--_-11-,+--,
q2
- -1'''''''-6---1
+u J ',----,
-u -,.;:--_--1
$,
Figure 2.14: A switched-capacitor (discrete-time) implementation of MOOt.
31

2 The Flrst-Qrder Delta Sigma Modulator
Fig. 2.15 shows representative waveforms for a zero input (u = 0) and a slightly
positive input (u = 0.06). For the zero-input case, the integrator output alternately
ramps up and down, and the output v merely toggles between +1 and -1. With a
positive input, the integrator output primarily ramps up and then down, but tends to
drift high over time. After 15 clock cycles, the integrator output is so high that two
adjacent +1s are produced by the comparator and the integrator output takes two
successive downward steps. Clearly, the feedback is acting to regulate the output of
the integrator towards zero, and the only way that can happen over time is if the
average current into the integrating capacitor C equals zero. Thus, the circuit
forces the average of viRf to equal the average of u/R j • Similar conclusions can
be reached regarding the operation of the SC circuit of Fig. 2.14.
The remarkable feature of both of these simple circuits is that for constant inputs
arbitrarily high accuracy can be achieved, at least in principle. Furthermore, a com-
mon source of nonlinearity in a Nyquist converter, namely component mismatch,
is virtually immaterial to a AL converter. To see this, observe that changing the
value of the integrating capacitor in Fig. 2.13 (or changing either C1 or C2 in
Fig. 2.14) simply scales the output of the integrator slightly but does not affect its
polarity, which is the only thing a I-bit ADC detects. For this reason, component-
value shifts do not affect the operation, and hence the accuracy, of the converter.
Similarly, comparator hysteresis, opamp offset and (in the case of the CT circuit)
u=o
2 ",--,-,--,-,-",--"-c," " ,-,-,--,--,--"'"
20
1
:.V: ... :::
... ,
.
-2 L'-'-'-'-''-''-'.c'.c'.c'-'-'--'--'-'-''-'-'-'-'-J
o
5
10
15
Time
-1
.'. ,"'.
, ., -' •••'.'
'.' .'.
,
• C J.' .'
...
" . . ..
," ....
"
. .
. ,
.'.
, •• ,. C J.' .'. , .". , .".
:: :v. :"
-1
-2 L'-'-'-'-''-:"~'-'-'-'-'-'--,--,-"-'-'-:.J
o
5
10
15
20
Time
Figure 2.15: Waveforms for the CT system depleted in Fig. 2.13.
32

MOOt as an ACe
resistor mismatch, have virtually no impact on converter linearity. At worst, the
input full-scale range will shift, and/or the input-referred offset will be non-zero.
The results reached above are readily confirmed by a simple mathematical analy-
sis. Let the circuits in Fig. 2.13 and Fig. 2.14 be modeled by the block diagram of
Fig. 2.16t, where the quantizer Qis assumed to be have the simplified characteris-
tic
(2.6)
v(n) = sgo[y(n)],
fO
fO,r
Ie
lit
'0
ly
Iy
a
to
From the diagram,
Is
,-
y(n) = y(n - 1) + u(n) - v(n - 1)
(2.7)
"e
n
s
and hence, combining equations for n
:= 1,2, ...N
N
y(N)-y(O) = L [u(n)-v(n-1)].
'1=0
(2.8)
)
1-----'
,.-------------1
I
I'
IV
U--r+l-+,--+:....+}---~r-'....
-,
,
,
"
____ .J
I,,,
Q I-f-...v
Figure 2,16: A z-domain block diagram of MODI.
t
Fig. 2.12b shows a delaying integrator while Fig. 2.16 uses a non-delaying integrator with a
delay element in the feedback. Adding a delay to the u input of Fig. 2.16 makes Fig. 2.16 equiv-
alent to Fig. 2.12b.
33

2 The Flrst-Qrder Delta Sigma Modulator
Assume that the loop is stable, so that y(n) is bounded (i.e., finite). Then
From (2.8) and (2.9) it follows that the average of the input samples, defined as
lim y(N) - y(O) = O.
N -"
<>0
N
N -I
u =
lim
N.!. ~ u(n) ,
N-7""
£..J
n=O
equals that of the digital output v.
(2.9)
(2.10)
-
Thus, for a de input u, if we allow the circuit to operate for a sufficiently long time,
the average value of the digital output v will become an arbitrarily good approxi-
mation of the input. This average value can be recovered by cascading a digital
lowpass filter with the .6.~ loop.
Note that MODI uses a single-bit (two-level) quantizer, and hence ideally its DAC
is capable of perfectly linear operation. In practice there are several effects which
may compromise this linearity, such as changes in the value of the reference or
supply voltages with any of the signals, or memory effects in the DAC. These will
be briefly covered in Chapter 6.
2.3 MODI as a DAC
Consider the problem of driving an 8-bit DAC from a 16-bit data stream. One
could simply discard the 8 LSBs of the original data, but doing so would of course
entail a loss of resolution. An alternative method involves trying to make up for the
error caused by truncation in one cycle by introducing the opposite error in the
next cycle. By doing so, errors caused by truncation should average out over time.
Fig. 2.17 shows a system which embodies this principle. In this system, wide input
data (of width mt+m2 =m bits) is added to the contents of the truncation error reg-
ister. The output of the accumulator is truncated to mt bits to drive an ml-bit DAC
34
==!"
I
~Ii

.9)
MOD1 as a OAC
while the mrbit truncation error is stored in the error register for use in the next
cycle. We will shortly see that this system is another incarnation of the first-order
6.~ modulator, albeit with a multi-bit "quantizer."
Since the truncation operation can be viewed as subtraction of the LSBs, we may
write v = Y - YLSB' where YLSB is the truncation error consisting of the m2 LSBs
of y. From the diagram,
Thus the system shown in Fig. 2.17 is equivalent to MOD1. As a result of this
equivalence, the system shown in Fig. 2.17 responds to a de input by alternating
the DAC input code between adjacent levels in such a way that the average of the
analog output corresponds to the m-bit input. Furthermore, it is easy to show that
the accumulated difference between the input and the output is always less than
one DAC LSB.
0)
e,
i-
,I
h
'r
II
y(n) = urn) + hSB(n - 1).
Since hSB(n - I) = y(n - I) - v(n - I), (2.11) may be rewritten as
y(n) = urn) + y(n - I) - v(n - I),
which is identical to (2.7).
Digital modulators will be discussed at length in Chapter 7.
(2.11)
(2.12)
Digital
m=m,+m.
Input ---7L--+l
u
YLSB
Y
m1 MSBs
V
DAC
Analog
Outpul
Figure 2,17: A tirst-order digital modulator used in a lU: DAC.
35

2 The First..Qrder Delta SIgma Modulator
2.4 MODI Linear Model
The two preceding sections presented several implementations of MODI, focus-
sing on its time-domain operation and its response to dc inputs. To provide insight
into the behavior of MOD1 with time-varying inputs, this section studies the z-
domain model of Fig. 2.18, in which the quantizer has been replaced by its linear
model.
From the diagram,
(2.13)
Thus
The de values of u and v (i.e. their average values) can be obtained by setting
z = 1 in (2.14). IfIhe de value of e is finite, V(I) = VO) follows directly from
(2.14). This confinns the conclusion reached earlier in Section 2.2 regarding the
ability of MOD1 to provide arbitrarily high resolution for a de input.
(2.14)
E(z)
Y(z)
·)--~="'.(+·}--,_V(z)
= Y(z) + E(z)
Figure 2.18: A z-domain linear model for MODI.
VIz) = Y(z) + E(z) = z-I Y(z) + VIz) - C l VIz) + E(z)
= V(z)+E(z)-CI(V(z)-Y(z»
= VIz) + E(z) _·z-IE(z)
= V(z) + (1- z-I )E(z).
U(z)
36

MOD1 Linear Model
Eq. (2.14) can be written in the general form
where in this case the signal transfer function (STF) is unity, and the noise transfer
function is NTF(z) = 1 - z-l. In order to estimate the in-band power of the quan-
tization noise, it is useful to find the squared magnitude of NTF in the frequency
domain, by setting z ::: ej2rt!. This givest
For frequencies which satisfyf« 1, INTFI 2=(21</)2. Fig. 2.19 (earlier shown as
Fig. 1.5) illustrates the frequency response of the NTF. It is clearly a highpass
response. which suppresses the quantization noise at and near de (where the signal
energy is) and amplifies it out of band, at and near 0.5 (i.e., f s/2). This noise-
shaping action is the key to the effectiveness of dL modulation.
(2.15)
(2.16)
V(z) = STF(z)U(z) + NTF(z)E(z),
13)
:us~
ght
~
z~
ear
4)
If the conditions discussed in Section 2.1 (large, randomly-varying y) hold, the
error e can be treated as a white noise with a mean~square value cr; = 1/3.
(Recall that we assume !1 = 2.) The 1~sided power spectral density of e is therefore
..
.
4: l";;iF(~j2"f)12:
3 ... c ••• '•••'
• - ,- •• ,.
2
1
., .
.. ......
°ooT~~oT' 0.3"0.4'
0.5
Normalized Frequency (fits)
Figure 2.19: Noise-shaping function for MODt.
t
Here. as before. f. = I is used.
37

2 The Flrst-order Delta sigma Modulator
Sif) ;;;: 2cr; ;;;: 2/3. Then, as already shown in Section 1.2, the in-band noise
power in the output v is given approximately by
1/(2'0SR)
2
,,2 =f
[21tf]2S (f)df =
1t
•
q
0
e
9(OSR)3
(2.17)
Assume that the input signal is a full-scale sine wave with a peak amplitude M.
Since the STF is unity, the output signal power is
cr~ ;;;: M2/2. Hence, the in-
band signal-to-quantization-noise ratio (SQNR) is approximately
SQNR =
(2.18)
As already stated in Section 1.2, (2.18) shows that the SQNR increases by 9 dB for
each doubling of the OSR (i.e., for each octave increase ofIs within fixed). This
results in a relatively low SQNR, less than 70 dB, even for a relatively high value
of OSR such as OSR = 256.
2,5 Simulation of MODI
The behavior of MOD1 is easily simulated in the time-domain using the difference
equations (2.7) and (2.6). All that is needed to perform such calculations are the
samples of the input signal and the initial condition of the integrator. Once the out-
put sequence has been computed, its spectrum can be found using an FFf. How-
ever, to achieve the high numerical accuracy needed, several precautionary
measures must be used; these are discussed in Appendix A. Simulation is an
important tool in .6.!: modulator design because the linear model is imperfect and
can hide important effects which only become apparent when the true nonlinear
nature of the modulation process is taken into account.
As a demonstration that MODI really does shape quantization noise. Fig. 2.20
plots the spectrum of the output of MOD1 when simulated with a full-scale sine-
wave input. This figure clearly shows a noise-shaped characteristic, the hallmark
of LU: modulation, and the 20 dB/decade slope of the noise is consistent with first-
38

Simulation 01 MOD1
As a further demonstration of the complexity lurking in MODI, Fig, 2.22 plots the
simulated in-band noise power as a function of the value of a de input for two val-
.
.
.
. . '..... '...•.
.
. .
. , , , .
-,
.~
~.,."
• •••;•• " ~. - f ••;. i .:-.; .;, .....
o ,.......-~_._.~.~.~.~.~..--~.-_~.-._.~.~..--_--,--,..,
.
, ..
, , , ,
,
,
, . , . ,
·
..•... ' .. l.'.l .• ' .•. _
,_ ..•... ' ..•.. c .•. '.el
SQNR = 55 dB @ OSR = 128
: : : : ::
· .. ',' .,. - ; ", ,. " ",' . . . .. .
,
"
"
','" ,
"
. " . " .. ','
"~",'
~.~.. "
"~ ..
".~.
-~.
Fig. 2.21, which plots the simulated SQNR VS, the input amplitude for two differ-
ent test frequencies, gives a clue as to the source of this SQNR discrepancy. As this
figure demonstrates, the simulated SQNR of MODI is an erratic function of the
input amplitude and frequency, Clearly, the dynamics of MODI are not as simple
as the linear model would lead us to believe.
order shaping, Furthermore, computing the optimal quantizer gain using (2.5)
yields k = 0.90, which is fairly close to the value of 1 assumed in the analysis.
However, the simulated SQNR of 55 dB for OSR = 128 is 5 dB less than the value
of 60 dB predicted by (2.18) with M = I.
~ -20
~
-40
m
~ -60
~
1.80
or
lis
ue
8)
,e
,e
t-
m-
M.
1-
17)
lise
y
n
d
Figure 2.20:
)
t
As with all spectral density plots in this text, the vertical axis ofFig, 2.20 is the power relative to
a full-scale sine wave contained in a certain bandwidth. the noise bandwidth (NBW), Thus the
units on the vertical axis are dB relative to a full-scale sine wave, per bandwidth NBW, which is
abbreviated dBFS/NBW. Appendix A describes the process of spectral estimation in more detail
and explains the origin and significance of NBW.
39

2 The Flrst-Qrder Delta Sigma Modulator
ues of OSR. Also shown are the mean-square levels of the in-band noise, averaged
over all input values. Both plots show that MODI exhibits increased in-band noise
in the vicinity of certain input values. in particular ±1
and O. Comparing
Fig. 2.22a with Fig. 2.22b, we see that as OSR is increased, the widths and abso-
lute heights of the anomalous regions decrease, but relative to the mean noise level
the noise spikes are higher. Candy and Benjamin showed that the central noise
peaks have a height -20Iog(.)20SR) dB and width (OSR)-l [2J. Later. Fried-
man showed that the dominant pattern consists of two large spikes surrounding a
mound of smaller spikes, and that this pattern is duplicated between adjacent pairs
of the smaller spikes in an endless recursion [3].
This and other exotic behavior is a direct consequence of the nonlinear difference
equations which govern MOD1. Although a thorough study is beyond the scope of
this text, it is possible to state some important results and give some indications of
the underlying mechanisms.
100r--,--,--_-_-~__,
D Low-frequency input
oHigh-frequency input
o
·40
-20
Input Amplitude (dBFS)
Figure 2.21: Simulated SQNR for MODI with OSR = 256.
-60
40

MODi under DC Excitation
2.6 MODI under DC Excitation
As mentioned earlier, the linear model used in Section 2.4 is valid only under spe-
cific conditions (large and fast random variations) on the input y to the quantizer,
which can only be satisfied if the input u to the loop meets similar conditions. In
this section, we shall discuss the behavior of MOD1 for an important case in which
these conditions are violated, namely the case of a constant input signal.
.
.
.
........'... , .
.
.
.
. . "," .. " .. ",'
0.5
---'- -.-'
o
-0.5
·
.
·
.
•• c ••• •••••••
·
.
.
·
.
.
.:
:::
OSR = 32
- -, ••• "
•• "," •••••• 'c'
•
-
" •••
,
•
_ ....
- -,-
-
-
,-
-
- -,
••
, ••
-
, ••
en-3D
:s.
~ -40
8.
CI>
.~ ·50
g
'0
~ -60
,
.S
goo
lise
iog
'so-
vel
lIse
'd-
g a
,rs
ce
of
of
.
,-
0.5
: OSR=64
.....
.
,
.
.....
..'. _.'.
-0.5
.
.
... .... _,.
10.30
..
:s.
~ -40
oc.
m·50
"g
-g -60
'"
.0
I:.- ·70
-1
o
DC Input
Figure 2.22:
In~band quantization noise power vs. the DC input level for
MODt. The broken line marks the noise power averaged over all input values.
41

2 The First-Order Delta Sigma Modulator
Combining these relations,
To avoid ambiguity, for y(n) = 0, we assign v(n) = 1. It should also be noted
that by regarding the DAC as a unity-gain element, as is implied in (2.19), we
effectively nonnaIize all analog signals (y and u) to the reference voltage Vref of
the DAC.
(2.19)
(2.20)
yin) = y(n-l)+u-v(n-I)
and
2.6.1 Idle Tone Generation
Consider MODI with a de input u. From the block diagram in Fig. 2.18,
v(n) = sgn(y(n)).
yin) = yin - I) + u - sgn(y(n - I))
(2.21)
results. Although (2.19) and (2.20) can then be used to generate the sequences
yin) and v(n) from a given u and the initial condition y(O), (2.21) shows that the
exotic behavior of MODI can be captured in a single first-order nonlinear differ-
ence equation.
Now
assume
that
u = 1/2
and
also
y(O) = 1/2.
Then
viOl = 1,
y(l) = 1/2 + 1/2 - 1 = 0 and v(l) = I. The y and v sequences are summa-
rized in Table 2.2 for n = 0 to 4. Clearly, for n =4, the same conditions exist as for
n = O. Hence, the output is periodic with a period of 4.
n
0
I
2
3
4
yin)
I
0
I
I
I
2
-2
2
v(n)
I
I
-I
I
I
Table 2,2. MODI operation for u = 112.
42

19)
10)
ed..
of
I)
",e
r-
r
MOD1 under DC Excitation
The average value of v for a full period is (1 + 1-1 + 1)/4 = 1/2, which is
identical to the input u. Thus, as already shown in Section 2.2, MODI is capable of
converting a de input signal with unlimited accuracy, provided it is allowed to
operate for unlimited time, and is followed by a perfect lowpass filter. For the input
under consideration, the output is periodic with period 4, and so contains tones at
fs/4 and its harmonics, which will be removed by the lowpass filter.
The reader should repeat the calculation for different values of y(O) to verify that
the output will again be periodic with a period of 4, and that ly(n)1 ,; 2 t. Over a
period of 4 samples, the output will always contain three +ls and one -1. The
order in which they occur will depend on y(O) .
Consider now the more genera] case where the input is a constant rational number:
u = a/b. Assume 0 < a < b, and that a and b are odd positive integers with no
common factor. The initial value yeO) is given, with jy(o)1 < 1. Let the first b out-
put samples of v contain (a + b)/2 samples of +I, and (b - a)/2 samples of -1 .
Then the average value of v in this set is a/b, the same as u. The total net input to
the integrator for the first b samples is zero. Hence, after the bth sample, the value
of y will be again back at y(b) = y(O). The v sequence will therefore be repeated
during the next b samples. Therefore, a periodic sequence with a period b will be
generated.
If u = alb with one of a or b even so that (a + b) is odd, it can be easily shown
that again a periodic sequence results, with a period 2b containing (a + b) +ls and
(b - a) -1 s. For a negative input u, the output is the negative of the above given
the positive input -u.
Assume now that MODI has an output which is periodic with a period p, contain-
ing m samples of +1 and p - m samples of -1 in each period. The average output
for each period will be (2m - p)1p, a rational number. Hence, the (constant) input
must equal this value, and must also be rational.
t
A tight bound on the input to the quantizer for a de input u is - 1+ U :0::; y:S I + u •for lui :S 1 and
ly(o)1 :S I .
43

2
The Flrst-Qrder Delta Sigma Modulator
Thus, a periodic output with a constant input u (lui < 1 ) implies that u is rational. It
follows therefore that if u (lui < I) is constant but irrational, the output of MODI
cannot be periodic.
The periodic sequences generated by rational dc inputs are sometimes called pat-
tern noise, idle tones, or limit cycles. They do not represent instability of the loop;
their amplitude does not change with time, but is a complicated function of u [2].
Their frequency also depends on the input, as discussed above.
It is important to examine the effect of limit cycles on the in-band noise of MOD1.
In the numerical example discussed above, the output spectrum contains a line at
dc, corresponding to the average value of the v samples. This represents the digital
equivalent of the de input u, and is thus the desired signal. In addition, there will be
spectral lines atl/4, 2J!4 and 3J!4 which represent noise. Since typically the cut-
off frequency IB of the digital lowpass filter following the loop satisfies
I B = 1,1(2' OSR)« I"
these lines are in the stopband of the filter, and hence
are hannless.
Unfortunately, the situation is not always so rosy. Assume that the input is the
rational dc value u = 1/100. Now the argument presented above shows that the
output signal will contain tones atl/200 and its harmonics. Several of these will
usually be within the passband of the digital filter, and hence deteriorate the SNR.
(A detailed analysis shows that the output sequence will contain an alternation of
the values +1 and -1 for 101 periods; the -1 which would have occurred at sample
102 is changed to +1 due to the accumulation of u in the integrator so that two +1s
occur in a row. Then the alternation resumes until sample 199, when again a-I
becomes a +1 so that two +Is occur in succession. A quick calculation confinns
that the average of the output over 200 samples is (101-99)/200 =2/200 =u, as
expected. The output spectrum can be visualized by observing that the output is
equivalent to a sampled sine wave of frequency IJ2 modulated by a square wave
with a frequency ofl/2oo and a 50.5% duty cycle.)
As mentioned earlier, both the frequency and power of the tones are functions of
the dc input u. Hence, so is the in-band noise which they introduce. Fig. 2.22
shows the variation of in-band noise power for MOD1 with u for OSR = 32 and
44

· It
Dl
21-
'p;
lJ.
,1.
at
31
Je
It-
'S
:e
Ie
e
II
M001 under DC Excitation
for OSR = 64. As the figure shows, large peaks occur near simple rational values,
such as u = 0, ±1I2, ±1I3,elc.
In some applications, such as in digital audio, idle tones cannot be tolerated, since
the human hearing apparatus can detect tones even 20 dB below the level of any
white noise present. The prevention of tone generation is therefore an important
aspect of.6.:r modulator design, one that often motivates the use of high-order mod-
ulators or dither, an added pseudo-random signal.
Idle tones may also be generated in the presence of slowly varying input voltages,
which stay near a critical level (a simple rational value) long enough for a limit
cycle to become apparent. This is particularly likely to occur for low-order modu-
lators, such as MODI.
2.6.2 Graphical Visualization
In this section, MOD I is viewed from the perspective of nonlinear dynamics.
Proofs are avoided in order to maintain focus on the results themselves. The inter-
ested reader is encouraged to consult the references for complete derivations.
Fig. 2.23 shows a geometric interpretation of the operation of MOD1. The hori-
zontal axis represents time and the vertical axis is the accumulated output
The possible values of s from time 0 to time n form a triangular lattice of points.
Also plotted is a line L of slope u passing through the origin. At each time step, s is
either incremented or decremented by I, depending on which choice results in a
sum which is closest to the line L.
,f
e
s
s
s
n
s(n) =Lv(i)
i "" 1
(2.22)
If the input u is rational, L periodically passes through one of the lattice points and
the v sequence repeats. If the input u is irrational, L threads its way through the lat-
tice but does not go through any lattice point other than (0,0) and so the v sequence
45

2 The Flrst-order Delta Sigma Modulator
does not follow a repetitive pattern. However, suppose that L comes very close to a
lattice point at time n and let f denote the distance between L and this lattice point.
If Eis small enough, the modulator will repeat the sequence of decisions leading
up to time n. After this repetition, the distance between L and the nearest lattice
point will be 2E. If this quantity is still small, the modulator will repeat the
sequence once again, and the distance will increase to 3E. After k repetitions, the
distance will be kE, and so it will tventually grow large enough that the modulator
output is forced to deviate temporarily from a repeating pattern.
A procedure for computing the output of MOD1 given a DC input u, without
resorting to step-by-step simulation of the difference equations, is available in the
literature [3][4], and is summarized here without proof:
t.
Map u to x = (1 + u)/2 . This transfonnsthe range [-1,1] to [0,1].
s(n)
•
•• •
• •
• • •
• • •
• • • •
• • • •
L
3
2
•
1
0
time
-1
• • • •
• •
n
-2
• • • • • •
-3
• • • • •
• • • • •
• • • •
• • • •
• • •
• • •
• •
• •
• •
Figure 2.23: A geometric interpretation of the operation of MODt.
46

MOo1 under DC Excitation
It can be shown that
i) for rational x, the CFE terminates after a finite number of steps;
ii) truncating the CFE early results in a rational ofbest approximationt to x.
3. Next, carry out the recursion
For example, u ::;: 0.4 maps to x = 0.7.
2. Detennine the continuedlraction expansion (ePE) of x.
For x = 0.7,
(2.23)
1
1
1+--1
2+-3
CFE(I, 2, 3).
7
1
x=1O=--3=
1+-7
which will be abbreviated as 0.7 =
'ut
he
oa
int.
ing
ice
the
he
tor
So = 0 and S[ = I(So)"j - [ .
(2.25)
Here, Sk means the k-fold repetition of the sequence S and an is the nth argu-
ment in CFE(u[,az,...).
For x =0.7, u =(I, 2, 3) and so
So = 0
SI = 1(0)[-1 = 1
S2 =0(1)2 =011
S3 = 1(011)3 = 1011011011
Sn = Sn_2(Sn_l)o"
with starting conditions
(2.24)
t
alb is said to be a rational of best approx.imation to x if. for all rationals plq with q<b,
Ix -alb! < Ix- plql .
47

2 The First-Qrder [)efta Sigma Modulator
Since the CFE tenninates, MODI produces the 83 sequence repeated ad infinitum.
Note that in this interpretation, the modulator output is taken as 0 or I, rather than
our more usual -1 or +1. This difference in convention is the reason for the trans-
formation of step 1. Furthennore note that the starting point within the sequence is
dependent on the initial conditions of the integrator. For the example sequence, the
length is 10 and there are 7 ones, so the average is 7/10 (which equals x). Interpret-
ing the Os as -Is yields an average of 4/10 (the value of u).
The above procedure gives several insights into the structure of MODI's output
given a DC input First, since each subsequence Sn corresponds to a rational of best
approximation, the Os and Is are distributed as unifonnly as possible in the output
bit stream. Second, if the input is close to a rational r, then one of the a. arguments
in CFE(al, ~, ...) will be large, and thus the pattern which corresponds to r will
be repeated in the output data stream many times in a row. If r has a small denomi-
nator, then MOD1's output will appear periodic over short time spans. Of course, if
the input is equal to r, the output of MODI will be truly periodic.
Taking a slightly different perspective, the above procedure shows that if x < 1 is a
rational alb, taken in lowest terms, then MODI will produce a period-b output
Since we already know that irrational inputs result in aperiodic behavior, we con-
clude that MOD1 is like an oscillator whose period can be anything, including
infinity! As mentioned in Section 2.6.1, the periodic sequences generated by ratio-
nal dc inputs are sometimes called pattern noise, idle tones, or limit cycles. They
are not a result of non-ideal operation of the loop; they are a direct consequence of
MOD1's dynamics.
Clearly, a rational input yields an output spectrum consisting of a finite number of
discrete spectral lines between 0 and f sl2 . It is somewhat surprising that irratio-
nal inputs also yield an output spectrum consisting solely of discrete spectral lines,
although the number of such lines between 0 and 1512 is infinite. This remarkable
result was established in [5] by a study of MOD1 from the nonlinear dynamical
system perspective. This work showed that the tones in the output spectrum have
frequencies (normalized toIs)
48
In =nx
(2.26)

m.
,an
lS-
is
he
,t-
'tit
~st
ut
,ts
ill
li-
if
a
t.
1-
g
)-
Y
,f
f
.,
Stability 01 MODi
where n is a natural number and, as before, x=-( 1 + u)/2. These tones alias to
the [0, O.SJ Nyquist range and have an amplitude of
an = 2INTF(ej2af·)I/(1tn).
(2.27)
For example, assume that a small dc input u = 1/(2· OSR) is applied to MODI,
and use the above fonnulas. The largest tone in the output is at a frequency
11 = x = (I + u)/2 = 0.5 + 1/(4 . OSR), which is very close to 0.5, (i.e., to
/s/2), This fits our intuition because we expect the output of MOD1 to alternate
between -1 and +1 most of the time when the input is small. The frequency of the
n = 2 tooe is 12 = 2x = 1+ 1/(2· O~R), w!)!ch a'iases to the edge of the
passband at 1 2 = 1/(2· OSR). Since INTF(e} 01,)1 =1t/(OSR), the power
associated with this tone is a;/2 =1/(2· OSR2) . Increasing u would move this
second tone out of the band-of-interest, resulting in a sharp drop in the in-band
noise, while decreasingtWOUJdJOWerlthe frequency and hence increase the atten-
uation provided by the NTF(eJ21tfn)
factor in an' This argument accounts for
the shape of the noise peaks in Fig. 2.22 around u = 0, which resemble the letter
M, and also agrees with the results quoted on page 39 regarding the width and
height of these noise peaks.
2,7 Stability ofMODl
Linear analysis based on Bode plots would predict unconditional stability for
MODI, since the loop gain decreases by -6 dB/octave and the loop phase is -90
0
at all frequencies. This prediction, however, does not take into account the actual
signal processing petformed by the quantizer. Hence, time-domain considerations,
taking into account nonlinearities, are required.
Consider the stability of the loop under dc excitation. It is obvious that loop
becomes unstable, and specifically y becomes unbounded, if luI> I . For example,
if u = 1.3, the DAC will try desperately to balance u by feeding back a signal -I
every time. Even so, a net input of 0.3 will enter the integrator in every clock
period, until y grows so large that the circuit becomes dysfunctional.
------- --------------_._-
49

2
The Flrst-Qrder Delta Sigma Modulator
Vice versa, if lui S I and the initial value of y satisfies ly(O)1 S 2 , then the loop will
remain stable, with Iyl bounded by 2. This stability condition is sufficient even for
time-varying u and is readily established by induction as follows. Replacing the dc
input teon u in (2.21) with u(n) gives
Yin) = yin -I) + u(n) - sgn(y(n - I».
(2.28)
If ly(O)1 S 2, then IY(o) - sgny(O)1 S I. Thus ly(l)1 = lu(l) + y(O) - sgny(O)1 S 2,
since lu(I)1 S I. Continuing, we can show that ly(2)I, ly(3)I, etc. all are similarly
bounded, provided lu(n)1 S I for all n.
If ly(o)1 > 2 and lu(n)1 S I, then the modulator output will contain a string of +Is
(if yeO) > 2) or -Is (if y(O) < -2) and Iyl will monotonically decrease until it is
less than 2, at which point the condition of the preceding paragraph will hold and
Iyl will remain bounded by 2. Thus, it is clear that MOD1 is stable with arbitrary
inputs less than or equal to 1 in magnitude, and that it is able to recover from any
initial condition.
2.8 The Effects of Finite Op·Amp Gain
The foregoing analyses have all assumed ideal operation of MODI. In this section,
we take a brief look at the effect of an important non-ideality: finite op-amp gain.
Both linear and nonlinear system perspectives are used, since each provides worth-
while insights.
2.8.1 Linear Systems Perspective- Degraded Noise Shaping
If the gain of the op-amp in Fig. 2.14 is A, then the difference equation which
applies to the charge qz(n) on integrating capacitor C2 is
(2.29)
Assuming C1 :;:; Cz and A» 1, the z-transform ofthe voltage across C2 is
50

The Effects of Finite Op-Amp Gain
y(z) = pzU(z) - V(z)
(2.30)
Z-P
where the pole p = 1- 1/A is slightly less than 1. The integrator is therefore
lossy or leaky; its de gain Y(l) is no longer infinite.
The noise transfer function is then found to be
(2.31)
NTF(z) = 1 - pz-l,
From this expression. it is apparent that the NTF's zero shifts from z ::: 1 to
Z ::: P. inside the unit circle. Thus the NTF gain at de changes from its ideal value
of zero to 1- p ::: 1/A and MODI loses its ability to achieve infinite precision
with de signals. For busy input signals, the additional noise power resulting from
the "filling in" of the noise notch at low frequencies can be estimated by integrat-
ing INTF(e jOO)12 =A-2 + 0)2 across the 0) E [0, It/(OSR)l band of interest and
comparing the result against the A = 00 case. If A > OSR, the additional noise is
less than 0.2 dB, and hence this effect is rarely serious. Although this argument
suggests that high op-amp gain is not a critical requirement, the reader should be
aware that the above argument assumes linear op-amp gain. As will be discussed in
Chapter 6, low op-amp gain can be problematic if the gain is sufficiently nonlinear.
Also, the finite-gain effect has serious consequences for the cascade (MASH)
architectures discussed in Chapter 5.
S
IS
d
Y
Y
,.,
8)
Iy
'ill
or
de
2.8.2 Nonlinear Systems Perspective- Dead Zones
Assume next that a small positive de input u is applied to MOD1 under ideal con-
ditions (A = =), and that the initial condition is y(O) = O. By (2.28), the first few
values of the quantizer input are
y(l) = y(O) +u - sgn(y(O»
= u - 1 < 0
y(2) = u - 1 + U + 1 = 2u > 0
y(3) = 2u+u-1 = 3u-I<0
(2.32)
and so on.
51

2
The Flrst-Qrder Delta Sigma Modulator
52
In order for u to have an effect on the output v, sgn [y(k)] must stop alternating for
some odd value of k. For this to happen, the magnitude of the first tenn in (2.35)
(2.33)
(2.34)
(2.35)
y(k) = { ku - I , if k is odd
ku
•if k is even
k-l
k-l
y(k) = ~>iu + (_I)k ~:<_p)i
i=O
i=O
y(n) = py(n - I) + u - sgn(y(n - I)).
Clearly, v alternates: v(O) = I, v(l) = -1, v(2) = I, v(3) = -I etc., at least
initially. This pattern would hold for all time if the input were exactly zero.
For the kth sample, we have
y(I) = y(O) + u - sgn(y(O)) = u - I < 0
y(2) = pu-p+u+1 = (I+p)u+(I-p»O
y(3) = p(l+p)u+p(l-p)+u-1 = (l+p+p2)u-(I-p+/)<0
Assuming again a small positive dc input u, and y(O) =0, we now get
The even-indexed y(k) will always be positive. The effect of u > 0 will occur in
the first odd-indexed sample satisfying ku <: I. At this point, the sign of y(k)
becomes positive, and hence v(k) = 1 occurs twice in a row after k ~ llu peri-
ods. The frequency with which this happens is a measure of the value of u.
The general fonnula is clearly
If the integrator is lossy, such that its transfer function becomes H(z) = -..l!.- as
in (2.30), then the recursion relation (2.28) becomes
z- p

The Effects of Finite Op-Amp Gain
where A» 1 is the opamp gain. A similar result can easily be found for lui if
u<o.
must become larger at some point than that of the second tenn. For k ~ co, this
requires that
(2.36)
(2.37)
u
1
-->--
I-p
l+p
u>l-p;
l/A
1
1+ P
2-I/A
2A
or
The conclusion is that with finite op-amp gain, inputs smaller than 1/(2A) in nor-
malized value will have no effect on the output. For example, if A = 1000 and
Vref; 1 V, then de signals less than 0.5 mV will not register in the output. There is
thus a dead zone or dead band around u = 0 if MOD1 uses a leaky integrator. It
can be shown that similar dead zones exist around all rational values of u, and that
with the exception of the dead zones around ±1, these other dead zones are nar-
rower than the one around u = O. Fig. 2.24 plots the simulated average output, V,
of MOD1 for dc values around zero when p = 10-3. This figure shows that the
width of the dead zone is as predicted, and that the error quickly decays to a value
much less than 0.5 mV for inputs outside the dead zone.
asl
IS
3)
in
0)
i-
~)
Another consequence of the finite amplifier gain concerns the limit cycles of
MODI. The limit cycles displayed by an ideal MODI with a dc input are unstable,
or non-attracting, because arbitrarily small shifts in the input eventually lead to
large changes in the integrator state and hence a different output pattern. However,
if the NTF zero is inside the unit circle, the resulting limit cycles are stable or
attracting, because sufficiently small shifts in the input lead to small changes in the
integrator state and no change in the output pattern. This is a detrimental effect,
since limit cycles are usually undesirable. We note in passing that if the NTF zero
is placed outside the unit circle, all limit cycles are repelling and the modulator
forms a chaotic system [6-8]. This effect may be used to suppress idle tones.
53

2 The Flrst-Qrder Delta Sigma Modulator
2.9 Decimation Filters for MODI
As shown in Sec.2.5, the output signal of MOD1 contains very little quantization
noise at low frequencies, but the PSD of the output noise grows rapidly with
increasing frequencies, and is four times higher atf/2 than the power of the white
quantization noise assumed in the analysis. Hence, the signal band limitfB must be
much smaller than f/2. and if MOD1 is to be used as an ADC. the out-of-band
noise must be removed by a digital lowpass filter (LPF). Afterwards, the LPF's
output signal may be decimated, thereby reducing the sampling rate to the Nyquist
sampling freqnency 2!•.
Clearly, the requirements on the LPF are that its gain response be flat and large
over the signal band [O./.J. and very small between!. and!J2. Often. it is also
desirable to have a flat group delay response in the signal band. The latter condi-
tion can be satisfied by using a linear-phase finite-impulse-response (FIR) LPF.
Since the output signal of MODI is a single-bit data stream, it may be practical to
use a single-stage high-order linear-phase FIR filter, since there are no actual mul-
tiplications required between the samples of the signal and the weights of the taps.
In general, however, it is usually more efficient and economical to carry out the fil-
i
I
i
I
J
.'.. .
.'
. .
..'..
. •. ..
.- ...
...' .. .
••••••
0.5
:;-
E-
O
I>
-0.5
-1
-1
54
· .....
· .
· .
·.'
.............
• ••••••
..
-0.5
0
0.5
u (mV)
Figure 2.24: Dead-band behavior of MODI around u =0 with A =1000.

Decimation FIlters for MOD1
tering and decimation in stages. The stages most often used are the so-called sine
filters. These will be discussed next.
2.9.1 The Sine Filter [9J
A sine filter is an FIR filter with N-l delays andN equal-valued tap weights, which
simply computes a running average of the input data stream v(n) . Thus, the output
wen) of a sine filter is
(2.38)
N -1
w(n) = ~L v(n-I).
j,., 0
Its impulse response is hence given by
On
ith
ite
be
ld
re
:0
i-
F.
;'8
st
a
1-
,.
h1(n) = { liN ,if(O$n$N-l)
o
,otherwise
(2.39)
The z-domain transfer function is
(2.40)
and thus its frequency response is
= sine(Nf)
sinc(f)
(2.41)
where sinc(f) is defined as (sin(1tf)/(1tf), whence the name of this filter. Fig-
ures 2.25 and 2.26 show the impulse response and frequency response, respec-
tively, for a sine filter with N = 32. As Fig. 2.26 shows, the gain is close to I at
and nearf = 0, and close to zero near lsiN and its harmonics. Hence, if the sam-
pling rate at the output of the filter is reduced by N, causing the noise around
f,lN, 2f,lN , 3f,lN , etc. to fold into the baseband, the energy of the aliased
55

noise will be reduced by the sine filter's attenuation. Hence, N = OSR should be
chosen for this application.
I::iI
IJ
(2.42)
40
..
,
,
,
,
--- ......
. , , , , .
..
'>i':-';'~';-:":-
10
15
20
25
30
35
Sample Number
Impulse response of a sine filter with N == 32.
Figure 2,25:
0.02
0.01
2 The First-Order Delta Sigma Modulator
·40
0.04 r.,--,-,--,..,...,,..,...,-,..,-,-,...,...,...,...,...,...,...,...,.,...,...,...,...,-,--,..,...,-,..,-,-,...,...,...,...,..,-,-,
. . . . . . .
..
.-: , .,.,
:-:-
;.'.:.;.'..,.
0.03
' , . , , ,
·60 o~.l-J..L-~-'--"--':~l-L.-.l.;;'!--...l.L-l-~--l.L...I~
0.1
0.2
0.3
0.4
0.5
Normalized Frequency
Figure 2.26: Frequency response of a sine filter with N = 32,
56
so that in the time domain
It is instructive to find out how much residual noise remains at the output of the
sinc filter when it is used to suppress the shaped quantization noise NTF(z)E(z) of
MODI, compared to what an ideal LPF with a bandwidth f B = f/(2N) could
achieve. The z-transfonn of the noise at the output of the sine filter is

dbe
(2.44)
WI
---III.~
i
~
!
tbe
) of
mId
12)
Decimation Filters fOr MOD1
1
gl(n) = ;V[e(n)-e(n-N)].
(2.43)
Assuming e(n) and e(n - N) are uncorrelated, and that each has an rms value 0';,
the quantization noise power at the output of the sine filter is
2,,2
0'2
= __'
ql
N2
The output noise power for an ideal LPF with unit gain at de is given by Eq (1.7).
Using OSR = N:
(2.45)
Thus, it is clear that the sine filter is nearly N limes less effective than the ideal
LPF. Hence, the sine filter is seldom used as a complete decimation filter. Rather, it
normally forms only one stage in a multi-stage filter.
An important advantage of the sine filter is that for single-bit modulators it can be
realized very economically. In the implementation shown in Fig. 2.27, a counter is
incremented for each +1 from the modulator. Once in every N clock cycles, the
output of the counter is clocked into a register, and the counter is reset. Thus, the
output wen) is a down-sampled count of the number of +1s produced by the mod-
ulator over the last N clock cycles. For this reason, a sine filter with downsampling
is also known as an accumulate-and-dump stage. If N = Zk, the counter produces
a k-bit outputt which may be interpreted as a binary fraction between 0 and 1. In
this interpretation, the ADC is considered to be unipolar. For a bipolar ADC, sim-
t
Strictly speaking, the output of the counter requires k+1 bits in order to accommodate the possi-
bility that the number of +ls accumulated equals Zk. To avoid adding an extra bit for this over-
flow condition, the counter should saturate, instead of wrapping around.
57

CKN
2 The Fll1It.()rder Delta Sigma Modulator
tJ: ADCLv~(~n)w.'~EEtN;-CQl1-_-rcD:--aQ~w~(~n)
(invert MSB)
Counter
Register
cKJlJ1.fUlJl--~-T--t~C:!K~R_J
CK
I
I
o
N
CKN~
w(n) x==x
Figure 2.27: Sinc filter realized with a counter.
ply invert the MSB of the counter output, and interpret the result as a signed binary
fraction in two's-complement form.
2.9.2 The Sine> Filter
Cascading two sine filters results in the so-called sine! filter. The impulse response
of the sinc2 filter is obtained by convolving the rectangular impulse response of the
sine filter with itself. A triangular response results (Fig. 2.28). The z-domain and
frequency-domain transfer functions are simply those of the sine filter, squared:
O.OBr--~-~--~-~----~---~
0.06
0.04
...........,.
.
-
,
.
.....
0.02
....
rtrl .
00
10
20
30
40
Sample Number
Figure 2.28: Impulse response of an N = 16 sinc2 filter.
58

Decimation Filters for MOD1
Q2(Z) = NTF(z)H2(z)E(z) =
\ (l-Z-~)(l_z-N)E(Z)
N (I-z-)
= RHI(Z)[(l-CN)E(Z)].
(2.48)
Since HI implements an N-sample average in the time domain and (l-cN)E(z)
corresponds to e(n) - e(n - N) in the time domain,
ry
;e
Ie
d
H (ej2n!) = ('inC(Nf))2
2
smc(f)
The z-transform of the noise at the output of the sine filter is therefore
N -I
q2(n) = :2 L [e(n-t)-e(n-N-t)].
i"" 0
(2.46)
(2.47)
(2.49)
Ife is white noise of power 0;,the power of the quantization noise at the output of
the sinc2 filter is
2
2Ncr;
20;
(Jq'l = N4;; N3'
(2.50)
Comparing 0 2
with the ideal LPP's output cr~ from (2.45), we see that (1'2
is
actually Jess d{§n 0 2 . However, by taking into account the passband droop, w~ich
reduces the signal 2nergr at the LPF output, we find that the SNR is in reality
slightly lower with a sine LPF than with an ideal LPF. Since the SNR difference is
small, the sinc2 filter is sufficient for the decimation of MOD1's output data. (In
general, a sincL+1 LPF is sufficient for an Lth-order loop.)
59

________1"
2
The First-Order Delta Sigma Modulator
I -
----_._----------
The sinc2 filter can of course be realized by cascading two sine filters. However, to
minimize the hardware requirements, the triangularly-weighted sum needed for the
impulse response of a sinc2 filter can be constructed from rectangularly-weighted
and ramp-weighted sums, as illustrated in Fig. 2.29a. Fig. 2.29b depicts the real-
ization of a sinc2 filter for single-bit data which implements the concept of
Fig. 2.29a. The hardware is made especially simple if N is assumed to be a power
of 2. A sine filter generates the rectangularly-weighted sums, while the ramp-
weighted sums are generated by conditionally accumulating the output of a
counter which wraps to zero every N clock cycles. The filter output is then an arith-
metic combination of these intermediate sums.
It should be pointed out that both sinc and sinc2 filters introduce a droop into the
baseband frequency response. If necessary, this droop may be equalized with a
post-filter operated at the reduced clock rate.
2.10 Conclusions
This chapter discussed quantizers and the first-order.6.1: modulator MODI. It was
shown that the quantization error of a multi-bit quantizer is usually well-approxi-
mated by a white noise e of power 0; = .6.2/12. For the single-bit quantizers
often found in LU: modulators, this approximation is still useful, but must be
b)
Count
eK
v(n)
=A
Sine
Filter
60
Figure 2.29: A hardware-efficient sinc2 filter implementation.
lu
,....

r, to
lhe
Ited
,a1-
of
.er
ap-
r a
lh-
he
,a
as
J-
rs
>e
Conclusions
applied with caution. In particular, the designer should verify that the quantizer
gain used in the linear model accurately reflects the actual operation of the quan-
tizer in the Ll1: loop.
The first-order.6.:I: modulator, MODI, can be used as an ADC or as a DAC, and
although each application can use a variety of topologies and technologies in the
implementation, the essential dynamics of all these systems are the same. The
most important property of MODI in its ideal form is that it can achieve arbitrary
accuracy for dc inputs. For low-bandwidth signals, the effective number of bits is
approximately
1.51ogz0SR, where OSR
~ 1/(2·1B)
is the oversampling
ratio.
When binary quantization is used, MODI is immune to a variety of non-idealities,
including component errors and misplaced DAC levels. However, an important
non-ideality which does have an impact on MOD I is finite op-amp gain. Finite
gain A creates dead zones in the input-output characteristic of MOD I, the width of
which are proportional to lIA. MODI is also prone to limit cycles, an undesirable
oscillatory condition. Last but not least, MOD1 requires a very large OSR for
accurate data conversion.
References
{l]
D. A. Johns and K. Martin, Analog Integrated Circuit Design, John Wiley & Sons. New
York, New York, 1997, pp. 45{}-451.
[2]
J. C. Candy and O. J. Benjamin, ''The structure of quantization noise from sigma-delta
modulation,"
IEEE Transactions on Communications, vol. 29, no. 9, pp.1316-1323,
September 1981.
[3]
V. Friedman, ''The structure of the limit cycles in sigma delta modulation," IEEE
Transactions on Communications, vol. 36, no. 8, pp. 972-979, August 1988.
{4]
O. Feely and L. O. Chua, "The effect of integrator leak in l:-ll modulation,"
IEEE
Transactions on Circuits and Systems, vol. 38, no. II, pp. 1293-1305, November 1991
[5]
R. M. Gray, "Spectral analysis of quantization noise in a single-loop sigma-delta modulator
with dc input," IEEE Transactions on Communications, vol. 37, no. 6, pp. 588-599, June
1989.
[6]
M.
O. J. Hawksford, "Chaos, oversampling, and noise-shaping in digital-to-analog
conversion," Journal a/the Audio Engineering Society. vol. 37, no. 12, December 1989.
(7]
O. Feely and L. O. Chua, "Nonlinear dynamics of a class of analog·to-digital converters,"
International Journal ofBifurcation and Chaos, vol. 2. no. 2, June 1992, pp. 325-340.
61

______________IT
_______2_Th_e_Fl_"_'-o_-
__De_,te_S_'"_m_e_M_ed_"_'_e'_o_'
----------------i"l I
[8]
R. Schreier. "On the use of chaos to reduce idle-ehannel tones in delta-sigma modulators,"
TEEE Transactions on Circuits and Systems I, vol. 41, no. 8, pp. 539-547, August 1994.
(9]
J.
C.
Candy,
"Decimation
for
sigma-delta
modulation,"
IEEE
Transactions
on
Convnunications, vol. 34, no. I, pp. 72-76, January 1986.
CHt
1
t
S
s
62
HI

ors,"
on
CHAPTER 3
The Second-Order Delta-
Sigma Modulator
The previous chapter studied MODI. the first-order
6.~ modulator. Despite the
advantages of simplicity. robustness and stability, the overall petformance of
MOD1 in terms of resolution and idle-tone generation is inadequate for most
applications. This chapter focuses on MOD2. the second-order 6.:E modulator. We
will see that MOD2 overcomes the above disadvantages of MODI. but does so at
the expense of more hardware and a slight reduction in signal range.
3.1 The Second-Order Modulator: MOD2
The simplest way to construct a second-order modulator from MOD1 is to replace
the quantizer within MODI with another copy of MOD1. The resulting structure is
shown in Fig. 3.1. Modeling the quantizer in the new system with an additive noise
source results in the Hnear z-domain model of Fig. 3.2. From the figure,
V(z) = Ell) +
1 1(-C1V(z) + ~(_z-1 V(z) + U(z)))
1-z
1-z
_ (1- z-1 )2£(z) - [( 1-c 1)Z-1 + z-IJ V(z) + U(z)
-
(1 _ z 1)2
(3.1 )
63

3
The Second-Order Delta-8lgma Modulator
from which it follows that
(3.2)
(3.3)
Hence, the signal transfer function is STF(z)
~ I, as for MODI, but now the
noise transfer function is NTF(z)
= (l - z-1)2. Since this is the square of
MODl's NTF, we expect increased attenuation of quantization noise at low fre-
quencies.
In the frequency domain, the squared magnitude ofthe NIF is given by
Q
y
r----------------------------,
,
MOD1
',,
H-+,-V
,,,,,,,,,,
~
J
u
Figure 3.1: MOD2: A second-order &: modulator obtained by replacing the
quantizer In MODI with another copy ofMODI.
E
u
+
1
.-::1
1
-
-z
+
1
~
-
-z
v
Figure 3.2: Linear model ofMOD2.
64
----~-I

1.2)
the
of
re-
The $econd·Order Modulator: MOD2
Fig. 3.3 compares the NTF magnitude of MOD2 and MODI. At low frequencies,
the NTF of MODI displays a 20 dB/decade slope, while the NTF of MOD2 has a
40 dB/decade slope. The increased attenuation at frequencies close to de is desir-
able because it reduces the amount of quantization noise within the signal band.
Unfortunately, since the gain at high frequencies provided by MOD2's NTF is
greater than that of MOD1's NTF, the total power of the quantization noise at the
output of MOD2 is more than that of MODI.
Following the same steps as in the derivations for MODI, we can calculate the
power of the in-band quantization noise contained in v:
3)
1/(2·0SR)
4
2
f
n 0,
0 2 =
(2n/)4 . 2 . 02d! = -:-:-:c=:<
q
,
5(OSR)5
o
(3.4)
Comparing this with the power M2/2 of a sine wave of amplitude M, and assum-
ing that 0; = 1/3, we find the SQNR of MOD2
SQNR = M212
0 2
q
(3.5)
.:..;-:-:. ;:-:
; .. ; - :.
',.,.,.,.",
"",-
• • • • "." • ',' "," ","; , , r ," •••• , •• ", - •
. ,., , ....
.....;- ..;-.;..:.;;;;: .... ;...:. .;. -:<.;;'.'..
. ,.. .. " .
., .
:::: )~Q(il':'::::... ;:' ':: ;:",,:: ...
,
''''''
."",..
...:. -:..:.;; ,.~;..
"." ..;. -:..:-:.:;;>. _.. : .. ;. ','
·
,
,,,
,
.,.-.. ,
",
, .. ,.,.
·
.
-.- -,
,
,
.
·
.
. . "
" .
.
',' ","" '" . "',
-1 00 L.::---'---'.~.'-'-'=,--O---'.'---'--'-'-'-'-'"'--c---'---'--'-J
10-3
10-2
10-1
Normalized Frequency
Figure 3.3: NTFs of MODI and MOD2.
1C
0
~
-20
~
-40
N
.~
~
-60
~
:,;
-80
65

-------~-----_.
3
The 8econd-Qrder Delta-Sigma Modulator
Fig. 3.4 compares the theoretical SQNR vs. OSR performaoce of MOD2 with that
of MOD1 for M = I. The SQNR of MOD2 is proportional to the fifth power of
OSR, rather than third power, as in the case of MODI. Hence, doubling OSR
increases SQNR by a factor of 32 (15 dB), and thus increases the resolution by 2.5
bits.
As an example of the achievable ENOB, let OSR = 128 and M = I. Then, (3.5)
gives SQNR = 94.2 dB, which corresponds to nearly 16-bit resolution. If the ADC
is used to convert audio signals, so thatfB:;:: 20 kHz, the clock rate needed will be
f, =2· OSR· f B =5.12 MHz, a highly practical value. To achieve the same
resolution with MODI, (2.18) predicts that OSR = 1800 would be needed. This
necessitates the use of Is
:= 72 MHz, which would make the implementation
unnecessarily difficult.
If binary quantization is used, MOD2 has the same inherent linearity property as
MOD t. Like MOD1, the linearity of MOD2 is not jeopardized by comparator 000-
idealities, such as offset or hysteresis, since these errors are injected into the loop
at the same point as the quantization noise and are thus also attenuated by the NTF.
Slight shifts in the loop filter coefficients are similarly benign, since these translate
into small shifts in the pole and zero locations of the NTF and STF, rather than into
nonlinearities.
.1. ..•
.. . . . ; .... .. .
.
.
.. ,
,".
.. ,
..... ,..
. "
.,
..... ; ..
.,
,
;
.
.. .
..... , .
20
140 ,----,------,---.,------,----,---,-....-,""
120
_ 100
"'
:g,
80
a:zg
60
40t··:;"'2 :-:.
:
,
:
.,
••.•.. '
•.•••• 1. •••• 1. ..••• -1 ••.•
210 GSR
Figure 3.4: SQNR vs. OSR for MODi and MOD2 with M=I.
66
L

that
r of
ISR
2.5
'.5)
)C
be
ne
lis
on
as
n-
>p
F.
te
:0
Simulation of MOD2
3.2 Simulation of MOD2
As with MODI, the validity of the assumptions which lead to analytical SQNR
predictions for MOD2 are best checked by performing simulations based on the
modulator's difference equations. Fig. 3.5 illustrates the input and output wave-
fonns for MOD2 with a half-scale sine-wave input. As is typical in .6.}: systems,
these wavefonns provide very little insight into the system's behavior when
viewed in the time domain. Only crude observations can be made, such as the
increased tendency for the output to be +1 when the input is positive and -1 when
the input is negative. However, by viewing the modulator output in the frequency
domain, a much clearer picture emerges.
The spectrum shown in Fig. 3.6 clearly exhibits noise shaping, and the 40 dB per
decade slope confirms the second-order nature of the shaping. For an oversampling
ratio of 128, integrating the PSD yields SQNR ~ 86 dB and extrapolating from this
value to the SQNR for a full-scale input results in a predicted peak SQNR of
92 dB. This is in close agreement with the theoretical result of 94 dB predicted by
(3.5).
However, Fig. 3.6 displays two features which are not in agreement with our
model. First, the 3rd and 5th harmonics of the signal are distinctly visible, having
amplitudes of -88 dBFSt and -90 dBFS, respectively. Since white quantization
.. """. -
.1- .r-'-
...........
..
."
"
o
;i
~'.!~ •
....
." -.-
.. .. '"
','" .,.
1...-
40
!.
• ....
.......
20
30
Sample Number
MOD2 input and output waveforms.
Figure 3.5:
-1
...
o
10
t. "dBPS" means "dB with respect to afull-scale sine wave."
67

-------~---------,.---
______3_Th_e_S_e._O_nd_._O_"'_"'_D_e_'la_._s'_gm_O_M_od_U_'0_10_'
~
noise cannot produce harmonics of the signal, this simulation result is inconsistent
with the white noise model. Second, Fig. 3.6 shows a plot of MOD2's NTF, scaled
by 2o;NBW so that it should align with the observed PSDt . The theoretical curve
is similar to the observed PSD, but has a comer frequency that is higher than that
of the observed PSD. The higher comer frequency makes the theoretical PSD
somewhat lower at low frequencies and somewhat higher at high frequencies than
the observed PSD.
To account for the harmonics, a nonlinear quantizer model IS needed. Such a
model will be presented in the next section. To account for the shift in NTF shape,
it is sufficient to evaluate the effective quantizer gain from simulation. Applying
(2.5) to the simulation data results in k = 0.63, and recomputing the NTF for this
value of k results in the pole-zero and PSD plots shown in Fig. 3.7. Now the agree-
ment between the observed PSD and that "predicted" by the linear model is very
good.
....... , ..'..'. '.e' >•••••••
~ •••• ~. _ ~ •• ;•• ; -:.
~ _:-:..
• ••'.•.• , .••'.
·20
SQNR';' 86'dB·
.,..,. -:..;.:: .:.:
,
" '.'
..• .Ii!i. O.$..R "'., ..1,.?.8.
.,
: .. :
".:
:
:
:.
3:
.40
..·.
,..
.. ..,
, .. ;.-:..,.-::-:.,
: "'.<-
~
-60
:: :;..;:::: Si~~'I~t~d~pectru·~·:::~:::::~:~::·:::~·~~.~:~~:;::·:::::;:
en
--: ,-·:·(smoothed}··· .;
~ ..;.. ~..T·..~Theor~tjcal·PsD
~:;~~ ··
,~q.~~(~~4d~.k]1.·;·I·
'140~:'''':
: : : ,:,:
,. ";",":',',':-:'NBW = 5.7x10-6
10 3
10 2
10 1
Normalized Frequency
Figure 3.6: Output spectrum of MOD2 with a -6·dBFS sine·wave input.
t. NBW is an abbreviation for noise bandwidth. See Appendix A for a discussion of the impor-
tance of NBW in the context of a PSD plot.
W
th,
an
M
on
Wl
Si
th
pr
a
68

SimulatIon of MOD2
ent
led
rve
oat
m
Ian
When the input amplitude is lowered, simulations show that the optimal value of
the quantizer gain changes slightly, and is approximately k =0.75 for inputs that
are less than -12 dBFS. Thus, simulations indicate that a more accurate NTF for
MOD2 with small inputs can be derived if it is assumed that k :;:; 0.75. rather than
one. As will be shown in Section 4.2, the following formula offers a convenient
way to calculate the NTF for any value of the quantizer gain k (NTFk), once the
NTF associated with a quantizer gain of 1(NTF1) is known:
, a
,e,
ng
lis
:e-
ry
(3.6)
Applying (3.6) with k = 0.75 yields the following improved estimate of MOD2's
N'IF.
NTF(z) =
(z _1)2
z2 - 0.5z +0.25
(3.7)
Since this NTF has an in-band gain 2.5 dB above that of NTFl(z) = (I _ C 1)2,
the in-band noise power seen in simulation should he about 2.5 dB higher than that
predicted from NTFt.
Or--,--,,=",~,-,"",,CT,",,"-,-,--,-,-,
.-.:-;~-:-:-:::-
~-TheoretlcaIPSD ..• -,.
-20 ......•...,-,.,.,••...• -... k
063 ....
.•• ~.: j::~: .•• ~••:. :~;::.:\•. ~:
b)
-'20
:>
-40
[jj
~ ~: :..
co
__ .
"'C -100 ..
~ NBW=5.7x10-8
-l40L,-'--"-'-"-'=L,-'--"-'----ce<---'
10-3
10-2
10-1
Normalized Frequency
Figure 3.7: (a) NTF of MOD2 if the quantizer gain is k =0.63;
(b) Comparison of corresponding PSD with simulation.
_,
'-~=-'-""",,,=--_.J
-1
-0.5
0
0.5
a)
69

3 The Second-Qrder Delta-Sigma Modulator
When the input amplitude exceeds half of full-scale, the optimal quantizer gain
decreases, degrading the noise-shaping further and increasing the difference
between the expected and simulated SQNR. To illustrate this, Fig. 3.8 plots the
SQNR of MOD2 as a function of the input amplitude, for two different test fre-
quencies, and compares the simulation results against the predictions of the unity-
gain white-noise quantizer model. The simulation data follows (3.5) quite closely
over the middle portion of the amplitude range. For small inputs, the observed
SQNR is somewhat lower than predicted, with the result that 0 dB SQNR requires
a larger input than expected. For large input amplitudes, the SQNR of MOD2 satu-
rates, peaking for inputs in the vicinity of -5 dBFS, and then dropping abruptly as
the input amplitude approaches full-scale. The largest degradation in SQNR occurs
for low-frequency full-scale signals because these signals apply large values for
extended periods of time to the input of MOD2. Comparing Fig. 3.8 with the cor-
responding one for MODI (Fig. 2.21), we see that the SQNR of MOD2 is more
well-behaved than MOD1, except for the aforementioned saturation under large-
signal conditions.
o
.....•........
.
.
.
.
80
..
~.
..'~.. ;
..,.;..8: ....
·:~t~~~··
20
;&-Q
...
. .. - _•...• -. -. - _.
---
~~.Q_~_:
.. - .. ~...•....
o
;. ..
-100
·80
·60
-40
·20
Input Amplitude (dBFS)
Simulated SQNR of MOD2 with OSR = 128.
"
40
100 .--,----,---,----,---,----,~,----,----,- •
.. ~ Theoretical curve (3.5
CI Low-frequency input
o High-frequency input
a:zg
m
~
60
Figure 3.8:
70

__ I
Nonlinear Effects In MOD2
~ain
nee
the
fre-
ily-
ely
led
res
tu-
as
IfS
'or
>r-
,re
e-
5
3.3 Nonlinear Effects in MOD2
The simulations of MOD2 presented above confinn the essential insights provided
by the linear model, but also exhibit anomalies which can only be explained with
nonlinear models. Unfortunately, the dynamics of MOD2 with a binary quantizer
are much more complex than those of MOD1 and defy exact analysist. In light of
the intractable dynamics, it is reasonable to use approximate andlor empirical tech~
niques to explain the observed behavior of MODZ.
3.3.1 Signal-dependent quantizer gain
As Section 2.1.1 described, the gain of a binary quantizer is indetenninate. More-
over, the simulations of the previous section suggest that, in the case of MOD2, the
quantizer's gain is in fact signal-dependent. A model for MOD2 which includes
this signal-dependent gain (a nonlinear effect) is depicted in Fig. 3.9. In this figure,
the quantizer is replaced by a weak nonlinearity, the quantizer transfer curve
(QTC), plus additive noise. The QTC is determined by computing the average
quantizer output as a function of the average quantizer input, while the dc input
signal is swept across its range. Fig. 3.10 shows the QTC determined by simula-
tions. This figure shows that the QTC is compressive, i.e. it exhibits reduced gain
when the magnitude of its inp~t is large. F~. 3.10 also plots a cubic approximation
to the quantizer nonlinearity. v = kly + k3Y ' and lists the (kl,k3) coefficients of this
approximation. We can use these coefficients to estimate the distortion induced by
the QTC as follows.
e
u
Figure 3.9: A modulator model incorporating quantizer nonlinearity.
t. For MOD2 with 4 quantization levels and dc inputs less than 0.5 LSB in magnitude, ex.act anal-
ysis is possible and has shown that the quantization noise is in fact white [2].
71

-
3 The second-Order Delta-Sigma Modulator
First, detennine the effective NTF of the modulator by using k ;;; k I as the effec-
tive the quantizer gain:
(z _1)2
=z~2'-_-O-'-.7"-75-z-=-+L-O.-3-87-5·
(3.8)
Next, since the distortion tenn kiY is added at the same place in the loop as the
quantization error, we conclude that the spectrum of the distortion is shaped by
NTF(z, k1). Thus, distortion is greatest for frequencies where the NTF gives the
least protection, i.e. when the distortion teon lies at the edge of the passband. For
the spectrum of Fig. 3.7, the ioput signal is located at 1 = 1/500 and thus the
third harmonic is at a nonnalized frequency of 3f
= 0.006, where the attenuation
provided by NTF(z, k1) is about 53 dB.
For a small low-frequency sine-wave input of amplitude A, the local average of the
output follows the input and thus, according to the linear model, the local average
of the quantizer input is also a low-frequency sine-wave. but of amplitude AIk1.
The amplitude of the third harmonic induced by the QTC is k3(A/k j )3/4 t, from
which it follows that the third hannonic distortion is
72
t. The third harmonic component of (Asinwt)3 is A3/4. [3)
-
-
-3
v=k1y+k3y
k, =0.6125,k3 =-Q.0712
.
.
. __.-
,
.
.
.
.
... '
_
,- - . _..
-- simulation data
.......~~ .G,l,l~*?-~P'p!9~ ..
.........
-
,
-
....
I~
io
~t 0
o
~
iij'
~
·1c======±·:.:..~.. :,:"j':,:'-i:.:'i'':'::':"~':.:,:"
<
·1.5
-1
-0.5
0
0.5
1
1.5
Average Quantizer Input (y)
Figure 3.10: Empiricallyadetermined quantizer transfer curve for MOD2.

(3.9)
c-
I)
e
y
e
r,
Nonlinear Effects In MOD2
k3A2
--3NTF(z, kt ) ,
4kt
where z = ej2tt(3f). Evaluating (3.9) under the conditions of Fig. 3.7 (A = 0.5,
f = 1/500) yields HD3 = -87 dB. Since this calculated value is about 5 dB
short of the observed value of -82 dB, the distortion estimate provided by the
above calculation can only be considered a rough approximation. The discrepancy
is greatest when the input is large and the distortion is severe.
Returning now to our empirical study of MOD2's behavior as its input is varied,
Fig. 3.11 plots the in-band quantization noise power of MOD2 (with binary quanti-
1
.
..
'
'
'
'.
,
,
,
.
0.5
0.5
.
..
.
...
• '.' •• , •• , •• ',' • '.' •• c
. . .
.. '... '... '-."..
. . . .
,
.
. .
........ ..,....
o
DC Input
••••••••••••• , ••••••••••••••• ,
'••• 1
'•
.... "/~::
.. :.. :.:.
'
.
:,lo
'.'
.
••
• >
•
"
",., ..
_.,'
"..
......•.
• :
I
'~12 ·1/604
0
1~~ 32
-0.5
-0.5
o
DC Input
Simulated in~band quantization noise power for MOD2 as a
function of the DC input level.
""," ....., .. , ....
·:··::O$R:=?2.·:· :":
:
•
I
• _ >•••'. _ • '••• 1 •••'
•• ' ••• '••• 1 •••' ••• ' ••• c •• , •••' •••'••• '.
.
,
. . .
,
. . . .
. .
•' •••' .•. c •• , •• .' •••' ••• '••• , •••'
..
..
....
.'
.
'-."
-
...... .. , .,.
a) 10
:!1. -30
;;;
~ -40
.~ -50
c
u
-60
c
~'i'E
-70-1
b)
10
:£. ~40
~w
~ -50
Co
w -60
.~
c .70
uc
~ -80
'i'E -90-1
Figure 3.n:
73

3 The 5econd-Ord81 Delta-Sigma Modulator
zation) vs. the de input level for oversampling ratios of 32 and 64. Comparing
these plots with those for MOD1 (Fig. 2.22), we immediately note that the numer-
ous spikes associated with periodic behavior in MODI are now absent, and thus
conclude that MOD2 is more resistant to tones than MODI. However, as the
expanded view around u ;;; 0 in Fig. 3.11b illustrates, MOD2 still exhibits ves-
tiges of this undesirable behavior.
A second feature apparent in the plots of Fig. 3.11 is the V-shape of the in-band
noise power, which culminates in very large noise peaks as lui ~ 1. Even over the
range lui <0.7 (i.e. for inputs less than -3 dBFS), the in-band noise varies by
about 6 dB. The bulk of this behavior is accounted for by the signal-dependent
quantizer gain (and hence signal-dependent NlF) of MOD2. As the input
increases in magnitude, the quantizer gain decreases, reducing the loop gain and
hence the effectiveness of the noise-shaping. As a result, the noise at the output of
MOD2 increases with signal level. In the terminology of stochastic processes, this
property makes the quantization noise of MOD2 with a large detenninistic input
non-stationary. Specifically, when the absolute value of the signal is large, the
quantization noise power is also large, and thus the statistics of the quantization
noise are time-varying.
3.3.2 Stability ofMOD2
The preceding section used a combination of simulation and quasi-linear modeling
to explain several of the nonlinear aspects of MOD2. In this section, results from
the literature regarding the stability of MOD2 with a dc input are presented.
Hein and Zakhor [4,5J have shown that if MOD2 is constructed as in Fig. 3.1, so
that the difference equations are
-
iiiiI
I
s,
v(n) = sgn[x2(n)]
fXl(n+l~ = [I 0Jfxl(n)l+r-llv(n)+[llu,
h(n + I~
1
I
h(n~
L-2J
IJ
then for de inputs u satisfying lui < 1 the following bounds apply:
74
(3.10)
(3.11)

Fig. 3.12 plots these bounds along with values found by simulation. As this figure
shows, the analytic bounds are fairly tight for lui" 0.7 , but the analytic bound on
x2 "blows up" more quickly than do the simulation results as lui ~ 1 . Since x2 is
(a delayed version of) the quantizer input, Fig. 3.12 once again demonstrates that
the input to the quantizer in MOD2 becomes large as the input approaches full-
scale.
According to (3.12) and (3.13), the internal states of MOD2 are guaranteed to be
bounded for de inputs less than 1 in magnitude, although the bound on x2 does
become arbitrarily large as lui ~ 1. Since MOD2 tracks the low-frequency con-
tent of its input, one might assume that arbitrary time-varying inputs satisfying
lu(n)j < 1 for all n would lead to bounds similar to those for de inputs. However, as
Fig. 3,13 illustrates, an input waveform with lu(n)1 < 0.3 can lead to large internal
states if the waveform is chosen appropriately, The input waveform shown in
Fig. 3.13 predominantly oscillates between +0.3 and -0.3, and it does so with just
the right phase and period so as to drive the modulator state into ever-increasing
oscillations. Furthermore, the values at the transitions are chosen so as to maxi-
mize the excursion of the internal oscillations. Fortunately, such a waveform is
ng
er-
,"s
he
:5-
Id
Ie
'y
,t
Jt
d
,f
s
It
e,
Ixll"lul+2,
< (5 -lul)2
hl- 8(1-lul>'
Nonlinear Effects In MOD2
(3.12)
(3.13)
2
.
~
' ',""
.... ,....: ..• Blmulatlon
:-
:
, .... , ....
o
.
.
.
o
0.2
0.4 luI
0.6
0.8
Figure 3.12: Comparison of analytic stale bounds with simulation for MOD2.
75

3 The second-Order Delta-Sigma Modulator
unlikely to be encountered in practice, and even if it were, it is even more unlikely
that it would be precisely synchronized with the modulator's internal dynamics the
way the wavefonn in Fig. 3.13 is. It is known that MOD2 is stable for arbitrary
inputs less than 0.1 in magnitude, but the upper limit on the input amplitude for
which stable operation is guaranteed is not known.
The preceding discussion shows that MOD2 is "less stable" than MOD1. Although
the stability of MOD2 with dc inputs less than I in magnitude has been rigorously
established, the states may become arbitrarily large as lui ~ 1. It is therefore wise
to limit the input of MOD2 to lui < 0.8 or 0.9, if possible, so that the state of the
second integrator is not unduly large. Unfortunately, even though such an input
limit will keep the modulator state reasonable for de and slowly-varying inputs, it
is possible for the modulator state to become much larger than intended. It is there-
fore important to include means for detecting overly large states and for placing
the modulator in a "good" state.
o.Sttll!'TJul:ii:m'''I:I:t:I:lj''n::.i··.::
:'i:::: ·····jll II
u 0:i~wi~-iiJi~fti;JI~::'" ::::
~..,. ;::::'
~;3
......................................................
.(j.'o
100
200
10
; ..;;;:
.•• : .• "..
.
X1
0
'
,
:
'
:
:
- '
,
:
~
·10o
100
200
;OOf~..4;~·±;·+·~i.·~··;
..···;..·..;·····;··
_Large!
20 <$ .-;-r
,~,
"
:
.
,
.
,
"
.
. . .... ... ..,....., .... ',' ... ".," ... " .,.....
~. .......
. ....
.
,
,
,
.
,
,
,
,
-100o
100
200
Time
Figure 3.13: A hostile input with lui = 0,3 can drive MOD2 "unstable,"
76
I
=
!!
!•
"

ely
the
lry
for
gh
ly
se
,e
ut
it,-
g
Nonlinear Effects In MOD2
3.3.3 Dead-band behavior
Section 2.8.2 showed that when the gain of the op amp in the integrator is finite,
the zero in MODI's NTF shifts from z ;;;; 1 to Z = I-J.t. where
J..L is inversely
proportional to the op-amp gain, A. For simplicity, we will assume as before that
the proportionality constant is 1, i.e. J.l = 1/A t. This shift in the NTF zero creates
dead bands in the response of MODI to de inputs; the most troublesome of these
dead hands is the one centered on u ;;;; O. the width of which was calculated to he
IIA.
In MOD2, we will see that the impact of finite op-amp gain is drastically reduced
because the open-loop gain of the loop filter is proportional to A2. Assuming as
above that finite op-amp gain results in integrator poles at z ;;;; 1 - Jl, with
J..L = 1/A, the two zeros in the NTF of MOD2 under finite gain are both located at
Z = I-l/A.
To determine the width of the dead-band around u = 0 which results from finite
amplifier gain, we will calculate the largest dc input which can maintain the
period-2 limit cycle tabulated below in Table 3.1. Assume that the v sequence is as
n
0
I
xl(n)
0.5
-0.5
x2(n)
0.75
-0.75
v(n)
I
-I
xl(n+ 1)
-0.5
0.5
x2(n + I)
-0.75
0.75
Table 3.1. A length-2Iimit-cyc1e for MOD2 with u =o.
t. In practice. the proportionality constant depends on the values of the components used in the
integrator.
77

3 The second-Order Delta-Sigma Modulator
n
-----..----------------
shown in the third row, and that the op-amp gain is high enough that the response
of MOD2 to u = 0 is close to that given in Table 3.1. Applying a small input
u '¢ 0 to MOD2 changes the de component of the output of the first integrator to
Au. Similarly, the de component of the output of the second integrator becomes
A2u . In order for this de component to leave the sign of x2 unchanged, we need
IA2ul < 0.75. Thus, the expected width of the dead band centered on u = 0 is
(2·0.75)/A2 = 1.5/A2. For reasonable values of A, the dead band will there-
fore be very small.
"
To verify the preceding calculation, Fig. 3.14 plots the average value of the output
of MOD2 for small de inputs; the poles of the loop filter are located at
Z = 1 - 1/A with A ;::: 100. The observed width of the dead band is identical to
OUf 1.5/A2 estimate. Furthennore, Fig. 3.14 shows that, as with MODI, inputs
outside the dead band are accurately represented by the average output of MOD2.
s
C
r
1
1
1
I
(
I
(
The gain-squaring nature of the two-integrator cascade found in MOD2 is respon-
sible for MOD2's increased tolerance of finite op-amp gain and reduced suscepti-
bility to tones relative to MOD1.t Also, as noted earlier, MOD2 possesses a vastly
v
0
·1xl0·3',,-.,....'--''---''---'
-1x10'3
0
1x10·3
u
Figure 3.14: Dead-band behavior of MOD2 around u =0 with A =100.
t. An alternative perspective regarding tonal behavior in MODI and MOD2 considers the dimen-
sionality of the state-space for each system. Since the state~spaceof MOD2 is 2-dimensional,
whereas the state-space of MOD 1 is only 1~dimensional, it is far more unlikely for a particular
input to result in equal initial and final states in MOD2 than in MODI. Thus repetitive behavior
in MOD2 is less probable than in MOD 1.
78

se
ut
to
"
>d
is
"
It
It
)
s
Alternative Second-Order Modulator Structures
----------------------------
superior SQNRlOSR trade-off. Aside from the added analog complexity, the main
drawback of MOD2 is reduced stability, which is manifested in a practical input
range that is about 80% to 90% of the potential full-scale range of the converter.
The following section presents alternative realizations of MOD2, as well as a mod-
ified version of MOD2 that offers improved SNR and better stability.
3.4 Alternative Second-Order Modulator Structures
A number of alternative structures exist which can perform a second-order modu-
lation, and which also give a unity-gain STF (albeit with a delay of one or two
clock periods), as well as the same (1_z-1)2 NTF as the structure shown in
Fig. 3.1. In devising such structures, care must be taken to avoid delay-free loops
(which are not realizable), and to preserve reasonable robustness against the
unavoidable nonideal practical effects such as element inaccuracies, finite op-amp
gain, etc.
Second-order modulator structures which implement lowpass STFs exist, as do
structures which implement NTFs other than plain second-order differentiation. In
dealing with such NTFs, care must also be taken to ensure that the resulting modu-
lator is stable. For example, converting the delay-free integrators of Fig. 3.1 into
delaying-integrators and removing the feedback delay alters the NTF and yields a
marginally-stable system.
3.4.1 The Boser-Wooley Modulator
A second-order modulator which contains two delaying integrators [6] is shown in
Fig. 3.15. Using delaying integrators is desirable because it allows the op amps in
each integrator to settle independently of each other, thereby relaxing their speed
requirements [7].
Presuming unity gain for the quantizer Q, linear analysis shows that the STF is
and the NTF is
STF(z) =
(3.14)
79

--~~~~:-------_..-
3 The Second-Order Defia-Slgma Modulator
I
~~~~~~~~~-~~~.-
where
NTF() = (I_C1)2
z
D(z)
(3.15)
(3.16)
To achieve STF(z) = z-2 and NTF(z) = (l_z-1)2,lhe condilions Q1Q2 = 1
and alb = 2 must be satisfied. Since we have 3 parameters and only 2 con-
straints, there are many possible solutions. For example, a 1 = a2 = 1, b = 2. or
I
a1 ::. 0.5 ,a2 = 2 and b = 1 can be used. In the actual design process, dynamic
L
range scaling (to be discussed in Section 8.3) removes any ambiguity in finding the
=-
parameters needed to implement a given NTF and STF.
;:
---
3.4.2 The Silva-Steensgaard Structure
Another useful second-order structure is shown in Fig. 3.16 [8]{9]. The distin-
guishing features of this circuit are the direct feedforward path from the input to
the quantizer and the single feedback path from the digital output. Linear analysis
confirms that the output is given in the z-domain by
V(z) = U(z)+(I-C1)2E(z)
(3.17)
as before. The input signal to the loop filter is, however, different: it contains only
the shaped quantization noise:
U(z)- V(z) = _(1_C1)2E(z)
(3.18)
Q
v
~_J
Figure 3.15: A second-order modulator with delaying integrators.
80
J I

·=
Alternative $econd-Qrder Modulator Structures
Since the loop filter thus does not need to process the signal, the requirements on
its linearity may be greatly reduced, which is a significant practical advantage.
Also, as can be seen from (3.18), the output of the second integrator will give
-z-2E(z) directly. This is advantageous if the modulator is the input stage of a
MASH structure.
3.4.3 The Error-Feedback Structure
As an example of a circuit which looks simple and hence attractive, but which is
impractical for analog AI: loops, we shall next consider the so-called errorleed~
back structure shown in Fig. 3.17. Here, the quantization error e is obtained in ana-
log form by subtracting the internal ADC's input from the DAC output; e is then
fed hack to the input through a filter Hf The output signal in the z~domain is
u
r------------I1
+y
Q
v
L------I2
r-,
~_J
Figure 3.16: A second-order modulator with feedforward paths.
v
Q
y
+}-------~
_____~rl~l~:~~~~~~ __
,
,
,
,
,
,
,
,
,
,
:
'E
~ -,
,
,
+~+-ElAl3-'
I
I
,-_.1
~------------------_.
u
Figure 3.17: Error-feedback implementation of MOD2.
81

3 The Second-Order Delta-Sigma Modulator
V(Z) = E(z) + U(z) + HIz)E(z)
(3.19)
Hence, STF(z) = 1 and NTF(z) = 1 + HIz). To obtain NTF(z) = (1- e i )2
as in (3.2), HIz) = (1- z-I)2 - 1 = z-2 - 2ei is needed. This is readily real-
ized as shown in Fig. 3.17.
In spite of its attractive simplicity, the structure of Fig. 3.17 is not practical for ana-
log implementation, since it is very sensitive to variations of its parameters.
Assume, e.g., that the element (say, a capacitor) realizing the multiplication by 2
has a +0.5% mismatch error, so its actual value is 2.01. Then the actual NTF will
be H'(z) = (1 - z-I)2 - 0.0Iz-1. At very low frequencies, instead of 0, the mag-
nitude of H' will then equal 0.01, or -40 dB. Hence, even with careful analog
design, the achievable ENOB will typically be less than 10 bits for ADCs with a
single-bit quantizer, even for high OSR. By contrast, comparable parameter
changes still allow over 18-bit resolution for all second-order structures discussed
earlier.
Note that the error feedback structure is very useful, and is often applied, in the
digital loops required in .6.~ DACs. There, e.g., the parameter values 1 and 2 are
easily and exactly realized. More general values can also be accurately imple-
mented. This topic will be discussed in detail in Chapter 7.
3.4.4 Generalized Second-Order Structures
The structure of Fig. 3.1 gives STF(z) = 1 and NTF(z) = (1 - e 1)2 More gen-
eral STFs can be obtained by feeding u not only to the input of the first integrator,
but also to the inputs of the second integrator and the quantizer (Fig. 3.18). The
STF then becomes
(3.20)
The STF now has two zeros, and a double pole at z = O. In this way, a "free" sec-
ond-order FIR signal pre-filter can be incorporated into the ADC.
82
I.-
ii
!
i
iii
!!!!!!
~..
I

Alternative Second-Qrder Modulator Structures
Similarly, by feeding the output signal v back to all three blocks in the forward
path (Fig. 3.19), two nonzero poles can be generated in both the STF and the NTF.
Thus, more general STFs and NTFs may be obtained. The new functions are
v
(3.21)
Q
+
1
-1
-1
-z
STF(z) = B(z)
A(z)
1
~1.
-z
2
I
9)
,-
I.
2
1-
'-----.....---JZ·lf+.-------'
Figure 3.18: A second~order modulator with multiple input feed·in terms.
u
v
Figure 3.19: A second-order modulator with arbitrary feed·in and feed-hack
coefficients.
83

3 The Second-order Delta-Sigma Modulator
and
where
NTF(z)
(3.22)
and
(3.23)
(3.24)
Since the a 3 feedback term increases the NTF order to 3, but does not increase the
number of in-band NTF zeros, this term is rarely used. (It may be useful if the
modulator is continuous-time, rather than discrete-time as assumed here.)
By incorporating both multiple feedforward and feedback features into the second-
order structure, more flexibility is obtained for enhancing stability and improving
dynamic range.
3.4.5 Optimal Second-Order Modulator
Given the variety of modulator architectures shown thus far, the reader might well
wonder "Which architecture is the best?" One part of the answer to this question
deals with the optimal NTF, while the second part of the answer deals with the
optimal topology. The STF is a secondary consideration because the STF merely
filters the signal; it plays no role in determining the peak SQNR. Also, since the
choice of the topology is tied more closely to practical considerations than to fun-
damental mathematical limits, this section will only consider the problem of opti-
mizing the NTF.
Thus, the first step in finding an optimal second-order modulator is to find the sec-
ond-order NTF which yields the highest SQNR, or equivalently, the N1F which
minimizes the in-band noise. For high
values of OSR, the
magnitude of
NTF(z) = (1 - z-l )2;A(z)
in !he passband is approximalely
Kw2 , where
84
l
~
t[
III
H,

Alternative Second-order Modulator Structures
K = IIIA(I)I. By shifting the NTF zeros from z = 1 to Z = e±jo., the magni-
tude of the NTF in the passband becomes K(m- a)(m + a) = K(m2 - a2). The
integral of the square of this quantity over the passband is a measure of the in-band
noise, and can be minimized by choosing a such that
(3.25)
is minimized. The solution to this optimization problem can be obtained by differ-
entiating lea) with respect to a, and equating the result to O. This gives
(3.26)
Since the ratio
I(O)/I(ao ,) = 9/4,
the expected SQNR improvement is
10JoglO(9/4) ;;; 3.5 dB. Ntte that these results assume that the quantization
noise is white, and that IA(z)1 =IA(l)1 in the O-mB frequency range.
An exhaustive search of the NTF design space for the NTF with the highest peak
SQNR yields the NTF whose pole-zero plot and SQNR curve are depicted in
Fig. 3.20. The denominator of this optimal NTF is
(3.27)
.'
.~.
Compared to the SQNR curve of MOD2 shown in Fig. 3.8, the SQNR curve asso-
ciated with this NTF is more linear and supports signals closer to full-scale without
saturating. As a result, the peak SQNR for this NTF is about 94 dB, which is about
6 dB higher than that of MOD2.
85

3 The $econd-order Delbl-8lgme Modul.tor
I
I
,
CD
:!:!- 60
a::
Zg 40
aj
o
.
-1
••
o
. +.
.•+
.++~
.+:
..:... :...:.+:.
20:++:
.......•...:... ".
O,LOO~"'_':'8"CO~-..~O~--4~O~-_~2"CO~---'O
Input Amplitude (dBFS)
Figure 3.20: Optimal second-order NTF for OSR ~ 128;
<a) pole-zero plot, (b) SQNR curve.
3.5 Decimation Filtering for Second-Order A1: Modulators
As with MODI, efficient decimation filtering can be based on cascaded sine filters
for higher-order modulators also. In general, the determining factors in finding the
order K of the sin~ filter for an Lth-order.1L modulator are
(a)
the filter should cut offal a fasterrale aroundfs than the NTF ofthe ~
modulator rises there, and
(b)
its gain response should be flatter around Is/OSR and its harmonics
than the NTF is around dc.
Condition (a) insures that very little out-of-band noise is left unsuppressed around
/ = fa after decimation, while Condition (b) guarantees that the folding of the noise
from frequency bands around lsiOSR, 2/s/0SR, etc. after decimation adds lit-
tle to the in-band noise. Both conditions require that K > L; usually, K = L + 1 is
adequate.
86
~
It
~I•
~
~,
iii -,
II ..
• •-

Decimation Filtering for Second"()rder &l: Modulators
Ifhi~ resolution is required, a two-stage approach is efficient (Fig. 3.21). Here, a
sine (xJ/ JD) filter, clocked at/" is used first to reduce the sampling rate from/,
to the intermediate clock rateJD [10, Ch.l]. The sine filter is followed by a sharp
lowpass filter clocked at the reduced rate JD. The second filter, which may have
either afinite impulse response (FIR) or an infinite impulse response (IIR), sup-
presses the remaining noise in the range betweenfB andfd2, allowing the further
reduction ofthe clock frequency to its decimated value close to 2JB. The second fil-
ter may be implemented with a cascade of ha/fband FIRjilters [11,12] and may
also incorporate compensation for the droop introduced by the sincK filter.
Fig. 3.22 illustrates the spectra and filter responses for the two-stage approach with
JD = 4tB· In the case of MOD2, L ~ 2, and thus a sinc3 filter is adequate for the
first stage.
From Lll:
Modulato
slncK in 1
FIR or IIR in2
r
f.
filter
fD
filter
2fs
To
DSP
Figure 3.21: A two-stage decimation filter.
...:... ;...:~!F.....:
'... :' ,s;nc~ l:e~ponse
., .. ,',
,
'
.
.:... : .. : ... : .. :., .: ... '...,
'
.'
'...
:
:
:
:
composIte response
-, - - -:... : ...:;," : ...: ..
~ ...:...
~ ... :- --
20 !i!9I)?oJ ,~~9~.. : .. ,'..
.....
~ ..
o
.
iD
""j
c
'"
~
-60
.-;
,
.
,
.
,
,
: :,/:\.~ j :.(\~ ;:'/~\
"OO!.--'-'!fD'-'-c2!,;fD~'--\3'"fD'-"--'o4"fDL1.-'--'4..'-"~'LlC-L:Lili}fJ2
fa
Frequency
Figure 3.22: Decimating with a sine3 filter;.fs is the modulation rate'!D is the
intermediate decimation frequency and [0J'BJ is the signal band.
!!
•
j-I
'-
.~~
Jj
87

3 The Second.Qrder Delt8-Slgma Modulator
In selecting the intennediate frequency fD' a compromise must be reached. Lower-
ingfD allows the reduction of the speed and complexity of the second filter. On the
other
hand,
as
fD
approaches
2fB
so
that
the
intennediate
OSR
(OSR t ~ J D1(2JB))
drops below 4, condition (b) may not hold even for
K
= L + I ; furthermore, the droop of the sincK filter atIs becomes large. Hence,
an intennediate OSR of 4 seems to be about optimal. In [13], useful graphical
design infonnation is given for the added noise and droop introduced by this
approach.
A sinc3 filter may be constructed from a combination of three of the accumulator
sections already introduced in Section 2.9. However, a more economical realiza-
tion of sincKfilters for K> 2 is provided by the Hogenauer structure [14] shown
in Fig. 3.23a. This structure is obtained by factoring the transfer function of the
sinc3 filter as follows
(3.28)
and realizing each factor by an accumulator or differencing stage. By perfonning
the decimation just before the differencer stages, the N-period delays needed to
a)
-j~H~H~~~ 1-~1H 1-z-1H
1_~1~
Downsample
~
_N
-j~H~H~~~ 1_z-1H 1_z-1~
Figure 3.23: Hogenauer structure of a sine3 filte'r.
88
J
II
iii
iii

-I-,
~!
Conclualona
realize the z-N factors can be implemented by single-delay blocks. The constant
factor N is usually an integer power of:2, and hence division by N does not require
any arithmetic operation.
In the Hogenauer structure, the accumulators will tend to overflow, but if an arith-
metic such as two '8 complement or modu.(o arithmetic with "wrap-around" charac~
teristics is used, then the correct result will be obtained at the output, in spite ofthe
intennediate overflows. For an M-:-bit input, using M + Klog2N bits throughout is
sufficient to realize the filter exactly. Fewer bits can be used in internal states since
the associated truncation errors are noise-shaped in the final output. Also, the
structure can be simplified somewhat by combining the last accumulator and the
first differencer into an accumulate-and-dump stage as shown in Fig. 3.23b [10,
Ch. 1].
3.6 Conclusions
This chapter examined the second-order modulator, MOD2 and several of its vari-
ants. Like MODI, MOD2 is theoretically able to achieve arbitrarily high resolution
for dc inputs, and is immune to a variety of imperfections. In contrast to MODI,
which displays a 9 dB increase in SQNR for every douhling ofOSR, the SQNR of
MOD2 increases at 15 dB per octave. As a result, MOD2 is able to achieve a given
level ofperfonnance with a lower sampling rate than MODI would require. Due to
the gain-squaring provided by the two-integrator cascade, MOD2 is also more
robust in the face offinite op-amp gain than MODI. Furthennore, the quantization
noise at the output ofMOD2 is less likely to contain tones than the noise at the out-
put of MODl. In all these areas, MOD2 is markedly superior to MODl. The pri-
mary drawbacks associated with MOD2 are increased hardware complexity (both
analog and digital) and a slight decrease in the allowable signal range.
References
[1]
J. C. Candy, "A use ofdouble integration in sigma-delta modulation," IEEE Transactions on
Communications, vol. 33, no. 3, pp. 249-258, March 1985.
[2]
N. He, F. Kuhlmann and A. Buzo, "Double-loop sigma~delta modulation with de input,"
IEEE Transactions on Communications, vol. 38, no. 4, pp. 487-495, April 1990.
[3]
D. Johns and K.w. Martin, Analog Integrated Circuits, Wiley, New York, 1997.
89

[4]
[5]
[6J
[7]
[8J
[9J
[IOJ
[II)
[12]
[l3J
[14J
[15]
[16]
3
The Second-order Delta-5lgma Modua.tor
S. Hein and A. Zakbor, "On the stability of interpolative sigma delta modulators,"
Proceedings of the /99/ IEEE International Symposium on Circuits and Systems, vol. 3,
pp. 1621-1624, June 1991.
S. Hein and A. Zakhor, "On the stability of sigma delta modulators," IEEE Transactions on
Signal Processing, vol. 41, no. 7, pp. 2322-2348, July 1993.
B. E. Boser and B. A. Wooley, "The design of sigma-delta modulation analog-to-digital
converters," IEEE Journal a/Solid-State Circuits. vol. 23, pp. 1298-1308, December 1988.
R. Gregorian and G. C. Ternes, Analog MOS Integrated Circuits, John Wiley & Sons, New
York, New York, 1986, pp. 491-496.
J. Silva, U. Moon, J. Steensgaard and G. C. Temes, "Wideband low-distortion delta-sigma
ADC topology," Electronics Letters, vol. 37, no. 12, pp. 737 -738, June 7 2001.
J. Steensgaard, "High performance data converters," Ph.D. thesis, Technical University of
Denmark, Department of Infonnation Technology, March 8, 1999. Available on the
worldwide web at www.steensgaard.org.
S. R. Norsworthy, R. Schreier and G. C. Ternes, Eds., Delta-Sigma Data Converters,
Piscataway NJ: IEEE Press, 1997.
T. Saramliki, T. Karema, T. Ritoniemi and H. Tenhunen, "Multiplier-free decimator
algorithms for superresolution oversampled converters," Proceedings 0/ the J990 IEEE
International Symposium on Circuits andSystems, vol. 4, pp. 3275-3278, May 1990.
D. A. Johns and K. Martin, Analog Integrated Circuit Design, John Wiley & Sons, New
York, New York, 1997, pp. 551-554.
J.
C.
Candy,
"Decimation
for
sigma-delta
modulation,"
IEEE
Transactions
on
Communications, vol. 34, no. I, pp. 72-76, January 1986.
E. B. Hogenauer, "An economical class of digital filters for decimation and interpolation,"
IEEE Transactions on Acoustics. Speech and Signal Processing, vol. 29, pp. 155·162, April
1981.
K. C. H. Chao, S. Nadeem, W. L. Lee, and C. G. Sodini, "A higher order topology for
interpolative modulators for oversampling AID conversion," IEEE Transactions on Circuits
and Systems, vol. 37, pp. 309-318, March 1990.
R. Schreier, "An empirical study of high-order single-bit delta-sigma modulators," IEEE
Transactions on Circuits and Systems II vol. 40, no. 8, pp. 461-466, August 1993.
r-
I
-
c
90

-
CHAPTER 4
Higher-Order Delta-Sigma
Modulation
The operation of the quantizer is, as usual, described as the addition of an error sig-
nal:
In this chapter, higher-order modulators are developed as generalizations of the
first and second-order modulators studied in earlier chapters. High-order modula-
tors are found to offer improved perfonnance at the expense of more hardware and
reduced signal range. This chapter also investigates various architectural options
for implementing high-order modulators.
4.1 High-Order Single-Quantizer Modulators [1]-[3]
Fig. 4.1 shows the general structure of a single-quantizer &L modulator. In this dia-
gram, the modulator is divided into two parts: a linear part (the loop filter) contain-
ing memory elements, and a memoryless nonlinear part (the quantizer). The loop
filter is a two-input system whose single output Y can be expressed as a linear com-
bination of its inputs U and V:
(4.1)
y(z) = Lo(z) U(z) + L ,(z) V(z).
-Ii-
ii,..
"'"
I
I•
V(z) = Y(z) + E(z).
(4.2)
91

4
Higher-Order Delta-Sigma Modulation
Using these two equations, the output V can be written as a linear combination of
two signals. namely the modulator input U and the quantization error E:
where
V(z) = STF(z)U(z) + NTF(z)E(z).
(4.3)
i
i"-•"=
NTF(z) =
(4.4)
Conversely, given the desired NTF and STF, one can compute the loop filter trans-
fer functions which are required to implement them, namely
Since these relations apply regardless of the structure of the loop filter, the input-
output characteristics of the loop filter (and hence of the modulator) are deter-
mined solely by STF, NTF and the properties of the quantizer. Structural details of
the loop filter are thus unimportant in determining the (ideal) input-output behav-
ior of the modulator.
L (z) = STF(z) and L (z) = 1
a
NTF(z)
I
1
NTF(z) .
(4.5)
=
i
The reader is reminded that the quantizer Q shown in Fig. 4.1 is in fact an analog-
to-digital converter. Hence, y(n) is an analog signal (usually voltage), while v(n)
is a digital data stream. Thus, (4.2) implies that the reference voltage VREF of the
ADC is assumed to be unity, or equivalently that all analog quantities are in fact
normalized to VREP This also means that an ideal DAC using the same VREF is a
u
l..o
Loop
Y
Q
Filter
-
L1
v
Figure 4.1: General structure ofa single-quantizer 8.!: modulator.
92
J

-
High-Qrder Single-Quantizer Modulators [1]-[3]
unity-gain block. Hence, the DAC was omitted from the feedback path of the struc-
ture of Fig. 4.1.
Equation (4.4) suggests that L 1 must be large in the signal frequency range 0 toIs
to reduce the NTF there, and hence La must also be large in the same range to
allow the STF to remain close to 1. This suggests that both L1 and Lo should have
their poles in this range. In fact, as can be foreseen from the structure of Fig. 4.1
and its input-output relations (4.1)-(4.5), due to the shared circuitry used to realize
both La and Ll• these two functions indeed usually have the same poles (which are
also the zeros of NTF). Lo and L1do, however, have in general different zeros.
In the simplest case, the signal is only delayed by k clock periods in the modulator
so that the SlF satisfies ISTFI = 1, and the NTF requires the quantization noise
to be differentiated N times. Then,
The N poles of both Lo and L1 lie on the unit circle, at z = 1. Considering their
zeros, N - k of the N zeros of 1..0 lie (for N > k) at z = 0, and k zeros at infinity,
while those of L 1 are located at the roots the equation (1 - z-I)N = 1. This gives
the following formula for the N - I zeros of L1
;
~[I + jcot(1ti/N)], i ;
1,2, ''', N-1.
Iii
i"
'
which, by (4.5), leads to
Lo(z); z-k(i-z-I)-N andL1(z); I-(i-rl)-N
1
zi = _--'c,,---
j21t .
-,
l-e N
(The Nh zero corresponding to i = 0 is at infinity.)
(4.6)
(4.7)
(4.8)
The zeros and poles of 1..0 and L1 are illustrated for N = 2, 3, 4 and 5 in Fig. 4.2.
Note that for higher degrees N, the finite zeros of L1 may be outside the unit circle,
in which case L1 is a non-minimum-phase transfer function.
93

4
Higher-Qrder Delta-Sigma Modulation
An important special case occurs when the loop filter has a single input, and only
the difference urn) - v(n) enters the loop filter (Fig. 4.3). Then Lo " Land
L t " -L,and(4.4)becomes
1
I
wi
al<
no
I
NTF(z) = I + L(z) and STF(z) =
L(z)
I +L(z)'
(4.9)
In
to
re
N=2
...... ·...a
N=4
a
..... a ..
a
a
....•..
a
a
:
a
..
..
.
a
a
o zeros of La
a zeros of L1
x
poles of ~
and L1
Figure 4.2: Poles and zeros of the Lqand L)
loop filters for NTF(z) = (I - C
)N.
u
,
,
,
~
,
,
L
,y
Q
,
,
,
,
,
,
- -- ----------
v
94
Fignre 4.3: The single feedback topology.
L_

-
Hlgh~rder Single-Ouantizer Modulators [1]-(3)
where L is the transfer function of the common portion of the loop filter. Now L,
along with the quantizer, detennines all important properties (stability, signal and
noise transfer) of the modulator.
In another special situation (Fig. 4.4), a forward signal path is added to the struc-
ture of Fig. 4.3 so that Lo = L + 1 while L. remains unchanged. Hence, the NTF
remains as given in (4.9), but the STF becomes
STF( ) ;
L(2) + 1 ;
1
z
1+ L(z)
.
(4.10)
The output thus contains the input without any filtering or delay. It is only scaled
by VREF, here assumed to be 1. Hence, the input to the loop filter is, in the z
domain,
U- V; U-(STF· U+NTF·E); -E/(I +L).
(4.11)
Q
•!
ii
Thus, the input to the loop filter no longer contains the signal, only the filtered
quantization noise. This makes the design of the loop filter a much easier task,
since its linearity need not be very high [4], [5].
Note that there must be at least one clock-period of delay in the loop containing Q
and L. in Fig.4.1. Otherwise, a given value
yen)
would make
v(n)
into
yen) + e(n) , and this sample would pass through L1• and change yen) instantly.
f- - - - -ioop-Ffiter------:
,
'
,
:
,
,
,
, y
,
+
L
J-<,-'--+I
~
J
L-__-J
Figure 4.4: The single feedhack topology with a feedforward path.
------------------ ---~-----
9S

.-----.
H
~
Thus the value of yen) would continuously vary during the same period! In the
~
structure of Fig. 4.1, this delay must exist in the transfer function LI'
r-
From the required loop delay, we can derive an important realizability condition
which restricts the choice of the NTF. This condition can be derived from (4.2),
which in the time domain translates into v(n) :::: yen) + e(n). Assume that there is
no input, so u(n) ;;;; 0, and that initially all signals are zero. Let next the error
change
to
e(O) = 1.
The
new
value
of
the
output
will
then
be
v(O) = y(O) + 1 = l.t
Since, as shown above, there must be at least one delay in the loop filter L 1
between its input v(n) and its output yen) (otherwise, a physically unrealizable
delay-free loop would exist in the modulator), yen) cannot depend on v(n), and for
the conditions stated above yeO) ::: e(O) ::: 1 must hold. This condition is easily
translated into a condition on the NTF. Denoting for brevity the NTF by H(z) , by
the above derivation the impulse response hen) corresponding to the NTF R(z)
must
satisfy
the
condition
h(O) ::: 1.
From
the
equation
H(z) = h(O) + z-Ih(l) + c 2h(2) + ... , it can also easily be seen that Ihis is equiv-
alent to the condition R(oo) = l.
Next, let be H(z) a rational function of the form
-
i!!!ll!'-
.-
!II!
=
ii•
H(z) =
bmzm+bm_IZm-1 +
+ b1z+ bo
anzn +an_1zn
1+
+a1z+ao
(4.12)
Then it follows from R(oo) ::: 1 that m :: nand bm = bn = an must hold.
In conclusion, if a physically unrealizable delay-free loop is to be avoided in the
modulator, the equivalent conditions
t. Note that in the physical structure e(n) does not change independently of y(n) ; however, we are
discussing here the linearized model where e(n) is an independent input.
%

-
T
=
Stability ConsIderations In High-order Modulators
bn
h(O) = H(=) = -
= I
an
(4.13)
on the NTF must hold. This seriously restricts the choice of H(z) available to the
designer.
A simpler proof of (4.13), but one without physical insight, is based on (4.4). As
discussed above, the loop filter LI(z) must delay its input signal v by at least one
clock period. Thus the first sample of the impulse response of L1 is zero, i.e.
L/=) = O. Then, by (4.4),
(4.14)
I
s
;=1
The rest of (4.13) fnllows directly.
4.2 Stability Considerations in High-Order Modulators
The linearized model of the single-quantizer modulator (as described by Fig. 4.1
and Eqs. 4.1-4.5) predicts that the stability of the modulator is detennined solely
by the loop gain L 1(z), which in turo is determined by the NTF H(z). However,
this argument ignores the nonlinear limitations of the quantizer. For example, con-
sider a situation in which the input u(n) is so large that the input to the first integra·
tor is positive at every time step. In this case, the output of the integrator will
monotonically increase without bound, and the loop will be unstable. This thought
experiment clearly demonstrates that the magnitude of the input is of relevance in
detennining the stability of the loop. The STF is similarly relevant in that it effec-
tively provides a (frequency-dependent) scaling of the input magnitude.
The range of input magnitudes over which the modulator functions properly is
called the stable input range. Proper modulator operation is assured if the loop fil-
ter remains linear (i.e. internal signals do not grow so large as to saturate the op
amps) and if the internal quantizer is not severely overloaded. By virtue of the pre-
ceding argument, the stable input range must be less than or equal to the full-scale
of the first feedback DAC. In a high-order modulator, especially in one employing
97

4 Higher-order Delta-Sigma Modulation
single-bit quantization, the stable input range is usually a few dB below the full-
scale range of the feedback DAC. This loss in range usually results from the non-
linear effects of quantizer overload rather than from insufficient linear range in the
loop filter. Since the input to the quantizer is given by
-
Y(z) = STF(z)U(z) + (NTF(z) - 1)E(z)
(4.15)
it is clear that when the modulator input u(n)
(as amplified by the STF)
approaches the edge of the no-overload range of the quantizer, the addition of fil-
tered quantization error may push yen) into the overload range. This overload will
increase e(n) , which will aggravate the original overload, and this vicious circle
eventually results in severe quantizer overload and hence the saturation of the
active blocks. Correction of this runaway behavior often requires some sort of
intervention, such as modulator reset, since the return of the input to the stable
input range of the modulator may not be sufficient to restore stable operation.
Since the STF acts essentially like a pre-filter, the stable input range of a ~:r mod-
ulator is primarily detennined by the NTF and the number of bits in the quantizer.
Single-bit quantization is an important case which is given special attention in the
following section. Multi-bit quantization is discussed Section 4.2.2.
4.2.1 Single-Bit Modulators
If the NTF is all one needs to know to describe the stability properties of a binary
(I-bit) modulator, an important question is "What NTF properties are necessary
and sufficient for stable operation?" Unfortunately, a simple and exact answer to
this question is not known. The proven results are generally either too restrictive
(that is, too conservative), or apply only for specific modulators with constant
inputs. The most widely-used approximate criterion is the (modified) Lee criterion
[1][7]:
==I
•
i
!!
iii-..
A binary
8.~ modulator with an
m<l'xIH(ejOJ)! < 1.5.
98
NTF = H(z) is likely to be stable if
I

-
II•I
I
,-
Stability ConsIderations In High..Qrder Modulators
Note that this criterion is neither necessary (as we have seen in some stable
MOD2, max!H(eJOl)1 = 4 was allowed), nor sufficient (the criterion says nothing
about a li~it on the input signal). Nevertheless, due to its simplicity. it is of some
use.
The quantity maxIH(ejW)1 is the maximum gain of the NTF over all frequencies,
also known asU\he infinity-nonn of H, for which the mathematical notation is
~HL. In the original statement of the condition, the limit on IIHlI_ was given as 2,
but as experience with higher-order modulators was gained, the rule of thumb was
revised to use a limit of 1.5. For moderate-order modulators (order 3 or 4), slightly
higher values may be tolerable, while for very high-order modulators (7 or more) a
more conservative IIHlloo < 1.4 may be more appropriate.
Although Lee's rule is a helpfUl rule of thumb for predicting a priori instabilities in
single-bit modulators, it has no solid theoretical foundations, and needs to be con-
firmed by extensive simulations.
Note that the maximum of IH(ejW)1 usually occurs at <.0 :;:: 1t, since this point is
farthest from the zeros (which are clustered around z :;:: 1) and closest to the
poles. An exception may occur if high-Q poles exist in H(z), in which case the
peak value may occur near the dominant (highest-Q) pole.
A somewhat more reasoned and satisfying explanation of the runaway behavior
associated with instability is based on the linear modulator model shown in
Fig. 4.5. Here, the quantization has been replaced by a multiplication with a con-
UI--.llo
Loop
Y
Filter
L,
E
k·>-<~+·H_V
Figure 4.5: Linear model of a modulator wherein the quantizer is
modeled by a gain k and additive error signal E.
_._-------------------
99

4
Higher-Qrder Delta-Sigma Modulation
stant k and by the addition of the random noise e(n). The gain k can be found by
simulation, as described in Section 2.1. The result obtained there was
k = (v, y)
(y, y)
(4.16)
where the quantization v(n) = sign[y(n)] was assumed. In the improved linear
model which incorporates k, the transfer functions La and L1 are effectively
replaced by kLo and kL 1• respectively. Hence, the new noise transfer function is
now
NTF (z) _
1
=
k
-
l-kLt(z)
(4.17)
as already stated in Section 3.2. Here, NTFI (z) is the NTF for k = I. The natural
modes of the linear model are the roots of the denominator of NTFk(z), By draw-
ing the locus of these roots for 0 < k < 1, the stability of the system may be pre-
dicted [8]. (In some cases, k may be larger than 1, but in the overload zone k is
usually less than one.) Note that for k = 0, these roots coincide with the zeros of
NTFI(z); for k = 1, with its poles. For stability, all roots must be within the unit
circle. As an example, Fig. 4.6 shows the root locus of a fifth-order modulator. For
,1<=0.547
--k=O
Figure 4.6: Root locus of a Sth.order modulator
as the effective quantizer gain, k, varies.
100
I!i
i

, , .
ii,
II
==
Stability Considerations In High-Qrder Modulators
i
k > 0.547 all roots are inside the unit circle, but if k goes below 0.547. one pair of
roots moves outside the unit circle.
"
Note that the root locus indicates a reduced stability for decreasing values of k. To
understand this phenomenon better, consider the Bode gain plot associated with
the modulator loop. The loop gain is kL1(z) , which (as explained in Section 4.1)
typically has all its N poles at or near dc, i.e. z ;;;; 1. on the unit circle. Hence, the
log-log gain-vs.-frequency plot at low frequencies is high, but it drops rapidly, with
a slope -20N dB/octave. A typical Bode plot for k = 1 is as shown in Fig. 4.7. It
indicates conditional stability, since there are frequencies at which LL1 = 180
0
10.2
10.1
Normalized Frequency, f
Bode plot for the 5th-order loop filter.
Figure 4.7:
Or----,---,---,--,-,-,-,c"---,-,--,-+-,-,.,-,i---,----,--,,
-90'':::: ::::::::j',.
.,....... .... ".,
L''~"'......-"""",;,L
;t!il;tUJfm~t~J18~1
.. ,., ,··.··.·,-,· .. c,·····,···.··,·,·.,·.·.·.······,···.··,·
.
,
..
-., •••••
··-'·.. r .. ·····,·", .,.,."
••••• ,
_,_._,_',.
-270
-360
-450
-540
10.3
~
~:;
-180
1
~",
101

4
Higher-Order Delta..slgma Modulatlon
and IL11> I . For decreasing k values the lkL11 curve drops until the marginal
instahility condition, IkL11 ~ I at LL j =
80', holds. The value of k for which
this occurs, namely "min
:= 1/1.83 = 0.547, is the lowest allowable quantizer
gain as indicated in Fig. 4.6.
Since the output amplitude Iv(n)1 of the single-bit quantizer is fixed, a smaller k by
(4.16) is equivalent to larger input signals ly(n)1 and hence larger lu(n)l, confirm-
ing the observation that instability can be prevented by limiting the input signal.
An alternative way to explain the phenomenon of conditional stability is via the
Nyquist plot, shown in Fig. 4.8. From linear systems theory [9], the number of
clockwise encirclements of the critical point at (-I,D) made by the -L1(ejW) con-
tour as co varies from -7t to 7t is equal to the number of closed-loop poles which
are outside the unit circle, minus the number of open-loop poles which are outside
the unit circle. Since L I has poles which are on the unit circle, the ejw contour is
modified to have infinitesimal bumps that skirt these singularities on the outside of
the unit circle. The number of open-loop poles which are then outside this modi-
fied contour is zero, and thus the condition for closed-loop stability is simply that
iI
=
-
-"
"
-
'"-1
....
3
,
/;-
,
2
... :-1":_/_:_
\
//
\
/ .
Critical \
•
...... ... ,t
...
Point
•
//~1.83 '
I
I
Im(-L,(....))
0
!...
.
(():= ~
I
I
(() := +1t
•
II,
I
;;•
-1
... .\.,.
J
111
\ \
I
" !!!!
-2
- - ...:..... ;. \.. \. ;- .
"
/
Iii
-3
;" ....
/ Net large-radius
~
'--t ::'-9-
,
locus
-5
-4
-3
-2
- -
I
Re(-L,(....))
,
Figure 4.8: Nyquist plot for the loop filter of a sth.order modulator.
102
j

i;
d
Stabllity Considerations In High-Order Modulators
the number of clockwise encirclements of the critical point is zero. In Fig. 4.8, the
number ofencirclements is zero, so the closed loop system is expected to be stable.
However, if the quantizer gain were to drop by a factor of 1.83 or more, the
-L1(e jW) contour would encircle the critical point twice and the (linear) closed-
loop system would be unstable.
The reader should note that the root-locus, Bode and Nyquist techniques for
assessing the stability of a t1E modulator are all based upon the same linear modu-
lator model. Any of these techniques can be used to compute the range of quantizer
gains over which the linear model is stable, and the results will be identical. Unfor-
tunately, since a ~ modulator is a nonlinear system, the quantizer gain is signal-
dependent and this dependency cannot captured by any linear model.
A more sophisticated (and complicated!) technique for modeling one-bit modula-
tors was suggested by Ardalan and Paulos [10]. They proposed splitting the modu-
lator into two linear loops, one processing the signal and the other one the noise,
with different equivalent quantizer gains. The quantizer gains are nonlinear func-
tions of the modulator's input. The predictions obtained using this model for the
maximum stable input and SNR vs. input characteristics have been found to be
very close to the values obtained by simulation. The quasi-linear model advocated
by Ardalan and Paulos was extended to non-Gaussian probability density functions
by Risbo [11].
In practice, even a very elaborate model cannot predict loop stability with 100%
reliability, and the designer of high-order single-bit modulators must resort to
extensive simulations. As shown in Fig. 3.13, some rapidly varying input signals
can drive a modulator loop into instability, even if their amplitudes are relatively
low. Hence, simulations should be performed using realistic worst-case input sig-
nals. As R. Adams suggests [6, Sec. 5.4], a representative worst-case signal is a
square-wave with the largest permissible amplitude and with a fundamental fre-
quency OJf equal to that of the dominant (highest-Q) pole of the NTF. UsualJy, OJf
is far outside of the signal band of the modulator, and hence this observation sug-
gests that the stability can be improved by analog prefiltering, which prevents such
harmful out-of-band signals from exciting any resonant oscillations in the modula-
tor loop.
-_._------
103

4 Hlgher-Qrder Delta-Sigma Modulation
4.2.2 Multi-Bit Modulators [l2]
For multi-bit modulators, the following theoretical result can be useful:
Consider a modulator with an M-step (I.e. (M+I)-level) quantizer which
has one of the characteristics shown in Fig. 2.3 and 2.4. Let the initial
input y(O) to the quantizer be within its linear (no-overload) range. Then,
the modulator is guaranteed not to experience overload for any input u(n)
such that m;:x lu(n)l,;M+ 2-llhlh, where Ilhll! =L;=olh(n)l. Here,
h(n) is the inversez-transrorm of the noise transfer function H(z).
For example, if M = 16 and H = (I - z-l)3, then IIhlll = 8 and thus any input
with max lu(n)1 < 10 is guaranteed to not overload the modulator, i.e. this modu-
"
lator system is stable for inputs up to 62.5% of the full-scale value 16.
It is easy to use the above rule to establish a more specific condition, namely that
modulators employing ,Nth-order differentiation for the NTF and M = 2N + I
steps in the quantizer are stable for arbitrary inputs at least up to half of the quan-
tizer input range. For an ,Nth-order differentiating NTF,
(4.18)
indicatmg that Ih(n)1 = (-I)"h(n) , and hence, Ilhll l = H(-I) = 2N Thus, the
condition
max lu(n)1 < 2N + 1+ 2 - 2N = 2N + 2 = M/2 + 2 guarantees stabil-
ity. Since theninput range of the quantizer spans -(M + 1) to (M + 1), any input
which is less than half of the quantizer input range is sufficiently small to prevent
quantizer overload.
To prove the above sufficient (but not necessary!) condition, we first calculate the
input y(n) of the quantizer Q (Fig. 4.1). In the z-domain
Y(z) = V(z) - E(z) = STF(z) U(z) + NTF(z)E(z) - E(z)
and hence, assuming that the STF is only a delay of k clock periods,
104
(4.19)

1
StabIlity Considerations In High-Qrder Modulators
yen) = u(n - k) + (h*e)(n) - e(n) = u(n - k) +L h(i)e(n - i)
i = 1
(4.20)
Here, the asterisk (* ) denotes convolution, and we used the condition h(O) = 1.
proven in Section 4.1. To avoid overdriving the quantizer, ly(n)1 $. M + 1 must
hold, as Figs. 2.3 and 2.4 show. Hence. using the worst-case (i.e., largest) values
for the tenns on the RHS of (4.20), the stability condition becomes
max lu(n)1 + max Je(n)1 .[llhll, - 1] =
Ilull~ + IIhll, -1 ,; M + 1 .
(4.21)
n
n
Here we used max le(n)1 = 1 (Figs. 2.3 & 2.4), and h(O) = 1. Thus,
n
max lu(n)1 ,; M + 2 -llhlll
n
guarantees stability, as stated.
As an example, consider the circuit shown in Fig. 4.9. Clearly,
and
(4.22)
(4.23)
(4.24)
Fignre 4.9: An implementatinn of NTF(z) = (1- z-I)N.
105

-
4 Higher-Qrder Delta-Sigma Modulation
where I(z) is the transfer function of the delay-free accumulator:
I
I
j
(4.26)
(4.25)
Z
I(z) = -1'
z-
H(z) =
From the last two equations, it follows that L1 :::: 1 _IN and the NTF is
1
=I-N=(l_z-l)N
l-L I(z)
f,
As shown earlier. for Ihis NTF Ilhlll = H(-I) = 2N
The STF is
G(z) = H(z)Lo(z) = c l
(4.27)
! ','.
! '.,
Hence, max lu(n)1 appears in yen) unchanged.
n
is sufficient to guarantee the stability of the modulator shown in Fig. 4.9. Recalling
that the no-overload range of the quantizer is between -(M + 1) and (M + 1),
clearly the accumulated quantization noise occupies a part (2 N - 1) of the avail-
able range, allowing u(n) to utilize the rest.
From the theorem given above, therefore, the condition
max lu(n)1 ,; M + 2 - 2N
n
(4.28)
Equation (4.28) can be used to find the minimum quantizer resolution M for
higher-order modulators with the structure of Fig. 4.9. If, e.g., M :::: 2N (N-bit
quantizer) is chosen, the remaining range for signals is only 2- Le., only one
LSB! Using N + 1 bits, the signal can be as large as O.5(M + 1) + 1.5, more than
50% of the quantizer range; for N + 2 bits, over 75% of the range can be utilized
for the signal.
106
t

I
I
II;,
~I
i
j
Optimization of the NTF zeros and Poles
Extensive simulations performed for dc, sinusoid and noise input signals [13]
showed that for N ;
5 and M > 25, the condition (4.28) is a very tight one. Thus,
signal levels only slightly higher than the m,\'x lu(n)1 value given by (4.28) could
cause instability. This indicates the practical value of this condition.
In concluding this section, it should be reiterated that while there are impressive
research results available on the stability of high-order delta-sigma modulators,
extensive behavioral simulations are still advisable before implementing them. The
lower the resolution of the quantizer used, the more suspicious the designer should
be about unforeseen instability!
4.3 Optimization of lhe NTF Zeros and Poles
Although most examples used earlier in the text dealt with NTFs of the form
(1 - z-l)N , which had all their zeros at z :;;: 1 and all their poles at z :;;: 0, signif-
icant improvement in the SQNR can be obtained by using more general functions.
These are NTFs with separated zeros on the unit circle, spread over the signal
range, and with complex poles located within the unit circle surrounding the signal
band. Spreading the zeros reduces the total noise power in the signal band, while
moving the poles nearer to the zeros reduces the out-of-band NTF gain, resulting
in improved stability.
Techniques for constructing such NTFs will be discussed next.
4.3.1 NTF Zero Optimization
It was shown in Section 3.4.5 that shifting the two zeros of a second-order NTF
from dc «(0 :;;: 0) to an optimized value equal to coB/Jj resulted in a significant
(3.5 dB) SQNR improvement. It is to be expected that even greater benefits can be
obtained by optimizing the location of the zeros of higher-order NTFs. The princi~
pIe of optimization, however, remains the same: the normalized noise power, given
by the integral of the squared magnitude of the NTF over the signal band, is mini-
mized with respect to the values of all its zeros. The optimal zeros are found by
equating the partial derivatives of the integral to zero.
107

4
Higher-order Delta-Sigma Modulation
-
The resulting values for the zeros (normalized to the signal band limit (l)B) are
given, for NTFs with degrees from 1 to 8, in Table 4.1. Note that the optimization
process giving these zeros assumed that the quantization noise is white, and that
the poles of the NTF have no significant effect on the inband noise. If these condi-
tions do not hold, or if the noise at different frequencies should be weighted differ-
ently as is the case, e.g., for A-weighting of audio signals, then the optimization
may still be performed, by incorporating these factors into the optimization pro-
cess in the fonn of a weight factor under the integral.
As an illustration of the improvements achievable using shifted zeros, Fig. 4.10
compares the frequency responses of two fifth-order NTFs, one with all its zeros at
dc, and the other with optimized zeros. The optimization assumed OSR =32, i.e., a
nonnalized signal band limit equal to 1/64. Fig. 4.11 shows the optimized output
spectrum when the input signal of the single-bit modulator is a half-scale sine-
Table 4.1. Zero placement for OllDlmum Ill-band nOise.
N
zero locations, nonnalized to (r)B
SQNR improvement
I
0
OdB
2
±1/(J'3)
3.5 dB
3
0, ±J3/5
8dB
4
±J3/7± J(3/7)2 - 3/35
13 dB
5
0, ±J5/9± J(5/9)2 - 5/21
18 dB
6
±O.23862, ±O.66121, ±O.93247
23 dB
7
0, ±O.40585, ±0.74153, ±O.94911
28 dB
8
±O.18343, ±O.52553, ±O.79667, ±0.96029
34 dB
. .
108

Optimization of the NTF Zeros and Poles
wave. The SQNR is 84 dB. The Figure also illustrates the responses predicted by
using linear models with quantizer gain k = 1 and with the optimized value
k = 1.72 (the value obtained a posteriori from simulation data according to the
method described in Section 2.1). Once again, note that once the value of the quan-
tizer gain used for analysis accurately reflects the actual quantizer gain, the pre-
dicted PSD matches the observed PSD very well.
o
-20
-40
m
"0
-60
-80
•• ; ••
:.~.:.:_:.~~: ••••
: •••: •• :_.:_:~~~:••• '
•••• J_
· . . , "".
..,
-,
,. ,". "'~'~"""."~'
.
· . , ......
.,
..;...:.. j.! .;.;-:-;.;..... !..
.;. ',"';'" ....:.. ·l· .;-
, . " .....
.
"
.",.
.. -
'.~~""""
._.~ .'.'
'
'.'" -'.
·
., , ,
. . ..,., ,
,
, . ......
.
, , .....
., .
.--.... -.,. ,' ......,.......
. '.' '.' '." ,,,"" -.,..... ,.
"""'"
..
, .....
.-' ..;... ~. ;'1':-:-:-:':"
.' "'--"';'
~ ;~~:
..;. _.: ..>
.~.~.~.~.~.~~..
-41d'B
.
· .",...
.
.
:.;.:::"'::' ····.:ell~(J~:::::::,·
.........
. . , .... "
..... ",' . ," ','.. ~., ..
.... -:- .. ;.
-:..
~-~.
-1 00 L,,--'--~~c!L+-"-~.-'..-'..'-'..-'-..~.~-'--C'--CJ
10-3
10-2
10-1
Normalized Frequency
Figure 4.10: Fifth-order NTFs, with and without optimized zeros.
Figure 4,11:
~mz
"
en
lL
..
m
"
"0
!
iii
i
!---
"
i-
o.---,~---,--"'-.-,,--__,.----,--,,-_.,--.-,
;.~ ~~.:-:-
~ ..:..:. ~.:.::!..
..~ .. ,.
::~ ::::::;:: :~::; 1111:U~~~:;:: :t::!: :L8~~ef.r~~~?~I:t:
........ ~...
:·~~l
·.. ·-·······~·r.~~v;'t..
. .....,
·60
,..•
~:.:.;
;_ ..'.'
,
,.;
:
~ .. ;.
·80 ::::::i:::~::; i:fH?::
;· :~::~::;:~:~i~~i~~~;~eirT
-100 .'''':'' ",': ,'_ ".'."'.
. -- __ ' ..--.' ,"
__ ". --'.' ., .. ,.
...:... ~.. ;
.. ;. ..:.-:. ~.:.;;;.
"., ..: .. j.
·120
~H"'.·""····"
'
'"
.' .,
-140
- ~' ::.L,--:..c'.c".:.:'ILL+----'--·_·.-'.'_--:L.',, ;, :NBW = 5,6x10
10-3
10-2
10-1
Normalized Frequency
Output spectrum ofa 5th·order modulator
with a half-scale input.
109

4 Higher-Order Delta.Slgma Modulation
~I
110
t. Recall that "dBFS" means "dB with respect to a full-scale sine wave."
k=1.00
k = 1.72
Simulated data
o high-frequency input
a low-frequency input
o
80
-..... 1 ••••••• ; ••• :••
...
5)
.,
.. ;.. .:... ;
"t...
.
.
~60
;..........••:
: .
a:
..:::
~
.t:
:
......•...,.(>
.."', ..•.•..•..
Z
;
:
"
.t:
:
:
040 ...:
:- ..:.... -0..••~ ...:... :...:.
00
0
~
.
.
.
.
::T::; ~.~.;~~~~::: i::T::;:::::::
20
.•
•.
.
.
.
.
.
.. jO>••~-.~...~...
~... ~... ~...!...
O.
-.• _ •.-~"..
-100
-80
-60
-40
-20
Input Amplitude (dBFS)
Fig. 4.12 demonstrates the computed SQNR vs. input amplitude curves for the
modulator. Here, the continuous lines show the SQNR predicted by the linear
models, while the diamonds illustrate the simulated values for a high-frequency
input sine-wave, and the squares the simulation results for a low-frequency one (cf.
Fig. 3.8 of Chapter 3). This modulator shows behavior which is less erratic than
the earlier low-order modulators, indicating that modeling the quantizer with a
white noise source of constant power is more valid in a complex high-order system
than it is in a simpler lower-order system. For moderate signal levels (-40 dBFSt
to -5 dBFS), the predicted behavior matches the simulated behavior quite well. At
high signal levels, instability causes the saturation and eventual deterioration of the
SQNR. Lastly, at low signal levels (below an input-frequency-dependent thresh-
old) the character of the spectrum changes abruptly (see Fig. 4.13) and the simu-
lated SQNR is about 7 dB higher than predicted from the linear modeL As
Fig. 4.13 shows, the observed PSD in the low-signal regime is markedly different
from the moderate-signal regime- there is a collection of tones in the vicinity of
/s/4 and a notch at /s/2. Explanation of these new features requires modifica-
tions to OUf simple linear model which are beyond the scope of this text.
Figure 4.12: SQNR vs. input amplitude for the sth.order modulator.

Opt1mlzatlon of the NTF Zeros and Poles
For even-order NTFs, the optimized zeros do not provide perfect de suppression,
since there are no zeros at z = 1. Often such de zeros are desirable in order to
ensure exact reproduction of the de input level, and also to reduce the probability
of low~frequency tones. In such cases, it is possible to place a double zero at
z = 1, and optimize the remaining zeros as before so as to minimize the mean-
square inband gain of the NTF.
I,
\
4.3.2 NTF Pole Optimization
When the poles of the NTF are detennined, a number of constraints must be
observed:
(a)
As discussed in Section 4.1, the overall noise transfer function, H(z),
must satisfy the realizability condition H(oo) = 1.
(b)
The out-of-band NTF gain, the loop gain, and hence the stability of the
whole modulator are largely determined by the choice of the poles.
(The zeros, as explained above, are constrained for efficient noise shap-
ing to the signal-band region of the unit circle.) Hence, the location of
the poles should be at least partially based on stability considerations.
',' .".
f'
r-.· .....·· ..
c.·.·.·.'_
•. >.
,.,
~ ~:~NBW ~ 5.6-;10:'5
10-2
10-1
Normalized Frequency
Output spectrum ofa 5th.order modulator
with a -60 dBFS input.
Figure 4.13:
or-.,---'-"'-'.-"C"'.,,--
I
'
,-, .. '~'"
,
, .. ,-,..
~
"
-.,
.
-20
....,.. ,
)·,·,·,·,,···_·-.···,··;·;·;·:-:·:·~Unearmodel,
s: -40::: ~;)n'-::::r7k~_l~;;
OJ
-..'- . - .'.. , -:-:.;.;- ~ ~ ..•.. ':"'f'~'~'~.·~..E·,~·~"~··~·:~t!··~·l
z
-60
. , ...
'. ;,.' "'. :~~
~
<SImulation' ::::
..... ~-Linear model,
CD
-80
':::::.::::: ~::{;:::::.:
.;:;:;~:~~';:J.-?EL:...;..(
"C -100
... .;_ ...;.. ;.
.;.;
••.•••:••• _; .. J.
•••' •• '.!
-120 .....,.••~~•• v ••~
•I
I
j=Ii•
111

4
Higher..Qrder Delta-Sigma Modulation
(c)
In optimizing the zeros, it was assumed that the influence of the poles
on the magnitude of the NTF in the signal band is minimal. Also, for
many modulator structures, the STF and NTF have the same poles. For
both of these reasons, the denominator of H(z) should have a magni-
tude which is flat over the signal band.
These constraints make the selection of poles a
trade~off between conflicting
design considerations, with no unique general solution. Fortunately, there are soft-
ware tools available to perform this task for the designer. These will be discussed
in Sections 8.1 and 8.2. There is also useful information based on extensive com-
putations using these tools [14]. Figs. 4.144.16 provide some additional design
infonnation. These curves show the achievable peak signal-to-quantization-noise
ratio (SQNR) for modulators of orders N = 1 to 8 employing optimal zero place-
ment, with 1- to 3-bit internal quantization. The curves include the effects of the
reduction of the input u necessary to satisfy the stability conditions. Hence, they
accurately predict the actual performance of the real (nonlinear as opposed to lin-
earized) modulator.
001'--<01.0
II II II "
140
~~~~
N=4 N=3
N=2
120
m
:s- 100
N=1
a:
80
za
60
CfJ
"'"
40
'"
........
8'.
'"
.
. "
-- .. -,'-
. ,
. . . . . . . ...
.....
04
8
16
32
64
128 256 512 1024
GSR
Figure 4.14: Empirical SQNR limit for I-bit modulators of order N.
112
I
=-•,
I
f=
!
--::-
,ii
If'.f
!ii•••
i~
i~•I

;
I
;
"i
=
,-
Optimization of the NTF Zeros and Poles
If the appropriate computer tools are not readily available, a "cookbook" design
methodology, similar to that described in Section 4.4.1 of [6], may be used to find
the complete NTF. It consists of the following steps:
CCf'-,.(OL()
""""
140
««
N=4N=3
N=2
.. '..... ,.
iIi'
120
~ 100
.... N=1
a:
80
za
60
Cf)
-"
.
....'.....
'"
40
.....
8'.
....
- .... ,_ ... ","
20
. ,. . . . - - - . . . , .
.. . . . . . . . . - , .
0
8
16
32
64
OSR
4
128 256 512 1024
Figure 4.15: Empirical SQNR limit for modulators with 2-bit quantizers.
a:n·... CJJLO
II II II II
140
««
N= 4 N= 3
iIi'
120
N=l
~ 100
a:
80
za
60
Cf)
-"
••
,
0-
'"
40
... ,.
8'.
......
20
... ,-
..
0
OSR
4
8
16
32
64
128 256 512 1024
Figure 4.16: Empirical SQNR limit for modulators with 3·bit quantization.
113

i
,
-!-
=:=
.= -
!!!!
""""
•
~
-
(4.29)
(4.30)
1. Choose the order N of the modulator. This can be done based on the specified
SQNR and OSR, using the curves of Pigs. 4.14-4.16.
2. Choose the NTF approximation type. Usual choices are Butterworth, inverse
Chebyshev, or maximally-flat all-pole highpass transfer functions.
3. Place the 3-dB cutoff frequency (i)3dB of the NTF slightly above the edge of the
signal band.
4. Based on the choices made in Steps 1. and 2., find the zeros zi and poles Pj of
the NTE To satisfy Condition (a) given above, the NTF must be in the fonn
N
H(zl =n
Z
-
Z'.
Z-p.
i = 1
I
5. Predict the stability of the modulator. For multi-bit quantization, the main Theo-
rem given in Section 4.2.2 may be used to estimate the pennissibJe input signal
amplitude for guaranteed stability. For single-bit quantization, Lee's Rule can
be utilized. Since, as discussed above, the maximum value of jH(z)! on the unit
circle usually occurs at z :;; -1 (ffi :;; ffi.J2), Lee's Rule requires
Nn
1+ Z.
IH(-lll =
--' < 1.5.
i=II+Pi
(Even if the peak gain occurs elsewhere due to some high-Q poles, its value is
usually close to IH(-I)I.)
________________________ I~~
4
Higher-Order Delta-Sigma Modulation
_~
IU
U
--
'i •
I;;;
I-
iI
i
~ iii
-
114
6. Confirm the stability estimation with extensive simulations under all practical
conditions.
7. If the predicted stability is unsatisfactory, the poles need to be shifted away
from the z :;; -1 point, while maintaining the flat gain in the signal band. This
can be achieved by reducing the cutoff frequency (J)3dB' As shown in [14], this
reduces the peak NTF gain and hence enhances the stability of the modulator.
8. If the stability is robust, but the SQNR does not reach the limit values predict-
able from Figs. 4. J4-4.16, it may be beneficial to make the design more aggres-
sive by increasing ffi3dB ' and then repeating the stability tests. Steps 6. to 8. can
be iterated until the optimum condition (maximum SQNR WIth adequate stabil-
ity) is approached.
--~---

i
Loop Filter Architectures
f
I
(
4.4 Loop Filler Architectures
In this Section, some basic configurations will be described for the implementation
of the loop filter of Fig. 4.1. Some of these can be considered as the straightfor-
ward generalization of the second-order modulator MOD2 discussed in Chapter 3;
others are different. Their advantages and disadvantages will also be discussed.
[4](5](6. Sec. 5.6](15].
4.4.1 Loop Filters with Distributed Feedback and Input Coupling- The CIFB and
CRFB Structures
The circuit containing cascaded integrators with distributed feedback as well as
distributed input coupling (eIFB), shown in Fig. 4.17, is an extension of that
shown earlier in Fig. 3.15. It contains a cascade of N delaying integrators, with the
feedback signal as well as the input signal being fed to each integrator input tenni~
nal with different weight factors Qi and hi. By inspection, the transfer function of
the signal filter Lo is now given by
u--,r----.-----..----~---_,
Q
1
z-1
1
z=l
1
z=l
L----.:L----.:L----.:L--'=r:;'v
Figure 4.17: Cascade of 4 integrators with distributed feedback and
distributed coupling (CIFB structure).
j
1t
--------
115

4 Higher-Order Delta-Sigma Modulation
II•
while the feedback filter L 1 has the transfer function
(4.31)
•
JI
j--
I
I,
a l +a2(z-I)+ ... +aN(z-l)N-I
(z _l)N
(4.32)
where aI' b1>0. By (4.4), the NTF for this circuit is of the form
(z - 1)N
D(z)
where
(4.33)
(4.34)
Thus, all zeros of the NTF of this structure must lie at z = 1 (de). Note that the
realizability condition H(oo) = 1 is satisfied by H(z) , as it must be for a physical
structure.
The weight factors ai can be used to introduce finite nonzero poles into the NTF,
and also to determine the zeros of LI(z). The a j can be found by comparing D(z)
to the denominator of the desired NTF, and equating the coefficients of like powers
of z. (Or, preferably, of (z - I) !)
The STF is, also by (4.4),
G(z) =
116
=
bl + b2(z-l) + ... + bN + I(Z-I)N
D(z)
(4.35)
I,
I
j

I
I;-
Loop FIlt8f' Architectures
where D(z) is given in (4.34). This indicates that the hi dctcnnine the zeros of the
STF, and the a j its poles. As explained before, the bi can be found by coefficient
matching with the numerator of the specified STF. The poles of the STF and the
NTF are shared.
=•
It is usually necessary to choose nonzero values for all ai to realize the prescribed
poles suitable for stable operation. There is some latitude, however, in choosing
the zeros of the STF, and hence the bi' To simplify the circuit, all hi except b I can
be chosen as zero. Then all zeros of the STF lie at infinity in the z plane, and the
signal transfer function is detennined by b1/D(z). In this case, ID(eJffi)[ should
be flat in the signal band, to make ISTFI constant there.
Another interesting choice is bi = a j for all i~N and bN + I = 1 [15]. Then, by
(4.35), the STP is exactly 1, and hence the output of the modulator is
I
V(z) = V(z) + H(2)£(Z).
(4.36)
Hence, the input signal to the ith integrator is, from Fig. 4.18 with bi = ai'
(4.37)
117
Xi
1
z-1
Xi-1
V
Figure 4.18:
Input signals to the ;th integrator.
I
j

Thus, the input signal u(n) is not present in any integrator input signal. The loop
filter only processes the quantization noise e(n). This usually results in reduced
op-amp output swings, especially for multi-bit quantizers.
HT
------4-H--gh-e-'-o-"'-e'-D-e~I..-.S~,-gm-a-M:-od~U~,a~t1o-n-----------------t.!I
i !
Fe"
, i •
, -
'..
~.•-•
As discussed in Section 3.4.2, not having to process u(n) in the loop filter has sev-
eral advantages. One is that the unavoidable nonlinearities of the integrators will
not introduce harmonic distortion into the output signal. The other is that, in the
absence of u(n), the integrator outputs are considerably reduced, especially if a
multi-bit quantizer is used. Thus, this circuit needs less extensive dynamic range
scalingt and hence has more convenient element values, than other CIFB struc-
tures, such as the one with bj
;:: 0 for i> 1.
As (4.33) indicated, the structure of Fig. 4.17 can realize NTF zeros only at de
(z ;:: 1). We have already seen that much better SQNR perfonnance may achieved
if these zeros are located at nonzero frequencies on the unit circle. This requires a
modification of the CIFB architecture, as indicated in Fig. 4.19. The circuit shown
u--;~---....----~----_---___,
1
z-1
Q
L--L--L--L----'=r::;·v
Figure 4.19: Cascade of resonators with distributed feedback
and inpnt (CRFB strnctnre).
t. Scaling will be discussed in Sechon 8.3.
us
r
=
•

Loop Filter Architectures
there is capable of realizing four NTF zeros as two conjugate complex pairs on the
unit circle. The first and second integrators, together with the feedback path -gI '
form
a
resonator
with
two
complex
poles
which
are
the
zeros
of
z2 - (2 - g 1)z + 1. These poles will be on the unit circle at frequencies ±co I
which satisfy cos(O, = 1 - g 1/2. Similarly, the third and fourth integrators, with
feedback branch
~g2' fonn a resonator giving rise to poles at ±(O2 such that
COS0)2 = 1-!f.2./2. For the usual case when the normalized pole frequency
ffij« I, (OJ = Jgj is a good approximation. This configuration will be called a cas-
cade ofresonators with distributedfeedback (CRFB) structure.
One of the integrators in each resonator (here, the first and third integrators) needs
to be a delay-free one to insure that the poles stay on the unit circle.
The transfer functions ofthe resonators can easily be found. For the first resonator,
the transfer function from V to X2 is
Q\z+a2(z-l)
z2_(2-gl )z+(
(4.38)
(4.39)
Note that if the order N is odd, a plain integrator is also needed in the loop filter. In
this case, it is customary to make the integrator the input stage in order to minimize
the input-referred contribution of noise sources from subsequent stages.
For high-frequency (wideband) ADCs realized using switched-capacitor (SC) inte-
grators, it is advantageous to have a delay associated with every integrator, since
this reduces the speed requirements ofthe amplifiers used. In such situations, both
integrator blocks in the resonator have transfer functions 1/(z - I). The transfer
function of the first resonator then becomes
X 2(z)I
at +a2(z-l)
RI(z) ~
V(z)
~
2
.
U(z) " 0
z -2z+ (I + gIl
The poles are now outside the unit circle, at z = 1+jji;. For ooj«I, coj=Ii
gives again a good approximation.
119

4 Higher-Order Delta-Sigma Modulation
j'=-
=
The resonators by themselves are unstable, as can be inferred from their pole loca-
tions. However, they are embedded in a stab~e feedback system, which prevents
local oscillations.
In designing the CRFB circuit, the values of the gi can immediately be determined
from the (Oi as shown above. The rest of the parameters (the a i and bi) can readily
be found by calculating Lo(z) and LI(z), first from the specified STF and NTF,
then in terms of the a j , hi and gj from the circuit diagram, and matching the coef-
ficients of like powers of z. A less laborious way is to use the software tools
described later in Chapter 8.
To illustrate the analysis of the circuit of Fig. 4.19, we shall express L 1(z) in terms
of the resonator transfer functions R t(z), given by (4.38), and R2(z) , given by
a3z + "4(2 -1)
22-(2- 82)2+ I'
If U(2) = 0, then, from Fig. 4.19,
(4.40)
i-
,..
~'i
i
and thus
The expression for Lo(z) is the negative of the above, with the bi replacing the a i
in R 1(z) and R2(z) , and with bs added as a constant term.
120
,I !!
I
i
•

Loop Filter Architectures
4.4.2 Loop Filters with Distributed Feedforward and Input Coupling- The CIFF
and CRFF Structures
The transfer functions Lo(z) and L1(z) discussed in Section 4.1 can also be real-
ized by using feedforward, rather than feedback, signal paths to create the zeros of
the NTF.
A circuit constructed from cascaded integrators and feedforward
branches is shown in Fig. 4.20. By inspection, the transfer function of the feedback
filter is
(4.43)
where I(z) = 1/(z -1) is the delaying integrator's transfer function. Similarly,
the signal filter function is
u--r-----.----~p-----___._----.,
1
z-1
'-----------.c+~------'
Q
L---------=::r:::-
v
Figure 4.20: Chain of integrators with weighted feedforward
summation (CIFF structure).
121

'!!!
...........
....
4 Higher-Order Delta-Sigma Modulation
------------------------~
Lo(z) = bl '(011+0212+ ... +0NIN)+b2 ·(a21+ ... +aNIN-I)
+b3 · (°31+ ... +oN1N - 2) + ... +bN + I
(4.44)
Consider next the case when b1 = b3 = .. , = bN = 0 and b1 = bN + 1 = 1.
Then, from (4.43) and (4.44), Lo(z) = 1- L,(z) holds, and hence from (4.4) it
follows Ihal STF(z) = 1. Hence, Ihe input to the loop filter satisfies
Thus, the loop filter does not process the input signal u(n), and hence this configu-
ration has the low-distortion property discussed earlier for the distributed feedback
structures.
U(z) - V(z) = U(z) - [U(z) + H(z)E(z)] = -H(z)E(z)
(4.45)
, =
As (4.43) shows, all N poles of Lj(z) lie at de (z = I) for the slmcture of
Fig. 4.20. Hence, so do all zeros of ll(z). To obtain optimized zeros for H(z), res-
onators must be created by internal feedback within the loop filter. The resulting
structure is illustrated in Fig. 4.21, where for simplicity only the first and last input
weight factors were included, to obtain the low-distortion structure. The analysis
of this system is left for the reader, as an exercise.
4,5 Multi-Stage Modulators
For low OSR values, as Figs. 4.14-4.16 illustrate, it is no longer possible to obtain
high SQNR values in a single-quantizer modulator simply by raising the order of
the loop filter, since stability considerations limit the pennissible input signal
amplitude for higher-order loops, which counteracts the improved noise suppres-
sion. The SQNR can still be increased by using more bits in the internal quantizer,
but this requires a flash ADC and also means to insure the in-band linearity of the
internal DAC, as will be discussed in Section 6.4. As a result, the complexity of the
quantizer grows exponentially with the number of bits used in it. Hence, this num-
ber can seldom be higher than 4 or 5 bits.
A different strategy, which relies on the cancellation rather than the filtering of the
quantization noise, is to use a multi-stage (also called cascade) structure for the
122
=
-!
~•
~•,i•
i
Ii••
1l! =
, •
•

Multi-Stage Modulators
modulator. This section is devoted to a discussIOn of this useful modulator topol-
ogy.
4.5.1 The Leslie-Singh (L-O Cascade) Structure [16J
A simple two-stage delta-sigma ADC is illustrated in Fig. 4.22. 1t contains an L th_
order delta-sigma modulator as its first stage, and a static (i.e., zero-order) ADC as
its second stage. The outputs of the two stages, vI and v2, are digitally filtered and
combined to obtain the overall output v.
As shown, the quantization error eI(n) of the input stage is extracted in analog
form by subtracting the input signal Yt of the internal quantizer from its output VI'
The error el is then converted into digital fonn by a multi-bit (say, lO-bit) ADC
which forms the second stage of the modulator, This introduces another quantiza-
tion error e2(n) , which however can be much smaller than e1(n), since the second-
stage ADC (not being in a feedback loop) is allowed to have arbitrary latency, and
hence it can be realized as a low-complexity multi-bit pipeline structure.
U-T"--------------------,
1
I'-X'-'j'r-I
1
~x+-<
z-l
z- 1
Q
L----------'=:r:=-----..v
Figure 4.21: Chain of integrators with feedforward summation
and local resonator feedbacks (modified CIFF structure).
----------------
123
J
j

4 Higher-Order Delta-Sigma Modulation
Next, the outputs vI and v2 of the two stages are filtered by the digital stages HI
and H 2 , respectively, and added. Usually, H l(z)
:= C k simply implements a
delay which equals the latency of the second-stage ADC, while H2 is chosen as
the digital equivalent of the NTF of the first stage. Then, subtracting the output of
H2 from that of H I produces the output
V(z) = ElI(z)· V I(z)-H2(z)· V2(z)
= c k . [STF I(z) . U(z) + NTF I(Z) . E l(z)]- NTF I(Z)· c k . [E I(Z) + Ez<z)]
= c k . [STF I(Z) . U(z) - NTF 1(z) . E2(z)]
(4.46)
Comparing the output V(z) with the first-stage output V l(z), it is clear that (apart
from the delay of k clock periods) the difference is that E1(z) is replaced by
-E2(z) in V(z). As explained above, E2(z) may be much smaller than E 1(z) since
it is much cheaper to construct a
multi~bit pipeline ADC than a multi-bit loop
quantizer for the first stage. Hence, this technique can enhance the SQNR by as
much as 25-30 dB.
-,
J!
~
1•
U---lLo
Loop
Filter
L,
E,
Q
v,
v
ADC
V2
Figure 4.22: The L-O cascade (Leslie-Singh) structure.
124
-
:•

1'I
1II
Multi-Stage Modulators
To obtain et(n) by simple subtraction, the operation of the quantizer must be
delay-free, which may not be practical. In this case, the signal y 1 must be delayed
before the subtraction is carried out.
To avoid the subtraction altogether, the input signal of the second stage can be cho-
sen as Yl(n), the input signal of the first-stage ADC, instead of el(n). It is given
by
(4.47)
Keeping
HI (z) = z-k,
but
choosing
the
other
filter
function
as
H 2(z) = NTFl(z)/[NTF l(z) - l],t the overall output now becomes
V(z) = z-k. [STF l(z) . U(z) + NTFl(z) . E t(z)]
(4.48)
NTFj(z)
NTFj(z)-l . C k . {STFt(z)' V(z) + [NTFt(z)-lj· Ej(z)+E,(z)}
so, assuming ideal cancellation of like tenns,
(4.49)
results. In the signal band, INTFd« 1, and hence the SQNR obtained with the
new V(z) is very close to the one obtainable with the V(z) given in (4.46). A dis-
advantage of using yI(n) as the input to the second stage is that it contains u(n) as
well eI(n) • and hence the second stage must be able to handle a larger input signal.
Also, the second stage must have low distortion. to avoid generating harmonics of
urn).
Consider next onc of thc low-distortion structures discussed in Section 4.4 used as
the first stage. Assume, e.g., that in thc CIFB modulator of Fig. 4.17 the conditions
t.
H 2(z), as written, is non-causal. MultIplying H 2(t) and HI(z) by z-l yields a realizable pair of
filters and preserves the desired noise cancellation.
125

4 Higher-Order Delta-Sigma Modulation
bj = ai for all i '5 Nand bN+ 1 = 1 hold. Then STF(z) = 1, and the output sig-
nal of the last integrator is
XN(z) = y(z) - bN · U(z) = STF(z)· U(z) - [I - NTF(z)] . E(z) - bN' U(z)
= -[ 1- NTF(z) I . E(z)
(4.50)
This signal can be used as the input signal of the second-stage ADC. It does not
contain u(n), and hence the second stage has a smaller input signal, and need not
be very linear.
It can easily be seen that similar conclusions apply to the other low-distortion
structures: it is possible to extract YI(n) - u(n) =:: e(n), and use it as the input to the
second stage. As an example, Fig. 4.23 shows a second-order low-distortion CIFF
modulator. Simple analysis shows that its noise transfer function is (1 - C 1)2, its
signal transfer function is 1, and the output signal of its second integrator is
X2(z) = _z-2E I . Hence, X2(z) can be used directly as the input to the second
stage of the structure.
I
~•;
I
~-
1 -
~
I
-
I·
-
,
i ,·,
•
- ,
1
z-1
Q h-_V
2,>-1-...J
X2
Figure 4.23: Low·distortion CIFF modulator used as first
MASH stage.
126
l,
I:
,
-
1
~
.~, .
I
•
1 I ii
I·i
Ij -

iIi"'.'I
Multi-Stage Modulators
4.5.2 Cascade (MASH) Modulators
An obvious extension of the Leslie-Singh modulator, which historically preceded
it, is the cascade modulator, also called multi-stage or MASH (for Multi-stAge
noise-SHaping) modulator [17-19]. Here, the second stage is realized by another
delta-sigma modulator. The basic concept is illustrated in Fig. 4.24. The output
signal of the first stage is given by
where STF I and NTF I are the signal and noise transfer functions, respectively, of
the first stage.
As shown in Fig. 4.24, the quantization error e1 of the input stage is found in ana-
log fonn by subtracting the input to its internal quantizer from its output. It is then
fed to another ~L loop forming the second stage of the modulator, and converted
into digital fonn. Hence, the output signal of the second stage in the z-domain is
given by
•i
i
I
=
=
u
LO
~E,
a
H,
,+
r
L
,
Y,
V,
-
+'
E,
~E2
'--+ Lo'
a
V2
H2
r
L,
(4.51)
v
Figure 4.24: A two-stage MASH structure.
127

4
Higher-Qrder Delta-Sigma Modulation
(4.52)
where STF2 and NTF2 are the signal and noise transfer functions, respectively, of
the second stage. The digital filter stages H I and H 2 at the outputs of the two
modulator loops are designed such that in the overall output V(z) of the system the
first-stage error E1(z) is cancelled. By (4.51) and (4.52), this is achieved if the
condition
---
;;;-I
iii;;
(4.53)
holds. The simplest (and usually most practical) choice for HI and H2 which sat-
isfies (4.53) is HI = STF2 and H2 = NTF 1. Since STF2 is often just a delay,
H I is then easily realized.
The overall output is given by
In a typical case, both stages of the MASH may contain a second-order loop, and
their transfer functions may be given by
STF,(Z) = STF2(z) = C 2 and NTF,(z) = NTF2(z) = (l-z-')2
Then, the overall output will be
(4.54)
(4.55)
(4.56)
--
!!"••••
'"
~
i i -
~
Thus, the noise-shaping perfonnance is that of a fourth-order single-loop con-
verter, while the stability is that of a second-order one, since both internal feedback
loops are of order 2.t
t. In practIce, the E[ mput 10 the second modulator stage needs to be scaled to fit within the stable
mput range. For a second-order, single-bit first stage, the usual scaling factor is l/4. If multi-bit
quantization is used in the first stage, the scaling factor can be greater than 1. The Inverse of this
scaling factor needs to be included in H2 m order to -cancel E].
128
;•
!!!
-
=;
~-

Multl.Stage Modulators
If the condition (4.53) is not exactly satisfied due to imperfections in the realiza-
tion of the analog transfer functions, then EI will appear at the output multiplied
by STF2 · NTF1a-NTF 1· STF2a , where subscript "a" denotes the actual value
of the analog transfer function. As will be shown in Section 4.5.3, this may result
in a serious deterioration of the noise perfonnance of the converter.
II"i
As discussed in the preceding section, it is advantageous for MASH systems as
well to use a low-distortion loop filter structure in all stages. This makes it possible
to obtain the first-stage error elen) without any subtraction, for entering it into the
second stage. In addition, of course, the low-distortion property improves the per-
formance of both stages.
An advantage of the MASH configuration is that the remaining error in the output
V is the shaped quantization error e2(n) of the second stage, operating with an
input e1(n) which is itself noise-like. Hence, the second-stage quantization error
ein) is very similar to a true white noise. This remains valid even if the first stage
noise contains tones. As an illustration, Fig. 4.25 shows the simulated output spec~
129
-, ....' .. -;..
• ,j
.
'. "'.
:
- ..;.. '.- .
._. :~ :: ~ PS~D~tV1J':
..•.
;,;- PSDofV
.. ,. . ... '.'.. '.'
,
'.' . '.'
.... -101 dBc -; : -;-: :-;.
.
•••• ••••
.'. ••' •• '•• < .'.' '-'
.. .• . .. •..
',' '"NBW =1.1 xW5
. ",
---
.
'.' '.',";
.,..,.... ,... '1-._-,
10-2
10-1
Normalized Frequency
Output spectra for a 2-2 MASH modulator.
•• , •• J •••• _'__,_,_, ,.
... ,
.'
. ..
...
. '::: ~::: ;'3fd 'harmonlc @'~4'dBC"
·::.Ht<
.~::;;;.2·'·:·::·~·"'.4"""
•• '••• 1
.,
.... ' ••' ••_,
.....:
......,.
Figure 4.25:
o
-20
-120
-140
-160 '--~-'----""'l:
10'"
;;:
-40
lD
-BO
~
-80
lD
"0 -100
I..•i-

4 Higher-Order Delta-Sigma Modulation
Ira of the input stage (V t) and the overall modulator (V) for a 2-2 MASH with
!. single-bit quantization. V 1 contains 3rd hannonic near f
;;:;; 0.01 which is greatly
reduced in V. Thus, a MASH modulator is less likely to need dithering than a sin-
gle-stage one.
Another useful property of the MASH structure is that it often allows the use of a
multi-bit quantizer in the second stage, without any dynamic or other correction of
the DAC nonlinearity [20]. This is true since the nonlinearity error of the sccond-
stage DAC (as part of V2) is multiplied by ~H2(z) before being added into the
output signal V. As shown above, Hlz) contains the NTF of the first stage. Since
this NTF l(Z) is a highpass filter function, the nonlinearity error of the second-
stage DAC is suppressed in the baseband.
=•
-=
i
•=
•
··
Also, since the input to the second stage contains the quantization error el of the
,first stage rather than the input signal, no harmonic distortion of the signal is gen-
erated in the second stage, and (especially for high OSR and small nonlinearity
error) the small added noise due to the DAC nonlinearity is usually tolerable.
The principle of quantization error cancellation implemented by the two-stage
MASH structure of Fig. 4.24 can be extended. Just as the second stage of the
MASH is used to cancel the quantization error e1(n) of the first stage, a third stage
can be added to cancel
e2(n) , the quantization error of the second stage
(Fig. 4.26). The cancellation conditions can be found exactly as for the two-stage
MASH_ They are
H r -NTF t -H2 -STF2 = 0
H2 -NTF2-H3 -STF3 = 0
(4.57)
•,•••
I
i
Under these conditions, E I and E2 are cancelled in the overall output signal:
V = [STFr-U+NTFt-Erl-Hr-[STF2-Et+NTF2-E2J-H2
+ rSTF3 -E2+ NTF3 -E31- H3
= STFr -Hr - U + NTF3 - H3 - E3
130
(4_58)
Il i

Multi-Stage Modulators
Using (4.57) to express H3' V can be written as
_
..
(H I ·NTFI ·NTF2 ·NTF3].
V - STFI
HI
U+
STF
STF
£3
2'
3
(4.59)
I•:i
<!!
As discussed earlier, HI and the signal transfer functions usually contain only
simple delays, or have flat gain in the signal band, and hence they will not shape
either the signal or the noise significantly. However, the NTFs provide suppression
over the baseband. Hence, under ideal conditions, the quantization errors of the
first two stages are cancelled, while that of the third stage is filtered by the product
of the NTFs of all three stages. Thus, if all three stages contain, e.g., second-order
loop filters, the overall NTF of the structure will be equivalent to that of a siXlh-
order modulator, but without the troublesome stability problems inherent in such a
high-order loop.
Since the three-stage MASH is normally used only when it is necessary to provide
very high SQNR performance, the leakage of the poorly filtered quantization noise
of the first stage due to imperfect matching between the analog lransfer functions
Figure 4.26: A 3-slage MASH ADC.
I
=•;;•-I
•i'
"'I
i I
U
<'>1: ADC
V,
#1
E,
<'>LADC
II
#2
E2
<'>LADC
II
#3
H,
V
131

4 Higher-Qrder Delta-Sigma Modulation
(NTF 1,2,3' STF 1,2,3) and the digital oneS (81,2 3) is a very critical issue here,
and typically limits the practically achievable resolution.
The topic of noise leakage will be discussed in the next section.
4.5.3 Noise Leakage in Cascade Modulators
In higher-order single-stage modulators, the imperfect matching of the passive
loop filter elements (usually capacitors) and the finite gain of the active ones (usu-
ally op amps) will change the coefficients of the NTF and STF, but will usually not
affect the SQNR perfonnance significantly, This is because the quantization error
is suppressed by filtering, and as long as the gain L1 of the loop filter remains suf-
ficiently large in the signal band, INTFI = (l/ILtI)« I will continue to hold
there. It can easily be shown, e.g., that for op-amp gains as low as OSR/n the
SQNR decreases by only a few decibels from its ideal value for high-order single-
stage ADCs.
In a two-stage MASH structure, by contrast, a large SQNR is achieved by accurate
cancellation of the first-stage quantization error el' which is shaped only by a low-
order NTFl' As (4.57) shows, this requires accurate matchmg between the nomi-
nally identical mixed-signal (analog and digital) transfer functions HI' NTF I and
1I2' STF2' For the designer, it is important to know how precise the analog circuit
needs to be to obtain good performance for the cascade, i.e. how accurately the
components need to be matched, what is the minimum acceptable gain for the op
amps, etc., in order to keep the leakage of e 1 acceptably low. For a three-stage
MASH, the leakage of e2 also needs to be analyzed. Even for relatively simple
structures, the equations describing the leakage can become very complex.
As usual for delta-sigma modulators, accurate behavioral simulation is the most
reliable technique for predicting the effects of all nonidealities on the SQNR of a
MASH modulator. However, under some (usually valid) conditions, valuable and
simple results can be obtained using linear analysis and approximations, as will be
shown next.
Referring back to (4.58), the transfer functions from Eland £2 to the overall out-
put V are
132
"
-
!•,
J,
I ,
I
-
•
.Ii,••·•• -
I•!I
i·•
"·•
~=·
Iii-•i••
i=IL
'9.

Multi-Stage Modulators
~~~~~~~-~-
Eq. (4.62) is much simpler to evaluate than the complete original relations (4.58)
or (4.60). It can be used for both two- and three-stage MASH modulators.
(4.60)
(4.62)
H ll = H j
• NTF j -H2 • STF2
H l2 = H 2 ·NTF2-H3 ·STF3
respectively. Ideally, both of these "leakage" transfer functions are identically zero,
but since the NTF and STF functions are realized using imperfect analog compo-
nents, they will be inaccurate. Hence, H II and H 12 will be nonzero, allowing E1
and £2 to leak into V. We can usually justify the following simplifying assump-
tions:
1. The leakage of £2 is less important than that of E 1 . This is true since the tenns
in II /2 represent higher-order noise shaping than those in H [1 . As an example,
in a 2-2-1 MASH, the noise-shaping due to H 11 is at most of order 2, while that
of HJ2 is of order 4. Also, often £2 is smaller than E1 if a multi-bit seconct-
stage quantizer is used.
2. In H il ' the effect of an imperfect NTF1 dominates that of the imperfect STF2'
even though the gain error is the same for both. This holds since the second
stage is followed by the noise-shaping block H 2 = NTF I . Hence, error signals
due to imperfect STF2 are inherently noise shaped. This is not true for errors
due to the imperfect NTF l' since the HI block has umty gain in the signal
band.
3. In view of assumption 2, we may set STF2 = H 1 ::: I in (4.60), as a first
approximation. Then
Will ~ INTF j - H 21 = INTF la - NTF1,1
(4.61)
results, where the subscripts "a" and "i" denote actual and ideal functions,
respectively.
4. From (4.4). NTF j = I/(l-L j ). where L1 is the gain of the loop filler from
the quantizer output to its input (Fig. 4.1). Assuming only small errors,
jLtI »1 holds for both the ideal and actual functions. Then, (4.61) can be fur-
ther approximated by
-
~·•
I
i
!!!
~=•
I
••!
i
!
!
~••Ii
".,
iiII
I
~~--~-"~-~
133

4
Higher-Order Delta-Sigma Modulation
As an illustration, consider the simple case of a I-lor 1-1-1 MASH modulator.
The loop filter for the first stage is just a delaying integrator, with an ideal transfer
function
•i-
~•
•
(4.64)
(4.63)
a'
la(z) = --"
z-P
where, as a simple analysis shows, for D« 1 and a/A« 1,
I(z) = _a_
J
z- 1
If the integrator is, as usual, realized using SWitched-capacitor (SC) circuitry, such
as shown in Fig. 4.27, then an error D in the nominal capacitance ratio (C1/ C2)
will change the factor a, and the finite dc gain A of the op amp will change both a
and the value of the pole (ideally at p = 1). The resulting actual transfer function
is
a' =al t - D - (l + a)1A]
(4.65)
and
p' =I-alA.
(4.66)
Since here LI(z) = -/(z), by (4.62),
;;•
w
=
uo---Y2.r:-r~2
tzJt _+
V
Figure 4.27: A delaying switched-capacitor integrator as used in
a first~order Ll~ modulator.
._-----~- ---~~~._---
134
•"!
i;=
I•
1=
i•

Multl.Stage Modulators
IHIII = I(z - 1)1a - (z - p')/(a')1
~ Il/a'I'I(alA)+(z-l)· [D+ (I +a)1All
~ 1(11A)+ (z-I)· [Dla+ (I + l/a)1All
(4.67)
As (4.67) shows, there is an unfiltered leakage component approximately equal to
E1/A,
and
a
first-order-filtered
component
given
approximately
by
(z - I) . [DIa + (I + 1/a)1AlEI' For high specified SQNR, a very-high-gain op
amp with excellent settling is required to reduce the unfiltered leakage to a suffi-
ciently low level. If the OSR is low, then the second component will also be signif-
icant, requiring D « I . Hence, the matching accuracy of the capacitors must also
bc very high.
Errors in the path coupling the first and second stages will also add to H 1I . E I .
However, their effects on the output V will be at least first-order filtered, since
error signal will pass through the H2 filter.
For a second-order first stage, the leakage of E I can be reduced. The calculations,
however, become much more complicated. Consider, e.g., the 2-0 MASH (Leslie-
Singh) modulator (Fig. 4.22), with the ideal output given in (4.46). Assume that
the first stage is realized by the low-distortion modulator structure shown in
Fig. 4.23, built from two cascaded integrators. The ideal transfer functions of the
integrators are given by (4.63) and their actual transfer functions by (4.64)-(4.66).
As a result of these changes, and the inaccuracies in the other coefficients bj in the
loop, there will be leakage of the first-stage quantization error E 1 to the output V
of the overall ADC system. It is useful to represent the parasitic leakage transfer
function by its Taylor-series expansion around z = 1 [21]:
(4.68)
where, assuming A:» 1 and D« 1 , the coefficient values are
135

i
4 Higher-Order Delta-Sigma Modulation
-
----~:-:-:-:-~~~----------
AO = [/A2
Al = [lla l + 1/a2l1A
A2 = lI(ajOa2)-1+2[1-II(ajOa2)-lIaillA+2DI(ajoaZ)
(4069)
The first term in the series expansion of Hf1 represents unfiltered leakage. Since it
is inversely proportional to A2 , it is usually very small. The second term gives the
linearly filtered error leakage, the third the quadratically filtered leakage, etc. For
OSR» 1, op-amp gains and matching errors. the linear and quadratic terms con-
taining A1 and A2 tend to dominate HJl ' since Ao is normally very small, and
since higher-order filtering suppresses the terms beyond the quadratic one.
•
··
The derivation given above ignored leakage due to the errors in the coupling
branch and in the second stage. In this case, these errors contribute only to the qua-
dratic and higher-order terms (A 2 , A3 , etc.), since H 2 is here a second-order
highpass filter.
As an illustration, for A ;;; 1000 and D ;;; 0.5%, we find that Ao ;:;; 10-6 and
the values of coefficients A I -A4 are between 0.001 and 0.2. The multipliers
(l - C1)L introduce highpass filtering into the terms in HII ' which reduces their
effects on the inband noise. The reduction increases rapidly with increasing Land
OSR. For, e.g., an OSR ;:;; 64, the linear term (L ;:;; 1) is reduced by about a fac-
tor 1/30, the quadratic term by about 111000, and the cubic one by about 1/30,000.
Hence, only the first three terms are significant.
4.6 Conclusions
In this chapter, higher-order modulators were discussed. Special attention was
devoted to the stability of high-order delta-sigma loops, both with single-bit and
with multi-bit quantizers. For single-bit loops. the equivalent gain of the quantizer
varies strongly with the value of its input, so that linearized stability analysts
becomes a difficult task. The stability of the loop may be established using root
locus techniques which examine the pole locations for all possible quantizer gains,
-=
iii=--
~=
~
~
-I ...-
•
~
i -
I IIi
136
=

II
~"
=
:
iI
iii,
"ii
-
:=
Conclusions
or by extensive simulation. For multi-bit loops, the quantizer's gain varies only
slightly with its input signal, and hence tight theoretical bounds can be found for
the signal range which insure stable loop operation.
The optimization of the noise transfer function zeros and poles, already discussed
for second-order loops in Chapter 3, was generalized here for higher·order modu-
lators.
The most commonly used loop architectures were also described, analyzed and
compared for single-stage modulators. Finally, multi-stage (cascade, MASH) mod-
ulators were discussed, and their advantages and drawbacks relative to the single-
stage ones analyzed.
References
flJ
W.L. Lee, "A novel higher order interpolative modulator topology for high resolution
ovcrsamphng NO converters:' Master's Thesis. Massachusetts Institute of Technology,
Cambndge, MA. June 1987.
[2]
D.R. Weiland. B.P. Del Signore, EJ. Swanson, T. Tanaka, K. Hama,shita, S. Hara. and K.
Takasuka, "Stereo 16~bit delta-sigma AID converter for digital audio," Journal a/the Audio
Engineering Society, vol. 37, pp. 476-486, June 1989.
[3]
R.w. Adams, PP. Fergw,on, A. Ganesan. S. Vmcelette. A. Volpe and R. Libert, "Theory and
practical implementatIOn of a fifth-order sigma-delta AI D converter," Journal a/the Audio
Engmeering SOCiety, vol. 39, pp. 515-528, July 1991.
[4]
J.
Steensgaard.
"High-Performance
Data
Converters,"
Ph.D.
dissertation,
Technical
University of Denmark, Dept. of Information Technology, pp. 170-171, March 8, 1999.
[5]
J. Silva, U. Moon, J. Stcensgaard and G.C. Ternes, "Wideband low-distortion delta-sigma
ADC topology," lEE Electronic Letters. vol. 37, no. 12, pp. 737-738, June 7, 2001.
t61
S,R. Norsworthy, R. Setueier and G.C. Ternes, Delta-Sigma Data Converters2, IEEE Press,
1997,
[71
K.C.H. Chao, S. Nadeem, w.L. Lee. and e.G. Sodini, "A higher order topology for
mterpolatlve modulators for oversampling AID conversion," IEEE Transactions on Circuits
and Systems. vol. 37, pp. 309-318, March 1990.
[8]
T. Ritoniemi, T. Karema and H. Tenhunen, "The design of stable high order I-bit sigrna-
delta modulators," Proceedlllgs a/the 1990 IEEE Internatiollal Symposium all Circuits and
Systems, vol. 4, pp. 3267-3270. May 1990.
[9]
H. Kwakernaak and R. Sivan, Modern Signals and Systems, pp. 682, Prentice Hall,
Englewood Cliffs, NJ, 1991.
110j
S.H. Ardalan and J.J. Paulos. "Analysis of nonlinear behaVior in delta-Sigma modulators."
IEEE Transactions all CircuItS and Systems, vol. 34, pp. 593- 603. June 1987.
137

4
Higher-Order Delta-Sigma Modulation
[11)
L. Risbo,
"1:~6. modulators- stability analysis and optimization," Ph.D. thesis, Technical
University of Denmark, DK-2800 Lyngby, Denmark, 1994.
(12)
J.G. Kenney and L.R. Carley, "Design of multibit noise-shaping data converters," Analog
Int. CIrcuits Signal Processing Journal, vol. 3, pp. 259-272,1993.
[13]
Y. Yang, G.e. Ternes and R. Schreier, "A tight sufficient condition for the stability of high-
order multibit delta-sIgma modulators," Oregon State University research report, 1991.
[14)
R. Schreier, "An empirical study of high-order single-bit delta-sigma modulators," IEEE
Transactions on Circuits and Systems II, vol. 40, no. 8, pp. 461-466, August 1993.
[15)
P. Benabes, A. Gauthier and D. Billet, "New wideband sigma-delta convertor,"
lEE
Electronic Letters, vol. 29, no. 17, pp. 1575-1577, August 19, 1993.
[16)
T.e. Leslie and B. Singh, ''An improved sigma-delta modulator architecture," Proceedings of
the 1990 IEEE International Symposium on Circuits alld Systems, vol. I, pp. 372-375, May
1990.
[17]
T. Hayashi, Y. Inabe, K. Uchimura and A. [wata, "A multistage delta-sigma modulator
without double integration loop," ISSCC Digest of Techllical Papers, pp. 182-183, February
1986.
[18)
Y. Matsuya, K. Uchimura, A. Iwata, T. Kobayashi, M. Ishikawa and T. Yoshitome, "A 16-bit
oversampling A-to-D conversion technology using triple-integration noise shaping," IEEE
Journal ofSolid-State Circuits, vol. 22, pp. 921-929, December 1987.
[19)
J.e. Candy and A. Huynh, "Double integration for digital-la-analog conversion," IEEE
Transactions on Communications, vol. 34, no. 1, pp. 77- 81, January 1986.
[20]
B.P. Brandt and B.A. Wooley, "A 50-MHz multibit sigma-delta modulator for 12-b 2-MHz
AID conversion," IEEE Journal of Solid-State Circuits, vol. 26, no. 12, pp. 1746-1756,
December 1991.
[21]
P. KISS, J. Silva, A. Wiesbauer, T. Sun, U.K. Moon, J.T. Stonick and G.e. Ternes, "Adaptive
Digital Correction of Analog Errors in MASH ADCs - Part II:' IEEE TrallsactlOlls 011
Circuits an.d Systems II, vol. 47, no. 7, pp. 629-638, July 2000.
138
II
I
Ii
=-
=
-
=--
.. =
iii -
!l I
'"

I-
I
CHAPTER 5
Bandpass and Quadrature
Delta-Sigma Modulation
Previous chapters describe the operation of lowpass ~~ modulators, for which the
highest frequency-of-interest is a relatively small fraction of the sample ratc.
Advantages of the A:t approach include simplified anti-alias filtering, inherent lin-
earity, robust operation and low power consumption, whereas the primary disad-
vantage is the need to sample at a rate many times higher the highest frequcncy-of-
interest. This chapter shows how ~ modulation can also be applied to narrowband
signals whose highest frequency-of-interest is an appreciable fraction of the sam-
pling rate. The resulting bandpass and quadrature modulators preserve many of
the advantages of lowpass AL modulation, and are particularly useful in modem
receiver systems where high-frequency narrowband signals are converted to digital
form without prior translation to baseband.
5.1 The Need for Bandpass and Quadrature Modulation
Fig. 5.1 shows a signal processing chain which is found in a variety of wired and
wireless receivers. As depicted in the figure, the incoming signal is repeatedly fil-
tered, amplified and mixed down to a lower frequency before finally being digi-
tized and sent to a digital signal processor (DSP). The number and location of the
amplifiers, mixers, bandpass filters and lowpass filters, as well as the gain distribu-
139

5
Bandpass and Quadrature Delta-Sigma Modulation
tion and gain control strategy, are detennined by the system designer based on the
requirements of the system and on the capabilities of available building blocks. For
example, a receiver with modest requirements for instantaneous dynamic range
will typically rely more on AGC (automatic gain control) than a system which
needs to attain high instantaneous dynamic range, and so will be able to accommo-
date an ADC with only modest dynamic range. Similarly, increased filtering (pos-
sibly combined with an increased number of mixing operations) can relax both the
bandwidth and dynamic range requirements of the ADC.
However, since the current trend is toward multi-standard receivers which can han-
dle a variety of modulation formats, receiver specifications must increasingly
accommodate the specifications of several standards. Also, since broadcast band-
width is a limited resource, bandwidth-efficient modulation schemes are increasing
in popularity. The result is that bandwidth, linearity and noise requirements are all
becoming more difficult and that receiver flexibility is a must. In a similar vein,
cost, size and power pressures have put increased emphasis on system simplicity
and efficiency. How does the modem receiver designer deal with these conflicting
requirements?
Thus far, the answer has been to remove as many analog processing stages as pos-
sible, and to put as much of the signal-processing burden on the ADC and DSP as
possible. Performing analog-to-digital conversion early in the signal chain require~
conversion ofeither narrowband bandpass or narrowband quadrature signals, while
the high dynamic range requirements mandate the use of dL techniques.
Fig. 5.2 depicts a bandpass dL ADC system as well as the spectra of its key sig-
nals. As the figure shows, the input to the ADC is either an JF (intennediate fre-
quency) or RF (radio frequency) signal. This signal may have already been heavily
·1f1
.- -
BPF
Amp
Mixer
LPF
Amp
ADC
DSP
Figure 5.1: A signal processing chain found in many receiver systems.
140
Li

The Need for Bandpass and Quadrature Modulation
filtered (so that the primary component is the desired signal), but it is more likely
to contain undesired signals which are many tens of decibels stronger than the
desired signal. The output of the converter contains the desired signal surrounded
by shaped quantization noise, plus the interfering signals. The primary feature dis-
tinguishing a bandpass modulator from a lowpass modulator is that the quantiza-
tion noise stopband of a bandpass modulator is not centered on dc. Instead, the
stopband is placed at some non-zero frequency 10 that is well removed from dc,
such as f 0 = 1/4. The digital output of the modulator is mixed to dc by a digital
quadrature mixer, and then lowpass-filtered and decimated by a quadrature low-
pass digital decimation filter, to remove out-of-band signals and noise and thereby
to produce baseband digital data.
At the system level, the two primary advantages of bandpass conversion are the
elimination of one or more analog downconvcrsion operations, and the preserva-
tion of the spectral separation between the signal and various low-frequency noise
and distortion components. At the circuit level, bandpass conversion is more effi-
cient than converting the entire frequency band between 0 and f 0 + f B/2 , since
no power is wasted on the accurate conversion of unwanted signals between 0 and
10 - f B/2. At present, the only converter architecture that is able to focus its
operation on a particular frequency band in this way is the bandpass 6.~ converter.
Fig. 5.3 contrasts the polelzero placement of the NTFs of hypotheticallowpass and
bandpass 6.~ modulators. The lowpass modulator has NTF zeros at or near z = I
IF (or RF)~-/
Input
desiredet-
a
1/2
BP~
ADC
Decimation
Filler
tl[JdLi
a
1/2
-//2
0
1/2
ToDSP
baseband
1.
Figure 5.2: A bandpass DJ.: ADC system.
141

5
Bandpass and Quadrature Delta-5igma Modulation
(which corresponds to dc), whereas the bandpass modulator has NlF zeros else-
where on the unit circle, such as z = ±j (which corresponds to f o = f/4).
Note that since the NTF zeros occur in complex conjugate pairs, realizing n NTF
zeros in the passband of a bandpass modulator requires a (2n)th-order converter.
The oversampling ratio of a bandpass system is defined in the same manner as in a
lowpass system, namely OSR = 1/(2!B), so that OSR = 1 corresponds to
Nyquist-rate sampling. For a bandpass signal, f B represents the two-sided band-
width.
In a lowpass system, the modulator output can be decimated by a factor of OSR
without loss of infonnation, since the minimum sample rate at the output of the
decimation filler is 2/B' In a bandpass system, however, the minimum sample rate
at the output of the decimation filter is only f B because the output of the decima-
tion filter is complex data. (Section 5.5 provides a brief overview of complex, or
quadrature, signals.) Thus, the data from a bandpass ADC can be decimated by a
factor as high as 2 x OSR without loss of infonnation.
As a numerical example, consider a system in which the signal band is centered at
10 MHz and has a bandwidth of 200 kHz (the channel spacing in the popular GSM
cellular telephone standard). Sampling at 40 MHz implies that a bandpass modula-
tor with f 0 = f /4 is needed. The OSR corresponding to this sampling rate is
OSR = 1/(21B) = (40 MHz)/(2 x 200 kHz) = 100, even though the sam-
pling rate is only 4 times the center frequency of the desired signal. This example
I•=
I•I
,I
i "
i -
;;
l
-
i •
.. -
I
~
~
-
x
x
b)
I,
OSR =-
21B
Figure 5.3: a) Luwpass .s. b) bandpass NTFs.
a)
1/2 +-----i~----lI~__
142

The Need for Bandpass and Quadrature Modulation
makes it clear that while a bandpass modulator oversamples the bandwidth by a
large factor, the ratio f,lf 0 need not be especially large. Since a 3'd-order binary
lowpass modulator can achieve approximately
100~dB SQNR with OSR
::::; 100,
similar perfonnance should be expected from a 6th_order binary bandpass modula-
tor with the same OSR.
The lowest frequency which aliases into the passband of an OSR = 100 lowpass
modulator as a result of a 40-MHz sample rate is 39.8 MHz. Since this alias fre-
quency is nearly 200 times the upper frequency of the passband, anti-alias filtering
for such a modulator is virtually trivial. However, in the case of our example band-
pass modulator, the lowest frequency which aliases into the passband is 29.9 MHz.
Since this frequency is only about a factor of 3 higher than the desired signal, the
anti-alias filter will most likely need to be a bandpass filter in order to provide suf-
ficient alias protection. The Q of this filter is dictated by the required alias suppres-
sion and the f 0/f s ratio; the filter is easier to realize iffo is a small fraction ofIs·
As will be discussed in Section 5.3, and demonstrated in Section 5.4, the anti-alias
filter can be eliminated entirely if the modulator makes use of a continuous-time
loop filter.
Just as a bandpass modulator can exploit the narrowband character of its input, a
quadrature 6.L modulator can exploit the additional infonnation available in a
quadrature signalt. Fig. 5.4 illustrates the main signal-processing operations that
occur within a quadrature 6.L ADC system. A quadrature signal, such as that pro-
duced by a quadrature mixer, is applied to a quadrature 6.L modulator which out-
puts a digital quadrature signal containing the desired signal and the shaped
quantization noise. The distinguishing feature of a quadrature modulator is that its
quantization-noise stopband need only exist for positive (or negative) frequencies.
In a sense, a quadrature converter is more efficient than a bandpass converter
because no power is wasted digitizing the negative-frequency content of the input.
t. A quadrature signal consists of two real signals, commonly denoted either by I (for m-phase)
and Q (for quadrature phase), or by re (for real) and im (for imaginary). The key difference
between a real signal and quadrature signal is that the spectrum of a quadrature Signal need not
be symmetric about zero frequency, i.e., for a quadrature signal, positive frequencies are distinct
from negative frequencies. Section 5.5 discusses quadrature signals and quadrature filters in
more detail.
143

5
Bandpass and Quadrature Delta-Sigma Modulation
The modulator output is mixed to baseband by a digital quadrature mixer, and fil-
tered by a quadrature decimation filter, to produce Nyquist-rate baseband data.
For a real (non-quadrature) system, signals beyond 15/2 suffer from aliasing,
whereas for a quadrature system the corresponding limits are ±1/2. The total
alias-free bandwidth is thusfr In order for OSR = I to correspond to no oversam-
piing, the OSR of a quadrature system is defined as OSR = Is/lB' In other
words, for a given signal bandwidth and sampling rate, a quadrature modulator has
an OSR that is twice that of a real modulator. Lastly, since the minimum output
data rate is IB' decimation by a factor of OSR is appropriate for a quadrature sys-
tem.
..• ••
=
=
=
A quadrature 8L modulator can be either lowpass or bandpass. However, since a
quadrature lowpass modulator is equivalent to a pair of regular lowpass modulators
operating independently on the components of the quadrature signal, the advan-
tages of a quadrature lowpass modulator over competing architectures are not as
pronounced as they are for a quadrature bandpass modulator. In the bandpass case,
a quadrature modulator is useful because it effectively doubles the OSR, and it
does so without doubling the hardware. Section 5.6 will delve into this more
deeply, but for the moment it suffices to note that a bandpass modulator having n
in-band zeros requires a loop filter of order 2n (containing 2n op-amps), whereas a
Quadrature
r---' complex Digital Mixer
Quadrature-- -'Quadrature l-::d:a=ta=~~Xt:==::::~Decimation
Input
~~
6.l: ADC
I-
~
Filter
pos.ltive·fr~Quency
shaped
signal shifted
I
'l~,gn,al -=ilL :j(
-//2
0
1/2
-1./2
0
f,/2
-1/2
0
1/2
Figure 5.4: A quadrature t>L ADC system.
144
To DSP
II•I••
i=
~ I
-,
II,,
I
i,,
1
j

Bandpass NTF Selection
quadrature modulator having n in-band zeros requires a complex loop filter of
order n, which also contains 2n op-amps.
ADCs employing bandpass modulation are less common than ADCs employing
lowpass modulation, but have been reported in numerous publications [1-10], and
are commercially available in a few devices [11-12]. Quadrature
6.~ ADCs are
more uncommon still, with only a few publications [13-14] and no commercial
realization. Research into the utility of bandpass and quadrature 6.L DACs indi-
cates some promise, but at this point demonstrating feasibility is more important
than demonstrating significant performance advantages [15-16].
5.2 Bandpass NTF Selection
The NTF of a bandpass modulator is subject to the same realizability and stability
constraints as the NTF of a lowpass modulator. In particular, Lee's rule for stability
is as effective in the context of binary bandpass modulation as it is in the context of
binary lowpass modulation. Zero optimization is likewise as useful for bandpass
NTFs as it is for lowpass NTFs. However, one degree of freedom which is avail-
able to bandpass modulators but not to lowpass modulators is the choice of the
center frequency fo relative to the sampling rate fs'
Iffo andfn are fixed by the application, choosing a high value of fs IS desirable for
two reasons: it maximizes the achievable SQNR by maximizing the OSR, and it
eases the design of the anti-alias filter by minimizing the folfs ratio. Of course, fs
has a practical upper limit which is dictated by the available technology. If only fn
is fixed, the choice of fs is still governed by the preceding considerations, but fo
now becomes an independent parameter. To simplify the anti-alias filter,Jo should
be small. Furthermore, as depicted in Fig. 5.5, a low value of 000 = 2itf0 may
improve the noise-shaping characteristics of the modulator. These considerations
must be balanced against the corrupting influence of low-frequency noise as fa
approaches zero. A further consideration in the choice of fa is that the digital
quadrature mixer which precedes the decimation filter is simplest when 10/ Is is a
simple rational such as l/4t .
145

;; -
!!-
•
j
-,
Once In, 10 and Is have been selected, the NTF selection process for a bandpass
modulator is essentially identical to that for a lowpass modulator. The designer
chooses the modulator order, decides whether the NTF zeros should be optimally
spread or not, and then uses a procedure such as that coded in the synthesi-
zeNTF function of the I1.L Toolbox (see Chapter 8) to arrive at a candidate NTF.
Simulation is then used to detennine whether the NTF order and other parameter
choices are acceptable. If not, iteration is necessary.
As an example, Fig. 5.6a shows the pole-zero distribution of a 6th_order bandpass
NTF designed for a center frequency of f 0 = 1./6, an oversampling ratio of
OSR = 32 and an out-of-band gain of 2. Fig. 5.6b plots the frequency response of
this NTF, as well as that of the STF which results when the modulator is realized
with the CRFB structure and a single input feed-in. Since the mean depth of the
NTF notch is 60 dB and the OSR is 32, if we assume that the quantization noise is
white
with
power 0;,
then
the
in-band
quantization
noise
power
is
0; x 1O-6/OSR, which is about 75 dB (12.5 bits) lower than a;. With a 4-bit
quantizer, this NTF should therefore yield better than 16-bit perfonnance.
To confirm this prediction, Fig. 5.7 plots the simulated output spectrum when the
input is a -I dBFS sine wave. The observed SQNR of 102 dB is in fact close to 17-
_______-----I1T
5 ","dpa.. and aoad"tu,. a.lta-Slgma Modulation
l I
I
Ipl
,;
~ -
I ,
\I
:j ,· -
•
x
x
"'0
x
---I-----I----~,,:..jl__l_ dz; mean distance to the
negative-frequency zeros
dp; mean distance to the
negative-frequency poles
Figure 5.5: Lowering (00 in a bandpass modulator will improve the
suppression of quantization noise ifdz <dp-
t
Subsampling bandpass modulators, In which 10 /1 , = 3/4, or 5/4 etc. have equally simple
digItal mixers.
146

Bandpass NTF Selection
bit perfonnance. Fig. 5.8 shows that this level of performance holds up well as the
input amplitude is swept over a broad range.
Fig. 5.9 superimposes a portion of the output data on the input sine wave in order
to demonstrate that the high resolution of a bandpass modulator, which is so
readily apparent in the frequency domain, is nearly impossible to discern in the
time domain. As Fig. 5.9 shows, the resemblance between the input and output
a)
b)
!g ·20
c
~
-40
.. ,'"
...
-60
.
~ ....
. ..
~ ...
o
0.25
Normalized Frequency
0.5
Figure 5.6:
aj Pole-zero and b) NTF/STF magnitude plots for anf,J6
bandpass modulator.
....'
'
.
~
'
.
• •••• J ••••••' •••••• ,
StiNR"; j 02dB
: @ OSR '" 32 :
... ,
,
0.25
Normalized Frequency
Example bandpass output spectrum.
....;-
:....
....;
.
Figure 5.7:
o,,---,--~-,","~-~--!---,
-20 -
~
--40
ti -601"lIlI"""'..~..iIi.'...
u.
-80
In
"0 -100 -
-120 .
-140o
._- ---------- ---
147

=
5
Bandpass and Quadrature Delta-Sigma Modulation
waveforms is coarse at best, and gives no indication that in the signal band the
accuracy of the modulation is in fact better than one part in 105!
I
iii•
iiiii••
100
80
iD
;
~
;
0::
60
Zaen
40
20
.,
o
--~~._--~-~..__.~
-100
-80
-60
-40
-20
0
Input Amplitude (dBFS)
Figure 5.8: SNR vs. input amplitude for the example bandpass modulator.
=
30
,
,. r
20
.;. ~-I
.. .: I
<..;,
.;- .,
'.' ,...
I.:..
\;..,'
.:..:. ~- ;.,.
..
. - .
. ':i ....,.
j: :i:l'ili·1:.LJ}
10
., ..;. .:
::(
:.
., -:' .!.;.
....;..
:'
"
~:
I· l,
8
16 r.,-".·....'-CTT,...
TT."""'.""n-cco-co-'T1
.
\
.. . .. ,..'."
o .... :.1
: -;-1-
-8
,,
-16 o
Time Step
Figure 5.9: Simulated output data for the example bandpass modulator
superimposed on the input waveform.
---_._--
148
=

f
•
Bandpass NTF $election
5.2.1 Pseudo N-path transformation
The substitution z ----t _z2 transfonns a lowpass NTF (whose n zeros are near
z = 1) into a bandpass NTF with n zeros near z = j and n zeros near z = _j .t
This (2n)th-order NTF has the same gain vs. frequency profile as the original NTF,
but compressed by a factor of two and replicated, as illustrated in Fig. 5.10. One
might therefore expect that a bandpass modulator derived in this way behaves in a
manner similar to the originallowpass modulator. In fact, it is easy to show that the
bandpass modulator is exactly equivalent to two copies of the original lowpass
modulator, each operating on subsampled data with alternating polarities, as
depicted in Fig. 5.11.
Lowpass Prototype NTF
x
x
Bandpass NTF
x x
x x
~1I
.........
-8.'<5--'-~--'---'-~0~'--"---'---'--;!05
Normalized Frequency
~.5
o
Normalized Frequency
0.5
Figure 5.10: Pseudo 2-path transformation applied to a lowpass NTF.
t. A transformation of the form z --4 ,N is called an N-path trailsformation because it can be
accomplished by replicating the original system N times and processing the incoming sIgnal
with N parallel paths operation in a tIme-interleaved fashIOn. Similarly, replicating all memory
elements in the system also accomplishes this transformation. The transformation z --4 _,N is
called a pseudo N-path transformation because it IS akin to an N-path transformation.
149

5 Bandpass and Quadrature Della-Sigma Modulation
This equivalence shows that a 2l1th-order bandpass modulator (derived from an nth.
order lowpass modulator via the z ~ _Z2 transformation) has exactly the same
stability properties and SNR curve as the lowpass modulator operated at the same
OSR. Furthermore, the limit cycle characteristics of a bandpass modulator with an
lsi4 sine wave input correspond to the interleaved limit cycle characteristics of
two lowpass modulators with dc inputs of Acos(\> and Asin(\>, where A is the
amplitude of the sine wave and (\> is its phase relative to the sampling clock.
The z ~ _z2 transformation can be applied to the NTF of a lowpass modulator to
yield a bandpass NTF which can then be realized with any of the struclures shown
in Chapter 4. An alternative method is to apply the z ~ _z2 transfonnation
directly to a lowpass modulator (at either the block-diagram level or the circuit
level), simply by replacing each delay element with two delay elements and an
inversion. As an illustration, Fig. 5.12 shows the I s/4 bandpass analog of MODI.
The "integrator" now contains a pair of delays and an inversion in its feedback
path, while the feedback path from the quantizer also contains two delays but loses
the inversion that is normally present at the first summation. This structure is sim-
=
ii
••----
+1,-1
Lowpass
6.:E Modulator
+1,-1
,,,,,,,,,._------------------------------_.
's /4 Bandpass ~~ Modulator
r-------------------------------
•
+1,-1
+1,-1
:
t
•
Lowpass
:
6.:E Modulator
X
,,,
Figure 5.11: Pseudo 2-path transformation applied to a lowpass
modulator at the system level.
150
------

Architectures for Bandpass Delta-Sigma Modulators
pIer than what would result from mapping the NTF onto any of the general-pur-
pose structures presented in Chapter 4.
5.3 Architectures for Bandpass Delta-Sigma Modulators
5.3.1 Topology Choices
Bandpass modulators possess the same architectural variety as lowpass modula-
tors, and the trade-offs between the different structures are also essentially the
same. Bandpass modulators can be implemented in single-loop or cascade Conn,
with a similar trade-off between improved stability and increased sensitivity to
analog non-idealities such as parameter errors and finite op-amp gain. Likewise,
the loop filter of a bandpass modulator can be constructed using any of the conven-
tional forms found in lowpass modulators, including feedback, fecdforv.'ard and
hybrid topologies, with similar trade-offs between internal dynamic range and STF
quality.
Fig. 5.13 contrasts the feedback and feedforward topology extremes for lowpass
modulators. In the feedback topology, the quantizer output signal is fed back to the
input of every integrator in the loop filter, whereas in the feedforward topology, the
output signal of every integrator is fed forward to the input of the quanlizer. The
integrators may be any combination of continuous-time integrators (such as Gm-C
or active-RC integrators) or discrete-time integrators (including delaying, non-
delaying or half-cycle-delaying switched-capacitor integrators), provided the coef-
UI---l~
y
Q 1--.-. V
i•
Figure 5.12: Pseudo 2.palh lransformalion applied 10 MODI
at lhe block level.
151

5
Bandpass and Quadrature Delta-Sigma Modulation
ficients and timing are chosen appropriately. To shift the loop-filter poles to non-
zerO frequencies, it suffices to add internal feedback paths such as the one shown
with dashed lines in Fig. 5.13a. These loop filter topologies are readily used in the
construction of bandpass modulators. For example, Fig. 5.14 shows the structure
of the loop filter of a 4th-order bandpass modulator employing the feedback topol-
ogy.
•j
'i
;;=
.!
'----
~.-
a)
b)
u
u
v
v
..
Figure 5.13: Basic loop topologies for lowpass modulators:
a) feedback, b) feedforward.
U
Y
'-----J...---+------4
V
Figure 5.14: Loop filter of a 4th·order bandpass modulator employing the
standard feedback topology.
152

Architectures for Bandpass Delta-SIgma Modulators
When fo is a substantial fraction of the sampling rate, there is strong coupling
between the two integrators that comprise a resonator, and thus the resonator out-
put may be taken from the first integrator, as shown in Fig. 5.15. The integrators in
this figure are shown as continuous-time blocks for convenience. Taking the reso-
nator output from the first, rather than the second integrator output, changes the
transfer function of the resonator from 0>6/(s2 + (05), which is a lowpass
response, to sO>o/(s2 + (05), which is a bandpass one. Since the bandpass
response has a null at dc, it is clear that a lowpass modulator cannot make use of
these bandpass resonators, whereas a bandpass modulator can. Since the nl2 res-
onators in a bandpass modulator may either be of the lowpass or bandpass variety,
there are In/2 possible lowpasslbandpass resonator combinations for a given loop-
filter category such as the feedback, feedforward or hybrid categories.
Fig. 5.16 illustrates how adding a feedforward path and thus connecting the output
of one resonator to both of the integrators in the next resonator can eliminate one
of the feedback coefficients (i.e., one of the feedback DACs) in a bandpass modu-
lator. Since the transfer function from V to Y is the same in Fig. 5.16 as that of
Fig. 5.15, the noise transfer function of a modulator employing the loop filter of
Fig. 5.16 will be the same as that of a modulator employing the loop filter of
Fig. 5.15. (Of course, the signal transfer functions may not be the same.) This
transformation may be applied to each resonator section except the last one,
thereby cutting the required number of DACs by nearly 50%. As will be seen in
Section 5.4, this transformation is helpful in the construction of a bandpass modu-
lators which employs an LC tank.
u
y
l-__----l
-L
-L-__ v
Figure 5.15: Loop filter of a 4th~order bandpass modulator employing a
feedback topology with bandpass resonators.
153

5
Bandpass and Quadrature Delta-Sigma Modulation
Fig. 5.17 shows a portion of a loop filter which encompasses all of the above vari-
ants. Each resonator section is coupled to the next through 4 arbitrary gains, so the
choice of a lowpass vs. a bandpass section is simply a special case wherein all
coefficients are zero except for one. The feedback DACs are not shown. and could
be added to any or all of the integrator summing junctions, according to whether a
feedback, feedforward or hybrid modulator topology is used.
5.3.2 Resonator Implementations
The primary difference between the realization of a lowpass modulator and a band-
pass modulator is that a lowpass modulator requires good integrators, whereas a
bandpass modulator needs good resonators. The degradation caused by a finite
I~
;
~
i-
;;
~•
=
=
U
Y
===
=
~
-"
'----l.-
L---l-
v
Figure 5.16: Eliminating a feedback DAC by adding a feedforward path.
Figure 5.17: Internal structure of a more general loop filter for a bandpass
modulator.
154
=
" •
, •
~,
='j";
~

Architectures for Bandpass Delta-Sigma Modulators
quality factor (Q) in the resonators of a bandpass modulator is analogous to the
degradation caused by finite dc gain in the integrators of a lowpass modulator: both
cause reduced SQNR and increased susceptibility to tonal behavior. The SQNR
degradation is significant when Q falls below f 0/f B' Thus, in order to take full
advantage of a high value of OSR, the Q of each resonator should be high. Con-
versely, when the signal is not especially narrowband, i.e. when f 0/f B is not very
high, the Q requirements for nearly ideal operation are relaxed. The resonant fre-
quency of the resonator must be accurate for similar reasons. A frequency error
that is an appreciable fraction of f B' say 20%, is usually close to the level of sig-
nificance. Once again, a high value for OSR dictates more stringent accuracy
requirements. This section presents several resonator circuits which have been
used in the construction of bandpass dL ADCs, and comments on the ability of
each to achieve an accurate and high-Q resonance.
Fig. 5.18a depicts the lossless discrete integrator (LDI) loop, which may be real-
ized in switched-capacitor form as shown in Fig. 5.18b. The structure of this cir-
cuit is such that the poles are the roots of the characteristic equation
a)
b)
,.......
1
z
f-
z-1
z-1
<i
c
c
+
Figure 5.18: a) The LDI loop. b) A switched-capacitor implementation (half
of a differential circuit).
155

(5.1)
5
Bandpass and Quadrature Delta-Sigma Modulation
1+
gz
= o.
(z _1)2
The roots of (5.1) are z
= cr±jJI-cr2 , where cr = l-gl2. Clearly, for
Icrl <;; 1 (0 <;; g <;; 4), the pofes of the LDI loop lie on the unit circle, and thus the Q
of the resonator is ideally infinite. In practice, Q is limited by finite op-amp gain,
but since Q> 100 is readily achieved, finite resonator Q is usually not problematic.
The frequency of the resonance is given by (1)0 = cos-1(0) , which shows explic-
itly the dependence of 000 on capacitor ratios. The sensitivity of 000 to capacitor
ratio errors is an increasing function of (00' but even at the relatively high value of
000 = n/2, a 1% shift in capacitor ratios translates into only a 0.6% shift in 000 ,
Since capacitor matching is typically much better than 1%, the OJo-accuracy of an
LDI-based resonator is insufficient only if the signal bandwidth is a small fraction
of the center frequency.
The LDI loop provides a good way to implement a switched-capacitor resonator
possessing an arbitrary resonant frequency, but requires the usc of two op amps.
When the resonant frequency is f / 4, the pseudo 2-path transformation described
in Section 5.2.1 leads to circuits such as that depicted in Fig. 5.19 which are able to
implement a resonator with a single op amp. Note that since such circuits impJe-
__A/.
Ca
A
cJ-1H5
~_B/.
Cb
B
DJ-1H::§:
+
Vout
+ -y<'---+-
Figure 5.19: A pseudo.2.path switched-capacitor1/4 resonator.
156
I
I ;;. ~
I !!
I
Ii
J
~ ~.
~
.!!!

ArchItectures for Bandpass Delta.Sigma Modulators
ment the desired center frequency by virtue of their topology, rather than through
the use a particular set of capacitor ratios, capacitor errors do not translate into
center-frequency errors.
Although the center frequency of the circuit shown in Fig. 5.19 is insensitive to
capacitor ratios, mismatch in the paths (in particular the Ca and Cb capacitors)
causes the circuit to be periodically time-varying, instead of time-invariant. The
time-varying nature of the circuit in tum causes mixing of the signal with f sl4
and its harmonics, and it is the mixing of the signal with f /2 that results in the
appearance of an image signal, a frequency-inverted copy of the signal centered on
10' Another source of difficulty in this circuit stems from the use of clocks whose
frequency is f sl4. The large-amplitude clocks can leak into the signal band and
appear as a tone at band-center.
The circuit depicted in Fig. 5.20 avoids these problem to a large degree. Since the
Ca and Cb path capacitors are only used for charge storage, and since the conver-
sion of charge to voltage is perfonned the (path-independent) Co capacitors, the
time-varying nature of the circuit is essentially hidden. (In practice, the op-amp
gain must be high enough to ensure adequate charge-transfer efficiency.) Also,
since this circuit does not use f/4 clocks, this spur-generating mechanism is not
an issue.
Fig. 5.21 shows the structure of a Gm-C resonator. Since the center frequency is
given by 000 = gn/C, and since the value of gmlC implemented with on-chip
capacitors and transconductors typically has 30% variability, the center frequency
of a Gm-C resonator will be poorly controlled unless some means for tuning IS pro-
vided. A common mcthod for tuning a Gm-C filter is to adjust all the Gmelements
of the filter along with those of a simpler reference filter until the reference filter
has the desired response. However, since the resonator can be converted into an
oscillator with only a small amount of positive feedback, it suffices to measure the
oscillation frequency of the resonator itself and adjust Gm (or C) directly. Since
this calibration must be done off-line, the designer must ensure that the drift of (im
over temperature is sufficiently small. If the drift cannot be made sufficiently
small, a continuous-tuning method involving a (scaled) copy of the resonator is the
next best choice.
157

:
,
II
Once the problem of resonator tuning has heen addressed, the next set of concerns
revolve around the resonator's Q. Non-idealities such as finite output impedance
and non-zero phase shift in the transconductors limit resonator Q. Techniques such
as cascoding can boost output impedance, while the phase shift can he reduced by
using a wide-band Gm•or compensated by adding a small resistor in series with the
capacitors.
_____-
---I!TT_
5 Bandpa.. and Q"d,at... Del""'gma Mod.lalion
II
I!
-
Ii••I•I
!
I.
I
-jjI
+
You!
-
+"",--------'
2
Co
+-+------j ~
>i
~=::j __ L--~+_---iCb~_1
J f·U2lf11J2l
! ~~
JAi1fA2lJB1l.fB
Ca
A2
~-1
A 2-path resonator with reduced sensitivity
to capacitor mismatch.
Ca
A2
~-1
Cb
82
r-2t-~-1~~
Co
1
Ci
+-------i ~
+~i1~-+4
>i
2/
2/
Yin
.L
.L
Figure 5.20:
158

c
IS
e
h
y
e
, -
I
Architectures for Bandpass Delta-Sigma Modulators
Fig. 5.22 shows the structure of an active-RC resonator. Here the center frequency
is given by 0>0 = l/(RC), and once again the highly variable nature of the RC
product necessitates the use of tuning. Tuning may be accomplished by adjusting R
(continuously via MOS devices, or in discrete steps using a resistor array), by
adjusting C (here an array is most practical), or by a combination of the two
approaches. Once again, configuring the resonator as an oscillator is straightfor-
o---I~ +
V
Gml
in0---1+ -
- +l-++-..-___j
Gm
+ _.~-+----j
Figure 5.21: A Gm~C resonator.
R
c
R
c
-f
Figure 5.22: An active~RC resonator.
159

5 Bandpass and Quadrature Delta-Sigma Modulation
ward and eliminates the need for a replica block, but can only be done when the
converter is off-line.
The last resonator we consider is the LC tank driven by a current source, shown in
Fig. 5.23. From the viewpoint of complete integration, this topology represents
somewhat of a backwards step. On-chip inductors possess only a few nanohenries
of inductance, and so would only be useful if the center frequency is above 1 GHz
or so. Since such high frequencies are beyond the reach of existmg mainstream
technologies, bandpass modulators which employ inductors have all relied on
external components. As with the Gm-C and active-RC resonators, the accuracy of
the LC tank's center frequency is determined by the accuracy of its components.
Since discrete inductors with tolerances on the order 2% and Q> SO are available,
as are capacitors with even tighter tolerances and higher Q, it is possible to imple-
ment a high-Q LC resonator without incorporating means for tuning. Furthermore,
since inductors and capacitors are ideally noiseless, a resonator based on an LC
tank enjoys an enonnous noise advantage over the preceding resonator circuits.
The distortion of an LC tank is also quite small compared to what can be achieved
with active circuitry. Lastly, since an LC tank implements a physical resonance (as
opposed to the synthesized resonance), an LC resonator needs no bias power.
Despite its resistance to integration, an LC tank possesses a number of important
attributes (namely low noise, distortion and power!) that make its use in a bandpass
converter highly advantageous. The following section will illustrate these advan-
tages in the context of an example.
Figure 5.23: A resonator based on an LC tank.
160
I
iI..
=;
11
I
•
I Ii
• •
I ..
!
~
J ~
I
• =·
,
=
=
=
I.

e
,
s
Bandpass Modulator Example
5.4 Bandpass Modulator Example
As described in the introduction, bandpass modulators are most attractive in nar-
rowband receiver systems. System specifications regarding portability, operating
time. range and reliability translate into requirements for low power consumption
and high dynamic range. When these requirements are extreme, as they are for the
two-way radios used by military and safety personnel, a structure such as that
shown in simplified fonn in Fig. 5.24 and more detailed fonn in Fig. 5.25 offers a
number of important advantages.
The main advantages stem from the fact that the output of the active mixer (which
is a current) is applied to a high-Q LC tank. The high impedance of the tank at res-
onance endows the LNNmixer with high gain (an effective gain of 60 was
reported in [17]), thereby reducing the noise of subsequent blocks in the ADC by
the same factor when referred to the LNA input. This high gain can be supported
without a large voltage swing on the tank since the tank is part of a bandpass ~:E
converter. (In effect, IDAC, the current-mode feedback DAC, cancels the in~band
portion of the mixer's output current and thus prevents unbounded voltage swing
on the tank even if the Q of the tank is infinite.) Both IDAC and the mixer benefit
by having an inductive connection to the supply, since this arrangement eliminates
the dc drop associated with bias currents flowing through resistive loads and allows
signals to swing above the supply, thereby giving plenty of headroom to both
RC
SC
Flash
Resonator
Resonator
ADC
IFin
IDAC AA
/
Data
out
Figure 5.24: Simplified block diagram of the IF-to-bits portion
of a high-performance receiver.
161

_____--__------fl
5 Bandpass and Quadrature Delta.Slgma Modulation
blocks. Finally, as mentioned in the preceding section, an ideal LC tank adds no
noise or distortion, and consumes no power. The combination of increased head-
room and increased gain without penalties in noise, distortion or power is a rare
combination, one that makes using an LC tank as the first resonator in a bandpass
t>L ADC highly desirable.
For the user, the only disadvantage of an LC tank is reduced integration. With an
IF in the 2-3 MHz range, the inductance range is roughly 5-10 ~H. Since suitable
inductors arc fairly small (measuring 1.3 x 2.0 x 1.4 mm) and cost only a few
cents, this disadvantage is not particularly prohibitive.
•
•
!!
;: =
i~••·-•·-
=
External
RC Resonator
Inductors
•
•
36K
·1
1-4 F
1-4 F
36K
., +
+
-
IFm
•••
"
3R
2R
••~----- SC Resonator
•
Figure 5.25: A more detailed ADC schematic.
"
.j.
162
"
~
• .j.
iV,et -----"~
.,!. : 8DAC
•
capacilo~
• +
·1
To
Flash
ADC
IIiiI--
;;;;
!!!!!!-
~
"
-I
~
•

10
1-
·e
:s
n
e
v
Bandpass Modulator Example
For the 8~ designer, the disadvantage of an LC tank is that it complicates the
design process. In a purely feedforward topology, a linear combination of all loop-
filter state variables is fed to the quantizer, but since the inductor current is difficult
to sense without adding noise or degrading the Q of the tank, it is impractical to
incorporate the inductor current in the summing network which drives the quan-
tizer. On the other hand. in a purely feedback topology the quantizer output must
be fed to the summing node of each integrator. Since the integration performed by
an inductor (i = Jv dt / L) requires a summation of voltages, incorporating a feed-
back term for controlling the inductor current requires a voltage-mode DAC,
which is also impractical. These difficulties can be overcome as described in
Section 5.3.1, namely by feeding the output voltage of the tank into both integra-
tors of the subsequent resonator. Alternatively, as done in this modulator, the out-
puts of both integrators within the second resonator can be fed forward to the third
resonator. This output-combining arrangemenl is implemented via the resistors
labelled 3R and 2R in Fig. 5.25.
The second resonator in the modulator could also make use of an LC tank, but here
the noise, power and distortion advantages are outweighed by the advantages of
fewer external components and associated pins. Since an active-RC resonator
offers a better noise/power trade-off than a switched-capacitor resonator, the sec-
ond resonator is implemented with active-RC techniques. The first two resonators
in the loop filter arc thus continuous-time blocks, and sampling occurs after the
signal has experienced two stages of continuous-time amplification. As a result,
sampling errors (such as lhose associated with aliasing and jitter) are referred to
the input through noise-shaping functions with double zeros. The alias suppression
in this modulator is more than 80 dB, even at a relatively low-valued OSR of 48.
A switched-capacitor resonator is used as the final resonator in this modulator
since its Q is high and its drift is low. Without such a stable resonator, the modula-
tor would require a fourth resonator stage in order to guarantee sufficient attenua-
tion of quantization noise in the face of finite Q and center-frequency drift in the
resonators. Section 9.5 describes the design process for this modulator in greater
detail.
._--- - - - - - --_.-
163

5
Bandpass and Quadrature Delta-Sigma Modulation
Fig. 5.26 shows the PSD of the undecimated modulator output, together with the
theoretical srp and NTF (scaled as described in Appendix A to align with the
observed PSD). This figure shows the bandpass nature of the STF, and also that the
NTF provides at least 50 dB of attenuation of quantization noise in the band of
interest.
I:
II
..' . .' ..'. 1 ..;. .; .. '
· ..
' ...
·-. . . . . . . . . . . .
· ..
, . ..
..
: NTF:
~~~..~
..
'...:...':"
.................
..
, ....
4
2
-100
;
o
'-
~ -;.:.~.~~~.~~~-~~~._~;.~~.?;~.~~~.
-'-;;6--'--'--'- 8
10
12
14
16
Frequency (MHz)
Figure 5.26: Measured STF and noise PSD. ({eLK =32 MHz)
0
-20
~z
--40
-
en
LL
III
"C
-£0
(;
III
"C
-BO
Fig. 5.27 shows the in-band portion of the modulator output spectrum when the
input signal is a nearly full-scale tone at a 25 kHz offset from the 103.25 MHz cen-
ter frequency of the system, while the LO and CK frequencies are 100 MHz and
26 MHz, respectively. This figure exhibits an SNR of 81 dB and a spurious-free
dynamic range of!03 dB over a 270 kHz bandwidth (OSR = 48). Pig. 5.28 plots
the measured SNR as a function of input power (in dBm) with LO and CK fre-
quencies of 269 MHz and 32 MHz, respectively. As this figure shows, the system
achieves a dynamic range of 90 dB for OSR = 48 and 105 dB for OSR = 900.
This high level of performance is achieved with an analog power consumption of
only 50 mW, a figure which includes the 30 mW power consumption of the LNA
and mixer.
164
II

Bandpass Modulator Example
e
e
e
.f
'"
'"
j
<I:
50
Z
(j)
40 ........a..,.
OSA ",48
:Ht;fr~!>;,,:~~,
fila"
,.. -
'
o
., 10 ·100 ·90
-.llO
-70
-60
·50
-40
-30
-20
·10
Pin (dBm)
Figure 5.28: SNR vs. input power.
flF =273 MHz,fw =269 MHz,fCK =32 MHz.
.; .
-20
_ ~. L' .•. ; "
.; .
..
NBW"" 200Hz
-, 40 ';:C-.L..C--':-::::-'--'--'-'-:~-'--'-"-::-'-.L..C-,-::-,--'--'=-'::::."=",:-:"
-150
100
-50
0
50
100
150
Frequency Offset (kHz)
Figure 5.27: In-band spe<lrum at OSR = 48.
fIF = 103.25 MHz,fw = 100 MHz,fcK =26 MHz
o,-,--,-,--,--,,-,--,--,--,,-,--,--,--,--,--.,,--,--,--,--,--,--,--,--,--,--,-,-,
::.
J~~~~!l1d~'
.' SFDR = 103dB
",,' I
-80 --:::..
.' ..'. :.: .' ..'
.. -:.,'
-100 ","~'~"'~-i''1iIi:'"";:ij"':oI!l'~'.:~\.ill••.~..~",~"~",~',:~:::.j.;:~~~:~I:~
-120 ~...!.,. , .....;. ~ ..>....
....'":.;.; .;.
BW ~ 270 kHz
165

5
Bandpass and Quadrature Delta-Sigma Modulation
11II
5.5 Quadrature Signals
This section reviews quadrature signal processing in preparation for the upcoming
section on quadrature .6.1:: modulation. As will be explained in greater detail
shortly, quadrature signals are (most often) produced by quadrature mixers, which
are themselves useful because of their image-rejection properties.
Figure 5.29: Quadrature mixing.
Quadrature analog signals are often created via quadrdture mixing. In a quadrature
downconyersion mixer, a real (or quadrature) signal is multiplied by the quadrature
signal e-jWLO', which we will refer to as the LO (for local oscillator). The LO con-
sists of two real signals, COSWLot and -sinwLot, as illustrated in Fig. 5.29. Sup-
•!•••
•
l!!.-
I
!!!!!!
i!i!!i!
i ;;
I
~
II
==.
r
Jti•iI•i;;
COS(WLQt)
-sin(wLQt)
u(t)
A quadrature signal is an abstract signal composed of two real signals, vx and vy'
viewed as a single complex entity v ;:;: vx + jv t. Since a quadrature signal has a
non-zero imaginary part, its Fourier transform Yneed not be symmetric about zero
frequency. In other words, with quadrature signals, positive frequencies and nega~
tive frequencies contain independent infonnation.
t. Since this text has a strong circuits emphasis,denoling the components of a quadrature signal by
I and Q may lead to confusion smce I is often used to represent current, while Q is often used to
represent quality factor or charge. Similarly, denoting the components re and im leads to confu-
sion when dealing with transforms. (The imaginary part of the Laplace transform of a quadrature
signal is not the Laplace transform of the imaginary component of the quadrature signal.)
Instead of using either of the two prevailmg conventions, we adopt the notation (inspired by the
Cartesian representation of a complex number) that a quadrature signal v IS decomposed as
v = Vx + jvy , and refer to the components of v as the x and Y components. respectively. The
Laplace transform of v is then V = V, + jV,. where V.I and vy are the Laplace transforms of
the x and y components of v.
166

I
Quadrature Signals
g
I
pose that the input to such a mixer is the real signal u(t)
Then the output of the mixer is
1
( )
A
(
)
-jwLO'
vt =
cos WLO + w1F txe
(5.2)
Removing the second term in the last expression with a lowpass filter leaves a fre-
quency-shifted version of the original signal, centered at the angular frequency
(t)IF .
A quadrature downconversion mixer is useful because it perfonns a frequency
translation operation that distinguishes between signal frequencies above the LO
and signal frequencies below the LO, whereas a conventional mixer does not make
that distinction. To see this, suppose that the input to the quadrature mixer is a
combination of two signals having frequencies above and below the LO by an
amount equal
to the IF:
xU) = Ajcos(wLO+wIF)t+A2cos(wLO-wIF)t.
Applying this signal to a quadrature mixer and lowpass filter yields the output
A j
.
A2
·
(
)
_
jW1Ft
-jW1Ft
v t
- -e
+-e
2
2
(5.3)
The signal that was located above the LO frequency could be recovered with a
quadrature filter whose passband is located at wIF ' while the signal below the LO
frequency could be recovered wIth a quadrature filter whose passband is located at
-wIF . However, since the output of a conventional mixer is simply the real part of
(5.3), namely
vP)
~
(5.4)
167

5
Bandpass and Quadrature Delta-Sigma Modulation
I-=
It is thus clear that A1 and Az cannot be computed from knowledge of vx(t)
..,
alone.
~
(5.5)
In practice, the ability of a quadrature mixer to distinguish between frequencies
offset from the LO by equal positive and negative amounts is limited by the degree
to which the two real mixers match and the degree to which the two components of
the LO are in quadrature. The image rejection ratio (IRR) specifies the signal
power appearing at -rolF relative to the signal power appearing at OJIF as a result
of an input at ffiLO - rolF" For small errors, IRR is approximately [18]
ERR = 6-1OIoglO[(~Ar +(t>.~)2l
where (8A)/A is the relative amplitude imbalance and 8~ is the phase error (in
radians). Fig. 5.30 indicates that an amplitude imbalance of 2% (0.17 dB), or a
phase error of 0.02 rad (1.1 degree), is sufficient to limit IRR to 40 dB. Higher
image suppression requires proportionally greater amplitude and phase accuracy.
g
w
J
"-
j
j
Ii..
I..i•I..
168

"'e
)f
l!
It
Quadrature Signals
Quadrature signals may be filtered using a quadrature filter. The transfer function,
H, of a quadrature filter differs from that of a real filter in that the poles and zeros
of H need not come in complex-conjugate pairs, i.e. H may have an asymmetric
frequency response. Fonnal manipulation of such transfer functions in symbolic
form is straightforward; realizing a quadrature filter is more cumbersome. One
way to implement a quadrature filter H starts with decomposing H into
H = H x + jHy' where H x and Hy are real transfer functions. t The output of the
filter is
)
v = HU
= (Hx + jHy)(Ux+ jUy)
= (HxUX-HyUyl+j(HxUy+HyUxl
= Vx+jV y
(5.6)
which indicates that a quadrature filter may be implemented with the lattice struc-
ture shown in Fig. 5.31. This figure depicts a two-inputJtwo-output linear system in
which the transfer function from the input Ux to the output Vx is equal to that from
Uy to VY' while the transfer function from Ux to Vy is the negative of that from Uy
to Vx' In practice, these symmetries are not exact, and the reader may well wonder
what impact such an imperfection has.
H---<~Vx
V=Vx+jVy
=HU
H---<~Vy
,
---------------~
Figure 5.31: A quadrature filter.
t. This decompositIOn may be performed by multiplying the numerator and denominator of H by
the complex conjugate of its denominator polynomial, and then gathering numerator terms.
169

5 Bandpass and Quadrature Delta-Sigma Modulation
To address this question, Fig. 5.32a shows an arbitrary two-inputltwo-output real
linear system, whose inputs and outputs are to be interpreted as quadrature signals.
As depicted in Fig. 5.32b, this system can be represented with two complex filters:
one (H) operating on the unaltered signal, V, and the other (Hi) operating on its
conjugate, U... To derive the equivalence, simply write the output of the second
system in expanded fonn:
V=HU+HiV*
.
= (fIxUx-fIyUy) +J(HxUy + llyU)
+ (Hi, xUx + Hi, yV) + j(-Hi, xVy + Hi, yUx>
= (llx+ fI;,)U x + (H;,y-fIy)Uy
+ j«fIy + fI;, y)Ux + (fIx-H;, x)U,,)
(5.7)
iI
~•I ~.-
!.
Thus
(5.8)
or in inversely
!!I•
v
(5.9)
u~
b)
[
fIx
fIy]
H.
H
I, X
I, Y
a)
uy-t,l.[~~
,Vy
~
l
Figure 5.32: Mismatch in a quadrature filter creates an image response.
170
III

al
s.
s:
ts
,d
Quadrature Signals
The upshot of (5.7-5.9) is that path mismatch (HI!" H" and/or H 12 " -H2!)
causes the output of a quadrature filter to contain the conjugate of the input, multi-
plied
by
the
image
transfer
function
Hi = Hi,x+jHi,y'
where
Hi x = H 11 - H22 and Hj
= H21 + H12' Since taking the conjugate of the
input
reflects
its
' Fourier
transform
about
f = 0,
i.e.
(x(t) .... XU» => (x\t) .... X'(-fJ), the image transfer function is responsible for
transferring signal energy from positive frequencies to negative frequencies, and
vice versa. We shall see shortly that in a quadrature 6.L modulator, this mirroring
action can be highly detrimental to the performance of a quadrature modulator.
At this point, it is helpful to consider a more concrete example. Suppose we want
to implement a quadrature filter with transfer function
"'0
H(s) =
.
S - lOla
(5.10)
Since this is a first-order transfer function with a single pole at s = jOla' the
resulting filter will therefore be a positive-frequency resonator. The H x and H y
components of H arc found by multiplying the numerator and denominator by the
complex-conjugate of the denominator, as follows:
"'0 (S +j"'o)
H(s) =
=
s- jwo s + jWa
Thus the required filters are
(5.11)
"'OS
Hx(s) =
2
2 and H (s) =
S +Ol
Y
o
(5.i2)
These two second-order filters, as well as the computations of (5.6) can be imple-
mented with only two real integrators, configured as shown in Fig. 5.33.
171

.
!
I•==
5.6 Quadrature Modulation
As with other modulator types, the starting point in the design of a quadrature
modulator is the NTF. The causality constraint (h(O) = 1) is the same as that of a
real modulator, and optimized zeros are as useful in quadrature systems as they are
in real systems. The stability-imposed constraints on the out-of-band NTF gain
appear to be similar between real and quadrature systems. The only real difference
(pun intended) is that the pole/zero distribution of a quadrature NTF need not be
symmetric about the real axis. Fig. 5.34a shows the pole-zero plot of a quadrature
NTF intended for an f 0 = 1/4, OSR = 32 application. Observe that the NTF
_______-----lfl
5
Bandpass and Quadrature Delta-Sigma MOd_"'_a'_'O_"
1I1
II
II
i
iii
Uy.--~
1-+-....,
Vy
,
~---------------
Figure 5.33: A quadrature resonator, H(s) = ooo/(s - jooo)'
•..••
Figure 5.34: a) Pole·zero and b) magnitude plots for
a quadrature NTF with OSR =32.
I;•i!•
~•
0.5
. ,. -'- .'. -'
..... -,.
--",-
-80 u----,----,---,----,-----,----,---,----,-----,---,-,--,----'----'----'----,----,---'---.J
-0.5
-0.25
0
0.25
Normalized Frequency
o
iii':s -20 ..'.
~.a ·40
·c
I-eo
b)
x
x
172
a)

re
a
re
In
:e
'"·e
p
Quadrature Modulation
zeros are located only in the positive-frequency passband. Fig. 5.34b plots the
associated NTF magnitude. Since the nus attenuation of quantization noise is
approximately 60 dB, this NTF provides 10 bits of resolution in addition to the
2.5 bits resulting from OSR = 32. The expected SNR of a modulator employing
this NTF in conjunction with a pair of 4-bit quantizers is thus about 100 dB
(16.5 bits). (This SNR estimate is identical to that given on page 146 for a band-
pass modulator having similar NTF attenuation, OSR and number of quantizer lev-
els.)
Fig. 5.35 shows the simulated quadrature output data of such a modulator when the
input is a ~3 dBFS quadrature sine wave. As with the bandpass example, the corre-
spondence between the input and output wavefonns appears very coarse in the
time domain, but a much clearer picture emerges in the frequency-domain plot of
Fig. 5.36, from which an SQNR of nearly 100 dB is calculated.
As a final demonstration that the quadrature modulator is indeed operating in
accordance with expectations, Fig. 5.37 plots the simulated SQNR as well as the
Time Step
Figure 5.35: Real (I) and imaginary (Q) components of the output data from
a quadrature modulator containing 16-step quantizers.
173

5
Bandpass and Quadrature Delta-Sigma Modulation
•
I •••;. ••
.".
. .....
.'
,
'
,
.
..... ;.
....... , .
...... ,..... -,.
"
,
.
.
.. ... .,.. ','" ,.....
-40
-20
0,-.-'-,---,----,---,--,-"'-'-'--'--'-'-'-';-1'-'-'-'-'
':SONR = 99 dB
..:•..~ q~1'l ':.3? ..
.
..
..... ',' .. ,
: .. ,.
.
,-
-60'~"•.~.=.~.':;:''''~.:;::.~..~.~.~':;·~"~·~'.:~ill.~:::i;1'="~"~~.~~,.:j;.~•.,'=.i;";;':'
"','
-80
NBW = 4.6x1 0-5 .-
..'. -- '.
"." .. '- ..'... , ...'.
-140' L..,"-J-.-L_-'_L'-'-_-lL..L...-"_L..L....J1_L.L
~.5
-0,25
0
0,25
0.5
Normalized Frequency
Figure 5.36: Output spectrum for a quadrature modulator.
-100
-120
II-
o
'.'
, .
.. ,....'..
80
20
100 ,-,--,---,--,.---,,-,---,--,
.. ,
......, ... ,
,.....
........;-
:.. -;
;..
.. '."
, .
CD
~
60
a:za
40
(/)
.
.
oL-+_"---"----~c'-.---'-.'..-l-+_
-100
-80
-60
-40
-20
Input Amplitude (dBFS)
SQNR vs. input amplitude for the quadrature modulator.
Figure 5,37:
174
.._---
J
~II

Quadrature Modulation
expected SQNR vs. input amplitude curve. For moderately strong inputs (i.e. input
levels above -40 dBFS), the observed SQNR follows the theoretical curve well. A
peak SNR of about 100 dB is observed, and the modulator appears to be stable for
inputs up to -2 dBFS.
Under ideal circumstances, the performance of a quadrature modulator is essen-
tially as predicted. Non~idealities such as finite resonator Q and shift in resonator
frequency have deleterious effects that are similar in magnitude to those found in
real systems, and so are usually not problematic. However, quadrature errors
(caused by mismatch in the two channels) can be a serious source of degradation.
To see this, observe that in the spectrum of Fig. 5.36 the level of the quantization
noise in the passband (around lsi4) is nearly 65 dB below the level of the quanti-
zation noise in the image band (around -lsi4). Path mismatch on the order of
0.1% (caused, for example, by mismatch in the full-scale outputs of the DACs
which feed back to the first quadrature resonator) is sufficient to reflect enough
image band noise to degrade the SQNR by more than 6 dB. Since much more
stringent matching would be needed to ensure negligible performance degradation,
path mismatch can easily be the dominant error source in a quadrature modulator.
Two methods for countering path mismatch havc bcen described in the literature.
The first involves adding one or more image zeros (and corresponding image
poles) to the NTF so that the noise present in the image band is reduced. The depth
of the image notch is adjusted to achieve the desired immumty to path mismatch.
In addition to the increased hardware complexity, reducing the mismatch sensitiv-
ity in this way comes at the price of a reduction in the suppression of quantization
noise and possibly a reduction in the stable input range. The second method for
combatting mismatch applies only to DAC mismatch, and involves the use of
quadrature mismatch-shaping [20].
The structure of a single-loop quadrature modulator follows that of real modula-
tors, namely a loop filter attached to a quantizer. However, the loop filter and the
quantizer are now quadrature systems. A quadrature quantizer is simply a pair of
real quantizers, while the quadrature loop filter is a cascade of quadrature resonator
sections such as that shown in Fig. 5.33. The usual variety of feedback and feed·
forward topologies, as well as single-loop and
multi~loop architectures, are all
175

5
Bandpass and Quadrature DeRa-Slgma Modulation
...
Figure 5.38: A quadrature modulator employiug the feedhack topology.
i
•
i i·-·~· "
i
iii
•••
applicable to quadrature modulators. For example, a feedback topology (using
continuous-time resonators) is depicted in Fig. 5.38, while [21] describes the use
of a feedforward topology.
== =
"" =
5.7 Conclusions
Delta-sigma modulation is applicable to narrowband bandpass and narrowband
quadrature signals, and in this capacity delta-sigma converters are unique in the
converter world. Efficient realizations of high-perfonnance ADCs are possible,
especially if a physical resonance, such as that of an LC tank, is exploited. Band-
pass modulators are currently commercially available as stand~alone ICs and as
sub-blocks in larger ASICs. Quadrature modulators are a more recent development
and appear to be on the verge of achieving similar levels of commercial success.
176
jJi

Conclusions
References
[I)
[2J
[3J
[4J
[5J
[6J
[7)
[8J
[9J
[IOJ
[IIJ
[12J
[13J
[14J
[IS)
[16)
[17J
T. H. Pearce and A. C. Baker, "Analogue to digital conversion requirements for HF radio
receivers," Proceedings ofthe lEE Colloquium on system aspects and applications ofADCs
for radar. sonar and communications, London, Nov. 1987, Difest No. 1987/92.
S. A. Jantzi, M. Snelgrove and P. F. Ferguson, Jr., "A 4' -order bandpass sigma-delta
modulator," Proceedings ofthe IEEE J992 Custom Integrated Circuits Conference, Boston,
MA,pp.16.5.1-16.5.4,May3-61992.
G. TrOster, H.~J. Dre81er, H.-J. Golberg, W. Schardein, E. Zocher, A. Wedel, J. Arndt, ''An
interpolative bandpass converter on a 1.2~m BiCMOS analog/digital array," IEEE Journal of
Solid-State Circuits, vol. 28, no. 4 pp. 471-477, April 1993.
A. Hairapetian, ''An 81MHz IF receiver in CMOS," IEEE Journal ofSolid-State Circuits,
vol. 31, no. 12, pp. 1981-1986, December 1996.
O. Norman, "A bandpass U
modulator for ultrasound imaging at 160 MHz clock rate,"
IEEE Journal ofSolid-State Circuits, vol. 31, no. 12, pp. 2036-2041, December 1996.
S. Bazarjani and W. M. Snelgrove, "AI60-MHz fourth-order double-sampled SC bandpass
sigma-delta modulator," IEEE Transactions on Circuits and Systems II, vol. 45, no. 5,
pp. 547-555, May 1998.
J. A. E. P. Van Engelen, R. J. Van De Plassche, E. Stikvoort and A. G. Venes, "A sixth-order
continuous-time bandpass sigma-delta modulator for digital radio IF," IEEE Journal of
Solid-State Circuits, vol. 34, no. 12, pp. 1753 -1764, Dec. 1999.
G. Raghavan, J. F. Jensen, J. Laskowski, M. Kardos, M. G. Case, M. Sokolich and S.
Thomas III, "Architecture, design, and test of continuous-time tunable intermediate-
frequency bandpass delta-sigma modulators," IEEE Journal ofSolid-State Circuits, vol. 36,
no. 1, pp. 5-13, Jan. 2001.
P. Cusinato, D. Tonietto, F. Stefani and A. Baschirotto, "A 3.3-V CMOS 1O.7-MHz sixth-
order bandpass La modulator with 74-dB dynamic range," IEEE Journal of Solid-State
Circuits, vol. 36, no. 4, pp. 629-638, April 2001.
T. Salo, S. Lindfors and KAT Halonen, "A 80-MHz bandpass AI modulator for a 1OO-MHz
IF receiver," IEEE Journal ofSolid-State Circuits, vol. 37, no. 7, pp. 1798 -808, July 2002.
Analog Devices, Inc., AD9870 datasheet, Norwood, MA: Analog Devices, 1999.
Analog Devices~ Inc., AD9874 datasheet, Norwood, MA: Analog Devices, 2002.
S. A. Jantzi, K. W. Martin and A. S. Sedra, "Quadrature bandpass AL modulation for digital
radio," IEEE Journal ofSolid-State Circuits, vol. 32, no. 12, pp. 1935-1950, Dec. 1997.
T. Paulus, S. S. Somayajula, T. A. Miller, B. Trotter, C. Kyong and D. A. Kerth, "A CMOS
TF transceiver with reduced analog complexity," IEEE Journal ofSolid-State Circuits, vol.
33,no. 12,pp.2154-2159,Dec. 1998.
C. H. Leong and G. W. Roberts, "High-order bandpass sigma-delta modulators for high-
speed D/A applications," Electronics Letters, vol. 33, no. 6, pp. 454-455, March 1997.
J. Keyzer, R. Dang, Y. Sugiyama, M. Iwamoto, I. Galton and P. M. Asbeck, "Generation of
RF pulsewidth modulated microwave signals using delta-sigma modulation," IEEE MFT-S
International Microwave Symposium Digest, vol. I, pp. 397 -400, Sept. 2002.
R. Schreier, J. Lloyd, L. Singer, D. Paterson, M. Timko, M. Hensley, G. Patterson, K. Behel
and 1. Zhou, "A 10-300 MHz IF-digitizing Ie with 90-105 dB dynamic range and
15-333 kHz bandwidth;' IEEE Journal of Solid-State Circuits, vol. 37, no. 12, pp. 1636-
1644, Dec. 2002.
177

5
Bandpass and Quadrature Delta-Sigma Modulation
[18]
B. Razavi, RF Mlcroelectromcs. Englewood Cliffs. NJ: Prentice-Hall, 1997.
[19]
1. Van Engelen and R. Van De Plassche. Bandpass sigma delta modulators- stability
analysis, performance and design aspects. Norwell, MA: Kluwer Academic Publishers
1999.
[20]
R. Schreier. "Quadrature mismatch-shaping." Proceedings, IEEE International Symposium
on Circuits and Systems, Vol. 4. pp. 675-678, May 2002.
[21]
K. Philips, "A 4.4mW 76dB complex L8. ADC for bluetooth receivers," IEEE International
Solid-State Circuits Conference Digest of Technical Papers, pp. 64-65, Feb. 2003.
178

CHAPTER 6
Implementation Considerations
For~ADCs
In this chapter, some of the implementation issues arising in the design of 6.L NO
converters will be discussed. These include the choice between single-bit and
multi-bit quantizers, and algorithms which can effectively linearize the internal
DAC in multi-bit quantizers. Also, the relative advantages of sampled-signal and
continuous-time loop filters will be analyzed, and the design of modulators with
continuous-time loop filters will be addressed.
6.1 Modulators with Multi~Bit Internal Quantizers
As already discussed in Chapter 4, the use of multi-bit quantizers offers many
advantages, including the following:
1. For a fixed full-scale, the quantization error is reduced by 6 dB for every bit
added to the resolution of the quantizer. Hence, the SQNR is increased by this
amount, and the stopband performance of the decimation or reconstruction filter
used to suppress the out-of-band noise can be correspondingly relaxed.
179

6 Implementation Considerations For IU: ADes
2. The feedback loop becomes more linear, since the variations of the effectIve
gain of the quantizer with its input signal are reduced. Hence, the stability is
more robust, and the performance is closer to what a linear analysis predicts.
Thus, the simulation effort needed to predict the expected perfonnance can be
reduced.
3. Due to the improved loop stability, the NTF can be chosen more aggressively.
Hence, better SQNR can be obtained, and/or larger input signals can be
allowed. For example, for a 5th-order single-bit modulator with OSR = 16, sta-
bility considerations limit the SQNR to about 60 dB; using a 4-bit quantizer, the
reduced quantization noise and improved stability combine to increase the theo-
retical peak SQNR to about 120 dB'
4. Since the DAC input to the loop filter changes less from sample to sample, the
required slew rate of the input op amp of the loop filter is reduced. This may
allow lower power dissipation.
5. Since the difference between the input and the DAC signals entering the loop
filter is smaller, the linearity requirements on the input stage of the filter can be
eased.
6. Finally, for DACs and for ADCs with continuous-time loop filters, the smaller
steps in the DAC wavcfonn make the operation less sensitive to clock jitter, as
will be discussed in Section 6.6.
Regarding item 2 and referring to Fig. 6.1, the "instantaneous gain" of the multi-
bit quantizer is
e(n)
.......4-_v(n)
ADC
u(n)--.(+).....;~ Loop
Filler
y(n)
eD(n) "-_-J
N
180
DAC
Figure 6.1: Signals in a common 6L ADC topology.
--.-------~- J- !!
-
-
L

Modulators with Multi-Bit Internal Quantlzers
Hence, the gain deviation from the nominal gain 1 is at most .6./12 . y(n)l, where
1:1 is the LSB voltage of the quantizer. Note that the deviation is large for small
yen) which cannot overload the quantizer, and smallest for large quantizer inputs,
where instability is most likely. By contrast, for a I-bit quantizer, the instantaneous
gain (with the normalization used in Fig. 2.4) is l/y(n), which can take on any
value as yen) changes, and tends to zero as yen) becomes large. As the discussions
of Chapter 4 showed, small values of ken) are likely to result in instability for
higher-order loops.
'e
IS
;.
e
I.
e
,
k(n) = v(n) = y(n) + ern) = 1+ ern)
y(n)
y(n)
y(n)
(6,1)
Against all these advantages stands a single large disadvantage: as can be seen
from the location of the DAC in the feedback path between the output and the
input of the loop (Fig. 6.1), any error edn) in the DAC response will be directly
subtracted from the input signal u(n) and hence it appears at the output without the
benefit of noise shaping.
Especially damaging is the fact that any nonlinearity of the DAC will introduce a
corresponding nonlinear signal distortion into the overall ADC response. To see
this,
assume that the nonlinear input/output characteristic of the DAC is
wen) = F[v(n)]. Since, due to the operation of the feedback loop, to a very good
approximation w = u holds within the signal band, for a nonlinear characteristics
F[o] the output v(n) = F-l[w(n)] = F-l[u(n)] will contain the nonlinearly dis-
torted version of u(n).
Clearly, for an N-bit ADC linearity, the DAC needs to be linear to at least N bits.
Since it is hard to realize a DAC with a linearity much better than 10 - 12 bits
without trimming, other methods must be used to achieve the 16- to 19-bit ADC
linearity typically needed. The most useful ones of these methods can be classified
into dual-quantization, mismatch-shaping and digital correction schemes. They
will be discussed in the next sections.
181

ii
'""
..
..
i;;
II
6 Implementation Considerations For ~ ADCs
6.2 Dual~Quantizer Modulators
The fundamental idea behind the dual-quantization architectures is to use a single-
bit quantizer where the DAC nonlinearity is most critical, i.e., where the DAC out-
put is directly subtracted from the input, and use one or more multi-bit quantizers
elsewhere in the system. The circuit will have two or more digital outputs which
are combined in such a way that the large error introduced by the single-bit quan-
tizer is cancelled. The simplest example of this technique is the Leslie-Singh archi-
tecture, already described in Section 4.5.1 and depicted in Fig. 4.20. The single-bit
quantizer Q makes it possible to achieve high linearity in the first stage which pro-
cesses the input signal u. The large quantization error el of Q is then converted by
the multi-bit ADC into digital fonn, and cancelled in the output using the noise-
cancellation logic implemented by the digital blocks HI and H2' The final output
v ideally contains only the input signal u and the filtered and inherently small
quantization error e2 of the second-stage ADC.
______________ Ifl
•i
-----------------~-------
1
Next, some more elaborate schemes will be shown for implementing the dual-
quantization principle.
, !
!!!!
6.2.1 Dual-Quantization MASH Structure
As an extension of the Leslie-Smgh scheme, a two-stage MASH can be imple-
mented so that the second stage contains a
multi~bit quantizer (Fig. 6.2) [1]. The
nonlinearity of the multi-bit DAC (here, a 3-bit DAC) in the second stage will not
introduce signal distortion, since the input to the second stage (at least ideally)
contains only the quantization error ej of the first stage and not the input signal u.
Also, the nonlinearity error eD of this DAC will be filtered along with ej by the
digital highpass filter 112 , and hence will be suppressed in the signal band. The
overall output is still given by Eq. (4.52), where E2 is now the small error due to
the multi·bit second-stage quantizer. The improved stability of the second stage
makes it possible to use a more aggressive noise shaping function NTF2 here.
The principle can be extended to 3-stagc MASH structures, with a binary first
stage and multi-bit second and third stages.
..
--_.~--------------
182

t-
os
h
,-
,-
it
y
Dual·Quanttzer Modulators
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
-0_ _ -
As discussed in Section 4.5.3, the imperfections of the analog elements will affect
the cancellation of the first-stage quantization error. This is a key limitation on the
perfonnance of all multiple-quantizer schemes.
6.2.2 Dual-Quantization Single-Stage Structure
It is also possible to use dual (both single-bit and multi-bit) quantizers in a Single
delta-sigma loop [2], as shown in Fig. 6.3 for a third-order structure. Here, the
DAC signals fed back to the inputs of the first and second integrators are single-bit
ones, and hence it is possible to achieve high linearity for these signals. A multi-bit
signal is fed back to the third integrator. The nonlinear distortion introduced by the
N-bit DAC generating this signal is divided by the product of the transfer functions
of the first two integrators, and hence can be negligible for high OSR. By combin-
ing the outputs of the single-bit and multi-bit ADes, el can be cancelled and
replaced in the output by the quantization error e2 of the N-bit ADC. The overall
output is then given by
1
z=1
1-bi!
ADC
1-bit
DAC
r-----<.~'--....J
V,
+
1
z=1
3 bOt
V2
Noise
W
-
I
h--'-'-JCancellation
ADC
Logic
3-bi!
DAC
Figure 6.2: A third-order dual-quantization cascade ADC with multi-bit
second stage.
_________ 0_-
183

6 Implementation Considerations For 6I ADCs
Since the use of multi-bit quantizers reduces the input signals of both quantizers,
the loop stability is improved compared to that of a simple binary loop. The effect
of nonlinearity in the multi-bit DACs can be further reduced by using one of the
low-distortion structures discussed in Section 4.4 for the loop filter.
I~
!!
~.
~ I
" I
";; .-
,j•
~.
~ I
Since the cancellation of e I is contingent upon the equality of analog and digital
transfer functions (just as in the MASH structure), the imperfections of analog
components (finite op-amp gains, capacitor mismatches) will introduce single-bit
quantization noise leakage in this structure also.
6.3 Dynamic Element Randomization
Element mismatches in the multi-bit DAC introduce an output error, which con-
sists of the harmonics of the input signal as well as an increased noise floor due to
the folding of high-frequency quantization noise into the signal band. In some
cases, the increased noise floor (and the resulting reduction of the SQNR) is
acceptable, but the harmonic signal distortjon is not. In this case, a randomization
of the static nonlinearity of the DAC may provide a simple solution to the problem,
by converting the energy of the hannonic spurs into pseudo~random noise [3}. The
process can be carried out conveniently if the input of the DAC is a thennometer-
I
I iii
I ;;
l-bit
DAC
z
1
1-bit
V,
3z-1_2z-2
z-1
z-1
ADC
ED
N-bit
V,
ADC
2(1_z-1)2
N-bit
DAC
Figure 6.3: A third-order, dual-quantization, single-path ADC.
184
•
: -
=

DynamIc Element Randomization
coded digital signal, and the DAC is built from unit elements (equal-valued
switched capacitors or current sources). The data conversion is petformed by acti-
vating K unit elements if the value of the input code is K. The error randomization
is achieved by choosing these K unit elements randomly each time. Then the DAC
error eDen) at time n will not be correlated with the value of its input v(n), and
hence the signal distortion is replaced by random noise in the DAC output. A sche-
matic block diagram of the system implementing the process is shown in Fig. 6.4
[4].
To illustrate the effect of error randomization, Fig. 6.5 (4) compares the output
error spectra of a third-order ADC with a 3-bit quantizer, without and with ran-
domization. It is assumed that the DAC is built from unit elements with a
(-D.l%, +0.1%) linear-gradient mismatch. Fig. 6.5 shows that applying random-
ization eliminates the large second harmonic spur caused by this static DAC non-
linearity, but unfortunately also increases the noise floor.
Digital
input
Thermometer
8M
Unit
-
decoder
element
~
8M-l
Unit
ele~entl\
Arbitrary
connection
•
+
switchbox
·V
82
t
Unit
element
Random-
8,
number
Unit
generator
element
Analog
output
Figure 6.4: Parallel-unit-element DAC with randomized element selection.
185

6 Implementation Considerations For to!; ADCs
6.4 Mismatch Error Shaping
The basic operating principle of delta-sigma data conversion, namely noise shap-
ing, can also be utilized to reduce the effects of the nonlinearity in a multi-bit
DAC. Here, the "noise" is the mismatch error introduced by the uneven spacings of
the DAC levels, rather than the quantization error, but the procedure used is the
same: use filtering to suppress the noise spectrum in the signal band and to shift its
power to out-of-band frequencies. There are a number of strategies which can
achieve this [4]. The most commonly used ones are element rotation (also called
data*weighted averaging), individual level averaging, vector-based mismatch
shaping and tree-structure element selection. All these techniques utilize the unit-
element DAC structure shown in Fig. 6.4, but each uses a different strategy for the
selection of the unit elements for a given digital input code. These strategies will
be discussed in the next subsections.
A common underlying assumption of these element-selection algorithms is that the
offset and gain errors of the DAC (which introduce corresponding offset and gain
errors into the transfer characteristics of the overall 8L ADC) are acceptable, and
only the DAC nonlinearity error is of concern. This assumption is valid in many
o~~~~~~-~---~t=-===_·.::.:.;_·=':::::;
-20
::: '::.::: -
Randomized
.. ,. -- Not randomized
.. .; ....:
.;.
.....
, ".'.
'.' ."
,
.
.. ;'
..... : .... ;
..........
"
.., ; '::. NBW =' 2.3'-10--5
.-'L-~'----'-----'--Ll
...
'
,"
"
","
. ,.,." ..
10-2
10-1
Normalized Frequency
Figure 6.5: Output spectra of a 3rd-order 3-bit modulator, with and without
element randomization.
186

Mismatch Error ShapIng
Next, let each unit element have the actual value uj
:;;; V + di (i = 1, 2, .. " M).
Here, U is the average element value
practical applications, and it is necessary to make, since no element selection
method can reduce the offset OS (i.e., the DAC output when the input code is zerO,
so no unit element is used) or affect the full-scale value FS when all elements are
used (Fig. 6.6). Hence, the effective gain (FS - OS)/M (where M is the full scale
digital input to the DAC) cannot be changed by any element selection logic either.
Therefore, we must assume that these values are the correct ones, and hence that
the "ideal" M-element DAC input-output characteristics is described by the linear
function
(6.3)
k = 0, 1,2, ...,M
'e
ts
n
d
h
p-
lit
)f
e
'j
M
U = LU/M
(6.4)
i = I
and the dl are the deviations of the u/ from the average. From (6.4), it follows that
w(k)
(analog output)
•
FS
187
o
2
3
4
Figure 6.6: Outputs of a 4-element DAC.
I
j~
as I--r-...-r-~~k(digital Input)

6 Implementation Considerations For L\I: ADCs
The full-scale output is therefore
M
FS = as + L"i = as + M . U
j == 1
and the ideal output for an input k is
w(k) = as + k· U,
(6.5)
(6.6)
(6.7)
An interesting and important property of unit-element DACs concerns the symme-
try properties of the possible DAC outputs shown in Fig. 6.6, which shows the pos-
sible characteristics of a DAC with M
:::: 4 inaccurate unit elements. As explained
earlier, for input codes k
:::: 0 and k :::: M :::: 4 the analog output is unique. For
all other inputs, however, due to the matching errors di, different outputs result
from different selections of the unit elements used to produce the output. For
example, for k :::: 2, the first unit element used may be chosen four different ways,
while the other one three different ways. Since the order of selection is immaterial,
we have 4 x 3/2 :::: 6 possible outputs for the same input code. Three of these
selections will include u1, three will include uz, etc. Hence, when we calculate the
average value of all 6 possible outputs for k
:::: 2, we find
4
4
w(k) = as + 3· L"/6 = as + 2U + 0.5· L di = as + 2U
(6.8)
1==1
;==1
which is the same as the ideal value calculated from (6.7). Thus, the average value
of all possible outputs lies on the ideal DAC characteristic line connectmg the
k :::: 0 and k :::: M points. This statement is generally true, and is utilized in some
of the element selection algorithms described below.
-----
188
I
I I
II
i
iiii~
I~~

Mismatch Error Shaping
6.4.1 Element RotatiOll or Data-Weighted Averaging
The element rotation [5] or data-weighted-averaging (DWA) [6] algorithm aims to
make the long-term average use of each unit element in the DAC the same, by
rotating the pattern of unit elements. Consider a DAC with 8 unit elements, and
visualize them arranged in a circle (Fig. 6.7). Let the first input code be 3; then ele-
ments 1,2 and 3 will be used. Let the next code be 4; then the next 4 elements (4,
5, 6 and 7) will be called to duty. If the next code is a 6, then we wrap around the
circle, and use elements 8, 1, 2, 3,4 and 5. Thus, we use all components sequen-
tially, and as often as possible.
To understand the effect of DWA on the time response and spectrum of the DAC
error induced by the mismatches di, next we shall examine the sequence of DAC
output errors e(n) ("mismatch noise") generated during the conversion. A limit
can be found for the sum of all errors
l
N
s(N) = L ern)
II :: I
Figure 6.7: Element rotation.
(6.9)
189

6
Implementation ConsideratIons For 8:E ADCs
accumulated during the operation over N clock periods. Specifically, as the conver-
sion progresses and cycles around the dial of unit elements, every time it reaches
element 8, seN) is reset to 0, since the sum of errors dj for all 8 elements is zero.
Hence, for any N, Is(N)1 is at most equal to PI2, where P is the sum of the absolute
values of the errors in the 8 unit elements. P is a finite (in fact, relatively small)
number. The average value of the error samples e(n) after N clock periods thus sat-
isfies
le(N)I", = Is(Nll / N S P/ (2N) -> 0 as N -> =.
Hence, the long-term average value of e(n) is zero, a very desirable result.
(6.10)
!!!!
--
Next, let the power spectrum of sen) be S(w). Since sen) is bounded by P12, it is
reasonable to assume that (for a random and busy input signal) sen) will behave
like a bounded white noise so that Sew) will be a uniform noise spectrum. Since,
by the definition of s(n) , the relation e(ll) = sen) - sen - 1) holds, the power spec-
trum of e(n) satisfies
E(wl = II_e-jroI2 . Sew).
(6.11)
Hence, the mismatch noise is shaped by a first-order highpass filter function. The
noise shaping is thus similar to that encountered by the quanttzation noise in
MODI.
As in the case of MOD1, however, tone generation is a major problem with the
DWA algorithm, if the DAC input is not a busy random signal but a dc or a low-fre-
quency periodic one. Assume, e.g., that the input to the 8-element DAC of Fig. 6.7
is a dc digital signal with a value of 6. Then the element sets used will be
SI = (1,2,3,4,5,6);
S2 = (7,8,1,2,3,4);
S3 = (5,6,7,8,1,2);
and
S4 = (3,4,5,6,7,8). After that S5 = SI' S6 = S2' ele. Thus, e(n) will be a
periodic signal with a line spectrum, not a highpass-filtered noise. The tonal char-
acter of e(n) can be changed by introducing a random or pseudo-random effect
(e.g., random element skipping, or bidirectional rotation) into the process. In the
latter scheme (named bi-DWA in [7]), the direction of the rotation is inverted in
every cycle. Each directional rotation proceeds independently from the other. As
190
----JII

Mismatch Error Shaping
the simulation results of Fig. 6.8 illustrate, this increases the spurious-free
dynamic range, but also increases the noise ftoor by approximately 9 dB.
6.4.2 Individual Level Averaging
Individual level averaging (ILA) [8] is another technique for introducing a first-
order highpass filtering of the mismatch noise. Instead of attempting to equalize
the use of all elements for all codes over a long time period, ILA tries to equalize
their usage separately for each code over time. Since the average error of all selec-
tions for a given code is zero, as shown in the derivations of (6.8), cycling through
all possible selections sequentially will result in the elimination of the average
error (de error) of the DAC. An alternative is to cycle through all elements for a
given code k, making the probabilities of element usages the same. The simplest
way to carry this out is to use the DWA algorithm for each code, i.e., for a given
code k rotate the elements used by k places each time the code occurs, and wrap
around after the Mth element has been used.
Compared to the DWA method, ILA converges more slowly to the zero-average
condition, which reduces the effectiveness of the technique, especially for large M.
.; ...'
.; .. -.'
... ;
:: ..'. j TI=- Bi~DWA.]
............
.;.'.;.: --DWA
: .'
'.'.
;
:.
.
..
. ,. '.' ,., ".' . . .
. , .
',' "
.', :.', ...
.'..'. ,.....
..'. -:. :-:.:.
, . , .
..:..
..... ,',: ..
.. '..
Figure 6,8:
..'__
,
.J
-140 ~~~~~~~.~.~..:.'2···1··=·.~.:.:..~..j,~±:.:·L..j::.:·.~•. ~
.• ·~'L.':,:",!N~B~W'G~~2,:,.3~·X1l1 0~'-5~
10-3
10~2
10-1
Normalized Frequency
Simulated spectra for 8-element DWA and Bi-DWA
with 1% element mismatch.
0
.'.
.:-
!
-20
;;:
-
-
•
m -40
•
Z
..
en -60
~-
u.
'.
m -80
u
-100
..:
'.'-
-120
.'.
-
_._-_.- ----------------------
191

6
Implementation Considerations For ,'"L ADCs
On the other hand, it is less affected by any correlation between the mismatch
shaping and the DAC input signal, and is less likely to generate tones even for de
or periodic inputs.
Fig. 6.9 illustrates the output spectrum of a third-order ..6.L loop with a 3-bit DAC,
when ILA was used with DWA rotation for each code. No hannonics or spurious
tones are visible in the spectrum, but the noise floor is higher than when element
rotation is used.
6.4.3 Vector-Based Mismatch Shaping
The mismatch-error-shaping techniques described in the preceding sections are
specifically tailored to achieve first-order error filtering, since they are based on the
averaging of errors. A more general strategy, which can achieve higher-order spec-
tral shaping [9] is described next. It actually involves the implementation of M dig-
ital noise-shaping loops, one for each unit element. Fig. 6.10 shows an error-
feedback loop which generates the bit xi turning on or off the ith unit element.
Here, xj(n) is produced by a digital comparator whose output is I (0) if its input
1ft
Ii ..
i
!II••i•
! ::
••·
I!
....
Ii
~
I;:
~ i
~
H-
~
•,
-
--
192
•i•!!
i
II
.!..
I; =
•1-
·:J-
1-
1=•I-
I
i
.. ,.
...." ..,-
Figure 6,9:
°C=T~3~===~--CS=='='=;]'
~ ~:HH'H:':::
H:::::I~~A]
Z
-£0
12
III -£0
'0-100c..:...,.:.'':';H;;.....-:,',~H""."4~'Ii'.'4'W;11'!l':
-120t~H_'~"I':-~'~' J'·~·J·'~·~j·~··j·t~~l··
H'·H'H·"
...
...,
·H:>::NBW ~ 23~1O:.s
-140
--....<-----~. , !
~....._..•_~ L
,". -_.•
1~3
1~
1~1
Normalized Frequency
Spectrum for 8-element ILA with 1% element mismatch.

Mismatch Error Shaping
w/(n) is greater (smaller) than a time-varying reference r(n). Its quantization error
is ei(n). Note that the input fen) and the reference r(n) are the same for all M
loops, as is the NTF H(z) .
The digital loop needed is very simple. For first-order mismatch shaping by
1 - z-1, the loop filter contains only a delay z-1; for second-order shaping with
(1 - z-1)2 it contains two adders, two delays and a binary-point shift, realizing
z-I(2-el ).
Linear analysis shows that
X,(z) = F(z) + H(z)E,(z)
and in the time domain
x,(n) = f(n) + lh"i](n)
where the asterisk denotes discrete convolution.
The output of the DAC with input bits xi(ll) will be
(6.12)
(6.13)
Figure 6.10: One of M error·feedback loops in vector mismatch-shaping.
II•..
~
II
!!!..
!!
f(n)
,t-
wi(n)
Digital
r(n)_ Comparator
Ii (n)
comparator
e (n)
- reference
IH(z)-t:
i",-i='
Xi(n)
i-
>=I j
193

___~-:--:-~-=-~
I:r---
6
Implementation Considerations For 6L ADCs
1.:. i
M
M
Y(I1) = L ",(11) = L x,(n) [ U + d,]
i = 1
i = 1
M
M
= UL xi(n) +L {fen) + [h*ej](n)}' d,
i=l
i=1
(6.14)
Here, the first term on the RHS is the ideal DAC output, for all unit-element errors
d i = O. The second term gives the DAC error eD(n). It can be rewritten as
i
i •
! ..
•
~
M
M
eo(n) = J(n)· L d, + hen) *L [d, e,(n)]
i = 1
i = 1
(6.15)
The first tefm is zero, as (6.5) shows. The second term is the filtered and weighted
sum of the output noises of all M digital mismatch-shaping loops. Hence, edn)
itself will be a noise-like signal shaped by H(z). The order of the noise shaping is
determined by that of I-/(z) , and (unless instability occurs) may be of arbitrarily
high order. To prevent tone generation in the digital loops, dither signals may be
injected at the inputs of the comparators. MASH and/or multi-bit loops may be uti-
lized to improve the stability conditions, provided the elements can be used multi-
ple times in a clock period. Finally, the system can be generalized to the use of
elements with non-equal weights.
So far, the two inputs fen) and r(n) , which are common to all loops, have not
been determined. In fact, r(n) and the digital comparators need not be imple-
mented; their presence in the loop shown in Fig. 6.10 is symbolic. The actual oper-
ation is to assign to a total of K outputs xj(n) the value 1, and to the rest the value
O. Here, K is the value of the input code v(n) to the DAC. As (6.15) indicates, the
DAC error can be reduced by making the ej(n) as small as possible; this will be the
caseiftheKlargestwi(n) arequantizedtoxj(n) = l,andtheresttox/n) = O.
194
-•I•
• iiiIIi
• ~
•

Mismatch Error Shaping
The system described above can be regarded as a single delta-sigma loop operating
on vectors containing the xj ' ei' W j and t j utilizing a quantizer which truncates
........ " .. "':
(
..... ,
,
'.' ..... ,,;.
. ., .
.,.".,,,,.
.,-
.
,
,
,~~.
'::;NBW~2,3~;O:.;;
. ·l·
. .J.
-i·
~'---'--'-.;C'~~="":"::,,.~,,~-.-:-'",---;:::::r:==~
",
",
-
No shaping
;.. ;.::::~::::'
':::.:::::'::'
'., -1s'-order
,
, L"'""
t •••
.;.:.:-:-:.:.
..'•.
_
2nd-order
•••• J
;"'"'.'~
, •••••••••••••••••
~,.
',~~~
-,Ideal
.. ,..
.... ; ...;...;- ~.;.; .:.:-:
. .;.. ~.;-:.\.:.:.:.
,...,. " ... , ...
Figure 6.11:
o
-20
-40
~
--60
~
-80
til -1001-~-+~~'!"""~.....~~~~
" -120
=;:~ [~~,l·~,:fb::±:~::±::±••:'.~:t;t]t~'"'"""
10-4
10-3
10.2
Normalized Frequency
Spectra for 8-element vector mismatch shaping.
Fig. 6.11 shows the output spectra of a third·order 16-level ADC for several mis-
match scenarios when the input is a half-scale sine-wave and the oversampling
ratio is 50. With an ideal DAC, SNR = 108 dB can be achieved. When 1% mis-
match occurs between the DAC elements, the noise floor rises and large hannonics
become apparent. The SNR deteriorates catastrophically, to about 50 dB. For sec-
ond-order mismatch shaping, the SNR recovers to about 105 dB; for first-order
shaping (which is equivalent to element rotation), the SNR is about 97 dB. Note
that the slope of the noise·floor for the ideal ADC is 60 dB/decade, due to the
third-order noise shaping of the loop; for the ADCs with nonideal DACs, the order
of mismatch shaping detennines the slope of the noise floor (40 dB/decade for sec-
ond-order shaping, 20 dB/decade for first-order shaping).
The choice of fen) can be based on making all data in the loop positive, and at the
same time making their magnitudes as small as possible, to keep them bounded
and the loop stable. This will be achieved if fen) =
-m~n [lj(n») is used.
,
195

6 Implementation Considerations For l!.}: ADCs
=''''''-
__..
'il•
!
the vector of the
W j' Hence, it sometimes called a vector quantizer mismatch
shapero
6.4.4 Element Selection Using a Tree Structure
Another mismatch-shaping strategy using internal delta-sigma modulation, which
can also provide higher-order (in practice, second-order) mismatch noise filtering,
is based on the tree structure architecture [10] shown in Fig. 6.12 for M = 8 unit
elements. The structure consists of log2(M) layers of switching blocks (SBs), each
of which splits its input data into two output signals whose sum equals the input.
The input to Layer 1 is slightly over 3 bits, corresponding to 9 possible values
(0,1,2, ..., 8). Hence, as illustrated, the input x(n) must have a 4-bit word-
length. Alternatively, the signals shown in Fig. 6.12 can be encoded in unary (ther-
mometer-code) form, in which case the total number of bits entering and leaving
each layer is 8. Thermometer-coding is advantageous because it avoids the ther-
mometer-to-binary conversion of the multi-bit flash converter's output.
x(n) 4
Layer 3
'--'3
8 3,1
3
Layer 2
Layer 1
1
8, ,4
1-b DACs
196
Figure 6.12:
Tree~structured mismatch-shapero

Mismatch Error Shaping
For switching block Sk r' the first subscript k denotes its layer, which also indi-
cates the number of bits'in its output. The second subscript r denotes the SB's loca-
tion within its layer. The last layer contains I-bit outputs, each of which then
activates a I-bit DAC, i.e., a unit element. Since the sum of the codes in each layer
remains the same, the tree simply rearranges the location of the Is as a code npples
down from the single M-bit input to the final M I-bit outputs. The function of the
structure is to select the final location of the Is, and thus choose the unit elements
activated, in such a way that the resulting DAC mismatch noise is highpass filtered.
The structure of switching block Sk r is shown in Fig. 6.13. It contains a sequence
generator, which generates a I-bit sequence sk ,(n) of special properties. It can be
shown [10] that the final DAC mismatch noise' will be a weighted sum of the Sk r
sequences, and hence it will be shaped by an Lth_order highpass filter function,' if
each sk
(n) sequence has an Lth-order spectral shaping.
.,
A simple method which can generate sk
(n) for first-order (L = 1) shaping is to
.,
use the rule
k
k
,,-.-,.+}------.J
~----------------------------,
,
,
,,,,,,,,,,,,,,,,
,
J
1,0,0, ...,0, -1, 0, 0, ...,0, I. O. 0,...
(6.16)
Here, the sequence of zeros is interrupted by a 1 or -1 (alternating) when an odd
xk, r(n) enters the SB. Clearly, the sum of the sk, ,(n) from n = 0 to infinity is
Figure 6.13: Switchiug block.
-----------
197

6 Implementation Considerations For ~ ADCs
•I
---------------------
between -1 and 1, and hence its power spectral density has a zero at dc, indicating
first-order noise shaping. A similar sequence can also be obtained by using a first-
order digital t!:E modulator loop as the sequence generator; an sk /n) sequence
with second-order shaping can also be obtained, by using a second~order ill: loop.
Figs. 6.14a and 6.14b show, respectively, a first- and second-order loop capable of
generating shaped sk /n) sequences. In FIg. 6.14b, the quantizer is mid-tread
when xk /n) is odd and mid-rise when xk /n) is even. As discussed above, using
such a loop will result in first- or second-'arder mismatch shaping for the overall
DAC.
Fig. 6.15 illustrates the performance of an 8-element DAC with ideal unit ele-
ments, as compared with 1%-mismatched unit elements selected by scrambling, as
well as by first- and second-order mismatch shaping. Clearly, the low-frequency
=
=
L-__--< -11-----'
a)
1
z-1
LSB of xk ,(n)
,
sk,,(n)
J••"•-
,
i
:;
ii
b)
LSB of xk,r(n)
z
z -1
1
z=1
midtread/midrise
Quantizer
(t>=2)
Limiter
Figure 6.14: Switching sequence generators: a) first·order; b) second-order.
!!
198

Digital Correction of CAe Nonlinearity
noise shaping is much improved by mismatch shaping. Also, note that the
improvement offered by second-order shaping is significant only if the OSR is
large (say, greater than 64).
6.5 Digital Correction of DAC Nonlinearity
The multi-bit modulators discussed in Section 6.2 reduce the effects of multi-bit
DAC nonlinearities by using multi-bit DACs only in branches where only a filtered
version of the resulting nonlinearity error appears in the output signal. The
schemes described in Sections 6.3 and 6.4 convert the error signal introduced by
the nonlinearity of the multi-bit DAC into a pseudo-random noise, and (in most
systems) also shape the power spectral density of this noise such that the in-band
noise power is reduced. All these schemes rely on oversampling and noise-shap-
ing, and hence become ineffective for very low values (4 - 8) of the OSR, which
are sometimes needed in broadband data converters.
In this section, different strategies will be discussed. These are based on acquiring
the DAC errors in a digital fonn, and then cancelling their effects in the digital
domain. The acquisition can be performed at power-up, or as a background process
during normal operation.
-
Scrambling
-1storder
-
2nd·order
--Ideal
. . .. " ..
..' ..' .'. ,.'
.
.. '_.'
,.'
.
or--'--'--'-""""=--'-'-'~..~.~..~,--~===~-"'-~
..
. ..,.
-20
,."
.
-40
,..
. . ,
~. :';' : ~.:;.
s: -60
'- ...... """:'::'
lD
... !..-:.. ;
~':-;'::.
..~_.:
.'.!.'_'.'_'..
ijj -80
..
:
, .. ,
.-;-'
,'
,.....
'....
,.,'..
~-1001---:-""'~.-::-,.;.;...:...;-:-.:.~:.:...- ...~.~,~.",:"!"~!'!'!'''''~,...:j;;l~.--.-n:;:
:::: ..:::
'0
_.... ,.,
.. ,.......
.,., ."",.
,.
-120
..
j ••••• ,.,
,
••
~ •• ~.~~.~:~~ ••••• ,.
-."j
....•.. ~ ... , .. , .. ,_'
..•. _,.-.. "
,.
. .. '"
~
j;,;.t;:t~d:j~~
. .
.
-140
".."...... .
-160
.....
. ." I
~.~l":'L·_··· ·~~~L.liii!'JBW = 2.3x10-5
10--4
10-3
10-2
10-1
Normalized Frequency
Figure 6.15: Spectra for 8-element tree·structured mismatch-shaping.
=
199
j j

__________-----11
6 Implementation Considerations For 8L ADCs
I:I
6.5.1 Digitally-Corrected Multi-Bit 8L Modulator with Power-Up Calibration
Fig. 6.16 illustrates the basic correction scheme of a digitally-corrected 6.}2 ADC
(II]. It will next be shown that the digital correction stage following the modulator
loop can simply be a random-access memory (RAM), storing the accurate digital
equivalents of the actual output values of the N-bit DAC for all possible input
codes, and addressed by v(n). Thus, for any loop output signal sample v(n), the
analog output v'(n) of the DAC and the digital output wen) of the correction stage
are the same. Since for sufficiently high inband loop gain the inband spectrum of
v'(n) is very close to that of the analog input u(n) , and since v'(n) = w(n) , it fol-
lows that the inband spectrum of w(n) is very close to the input spectrum.
The calibration, i.e., the acquisition and storing of the digital versions of the actual
DAC output values, can be perfonned at power-up. In the process, an N-bit digital
counter (not shown) is used to produce all input codes of the DAC (Fig. 6.17).
Each code is held for a duration of at least 2M clock periods, where M is the
required linearity of the overall ADC, in bits. During this time, the DAC output is
fed to a single-bit (and hence very linear) 8L ADC with a digitally filtered output.
The resulting digital code is the desired DAC output equivalent, and is stored in the
RAM.
i
I: =
Ii
~
;•i-
-
The system can be made much more efficient and economical if the stored digital
values represent the errors, rather than the actual values, of the DAC output levels.
1-
The reader is referred to [11] for the details.
~
L(z)k
N-bit
N
V
Digital
NW Decimation N x
ADC
Correction
Filter
~
N-bit
DAC
i•·-•••
Figure 6.16: A digitally-corrected "'~ ADC.
.- ------------ -----_._-
200
f--
I
_

Digital Correction of OAC Nonlinearity
c
Jf
l!
It
e
e
,f
Fig. 6.18 [11] verifies the effectiveness of the correction process. It shows the mea-
sured signal spectra at the loop output and at the output of the RAM for a sinewave
input signal. The DAC linearity was about 10.5 bits, resulting in a spur-free
dynamic range SFDR of about 63 dB and an elevated noise floor in the uncorrected
output v(n). The corrected signal wen) at the RAM output had a noise floor low-
ered by nearly 20 dB (achieving a peak SNR of 95 dB at OSR = 128). and a
much improved SFDR of approximately 105 dB.
II
,I
I.
+
L(z)
1-biI
DAC
1-bit
ADC
Digilal
LPF
"S- RAM
S-Address
s
v·
N-bil
DAC
N
From N-bit Counter
Figure 6.17: Calibration scheme for digital correction.
. ....,.....
.... ,".; .
... ; -
Uncorrected
, -- Corrected
•• _ • .;•••••• ; ••••• .1
.. "
;. -
:
... "-.
0.002
0.004
0.006
0.008
0.01
Normalized Frequency (Ufs)
Figure 6.18: Measured spectra if, = 5.25 MHz).
0
--!
-20
- -.. ,.
. -...
:;:
,-40
ro
...
Z
-60
~
en
LL
-80
ro
"0
-100
-120
-1400
201

6 Implementation ConsIderatIons For SE ADCs
The principle of Fig. 6.16 is easily extended to ~~ DACs. Fig. 6.19 illustrates a
digitally corrected N-bit DAC. As before, the RAM should contain the accurate
digital replicas of the actual DAC output levels. An argument very similar to that
presented for the ADC of Fig. 6.16 proves that the inband spectrum of the analog
output will be very close to the spectrum of the digital input signal x(n) even if the
DAC has static nonlinearities.
6.5.2 Digitally-Corrected Multi-Bit ~L ADC with Background Calibration
While power-up calibration is feasible in most cases, it cannot track and correct the
changes due to thennal drift during operation. Hence, background calibration
methods, which continuously update the DAC error correction, are usually prefera-
ble. Such a technique, based on a correlation algorithm, has been reported in [12].
The basic principle is illustrated in Fig. 6.20. The ADC output v(n) is represented
in a thennometer code, and the resulting bits are permuted (scrambled) in a pseu-
dorandom way. The objective of the scrambling is to reduce the correlation
between the individual bit sequences bj(n) controlling the unit elements of the
DAC and all other signals in the system, especially the input signal u(n) and the
quantization noise q(n).
The DAC errors are estimated from the correlation between the scrambled bits
bin) and the ADC output v(n). The latter is given by
rII
• i
I
ii
~
= -
v(n) = [u.stJ](n) + [q.ntJ](n) + [e-etJ](n)
(6.17)
Digital
Input
x(n)
L(z)
N-bit
N
Truncatorl-':"......,~
RAM
N-bit
DAC
Analog
Output
•I
•-I
• ~••!
=·
=•
~
=
202
Figure 6.19: A digitally·corrected N·bit loop.

Digital Correction of OAC Nonlinearity
where stf(n), ntf(n) and etf(n) are the impulse responses (i.e., inverse z-trans-
forms) of the STF, NTF and ETF, respectively, and the asterisk (*) denotes the
convolution operation. Here, ETF is the error transfer function, from the DAC
error to the output. As before, we are only concerned with the deviations d i of the
unit element values uj from the average element value U given by (6.4). Hence,
the DAC errors are given by
a
M
ern) = Ld;.b,(n)
i = 1
(6.18)
An estimate of the ith DAC error d j can be obtained by finding the expected value
of the product v(n)' b;'(n) , where b;'(n) denotes [b;*etfl(n). From (6.17), denot-
ing the first term in (6.17) by u'(n) , the second by q'(n) and the third by e(n) , we
obtain
E{ v(n) . b;'(n)} = E{ u'(n)· b;'(n)} + E{q'(n) . b;'(n)} + E{ e'(n) . b;'(n)} (6.19)
Figure 6.20: Background calibration scheme for a digitally-
corrected tiL ADC
203

___________In
______6_'_m_
p
'_em_e_"_'._"_0"_C_O_"_"_de<__"_'0_"_'_FO_'_""_'_ADC_'
l1
~ I
Assuming that sequences u'(n) , q'(n) and e'en) have zero mean values, and that
b;(n) is uncorrelated wi,h urn) and q(n), the first two tenns on the RHS of (6.19)
will be zero. Assuming also that bl(n) is uncorrelated with all other bin)
sequences (j '* i), the last term also simplifies, by (6.18), to
The ratio of expected values E {.} can be obtained by accumulating the products
v(n)' b/Cn) and [b/(n)]2, and finding the ratio of the two sums. This operation is
performed by the correlator block in Fig. 6.20 either in every clock period, or after
a predetermined number of clock periods. The di values can then be stored in a
RAM (Fig. 6.20), updated periodically, and used to correct the output yen) by sub-
tracting the expected output error e'en) due to the DAC, as found from (6.18).
Unfortunately, the crucial assumption about the b/n) being completely uncorre-
lated to all other sequences involved in the derivation, and the zero-mean property
assumed for various signal and error sequences does not hold. Hence, in spite of
the scrambling of bits at the input of the DAC, the remaining correlations cause
slow convergence and a large residual error in the adaptive correction. However,
there are several simple steps that can be taken to reduce the hannful correlations
(12]. The resulting process is quite accurate, as illustrated in Fig. 6.21 for a 2-0
MASH ADC with a very low oversampling ratio (OSR ;
4) and a 32-element
DAC [12]. Fig. 6.21 compares the output spectra of the modulator for ideal DAC
elements and for a DAC with a 0.1 % random element errors, before and after cor-
rection. The inband SNDR is 102.6 dB for the ideal case, and only 76.2 dB for the
modulator with the inaccurate DAC. Us-ing the adaptive correction scheme, after
2 17 = 131072 clock periods the inband SNDR rose to 101.5 dB.
E{[d;b;(n)>et!(n)]' [bin).et!(n)]} = d;E{[b/(n)J 2}.
Hence, an estimate of the ilh unit element error can be obtained from
d. = _E,:{~
v(~n)_'_b",/",(n,:".:)}
,
E{[b/(n)]2}
(6.20)
(6.21)
I iiI
~
~
~
=·-
•
~
•-••
~
I
-
-•-
;! -•
~
i
=-
. ,
j
,
204
I
_~__,J
III

Continuous-Time Implementations
..:.;
.•. <\'.••• <... \ ••:.;
< .'.\ \'.',"
••
.'
".
,~.'
'.'
",.".
.,.,
.... ; '.'; ,..... ; ... ,......
.:.
.
.
..;. -;.:. ':i:"
..'
.'.·.n·,.
.. "
\
'.'
'.'"
. '.
.'..:-:.
:-:.:~:....:...:
or;:::===:;:;;:;:r~:-T:"..:::::;T,...T..:-:;..C':
.. •:c:
.....:;:-...:-:;.,:Tl
.....
-20
.. -
Uncorrected
.... .
'".
-40
:: -
Corrected
.. --Ideal
~
-00
t~~
!Xl
"0 -120
-140H'"'h~MW~~."
-160
-180 l...--,--,-~=.......-"-,-"",",,,"......_ ..
10-5
10-4
10--3
10-2
Normalized Frequency (flfs)
Figure 6.21: Simulated spectra for a 2-0 MASH modulator with adaptive
correction of errors in the multi-bit DAC.
j•
6.6 Continuous-Time Implementations
The earliest implementations of 6.I. ADCs used continuous-time (CT) loop filters,
but since the advent of switched-capacitor (SC) circuits in the 1980s the majority
of LU: ADCs have been constructed with SC loop filters. SC filters are attractive
because they exhibit both good accuracy and good linearity. In addition, the differ-
ence equations which describe an SC circuit are independent of the clock rate, and
hence the transfer function of an SC circuit scales naturally with the clock fre-
quency. In contrast, CT filters generally have inferior linearity and accuracy. The
time-constants of a CT filter are subject to large variation and furthermore do not
track the clock rate. Consequently, the time-constants of a CT loop filter typically
require calibration and that calibration is only valid for a single clock frequency.
Despite the above disadvantages, .6.:E ADCs employing CT elements in their loop
filters are appearing increasingly often in both the literature and the marketplace.
There are two important reasons for this trend:
205

____________IT
6 Implementation Considerations For !!.~ ACes
:~! I
--~~~--~~~~~~~~~~~~---~-~~~~~~~~-~~-
i
1. CT modulators possess inherent anti-aliasing. As will be demonstrated shortly,
the degree of alias suppression is equivalent to the degree of quantization-noise
suppression. Inherent anti-aliasing simplifies system design by eliminating the
anti-alias filter, which typically must precede other ADCs. Inherent anti-aliasing
also allows improved system performance, since it also eliminates the noise-
folding associated with sampling the incoming signal.
Effectively, the use of a CT filter postpones the inevitable sampling of the sig-
nal, which now takes place at the output of the loop filter. Thus, imperfections
of the sampling process, and the folding of the wideband noise, both take place
at a much less sensitive point in the loop.
2. The theoretical limit on the clock rate of a CT modulator is determined by the
regeneration time of the quantizer and the update rate of the feedback DAC,
whereas in an SC modulator the clock rate is limited by the op-amp settling
requirements, to about 20% of the unity-gain frequency lu of the amplifiers
within it. In practice, a CT modulator can operate with a clock frequency (and
thus achieve a signal bandwidth) which is 2-4 times greater than that which can
be achieved with SC techniques, albeit with a lower linearity and accuracy.
This difference is due to the fact that the settling error in an SC stage depends
exponentially on the I ,/Is ratio, and hence the error grows rapidly when this
ratio drops below about 4. By contrast, the error introduced by op-amp band-
width in a CT stage increases only gradually when I u/Is is reduced.
The above two advantages are driving the development of cr ADCs with band-
widths in the multi-MHz range. These ADCs arc geared towards wired and wire-
less communications systems, and will enable digital signal processing to replace
analog signal processing to a greater extent than is feasible today. The purpose of
this section is to demystify the operation of CT 8~ modulators, while providing
deeper justification for the above advantages along the way.
II
i
~
I•
206
----------~
JU

=
=
•
I;
iI
Continuous-Time Implementations
6.6.1 A Continuous-Time fmplementation a/MOD2
This section examines a CT implementation of MOD2. The mathematical equiva-
lence between a CT modulator and a discrete-time (DT) modulator with pre-filters
is established and used to demonstrate the inherent anti-aliasing property of a CT
modulator. In Section 9.4, we provide a more in-depth discussion of a practical
implementation of CTMOD2.
Consider the second-order modulator depicted in Fig. 6.22. There are several ways
to analyze this system, but perhaps the most direct method starts with simply writ-
ing the time-domain equations which describe the system's operation. As usual,
we assume that the sampling rate is 1 Hz. We will also assume that the quantizer
operates instantaneously, so that v(n) = Q(x2(n», and we will also assume that
the DAC acts as a delay-free sample-and-hold stage, so that v/0 = v(n) for
t E Ln, n + 1]. (Note that we denote a CT signal by attaching a subscript "e" to it.)
Next, we shall derive a sample-data model of the CT loop filter, which provides the
correct sampled input for the clocked quantizer Q.
Using the above assumptions, the output of the first integrator between sample
times nand n + I may be expressed in tenns of its value at time n and the value of
the feedback signal at time n:
t
xj,(1) = xj/n) + ftu,«J-v(n)]d<,forn';t,;n+1.
"
(6,22)
f
f
x"
Q
(clocked)
v
Figure 6.22: MOD2-CT: A continuous-time implementation of MOD2.
207

__:-:-:-~~~"",::,",:,::-
Ir
6 Implementation Considerations For t.L ADCs
Thus the sampled values of this waveform obey the difference equation
where
II + I
u1(n) ~ f uc(t)dt ~ (gplc·uc)(n).
n
(6.23)
(6.24)
Hence, we can define a hypothetical pre-filter with a (non-causal) unit-rectangle
impulse response gplc t
!!=
g 1 (t) ~ { 1, -I <; t < 0
p c
0, otherwise
The pre-fIlter's input is uc(t) and the pre-filter's output is u len) (Fig. 6.23).
Similarly, the output of the second integrator is given by
II + I
xzc!n+ I) ~ x2c!n) + f [x lc(t)-1.5v(Il)]dt
II
~ x2c(n) + nY[x 1c!n) +f"crt) - V(n)dt]dt __ 1.5v(n)
II
/I
~ x2c!n) + x Ic(n) + "Y[f Uc!t)dt]dt - 2v(n)
"
n
(6.25)
..
!!
t. The pre-filter is non-causal by virtue of our definition of Ill. It is pos1>ible to alter the definition
of U l in such a way that the pre-filter becomes causal, but the analysis and diagrams are tidier if
we (temporarily) introduce non-causal filtering.
208
- - _._--~----

Continuous-Time Implementations
~
=-=
-
iiII
)
I
o
= x2,(n)+xtc(n)+ f(T+l)Uc(n-T)dT-2V(n).
-1
Thus, the sampled values of this waveform obey
x2(n + 1) = x2(n) + x ,(n) + u2(n) - 2v(n)
where
and gp2c is a (non-causal) unit-ramp pre-filter impulse response
(t) = { (1+ I), -I ,;t<O
gp2c
.
0,
otherwise
(6.26)
(6.27)
(6.28)
(6.29)
Fig. 6.23 depicts a system which embodies the above difference equations. Note
that by virtue of (6.27), the feedback coefficient for the second integrator is 2 in the
DT system, whereas in the CT system this coefficient was 1.5. Clearly, construct-
ing the DT equivalent of a CT system is not simply a matter of replacing the CT
integrators with DT integrators!
gp2c
~ U2
r--:(}
;
gp1c
>- Ul$--
1 Xl!
1
~
D
f
_,+
z-1
z-1
Q
•
Figure 6.23: Discrete·time equivalent of MOD2-CT.
-- ------------ -- ----.----c
209

______-=-
in
_____6_'m_p'_.me_"_la_tiO_"_C_O_"_"_d._"_I_'O_"'_F_O_'_."_''_O_C_'
,
~III
Fig. 6.23 also shows that in order for the DT system to follow the behavior of the
CT system exactly, the CT input uc{t) must be processed by the two pre-filters,
g 1c and g 2c' the outputs of which are sampled and then injected into the loop
fiher. The refst of the system operates in discrete-time. A brief analysis shows that
(6,30)
where E(z) is the z-transform of the quantization error. Since the noise transfer
function is identical to that of MOD2, all previously obtained results regarding the
quantization noise and stability properties of MOD2 carryover to MOD2-CT.
However, the signal transfer function of MOD2-CT must be obtained separately.
According to (6.30), the impulse response of the STF is a twice-delayed version of
g Ie plus a delayed version of g 2e minus a twice-delayed version of g 2e·
These operations (depicted in FiI6.24) result in a causal triangular im~lse
response
!!
• "
•-
i
'!
-, -
•
.!L
•!
210
If this pre-filter is cascaded with MOD2, as shown in Fig. 6.25, the resulting sys-
tem will have the same input-output behavior as MOD2-CT.
~
:1
~F
I
ii'.I
i
.
• l
(6.31)
I,
Ost<l
1-2, Ist<2
0,
othenvise
gpl,(t-2) t
,.......,
U-L.~t
+ gp2clt - 1)-gp2,(t-2) ~ t
...............................................................................
gp,(t) b
,.
t
o
1
2
3
Figure 6.24: Impulse response of the STF of MOD2-CT.

Continuous-Time Implementations
The Laplace transform of gpe(t) is
(
I
-'12
GpC<s);;: +J
(6.32)
Evaluating Gpees) for physical frequencies s ;;: j2nf yields the frequency
response of the STF
ISTF(f)[ = (Sin1[11 2
1[/-) ,
(6.33)
which is plotted in Fig. 6.26. This function has second-order zeros at all non~zero
multiples of the sampling frequency, and thereby provides alias protection com-
mensurate with the order of the modulator.
Figure 6.25: MOD2·CT is equivalent to MOD2 preceded by a pre-filter.
-20 .
CIl
'0
--40 .
,
Figure 6,26:
I
,.,
-B0·0'c-'.-'-'-'-J~1--'.-'~'--Ll-±2./-.i-'--'----'--U3
Normalized Frequency (Qfs)
Frequency response of tbe STF of MOD2-CT.
211

__________In
______'_'_m_p'_e_m_oo_'._'_'o_n_c_o_n._'_de_"_'_'o_n_._F_O'_""_A_D_C_.
!UI
In general, the alias protection of a high-order CT modulator is at least as good as
its quantization noise suppression. The reason is simply that both sampling and
quantization occur at the same point in the loop. We regularly model quantization
as the addition of noise, so if we similarly regard sampling as the addition of
aliases, then the quantization noise suppression and the alias suppression should be
the same. This argument will be made more precise shortly.
6.6.2 Inherent Anti-Aliasing in CT L1L ADCs
The above example demonstrated that MOD2-CT is mathematically equivalent to
MOD2 with a pre-filter. In a more general case, the samples of the signal entering
the quantizcr are given by
(6.34)
where IOc is the continuous-time impulse response from the input u/t} to the
quantizer, while II is the discrete-time impulse response from the quantizer's out-
put, through the feedback DAC(s) and the loop filter, back to the quantizer's input
[13]. As usual, modeling the discrete-lime quantization process by the addition of
an error signal yields the noise transfer function NTF(z) = 1/(1-L1(z». How-
ever, instead of the usual STF(z) = Lo(z)NTF(z), formal manipulation of the
equations yields
Ii
- I'
•
-
===•
t
;~
~•
STF = Loc(s)NTF(z).
(6.35)
Note that the STF is a mixture of continuous-time (s-domain) and discrete-time (z-
domain) transfer functions, and that we have side-stepped the issue of which argu-
ment is appropliate for the STF. For physical frequencies,
S = j2nf
and
z = eJ2nf, we may write the less ambiguous relation
i..II
STF(f) = Loc(j2nf)NTF(ej2nf).
(6.36)
..-
At a pole frequency of L Dc (which is assumed to lie in the modulator's passband),
NTF is zero and a pole-zero cancellation results in a finite (often unity) signal
212
I
I
,
!
i
__

Continuous-Time Implementations
1
f
I
!I
transmISSion.
For
example,
in
MOD2-Cf,
NTF(z) = (1 - z-I)2. According to (6.35),
STF = (1_Z-I)2 = (1_Z-1)2
,2
,
and
(6.37)
and we see that the double pole at de (5 = 0) is cancelled by a double zero at de
(z = 1). Substituting s = j2rtf and z = eJ21tj yields
ISTF(f)! =II-e-Jzn/lz = (Sin1t[)2
21tf
1tf-)
as before in (6.33), from which it is clear lhat ISTF(O)[ = 1.
(6.38)
Next, consider a frequency fthat aliases to an NTF zero. Since this frequency is
outside the passband, L9
(j2nf) is finite by our first assumption. Sincefaliases to
an NTF zero, NTF(eJ ttl) = 0 and thus STF(f) = O. More generally, (6.36)
shows how the alias suppression is intimately linked with the NTF. Any frequency
which aliases to the passband is attenuated by the NTF(ei21tf) factor, and the
LOc(j2~f) factor cannot undo the large amount of attenuation provided by the
NTF(eJ2nf) factor. In fact, for frequencies that are outside the passband, LOc is
usually less than one and thus the alias attenuation is usually greater than the quan~
tization noise attenuation.
6.6.3 Design Issues for Continuous-Time Modulators
The key theoretical result regarding a CT modulator is that a CT modulator is func+
tionally equivalent to a DT modulator preceded by a pre-filter. This fact suggests
that one could first select a DT prototype and then transform it into a CT system
which has the same NTF. In order for this procedure to work, the designer needs to
ensure that the path from the quantizer output back to its input has the same
impulse response in the two structures. In the DT case, this impulse response is
I J(n) . In the CT case, the impulse response is obtained by lracing the signal path
from the (discrete-time) quantizer output, through the DT-CT transformation of the
DAC(s) and then through the loop filter, whose output is sampled to yield a dis-
crete-time response. In more concise (and only slightly less precise) tenns, the
213

ITI
-------.-'-m-p-'.-m-.-n'-.'-'o-n-eo-n-.-'d-...-tio-n-.-F-o-'-6~-A-D-c-'----------------I: II
sampled pulse response of the CT loop filter must match the impulse response of
the DT loop filter. If the designer is successful in achieving this correspondence,
the CT system and the DT system will implement the same NTF.
A number of practical concerns act as impediments to the above goal, the most
important of which derives from the assumption that the quantizer operates instan-
taneously and provides feedback immediately after sampling its input. If one were
to try to approximate this ideal behavior by using a fast comparator, then metasta-
bility, or more generally, input-dependent comparator delay, would affect the feed-
back timing and thereby degrade the performance of the system. The following
approximate calculation illustrates the severity of this problem.
I
i
=
Suppose that the modulator is a single-bit system clocked at 100 MHz, and that
once every 100 cycles or so the comparator output (and thus the feedback) is
delayed from its nominal timing by I:1t = 0.1 ns, as illustrated in Fig. 6.27. The
equivalent relative error signal therefore has an average power of
+1
1-bit
data
-1
(
20.1 nS)2
10 os
6
= -=c;-- = 4xlO- ,
100
(6.39)
II••-
=
=
~
"1
+1
-~-- ----j---~t
o~~p~~ 1
Idearactual
eqUivalent!
rJ ~,1tfT
error
-----------<.~ t
Figure 6.27: Timing variation in a single-bit CT modulator.
---_ ...._ ..._.
214

·,·!I
Continuous-Time Implementations
which is only 51 dB below the power of a full-scale sine wave. If this error is
white, then its in-band power would be reduced by a factor of OSR. However, since
it is likely that this error would be correlated with the input signal, the error is
likely to manifest itself as a distortion product, and thus the ADC would probably
be limited to the equivalent of 9-bit linearity.
Another important consideration in CT modulator design is clock jitter. As illus-
trated in Fig. 6.28a, sampling a sine wave of am,Plitude A and frequency fwith an
rms time jitter of crt results in an nTIS error of J2rtAfcrt' which is proportional to
A solution to the above problem is to allocate a fixed amount of time for the quan-
tizer to perfonn its job. Since delaying the feedback affects the sampled pulse
response of the loop, the modulator's coefficients need to be adjusted to account
for this change in feedback timing. Failure to account for the excess loop delay
will yield an NTF which differs from the desired one, and the difference may be
great enough to yield an unstable modulator. As will be seen in Section 9.4, the
desire to maintain exact correspondence between a CT system with delayed feed-
back and a DT prototype may require the addition of extra feedback DACs as well
as an adjustment of the loop filter coefficients.
!r-
~
iii
;;;
i;
I•i•=
;;
I
a) sine wave
V(/) ~ AsinWI :
~I,-----
dv
error = dt6.t
~ (AwcosW/)M
Awcrt
errorrms = h
I
1
b) 1~bit I1r waveform
+1
v(n):
-1-
,--c----- error ~ ("'v )(M)
errorrms
::;: (6.vrms )crt
Figure 6.28:
Jitter-induced errors.
215

There are two ways to overcome this disadvantage. The most obvious is to increase
the number of levels in the feedback DAC. With a sufficient number of levelst the
feedback waveform approximates the input signal and thus the rms sample-to-sam-
pIe change in the feedback wavefonn is approximately equal to the nns sample-to-
sample change of the input signal. Under these circumstances, a CT modulator has
a jitter sensitivity that is comparable to that of its DT counterpart.
both the signal's amplitude and its frequency. As illustrated in Fig. 6.28b, the rms
error due to jitter in the feedback of a I-bit CT modulator is (L'lv)mlSOt' where
(6.v)rms is the rms change in the I-bit feedback. If we assume that (L'lv)rms "" 1,
the jitter-induced error in a I-bit CT modulator is approximately equivalent to the
error associated with sampling a full-scale sine wave whose frequency is 0.2Is !
Clearly, a I-bit CT modulator is at a jitter disadvantage relative to a I-bit DT mod-
ulator.
III
---~-:---:----:--~--------~
6 ImplementatIon Considerations For 6E ADCs
I ~
------ ---- ------------
~ ..I=
11
I••-
A more elegant solution to the jitter problem is to change the feedback from a tim-
ing-dependent signal to a timing-insensitive signal. To see how this is possible,
consider the simplified first-order CT modulator illustrated in Fig. 6.29a. Over a
clock period T, the feedback signal induces a change IT/ C in the output voltage
of the integrator. Jitter effectively causes variation in the value of T, and hence an
error in the integrator's state. If a switched-capacitor branch replaces the current-
source feedback as illustrated in Fig. 6.29b, then the change in the integrator's
state over one clock period due to the comparator feedback is always ±Vref'
regardless of the amount of jitter. This insensitivity to clock jitter is a simple con-
sequence of the fact that the amount of charge fed into the integrator is now inde-
pendent of the duration of a clock period.
6.7 Conclusions
In Chapter 6, several implementation issues important for ~L ADCs were dis-
cussed. The topics discussed included the relative advantages of using multi-bit,
rather than single-bit, internal quantization in ~L ADCs. This was followed by a
t. It is assumed that the aggressiveness of the NTF is not Increased as the number of levels is
increased.
216
L
"-IiI.
I ;;
. I !!!
I. _
II
~.
'
--=

Conclusions
a)
c
217
Finally, an alternative realization of the loop filter in a ~L ADC was discussed.
This uses continuous-time cirCUitry, and thus has inherent anti-aliasing properties.
This allows simplification of the overall system, and avoids noise folding which
plagues switched-capacitor circuits. Also, since the internal nmplifiers do not have
>+-- to comparator
:><'--to comparator
+
+
Figure 6.29: a) A first-order CT modulator. b) A modulator
with reduced sensitivity to clock jitter.
C
'V"f./.~~
-Vrel""""":
from ~
..L..L
comparator
-=-=
input
input o--"/'v-""""t-+';
c
b)
description of several schemes for reducing the effects of the nonlinear distortion
which the multi-bit internal DACs inherently introduce. The discussed strategies
included the use of dual quantization, i.e., the inclusion of both single-bit and
multi-bit quantizers in the converter. Also, various mismatch error shaping algo-
rithms, which suppress the noise due to nonlinear distortion within the signal band
and shift it out of band, were described. An alternative strategy, in which the DAC
nonlinearity errors are acquired in digital form, either at power-up or during opera-
tion, and then corrected in the digital ADC output, was also discussed, and various
implementations described.
"i-
"iI
I
-..
=='"I..
i
I
!•"

to settle in a fast transient occurring in every clock period as in a switched~capacj­
tor circuit, faster operation is possible, albeit with reduced linearity. The theory
and key properties of 8L ADCs with contmuous-time loop filters were discussed in
the context of the second-order continuous-time modulator MOD2-CT, and some
design issues, potential problems and their solutions were considered.
'11
-------.-'-m-p-'.-m-.-n-..-.-'o-n-C-o-n-"-d-.-'.-t1-o-n'-FO-'-'-'-.-O-C-'-----------------] J I
j I
II
c
References
I
[lJ
[2J
[3]
[4]
[5]
[6]
[7)
IS]
[9J
[IOJ
[II]
[12J
[13]
B. P. Brandt and B. A. Wooley, "A 50-MHz muhibit sigma-delta modulator for 12-b 2-MHz
AiD conversion," IEEE Journal of Solid-State Circuits, vol. 26, no. 12, pp. 1746-1756.
December 1991.
A. Hairapetian and G. C. Ternes, "A dual-quantization multi-bit sigma-delta AID converter,"
Proceedings of the 1994 IEEE International Symposium on Circuits and Systems, vol. 5,
pp. 437-440, May 1994.
L. R. Carley, "A noise-shaping coder topology for 15+ bit converters," IEEE Journal of
Solid-State Circuits, vol. 24, pp. 267-273, April 1989.
S.R. NorswoTlhy, R. Schreier and G.c. Ternes, Delta-Sigma Data Converters, Sec.S.3.3,
IEEE Press, 1997.
M. J. Story, "Digital to analogue converter adapted to select input sources based on a
preselected algorithm once per cycle of a sampling signal," U.S. patent number 5138317,
Aug. II 1992 (filed Feb. 10 1989).
R. T. Baird and T. S. Flez, "Improved 8:E DAC linearity using data weighted averagmg,"
Proceedings of the 1995 IEEE IllfernatlOnal Symposium Oil Circlllts and Systems, vol. 1.
pp. 13-16, May 1995.
I. Fujimon, L. Longo, A. Hairapctian, K. Seiyama, S. Kosic, C. Jun and SL Chan, "A 90-
dB SNR 2.5 MHz output-rate ADC using cascaded multibit delta-sigma modulatIOn at 8x
oversampling ratio." IEEE Journal of Solid-State Circuits, vol. 35, no. 12. pp. 1820-1828,
December 2000.
F. Chen and B. H. Leung, "A high resolution multibit Sigma-delta modulator with individual
level averaging," IEEE Journal of Solid-State CIrcuits, vol. 30, no. 4, pp.453-46O, April
1995.
R. Schreier and B. Zhang, "Noise-shaped multibit D/A convertor employing unit elements,"
Electronics Letters, vol. 31, no. 20, pp. 1712-1713. Sept. 28 1995.
I. I Galton, "Spectral shaping of Circuit errors in digltal-to-analog converters,"
IEEE
Transactiolls on Circuits and Systems //. vol. 44. pp. 808-817. Oct 1997.
M. Sarhang-Nejad and G. C. Ternes. "A high-resolution multi-bit :El'r. ADC with digital
correction and relaxed amplifier requirements," IEEE JOl/mal of Solid-State Circuit5. vol.
28, pp. 648-660, June 1993.
J. Silva, X. Wang, P. Kiss, U. Moon, G. C. Ternes, "Digital techmques for improved l'r.L data
conversion," Proceedings ofthe IEEE 2002 Custom Integrated Circuits Conference, pp. 183-
190, May 2002.
R. Schreier and B. Zhang, "Delta-sigma modulators employing continuous-time circuitry,"
IEEE TransactIO/IS 011 Circuits alld Systems I. vol. 43. no. 4, pp. 324-332. ApTlI 1996.
•
j
I
.~ .
:
~.-
-
218
.,)-I
_
Li

1
IiI
,
=!
-
CHAPTER 7
Delta-Sigma DACs
Up to this point, the concepts of oversampling and noise shaping were (with the
exception of the brief discussions in Section 2.3) applied only to ADCs, and not to
digital-la-analog converters (DACs). In fact, delta-sigma DACs are commercially
as important as their ADC counterparts, if not more so, and their implementation is
often just as difficult as the implementation of a f!.L ADC. This chapter will be
devoted to the specific issues involved in the design of delta-sigma DACs.
The motivation to use noise shaping in D-to-A conversion is the same as in A-to-D
conversion. For a DAC with a 3-V full-scale and an 18-bit resolution, the LSB
voltage is only about 12 Jlv. Hence, the permissible deviation of the DAC output
levels from their ideal values is of the order of 6 JlV, which cannot be achieved in a
conventional DAC without expensive trimming andlor extremely long conversion
time. Therefore, the trade-off earlier discussed in connection with delta-sigma
ADCs, wherein oversampling and additional digital hardware are applied to allow
the use of robust and simple analog circuitry, is attractive for high-accuracy DACs
as well. The actual structures implementing this trade-off will be discussed next.
219

7
Delta-5lgma DACs
______________,!E
_________:
I
The spectra of the signals processed by the system are shown in Fig. 7.2. The input
signal uo(n) is a multi-bit data stream with a word-length No (typically, 15-24
bits) sampled near the Nyquist rate f N' Its spectrum is illustrated in Fig. 7.2a.
7.1 System Architectures for tiL DACs
Fig. 7.1 illustrates the basic system diagram of the ~ DAC. As indicated, the front
end (containing a digital interpolation filter IF and a noise-shaping loop NL) con-
tains digital circuitry, while the output stages (the internal DAC and the reconstruc-
tion filter) are analog.
The roles of the interpolation filter IF are (1) to raise the sampling frequency to
OSR . f N and thereby allow subsequent noise shaping, and (2) to suppress the
spectral replicas centered at / N' 2/N' "" (OSR - 1)/N" The purpose of thlsside-
band suppression is to reduce digitally the out~of-band power of the input of NL
without affecting the baseband signal spectrum. This improves the dynamic range
of the noise-shaping loop, since larger signals can thus be accommodated. It also
eases the task of the analog output filter, since it needs to suppress less out~of~band
noise, and also its linearity requirements can be somewhat more relaxed since the
amount of intermodulated out-of-band noise folding down into the signal band is
reduced. The suppression need not be very accurate, since the truncation error gen-
erated in the noise-shaping loop will introduce unwanted noise in the same fre-
quency range anyway. The ideal spectrum of the IF output signal is shown in
,
i
=
=r•
i
n~
I
•
II
I
~
,j
!•
Analog
output
Analog
Digital
IF:
Interpolation Filter
NL:
Noise-shaping Loop
DAC:
Digital-Analog Converter
LPF:
Lowpass Filter
Figure 7.1: Block diagram of a tiL DAC.
Digital
input
tlo ,?..jIF
220
I-

"
ii
===
~--..-=-=
==
---
ii•
j
,
System Architectures for L\t OACs
Fig. 7.2b. The word-length of this signal can remain about the same as that of the
input data "o(n).
The noise-shaping loop NL reduces the word-length of its input signal to a few (1-
6) bits. If a single-bit NL output is used, then (as discussed in Chapters 4 and 6 for
the internal DACs in M: ADCs) the linearity requirements for the DAC following
the NL can be relaxed. If the output data are multi-hit, then the techniques dis-
cussed in Sections 6.2 to 6.5 may be utilized to filter out or cancel the unavoidable
DAC nonlinearity errors, and thus to achieve linear conversion. (The pros and cons
of using multi-bit DAC loops will be discussed in Section 7.3). In any case, the NL
output must contain a faithful reproduction of the input signal uo(n) in the base~
band, but it will also include the filtered truncation noise caused by the reduction
of the word~length in the loop. The spectrum of the NL output signal is schemati~
cally illustrated in Fig. 7.2c.
The next block in the system is the embedded DAC. As discussed above, it may
have a single~bit input, in which case its output will be a two-level analog signal.
a)
Digital
I
input
(OSA-1)'IN
OSR'IN
b)
IF
output
I
(OSA-I)'IN
OSR" N
c)
NLand
DAC output
I
(OSA-I)'IN
OSR'IN
d)
Analog
I
output
Is
IN
(OSA-I)'IN
OSR" N
Figure 7.2: Signal and noise spectra in a ~ DAC.
221

7
Delta-5lgma DACs
The structure of such a I-bit DAC will be very simple, and its linearity will be the-
oretically perfect (although some practical precautions need to be observed to
achieve good linearity). However, the high slew rate of the single-bit DAC output
signal, and the large amount of out-of-band noise power it contains, make the
design of the subsequent analog smoothing filter LPF a difficult task.
By contrast, for a multi-bit DAC, additional circuitry is required for the filtering or
cancellation of the DAC nonlinearity error, which results in a more complex DAC.
However, the reduced slew rate and out-of-band noise power of the DAC output
signal allows reduced perfonnance requirements, and hence simpler implementa-
tion, for the smoothing filter. Usually, the overall trade-off in complexity, chip area
and power dissipation favors the multi-bit structure.
Ideally, the DAC will reproduce the digital signal at its input in an analog fonn
without any distortion. Hence, the output spectrum of the DAC will be (except for
a constant factor corresponding to the reference voltage or current of the DAC (and
for a (sinx)/x
frequency~dependent factor corresponding to the frequency
response of a zero-order hold), the same as that shown in Fig. 7.2c for the output
signal of the NL.
Finally, the task of the analog smoothing or reconstruction filter LPF is to suppress
most of the out-of-band noise power contained in its input signal. Hence, the ideal
spectrum of its output signal should be as shown in Fig. 7.2d. As already men-
tioned. it is relatively easy to achieve good noise suppression without introducing
additional distortion for a multi-bit DAC output signal, but the task is usually quite
difficult for a single.bit signal. The design of the analog
post~filter will be dis-
cussed in Section 7.S.
7.2 Loop configurations for 6.:r DACs
As was the case the 6.L ADCs, there is also a wide variety of loop architectures
available for the designer of 6.L DACs. The function of the loop is similar to that of
the noise-shaping loop of the 6.:r ADC, namely to reduce the resolution of the
input signalt to a few bits without significantly affecting its inband spectrum in the
process. Since the reduced word-length means that quantization or truncation error
,,,
---l
222
I
."
'iI

•
~
!!
II!!
LOOp configurations for t.L OACs
is introduced, the loop must suppress the power spectrum of this added noise in the
signal band. Tbe only significant differences between ADC and DAC loops are
that
1. In the DAC loop all signals are digital, and hence no internal data conversion is
required.
2. For the same reason, the signal processing in the loop can be made highly accu-
rate, and we need not take any analog imperfections into account when predict-
ing the actual behavior of the loop. As we shall see, this pennits the use of some
efficient configurations which are impractical for ADC loops.
Some typical loop configurations will be discussed next.
7.2.1 Single-Stage Delta-Sigma Loops
All loop architectures discussed for ADCs in Section 4.4, and shown in Figs. 4.17
to 4.21, remain applicable for delta-sigma DACs. Thus, the structure containing
cascaded integrators with distributed feedback and input coupling (CIFB), illus-
trated in Fig. 4.17; the circuit using cascaded resonators with distributed feedback
and input coupling (CRFB), shown in Fig. 4.19~ as well as the structures contain-
ing cascaded integrators or resonators with feedforward coupling (CIFF), shown in
Figs. 4.20 and 4.21, respectively, can also be used in delta-sigma DAC loops. Of
course, the component blocks are now accumulators rather than integrators, and
they are implemented by digital adders and multipliers, rather than op amps,
capacitors and switches as in the ADC loops.
The designer is still faced with some of the same problems (e.g., stability issues) as
were encountered for analog loops, and also with some new ones. In finding the
proper configuration and order for the loop, and calculating the coefficients
needed, the noise-shaping and signal transfer specifications must be satisfied, and
stability needs to be ascertained under all anticipated conditions. Also, the condi-
tions for optimum dynamic range must be met, and the over- or underflow of any
block avoided. Finally, the word-lengths of all coefficients and operations should
t. For an analog signal, the resolution can be regarded as infinite.
223

7
Delta-SIgma DACs
be carefully determined so that, on the one hand, the required accuracy in signal
transfer and noise suppression is maintained, and, on the other hand, the complex-
ity of the circuit is minimized subject to these accuracy conditions.
Qualitatively, the sensitivity considerations discussed for ADC loops remain valid
for DAC loops, except that the errors generated here are due to coefficient trunca-
tions and to the round-off errors of the digital operations (additions and multiplica-
tions), rather than element-matching errors and finite op-amp-gain effects. Thus,
the coefficient and round-off errors must be kept small in all signal paths connect-
ing to the input node, but they may increase progressively as the signal propagates
towards the output of the loop. Hence, the word-length needed may vary consider-
ably with the location of the block in the loop.
Hardware can also be saved by choosing simple coefficients which contain only a
few terms, each tenn an integer power of 2. This may alter the signal and noise
transfer functions slightly, but the effect on the NTF and STF are usually small
and, in the case of the STF, can often be corrected the blocks preceding or follow-
ing the loop. The signal transfer function of the low-distortion architecture dis-
cussed in Chapter 4 tends to be less susceptible to coefficient truncation than that
of competing architectures.
The detailed design process will be illustrated in the example discussed in
Section 9.6, later in the book.
7.2.2 The Error Feedback Strncture
A configuration which is not practical for ADC loops, but is highly efficient for
DACs, is illustrated in Fig. 7.3 for a I-bit loop. Here, rather than feeding back the
MSB retained in the output signal as was done in the delta-sigma loop discussed in
Section 7.2.1, the discarded LSBs (representing the truncation error e(n»
are fil-
tered and fed back to the input. The loop filter He used to filter e(n) is now
located in the feedback path.
In an ADC loop, this structure would be overly sensitive to the imperlections of the
analog loop filter and of the analog subtraction needed to generate e(n), since the
errors generated in either enter the input terminal directly. Hence, this architecture
224
,•
'!I'
i..
=
;.-
..
=
i

ii
II•
Loop configurations for 6.I: DACs
is never used in an ADC. In a digital realization, however, if sufficient accuracy is
used in the digital implementation of the He filter, the circuit will perform well.
Linear analysis shows that the output is given by
Viz)
~ U(z) + [1 - H elz)lE(z)
Hence, the SlF is 1, and the NTF equals 1 - H elz).
(7.1)
For low-order loops, the error feedback loop can usually be very simply realized.
For a first-order loop, NTF = 1- z-l, and hence Hiz) = C 1, i.e., it is simply a
delay. For a second-order loop with a double zero of the NTF at dc,
(7.2)
Thus, the loop can be realized from two delays, a shift in the binary point to imple-
ment the factor 2, and two adders (Fig. 7.4).
Higher-order error-feedback loops can, of course, also readily be designed, subject
to stability considerations. As in the delta-sigma type loop, instability causes the
input signal yen) of the quantizer (here, the truncator) to grow beyond the operat-
ing range of the digital logic. Depending on the arithmetic used, this may just
cause the saturation of yen) at its largest possible value, or it may cause a wrap-
around, where the output v(n) suddenly decreases with increasing y(n) at over-
flow. While saturation is usually acceptable, wrap-around causes large errors, and
hence must be prevented, e,g. by including a digital limiter in the loop (Fig. 7.5) at
1-bit
1
u --.-f+}-------.-Jtruncator b'~.....v
Figure 7.3: Error feedback structure.
225

I
I
!
~;;
the input of the truncator [1]. The limiter should saturate before overflow can
occur.
7.2.3 Cascade (MASH) Stroctares
To achieve high~order noise shaping without the stability problems inherent in the
design of higher~orderloops, cascade structures may be used for LU: DACs as well
as for AI: ADCs [2]. (Note that in fact cascaded DAC stages were proposed before
ADC ones.) Fig. 7.6 illustrates the architecture of a two-stage cascade DAC. In a
typical structure, both stages may contain second-order loop filters, resulting in a
fourth-order noise shaping overall, while preserving the robust stability properties
of second-order loops.
________________I,-r
_~
7_De_It_••_SI_gm_._DA_C_.
~
~ I
II
!
-·
k+m-1
-e
-1
-
1
k+m
}----r-~_'--.. v
u----o-{
Figure 7.4:
Second~order error-feedback noise-shaping loop.
u--.{
Limiter
1-bil
t
1-1~ truncalor IT......... v
III·-·..
•
Figure 7.5: Error feedback with limiter.
-
226
-i--
~ -'--

=
=
•"=-..=!•
=
=
Loop conflgurations for IU: DACs
A design issue, which did not occur for MASH ADCs but appears for cascade
DACs, concernS the optimum location of the internal DACs in the structure.
Assume at first that all signal processing in the structure of Fig. 7.6 is performed
digitally. As explained in the discussions of Section 4.5, the post-filter II 1 usually
replicates the signal transfer function SrF2 of the second stage. Often, SrF2 is
simply a single or multiple delay, and hence HI can easily be implemented digi-
tally without increasing the word-length n 1 of the first stage output vI' By con-
trast, H 2 usually reproduces the noise transfer function NTF I of the first stage,
and hence, if implemented digitally, it increases the word-length nz of v2 . Adding
HI' V 1 and H 2 . V2 digitally will increase the output word-length even further.
Hence, such a structure will produce a multi-bit output v(n) , which then needs to
be accurately converted in a mUlti-bit, and hence complex, internal DAC.
An alternative is to use a separate DAC in each stage, and combine their outputs
using analog circuitry, as illustrated schematically in Fig. 7.7. This allows the use
of less complicated DACs. A mismatch between the gains of the two paths caused
by analog errors will introduce leakage of the first-stage truncation error, but will
not affect the linearity of the signal conversion, which is limited only by the linear-
ity of the first-stage DAC.
=
k
k+1
n,
v,
u
+}----r---""'--'}L---'-!
1-----<+>--_ v
-
=
=
-e,
k+1-~
j J
Figure 7.6: Cascade structure for a second-order noise-shaping loop.
227

7
Delta-Sigma DACs
It is also possible to place DAC2 ahead of the H 2 filter, which then must be real-
ized by analog circuitry. This has two advantages: first, the resolution of DAC2 can
be reduced, since it only needs to convert V2' not Hz· Vz which has longer
words. In fact, for n I = nz = I, both DACs can be single-bit ones. For multi-bit
DACs, Hz is now going to shape the noise introduced by the inherent nonlinearity
of DAC2, along with the truncation noise of the second stage. A disadvantage of
this modified scheme is that the analog implementation of Hz cannot reproduce
the digital NTFI as accurately as a digital filter could. (Note, however, that any
zeros of Hz at de can be very accurately realized in an analog circuit, by having
series capacitors in the signal path.)
Another option is to split the Hz block into a digital stage preceding DAC2, and
an analog one following it. This way, the larger truncation noise receives full shap-
ing by NTFz and Hz, and the much smaller noise caused by DAC2 errors will be
shaped only by the analog part of Hz. This scheme will realize the required replica
of NTF1 more accurately than a fully analog Hz can.
I
I •· """·-·~
u
I---JDAC1
v
i-
~
=
228
Figure 7.7: A cascade DAC using analog recombination.
, i
~
j

I '..-
=
..
=-..
!!!!;;;;
=
-=1
;;1
=
J
61: DACs Using Multi·Bit Internal DAes
7.3 LU: DACs Using Mnlti-Bil Internal DACs
The parameters of the digital noise-shaping loops used in 6.l DACs are much more
accurately controlled than those of the analog loops required in L1~ ADCs, and
some of the basic arguments for using multi-bit quantization in ADCs (such as the
ones based on op-amp slew rate. power dissipation, nonlinearity, clock jitter, etc.)
are not valid for DAC loops. Nevertheless, the stability considerations presented in
Section 6.1 remain valid, and an additional powerful reason for multi-bit operation
emerges: the relaxed requirements on the analog smoothing filter LPF following
the internal DAC. For a single-bit DAC, the input signal of this filter is a two-level
fast-slewing analog signal (usually voltage), with most of its power contained in
the large high·frequency quantization noise. This fast signal needs to be filtered by
LPF so that almost all its high-frequency noise is removed. This must be accom-
plished without distorting the signal or even the out-of-band noise. (Distorting the
noise will cause the folding down of the large noise spectrum from the region
around I s/2 into the signal band.)
In addition, due to the steep slopes of the two-level analog signal, any clock jitter is
translated into substantial amplitude noise at the output of the filter.
In conclusion, the analog problems due to single-bit truncation which appeared in
the noise-shaping loop in AL ADCs do not disappear in 8L DACs; they are just
shifted to the analog post-filter!
In earlier single-bit implementations [3], to overcome these difficulties, the
smoothing filter was realized as a cascade combination of a high-order switched-
capacitor (SC) filter, an SC buffer stage and a continuous-time post filter. It
required a considerable chip area and dc power. The motivation for paying such a
high price for the one-bit system was to avoid the inherent nonlinearities of a
multi·bit internal DAC.
In recent years, various techniques (dual quantization, mismatch-error shaping and
digital correction) became available for reducing the DAC nonlinearity effects, and
hence multi-bit DAC structures became favored over single-bit ones. These DAC
linearization methods are quite similar to their counterparts used in ADCs, which
229

7
Delta-Sigma DACs
were discussed earlier in Sections 6.2 to 6.5. In the next Section, these schemes
will be examined.
Ii
I
i,
7.3.1 Dual-Truncation DAC Structures
The general principle of dual-truncation DACs is similar to that of dual-truncation
ADCs: use single-bit truncation in the D/A conversion of the signal, and use multi-
bit truncation where only the truncation errors are converted. A simple implemen-
tation, which is similar to the Leslie-Singh structure of Section 4.5.1, is shown in
Fig. 7.8. (4]. As shown, the signal u(n) is reduced to a single-bit data stream in a
noise-shaping loop. This can be converted linearly in a I-bit DAC. The large trun-
cation error -e I is truncated to M bits (M > 1 ), and converted in an M-bit internal
DAC. It is then filtered, and added to the output of the I-bit DAC to cancel el(n).
The spectrum of the nonlinearity error dM of the M-bit DAC is shaped by the ana-
log filter H2(Z) , which duplicates the NTF of the I-bit loop, and suppresses its
inband power.
A more sophisticated and effective structure, shown in Fig. 7.9, uses a noise-shap-
ing loop in both stages, with I-bit truncation in the first stage and M-bit truncation
I;..
Digital
Analog
I•I
I
~
~
.
i i =
nalog
utput
v
et
Figure 7.8: A dual-truncation DAC system.
tal
t'
A
ut
0
Basic noise-shaping
1
1-bit
"!;1~'
-
loop with l-bi1
truncator
DAC
:t
M
I
-et
M-bit
M
M-bit
H2(z)
truncator
DAC
230
Digi
inp
u

i
~I: DACs Using Multi-Bit Internal DAe,
,
II,I;
I
l'
in the second one. Fig. 7.10 shows the implementation of a third-order DAC [4)
based on this structure. In the diagram, the switched-capacitor branch containing
C1 realizes the I-bit DAC, while eZl C3• C4 and their switches perform as the ana-
log filter H 2(z) . Both loops use error feedback; the first loop has a second-order
loop filter with a pole at z :;:: 0.5 for improved stability, while the second loop
uses a simple first-order filter.
It is also possible to realize a single-stage dual-truncation DAC (Fig. 7.11). This is
similar to the Hairapetian ADC structure [5] discussed in Section 6.2.2. The sin-
gle-bit output is fed to a I-bit DAC, and is also fed back to all but the last stage in a
cascade of integrators. An M-bit output is also generated; it is converted in a multi-
bit DAC, and also entered into the last integrator. The input signal in this structure
is converted by the I-bit DAC in a potentially linear fashion, while the M-bit cir-
cuitry is used to cancel the large I-bit truncation error in the output v(n), and
replace it with a much smaller M-bit error. An error cancellation logic, consisting
of the analog filters H 4 and H 5' carries out this operation. Mismatch between the
231
Analog
utput
v
Analog
e,
Digital
Figure 7.9: A dual-truncation MASH structure.
Digital
r
input
Basic noise-shaping
0
u_
loop with 1-blt
1
1-bil
,+
truncator
DAC
I t
t
M
-e,
Correction path noise- M
M-bit
shaping loop with
H2(z)
M-bit truncator
DAC
,
'iii••
I-IIII
.,1
=I

7
Delta-.5lgma DACs
gains of these filters will degrade the cancellation of the i-bit truncation error and
hence the SNR, but will not introduce nonlinear signal distortion.
7.3.2 Multi-bit Delta-Sigma DACs with Mismatch Error Shaping
As
mentioned earlier, the
mismatch-error-shaping
techniques
discussed in
Section 6.4 (data-weighted averaging, individual level averaging, vector-based
mismatch shaping, tree-structure element selection) remain applicable to the inter-
nal DACs in multi-bit D/A converters. Again, however, there are new possibilities
and trade-offs to consider for ~ DACs.
In a multi-bit.6.~ ADC, the number of bits N used in the output is generally limited
to about 4, since for N = 5 the internal ADC already needs 32 comparators with
associated circuitry, and hence requires substantial supply power and chip area.
I
I
~
1!
~
I
232
Figure 7.10: A third-order dual-truncation MASH noise-shaping stage.
: !
! :
"
I••-
~..
~
II
.I
~-
-
To next stage
of the smoothing
filter
Capacitors and switches
of the first smoothing
filter stage
+
h)CF-J.2
$t=!="C
4
+
-
E
~1
~
Vref0------::t11T:""'"
2
F.i J!1
-
-
M-bil
DAC
20
M
-e
)-'7<--,,---,L----.,.. To E, Fswitch
control logic

•
6.£ DACs Using Multi-Bit Internal OAes
For N = 2-4, the complexity of the DAC itself, and that of digital circuitry imple-
menting the necessary mismatch shaping, are both relatively low, and no special
schemes are needed to simplify them.
By contrast, in a multi-bit AL DAC, no internal ADC is required, and hence values
of N higher than 4 may be chosen. However, since the complexity of the DAC and
its error-correction circuitry grow exponentially with N, they may then require too
much chip area and bias power. We may use 2N as a complexity index; generally,
for N > 4, its value is impractically high. This problem, and its solution, will next
be discussed in tenns of a second-order 6-bit delta-sigma DAC.
H1(z)
H2(z)
H3(z)
M-bit
truncator
M
MSB
LSBs
M-1
I-bit
(M-l)-
DAC
bit
DAC
'----l~+ t---..J
v
Figure 7,11: A single-stage dual-truncation D/A loop,
233

I
------'-D.-lta-..-'g-m-.-DA-C-.-----------------------j j I
r~
An obvious solution to having too many bits (here, 6 bits) in the DAC input signal
is tD use segmentation, Le" to split the 6-bit input data stream into two 3-bit seg-
ments: an MSB signal and an LSB one. The two segments can then be separately
encoded into thennometer-coded words, scrambled and converted into analog sig-
nals (Fig. 7.12). The weighted sum of the two analog outputs provides the overall
output signal. The effective complexity index of this system is 2.23 = 16,lower
(by a factor of 4) than that of a direct realization of the 6-bit DAC, which is
26 = 64.
The problem with this approach is that both the MSB and LSB segments contain
large distortion components, which ideally cancel if the two are recombined
exactly, with the weight factor 8 needed to scale the MSB analog output. However,
if this factor is inaccurate, then the unfiltered quantization noise and distortion
components contained in the MSB and LSB outputs will not cancel perfectly, and
this will significantly degrade the linearity and SNR performance. This degrada-
tion will occur even if the scramblers in both paths use mismatch shaping, since
the noise is already contained in the scrambler inputs Band C, and not generated
by the internal DACs.
A way to overcome this accuracy problem is illustrated in Fig. 7.13 [6]. An addi-
tional first-order 6.I: loop is cascaded with the main modulator, and it compresses
•
I
1W''.".
--
!!·;;;;;;
i i
••

6I: OACs UsIng Multi-Bit Internal OACs
--i
"r
the word-length of its 6-bit input A into 4 bits. Denoting the NTF of MOD1 by
HI' and its quantization error by EI' the two segmented signals are then the 4-bit
output B = A + HIE1 of the first-order loop, and C ;;;; -H 1E I ' which is the neg-
ative of its shaped 3-bit quantization error. C is generated by subtracting the input
A of MOD1 from its output B. Both signals Band C are next thermometer-coded,
scrambled and D/A converted, and then added, using a scale factor 4 for B to make
up for the shift of the binary point when C is thermometer coded. Ideally, the ana-
log output is therefore
B + C = A, as required. The complexity index is
24 +23 = 24, still much lower than the value 26 = 64 associated with the
unsegmented system.
In the system of Fig. 7.13, both Band C are noise-shaped signals, and hence if
there is an error in the analog scale factor 4, so that C is not completely cancelled,
the resulting output error will be only some additional shaped noise. For suffi-
ciently high oversampling ratio (say, 128), a 1% DAC element matching error will
still allow a 110 dB SNR [6].
Another segmentation scheme for tU: DACs is illustrated in Fig. 7.14. [7]. Here,
the L LSBs of the input data stream are compressed to shorter (B-bit, B < L) words
by an error-feedback noise-shaping loop, and fed to a digital adder. The M MSBs,
by contrast, are directly entered into the adder. Since the addition is digital, it can
ut
~
Scrambler
l:2,
4-8i1
/7'4~--,8'+l Scrambler
MOD1
l2,
k,
,....---,
,....---,
6-811
6 A
MOD2
Figure 7.13:
Noise~shaped segmentation.
235

7
Delta-Sigma DACs
be highly accurate. For a 6-bit input. the 4 LSBs may be compressed into 2 bits,
and combined with the 2 MSBs to result in a 4-bit DAC circuit. For sufficiently
large OSR. the accuracy can be satisfactory. (Note that this system is just a first-
order modulator; it does not split the data into an MSB stream plus a noise-shaped
LSB stream like the system of Fig. 7.13 does.)
-
iI•i
7.3.3 Digital Correction ofMulti-Bit Delta-Sigma DACs
As already mentioned in Section 6.5.1, a power-up calibration is readily available
for multi-bit dL DACs. The block diagram is shown in Fig. 7.15. The RAM stores
the digital equivalents of the actual analog outputs of the DAC for all possible
input codes. The feedback loop forces the inband spectral components of the RAM
output to follow the digital input u(n) , and since the inputs of the RAM and the
DAC are the same, the output of the DAC follows that of the RAM. In conclusion,
the inband part of the DAC output signal will be the analog version of the input
signal "(n).
.
I
I
j
As discussed in Section 6.5.1, the calibration (i.e., the storing of the appropriate
numbers in the RAM) can be petformed at power-up, using an auxiliary I-bit
delta-sigma ADC (Fig. 7.16). In the calibration process, a digital counter produces
U---,N;.L-_~MpM",S""B,,,s,----
~.+ M+8-1
DAC
v
L
.J
Figure 7.14: A hardware~reduced first~order modulator with dither.
j
I i
I!I
••
~;
I··F
L
i - :
.. -
I
=
!
I--{+).o_o---------'
8
- 6fgrtaiNOfse-Shaping Loop -
~
dither
I
L
LSBs
236

~ DACs Using Multl..Blt Internal OAt.
i
sequentially all input codes for the DAC. For an M-bit DAC, the counter will thus
count up to 2M . Each code from the counter is held at the DAC input for at least
IN clock periods, where N is the required DAC linearity (in bits). The DAC output
is converted by the ADC into a i-bit data stream, whose de average is linearly
related to the DAC output. A digitallowpass filter recovers this de value, which is
then stored in the RAM at the address given by the counter output.
Background calibration is also possible. In a classical scheme [9] implemented for
a current-switching DAC, the DAC contains two more unit current sources than
necessary for conversion. One is used as a reference. In each clock period, a new
Analog
tput
v
t
M
ou
,~
L(z) f---+
M-bit
M-bit
truncator
DAC
N
RAM
Digital
inpu
u
Figure 7.15: A digitally.corrected M·bit DAC.
From
M-bit
counter
M
M-bit»
L(z)-
1-bit
Digital ~
DAC
ADC
LPF
1-bit I-
DAC
data In
•
~ RAM
•••
Figure 7.16: Calibration scheme for digital correction.
237

7
Delta-5igma DACs
unit source is selected for calibration, and the reference current is copied into it,
while the remaining sources perform the data conversion. Thus, by selecting the
calibrated source in a rotating pattern, every source can be recalibrated in each 2M
clock periods.
Another background calibration scheme for current-mode DACs was described in
[10]. Here, the current sources are measured and adjusted against a reference
source, using an auxiliary DAC and a I-bit ~~ ADC.
A charge-based calibration scheme similar in principle to that of [9], but suitable
for switched-capacitor DACs, was described in [11]. Here, the charges delivered
by the unit-element capacitors are adjusted sequentially, using a variable reference
voltage for each element, until all charges match a fixed reference charge. This
scheme also requires extra unit elements.
7.3.4 Comparison ofSingle·Bit and Multi-Bit ~ DACs
Comparison of single-stage ~ DACs with single-bit or multi-bit internal trunca-
tion shows the following relative advantages of the two schemes:
Single~bit truncation: Much simpler internal DAC structure can be used, without
the need for thermometer coding, unit elements and digital mismatch-shaping
logic.
Multi-bit truncation: Several advantages can be obtained. including
1. Simpler digital noise-shaping loop, since more aggressive NTF may be used,
and since the truncation noise is reduced by at least N - 1 bits.
2. Less (or no) dithering, since tones are less likely to be generated, and since typ-
ically the amplitude of dithering is about 1/2 LSB, which is smaller in a multi-
bit quantizer.
3. Much simpler analog smoothing filter, since the slewing and out-of-band noise
in the DAC output are both reduced. Also, the sensitivity to clock jitter is
reduced, due to the reduced step size in the DAC output signal.t
---~~~~~--~~~~~~~~~~-
238
I
=
1- -
-:
-
-,
-
I
jj

""i
Interpolation Fiherlng lor AI: DACs
Generally, the advantages of multi-bit truncation outweigh those of single-bit trun-
cation, and hence it is preferable to design IlL DACs with multi-bit intemal DACs.
As an illustration, ref. [3] describes a ~ audio DAC using single-bit internal trun-
cation, while ref. [8ldiscusses a 5-bit DAC with comparable performance. The 1-
bit DAC needed a 5 -order noise-shaping loop; the 5-bit DAC required oolh a 3rd_
order loop. The i-bit DAC used an analog smoothing filter containing a 41 -order
switched-capacitor (SC) filter, followed by an SC buffer stage and a 2nd-order con-
tinuous-time active filter. By contrast, in the 5-bit system, the SC analog filter was
effectively merged with the DAC itself, and required no extra operational amplifi-
ers. On the other hand, the mismatch-shaping applied in the 5-bit DAC needed a
fairly elaborate digital circuitry.
7,4 Interpolation Filtering for dL DACs
Efficient implementation of the digital interpolation filter IF preceding the noise-
shaping loop (Fig. 7.1) usually requires a multi-stage structure. A typical architec-
ture and the role of the individual filter stages will next be discussed. We use as an
example lbe IF of a classical18-bit audio DAC [3]. The block diagram of the DAC
is illustrated in Fig. 7.17; the structure of the IF in Fig. 7.18. The IF contains three
cascaded finite-impulse~response(FIR) filter stages, followed by a digital sample-
and-hold register. (A similar DAC IF was implemented in the more recent audio
1-bit
DAC
--
II
18-bit
digital
18-bit
1-bit
input ...-
---, 8fs ...-__---, 64fs
fs
th
,....--,
8x
5 -order
Interpolation
IlL
Filter
Modulator
analog
output
,.----,
Analog
Lowpass
Filter
Figure 7.17: An IS-bit D/A converter architecture.
t. The sensitivity to clock jitter can also be reduced if the analog smoothing filter has switched-
capacitor input stages [3].
-----------------~-------
239

7
Delta-Sigma DACs
DAC discussed in [8J.) Fig. 7.19 shows schematically the spectra of the signals
appearing at the inputs and outputs of the individual iF stages, as well as the final
output of the DAC.
As explained in Section 7.1, the purpose of the IF is to take advantage of the
increased clock frequency, and to suppress all unnecessary replicas of the signal
spectrum occurring between the baseband and OSR· Is' This will improve the
dynamic range of the noise shaping loop, and ease the selectivity and linearity
requirements of the analog output filter. As was also mentioned in Section 7.1, the
unwanted sidebands need not be totally erased, since truncation noise will be intro-
duced in their place anyway in the noise-shaping loop NL.
In principle, it is possible to raise the sampling frequency immediately to
OSR· Is' and then to carry out all filtering at this elevated clock rate. However,
this would require all digital circuitry to function at high speed, and it would hence
dissipate an unnecessarily large amount of power. It would also generate more dig-
ital activity, and thus more digital noise, than necessary. Therefore, it is preferable
to perfonn the increasing of the clock frequency and the filtering in parallel steps,
with most of the signal processing performed at a low clock rate.
The first stage of the filter is operated at 2f, (Fig. 7.18), and is used to suppress
the odd-order images. Thus, it removes the first replica of the baseband, assumed
to extend approximately from I B to 31B' as well as the third replica between
5I Band 71B' etc. The operation is illustrated in Figs. 7.19a and b, where the first
curve shows the spectrum of the Nyquist-sampled input signal, and the second the
desired spectrum of the first-stage output. Notice that the requirements on this
I -
••i ~
=
=
, <::
Figure 7.18: Interpolation filter arehiteeture.
~
FIR 2x
1215•
FIR 2x
1415..
FIR2x ~
,64(5
lnterp.
Interp.
Interp.
8/H
Filter
Filter
Filter
18-bit
digital
input
240
125 taps
25 taps
4 taps
Inter-
polator
output
•
• •·-
! 1=
!
!!!!!
!
-·
J
--
-
~
I
_ l

•
Interpolation FilterIng for 6.L DACs
=
•
~
=•
-- ••....' .••.. <.-
.•.' •
. -,-
","
-80
b)
0
j---;,......'
'
r '--+--;' ..,.
-,_
-,
,
.............
.;. - ..
...... '," -,-
..! ...' ... ' .
.....
., ...' ....-..,-..,- - ,'.
.. ,.....
-
,
.
,......,..-;' ...'..
~..... ,.
. ~ ...'- - . '. .. ..' ...'.,. '... , .. , ...'.
- -.,
, . ","..
.
,.
.,
.
. . . .. ..:. -. ; ...;. ..:_.
... :..
-100
-100
-100
C)
0
d)
0
e)
0
1
'j
I
II
....
. -,
.
-100
f)
o
...
.
-
,
.. ,. ',"
.
.. ,- ..,
,
.
','
. .'... "... ,...: ...:... :- ...' ..
~ ..
. .'... , .. ,.. ,'-
.. :... , ...'.
.'..
Fignre 7.19:
-1 OOL.jL...l_L-L---L..L.....L-':c--L.':--'L...i:-'--L--'-,-':--':--':c--L.L..-J
o fB
Is
2fs
3fs
4fs
5fs
6fs
Us
Bls
91s
1als
Frequency
Spectra within a ~L DAC system.
241

11
--------------------
7
Delta-5igma OACs
1
-----------------:
stage are very demanding: it needs to have a flat passband with extremely small
(here, about 0.001 dB) gain variation in the 0 to f B frequency range, and a very
sharp cutoff in order to suppress the adjacent image which is quite close. In the fil-
ter discussed in [3], this stage was realized by a 125-tap half-band FIR filter. (Half-
band filters are FIR structures, which allow every second tap weight (except the
center one) to be zero, and hence are very economical. A halfMband filter can only
realize, however, a frequency response which has a skew symmetry around its mid-
point at /./4, as shown in Fig. 7.20. Thus, the pass- and stop-band limit frequen-
cies must be symmetrically located, and the ripples must be the same in the two
bands. These restrictions are usually acceptable in the interpoiation-by-2 filtering
task perfonned here.)
•
The second stage of the IF has a clock frequency of 4fs ' Its task is to remove the
images between 3fB and 51B , 71B and 9/B , etc., as shown in Fig. 7.19c. Its
cutoff needs to be much less abrupt than that of the first stage. In the system
described in [3], this task required a 24-tap half-band FIR filter. The third stage,
operated at Sis' was a 4-tap half-band FIR filter. It reduces the first, third, etc. of
the remaining images (Fig. 7.19d).
Finally, a digital sample and hold operation was implemented by simply raising the
sampling rate to 64/s' and repeating each output sample of the third IF stage S
-
! •
~ ~
,
0
........ ·
: Symmetry center
o
0.25
0.5
Normalized Frequency
Figure 7.20: Frequency response of a half-band filter.
242
-,
I•-

Analog Post-Filters for AE DACs
times. This 51H operation introduced a sine function which had zeros at 8/s '
16/"24/,, etc., thus contributing slightly to the filtering at no added cost, as
illustrated in Fig. 7.1ge. The final OSR was thus 64.
Note that the IF is designed to provide most of its noise suppression just above the
signal band, where the analog filter following the DAC has the most difficulty in
removing noise.
In the noise-shaping loop NL following the IF, some truncation noise is added to
the residual out-of-band noise (not shown in Fig. 7.19). Ideally, the resulting spec-
trum is then accurately reproduced at the DAC output, and finally all noise is
removed by the analog LPF, giving the output spectrum illustrated in Fig. 7.19f.
The word-length used for data in the IF was 18 bits. 19-bit accuracy was used for
the constant coefficients. The overall truncation noise was 107 dB below the full-
scale sine-wave signal power, consistent with an approximately 18-bit perfor-
mance.
Note that FIR filters are commonly used in LU: systems since these filters can have
perfectly flat group delay, and also since the required hardware can be clocked at
the lower of the input and output data rates. IIR filters are less common, but have
the advantage of being able to provide greater stopband attenuation with a given
hardware complexity.
7.5 Analog Post-Filters for SF, DACs
As discussed earlier, difficult analog circuit problems may arise in the design of the
post-filter of the ~ DAC. This filter, as illustrated in Fig. 7.19, needs to remove all
out-of-band portions of the output signal of the internal DAC, and must not intro-
duce appreciable nonlinear distortion into the signal while doing so. This task is
particularly difficult for single-bit DACs. where a large two-level analog signal
enters the post-filter.
Depending on the application, it may also be necessary for the post-filter to pro-
vide exactly or approximately linear phase characteristics. Alternatively, it may be
243

7 Delta.Slgma DACs
designed with mildly nonlinear phase, and the phase error compensated in the dig-
ital interpolation filter.
In this Section, the post-filter design issues arising for single-bit and for multi-bit
DACs will be discussed separately, and illustrated with examples from commercial
chips.
7.5.1 Analog Post-Filtering in Single-Bit M; DACs
The block diagram of a typical post-filter for a single-bit DAC is shown in
Fig. 7.21. The functions of the various blocks will be explained next.
As mentioned above, the input signal x(t) of the post-filter in a single-bit DAC is a
large two-level signal. The minimum swing of x(t) is restricted by the condition
that the inband component (i.e., the useful signal) needs to be much larger than the
thennal and other noises introduced by the filter itself. This necessitates a large
amplitude, since most of the power in the DAC output signal is out of band. Hence,
if this signal were to be entered into a conventional active filter, the active compo-
nent (op-amp or transconductance) would need an impractically high slew rate to
avoid slew-rate-limited operation which generates harmonic distortion.
A more subtle linearity problem is due to the slew-rate limited slopes and imper-
fect symmetry of the waveform of x(t) itself, since it is generated by an imperfect
internal DAC. Also, the exact shape of the wavefonn may depend on its previous
values. Thus, while the periodic samples x(nn of x(t) may correctly and linearly
reproduce the useful signal, the Fourier transform of the continuous-time x(t) will
usually contain harmonics.
•I
~
,I
•
JUl
r-'
~
~
III
,
·1
I
·1
I
.1 CT FilterI
~ "
x
SCF
Buffer
• Y
;; =.
Figure 7.21: Post-filter for a I-bit 8~ DAC and associated signals.
244
. _---
:~i

I
I
Analog Post-Filters for t:.:E DACs
To alleviate both problems, it is customary to use switched-capacitor filter (SCF)
stages as the input stages of the post-filter. A SCF with sampled-data input and
output needs only the samples x(nT) of x(t) as its input signal, and it can remove
most of the highRfrequency power from the signal (and thus reduce its step size)
without requiring high op-amp slew rate. Once the step size of the waveform is
small enough, such that the slew rate required for its linear continuous-time (CT)
processing is acceptably low, it can then be filtered by a cr active filter.
To understand the basic difference between the slew-rate requirements of CT and
SC filters, consider the SC integrator shown in Fi~. 7.22a. During phase tjll' the
input voltage x(t) charges C1; at the end of the n
clock phase $1 ' for properly
designed switches, the charge will very accurately equal CI . x(nT). At the same
time, C3 samples the output voltage y(t) of the op-amp. This voltage has abruptly
changed when
tjl2 went high; as illustrated (in an exaggerated fashion) in
a)
=
x(t) 0---3t-JCh:-J.2
$!..-jCh::
-
J.4'2 J.4'1
.~•
-
-
y(t)
J.4'1
•
-
-
•i
-
b)
y(t)
slewing ~+/ ~ lin~ar settling
o
T
2T
3T
t
Figure 7.22: An SC integrator.
245

7 Delta-8lgma DACs
Fig. 7.22b, it underwent a slewing and settling process. The settling continues dur-
ing <1>1' For properly designed op-amp and switches, the final value y(nT) will be
very close to the theoretical value y(nT-T)+(Ct /C2)x(nT-T), and the
charge in C3 wiH be very close to C3 · y(nT). Thus, the sampled signal process-
ing is essentially unaffected by the nonlinear effects introduced by the slewing and
(possibly nonlinear) settling of the op amp. Hence, the slew rate of the op amp
does need to be very high, just high enough to allow accurate settling of yet) in the
allocated time period. This makes the SCF particularly well suited for the task at
hand.
Since the signal/noise ratio of the SC filter in a ~ DAC must often be extremely
high, its susceptibility to internal noise sources is an important design factor. This
may result in the choice of unconventional architectures for the SCE The most
commonly used configuration, a cascade of biquads, has inferior noise-gain prop-
erties, as will be demonstrated next. Consider the block diagram of such a filter,
shown along with its noise sources ni · in Fig. 7.23a. Clearly, nil has the same
gain to the output as the input. When n~2 is referred back to the input, its power is
divided by IIllIZ, where III is the transfer function of the first integrator. This
division is equivalent to differentiating (high-pass filtering) the noise, and it thus
reduces the inband noise introduced by n IZ .
Consider now the first noise source nil of the jth biquad. When it is referred back
to the input, its power is divided by the factor IH IHz·· .Hi _ 112, where H k is the
transfer
function
of
the
kth
biquad.
Dynamic
range
scaling
causes
IH1Hz" .Hi _11:5: 1 and hence when nil is referred back to the input, its inband
power, is not reduced. The power gain of niZ is 1/IIil12 times that of njJ' and
hence it is first-order noise shaped.
In conclusion, for high oversampling ratios, the input-referred noise power is the
weighted sum (with weight factors larger than or equal to 1) of the unshaped input
noise powers of all biquads in the SCF, a decidedly unhappy situation.
Consider, by contrast, the structures shown in Figs. 7.23b and c. Simple analysis of
the first one (sometimes called "inverse follow-the-Ieader" structure) shows that
referring noise source nj to the input is equivalent to multiplying its noise power
246
,,
I,
j "I
=
ii•••
~

-
I
Analog Post-Filters for ~~ DACs
by 1/11112...I ._ 112. Thus, all noise sources (except n1) are shaped, and for high
OSR the noiseis dominated by nl ' with all olher sources conlrihuting negligible
in-band noise power.
For the structure of Fig. 7.23c, analysis shows that n1 remains unshaped, nz first-
order shaped, and all other noise sources are suppressed by a second- or third-order
shaping. Hence, again n 1 dominates the overall noise, for a very good noise per-
fannance. (Notice that- like the structure of Fig.7.23a, but unlike that of
Fig. 7.23b- the architecture of Fig. 7.23c allows the realization of finite transmis-
sion zeros, which improves its selectivity capabilities.)
a)
H1; biquad 1
Hi: biquad i
... -----------,
... -----------,
I
n11
n'2
I I
ni'
ni2
I
i~l~out
:~:-:-~:--~
L
.J
L
.J
Figure 7.23: Reconstruction filter architectures.
247

7 Delta-Sigma DACs
In conclusion, in high-accuracy DACs, the architectures of Figs. 7.23b and c may
be preferable to that of Fig. 7.23a, or other commonly used SCF structures. (Note
that our discussions ignored the different sensitivities of the various configurations
to element value variations. This is usually less important in the present context,
since the variations tend to be small, and the exact response not too critical.)
Figs. 7.24-7.27 compare the realizations and noise shaping properties of two
Bessel SCFs realizing the same transfer function [12]. Fig. 7.24 shows a biquad
realization, and Fig. 7.25 its noise transfer functions from source to output.
Fig. 7.26 and Fig. 7.27 show the same for the inverse follow-the-Ieader structure.
The curves demonstrate the superior noise shaping properties of the latter architec-
ture.
After sufficient filtering, the step size of the SCF waveforms can be greatly
reduced. However, the wavefonns will still exhibit op-amp-induced transients rep-
resenting nonlinear distortion. Hence, it is necessary to use a buffer stage which is
Figure 7.24: A 4th.order Bessel filter implemented with a cascade ofbiquads.
248
j'
~
i
'1 i
iII
I•-
IiI•!•·
~

An'alog Post-Filters for tI.:E DACs
0
iii'
~
~
u
~
-20
.~
C>..
:::;
-40
20.----;-,----,--_c----,
,,,,
,
,
:
:
",'r;,:S-';' op amp 3
I
I.'
/1
j
j.'
/
1
_____ ~------~c~--~----
I
".:" :
op amp 1
1,";11
t
I
.""
I
I
I
,
I
I
______ 1"_ f- __ +
-,
_
opamp2"
j
I
,."
~
I
j
,.' op amp 4
,-'
I
,.
/
I
:
I
_
L.L__'---_--'
,__--'
10
100
1k
10k
1001<
Frequency
Figure 7.25: Noise gains from each op·amp input to the
output for the circuit of Fig. 7.24.
oul
L
3.82
H
K
+-= 411
1.00~
I
'.0~
G
9.32
411 ~oo
cfI2~~ cfI1
1.~O
412
l~2l' ~ }J2l~l----r-.
Figure 7.26: A 4th-order Bessel filler implemented with Ihe
inverse follow-the-Ieader topology.
249

7 Delta-Sigma DACs
driven by the samples y(nD of the SCF output, and which provides a waveform
free of such transients. This can be achieved by using a direct-charge-transfer
(Dcr) stage [13]. A low-pass DCT stage is shown in Fig. 7.28a. It samples the
input signal x(t) at the end of phase lP1' storing it in Ct. As ~2 goes high, Ct is
switched across C2, and the two capacitors share charges (Fig. 7.28b). Since the
left terminal of the parallel combination is floating at this time, no external charge
enters the branch during the charge transfer; in particular, the op-amp does not
need to contribute to the high impulsive current flowing. Thus, this transient is
governed by a simple first-order differential equation, with only the switch on-
resistances and the capacitance C1+ C2 determining the time constant. This way,
a fast and clean transient may be obtained, which does not exhibit the slewing and
nonlinear settling behavior which the op-amp would normally exhibit.
I
;;; =
The output of the buffer stage can now be fed to the CT filter. This filter needs to
eliminate the remaining noise above f B' Typically, it is a second- or third-order
active-RC circuit, often using the Sallen-Key configuration [14].
=
I
I
100k
10k
1k
Frequency
Figure 7.27: Noise gains from each op-amp input to the
output for the circuit of Fig. 7.26.
250

Analog Post-Fitters for AI: DAes
7.5.2 Analog Post-Filtering in Multi-Bit dL DACs
For multi~bit ~ DACs, the tasks, and hence the design, of the post-filter can be
much easier. The out~of-band noise power is reduced due to the smaller step size;
the remaining power decreases exponentially with the number of bits N retained
after truncation. The corresponding simplification in the SCF is hence also greatly
dependent on N.
TWo examples will be shown to illustrate the design of post-filters for multi-bit..6.~
DACs. For the first one [8J, N - 5 (31 levels) was used in the truncation. A single
SC stage (Fig. 7.29.) was used to perform the functions of the internal DAC and
the SCE Since it was a direct-charge~transfer circuit, it also made the extra SC-to-
CT buffer stage unnecessary. Thus the DAC, SCF and buffer functions, which
would have required 5-6 op~amps for a single-bit DAC, were all performed by a
single op-amp for the 5~bit system. In the circuit of Fig. 7.29, the DAC operation is
a)
C2
X(I) 0---51
C~2
-.L4'1
yet)
-
b)
C1
C2
i= 0
i= 0
+
Figure 7.28: A direct-charge-transfer (OCT) stage.
251

7 Delta-Sigma DACs
performed during cjll ' by pre-charging some of the 4x3l small capacitors in the
four capacitor arrays to VDD and discharging others. By duplicating the capacitor
arrays, and driving the secondary arrays with a delayed digital signal, a first-order
(2-tap) FIR filter function is realized. During 4j)2' all capacitors are connected in
parallel with the feedback capacitors CFB in a DCT operation. The overall trans-
fer function between the digital input and the samples of the output signal, nonnal-
ized to the full-scale output, is hence
where
H(z) :!(
1+ z-1
)
2 1+r-rz-1
(7.3)
1
--
I
•
~
i•
~
•
=:a
it••i••i
~
i
"
(7.4)
I
I
;;;;
i-i:
•
=
, !!
II
out
- --
~
out
00'
It~
31-Level
31-Level
Cap Array
Cap Array 1$, $"
I'-..
""m
+ >V
f-t>o-
0",
4»-
out t, ~2l+
31-Level
31·Level
Ca~,Array
Ca~,~ray
om
CFB
t $2--1 Reg I
DEM outpu
SV1 to sV31
Figure 7.29: Combined DAC, DCT and 1iI1er for a mnlti-bit ~ DAC [8].
252
•
;
~ l

•
!J
1I
1
Analog Post-Filters for tU: OAes
DEM data
(sv)
r-
,~~2-l12-Capacitorl-_,~:,,:2,-
-,
Array (CIN)
C"
Figure 7.30: Another dr DAC with merged DAC, DCT and
SCF filter functions [15].
This simple first-order fIR filter was adequate to prepare the signal for CT filtering,
perfonned off-chip by a Sallen-Key filter.
Another 8L DAC, described in [15), used a 13-level (N - 3.7 bits) truncation. Its
SCF was a third-order Chebyshev filter. It is shown in Fig. 7.30 as a single-ended
circuit (the actual implementation was fully differential). The DAC action is per-
formed during ep1' by charging to V DD or discharging the 12 capacitors in the
input array CIN' During $2' the circuit is configured as a third-order inverse fol-
low-the leader SC filter, with the charge acquired by C1N during $t acting as its
input signal. A simple first-order active-RC stage was used to perfoon both the CT
filtering and the clifferential-to-single-ended conversion.
253

7
Delta-Sigma DACs
7.6 Conclusions
Chapter 7 was devoted to the design of delta-sigma DACs. First, the general princi-
ples and basic DAC architectures were discussed, and then various structures avail-
able for realizing their noise-shaping loops were described. Due to the high
accuracy made possible by the all-digital loop, some novel loop architectures (not
practical for ADC loops) exist in delta-sigma DACs. These were introduced, along
with some variants of the conventional MASH configurations specific to DACs.
As was the case for ~ ADCs, either single-bit or multibit internal quantization
may be used in dL DACs. The relative merits of these two options were compared,
and various methods were discussed for the filtering or compensation of the error
signals introduced by the unavoidable nonlinearity of a multibit internal DAC.
Again, some of these schemes are similar to those applicable to multibit ADCs,
which have already been discussed in Chapter 6; others are specifically aimed at
b.l: DACs, and were described in this chapter.
Next, the design issues of the digital interpolation filter were discussed, and illus-
trated by an example. The example chosen was an efficient multi-stage filter used
in a commercial] 8-bit audio delta-sigma DAC.
Finally, the design of the analog postfilter used in ~ DACs was discussed. The
two different situations arising for single-bit and for multi-bit truncations were
contrasted, and filter design techniques were described for both systems, along
with some typical examples.
References
I•
~
"
[1]
P. J. Naus, E. C. Dijkmans. E. F. Stikvoort, A. J. McKnight, D. J. Holland, and W.
Brandinal.. "A CMOS stereo 16-bit D/A converter for digital audio," IEEE Journal ofSolid-
State Circuits, vol. 22, pp. 390-395, June 1987
I2J
J. C. Candy and A. Huynh, "Double integration for digltal-to-analog conversion," IEEE
Transactions on Communications, vol. 34, no. l, pp. 77-81, January 1986.
[3J
N. S. Sooch, J. W. Scott, T. Tanaka, T. Sugimoto and C. Kubomura, "I8-bit stereo D/A
converter with integrated digital and analog fihers," presented at the 9Jst convention ofthe
Audio Engineering Society, New York, October 1991, preprint 3113.
254
i
j
-------..-----J~
!!

[4J
[5]
[6]
[7]
[8]
[9)
[10]
[lIJ
[12]
[l3J
[14]
[15]
Conclusions
X. F. Xu and G. C. Ternes, "The implementation of dual-truncation :Eli DJA converters,"
Proceedings ofthe IEEE International Symposium on Circuits and Systems, pp. 597~600,
May 1992.
A. Hairapetian, G. C. Ternes and Z. X. Zhang, "A multibit sigma-delta modulator with
reduced sensitivity to DAC nonlinearity," Electronics Letters, vol. 27, no. 11, pp. 990-991,
May 231991.
R. Adams, K. Nguyen and K. Sweetland, "A 113dB SNR oversampling DAC with
segmented noise-shaped scrambling," IEEE JourTUll ofSolid-State Circuits, vol. 33, no. 12,
pp. 1871-1878, December 1998.
S. R. Norsworthy, D. A. Rich and T. R. Viswanathan, "A minimal multibit digital noise
shaping architecture," Proceedings of the IEEE International Symposium on Circuits and
Systems, pp. 1-5 to 1-8, May 1996.
I. Fujimori, A. Nogi and T. Sugimoto, "A multibit 6.-:E audio DAC with l2O-dB dynamic
range," IEEE Journal ofSolid~Slate Circuits, vol. 35, pp. 1066~1073, August 2000.
D. Groeneveld et aI., "A self-calibration technique for monolithic high-resolution D/A
converters," IEEE J. Solid-State Circuits, vol. 24, pp. 1517-1522, Dec. 1989.
A. R. Bugeja and B.-S. Song. "A self~trimming 14-b 100 MS/s CMOS DAC," IEEE Journal
ofSolid-State Circuits, vol. 35, pp. 1841-1852, Dec. 2000.
U. K. Moon et aI., "Switched-capacitor DAC with analogue mismatch correction,"
Electronics Letters, vol. 35, pp. 1903-1904, Oct. 1999.
M. Rebeschini and P. F. Ferguson, Jr., "Analog Circuit Design for ft:E DACs," in S.
Norsworthy, R. Schreier and a.c. Ternes, Delta-Sigma Data Converters, Sec. 12.2.3, IEEE
Press, 1997.
I.A.C. Bingham, "Applications of a direct-transfer SC integrator," IEEE Transactions on
Circuits and Systems, vol. 31, pp. 419-420, Apr. 1984.
See, e.g., R. Schaumann and M.E. Van Valkenburg, Design ofAnalog Filters, pp. 161-163,
Oxford University Press, 200l.
M. Annovazzi et aI., "A low-power 98-dB muJtibit audio DAC in a standard 3.3-V 0.35-J.lrn
CMOS technology," IEEE Journal ofSolid-State Circuits, vol. 37, pp. 825-834, July 2002.
25S

256
7 Delta·Sigma DAC,
j
•,•

CHAPTER 8
High-Level Design and
Simulation
This chapter describes the use of several key functions found in the Delta-Sigma
Toolbox for MATLAB as well as some of the supporting theory. Since it is not nec-
essary to understand algorithmic details before making use of the toolbox, the
reader may choose to skip over sections that contain such material. A complete ref-
erence manual for this freeware toolbox, including instructions for obtaining it,
may be found in Appendix B.
8.1 NTF Synthesis
The first step in the design of a ~ modulator is the selection of the NTF. The mod-
ulator order, the number of quantization levels, and the choice of lowpass. band-
pass or quadrature modulation are all design parameters. Figures 4.14 to 4.16 of
Chapter 4 depict the SQNR limits for lowpass modulators of orders 1 to 8, with 1-
bit to 3-bit quantization, as functions of the oversampling ratio. These plots can be
used to estimate the number of quantization levels and the modulator order needed
to achieve a particular OSR-SNR target. Once approximate values for these param-
eters have been selected, the designer can perform a detailed examination of the
NTFs surrounding this point in the design space.
257

8 HIgh-Level Design and Simulation
As an example, consider the goal of achieving an SNR of 100 dB with an OSR of
64. Aiming for an SQNR of 120 dB will ensure that quantization noise is negligi-
ble and will also provide plenty of design margin. According to the plots in
Chapter 4, either a 5th_order single-bit modulator, a 4th.-order 2-bit modulator, or a
3rd-order 3-bit modulator could be used to achieve this SQNR. In practice, each of
these architectures should be tried and evaluated in tenus of power and/or area effi-
ciency, but for the sake of simplicity we will consider only the first configuration.
Fig. 8.1 shows the MATLAB code which synthesizes a 5th-order NTF, and which
then creates plots of the pole-zero distribution and the frequency response. (Code
for fonuatting the figures is not shown.) The function which synthesizes the NTF
is synthesizeNTF. The first two arguments to synthesizeNTF specify the
order of the NTF and the oversampling ratio, while the third argument (opt) is a
flag which specifies whether or not the NTF zeros are to be optimized for maxi-
T
+
i~
I
.!!
II-i
=
I••··•!
0.5
.... ,
0.4
-80
Of::
-20 .
-80
~(JH'= -95dB
-100
'
,
.
o
0.1
0.2
0.3
Normalized Frequency
MATLAB code for creating a lowpass NTF.
Figure 8.1:
o
:
'l
"
order = 5;
OSR
64;
opt
= 1;
H = synthesizeNTF(order,OSR.opt);
plotpz (H) ;
f
= 1inspace(O.O.5,lOOO);
z = exp(2i*pi*f);
plott
f,
dbv(evalTF(H,z)}
};
sigma_H = dbv( rmsGain(H,O,O.5/0SR}
);
258
I
,
!
Li

•
I•
rI
I
NTF SynthesIs
mum attenuation of quantization noise in the band of interest. Optional fourth and
fifth arguments specify the NTF's out-of-band gain (Hinf) and, for bandpass mod-
ulators, the center frequency (fa). Since the out-of-band gain was not specified in
this example, IIHlIoo defaults to 1.5. Likewise, since the center frequency was not
specified, f 0 defaults to zero. In the documentation for synthesizeNTF (on page
B-393), these default values are indicated in the synopsis of the function as values
following an equals sign (=) in the parameter list:
ntf
= synthesizeNTF(order=3,OSR=64,opt=O,H_inf=1.5,fO=O)
The same notational convention applies to all other toolbox functions.
The nns gain of the NTF in the band of interest is calculated using the function
rmsGain, and the result is converted to units of dB using the function dbv.
(dbv(v) = 2010g lO(v) is the dB-equivalent of a voltage v.) From this calculation,
we find that the chosen NTF provides 95 dB of suppression for the quantization
noise which falls in the passband. If we assume that the power of the quantization
noise is cr; = 1/3 = -4.8 dB , then the power of the shaped in-band quantization
noise is expected to be cr2 = cr~cr;/OSR, which gives -95 - 4.8 -1010g 1O(64) =
-118 dB.
q
Use of synthesizeNTP's optional arguments is illustrated in Fig. 8.2, which con-
tains both the MATLAB code for designing the N1F of a bandpass modulator and
for producing the plots shown. As this example demonstrates with the fourth argu-
ment (Hinf), an optional argument retains its default value if the empty matrix
([]) is supplied as a place-holder; not-a-number (NaN) can also be used for this
purpose. This example uses opt=2, which specifies that the NTF zeros are to be
optimized, under the constraint that the N1F must have at least one zero at band-
center. Ensuring that at least one NlF zero is at band-center (at DC for lowpass
modulators) can be helpful when the signal energy is known to be concentrated in
the middle of the band. Since this NfF achieves an rms attenuation of 80 dB for
quantization noise which falls in the passband, the expected SQNR for this design
with a -{j dBFS input is 80 + dbp(3 x 64) - 6 = 97 dB (dbp(p) = 10logw(p) is
the toolbox function for the dB-equivalent of a power p).
------------~--~--~--
~
259

8 High-Level Design and Simulation
8.1.1 How synthesizeNTF works
This section describes some of the internal details of synthesizeNTF, and thus
may be skipped by those readers who wish to focus on putting the toolbox to work,
rather than understanding how the toolbox itself functions.
The purpose of synthesizeNTF is to find an NTF of the specified order and out-
of-band gain, whose zeros follow the formulae of Table 4.1 and whose poles are
those of a maximally-flat all-pole transfer function. The reason for the latter
requirement is primarily one of convenience: when the CRFB (or CIFB) topology
is used with a single feed-in, the signal transfer function has the same frequency
response as that of the all-pole transfer function created from the NTF's poles.
(See Section 4.4.1.) In the authors' experience, the performance of an NTF is pri- I
;
••;;
order = 8;
OSR = 64;
opt
= 2;
£0
= 1/8;
H = synthesizeNTF(order,OSR,opt, [1 ,fO);
plotPZ (H) ;
£
= linspace(0,O.5,1000);
z
= exp(2i*pi*fl;
plot( f,
dbv(evalTF(H,z})
};
sigma_H = dbv(rmsGain(H,fO-O.25/0SR,fO+0.25/0SR));
--=
..... -. ,.
. ... :'"
-20
-60
' .. ,-
- -
,
,
,...
_
,.
-60
I+- "H =-aOdS
"' -40
"0
o
-100!-----'---c~LL~foc---'--f;;-'---:!cc-"----!
o
0.1
0.2
0.3
0.4
0.5
Normalized Frequency
Figure 8.2: MATLAB code for designing a bandpass NTF.
260

[
NTF SynthesIs
marily a function of its out-of-band gain and its zero locations, whereas the form of
the pole distribution is secondary.
The NTF poles which yield a max.imally-flat all-pole transfer function can be
derived as follows. Let P(z) be an nih-order polynomial in z whose roots are such
that IP(ejW)1
is maximally flat around
OJ = O. (P(z) will be the denominator
polynomial for the NTF.)
Since the coefficients of P(z) are real,
Thus the requirement that IP(ejW)1 be maximally flat around w ;;: 0 is equivalent
to the condition that P(z)P(l / z) be maximally flat around z ;;: 1, i.e.
where a is some constant which controls the sharpness of the filter. For example,
a ;;: 0 results in a transfer function that is constant (and so is completely flat);
larger values of a result in lowpass transfer functions with increasing sharpness.
Negative values of a result in polynomials whose magnitudes decrease as one
moves away from z ::; 1. Since this latter behavior is the opposite of what we
want, a must be positive.
j
.. 1· .
.~
'l:
·•i
Ii
I
(I
)"
P(z)P(,) = P(I)+a(z-I)" ,-I ,
(8.1)
(8.2)
Taking P(l) ::; 1 without loss of generality and simplifying (8.2) results in
·•
Thus, the roots of
(z _1)2"
::;l+a
::;
(-z)"
a(z - 1)2" + (-2)"
(-2)"
(8.3)
a(z _1)2" + (-z)" = 0
(8.4)
J
261

8 High-Level Design and SImulation
are the poles (and their inverses) of the sought-after NTF. These roots are given by
the roots of the n complex quadratic equations
..
where
(8.5)
Since the constant tenn in the quadratic is 1, the product of the two roots of the
quadratic is 1. Thus one root lies inside the circle while the other lies outside. Col-
lecting the n roots that are inside the unit circle yields the poles of the desired NTF.
.(2k+ 1)1t
J
n
e
bk = "---'[7/-
a
n
2.
(8.6)
=..
.::1
.j
i I
I
I
I
=
8.1.2 Limitations ofsynthesizeNTF
Since synthesizeNTF chooses the zeros of the NTF according to Table 4.1 (i.e.
the zeros are chosen independently of the poles), the zero locations are optimal
only if the denominator polynomial is constant in the band of interest. For most
practical situations, the fact that the denominator polynomial is that of a maxi-
mally-fiat all-pole transfer function ensures that this requirement is met. However,
when OSR is low, the -3-dB cut-off frequency of the denominator polynomial may
approach the edge of the passband, causing the zeros to no longer be optimal. For
example, the cut-off frequency of the denominator polynomial associated with a
5th-order NTF designed using the defaull value of IIHII~ = 1.5 falls close to [he
edge of the passband when OSR = 12.
Another pair of limitations on synthesizeNTF relate to the range of IIHII"., -val-
ues supported by this function. Note that
~Hlloo increases as the bandwidth of the
denominator polynomial increases, reaching a maximum when the denominator
polynomial has all its roots at z = O. Since all the zeros of the NTF are clustered
around z = 1, IjHII"., is equal to the magnitude of R at z = -1, which can be no
greater than 2n . Although a general nth-order NTF can be constructed such that
IIRlloo > 2n , such an NTF does not have poles corresponding to a maximally-flat
all-pole transfer function and so cannot be found with synthesizeNTF.
262
i
I
•;
=
j
1•
~ i
~
!
.

]t
-
,
NTF Simulation, SQNR calculation and Spectral Estimation
Similarly, values of IIHlloo near 1 can also be troublesome if optimized zeros are
used. When a low value of IIHll oo is requested, the poles of H converge on z ;:: 1.
If the zeros of H are all at z = 1, then IIHII_ approaches 1 and there is no prob-
lem. However, if the zeros have been assigned their "optimal" locations, IIHll oo
does not converge to 1 as the poles converge to z = 1. This limitation is a result of
the current strategy which separates the pole and zero optimizations, and may be
corrected in a future release of the toolbox.
8.2 NTF Simulation, SQNR Calculation and Spectral Estimation
Once an NTF is in hand, the designer can immediately begin to evaluate the modu-
lator via simulation. The toolbox function simulateDSM computes the output of a
modulator which realizes the desired NTF, assuming the STF is unity. Since the
input-output behavior of an ideal LU: modulator is determined solely by the NTF,
the STF, the number of quantizer levels and the initial state, the behavior predicted
by simulateDSM in terms of stable input range, tone performance and SNR is the
same as it would be for any realization of the desired NTF. Internal details of the
loop filter are only relevant when one is concerned with coefficient errorS, satura-
tion of internal nodes and other non-ideal effects.
The primary arguments to simulateDSM are the input sequence and the NTF.
Secondary arguments include the number of quantizer levels (nlev), which
defaults to 2, and the modulator's initial state (xO), which defaults to zerO. A code
fragment for simulating a 3-levellowpass modulatort and for plotting portions of
its input and output waveforms is shown in Fig. 8.3, along with the associated
graphical output. The input signal was chosen as a half-scale sine wave in order to
avoid overloading the modulator, and the frequency of the sine wave was chosen
such that it would fall into one of the in-band frequency bins of an 8192-point FFT.
The waveforms of Fig. 8.3 provide a dramatic illustration of the (apparently) poor
correspondence between the input of a .6.1: modulator and its output. As this figure
shows, the only similarity between the input and output waveforms in the time
t. Although the design point considered in the preceding section was a 5th-order binary modulator,
this section examines a 5th-order ternary modulator in order to illustrate the use of the toolbox
with a multi-bit modulator.
263

8
High-Level Design and Simulation
domain is that when the input is positive, the output is usually either +2 or 0, and
that when the input is negative, the output is usually either -2 or O.
However, when viewed from the frequency domain, the near-equivalence of the
input and output (in the band of interest) becomes more clear. Fig. 8.4 plots the
FFT of a length-8192 output stream and superimposes the expected PSD. Noise-
shaping is clearly evident, but the notch is much shallower than the expected PSD
and consequently the observed SQNR is about 40 dB lower than OUf expectations.t
QSR = 64;
H = synthesizeNTF(S,OSR.l);
nLev = 3;
Nfft
= 2"13;
tone_bin = 57;
t
[O:Nfft-l];
u
= O.5*(nLev-l)*sin(2*pi*tone_bin/Nfft*t);
v
= sirnulateDSM(u.H,nLev);
n=1:150;
stairslt (n) ,u(n) . 'g') ;
hold on;
stairs(t(n),v(n), 'b');
Time
Figure 8.3: MATLAB code for simulating a M: modulator
and for plotting a portion of the output waveform.
-2
-:
;
:
,
150
"',' .-
100
.....
'...
......
- ...,
50
.
.
.
.
-
"-.
.
.
.
. -.- ..., ... , ... '.' .. ",'
" . " , ..
.. ..... '." ...
o
2
~ 0
t. Since the power of the unit-amplitude sine wave input is -3 dB and the expected in-band noise
power is -118 dB (see page 259), the expected SQNR is 115 dB.
264
II

NTF Simulation, SQNR Calculation and Spectral Estimation
-_._----------_._--._---- ---
The discrepancy between the simulation result and our expectations is resolved by
windowing. When the input data to an FFf consists solely of tones located in FFf
bins, there is no need to window the data since no spectral smearing due to the
finite length of the time sequence can result. However, the aperiodic nature of a ~
modulator's output stream will often suffer spectral smearing unless it multiplied
by an appropriate window. Fig. 8.5 demonstrates the use of a Hann window. Note
the changes to the scale factors of both the FFf and the expected PSD (via the
noise bandwidth, NBW) when a Hann window is used. The spectrum contained in
this figure exhibits a notch depth, and hence an SQNR, that are in good agreement
with our expectations. Appendix A describes other aspects of spectral estimation
and gives a more detailed discussion of the importance of windowing and the sig-
nificance of NBW.
spec = fft(v) I (Nfft*(nLev-l) 12) ;
snr
calculateSNR(spec(1:ceil(Nfft/(2*OSR))+1) ,tone_bin);
NBW = l/Nfft;
Sqq = 4
* (evalTF(H,exp(2i*pi*f))/(nLev-l)) .A2
I
3;
f
= linspace(O,O.5,Nfft/2+l};
plott
f,
dbv(spec(1:Nfft/2+1)),
'b'}
hold on;
plott f,
dbp(Sqq*NBW),
'm',
'Linewidth',
1 );
05
0.4
.. ..
.
Simu{atioOl'
.
~"!!.~J.
....., New ~ 1:2~1O-4
_,4</i"-_-'-. __ ----l._
!
_.-L-_----J-.._-'-__,L-. =_CC'
o
0.1
0.2
03
Normalized Frequency
Crude MATLAB code for calculating a spectrum and
comparing it against the desired NTF.
Figure 8.4:
0,---,-,---,,---,,- -,---'"---,---,- --,----
.. SNR =76.4dB @ OSR =64' . .
.
.
-------._---
US

8
Hlgh.Level Design and Simulation
A single simulation is often insufficient to evaluate the perfonnance of a L\L modu-
lator. Numerous simulations using excitations with varying amplitudes and fre-
quencies are usually required. The simulateSNR function provides support for
this task, allowing an amplitude sweep to be conducted with a single function call.
Code illustrating the use of this function is given in Fig. 8.6.
8.3 NTF Realization and Dynamic Range Scaling
Once the designer is satisfied with the petfonnance of the NTF, the next step is to
realize that NTF with a particular modulator structure. Although the toolbox can
represent just about any modulator structure, code for converting an NTF into
coefficients is currently only available for four of the most popular structures.
These four structures are the feedback (FE) and feedforward (FF) versions of loop
filters containing either only delaying integrators or altemately delaying and non-
delaying integrators. As discussed in Section 4.4, loop filters of the former type are
266
spec = fft(v.*hann(Nfft})/(Nfft*(nLev-l)/4),
snr
calculateSNR{spec(1:ceil(Nfft/(2*OSR))+1) ,tone_bin);
NBW'" 1.5/Nfft;
Sqq = 4
* (evalTF(H,exp(2i*pi*f})/(nLev-l)) .A2
/
3;
The remainder of code fragment is the same as in Fig.
8.4
0,5
0,4
°
-20
-40
en
-60
u.
lD
-80
"0
-100
-120
-140
°
'-~~'~" -""'"
,II-=--.
simUl,",iOn"I' .
'-;,;---;-'Expec=!~
.
New;;i :8~1'(r'4
1
l
--------L~
I
t
---------.L __-.i
•__......._---'----._.__
0.1
0.2
0.3
Normalized Frequency
Figure 8.5: Code for calculating a windowed spectrum and comparing it
against the expected PSD.

NTF RealiZation and DynamIc Range SCaling
termed (somewhat inappropriately) cascade-of-inte~rator (CI) filters, whereas the
latter are termed cascade-of-resonator (CR) filters' and thus the four supported
topologies which are fully supported by the toolbox bear the abbreviations CIFB,
CIFF, CRFB and CRFF.
Fig. 8.7 shows code for realizing a 5th_order NTF with the CRFB structure, which
is also depicted in Fig. 8.7 for ease of reference. The coefficients of the structure
are specified by the a, g, b, and c coefficient vectors. The coefficients computed by
synthesizeNTF are such that the NTF of the resulting modulator is the desired
amp = [-130:5:-20 -17:2:-1J;
snr = simulateSNR{H,OSR, amp, [],nLev);
plot(arnp,snr, '-b' ,amp,snr, 'db');
[pk~snr pk_amp]
peakSNR(snr,arnp);
. -:...:..
••••• J
toO
.'
._. i .. •...' .. i.
m80 .. '...'.. ' .. '._-'-
:!3.
0:60
Zg 40
20
120
o
. . . . ' . . , . ,
-120 -100
--80
--60
-40
-20
0
Input Level (dBFS)
Figure 8.6: Generating an SNR vs. input amplitude curve.
t. In early versions of the toolbox, the CI filters were only allowed to implement NTF zeros at
z =: 1, whereas the CR filters were used to implement arbitrary NTF zeros. Thus the CI filters
truly were cascaded (delaying) integrators, while the CR filters truly were (most often) cascaded
resonators. However, since feedback around a pair of delaying integrators can realize zeros that
are close to the unit circle if the zeros are low-frequency zeros, and since this trick has been used
in reallowpass modulators, the CI structure was generalized to support such internal feedback
terms and thus the tenn "cascade-of-integrators" became a misnomer. Since the resulting
pseudo-resonators can only realize NTF zeros along the line Re(z) =1, a warning message is
issued if one tries to realize an NTF possessing general zeros with a CI filter.
267

I
8 High-Level DesIgn and Simulation
NTF and the STF is unity. Setting all feed-in (b) terms except the first to zero
results in the aforementioned maximally-fiat all-pole STF. The frequency response
of this STF is depicted in Fig. 8.8. The STF is calculated by the toolbox function
calculateTF from a generic loop-filter description (the ABeD matrix), which is
computed by the stuffABCD
function from the topology-specific a, g, band c
coefficients. The structure of the ABeD matrix is described in Section 8.3.1.
The coefficients returned by realizeNTF are those of an unsealed modulator, i.e.
a modulator whose internal states occupy an unspecified range. In order to restrict
the state range to known (and practical) values, dynamic-range scaling must be
performed. Dynamic-range scaling can be applied to any linear system on a state-
by-state basis as depicted in Fig. 8.9, which shows how an internal state is scaled
down by a factor k simply by reducing all incoming branches to that state by a fac-
tor of k, and by making up for the attenuation so introduced by multiplying all out-
going branches by the same factor k.
The toolbox function scaleABCD uses simulations to determine the required scal-
ing factors for each state of a delta-sigma modulator. The modulator is simulated
with inputs of various amplitudes in order to determine the maximum stable input
amplitude (umax) as well as the maximum value that each state achieves for input
H = synthesizeNTF(S,64,1};
form = 'CRFB';
[a,g,b,c]
= realizeNTF(H,form);
b(2:end)
= 0;
% for a maximally flat STF
Figure 8_7: Realizing an NTF with the CRFB structure.
268
I-•
~·
•

NTF Realization and Dynamic Range SCaling
amplitudes up to umax. The ABeD matrix of the modulator is then subjected to
dynamic range scaling so that the maximum value of each state equals the speci-
fied limit (xlim, which defaults to 1). The toolbox function mapABCD then trans-
ABCD
~ stuffABCD(a,g,b,c,form);
[Ha Gal
~ calculateTF(ABCD);
f
~ linspace(O,O.5,100);
z
~ exp(2i*pi*fl;
magHa
~ dbv(evalTF(Ha,z));
magGa
= dbv(evalTF{Ga,z));
plotlf,magHa, 'b',
£,magGa, 'm',
'Linewidth' ,1);
.
'
,
,
.... ,
' .,
, ','
, .. .
,...
'.'
.
.......
.
.
...
.. .'
;. .... ;.....:
:-
;-
....;.
.:1 .
NTFT
:
-~ill
..
','
,'--;
. .....
. ~ ..... ,
......... ...:
:.~.~+.'-.~~,... ~.:.:.:1
... '.'
,.... '.'
,
"
L_l-~l-~.--l
,L_-.L.~-I
0.1
0.2
0.3
0.4
0.5
Normalized Frequency
Figure 8.8: NTF and STF calculation for the modulator
realization of Fig. 8.7.
Figure 8.9: Scaling an individual filter state, x, to xlk.
269

11--
8 High-Level Design and Simulation
lates the scaled ABCD matrix back into the coefficients for the chosen topology.
Fig. 8.10 shows the associated code fragment, and also plots the observed state
maxima, after scaling as a function of the input level for our 5th-order 3-level mod-
ulator. As the plot demonstrates, each state stays below the specified limit of 0.9
for inputs from 0 to 78% of fuH-scale.t
!
j,
"••
nLev = 3; xLim = 0.9;
fO
= 0;
[ABCDs umax]
= scaleABCD(ABCD,nLev,fO,xLim);
(a g b c]
= mapABCD(ABCDs,form);
=
Scaled Coefficients:
Observed State Maxima
....;
0.•
0.•
0.2
0.4
i
ai
gi
bi
Ci
1
0.0383
0.0034
0.0383
0.1473
2
0.0748
0.0045
0
0.2045
3
0.0969
-
0
0.4007
4
0.1754
-
0
0.4385
5
0.1709
-
0
3.2533
; 1 :i r
q
;=I~';\'"
,-x
'
.;'"
-~
.;.
. ..
,
,
l-'--c'c'
,
0 0
0.2
0.4
0.6
0.8
Input Amplitude (relative to FS)
Figure 8.10: Code for performing dynamic range scaling, plus a plot of the
state magnitude as a function of the input level for the scaled modulator.
t, The obserVed value ofumax is 1.56. which is 78% of the nLev-l =2 full-scale input level.
270
!!
~

NTF Realization and Dynamic Range Scaling
8.3.1 The ABCD Matrix
This section describes the structure and interpretation of the ABCD matrix, and so
may be skipped by readers who do not wish to delve into the internal details of the
toolbox.
In order to make the toolbox as general as possible, the ABCD matrix is used for
generic operations such as modulator simulation and dynamic-range scaling.
Topology-specific functions are only needed to translate an NTF into coefficient
vectors and to convert between coefficient vectors and the ABCD matrix.
The ABCD matrix is a conglomeration of four matrices, A. B, C and D, which can
be used to describe the dynamics of any discrete-time linear system. Simply
assemble the state equations into the following fonn
x(k + 1) ;
Ax(k) + B[U(k~
v(k)j
y(k) ;
CX(k)+DrU(k~
Lv(k)j
(8.7)
where x(k) is the nxi state vector at time k (n is the order of the system), A is an
nXn matrix describing the interconnections within the loop filter, B is an nx2
matrix describing how the input u(k) and the fed-back output v(k) are applied to the
loop filter, while C and D are IXn and lx2 matrices describing how y(k), the output
of lhe loop fillet, is computed from x(k), u(k) and v(k).t
For example, consider the 5th-order CRFB system shown in Fig. 8.7. By examin-
ing the expanded fonns of the delaying and non-delaying integrators shown in
Fig. 8.11, the following state equations can be written by inspection:
t. The dimensions given assume a single-quantizer modulator with a single input. For an nt-input,
nq-quantizer modulator, the dimensions of theA, B, C and D matrices are nxn, nX(n,+nq), nqXn
and nqx(n,+nq), respectively.
271

B High-Level Design and Simulation
x 1(k+1)::: x1(k)+b1u(k)-alv(k)
x2(k+ 1) = x2(k)+c1x1(kj-glx3(kj-u2v(k)
x 3(k+ 1)::: X3(k) + c2x2(k + 1)-a3v(k)
::: (I - c2KI )x3(k) + c2xz(k) + c2c IX I(k) - (u3 +c2a2)v(k)
x4(k+ I)::: x4(k) + c3x3(k)-82xS(k)-a"v(k)
xs(k + 1) ::: xs(k) + c4xz(k + I) -usv(kj
::: (1- c4gz)xs(k) + c4Xik) + C,C3x 3(k) - (as + c4a4)v(k)
y(k) ::: csxs(k)
and thus the ABeD matrix for this structure is
(8.8)
x(k + 1)
0
0
0
0
b,
-',
c,
-g,
0
0
0
-',
~=
c1c2
C,
I-C28 l
0
0
0
-a3-a2cZ
(8.9)
0
0
c,
-g,
0
-',
0
0
C3 C'
"
1-c4g2
0
-as-a4c4
0
0
0
0
"
0
0
In the general fonn of this structure, the input signal u(k) would be fed to the input
of every integrator and the quantizer through coefficients b2...b6 , and these coef-
ficients would populate the column whose first element is b1. The ABeD matrices
of other structures can be derived by a similar procedure, and new topologies may
be added to the toolbox simply by adding the appropriate conversion routines to
mapABCD, stuffABCD and realizeNTF.
Figure 8.11: Delaying and non-delaying integrators expanded to show the
associated state variables.
272

1
i I
I.
1 Ii
i
J
Creating a SPICE-Slmulatable Schematic
8.4 Creating a SPICE-Simulalable Schematic
Once the designer has obtained a scaled block diagram, the next step towards a
transistor-level realization usually involves constructing a schematic that can be
simulated in behavioral fonn. This schematic can be used to study such effects as
switch resistance, comparator hysteresis, op-amp nonlinearity, finite op-amp gain,
bandwidth. slew-rate and so on, in order to obtain specifications for the various
sub-blocks before embarking on transistor-level design. When transistor·level
implementations are available, these may be substituted for the behavioral ele-
ments, either indiVidually or all at once, so that time-domain simulations can verify
the modulator's functionality. This section describes how the designer translates a
MATLAB description of the modulator into a behavioral description that can be
simulated with a SPICE-like simulator.
In principle, translating a block diagram into a behavioral schematic is straight for-
ward: simply connect the appropriate behavioral elements such as switches and
amplifiers as indicated by the block diagram. In practice, details such as voltage
scaling, polarity and timing complicate the process, and the numerous connections
in the schematic make the process error·prone. As an example of the translation
process, we shall next show how to construct a schematic that implements the
block diagram of Fig. 8.7 with the coefficients listed in Fig. 8.10.
8.4.1 Voltage Scaling
Assume that the reference voltage is 1 V and that both the full-scale input and the
swing available at the outputs of the op-amps are 2 Vpp,differential' By this assump-
tion, the full-scale input of ±1 V matches the I-V reference voltaget , so the input
capacitors may be used for both sampling the input and feeding back the reference,
as shown in Fig. 8.12. The DAC function in this stage is implemented by connect-
ing each of the two halves of the sampling capacitor to either the positive reference
voltage (v+) or the negative reference voltage (v-), according to the state of the
two feedback bits (vO and vI).
t. In practice, the modulator will be driven 10 instability if the input voltage is close to the refer-
ence voltage. and thus the allowable input voltage will be a few dB lower than the reference volt-
age.
273

8 High-level Design and Simulation
Also, since the op-amp swing is ±1 V, the scaling of the modulator states for a
swing of ±O.9 in MATLAB provides 10% of design margin, provided we equate
the value of a MATLAB signal with the differential voltage of the corresponding
signal in the behavioral version of the modulator. Stated more succinctly, 1 (in
MATLAB) equals 1 V.
Since the full-scale input of a 3-1evel modulator in MATLAB is ±2 (recall the
toolbox convention that the outermost quantizer levels are at ±(nLev - 1», the b1
and also the a1 coefficients given in Fig. 8.10 must be doubled in order for a ±1 V
input signal to occupy full scale. Conveniently, the input coefficient for the modu-
lator of Fig. 8.12 is 2Cl Cz' and thus these factors of 2 cancel, leaving
a l = hi = C l/CZ' This fortuitous cancellation will occur with any value of M,
as long as the voltage scaling factor is unity and the DAC levels are implemented
with individual capacitors as shown in Fig. 8.12.
•
"!!ii
I;;
"::I
~
8.4.2 Timing
According to Fig. 8.7, the first integrator in this 5th-order modulator is a delaying
integrator. If we adopt the convention that one time period consists of phase 1 (pI)
followed by phase 2 (p2), then a delaying integrator can be constructed by sam-
I!
~..r•
I•
~.."
Cl
C2
+
x1
C2
C2
-
T'i"<:+---O
+ ",-""r---o
j
P2t ll~'
p1-vO\
!pl.
$
<Y:>Cl
p2
I
p1
+
P1.,~1('P1.'[o2
u
v+
v-
C
p1·vr
·v1
- II'r
l
-<s(~p
P
pl0v0J
\Jl10v0
I
I I
p2
Cl
Figure 8.12: The first integrator of the Sth·order modulator.
274

" .
~ .
.~ ,
.~ :
Creating a SPICE-$Imulatable Schematic
piing on phase 2 and integrating on phase I, as shown in Fig. 8.12. As a final step
in the justification for the topology depicted in Fig. 8.12, the reader should verify
that the polarity of the various connections is correct.
Referring back to Fig. 8.7 once more, we next observe that the first resonator in
this modulator consists of a non-delaying integrator followed by a delaying inte-
grator. Following the same reasoning as used in the preceding paragraph leads to
the switch phasing shown in Fig. 8.13 for these two integrators. Since the feedback
coefficients (a2' a3) match neither the interstage (cl' C2) nor the resonator (gt)
coefficients, separate capacitors have been used to implement these terms. The
equations governing the capacitor selection follow directly from the difference
equations and so are simply listed in Fig. 8.13 without further justification.
C3
C41--T:' 1
~oiQ
C7
~
,. ~
~
J;2
~..,
@..2l:_
C7
~'
C3
G>{'g:
,. 2r
C6
~t
~
@3l:
C5
0-3~
p2
P2~8
p1
-
+
+ (i'
+ ~' t
x1
c
em
x2 c
c
- A~
+
-
-A~
7
C5
p2
p2
C8
p1
C9
+
+
x3
9
J
Figure 8.13: A realization of the first resonator in a sth.order modulator.
275

8 High-level Design and Simulation
However, the phasing of the feedback elements (the capacitors labelled C3 and
C7 ) merits further explanation. Fig. 8.14 shnws a timing diagram for the loop filter
and quantizer. On phase I, the values of x,(k), x,(k) and xs(k) are calculated. The
input branches for these integrators follow the expected form for an integrator
which samples on phase 2 an updates on phase 1. However, on phase 2, x2(k+l)
and x4(k+l) are calculated, and these calculations make use of v(k), which has
itself only just been computed. (See Eq. (8.8) on page 272.) Reoce, the feedback
elements for x2 and x4 must acquire their data-dependent values during phase 2.
Since the resulting switched-capacitor branch is inverting, the polarity of the data
used for feedback is the opposite of what is used for the non-inverting feedback
branches of the Xl' x3 and Xs states. The topology of the second resonator would be
essentially the same as that of the first.
In this modulator, the quantized version of Xs must be available shortly after Xs has
been computed. In order to allow sufficient time for regeneration in the comparator
(and for the delay of the element selection logic, if present), the comparator may
be strobed part-way through phase 1, before Xs has settled fully. Strobing the com-
parator early usually results in only a slight increase in the quantization noise
power and is an effective way to accommodate quantizer delay.
v(k)
Figure 8.14:
Timing diagram for the Sth'order modulator,
276
-i
I
I••
;
!i•••••=

Creating a SPiCE-Simulatable SChematIc
Alternatively, the modulator could be redesigned with an explicit delay assigned to
the quantizer. The loop filter would be similar to that of Fig. 8.7, except that the
delaying integrators would become non-delaying integrators and vice versa, so that
there would still be precisely one unit of delay through the quantizer plus loop fil-
ter and back to the quantizer input. The feedback coefficients of this architecture
would have to be recalculated, since they would not be the same as those listed in
Fig. 8.10, but the quantizer (and element selection logic) would have a half-cycle
in which to detennine v.
Now that the loop filter has been converted into schematic form, it is possible to
perform the first verification step: an impulse response check. In this step, the
quantizer is replaced with a pulse source (so that the loop is effectively open), and
the resulting response is compared against a MATLAB prediction. Fig. 8.15 shows
the plot of the simulated wavefonn as well as the MATLAB-predicted samples. As
this figure shows, the correspondence between the two is essentially perfect. Note
1.1
1
,9
.3
.4
.5
.6
.7
.8
time, xle-6 Seconds
.2
.1
-v(xSp,xSnj*c5/2
Xy matlab
o
: Ii!
-2 ·····+··~
....t::·~·+-~~r..·~..~+..1:::·:h'·
....·+····+ ..··j····..·
-4
:.:
::.I.:
;.:
l
,.,
,
~.1 j
i
j
,,
,
.
:
:
;
:
;
:
:
i
:
:
i
:
i
i
: I :
-6 ......·!........r......·I·......r..·..l..·..·i..·....-r--....r·.. --r-·
y
..·"L
-8
'
,
,
,
,
,
,
.
,
.
l(d} ~
0
v(pl}
v(p2} ,
o
Figure 8.15:
Loop filter verification.
277

8 High-Level Design and Simulation
that since the behavioral model uses a quantizer step (which corresponds to an
impulse of height 8.=2) to excite the loop filter, and since the relation between y
(the input of the MATLAB quantizer) and Xs is y = csxs ' the observed response
at Xs must be multiplied by csl2 in order to match the MATLAB prediction.
If there is a discrepancy between the simulated and predicted responses, the
designer can identify the problem by using MATLAB to predict the evolution of
each state within the modulator in response to an impulse input. Comparing these
predictions against the observed responses usually pinpoints the source of the
error.
In a binary modulator, it is often not possible to excite the loop filter with an
impulse, since zero is not a valid feedback value. The impulse response can still be
simulated by taking the difference between the responses due to a baseline input
(such as -1, -1, ...) and an input with one sample incremented (+1, -1, -1, ...). In
a multi-bit modulator, the DACs can be verified by exciting each level individually.
Once the feedback path through the loop filter has been tested, the quantizer can be
verified. In MATLAB, the quantizer quantizes y = csxs ' with an LSB size of 2.
In the behavioral model, the quantizer quantizes Xs with an LSB size of 2/cs.
Since we are employing 3-level quantization, the two thresholds are therefore at
t(O.S LSB) = ±11Cs = to.31 V. Verification of the quantizer can be performed
by replacing the loop filter with a ramp source and checking that the quantizer
thresholds are in the right place, and that the timing is also correct.
If the loop filter and the quantizer pass the above tests, the loop should behave
properly when it is closed. The most common error which causes the loop to mal-
function at this stage is incorrect feedback or sensing polarity, a catastrophic con-
dition that causes the loop to become unstable almost immediately, even with zero
input. To verify that the loop is functioning properly, and that the input signal has
the correct full scale, a longer time-domain simulation may be used. Fig. 8.16 and
Fig. 8.17 depict the resulting spectrum when the modulator is supplied with a
-3 dBFS input and clocked at 10 MHz for 4096 cycles. The noise spectrum fol-
lows the NTF closely, the signal is indeed at -3 dBFS, and the calculated SQNR is
116 dB. (Since increasing the number of simulated cycles to 8192 increases the
278
"i
I

Creating a SPICE-8lmulatable Schematic
-----.._------------------
o...-_db...:.;.1s.:p..;e_c.:-J.,___db..,..1S_q:-q:-J~_-~-_;_--.,_-_;--_,_-_.,
II
!
-20
-40
-60
-80
-100
-120
-140
-160"---'----'---'------"---'---'---'----'---'
o
.5
1
1.5
2
2.5
3
3.5
4
4.5
5
freq, xle6 Hertz
Figure 8.16: Simulated spectrum.
o _db(spec) _db(Sqq}
,
. . . .
· .
,
,
·
.
,
,
·
,
,
,
. .
~:::::::::;:::::t::::L:r:::i:::T:::
· .
, .
,
.
·
,
.
,
,
,
-60
--t-----(---i·····j·····i·..··(··
-80-···· -
··r--···r·-··i··_··j·_···:·····~
·
.
,
,
, .
,
,
-100 ...-.' --r····t····1······
";"'"
· . .
·
. .
-120-···· - ..}--...:-....
..._-..! .. __ .:-....
.
.
.
,
, .
,
.
.
~/1V:\lf,'" NBW =3,7 kHz
-140
- 16O......-::':--::L--::':--:':-::-:-::-:-::-::-::-'::--:-'
o
20
40
60
80 100 120 140 160
treq, xle3 Hertz
Figure 8.17: Simulated spectrum in the passband.
279

(8.10)
8 High.Level DesIgn and Simulation
observed SQNR to 120 dB, whereas decreasing the number of simulated cycles to
1024 decreases the observed SQNR to 96 dB, this slight SQNR discrepancy may
be assumed to be the result of insufficient simulation time.)
8.4.3 kT/C Noise
The final step in the realization of this modulator which we will perform is the siz-
ing of the capacitors in the first stage. The sampled thermal noise (kTIC noise) is
a major limitation of switched-capacitor circuits, and must be taken into account in
the design. The theory of kT/ C noise is briefly discussed in Appendix C. Let us
choose capacitances such that kT I C noise from the first integrator is 3 dB lower
than what would he required for SNR = 100 dB with a -3 dBFS input. If we
assume that the op-amp itself contributes no excess noise, then the noise associated
with the input capacitors is
2kT
2 _ 2kT
2C x
- C'
t
1
where the factor of 2 in the numerator comes from the fact that each capacitor is
subjected to 2 charging/discharging events per period, while the factor of 2 in the
denominator is a result of the fact that the sampling capacitor is effectively 2CI.
The final factor of 2 comes from the fact that the circuit is differential.
Since a -3 dBFS signal has a power of 0.25 V2, 103 dB SNR requires the noise
voltage to be
•
•I .
1 .
i••·!;-i=i•
•
which in turn requires
and thus
280
/_O~.:;;2=,5= = 3.5 I!Vnns '
10103110
C
t = 2::I(OSR) = 10 pF.
n
(8.11)
(8.12)
•ii

C I
C2 =- =270pF.
b i
Conclusions
(8.13)
Since these capacitances are rather large, the designer should consider some of the
alternative designs before committing to the realization of this design. In particu-
lar, Section 9.2 will show that using a feed-forward topology reduces the required
capacitance substantially.
Now that the architecture has been translated into behavioral fonn, the designer
can easily investigate practical impainnents (op-amp non-linearity, slew rate and
finite gain, etc.) and thereby derive specifications for the various sub-blocks.
8.5 Conclusions
This chapter introduced the use of the Delta Sigma Toolbox for NTF synthesis,
modulator simulation, modulator realization and dynamic-range scaling. The tool-
box is best suited to single-quantizer, discrete-time, lowpass and bandpass modula-
tors, but it can also be applied to the design of continuous-time and multi-quantizer
modulators. Several of these systems will be studied in the next chapter. The reader
is referred to Appendix B for a more complete guide to the Delta Sigma Toolbox.
--,-c---
281

282
8
High-Levej Design and Simulation
ii

CHAPTER 9
Example Modulator
Systems
<
Ij
This chapter illustrates the design principles presented in the preceding chapters
through a study of five LU: ADC systems and one DAC system. The first example
demonstrates the basics of liE ADC design and also presents example circuits for
several building blocks commonly found in ,.u; ADCs. Subsequent ADC systems
illustrate increasingly complex concepts and techniques, culminating in a hybrid
continuous-timeJdiscrete-time bandpass ADC.
9.1 SCMOD2: General·PurposeSecond-Order Switched-Capacitor ADC
This ADC system is intended to digitize low-frequency signals and so could be
used as a voltage monitor or as part of a low-speed on-chip calibration engine. For
such applications, a signal bandwidth of 1 kHz is more than adequate. With such a
small signal bandwidth, a clock rate of only 1 MHz yields an oversampling ratio of
500 and thus a signal-to-quantization-noise ratio well in excess of 100 dB for a
second-order modulator. This high SQNR gives the ADC enough resolution to
allow its use in very demanding calibration/measurement applications. To accom-
modate the applications envisioned, the ADC is required to accept a single-ended
input ranging from 0 to Von = 3 V. These specifications are summarized in
Table 9.1.
283

9 Example Modulator Systems
In keeping with the emphasis on simplicity in this design, we will assume that the
positive supply rail is used as the reference voltage. In practice, using the supply
voltage as the reference requires careful filtering in order to achieve high conver-
sion accuracy in the face of supply noise. A suitable circuit utilizing a two~step
coarse/fine charging scheme and an external capacitor to effectively filter the sup-
ply voltage with a 2-Hz lowpass filter is described in [1].
9.1.1 System Design
Fig. 9.1 shows a block diagram of the system under consideration. The reader may
recognize the modulator topology as a standard CIFB (cascade of integrators, feed-
back) structure. As discussed in Chapter 8, coefficients for such standard structures
are readily found using the ~ Toolbox. The code fragment shown in Fig. 9.2
yields the parameters at = bl = 0.2665,
a2 = 0.2385,
c1 = 0.3418
and
c2 = 5.18. Rounding these to simple ratios then gives at ::; hi = a2 ::; 1/4
and c1 ::; 1/3. (The c2 coefficient is unimportant since the quantizer is single-
bit)
Parameter
Symbol
Value
Units
Bandwidth
Is
-1
kHz
Sampling Frequency
f,
1
MHz
Signal-to-Noise Ratio
SNR
100
dB
Supply Voltage
VDD
3
V
Table 9.1. Specifications for the example 2nd~order modulator.
Figure 9.1: Block diagram for SCMOD2.
•!
II••t
v
Q
1
z=1
1
z-l
u
284
·!

SCMOD2: General-Purpose Second-Order Swltched·capacltor ADC
The impact of this coefficient quantization is minimal. Calculations using the tool-
box show that the maximum out-of-band gain of the NTF increases from 2 to 2.25,
and simulations indicate a peak SQNR of approximately 115 dB. Furthermore, the
effective quantizer gain (including the c2 coefficient) is found from simulations to
be k::= 16/3. Using this value of k as an added argument to the tiL toolbox func-
tion calculateTF (see page 403 in Appendix B) yields the simple NTF
( z_1)2
NTF(z)
~
z-1/3
.
(9.1)
,
The Umax variable, which indicates the stable input range (nonnalized to the 3-V
reference voltage), is 0.9, so we should expect the modulator to function perfectly
for inputs in the range 0.15 V to 2.85 V. Since the modulator is only second order,
inputs which are outside this range will most likely cause saturation in the integra-
tors (rather than drive the modulator into a self-sustaining oscillation) but the mod-
ulator output will nonetheless be an unsatisfactory representation of the input. For
the sake of simplicity, we will consider the naturally-available input range to be
acceptable.t With a scaled block diagram now in hand, we can turn to the practical
problem of implementing it.
H = synthesizeNTF(2,SOO,0,21;
form
=::
'eIFB';
[a,g,b,c)
=:: realizeNTFjH,form);
b(2:end)
=:: 0,
ABCD
= stuffABCD{a,g,b,c,form);
[ABCDs umaxl
=:: scaleABCD(ABCD);
[a,g,b,c]
=:: mapABCD{ABCDs,formj,
Figure 9.2: Toolbox code fragment for determining coefficients.
t. A simple transformation u' = 0.9u + 0.15 would allow input voltages u in [O,3VJ while ensuring
that the modulator receives an input u' which is within the stable input range. Such a transfor-
mation could be implemented by changing the input-sampling/reference~feedback network.
285

9 Example Modulator Systems
9.1.2 Timing
Perhaps the most common source of error in switchedwcapacitor modulator design
is improper timing. It is imperative that the timing of the quantization and feed-
back operations be such that the loop filter follows the desired difference equa-
tions, otherwise the modulator will not function as desired, if it functions at all.
Fig. 9.3 shows a simplified switched-capacitor schematic of our modulator, as well
as the desired difference equations, the switch/clock timing and representative
wavefonns. The difference equations and the topology of the schematic follow
directly from Fig. 9.1. To verify that the timing shown is correct, we need to verify
that the loop filter implements the desired difference equations. Starting at the end
of phase 2 (marked in the timing diagram with a dashed line), observe that xin)
has just settled and thus strobing the comparator as phase 2 falls will implement
the quantization operation implied by the third equation. The next rising edge of
phase 2 causes xz(n + I) to be generated using xt(n) and v(n) as dictated by the
second difference equation. The subsequent phase 1 interval is used to generate
x I (n + 1) in accordance with the first difference equation. Since v(n) is needed for
both of these operations, a flip-flop clocked on falling phase 1 holds v(n) over a
phase-2/phase-1 interval and thus the timing shown is consistent with the desired
difference equations. Many other timings and switch arrangements exist which
Desired Difference Equations
x1cn + 1) =: x1(n) + b1u(n) - a1V(n)
x2(n + 1) ::: x2(n) + c1x1(n) - a2yen)
v(n) = Q(x2(n))
Timing
...fTI.fT1J21..
=:::::J< x,(n)
)(x,(n+1)
:x ,x2(n)
)(x2(n+1) x::::
vq':=3(
v(n)
X
vd' X
Xv(n)
x:::::::::
Figure 9.3: Timing check for SCMOD2.
286

SCMOD2: General·Purpose Second-Order Swltched.Capacltor ADC
also implement the desired difference equations. An advantage of the timing
shown in Fig. 9.3 is that the comparator and both integrators have an entire clock
phase, or nearly half of a clock period, in which to settle.
Fig. 9.4 shows the first integrator stage in more detail. A differential circuit with a
single-ended input is assumed. Since a1 = b1 ' the same physical capacitor C1
can be used to implement both coefficients. As shown in the schematic, the input
signal is sampled onto the upper C I input capacitor on phase 2, and then the dif-
ference between the input and the reference is integrated onto the upper Cz inte-
grating capacitor on the next phase 1. The lower path feeds the inverted signal to
the integrating capacitor also on phase 1, but samples the input on phase 1 and the
reference on phase 2 in order to accomplish the inversion. The fact that the input is
sampled twice per period adds a (1 + z-II2)/2 factor to the STF, which creates a
zero atls but has little impact on the in-band portion of the STF. In this integrator,
the reference is sampled on two clock phases, so we have to ensure that the feed-
back signal (v) has the same value in both phases. Fortunately, the flip-flop which
holds v constant from phase 2 to phase 1 realizes the required timing.
Voo gnd
1'Vd~"iid
C2
Vin
2
Ch!
1
LV,m1~
---<l+
V"
2'Y~';d l'
,---()
I
I
Vao gnd
Figure 9.4: First integrator for SCMOD2.
(This circuit has signal-dependent loading on the reference.)
287

9 Example Modulator Systems
9.1.3 Scaling
Another common source of error in the translation of a block diagram into a practi-
cal circuit is the process of denormalization and scaling. The L\L toolbox assumes
that the input of a binary modulator ranges from -1 to +1; the default scaling is
also such that the integrator states occupy the [-1,1] range. These ranges are
given in nonnalized (unit-less) form, but in an analog circuit the ranges must have
physical units and also need to match the capabilities of the circuits.
In this example, the full~scale input is 3 V, whereas the toolbox default value is 2.
Let us assume that the amplifier supports a differential swing with the same
numerical range as used in the Toolbox, i.e. the amplifier output swing is 2 Vpp'
Lastly, assume that the digital vd signal is interpreted as 0 or 1. Thus the relation-
ships between the circuit variables shown in Fig. 9.4 and the state variables used in
the difference equations are
(9.2)
u =
and
(9.3)
The difference equation that we need to implement is
(9.4)
(9.5)
where a1 ;: b I = 1/4. In terms of the circuit variables, the desired difference
equation becomes
288

SCMOD2: General-Purpose Second-order Switched-CapacItor ADC
vxl(n + I)
bl [vin(n)-1.5 VJ
= vx1(n) +
1.5
a1[2vd(n)-IJ·IV
vin(n)
= vxl(n) + -6- - 0.5 V· Vin)
(9.6)
If vin is assumed to be unchanged from phase 2 to phase 1, the equation imple-
mented by the circuit in Fig. 9.4 is
(9.7)
Thus, in order for (9.6) and (9.7) to be equivalent, the ratio of the input and inte-
grating capacitances needs to be
(9.8)
With V DD = 3 V, the above ratio also gives the correct coefficient for vd .
Fig. 9.5 shows a schematic for the second integrator. In the first integrator, the
input and reference feedback capacitors were shared since the associated coeffi-
cients (hi and Gl) were equal. However, the two input coefficients (Cl and Gz) asso-
ciated with the second integrator are not equal, and so are implemented with
separate branches.t Following the same methodology as was used for the first inte-
grator results in the capacitor ratios indicated in the figure.
9.1.4 Verification
At this point, we have a circuit which we expect will implement the desired differ~
ence equations. To verify that the topology, timing and capacitor ratios are indeed
correct, several simulations need to be performed. The first simulations use an
t. If the a2 and c j coefficients are different, it is still possible to share a portion of the associated
capacitors. We use independent branches for the sake of schematic clarity.
289

9 Example Modulator Systems
open-loop configuration to demonstrate that the loop filter has indeed been imple-
mented correctly. The second set of simulations operates the modulator in closed-
loop fonn, and serves to confinn the input range, state scaling and NTF.
In the first set of simulations, the loop filter is initialized to a known state and the
quantizer is replaced with a simple data source. By running two simulations, for
example one in which the data source produces the sequence (-1, +1, -1, +1, ...)
and one in which the data source produces (+1, +1, -1, +1, ...), the open-loop
impulse response ll(n) may be detennined. Since the difference between the two
input sequences is 23(n), where Sen) is a discrete-time impulse, ll(n) is the dif-
ference in the loop filter's output between the two simulations, divided by 2.
Using the difference equations, we find that the impulse response of the loop filter
is
T -
(9.9)
+
V"
Figure 9.5: Second integrator in SCMOD2.
(In this circui4 the load on the reference is signal-independent.)
290

-
SCMOD2: General.Purpose Second-Order Swftched·Capacltor ADC
(The impulse response may also be calculated directly from the NTF given in (9.1)
using the Toolbox function impLl, provided the result is divided by the assumed
quantizer gain of 16/3.)
Fig. 9.6 shows the simulated output of the loop filter when ideal behavioral models
are used for the analog components, as well as the desired impulse response given
by (9.9). Since the observed response matches the desired response precisely, we
can be confident that the circuit really does implement the desired difference equa-
tions. (More precisely, we can be confident that the circuit implements all terms in
the desired difference equations, except possibly for the feed-in (u) terms.)
The second set of behavioral simulations verify that the modulator operates prop-
erly when the loop is closed. In order to get an accurate SQNR measurement, such
simulations need to be run for a long time (on the order of OSR x 64 clock cycles)
and so tend to be prohibitive. Shorter simulations can be used to verify that the
modulator follows the desired difference equations and that it starts up properly,
but long simulations should be run at some point in order to verify the modulator's
SQNR via simulation. In the early days of t!.:E, such simulations were impractical
(especially since OSR tended to be high), but nowadays such simulations are via-
..,..
............
"."
.
.. ..
I
, .
.. ..... .... ,.
-0.25
Vx2(t~ I=i;:;~~~:-:-.~...:-:-..-:-:-.:.....~.~,~..:.....-:-..7.,.-:-.~.T,.~;:::::=2=2=;l
(V)
... ..... ..
X
Desired
Simulated
-0.5
-0.75
. .;..
" . -:...
..'.
. .
~ -
. ... . ......
.!..
..;
-1 L-_-'--_-'-_--L_--L_-'-_-'--_-'-_-'-_---'-_-'
o
2
3
4
5
6
7
8
9
10
Time (!'s)
Figure 9.6: Impulse response of SCMOD2's loop filter.
291

9 Example Modulator Systems
ble. Fig. 9.7 shows the spectrum of the simulated output as well as the expected
PSD (after taking into account the observed quantizer gain of k = 16.6/3). for a
214_point simulation of the modulator with a -3 dBFS sine-wave input. The
observed SQNR is 102 dB, which is dominated by the presence of a 3rd-harmonic
of the input tone. If this hannonic is discounted, the SQNR is 114 dB and we can
conclude that the modulator is indeed perfonning as desired.
9.1.5 Capacitor Sizing
At this point, we have a scaled block diagram which has been verified with ideal
circuit elements. The next step towards a transistor-level implementation is capaci-
tor sizing. Since we desire a fairly high SNR, the size of the capacitors in the first
stage is likely to be dictated by thennal noise considerations.
,
j
I
I
If we assume that the amplifier noise is negligible, then the input-referred thermal
noise of the circuit in Fig. 9.4 is
kT
= C·
I
(9.10)
Figure 9.7:
I
!
..-
...... ,. ,.
.
,
, .. ".
',' . '.' ., ." .,...., .
"""
"
... ".
, '. '.' ....,.....•.. ,. '.' ".' ,," .
..... ",
."
., '.',' ,
,. ,. ',' ,. " , '"
, .. ',' ., .
,
,
, "'"
<,
.. ; ..:- ':':-1 n:
..:....
.:.. . ~ ... ','.'.'.
, . . , , ...,
....:...:.. ;-:.:.:.;-:~
...... "
.:'-:::"
..';::."
NBW=92 Hz
._~~"-'-'-lC"'
":~_l_l_l_l..l..L_.
L._...L_l.."":'.. :' "j
__<
10°
10
1
10
2
Frequency (kHz)
Spectrum from a behavioral simulation; 214.point FFf.
.. -:
:
.
.. , -
.. '"', ..,.,
.. -:' .. :..
~
-80
-20
-40
-120
10-1
~
00
~
00:s-
O
-80
CfJa.
-100
292

SCMOD2:. General-Purpose Second-Order Switched-Capacitor ADC
(As discussed on page 430 of Appendix C, the switched capacitors in this circuit
transfer a mean-square noise charge of 4kTCI to the integrating capacitor in each
clock period. However since this circuit double.samples its input, the charge trans-
ferred to the integrating capacitor due to an input voltage v is 2CIv. Thus the
input-referred noise is (4kTC,)/(2C1v)Z = kTIC 1·)
This noise is evenly spread over the frequency range [0,ls/2] (i.e. the noise is
white), so its in-band power is
Z
vnl
= OSR'
(9.11)
In order to achieve SNR:;;; 100 dB with a full-scale sine wave input, we require
(9.12)
If the entire noise budget is allocated to the first integrator and if we take
T = 300K , then we require
C
=
kT
= 74 fF
1
OSR. vZn
(9.13)
andlhusCZ = 12C1 = 0.88 pF. Rounding Czto 1 pF,solhalCI =83fF,givesa
modest amount of margin to the design.
The noise at the input to the second integrator is (see Appendix C)
(9.14)
Since this noise is shaped by the inverse of the 2C1/C2 transfer function of the first
integrator, the in·band power of this noise is
1-;-1
293

9 Example Modulator Systems
(9.15)
The 60-dB suppression afforded by the first integrator makes the tbennal noise of
the second integrator wholly negligible in this application. For example, if we
choose C =20 iF (assuming that this is the lowest value which gives reasonable
accuracy in the technology used), then the power ofthe in-band noise from the sec-
ond integrator is below the -125 dBFS level, i.e. more than 20 dB lower than the
first integrator's noise.
9.1.6 Circuit Design
Now that we have selected all absolute capacitor sizes, we can estimate some spec-
ifications for the op amp. Let's first consider the bias current. Assume that the
folded-cascode op-amp topology depicted in Fig. 9.8 will be used. With a bias cur-
rent of 21 for the differential pair, the slew current available at each output termi-
nal is 1. To estimate the slew requirements, note that the largest quantity of charge
which may need to be transferred from the input capacitors to the integrating
capacitors is C I VDD' If we allocate 25% of a half-clock-period for slewing, then
the required slew current is
=
VDD
bias3
Ibias4
V N
vcm->-r:
~--Lvcm
bias1 J J>--"-,Jf--+=--J/:,.......l---':U--..L bias1
Figure 9.8: Folded-cascode op amp with switched-capacitor
common-mode feedback.
294

-
SCMOD2: General.purpose Second-Order Switched-Capacitor ADC
(9.16)
According to this calculation, the bias current of the op amp can be very low- a
mere 8 J.!A!
Let us now consider the bandwidth requirement for the op amp. Suppose we
require 10 time-constants of linear settling in the remaining 75% of the half-clock
period. (Having 10 time-constants of linear settling makes the settling error nearly
87 dB lower than the error eo at the onset of linear settling. Since eo is only a
fraction of the step, 100 dB 8NR should be within reach.)
As shown in Appendix C, the settling time constant 't is given by CloQd/(~gm),
where Cload is the total capacitance loading the output of the op amp, while gm is
the transconductance of the input devices, and j3 is the feedback factor. For the
first integrator, C1oad/J)::= C l' and hence we require
(9.17)
This transconductance is readily achieved with a 2-JlA drain current.
Lastly, let us consider the de gain of the first op amp. Linear analysis indicates that
the attenuation offered by the NTF begins to degrade if its zero moves inside the
unit circle by about n/OSR. Since finite op-amp gain shifts the pole of the first
integrator
by
CI/(ACz),
one
might
be
tempted
to
conclude
that
A;:; (OSR· Cj)/(nCz) =:: 13 would be adequate. However, this linear analysis
neglects the nonlinear errors which result from slewing and nonlinear DC gain.
(Note that as long as the amplifier's gain is linear, finite DC gain does not cause
distortion. Similarly, as long as the amplifier does not slew, settling errors caused
by finite op-amp bandwidth do not cause distortion. However, these ideal condi-
tions should not be assumed.)
Although it is not possible to obtain an accurate estimate of the required dc gain
without knowledge of the nonlinear nature of the amplifier's transfer characteristic,
it is possible to put an upper bound on the required gain. To do this, observe that
295

9 Example Modulator Systems
the settled voltage at the input terminals of the op amp is Vou/A, and that (due to
the double sampling used, as shown in Fig. 9.4) this voltage results in an error
charge that is equivalent to an input voltage error of Vou/(2A). This voltage con-
sists of a signal component (the effect of which is benign), broadband noise (the
impact of which would be reduced by an OSR factor), and distortion components.
If we assume the error consists of dist0rt:ion terms only (an assumption which is
often pessimistic by 30 dB or more), then the requirement that distortion terms
stay below -100 dBFS gives
Vout
-5
(2A) < 10
V,n
(9.18)
Using Vin
;;;: 1.5 V and Vout ;;;: 1.0 V leads to a worst-case gain requirement of
A> 90 dB. In practice a gain of 60 dB is likely to be adequate, but this would
need to be verified using simulations involving the actual nonlinear gain character-
istic of the amplifier.
The above discussion dealt only with the op-amp requirements in the first integra-
tor. We have already noted that noise at the input of the second integrator is greatly
attenuated, owing to the high in-band gain of the first integrator. Other non~ideali­
ties in the second integrator also benefit from this attenuation mechanism, with the
result that the distortion and settling requirements of the second op amp are greatly
relaxed. In this example, the second op amp could simply be a copy of the first op
amp, scaled down in size and current by, say, a factor of 4. More aggressive scaling
is theoretically possible, but the additional power and area savings would be mini-
mal.
To complete this modulator example, Fig. 9.9 shows the schematic of a common
comparator, while Fig. 9.10 depicts a widely used clock generator. By using these
blocks in conjunction with those shown earlier, a fully transistorized implementa~
tion of MOD2 can be constructed. References [2-3J describe systems similar to
this example, and the reader may wish to consult these references for further
design information.
--------
296
=·
•--
•
•

SCMOD2: General-Purpose second-Order SwltchecJ..Capacltor AOC
: ~To 0 flip flop
VSS
Figure 9.9: Latched comparator.
2D~
L..--f>---<>2 ~
-{}>o- == delay/non-overlap adjust
Figure 9.10:
Non~overlapping clock generator.
297

9 Example Modulator Systems
9.2 SCMODS: A Fifth-Order Single-Bit Noise-Shaping Loop
The specifications for our second ADC example are listed in Table 9.2. Since we
are aiming to increase the bandwidth by a factor of 50 and the SNR by 10 dB rela-
tive to the previous example, while only increasing the clock rate by a factor of 8,
we must increase the modulator order and/or the number of quantization levels.
For this ADC example, we choose to implement a high-order single-bit modulator.
9.2.1 NTF and Architecture Selection
Fig. 4.14 on page 112 showed the achievable SQNR as a function of OSR for sin-
gle-bit systems of various orders. According to Fig. 4.14, a 4th-order system can
achieve SQNR ~ 120 dB with OSR = 80. Typically, we want the theoretical
SQNR to be 10-20 dB more than the desired SNR in order to allow for the inevita-
ble SQNR degradation due to circuit non-idealities and to leave as much of the
noise budget for thermal noise as possible. Furthermore, since the SQNR limits
shown in Fig. 4.14 correspond to modulators which are on the verge of instability,
this figure should be viewed as defining the boundary of what is possible, rather
than what is practical. For these reasons, we opt to use a 5th-order NTF.
Fig. 9.11 shows a code fragment for simulating the SQNR of a 5th-order system
and Fig. 9.12 contains the resulting plot. As Fig. 9.12 shows, the peak SQNR of
this system is 128 dB with a maximum stable input of -4 dBFS. In order to leave
some margin for instability, we will scale the input such that a 2-Vp differential
Parameter
Symbol
Value
Units
Bandwidth
fa
50
kHz
Sampling Frequency
f,
8
MHz
Signal-ta-Noise Ratio
SNR
110
dB
Supply Voltage
VDD
3
V
Input Voltage Range
[-2,2)
V
Table 9.2. Specifications for the example Sth.order modulator.
298

-
SCMOD5: A Fifth·Order Single-Bit Nolse-Shaplng Loop
signal corresponds to -6 dBFS, i.e. we will set the differential full-scale range to
-4 V to +4 VI. With a theoretical SQNR of 128 dB, we could opt to decrease the
peak out-of-band gain of the NTF (IINTFII_) in a bid to gain increased input
range, but for the sake of moving forward we will stick with the default value of
IINTFlloo and be content to use only half of the full-scale range.
OSR
8e6/(2*50e3);% OSR = 80
NTF
synthesizeNTF(S,OSR,l);
amp
[-140~5:-15 -12 -10:0];
snr
simulateSNR(NTF,OSR,amp);
plot (arnp,snr, 'b-d'};
Figure 9.11: Code for simulating the SQNR curve.
-4 dBFS max
stable input
'...'-.'.
"," ..,
,
.
--'... ' - .'..
--'.. ,',
..;..
-120
-100
-80
-60
-40
-20
0
Input Amplitude (dB)
Figure 9.12: Simulated SQNR curve.
140 ,..--,..--,..--,..--,..--"",,---,---,-,----,-,---,
iL-loo--128 dB peak SONR
@ -5 dBFS input
100
120
..
iii
~
80
a:z
80
a
(J)
40
20
0
-140
t. The reader should not be concerned that the ADC's full-scale is larger than can be supported by
a 3-V supply voltage. As indicated in the text, the ADC is only intended to operate on signals
that are smaller than half of full-scale. i.e. -2 V to +2 V.
299

9 Example Modulator Systems
The code for the next two steps in the design process, namely realization (with a
cascade-of-resonators feedback, or CRFB, topology) and dynamic range scaling, is
listed in Fig. 9.13 along with the resulting coefficients. As was observed in
Section 8.4.3. we will find that the small value of b1leads to an unreasonably large
integrating capacitance.
iI,
Consider the topology shown in Fig. 9.14 for use in the first integrator. This topol-
ogy has the attractive feature that the amplifier does not experience a common-
mode step if the input common-mode voltage and the reference common-mode
•
form = 'CRFB';
[a,g,b,c]
= realizeNTF(NTF,form);
b(2:end)
= 0;
ABeD
= stuffABCD(a,g,b,c,form};
[ABCDs umaxJ
= scaleABCD(ABCD};
[a,g,b,c]
= mapABCD(ABCDs,form};
~ a
=
[0.09675
0.1628
0.2015
0.3386
0.2577]
g = [0.00228 0.003687J
b
= [0.09675
0
0
0
0
0]
C = [0.1261
0.1961
0.3715
0.3434
2.157]
Figure 9.13: Realization and dynamic range scaling- CRFB topology.
(1-v}+(2.V) C1
~refP (l'VJ+(;:2f1~ r_-lCF2:.--...,
refn~
C
~-V1
~
Vin ~ 12
~refn (1~ ,~ L--I
refp (10V)+(2.:t"irl
Figure 9.14: First integrator in SCMOD5.
(In this circuit, the load on the reference is signal-independent.)
300

SCMOD5: A Flfth.()rder Single-Bit Nolse-5haplng Loop
voltage differ, and so can be used with both balanced and unbalanced inputs. How-
ever, this circuit's insensitivity to the input common-mode voltage comes at the
cost of increased noise relative to a structure in which the input capacitors are also
used to feed back the reference. According to the anal sis of Appendix C, the nTIS
input-referred noise voltage of this circuit is
8kTIC I' assuming the amplifier
noise is negligible.
Since the outer capacitors are switched between V reiJ
and Vrein' or vice versa, a
differential reference V ren - Vrein
;;:: 2 V implemetfts a full-scale range of -4 V
to +4 V. However, since nfe input sampling capacitors are connected to either the
input or to each other, a 2-V input corresponds to a half-scale signal, as called for
in Table 9.2. The signal-to-thermal-noise ratio for this system with a half-scale
input is therefore
SNR = (_I)((2 V)2/2)
OSR
8kTIC I
'
(9.19)
which leads to CI = 21 pF for SNR = 110 dB at OSR = 80. A 21-pF capaci-
tor is rather large (on the order of 150).lID x 150 ).lID), but it pales in comparison to
the size of the integrating capacitor C2 . With aggressive design, the output swing
of the first integrator given a 3-V supply may be as large as 4 Vpp' However, even
with this wide swing, the ratio C1/C2 must be b1/2, or about 1/20, when the
voltage scaling of the modulator coefficients is taken into account. Thus, the inte-
grating capacitance needs to be 420 pF, and since there are two such capacitors the
area occupied by the first integrator is prohibitive. (A similar conclusion was
reached in Section 8.4.3, where we found that a CRFB topology targeting
SNR;;:: 103 dB at OSR = 64 reqUired a total integrating capacitance of more than
500 pE)
A number of alternatives exist which make the desired specifications more readily
achievable. For example, we could increase the sampling rate in order to take
advantage of the OSR factor in (9.19) and thereby reduce the size of all capacitors,
while leaving the topology unchanged. Increasing OSR also allows the specifica-
tions to be achieved with a lower-order modulator, which also helps save capacitor
area since the b1coefficient tends to increase as the order is decreased. A factor of
301

9 Example Modulator Systems
10 improvement is possible, provided the designer has the freedom to set the sam-
pling frequency arbitrarily.
A second alternative, which does not require increasing the sampling frequency, is
to employ a feedforward topology. Fig. 9.15 lists the code for realizing the desired
NTF with a CRFF topology and gives the resulting coefficients. Since bi is
increased by a factor of about 3.5, the integrating capacitors are reduced by this
factor. Although the resulting 120-pF integrating capacitors are still large, they are
within the realm of practicality.
As discussed in Section 4.4.2, feeding the input signal forward to the input of the
quantizer with a gain of b6 ;;: 1 ideally results in a unity STF. In order for this
feedforward technique to work properly with a binary modulator, the coefficient of
the feedforward tenn should be b6 ;;: 1/k, where k is the effective quantizer gain.
Using simulations to evaluate the effective quantizer gain results in the require-
ment b6 = 0.53.
9.2.2 Implementation
Fig. 9.16 shows the topology for which we now have coefficients. The remaining
steps for the implementation of SCMOD5 are similar to those followed in the
implementation of SCMOD2. In brief, we need to perform voltage scaling, con-
struct a behavioral schematic, verify the behavioral model, and then substitute
transistor-level implementations for each behavioral block until the schematic has
been fully realized.
form'"
'CRFF';
[a,g,b,c]
'" realizeNTF(NTF,form);
ABCD '" stuffABCD(a,g,b,c,form);
[ABCDS umax]
'" scaleABCD(ABCD};
[a,g,b,c]
'" mapABCD(ABCDs,form);
--7 a
[1.561
1.75
1.355
0.9588
0.7931)
9
[0.001586 0.01526J
b
[0.3561
0
0
0
0
1)
c
[0.3561
0.4025
0.2819
0.2215 0.08296)
Figure 9.15: Realization and dynamic range scaling- CRFF topology.
302

-
SCM005: A Flfth-order Single-Bit NolSe-5haplng Loop
----------------------. ---._-
In preparation for these activities, it is wise to create a simplified behavioral sche-
matic, such as that shown in Fig. 9.17, in order to determine the switch and quan-
tizer timing which will be used to implement the desired difference equations.
Fig. 9.17 lists the difference equations for SCMOD5 and illustrates a possible tim-
ing for the various analog computations. As shown in the figure, we have chosen to
update even-numbered states on phase 2 and odd-numbered on the subsequent
phase 1. This timing is convenient because the updated even-numbered states,
namely x2(n + 1) and xin + 1), have terms which depend on the previous odd-
numbered states, while two of the odd-numbered states (x3 and xs ) have update
equations which contain tenns involving x2(n + 1) and x4(n + 1). Thus, with the
timing shown, the inter-state coefficients will correspond directly to capacitor
ratios.
Unfortunately, the situation is a little more complicated for the summation and
quantization operations. To see this, note that although the update for xt(n + 1)
occurs on phase 1, the structure of the feedback branch for the first integrator
I'(n)
Q
'2(n+1)
1
p-----'-~(o/-~ z - 1
z
z-l
,,,,,
x3(n) :,,,,,
,
,
---------------------------------------
Integrator
,,
x1(n) ,
Figure 9.16: CRFF topology for SCMODS.
303
•

9 Example Modulator Systems
shown in Fig. 9.14 requires the quantizer output v(n) to be available during the
preceding phase 2 and held over the subsequent phase l.t However, according to
the block diagram shown in Fig. 9.16. y(n) (which is quantized to yield v(n»
is
dependent on x2(n + 1) and x4(n + 1), which only become available at the end of
phase 2. One solution to this interdependency problem is to expand the x2(n + 1)
and x4(n + l) tenus as shown in Fig. 9.17. With this technique, y(n) can be com-
puted using the tenus x l(n), x2(n), ..., x5(n) , all of which are available in phase 1.
Quantizing y(n) at the end of phase 1, as indicated in Fig. 9.17, then yields v(n)
with the desired timing.
r
Desired Difference Equations
xl(n+ l) = xt(n) + b1u(n)-c1v(n)
x2(n+ I) = c2x l(n) + x2(n)-8I x 3(n)
x 3(n+ 1) = c3x2(n+ l)+x3(n)
xin + I) = c4x3(n) + x 4(n) - 82x5(n)
x5(n + I) = c5xin + 1) + x5(n)
y{n) = alxt(n) + a2x2(n + I) + a3x3(n)
+ a4xln + 1) + a5x5(n) + b6u(n)
= (at +a2c2)xl(n)+a2x2(n)+(a3-a2gt +a4c4)x3(n)
+ a4xln) + (a5- a482)x5(n) + (b6 + bta2c2)u(n)
v(n) = Q{y(n)J
Timing
J2l.fT1J2lIT1.f
xl(n)
xl(n+1)
x n)
x3n+1
Figure 9.17: Timing check for SCMODS.
t. Alternatively, a swilched-C branch involving cross-connections to the amplifier's inputs could
have been used to eliminate this requirement. We use the integrator arrangement shown in
Fig. 9.14 in order 10 demonstrate another way to resolve this timing conflict.
304
-"

SCMOD5: A Fffth-order Single-Bit Noise-Shaping Loop
Table 9.3 lists the coefficients which result from scaling the original block diagram
for an 8-Vpp full-scale input range and a 4-Vpp integrator swing. (An 8-Vpp full-
scale ensures that the half-scale input range is the desired [-2 V,+2 VJ differential
input range.) For the at, G3 , as and b6 coefficients, Table 9.3 lists the modified
values resulting from the expansion given in Fig. 9.17.
Table 9.3 also lists rational approximations to these coefficients. Approximating
the coefficients with rationals allows the use of unit capacitors in the implementa-
tion, which helps to ensure that the capacitor ratios will be insensitive to fringing
effects as well as processing-induced length and width variations. Note that we
have set the small 81 coefficient to zero, and that although the 82 term has been
retained it has been altered by about 10%. The other coefficients have been approx-
Coefficient
Value
Approximation
Capacitor Ratio
a1 ~ (a1 + a2c2)
2.266
9/4 - 2.250
CdCT
a2
1.750
7/4 =1.750
C,JCT
83 ~ (a3 - a291 + 84C4)
1.564
3/2 =1.500
C,slCT
a,
0.9568
1
C,slCr
85 -) (as - ~92)
0.7785
3/4 =0.7500
C17/Cr
9,
0.0016
0
CJCs
92
0.0153
1/60 =0.0167
C>,ClO
b1=C,
0.3561
5/14 =0.3571
C,/C2
be ~ (be + b18t:2)
0.7840
3/4 =0.75
C"ICr
C2
0.4025
2/5 =0.4000
C:,ICs
c3
0.2819
2f7 =0.2857
CslC7
c,
02215
2/9 =0.2222
CalC 10
Cs
0.08296
1/12 =0.0833
C
"
/C12
Table 9.3. Coefficients and capacitor ratios for SCMODS. cT = L:~ 13 c,
305

9 Example Modulator Systems
imated with greater precision (typically with an error of a few percent), even
though such high precision is typically not required in a single-loop ~~ modulator.
If the NTF zeros remain intact, slight changes to the coefficients usually have only
a small effect on the modulator. The reason is that such changes only shift the
NTF's poles, and the theoretical SQNR is a weak function of the NTF's poles.
However, in this example we chose to set g1 to zero, in order to avoid having to
realize a large (600:1) capacitor ratio. This choice moves two NTF zeros down to
dc, and so does degrade the theoretical SQNR.
To quantify the degradation, Fig. 9.18 compares the NTF associated with the orig.
inal coefficients to the NTF associated with the quantized coefficients. Since the
modulator is single-bit, both NTFs take into account the effective quantizer gain as
detennined by simulations. According to this plot, the new NTF has about 7 dB
less quantization noise attenuation than the original NTF. Since the peak SQNR
with the original NTF was about 128 dB, we would expect the new NTF to yield
SQNR eak:= 121 dB. Simulations confirm this value. Since the desired SNR is
110 dB~ quantization noise will still be a small portion (less than 10%) of the noise
budget, and hence our choice to dispense with g 1 is a reasonable one.
-••
"•
55;;
iiI•!•s
i
ii"-=
~
--=
ii
, :;''''
.;.;; ;;:-;..
-,-
" ...•.......
,
.
,
~
,~.
,
.
,
,
,
. ., - ,
, "
.
·
.
·
,
..
...:...;.;.;.;-:.;.;; ....:.
..;..:-:;,,;-:-
..'-.'-
·
,
, ......
.
.,.
.,. ,
,
eo··
.•
. ...,
"
- ~ -: .;. ~ ~~;:
--'- -'.~" .... Final NTF·
,,~,_ .. ' ..'..'.
. .;. ~ .:.;.::-;:. -
~..~.~. ~ .;.:-:. rm~ g~i~.~ ~j~4d$ ., ',-
..,.....,....,.
\i(., .:.,.::::::.... ,. , ,
~ OriQinal NTF: .. ~. -;..;-
~:-:.: .. -rms gain =-111dB :- .;.
·
,
,
..
- - -..- . ,
'"
.
-·-;···;·1-:,;·,;·;';'·"
..;..;.;.;;:-;.;..
",
,
,..
. . . .,.. ,. , -.. "
.-"
,
' ,
".,.
,
,
,...
,
,
,
-.'
"-,,
.'
~"'".
·
..
o
-100
104
10-3
10-2
10-1
Normalized Frequency
Figure 9.18: Original and final NTFs for SCMODS.
306

-
SCMOD5: A Fltth-Order Single-BIt Noise-Shaping Loop
If the SQNR loss associated with setting the g I coefficient to zero is considered
excessive, a capacitive T network, such as that shown in Fig. 9.19 can be used to
realize the required small coupling tenn. The charge provided to the op-amp input
by this network equals that of a direct capacitive connection with a capacitance
C/(k + 2). Thus, if C is a unit capacitor and the integrating capacitance Cs is
made with 40 such units, then using k = 13 will yield gl
:::; 1/600. Since para-
sitic capacitance on the T node will affect the accuracy of the implemented coeffi-
cient, the capacitors' top plates should be connected to node T and the switch
grounding T should be made small.t
As a final confinnation that the quantized coefficients are acceptable, Fig. 9.20
plots the simulated integrator maxima as a function of the de input level. Since the
swing at the output ofeach integrator is below the 2-Vp limit, the amplifiers within
the modulator should not saturate for inputs in the [-2V, +2Vl input range.
Now that the modulator structure, timing and filter coefficients have been deter-
mined, a behavioral schematic needs to be constructed and verified. Fig. 9.21
shows a detailed schematic which follows from the simplified schematic of
Fig. 9.17. For the sake of generality, this schematic shows the feedback capacitor
C4 associated with the first resonator even though we have already decided to omit
this element. The summation operation which creates the output of the loop filter is
perfonned by the passive capacitor network shown at the bottom of the figure. The
phase I switches connected to the capacitor labelled CHOLD, and CHOLD itself, are
Figure 9.19: A capacitive T.
t. A further caution is in order if the circuit of Fig. 9.19 is used in an ordinary switched-capacitor
biquad. In this application, op-amp dc offset is more problematic with a T network than with an
equivalent standard SC branch.
307

9 Example Modulator Systems
included for simulation convenience. In an actual implementation, these elements
can be omitted since their only function is to improve the readability of the YP and
YN waveforms by making them non-retum-to·zero.
As with SCMOD2, the first step in the verification of this schematic is an impulse-
response test. Fig. 9.22 compares the simulated impulse response with the MAT-
LAB-calculated impulse response. Since these agree precisely, we can be fairly
confident that the loop filter has been implemented correctly and can therefore pro-
ceed to closed-loop simulations. Fig. 9.23 shows the (smoothed) spectrum which
results from an 8192-cycle simulation, and superimposes the desired NTF, scaled
as prescribed in Appendix A to follow the expected noise density. The SQNR
observed in this simulation is within a few dB of the MATLAB-simulated SQNR;
doubling the number of simulated cycles closes the gap to less than I dB. Further-
more, since a check of the voltage excursions at the integrator outputs confirms
that the swing at these nodes is consistent with the swings predicted in Fig. 9.20,
the designer can be confident that the behavioral schematic is correct. Capacitor
selection, switch sizing, and amplifier design remain to be performed, but will not
be considered here. References [4-7] describe these and other considerations in the
context of similar modulator systems.
r=i
. .... ',.
............
...',
'," ....;. ... ".
.
.
..,
• /j".
Statal
- 8
~
State 2
-V-
State 3
.~-
State 4
- •
-
StateS
Figure 9.20:
308
.
.
o,L_-'-~-'-_L.---.l...-.
L--l_~_~__~~--J
o
2
4
DC input (V)
State maxima vs. input level for SCMODS.
;
i

-
,:
I
, ,
SCMOD5: A Flfth-Qrder Single-Bit Noise-Shaplng Loop
Figure 9.21: SCMOD5 behavioral schematic.
309

9
Example Modulator Systems
•
-ii•"I
I
I
...J.....j
..,.,..-.--
. .. __
.
.
.
-+ ....1.. "',
..;
,
,..~ .... ~
. t······ !
.._;.
..~
1.1
1.2
1.3
1.4
"'1.' .,... ]. ·---·f-., ..j
,
!
j
'.,.','
..:
.••.,j.••
i
'
.
!
.)
••_._f
,
....;
!
i
i..
'·.4
.9
1
'--1,'
!-
- !
1
.-.,.....-.,..
,
!
........ j....._+-
. ~ ....
~..,..
. . . . ,
- ...;- -.: -.;..:.
~
.:" -':- _.: -·<:·c·:c"'cic'c·c:·cc'-C,,-,cc:..:z;·:·.
;::::,::;:'
ExpectedPSD
Simulated PSD
t---
'r
--t
!
.._;
······1
i' .._(-.
j
j . ,
;
~
.l _
..-i
J,..
2
~
A
.5
~
J
B
time, J-1S
"
Expected Impulse Response
Simulated Impulse Response
... ... _..
....'. - _
'- , '.
.,....:
;-{..:-:.;.;; ....
, ..:
;
;..;.; .", ..
·
,
.
. . .,- .., . ~.
~..
·
, .
. ...
~...
····f
..+
,
.... ~"
.1
-6:
}
,
.
!·'····1 .....j .....+.
"T
;
i!
!
-.8;- ····t·--·-1
,
t··
j
.11,··..1 I_
~_.
.:... .1 .....-[-.J
....i..... i..
'
i
J
t-;.·"'",.ci-",··c·.Je·c···c·iJ·c·c·"c"-C·c·c··=·JC··"'ic"''=',
-1.2;
i
-1.4!·
-1.6(
!
-1.8)o
Figure 9.22: SCMOD5 impulse response check.
. SNR = 119 dB'
•.'.".
. .'..'.•
0-6dBFS .... ;.:.~~.
..-~
:
~ ..:..:-.: :.;-:
'.' •• ,- ..•..:. j .:. i ;
;
-;
i ..;. .;..:-:. 1.;
. , .,
. ,
., .,.
~. ,..'
-.. ,
.
, ... , .
-:..
~.
.:<;..
., ....:.. _~ ..:.. :.~.:.;-:
....
~ ..
, ., ...
·
" - .
\ ... ".
., -....". -,. ',. ',. ",' ,'.'
.. , ...
-150L·.·.'.....:,;.?;;.
;,;.:,_,_,~",",,1.'.'.:.:·-"-,'_'·.J.I__--'-~-'.;._..__',_.-'-:'...:,-'.:.'-,'-,'.L'_N..BW_=_,~.5..k_H~'...J
10kHz
100kHz
1MHz
Frequency
Figure 9.23: SCMOD5 spectrum from behavioral simulation.
o
-100
rr
310
..

'< :
i
,I
H
j!
J:
i
i
I;
1j
J
A Wldeband 2..Q Cascade System
9.2.3 Instability and Reset
In a single-bit system such as this one, it is important to consider the possibility of
modulator instability and to provide means for initializing the modulator on
power-up. The reset (R) switches shown in Fig. 9.21 set all integrator states to
zero, and thereby both provide a safe starting state, and may return the modulator
to a safe state in response to overload.
A reset event can be triggered by either analog or digital means. An effective ana-
log technique for determining that the modulator needs to be reset is to monitor the
input to the quantizer and reset the modulator whenever the magnitude of the quan-
tizer's input exceeds a threshold. The threshold should be high enough that the
modulator does not reset under nonnal operation, but low enough to activate a
reset even if the amplifiers saturate.
Modulator instability can also be detected by digital means. Since the stable input
range of this modulator is half of full-scale, any output value that is greater than
half of full-scale indicates overload. By monitoring the output of the first stage of
decimation for values which are, say, 75% of full-scale, modulator instability can
be detected rapidly with a negligibly small false-alann probability.
To minimize artifacts caused by reset, some modulator systems set the output of
the decimation filter to full-scale until the modulator is once again operating prop-
erly, and the glitch caused by reset has propagated through the decimation filter.
9.3 A Wideband 2-0 Cascade System
The specifications of our third ADC example are listed in Table 9.4. The signal
bandwidth is 1.25 MHz (25 times that of the preceding example), while the sam-
pling frequency is 20 MFIz (2.5 times that of the preceding example). Thus, the
oversampling ratio for this modulator is one-tenth of the previous example, i.e.
OSR is only 8. In order to achieve SNR ::: 90 dB at such a low oversampling
ratio, multi-bit quantization is now a necessity.
311

9
Example Modulator Systems
9.3.1 Architecture
Fig. 9.24 shows the architecture which we will examine. A second~order modula-
tor is used as the first stage of the cascade in order to avoid the problems associated
with a first-order first stage and to avoid the complexity of a third-order first stage.
As noted in the previous example, keeping the modulator order low keeps the coef-
ficient b1 large and thereby saves capacitor area.
The number of bits allocated to the first stage involves a trade-off between the
complexity of the quantizer and the sensitivity of the ADC system to analog non-
idealities. If the first stage uses 12 bits, then there is no need for a second stage at
all and so the deleterious effects of mismatch between the analog and digital trans-
fer functions is not an issue. However, the internal ADC and DAC need to be very
complex. On the other hand, if the first stage uses only a I-bit quantizer, the raw
Parameter
Symbol
Value
Units
Bandwidth
'
B
1.25
MHz
Sampling Frequency
I,
20
MHz
Signal-to-Noise Ratio
SNR
90
dB
Supply Voltage
VDD
5
V
Input Voltage Range
[-2,21
V
Table 9.4. Specifications for the example cascade modulator.
v,
5-bil
5
U--J MOD2
E,
PipelineI-V..;2~(1_Z-1) 2
ADC
7
v
Figure 9.24: High-level system diagram for the 2a Ocascade.
312
I

A Wideband 2"() Cascade System
perfonnance of a second-order modulator at OSR
:;::; 8 is so low that we require
99.9% of its quantization noise to be cancelled digitally, which can only be
achieved with stringent matching between the analog and digital domains. A 5-bit
quantizer was selected as a compromise between these two extremes. The com-
plexity and power consumption of a 5-bit quantizer were judged to be reasonable
and, as we shall demonstrate shortly, 5-bit quantization yields a reasonably robust
system.
Fig. 9.25 shows a code fragment for simulating the SQNR of the ideal system and
Fig. 9.26 displays the resulting plot. As the latter figure shows, the 2nd-order mod-
ulator is able to realize a peak SQNR of 65 dB, whereas the composite system
exhibits a peak SQNR which is 40 dB higher, namely 105 dB. As is commonly
done in 6.1: systems, the theoretical SQNR is set 15 dB higher than the SNR target
(which is 90 dB) in order to make quantization noise an insignificant contributor to
the system noise budget.
BW
~ 1.25e6; Fs
= 20e6;
OSR
Fs/(2*BW);
M = 32; nlev = M+1;
nb = 7; kpipe
= 2 A nb;
Ha = zpk( [1 1J, [0
OJ ,1,1);
amp = [-120:5:-15 -12:2:-6 -5:0];
sqnr = zeros(2,length(amp));
N = 8192;
ftest
= round(0.16/0SR*N);
ul = M*sin(2*pi*ftest/N*(0:N-l]);
for i = 1:1ength(amp)
(vI junk1 junk2 yl1
= simulateDSMlundbv(amp(i))*u1,Ha,nlev);
v2 = ds_quantize(kpipe*(vl-y1),kpipe+l);
v
= vI
- filter( [1 -2 1] ,1, v2/kpipe);
specl = fftlv1.*hann(N))/lM*N/4);
sqnr{l,i)
= calculateSNR(specl{1:ceil(N/2/0SR)) ,ftest);
spec = fft(v.*hannlN})/(M*N/4);
sqnr(2,i)
= calculateSNR(spec(l:ceil(N/2/0SR)),ftest);
end
Figure 9.25: Code for simulating the cascade system.
313

....
9
Example Modulator Systems
Since the SQNR improvement is 40 dB, we are aiming to cancel 99% of the quan-
tization noise, and thus would expect that a 1% gain error would result in a notice-
able SQNR degradation. In order to verify this prediction, we can scale the input to
the pipeline ADC by a factor of (1 + gain_mismatch):
v2 = ds_quantize(kpipe* (vl-yl) * (l+gain_mismatch) ,kpipe+l)
Similarly, the effect of finite op-amp gain in the amplifiers of the modulator can be
mimicked by shifting the zeros of the NTF to the left of z ;:; 1:
Ha = zpk([1 1] * (1-1/gain) , (0 O],I,ll
Fig. 9.27a plots the peak SQNR of the cascade system as a function of the gain
mismatch. As this figure shows, a 1% gain error reduces SQNR by about 4 dB,
which is in agreement with our intuition, while a gain mismatch of less than 0,5%
results in negligible SQNR degradation.
100 . r-~~~~~-"
__
Cascade
-
o!Io -
S·b MOD2
•
•"iI
ii
peakSQNR
= 105 dB
@ -1 dBFS
" ., .
. .'...•.
.. :..
...... ,"
20
,
"',-'"r'" , •• ','"
o'-.. ,.~_:
; ...
;
.
'~_.
-120
-100
-80
-60
-40
-20
0
Input Amplitude (dB)
Figure 9.26: Simulated SQNR curves.
en
80
~
a:
80
Zg
.
40
,
, •.
. ,
314
I

-
I
~I
A Wldeband 2-0 cascade System
Fig.9.27b plots the resulting curve. According to these simulation results, the
amplifier gain needs to be at least 65 dB in order to have negligible SQNR loss.
9.3.2 Implementation
Fig. 9.28 shows the ADC system as implemented in [8J. As the diagram indicates,
the 5-bit 2nd_order modulator (which makes use of dynamic element matching to
reduce the effects of DAC mismatch errors) is followed by a 7-bit pipeline possess-
ing 1 bit of redundancy at each residue stage. The data from the modulator and the
pipeline stages are combined digitally in accordance with Fig. 9.24.
Fig. 9.29 shows the structure of the first integrator. Note that the sampling capaci-
tors are divided into 32 units which accomplish the DAC function. As discussed
earlier, this structure minimizes noise, but the amplifier must tolerate whatever
common-mode step results from the difference between the input and reference
common-mode voltages. References [9-11] describe implementations of similar
multi-bit cascade modulator systems in more detaiL
rg
a:z0
100 .
<J)
~
&
. .
.
. .
.
_i· '.' '.'.'"
·
..
. ,
.
· ,
..
·
..
,
..
90
90 _'::---'---c~-'-~:--'--::c-'----:'
1~
1~
1~
~
M
ro
~
00
Gain Mismatch
Op-Amp Gain (dB)
Figure 9.27: Effect of two nonidealities on SQNR of the cascade system.
315

9 Example Modulator Systems
Correction/Cancellation Logic
Dou!
Figure 9.28: Expanded cascade system diagram.
~
1
'
J
+
~
z-b"
+
2-.§L
Vin
V'e1
~
-
2'bsl
I .
1
Figure 9.29: First integrator in the cascade system.
(In this circuit, the current drawn from the reference is signal-dependent.)
316
,....,
ii
iii
~ I
-, ii--=
dI
-, •ii-
~ii
=--
=; ii..
--
=.. ii
=
~e-=
;;..,.•i•i
-•!
I-
-i

I
I
:!
=
A Micropower Continuous-Time ADC
9.4 A Micropower Continuous-Time ADC
The preceding examples dealt with systems characterized by high dynamic range.
10 this example, the ADC is intended to interface directly to a microphone and our
primary concern is micropower operation. To eliminate the need for an anti-alias
filter and a preamplifier, the ADC will be continuous-time with a input range of
±20 mY. The signal bandwidth for this audio application is 100 Hz-lO kHz.
Our goal is to maximize dynamic range, while consuming less than 50 J.1A from a
1.8-V supply. Table 9.5 summarizes the design specifications for this ADC system.
Since the bandwidth is low, a high oversampling ratio is readily achieved and thus
a low-order modulator can be used. For example, if the clock frequency is
13/2 MHz = 6.5 MHz,t then OSR =300. Since an ideal single~bit second-order
modulator achieves SQNR> 100 dB with this OSR, this configuration provides
Parameter
Symbol
Value
Units
Signal band
8
100·10k
Hz
Supply Voltage
VDD
1.8
V
Current Consumption
IDD
50
~A
Input Voltage Range
-20 to 20
mV
Sampling Frequency
f,
6.5
MHz
Signal-to-Noise Ratio
SNR
80
dB
Table 9.5. Specifications for the micropower modulator.
t. 13 MHz is a frequency that is readily available in many cellular telephones. A lower clock fre-
quency could easily have been chosen, but as we shall see, employing a high sampling rate
reduces the area occupied by the circuit. Dividing the clock by two ensures that the duty cycle of
the clock is 50%, a condition which we implicitly assume when we set the DAC feedback delay
to half of a clock period.
317

9 Example Modulator Systems
more than enough quantization noise suppression. Lastly, we choose to adopt a
feedback topology in order to realize a lowpass STP having no out-of-band peaks.t
9.4.1 High-Level Design
Fig. 9.30 shows the modulator topology which we wish to implement. In contrast
to the second-order system discussed in Section 6.6.1, the DAC timing for the cur-
rent system is assumed to be [0.5, 1.5], i.e. the DACs are updated half a clock
cycle after the comparator samples its input. This half-cycle delay gives the com-
parator sufficient time to resolve its input and also provides set-up time for the
DACs. Although the clock frequency in this example is low enough that a modem
CMOS process would not require a feedback delay of this magnitude, it is none-
theless instructive to see how this delay can be incorporated into the design pro-
cess.
As with previous examples, the first task in the design process is to select the target
NTF. For simplicity, we will use the same NTF as was used in the first design
example, namely
-
=
=-....
I iii
, -
I '"
1 ==
I•
I !!
I..
!!'
EII
(
Z - 1)2
NTF(z) =
Z_ 1/3
.
x
Q
Figure 9.30: Continuous-time modulator system diagram.
(9.20)
v
I
t. As discussed on page 95. a discrete-time feedforward topology can have a a perfectly fiat S1F if
a direct connection from the input to the quantizer is included. Unfortunately, realizing an STP
which has no out-of-band peaks with a continuous-time feedforward topology is not so straight-
forward.
!!
~
- ~
318
i
~
i ii
•

Ii
i.'
-",'
'-I
i
i
"I
I
1
A Mlcropower Continuous-Time ADC
The second design task is to determine coefficients which realize this NTF. For this
operation, the c coefficients, which only affect internal scaling, can initially be set
to unity. As described in Section 6.6, we must select the coefficients (al•a2, u3)
to match the sampled pulse response of the loop filter to the impulse response of
our target discrete-time system's loop filter.
Since the loop filter is second-order with two poles at dc, its long-tenn pulse
response is a ramp. The a1 and a2 coefficients control the slope and intercept of
this ramp, so it is straightforward to find values for these tenns which yield the
desired long-term behavior. However, while the pulse is active, the system is
responding as if the input were a step, and since this step occurs midway through
the first feedback interval, the first sampled value of the system's output will not
fall on the same ramp as the remaining samples. Fortunately, the a3 coefficient
affects only the first sample of the pulse response, and thus provides the means to
compensate for the half-cycle feedback delay. In principle, any amount of delay in
the main loop filter can be accommodated by adding a sufficient number of prop-
erly-timed feedback paths to the quantizer, but the sensitivity of the modulator to
errors in the coefficients increases as the feedback delay is increased.
Fig. 9.31 lists MATLAB code which leads to the following coefficients for our
half-cycle delay system:
(9.21)
while Fig. 9.32 plots the STF associated with this modulator. The latter figure rein-
forces the discussion of Section 6.6.2, namely that the STF of a continuous-time
modulator naturally attenuates frequencies which alias to the passband. For an
ideal implementation, the attenuation experienced by frequencies which alias into
the passband is over 130 dB. In practice, finite dc gain in the loop filter will limit
t. There are many ways to compute these coefficients. The method used in Fig. 9.31 is based on
the fact that the pulse response of the loop filter is a weighted linear combination of the pulse
responses from each DAC. By computing these pulse responses (yy in Fig. 9.31), the weight-
ings (i.e. the ai coefficients) needed to achieve a desired response can be found by solving a set
of linear equations, as is done in the last line of Fig. 9.31.
319

9
Example Modulator Systems
% Desired NTF and its impulse response
NTF = zpk([l 1],(1 1JI3,1,1);
n_imp = 10;
y_desired = impLl(NTF,n_imp)';
% State-space description of CT loop filter
% as a 3-input,
I-output system
Ac
00;101;
Bc
-1 0 0;
0 -1 0 ];
Cc
01];
Dc
[00-1];
td
0.5;
Sys_c = SS(Ac,Bc,Cc,Dc);
set (sys_c, 'InputDelay',td*(l 1 1]);
% Discrete~time equivalent and associated impulse response
sys_d = c2d(sys_c,1);
yy = squeeze ( iropulse(sys_d,n_imp)
) ';
% Solve for coefficients S.t. a*yy = y_desired
a
= y_desired/yy;
Figure 9.31: Code for computing CTMOD2's coefficients.
i•i-!
o
-20
-40
-60
-80
"
,
'.; ......••. '...•:....' ••••.• ~. .,S!Fn:"s~tfS,:2,..: ..:
... :.....;....
... >. .
.'.
....'-
... ,.
.'.
.-._.
=
-1 OO:---'--'--.-'-----'-~--"-L-'---.L-"--:':c-'--'--l
o
5
10
Frequency (MHz)
Figure 9.32: Signal transfer function for CTMOD2.
320
•
i
i•

-..
A Micropower Contlnuous·Tlme ADC
the depth of the NTF's and hence the STF's notches, as dictated by (6.35), but an
alias suppression of over 80 dB is nonetheless readily achieved.
The third design step, namely dynamic range scaling, can be perfonned by using
the discrete-time model of the modulator, hut since the discrete-time model only
computes the modulator's internal states at the sampling instants, it is advisable to
use a behavioral version of the continuous-time modulator instead. Fig. 9.33 shows
a behavioral schematic which can be simulated to detennine the internal signal
swings. The circuit parameters, along with the fannulae used to calculate them, are
tabulated in Table 9.6. Behavioral simulations indicate that the peak swings of the
two integrators are 1.6 V and 3.5 V, respectively. Scaling the states for peak swings
of 0.5 V, setting the full-scale level 25% higher than the desired 20-mV input range
and choosing I.
:;:; 101z :;:; 1013 :;:;
lO~A yields the scaled values shown in the
fourth column of Table 9.6. These scaled values can be used to construct a transis-
tor-level implementation.
Refening to Table 9.6, note that the scaled value of C 1 is 11 pF. Since in a typical
process the capacitance per unit area is 1 fF/~mZ, each C1 capacitor occupies a
sizable (100 ~m x 100 ~m) area. Since the value of C. is inversely proportional to
the clock rate, it should now be apparent that excessive silicon real estate would
have been consumed had the modulator's clock rate been much lower than the
value chosen.
Latches on
falling CK
I
g/' "''i--+
.
Outputs
-'±=======::l:J======:':±=::::I----"
±O.513
,,~.-- -
-----
on rising CK
Figure 9,33: CTMOD2 behavioral schematic.
321

9 Example Modulator Systems
9.4.2 Circuit Design
Fig. 9.34 shows the schematic of DACl, the first feedback DAC, along with the
latch which precedes it. In order to minimize thermal noise, the DAC uses a com-
plementary structuret, and the current source devices MN1 and MP1 are sized to
have as large a VGS as possible, while leaving only as much headroom for swing at
their outputs as is necessary.:I: Furthermore, the devices are physically large in
Parameter
Formula
Starting
Scaled
Units
Value
Value
VFS
-
1.0
0.025
V
C,
-
1.0
11
pF
I,
alGI
2.9
10
i1A
R,
Vpsl(bJ!,C l )
350
2.5
k.Q
C,
-
0.1
0.8
pF
12
aZ/ sC2
0.87
,
i1A
R2
I/(cJ!,C2)
1540
420
k.Q
13
-
1
1
i1A
R3
a3/ (c213)
611
87
k.Q
Table 9.6. CTMOD2 circuit parameters.
t. For a fixed LSB size, a complementary current-mode DAC has a 3-dB noise advantage over a
single-ended DAC with associated counterbalancing current sources since all currents in the
complementary DAC are half the corresponding currents in the single-ended DAC and its asso-
ciated fixed current sources.
.
*. Since the noise density of the drain current in an MOS device is ~kT8m' minimizing noise
requires minimizing 8m' Since 8m = 21D1(6.V) , where 6.V = V6s- VT and the drain current
1D is fixed, we therefore desire to maximize V GS'
322
If
I~
I•Ii=•I
t
=
j
i
·j I

I
I
A Mlcropower Continuous-Time ADC
order to minimize their 1/f
noise. With the sizes shown, the (non-II f) current
noise density at the output of DACI is 0.4 pNJfu, which translates to an input-
referred noise of 2 nVI jHZ. This noise density is approximately 12 dB lower than
the J(4kT)(2R1) = 9 nV / Jfu density associated with the input resistors, and
hence the DAC will be a relatively minor contributor to the noise of the modulator.
If the resistors and the DAC were the only noise sources in the circuit, the expected
SNR would be
(9.22)
I
;•
;
As anticipated, the above noise-limited SNR is much lower than the >lOO-dB the-
oretical SQNR of an ideal second-order modulator operated at an OSR of 300.
Since doubling I I by a factor of 2 would halve R1' and thereby increase the 8NR
given in (9.22) by 3 dB, it makes sense to spend as much of our current budget on
DACI as we can afford. However, with the values chosen, and assuming the cur-
rent in the bias network is equal to that of the main DAC branch, we have only
allocated 20% of our power budget to DACI .
5,A
Figure 9,34: (a) Latch and (b) DAC schematics.
•
I
a)
c
VP
VN
i' 'i
,
""
DP
DN
b)
VDD=1.8V
323

9 Example Modulator Systems
The reason that we cannot afford to allocate more current to DACI is that the first
amplifier must possess low noise and must also be able to source or sink the sum of
the input current and DACI 's output current. Both requirements imply that the
bulk of our current budget must be allocated to the first amplifier.
Assuming that a class-A amplifier is used, the bias current in the output legs must
be at least 5 ~A in order to meet the output current requirements. To reduce the
ratio of the maximum current to the minimum current in the output devices, a more
practical bias current would be on the order of 10 J.lA per leg. Next, assume that we
desire the amplifier's input-referred noise to be equal to that of the input resistors,
namely 9 nVI jHZ. Then, assuming the Ilf noise is negligible, the transcon-
ductance of the devices in the input differential pair needs to be
t. With a bias current of 2lc :: 251lA, a BJT differential pair achieves a transconductance of
8", :: 0.51clVT :: 0.25 mAIV. A CMOS differential pair can only have a 8", which is a fraction
of this amount. In the above. we generously assumed that this fraction is 50%.
Assuming a square-law model, gm = 21DIAv, and choosing .6..v = 100 mV
leads to I D = 14 J.lA. Thus, we need to spend significant fractions of our SO-J.lA
current budget on both the differential pair and the output legs. In a single-stage
amplifier, the current in the differential pair flows in the output legs, and so it might
appear that a single-stage amplifier would provide a power-efficient way to achieve
both low noise and adequate drive current. Unfortunately, the transconductance of
a single-stage CMOS amplifier biased with 25 ~A is no more than 125 J.lA/V or
so,t and thus the differential voltage at the input of the amplifier corresponding to
an output current of 5 J.lA will be at least 40 mV, which is double our desired full-
scale input voltage! Clearly the transconductance of a single-stage amplifier is
much too low for this application, and thus we need to adopt a multi-stage archi-
tecture, such as the two-stage architecture depicted in Fig. 9.35. The bias currents
shown reflect the above calculations, while the output devices are cascoded in
Ii
I
iiiII•!!
(9.23)
= 270 J!NV.
--•
324
ii-
ii
I

~[
-I
=1
-I
:-1
1
,-,
A Mlcropower Continuous-Time ADC
order to achieve an output resistance which is comparable to R2 = 400 k.Q. Com-
pensation and common-mode feedback networks are not shown.
Since the second amplifier in the modulator is required to supply currents which
are approximately 10% of those of the first amplifier, simply scaling the first
amplifier down by a factor of 10 should yield a circuit which has negligible contri-
butions to the noise and distortion of the system.
Lastly, Fig. 9.36 shows the schematic of a low-power comparator which is suitable
for the modulator under consideration. This comparator may be operated with a
low (l ~A) bias current, since the speed requirements are quite lax and since the
modulator is tolerant of comparator offset. Simulations indicate that the power
consumption of this circuit is less than 5 J.lW at a clock frequency of 6.5 MHz, so
the power consumed by the quantizer will be a very small portion of our 9O-JAW
budget.
The above discussion indicates that a modulator of the form considered here
should be able to achieve a dynamic range of more than 80 dB over a 10-kHz
bandwidth while consuming less than 100 IlW, an expectation which is supported
by the excellent work of [13] (which also used chopping to combat 11f noise).
Vop
bias -Jle.:---11
Von
L
Figure 9.35: Twn-stage amplifier.
325

!-i;
I
I
iI
B
IPo-J
9
Example Modulator Systems
VDD =1.8V
bias 0-11/1*1).lA
1l-+--1-=-~+---l--+-1I1/o.18
rx
~O~.2,",5/c-'~+---,rsx
'---4---l1 110.5
Figure 9.36: A low-power comparator.
9.5 A Continuous-Time Bandpass ADC
Section 5.4 described the structure of a bandpass D..L ADC which is well-suited to
the dual-conversion superheterodyne receiver illustrated in Fig. 9.37. In this
receiver architecture, the incoming radio-frequency (RF) signal is filtered, ampli-
Figure 9.37: A dual-conversion superheterodyne receiver.
....-- Front End --~.. ~.o---BackEnd -----I...
AAF
ADC
DSP
----
I E
II
- iii
Sample Rate
10-750 kaps
IF.
1-4 MHz
VGA
IF,
10-300 MHz
LO,
RF
50-2000 MHz
LNA
326

•
A Continuous~Tlme Bandpass ADC
tied and mixed to a first intennediate frequency IFI' which is in turn filtered,
amplified and mixed to a second intermediate frequency IF2 before being con-
verted to digital form. Although a discussion of the advantages of this receiver
architecture over competing architectures is beyond the scope of this text, it is
worth noting that the venerable superheterodyne architecture is preferred when the
system must achieve both high sensitivity and high selectivity. By converting an IF
signal to digital form, low-frequency analog impairments such as 1/f noise and
de offset do not affect the signal, and thus this system is able to achieve a higher
dynamic range than a system in which the signal is translated to de before AID
conversion.
A straightforward implementation of the receiver back end as depicted in Fig. 9.37
is feasible, but suffers from the drawback of requiring several high-dynamic-range
(and thus high-power) blocks, namely the variable-gain amplifier (VGA), the sec-
ond mixer, the anti-alias filter (AAF) and the ADC. Since the VGA can be elimi-
nated if the ADC has sufficient dynamic range, and since the AAF can be
eliminated if the ADC is of the continuous-time variety, the system can be simpli-
fied greatly by using a power-efficient and high-dynamic-range continuous-time
bandpass LU: ADC.
Section 5.4 argued that such an ADC can be constructed if an LC resonator plus a
current-mode feedback DAC (IDAC) are used in the first stage of the ADC. This
architecture, first illustrated in Fig. 5.24 but rendered in slightly greater detail in
Fig. 9.38, obtains high efficiency by exploiting the high output resistance of the
active mixer in the construction of the ADC's first and most critical resonator.
Since subsequent resonators require less dynamic range than the first, the only ele-
ments in this system which must process the full dynamic range of the signal are
the LNAlMixer and IDAC, thereby giving this arrangement a significant power
advantage.
Section 5.4 gave an overview of a particular embodiment of this ADC architecture
and provided justification for several of the architectural choices, in particular the
choice to use active-RC and switched-capacitor resonators in the second and third
resonator stages, respectively. In this section, we take this topology as a given and
delve deeper into the design process and the underlying circuits.
327

9
Example Modulator Systems
9.5.1 Architecture/Analysis
Fig. 9.39 depicts a simplified schematic of the ADC, including timing details,
which we will use as a starting point. Our first step is to transform this mixed con-
tinuous/discrete system into a discrete-time equivalent so that we can bring the
power of the 6.!. Toolbox to bear.
1,
-
A state-space description of the continuous-time portion of the loop filter is
Cli te
0
-I
0
0 '" '"
x,
r-
L,i2e
0
0
0
0
0
"
C'3xk
0
x,
(9.24)
-g31
0
0
-g34
-g3"
Xx
C 14i 4(
0
0
-g43
0
0
-g4v "c
~
Ylc
0
0
a
~
0
0
"c
where the state variables (xlc,xlc,x3c,x4c) are as indicated in Fig. 9.39. (For
example, x 1c is the voltage across capacitor C1and x1c is current in inductor Lt.)
DAC
Flash h-"'- ADC
ADC
'Output
,,,,,,,
,
,
,
,
I
----------~
Subsequent Resonators
and Feedback DACs
;----------------~
,,,,
1st Resonator
and Feedback DAC
r----------------
1
:
LC
:
I
Tank
I
,
'
,
'
'-
IF
LO
LNAIMixer
Bandpass "'~ ADC
-•
328
Figure 9.38: Active mixer connected to a bandpass ~ ADC.
iI1

=
~I
,
A Continuous-Time Bandpass ADC
Also as indicated in Fig. 9.39, the output of the loop tilter is sampled when the cur-
rent-mode feedback DACs (glv' g2v' g3v) change stale. Since these DACs feed
current back for a full clock period, the appropriate specification for the DAC tim-
ing is tdac = [0,1].
a) Loop Filter
Qlv
03\1
~cu~nt.mode
D.o,
b) Quantization and Feedback
2
""
-
SWltched-cap
SVB
DACs
SVA
c) Timing
,
regenerates
on phase 2
X4c .a"lJled
,
T
'2
CK
,
,
,
X5~
X6~
'=:1
,I
C
.." ==:J
""':
I
C
$VB
~
[
vln)
'II
II '
, IDAC 1eedbBd< '
Figure 9.39: A single~ended representation of the bandpass system.
329

9 Example Modulator Systems
The next piece of information we need in order to construct a toolbox-compatible
description of this modulator is the state-space description of the discrete·time por-
tion of the loop filter. Following a procedure like that used earlier, while paying
attention to the timing of Fig. 9.39, yields
[
X,ln + \11
x 6(n+ I)
'"
y(n)
(9.25)
The matrix descriptions of (9.24) and (9.25) specify a mixed
continuous~timel
discrete-time system of the fonn illustrated in Fig. 9.40a. To transform such a
system into an equivalent system with a discrete-time loop filter as shown in
Fig.9040b, we use a pulse-invariant transformation (toolbox function mapCtoD)
to transfonn ABCDc into ABCDI for the feedback path, while keeping the signal
path through ABCDc intact. The ABCD matrix which describes the discrete-time
portion of the loop filter is then
ABeD '"
o
c,
(9.26)
This ABCD matrix can be used to calculate the NTF using the toolbox function
calculateTF.
To compute the STF, simply observe from Fig. 9.40b that
STF = Lo,H,.
where Lex: is the open-loop transfer function of the continuous-time system and HI
is the closed-loop transfer function from YI to v. Loc may be evaluated from
ABCDc using MATLAB 's LTI (linear time-invariant) system capabilities. To com-
pute HI' the following state-space fonnulation may be used
330

A Continuous-Time Bandpass AOC
(9.27)
With the above formulae. the NTF and STP can be computed for a given set of
parameter values. Thus, system analysis is readily accomplished. System synthesis
(the inverse procedure of converting a desired NTF into a set of parameter values)
is Jess straightfOIward, but may be accomplished iteratIvely. Once a set of parame-
ter values which realize a desirable NTF and STP have been found, dynamic range
scaling (using the results from behavioral simulations) and system denormalizaton
need to be performed. The results of these operations for the system under consid-
a) Original System
I
1
J
Y1c
Y1
ABCDc
ABCD2 -
Q
r
/DAC' r
v
b) Discrete-Time Model, plus continuous-time prefilter
Uo'~
--.J
ABCDch
o
Q
Figure 9.40: Transformation to a discrete-time model.
331

9
Example Modulator Systems
Table 9.7. Parameter values for the bandpass modulator of Fig. 9.39.
ii-
•II;;
=,.
1r
• •
1 i
II
li-II
',: ==-
1=
j~ii..
'.
' .
Parameter
Value
Cs
200fF
CS6
-200fF
cs,
-16.1 fF
C'S
400fF
C6S
280fF
C6'
-36.6 fF
Ci6
240 IF
Vref
0.5V
flash LSB
106mV
. .;.... -
. '"
Parameter
Value
L,
2 x 10 ~H
C,
250 pF
9"
21 v.AfV
934,943
26.8 v.AfV
9"
256 "A
93'
5.2 "A
94'
O"A
C13,C14
1.9 pF
0
iIi'
-20 ..
:!:!.
......
u..
-40
I-
Z
-£0
eration, denorrnalized for an 18-MHz clock rate, are tabulated in Table 9.7, while
Fig. 9.41 and Fig. 9.42 plot the associated NTF and STF, respectively. The NTF
has a peak out-of-band gain of 3, and the STF exhibits the inherent anti-aliasing
. . . . - '
-80L---L..--:'Lc---'------:'-:---.L.--c:'=-c---'------:'
o
2.25
4.5
6.75
9
Frequency (MHz)
Figure 9.41: NTF for the bandpass example,
332

=
A Continuous-Time Bandpass ADC
property which is characteristic of a continuous-time modulator. Although the STF
nulls are not as deep in this system as they would be in a fully continuous-time sys-
tem, signals which alias to the passband are nonetheless attenuated by at least
75 dB.
Fig. 9.43 shows the simulated SQNR vs. input amplitude curve for a lO-kHz signal
bandwidth. The peak SQNR is 107 dB and the modulator is stable for inputs that
are within a fraction of a dB of full-scale.
9.5.2 Subcircuits
Fig. 9.44 depicts the equivalent input-referred noise for a variety of noise sources
in the system as a function of the full-scale setting. As described in Section 5.4,
this ADC implements a variable full-scale by changing the full-scale current of the
first feedback DAC in tandem with the g31 transconductance. For this figure, the
signal bandwidth is assumed to be 150 kHz; at lower signal bandwidths, the contri-
butions of shaped noise sources such as DAC mismatch noise, quantization noise
and SC noise are much reduced. Note that the noise due to the front end RF corn-
0
-20
iii':s -40
LLI-
00
-60·
'"
.;.
-80~c.....J.---,-.u...l-L--'--...Ll~.L.....cL....l-ll..L./I..L-=r:::.-UULw....-"-,,,../.J
0 2 3 4 5
Normalized Frequency (,l,s)
Figure 9.42: STF for the bandpass example.
333

9
Example Modulator Systems
CD
~
a:zg
...
334
oL..C--'-'--'---'----'---'----'--'-J
-100
-80
-60
-40
-20
0
Input Amplitude
Figure 9.43: Simulated SQNR for lhe bandpass example.
15
.:
.
.._ ..
.._ .. 1~A1Mi~~L: :2: _
_ .. _"
-- --:..:::::::;::..:... -:- -_.: ....:-...:....:.. :~ -. ~_.-
...,:;...-
" "- -
"
.. .:. _.. ;. _..:. .. .:....~ ..:::::.. .:-." -;. _..:. _. .;.. -"
:~ -¥\~;~c~j::: :t~~~ll~:1:: ~~~~~l~::~::+:::
~!,~-::r
~-
-.- -- -,- -- ';"'
"··dP.\~·· .. " ..
,- - -
_:::;:. ---:.;::::: ··········:·jP~~:::;::
"';-sG-
-30 dBm
-18 dBm
50 mVpp
Input Full-Scare
200 mVpp
Figure 9.44: Noise contributions in the bandpass ADC system.

11'
1 i'I i
.1
,
1
I
I
~
A Continuous-TIme Bandpass ADC
----_._---_...-
----
panents, namely the LNA and the mixer, is independent of the ADC's full-scale
setting and furthermore dominates the system noise. As the ADC's full-scale set-
ting is reduced, i.e. as the effective gain of the ADC is increased, the input-referred
equivalents of noise sources located after the g31 transconductance arc reduced at
the rate of 1 dB per dB, simply by virtue of the fact that g31 is proportIOnal to the
ADC's gain. (The slope of the RC noise is somewhat shallower than 1 dB/dB
because the noise of the g31 transconductor, which is included in the RC noise,
increases with increasing g31 .) Note also that both the IDAC's thermal noise and
its mismatch noise decrease as the full-scale limit of the IDAC is reduced. At first
this may seem counter-intuitive, since one would expect that reducing the IDAC's
full-scale should reduce the dynamic range. However, both statements are correct.
As the full-scale of the IDAC is reduced, its dynamic range falls, but it falls at a
rate of less than 1 dB/dB. In other words, as the full-scale of the IDAC is reduced,
the absolute size of its input-referred noise (as opposed to its size relative to full-
scale) is also reduced. The main advantage of a variable full-scale in the ADC is
that the noise figure of the system at the minimum full-scale setting is within
approximately 1 dB of the 7-...dB noise figure of the LNAlMixer.
Fig. 9.45 shows the structure of the active-RC resonator used for the second stage
of the modulator. By making the op amps out of simple transconductors, the Q of
this resonator can be very high, since the Q-degrading effect of finite gain (caused
programmable capacitor arrays
c
R
o-~rl+ :;--...e.,-Vv---';·
c
R
Figure 9.45: Structure of the RC resonator.
335

9 Example Modulator Systems
-by resistive loading) turns out to be cancelled by the Q-enhancing effect of phase
shift (caused by capacitive loading). In order to accommodate process tolerances
and to allow some fleXibility in the clock rate, this resonator needs to be tunable.
Tuning is accomplished by transforming the resonator into an oscillator and adjust-
ing the feedback capacitors until the oscillation frequency equals 1/8.
Fig. 9.46 shows a single-ended representation of the switched-capacitor resonator.
The structure is a standard LDI (Iossless discrete integrator) topology. As indicated
in the figure, the capacitors in each integrator are made with simple integer multi-
ples of a unit capacitor. The realized center frequency is within a fraction of a per-
cent of the desired center frequency, despite the use of the simple coefficients
shown.
II
=
9C
4C
Figure 9.46: Structure of the SC resonator.
---"-------
336

Audio DAe
9.6 Audio DAC
Table 9.8 lists the specifications ofa representative audio AI: DAC. In order to sim-
plify the reconstruction filter, the modulator assumes a passband whose width is
greater than the bandwidth of the input signal. In particular, the modulator's pass-
band is set to twice the input sample rate (i.e. Is = 2fs in = 88.2 kHz, or more
than 4 times the input bandwidth f so ), and so the modulator's clock rate must be
256f" in ~ 11.29 MHz to provide an oversampling ratio of 64 for this extended
passband. By extending the modulator's passband in this way, the quantization
noise (which grows abruptly at the modulator passband limit frequency) need not
be removed by an excessively sharp reconstruction fitter. Note that the passband
edge of the interpolation filter remains at Iso = 20 kHz. For this filter, we
require the passband variation to be no more than 0.1 dB and the image attenua-
tion, namely the attenuation beyond Is in /2. to be at least 90 dB. Lastly, we shall
assume that the quantizer has M = 8 steps.
Parameter
Symbol
Value
Units
Input Sample Rate
's.;n
44.1
kHz
Signal Bandwidth
'00
20
kHz
Output Signal-to-Noise Ratio
SNR
110
dB
Passband Flatness
0.1
dB
Image Attenuation
>90
dB
Modulator Bandwidth
fa = 2 's,ln
88
kHz
Modulator Sample Rate
's = 256 's.in
11.29
MHz
Modulator OSR
OSR = ',/(2'0)
64
Number of Quantizer Steps
M
8
Table 9.8. Specifications for the DAC example.
337

9
Example Modulator Systems
The overall architecture of the DAC system is illustrated in Fig. 9.47. The follow-
ing subsections will describe the modulator, the interpolation filter, and the recon-
struction filter in detail.
r
I
~
j
9.6.1 Modulator Design
As discussed in Section 7.3.4, a multi-bit modulator is especially desirable in a
DAC system since multi-bit quantization allows the modulator output to follow the
desired signal more closely, and thereby ease the design of the reconstruction filter.
For the modulator parameters given above, a third-order, 9-level modulator
employing an NTF with IIHII_ = 2.5 yields a peak SNR of nearly 115 dB over the
extended passband. Since the NTF uses coincident zeros at dc, the SQNR in the
true O-to-20-kHz passband will be much greater than the desired 110 dB and we
can therefore rest assured that the performance of the modulator will be more than
sufficient for this application.
Fig. 9.48 shows a block diagram of the modulator. A standard CIFB (cascade-of-
integrators, feedback) topology was selected so that the naturallowpass STP asso-
Analog
Outpul
I!. Interpolation foo Digilal fiL HDACr Reconstruction f.-
Filter
Modulalor
Filter
Digila
Inpu
Figure 9.47: DAC system.
l-
--+
~-----'-::!v'--l Q
Figure 9.48: Block diagram for the digital modulator.
-------._-~---
338

AudIo CAe
ciated with the modulator can simplify the interpolation filter. The coefficients for
this structure were obtained by using the first code block given in Fig. 9.49 to pro-
vide first-cut coefficients (listed) which are scaled for dynamic range. These coeffi-
cients were then re-scaled or changed, as indicated in the code block on the right,
to give power-of-two interstage coefficients or to simplify the feedback coeffi-
cients. Note that the interstage coefficients are rounded downward so that the max~
imum values of the internal states stay less than one. The final coefficients (listed
in Table 9.9) are obtained from the values in Fig. 9.49 by quantizing the only non-
power-of-two coefficients, namely a3 and c3 ' to two binary terms.
Fig. 9.50 compares the poles of the original NTF with the poles of the NTF after
coefficient quantization. Since the poles are nearly identical, the perfonnance of
the modulator will not be significantly affected by coefficient quantization; toolbox
simulations with the fmal NTF confinn this expectation.
The next step toward a hardware implementation involves determining the word
lengths needed within the modulator loop. In performing this task, we will choose
word lengths such that the in-band noise caused by finite precision arithmetic is
below the -130 dBFS level.
form'"
'eIFS';
[a.g,b.e]",realizeNTF(NTF,form);
b{2:endl
'" 0;
ABCD~ stuffABCD(a,g,b,e,form);
ABCDs
~ sealeABCD(ABCD,M+l);
[a,g,b,e)~ mapABCD{ASCDs,form);
% a
(0.0331 0.0807 0.1626)
•
g
0
% b
[0.0331
0 0
OJ
% e
[0.6176 1.3672 10.4879)
% scale for a(l)
k~a(I)*32;
a(l)
a(I)/k;
b{l)
~ btl) Ik;
e(l)
~ c{l)*k;
% scale for e(l)
k
~ c(I)/O.S;
e(l)
c(l)/k;
a(2)
~ a(2)/k;
c(2)
~ c(2)*k;
% scale for c(2)
k=c(2)1l;
e(2)
e(2)/k;
aD)
~ aD)/k;
e(3)
== c(3)*k;
1/32
0.5
1
Figure 9.49: Toolbox code for determining coefficients.
339

9 Example Modulator Systems
Coefficient
Original
Transformed
Quantized
% Error
Value
Value
Value
a, = b,
0.0331
0.0312
,
0
32
.,
0.0807
0.0617
,
1
16
·3
0.1626
0.0909
'
1
3
16+32
c,
0.6176
0.5000
,
0
2
e,
1.3672
1.0000
1
0
Co
10.4879
18.7539
16+2
-4
Table 9.9. Modulator coefficients.
•
Figure 9.50: NTF before and after coefficient quantization.
% quantized coefficients
aq
[1/32 1/16 1/16+1/32];
gq
0;
bq
[1/32
0 0 0];
cq
[1/2 1 16+2];
ABCDq
= stuffABCD(aq,gq,bq,cq,form);
[NTFq STFq]
= calculateTF(ABCDq);
figure (1); clf;
plotPZ (NTF, 'm', 10) ;
hold on;
plotPZ (NTFq, 'b' ,10) ;
340
o
X Original NTF
X NTF with quantized
coefficients
••
i
I-•I .
I .·-

l'I
Audio CAe
For the first integrator, the input-referred in-band noise power associated with N 1-
bit quantization is
I
(2-N1 )2
1
at
3
. OSR'
(928)
Since the power of a full-scale sine wave is M2/2, the number of bits in the first
stage must satisfy
or
J
-13
Nt >-!og2(Ma t
1.5xlO
OSR) = 20.3.
Hence, we require the use of 21-bit arithmetic in the first integrator.
(9.29)
(9.30)
Since noise added to the input of the second integrator is first-order shaped when
referred to the modulator's input, the input-referred in-hand noise power associ-
ated with N 2-bit quantization in the second integrator is
I
(9.31)
From (9.31), the number of bits re uired for a -130-dBFS noise contribution is
N 2 >-10g2(Ma tct
0.45xlO- 13(OSR)3) = 16.2. so we will use 17 bits in the
second integrator.
Lastly, since the input-referred in-band noise power associated with N3-bit quanti-
zation in the third integrator is
341

9
Example Modulator Systems
5(OSR)5'
(9.32)
In order to verify that the above word-lengths are sufficient, a version of the modu-
lator which uses integer arithmetic will be constructed (in C) and simulated.
Since the word-lengths of the integrators differ, the coefficients in the C model are
not the same as the coefficients listed in Table 9.9. For example, the third integrator
uses 12-bit arithmetic whereas the output of the second integrator has 17 bits, and
thus a coupling coefficient of c2 = 1 translates into a right-shift of 5 bits.t Simi-
larly, since the toolbox convention is that both the input u and the feedback v
occupy a range of -M to M, these signals must also be scaled appropriately.
Fig. 9.51 lists the code which simulates the operation of the modulator. Since each
integrator is delaying, the updated states of the modulator can be computed with-
out making use of temporary variables. Computing the output of the third integra-
tor, then the second, and finally the first, implements the desired difference
equations. For the sake of simplicity, the code does not include saturation for each
summation operation, even though it would be wise to include such logic in the
actual implementation. As the figure shows, the C model can be quite compact.
Lastly, Fig. 9.52 plots the spectrum of the output data when the C model is sup-
plied with a -1 dBFS input. Since the "noise floor" in the 0 to 20 kHz passband is
-153 dBFSI500 Hz, the integrated noise in this band is -137 dBFS. This value is
small enough to make the effect of digital truncation noise negligible, and thereby
validates our word-length choices.
t. Recall that the modulator coefficients are scaled for a dynamic range of unity. Thus the binary
representations of these states should be viewed as fractional quantities, with a binary point
located immediately after the sign bu. Aligning the binary point of a 17-bit word WIth a 12-blt
word therefore requires a shift of 5 places to the right.
Alternatively, one can view the mteger version of the modulator as having resulted from scaling
the mternal states of the original modulator by IN, - I, 2Nl-1 and 2N,-I. As a result of this scal-
ing, all coefficients of the modulator change by powers of 2.
342
-
I
J

Audio DAC
~include <stdio.h>
main(){
long u, v,
xl=O,
x2=O,
x3=O;
while( scanf(
~%d", &u)
>0
)(
v = (18*x3)
»
12;
if(v>4)
v
4;
if ( v
<
~4
)
v
-4,
x3
+=
(x2»5)
-
(v«8)
-
(v«7);
x2
+= (xl»5)
-
(v«13);
xl
+= u
-
(v«16);
printf(
~%d\n", v
);
}
Figure 9.51: C model of the modulator.
....
,",-,,, --~-.-.-.+o+~,..:' .
. ,.. ,. ,.,.
,-.
.. .. ;-,.:.:.:,
.; . ,':-:'; :
.. ,.
•• J •
~. ,
, •••• "
•
. . .... "
. . . , .. "
.. _, .. ,.... ,., ..-...,.... ,.. ,.
;'-
.; .:.; ';·:-:·:i·
;.
, .. ;. ':'i .:.:.:-::
,
.. -: .. ; ..:.; .:-:.:.:;
.
•
~.
'
. .'.'
1.
•• J.
'.
_'.'
;
.,.... ,'
.... ~ --,. ';',
or~Sf:"r=:::::::C:=:'=:;::;::;:::=~~ --,-~.
-_
_
_
Expected PSD
PSD with C model ..
-40
, ".
.-
-160 __
••.:.kY~~':';':;i:L':':":'-':':'-
·,-,--,-"c.N':'.B~W.=517 Hz :,; :
10°
101
102
103
10
4
Frequency (kHz)
Figure 9.52: Simulated and expeded PSDs.
343

9
Example Modulator Systems
9.6.2 Interpolation Filter Design
As discussed in Chapter 7, the task of the interpolation filter is to reduce the power
of the unneeded spectral replicas centered at the Nyquist frequency Is, ill and at its
multiples up to (OSR - 1)Is, ill' This reduces the noise power in the noise-shap-
ing loop, improving its dynamic range. It also makes the task of the analog recon-
struction filter easier. Since the quantization noise occupies the same frequency
band, it is unnecessary to suppress the spectral images very rigorously; it is suffi-
cienllo reduce them to (or somewhat below) the quantization noise level.
As an aid to the design of the filter, Fig. 9.53 plots the STF for the modulator
designed in the previous subsection along with the quantization noise's power
spectral
density
(PSD).
(The
PSD
plotted
assumes
a
noise
bandwidth
1-
NBW
::::: Is
/2 in order to facilitate comparisons between the PSD and the
."
STEt) As thi~\gure demonstrates, the STF attenuates any high-frequency images
I
present in the modulator's input by about 20 dB; another 15 dB of attenuation must
.!!
•
":: 15 dB
,..' ..'
'
'
',",
. 0'
"
;.,., '.'-.'
.'..:-.
:40 dB ..... .
,. ,
.
..
'
, .
,
,
'
.
•
•
•
,
0
,.
",' '.'
•
"
_,
•
,
•
,
•
,
•
','
'.' ',' '.' .,
•
......0..; : ;":'
Q. noise density;
o'
::::07(NBW = O.S/fs.!n>:
'--~L----'-------'---""-_--'-,_.L_L~
;
j
j
;
;
I
j
~1
'
.
0
0.125
0.25
0.375
0.5
Normalized Frequency
STF and quantization noise density for the DAC modulator.
0',' '.
20
10
;;-:
0
'"
Z
-10
~en
LL
-20
'"
"0
~
-30
0
'"
-40
"0
-50
-60
0
Figure 9.53:
t. The expression plotted is INTFI , multIplied by the scale factor [Jf,. wJ(./273).The reader IS
referred to AppendIx A for a discussion of noise and its PSD.
f,
M
344

i
I
i
Audio DAC
be provided by the interpolation filter to bring the image power down to the level
of the high-frequency quantization noise. Since the reconstruction filter must atten-
uate both the images and the quantization noise to acceptable levels, providing fur-
ther image attenuation is generally neither necessary nor very helpful. Having less
image attenuation is certainly possible, but may increase the burden on the recon-
struction filter.
Since the interpolation factor is OSR = 256 = 28, it is convenient and efficient
to realize the filter as the cascade of several stages, each interpolating by a power
of 2. Such stages can be realized by the sine filters earlier introduced as simple
decimation filter stages in Section 2.9. As described there, the transfer function of
the sinck filter is
(9.33)
Note that here z is associated with the high (output) sampling frequency of the
stage; N is the interpolation factor, the ratio of the output and input sampling rates.
In the frequency domain, the transfer function becomes [sinc(Nf)/sinc(f)]k. This
function is close to 1 around dc, and zero atf= fJN, 2fJN, ...t Hence, a sinck fil-
ter can be used to reduce the amplitudes of the spectral images centered around
these frequencies.
A key issue in the design of the sine filter is how well it can suppress the power at
the lowest image of the signal band edge f 80' located at f 1 = f slN - f 80' This
can be described by the image gain
iI
j
t. Here,/s is the sample rate at the output of the filter.
--------- ---_. _.._-_._-_.
(9.34)
345

9 Example Modulator Systems
G is a function of the interpolation factor N (here equal to 2), and of the input over-
sampling ratio
f,lN
2IBO
(9.35)
A plot of G vs. OSR in , shown in Fig. 9.54. indicates that G is a strong function of
OSRin , but only a weak function of N.
Next, it will be shown that the last stage of the interpolation filter may be chosen as
a simple sinck filter with k = 1 and N = 4.t For this stage, OSRin is 64, and
hence by the curve of Fig. 9.54 the replica attenuation is around 43 dB. Also, here
/ 1 =: l/4. At this frequency, as Fig. 9.53 shows, the STF is down by about
12 dB, further attenuating the replica, while the noise density is around -35 dB.
Hence, at this frequency the remaining replica noise at the output of the delta-
t. As shown in Fig. 2.25, for k = I the impulse response consists ofN replicas of the input impulse.
Hence a sincl interpolator acts simply as a sampk-and-hold (zero-order hold) stage, and so
requires no arithmetic operations in its implementation.
I
I
1
.....
-30
-40
-50
(::~I
".L:-~'"
-60 1
2
4
8
16 32 64128256
InputOSR
Figure 9.54: Image gain for (~)( ~ ~ ~~~) .
m
~
-20
c:
·iii
<.'J
t
-10
346

Audio OAC
sigma loop will be around 43 + 12 - 35 = 20 dB below the quantization noise.
This is more than enough, and justifies the use of the simplest sine filter in thiS
stage.
As shown above, a zero~order hold suffices for taking the data rate from f sl4 to
f s . However, a zero-order hold is not sufficient for taking the data rate from 1./8
to lsi4, since the separation between the STF and the shaped quantization noise
is about 40 dB at I sl8 (Fig. 9.53), whereas a zero-order hold only provides about
35 dB of attenuation. Thus a first-order hold, or linear interpolator, with transfer
function sinci, should be used to increase the data rate from I sl8 to lsi4. (See
Section 2.9.2 for a discussion of this filter.)
To increase the data rate from 1./16 to 1/8, Fig. 9.53 indicates that approxi-
mately
60 dB
of image
attenuation
is
required.
Fig.9.54
shows
that
at
OSRin = 16, a sinci
transfer function provides about 25 dB of attenuation.
Thus, in order to meet the 60-dB requirement, a sinc1 function is required for this
interpolator stage. Similarly, a sinci function is needed to raise the sampling rate
from f /32 to f /16 (Sf
.
to 16f
. ), while sinc2? is needed to go from
s
s
. s, In
s, In
41s, ill to 81s, ill'
Fig. 9.55 plots the individual and composite frequency responses for the above
interpolation stages, and compares the final result with the scaled NTF. In the dia-
gram, the top curve shows the response of the sinc] filter; the next curve down
shows the output response of the modulator, which includes also the STF of the
modulator. In the next diagram, the top curve is the response of the preceding
(sinci) stage, the bottom one is the same curve combined with the responses of all
stages which follow it, including the STF of the modulator. The curves in the rest
of the diagrams are similarly constructed. The last diagram shows also the PSD of
the quantization noise; even without the image~narrowing effect of the yet-to-be
discussed interpolation filters which precede the sinc filters, many of the images
are already below the quantization noise curve, as desired.
The reader may be concerned that the use of high-order sinc filters implies high
arithmetic complexity and a loss of passband flatness, but this is not the case. Con~
sidering the arithmetic complexity, Table 9.10 lists the computational requirements
347

'T
9
Example Modulator Systems
~
!!-i-
,.'-
"
. . .
,
, .
-1 00 :-,UU-L-LJ...:,-c·c·~·"·-'.i'-'c'·_·L·J'_·.i'c':-:'--LJ....i.._·c·'-L~'_'!':'~'c'LJU...l-L..LJ
o
0.125
0.25
0.375
0.5
~--
I•I•I,
i
I
i-
•
-··sinc41
-composite
"-sincl
-composite
0.5
0.375
............. ,., .'.. '..... '.
0.25
0.125
....
oFS=S;;:;:..;rr[n:s-T,T;,:T.'D::':JJ:::T.n
........
: .•• •.• ,•• '.•.•••.•••.•.R.•••.•••.•••••••... ,
.:::..:.. ~-.
-50
-50
-1 00 u··_·.i"_'.i-LJU...l..J.-LJ....i-.i-UU-L-L-LJ....i-LU-I-L-L-LJ....i-UU
o
dB
dB
o
dB
-50
'.'''''' .
......
-"-sincl
-composite
-1 00 U-'-'--'-'-~.l-LJ...L.lW.-'-'--Ll-'-'-"-'--L.J'-"-'-'--u:L.i-Li..J
o
0.125
0.25
0.375
0.5
•1
1
I
1
•j·•
-"-sinc25
-composite
.
7
_.. -slncz
-composite
-<ll: noise
0.5
- -;.
."
. :': ..:.: ..:.;-. -:.:.. :{ '. :':.....
. ~: - :::.: ::::: ~ ::~.; H '. ::: .. ::~
.':.~' .;~ ...}:.
~ 'r:;::::::~ :.. :'.
.,0,.
,
'
'
-'
,
.
... ..'. .
.
...
.•..........• ,~, .,...... ,
~" ,.-.','.. ,~, ''-'-.- .... , ....,.
.~.;:':::,}; 1;:, ::;:.~: ~!:'~';:: ~:: -:; 1::';::;:' ~: ~::.~:;.:~:~-:
.. '..... ' .'... '.. '" . ,.. ' ,....'. , ,'.
-50
-100o
-1OO:-'-LL"-'-.....-'::-':.......-lWJ<W~-'"'-'-"'-""":'-"::':"""-W"""CL:'
o
0.125
0.25
0.375
0.5
o
dB
dB
-50
0.125
0.25
0.375
Frequency (normalized to fs)
Figure 9.55: Frequency responses of the last 5 interpolation filter stages.
The composite responses in-clude the modulator's STF.
348

Audio DAC
of direct implementationst of these filters, Since the total number of additions is
less than 256 per input sample, the computational requirements of the modulator
(8 additions per output sample, Le. 2048 additions per input sample) are consider-
ably greater. Furthennore, since the sinc filters only require a total of 13 registers,
the storage requirements ofthe sinc filters are also reasonable. Implementations of
the sinc cascade range from a direct implementation with dedicated hardware for
each operation (the lowest-power implementation) to a micro-controlled accumu-
lator-plus-register-bank (which requires the smallest chip area).
Parameter
sinc/
sinc25
sincl
sinci
sinc41
Output Sample Rate
8 's,in
16 's,ln
32 's,ln
64 's,in
256 's,in
Sine order
7
5
3
2
1
Number of Additions
at the output sample rate
6
4
2
1
0
(= Number of registers)
Number of Additions at 's,ln
48
64
64
64
0
Table 9.10. Sine filter complexity (direct implementation).
data in'-t-4-lJ>"'f"oi
@f1n -
~o---,data out
@2fin
Figure 9.56: A polyphase implementation of a sinc23 interpolator.
t. A direct implementation ofa sinc2N interpolator requires N - 1 additions at the output rate. A
polyphase implementation is sometimes more efficient. For example, Fig. 9.56 shows a
polyphase implementation ofa sinc23 filter. This implementation requires only 3 additions at the
input rate. or 1.5 additions at the output rate, which represents a 25% savings.
349

9 Example Modulator Syetems
Considering next the passband flatness, Fig. 9.57 plots the passband response of
the sine tilter cascade. The 1.2-dB passband droop can readily be corrected by one
of the filter stages which precedes the sinc cascade.
The two remaining interpolation stages transfonn the data rate from Is in to
21s, in and from 21s in to 41s in' The latter operation can be accomplished by a
Saramllki halfband tilter [16], designed as in Fig. 9.58 using the toolbox function
designHBF. Note that the stopband attenuation (the second argument to design-
HBP) is specified as 70 dB since the sinc filters chosen above provide an additional
20 dB ofattenuation at the edge of this filter's stopband. Table 9.11 lists the result-
ing coefficients, Fig. 9.59 plots the associated frequency response and Fig. 9.60
plots the associated impulse response. (Refer to the designHBF documentation on
page 405 for a description of this function and for an illustration of the filter struc-
ture.) As Fig. 9.59 shows, this filter achieves 82 dB ofimage attenuation; the arith-
metic complexity is 44 additions at its input rate, or 88 additions at the Is in rate,
and the filter requires 50 registers.
'
°C?.~
.. "'~.. ,.;,.J~"" .....
to
'0 -1
i
1
r
I
20
5
10
15
Frequency (kHz)
Figure 9.57: Passband response of the sine filters.

Audio DAC
We now turn our attention to the first interpolation filter. The situation is somewhat
special for this stage. According to our design specifications, this filter must have a
passband from dc to I BO = 20 kHz, and must suppress the images above
f, ;/2 ~ 22.05 kHz by at least 90 dB!. A baltband filterwould have a response
with an odd symmetry around Is in/2, and hence would only provide 6 dB atten-
uation at that frequency. Since we also need to correct for the droop of the sine fil-
[fl,f2,infol = designHBF(0.125,undbv(-70»);
figure{l); elf
f
m linspace(0,O.S,256);
plot (f"'4,
dbv(frespHBF{f,f1,f2), 'b', 'Linewidth',1.5)
figureMagic«(O 2],0.25,2,
[-14010],10,2);
printmif('HBF_freq',
[52.5],
'HelveticalO'J
N = (2"'length(fl)-1)"'2"'(2*length(f2)-1)+1;
y
= simulateHBF([l zeroS(l,N-l)] ,fl,f2};
stem( [O;N-1] ,y);
figureMagic([O N-l],5,2,
(-0.20.5l,0.1,1)
printmif('HBF_imp',
[52],
'HelveticalO')
Figure 9.58: Hallband filter design.
F1Fitter
F2 Filter
20 _ 2-4 + 2--6
2-1 + 2-4 + 2--8
_2-1- z-3 - 2-s
_2-3 +r S _ 2-8
2-2 _ 2-4 + 2--6
Table 9.11. Coefficients for the Saramaki halfband filter.
t. The need for all image energy to be suppressed is debatable. Ifthe input data is already bandlim-
ited to Iso ' then the stopband edge can be placed at Is. In - Iso, which doubes the width of the
transition band. For an audio application, it can also be argued that images above 20 kHz are
inaudible, and thus unimportant. Nonetheless, the convention in high-performance commercial
audio DACs is to suppress all image energy.
351

9
Example Modulator Systems
I
!•
••
=
I.rI
stopband·
,
. . . . . . . , .
............. ,.
dB of====.=.,.=.===..=
...:::::...=:.~~~~~~
-20
-40
-60
-80
-100
-120
-1400::----'-~~"';--~--c:_~~-___:~--'--~2
0,5
1,5
Frequency (normalized to Is,in)
Figure 9.59: Frequency response of the Saramaki haltband filter.
.'
0,5,-------c,-------,----if-----,-----,-----,
0.4
0.3
0,2
0.1
","
-o~ uHu~·~r·~~~~~;~·~~1~~~~
,
-0,2 L....__-'-
-.L-_~_L___'_~_
___'____.J
o
10
20
30
Sample Number
Figure 9.60: Impulse response of the Saramaki haltband filter.
352

Audio DAC
ter cascade, the first filter needs to be a general FIR filter, rather than a halfband
filter.
MATLAB's remez function can be used to design this FIR filter. The filter's order
needs to be very high in order to provide the steep 20-kHz-to-22-kHz transition
band called for in our design specifications. Fig. 9.61 shows the composite pass-
band response with a 186th-order FIR first-stage. Since a realization of this filter
requires 445 additions at its input rate and 186 registers, the first interpolation
stage will occupy the bulk of the decimation filter's real estate. Fortunately, this
complex filter operates at the lowest clock rate (namely 88.2 kHz) of all the stages.
Even so, it will be responsible for approximately 2/3 of the interpolation filter's
power consumption.
Fig. 9.62 shows the structure of the complete filter. As shown in Fig. 9.61, the
passband variation of this filter is 0.08 dB, meeting the specifications. Fig. 9.63
demonstrates that the close-in images are attenuated by 90 dB, again in accordance
with our design targets. All that remains is to attenuate the far·oul images and
quantization noise using the reconstruction filter.
1,0
1'st interpolation Filier
,
,
m
"0
,',' ..'........ :;.::... 'i'7-Composite .Response
-1.0
"
20
15
o
-..
••
• • • •
.-..
•
• .. ·F
L..l..-L.J.---l..,.......L....~I
!
!
1.. _L_
.L_~L
_L .. -'.'---"---'• .1-
5
10
Frequency (kHz)
Figure 9.61: Passband response of the complete interpolation filter.
353

9
Example Modulator Systems
Saramaki I-~-l sinc27
Halfband
4
2
1861!l-order
FIR
Input
1
I
sample rate
relative to
input rate
Figure 9.62: Structure of the interpolation filter.
,,
=
350
300
100
50
150
200
250
Frequency (kHz)
Figure 9.63: Frequency response up to 8fS, in .
-100
-150o
-50
m
"0
--,--,----,---- ---,-------'--,
354

=
Audio DAe
9.6.3 DAC and Reconstruction Filter Design
Fig. 9.64 shows the structure of the DAC and reconstruction filter. The DAC has a
current~mode output, while the reconstruction filter is a continuous-time singJe-
amplifier biquad.
The transfer function of the filter circuit in Fig. 9.64 is
i,•••I,
1
where
and
rz;
Q = ~ZC;
R
C2
(9.36)
(9.37)
(9.38)
Current-
Mode
DAC
R
C2
Figure 9.64: DAC and reconstruction filter.
355

9
Example Modulator Systems
J
For a second-order Butterworth response, Q ;; 1/j2, which implies Ct ;; CZ'
Setting the cut-off frequency to 80 kHz yields the quantization noise density
shown in Fig. 9.65. Since the peak oUl-of~band quantization noise density is an
acceptable -90 dBFS/22 kHz, the cut-off frequency does not need to be lowered.
(The reconstruction filter would need a third-order transfer function to prevent a
rise in the out-of-band noise with frequency.) Also, since the attenuation at 20 kHz
is a mere 0.017 dB, while the group delay variation is less than 1% of a 44-kHz
sample period, the passband droop and the group delay error associated with the
reconstruction filter are sufficiently small for most audio applications.
-' t....•
The last step we will perform is component-value selection. If we assume that the
output swing is 0.7 Vp' then a full-scale sine wave has an rrns output of 0.5 V and
so
a
lID-dB
SNR
requires
a
noise
voltage
of
no
more
than
0.5.10-110/20 ;; 1.6 !JoY. Dividing this value by J20 kHz yields a required
noise density of 11 nVIJHZ. Allocating half of our noise budget to the reconstruc-
tion filter (so that the DAC may take the other halt) gives a specification of
8 nV/../lli. for the output-referred noise of the reconstruction filter.
. "
"
,
' ..'. , .','
-. -., .
••' •• ,
'.'.' 0 J J •
" . ".,
.J._ .
. •••. I.
_-c-,,-,-c~~_-J
10
2
10
3
10
4
Frequency (kHz)
.. ,...
,..........
'.
.0. Noise @ DAC Output:
..;(NBW -= 22 kHll.~ ...:.. ;
.,.
.0. 'Noise'@ R.F. Output~~~;.
.....:.•:.(NBW=22kHz}..:.. ;.:."., .. ,
-120 L-~_~__~
10'
s:
-20
CD
Z
-40
[2
CD
-60
"0
~o
-80
CD
"0 -100
Figure 9.65: Quantization noise density at the output of the
reconstruction filter.
356

Conclusions
Analysis of the circuit in Fig. 9.64 shows that, with an ideal op amp, the output-
referred noise density of the reconstruction filter is 4JkTR at low frequencies.
Equating
this
to
the
desired
noise
density
leads
to
R = I ill
and
C 1 = C2 =
1.4 nF. For a high-dynamic-range DAC such as that considered in
this example, the need for large capacitors in the reconstruction filter typically pre-
cludes a monolithic implementation.
Since the low-frequency gain of the filter is 2R
~ 2 VIrnA, the peak DAC current
for a 0.7-V peak output is 0.7/2 ~ 0.35 rnA. Hence, the differential DAC may be
constructed from 8 pairs ofcurrent sources, each providing 44 ).lA.
9.7 Conclusions
This chapter examined five ADC systems and one DAC system. The ADCs ranged
from a simple second-order, single-bit low-frequency switched-capacitor modula-
tor (MOD2) to a sixth-order~ multi-bit, mixed discrete-time/continuous-time band-
pass modulator. Example circuits were given for a number of important building
blocks, and sample calculations of block specifications were illustrated in the con-
text of each system.
9.7./ The ADC State-of-the-Art
We conclude our journey through the land of delta-sigma with a birds-eye view of
the ADC landscape, using the following figure-of-merit (FOM)
FOM ~ DRdB + 1OIog(Bp~
(9.39)
to compare the performance of various ADCs. This figure-of-merit is essentially
the same as that proposed in [17], namely FOM ~ (4kTxDRx2BW)IP, in
that a factor of 2 in power (P), a factor of 2 in bandwidth (BW) and a factor of 2
(3 dB) in dynamic range (DR) are all considered to be equivalent. Our FOM omits
an 8kT factor and uses a dB scale in order to facilitate calculations. Section 9.7.2
offers several theoretical arguments to justify the exponents associated with these
three performance metrics.
357

9 Example Modulator Systems
The example systems considered in this chapter span a 1000:1 range in DR, P and
BW. Table 9.12 summarizes the estimated specifications for these example sys-
tems. Despite the wide range in ADC bandwidth, performance and power con-
sumption, we see that the values of FOM achieved by these distinctly different
architectures are remarkably close, hovering around FOM = 160.
Similarly, Table 9.13 lists the perfonnance of ADCs which achieve the largest
FOM for a given bandwidth, while Fig. 9.66 plots the FOM versus bandwidth for
these and other ADCs reported in the open literature. Note that the first three
entries in Table 9.13 have about the same bandwidth and achieve almost the same
FOM value despite having dynamic ranges which span a 23-dB (200:1) range.
This fact lends credence to our claim that dynamic range and power can be traded
at the rate of I dB/dB. Table 9.13 shows that M: converters currently achieve the
best FOM value for bandwidths up to approximately 10 MHz. Beyond this value, it
becomes increasingly difficult to achieve a sufficiently high oversampling ratio and
so pipeline and folding ADCs dominate.
The latter observation is also apparent in Fig. 9.66. As this figure indicates, a FOM
"ceiling" ofabout 170 dB exists for bandwidths up to a few MHz; beyond this fre-
quency, the achievable FOM drops due to technological limitations and the need to
use architectures which are less efficient than
~:E modulation. As CMOS line-
Design
BW (kHz)
DR (dB)
P(mW)
FOM
MOD2 (SC)
1
100
0.05
173
MODS (SC)
20
110
200
160
2-0 Cascade (SC) [8J
1250
89
550
157
l-lpower (CT Active-RC)
10
80
0.1
160
15
105
160
Bandpass (CT LC)
50
333
90
158
Table 9.12. Performance estimates for our example ADCs.
358
ri!
I;;•i•·
==
-;
=
•

Conclusions
Architecture
BW
DR (dB)
P(mW)
FOM
61:: 5(4b) SC [18}
20 kHz
111
27.5
170
61:: 3(1b) SC [19)
20 kHz
88
0.14
170
61:: 2(1 b)-1 (1 b) SC (17)
25 kHz
99
2.5
169
61:: 2(5b)-2(3b)-1(3b) [101
2 MHz
95
150
166
61:: 5(1b) 9m-C (20)
3.8 MHz
78
9
164
61:: 3(6b) 9m-C (21)
12 MHz
79
75
161
Pipeline [221
80 MHz
66
290
150
Pipeline [23]
100 MHz
51
135
140
Folding [24)
300 MHz
45
200
137
Folding [25J
800 MHz
46
1270
134
Table 9.13. Published ADCs achieving the highest FOM at a given BW.
','"
..........
;-.: :-:.:::
180
170
160
-
aJ
150
~
:2
140
0LL
130
120
..:.. ~ .:" Architecture Fro'nt -:-: ::.::;....:..;.: ~: :i':: ...;. -:. ~ .:.:~:::.
~:"·,i.~"ti~jjr~[1~)i~~,#:-."':~~~~(·ro1~~>.,
~
:.:_:;;_~;
.... "
.
,,: :.:
y' :::: .. "':
""'.:.,.... '-cw·::::
.• "....
• ...... ~
b 0
....~
..
[201""~
...•,1> ..,...
.......
':
~.
::, :'.:.:
oQ ::.,:~
~: ::.J21),<::%~
: ::::;:
:·k:··:·:..:.:9 .. :. HH+"~ '.'+:~'~~~;~~~~I>
........... ......~ ......c>.9.9.~..GI... r......
........... :::: ..:.:::::: .. ~.:.:~::,~.~~~.+~~;~:.
.. ', .(-,.,....", ..;.; .:-:.;.:;;;.. ;.; .:. ;~'::'."
.:..:.:;; ;:.:;~- '. ';'o-:-:f2"3]- -'. ~,:.:J.'
. .. ....9 ..... .... g'" "..
[24)'''!'
'
,..
::::::::
"::':;,'::":--:9:,,:'::" :.¢.:
·•·.••.•·
·.:·.·,.·.·.,.E.5.
........
:-:';;:':i: ...:-.;.;;;;:.::
vv-;
:: .:::::
. : ''''''
-'-'-'-'''''- ~-:-: ,-,_.,
, ",,,..
. .... ".
Figure 9.66:
110 '-::--'--'-'--'=c-'-'---'--'=-::--'--"--'''-"-'"::--.'--'-.-,-"cc'cc'""::'~--'-'-'--'":--'---'-'-'-=
10'
104
10'
10·
107
10'
10'
BW (Hz)
FOM vs. baudwidth for published ADCs.
359

9 Example Modulator Systems
widths continue to shrink, the "technology front" should therefore shift to the
right. Achieving FOM values above 170 will require more efficient building blocks
and/or architectural innovations.
9.7.2 FOM Justification
To see why 3 dB in DR should be equivalent to a factor of 2 in power, consider
what happens when two identical ADCs are used to sample the same signal. Aver-
aging the ADCs' outputs reduces the system noise by 3 dB, but to achieve this
improvement we had to double the number of ADCs and hence double the power
consumption. Similarly, if we take an ADC and "cut it in half' (so that the original
ADC can be considered to be composed oftwo half-power ADCs operating in ~ar­
allel), we can cut the power consumption by a factor of2 and lose 3 dB in DR.
The fact that this trade-off is (in principle) bidirectional implies that no better
trade-off can exist for power-optimal ADCs. To see this, assume that a certain
ADC (ADCl) is purported to be optimal in the sense that no other ADC consumes
the same power P, achieves the same bandwidth BW and has higher dynamic range
DR. Now assume that the structure of ADCI is such that it offers a more favorable
trade-off of(say) 6 dB in SNR for each doubling in P. Apply this trade-off to yield
ADC2 which achieves DR + 6 dB with power 2P. If we "cut ADC2 in half' to
yield ADC3, then ADC3 will, according to the preceding discussion, achieve
DR + 3 dB with power P, which is superior to ADC I. Consequently, ADC1 cannot
be power-optimal.
Given any ADC, we can (in principle) construct other ADCs possessing the same
BW and the same DRIP ratio.t Alternatively, if two ADCs have the same BW, the
one which has the larger DRIP ratio is superior since it can be used to construct an
ADC which consumes the same power as the other ADe but at the same time
achieves greater DR.
t. Admittedly, halving an ADC cannot be repeated many times before second-order effects such as
peripheral capacitance and lithographic limits become significant. When such second-order
effects are significant, a 3-dB reduction in SNR witl not be accompanied by a full factor-of-2
reduction in power consumption.
:t. Here DR is a power ratio, on a linear scale.
360
•

=
i••
,
,
I
Conclusions
As further justification for why 3 dB in DR is equivalent to a factor of 2 in power,
consider cooling an ADC from a temperature T to a temperature T/2. Since the
power of all thermal noise sources is proportional T, cooling the ADC in this way
will reduce all noise sources by a factor of 2, or 3 dB. However, the second law of
thermodynamics tells us that in order to transport a power P from a heat sink at
temperature T/2 to a heat sink at a temperature T requires the expenditure of at
least a power P, i.e. we would need to supply P to the circuit and P to the refngera-
tion unit, for a total power consumption of 2P .
Having established that 3 dB in DR is equivalent to a factor of 2 in power, let's
consider BW. We can reduce the bandwidth of an ADC simply by applying linear
filtering. Assuming that the ADC's noise is white, reducing the bandwidth by a
factor of 2 increases the dynamic range by 3 dB. If we assume that such filtering
can be done with negligible power, we can therefore trade bandwidth for dynamic
range at constant power at the rate of +3 dB per octave reduction. The reverse
trade-off is somewhat more tenuous, but in principle we can time-interleave two
ADCs and thereby achieve twice the bandwidth at double the power. (Similarly,
complex signal processing yields a 2x increase in bandwidth while requiring a 2x
increase in power.) Applying the previously-established link between power and
dynamic range leads to a bidirectional bandwidth/dynamic range trade-off of 3 dB
per octave. Once again, since this trade-off is bidirectional, no better trade-off can
exist.
The above arguments support our choice for an ADC figure-of-merit, but this fig-
ure-of-merit does not capture such important practical considerations as silicon
area, manufacturability, or ease of use. For example, switched-capacitor modula-
tors (especially those with large sampling capacitors) are notoriously hard to drive,
and as much power may be needed for the driver as for the ADC itself. Also, since
switched-capacitor ADCs require anti-alias filtering, whereas continuous-time
modulators do not, a continuous-time ADC may simplify the architecture of the
system in which it is embedded. Despite these shortcomings, the FOM described
here can be used to classify instantly a given set of ADC specifications as easy
(POM < 155), hard (FOM ~ 160), very hard (FOM ~ 165) or beyond Ihe slale-
of-the-art (FOM > 170).
-----------------~-----
361

9 Example Modulator Systems
References
[lJ
Y. Yang, A. Chokhawala, M. Alexander, J. Melanson, and D. Hester, "A 114 dB 68 mW
chopper-stabilized stereo multi-bit audio AiD converter," ISSCC Digest a/Technical Papers,
pp. 64-65, Feb. 2003.
[2]
B. E. Boser and B. A. Wooley. "The design of sigma-delta modulation analog-to-digital
converlers," IEEE Journal ofSolid-Slate CEr('l/its. vol. 23, pp. 1298-1308, December 1988.
[3)
B. P. Brandt, D. E. Wingard and B. A. Wooley, "Second-order sigma-delta modulation for
digital-audio signal acquisition," IfEE Journal ofSolid-State Circuits. vol. 26, pp. 618-627,
April 1991.
[4J
D. R. Weiland, B. P. Del Signore, E J. Swanson, T. Tanaka, K. Hamashita, S. Hara, and K.
Takasuka, "Stereo 16-bit delta-sigma ND converter for digital audio," Journal ofthe Audio
Engineering Society, vol. 37, pp. 476-486, June 1989.
[51
B. P. Del Signore, D. A. Kerth, N S. Sacch.. and E. J. Swanson, "A monolithic 20b delta-
sigma converter," IEEE loumal of Solid-State CirCllits. vol. 25, pp. 1311-1317, December
1990.
{6]
P. F. Ferguson Jr.. A. Ganesan, R. W. Adams, S. Vincelette, R. Libert, A. Volpe, D. Andreas,
A. Charpentier and J. Dattorro. "An 18b 20kHz dual sigma-delta AiD converter," ISSCC
Digest of Techntcal Papers, vol. 34, February 1991.
[7]
R. W. Adams, P. F. Ferguson, A. Ganesan, S. Vincelette, A. Volpe and R. Libert, "Theory
and practical implementation of a fifth-order sigma-della AID converter," Joumal of the
Audio Engineering Society, vol. 39, pp. 515-528, July 1991.
[8J
T. L. Brooks, D. H. Robertson, D. F. Kelly. A Del Muro and S. W. Harston, "A cascaded
sigma-delta pipeline AID convelter with 1.25 MHz signal bandwidth and 89 dB SNR," IEEE
JounUlI ofSolid-State Circuits, voL 32, no 12, pp. 1896-1906, December 1997.
[9J
I. Fujimori, L. Longo, A. Hairapetian, K. Selyama, S. Kosic, C. Jun and S. L. Chan, "A 90-
dB SNR 2.5 MHz output-rate ADC usmg cascaded multIbit delta-Sigma modulation al 8x
oversampling ratIo," IEEE JUI/mal of Solid-State Clrcllits, voL 35, no. 12, pp.1820-1828,
December 2000.
[IOJ
K. Vleugels, S. Rahli, and B. A. Wooley, '·A 2.5-V sigma-delta modulator for broadband
communicatiOns applications," lEE£ Journal of Solid-State Circlllls, vol. 36, no
12.
pp. 1887-1899, Dec. 2001.
[11]
Y. Geerls, M. Steyaert and W. Sansen, Design of multi-bit delta-SIgma AID COIll'erters,
Kluwer academic publishers, BaSion, Massachusetts, 2002.
[12]
Y. Geerts, M. Steyaert and W. Sansen, "A high-performance multi-bit CMOS Il~ converter,"
IEE£ Journal ofSolid-State OrClllts. voL 35, no. 12. pp. 1829-1840, Dec. 2000.
[13J
E. van der Zwan, E. Dijkmans and J. Huijsing, "A 0.2 mW ~Il modulator for speech coding
with 80 dB dynamic range," IEEE Joumal ofSolid-State Circuits, vol. 31, no. 12, pp. 1873-
1880, Dec. 1996.
[14]
R. H. M van Veldhoven, B. J. Mmms, H. A. Hegt and A. H. M. van Roermund, "A 3.3-mW
~Il modulator for UMTS in O.ll1m CMOS WIth 70-dB dynamIC range in 2-MHz bandwidth,"
IEEE JOl/mal ofSolid-Slate Circuits, vol. 37, no. 12. pp. 1645-1652, Dec. 2002.
[15J
R. Schreier, J. Lloyd, L. Singer, D. Paterson_ M. Timko, M. Hensley, G. Patterson, K. Behel.
J. Zhou and W. J, Martin, "A 10-300 MHz IF-digillzing IC with 90-105 dB dynamiC range
and 15-333 kHz bandwidth," IEEE Journal ofSolid-State Circuits, voL 37, no. 12, pp. 1636·
1644, Dec. 2002.
i
----------_._----
362
---------

i T
[16]
[17]
[18]
[19]
j
[20]
1I
[21]
1
[22]
[23]
[24]
[25J
References
T. Saramaki. "Design of FIR filters as a tapped cascaded interconnection of identical
subfilters," IEEE Transactions 011 CirCUIts and Systems, vol. 34, no. 9, pp. 1011·1029, Sept
1987.
S. Rabii, and B. A. Wooley, "A L8-V digital-audio sigma-delta modulator in O.81lffi
CMOS," IEEE Journal afSolid-State Circuits, voL 32, no. 6, pp. 783-796. June 1997.
Y. Yang, A. Chokhawala, M. Alexander, J. Melanson. and D, Hester, "A 114 dB 68 mW
chopper-stabilized stereo multi-bit audio AiD converter," ISSCC Digest afTechnical Papers,
pp. 64-65, Feb. 2003.
L. Yao, M. Steyaert and W. Sansen, "IV 88dB 20kHz :Eb. modulator in 90nm CMOS,"
ISSCC DIgest afTec/mical Papers, pp. 80-81, February 2004.
R. H. M van Vc1dhoven, "A lri-mode continuous-time ~L\ modulator with switched-capacitor
feedback DAC for a GSMEDGFJCDMA2000/UMTS receiver:' ISSCC Digest of Technical
Papers, pp. 60-61, Feb. 2003.
M. Mayal, M. Groepl, H. Werker, G. Mitteregger and J. Schambacher, "A 700/900mWI
channel CMOS dual analog front-end IC for VDSL with integrated 11.51l4.5dBm line
drivers," lSSCC Digest afTechnical Papers, pp. 416-417, Feb. 2003.
B. Murmann and B. Boser, "A 12b 75MS/s pipelined ADC using open-loop residue
amplification, " ISSCC Digest ofTecllllical Papers, pp. 328-329, Feb. 2003.
B. Hernes, A. Briskemyr, T. N. Andersen, F. Telst~. T. E. Bonnerud and 0. Moldsvor, "A
1.2V nOMS/s lOb pipeline ADC implemented in O.131lm Digital CMOS," ISSCC Digest of
Technical Papers, pp. 256-257, Feb. 2004.
G. Geelen and E. Paulus, "An 8b 600MS/s 200mW CMOS folding AID converter using an
amplifier preset techOlque," ISSCC Digest ofTeclmical Papers, pp. 254-255. Feb. 2004.
R. Taft, C. Menkus, M. R. Tursi, 0- Hidn, V. Pons, "A 1.8V 1.605/s 8b self-calibrating
folding ADC with 7 26 ENOB at Nyquist frequency," ISSCC Digest of Technical Papers,
pp 252-253, Feb. 2004.
J ,
--~_..------
363

364
9
Example Modulator Systems

=
=
APPENDIX A
Spectral Estimation
1
j,
The purpose of this appendix is to demystify the procedure of analyzing ~ data
using the Fast Fourier Transform (FFT) [1 J. The FFT is widely used to estimate the
power spectral density of t:U: data, but is also sometimes abused in the process.
When using the FFT to analyze .6.:E data, the .iL designer needs to be familiar with
several important concepts, namely windowing, scaling, noise bandwidth and
averaging. This appendix deals with each of these subjects in tum, applies them to
an example, and concludes with a brief discussion of the mathematical back-
ground.
The FFT is a fast algorithm for computing the Fourier Transform
N -I
X(f)
~ It x(n)· e-j2x/n
n=O
(A. I)
ofa length-Ndiscrete-time sequence x(n) at the N frequency points, the FFT bins,
f
~ 0, liN, 21N, ... , (N -1)IN. t
t. Here, as earlier, the sampling rate is assumed to be I Hz.
365

APPENDIX A
Spectrlll Estimation
A discrete-time signal with period N consists of a dc term and hannonics of the
fundamental frequency 11 ~ 11N. Since the amplitude of the
jth harmonic
Ii = i/N for i" 0 is given by 2!X(fill / N , an FFT can easily be used to com-
pute the power spectrum of a periodic signal. Unfortunately, since ill: data is typi-
cally not periodic, a direct application of the FFT to ill: data is unwise at best.
We shall consider the "noise" associated with dI: data to be like a random signal,
for which a more technical term is stochastic process [2]. If the data comes from
measurements, then it is bound to contain components which are true noise and
our viewpoint is justified. For data obtained from simulation, the noise is the result
ofa deterministic process, and so it is not strictly proper to describe this process as
random. However, since the process is complex, non-linear and often chaotic, the
fact that the process is actually deterministic has little practical impact.
A.I Windowing
Windowing is the act of multiplying the signal to be analyzed by a window func-
tion w(n) before subjecting it to an FFT. At first glance, it would appear that this
operation would alter the spectral content of the signal and therefore be undesir-
able. Although it is true that windowing alters a signal's spectrum, some window-
ing is inevitable because we can never obtain an infinite-length record of
modulator data. The best we can do is operate on a finite record of length N. Since
a finite-length record can be thought ofas the product ofthe infinite-duration mod~
ulator output and a rectangular window
w
(nl =
{
I, O$n$N-l
reet
.
0,
otherwIse
(A.I)
the damage caused by windowing the data has already been done. Thus the ques-
tion is not "Should I window my data?" but rather "How should I window my
data?"
366
•

Windowing
The answer to this question lies in the relationship between the spectrum of the
original data and that of the windowed data. Since multiplication In the time
domain corresponds to convolution in the frequency domain, the spectrum of a
windowed signal is, loosely speaking, the spectrum of the unwindowed signal con-
volved with the window's spectrum. In order to obtain an accurate spectrum, the
designer must choose a window which introduces sufficiently low errors through
spectral convolution.
Consider the three windowing functions illustrated in Fig. A.I. Table 1 lists their
definitions, and summarizes various parameters which will be discussed in this
Appendix. Since a
rectan~ular window has discontinuities at its endpoints,
whereas the Hann and Hann
windows are continuous (up to the 2nd and 4th deriv-
atives, respectively), we would expect the rectangular window to have a great deal
more high~frequency content than the other two windows. This suspicion in con-
firmed in Fig. A.2, which plots the magnitudes of the Fourier transform
wen)
1
0.5
N -I
W(n = L w(n)· e l2'!",
II = 0
1
!
!
!
:
!
!
!
!
!
!
!~·"'rr!
i
:
!
!
:
!
l
!
!
!
!
-:Rectangular .. -<··:·;·-;·-:··;··:--:··:··:-·:··1-;··;··;· .. ····
'. :--:.. ; ..;. '.
,
~$.~ ..tt'-=-e e-.~.~~.'"
... ~-t-~~~~-+-+*,~·~
Figure A.I: Three common windows (N::: 32).
(A.2)
._--._---- -----
367

0.5
APPENDIX A Spectral EstimatIon
normalized by the de gain W(O) , for each of these windows. N = 32 points were
used. As Fig. A.2 shows, the peaks of the high-frequency lobes in the spectrum of
the rectangular window approach a constant value (which is proportional to 1/N),
whereas the peaks of the high-frequency lobes of the Hann and Hann2 windows go
to zero with -60 dB/decade and -100 dB/decade slopes, respectively. The high-
Window
Rectangular
Hann
Hann1
w(n),n '" 0, I,
I _ cos 21t1l
(
'"" 2
...,N-I
1-,:, ~]
I
N
(w(n) '" 0 otherwIse)
2
IIwlli
N
3N/8
35N/128
No of non-zero FFT bins
I
3
5
W(O)
N
NI2
3N/8
NBW
liN
1.51N
35/(18N)
Table A.I: Properties of the three windows illustrated in Fig. A.I.
W(f)
0
_ '~.
W(O) -10\ -';';..::.:::...
-20
.. ~:.'.. ',1''''
:',
.. '. Rebtang'ular
,
.
(dB)
.. "
~
~
• \
"
"'c'"",'"
.
-30
.,.
t
~.:
"
...
\~ ..
\
.. ,,,~
-."
••• <_.,:-
;
: ,.:-.,
':'4 ..
~
-~_._"'-
'1--
'I
x:··\"---V.··-\,···,,···,.·.. ··,···
-40
: ),':
..
~.·r::r::~: ::~: .. ~.::,:.::~:_:.-::.::~~ .. :\\':::~:::~::
-50
::~:.,
.
~
S ...~.~:: ~::~:·~:·:~·::t:::,:::~
-60
.~
,.
\., '\H
nY
" ... , ...., ... ~ ......
-70
.. ~
..,.. :n y::~ .. :~~.::~:t::~
.. ~
'0\'
.""
"lJi'"
-80
:::,:'
('.,. t·":
:Hann2
'
~ .. "
:l\ -
-90
.,.
...
.• ,••.(....
,.
-100
- J:
'J ','\'
o
0.125
0.25
0.375
Normalized Frequency, f
Figure A.2: Frequency responses of the windows shown in Fig. A.t.
368
••ij

Windowing
-"!!
.~
i
1I•::
i
i
iI
Ii
frequency behavior of a window's spectrum is of critical importance in detennin-
iog the magnitude of the error resulting from convolution.
As a demonstration of the convolution problem, Fig. A3 shows the spectrum of
some noise-shaped data, the Fourier transfonn of a 256-point rectangular window
and the Fourier transfonn of the windowed data. As indicated in Fig. A.3, the
skirts of the window convolve with the out-of-band noise, thereby filling in the
noise notch and dramatically reducing the apparent SNR.
The 6.L designer must ensure that this noise leakage is small compared to the
actual in-band quantization noise density. In the context of a high-accuracy A};
modulator, the difference between the out-of-band noise density and the in-band
noise density can be 80 dB or more. Fig. A.3 indicates that with N = 256, the
observable difference between the out-of-band and in-band noise densities is only
about 23 dB. Increasing N improves the situation, but only at the rate of 3 dB per
octave. According to this trend, a rectangular window would need to use more than
108 points to reliably observe an 80 dB difference in noise densities!
40 r--~r---.--.-,-
20·····
.....
~.
.
~
.
illrllr~lrNI'I"IIII'I'~I'I'I'III'I?IVI'U""'i'\I'9,vj!)J.I.~~iil~i"~,!I,,ju'~';"'I;;';';1
iiI! n
IiIn -- - Actual ~~ spectrum
.
.
-
W(f)/lIwI2
-- Windowed spectrum
~':..
0.5
-60OLL---'------------l ·----'---O.~·5
Normalized Frequency. f
Figure A.3: A rectangular window obscures a noise null.
-40
-20
m
"C
o
-_._--_
_.
369

APPENDIX A
Spectral Estimation
'"I
Another important consideration in the analysis of M: data is signa/leakage. It is
convenient, both in the lab and in simulation, to use sine-wave excitation. How-
ever, the frequency ofthat sine wave must be located precisely in an FFT bin, oth-
erwise signal power will bleed into all bins. Fig. A.4 illustrates this phenomenon
with severallength-512 FFTs oftwo sine waves. The first has a frequency which is
The lU: designer is therefore compelled to use something other than a simple rect-
angular window. Many different windows exist (for example, see [3] or [4]) but the
feature of greatest importance to the M: designer is the amount of high-frequency
attenuation provided by the window. Windows which have finite high-frequency
attenuation, such as the Hamming window, are less desirable than windows whose
high-frequency attenuation increases without bound. In particular, a Hann window
with N = 512 is able to resolve an 80 dB difference in noise density, while a
Hann2 window does similarly well with N
= 256. Since the number of data
points needed to provide sufficient frequency resolution is usually on the order of
several thousands, a simple HaIUl window usually provides sufficient protection
against noise leakage.
20
0
~
m -20
:3-
f--
-40
u.u.
-60
-80
"; frequency··-
, =73/512
,<0/..
.: frequency
.. = 217
~.
"".. " -
Rectangular
.... --Hann
•__ • Hann2
II; I
I
I
!II
I,•
II j
I I
II
iIIIIi
I IIi
is-
I•
i
•
Figure A.4: FFTs of coherent and incoherent sine waves (N = 512).
370
Ii

"••
Windowing
located precisely in an FFf bin (specifically, bin 73, which is close to a frequency
of 1/7), while the secood has a frequency of exactly 2/7 and so is not in an FFf
bin. In the first case (the coherent case), the sine wave's power is concentrated in a
small number of FFf bins (l for a rectangular windowing, 3 for Hann, and 5 for
Hann2). In the incoherent case. the sine wave's power is smeared over all FFT bins.
The severity of the spreading is determined by how far away the sine wave is from
the nearest bin frequency, and by the shape of window's skirts. As was the case
with noise leakage, the rectangular window exhibits the greatest signal leakage
because its skirts are the most broad.
In simulation, it is a simple matter to place the signal frequency in an FFT bin and
thereby eliminate signal leakage entirely. In the lab, signal leakage can be mini-
mized by phase-locking the generators, and by setting the signal frequency accu-
rately. If it is not possible to place the signal frequency in an FFT bin, windowing
can be used to reduce spectral pollution. Alternatively, the signal's frequency and
amplitude can be estimated, and the estimated signal can be subtracted from the
data record to leave only the noise.
The final question regarding windowing which we will address is the length of the
window required to obtain an accurate estimate of a modulator's SNR. The sim-
plest way to estimate SNR is to compute the ratio of the power in the signal bins to
the power in the in-band noise bins. Since the signal is usually placed in-band, it
therefore occupies a few of the in-band bins. The number of bins occupied by the
signal should be a relatively small fraction (less than 20%) of the in-band bins in
order to have a small effect (less than 1 dB) on the SNR estimate. If we are using a
Hann window, the signal will occupy 3 bins and thus we should have at least 15 in-
band bins, which in tum requires N:?: (30 . OSR) bins in all, where OSR is the
oversampling ratio.
If the noise is assumed to be flat in-band, the missing noise power can be
accounted for by multiplying the power in the noise bins by 1/( I - a), where a is
the fraction of in-band bins occupied by the signal. Unfortunately, at least in simu-
lation, the in-band quantization noise follows the NTF and so tends to be non-flat.
Alternatively, the noise in the signal bins can be estimated by subtracting out the
estimated signal component before or after performing the FFT.
371

APPENDIX A
Spectral Estimation
Another consideration regarding the required length of the data record relates to
the repeatability of the SNR measurement. Since the FFT of a random signal is
itself a random quantity, the in-band noise power computed from the FFT is also a
random quantity. Numerical experiments indicate that using N = 30· OSR
results in SNR estimates which have a standard deviation of about 1.4 dB. Using
N = 64· OSR
results
in
a
standard
deviation
of
about
1.0 dB,
while
N = 256· OSR is needed to reduce the standard deviation to 0.5 dB. This degree
of repeatability is usually not required on an individual measurement, since it is
common for many measurements to be carried out, as would be the case during an
input amplitude sweep. The authors recommend using N = 64 . OSR.
A tertiary consideration regarding the required length of the data record relates to
the observable spurious-free dynamic range (SFDR). Using N = 64 . OSR is usu-
ally sufficient to reliably observe an SFDR which is about 10 dB greater than the
SNR. In order to detect tones which are more than 10 dB below the total in-band
noise, N needs to be increased. Specifically, doubling N increases the observable
SFDR by 3 dB.
A.2 Scaling and Noise Bandwidth
The astute reader may have already observed that the spectral spike associated
with a sine-wave component in the data record has a height (as in Fig. A.4) that is
dependent on both the window type and the window length. Most windows have
maxIW(f)1 = W(O) (i.e. the peak in the window's spectrum occurs at dc), and so
the height of the peak corresponding to a sine wave is A· W(0)/2, where A is the
amplitude of the sine wave.
When displaying a spectral plot, it is customary to scale the FFf such that a fu11-
scale sine wave yields a O-dB spectral peak. If we denote the full-scale range by
FS, the amplitude of a full-scale sine wave is A = FS/2 and thus the scaled ver-
sion of the FFf which we would present is
372

Scaling and Noise Bandwidth
I
•I
N -1
2
L w(n)' x(n) . e-j2n!n
=
n =0
(FS/4)W(O)
(A.3)
1I
i
'-1
Note that we have squared the magnitude in order to allow us to interpret Sx'(f) as
a power spectral density (PSD). The power of a sine-wave signal relative to the
power of a full-scale sine-wave signal is therefore given by 1OIogSx'(j), where!
is the frequency of the signal. The units of this quantity are often given as dBFS
(dB relative to full-scale) in order to emphasize that the reference power is the
power of a full-scale sine wave, but we shall see shortly that these units omit an
important detail. The caret on the symbol Sx'(f) indicates that the above expres-
sion is an estimate of the PSD, while the prime indicates that we have scaled the
estimate so that sine-wave signals yield calibrated spike heights.
Although the above scaling is convenient for analyzing a signal which consists of
sine waves, it is less convenient for analyzing a signal which contains noise.
Fig. A.5 illustrates the problem by plotting Sx'(f) for a signal consisting of a
odBFS sine wave plus white noise having the same power as the sine wave, when
different.length rectangular windows are used. (A rectangular window is safe here,
since we are not interested in observing notches in Sx'(f).) Although the signal
spike has the same height in each case, the average "noise floor" of Sx'(f) drops
by 3 dB every time N doubles. Since the noise power is actually 0 dBFS in each
case, the location of the "noise floor" is not the only piece of information that the
reader needs.
The problem with sine·wave scaling is that the noise power is, on average, evenly
distributed over all FFf bins, whereas the sine-wave power is concentrated in only
a few bins. With sine-wave scaling, the power of individual sine·wave components
can be read directly from the spectral plot, but in order to determine the noise
power, the powers of all the noise bins must be added together.
373

APPENDIX A Spectral EstimatIon
An alternative method of scaling, which is common in signal-processing texts, is to
scale the FFf such that it provides a calibrated noise density. The appropriate scale
factor in this case is 1/llwll~ , where
N -1
Ilwll~ = L Iw(n)12
n=O
is the energy of the window.t When this scaling is used, the PSD estimate is
o
..... 0 ClBFS sine wave ........
(AA)
r•!i
f10
I\-N=26~·~OdBF~nOise
P
J.
-
-20 F"'-'---,,-;,;--e;;---.-=-",-,,-,,,,:,v""'JI"'-;.c--c.- N= 26 c.--:c.-~0:.u-""'''"'-;;;:.:-'''';v;;j
~
- ------.-
--_·--~j"~·210
_,+<""'
~
~~
.J •.•••.•••••
~_....__...._
....ol··..·_N ~212..·....-....,.--ooioo--I
-40 L-_--'-__-'--_-'-__..l..-_-'__--"--__"-_...J
o
0.25
0_5
Normalized Frequency, f
Figure A.S: FFTs of a sine wave plus white noise; sine-wave scaling.
t. The notation IIwl1 2 means 2-norm, a special case of the p-norm Ilwlll' '" C~: Iw<nllp) III'.
374
•

SCaling and Noise Bandwidth
N -I
2
L w(n)· x(n) . e-j2<jn
n=:Q
Ilwlli
(A.S)
•
·•i
and as a result unit-power white noise yields a unit (O-dB) density, regardless of
the window type or length. Unfortunately, scaling for noise in this way makes the
height of a sine-wave spike dependent on both the window type and length.
OUf resolution of the scaling dilemma follows the solution adopted in laboratory
instruments, specifically in spectrum analyzers. A spectrum analyzer must contend
with the problem of representing the spectrum of a periodic signal such as a sine
wave on the same display as is used to represent the spectral density of a broad-
band signal such as noise. In a spectrum analyzer, the signal can be thought of as
being processed by a bank of filters possessing identical filtering characteristics
(gain, bandwidth, etc.), albeit with different center frequencies. The instrument
measures the powers at the outputs of the filters and constructs a plot of power ver-
sus center frequency.
For a sine~wave input, the display shows a peak at the input frequency, the height
of which equals the input power. Thus, the spectrum displayed by a spectrum ana-
lyzer is like an FFf with sine-wave scaling. For noise, the display indicates the
power of the noise that lies in each filter's bandwidth. In other words, for a noise-
like signal, the display gives the product of the noise density and the noise band-
width of the filters.
For a filter with infinitely steep roll-off, the noise bandwidth (NBW) is equal to the
filter's bandwidth, while for a filter with a single-pole roll-off, NBW is n/2 times
the 3-dB bandwidth. In general, a filter's NBW is the bandwidth of an ideal brick-
wall filter which has the same output power given a white noise input and which
has the same mid·band gain as the filter under consideration. A spectrum analyzer
solves the scaling problem by providing NBW along with each spectrum, thereby
providing the designer with the infonnation needed to convert the power shown on
the display into a power density. NBW depends on various analyzer settings,
375

APPENDIX A
Spectral Estimation
including those that detennine the frequency range and resolution for the spectral
plot.
The solution to the scaling problem in the case of a PSD obtained from a sine-wave
scaled WI is similarly simple. All we need do is provide the value of NBW.
The value of NBW is listed in Table 1 for the three windows considered in this
appendix. For each window, NBW is inversely proportional to N, and thus doubling
N decreases the apparent level of the noise in a sine-wave scaled PSD by 3 dB, as
indicated in Fig. AS Let us now illustrate the use of NBW in the calculation of the
total noise power. From the top curve in Fig. A.5, we observe a "noise floor" of
approximately
-15 dBFS,
which
is
the
amount
of
power
in
bandwidth
NBW = liN = 2-6. The total power in the entire Nyquist band [O,O.5J is
therefore 0.5/NBW = 25 times (15 dB more than) the observed -15-dBFS value,
or 0 dBFS, which is exactly the correct value.
The NBW, or at least sufficient infonnation for calculating it (namely N and the
window type), should always be given for a sine-wave-scaled WI. Furthennore, in
order to emphasize that such an FFf represents a power spectral density, the units
on the vertical axis should be shown as power per unit bandwidth. Since we report
power in dBFS and since the unit of bandwidth is NBW, the vertical axis is usually
labelled "dBFSINBW."j
A.3 Averaging
Our final point of discussion regarding the use of FFTs for spectral analysis is
averaging. We noted earlier that the FFf of a random wavefonn is itself a random
quantity. This quantity is random in both magnitude and phase, but since we are
t. Although in common usage, units such as dBFS/NBW or dBm/Hz are deceptive: a density of
1 dBm/Hz does yield 1 dBm of power in a I-Hz bandwidth but not 2 dBm of power in a 2-Hz
bandwidth! Doubling the bandwidth doubles the power (a 3-dB increase), yielding a 4 dBm
power in a 2-Hz bandwidth. The way out of this notational morass is to interpret "dBm/Hz" to
mean "dB with respect to a 1 mW per Hz density." Similarly, "dBFS/NBW" means "dB with
respect to a density equivalent to the power of a full-scale sine wave spread over a bandwidth
NBW."
376
=
=
~
~
~ £
-I
..
~
"1 1=-
= -
ii
;;;;
i
-
~
"=-
;;
~

Averaging
concerned with power we will only consider the magnitude. The magnitude of a
particular frequency bin in an FFT of a random signal is a random value that has
both a mean and a standard deviation. It turns out that the expected valuet of the
FFf magnitude equals the actual PSD (convolved with the window), as we would
hope, but that the standard deviation of the magnitude is large. In fact the standard
deviation is equal to the expected value!
The upshot of this property is that a single FFf results in a "noisy" spectral esti-
mate, as demonstrated in Fig. A.6, where three length-64 FFTs of O-dBFS white
noise are shown. Each curve is expected to be a flat line at -15 dBFS, but this is not
apparent in the Figure due to the large degree of variability in the individual bin
magnitudes.
o
0.5
0.25
Normalized Frequency, f
Three length.64 FFTs of O·dBFS white noise.
FigureA.6:
NBW =1/64
-40 '-_~'-~-'-'__-L__--'.__-'-__--L__.i
-
o
1
t. Expected value is another term for mean, or average, value.
377

APPENDIX A Spectral EstImation
If one is computing a noise power (by summing the powers over a range of FFf
bins), the variability of an individual bin magnitude is not problematic, provided a
sufficient number of bins are used. However, if one is trying to construct a clear
graph of a spectral density, the erratic nature of the bin magnitudes results in a
fuzzy plot such as that shown in Fig. A.7. Here, instead of a smooth curve, we see
a broad black band spanning nearly 20 dB which obscures the true noise density.
There are two solutions to this problem, namely averaging and integration. Averag-
ing can be performed by either averaging many FFfs, or by averaging nearby bins
in a single FFf.
Averaging multiple FFTs requires the use of multiple data records. When a single
large data record is available, it can be partitioned into many (possibly overlap·
ping) records which are individually windowed and transformed with an FFf.
Averaging the squared magnitudes of these FFfs reduces the standard deviation
and so improves the legibility of the spectral plot. (At this point, we owe the reader
a confession: the spectra shown in Figs. A.3 and A.5 were averaged in this way for
the sake of clarity.) Similarly, averaging the powers in adjacent bins will also
If
•;;
0
~
-20
'"
Zen
-40
u.
'"
~
-60
;;
-80
,
,""
-100
-120 L-L--'--_--'__-'-_---'-__L---_-'--_--"_----J
o
0.25
0.5
Normalized Frequency, f
Figure A,7: A length-214 FFT without averaging.
378

A.n Example
smooth the FFf, effectively by "filtering" it. We present an example of this form of
averaging in the next section.
The second method for increasing the legibility of a spectrum is to plot its accumu-
lated value, scaled by I /(N . NBW). The resulting plot shows the amount of
power contained in the band from dc up to the current frequency, and so saves the
reader the effort of performing an integration to obtain a noise power. Of course,
the designer is obliged to empty the signal bins before performing the integration.
and the method must be changed when dealing with bandpass noise-shaping.
Fig. A.8 illustrates the effectiveness of the technique in smoothing out the FFf of
Fig. A.7. (Some might argue that the technique is too effective, since it hides high-
frequency tones that are readily apparent in the original FFf.)
A.4 An Example
We have now covered the essential topics regarding the use of the FFf to calculate
a sine-wave scaled PSD, and so are ready to demonstrate them with an example.
Fig. A.9 shows some example MATLAB code for producing a record of ~ data
and analyzing it according to the above procedures.
.
.
-- -- --
.
.
.
. . . . . . . . . . - - . . . . . . ;
... -- -- -'.
O~=l:=I=====E....::::E,..===f~
-20
-40
-60
-60'---'----"---.L...---'-------'---'----'---·-"
o
0.25
0.5
Normalized Frequency, f
Figure A.8: Integrated version of the noise spectrum in Fig. A.7.
379

APPENDIX A
Spectral Estimation
The first block of code synthesizes a 5th-order NTF, creates the binary LU: data,
estimates the quantizer gain and computes the actual NTF (see Eq. (4.17) on
page 100). The second block of code computes the scaled and windowed FFf, as
well as NBW. The last two code blocks compute the SNR and create the plots
shown in Fig. A.lO.
The NTF is 5th-order, with zeros optimized for an oversampling ratio OSR = 32.
The number of FFf points is set to N = 64 . OSR = 2048, as advocated in
Section A.I. Note that the half-scale input signal is placed precisely in an FFf bin
(specifically, bin II). Many practitioners use an odd FFf bin to ensure that the
input data contains no repeated segments, but this is not strictly necessary. In a
% Compute modulator output and actual NTF
OSR = 32;
ntfO = synthes~zeNTF(5,OSR,I);
N = 64*OSR;
fbin
= 11;
u
~
If2*sin(2*p~*fbinfN*[0;N-l]);
[v tmpl tmp2 y)
~
s~mulateDSM(u,ntfO)1
k
~
mean(abs(y)/mean(y.~2))
ntf
~ ntfO
I
(k
-I-
(l-k) *ntfO);
% Compute windowed FFT and NEW
w
~ hann(N);
% or onesll,N) or
hann(Nl.~2
nb
~ 3;
% 1 for Rect;
5 for
Hann~2
wI
~ norm(w,I);
w2
~ norm(w,2);
NEW '"
(w2fwl)~2
V'" fftlw.·v)f(wlf2);
% Compute SNR
signal_bins = fbln + [-(nb-ll/2:(nb-l)f2];
lnband_blns'" 0,Nf(2*OSRI 1
nOlse_b~ns = setd~ff(inband_blns,signal_b~ns);
snr = dbp(
surnlabs(V(s~gnal_bins+l)l .~2)
I
surn(abs(V(noise_bins-l-l))
.~2)
% Make plots
figure(ll; elf;
semilogx ( [l :N/2] IN, dbv(V(2 ;Nf2+!) ) , 'b' , 'Llnewldth' ,1) ;
hold on;
[f p]
~ logsmooth(V,fbin,2,nb);
plot (f, p, 'm' , 'Linewidth' , 1. 5)
Sq"
413
• evaITF(ntf,exp(21*pl'f)) ,'2;
plot If, dbp (Sq' NEW) , 'k--' , 'Llnewldth' ,1 l
figureMaglc([lfN O,5),[],[],
(-1400],10,2);
Figure A.9: Example MATLAB code for performiug spectral analysis.
380
J,
=

An Example
Nyquist converter, it is wise to use an input which contains no repeated segments
in order to exercise as many codes as possible, but in a AI. converter the internal
state of the converter typical ly ensures that the output data is not periodic.
As indicated in the second code block, different windows can be tried. The Hann
window is used here. The number of non-zero signal bins for the Hann window is
nb = 3. NBW is calculated directly for the window, using an expression which will
be justified in the Section A.5. As !9adicated in Table 1 the result for the Hann win-
dow is NBW ~ 1.5/N
~ 7.3xlO
,The last line ofthe second code block calcu-
lates the FFT, and scales it by halfthe de gain of the window to perfonn sine-wave
scaling.
In the third code block, the 8NR is calculated as the ratio of the total power in the
signal bins to the total power in the noise bins, and the result for this simulation is
SNR = 81 dB. If a rectangular window were used instead, the poor high-fre-
quency roll-off of the window would corrupt the in-band portion of the spectrum
. - ..... ,.
,
'.'. ,
.,. '.; .:- ;,;.
., -.'
- - - Theoretical spectrum
-- Hann-windowed FFT
-- Smoothed FFT
;.; ,.: ..
.'.! -' .•...... ,...
.:
-.-j-•••••••••
,
•
. .. ,
.. ,-'
.. ;", ; -.','
"
"
--.-
-' -'. , -' -'
~.
..... ,....
. , ... , .. , .-
4IH(eJ2ltf)12NBW -:. "
3M"1
...
~._..
; -,;,.:..;.,""~--
--
-40
-{;o
-20
,
,
. . . .
..
";":" ':': ':": 'NBW = 7.3x·10~
-140 L...'-'"-'-:-~_'--'--'-'-'-'-"---+-'----'-'-'--'-'-"':":':;.:.'--'-'-='-'
10--3
fa
10-1
Normalized Frequency, f
-120
orn
ll-
-100
Figure A.I0: Example PSDs produced by the code of Fig. A.9.
381

APPENDIX A
Spectral Estimation
and yield a lower SNR. For this particular example, the shortfall was a disastrous
23 dB.
In the fourth and final code block, the raw and smoothed PSD estimates are com-
pared graphically with the theoretical PSD. As expected, the raw FFf produces an
erratic graph from which it would be difficult to tell if the observed PSD follows
the expected PSD or not. Smoothing is performed with the ~ Toolbox function
logsmooth. This function averages the power across a number of bins in order to
reduce the variance of the PSD, and also subsamples the result to yield points
which are spaced fairly evenly on a logarithmic axis. This nearly-even spacing is
achieved by using a number of bins which increases geometrically beyond a user-
specified frequency (which defaults to the third harmonic of the input). See the
"help" information associated with logsmooth for further details. With this func-
tion, it is feasible to present the results of a muW-million point simulation without
having to plot millions of points in the spectrum. As Fig. A.to shows, the agree-
ment between the expected and observed PSDs is quite good. The justification of
the formula used to calculate the expected PSD is also relegated to Section A.5.
As a final demonstration, we will use the PSD plot of FIg. A.to to manually csh-
mate the SNR. The signal power is read directly from the graph: -6 dBFS. The
noise power is computed by multiplying the noise density by the bandwidth, or in
logarithmic terms, by adding 1010g(BWIJ1BW) to the noise density in d.!%.. For
OSR = 32, BW = 0.510SR = 1.6xlO
,and since NBW = 7.3xlO
the
conversion
factor
from
average
noise
density
to
total
noise
power
is
1010g(BWI NBW) = 13 dB. Since the average noise density in the passband is
-IOOdBFS/NBW,theestimatedSNRis-6-(-100+ 13) = 81 dB.
A.S Mathematical Background
Until now, the emphasis in this Appendix has been on using the FFT to perform
spectral estimation for the signals in a n:[ modulator, while keeping the mathemat-
ics to a minimum. The mathematical theory associated with spectral estimation
involves a number of concepts from stochastic processes which are worthy of
chapters in themselves. We cannot do justice to such concepts in a subsectIOn of an
,-
382

MathematIcal Background
Appendix, so we content ourselves to list the key results and to use these as justifi-
cation for a number of fannulae which appeared earlier in the Appendix without
justification. See [2] for background.
The autocorrelation function of a discrete-time stationary random processt x is
defined as
I
1I
I
rxlk) = E[x(n)x(n + k)],
where E[
] denotes expectation ("average"). The Z-transform of rx is
(A.6)
r
(n)z~n
x
(A.?)
11 =
~OO
and the PSD Sxlf) of x is defined as
(A.8)
In other words, the PSD is defined as the Fourier transform ofthe autocorrelation
function. The link between this definition and the more intuitive definition that
S:tC/) is amount of power between frequencies f and f +df divided by df is
established by the following two properties of Sx:
1.
P, = f~Sxlf)df,WherePx = Ellx(n)1 2] is the power ofx.
2.
If the output of a linear system having a transfer function H(z) is)'
when the input x, then Sif) = !H(eJ2nf)12Sxlf).
The first property says that integrating the power spectrum over all frequencies
yields the power in the signal. The second says that filtering the signal multiplies
its power spectrum by the squared magnitude of the filter's transfer function. The
t
A stationary random process IS a random process whose statistical propertIes (mean, variance,
etc.) do not vary with time.
j
--- ------
---_ .._-
383

APPENDIX A
Spectral Estimation
intuitive definition of Sx(f) results from considering an ideal filter H having a
bandwidth df about a frequencyf
Note that the first property required Sx to be integrated over the range L0, 11 .
Since real signals have symmetric spectra, it is common in practice to use the
range [0,0.51 and double the density
(A.9)
Since the range [0.5, 1J is equivalent to the range [-0.5, OJ, this convention is
similar to the conventional use of single-sided spectral densities when dealing with
continuous-time signals.
Next, we consider the estimate of Sx (repeated from (A.5))
~-
i=
i
!I
•I
N -I
2
L w(n) . x(n)· e-j2n!n
Sx(f) ~
"'n'-'-"O'---_---c-:--~_--'-
IIwll1
(A. 10)
(We can obtain SxU) for f i = i/ N from a length-N FFr of x windowed by lV.)
The properties of this estimate arc
1.
2.
384
SJf)
S/f)*llwI11 '
where SII'(j) = IW(f)12 and * denotes circular convolution.
--~~------- ------_.

MathematIcal Background
3.
Var[SAl)J ~ [Sxif)]2 , where Var[y] denotesthe variance of a statis-
tical quantity y.
The first property states that Sif) is a biased estimator of S (j), i.e. that the
_
x
expected value of Sx(j) is not equal to the true value of Sx(j) . For example, if a
rectangular window is used, then the expected value of the estimated PSD is equal
to the actual PSD convolved with
Sw(f) ~ .l(Sin(N1tIl)2
Ilwlll
N
sin(1t1l
.
(A II)
The second property effectively states that summing the val~es of 5ifj) con-
tained in the FFf, and dividing by N, (effectively, integrating Sifj ) over [0, 1])
yields an unbiased estimate of the power in x. This property justifies summing the
powers in the in-band bins of an FFf to produce an estimate of the in-band noise
power.
The third property states that the PSD estimate is very "noisy," in that the standard
deviation of the estimate is as large as the quantity being estimated. This property
necessitates the use of averaging, as discussed in SectIOn A3.
We are now in the position to calculate the NBW of a sine-wave-scaled FFT
employing a window IV. We assume that IW(j)j has a peak at f :; 0 and that the
full-scale range is [-I, 1]. The sine-wave-scaled PSD estimate is, from (A3),
N -1
2
L w(n)' x(n)' e-j2njn
:;
n - 0
W(O)12
Thus, Sx' is related to Sx (as given in Eq. (AW» by
(A.12)
385

APPENDIX A Spectral Estimation
Sx<.nllwlli
!W(O)121 2 .
(Al3)
Since we want the integral of Sx'(f) to yield the power in x relative to the power in
a full-scale sine wave, which is 0.5, we need to find the value of NBW which
makes the following equation true
Elj"OSSx'(f)dfJ ~
UO
NBW
Since EU~5 2'SX<f)dfJ~ px'
NBW
~
Ilwlli
Iw(o)1 2 .
(A.14)
(A.IS)
This expression was used to tabulate NBW for the three windows in Table A.I. If
we assume that wen) :?: 0, then Iweo)1 = Ilwll I and we arrive at the compact result
(
11W112J2
NBW ~
Ilwll l
(A.16)
which was used in the code of Fig. A.I). Since the full-scale range affects both the
definition of Sx'(f) and the reference power of 0.5 proportionally, NBW is inde-
pendent of the full-scale range.
The final formula which requires explanation is the formula for the expected PSD
of the shaped quantization noise of a ~~ modulator, which was also used In the
code of Fig. A.9. Since the power of quantization noise is ~21 12, where ~ is the
step size, the power of the quantization noise for an M-step quantizer with a step
size ~ = 2, relative to the power M 2/2 of a full-scale Sine wave is 2/(3M2).
Assuming the quantization noise is white, its one-sided PSD is twice this amount,
or 4/(3M2). Thus the PSD of the shaped quantization nOise is
386

Mathematical Background
(A.l?)
'i
!iI
·i
=
=
;;="";
For consistency with a plot of Sx'(f) , Sq(f) must be multiplied by NBW.
387

APPENDIX A
Spectral Estimation
References
[1 J
[2J
[3J
[4J
O. Brigham, The Fast Fourier Transform and Its Applications, Prentice-Hall, Englewood
Cliffs, New Jersey, 1988.
A. Papoulis, Probability, Random Variables and Stochastic Processes, McGraw-Hili, New
York, NY, 1984.
A. V. Oppenheim and R. W. Schafer, Digital Signal Processing, Prentice-Hall, Englewood
Cliffs, New Jersey, 1989.
f. j. harris, "On the use of windows for harmonic analysis with the discrete Fourier
transfonn," Proceedings o/the IEEE, vol. 66, no. 1, pp. 51-83,Jan. 1978.
388

APPENDIX B
The Delta-Sigma Toolbox
1--
!,
.
j
~
JJ
Getting Started
To obtain your free copy of the
Deha~Sigma Toolbox. go to the MathWorks web site
(http://www .mathworks. comjmatlabcentral/ fileexchange), find the Controls cate·
gory and select delsig. To improve simulation speed, compile the sirnulateDSM. c file by
typing mex s imulateDSM. c at the MATLAB prompt. Do the same for s imulateESL. c and
ai2mif. c. The Delta-Sigma Toolbox requires the Signal Processing Toolbox and the Con-
trol Systems Toolbox; the clans function also requires the Optimization Toolbox. These
and other toolboxes may be purchased from the MathWorks.
Toolbox Conventions
Frequencies are normalized; f
= I corresponds to the sampling frequency (1s)'
Default values for function arguments are shown following an equals sign ("') in the
parameter list. To use the default value for an argument. omit the argument if it is at the
end of the list, otherwise use NaN (not-a-number) or [) (the empty matrix) as a place-
holder.
A matrix is used to describe the loop filter of a general single-quantizer delta-sigma mod-
ulator. See "MODULATOR MODEL DETAILS" on page 410. for a description of this
ABeD matrix.
389

dsdemol
dsdemo2
dsdemo3
dsdemo4
dsderno5
dsdemo6
dsdemo7
dsexamplel
dsexample2
390
APPENDIX B
The Delta.Sigma Toolbox
DEMONSTRATIONS AND EXAMPLES
Demonstration of the synthes i zeNTF function. Noise transfer function
synthesis for a 5th-order lowpass modulator, both with and without opti-
mized zeros, plus an 8th-order bandpass modulator with optimized
zeros.
Demonstration of the simulateDSM, predictSNR and simulateSNR
functions: time-domain simulation, SNR prediction using the describing
function method of Ardalan and Paulos, spectral analysis and signal-to-
noise ratio. Lowpass, bandpass, multi-bit lowpass examples are given.
Demonstration of the realizeNTF, stuffABCD, scaleABCD and
mapABCD functions: coefficient calculation and dynamic range scaling.
Audio demonstration of MODI and MOD2 with sinen decimation.
Demonstration of the simulateESL function: simulation of the element
selection logic of a mismatch-shaping DAC.
Demonstration of the designHBF function. Hardware-efficient haltband
filter design and simulation.
Demonstration of the findPIS function: positively-invariant set compu-
tation.
Discrete-time lowpass modulator design example.
Discrete-time bandpass modulator design example.
-----~

·i
•t·•,
•I
1I
I,
=I
SUMMARY of KEy FUNCTIONS
ntf
= synthesizeNTF(order=J,OSR=64,opt=O,H inf=1.5,fO=O)
page 393
ntf
= clans(order=4,OSR=64,Q=5,rmaxaO.95,opt=Ol
page 394
Synthesize a noise transfer function.
[snr,a~,ko.kl.sigma_e21
= predictSNR(ntf,OSR=64.amp~ ... ,fO_O)
page 395
Predict the 8NR vs. input power curve using the describing function method
ofArdalan and Paulos.
(v,xn,xmax,y]
= simulateDSM(u,ABCD,nlev=2,xO=O)
page 396
[v.xn,xmax,y]
~ simulateDSM(u,ntf,nlev=2,xO=O)
Simulate a delta-sigma modulator with a given input.
[snr,amp]
= simulateSNR(ntf,OSR,amp= ... ,fo=o,nlev=2,f=1!(4*Rl,k=13)
page 398
Detennine the 8m vs. input power curve by simulation.
[a,9 t b,c]
= realizeNTF(ntf,form='CRFB',stf=l)
page 400
Convert a noise transfer function into coefficients for a specific structure.
ABCD = stuffABCD(a,g,b,c,form='cRFB'}
page 401
Calculate the ABCD matrix. given the parameters of a specified modulator
topology.
[a,g,b,c]
= mapABCD(ABCD,form='cRFB'l
page 401
Calculate the parameters of a specified modulator topology given the ABeD
matrix.
[ABCDs, umax]
= scaleABCD(ABCD,nlev=2,f=0,xlim=1,ymax=nlev+2))
page 402
Perfonn dynamic range scaling on a delta-sigma modulator described by
ABCD.
[ntf,stf]
= calculateTF(ABCD,k=1}
page 403
Calculate the NTF and STF of a delta-sigma modulator described by the
ABCD matrix, assuming a quantizer gain ofk.
[SV, sx, sigma_se, max_sx, max_sy]
= simulateESL(v,mtf,M_16.dw=[l...] ,BXO=[O...] 1
page 404
Simulate the element-selection logic in a mismatch·shaping DAC.
[f1,f2,info]
a designHBF(fp=0.2,delta=le-S,debug=0)
page 405
Design a hardware-efficient half-band filter for use in a decimation or inter-
polation filter.
y = simulateHBF(x,f1,f2,mode=0}
page 408
Simulate a Saramaki half-band filter in the time domain.
[s,e,n,o,Sc)
= findPIS(u,ABCD,nlev=2,options)
page 409
Find a convex positively-invariant set for a delta-sigma modulator.
391

APPENDIX B The Delta-Sigma Toolbox
. ------ -------
SUMMARY OF OTHER SELECTED FUNCTIONS
Delta-Sigma Utility
modl,
mod2
Scripts for setting up the ABeD matrix, NTF and STF of the 1Sll2nd_order
modulator.
snr
= calculateSNR(hwfft,fl
Estimate the SNR given the in-band bins of a Hann-windowed FFf and the
location of the input signal.
[sys,
Gp]
= mapCtoD(sys_c,t=[O 1J,fO=0)
Map a continuous-time system to a discrete-lime system whose impulse
response malches the sampled pulse response of the original continuous-
time system.
[A BCD)
= partitionABCD{ABCD,
rn)
Partition ABeD into A, B, C, Dfor an Ill-input slate-space system.
H_inf
= infnorm{H)
Compute the infinity norm (maximum absolute value) of a z-domain trans-
fer function. Sec evalTF.
sigma_H
~ rmsGain(H,fl,f2)
Compute the root mean-square gain of the discrete-time transfer function H
in the frequency band (n,f2).
General Utility
dbv(),
dbp(),
undbv(),
undbp{),
dbm()
The dB equivalent of voltage/power quantities, and their inverse functions.
window: hann(N)
A Hann window of length N. Unlike MATLAB's original hanning function.
hann does not smear a tone which is located exactly in an FFf bin (i.e. the
tone has an integer number of cycles in the given block of data). MATLAB
6's hanning (N, 'periodic') function is the same as hann (N).
Graphing
plotPZ(H,color~'b',markersize=5,list=O)
Plot the poles and zeros of a transfer function.
figureMagic (xRange,dx, xLab,
yRange,dy,yLab,
size)
Performs a number of formatting operations for the current figure, including
axis limits, ticks and labelling.
printmif(file,size,font,fig)
Print graph to an Adobe Illustrator file and then use ai2mif to convert it to
FramcMaker MIF format. ai2mi f is an improved version of the function of
the same name originally written by Deron Jackson <djackson@mit.edu>.
[f,p]
= logsmooth(X,inBin,nbin)
Smooth the FFf. X, and convert it to dB. See also bplogsmooth and bilog-
plot for bandpass modulators.
392
~-.•
;

, '
----------------,---
synthesizeNTF
Synopsis:
ntf
'" synthesizeNTF(order",3,OSR=64,opt=O,H_inf=1.5,fO",O)
Synthesize a noise transfer function (NTF) for a delta-sigma modulator.
=
-~
=
;
i
Arguments
order
OSR
opt
jO
The order of the NTE order must be even for bandpass modulators.
The oversampling ratio. OSR is only needed when optimized NTF zeros
are requested.
A flag used to request optimized NTF zeros. opt=O puts all NTF zeros at
band-center (DC for lowpass modulators). opt==l optimizes the NTF
zeros. For even-order modulators, opt=2 puts two zeros at band-center,
but optimizes- the rest.
The maximum out-of~bandgain of the NTF. Lee's rule states that
H_inf<2 should yield a stable modulator with a binary quantizer.
Reducing H_infincreases the likelihood of success, but reduces the
magnitude of the attenuation provided by the NTF and thus the theoreti-
cal resolution of the modulator.
The center frequency of the modulator.jO#J yields a bandpass modula-
tor;jO=O.25 puts the center frequency at f / 4.
Output
nt/
The modulator NTE given as an LTJ object in zero-pole form.
Example
Fifth-order lowpass modulator; zeros optimized for an oversampling ratio of 32.
H • synthesizeNTF(S,32,1)
"
,
Max. gain =1.5 (3.5dB}-~-
Magnitude Response
o
·20
,,,,,---'-;''---,
'''I-c""",,,,~'';''''j4,_rmsgain
"/y
=-65 dB
'60 l~'~.~.~:~~~;':'
':.~::~:"~OO~'~=~;::164
·800
0.1
0.2
03
--S-4.---~O,5
Normalized Frequency (1 -~ fs)
i,,,,,
o
,
,,
.........,..,,,,,
.....:.
Pole-Zero Plot
,
~-
393

APPENDIX B The Detta-5igma Toolbox
clans
The order of the NTE
The oversampling ratio.
The maximum number of quantization levels used by the fed~back
quantization noise. (Mathematically, Q = Ilhlll - 1 ,Le. the sum of
the absolute values ofthe impulse response samples minus 1, is the
maximum instantaneous noise gain.)
The maximum radius for the NTF poles.
A flag used to request optimized NTF zeros. opt=O puts all NTF zeros at
band-center (DC for lowpass modulators). opt=1 optimizes the NTF
zeros. For even-order modulators, opt=2 puts two zeros at band-center,
but optimizes the rest.
rmax
opt
Synopsis:
ntf
= clans(order=4,OSR=64,Q=S,rmax=O.95,opt=O)
Synthesize a noise transfer function (NTF) for a lowpass delta-sigma modulator using the
CLANS (Closed-loop analysis of noise-shaper) methodology [1). This function requires
the optimization toolbox.
[I]
J. G. Kenney and L. R. Carley. "Design of multibit noise-shaping data converters,"
Analog Integrated Circuits Signal Processing Journal, vol. 3, pp. 259-272, 1993.
Arguments
order
OSR
Q
Output
nif
The modulator NTE given as an LTI object in zero-pole form.
Example
5th_order lowpass modulator; time-domain noise gain of 5, zeros optimized for OSR = 32.
H;; clans{5,32,5, .95,1)
, ..
.,
".,
Pole-Zero PIal
,,
Magnitude Response
394

predictSNR
The modulator NTF, given in zero~pole form.
The Qversampling ralio. OSR is used to define the "band of interest."
A row vector listing the amplitudes to use. Defaults to {-120 -110...-20-
15 -10 -9 -8 ... OJ dB, where 0 dB means a full-scale sine wave.
The center frequcoey of the modulator. ftJt:-O corresponds to a bandpass
modulator.
amp
Synopsis:
[snr,amp,kO,kl,sigma_e2]
'" predictSNR(ntf,OSR=64,amp"' ... ,fO"'O)
Use the describing function method of Arcla\an and Paulos [1] to predict the signal-to-
noise ratio (SNR) in dB for various input amplitudes. This method is only applicable to
binary modulators.
[1]
S. H. Ardalan and 1. J. Paulos, "Analysis of nonlinear behavior in delta-sigma
modulators," IEEE Transactions on Circuits and Systems, vol. 34, pp. 593-603, June
1987.
Arguments
nif
aSR
jD
Output
'"'
amp
kG
kl
sigma_e2
A row vector containing the predicted SNRs.
A row vector Ii sting the amplitudes used.
The signal gain of the quantizer model; one value per input level.
The noise gain of the quantizer model; one value per input level.
The mean square value of the noise in the model of the quantizer.
Example
See the example on page 399.
The Quantizer Model:
The binary quantizer is modeled as a pair of linear gains and a noise source, as shown in
the figure below. The input to the quantizer is divided into signal and noise components
which are processed by signal-dependent gains koand k]. These signals are added to a
noise source, which is assumed to be white and to have a Gaussian distribution (the vari-
ance cr; is also signal-dependent), to produce the quantizer output.
y~v
y
"signal"
"noise"
Yo
y,
e: AWGN with"
variance 0'e
v
--------
395

APPENDIX B The Oelta-5igma Toolbox
simulateDSM
Synopsis:
[v,xn,xmax,y]
= simulateDSM(u,ABCD,nlev=2,xO=O) or
[v,xn,xmax,y]
= simulateDSM(u,ntf,nlev=2,xO=O)
Simulate a delta-sigma modulator with a given input. For maximum speed, make sure that
the mex file is on your search path (At the MATLAB prompt, type which simulateDSM).
Arguments
The input sequence to the modulator, given as a m x N row vector. m is
the number of inputs (usually 1). Full~scale corresponds to an input of
magnitude nlev-I.
A state-space description of the modulator loop filler.
The modulator NTF, given in zero-pole form.
The modulator srp is assumed to be unity.
The number of levels in the quantizer. Multiple quantizers arc indicated
by making nlev an array.
The initial state of the modulator.
The samples of the output of the modulator, one for each input sample.
The internal states of the modulator, one for each input sample, given as
an n x N matrix.
The maximum absolute values of each state variable.
The samples of the quantizer input, one per input sample.
xO
Output
v
xn
"
nlev
ABeD
nif
xmax
y
=
396

Example
Simulate a 5th-order binary modulator with a half-scale sine-wave input and plot its output
in the time and frequency domains.
OSR = 32;
H •
syuthesi~eNTF(S,OSR,l);
N = 8192;
fB = ceil{N/{2*OSR»; fB8S;
u
= O.5*sin(2*pi*f/N*[O:N-l]);
v = simulateDSM(u,H);
Time-domain plot:
t
= 0:85;
stairs(t, u(t+l));
hold on;
stairs(t,v(t+l)) ;
axis([O 85 -1.2 1.2]);
ylabel('u, v');
>
0;
0
-, L--'--~.~~~--:cc~_-.L--.L--"~---cL-~~~~.J
o
10
~
~
~
~
00
ro
w
sample number
Frequency-domain plot:
spec=fft(v.*hann(N))/(N!4);
plot(linspace(0,1,N/2),
dbv(spec(1:N!2)));
figureMagic{[O 0.5J,O.05,2,
[-1200],10,4);
y1abel ( 'dB' ) ;
snr=calculateSNR(spec(l:fB) ,f);
s=sprintf('SNR
~ %4.1fdB\n',snr);
text(O.25,-90,s) ;
s=sprintf{'NBW=%7.5f',l.5/N);
text(0.25,
-110, s);
o r:-~--,----'----,----,--,----,--,---,---,
-40
<II
-0
-80
-120 o
. SNR =82_5dB_
NBW=O.00018-
-------'-------:L.-----'---:':-----'--------'-,---'---:"-------- __l
0.1
0.2
0.3
0.4
Normalized Frequency (1 --t 's)
0.5
.~~------------------
397

APPENDIX B The Delta-Sigma Toolbox
simulateSNR
A row vector containing the SNR values calculated from the simulations.
A row vector listing the amplitudes used.
The modulator NTF, given in zero~pole form.
The oversampling ratio. OSR is used to define the "band of interest."
A row vt:(:tor listing the amplitudes to use. Defaults to [-120 -110... ~20­
15 -10 -9 -8 ... 0] dB, where 0 dB means a full-scale sine wave, i.e. a
sine wave whose peak value is nlev-l.
The center frequency of the modulator. jf#0 corresponds to a bandpass
modulator.
The number of levels in the quantizer.
The nonnalized frequency of the test sinusoid; a check is made that the
test frequency is in the band of interest. The frequency is also adjusted
so that it lies precisely in an FfT bin.
The number of time points used for the FfT is 2"-.
amp
amp
k
Output
snr
Synopsis:
[snr,amp):= simulateSNR{ntf,OSR,amp, fO:=O,nlev:=2, f:=ll
(4*OSR) ,k=13}
Simulate a delta-sigma modulator with sine wave inputs of various amplitudes and calcu-
late the signal-to-noise ratio (SNR) in dB for each input.
Arguments
nif
aSR
nlev
f
fO
------~-_._-
398

Example
Compare the SNR vs. input amplitude curve for a fifth-order modulator detennined by the
describing function method with that determined by simulation.
OSR •
32;
H = aynth••izeNTF(5,OSR,1);
[snr-pred.amp]
;
predictSNR(H,OSR);
[snr,ampJ
•
simulateSNR(H,OSR);
plot (amp,snr-pred, 'b',amp,snr, 'gs');
figureMagic([-lOO
OJ,
10,
1,
(0100],
la,
I);
xlabel('Input Level,
dB'};
ylabel( 'SNR dB' l;
title{'SNR curve');
s=sprintf('peak SNR = %4.1fdB\n', max(snr});
text(-49,lS,s};
SNR curve
"
....
;
.
, ..
"
"
-. -- -;_
.
.,
100.--.,-,--,----,_,--,-,--,----,--,
90
80
70
60
50
40
30
20
CD
"Ca:
Z
Ul
o
~_-"-c---'c----'-c----'---'_'-_"--'
·100 -90 -80 ·70 -60 -50 -40 -30 -20 -10
0
Input Level, dB
399

APPENDIX B
The Delta-5igma Toolbox
realizeNTF
The modulator NTF, given in zero-pole form (i.e. a zpk object),
A string specifying the modulator topology.
CRFB
Cascade-of-resonators, feedback form.
CRFF
Cascade-of-resonators, feedforward form.
CIFB
Cascade-of-integrators, feedback form.
CIFF
Cascade~of-integrators,feedforward form.
Structures are described in detail in "MODULATOR MODEL
DETAILS" on page 410.
The modulator STF, specified as a zpk object. Note that the poles of the
STP must match those of the NTP in order to guarantee that the STF
can be realized without the addition of extra state variables.
'if
Synopsis:
[a,g,b,c]
~ realizeNTF(ntf,form='CRFB',stf=lj
Convert a noise transfer function (NTF) into a set of coefficients for a particular modulator
topology,
Arguments
ntf
form
Output
a
8
b
c
Feedbacklfeedforward coefficients from/to the quantizer (1 x 11).
Resonator coefficients ( I x Ln/2J ).
Feed-in coefficients from the modulator input to each integrator
(lxn+l).
Integrator inler~stage coefficients. ( I x It • In unscaled modulators, c is
all ones.)
Example
Determine the coefficients for a 5th_order moduEator with the cascade-of-resonators struc-
ture, feedback (CRFB) form.
»
H
~ synthesizeNTF{5.32,1);
»
[a,g,b,c] = realizeNTF(H, 'CRFB')
a
0.0007
0.0084
0.0550
0.2443
0.5579
9
0.0028
0.0079
b
0.0007
0.0084
0.0550
0.2443
0.5579
1.0000
ell
1
1
1
400

stuffABCD
A state-space description of the modulator loop filter.
Feedback/feedforward coefficients from/to the quantizer. 1 x n
Resonator coefficients. 1 x Ln/2J
Feed-in coefficients from the modulator input to the input of each inte-
grator and to the input of the quantizer. I x n + 1
Integrator inter-stage coefficients. I x n
see realizeNTF on page 400 for a list of supported structures.
g
b
Synopsis:
ABeD" stuffABCD(a,g,b,c,form='CRFB')
Calculate the ABeD matrix given the parameters of a specified modulator topology.
Arguments
a
c
form
Output
ABCD
=
mapABCD
A state-space description of the modulator loop filter.
see realizeNTF on page 400 for a list of supported structures.
-I
••·=
I
i•
[a,g,b,c]
"mapABCD{ABCD,form='CRFB')
Calculate the parameters for a specified modulator topology, assuming ABeD fits thai
topology.
Arguments
ABCD
form
Output
a
g
b
c
FeedbackJfeedforward coefficients from/Lo the quantizcr. 1 x n
Resonator coefficients. 1 x Ln/2J
Feed-in coefficients from the modulator input to each integrator.
lxn+1
Integrator inter-stage coefficients. I x n
401

1
APPENDIX B The Delta-Sigma Toolbox
scaleABCD
Iii
A state-space description of the modulator loop filter.
The number of levels in the quantizer.
The normalized frequency of the test sinusoid.
The limit on the states. May be given as a vector.
The threshold for judging modulator stability. If the quantizer input
exceeds ymax, the modulator is considered to be unstable.
The maximum input which will be applied to the modulator during sim-
ulation. Ifumax is not supplied, it will be estimated by simulation.
The number of time steps used for determination ofthe state maxima.
The scaled state-space description ofthe modulator loop filter.
The maximum stable input. Input sinusoids with amplitudes below this
value should not cause the modulator states to exceed their specified
limits.
N
Output
ABCDs
Synopsis:
[ABCDs, umax] _scaleABCD (ABCO, nlev=2, f"'O,xlim=l, ymax=nlev+S, umax, N=
leS)
Scale the ABeD matrix so that the state maxima are less than a specified limit. The maxi-
mum stable input is determined as a side-effect of this process.
Arguments
ABCD
"max
"max
nlell
f
xlim
ymax
•;;•
••
402

calculateTF
A state-space description of the modulator loop filter.
The value to use for the quantizer gain.
=
Synopsis:
[ntf,stf}
'" calculateTF(ABCD,k=l)
Calculate the NTF and STF of a delta-sigma modulator.
Arguments
ABeD
k
The modulator NTF, given as an LTI system in zero-pole fann.
The modulator STF, given as an LTI system in zero-pole form.
==
"•·•I
Output
nif
sif
Example
Realize a fifth-order modulator with the cascade-of-resonators structure, feedback form.
Calculate the ABeD matrix of the loop filter and verify that the NTF and STF are correct.
»
H = synthesizeNTF(S,32,1)
Zero/pole/gain:
(z-1)
(z A 2 _ 1.997z
+ 1)
(z A 2 - 1.992z
+ 1)
(z-0.7778)
(z
A 2 _ 1.613z + 0.6649)
(z
A 2 -
1.796z + 0.8549)
Sampling time:
1
»
[a,g,b,c] = realizeNTF(H)
a
9
b
c
0.0007
0.0028
0.0007
0.0084
0.0079
0.0084
0.0550
0.0550
0.2443
0.2443
0.5579
0.5579
1. 0000
1.992z
"'
1)
0
0.0007
-0.0007
0
0.0084
-0.0084
0
0.0633
-0.0633
-0 .0079
0.2443
-0.2443
0 .9921
0.8023
-0.8023
1 .0000
1.0000
0
ooo
1.0000
1.0000o
1
1
1
1
1
»
ABeD •
stuffABCD(a,g,b,c)
ABeD =
1.0000
0
0
1.0000
1.0000
-0.0028
1.0000
1.0000
0.9972
o
01.0000
o
01.0000
o
0
0
»
[ntf,stf) = calculateTF(ABCD)
Zero/pole/gain:
(z-l)
{z
A 2
-
1. 997z + 1}
(z
A 2
(z-0.7778)
(z~2 -
1.613z
+ 0.6649)
(z
A 2 - 1.796z
+ 0.8549)
Sampling time:
1
Zero/pole/gain:
1
Static gain.
------~- ------------------
403

APPENDIX B The Delta-Sigma Toolbox
simulateESL
Synopsis:
[sv, SX, sigma_se, max_sx,max_sy]
= simulateESL (v ,mtf, M=16, dw= [1...],
sxQ", [0...] )
Simulate the element selection logie (ESL) of a multi-element DAC using a particular
mismatch-shaping transfer function (mtf).
[1]
R. Schreier and B. Zhang "Noise-shaped multibit D/A convertor employing unit
elements," Electronics Letters, vol. 31, no. 20, pp. 1712-1713, Sept. 281995.
Arguments
v
mlf
M
dw
sxO
Output
sv
sx
Example
Run dsdemo6 . ffi.
404
A vector containing the number of elements to enable. Note that the
output of simulateDSM must be offset and scaled in order lo be used
here as v must be in the range [0, L~ dw(i)] .
The mismatch-shaping transfer function, given in zero-pole form.
The number of elements.
A vector containing the weight associated with each element.
An n x M matrix containing the initial state of the element selection
logic.
The selection vector: a vector of zeros and ones indicating which ele-
menl<; to enable.
An II x M matrix containing the final state of the element selection
logic.
The rms value of the selection error, se = sv - sy . sigma_se may be
used to analytically estimate the power of in-band noise caused by ele-
ment mismatch.
The maximum value attained by any state in the ESL.
The maximum value attained by any component ofthe (un-nonnalized)
"desired usage" vector.

Normalized passband cutoff frequency.
Passband and stopband ripple in absolute value.
designHBF
Synopsis:
[£1, £2, info) =designHBF (fp",Q. 2, delta=le-S, debug=O)
Design a hardware-efficient linear-phase half-band filter for use in the decimation or inter~
polation filter associated with a delta-sigma modulator. This function is based on the pro-
cedure described by Saramaki [11. Note that since the algorithm uses a non-deterministic
search procedure, successive calls may yield different designs.
[1]
T. Saramiiki, "Design of FIR filters as a tapped cascaded interconnection of identical
subfilters," IEEE Transactions on Circuits and S)wtems, vol. 34, pp.
101l~1O29,
1987.
Arguments
fp
delta
The number of additions per output sample.
The length of the f1 and f2 vectors.
The achieved stop-band attenuation (dB).
The scaling factor for the F2 filter.
Output
fl,12
info
Prototype filter and subfilter coefficients and their canonical·signed
digit (csd) representation.
A vector containing the following information data (only set when
debug=!):
complexity
nl.n2
sbr
phi
j
Example
Design of a lowpass half-band filter with a cUl-off frequency of 0.2fs. a passband ripple of
less than 10-5 and a stopband rejection of at least 10-5 (-100 dB).
[£1,£2]
= designHBF(O.2,le-5);
f
= linspace(O,O.5,1024);
plot(f,
dbv{frespHBF(f,fl, f2))}
A plot of the filter response and the structure of this filter as a decimation or as an interpo-
lation filter are shown on the next page. The filter achieves 109 dB of attenuation in the
stopband and uses only 124 additions (no true multiplications) to produce each output
sample.
405

APPENDIX B The Detta-8lgm8 Toolbox
' ....
............... ,' ...
... .
.\
,
or==::===::::;::::=;::::::::;:-:-~~~~
-20
a>-40
SI :
:f -100
-120
-140L_~_~--'--:-c--'-----c-',----=--=-,""",-'---=---o-
o
0.1
0.2
0.3
0.4
0.5
Normalized Frequency (1--+ '$)
IN
@f,
""'-f,(3)
'\--.Jr"'f----., +
OUT
@fJ2
Decimation structure.
IN~>-_--I
@fJ2
OUT
@f,
Interpolation structure.
IN -,rl-l
}---( .>-_ OUT
406

=
I
J
The coefficients and their signed-digit decompositions are
[fLval] ,
"
[f2.vall'
"
»
fl.csd
»
f2.csd
0.9453
0.6211
ans
.ns
-0.6406
-0.1895
0
-4
-7
-1
-3
-,
0.1953
0.0957
1
-1
1
1
1
-1
.ns
-0.0508
ans
-2
-4
-9
0.0269
-1
-3
-6
-1
1
-1
-0.0142
-1
-1
-1
.ns
ans
-3
-5
-9
-2
-4
-7
1
-1
1
1
-1
1
.ns
-4
-7
8
-1
1
1
ans
-5
8
-lJ
1
-1
-1
.os
-6
-9
-lJ
-1
1
-1
In the above signed-digit expansions, the first row contain the powers of two while the sec~
ond row ~ives their signs. For example,f1(l) = 0.9453 =20_2-4+Z-7 and (2(1) = 0.6211
= r1+T _2-8. Since the filter coefficients for this example use only 3 signed digits, each
multiply-accumulate operation shown in the diagram below needs only 3 binary additions.
Thus. an implementation of this l10th_order FIR filter needs to perform only 3x3 +
5x(3x6 + 6 -1) = 124 additions at the low (i/2) rate.
407

APPENDIX B
The Delta-Sigma Toolbox
simulateHBF
The input data.
Filter coefficients. fl and f2 can be vectors of values or struct arrays like
those returned from designHBF.
The mode flag determines whether the input is filtered, interpolated. or
decimated according to the following:
o
Plain filtering, no interpolation or decimation.
I
The input is interpolated
2
The output is decimated, even samples are taken.
3
The output is decimated, odd samples are taken.
mode
Synopsis:
y'" simulateHBF(x,fl,f2,mode"'0}
Simulate a Saramaki half-band filter (see designHBF on page 405) in the time domain.
Arguments
x
fl/2
Output
)'
The output data.
Example
Plot the impulse response of the HBF designed on the previous page.
N'" {2*length(f1}-1)*2*{2*length(f2)-1)+1;
y
=0 simulateHBF{ [l zeros (l,N-ll J, ft, f2);
stern ( [O:N-l] ,y};
figureMagic([O N-l],5,2,
[-0.20.5],0.1,1)
printmif{ 'HBFimp',
[6 3],
'Helvetica8')
"
"
~
"
•c00-m
"
rr:
~
"
.lIl
00-
oS
0
~"
" 0
....
"
40
50
60
70
Sample Number
"
00
100
110
408

·••.!!
I
j
findPIS, find2dPIS (in the PoslnvSet subdirectory)
Synopsis:
[s,e,n,o,Scj" findPIS(u,ABCD,nlev=2,options)
options
=
[dbg=O itnLimit=2000 expFactor=O.005 N=1000 skip=100
qhullArgA=O.999 qhullArgC=.OOl]
s
= find2dPIS(u,ABCD,options)
options
=
[dbg=O itnLimit=100 expFactor=O.Ol N=1000 skip=100J
Find a convex positively-invariant set for a delta-sigma modulator. findPIS requires com-
pilation of the qhull mex file; find2dPIS does not, but is limited to second-order systems.
Arguments
u
ABeD
nlev
dbg
itnUm;t
expFnctor
N
skip
qhullArgC
Output
s
e
n
o
Sc
The input to the modulator. If u is a scalar, the input to the modulator is
constant. If II is a 2 x 1 vector, the input to the modulator may be any
sequence whose samples lie in the range [u(l), u(2)].
A state-space description of the modulator loop filter.
The number of quantizer levels.
Set dbg=l to get a graphical display of the iterations.
The maximum number of iterations.
The expansion factor applied to the hull before every mapping opera-
tion. Increasing expFactor decreases the number of iterations but
results in sets which are larger than they need to be.
The number of points to use when constructing the initial guess.
The number of time stcps to run the modulator before observing the
slate. This handles the possibility of "transients" in the modulator.
Thc 'A' argument to the qhull program. Adjacent facets are merged if
the cosine of the angle between their normals is greater than the abso-
lute value of this parameter. A negative value implies that the merge is
perrormed during hull construction, rather than after.
The 'C' argument to the qhull program. A facet is merged into its
neighbor ifthe distance between the facct's centrum (the average ohhe
facet's vertices) and the neighboring hyperplane is less than the abso-
lute value of this parameter. As with qhullArgA, a negative value
implies pre-merging whereas a positive value implies post-merging.
The vertices of the set (dim x nv )'
The edges of the set. listed as pairs of vertex indices (2 x ne ).
The normals for the facets of the set (dim x nf ).
The offsets for the facets of the set ( 1 x nf)'
The scaling matrix which was used internally to "round out" the set.
409

APPENDIX B The Delta-Sigma Toolbox
MODULATOR MODEL DETAILS
A delta-sigma modulator with a single quantizer is assumed to consist of quantizer eon~
neeted to a loop filter as shown in the diagram below.
•
"1z)oG(z)U{z)+H(z)E(z)
E
----. Loo~
I
Loop Filter
y
/
1-.-
,.. L1= Hit1
Quantizer
u
The Loop Filter
The loop filter is described by an ABCD matrix. For single-quantizer systems, the loop fil-
ter is a two-input, one-output linear system and ABCD is an (n+l)x(n+2) matrix. parti-
tioned into A (llXn), B (nx2), C (lXn) and D (lx2) sub-matrices as shown below:
ABeD = [*].
(B.l)
The equations for updating the state and computing the output of the loop filter are
x(n + 1) = Ax(n) + B[lt(l1~
v(IJ)J
Y(I1) = Cx(n) + D[lt(ll~
~~
~.~
This formulation is sufficiently general to encompass all single-quantizcr modulators
which employ linear loop filters. The toolbox currently supports translation from an
ABCD description to coefficients and vice versa for the following topologies:
CIFB
Cascade-of-integrators. feedback form.
CIFF
Cascade-of-integrators. feedforward fonn.
CRFB
Cascade-of-resonators, feedback form.
CRFF
Cascade-of-resonalors. feedforward fonn.
Multi-input and multi-quantizer systems are also described with an ABeD matrix and Eq.
(2) still applies. For an nIh-order, ncinput, no-output modulator. the dimensions of the sub-
matrices are A: nXn, B: nx(n/+l1o)' C: noxn and D: IlQX(ni+llo)'
410

1
I
I
I
I
1
IJI
='i.,i
The Quantizer
The quanrizer is as described in Section 2.1, namely a symmetric binary quantizer with a
step size of two. Quantizers with an even number of levels are of the mid-rise type and
produce outputs which are odd integers. Quantizers with an odd number of levels are of
the mid-tread type and produce outputs which are even integers.
v
nlev--1
,~
3
~.l-r-,-';A;-c':oI'FT---~-Y
-n/ev
-4
2 4
n~v
-3
(nlev-1 )
Transfer curve of a quantizer with an
even number of levels.
v
nlev-1
4
-nlev
-5
-(nlev-1 )
j
Transfer curve of a quantizer with an odd
number of levels.
Illustrations of the four topologies for which the toolbox supports coefficient calculation
arc given on the following pages.

...
~
N
u(n)
CIFB Structure
u(n)
1
T
I
Even Order
Odd Order
~~n)
...r>-.-.. ,\n)
!
zg
"m
~!
...
~
<Io
~
------_...
I
"LlLUIL _J
.
.....
II'
___,Iii
11'.. ,
.
•._. __•.._
1111 I il
11111111111111111"11
i!J!!!!!...._l~Ji.I.III.I.IIIIII_~~I_"
._-.-••
1

"
=
-.-
=
,0{
=!.
iii•
"
~
"
~
";\'
"
.e
0;
"E
u
0
=
"E
.'
.i:l
0
~
~
en
c
0
'"
~
'"
w
-
U
•Ii
413

...
~...
u(n)
CRFB Structure
u(n)
f
f
I
~~v(n)
Even Order
~v(n)
Odd Order
Note that with NTFs designed using synthesizeNTF, omission of the
b2.. coefficients in the CRFB structure will yield a maximally¥flat STP.
,.
~
;liz2x
"i!
~.
•;}o
~
."'. "._,••,
_ ...,.w, .1••
'
Ii "ii jii' j" W••111._,_.
11
,

415

416
APPENDIX B The Delta-Sigma Toolbox
l.
A

APPENDIX C
Noise in Switched-
Capacitor Delta-Sigma
Data C01werters
One of the main limitations of the performance of delta-sigma converters is noise.
The sources of noise include the intrinsic noise generated in the MOS transistors,
as well as the extrinsic (interference) noise originating, typically, from the on-chip
digital circuitry, and coupled into the sensitive analog stages via the substrate and
supply or ground lines.
In this Appendix, the analysis of the effects of intrinsic noise on delta-sigma con~
verters using switched-capacitor (SC) circuits is discllssedt. The reader is referred
to [1] for infonnation on the physics, modeling and reduction of extrinsic noise.
There are two important intrinsic noise effects in MOS transistors: thermal and
flicker noise.~ Thermal noise is caused by the thermal motion of the charge calTiers
in the channel of the device. This causes a small amount of random fluctuatIon in
t. The authors are grateful for the assistance of Jesper Steensgaard and Jo.se Silva in the prepara-
tion of this Appendix. Jose Silva contributed Sections C.4 and CS.
+:. Shot nOIse, which is due to the random flow of discrete charges under high electric field condl'
tions, is significant mostly in forward-biased p-njunctions, which do not exist in common MOS
devices. It may occur. however. 1n deep submicron devices if significant gate current flows.
417

APPENDIX C
Noise In Switched-Capacitor Delta-Sigma Data Converters
the drain current. If the transistor operates In its triode region, as it does for a con-
ducting switch, the noise can be represented by a voltage source in series with the
device, The power spectral density (PSD) of its voltage is white; its estimated
value is given by
S,,(f)
~ 4kTRon (Y'/Hz).
(C.I)
Here, kis the Boltzmann constant, k = 1.38xlO-23 J/K, Tis the absolute temper-
ature of the device in degrees Kelvin, and Ron is its on-resistance in ohms. The
mean value of the thermal noise is zero.
Note that here, and in the rest of this Appendix, all PSDs are regarded as one-sided
distributions, so the noise power between f 1 and f 2 is obtained simply by inte-
grating S(f) between f 1 and f 2·
For a MOSFET operating in its active region, the thermal noise can be modeled by
a current source in parallel with the channel. The PSD of the noise current is to a
good approximation given by
(C.2)
Flicker noise or 1/f
noise is caused by the charge carriers getting trapped and
later released as they move in the channel. It is usually modeled by a series noise
voltage source connected to the gate. The PSD of this voltage is approximately
given by
K
2
WLC f (Y 1Hz)
0"
(C.3)
where Wand L are the width and length of the channel, Cox the gate capacitance
per unit area,f is the frequency, and K is a fabrication parameter. Note that SIi/)
is not white; most of its power is concentrated at low frequencies.
418

iI.
:Iit
I[I
Noise Effects In CMOS Op Amps
The reader can find a more detailed discussion of intrinsic device noise, e.g., in
Chapter 4 of [2J.
In the following, the effects of thennal noise and 1/f noise on the components of
switched-capacitor (SC) circuits will be discussed. Then, the noise analysis of a
complete SC integrator will be performed. Finally, the noise analysis of delta-
sigma converters using SC circuitry will be described.
C.1 Noise Effects in CMOS Op Amps
CMOS op amps are sensitive to the effects of both thennal noise and 1/f noise.
To reduce 1/f noise, several steps may be taken:
1.
As can be seen from (C.3), a device with larger gate area WL has less
flicker noise. Since often the op-amp input devices dominate the noise,
these should have large gate areas.
2.
For some technologies, the PMOS devices have considerably smaller
values for the constant Kthan the NMOS ones. Hence, PMOS input
devices are preferable for these technologies.
3.
Using correlated double sampling (CDS) at the op-amp input, the input
noise may be stored and then subtracted from the signal [2]. This intro-
duces a highpass filtering of the noise, and suppresses it effectIvely at
frequencies whIch are much lower than the sampling frequency Is.
4.
Chopper stabilization [3] can be used to modulate the 1/I noise out of
the signal band.
These measures can usually reduce 1/I
n01se to the point where thermal noise
effects dominate. Hence, the following discussions will concentrate on thermal
noise.
Next, the estimation of thennal noise in op amps will be discussed. As an illustra-
tion, a differential pair (which may be the input stage of a multistage op amp) is
shown in Fig. C.I, along with its thermal noise current sources. These represent
the effect of the noise currents, given in Eq. (C.2). It can readily be seen that the
noise current of the tail device Q5 does not contribute to the output current, since it
419

APPENDIX C Noise In SwitChed-Capacitor Delta-$Igma Data Converters
is present in the drain currents of both Q2 and Q4, and hence cancels in the output
current under ideal matching conditions. (This is a good approximation only at fre-
quencies where the gains and delays of the two signal paths match.t) The noise
currents of the input devices (assumed to be perfectly matched) can be represented
by equivalent noise voltage sources at their input terminals. From (C.2), the PSDs
of these sources are given by (8/3 )kT1gml . The noise current of Q3 can also be
represented by a voltage source at the gate of Ql. The PSD of this source is
(8/3)kTgm3Igl~1' Similar considerations hold when the noise of Q4 is repre~
seoted by an equivalent source at the input of Q2.
Combining these results, the total thermal noise of the stage may be represented by
a single equivalent noise voltage source VII, eq at the gate of Ql (or Q2). Its PSD is
(CA)
VDD
11--~OVin_
Figure C.I: Noise sources in a simple CMOS op amp.
t. More importantly, it is a good approximation in fUlly-differential Circuits.
420
i

•
Ii
I
Noise Effects in CMOS Op Amps
The first equality of (C.4) suggests that for low noise gml »gm3 should be used,
which justifies the approximation made in the last part.
Consider next the op amp under negative feedback conditions (Fig. C.2). Note that
the op-amp noise is represented by the equivalent source Vn,eq' and that no signal is
present since only the noise amplification is analyzed. It will be realistically
assumed that the op amp is properly compensated, so that in the frequency range of
interest (where the gain is 1 or larger) the closed-loop transfer function can be
approximated by the one-pole expression
Here, GO is the de gain of the stage, and t is its settling time constant. Go is deter~
mined by thefeedbaek factor ~ = C2/ (CI + C2) and by the de gain Aoof the op
amp. Assuming Ao»l/~ ,
!il
v
(s)
R(s) =
Ollt
V+(s) =
(C.S)
(C.6)
j
Since the settling time is determined by how fast the op-amp output current can
charge the load capacitances, '[ will be proportional to l/gml" Also, since feed-
back reduces t, it may be written in the form t = CO/(~gm 1)' where Co depends
Figure C.2: An op~amp with capacitive feedback and capacitive loading.
------- -_._---~---_._----_._----------
421

APPENDIX C
Nol.. ln Swllched-<:apacltor Delta-8lgma Data Converters
on the structure ofthe op amp. For a two-stage op amp, Co = Cc' where Cc is the
compensation capacitance connected between the stages. For a single-stage
(folded- or telescopic-cascode) op amp, Co is the load capacitance at the output
node oftheop amp: Co
~ C10ad ~ C3+CIC2/(Cl+C2)'
The PSD of the white input noise becomes shaped at the output by the first-order
lowpass filter function given in (C.S). The mean-square (MS) value of the output
noise may be calculated by integrating the shaped PSD from dc to infinite fre-
quency:
-2 _ [
I'
:j)12
_ (16kT)(G6)
vout -
0 S,,(fJ HU21t
dJ -
3g
m1
4<'
Substituting the values derived above for Go and 't gives
(C.7)
(C.8)
The MS value of the output noise voltage for unity-gain feedback can also be
obtained, simply by setting p ~ I (CI ~ 0) in (C.8):
-2-
vout
4kT
= 3C .o
(C.9)
Notice that even though the PSD of the op amp's input noise source is determined
by gm I ' the expressions (C.8) and (C.9), which give the MS value of its output
noise, do not contain gm1. This is because the PSD is inversely proportional to
gmt' while the bandwidth of the stage is directly proportional to it. Hence, its
effect cancels in the calculation ofthe MS output noise.
422

•
~
!•I,,,
1
Sampled lhennal Noise
C.2 Sampled Thermal Noise
The discussions of (C.S)-(C.7) can easily be generalized. As shown, when a ther-
mal noise voltage vn with a white spectrum Sv(f) is processed by a first-order fil-
ter with a transfer function
H(s) =
(C. 10)
(C.ll)
the result is a noise voltage vno with a lowpass spectrum. Its PSD has a 3-dB
bandwidth at f JdB = 1/(2"T), and a MS value
-
GaS
v2
;;:; --'
no
41"
The time constant 't determines the settling time of the system, since its transient
follows the e-th: response.
Assume next that the thennal noise source feeds a lowpass filter (active or passive)
whose voltage output is sampled on a capacitor C (Fig. C.3), at a clock rate Is' Let
the continuous-time transfer function H(...) from vn to v/l O when C is connected to
vna be given by (C.W). If the system must have an N-bit performance, then the
settling error of the LPF must be less than half an LSB. For a 2-phase system, this
requires that the condition
[/(21)
e
't
<2-(N+l)
Figure C.3: Noise signals in a sampled system.
(CI2)
423

APPENDIX C
Noise in Switched-Capacitor Delta-Sigma Data Converters
or equivalently
I 3dB
(N+I)lnZ
__ > ,,--,-:,=co
I,
1t
(C.l3)
be satisfied. For example, if N = 18, (Cl3) requires that hdB/I, > 4.Z. Thus,
the PSD of the H(,) block output will be heavily ahased. Due to folding, the spec-
trum of the sampled noise signal vno/n) will be very nearly white.t
The aliasing described increases the PSD of the noise significantly. The MS value
of the sampled signal vnos(n) remains the same as that of vnoU), since its samples
are taken from values of vIlO(t). Since vllo/n) is a (nearly) white noise, its PSD
can be found from
I/Z
(C.l4)
Since the low-frequency PSD of VII/f) is G5S I" the PSD has increased by a factor
II(Z<I,) , which by (C.IZ) is larger than (N+l)lnZ. For N = IS bits, the
noise power is magnified by a factor of 13.2, or 11.2 dB. This represents an inher-
ent disadvantage of sampled-data analog signal processors, such as switched-
capacitor and switched-current filters, as compared to continuous-time ones.
Note that in oversampled SCFs followed by a unity-gain-passband digital LPF, the
MS value of the oversampled noise is reduced by the OSR after digital filtering.
t. Another possible explanation for thiS phenomenon IS that under conditions (C.12)-(C.13) the
memory span of the LPF is much shorter than 1/f \.Hence, the samples of vm,(t) taken at limes
11/f, ' II '" I. 2,.
are very nearly uncorrelated. This property results in a white spectrum for
vnQ,(n) .
424

•·•
•!•!
Noise Effects In an SC Integrator
C.3 Noise Effects in an SC Integrator
Consider next the stray-insensitive SC integrator shown in Fig. CA. As shown, the
sampling instants nT, (n + 1)T, ... are at the end of the $. clock phases. For ideal
components, the input capacitor C1 samples the input voltage v in when $1 is
high, and stores a charge q1(n) = C1vin(n) at the end of the phase. During
$2 = 1, C1 discharges q1 into the virtual ground created by the op amp_ This
causes the charge stored in C 2 at the end of $2 to become
Hence, the output voltage vout satisfies
Next, we consider the noise contributed by the switches SI through 54 (Fig. C.S).
The only significant noise effect introduced by these switches is thermal noise. t
For simplicity, vin ;;;; 0 will be assumed. We shall first find the noise in vC1(n)
,
(C.15)
(C.16)
C2
Figure C.4: A stray-insensitive switched.capacitor integrator.
t. Since the current flow in these sWItches consists of short pulses occurring at the clock rate, the
1/f noise (which is caused by the trappmg and release of charge carriers occurring allong
intervals) has only negligible effect here.
425

APPENDIX C Noise In SWltched.capacltor Delta.Slgma Data Converters
due to the thermal noises generated in switches S 1 and 53. While <\)I is high, the
circuit containing C1 can be represented by the branch shown in Fig. C.Sa. Here,
the conducting switches SI and 53 have been replaced by their noise voltages and
on-resistances. As illustrated in Fig. C.5b, the noise voltages and resistors can be
pairwise combined. Assuming that all switches have the same Ron' the combined
switch resistance is 2Ron and (since vnI and vn3 are uncorrelated) the PSD of the
associated noise voltage vn is 4kT(2Ron ) = 8kTRon ·
The P5D of the noise voltage vel across C I can be expressed in terms of the PSD
of vn as follows:
(C.l7)
a)
C
Vn1 Ron1
1
~
Ron3
c)
r
Ron2
Cl
+ Vc1 -
Vn2 *
Ron4
- Vc2 +
v_
Vout
I
t
Figure C.S: Noise analysis for the integrator of Fig. CA.
--------
426

..--.
~
!
:5•iI
I
_!
Norse Effects in an SC Integrator
-- ---------------
where 'to :;:: 2RonC I is the time constant of the C I branch during I)ll
:;:: 1.
ScI(f) has a lowpass-filtered spectrum; it is no longer white_ Its de value is
8kTRoll ' while its 3~dB (half-power) frequency is roo = 1/'["0'
The total power (mean-square value) of vc1(t) can be obtained by integrating
Scl(f) for all frequencies from 0 to infinity. This gives
(C.IS)
which is independent of R
. The explanation is that the de value of the PSD is
on
,
proportional to Ron' while its bandwidth roo is proportional to 1/Ron' I The noise
chfrge
stored
in
C1
is
q 1(t) = C1Vel(t);
its
mean-square
value
is
CtkTIC,
~ kTC,_
At the end of the nth <ttl
:;:: 1 period (i.e., at t = nT), switches 51 and 53 will
open, and the charge q 1(n) is trapped in C1. The sequence q1(n), n :;:: 1, 2, ...
has the same mean-square value kTC I as ql(t), since it is constructed from the
samples of q t(t). However, due to the sampling, the P5D of q l(n) is nearly per-
fectly white. The reason for this is aliasing, as discussed in Section C.2.
Next, when $2 rises, switches S2 and 54 close. The resulting noisy circuit is shown
in Fig. C.Sc. To make the analysis more specific, we shall assume a single-stage op
amp represented by the model shown in Fig. C.6a, compensated by its capacitive
load. The diagram of Fig. C.6b Illustrates the resulting circuit during the time
when $2 is high. Note that the on-resistances and noise voltages of the two
switches have again been combined.
In the analysis of the circuit, it is reasonable to assume that the loop gain of the
stage satisfies the condition f)gI1lIRL»l, where B = C2/(C1+ C2); this is nec-
t. An alternative derivation appeals to the physical principle known as Equipartion of Energy.
which states that the average energy assocIated with any degree of freedom in a system at ther-
mal equilibrium is kT12 . For a capacitorS; charged to a voltage v. the electrical energy is
E = Cv2/2 andthusE = kT/2 impliesv2 = kT/C.
427

APPENDIX C
Noise In Switched-Capacitor Delta-Sigma Data Converters
cssary for suppressing nonlinear signal distortion caused by op-amp nonlinearity.
Under this condition, 1/RL = 0 may be assumed, and the calculation simplified.
Using the Laplace transfonn, the noise voltage across C1 may be found as
Vn(S)- Von(s)
1+ s't'
(C. 19)
where
(C.20)
Utilizing the results of Section C.2, the MS value of the C1 noise power caused by
the switch noise VII can be calculated:
a) +:t>-o
V
Voul
-
+
+0-
v-0-
r--~>~--jOvou!
12 9m1v 3:.RL
-
-
-
-
b)
.....-----<>---() VOUI
428
Figure C.6: Noise analysis for a single.stage amplifier,

Noise Effects In an SC Integrator
kT/C I
=
"-1-+""'\""'/""x
Here, the parameter x = 2Rongml was introduced.
The noise power in C I due to op-amp noise can also be found:
(C.21)
(C.22)
Consider next the total noise power stored in C t - At the end of clock phase <\)1' as
illustrated in Fig. C.Sh, C1 had acquired a noise voltage vel, I whose power was
given by (C.IS). During phase $2' the noise voltage becomes vel sw+vcl,o '
which have the noise powers given in (Co2l) and (C.22). The change In vcl duriKg
$2 is hence v 1
+ v 1
- vII' Since the three noise voltages are uncorre-
e
,SW
c __1op
c,
lated, their powers are adaed. Hence, the total noise power is
= kT(I+_x_+ 4/3) = kT(7/3 + 2X) = 2kT(1+ 1/6)
C1
l+x
l+x
C1
l+x
C1
l+x
(C.23)
••
The total noise power is mmimized, and becomes 2kT/ C l' if x» I , i.e. if the
condition gmt »l/Ron holds. Under these conditions, all of the noise is contnb-
uted by the switches. The absence of noise from the op amp is due to the fact that
(as (C.4) shows) the input-referred noise of the op amp is inversely proportional to
gml·
For a given capacitor size (i.e. for a fixed C 1), the above condition yields the min-
imum achievable noise. For a circuit whose area is dominated by its capacitors,
this condition corresponds to the minimum-area solution. However, since realizing
a large value of gml requires a large current, the most power-efficient solution is
the one which minimizes gml subject to constraints on the noise (C.23) and the
settling time (C.20). Combining these relations leads to
---_._----- ---ccc--
429

APPENDIX C Noise In Swltched-eapacltor Delta-Sigma Data Converters
gmt
kT
= ~(7/3+2x),
tv2cl
(C.24)
which is clearly minimized for x = 0, i.e. for vanishingly-small switch resistance.
Since, according to (C.23), the total noise power associated with this solution is
2.33kT/ C l' the size of C I in the minimum-power configuration is only about
17% larger than the size of C 1 in the minimum-area configuration.
From (C.23), the mean-square noise charge stored in C1is given by
'2 = kTC (7/3 + 2X)
qcl
1
l+x
(C.25)
Since C 1 and C2 become series-connected as $2 rises, C2 acquires the same noise
charge power as Ct. Hence, the added noise charge for C2 is qc2 = qcI' and the
MS noise voltage of C2 is increased by
(,',v
)2 = kTC1(7/3 + 2.<)
c2
C2
1 + x
2
during each $2 clock phase.
(C.26)
It is often useful to represent the effect of the noise source in a stage by one or
more equivalent voltage sources at the input and/or output of an otherwise ideal
and noiseless circuit. As discussed above, the effect of thennal noise in the transis-
tors of the switches and the op amp in an SC mtegrator is an added noise charge
qc2' with an MS value given in (C.25). In a nOIseless and ideal SC integrator, this
charge can be delivered into C2 by connecting an equivalent noise voltage source
v
"
to the input of the integrator. The MS value of v
.
is the same as that of
II,
I
II, In
Vel' given in (C.23); VII, In is a sampled-data signal with a white spectrum.
430

Noise Effects In an SC Integrator
Frequently, there are several SC input branches in an integrator. Assuming for sim-
plicity that gml »1/ROil' the total noise charge contributed by the switched input
capacitors Cla' Clb' ... to Cz is given by
(C.27)
i,
j
I
j'
I!
Thus, a large input capacitor contributes more noise than a small one.
In the input stage of an SC delta-sigma loop, it is possible to use either a single
capacitor to enter both input and DAC signals, or to use two separate ones. As
(C.2?) demonstrates, the latter solution introduces twice as much thermal noise
power as the first one, so the SNR is reduced by 3 dB. It may, however, reduce sig-
nal-dependent disturbances in the DAC reference voltage.
The input-referred noise source V'I, in models the noise charge entering C2 in every
clock period, and hence the noise voltage vc2' However, the output voltage is the
sum of vc2 and the voltage v_at the inverting input tenninal of the op amp
(Fig. C.Sc).
During
'PI = I,
when
the
output
voltage
is
sampled,
v_ = vout = v'out' Thus the circuit is in a unity-gain configuration, and the MS
value of v_may be obtained from (C.9). Since v_is added only to the output volt-
age, it may be represented by an output-referred sampled-data voltage source
VII,OII/
:;:
V_. The MS value of vn, out is given by (e.9); for the op-amp represen-
tahon of Fig. C.6a, Co:;: Cload should be used. The overall model of thennal
noise effects is shown in Fig. C.?, where the center box represents an ideal SC
integrator.
As will be illustrated in the example given below, the effect of vn out is usually
negligible compared to that of vn, in' Hence, the relative contributions of the
V,nO
~ I ~,out
0
Vout
Figure C.?: Equivalent noise sources for the integrator of Fig. C.4.
431

APPENDIX C Noise In Swltched-Capacltor Della-SIgma Data Converters
switches and the op amp to the integrator noise can be predicted from (C.23), as
functions of x
~ 2Rongml . The resulting curves are shown in Fig. C.8. As the
curves illustrate, the noise due to the op amp is comparable to the noise due to the
switches when x is small, but when x is large the switch noise dominates.
The described noise calculations assume single-ended circuit configurations. They
can, however, be easily adapted to fully-differential configurations by splitting all
calculated capacitances in half, and assigning them to the positive and negative
side of the circuits. Although this causes the thennal noise to increase by 3 dB for
each side, or by 6 dB in the differential mode, this is balanced out by the fact that
the signal range is also increased by 6 dB.
The total device size is nearly the same for both configurations. Differential cir-
cuits need a slightly larger area for common-mode feedback control and additional
interconnections. However, the differential configuration is preferable due to its
robustness to extrinsic (common-mode) noise and linearity enhancement proper-
ties (suppression of even harmonics).
10
100[j~J=:~·:··:··t··:·::~~=:"::··f··::··:·~··~·~··:··T3
,oov.s'I---~~~
'6
~'"i·"~~~·l···· .:
.;
.;
:',...
. ;.
Z
:~~~~:f~:~:f.~~~~~·~.·~~~~~
~~~~~~ ~~ :.'~
°0~~--;2~--'---4:---'---;~~"
8'
x
::::: 2Rongm 1
Relative contributions from the switches and op amp to the
total integrator thermal noise.
Figure e.S:
432

I
Integrator Noise AnalysIs Example
Finally, it should be noted that the noise estimation process discussed above
remains a good approx.imation up to a frequency (() = BgmI/ Co even if the op-
amp model includes an output capacitance Co in parallel with RL (Fig. C.6).
C.4 Integrator Noise Analysis Example
The following example illustrates how to calculate the output noise for the integra-
tor shown in Fig. C.4, given some specific values. It is assumed that C I ;:: I pF,
C2 :: 1 pF and CL = 0.5 pF. The switches have an on-resistance of 250 Q, so
2Ron
=:; 500 Q. The amplifier is an OTA with transconductance gm = 4 rnA/V
and output impedance RL ;;:: 250 kQ. Hence, the de gain is A = 60 dB . The
clock frequency is Is = 100 MHz. Note that both time constants 2RonC I and
Co/(pgm)
are 0.5 ns, and thus
ZO times smaller than
the clock period
1/f s ;
10 ns . This should guarantee adequate settling accuracy for the stage.
The PSD of the output referred noise is given by
(C.28)
In this equation, the power of the input referred noise source vn. ill is given by
(eZZ), while that of the output referred noise source vn, out is given by (e.9).
SVIIl (SVOllt) is obtained dividing the power of v" in (VII out)by /5/ 2 .
,
,
In (C.Z8), H(z) is the integrator transfer function. It can be found using available
SC analysis programs, such as SWITCAP, or analytically, as shown below. For the
integrator with a finite~gain op amp, H(z) is given by [5]:
k -I
H(z) =
Z
1+~(l+k)-(I+~)Z-1
(C.29)
The parameter k is the integrator gain factor; here, k = C I/ C2 = 1. Also,
~ ; 1/A = 10-3. The parameter x in the input-referred
noise source is
x = 2g R
= 2.
m
011
-_.._----------------
433

APPENDIX C Noise In Swltched-Capacitor Delta-Sigma Data Converters
-
The output referred noise power can be calculated by integrating the output PSD in
the signal band, from 0 to I B = 1/(20SR) . The resulting equation is very com-
plicated, and tedious to calculate manually. However, a symbolic analysis tool,
such as Maple™
[6], can be used for this calculation. The integrated noise power is
then found to be
(C.30)
Alternatively, the output noise power can be simulated by a dedicated CAD tool
such as SpectreRF [7]. This circuit simulator has built-in analysis routines that can
handle discrete-time circuits.
.1
Fig. C.9 shows the calculated and simulated output noise powers, as functions of
Is' It also shows the noise contribution of v
I' which is negligible here for all
n,OU
values of f B shown, as predicted earlier. The good agreement between the calcu-
Vn.m contribution
•• N
~~~
••. ""n
•• , .,,,.
Vn,OI.II contnbution
l..::"'-~~"""+"""'-::'~,£I
4
2
3
x10-6
s rc-=,...,..-c..",,,-.. -,.-c..co",.•-c.c:."'...:::......,-,..-c.."-'....",."
Ir'-'=';:;'-'.."""'··,,·
: :::::: : :::::::
-
Simulated
;:;;;:
-
Calculated
::;'
o
102
103
104
105
106
107
Is (Hz)
Calculated and simulated integrated noise powers at the
output of the integrator.
Figure C.9:
434

•;
I
I
Noise Effects in Delta-5lgma ADC Loops
tated noise and the simulated one verifies the accuracy of the theory discussed ear~
lier.
C.5 Noise Effects in Delta-Sigma ADC Loops
Once all noise sources have been identified and their power spectral densities cal-
culated, the next step is to find their contributions to the overall noise performance
of the delta-sigma ADC. This depends on the location of the noise source in the
loop (which determines how its PSD is shaped), and on the oversampling ratio
(which specifies the signal bandwidth).
To determine how the PSD is shaped, the transfer function from its source to the
input (determining the input-referred noise PSD) may be calculated. Alternatively,
the output-referred noise transfer function can be calculated. The input-referred
noise transfer function can be obtained by dividing the output-referred one by the
signal transfer function (STF). Since the signal transfer function STP typically has
a flat inband magnitude response, the input- and output-referred noise PSDs are
usually close to each other. Often, the input-referred noise is easier to estimate [8)
than the output-referred onc.
The in-band noise power can then be found by integrating the shaped PSD QYer the
desired bandwidth. Denoting the noise power of the jlh noise source by
v~, and
assuming that all noise sources provide sampled white noise, the PSD of the {Duree
is
(C.3l)
and hence the inband portion of the output noise power due to the /t. noise source
is given by
2 (/(20SRl_
v 2 = _
v2 'INTF(fJ[2dj
OJ
is 0
J
J
(C.32)
._----
435

APPENDIX C Noise In Switched-Capacitor DeI~Slgma Data Converters
where NTFj is the transfer function from thefh noise source to the output.
After the in-band noise power has been calculated for all noise sources, the total
noise is obtained by adding all their contributions:
N
v; = L vJ
j = 1
Finally, the maximum SNR of the system is given by;
(C.33)
(C.34)
where v;IQX is the maximum signal power, and V~t is the total noise power due to
all intrinsic and extrinsic sources. The total noise power is thus
~=;2+;2+;2+~
lit
nq
sw
oa
ex
(C.35)
This expression includes the noise contributions of the quantization noise (vllq ),
switch noise (vSIV)' op-amp thennal noise (vva) and all external noise sources
(vex). The latter tenn can include, for example, noise generated in the digital sec-
tion of the chip.
When designing a delta-sigma ADC, it is important to find a good balance between
the contributions of all noise sources. A good balance means that all noise sources
are scaled in a way that makes the circuit implementation economical. For exam-
ple, if the quantization noise power takes up 90% of the total noise budget, then the
capacitor sizes that satisfy the remaining 10% kT/ C noise target could be exces-
sively large, resulting in large chip area and power consumption. In addition, a
large quantization noise power is not desirable. Its behavior is not truly random,
and this may compromise the noise performance in certain applications, such as in
high-fidelity audio systems. This may occur since, under some circumstances, the
436

!I
i•
1 i
"I
I
'i
• i
Noise Effects in Delta-Sigma ADC Loops
human ear can detect tones even with amplitudes as much as 20 dB below the total
noise level. Hence, usually the thermal noise is allowed the largest share in the
budget. An example of a reasonable noise budget is shown in Fig. C.IO.
For most applications, OSR» I, and hence the first integrator dominates the ther-
mal noise contributions. The remaining noise sources have their PSDs attenuated
by at least the first integrator gain, so their contributions are usually negligible.
However, this is nol true for very low OSR (wide bandwidth) applications, because
then the gain of an integrator is low at the high end of the signal band, and so the
noise is not significantly attenuated.
As an example, we shall find next the thermal noise in a delta-sigma ADC using
the feedforward topology. Consider the second-order modulator loop shown in
Fig. C.II. We shall calculate the capacitor sizes that satisfy a specified total noise
target.
The first step is to identify the thermal noise sources in the topology. There are five
switched-capacitor branches: one in the first integrator, another in the second inte-
grator, and the remaining ones in the adder preceding the quantizer. Also, there are
two op amps, one in each integrator.
An equivalent representation of the noise sources associated with these devices is
shown in Fig. C.ll. As the Figure shows, there are three distinct points in the
••
Quantization
error (5%)
Figure C.lO: Noise budget.
437

APPENDIX C Noise In Swltched·Capacltor Delta-5lgma Data Corwerters
topology where noise is generated. The sources representing the output referred
op-amp noise are not included since their contributions are negligible.
This leads to the second step, which is to calculate the PSDs of the noise generated
at each of these points. The noise at the input of the first integrator contains a con-
tribution from the sampling capacitor, and also from the op-amp input-referred
thennal noise:
v2 ; (kT). (7/3+2x)
nil
Cs1
(1 +x)
.
(C.36)
The parameter x was introduced previously as x = 2Rongml . It will be assumed
here that x = 2, which corresponds to equal contributions to the settling error by
the switched-capacitor branches and the op amps.
The input of the second op amp contains the noise power
v2
; (kT). (7/3+2x)
nil
C
(l+x)'
,2
(C.37)
The noise contributions of the three switched-capacitor branches in the adder can
be combined into an equivalent noise power:
H(z) t-+--t+
H(z) I---t
Q
~_v
'----<O.ACI+------------'
Figure C.ll: Noise sources in the feedforward topology.
438

Noise Effects In Delta-Sigma ADC Loops
Since all these sources generate sampled white noise, it follows that their PSDs are
given by their MS values divided by f /2.
The third step is to calculate the gain responses from each of these sources to the
output. Again, this can be done using dedicated SC analysis programs. or analyti-
cally. Here we shall do the latter. Note that the integrators blocks, denoted by
H(z), are delaying (forward-Euler) structures, with transfer functions:
H(z) =~.
1- z-
(C38)
(C39)
The noise transfer function from the input of the first integrator to the output of the
modulator is
(C40)
The NTF from the input of the second integrator is
(C.41)
Finally, the NTF from the output of the se.cond inl,;,grator is
(CA2)
The frequency responses can be found by substituting z = ej2rtf/'. The results are
illustrated in Fig. C.l2. which indicates that (as expected) at low frequencies
NTFil dominates the other gain responses.
439

1
APPENDIX C
Noise in Switched-CapacItor Delta-Sigma Data Converters
-----------------------------
The fourth step is to integrate each noise PSD in the band of interest. Again, to
save time, it is recommended that a symbolic analysis tool be used for these calcu~
lations. The resulting output noise powers are:
(C.43)
(C.44)
-2 _-2[6
2.(,,) (") 8'(")J
N 02 -
vno3 OSR +jtsm asH. cos OSR -jtsm OSR
(C.4S)
Finally, the total (kT)/C and op-amp thermal noise power can be found as the
sum of all these contributions:
.................
.... - ... -.. .;..... -:-
t:~bd;d~2~B:··:·J·':' t~:8~;d
t
,,,,- INTFi~( ei2~if
aa
0.1 ~-6~2
'
0:3
'
0:4
0.5
Normalized Frequency
Frequency responses of the noise transfer functions.
12
"
"0a'c
8
Ol
'"
::;;
4
Figure C.12:
440

Noise Effects In Delta-Sigma ADC Loops
As a numerical example, assume that this loop operates with an oversampling ratio
of OSR ;;;; 256. its maximum input signal power is 1 V2, and a 16-bit perfor-
mance
is
required.
Then
the
total
pennissible
noise
power
is
Ntotal ;;;; 12.5
~ms .
IIl
!
-
-
--
Niota/ ::: Nfl +Nfl + N~2
(C.46)
Replacing OSR ::;: 256 in the previous equations, we get for the total thennal
noise power:
= 8.25xlO-3~T +5.88xlO-7 ~T + 1.42xlO-10~T
sl
s2
f1
(C.47)
This expression shows that capacitors Cs2 and C 1 have a negligible contribution
to the total noise power, so they will be ignored. this makes sense, since the noise
of these capacitors is shaped by first- and second-order high-pass transfer func-
tions, and the Dversampling ratio is large.t
By allotting to the thennal noise 75% of the total noise power (Ntotal )' the value
of Cs 1 becomes
-3
kT
= 8.25xlO
2
- 0.29 pF
O.75Ntotal
(C.48)
~
"•
iii
~
I
t.
As mentioned in Section C.l, it can be expected that the effects of flicker noise are
much less than those due to thermal noise. If this is not the case, techniques such as
correlated double sampling [3) can be used to suppress the 1/f noise in the first-
stage output signaL
In the cases where more than one capacitor significantly contributes to the total noise, an optimi-
zation algorithm can be used to find the minimum capacitor sizes that satisfy the noise target,
and result in minimum total capacitance.
44\

APPENDIX C
Noise In Swltched.Capacltor Delta-Sigma Data Converters
References
[1]
N. K Verghese, TJ. Schmerbeck and D.J Allstot, SimI/lotion Techlllques and Solutions for
Mixed-Signal Coupling in /megrated Circuits, Kluwer Academic Publishers, Boston, 1995.
[2]
D. Johns and K.W. Martin, Analog/ntegrated Circuits, Wiley, New York, 1997.
[3J
C. Enz and G.C. Ternes, "Circuit techniques for reducing the effects of op-amp
imperfections," Proceedings ofthe JEEE, vol. 84, no. 11, Nov. 1996, pp. 1584-1614.
[4]
R. Gregorian and G.c. Ternes, Analog MOS Integrated Circuits for Signal Processing,
Wiley, New York, 1986, Sec.7.4.
[5]
W. Ki and G. C. Ternes, "Offset~compensaled switched-capacitor integrators," International
Symposium on Circuits arul Sy~tems, May 1990, vol. 4, pp. 2829-2832.
[6]
AHeck, Introduction to Maple, Springer Verlag, 2003.
(7J
K. Kundert, "Simulating switched-capacitor filters with SpeclreRF,"
http://www.designers-guide.com/Analysis/sc-filters.pdf.
[8]
G. C. Ternes and J. Silva, "Simple and efficient noise estimation algorithm," Electronics
Letters, vol. 40, no. II, May 27,2004, pp. 640-641.
442

1I•
Index
A
ABeD matrix 271,401,410
Accumulate-and-dump 57
Autocorrelation function 383
B
BandpassADC 141,326
Bandpass modulator 13
center frequency selection 145
NTF 142,145
OSR defimtion 142
spectrum 147
topology 151
c
C model, modulator 343
CapacitIve T 307
Cascade 10
Chaotic modulator 53
Chopper stabilization 419
Circuits
clock generator 297
comparator 297
current-mode DAC 323
DAC latch 323
low-power comparator 326
opamp 294
two-stage amplifier 325
Clock generator 297
Comb filter 55
Comparator 297
Conditional stability 101
Continued fraction expansion 47
Continuous-time modulator 161, 205
comparator delay in 214
Jitter 215
STF 211
feedback delay 318
Correlated double sampling (CDS) 419
D
DAC
based on MODI 34
cahbraled 237
delta-sigma 16, 220
digitally-corrected 237
dual·truncation 230
example 252, 253
multi-bit 229
segmented 234
segmented and scrambled 235
single-stage 223
443

Index
Data-weIghted averaging 189
Dead band 51
Dead zones, MODI 51
DeCImation filter 54
Decimation, MOD2 86
Delta modulation 4
Digital correction 199
Direct charge transfer stage 251
Discrete Fourier transform 365
Dither 45
Dynamic element matching 184,404
Dynamic range scahng 266,268, 300, 402
E
Effective number ofbits (ENOB) 3,9, 10
Element rotatIOn 189
Error-feedback structure 35,81,224
Excess loop delay 215
F
Fast Founer Transform, see FFT 365
Feedbackdelay 318
FeedfOlward topology 309
FFT
averaging 377
bins 365
noise leakage 370
requIred length 372
scaling 373
signal leakage 371
smoothing 377
Figure ofmerit, ADC 357
Filter
architectures 247
Bessel 248, 249
half-band 242
interpolation 239
reconstruction 243
Finite op-amp gain In MODI 50
Flicker noise 418
Folded-cascode op amp 294
Fourier transform, definition 365
Full scale 24
G
General modulator structure 92
H
Haltband filter 87
design 405
444
Halfband filter simulation 408
History ofdelta-sigma 17
Hogcnauer structure 88
I
Image gain 345
Image rejection ratio (IRR) 168
Image rejection, function ofamplitude and phase
error 168
Image transfer function 171
Impulse response check 277,290,310
IndiVIdual-level averaging 191
Infimty nonn 99
Inherent anti-aliasing 206,212,319,333
Inherent linearity 7
Instability detection 311
Integrator, noise 425
Integrator, SC 245, 274, 300, 316
Interpolation filter 220,239,344
K
kTte noise 280
L
Least significant bit (LSB) 23
Lee criterion 98
Leslie-Smgb structure 123
Lmear interpolator 347
Loop filter
arbitrary NTF and STF 92
differentiating NTF 93
Lossless discrete integrator (LDJ) 155
M
MASH 10,17,127,182,226,311
2-stage 127
3-stage 131
noise leakage 132
Mismatch shaping 15,186,232
second order
195, 198
first order 189,198
individual-level averaging 191
tree structure 196
vector-based 192
Mixer 328
MODI
ADC 29
DAC 34
dc input 41
dead zones 51
MOl
MO
MO
MO
M~
M~
M~
Mol
Mol
N
NB'
Noi:
Noil

I
MODI (cont'd)
finite op-amp gain 50
geometric interpretation 45
irratIOnal input 44
linear model 36
NTF 37
rational input 43
robustness 32
simulation 38
8QNR 38
SQNR VS. input amplitude 40
stabihty 49
STF 37
tones 42,48
MOm from MODI 64
MOD2
Boser-Wooley structure 79
dead zones 77
decimation 86
distortion 71
error-feedback structure 81
harmonic distortion 71
in-band noise power VS. de input 73
linear model 64
NTF 64
NTF zero optimization 84
optimal 84
output spectrum 68
quanllzer gain 68,71
SC reahzation 283
Sllva-Steensgaard structure 80
SQNR 65
SQNR vs input amplitude 70
SQNR VS. OSR 66
stability 74
MOOn
NTF pole optimization 11\
NTF zero optimization 107
SQNR VS. OSR 112
stability 97
Modulator, ADC or DAC 30
Modulator, dual-quantizer 182
Modulator, simulation 396
Multi-bit modulator 179
Multi-stage modulator, see MASH
N
NBW, arbitrary window function 386
Noise bandWidth (NOW) 39, 376,386
Noise budget 437
Noise leakage 132
Noise shaping 6
Noise transfer function (NTF) 8
Noise, kT/C 280, 292, 301,427
Noise, op amp 419
N·path transformation 149
NTF zero optimization
NTF
as a function ofquantizer gam 69
cookbook procedure 113
function ofquantizer gain 100
pole optimization III
realization 266
realizability constraint 97
realization 400
stability constraint 97
synthesis 257, 393
zero optimization 85, [07
o
Op amp, finite gain 50, 77, 315
Op amp, folded cascode 294
OSR 8
OSR, bandpass modulator 142
OSR, quadrature modulator 144
Overload 10
Oversampling ratio 8
p
Positively invariant set 409
Post-filler, DAC 243
Power spectral density (PSD) 7, 38, 266, 383
Q
Quadrature ADC 144
Quadrature filter 169
Quadrature filter, mismatch 170
Quadrature mixing 166
Quadrature modulator 172
definition ofOSR 144
NTFI72
spectrum 174
Quadrature resonator 172
Quadrature signal 166
Quantization 21
Quantization error 23
Quantization noise 21
FFTof25
Quantizer gain 22
Quantizer gain, binary 29
445

Index
Quantizer transfer curve (QTC) 71
Quantizer,
binary 28
bipolar 23
mid-rise 22
mid-tread 22
overload 10
unipolar 22
R
Ranonal ofbest approximation 47
Realizability constraint 96
Realization 400
Receiver 140,326
Reconstnlction filter 243
Reset 98, 311
Resonator
2-path 156
active-RC 159
delaying integrators 119
Gm-C 159
LC 160
Lor 119,155
SC 275
Root locus 100
S
Scaling 288
Sigma delta vs. delta sigma 7
Signal leakage 371
Signal to quantization noise ration (SQNR) 38
Sine filter 55
Hogenauer structure 88
image attenuation 346,350
two-stage 58
Single-bit quantization 7
Slewing 294
446
SQNR limits
I-bit modulators I [2
2-bit modulato~ 113
3-bit modulators 113
SQNR simulation 299
SQNR prediction 395
Stability 409
invariant set method 409
Lee criterion 98
Stability, multi-bit modulator 104
Stable input range 97
STF
continuous-time modulator 211
example continuous-time bandpass 333
maximally-flat, all-pole 261
Superheterodyne 326
T
Thennal noise, MOSFET 418
Thennal noise, resistor 418
Timing 276, 286
Timing check 304
Topology
feedback 115
feedfolWard i21,303
Two-path transfonnatLon 149
V
Verification 289
W
White noise approximation 8
Window
Hann 368
rectangular 366
Windowing 265, 366
r
.1i
i..
•iI
Ii
i=
iI-
"'!I
~I

