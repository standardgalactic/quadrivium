
C O N C R E T E
M A T H E M A T I C S
Second Edition
Dedicated to Leonhard Euler (1707{1783)

A Foundation for Computer Science

C O N C R E T E
M A T H E M A T I C S
Second Edition
Ronald L. Graham
AT&T Bell Laboratories
Donald E. Knuth
Stanford University
Oren Patashnik
Center for Communications Research
6
77
ADDISON-WESLEY PUBLISHING COMPANY
Reading, Massachusetts
Menlo Park, California
New York
Don Mills, Ontario
Wokingham, England
Amsterdam
Bonn
Sydney
Singapore
Tokyo
Madrid
San Juan
Milan
Paris

Library of Congress Cataloging-in-Publication Data
Graham, Ronald Lewis, 1935-
Concrete mathematics : a foundation for computer science / Ronald
L. Graham, Donald E. Knuth, Oren Patashnik. -- 2nd ed.
xiii,657 p.
24 cm.
Bibliography:
p. 604
Includes index.
ISBN 0-201-55802-5
1. Mathematics.
2. Computer science--Mathematics.
I. Knuth,
Donald Ervin, 1938-
.
II. Patashnik, Oren, 1954-
.
III. Title.
QA39.2.G733 1994
510--dc20
93-40325
CIP
Reproduced by Addison-Wesley from camera-ready copy supplied by the authors.
Copyright c‚Éù1994, 1989 by Addison-Wesley Publishing Company, Inc.
All rights reserved. No part of this publication may be reproduced, stored in a
retrieval system, or transmitted, in any form or by any means, electronic, mechan-
ical, photocopying, recording, or otherwise, without the prior written permission
of the publisher. Printed in the United States of America.
1 2 3 4 5 6 7 8 9 10{MA{9897969594

Preface
THIS BOOK IS BASED on a course of the same name that has been taught
\Audience, level,
and treatment|
a description of
such matters is
what prefaces are
supposed to be
about."
|P.R.Halmos [173]
annually at Stanford University since 1970. About fty students have taken it
each year | juniors and seniors, but mostly graduate students | and alumni
of these classes have begun to spawn similar courses elsewhere. Thus the time
seems ripe to present the material to a wider audience (including sophomores).
It was a dark and stormy decade when Concrete Mathematics was born.
Long-held values were constantly being questioned during those turbulent
years; college campuses were hotbeds of controversy. The college curriculum
itself was challenged, and mathematics did not escape scrutiny. John Ham-
mersley had just written a thought-provoking article \On the enfeeblement of
mathematical skills by `Modern Mathematics' and by similar soft intellectual
trash in schools and universities" [176]; other worried mathematicians [332]
even asked, \Can mathematics be saved?" One of the present authors had
\People do acquire a
little brief author-
ity by equipping
themselves with
jargon: they can
ponticate and air a
supercial expertise.
But what we should
ask of educated
mathematicians is
not what they can
speechify about,
nor even what they
know about the
existing corpus
of mathematical
knowledge, but
rather what can
they now do with
their learning and
whether they can
actually solve math-
ematical problems
arising in practice.
In short, we look for
deeds not words."
|J.Hammersley [176]
embarked on a series of books called The Art of Computer Programming, and
in writing the rst volume he (DEK) had found that there were mathematical
tools missing from his repertoire; the mathematics he needed for a thorough,
well-grounded understanding of computer programs was quite dierent from
what he'd learned as a mathematics major in college. So he introduced a new
course, teaching what he wished somebody had taught him.
The course title \Concrete Mathematics" was originally intended as an
antidote to \Abstract Mathematics," since concrete classical results were rap-
idly being swept out of the modern mathematical curriculum by a new wave
of abstract ideas popularly called the \New Math." Abstract mathematics is a
wonderful subject, and there's nothing wrong with it: It's beautiful, general,
and useful. But its adherents had become deluded that the rest of mathemat-
ics was inferior and no longer worthy of attention. The goal of generalization
had become so fashionable that a generation of mathematicians had become
unable to relish beauty in the particular, to enjoy the challenge of solving
quantitative problems, or to appreciate the value of technique. Abstract math-
ematics was becoming inbred and losing touch with reality; mathematical ed-
ucation needed a concrete counterweight in order to restore a healthy balance.
When DEK taught Concrete Mathematics at Stanford for the rst time,
he explained the somewhat strange title by saying that it was his attempt
v

vi
PREFACE
to teach a math course that was hard instead of soft. He announced that,
contrary to the expectations of some of his colleagues, he was not going to
teach the Theory of Aggregates, nor Stone's Embedding Theorem, nor even
the Stone{Cech compactication. (Several students from the civil engineering
\The heart of math-
ematics consists
of concrete exam-
ples and concrete
problems."
|P.R.Halmos [172]
department got up and quietly left the room.)
Although Concrete Mathematics began as a reaction against other trends,
the main reasons for its existence were positive instead of negative. And as
the course continued its popular place in the curriculum, its subject matter
\solidied" and proved to be valuable in a variety of new applications. Mean-
while, independent conrmation for the appropriateness of the name came
from another direction, when Z. A. Melzak published two volumes entitled
\It is downright
sinful to teach the
abstract before the
concrete."
|Z.A.Melzak [267]
Companion to Concrete Mathematics [267].
The material of concrete mathematics may seem at rst to be a disparate
bag of tricks, but practice makes it into a disciplined set of tools. Indeed, the
techniques have an underlying unity and a strong appeal for many people.
When another one of the authors (RLG) rst taught the course in 1979, the
students had such fun that they decided to hold a class reunion a year later.
But what exactly is Concrete Mathematics? It is a blend of continuous
Concrete Mathe-
matics is a bridge
to abstract mathe-
matics.
and discrete mathematics. More concretely, it is the controlled manipulation
of mathematical formulas, using a collection of techniques for solving prob-
lems. Once you, the reader, have learned the material in this book, all you
will need is a cool head, a large sheet of paper, and fairly decent handwriting
in order to evaluate horrendous-looking sums, to solve complex recurrence
relations, and to discover subtle patterns in data. You will be so uent in
algebraic techniques that you will often nd it easier to obtain exact results
than to settle for approximate answers that are valid only in a limiting sense.
The major topics treated in this book include sums, recurrences, ele-
\The advanced
reader who skips
parts that appear
too elementary may
miss more than
the less advanced
reader who skips
parts that appear
too complex."
|G. Polya [297]
mentary number theory, binomial coecients, generating functions, discrete
probability, and asymptotic methods. The emphasis is on manipulative tech-
nique rather than on existence theorems or combinatorial reasoning; the goal
is for each reader to become as familiar with discrete operations (like the
greatest-integer function and nite summation) as a student of calculus is
familiar with continuous operations (like the absolute-value function and in-
nite integration).
Notice that this list of topics is quite dierent from what is usually taught
nowadays in undergraduate courses entitled \Discrete Mathematics." There-
fore the subject needs a distinctive name, and \Concrete Mathematics" has
proved to be as suitable as any other.
(We're not bold
enough to try
Distinuous Math-
ematics.)
The original textbook for Stanford's course on concrete mathematics was
the \Mathematical Preliminaries" section in The Art of Computer Program-
ming [207]. But the presentation in those 110 pages is quite terse, so another
author (OP) was inspired to draft a lengthy set of supplementary notes. The

PREFACE vii
present book is an outgrowth of those notes; it is an expansion of, and a more
leisurely introduction to, the material of Mathematical Preliminaries. Some of
the more advanced parts have been omitted; on the other hand, several topics
not found there have been included here so that the story will be complete.
The authors have enjoyed putting this book together because the subject
began to jell and to take on a life of its own before our eyes; this book almost
\. . . a concrete
life preserver
thrown to students
sinking in a sea of
abstraction."
|W. Gottschalk
seemed to write itself. Moreover, the somewhat unconventional approaches
we have adopted in several places have seemed to t together so well, after
these years of experience, that we can't help feeling that this book is a kind
of manifesto about our favorite way to do mathematics. So we think the book
has turned out to be a tale of mathematical beauty and surprise, and we hope
that our readers will share at least œµ of the pleasure we had while writing it.
Since this book was born in a university setting, we have tried to capture
the spirit of a contemporary classroom by adopting an informal style. Some
people think that mathematics is a serious business that must always be cold
and dry; but we think mathematics is fun, and we aren't ashamed to admit
the fact.
Why should a strict boundary line be drawn between work and
play? Concrete mathematics is full of appealing patterns; the manipulations
are not always easy, but the answers can be astonishingly attractive. The
joys and sorrows of mathematical work are reected explicitly in this book
because they are part of our lives.
Students always know better than their teachers, so we have asked the
rst students of this material to contribute their frank opinions, as \grati"
Math grati:
Kilroy wasn't Haar.
Free the group.
Nuke the kernel.
Power to the n.
N=1 ‚áíP=NP.
in the margins.
Some of these marginal markings are merely corny, some
are profound; some of them warn about ambiguities or obscurities, others
are typical comments made by wise guys in the back row; some are positive,
some are negative, some are zero. But they all are real indications of feelings
that should make the text material easier to assimilate. (The inspiration for
such marginal notes comes from a student handbook entitled Approaching
Stanford, where the ocial university line is counterbalanced by the remarks
of outgoing students. For example, Stanford says, \There are a few things
I have only a
marginal interest
in this subject.
you cannot miss in this amorphous shape which is Stanford"; the margin
says, \Amorphous . . . what the h*** does that mean? Typical of the pseudo-
intellectualism around here." Stanford: \There is no end to the potential of
a group of students living together." Grato: \Stanford dorms are like zoos
without a keeper.")
The margins also include direct quotations from famous mathematicians
This was the most
enjoyable course
I've ever had. But
it might be nice
to summarize the
material as you
go along.
of past generations, giving the actual words in which they announced some
of their fundamental discoveries. Somehow it seems appropriate to mix the
words of Leibniz, Euler, Gauss, and others with those of the people who
will be continuing the work. Mathematics is an ongoing endeavor for people
everywhere; many strands are being woven into one rich fabric.

viii PREFACE
This book contains more than 500 exercises, divided into six categories:
I see:
Concrete mathemat-
ics means drilling.
‚Ä¢
Warmups are exercises that every reader should try to do when rst
reading the material.
‚Ä¢
Basics are exercises to develop facts that are best learned by trying
one's own derivation rather than by reading somebody else's.
The homework was
tough but I learned
a lot. It was worth
every hour.
‚Ä¢
Homework exercises are problems intended to deepen an understand-
ing of material in the current chapter.
‚Ä¢
Exam problems typically involve ideas from two or more chapters si-
multaneously; they are generally intended for use in take-home exams
Take-home exams
are vital|keep
them.
(not for in-class exams under time pressure).
‚Ä¢
Bonus problems go beyond what an average student of concrete math-
ematics is expected to handle while taking a course based on this book;
Exams were harder
than the homework
led me to expect.
they extend the text in interesting ways.
‚Ä¢
Research problems may or may not be humanly solvable, but the ones
presented here seem to be worth a try (without time pressure).
Answers to all the exercises appear in Appendix A, often with additional infor-
mation about related results. (Of course, the \answers" to research problems
are incomplete; but even in these cases, partial results or hints are given that
might prove to be helpful.) Readers are encouraged to look at the answers,
especially the answers to the warmup problems, but only after making a
serious attempt to solve the problem without peeking.
Cheaters may pass
this course by just
copying the an-
swers, but they're
only cheating
themselves.
We have tried in Appendix C to give proper credit to the sources of
each exercise, since a great deal of creativity and/or luck often goes into
the design of an instructive problem.
Mathematicians have unfortunately
developed a tradition of borrowing exercises without any acknowledgment;
we believe that the opposite tradition, practiced for example by books and
magazines about chess (where names, dates, and locations of original chess
problems are routinely specied) is far superior. However, we have not been
Dicult exams
don't take into ac-
count students who
have other classes
to prepare for.
able to pin down the sources of many problems that have become part of the
folklore. If any reader knows the origin of an exercise for which our citation
is missing or inaccurate, we would be glad to learn the details so that we can
correct the omission in subsequent editions of this book.
The typeface used for mathematics throughout this book is a new design
by Hermann Zapf [227], commissioned by the American Mathematical Society
and developed with the help of a committee that included B. Beeton, R. P.
Boas, L. K. Durst, D. E. Knuth, P. Murdock, R. S. Palais, P. Renz, E. Swanson,
S. B. Whidden, and W. B. Woolf. The underlying philosophy of Zapf's design
is to capture the avor of mathematics as it might be written by a mathemati-
cian with excellent handwriting. A handwritten rather than mechanical style
is appropriate because people generally create mathematics with pen, pencil,

PREFACE
ix
or chalk. (For example, one of the trademarks of the new design is the symbol
for zero, `0', which is slightly pointed at the top because a handwritten zero
rarely closes together smoothly when the curve returns to its starting point.)
I'm unaccustomed
to this face.
The letters are upright, not italic, so that subscripts, superscripts, and ac-
cents are more easily tted with ordinary symbols. This new type family has
been named AMS Euler, after the great Swiss mathematician Leonhard Euler
(1707{1783) who discovered so much of mathematics as we know it today.
The alphabets include Euler Text (Aa Bb Cc through Xx Yy Zz), Euler Frak-
tur (Aa Bb Cc through Xx Yy Zz), and Euler Script Capitals (A B C through
X Y Z), as well as Euler Greek (AŒ± BŒ≤ ŒìŒ≥ through Xœá Œ®œà ‚Ñ¶œâ) and special
symbols such as ‚Ñòand @. We are especially pleased to be able to inaugurate
the Euler family of typefaces in this book, because Leonhard Euler's spirit
truly lives on every page: Concrete mathematics is Eulerian mathematics.
The authors are extremely grateful to Andrei Broder, Ernst Mayr, An-
Dear prof: Thanks
for (1) the puns,
(2) the subject
matter.
drew Yao, and Frances Yao, who contributed greatly to this book during the
years that they taught Concrete Mathematics at Stanford. Furthermore we
oer 1024 thanks to the teaching assistants who creatively transcribed what
took place in class each year and who helped to design the examination ques-
tions; their names are listed in Appendix C. This book, which is essentially
a compendium of sixteen years' worth of lecture notes, would have been im-
possible without their rst-rate work.
Many other people have helped to make this book a reality. For example,
we wish to commend the students at Brown, Columbia, CUNY, Princeton,
I don't see how
what I've learned
will ever help me.
Rice, and Stanford who contributed the choice grati and helped to debug
our rst drafts.
Our contacts at Addison-Wesley were especially ecient
and helpful; in particular, we wish to thank our publisher (Peter Gordon),
production supervisor (Bette Aaronson), designer (Roy Brown), and copy ed-
itor (Lyn Dupre). The National Science Foundation and the Oce of Naval
Research have given invaluable support. Cheryl Graham was tremendously
helpful as we prepared the index. And above all, we wish to thank our wives
(Fan, Jill, and Amy) for their patience, support, encouragement, and ideas.
I had a lot of trou-
ble in this class, but
I know it sharpened
my math skills and
my thinking skills.
This second edition features a new Section 5.8, which describes some
important ideas that Doron Zeilberger discovered shortly after the rst edition
went to press. Additional improvements to the rst printing can also be found
on almost every page.
We have tried to produce a perfect book, but we are imperfect authors.
Therefore we solicit help in correcting any mistakes that we've made. A re-
ward of $2.56 will gratefully be paid to the rst nder of any error, whether
it is mathematical, historical, or typographical.
I would advise the
casual student to
stay away from this
course.
Murray Hill, New Jersey
| RLG
and Stanford, California
DEK
May 1988 and October 1993
OP

A Note on Notation
SOME OF THE SYMBOLISM in this book has not (yet?) become standard.
Here is a list of notations that might be unfamiliar to readers who have learned
similar material from other books, together with the page numbers where
these notations are explained. (See the general index, at the end of the book,
for references to more standard notations.)
Notation
Name
Page
ln x
natural logarithm: loge x
276
lg x
binary logarithm: log2 x
70
log x
common logarithm: log10 x
449
‚åäx‚åã
oor: maxf n | n  x, integer n g
67
‚åàx‚åâ
ceiling: minf n | n  x, integer n g
67
x mod y
remainder: x ‚àíy‚åäx/y‚åã
82
fxg
fractional part: x mod 1
70
X
f(x) Œ¥x
indenite summation
48
Xb
a f(x) Œ¥x
denite summation
49
xn
falling factorial power: x!/(x ‚àín)!
47, 211
xn
rising factorial power: Œì(x + n)/Œì(x)
48, 211
n<
subfactorial: n!/0! ‚àín!/1! + ¬∑ ¬∑ ¬∑ + (‚àí1)nn!/n!
194
<z
real part: x, if z = x + iy
64
If you don't under-
stand what the
x denotes at the
bottom of this page,
try asking your
Latin professor
instead of your
math professor.
=z
imaginary part: y, if z = x + iy
64
Hn
harmonic number: 1/1 + ¬∑ ¬∑ ¬∑ + 1/n
29
H(x)
n
generalized harmonic number: 1/1x + ¬∑ ¬∑ ¬∑ + 1/nx
277
x

A NOTE ON NOTATION
xi
f(m)(z)
mth derivative of f at z
470
¬∑ n
m
¬∏
Stirling cycle number (the \rst kind")
259
¬Øn
m
¬∞
Stirling subset number (the \second kind")
258
¬øn
m
√Ä
Eulerian number
267
¬ø¬øn
m
√Ä√Ä
Second-order Eulerian number
270
Prestressed concrete
mathematics is con-
crete mathematics
that's preceded by
a bewildering list
of notations.
(am . . . a0)b
radix notation for Pm
k=0 akbk
11
K(a1, . . . , an)
continuant polynomial
302
F
¬µa, b
c
¬Ø¬Ø¬Ø z
¬∂
hypergeometric function
205
#A
cardinality: number of elements in the set A
39
[zn] f(z)
coecient of zn in f(z)
197
[Œ± . . Œ≤]
closed interval: the set fx | Œ±  x  Œ≤g
73
[m = n]
1 if m = n, otherwise 0 *
24
[mnn]
1 if m divides n, otherwise 0 *
102
[mnnn]
1 if m exactly divides n, otherwise 0 *
146
[m ‚ä•n]
1 if m is relatively prime to n, otherwise 0 *
115
*In general, if S is any statement that can be true or false, the bracketed
notation [S] stands for 1 if S is true, 0 otherwise.
Throughout this text, we use single-quote marks (`. . . ') to delimit text as
it is written, double-quote marks (\. . . ") for a phrase as it is spoken. Thus,
the string of letters `string' is sometimes called a \string."
Also `nonstring' is
a string.
An expression of the form `a/bc' means the same as `a/(bc)'. Moreover,
log x/log y = (log x)/(log y) and 2n! = 2(n!).

Contents
1
Recurrent Problems
1
1.1 The Tower of Hanoi
1
1.2 Lines in the Plane
4
1.3 The Josephus Problem
8
Exercises
17
2
Sums
21
2.1 Notation
21
2.2 Sums and Recurrences
25
2.3 Manipulation of Sums
30
2.4 Multiple Sums
34
2.5 General Methods
41
2.6 Finite and Innite Calculus
47
2.7 Innite Sums
56
Exercises
62
3
Integer Functions
67
3.1 Floors and Ceilings
67
3.2 Floor/Ceiling Applications
70
3.3 Floor/Ceiling Recurrences
78
3.4 `mod': The Binary Operation
81
3.5 Floor/Ceiling Sums
86
Exercises
95
4
Number Theory
102
4.1 Divisibility
102
4.2 Primes
105
4.3 Prime Examples
107
4.4 Factorial Factors
111
4.5 Relative Primality
115
4.6 `mod': The Congruence Relation
123
4.7 Independent Residues
126
4.8 Additional Applications
129
4.9 Phi and Mu
133
Exercises
144
5
Binomial CoeÔ¨Écients
153
5.1 Basic Identities
153
5.2 Basic Practice
172
5.3 Tricks of the Trade
186
xii

CONTENTS xiii
5.4 Generating Functions
196
5.5 Hypergeometric Functions
204
5.6 Hypergeometric Transformations
216
5.7 Partial Hypergeometric Sums
223
5.8 Mechanical Summation
229
Exercises
242
6
Special Numbers
257
6.1 Stirling Numbers
257
6.2 Eulerian Numbers
267
6.3 Harmonic Numbers
272
6.4 Harmonic Summation
279
6.5 Bernoulli Numbers
283
6.6 Fibonacci Numbers
290
6.7 Continuants
301
Exercises
309
7
Generating Functions
320
7.1 Domino Theory and Change
320
7.2 Basic Maneuvers
331
7.3 Solving Recurrences
337
7.4 Special Generating Functions
350
7.5 Convolutions
353
7.6 Exponential Generating Functions
364
7.7 Dirichlet Generating Functions
370
Exercises
371
8
Discrete Probability
381
8.1 Denitions
381
8.2 Mean and Variance
387
8.3 Probability Generating Functions
394
8.4 Flipping Coins
401
8.5 Hashing
411
Exercises
427
9
Asymptotics
439
9.1 A Hierarchy
440
9.2 O Notation
443
9.3 O Manipulation
450
9.4 Two Asymptotic Tricks
463
9.5 Euler's Summation Formula
469
9.6 Final Summations
476
Exercises
489
A
Answers to Exercises
497
B
Bibliography
604
C
Credits for Exercises
632
Index
637
List of Tables
657

1
Recurrent Problems
THIS CHAPTER EXPLORES three sample problems that give a feel for
what's to come. They have two traits in common: They've all been investi-
gated repeatedly by mathematicians; and their solutions all use the idea of
recurrence, in which the solution to each problem depends on the solutions
to smaller instances of the same problem.
1.1
THE TOWER OF HANOI
Let's look rst at a neat little puzzle called the Tower of Hanoi,
invented by the French mathematician Edouard Lucas in 1883. We are given
a tower of eight disks, initially stacked in decreasing size on one of three pegs:
Raise your hand
if you've never
seen this.
OK, the rest of
you can cut to
equation (1.1).
The objective is to transfer the entire tower to one of the other pegs, moving
only one disk at a time and never moving a larger one onto a smaller.
Lucas [260] furnished his toy with a romantic legend about a much larger
Tower of Brahma, which supposedly has 64 disks of pure gold resting on three
Gold|wow.
Are our disks made
of concrete?
diamond needles. At the beginning of time, he said, God placed these golden
disks on the rst needle and ordained that a group of priests should transfer
them to the third, according to the rules above. The priests reportedly work
day and night at their task. When they nish, the Tower will crumble and
the world will end.
1

2
RECURRENT PROBLEMS
It's not immediately obvious that the puzzle has a solution, but a little
thought (or having seen the problem before) convinces us that it does. Now
the question arises: What's the best we can do? That is, how many moves
are necessary and sucient to perform the task?
The best way to tackle a question like this is to generalize it a bit. The
Tower of Brahma has 64 disks and the Tower of Hanoi has 8; let's consider
what happens if there are n disks.
One advantage of this generalization is that we can scale the problem
down even more. In fact, we'll see repeatedly in this book that it's advanta-
geous to look at small cases rst. It's easy to see how to transfer a tower
that contains only one or two disks. And a small amount of experimentation
shows how to transfer a tower of three.
The next step in solving the problem is to introduce appropriate notation:
name and conquer. Let's say that Tn is the minimum number of moves
that will transfer n disks from one peg to another under Lucas's rules. Then
T1 is obviously 1, and T2 = 3.
We can also get another piece of data for free, by considering the smallest
case of all: Clearly T0 = 0, because no moves at all are needed to transfer a
tower of n = 0 disks! Smart mathematicians are not ashamed to think small,
because general patterns are easier to perceive when the extreme cases are
well understood (even when they are trivial).
But now let's change our perspective and try to think big; how can we
transfer a large tower? Experiments with three disks show that the winning
idea is to transfer the top two disks to the middle peg, then move the third,
then bring the other two onto it. This gives us a clue for transferring n disks
in general: We rst transfer the n ‚àí1 smallest to a dierent peg (requiring
Tn‚àí1 moves), then move the largest (requiring one move), and nally transfer
the n‚àí1 smallest back onto the largest (requiring another Tn‚àí1 moves). Thus
we can transfer n disks (for n > 0) in at most 2Tn‚àí1 + 1 moves:
Tn  2Tn‚àí1 + 1 ,
for n > 0.
This formula uses `  ' instead of ` = ' because our construction proves only
that 2Tn‚àí1 + 1 moves suce; we haven't shown that 2Tn‚àí1 + 1 moves are
necessary. A clever person might be able to think of a shortcut.
But is there a better way? Actually no. At some point we must move the
Most of the pub-
lished \solutions"
to Lucas's problem,
like the early one
of Allardice and
Fraser [7], fail to ex-
plain why Tn must
be  2Tn‚àí1 + 1.
largest disk. When we do, the n ‚àí1 smallest must be on a single peg, and it
has taken at least Tn‚àí1 moves to put them there. We might move the largest
disk more than once, if we're not too alert. But after moving the largest disk
for the last time, we must transfer the n‚àí1 smallest disks (which must again
be on a single peg) back onto the largest; this too requires Tn‚àí1 moves. Hence
Tn  2Tn‚àí1 + 1 ,
for n > 0.

1.1 THE TOWER OF HANOI
3
These two inequalities, together with the trivial solution for n = 0, yield
T0 = 0 ;
Tn = 2Tn‚àí1 + 1 ,
for n > 0.
(1.1)
(Notice that these formulas are consistent with the known values T1 = 1 and
T2 = 3. Our experience with small cases has not only helped us to discover
a general formula, it has also provided a convenient way to check that we
haven't made a foolish error. Such checks will be especially valuable when we
get into more complicated maneuvers in later chapters.)
A set of equalities like (1.1) is called a recurrence (a.k.a. recurrence
Yeah, yeah . . .
I seen that word
before.
relation or recursion relation). It gives a boundary value and an equation for
the general value in terms of earlier ones. Sometimes we refer to the general
equation alone as a recurrence, although technically it needs a boundary value
to be complete.
The recurrence allows us to compute Tn for any n we like. But nobody
really likes to compute from a recurrence, when n is large; it takes too long.
The recurrence only gives indirect, local information.
A solution to the
recurrence would make us much happier. That is, we'd like a nice, neat,
\closed form" for Tn that lets us compute it quickly, even for large n. With
a closed form, we can understand what Tn really is.
So how do we solve a recurrence? One way is to guess the correct solution,
then to prove that our guess is correct.
And our best hope for guessing
the solution is to look (again) at small cases. So we compute, successively,
T3 = 2¬∑3 + 1 = 7; T4 = 2¬∑7 + 1 = 15; T5 = 2¬∑15 + 1 = 31; T6 = 2¬∑31 + 1 = 63.
Aha! It certainly looks as if
Tn = 2n ‚àí1 ,
for n  0.
(1.2)
At least this works for n  6.
Mathematical induction is a general way to prove that some statement
about the integer n is true for all n  n0. First we prove the statement
when n has its smallest value, n0; this is called the basis. Then we prove the
Mathematical in-
duction proves that
we can climb as
high as we like on
a ladder, by proving
that we can climb
onto the bottom
rung (the basis)
and that from each
rung we can climb
up to the next one
(the induction).
statement for n > n0, assuming that it has already been proved for all values
between n0 and n ‚àí1, inclusive; this is called the induction. Such a proof
gives innitely many results with only a nite amount of work.
Recurrences are ideally set up for mathematical induction. In our case,
for example, (1.2) follows easily from (1.1): The basis is trivial, since T0 =
20 ‚àí1 = 0. And the induction follows for n > 0 if we assume that (1.2) holds
when n is replaced by n ‚àí1:
Tn = 2Tn‚àí1 + 1 = 2(2n‚àí1 ‚àí1) + 1 = 2n ‚àí1 .
Hence (1.2) holds for n as well. Good! Our quest for Tn has ended successfully.

4
RECURRENT PROBLEMS
Of course the priests' task hasn't ended; they're still dutifully moving
disks, and will be for a while, because for n = 64 there are 264‚àí1 moves (about
18 quintillion). Even at the impossible rate of one move per microsecond, they
will need more than 5000 centuries to transfer the Tower of Brahma. Lucas's
original puzzle is a bit more practical. It requires 28 ‚àí1 = 255 moves, which
takes about four minutes for the quick of hand.
The Tower of Hanoi recurrence is typical of many that arise in applica-
tions of all kinds. In nding a closed-form expression for some quantity of
interest like Tn we go through three stages:
1
Look at small cases. This gives us insight into the problem and helps us
in stages 2 and 3.
2
Find and prove a mathematical expression for the quantity of interest.
What is a proof?
\One half of one
percent pure alco-
hol."
For the Tower of Hanoi, this is the recurrence (1.1) that allows us, given
the inclination, to compute Tn for any n.
3
Find and prove a closed form for our mathematical expression. For the
Tower of Hanoi, this is the recurrence solution (1.2).
The third stage is the one we will concentrate on throughout this book. In
fact, we'll frequently skip stages 1 and 2 entirely, because a mathematical
expression will be given to us as a starting point. But even then, we'll be
getting into subproblems whose solutions will take us through all three stages.
Our analysis of the Tower of Hanoi led to the correct answer, but it
required an \inductive leap"; we relied on a lucky guess about the answer.
One of the main objectives of this book is to explain how a person can solve
recurrences without being clairvoyant. For example, we'll see that recurrence
(1.1) can be simplied by adding 1 to both sides of the equations:
T0 + 1 = 1 ;
Tn + 1 = 2Tn‚àí1 + 2 ,
for n > 0.
Now if we let Un = Tn + 1, we have
Interesting: We get
rid of the +1 in
(1.1) by adding, not
by subtracting.
U0 = 1 ;
Un = 2Un‚àí1 ,
for n > 0.
(1.3)
It doesn't take genius to discover that the solution to this recurrence is just
Un = 2n; hence Tn = 2n ‚àí1. Even a computer could discover this.
1.2
LINES IN THE PLANE
Our second sample problem has a more geometric avor: How many
slices of pizza can a person obtain by making n straight cuts with a pizza
knife? Or, more academically: What is the maximum number Ln of regions

1.2 LINES IN THE PLANE
5
dened by n lines in the plane? This problem was rst solved in 1826, by the
Swiss mathematician Jacob Steiner [338].
(A pizza with Swiss
cheese?)
Again we start by looking at small cases, remembering to begin with the
smallest of all. The plane with no lines has one region; with one line it has
two regions; and with two lines it has four regions:
L0 = 1
1
L1 = 2

1
2
L2 = 4
¬£
¬£
¬£
¬£
¬£
¬£

1
2
3
4
(Each line extends innitely in both directions.)
Sure, we think, Ln = 2n; of course! Adding a new line simply doubles
the number of regions. Unfortunately this is wrong. We could achieve the
doubling if the nth line would split each old region in two; certainly it can
split an old region in at most two pieces, since each old region is convex. (A
A region is convex
if it includes all
line segments be-
tween any two of its
points. (That's not
what my dictionary
says, but it's what
mathematicians
believe.)
straight line can split a convex region into at most two new regions, which
will also be convex.) But when we add the third line | the thick one in the
diagram below | we soon nd that it can split at most three of the old regions,
no matter how we've placed the rst two lines:

¬£
¬£
¬£
¬£
¬£
¬£
hhhhhhhhhhhhhh
2
4a
4b
3b
1b
1a
3a
Thus L3 = 4 + 3 = 7 is the best we can do.
And after some thought we realize the appropriate generalization. The
nth line (for n > 0) increases the number of regions by k if and only if it
splits k of the old regions, and it splits k old regions if and only if it hits the
previous lines in k ‚àí1 dierent places. Two lines can intersect in at most one
point. Therefore the new line can intersect the n‚àí1 old lines in at most n‚àí1
dierent points, and we must have k  n. We have established the upper
bound
Ln  Ln‚àí1 + n ,
for n > 0.
Furthermore it's easy to show by induction that we can achieve equality in
this formula. We simply place the nth line in such a way that it's not parallel
to any of the others (hence it intersects them all), and such that it doesn't go

6
RECURRENT PROBLEMS
through any of the existing intersection points (hence it intersects them all
in dierent places). The recurrence is therefore
L0 = 1 ;
Ln = Ln‚àí1 + n ,
for n > 0.
(1.4)
The known values of L1, L2, and L3 check perfectly here, so we'll buy this.
Now we need a closed-form solution. We could play the guessing game
again, but 1, 2, 4, 7, 11, 16, . . . doesn't look familiar; so let's try another
tack. We can often understand a recurrence by \unfolding" or \unwinding"
it all the way to the end, as follows:
Ln = Ln‚àí1 + n
= Ln‚àí2 + (n ‚àí1) + n
Unfolding?
I'd call this
\plugging in."
= Ln‚àí3 + (n ‚àí2) + (n ‚àí1) + n
...
= L0 + 1 + 2 + ¬∑ ¬∑ ¬∑ + (n ‚àí2) + (n ‚àí1) + n
= 1 + Sn ,
where Sn = 1 + 2 + 3 + ¬∑ ¬∑ ¬∑ + (n ‚àí1) + n.
In other words, Ln is one more than the sum Sn of the rst n positive integers.
The quantity Sn pops up now and again, so it's worth making a table of
small values. Then we might recognize such numbers more easily when we
see them the next time:
n
1
2
3
4
5
6
7
8
9
10
11
12
13
14
Sn
1
3
6
10
15
21
28
36
45
55
66
78
91
105
These values are also called the triangular numbers, because Sn is the num-
ber of bowling pins in an n-row triangular array.
For example, the usual
four-row array
qq q
q q q
q q q q has S4 = 10 pins.
To evaluate Sn we can use a trick that Gauss reportedly came up with
in 1786, when he was nine years old [88] (see also Euler [114, part 1, ¬ß415]):
It seems a lot of
stu is attributed
to Gauss|
either he was really
smart or he had a
great press agent.
Maybe he just
had a magnetic
personality.
Sn =
1
+
2
+
3
+ ¬∑ ¬∑ ¬∑ + (n ‚àí1) +
n
+ Sn =
n
+ (n ‚àí1) + (n ‚àí2) + ¬∑ ¬∑ ¬∑ +
2
+
1
2Sn = (n + 1) + (n + 1) + (n + 1) + ¬∑ ¬∑ ¬∑ + (n + 1) + (n + 1)
We merely add Sn to its reversal, so that each of the n columns on the right
sums to n + 1. Simplifying,
Sn = n(n + 1)
2
,
for n  0.
(1.5)

1.2 LINES IN THE PLANE
7
OK, we have our solution:
Actually Gauss is
often called the
greatest mathe-
matician of all time.
So it's nice to be
able to understand
at least one of his
discoveries.
Ln = n(n + 1)
2
+ 1 ,
for n  0.
(1.6)
As experts, we might be satised with this derivation and consider it
a proof, even though we waved our hands a bit when doing the unfolding
and reecting. But students of mathematics should be able to meet stricter
standards; so it's a good idea to construct a rigorous proof by induction. The
key induction step is
Ln = Ln‚àí1 + n =
¬° 1
2(n ‚àí1)n + 1
¬¢
+ n =
1
2n(n + 1) + 1 .
Now there can be no doubt about the closed form (1.6).
Incidentally we've been talking about \closed forms" without explic-
When in doubt,
look at the words.
Why is it \closed,"
as opposed to
\open"? What
image does it bring
to mind?
Answer: The equa-
tion is \closed," not
dened in terms of
itself|not leading
to recurrence. The
case is \closed"|it
won't happen again.
Metaphors are the
key.
itly saying what we mean. Usually it's pretty clear. Recurrences like (1.1)
and (1.4) are not in closed form | they express a quantity in terms of itself;
but solutions like (1.2) and (1.6) are. Sums like 1 + 2 + ¬∑ ¬∑ ¬∑ + n are not in
closed form | they cheat by using ` ¬∑ ¬∑ ¬∑ '; but expressions like n(n + 1)/2 are.
We could give a rough denition like this: An expression for a quantity f(n)
is in closed form if we can compute it using at most a xed number of \well
known" standard operations, independent of n.
For example, 2n ‚àí1 and
n(n + 1)/2 are closed forms because they involve only addition, subtraction,
multiplication, division, and exponentiation, in explicit ways.
The total number of simple closed forms is limited, and there are recur-
rences that don't have simple closed forms. When such recurrences turn out
to be important, because they arise repeatedly, we add new operations to our
repertoire; this can greatly extend the range of problems solvable in \simple"
closed form. For example, the product of the rst n integers, n!, has proved
to be so important that we now consider it a basic operation. The formula
`n!' is therefore in closed form, although its equivalent `1¬∑2¬∑. . .¬∑n' is not.
And now, briey, a variation of the lines-in-the-plane problem: Suppose
that instead of straight lines we use bent lines, each containing one \zig."
What is the maximum number Zn of regions determined by n such bent lines
Is \zig" a technical
term?
in the plane? We might expect Zn to be about twice as big as Ln, or maybe
three times as big. Let's see:
Z1 = 2


PPPPPPP
P
1
2
Z2 = 7
¬£
¬£
¬£
¬£
¬£
¬£
¬£¬£
B
B
B
B
B
B
BB

PPPPPPPP
1
2
3
4
5
6
7

8
RECURRENT PROBLEMS
From these small cases, and after a little thought, we realize that a bent
. . . and a little
afterthought. . .
line is like two straight lines except that regions merge when the \two" lines
don't extend past their intersection point.

PPPPPP
p p p p p p p p p p
p p p p p p p p p p
1
2
3
4
Regions 2, 3, and 4, which would be distinct with two lines, become a single
region when there's a bent line; we lose two regions. However, if we arrange
things properly | the zig point must lie \beyond" the intersections with the
other lines | that's all we lose; that is, we lose only two regions per line. Thus
Exercise 18 has the
details.
Zn = L2n ‚àí2n = 2n(2n + 1)/2 + 1 ‚àí2n
= 2n2 ‚àín + 1 ,
for n  0.
(1.7)
Comparing the closed forms (1.6) and (1.7), we nd that for large n,
Ln ‚àº
1
2n2 ,
Zn ‚àº2n2 ;
so we get about four times as many regions with bent lines as with straight
lines. (In later chapters we'll be discussing how to analyze the approximate
behavior of integer functions when n is large. The `‚àº' symbol is dened in
Section 9.1.)
1.3
THE JOSEPHUS PROBLEM
Our nal introductory example is a variant of an ancient problem
(Ahrens [5, vol. 2]
and Herstein
and Kaplansky [187]
discuss the interest-
ing history of this
problem. Josephus
himself [197] is a bit
vague.)
named for Flavius Josephus, a famous historian of the rst century. Legend
has it that Josephus wouldn't have lived to become famous without his math-
ematical talents. During the Jewish{Roman war, he was among a band of 41
Jewish rebels trapped in a cave by the Romans. Preferring suicide to capture,
the rebels decided to form a circle and, proceeding around it, to kill every
third remaining person until no one was left. But Josephus, along with an
unindicted co-conspirator, wanted none of this suicide nonsense; so he quickly
calculated where he and his friend should stand in the vicious circle.
. . . thereby saving
his tale for us to
hear.
In our variation, we start with n people numbered 1 to n around a circle,
and we eliminate every second remaining person until only one survives. For

1.3 THE JOSEPHUS PROBLEM
9
example, here's the starting conguration for n = 10:
'$
&%
6
1
2
3
4
5
6
7
8
9
10
The elimination order is 2, 4, 6, 8, 10, 3, 7, 1, 9, so 5 survives. The problem:
Determine the survivor's number, J(n).
Here's a case where
n = 0 makes no
sense.
We just saw that J(10) = 5. We might conjecture that J(n) = n/2 when
n is even; and the case n = 2 supports the conjecture: J(2) = 1. But a few
other small cases dissuade us | the conjecture fails for n = 4 and n = 6.
n
1
2
3
4
5
6
J(n)
1
1
3
1
3
5
It's back to the drawing board; let's try to make a better guess. Hmmm . . .
Even so, a bad
guess isn't a waste
of time, because it
gets us involved in
the problem.
J(n) always seems to be odd. And in fact, there's a good reason for this: The
rst trip around the circle eliminates all the even numbers. Furthermore, if
n itself is an even number, we arrive at a situation similar to what we began
with, except that there are only half as many people, and their numbers have
changed.
So let's suppose that we have 2n people originally. After the rst go-
round, we're left with
'$
&%
6
1
3
5
7
. . .
2n ‚àí3
2n ‚àí1
and 3 will be the next to go. This is just like starting out with n people, except
that each person's number has been doubled and decreased by 1. That is,
This is the tricky
part: We have
J(2n) =
newnumber(J(n)),
where
newnumber(k) =
2k ‚àí1.
J(2n) = 2J(n) ‚àí1 ,
for n  1.
We can now go quickly to large n. For example, we know that J(10) = 5, so
J(20) = 2J(10) ‚àí1 = 2¬∑5 ‚àí1 = 9 .
Similarly J(40) = 17, and we can deduce that J(5¬∑2m) = 2m+1 + 1.

10
RECURRENT PROBLEMS
But what about the odd case? With 2n + 1 people, it turns out that
Odd case? Hey,
leave my brother
out of it.
person number 1 is wiped out just after person number 2n, and we're left with
'$
&%
6
3
5
7
9
. . .
2n ‚àí1
2n + 1
Again we almost have the original situation with n people, but this time their
numbers are doubled and increased by 1. Thus
J(2n + 1) = 2J(n) + 1 ,
for n  1.
Combining these equations with J(1) = 1 gives us a recurrence that denes J
in all cases:
J(1) = 1 ;
J(2n) = 2J(n) ‚àí1 ,
for n  1;
J(2n + 1) = 2J(n) + 1 ,
for n  1.
(1.8)
Instead of getting J(n) from J(n‚àí1), this recurrence is much more \ecient,"
because it reduces n by a factor of 2 or more each time it's applied. We could
compute J(1000000), say, with only 19 applications of (1.8). But still, we seek
a closed form, because that will be even quicker and more informative. After
all, this is a matter of life or death.
Our recurrence makes it possible to build a table of small values very
quickly. Perhaps we'll be able to spot a pattern and guess the answer.
n
1
2 3
4 5 6 7
8 9 10 11 12 13 14 15
16
J(n)
1
1 3
1 3 5 7
1 3
5
7
9 11 13 15
1
Voila!
It seems we can group by powers of 2 (marked by vertical lines in
the table); J(n) is always 1 at the beginning of a group and it increases by 2
within a group. So if we write n in the form n = 2m + l, where 2m is the
largest power of 2 not exceeding n and where l is what's left, the solution to
our recurrence seems to be
J(2m + l) = 2l + 1 ,
for m  0 and 0  l < 2m.
(1.9)
(Notice that if 2m  n < 2m+1, the remainder l = n ‚àí2m satises 0  l <
2m+1 ‚àí2m = 2m.)
We must now prove (1.9). As in the past we use induction, but this time
the induction is on m. When m = 0 we must have l = 0; thus the basis of

1.3 THE JOSEPHUS PROBLEM
11
(1.9) reduces to J(1) = 1, which is true. The induction step has two parts,
But there's a sim-
pler way! The
key fact is that
J(2m) = 1 for
all m, and this
follows immedi-
ately from our rst
equation,
J(2n) = 2J(n)‚àí1.
Hence we know that
the rst person will
survive whenever
n is a power of 2.
And in the gen-
eral case, when
n = 2m + l,
the number of
people is reduced
to a power of 2
after there have
been l executions.
The rst remaining
person at this point,
the survivor, is
number 2l + 1.
depending on whether l is even or odd. If m > 0 and 2m + l = 2n, then l is
even and
J(2m + l) = 2J(2m‚àí1 + l/2) ‚àí1 = 2(2l/2 + 1) ‚àí1 = 2l + 1 ,
by (1.8) and the induction hypothesis; this is exactly what we want. A similar
proof works in the odd case, when 2m + l = 2n + 1. We might also note that
(1.8) implies the relation
J(2n + 1) ‚àíJ(2n) = 2.
Either way, the induction is complete and (1.9) is established.
To illustrate solution (1.9), let's compute J(100). In this case we have
100 = 26 + 36, so J(100) = 2¬∑36 + 1 = 73.
Now that we've done the hard stu (solved the problem) we seek the
soft: Every solution to a problem can be generalized so that it applies to a
wider class of problems. Once we've learned a technique, it's instructive to
look at it closely and see how far we can go with it. Hence, for the rest of this
section, we will examine the solution (1.9) and explore some generalizations
of the recurrence (1.8). These explorations will uncover the structure that
underlies all such problems.
Powers of 2 played an important role in our nding the solution, so it's
natural to look at the radix 2 representations of n and J(n). Suppose n's
binary expansion is
n = (bm bm‚àí1 . . . b1 b0)2 ;
that is,
n = bm2m + bm‚àí12m‚àí1 + ¬∑ ¬∑ ¬∑ + b12 + b0 ,
where each bi is either 0 or 1 and where the leading bit bm is 1. Recalling
that n = 2m + l, we have, successively,
n = (1 bm‚àí1 bm‚àí2 . . . b1 b0)2 ,
l = (0 bm‚àí1 bm‚àí2 . . . b1 b0)2 ,
2l = (bm‚àí1 bm‚àí2 . . . b1 b0 0)2 ,
2l + 1 = (bm‚àí1 bm‚àí2 . . . b1 b0 1)2 ,
J(n) = (bm‚àí1 bm‚àí2 . . . b1 b0 bm)2 .
(The last step follows because J(n) = 2l + 1 and because bm = 1.) We have
proved that
J
¬°
(bm bm‚àí1 . . . b1 b0)2
¬¢
= (bm‚àí1 . . . b1 b0 bm)2 ;
(1.10)

12
RECURRENT PROBLEMS
that is, in the lingo of computer programming, we get J(n) from n by doing
a one-bit cyclic shift left! Magic. For example, if n = 100 = (1100100)2 then
J(n) = J
¬°
(1100100)2
¬¢
= (1001001)2, which is 64 + 8 + 1 = 73. If we had been
working all along in binary notation, we probably would have spotted this
pattern immediately.
If we start with n and iterate the J function m + 1 times, we're doing
(\Iteration" here
means applying a
function to itself.)
m + 1 one-bit cyclic shifts; so, since n is an (m+1)-bit number, we might
expect to end up with n again. But this doesn't quite work. For instance
if n = 13 we have J
¬°
(1101)2
¬¢
= (1011)2, but then J
¬°
(1011)2
¬¢
= (111)2 and
the process breaks down; the 0 disappears when it becomes the leading bit.
In fact, J(n) must always be  n by denition, since J(n) is the survivor's
number; hence if J(n) < n we can never get back up to n by continuing to
iterate.
Repeated application of J produces a sequence of decreasing values that
eventually reach a \xed point," where J(n) = n. The cyclic shift property
makes it easy to see what that xed point will be: Iterating the function
enough times will always produce a pattern of all 1's whose value is 2ŒΩ(n) ‚àí1,
where ŒΩ(n) is the number of 1 bits in the binary representation of n. Thus,
since ŒΩ(13) = 3, we have
2 or more J's
z }| {
J(J(. . . J(13) . . . )) = 23 ‚àí1 = 7 ;
similarly
Curiously enough,
if M is a compact
C‚àûn-manifold
(n > 1), there
exists a dieren-
tiable immersion of
M into R2n‚àíŒΩ(n)
but not necessarily
into R2n‚àíŒΩ(n)‚àí1 .
I wonder if Jose-
phus was secretly
a topologist?
8 or more
z }| {
J(J(. . . J((101101101101011)2) . . . )) = 210 ‚àí1 = 1023 .
Curious, but true.
Let's return briey to our rst guess, that J(n) = n/2 when n is even.
This is obviously not true in general, but we can now determine exactly when
it is true:
J(n) = n/2 ,
2l + 1 = (2m + l)/2 ,
l =
1
3(2m ‚àí2) .
If this number l = 1
3(2m ‚àí2) is an integer, then n = 2m +l will be a solution,
because l will be less than 2m. It's not hard to verify that 2m ‚àí2 is a multiple
of 3 when m is odd, but not when m is even. (We will study such things in
Chapter 4.)
Therefore there are innitely many solutions to the equation

1.3 THE JOSEPHUS PROBLEM
13
J(n) = n/2, beginning as follows:
m
l
n = 2m + l
J(n) = 2l + 1 = n/2
n (binary)
1
0
2
1
10
3
2
10
5
1010
5
10
42
21
101010
7
42
170
85
10101010
Notice the pattern in the rightmost column. These are the binary numbers
for which cyclic-shifting one place left produces the same result as ordinary-
shifting one place right (halving).
OK, we understand the J function pretty well; the next step is to general-
ize it. What would have happened if our problem had produced a recurrence
that was something like (1.8), but with dierent constants? Then we might
not have been lucky enough to guess the solution, because the solution might
have been really weird. Let's investigate this by introducing constants Œ±, Œ≤,
and Œ≥ and trying to nd a closed form for the more general recurrence
Looks like Greek
to me.
f(1) = Œ± ;
f(2n) = 2f(n) + Œ≤ ,
for n  1;
f(2n + 1) = 2f(n) + Œ≥ ,
for n  1.
(1.11)
(Our original recurrence had Œ± = 1, Œ≤ = ‚àí1, and Œ≥ = 1.) Starting with
f(1) = Œ± and working our way up, we can construct the following general
table for small values of n:
n
f(n)
1
Œ±
2
2Œ± +
Œ≤
3
2Œ±
+
Œ≥
4
4Œ± + 3Œ≤
5
4Œ± + 2Œ≤ +
Œ≥
6
4Œ± +
Œ≤ + 2Œ≥
7
4Œ±
+ 3Œ≥
8
8Œ± + 7Œ≤
9
8Œ± + 6Œ≤ +
Œ≥
(1.12)
It seems that Œ±'s coecient is n's largest power of 2. Furthermore, between
powers of 2, Œ≤'s coecient decreases by 1 down to 0 and Œ≥'s increases by 1
up from 0. Therefore if we express f(n) in the form
f(n) = A(n)Œ± + B(n)Œ≤ + C(n)Œ≥ ,
(1.13)

14
RECURRENT PROBLEMS
by separating out its dependence on Œ±, Œ≤, and Œ≥, it seems that
A(n) = 2m ;
B(n) = 2m ‚àí1 ‚àíl ;
(1.14)
C(n) = l .
Here, as usual, n = 2m + l and 0  l < 2m, for n  1.
It's not terribly hard to prove (1.13) and (1.14) by induction, but the
Hold onto your
hats, this next part
is new stu.
calculations are messy and uninformative. Fortunately there's a better way
to proceed, by choosing particular values and then combining them. Let's
illustrate this by considering the special case Œ± = 1, Œ≤ = Œ≥ = 0, when f(n) is
supposed to be equal to A(n): Recurrence (1.11) becomes
A(1) = 1 ;
A(2n) = 2A(n) ,
for n  1;
A(2n + 1) = 2A(n) ,
for n  1.
Sure enough, it's true (by induction on m) that A(2m + l) = 2m.
Next, let's use recurrence (1.11) and solution (1.13) in reverse, by start-
ing with a simple function f(n) and seeing if there are any constants (Œ±, Œ≤, Œ≥)
that will dene it. Plugging the constant function f(n) = 1 into (1.11) says that
A neat idea!
1 = Œ±;
1 = 2¬∑1 + Œ≤;
1 = 2¬∑1 + Œ≥;
hence the values (Œ±, Œ≤, Œ≥) = (1, ‚àí1, ‚àí1) satisfying these equations will yield
A(n) ‚àíB(n) ‚àíC(n) = f(n) = 1. Similarly, we can plug in f(n) = n:
1 = Œ±;
2n = 2¬∑n + Œ≤;
2n + 1 = 2¬∑n + Œ≥;
These equations hold for all n when Œ± = 1, Œ≤ = 0, and Œ≥ = 1, so we don't
need to prove by induction that these parameters will yield f(n) = n. We
already know that f(n) = n will be the solution in such a case, because the
recurrence (1.11) uniquely denes f(n) for every value of n.
And now we're essentially done! We have shown that the functions A(n),
B(n), and C(n) of (1.13), which solve (1.11) in general, satisfy the equations
A(n) = 2m ,
where n = 2m + l and 0  l < 2m;
A(n) ‚àíB(n) ‚àíC(n) = 1 ;
A(n) + C(n) = n .

1.3 THE JOSEPHUS PROBLEM
15
Our conjectures in (1.14) follow immediately, since we can solve these equa-
tions to get C(n) = n ‚àíA(n) = l and B(n) = A(n) ‚àí1 ‚àíC(n) = 2m ‚àí1 ‚àíl.
This approach illustrates a surprisingly useful repertoire method for solv-
Beware: The au-
thors are expecting
us to gure out
the idea of the
repertoire method
from seat-of-the-
pants examples,
instead of giving
us a top-down
presentation. The
method works best
with recurrences
that are \linear,"
in the sense that
the solutions can be
expressed as a sum
of arbitrary param-
eters multiplied by
functions of n, as
in (1.13). Equation
(1.13) is the key.
ing recurrences. First we nd settings of general parameters for which we
know the solution; this gives us a repertoire of special cases that we can solve.
Then we obtain the general case by combining the special cases. We need as
many independent special solutions as there are independent parameters (in
this case three, for Œ±, Œ≤, and Œ≥). Exercises 16 and 20 provide further examples
of the repertoire approach.
We know that the original J-recurrence has a magical solution, in binary:
J
¬°
(bm bm‚àí1 . . . b1 b0)2
¬¢
= (bm‚àí1 . . . b1 b0 bm)2 ,
where bm = 1.
Does the generalized Josephus recurrence admit of such magic?
Sure, why not? We can rewrite the generalized recurrence (1.11) as
f(1) = Œ± ;
f(2n + j) = 2f(n) + Œ≤j ,
for j = 0, 1
and
n  1,
(1.15)
if we let Œ≤0 = Œ≤ and Œ≤1 = Œ≥. And this recurrence unfolds, binary-wise:
f
¬°
(bm bm‚àí1 . . . b1 b0)2
¬¢
= 2f
¬°
(bm bm‚àí1 . . . b1)2
¬¢
+ Œ≤b0
= 4f
¬°
(bm bm‚àí1 . . . b2)2
¬¢
+ 2Œ≤b1 + Œ≤b0
...
= 2mf
¬°
(bm)2
¬¢
+2m‚àí1Œ≤bm‚àí1+ ¬∑ ¬∑ ¬∑ +2Œ≤b1+Œ≤b0
= 2mŒ± + 2m‚àí1Œ≤bm‚àí1 + ¬∑ ¬∑ ¬∑ + 2Œ≤b1 + Œ≤b0 .
Suppose we now relax the radix 2 notation to allow arbitrary digits instead
(`relax' = `destroy')
of just 0 and 1. The derivation above tells us that
f
¬°
(bm bm‚àí1 . . . b1 b0)2
¬¢
= (Œ± Œ≤bm‚àí1 Œ≤bm‚àí2 . . . Œ≤b1 Œ≤b0)2 .
(1.16)
Nice. We would have seen this pattern earlier if we had written (1.12) in
I think I get it:
The binary repre-
sentations of A(n),
B(n), and C(n)
have 1's in dierent
positions.
another way:
n
f(n)
1
Œ±
2
2Œ± + Œ≤
3
2Œ± + Œ≥
4
4Œ± + 2Œ≤ + Œ≤
5
4Œ± + 2Œ≤ + Œ≥
6
4Œ± + 2Œ≥ + Œ≤
7
4Œ± + 2Œ≥ + Œ≥

16
RECURRENT PROBLEMS
For example, when n = 100 = (1100100)2, our original Josephus values
Œ± = 1, Œ≤ = ‚àí1, and Œ≥ = 1 yield
n =
( 1
1
0
0
1
0
0 )2
=
100
f(n) =
( 1
1
‚àí1
‚àí1
1
‚àí1
‚àí1 )2
=
+64
+32
‚àí16
‚àí8
+4
‚àí2
‚àí1
=
73
as before. The cyclic-shift property follows because each block of binary digits
(1 0 . . . 0 0)2 in the representation of n is transformed into
(1 ‚àí1 . . . ‚àí1 ‚àí1)2 = (0 0 . . . 0 1)2 .
So our change of notation has given us the compact solution (1.16) to the
\There are two
kinds of general-
izations. One is
cheap and the other
is valuable.
It is easy to gen-
eralize by diluting
a little idea with a
big terminology.
It is much more
dicult to pre-
pare a rened and
condensed extract
from several good
ingredients."
|G. Polya [297]
general recurrence (1.15). If we're really uninhibited we can now generalize
even more. The recurrence
f(j) = Œ±j ,
for 1  j < d;
f(dn + j) = cf(n) + Œ≤j ,
for 0  j < d
and
n  1,
(1.17)
is the same as the previous one except that we start with numbers in radix d
and produce values in radix c. That is, it has the radix-changing solution
f
¬°
(bm bm‚àí1 . . . b1 b0)d
¬¢
= (Œ±bm Œ≤bm‚àí1 Œ≤bm‚àí2 . . . Œ≤b1 Œ≤b0)c .
(1.18)
For example, suppose that by some stroke of luck we're given the recurrence
f(1) = 34 ,
f(2) = 5 ,
f(3n) = 10f(n) + 76 ,
for n  1,
f(3n + 1) = 10f(n) ‚àí2 ,
for n  1,
f(3n + 2) = 10f(n) + 8 ,
for n  1,
and suppose we want to compute f(19). Here we have d = 3 and c = 10. Now
Perhaps this was a
stroke of bad luck.
19 = (201)3, and the radix-changing solution tells us to perform a digit-by-
digit replacement from radix 3 to radix 10. So the leading 2 becomes a 5, and
the 0 and 1 become 76 and ‚àí2, giving
f(19) = f
¬°
(201)3
¬¢
= (5 76 ‚àí2)10 = 1258 ,
which is our answer.
Thus Josephus and the Jewish{Roman war have led us to some interesting
But in general I'm
against recurrences
of war.
general recurrences.

1 EXERCISES
17
Exercises
Warmups
1
All horses are the same color; we can prove this by induction on the
Please do all the
warmups in all the
chapters!
|The Mgm't
number of horses in a given set. Here's how: \If there's just one horse
then it's the same color as itself, so the basis is trivial. For the induction
step, assume that there are n horses numbered 1 to n. By the induc-
tion hypothesis, horses 1 through n ‚àí1 are the same color, and similarly
horses 2 through n are the same color. But the middle horses, 2 through
n ‚àí1, can't change color when they're in dierent groups; these are
horses, not chameleons. So horses 1 and n must be the same color as
well, by transitivity. Thus all n horses are the same color; QED." What,
if anything, is wrong with this reasoning?
2
Find the shortest sequence of moves that transfers a tower of n disks
from the left peg A to the right peg B, if direct moves between A and B
are disallowed. (Each move must be to or from the middle peg. As usual,
a larger disk must never appear above a smaller one.)
3
Show that, in the process of transferring a tower under the restrictions of
the preceding exercise, we will actually encounter every properly stacked
arrangement of n disks on three pegs.
4
Are there any starting and ending congurations of n disks on three pegs
that are more than 2n ‚àí1 moves apart, under Lucas's original rules?
5
A \Venn diagram" with three overlapping circles is often used to illustrate
the eight possible subsets associated with three given sets:
'$
&%
'$
&%
'$
&%
A
B
C
Can the sixteen possibilities that arise with four given sets be illustrated
by four overlapping circles?
6
Some of the regions dened by n lines in the plane are innite, while
others are bounded. What's the maximum possible number of bounded
regions?
7
Let H(n) = J(n + 1) ‚àíJ(n). Equation (1.8) tells us that H(2n) = 2, and
H(2n+1) = J(2n+2)‚àíJ(2n+1) =
¬°
2J(n+1)‚àí1
¬¢
‚àí
¬°
2J(n)+1
¬¢
= 2H(n)‚àí2,
for all n  1. Therefore it seems possible to prove that H(n) = 2 for all n,
by induction on n. What's wrong here?

18
RECURRENT PROBLEMS
Homework exercises
8
Solve the recurrence
Q0 = Œ± ;
Q1 = Œ≤ ;
Qn = (1 + Qn‚àí1)/Qn‚àí2 ,
for n > 1.
Assume that Qn Ã∏= 0 for all n  0. Hint: Q4 = (1 + Œ±)/Œ≤.
9
Sometimes it's possible to use induction backwards, proving things from
. . . now that's a
horse of a dierent
color.
n to n ‚àí1 instead of vice versa! For example, consider the statement
P(n) :
x1 . . . xn 
¬µx1 + ¬∑ ¬∑ ¬∑ + xn
n
¬∂n
,
if x1, . . . , xn  0.
This is true when n = 2, since (x1 + x2)2 ‚àí4x1x2 = (x1 ‚àíx2)2  0.
a
By setting xn = (x1 + ¬∑ ¬∑ ¬∑ + xn‚àí1)/(n ‚àí1), prove that P(n) im-
plies P(n ‚àí1) whenever n > 1.
b
Show that P(n) and P(2) imply P(2n).
c
Explain why this implies the truth of P(n) for all n.
10
Let Qn be the minimum number of moves needed to transfer a tower of
n disks from A to B if all moves must be clockwise | that is, from A
to B, or from B to the other peg, or from the other peg to A. Also let Rn
be the minimum number of moves needed to go from B back to A under
this restriction. Prove that
Qn =
¬Ø 0,
if n = 0;
2Rn‚àí1 +1,
if n > 0;
Rn =
¬Ø 0,
if n = 0;
Qn +Qn‚àí1 +1,
if n > 0.
(You need not solve these recurrences; we'll see how to do that in Chap-
ter 7.)
11
A Double Tower of Hanoi contains 2n disks of n dierent sizes, two of
each size.
As usual, we're required to move only one disk at a time,
without putting a larger one over a smaller one.
a
How many moves does it take to transfer a double tower from one
peg to another, if disks of equal size are indistinguishable from each
other?
b
What if we are required to reproduce the original top-to-bottom
order of all the equal-size disks in the nal arrangement?
[Hint:
This is dicult|it's really a \bonus problem."]
12
Let's generalize exercise 11a even further, by assuming that there are
n dierent sizes of disks and exactly mk disks of size k.
Determine
A(m1, . . . , mn), the minimum number of moves needed to transfer a
tower when equal-size disks are considered to be indistinguishable.

1 EXERCISES
19
13
What's the maximum number of regions denable by n zig-zag lines,
             




              
XXXXXXXXXXXXXXX
QQQQQQ
XXXXXXXXXXXXXXX
ZZ2 = 12
each of which consists of two parallel innite half-lines joined by a straight
segment?
14
How many pieces of cheese can you obtain from a single thick piece by
making ve straight slices? (The cheese must stay in its original position
while you do all the cutting, and each slice must correspond to a plane
Good luck keep-
ing the cheese in
position.
in 3D.) Find a recurrence relation for Pn, the maximum number of three-
dimensional regions that can be dened by n dierent planes.
15
Josephus had a friend who was saved by getting into the next-to-last
position. What is I(n), the number of the penultimate survivor when
every second person is executed?
16
Use the repertoire method to solve the general four-parameter recurrence
g(1) = Œ± ;
g(2n + j) = 3g(n) + Œ≥n + Œ≤j ,
for j = 0, 1
and
n  1.
Hint: Try the function g(n) = n.
Exam problems
17
If Wn is the minimum number of moves needed to transfer a tower of n
disks from one peg to another when there are four pegs instead of three,
show that
Wn(n+1)/2  2Wn(n‚àí1)/2 + Tn ,
for n > 0.
(Here Tn = 2n ‚àí1 is the ordinary three-peg number.) Use this to nd a
closed form f(n) such that Wn(n+1)/2  f(n) for all n  0.
18
Show that the following set of n bent lines denes Zn regions, where Zn
is dened in (1.7): The jth bent line, for 1  j  n, has its zig at (n2j, 0)
and goes up through the points (n2j ‚àínj, 1) and (n2j ‚àínj ‚àín‚àín, 1).
19
Is it possible to obtain Zn regions with n bent lines when the angle at
each zig is 30‚ó¶?
20
Use the repertoire method to solve the general ve-parameter recurrence
Is this like a
ve-star general
recurrence?
h(1) = Œ± ;
h(2n + j) = 4h(n) + Œ≥jn + Œ≤j ,
for j = 0, 1
and
n  1.
Hint: Try the functions h(n) = n and h(n) = n2.

20
RECURRENT PROBLEMS
21
Suppose there are 2n people in a circle; the rst n are \good guys"
and the last n are \bad guys." Show that there is always an integer m
(depending on n) such that, if we go around the circle executing every
mth person, all the bad guys are rst to go. (For example, when n = 3
we can take m = 5; when n = 4 we can take m = 30.)
Bonus problems
22
Show that it's possible to construct a Venn diagram for all 2n possible
subsets of n given sets, using n convex polygons that are congruent to
each other and rotated about a common center.
23
Suppose that Josephus nds himself in a given position j, but he has a
chance to name the elimination parameter q such that every qth person
is executed. Can he always save himself?
Research problems
24
Find all recurrence relations of the form
Xn = 1 + a1Xn‚àí1 + ¬∑ ¬∑ ¬∑ + akXn‚àík
b1Xn‚àí1 + ¬∑ ¬∑ ¬∑ + bkXn‚àík
whose solution is periodic.
25
Solve innitely many cases of the four-peg Tower of Hanoi problem by
proving that equality holds in the relation of exercise 17.
26
Generalizing exercise 23, let's say that a Josephus subset of f1, 2, . . . , ng
is a set of k numbers such that, for some q, the people with the other n‚àík
numbers will be eliminated rst. (These are the k positions of the \good
guys" Josephus wants to save.) It turns out that when n = 9, three of the
29 possible subsets are non-Josephus, namely f1, 2, 5, 8, 9g, f2, 3, 4, 5, 8g,
and f2, 5, 6, 7, 8g. There are 13 non-Josephus sets when n = 12, none for
any other values of n  12. Are non-Josephus subsets rare for large n?
Yes, and well done
if you nd them.

2
Sums
SUMS ARE EVERYWHERE in mathematics, so we need basic tools to handle
them. This chapter develops the notation and general techniques that make
summation user-friendly.
2.1
NOTATION
In Chapter 1 we encountered the sum of the rst n integers, which
we wrote out as 1 + 2 + 3 + ¬∑ ¬∑ ¬∑ + (n ‚àí1) + n. The ` ¬∑ ¬∑ ¬∑ ' in such formulas tells
us to complete the pattern established by the surrounding terms. Of course
we have to watch out for sums like 1 + 7 + ¬∑ ¬∑ ¬∑ + 41.7, which are meaningless
without a mitigating context. On the other hand, the inclusion of terms like
3 and (n ‚àí1) was a bit of overkill; the pattern would presumably have been
clear if we had written simply 1 + 2 + ¬∑ ¬∑ ¬∑ + n. Sometimes we might even be
so bold as to write just 1 + ¬∑ ¬∑ ¬∑ + n.
We'll be working with sums of the general form
a1 + a2 + ¬∑ ¬∑ ¬∑ + an ,
(2.1)
where each ak is a number that has been dened somehow. This notation has
the advantage that we can \see" the whole sum, almost as if it were written
out in full, if we have a good enough imagination.
Each element ak of a sum is called a term. The terms are often specied
A term is how long
this course lasts.
implicitly as formulas that follow a readily perceived pattern, and in such cases
we must sometimes write them in an expanded form so that the meaning is
clear. For example, if
1 + 2 + ¬∑ ¬∑ ¬∑ + 2n‚àí1
is supposed to denote a sum of n terms, not of 2n‚àí1, we should write it more
explicitly as
20 + 21 + ¬∑ ¬∑ ¬∑ + 2n‚àí1.
21

22
SUMS
The three-dots notation has many uses, but it can be ambiguous and a
\Le signe Pi=‚àû
i=1
in-
dique que l'on doit
donner au nombre
entier i toutes ses
valeurs 1, 2, 3,
. . . , et prendre la
somme des termes."
|J. Fourier [127]
bit long-winded. Other alternatives are available, notably the delimited form
n
X
k=1
ak ,
(2.2)
which is called Sigma-notation because it uses the Greek letter P (upper-
case sigma).
This notation tells us to include in the sum precisely those
terms ak whose index k is an integer that lies between the lower and upper
limits 1 and n, inclusive. In words, we \sum over k, from 1 to n." Joseph
Fourier introduced this delimited P-notation in 1820, and it soon took the
mathematical world by storm.
Incidentally, the quantity after P (here ak) is called the summand.
The index variable k is said to be bound to the P sign in (2.2), because
the k in ak is unrelated to appearances of k outside the Sigma-notation. Any
other letter could be substituted for k here without changing the meaning of
Well, I wouldn't
want to use a or n
as the index vari-
able instead of k in
(2.2); those letters
are \free variables"
that do have mean-
ing outside the P
here.
(2.2). The letter i is often used (perhaps because it stands for \index"), but
we'll generally sum on k since it's wise to keep i for
‚àö
‚àí1.
It turns out that a generalized Sigma-notation is even more useful than
the delimited form: We simply write one or more conditions under the P,
to specify the set of indices over which summation should take place. For
example, the sums in (2.1) and (2.2) can also be written as
X
1kn
ak .
(2.3)
In this particular example there isn't much dierence between the new form
and (2.2), but the general form allows us to take sums over index sets that
aren't restricted to consecutive integers. For example, we can express the sum
of the squares of all odd positive integers below 100 as follows:
X
1k<100
k odd
k2 .
The delimited equivalent of this sum,
49
X
k=0
(2k + 1)2 ,
is more cumbersome and less clear. Similarly, the sum of reciprocals of all
prime numbers between 1 and N is
X
pN
p prime
1
p ;

2.1 NOTATION
23
the delimited form would require us to write
œÄ(N)
X
k=1
1
pk
,
where pk denotes the kth prime and œÄ(N) is the number of primes  N.
(Incidentally, this sum gives the approximate average number of distinct
prime factors of a random integer near N, since about 1/p of those inte-
gers are divisible by p. Its value for large N is approximately ln ln N + M,
where M ‚âà0.2614972128476427837554268386086958590515666 is Mertens's
constant [271]; ln x stands for the natural logarithm of x, and ln ln x stands
for ln(ln x).)
The biggest advantage of general Sigma-notation is that we can manip-
ulate it more easily than the delimited form. For example, suppose we want
The summation
symbol looks like
a distorted pacman.
to change the index variable k to k + 1. With the general form, we have
X
1kn
ak =
X
1k+1n
ak+1 ;
it's easy to see what's going on, and we can do the substitution almost without
thinking. But with the delimited form, we have
n
X
k=1
ak =
n‚àí1
X
k=0
ak+1 ;
it's harder to see what's happened, and we're more likely to make a mistake.
On the other hand, the delimited form isn't completely useless.
It's
nice and tidy, and we can write it quickly because (2.2) has seven symbols
A tidy sum.
compared with (2.3)'s eight. Therefore we'll often use P with upper and
lower delimiters when we state a problem or present a result, but we'll prefer
to work with relations-under-P when we're manipulating a sum whose index
variables need to be transformed.
The P sign occurs more than 1000 times in this book, so we should be
That's nothing.
You should see how
many times  ap-
pears in The Iliad.
sure that we know exactly what it means. Formally, we write
X
P(k)
ak
(2.4)
as an abbreviation for the sum of all terms ak such that k is an integer
satisfying a given property P(k). (A \property P(k)" is any statement about
k that can be either true or false.) For the time being, we'll assume that
only nitely many integers k satisfying P(k) have ak Ã∏= 0; otherwise innitely
many nonzero numbers are being added together, and things can get a bit

24
SUMS
tricky. At the other extreme, if P(k) is false for all integers k, we have an
\empty" sum; the value of an empty sum is dened to be zero.
A slightly modied form of (2.4) is used when a sum appears within the
text of a paragraph rather than in a displayed equation: We write `P
P(k) ak',
attaching property P(k) as a subscript of P, so that the formula won't stick
out too much. Similarly, `Pn
k=1 ak' is a convenient alternative to (2.2) when
we want to conne the notation to a single line.
People are often tempted to write
n‚àí1
X
k=2
k(k ‚àí1)(n ‚àík)
instead of
n
X
k=0
k(k ‚àí1)(n ‚àík)
because the terms for k = 0, 1, and n in this sum are zero. Somehow it
seems more ecient to add up n ‚àí2 terms instead of n + 1 terms. But such
temptations should be resisted; eciency of computation is not the same as
eciency of understanding! We will nd it advantageous to keep upper and
lower bounds on an index of summation as simple as possible, because sums
can be manipulated much more easily when the bounds are simple. Indeed,
the form Pn‚àí1
k=2 can even be dangerously ambiguous, because its meaning is
not at all clear when n = 0 or n = 1 (see exercise 1). Zero-valued terms cause
no harm, and they often save a lot of trouble.
So far the notations we've been discussing are quite standard, but now
we are about to make a radical departure from tradition. Kenneth E. Iverson
introduced a wonderful idea in his programming language APL [191, page 11;
see also 220], and we'll see that it greatly simplies many of the things we
want to do in this book. The idea is simply to enclose a true-or-false statement
in brackets, and to say that the result is 1 if the statement is true, 0 if the
Hey: The \Kro-
necker delta" that
I've seen in other
books (I mean
Œ¥kn , which is 1 if
k = n, 0 oth-
erwise) is just a
special case of
Iverson's conven-
tion: We can write
[ k = n ] instead.
statement is false. For example,
[p prime] =
¬Ø
1,
if p is a prime number;
0,
if p is not a prime number.
Iverson's convention allows us to express sums with no constraints whatever
on the index of summation, because we can rewrite (2.4) in the form
X
k
ak
¬£
P(k)
¬§
.
(2.5)
If P(k) is false, the term ak
¬£
P(k)
¬§
is zero, so we can safely include it among
the terms being summed.
This makes it easy to manipulate the index of
summation, because we don't have to fuss with boundary conditions.
\I am often surprised
by new, important
applications [of this
notation]."
|B. de Finetti [123]
A slight technicality needs to be mentioned: Sometimes ak isn't dened
for all integers k. We get around this diculty by assuming that
¬£
P(k)
¬§
is
\very strongly zero" when P(k) is false; it's so much zero, it makes ak
¬£
P(k)
¬§

2.1 NOTATION
25
equal to zero even when ak is undened. For example, if we use Iverson's
convention to write the sum of reciprocal primes  N as
X
p
[p prime][p  N]/p ,
there's no problem of division by zero when p = 0, because our convention
tells us that [0 prime][0  N]/0 = 0.
Let's sum up what we've discussed so far about sums. There are two
good ways to express a sum of terms: One way uses ` ¬∑ ¬∑ ¬∑ ', the other uses
` P '. The three-dots form often suggests useful manipulations, particularly
the combination of adjacent terms, since we might be able to spot a simplifying
pattern if we let the whole sum hang out before our eyes. But too much detail
can also be overwhelming. Sigma-notation is compact, impressive to family
and friends, and often suggestive of manipulations that are not obvious in
. . . and it's less
likely to lose points
on an exam for
\lack of rigor."
three-dots form.
When we work with Sigma-notation, zero terms are not
generally harmful; in fact, zeros often make P-manipulation easier.
2.2
SUMS AND RECURRENCES
OK, we understand now how to express sums with fancy notation.
But how does a person actually go about nding the value of a sum? One way
is to observe that there's an intimate relation between sums and recurrences.
The sum
Sn =
n
X
k=0
ak
is equivalent to the recurrence
(Think of Sn as
not just a single
number, but as a
sequence dened for
all n  0.)
S0 = a0 ;
Sn = Sn‚àí1 + an ,
for n > 0.
(2.6)
Therefore we can evaluate sums in closed form by using the methods we
learned in Chapter 1 to solve recurrences in closed form.
For example, if an is equal to a constant plus a multiple of n, the sum-
recurrence (2.6) takes the following general form:
R0 = Œ± ;
Rn = Rn‚àí1 + Œ≤ + Œ≥n ,
for n > 0.
(2.7)
Proceeding as in Chapter 1, we nd R1 = Œ± + Œ≤ + Œ≥, R2 = Œ± + 2Œ≤ + 3Œ≥, and
so on; in general the solution can be written in the form
Rn = A(n)Œ± + B(n)Œ≤ + C(n)Œ≥ ,
(2.8)

26
SUMS
where A(n), B(n), and C(n) are the coecients of dependence on the general
parameters Œ±, Œ≤, and Œ≥.
The repertoire method tells us to try plugging in simple functions of n
for Rn, hoping to nd constant parameters Œ±, Œ≤, and Œ≥ where the solution is
especially simple. Setting Rn = 1 implies Œ± = 1, Œ≤ = 0, Œ≥ = 0; hence
A(n) = 1 .
Setting Rn = n implies Œ± = 0, Œ≤ = 1, Œ≥ = 0; hence
B(n) = n .
Setting Rn = n2 implies Œ± = 0, Œ≤ = ‚àí1, Œ≥ = 2; hence
2C(n) ‚àíB(n) = n2
and we have C(n) = (n2 + n)/2. Easy as pie.
Actually easier; œÄ =
P
n0
8
(4n+1)(4n+3).
Therefore if we wish to evaluate
n
X
k=0
(a + bk) ,
the sum-recurrence (2.6) boils down to (2.7) with Œ± = Œ≤ = a, Œ≥ = b, and the
answer is aA(n) + aB(n) + bC(n) = a(n + 1) + b(n + 1)n/2.
Conversely, many recurrences can be reduced to sums; therefore the spe-
cial methods for evaluating sums that we'll be learning later in this chapter
will help us solve recurrences that might otherwise be dicult. The Tower of
Hanoi recurrence is a case in point:
T0 = 0 ;
Tn = 2Tn‚àí1 + 1 ,
for n > 0.
It can be put into the special form (2.6) if we divide both sides by 2n:
T0/20 = 0;
Tn/2n = Tn‚àí1/2n‚àí1 + 1/2n ,
for n > 0.
Now we can set Sn = Tn/2n, and we have
S0 = 0;
Sn = Sn‚àí1 + 2‚àín ,
for n > 0.
It follows that
Sn =
n
X
k=1
2‚àík.

2.2 SUMS AND RECURRENCES
27
(Notice that we've left the term for k = 0 out of this sum.) The sum of the
geometric series 2‚àí1+2‚àí2+¬∑ ¬∑ ¬∑+2‚àín = ( 1
2)1+( 1
2)2+¬∑ ¬∑ ¬∑+( 1
2)n will be derived
later in this chapter; it turns out to be 1 ‚àí( 1
2)n. Hence Tn = 2nSn = 2n ‚àí1.
We have converted Tn to Sn in this derivation by noticing that the re-
currence could be divided by 2n. This trick is a special case of a general
technique that can reduce virtually any recurrence of the form
anTn = bnTn‚àí1 + cn
(2.9)
to a sum. The idea is to multiply both sides by a summation factor, sn:
snanTn = snbnTn‚àí1 + sncn .
This factor sn is cleverly chosen to make
snbn = sn‚àí1an‚àí1 .
Then if we write Sn = snanTn we have a sum-recurrence,
Sn = Sn‚àí1 + sncn .
Hence
Sn = s0a0T0 +
n
X
k=1
skck = s1b1T0 +
n
X
k=1
skck ,
and the solution to the original recurrence (2.9) is
Tn =
1
snan
¬µ
s1b1T0 +
n
X
k=1
skck
¬∂
.
(2.10)
For example, when n = 1 we get T1 = (s1b1T0+s1c1)/s1a1 = (b1T0+c1)/a1.
(The value of s1
cancels out, so it
can be anything
but zero.)
But how can we be clever enough to nd the right sn? No problem: The
relation sn = sn‚àí1an‚àí1/bn can be unfolded to tell us that the fraction
sn = an‚àí1an‚àí2 . . . a1
bnbn‚àí1 . . . b2
,
(2.11)
or any convenient constant multiple of this value, will be a suitable summation
factor. For example, the Tower of Hanoi recurrence has an = 1 and bn = 2;
the general method we've just derived says that sn = 2‚àín is a good thing to
multiply by, if we want to reduce the recurrence to a sum. We don't need a
brilliant ash of inspiration to discover this multiplier.
We must be careful, as always, not to divide by zero. The summation-
factor method works whenever all the a's and all the b's are nonzero.

28
SUMS
Let's apply these ideas to a recurrence that arises in the study of \quick-
sort," one of the most important methods for sorting data inside a computer.
(Quicksort was
invented by Hoare
in 1962 [189].)
The average number of comparison steps made by quicksort when it is applied
to n items in random order satises the recurrence
C0 = 0 ;
Cn = n + 1 + 2
n
n‚àí1
X
k=0
Ck ,
for n > 0.
(2.12)
Hmmm. This looks much scarier than the recurrences we've seen before; it
includes a sum over all previous values, and a division by n. Trying small
cases gives us some data (C1 = 2, C2 = 5, C3 = 26
3 ) but doesn't do anything
to quell our fears.
We can, however, reduce the complexity of (2.12) systematically, by rst
getting rid of the division and then getting rid of the P sign. The idea is to
multiply both sides by n, obtaining the relation
nCn = n2 + n + 2
n‚àí1
X
k=0
Ck ,
for n > 0;
hence, if we replace n by n ‚àí1,
(n ‚àí1)Cn‚àí1 = (n ‚àí1)2 + (n ‚àí1) + 2
n‚àí2
X
k=0
Ck ,
for n ‚àí1 > 0.
We can now subtract the second equation from the rst, and the P sign
disappears:
nCn ‚àí(n ‚àí1)Cn‚àí1 = 2n + 2Cn‚àí1 ,
for n > 1.
It turns out that this relation also holds when n = 1, because C1 = 2.
Therefore the original recurrence for Cn reduces to a much simpler one:
C0 = 0 ;
nCn = (n + 1)Cn‚àí1 + 2n ,
for n > 0.
Progress. We're now in a position to apply a summation factor, since this
recurrence has the form of (2.9) with an = n, bn = n + 1, and cn = 2n.
The general method described on the preceding page tells us to multiply the
recurrence through by some multiple of
sn = an‚àí1an‚àí2 . . . a1
bnbn‚àí1 . . . b2
= (n ‚àí1) ¬∑ (n ‚àí2) ¬∑ . . . ¬∑ 1
(n + 1) ¬∑ n ¬∑ . . . ¬∑ 3
=
2
(n + 1)n .

2.2 SUMS AND RECURRENCES
29
The solution, according to (2.10), is therefore
We started with a
P in the recur-
rence, and worked
hard to get rid of it.
But then after ap-
plying a summation
factor, we came up
with another P.
Are sums good, or
bad, or what?
Cn = 2(n + 1)
n
X
k=1
1
k + 1 .
The sum that remains is very similar to a quantity that arises frequently
in applications. It arises so often, in fact, that we give it a special name and
a special notation:
Hn = 1 + 1
2 + ¬∑ ¬∑ ¬∑ + 1
n =
n
X
k=1
1
k .
(2.13)
The letter H stands for \harmonic"; Hn is a harmonic number, so called
because the kth harmonic produced by a violin string is the fundamental
tone produced by a string that is 1/k times as long.
We can complete our study of the quicksort recurrence (2.12) by putting
Cn into closed form; this will be possible if we can express Cn in terms of
Hn. The sum in our formula for Cn is
n
X
k=1
1
k + 1 =
X
1kn
1
k + 1 .
We can relate this to Hn without much diculty by changing k to k ‚àí1 and
revising the boundary conditions:
X
1kn
1
k + 1 =
X
1k‚àí1n
1
k
=
X
2kn+1
1
k
=
¬µ X
1kn
1
k
¬∂
‚àí1
1 +
1
n + 1 = Hn ‚àí
n
n + 1 .
Alright! We have found the sum needed to complete the solution to (2.12):
But your spelling is
alwrong.
The average number of comparisons made by quicksort when it is applied to
n randomly ordered items of data is
Cn = 2(n + 1)Hn ‚àí2n .
(2.14)
As usual, we check that small cases are correct: C0 = 0, C1 = 2, C2 = 5.

30
SUMS
2.3
MANIPULATION OF SUMS
The key to success with sums is an ability to change one P into
another that is simpler or closer to some goal. And it's easy to do this by
Not to be confused
with nance.
learning a few basic rules of transformation and by practicing their use.
Let K be any nite set of integers. Sums over the elements of K can be
transformed by using three simple rules:
X
k‚ààK
cak = c
X
k‚ààK
ak ;
(distributive law)
(2.15)
X
k‚ààK
(ak + bk) =
X
k‚ààK
ak +
X
k‚ààK
bk ;
(associative law)
(2.16)
X
k‚ààK
ak =
X
p(k)‚ààK
ap(k) .
(commutative law)
(2.17)
The distributive law allows us to move constants in and out of a P. The
associative law allows us to break a P into two parts, or to combine two P's
into one. The commutative law says that we can reorder the terms in any way
we please; here p(k) is any permutation of the set of all integers. For example,
Why not call it
permutative instead
of commutative?
if K = f‚àí1, 0, +1g and if p(k) = ‚àík, these three laws tell us respectively that
ca‚àí1 + ca0 + ca1 = c(a‚àí1 + a0 + a1) ;
(distributive law)
(a‚àí1 + b‚àí1) + (a0 + b0) + (a1 + b1)
= (a‚àí1 + a0 + a1) + (b‚àí1 + b0 + b1) ;
(associative law)
a‚àí1 + a0 + a1 = a1 + a0 + a‚àí1 .
(commutative law)
Gauss's trick in Chapter 1 can be viewed as an application of these three
basic laws. Suppose we want to compute the general sum of an arithmetic
progression,
S =
X
0kn
(a + bk) .
By the commutative law we can replace k by n ‚àík, obtaining
This is something
like changing vari-
ables inside an
integral, but easier.
S =
X
0n‚àíkn
¬°
a + b(n ‚àík)
¬¢
=
X
0kn
(a + bn ‚àíbk) .
These two equations can be added by using the associative law:
2S =
X
0kn
¬°
(a + bk) + (a + bn ‚àíbk)
¬¢
=
X
0kn
(2a + bn) .

2.3 MANIPULATION OF SUMS
31
And we can now apply the distributive law and evaluate a trivial sum:
\What's one
and one and one
and one and one
and one and one
and one and one
and one?"
\I don't know,"
said Alice.
\I lost count."
\She can't do
Addition."
|Lewis Carroll [50]
2S = (2a + bn)
X
0kn
1 = (2a + bn)(n + 1) .
Dividing by 2, we have proved that
n
X
k=0
(a + bk) = (a + 1
2bn)(n + 1) .
(2.18)
The right-hand side can be remembered as the average of the rst and last
terms, namely 1
2
¬°
a + (a + bn)
¬¢
, times the number of terms, namely (n + 1).
It's important to bear in mind that the function p(k) in the general
commutative law (2.17) is supposed to be a permutation of all the integers. In
other words, for every integer n there should be exactly one integer k such that
p(k) = n. Otherwise the commutative law might fail; exercise 3 illustrates
this with a vengeance. Transformations like p(k) = k + c or p(k) = c ‚àík,
where c is an integer constant, are always permutations, so they always work.
On the other hand, we can relax the permutation restriction a little bit:
We need to require only that there be exactly one integer k with p(k) = n
when n is an element of the index set K. If n /‚ààK (that is, if n is not in K),
it doesn't matter how often p(k) = n occurs, because such k don't take part
in the sum. Thus, for example, we can argue that
X
k‚ààK
k even
ak =
X
n‚ààK
n even
an =
X
2k‚ààK
2k even
a2k =
X
2k‚ààK
a2k ,
(2.19)
since there's exactly one k such that 2k = n when n ‚ààK and n is even.
Iverson's convention, which allows us to obtain the values 0 or 1 from
logical statements in the middle of a formula, can be used together with the
distributive, associative, and commutative laws to deduce additional proper-
Additional, eh?
ties of sums. For example, here is an important rule for combining dierent
sets of indices: If K and K‚Ä≤ are any sets of integers, then
X
k‚ààK
ak
+
X
k‚ààK ‚Ä≤
ak
=
X
k‚ààK‚à©K ‚Ä≤
ak
+
X
k‚ààK‚à™K ‚Ä≤
ak .
(2.20)
This follows from the general formulas
X
k‚ààK
ak
=
X
k
ak [k ‚ààK]
(2.21)
and
[k ‚ààK] + [k ‚ààK‚Ä≤] = [k ‚ààK ‚à©K‚Ä≤] + [k ‚ààK ‚à™K‚Ä≤] .
(2.22)

32
SUMS
Typically we use rule (2.20) either to combine two almost-disjoint index sets,
as in
m
X
k=1
ak
+
n
X
k=m
ak
=
am
+
n
X
k=1
ak ,
for 1  m  n;
or to split o a single term from a sum, as in
(The two sides of
(2.20) have been
switched here.)
X
0kn
ak
=
a0
+
X
1kn
ak ,
for n  0.
(2.23)
This operation of splitting o a term is the basis of a perturbation
method that often allows us to evaluate a sum in closed form.
The idea
is to start with an unknown sum and call it Sn:
Sn =
X
0kn
ak .
(Name and conquer.) Then we rewrite Sn+1 in two ways, by splitting o both
its last term and its rst term:
Sn + an+1 =
X
0kn+1
ak = a0 +
X
1kn+1
ak
= a0 +
X
1k+1n+1
ak+1
= a0 +
X
0kn
ak+1 .
(2.24)
Now we can work on this last sum and try to express it in terms of Sn. If we
succeed, we obtain an equation whose solution is the sum we seek.
For example, let's use this approach to nd the sum of a general geomet-
If it's geometric,
there should be a
geometric proof.






















BB
B
BB
B
B
B
BB
B
B
B
B
BB
B
B
B
B
BB
B
B
B
BB
B
BB
BB
¬£¬£
¬£¬£
¬£¬£
P
P
P
P
P
P
P
P
P
P
P
P
P
P
ric progression,
Sn =
X
0kn
axk .
The general perturbation scheme in (2.24) tells us that
Sn + axn+1 = ax0 +
X
0kn
axk+1 ,
and the sum on the right is x P
0kn axk = xSn by the distributive law.
Therefore Sn + axn+1 = a + xSn, and we can solve for Sn to obtain
n
X
k=0
axk = a ‚àíaxn+1
1 ‚àíx
,
for x Ã∏= 1.
(2.25)

2.3 MANIPULATION OF SUMS
33
(When x = 1, the sum is of course simply (n + 1)a.) The right-hand side
can be remembered as the rst term included in the sum minus the rst term
Ah yes, this formula
was drilled into me
in high school.
excluded (the term after the last), divided by 1 minus the term ratio.
That was almost too easy.
Let's try the perturbation technique on a
slightly more dicult sum,
Sn =
X
0kn
k 2k .
In this case we have S0 = 0, S1 = 2, S2 = 10, S3 = 34, S4 = 98; what is the
general formula? According to (2.24) we have
Sn + (n + 1)2n+1 =
X
0kn
(k + 1)2k+1 ;
so we want to express the right-hand sum in terms of Sn. Well, we can break
it into two sums with the help of the associative law,
X
0kn
k 2k+1
+
X
0kn
2k+1 ,
and the rst of the remaining sums is 2Sn. The other sum is a geometric
progression, which equals (2 ‚àí2n+2)/(1 ‚àí2) = 2n+2 ‚àí2 by (2.25). Therefore
we have Sn + (n + 1)2n+1 = 2Sn + 2n+2 ‚àí2, and algebra yields
X
0kn
k 2k = (n ‚àí1)2n+1 + 2 .
Now we understand why S3 = 34: It's 32 + 2, not 2¬∑17.
A similar derivation with x in place of 2 would have given us the equation
Sn + (n + 1)xn+1 = xSn + (x ‚àíxn+2)/(1 ‚àíx); hence we can deduce that
n
X
k=0
kxk = x ‚àí(n + 1)xn+1 + nxn+2
(1 ‚àíx)2
,
for x Ã∏= 1.
(2.26)
It's interesting to note that we could have derived this closed form in a
completely dierent way, by using elementary techniques of dierential cal-
culus. If we start with the equation
n
X
k=0
xk = 1 ‚àíxn+1
1 ‚àíx
and take the derivative of both sides with respect to x, we get
n
X
k=0
kxk‚àí1 = (1‚àíx)
¬°
‚àí(n+1)xn¬¢
+ 1‚àíxn+1
(1 ‚àíx)2
= 1 ‚àí(n+1)xn + nxn+1
(1 ‚àíx)2
,

34
SUMS
because the derivative of a sum is the sum of the derivatives of its terms. We
will see many more connections between calculus and discrete mathematics
in later chapters.
2.4
MULTIPLE SUMS
The terms of a sum might be specied by two or more indices, not
just by one. For example, here's a double sum of nine terms, governed by two
Oh no, a nine-term
governor.
indices j and k:
Notice that this
doesn't mean to
sum over all j  1
and all k  3.
X
1j,k3
ajbk = a1b1 + a1b2 + a1b3
+ a2b1 + a2b2 + a2b3
+ a3b1 + a3b2 + a3b3 .
We use the same notations and methods for such sums as we do for sums with
a single index. Thus, if P(j, k) is a property of j and k, the sum of all terms
aj,k such that P(j, k) is true can be written in two ways, one of which uses
Iverson's convention and sums over all pairs of integers j and k:
X
P(j,k)
aj,k =
X
j,k
aj,k
¬£
P(j, k)
¬§
.
Only one P sign is needed, although there is more than one index of sum-
mation; P denotes a sum over all combinations of indices that apply.
We also have occasion to use two P's, when we're talking about a sum
of sums. For example,
X
j
X
k
aj,k
¬£
P(j, k)
¬§
is an abbreviation for
X
j
¬µX
k
aj,k
¬£
P(j, k)
¬§¬∂
,
which is the sum, over all integers j, of P
k aj,k
¬£
P(j, k)
¬§
, the latter being the
Multiple 's are
evaluated right to
left (inside-out).
sum over all integers k of all terms aj,k for which P(j, k) is true. In such cases
we say that the double sum is \summed rst on k." A sum that depends on
more than one index can be summed rst on any one of its indices.
In this regard we have a basic law called interchanging the order of
summation, which generalizes the associative law (2.16) we saw earlier:
X
j
X
k
aj,k
¬£
P(j, k)
¬§
=
X
P(j,k)
aj,k =
X
k
X
j
aj,k
¬£
P(j, k)
¬§
.
(2.27)

2.4 MULTIPLE SUMS
35
The middle term of this law is a sum over two indices. On the left, P
j
P
k
stands for summing rst on k, then on j. On the right, P
k
P
j stands for
summing rst on j, then on k. In practice when we want to evaluate a double
sum in closed form, it's usually easier to sum it rst on one index rather than
on the other; we get to choose whichever is more convenient.
Sums of sums are no reason to panic, but they can appear confusing to
Who's panicking?
I think this rule
is fairly obvious
compared to some
of the stu in
Chapter 1.
a beginner, so let's do some more examples. The nine-term sum we began
with provides a good illustration of the manipulation of double sums, because
that sum can actually be simplied, and the simplication process is typical
of what we can do with P P's:
X
1j,k3
ajbk =
X
j,k
ajbk[1  j, k  3] =
X
j,k
ajbk[1  j  3][1  k  3]
=
X
j
X
k
ajbk[1  j  3][1  k  3]
=
X
j
aj[1  j  3]
X
k
bk[1  k  3]
=
X
j
aj[1  j  3]
¬µX
k
bk[1  k  3]
¬∂
=
¬µX
j
aj[1  j  3]
¬∂¬µX
k
bk[1  k  3]
¬∂
=
¬µ 3
X
j=1
aj
¬∂¬µ 3
X
k=1
bk
¬∂
.
The rst line here denotes a sum of nine terms in no particular order. The
second line groups them in threes, (a1b1 + a1b2 + a1b3) + (a2b1 + a2b2 +
a2b3) + (a3b1 + a3b2 + a3b3). The third line uses the distributive law to
factor out the a's, since aj and [1  j  3] do not depend on k; this gives
a1(b1 + b2 + b3) + a2(b1 + b2 + b3) + a3(b1 + b2 + b3). The fourth line is
the same as the third, but with a redundant pair of parentheses thrown in
so that the fth line won't look so mysterious. The fth line factors out the
(b1 + b2 + b3) that occurs for each value of j: (a1 + a2 + a3)(b1 + b2 + b3).
The last line is just another way to write the previous line. This method of
derivation can be used to prove a general distributive law,
X
j‚ààJ
k‚ààK
ajbk =
¬µ X
j‚ààJ
aj
¬∂¬µ X
k‚ààK
bk
¬∂
,
(2.28)
valid for all sets of indices J and K.
The basic law (2.27) for interchanging the order of summation has many
variations, which arise when we want to restrict the ranges of the indices

36
SUMS
instead of summing over all integers j and k. These variations come in two
avors, vanilla and rocky road. First, the vanilla version:
X
j‚ààJ
X
k‚ààK
aj,k =
X
j‚ààJ
k‚ààK
aj,k =
X
k‚ààK
X
j‚ààJ
aj,k .
(2.29)
This is just another way to write (2.27), since the Iversonian [j ‚ààJ, k ‚ààK]
factors into [j ‚ààJ][k ‚ààK]. The vanilla-avored law applies whenever the ranges
of j and k are independent of each other.
The rocky-road formula for interchange is a little trickier. It applies when
the range of an inner sum depends on the index variable of the outer sum:
X
j‚ààJ
X
k‚ààK(j)
aj,k =
X
k‚ààK ‚Ä≤
X
j‚ààJ ‚Ä≤(k)
aj,k .
(2.30)
Here the sets J, K(j), K‚Ä≤, and J‚Ä≤(k) must be related in such a way that
[j ‚ààJ]
¬£
k ‚ààK(j)
¬§
= [k ‚ààK‚Ä≤]
¬£
j ‚ààJ‚Ä≤(k)
¬§
.
A factorization like this is always possible in principle, because we can let
J = K‚Ä≤ be the set of all integers and K(j) = J‚Ä≤(k) be the basic property P(j, k)
that governs a double sum. But there are important special cases where the
sets J, K(j), K‚Ä≤, and J‚Ä≤(k) have a simple form.
These arise frequently in
applications. For example, here's a particularly useful factorization:
[1  j  n][j  k  n] = [1  j  k  n] = [1  k  n][1  j  k] .
(2.31)
This Iversonian equation allows us to write
n
X
j=1
n
X
k=j
aj,k =
X
1jkn
aj,k =
n
X
k=1
k
X
j=1
aj,k .
(2.32)
One of these two sums of sums is usually easier to evaluate than the other;
(Now is a good
time to do warmup
exercises 4 and 6.)
(Or to check out
the Snickers bar
languishing in the
freezer.)
we can use (2.32) to switch from the hard one to the easy one.
Let's apply these ideas to a useful example. Consider the array
Ô£Æ
Ô£ØÔ£ØÔ£ØÔ£ØÔ£∞
a1a1
a1a2
a1a3
. . .
a1an
a2a1
a2a2
a2a3
. . .
a2an
a3a1
a3a2
a3a3
. . .
a3an
...
...
...
...
...
ana1
ana2
ana3
. . .
anan
Ô£π
Ô£∫Ô£∫Ô£∫Ô£∫Ô£ª
of n2 products ajak. Our goal will be to nd a simple formula for
S@ =
X
1jkn
ajak ,

2.4 MULTIPLE SUMS
37
the sum of all elements on or above the main diagonal of this array. Because
ajak = akaj, the array is symmetrical about its main diagonal; therefore S@
will be approximately half the sum of all the elements (except for a fudge
factor that takes account of the main diagonal).
Does rocky road
have fudge in it?
Such considerations motivate the following manipulations. We have
S@ =
X
1jkn
ajak =
X
1kjn
akaj =
X
1kjn
ajak = S@ ,
because we can rename (j, k) as (k, j). Furthermore, since
[1  j  k  n] + [1  k  j  n] = [1  j, k  n] + [1  j = k  n] ,
we have
2S@ = S@ + S@ =
X
1j,kn
ajak
+
X
1j=kn
ajak .
The rst sum is
¬°Pn
j=1 aj
¬¢¬°Pn
k=1 ak
¬¢
=
¬°Pn
k=1 ak
¬¢2, by the general distribu-
tive law (2.28). The second sum is Pn
k=1 a2
k. Therefore we have
S@ =
X
1jkn
ajak = 1
2
√É¬µ n
X
k=1
ak
¬∂2
+
n
X
k=1
a2
k
!
,
(2.33)
an expression for the upper triangular sum in terms of simpler single sums.
Encouraged by such success, let's look at another double sum:
S =
X
1j<kn
(ak ‚àíaj)(bk ‚àíbj) .
Again we have symmetry when j and k are interchanged:
S =
X
1k<jn
(aj ‚àíak)(bj ‚àíbk) =
X
1k<jn
(ak ‚àíaj)(bk ‚àíbj) .
So we can add S to itself, making use of the identity
[1  j < k  n] + [1  k < j  n] = [1  j, k  n] ‚àí[1  j = k  n]
to conclude that
2S =
X
1j,kn
(aj ‚àíak)(bj ‚àíbk) ‚àí
X
1j=kn
(aj ‚àíak)(bj ‚àíbk) .

38
SUMS
The second sum here is zero; what about the rst?
It expands into four
separate sums, each of which is vanilla avored:
X
1j,kn
ajbj
‚àí
X
1j,kn
ajbk
‚àí
X
1j,kn
akbj
+
X
1j,kn
akbk
= 2
X
1j,kn
akbk
‚àí2
X
1j,kn
ajbk
= 2n
X
1kn
akbk
‚àí2
¬µ n
X
k=1
ak
¬∂¬µ n
X
k=1
bk
¬∂
.
In the last step both sums have been simplied according to the general
distributive law (2.28). If the manipulation of the rst sum seems mysterious,
here it is again in slow motion:
2
X
1j,kn
akbk = 2
X
1kn
X
1jn
akbk
= 2
X
1kn
akbk
X
1jn
1
= 2
X
1kn
akbkn = 2n
X
1kn
akbk .
An index variable that doesn't appear in the summand (here j) can simply
be eliminated if we multiply what's left by the size of that variable's index
set (here n).
Returning to where we left o, we can now divide everything by 2 and
rearrange things to obtain an interesting formula:
¬µ n
X
k=1
ak
¬∂¬µ n
X
k=1
bk
¬∂
= n
n
X
k=1
akbk ‚àí
X
1j<kn
(ak ‚àíaj)(bk ‚àíbj) . (2.34)
This identity yields Chebyshev's monotonic inequalities as a special case:
(Chebyshev [58]
actually proved the
analogous result
for integrals
instead of sums,
(Rb
a f(x) dx)
¬∑ (Rb
a g(x) dx)
 (b ‚àía)
¬∑ (Rb
af(x)g(x) dx),
if f(x) and g(x)
are monotone
nondecreasing
functions.)
¬µ n
X
k=1
ak
¬∂¬µ n
X
k=1
bk
¬∂
 n
n
X
k=1
akbk ,
if a1  ¬∑ ¬∑ ¬∑  an and b1  ¬∑ ¬∑ ¬∑  bn;
¬µ n
X
k=1
ak
¬∂¬µ n
X
k=1
bk
¬∂
 n
n
X
k=1
akbk ,
if a1  ¬∑ ¬∑ ¬∑  an and b1  ¬∑ ¬∑ ¬∑  bn.
(In general, if a1  ¬∑ ¬∑ ¬∑  an and if p is a permutation of f1, . . . , ng, it's
not dicult to prove that the largest value of Pn
k=1 akbp(k) occurs when
bp(1)  ¬∑ ¬∑ ¬∑  bp(n), and the smallest value occurs when bp(1)  ¬∑ ¬∑ ¬∑  bp(n).)

2.4 MULTIPLE SUMS
39
Multiple summation has an interesting connection with the general op-
eration of changing the index of summation in single sums. We know by the
commutative law that
X
k‚ààK
ak =
X
p(k)‚ààK
ap(k) ,
if p(k) is any permutation of the integers. But what happens when we replace
k by f(j), where f is an arbitrary function
f : J ‚ÜíK
that takes an integer j ‚ààJ into an integer f(j) ‚ààK? The general formula for
index replacement is
X
j‚ààJ
af(j) =
X
k‚ààK
ak #f‚àí(k) ,
(2.35)
where #f‚àí(k) stands for the number of elements in the set
f‚àí(k) =
¬©
j
¬Ø¬Ø f(j) = k
¬™
,
that is, the number of values of j ‚ààJ such that f(j) equals k.
It's easy to prove (2.35) by interchanging the order of summation,
X
j‚ààJ
af(j) =
X
j‚ààJ
k‚ààK
ak
¬£
f(j) = k
¬§
=
X
k‚ààK
ak
X
j‚ààJ
¬£
f(j) = k
¬§
,
since P
j‚ààJ
¬£
f(j) = k
¬§
= #f‚àí(k).
In the special case that f is a one-to-one
correspondence between J and K, we have #f‚àí(k) = 1 for all k, and the
My other math
teacher calls this a
\bijection"; maybe
I'll learn to love
that word some day.
And then again . . .
general formula (2.35) reduces to
X
j‚ààJ
af(j) =
X
f(j)‚ààK
af(j) =
X
k‚ààK
ak .
This is the commutative law (2.17) we had before, slightly disguised.
Our examples of multiple sums so far have all involved general terms like
ak or bk. But this book is supposed to be concrete, so let's take a look at a
multiple sum that involves actual numbers:
Sn =
X
1j<kn
1
k ‚àíj .
For example, S1 = 0; S2 = 1; S3 =
1
2‚àí1 +
1
3‚àí1 +
1
3‚àí2 = 5
2.
Watch out|
the authors
seem to think that
j, k, and n are
\actual numbers."

40
SUMS
The normal way to evaluate a double sum is to sum rst on j or rst
on k, so let's explore both options.
Sn =
X
1kn
X
1j<k
1
k ‚àíj
summing rst on j
=
X
1kn
X
1k‚àíj<k
1
j
replacing j by k ‚àíj
=
X
1kn
X
0<jk‚àí1
1
j
simplifying the bounds on j
=
X
1kn
Hk‚àí1
by (2.13), the denition of Hk‚àí1
=
X
1k+1n
Hk
replacing k by k + 1
=
X
0k<n
Hk .
simplifying the bounds on k
Alas! We don't know how to get a sum of harmonic numbers into closed form.
Get out the whip.
If we try summing rst the other way, we get
Sn =
X
1jn
X
j<kn
1
k ‚àíj
summing rst on k
=
X
1jn
X
j<k+jn
1
k
replacing k by k + j
=
X
1jn
X
0<kn‚àíj
1
k
simplifying the bounds on k
=
X
1jn
Hn‚àíj
by (2.13), the denition of Hn‚àíj
=
X
1n‚àíjn
Hj
replacing j by n ‚àíj
=
X
0j<n
Hj .
simplifying the bounds on j
We're back at the same impasse.
But there's another way to proceed, if we replace k by k + j before
deciding to reduce Sn to a sum of sums:
Sn =
X
1j<kn
1
k ‚àíj
recopying the given sum
=
X
1j<k+jn
1
k
replacing k by k + j

2.4 MULTIPLE SUMS
41
=
X
1kn
X
1jn‚àík
1
k
summing rst on j
=
X
1kn
n ‚àík
k
the sum on j is trivial
=
X
1kn
n
k ‚àí
X
1kn
1
by the associative law
= n
¬µ X
1kn
1
k
¬∂
‚àín
by gosh
= nHn ‚àín .
by (2.13), the denition of Hn
Aha! We've found Sn. Combining this with the false starts we made gives us
It's smart to say
k  n instead of
k  n ‚àí1 here.
Simple bounds save
energy.
a further identity as a bonus:
X
0k<n
Hk = nHn ‚àín .
(2.36)
We can understand the trick that worked here in two ways, one algebraic
and one geometric. (1) Algebraically, if we have a double sum whose terms in-
volve k+f(j), where f is an arbitrary function, this example indicates that it's
a good idea to try replacing k by k‚àíf(j) and summing on j. (2) Geometrically,
we can look at this particular sum Sn as follows, in the case n = 4:
k = 1 k = 2 k = 3 k = 4
j = 1
1
1
+
1
2
+
1
3
j = 2
1
1
+
1
2
j = 3
1
1
j = 4
Our rst attempts, summing rst on j (by columns) or on k (by rows), gave
us H1 + H2 + H3 = H3 + H2 + H1. The winning idea was essentially to sum
by diagonals, getting 3
1 + 2
2 + 1
3.
2.5
GENERAL METHODS
Now let's consolidate what we've learned, by looking at a single
example from several dierent angles. On the next few pages we're going to
try to nd a closed form for the sum of the rst n squares, which we'll call
n:
n =
X
0kn
k2 ,
for n  0.
(2.37)
We'll see that there are at least seven dierent ways to solve this problem,
and in the process we'll learn useful strategies for attacking sums in general.

42
SUMS
First, as usual, we look at some small cases.
n
0
1
2
3
4
5
6
7
8
9
10
11
12
n2
0
1
4
9
16
25
36
49
64
81
100
121
144
n
0
1
5
14
30
55
91
140
204
285
385
506
650
No closed form for
n is immediately evident; but when we do nd one, we
can use these values as a check.
Method 0: You could look it up.
A problem like the sum of the rst n squares has probably been solved
before, so we can most likely nd the solution in a handy reference book.
Sure enough, page 36 of the CRC Standard Mathematical Tables [28] has the
answer:
n = n(n + 1)(2n + 1)
6
,
for n  0.
(2.38)
Just to make sure we haven't misread it, we check that this formula correctly
gives
5 = 5 ¬∑ 6 ¬∑ 11/6 = 55. Incidentally, page 36 of the CRC Tables has
further information about the sums of cubes, . . . , tenth powers.
The denitive reference for mathematical formulas is the Handbook of
Mathematical Functions, edited by Abramowitz and Stegun [2]. Pages 813{
(Harder sums
can be found
in Hansen's
comprehensive
table [178].)
814 of that book list the values of
n for n  100; and pages 804 and 809
exhibit formulas equivalent to (2.38), together with the analogous formulas
for sums of cubes, . . . , fteenth powers, with or without alternating signs.
But the best source for answers to questions about sequences is an amaz-
ing little book called the Handbook of Integer Sequences, by Sloane [330],
which lists thousands of sequences by their numerical values. If you come
up with a recurrence that you suspect has already been studied, all you have
to do is compute enough terms to distinguish your recurrence from other fa-
mous ones; then chances are you'll nd a pointer to the relevant literature in
Sloane's Handbook. For example, 1, 5, 14, 30, . . . turns out to be Sloane's
sequence number 1574, and it's called the sequence of \square pyramidal
numbers" (because there are
n balls in a pyramid that has a square base of
n2 balls). Sloane gives three references, one of which is to the handbook of
Abramowitz and Stegun that we've already mentioned.
Still another way to probe the world's store of accumulated mathematical
wisdom is to use a computer program (such as Axiom, MACSYMA, Maple, or
Mathematica) that provides tools for symbolic manipulation. Such programs
are indispensable, especially for people who need to deal with large formulas.
It's good to be familiar with standard sources of information, because
they can be extremely helpful. But Method 0 isn't really consistent with the
spirit of this book, because we want to know how to gure out the answers

2.5 GENERAL METHODS
43
by ourselves. The look-up method is limited to problems that other people
Or, at least to
problems having
the same answers
as problems that
other people have
decided to consider.
have decided are worth considering; a new problem won't be there.
Method 1: Guess the answer, prove it by induction.
Perhaps a little bird has told us the answer to a problem, or we have
arrived at a closed form by some other less-than-rigorous means. Then we
merely have to prove that it is correct.
We might, for example, have noticed that the values of
n have rather
small prime factors, so we may have come up with formula (2.38) as something
that works for all small values of n.
We might also have conjectured the
equivalent formula
n =
n(n + 1
2)(n + 1)
3
,
for n  0,
(2.39)
which is nicer because it's easier to remember. The preponderance of the
evidence supports (2.39), but we must prove our conjectures beyond all rea-
sonable doubt. Mathematical induction was invented for this purpose.
\Well, Your Honor, we know that
0 = 0 = 0(0+ 1
2)(0+1)/3, so the basis
is easy. For the induction, suppose that n > 0, and assume that (2.39) holds
when n is replaced by n ‚àí1. Since
n =
n‚àí1 + n2,
we have
3
n = (n ‚àí1)(n ‚àí1
2)(n) + 3n2
= (n3 ‚àí3
2n2 + 1
2n) + 3n2
= (n3 + 3
2n2 + 1
2n)
= n(n + 1
2)(n + 1) .
Therefore (2.39) indeed holds, beyond a reasonable doubt, for all n  0."
Judge Wapner, in his innite wisdom, agrees.
Induction has its place, and it is somewhat more defensible than trying
to look up the answer. But it's still not really what we're seeking. All of
the other sums we have evaluated so far in this chapter have been conquered
without induction; we should likewise be able to determine a sum like
n
from scratch. Flashes of inspiration should not be necessary. We should be
able to do sums even on our less creative days.
Method 2: Perturb the sum.
So let's go back to the perturbation method that worked so well for the
geometric progression (2.25). We extract the rst and last terms of
n+1 in

44
SUMS
order to get an equation for
n:
n + (n + 1)2 =
X
0kn
(k + 1)2 =
X
0kn
(k2 + 2k + 1)
=
X
0kn
k2 + 2
X
0kn
k +
X
0kn
1
=
n
+ 2
X
0kn
k + (n + 1) .
Oops | the
n's cancel each other. Occasionally, despite our best eorts, the
perturbation method produces something like
n =
n, so we lose.
Seems more like a
draw.
On the other hand, this derivation is not a total loss; it does reveal a way
to sum the rst n integers in closed form,
2
X
0kn
k = (n + 1)2 ‚àí(n + 1) ,
even though we'd hoped to discover the sum of rst integers squared. Could
it be that if we start with the sum of the integers cubed, which we might
call n, we will get an expression for the integers squared? Let's try it.
n + (n + 1)3 =
X
0kn
(k + 1)3 =
X
0kn
(k3 + 3k2 + 3k + 1)
= n + 3
n + 3(n+1)n
2
+ (n+1) .
Sure enough, the n's cancel, and we have enough information to determine
Method 2 ‚Ä≤:
Perturb your TA.
n without relying on induction:
3
n = (n + 1)3 ‚àí3(n + 1)n/2 ‚àí(n + 1)
= (n + 1)(n2 + 2n + 1 ‚àí3
2n ‚àí1) = (n + 1)(n + 1
2)n .
Method 3: Build a repertoire.
A slight generalization of the recurrence (2.7) will also suce for sum-
mands involving n2. The solution to
R0 = Œ± ;
Rn = Rn‚àí1 + Œ≤ + Œ≥n + Œ¥n2 ,
for n > 0,
(2.40)
will be of the general form
Rn = A(n)Œ± + B(n)Œ≤ + C(n)Œ≥ + D(n)Œ¥ ;
(2.41)
and we have already determined A(n), B(n), and C(n), because (2.40) is the
same as (2.7) when Œ¥ = 0. If we now plug in Rn = n3, we nd that n3 is the

2.5 GENERAL METHODS
45
solution when Œ± = 0, Œ≤ = 1, Œ≥ = ‚àí3, Œ¥ = 3. Hence
3D(n) ‚àí3C(n) + B(n) = n3 ;
this determines D(n).
We're interested in the sum
n, which equals
n‚àí1 + n2; thus we get
n = Rn if we set Œ± = Œ≤ = Œ≥ = 0 and Œ¥ = 1 in (2.41).
Consequently
n = D(n). We needn't do the algebra to compute D(n) from B(n) and
C(n), since we already know what the answer will be; but doubters among us
should be reassured to nd that
3D(n) = n3 + 3C(n) ‚àíB(n) = n3 + 3(n+1)n
2
‚àín = n(n+ 1
2)(n+1) .
Method 4: Replace sums by integrals.
People who have been raised on calculus instead of discrete mathematics
tend to be more familiar with
R
than with P, so they nd it natural to try
changing P to
R
. One of our goals in this book is to become so comfortable
with P that we'll think
R
is more dicult than P (at least for exact results).
But still, it's a good idea to explore the relation between P and
R
, since
summation and integration are based on very similar ideas.
In calculus, an integral can be regarded as the area under a curve, and we
can approximate this area by adding up the areas of long, skinny rectangles
that touch the curve. We can also go the other way if a collection of long,
skinny rectangles is given: Since
n is the sum of the areas of rectangles
whose sizes are 1 √ó 1, 1 √ó 4, . . . , 1 √ó n2, it is approximately equal to the area
under the curve f(x) = x2 between 0 and n.
The horizontal scale
here is ten times the
vertical scale.
6
-
f(x)
x
1 2 3
. . .
n
f(x) = x2
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
The area under this curve is
Rn
0 x2 dx = n3/3; therefore we know that
n is
approximately 1
3n3.

46
SUMS
One way to use this fact is to examine the error in the approximation,
En =
n ‚àí1
3n3. Since
n satises the recurrence
n =
n‚àí1 + n2, we nd
that En satises the simpler recurrence
En =
n ‚àí1
3n3 =
n‚àí1 + n2 ‚àí1
3n3 = En‚àí1 + 1
3(n‚àí1)3 + n2 ‚àí1
3n3
= En‚àí1 + n ‚àí1
3 .
Another way to pursue the integral approach is to nd a formula for En by
summing the areas of the wedge-shaped error terms. We have
This is for people
addicted to calculus.
n ‚àí
Z n
0
x2 dx =
n
X
k=1
¬µ
k2 ‚àí
Z k
k‚àí1
x2 dx
¬∂
=
n
X
k=1
¬µ
k2 ‚àík3 ‚àí(k ‚àí1)3
3
¬∂
=
n
X
k=1
¬°
k ‚àí1
3
¬¢
.
Either way, we could nd En and then
n.
Method 5: Expand and contract.
Yet another way to discover a closed form for
n is to replace the orig-
inal sum by a seemingly more complicated double sum that can actually be
simplied if we massage it properly:
n =
X
1kn
k2 =
X
1jkn
k
=
X
1jn
X
jkn
k
=
X
1jn
¬µj + n
2
¬∂
(n ‚àíj + 1)
=
1
2
X
1jn
¬°
n(n + 1) + j ‚àíj2¬¢
=
1
2n2(n + 1) + 1
4n(n + 1) ‚àí1
2
n =
1
2n(n + 1
2)(n + 1) ‚àí1
2
n .
Going from a single sum to a double sum may appear at rst to be a backward
(The last step here
is something like
the last step of
the perturbation
method, because
we get an equation
with the unknown
quantity on both
sides.)
step, but it's actually progress, because it produces sums that are easier to
work with. We can't expect to solve every problem by continually simplifying,
simplifying, and simplifying: You can't scale the highest mountain peaks by
climbing only uphill.
Method 6: Use Ô¨Ånite calculus.
Method 7: Use generating functions.
Stay tuned for still more exciting calculations of
n = Pn
k=0 k2, as we
learn further techniques in the next section and in later chapters.

2.6 FINITE AND INFINITE CALCULUS
47
2.6
FINITE AND INFINITE CALCULUS
We've learned a variety of ways to deal with sums directly. Now it's
time to acquire a broader perspective, by looking at the problem of summa-
tion from a higher level. Mathematicians have developed a \nite calculus,"
analogous to the more traditional innite calculus, by which it's possible to
approach summation in a nice, systematic fashion.
Innite calculus is based on the properties of the derivative operator D,
dened by
Df(x) = lim
h‚Üí0
f(x + h) ‚àíf(x)
h
.
Finite calculus is based on the properties of the dierence operator ‚àÜ, dened
by
‚àÜf(x) = f(x + 1) ‚àíf(x) .
(2.42)
This is the nite analog of the derivative in which we restrict ourselves to
positive integer values of h. Thus, h = 1 is the closest we can get to the
\limit" as h ‚Üí0, and ‚àÜf(x) is the value of
¬°
f(x + h) ‚àíf(x)
¬¢
/h when h = 1.
The symbols D and ‚àÜare called operators because they operate on
functions to give new functions; they are functions of functions that produce
functions. If f is a suitably smooth function of real numbers to real numbers,
then Df is also a function from reals to reals. And if f is any real-to-real
As opposed to a
cassette function.
function, so is ‚àÜf. The values of the functions Df and ‚àÜf at a point x are
given by the denitions above.
Early on in calculus we learn how D operates on the powers f(x) = xm.
In such cases Df(x) = mxm‚àí1. We can write this informally with f omitted,
D(xm) = mxm‚àí1 .
It would be nice if the ‚àÜoperator would produce an equally elegant result;
unfortunately it doesn't. We have, for example,
‚àÜ(x3) = (x + 1)3 ‚àíx3 = 3x2 + 3x + 1 .
But there is a type of \mth power" that does transform nicely under ‚àÜ,
Math power.
and this is what makes nite calculus interesting.
Such newfangled mth
powers are dened by the rule
xm =
m factors
z
}|
{
x(x ‚àí1) . . . (x ‚àím + 1) ,
integer m  0.
(2.43)
Notice the little straight line under the m; this implies that the m factors
are supposed to go down and down, stepwise. There's also a corresponding

48
SUMS
denition where the factors go up and up:
xm =
m factors
z
}|
{
x(x + 1) . . . (x + m ‚àí1) ,
integer m  0.
(2.44)
When m = 0, we have x0 = x0 = 1, because a product of no factors is
conventionally taken to be 1 (just as a sum of no terms is conventionally 0).
The quantity xm is called \x to the m falling," if we have to read it
aloud; similarly, xm is \x to the m rising." These functions are also called
falling factorial powers and rising factorial powers, since they are closely
related to the factorial function n! = n(n ‚àí1) . . . (1). In fact, n! = nn = 1n.
Several other notations for factorial powers appear in the mathematical
literature, notably \Pochhammer's symbol" (x)m for xm or xm; notations
Mathematical
terminology is
sometimes crazy:
Pochhammer [293]
actually used the
notation (x)m
for the binomial
coecient
ƒÖ x
m
ƒá
, not
for factorial powers.
like x(m) or x(m) are also seen for xm. But the underline/overline convention
is catching on, because it's easy to write, easy to remember, and free of
redundant parentheses.
Falling powers xm are especially nice with respect to ‚àÜ. We have
‚àÜ(xm) = (x + 1)m ‚àíxm
= (x + 1)x . . . (x ‚àím + 2) ‚àíx . . . (x ‚àím + 2)(x ‚àím + 1)
= m x(x ‚àí1) . . . (x ‚àím + 2) ,
hence the nite calculus has a handy law to match D(xm) = mxm‚àí1:
‚àÜ(xm) = mxm‚àí1 .
(2.45)
This is the basic factorial fact.
The operator D of innite calculus has an inverse, the anti-derivative
(or integration) operator
R
. The Fundamental Theorem of Calculus relates D
to
R
:
g(x) = Df(x)
if and only if
Z
g(x) dx = f(x) + C .
Here
R
g(x) dx, the indenite integral of g(x), is the class of functions whose
derivative is g(x). Analogously, ‚àÜhas as an inverse, the anti-dierence (or
\Quemadmodum
ad dierentiam
denotandam usi
sumus signo ‚àÜ,
ita summam indi-
cabimus signo Œ£.
. . . ex quo quatio
z = ‚àÜy, si inver-
tatur, dabit quoque
y = Œ£z + C."
|L. Euler [110]
summation) operator P; and there's another Fundamental Theorem:
g(x) = ‚àÜf(x)
if and only if
X
g(x) Œ¥x = f(x) + C .
(2.46)
Here P g(x) Œ¥x, the indenite sum of g(x), is the class of functions whose
dierence is g(x). (Notice that the lowercase Œ¥ relates to uppercase ‚àÜas
d relates to D.) The \C" for indenite integrals is an arbitrary constant; the
\C" for indenite sums is any function p(x) such that p(x + 1) = p(x). For

2.6 FINITE AND INFINITE CALCULUS
49
example, C might be the periodic function a + b sin 2œÄx; such functions get
washed out when we take dierences, just as constants get washed out when
we take derivatives. At integer values of x, the function C is constant.
Now we're almost ready for the punch line. Innite calculus also has
denite integrals: If g(x) = Df(x), then
Z b
a
g(x) dx = f(x)
¬Ø¬Ø¬Ø
b
a = f(b) ‚àíf(a) .
Therefore nite calculus | ever mimicking its more famous cousin | has def-
inite sums: If g(x) = ‚àÜf(x), then
Xb
a g(x) Œ¥x = f(x)
¬Ø¬Ø¬Ø
b
a = f(b) ‚àíf(a) .
(2.47)
This formula gives a meaning to the notation Pb
a g(x) Œ¥x, just as the previous
formula denes
Rb
a g(x) dx.
But what does Pb
a g(x) Œ¥x really mean, intuitively? We've dened it by
analogy, not by necessity. We want the analogy to hold, so that we can easily
remember the rules of nite calculus; but the notation will be useless if we
don't understand its signicance. Let's try to deduce its meaning by looking
rst at some special cases, assuming that g(x) = ‚àÜf(x) = f(x + 1) ‚àíf(x). If
b = a, we have
Xa
a g(x) Œ¥x = f(a) ‚àíf(a) = 0 .
Next, if b = a + 1, the result is
Xa+1
a
g(x) Œ¥x = f(a + 1) ‚àíf(a) = g(a) .
More generally, if b increases by 1, we have
Xb+1
a
g(x) Œ¥x ‚àí
Xb
a g(x) Œ¥x =
¬°
f(b + 1) ‚àíf(a)
¬¢
‚àí
¬°
f(b) ‚àíf(a)
¬¢
= f(b + 1) ‚àíf(b) = g(b) .
These observations, and mathematical induction, allow us to deduce exactly
what Pb
a g(x) Œ¥x means in general, when a and b are integers with b  a:
Xb
a g(x) Œ¥x =
b‚àí1
X
k=a
g(k) =
X
ak<b
g(k) ,
for integers b  a.
(2.48)
In other words, the denite sum is the same as an ordinary sum with limits,
You call this a
punch line?
but excluding the value at the upper limit.

50
SUMS
Let's try to recap this in a slightly dierent way. Suppose we've been
given an unknown sum that's supposed to be evaluated in closed form, and
suppose we can write it in the form P
ak<b g(k) = Pb
a g(x) Œ¥x. The theory
of nite calculus tells us that we can express the answer as f(b) ‚àíf(a), if
we can only nd an indenite sum or anti-dierence function f such that
g(x) = f(x + 1) ‚àíf(x).
One way to understand this principle is to write
P
ak<b g(k) out in full, using the three-dots notation:
X
ak<b
¬°
f(k + 1) ‚àíf(k)
¬¢
=
¬°
f(a+1) ‚àíf(a)
¬¢
+
¬°
f(a+2) ‚àíf(a+1)
¬¢
+ ¬∑ ¬∑ ¬∑
+
¬°
f(b‚àí1) ‚àíf(b‚àí2)
¬¢
+
¬°
f(b) ‚àíf(b‚àí1)
¬¢
.
Everything on the right-hand side cancels, except f(b) ‚àíf(a); so f(b) ‚àíf(a)
is the value of the sum. (Sums of the form P
ak<b
¬°
f(k + 1) ‚àíf(k)
¬¢
are
often called telescoping, by analogy with a collapsed telescope, because the
thickness of a collapsed telescope is determined solely by the outer radius of
And all this time
I thought it was
telescoping because
it collapsed from a
very long expression
to a very short one.
the outermost tube and the inner radius of the innermost tube.)
But rule (2.48) applies only when b  a; what happens if b < a? Well,
(2.47) says that we must have
Xb
a g(x) Œ¥x = f(b) ‚àíf(a)
= ‚àí
¬°
f(a) ‚àíf(b)
¬¢
= ‚àí
Xa
b g(x) Œ¥x .
This is analogous to the corresponding equation for denite integration. A
similar argument proves Pb
a + Pc
b = Pc
a, the summation analog of the iden-
tity
Rb
a +
Rc
b =
Rc
a. In full garb,
Xb
a g(x) Œ¥x +
Xc
b g(x) Œ¥x =
Xc
a g(x) Œ¥x ,
(2.49)
for all integers a, b, and c.
At this point a few of us are probably starting to wonder what all these
parallels and analogies buy us. Well for one, denite summation gives us a
Others have been
wondering this for
some time now.
simple way to compute sums of falling powers: The basic laws (2.45), (2.47),
and (2.48) imply the general law
X
0k<n
km = km+1
m + 1
¬Ø¬Ø¬Ø¬Ø
n
0
= nm+1
m + 1 ,
for integers m, n  0.
(2.50)
This formula is easy to remember because it's so much like the familiar
Rn
0 xm dx = nm+1/(m + 1).

2.6 FINITE AND INFINITE CALCULUS
51
In particular, when m = 1 we have k1 = k, so the principles of nite
calculus give us an easy way to remember the fact that
X
0k<n
k = n2
2
= n(n ‚àí1)/2 .
The denite-sum method also gives us an inkling that sums over the range
0  k < n often turn out to be simpler than sums over 1  k  n; the former
are just f(n) ‚àíf(0), while the latter must be evaluated as f(n + 1) ‚àíf(1).
Ordinary powers can also be summed in this new way, if we rst express
them in terms of falling powers. For example,
k2 = k2 + k1 ,
hence
X
0k<n
k2 = n3
3 + n2
2
=
1
3n(n ‚àí1)(n ‚àí2 + 3
2) =
1
3n(n ‚àí1
2)(n ‚àí1) .
Replacing n by n + 1 gives us yet another way to compute the value of our
old friend
n = P
0kn k2 in closed form.
With friends like
this . . .
Gee, that was pretty easy. In fact, it was easier than any of the umpteen
other ways that beat this formula to death in the previous section. So let's
try to go up a notch, from squares to cubes: A simple calculation shows that
k3 = k3 + 3k2 + k1 .
(It's always possible to convert between ordinary powers and factorial powers
by using Stirling numbers, which we will study in Chapter 6.) Thus
X
ak<b
k3 = k4
4 + k3 + k2
2
¬Ø¬Ø¬Ø¬Ø
b
a
.
Falling powers are therefore very nice for sums. But do they have any
other redeeming features? Must we convert our old friendly ordinary powers
to falling powers before summing, but then convert back before we can do
anything else? Well, no, it's often possible to work directly with factorial
powers, because they have additional properties.
For example, just as we
have (x + y)2 = x2 + 2xy + y2, it turns out that (x + y)2 = x2 + 2x1y1 + y2,
and the same analogy holds between (x + y)m and (x + y)m. (This \factorial
binomial theorem" is proved in exercise 5.37.)
So far we've considered only falling powers that have nonnegative expo-
nents. To extend the analogies with ordinary powers to negative exponents,

52
SUMS
we need an appropriate denition of xm for m < 0. Looking at the sequence
x3 = x(x ‚àí1)(x ‚àí2) ,
x2 = x(x ‚àí1) ,
x1 = x ,
x0 = 1 ,
we notice that to get from x3 to x2 to x1 to x0 we divide by x ‚àí2, then
by x ‚àí1, then by x. It seems reasonable (if not imperative) that we should
divide by x + 1 next, to get from x0 to x‚àí1, thereby making x‚àí1 = 1/(x + 1).
Continuing, the rst few negative-exponent falling powers are
x‚àí1 =
1
x + 1 ,
x‚àí2 =
1
(x + 1)(x + 2) ,
x‚àí3 =
1
(x + 1)(x + 2)(x + 3) ,
and our general denition for negative falling powers is
x‚àím =
1
(x + 1)(x + 2) . . . (x + m) ,
for m > 0.
(2.51)
(It's also possible to dene falling powers for real or even complex m, but we
How can a complex
number be even?
will defer that until Chapter 5.)
With this denition, falling powers have additional nice properties. Per-
haps the most important is a general law of exponents, analogous to the law
xm+n = xmxn
for ordinary powers. The falling-power version is
xm+n = xm (x ‚àím)n ,
integers m and n.
(2.52)
For example, x2+3 = x2 (x ‚àí2)3; and with a negative n we have
x2‚àí3 = x2 (x ‚àí2)‚àí3 = x(x ‚àí1)
1
(x ‚àí1)x(x + 1) =
1
x + 1 = x‚àí1 .
If we had chosen to dene x‚àí1 as 1/x instead of as 1/(x + 1), the law of
exponents (2.52) would have failed in cases like m = ‚àí1 and n = 1. In fact,
we could have used (2.52) to tell us exactly how falling powers ought to be
dened in the case of negative exponents, by setting m = ‚àín.
When an
Laws have their
exponents and their
detractors.
existing notation is being extended to cover more cases, it's always best to
formulate denitions in such a way that general laws continue to hold.

2.6 FINITE AND INFINITE CALCULUS
53
Now let's make sure that the crucial dierence property holds for our
newly dened falling powers. Does ‚àÜxm = mxm‚àí1 when m < 0? If m = ‚àí2,
for example, the dierence is
‚àÜx‚àí2 =
1
(x + 2)(x + 3) ‚àí
1
(x + 1)(x + 2)
=
(x + 1) ‚àí(x + 3)
(x + 1)(x + 2)(x + 3)
= ‚àí2x‚àí3 .
Yes | it works! A similar argument applies for all m < 0.
Therefore the summation property (2.50) holds for negative falling powers
as well as positive ones, as long as no division by zero occurs:
Xb
a xm Œ¥x = xm+1
m + 1
¬Ø¬Ø¬Ø¬Ø
b
a
,
for m Ã∏= ‚àí1.
But what about when m = ‚àí1? Recall that for integration we use
Z b
a
x‚àí1 dx = ln x
¬Ø¬Ø¬Ø
b
a
when m = ‚àí1. We'd like to have a nite analog of ln x; in other words, we
seek a function f(x) such that
x‚àí1 =
1
x + 1 = ‚àÜf(x) = f(x + 1) ‚àíf(x) .
It's not too hard to see that
f(x) = 1
1 + 1
2 + ¬∑ ¬∑ ¬∑ + 1
x
is such a function, when x is an integer, and this quantity is just the harmonic
number Hx of (2.13). Thus Hx is the discrete analog of the continuous ln x.
(We will dene Hx for noninteger x in Chapter 6, but integer values are good
enough for present purposes. We'll also see in Chapter 9 that, for large x, the
value of Hx ‚àíln x is approximately 0.577 + 1/(2x). Hence Hx and ln x are not
0.577 exactly?
Maybe they mean
1/
‚àö
3.
Then again,
maybe not.
only analogous, their values usually dier by less than 1.)
We can now give a complete description of the sums of falling powers:
Xb
a xm Œ¥x =
Ô£±
Ô£¥
Ô£¥
Ô£≤
Ô£¥
Ô£¥
Ô£≥
xm+1
m + 1
¬Ø¬Ø¬Ø¬Ø
b
a
,
if m Ã∏= ‚àí1;
Hx
¬Ø¬Ø¬Ø
b
a ,
if m = ‚àí1.
(2.53)

54
SUMS
This formula indicates why harmonic numbers tend to pop up in the solutions
to discrete problems like the analysis of quicksort, just as so-called natural
logarithms arise naturally in the solutions to continuous problems.
Now that we've found an analog for ln x, let's see if there's one for ex.
What function f(x) has the property that ‚àÜf(x) = f(x), corresponding to the
identity Dex = ex? Easy:
f(x + 1) ‚àíf(x) = f(x)
‚áê‚áí
f(x + 1) = 2f(x) ;
so we're dealing with a simple recurrence, and we can take f(x) = 2x as the
discrete exponential function.
The dierence of cx is also quite simple, for arbitrary c, namely
‚àÜ(cx) = cx+1 ‚àícx = (c ‚àí1)cx .
Hence the anti-dierence of cx is cx/(c ‚àí1), if c Ã∏= 1. This fact, together with
the fundamental laws (2.47) and (2.48), gives us a tidy way to understand the
general formula for the sum of a geometric progression:
X
ak<b
ck =
Xb
a cx Œ¥x =
cx
c ‚àí1
¬Ø¬Ø¬Ø¬Ø
b
a
= cb ‚àíca
c ‚àí1
,
for c Ã∏= 1.
Every time we encounter a function f that might be useful as a closed
form, we can compute its dierence ‚àÜf = g; then we have a function g whose
indenite sum P g(x) Œ¥x is known. Table 55 is the beginning of a table of
`Table 55' is on
page 55. Get it?
dierence/anti-dierence pairs useful for summation.
Despite all the parallels between continuous and discrete math, some
continuous notions have no discrete analog. For example, the chain rule of
innite calculus is a handy rule for the derivative of a function of a function;
but there's no corresponding chain rule of nite calculus, because there's no
nice form for ‚àÜf
¬°
g(x)
¬¢
. Discrete change-of-variables is hard, except in certain
cases like the replacement of x by c ¬± x.
However, ‚àÜ
¬°
f(x) g(x)
¬¢
does have a fairly nice form, and it provides us
with a rule for summation by parts, the nite analog of what innite calculus
calls integration by parts. Let's recall that the formula
D(uv) = u Dv + v Du
of innite calculus leads to the rule for integration by parts,
Z
u Dv = uv ‚àí
Z
v Du ,

2.6 FINITE AND INFINITE CALCULUS
55
Table 55 What's the dierence?
f = Œ£g
‚àÜf = g
f = Œ£g
‚àÜf = g
x0 = 1
0
2x
2x
x1 = x
1
cx
(c ‚àí1)cx
x2 = x(x ‚àí1)
2x
cx/(c ‚àí1)
cx
xm
mxm‚àí1
cf
c‚àÜf
xm+1/(m + 1)
xm
f + g
‚àÜf + ‚àÜg
Hx
x‚àí1 = 1/(x + 1)
fg
f‚àÜg + Eg‚àÜf
after integration and rearranging terms; we can do a similar thing in nite
calculus.
We start by applying the dierence operator to the product of two func-
tions u(x) and v(x):
‚àÜ
¬°
u(x) v(x)
¬¢
= u(x+1) v(x+1) ‚àíu(x) v(x)
= u(x+1) v(x+1) ‚àíu(x) v(x+1)
+ u(x) v(x+1) ‚àíu(x) v(x)
= u(x) ‚àÜv(x) + v(x+1) ‚àÜu(x) .
(2.54)
This formula can be put into a convenient form using the shift operator E,
dened by
Ef(x) = f(x + 1) .
Substituting Ev(x) for v(x+1) yields a compact rule for the dierence of a
product:
‚àÜ(uv) = u ‚àÜv + Ev ‚àÜu .
(2.55)
(The E is a bit of a nuisance, but it makes the equation correct.) Taking
Innite calculus
avoids E here by
letting 1 ‚Üí0.
the indenite sum on both sides of this equation, and rearranging its terms,
yields the advertised rule for summation by parts:
X
u ‚àÜv = uv ‚àí
X
Ev ‚àÜu .
(2.56)
As with innite calculus, limits can be placed on all three terms, making the
indenite sums denite.
This rule is useful when the sum on the left is harder to evaluate than the
one on the right. Let's look at an example. The function
R
xex dx is typically
integrated by parts; its discrete analog is P x2x Œ¥x, which we encountered
I guess ex = 2x ,
for small values
of 1.
earlier this chapter in the form Pn
k=0 k 2k.
To sum this by parts, we let

56
SUMS
u(x) = x and ‚àÜv(x) = 2x; hence ‚àÜu(x) = 1, v(x) = 2x, and Ev(x) = 2x+1.
Plugging into (2.56) gives
X
x2x Œ¥x = x2x ‚àí
X
2x+1 Œ¥x = x2x ‚àí2x+1 + C .
And we can use this to evaluate the sum we did before, by attaching limits:
n
X
k=0
k2k =
Xn+1
0
x2x Œ¥x
= x2x ‚àí2x+1 ¬Ø¬Ø¬Ø
n+1
0
=
¬°
(n + 1)2n+1 ‚àí2n+2¬¢
‚àí(0¬∑20 ‚àí21) = (n ‚àí1)2n+1 + 2 .
It's easier to nd the sum this way than to use the perturbation method,
because we don't have to think.
The ultimate goal
of mathematics
is to eliminate all
need for intelligent
thought.
We stumbled across a formula for P
0k<n Hk earlier in this chapter,
and counted ourselves lucky. But we could have found our formula (2.36)
systematically, if we had known about summation by parts. Let's demonstrate
this assertion by tackling a sum that looks even harder, P
0k<n kHk. The
solution is not dicult if we are guided by analogy with
R
x ln x dx: We take
u(x) = Hx and ‚àÜv(x) = x = x1, hence ‚àÜu(x) = x‚àí1, v(x) = x2/2, Ev(x) =
(x + 1)2/2, and we have
X
xHx Œ¥x = x2
2 Hx ‚àí
X (x + 1)2
2
x‚àí1 Œ¥x
= x2
2 Hx ‚àí1
2
X
x1 Œ¥x
= x2
2 Hx ‚àíx2
4 + C .
(In going from the rst line to the second, we've combined two falling pow-
ers (x+1)2 x‚àí1 by using the law of exponents (2.52) with m = ‚àí1 and n = 2.)
Now we can attach limits and conclude that
X
0k<n
kHk =
Xn
0 xHx Œ¥x = n2
2
¬≥
Hn ‚àí1
2
¬¥
.
(2.57)
2.7
INFINITE SUMS
When we dened P-notation at the beginning of this chapter, we
nessed the question of innite sums by saying, in essence, \Wait until later.
This is nesse?
For now, we can assume that all the sums we meet have only nitely many
nonzero terms." But the time of reckoning has nally arrived; we must face

2.7 INFINITE SUMS
57
the fact that sums can be innite. And the truth is that innite sums are
bearers of both good news and bad news.
First, the bad news: It turns out that the methods we've used for manip-
ulating P's are not always valid when innite sums are involved. But next,
the good news: There is a large, easily understood class of innite sums for
which all the operations we've been performing are perfectly legitimate. The
reasons underlying both these news items will be clear after we have looked
more closely at the underlying meaning of summation.
Everybody knows what a nite sum is: We add up a bunch of terms, one
by one, until they've all been added. But an innite sum needs to be dened
more carefully, lest we get into paradoxical situations.
For example, it seems natural to dene things so that the innite sum
S = 1 + 1
2 + 1
4 + 1
8 +
1
16 +
1
32 + ¬∑ ¬∑ ¬∑
is equal to 2, because if we double it we get
2S = 2 + 1 + 1
2 + 1
4 + 1
8 +
1
16 + ¬∑ ¬∑ ¬∑ = 2 + S .
On the other hand, this same reasoning suggests that we ought to dene
T = 1 + 2 + 4 + 8 + 16 + 32 + ¬∑ ¬∑ ¬∑
to be ‚àí1, for if we double it we get
Sure: 1 + 2 +
4 + 8 + ¬∑ ¬∑ ¬∑ is the
\innite precision"
representation of
the number ‚àí1,
in a binary com-
puter with innite
word size.
2T = 2 + 4 + 8 + 16 + 32 + 64 + ¬∑ ¬∑ ¬∑ = T ‚àí1.
Something funny is going on; how can we get a negative number by summing
positive quantities? It seems better to leave T undened; or perhaps we should
say that T = ‚àû, since the terms being added in T become larger than any
xed, nite number. (Notice that ‚àûis another \solution" to the equation
2T = T ‚àí1; it also \solves" the equation 2S = 2 + S.)
Let's try to formulate a good denition for the value of a general sum
P
k‚ààK ak, where K might be innite. For starters, let's assume that all the
terms ak are nonnegative. Then a suitable denition is not hard to nd: If
there's a bounding constant A such that
X
k‚ààF
ak  A
for all nite subsets F ‚äÇK, then we dene P
k‚ààK ak to be the least such A.
(It follows from well-known properties of the real numbers that the set of
all such A always contains a smallest element.) But if there's no bounding
constant A, we say that P
k‚ààK ak = ‚àû; this means that if A is any real
number, there's a set of nitely many terms ak whose sum exceeds A.

58
SUMS
The denition in the previous paragraph has been formulated carefully
so that it doesn't depend on any order that might exist in the index set K.
Therefore the arguments we are about to make will apply to multiple sums
with many indices k1, k2, . . . , not just to sums over the set of integers.
The set K might
even be uncount-
able. But only a
countable num-
ber of terms can
be nonzero, if a
bounding constant
A exists, because at
most nA terms are
 1/n.
In the special case that K is the set of nonnegative integers, our denition
for nonnegative terms ak implies that
X
k0
ak =
lim
n‚Üí‚àû
n
X
k=0
ak .
Here's why: Any nondecreasing sequence of real numbers has a limit (possi-
bly ‚àû). If the limit is A, and if F is any nite set of nonnegative integers
whose elements are all  n, we have P
k‚ààF ak  Pn
k=0 ak  A; hence A = ‚àû
or A is a bounding constant. And if A‚Ä≤ is any number less than the stated
limit A, then there's an n such that Pn
k=0 ak > A‚Ä≤; hence the nite set
F = f0, 1, . . . , ng witnesses to the fact that A‚Ä≤ is not a bounding constant.
We can now easily compute the value of certain innite sums, according
to the denition just given. For example, if ak = xk, we have
X
k0
xk =
lim
n‚Üí‚àû
1 ‚àíxn+1
1 ‚àíx
=
¬Ø
1/(1 ‚àíx),
if 0  x < 1;
‚àû,
if x  1.
In particular, the innite sums S and T considered a minute ago have the re-
spective values 2 and ‚àû, just as we suspected. Another interesting example is
X
k0
1
(k + 1)(k + 2) =
X
k0
k‚àí2
=
lim
n‚Üí‚àû
n
X
k=0
k‚àí2 =
lim
n‚Üí‚àû
k‚àí1
‚àí1
¬Ø¬Ø¬Ø¬Ø
n
0
= 1 .
Now let's consider the case that the sum might have negative terms as
well as nonnegative ones. What, for example, should be the value of
X
k0
(‚àí1)k = 1 ‚àí1 + 1 ‚àí1 + 1 ‚àí1 + ¬∑ ¬∑ ¬∑ ?
If we group the terms in pairs, we get
\Aggregatum quan-
titatum a ‚àía +
a ‚àía + a ‚àía
etc. nunc est = a,
nunc = 0, adeoque
continuata in inni-
tum serie ponendus
= a/2, fateor
acumen et veritatem
animadversionis
tu."
|G. Grandi [163]
(1 ‚àí1) + (1 ‚àí1) + (1 ‚àí1) + ¬∑ ¬∑ ¬∑ = 0 + 0 + 0 + ¬∑ ¬∑ ¬∑ ,
so the sum comes out zero; but if we start the pairing one step later, we get
1 ‚àí(1 ‚àí1) ‚àí(1 ‚àí1) ‚àí(1 ‚àí1) ‚àí¬∑ ¬∑ ¬∑ = 1 ‚àí0 ‚àí0 ‚àí0 ‚àí¬∑ ¬∑ ¬∑ ;
the sum is 1.

2.7 INFINITE SUMS
59
We might also try setting x = ‚àí1 in the formula P
k0 xk = 1/(1 ‚àíx),
since we've proved that this formula holds when 0  x < 1; but then we are
forced to conclude that the innite sum is 1
2, although it's a sum of integers!
Another interesting example is the doubly innite P
k ak where ak =
1/(k + 1) for k  0 and ak = 1/(k ‚àí1) for k < 0. We can write this as
¬∑ ¬∑ ¬∑ + (‚àí1
4) + (‚àí1
3) + (‚àí1
2) + 1 + 1
2 + 1
3 + 1
4 + ¬∑ ¬∑ ¬∑ .
(2.58)
If we evaluate this sum by starting at the \center" element and working
outward,
¬∑ ¬∑ ¬∑ +
¬≥
‚àí1
4 +
¬°
‚àí1
3 + (‚àí1
2 + (1) + 1
2) + 1
3
¬¢
+ 1
4
¬¥
+ ¬∑ ¬∑ ¬∑ ,
we get the value 1; and we obtain the same value 1 if we shift all the paren-
theses one step to the left,
¬∑ ¬∑ ¬∑ +
¬≥
‚àí1
5 +
¬°
‚àí1
4 + (‚àí1
3 + (‚àí1
2) + 1) + 1
2
¬¢
+ 1
3
¬¥
+ ¬∑ ¬∑ ¬∑ ,
because the sum of all numbers inside the innermost n parentheses is
‚àí
1
n + 1 ‚àí1
n ‚àí¬∑ ¬∑ ¬∑ ‚àí1
2 + 1 + 1
2 + ¬∑ ¬∑ ¬∑ +
1
n ‚àí1 = 1 ‚àí1
n ‚àí
1
n + 1 .
A similar argument shows that the value is 1 if these parentheses are shifted
any xed amount to the left or right; this encourages us to believe that the
sum is indeed 1. On the other hand, if we group terms in the following way,
¬∑ ¬∑ ¬∑ +
¬≥
‚àí1
4 +
¬°
‚àí1
3 + (‚àí1
2 + 1 + 1
2) + 1
3 + 1
4
¬¢
+ 1
5 + 1
6
¬¥
+ ¬∑ ¬∑ ¬∑ ,
the nth pair of parentheses from inside out contains the numbers
‚àí
1
n+1 ‚àí1
n ‚àí¬∑ ¬∑ ¬∑ ‚àí1
2 + 1 + 1
2 + ¬∑ ¬∑ ¬∑ +
1
2n‚àí1 + 1
2n = 1 + H2n ‚àíHn+1 .
We'll prove in Chapter 9 that limn‚Üí‚àû(H2n ‚àíHn+1) = ln 2; hence this group-
ing suggests that the doubly innite sum should really be equal to 1 + ln 2.
There's something aky about a sum that gives dierent values when
its terms are added up in dierent ways. Advanced texts on analysis have
a variety of denitions by which meaningful values can be assigned to such
pathological sums; but if we adopt those denitions, we cannot operate with
P-notation as freely as we have been doing. We don't need the delicate rene-
ments of \conditional convergence" for the purposes of this book; therefore
we'll stick to a denition of innite sums that preserves the validity of all the
Is this the rst page
with no grati?
operations we've been doing in this chapter.

60
SUMS
In fact, our denition of innite sums is quite simple.
Let K be any
set, and let ak be a real-valued term dened for each k ‚ààK.
(Here `k'
might actually stand for several indices k1, k2, . . . , and K might therefore be
multidimensional.) Any real number x can be written as the dierence of its
positive and negative parts,
x = x+ ‚àíx‚àí,
where x+ = x¬∑[x > 0] and x‚àí= ‚àíx¬∑[x < 0].
(Either x+ = 0 or x‚àí= 0.) We've already explained how to dene values for
the innite sums P
k‚ààK a+
k and P
k‚ààK a‚àí
k , because a+
k and a‚àí
k are nonnega-
tive. Therefore our general denition is
X
k‚ààK
ak =
X
k‚ààK
a+
k
‚àí
X
k‚ààK
a‚àí
k ,
(2.59)
unless the right-hand sums are both equal to ‚àû. In the latter case, we leave
P
k‚ààK ak undened.
Let A+ = P
k‚ààK a+
k and A‚àí= P
k‚ààK a‚àí
k . If A+ and A‚àíare both nite,
the sum P
k‚ààK ak is said to converge absolutely to the value A = A+ ‚àíA‚àí.
In other words, ab-
solute convergence
means that the sum
of absolute values
converges.
If A+ = ‚àûbut A‚àíis nite, the sum P
k‚ààK ak is said to diverge to +‚àû.
Similarly, if A‚àí= ‚àûbut A+ is nite, P
k‚ààK ak is said to diverge to ‚àí‚àû. If
A+ = A‚àí= ‚àû, all bets are o.
We started with a denition that worked for nonnegative terms, then we
extended it to real-valued terms. If the terms ak are complex numbers, we
can extend the denition once again, in the obvious way: The sum P
k‚ààK ak
is dened to be P
k‚ààK <ak + i P
k‚ààK =ak, where <ak and =ak are the real
and imaginary parts of ak | provided that both of those sums are dened.
Otherwise P
k‚ààK ak is undened. (See exercise 18.)
The bad news, as stated earlier, is that some innite sums must be left
undened, because the manipulations we've been doing can produce inconsis-
tencies in all such cases. (See exercise 34.) The good news is that all of the
manipulations of this chapter are perfectly valid whenever we're dealing with
sums that converge absolutely, as just dened.
We can verify the good news by showing that each of our transformation
rules preserves the value of all absolutely convergent sums. This means, more
explicitly, that we must prove the distributive, associative, and commutative
laws, plus the rule for summing rst on one index variable; everything else
we've done has been derived from those four basic operations on sums.
The distributive law (2.15) can be formulated more precisely as follows:
If P
k‚ààK ak converges absolutely to A and if c is any complex number, then
P
k‚ààK cak converges absolutely to cA. We can prove this by breaking the
sum into real and imaginary, positive and negative parts as above, and by
proving the special case in which c > 0 and each term ak is nonnegative. The

2.7 INFINITE SUMS
61
proof in this special case works because P
k‚ààF cak = c P
k‚ààF ak for all nite
sets F; the latter fact follows by induction on the size of F.
The associative law (2.16) can be stated as follows: If P
k‚ààK ak and
P
k‚ààK bk converge absolutely to A and B, respectively, then P
k‚ààK(ak + bk)
converges absolutely to A + B. This turns out to be a special case of a more
general theorem that we will prove shortly.
The commutative law (2.17) doesn't really need to be proved, because
we have shown in the discussion following (2.35) how to derive it as a special
case of a general rule for interchanging the order of summation.
The main result we need to prove is the fundamental principle of multiple
sums: Absolutely convergent sums over two or more indices can always be
summed rst with respect to any one of those indices. Formally, we shall
prove that if J and the elements of fKj | j ‚ààJg are any sets of indices such that
Best to skim this
page the rst time
you get here.
|Your friendly TA
X
j‚ààJ
k‚ààKj
aj,k
converges absolutely to A ,
then there exist complex numbers Aj for each j ‚ààJ such that
X
k‚ààKj
aj,k
converges absolutely to Aj,
and
X
j‚ààJ
Aj
converges absolutely to A .
It suces to prove this assertion when all terms are nonnegative, because we
can prove the general case by breaking everything into real and imaginary,
positive and negative parts as before. Let's assume therefore that aj,k  0
for all pairs (j, k) ‚ààM, where M is the master index set f(j, k) | j ‚ààJ, k ‚ààKjg.
We are given that P
(j,k)‚ààM aj,k is nite, namely that
X
(j,k)‚ààF
aj,k  A
for all nite subsets F ‚äÜM, and that A is the least such upper bound. If j is
any element of J, each sum of the form P
k‚ààFj aj,k where Fj is a nite subset
of Kj is bounded above by A. Hence these nite sums have a least upper
bound Aj  0, and P
k‚ààKj aj,k = Aj by denition.
We still need to prove that A is the least upper bound of P
j‚ààG Aj, for all
nite subsets G ‚äÜJ. Suppose that G is a nite subset of J with P
j‚ààG Aj =
A‚Ä≤ > A. We can nd nite subsets Fj ‚äÜKj such that P
k‚ààFj aj,k > (A/A‚Ä≤)Aj
for each j ‚ààG with Aj > 0.
There is at least one such j.
But then
P
j‚ààG,k‚ààFj aj,k > (A/A‚Ä≤) P
j‚ààG Aj = A, contradicting the fact that we have

62
SUMS
P
(j,k)‚ààF aj,k  A for all nite subsets F ‚äÜM. Hence P
j‚ààG Aj  A, for all
nite subsets G ‚äÜJ.
Finally, let A‚Ä≤ be any real number less than A. Our proof will be complete
if we can nd a nite set G ‚äÜJ such that P
j‚ààG Aj > A‚Ä≤. We know that there's
a nite set F ‚äÜM such that P
(j,k)‚ààF aj,k > A‚Ä≤; let G be the set of j's in
this F, and let Fj = fk | (j, k) ‚ààFg. Then P
j‚ààG Aj  P
j‚ààG
P
k‚ààFj aj,k =
P
(j,k)‚ààF aj,k > A‚Ä≤; QED.
OK, we're now legitimate!
Everything we've been doing with innite
sums is justied, as long as there's a nite bound on all nite sums of the
absolute values of the terms. Since the doubly innite sum (2.58) gave us
two dierent answers when we evaluated it in two dierent ways, its positive
terms 1 + 1
2 + 1
3 + ¬∑ ¬∑ ¬∑ must diverge to ‚àû; otherwise we would have gotten the
So why have I been
hearing a lot lately
about \harmonic
convergence"?
same answer no matter how we grouped the terms.
Exercises
Warmups
1
What does the notation
0
X
k=4
qk
mean?
2
Simplify the expression x ¬∑
¬°
[x > 0] ‚àí[x < 0]
¬¢
.
3
Demonstrate your understanding of P-notation by writing out the sums
X
0k5
ak
and
X
0k25
ak2
in full. (Watch out | the second sum is a bit tricky.)
4
Express the triple sum
X
1i<j<k4
aijk
as a three-fold summation (with three P's),
a
summing rst on k, then j, then i;
b
summing rst on i, then j, then k.
Also write your triple sums out in full without the P-notation, using
parentheses to show what is being added together rst.

2 EXERCISES
63
5
What's wrong with the following derivation?
¬µ n
X
j=1
aj
¬∂¬µ n
X
k=1
1
ak
¬∂
=
n
X
j=1
n
X
k=1
aj
ak
=
n
X
k=1
n
X
k=1
ak
ak
=
n
X
k=1
n = n2 .
6
What is the value of P
k[1  j  k  n], as a function of j and n?
7
Let ‚àáf(x) = f(x) ‚àíf(x‚àí1). What is ‚àá(xm)?
Yield to the rising
power.
8
What is the value of 0m, when m is a given integer?
9
What is the law of exponents for rising factorial powers, analogous to
(2.52)? Use this to dene x‚àín.
10
The text derives the following formula for the dierence of a product:
‚àÜ(uv) = u ‚àÜv + Ev ‚àÜu .
How can this formula be correct, when the left-hand side is symmetric
with respect to u and v but the right-hand side is not?
Basics
11
The general rule (2.56) for summation by parts is equivalent to
X
0k<n
(ak+1 ‚àíak)bk = anbn ‚àía0b0
‚àí
X
0k<n
ak+1(bk+1 ‚àíbk),
for n  0.
Prove this formula directly by using the distributive, associative, and
commutative laws.
12
Show that the function p(k) = k + (‚àí1)kc is a permutation of the set of
all integers, whenever c is an integer.
13
Use the repertoire method to nd a closed form for Pn
k=0(‚àí1)kk2.
14
Evaluate Pn
k=1 k2k by rewriting it as the multiple sum P
1jkn 2k.
15
Evaluate n = Pn
k=1 k3 by the text's Method 5 as follows: First write
n +
n = 2 P
1jkn jk; then apply (2.33).
16
Prove that xm/(x ‚àín)m = xn/(x ‚àím)n, unless one of the denominators
is zero.
17
Show that the following formulas can be used to convert between rising
and falling factorial powers, for all integers m:
xm = (‚àí1)m(‚àíx)m = (x + m ‚àí1)m = 1/(x ‚àí1)‚àím ;
xm = (‚àí1)m(‚àíx)m = (x ‚àím + 1)m = 1/(x + 1)‚àím .
(The answer to exercise 9 denes x‚àím.)

64
SUMS
18
Let <z and =z be the real and imaginary parts of the complex num-
ber z. The absolute value jzj is
p
(<z)2 + (=z)2. A sum P
k‚ààK ak of
complex terms ak is said to converge absolutely when the real-valued
sums P
k‚ààK <ak and P
k‚ààK =ak both converge absolutely. Prove that
P
k‚ààK ak converges absolutely if and only if there is a bounding con-
stant B such that P
k‚ààF jakj  B for all nite subsets F ‚äÜK.
Homework exercises
19
Use a summation factor to solve the recurrence
T0 = 5 ;
2Tn = nTn‚àí1 + 3 ¬∑ n! ,
for n > 0.
20
Try to evaluate Pn
k=0 kHk by the perturbation method, but deduce the
value of Pn
k=0 Hk instead.
21
Evaluate the sums Sn = Pn
k=0(‚àí1)n‚àík,
Tn = Pn
k=0(‚àí1)n‚àíkk, and
Un = Pn
k=0(‚àí1)n‚àíkk2 by the perturbation method, assuming that n 
0.
22
Prove Lagrange's identity (without using induction):
It's hard to prove
the identity of
somebody who's
been dead for 175
years.
X
1j<kn
(ajbk ‚àíakbj)2 =
¬µ n
X
k=1
a2
k
¬∂¬µ n
X
k=1
b2
k
¬∂
‚àí
¬µ n
X
k=1
akbk
¬∂2
.
Prove, in fact, an identity for the more general double sum
X
1j<kn
(ajbk ‚àíakbj)(AjBk ‚àíAkBj) .
23
Evaluate the sum Pn
k=1(2k + 1)/k(k + 1) in two ways:
a
Replace 1/k(k + 1) by the \partial fractions" 1/k ‚àí1/(k + 1).
b
Sum by parts.
24
What is P
0k<n Hk/(k + 1)(k + 2)? Hint: Generalize the derivation of
(2.57).
25
The notation Q
k‚ààK ak means the product of the numbers ak for all
This notation was
introduced by
Jacobi in 1829 [192].
k ‚ààK. Assume for simplicity that ak Ã∏= 1 for only nitely many k; hence
innite products need not be dened. What laws does this Q-notation
satisfy, analogous to the distributive, associative, and commutative laws
that hold for P?
26
Express the double product Q
1jkn ajak in terms of the single prod-
uct Qn
k=1 ak by manipulating Q-notation.
¬°
This exercise gives us a
product analog of the upper-triangle identity (2.33).
¬¢

2 EXERCISES
65
27
Compute ‚àÜ(cx), and use it to deduce the value of Pn
k=1(‚àí2)k/k.
28
At what point does the following derivation go astray?
1 =
X
k1
1
k(k + 1) =
X
k1
¬µ
k
k + 1 ‚àík ‚àí1
k
¬∂
=
X
k1
X
j1
¬µk
j [j = k + 1] ‚àíj
k[j = k ‚àí1]
¬∂
=
X
j1
X
k1
¬µk
j [j = k + 1] ‚àíj
k[j = k ‚àí1]
¬∂
=
X
j1
X
k1
¬µk
j [k = j ‚àí1] ‚àíj
k[k = j + 1]
¬∂
=
X
j1
¬µj ‚àí1
j
‚àí
j
j + 1
¬∂
=
X
j1
‚àí1
j(j + 1) = ‚àí1 .
Exam problems
29
Evaluate the sum Pn
k=1(‚àí1)kk/(4k2 ‚àí1).
30
Cribbage players have long been aware that 15 = 7 + 8 = 4 + 5 + 6 =
1 + 2 + 3 + 4 + 5. Find the number of ways to represent 1050 as a sum of
consecutive positive integers. (The trivial representation `1050' by itself
counts as one way; thus there are four, not three, ways to represent 15
as a sum of consecutive positive integers. Incidentally, a knowledge of
cribbage rules is of no use in this problem.)
31
Riemann's zeta function Œ∂(k) is dened to be the innite sum
1 + 1
2k + 1
3k + ¬∑ ¬∑ ¬∑ =
X
j1
1
jk .
Prove that P
k2
¬°
Œ∂(k) ‚àí1
¬¢
= 1. What is the value of P
k1
¬°
Œ∂(2k) ‚àí1
¬¢
?
32
Let a .‚àíb = max(0, a ‚àíb). Prove that
X
k0
min(k, x .‚àík) =
X
k0
¬°
x .‚àí(2k + 1)
¬¢
for all real x  0, and evaluate the sums in closed form.
Bonus problems
33
Let V
k‚ààK ak denote the minimum of the numbers ak (or their greatest
lower bound, if K is innite), assuming that each ak is either real or ¬±‚àû.
What laws are valid for V-notation, analogous to those that work for P
The laws of the
jungle.
and Q? (See exercise 25.)

66
SUMS
34
Prove that if the sum P
k‚ààK ak is undened according to (2.59), then it
is extremely aky in the following sense: If A‚àíand A+ are any given
real numbers, it's possible to nd a sequence of nite subsets F1 ‚äÇF2 ‚äÇ
F3 ‚äÇ¬∑ ¬∑ ¬∑ of K such that
X
k‚ààFn
ak  A‚àí, when n is odd;
X
k‚ààFn
ak  A+, when n is even.
35
Prove Goldbach's theorem
1 = 1
3 + 1
7 + 1
8 + 1
15 + 1
24 + 1
26 + 1
31 + 1
35 + ¬∑ ¬∑ ¬∑ =
X
k‚ààP
1
k ‚àí1 ,
where P is the set of \perfect powers" dened recursively as follows:
Perfect power
corrupts perfectly.
P = f mn | m  2, n  2, m /‚ààP g .
36
Solomon Golomb's \self-describing sequence" ‚ü®f(1), f(2), f(3), . . . ‚ü©is the
only nondecreasing sequence of positive integers with the property that
it contains exactly f(k) occurrences of k for each k. A few moments'
thought reveals that the sequence must begin as follows:
n
1
2
3
4
5
6
7
8
9
10
11
12
f(n)
1
2
2
3
3
4
4
4
5
5
5
6
Let g(n) be the largest integer m such that f(m) = n. Show that
a
g(n) = Pn
k=1 f(k).
b
g
¬°
g(n)
¬¢
= Pn
k=1 kf(k).
c
g
¬°
g(g(n))
¬¢
= 1
2ng(n)
¬°
g(n) + 1
¬¢
‚àí1
2
Pn‚àí1
k=1 g(k)
¬°
g(k) + 1
¬¢
.
Research problem
37
Will all the 1/k by 1/(k + 1) rectangles, for k  1, t together inside a
1 by 1 square? (Recall that their areas sum to 1.)
1
1
1
2
1
2
1
3
1
3
1
4
1
4
1
5
etc.
¬©
¬©¬©
¬©¬©¬©
¬©¬©¬©
¬©¬©¬©
¬©¬©¬©
¬©¬©¬©
¬©¬©
¬©¬©
¬©¬©
¬©¬©¬©
¬©¬©¬©
¬©¬©
¬©A
A
A
A
A
A
A
A
A
A
A
A
¬¶¬¶¬¶¬¶¬¶¬¶¬¶¬¶





¬©
¬©

3
Integer Functions
WHOLE NUMBERS constitute the backbone of discrete mathematics, and we
often need to convert from fractions or arbitrary real numbers to integers. Our
goal in this chapter is to gain familiarity and uency with such conversions
and to learn some of their remarkable properties.
3.1
FLOORS AND CEILINGS
We start by covering the oor (greatest integer) and ceiling (least
integer) functions, which are dened for all real x as follows:
‚åäx‚åã= the greatest integer less than or equal to x ;
‚åàx‚åâ= the least integer greater than or equal to x .
(3.1)
Kenneth E. Iverson introduced this notation, as well as the names \oor" and
\ceiling," early in the 1960s [191, page 12]. He found that typesetters could
handle the symbols by shaving the tops and bottoms o of `[' and `]'. His
notation has become suciently popular that oor and ceiling brackets can
now be used in a technical paper without an explanation of what they mean.
Until recently, people had most often been writing `[x]' for the greatest integer
 x, without a good equivalent for the least integer function. Some authors
had even tried to use `]x[' | with a predictable lack of success.
)Ouch.(
Besides variations in notation, there are variations in the functions them-
selves. For example, some pocket calculators have an INT function, dened
as ‚åäx‚åãwhen x is positive and ‚åàx‚åâwhen x is negative.
The designers of
these calculators probably wanted their INT function to satisfy the iden-
tity INT(‚àíx) = ‚àíINT(x). But we'll stick to our oor and ceiling functions,
because they have even nicer properties than this.
One good way to become familiar with the oor and ceiling functions
is to understand their graphs, which form staircase-like patterns above and
67

68
INTEGER FUNCTIONS
below the line f(x) = x:
-
x
6f(x)
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬° f(x) = x
r
qqqqqq
r
qqqqqq
r
qqqqqq
r
qqqqqq
r
qqqqqq
r
qqqqqq
r
qqqqqq
‚àí3 ‚àí2 ‚àí1
1
2
3
3
2
1
0
‚àí1
‚àí2
‚àí3
‚åàx‚åâ=
r
qqqqqq
‚åäx‚åã= r
x = e
x = ‚àíe
We see from the graph that, for example,
‚åäe‚åã= 2 ,
‚åàe‚åâ= 3 ,
‚åä‚àíe‚åã= ‚àí3 ,
‚åà‚àíe‚åâ= ‚àí2 ,
since e = 2.71828 . . . .
By staring at this illustration we can observe several facts about oors
and ceilings. First, since the oor function lies on or below the diagonal line
f(x) = x, we have ‚åäx‚åã x; similarly ‚åàx‚åâ x.
(This, of course, is quite
obvious from the denition.) The two functions are equal precisely at the
integer points:
‚åäx‚åã= x
‚áê‚áí
x is an integer
‚áê‚áí
‚åàx‚åâ= x .
(We use the notation `‚áê‚áí' to mean \if and only if.") Furthermore, when
they dier the ceiling is exactly 1 higher than the oor:
‚åàx‚åâ‚àí‚åäx‚åã= [x is not an integer] .
(3.2)
If we shift the diagonal line down one unit, it lies completely below the oor
Cute.
By Iverson's bracket
convention, this is a
complete equation.
function, so x ‚àí1 < ‚åäx‚åã; similarly x + 1 > ‚åàx‚åâ. Combining these observations
gives us
x ‚àí1 < ‚åäx‚åã x  ‚åàx‚åâ< x + 1 .
(3.3)
Finally, the functions are reections of each other about both axes:
‚åä‚àíx‚åã= ‚àí‚åàx‚åâ;
‚åà‚àíx‚åâ= ‚àí‚åäx‚åã.
(3.4)

3.1 FLOORS AND CEILINGS
69
Thus each is easily expressible in terms of the other.
This fact helps to
explain why the ceiling function once had no notation of its own. But we
see ceilings often enough to warrant giving them special symbols, just as we
have adopted special notations for rising powers as well as falling powers.
Mathematicians have long had both sine and cosine, tangent and cotangent,
secant and cosecant, max and min; now we also have both oor and ceiling.
Next week we're
getting walls.
To actually prove properties about the oor and ceiling functions, rather
than just to observe such facts graphically, the following four rules are espe-
cially useful:
‚åäx‚åã= n
‚áê‚áí
n  x < n + 1 ,
(a)
‚åäx‚åã= n
‚áê‚áí
x ‚àí1 < n  x ,
(b)
‚åàx‚åâ= n
‚áê‚áí
n ‚àí1 < x  n ,
(c)
‚åàx‚åâ= n
‚áê‚áí
x  n < x + 1 .
(d)
(3.5)
(We assume in all four cases that n is an integer and that x is real.) Rules
(a) and (c) are immediate consequences of denition (3.1); rules (b) and (d)
are the same but with the inequalities rearranged so that n is in the middle.
It's possible to move an integer term in or out of a oor (or ceiling):
‚åäx + n‚åã= ‚åäx‚åã+ n ,
integer n.
(3.6)
(Because rule (3.5(a)) says that this assertion is equivalent to the inequalities
‚åäx‚åã+ n  x + n < ‚åäx‚åã+ n + 1.) But similar operations, like moving out a
constant factor, cannot be done in general. For example, we have ‚åänx‚åãÃ∏= n‚åäx‚åã
when n = 2 and x = 1/2. This means that oor and ceiling brackets are
comparatively inexible. We are usually happy if we can get rid of them or if
we can prove anything at all when they are present.
It turns out that there are many situations in which oor and ceiling
brackets are redundant, so that we can insert or delete them at will. For
example, any inequality between a real and an integer is equivalent to a oor
or ceiling inequality between integers:
x < n
‚áê‚áí
‚åäx‚åã< n ,
(a)
n < x
‚áê‚áí
n < ‚åàx‚åâ,
(b)
x  n
‚áê‚áí
‚åàx‚åâ n ,
(c)
n  x
‚áê‚áí
n  ‚åäx‚åã.
(d)
(3.7)
These rules are easily proved. For example, if x < n then surely ‚åäx‚åã< n, since
‚åäx‚åã x. Conversely, if ‚åäx‚åã< n then we must have x < n, since x < ‚åäx‚åã+ 1
and ‚åäx‚åã+ 1  n.
It would be nice if the four rules in (3.7) were as easy to remember as
they are to prove. Each inequality without oor or ceiling corresponds to the

70
INTEGER FUNCTIONS
same inequality with oor or with ceiling; but we need to think twice before
deciding which of the two is appropriate.
The dierence between x and ‚åäx‚åãis called the fractional part of x, and
it arises often enough in applications to deserve its own notation:
fxg = x ‚àí‚åäx‚åã.
(3.8)
We sometimes call ‚åäx‚åãthe integer part of x, since x = ‚åäx‚åã+ fxg. If a real
Hmmm. We'd bet-
ter not write fxg
for the fractional
part when it could
be confused with
the set containing x
as its only element.
number x can be written in the form x = n + Œ∏, where n is an integer and
0  Œ∏ < 1, we can conclude by (3.5(a)) that n = ‚åäx‚åãand Œ∏ = fxg.
Identity (3.6) doesn't hold if n is an arbitrary real. But we can deduce
that there are only two possibilities for ‚åäx + y‚åãin general: If we write x =
‚åäx‚åã+ fxg and y = ‚åäy‚åã+ fyg, then we have ‚åäx + y‚åã= ‚åäx‚åã+ ‚åäy‚åã+ ‚åäfxg + fyg‚åã.
And since 0  fxg + fyg < 2, we nd that sometimes ‚åäx + y‚åãis ‚åäx‚åã+ ‚åäy‚åã,
otherwise it's ‚åäx‚åã+ ‚åäy‚åã+ 1.
The second case
occurs if and only
if there's a \carry"
at the position of
the decimal point,
when the fractional
parts fxg and fyg
are added together.
3.2
FLOOR/CEILING APPLICATIONS
We've now seen the basic tools for handling oors and ceilings. Let's
put them to use, starting with an easy problem: What's ‚åàlg 35‚åâ? (Following a
suggestion of Edward M. Reingold, we use `lg' to denote the base-2 logarithm.)
Well, since 25 < 35  26, we can take logs to get 5 < lg 35  6; so relation
(3.5(c)) tells us that ‚åàlg 35‚åâ= 6.
Note that the number 35 is six bits long when written in radix 2 notation:
35 = (100011)2. Is it always true that ‚åàlg n‚åâis the length of n written in
binary? Not quite. We also need six bits to write 32 = (100000)2. So ‚åàlg n‚åâ
is the wrong answer to the problem. (It fails only when n is a power of 2,
but that's innitely many failures.) We can nd a correct answer by realizing
that it takes m bits to write each number n such that 2m‚àí1  n < 2m; thus
(3.5(a)) tells us that m ‚àí1 = ‚åälg n‚åã, so m = ‚åälg n‚åã+ 1. That is, we need
‚åälg n‚åã+ 1 bits to express n in binary, for all n > 0. Alternatively, a similar
derivation yields the answer ‚åàlg(n + 1)‚åâ; this formula holds for n = 0 as well,
if we're willing to say that it takes zero bits to write n = 0 in binary.
Let's look next at expressions with several oors or ceilings. What is
¬ß
‚åäx‚åã
¬®
? Easy | since ‚åäx‚åãis an integer,
¬ß
‚åäx‚åã
¬®
is just ‚åäx‚åã. So is any other ex-
pression with an innermost ‚åäx‚åãsurrounded by any number of oors or ceilings.
Here's a tougher problem: Prove or disprove the assertion
¬•p
‚åäx‚åã
¬¶
= ‚åä‚àöx‚åã,
real x  0.
(3.9)
Equality obviously holds when x is an integer, because x = ‚åäx‚åã. And there's
(Of course œÄ, e,
and œÜ are the
obvious rst real
numbers to try,
aren't they?)
equality in the special cases œÄ = 3.14159 . . . , e = 2.71828 . . . , and œÜ =
(1 +
‚àö
5)/2 = 1.61803 . . . , because we get 1 = 1. Our failure to nd a coun-
terexample suggests that equality holds in general, so let's try to prove it.

3.2 FLOOR/CEILING APPLICATIONS
71
Incidentally, when we're faced with a \prove or disprove," we're usually
better o trying rst to disprove with a counterexample, for two reasons:
Skepticism is
healthy only to
a limited extent.
Being skeptical
about proofs and
programs (particu-
larly your own) will
probably keep your
grades healthy and
your job fairly se-
cure. But applying
that much skepti-
cism will probably
also keep you shut
away working all
the time, instead
of letting you get
out for exercise and
relaxation.
Too much skepti-
cism is an open in-
vitation to the state
of rigor mortis,
where you become
so worried about
being correct and
rigorous that you
never get anything
nished.
|A skeptic
A disproof is potentially easier (we need just one counterexample); and nit-
picking arouses our creative juices. Even if the given assertion is true, our
search for a counterexample often leads us to a proof, as soon as we see why
a counterexample is impossible. Besides, it's healthy to be skeptical.
If we try to prove that
¬•p
‚åäx‚åã
¬¶
= ‚åä‚àöx‚åãwith the help of calculus, we might
start by decomposing x into its integer and fractional parts ‚åäx‚åã+ fxg = n + Œ∏
and then expanding the square root using the binomial theorem: (n+Œ∏)1/2 =
n1/2 + n‚àí1/2Œ∏/2 ‚àín‚àí3/2Œ∏2/8 + ¬∑ ¬∑ ¬∑ . But this approach gets pretty messy.
It's much easier to use the tools we've developed. Here's a possible strat-
egy: Somehow strip o the outer oor and square root of
¬•p
‚åäx‚åã
¬¶
, then re-
move the inner oor, then add back the outer stu to get ‚åä‚àöx‚åã. OK. We let
m =
¬•p
‚åäx‚åã
¬¶
and invoke (3.5(a)), giving m 
p
‚åäx‚åã< m + 1. That removes
the outer oor bracket without losing any information. Squaring, since all
three expressions are nonnegative, we have m2  ‚åäx‚åã< (m + 1)2. That gets
rid of the square root. Next we remove the oor, using (3.7(d)) for the left
inequality and (3.7(a)) for the right: m2  x < (m + 1)2. It's now a simple
matter to retrace our steps, taking square roots to get m  ‚àöx < m + 1 and
invoking (3.5(a)) to get m = ‚åä‚àöx‚åã. Thus
¬•p
‚åäx‚åã
¬¶
= m = ‚åä‚àöx‚åã; the assertion
is true. Similarly, we can prove that
¬ßp
‚åàx‚åâ
¬®
= ‚åà‚àöx ‚åâ,
real x  0.
The proof we just found doesn't rely heavily on the properties of square
roots. A closer look shows that we can generalize the ideas and prove much
more: Let f(x) be any continuous, monotonically increasing function with the
property that
f(x) = integer
=‚áí
x = integer .
(The symbol `=‚áí' means \implies.") Then we have
‚åäf(x)‚åã= ‚åäf(‚åäx‚åã)‚åã
and
‚åàf(x)‚åâ= ‚åàf(‚åàx‚åâ)‚åâ,
(3.10)
whenever f(x), f(‚åäx‚åã), and f(‚åàx‚åâ) are dened. Let's prove this general prop-
(This observation
was made by R. J.
McEliece when he
was an undergrad.)
erty for ceilings, since we did oors earlier and since the proof for oors is
almost the same. If x = ‚åàx‚åâ, there's nothing to prove. Otherwise x < ‚åàx‚åâ,
and f(x) < f(‚åàx‚åâ) since f is increasing. Hence ‚åàf(x)‚åâ ‚åàf(‚åàx‚åâ)‚åâ, since ‚åà‚åâis
nondecreasing. If ‚åàf(x)‚åâ< ‚åàf(‚åàx‚åâ)‚åâ, there must be a number y such that
x  y < ‚åàx‚åâand f(y) = ‚åàf(x)‚åâ, since f is continuous. This y is an integer, be-
cause of f's special property. But there cannot be an integer strictly between
x and ‚åàx‚åâ. This contradiction implies that we must have ‚åàf(x)‚åâ= ‚åàf(‚åàx‚åâ)‚åâ.

72
INTEGER FUNCTIONS
An important special case of this theorem is worth noting explicitly:
¬πx + m
n
¬∫
=
¬π‚åäx‚åã+ m
n
¬∫
and
¬ªx + m
n
¬º
=
¬ª‚åàx‚åâ+ m
n
¬º
, (3.11)
if m and n are integers and the denominator n is positive. For example, let
m = 0; we have
¬•¬•
‚åäx/10‚åã/10
¬¶
/10
¬¶
= ‚åäx/1000‚åã. Dividing thrice by 10 and
throwing o digits is the same as dividing by 1000 and tossing the remainder.
Let's try now to prove or disprove another statement:
¬ßp
‚åäx‚åã
¬®
?= ‚åà‚àöx ‚åâ,
real x  0.
This works when x = œÄ and x = e, but it fails when x = œÜ; so we know that
it isn't true in general.
Before going any further, let's digress a minute to discuss dierent levels
of problems that might appear in books about mathematics:
Level 1. Given an explicit object x and an explicit property P(x), prove that
P(x) is true. For example, \Prove that ‚åäœÄ‚åã= 3." Here the problem involves
nding a proof of some purported fact.
Level 2. Given an explicit set X and an explicit property P(x), prove that
P(x) is true for all x ‚ààX. For example, \Prove that ‚åäx‚åã x for all real x."
Again the problem involves nding a proof, but the proof this time must be
general. We're doing algebra, not just arithmetic.
Level 3. Given an explicit set X and an explicit property P(x), prove or
disprove that P(x) is true for all x ‚ààX. For example, \Prove or disprove
In my other texts
\prove or disprove"
seems to mean the
same as \prove,"
about 99.44% of
the time; but not
in this book.
that
¬ßp
‚åäx‚åã
¬®
= ‚åà‚àöx ‚åâfor all real x  0." Here there's an additional level
of uncertainty; the outcome might go either way. This is closer to the real
situation a mathematician constantly faces: Assertions that get into books
tend to be true, but new things have to be looked at with a jaundiced eye. If
the statement is false, our job is to nd a counterexample. If the statement
is true, we must nd a proof as in level 2.
Level 4. Given an explicit set X and an explicit property P(x), nd a neces-
sary and sucient condition Q(x) that P(x) is true. For example, \Find a
necessary and sucient condition that ‚åäx‚åã ‚åàx‚åâ." The problem is to nd Q
such that P(x) ‚áê‚áíQ(x). Of course, there's always a trivial answer; we can
take Q(x) = P(x). But the implied requirement is to nd a condition that's as
simple as possible. Creativity is required to discover a simple condition that
But no simpler.
|A. Einstein
will work. (For example, in this case, \‚åäx‚åã ‚åàx‚åâ‚áê‚áíx is an integer.") The
extra element of discovery needed to nd Q(x) makes this sort of problem
more dicult, but it's more typical of what mathematicians must do in the
\real world." Finally, of course, a proof must be given that P(x) is true if and
only if Q(x) is true.

3.2 FLOOR/CEILING APPLICATIONS
73
Level 5. Given an explicit set X, nd an interesting property P(x) of its
elements. Now we're in the scary domain of pure research, where students
might think that total chaos reigns. This is real mathematics. Authors of
textbooks rarely dare to pose level 5 problems.
End of digression. But let's convert the last question we looked at from
level 3 to level 4: What is a necessary and sucient condition that
¬ßp
‚åäx‚åã
¬®
=
‚åà‚àöx ‚åâ? We have observed that equality holds when x = 3.142 but not when
x = 1.618; further experimentation shows that it fails also when x is between
9 and 10. Oho. Yes. We see that bad cases occur whenever m2 < x < m2 +1,
Home of the
Toledo Mudhens.
since this gives m on the left and m + 1 on the right.
In all other cases
where ‚àöx is dened, namely when x = 0 or m2 + 1  x  (m + 1)2, we
get equality. The following statement is therefore necessary and sucient for
equality: Either x is an integer or
p
‚åäx‚åãisn't.
For our next problem let's consider a handy new notation, suggested
by C. A. R. Hoare and Lyle Ramshaw, for intervals of the real line:
[Œ± . . Œ≤]
denotes the set of real numbers x such that Œ±  x  Œ≤. This set is called
a closed interval because it contains both endpoints Œ± and Œ≤. The interval
containing neither endpoint, denoted by (Œ± . . Œ≤), consists of all x such that
Œ± < x < Œ≤; this is called an open interval. And the intervals [Œ± . . Œ≤) and
(Œ± . . Œ≤], which contain just one endpoint, are dened similarly and called
half-open.
(Or, by pessimists,
half-closed.)
How many integers are contained in such intervals? The half-open inter-
vals are easier, so we start with them. In fact half-open intervals are almost
always nicer than open or closed intervals. For example, they're additive | we
can combine the half-open intervals [Œ± . . Œ≤) and [Œ≤ . . Œ≥) to form the half-open
interval [Œ± . . Œ≥). This wouldn't work with open intervals because the point Œ≤
would be excluded, and it could cause problems with closed intervals because
Œ≤ would be included twice.
Back to our problem. The answer is easy if Œ± and Œ≤ are integers: Then
[Œ± . . Œ≤) contains the Œ≤ ‚àíŒ± integers Œ±, Œ± + 1, . . . , Œ≤ ‚àí1, assuming that Œ±  Œ≤.
Similarly (Œ± . . Œ≤] contains Œ≤ ‚àíŒ± integers in such a case. But our problem is
harder, because Œ± and Œ≤ are arbitrary reals. We can convert it to the easier
problem, though, since
Œ±  n < Œ≤
‚áê‚áí
‚åàŒ±‚åâ n < ‚åàŒ≤‚åâ,
Œ± < n  Œ≤
‚áê‚áí
‚åäŒ±‚åã< n  ‚åäŒ≤‚åã,
when n is an integer, according to (3.7).
The intervals on the right have
integer endpoints and contain the same number of integers as those on the left,
which have real endpoints. So the interval [Œ± . . Œ≤) contains exactly ‚åàŒ≤‚åâ‚àí‚åàŒ±‚åâ
integers, and (Œ± . . Œ≤] contains ‚åäŒ≤‚åã‚àí‚åäŒ±‚åã. This is a case where we actually
want to introduce oor or ceiling brackets, instead of getting rid of them.

74
INTEGER FUNCTIONS
By the way, there's a mnemonic for remembering which case uses oors
and which uses ceilings: Half-open intervals that include the left endpoint
but not the right (such as 0  Œ∏ < 1) are slightly more common than those
that include the right endpoint but not the left; and oors are slightly more
Just like we can re-
member the date of
Columbus's depar-
ture by singing, \In
fourteen hundred
and ninety-three/
Columbus sailed the
deep blue sea."
common than ceilings. So by Murphy's Law, the correct rule is the opposite
of what we'd expect | ceilings for [Œ± . . Œ≤) and oors for (Œ± . . Œ≤].
Similar analyses show that the closed interval [Œ± . . Œ≤] contains exactly
‚åäŒ≤‚åã‚àí‚åàŒ±‚åâ+1 integers and that the open interval (Œ± . . Œ≤) contains ‚åàŒ≤‚åâ‚àí‚åäŒ±‚åã‚àí1;
but we place the additional restriction Œ± Ã∏= Œ≤ on the latter so that the formula
won't ever embarrass us by claiming that an empty interval (Œ± . . Œ±) contains
a total of ‚àí1 integers. To summarize, we've deduced the following facts:
interval
integers contained
restrictions
[Œ± . . Œ≤]
‚åäŒ≤‚åã‚àí‚åàŒ±‚åâ+ 1
Œ±  Œ≤ ,
[Œ± . . Œ≤)
‚åàŒ≤‚åâ‚àí‚åàŒ±‚åâ
Œ±  Œ≤ ,
(Œ± . . Œ≤]
‚åäŒ≤‚åã‚àí‚åäŒ±‚åã
Œ±  Œ≤ ,
(Œ± . . Œ≤)
‚åàŒ≤‚åâ‚àí‚åäŒ±‚åã‚àí1
Œ± < Œ≤ .
(3.12)
Now here's a problem we can't refuse. The Concrete Math Club has a
casino (open only to purchasers of this book) in which there's a roulette wheel
with one thousand slots, numbered 1 to 1000. If the number n that comes up
on a spin is divisible by the oor of its cube root, that is, if
‚åä
3‚àön‚åã
¬≤
n ,
then it's a winner and the house pays us $5; otherwise it's a loser and we
must pay $1. (The notation anb, read \a divides b," means that b is an exact
multiple of a; Chapter 4 investigates this relation carefully.) Can we expect
(A poll of the class
at this point showed
that 28 students
thought it was a
bad idea to play,
13 wanted to gam-
ble, and the rest
were too confused
to answer.)
(So we hit them
with the Concrete
Math Club.)
to make money if we play this game?
We can compute the average winnings | that is, the amount we'll win
(or lose) per play | by rst counting the number W of winners and the num-
ber L = 1000 ‚àíW of losers. If each number comes up once during 1000 plays,
we win 5W dollars and lose L dollars, so the average winnings will be
5W ‚àíL
1000
= 5W ‚àí(1000 ‚àíW)
1000
= 6W ‚àí1000
1000
.
If there are 167 or more winners, we have the advantage; otherwise the ad-
vantage is with the house.
How can we count the number of winners among 1 through 1000? It's
not hard to spot a pattern. The numbers from 1 through 23 ‚àí1 = 7 are all
winners because ‚åä3‚àön‚åã= 1 for each. Among the numbers 23 = 8 through
33 ‚àí1 = 26, only the even numbers are winners. And among 33 = 27 through
43 ‚àí1 = 63, only those divisible by 3 are. And so on.

3.2 FLOOR/CEILING APPLICATIONS
75
The whole setup can be analyzed systematically if we use the summa-
tion techniques of Chapter 2, taking advantage of Iverson's convention about
logical statements evaluating to 0 or 1:
W =
1000
X
n=1
[n is a winner]
=
X
1n1000
¬£
‚åä3‚àön‚åã
¬≤
n
¬§
=
X
k,n
¬£
k = ‚åä3‚àön‚åã
¬§
[knn][1  n  1000]
=
X
k,m,n
¬£
k3  n < (k + 1)3¬§
[n = km][1  n  1000]
= 1 +
X
k,m
¬£
k3  km < (k + 1)3¬§
[1  k < 10]
= 1 +
X
k,m
¬£
m ‚àà
¬£
k2 . . (k + 1)3/k
¬¢¬§
[1  k < 10]
= 1 +
X
1k<10
¬°
‚åàk2 + 3k + 3 + 1/k‚åâ‚àí‚åàk2‚åâ
¬¢
= 1 +
X
1k<10
(3k + 4) = 1 + 7 + 31
2
¬∑9 = 172 .
This derivation merits careful study.
Notice that line 6 uses our formula
(3.12) for the number of integers in a half-open interval. The only \dicult"
maneuver is the decision made between lines 3 and 4 to treat n = 1000 as a
special case. (The inequality k3  n < (k + 1)3 does not combine easily with
1  n  1000 when k = 10.) In general, boundary conditions tend to be the
most critical part of P-manipulations.
True.
The bottom line says that W = 172; hence our formula for average win-
nings per play reduces to (6¬∑172 ‚àí1000)/1000 dollars, which is 3.2 cents. We
Where did you say
this casino is?
can expect to be about $3.20 richer after making 100 bets of $1 each. (Of
course, the house may have made some numbers more equal than others.)
The casino problem we just solved is a dressed-up version of the more
mundane question, \How many integers n, where 1  n  1000, satisfy the re-
lation ‚åä3‚àön‚åã
¬≤
n?" Mathematically the two questions are the same. But some-
times it's a good idea to dress up a problem. We get to use more vocabulary
(like \winners" and \losers"), which helps us to understand what's going on.
Let's get general. Suppose we change 1000 to 1000000, or to an even
larger number, N. (We assume that the casino has connections and can get a
bigger wheel.) Now how many winners are there?
The same argument applies, but we need to deal more carefully with the
largest value of k, which we can call K for convenience:
K = ‚åä
3‚àö
N‚åã.

76
INTEGER FUNCTIONS
(Previously K was 10.) The total number of winners for general N comes to
W =
X
1k<K
(3k + 4) +
X
m
¬£
K3  Km  N
¬§
=
1
2(7 + 3K + 1)(K ‚àí1) +
X
m
¬£
m ‚àà[K2 . . N/K]
¬§
=
3
2K2 + 5
2K ‚àí4 +
X
m
¬£
m ‚àà[K2 . . N/K]
¬§
.
We know that the remaining sum is ‚åäN/K‚åã‚àí‚åàK2‚åâ+ 1 = ‚åäN/K‚åã‚àíK2 + 1;
hence the formula
W = ‚åäN/K‚åã+ 1
2K2 + 5
2K ‚àí3 ,
K = ‚åä
3‚àö
N‚åã
(3.13)
gives the general answer for a wheel of size N.
The rst two terms of this formula are approximately N2/3 + 1
2N2/3 =
3
2N2/3, and the other terms are much smaller in comparison, when N is large.
In Chapter 9 we'll learn how to derive expressions like
W =
3
2N2/3 + O(N1/3) ,
where O(N1/3) stands for a quantity that is no more than a constant times
N1/3. Whatever the constant is, we know that it's independent of N; so for
large N the contribution of the O-term to W will be quite small compared
with 3
2N2/3. For example, the following table shows how close 3
2N2/3 is to
W:
N
3
2N2/3
W
% error
1,000
150.0
172
12.791
10,000
696.2
746
6.670
100,000
3231.7
3343
3.331
1,000,000
15000.0
15247
1.620
10,000,000
69623.8
70158
0.761
100,000,000
323165.2
324322
0.357
1,000,000,000
1500000.0
1502496
0.166
It's a pretty good approximation.
Approximate formulas are useful because they're simpler than formu-
las with oors and ceilings.
However, the exact truth is often important,
too, especially for the smaller values of N that tend to occur in practice.
For example, the casino owner may have falsely assumed that there are only
3
2N2/3 = 150 winners when N = 1000 (in which case there would be a 10/c
advantage for the house).

3.2 FLOOR/CEILING APPLICATIONS
77
Our last application in this section looks at so-called spectra. We dene
the spectrum of a real number Œ± to be an innite multiset of integers,
Spec(Œ±) = f‚åäŒ±‚åã, ‚åä2Œ±‚åã, ‚åä3Œ±‚åã, . . . g .
(A multiset is like a set but it can have repeated elements.) For example, the
spectrum of 1/2 starts out f0, 1, 1, 2, 2, 3, 3, . . . g.
It's easy to prove that no two spectra are equal | that Œ± Ã∏= Œ≤ implies
Spec(Œ±) Ã∏= Spec(Œ≤). For, assuming without loss of generality that Œ± < Œ≤,
. . . without lots
of generality . . .
there's a positive integer m such that m(Œ≤ ‚àíŒ±)  1.
(In fact, any m 
‚åà1/(Œ≤ ‚àíŒ±)‚åâwill do; but we needn't show o our knowledge of oors and
ceilings all the time.)
Hence mŒ≤ ‚àímŒ±  1, and ‚åämŒ≤‚åã> ‚åämŒ±‚åã.
Thus
Spec(Œ≤) has fewer than m elements  ‚åämŒ±‚åã, while Spec(Œ±) has at least m.
Spectra have many beautiful properties. For example, consider the two
\If x be an in-
commensurable
number less than
unity, one of the
series of quantities
m/x, m/(1 ‚àíx),
where m is a whole
number, can be
found which shall
lie between any
given consecutive
integers, and but
one such quantity
can be found."
|Rayleigh [304]
multisets
Spec(
‚àö
2 ) = f1, 2, 4, 5, 7, 8, 9, 11, 12, 14, 15, 16, 18, 19, 21, 22, 24, . . . g ,
Spec(2 +
‚àö
2 ) = f3, 6, 10, 13, 17, 20, 23, 27, 30, 34, 37, 40, 44, 47, 51, . . . g .
It's easy to calculate Spec(
‚àö
2 ) with a pocket calculator, and the nth element
of Spec(2 +
‚àö
2 ) is just 2n more than the nth element of Spec(
‚àö
2 ), by (3.6).
A closer look shows that these two spectra are also related in a much more
surprising way: It seems that any number missing from one is in the other,
but that no number is in both! And it's true: The positive integers are the
disjoint union of Spec(
‚àö
2 ) and Spec(2+
‚àö
2 ). We say that these spectra form
a partition of the positive integers.
To prove this assertion, we will count how many of the elements of
Spec(
‚àö
2 ) are  n, and how many of the elements of Spec(2+
‚àö
2 ) are  n. If
the total is n, for each n, these two spectra do indeed partition the integers.
Right, because
exactly one of
the counts must
increase when n
increases by 1.
Let Œ± be positive. The number of elements in Spec(Œ±) that are  n is
N(Œ±, n) =
X
k>0
¬£
‚åäkŒ±‚åã n
¬§
=
X
k>0
¬£
‚åäkŒ±‚åã< n + 1
¬§
=
X
k>0
[kŒ± < n + 1]
=
X
k
¬£
0 < k < (n + 1)/Œ±
¬§
= ‚åà(n + 1)/Œ±‚åâ‚àí1 .
(3.14)

78
INTEGER FUNCTIONS
This derivation has two special points of interest. First, it uses the law
m  n
‚áê‚áí
m < n + 1 ,
integers m and n
(3.15)
to change `' to `<', so that the oor brackets can be removed by (3.7).
Also | and this is more subtle | it sums over the range k > 0 instead of k  1,
because (n + 1)/Œ± might be less than 1 for certain n and Œ±. If we had tried
to apply (3.12) to determine the number of integers in [1 . . (n + 1)/Œ±), rather
than the number of integers in (0 . . (n+1)/Œ±), we would have gotten the right
answer; but our derivation would have been faulty because the conditions of
applicability wouldn't have been met.
Good, we have a formula for N(Œ±, n). Now we can test whether or not
Spec(
‚àö
2 ) and Spec(2+
‚àö
2 ) partition the positive integers, by testing whether
or not N(
‚àö
2, n) + N(2 +
‚àö
2, n) = n for all integers n > 0, using (3.14):
¬ªn + 1
‚àö
2
¬º
‚àí1 +
¬ª n + 1
2 +
‚àö
2
¬º
‚àí1 = n
‚áê‚áí
¬πn + 1
‚àö
2
¬∫
+
¬π n + 1
2 +
‚àö
2
¬∫
= n ,
by (3.2);
‚áê‚áí
n + 1
‚àö
2
‚àí
¬Øn + 1
‚àö
2
¬∞
+ n + 1
2 +
‚àö
2
‚àí
¬Ø n + 1
2 +
‚àö
2
¬∞
= n ,
by (3.8).
Everything simplies now because of the neat identity
1
‚àö
2
+
1
2 +
‚àö
2
= 1 ;
our condition reduces to testing whether or not
¬Øn + 1
‚àö
2
¬∞
+
¬Ø n + 1
2 +
‚àö
2
¬∞
= 1 ,
for all n > 0.
And we win, because these are the fractional parts of two
noninteger numbers that add up to the integer n + 1. A partition it is.
3.3
FLOOR/CEILING RECURRENCES
Floors and ceilings add an interesting new dimension to the study
of recurrence relations. Let's look rst at the recurrence
K0 = 1 ;
Kn+1 = 1 + min(2K‚åän/2‚åã, 3K‚åän/3‚åã) ,
for n  0.
(3.16)
Thus, for example, K1 is 1 + min(2K0, 3K0) = 3; the sequence begins 1, 3, 3,
4, 7, 7, 7, 9, 9, 10, 13, . . . . One of the authors of this book has modestly
decided to call these the Knuth numbers.

3.3 FLOOR/CEILING RECURRENCES
79
Exercise 25 asks for a proof or disproof that Kn  n, for all n  0. The
rst few K's just listed do satisfy the inequality, so there's a good chance that
it's true in general. Let's try an induction proof: The basis n = 0 comes
directly from the dening recurrence.
For the induction step, we assume
that the inequality holds for all values up through some xed nonnegative n,
and we try to show that Kn+1  n + 1. From the recurrence we know that
Kn+1 = 1 + min(2K‚åän/2‚åã, 3K‚åän/3‚åã). The induction hypothesis tells us that
2K‚åän/2‚åã 2‚åän/2‚åãand 3K‚åän/3‚åã 3‚åän/3‚åã. However, 2‚åän/2‚åãcan be as small
as n ‚àí1, and 3‚åän/3‚åãcan be as small as n ‚àí2. The most we can conclude
from our induction hypothesis is that Kn+1  1 + (n ‚àí2); this falls far short
of Kn+1  n + 1.
We now have reason to worry about the truth of Kn  n, so let's try to
disprove it. If we can nd an n such that either 2K‚åän/2‚åã< n or 3K‚åän/3‚åã< n,
or in other words such that
K‚åän/2‚åã< n/2
or
K‚åän/3‚åã< n/3 ,
we will have Kn+1 < n + 1. Can this be possible? We'd better not give the
answer away here, because that will spoil exercise 25.
Recurrence relations involving oors and/or ceilings arise often in com-
puter science, because algorithms based on the important technique of \divide
and conquer" often reduce a problem of size n to the solution of similar prob-
lems of integer sizes that are fractions of n. For example, one way to sort
n records, if n > 1, is to divide them into two approximately equal parts, one
of size ‚åàn/2‚åâand the other of size ‚åän/2‚åã. (Notice, incidentally, that
n = ‚åàn/2‚åâ+ ‚åän/2‚åã;
(3.17)
this formula comes in handy rather often.) After each part has been sorted
separately (by the same method, applied recursively), we can merge the
records into their nal order by doing at most n ‚àí1 further comparisons.
Therefore the total number of comparisons performed is at most f(n), where
f(1) = 0 ;
f(n) = f(‚åàn/2‚åâ) + f(‚åän/2‚åã) + n ‚àí1 ,
for n > 1.
(3.18)
A solution to this recurrence appears in exercise 34.
The Josephus problem of Chapter 1 has a similar recurrence, which can
be cast in the form
J(1) = 1 ;
J(n) = 2J(‚åän/2‚åã) ‚àí(‚àí1)n ,
for n > 1.

80
INTEGER FUNCTIONS
We've got more tools to work with than we had in Chapter 1, so let's
consider the more authentic Josephus problem in which every third person is
eliminated, instead of every second. If we apply the methods that worked in
Chapter 1 to this more dicult problem, we wind up with a recurrence like
J3(n) =
l
3
2J3
¬°
‚åä2
3n‚åã
¬¢
+ an
m
mod n + 1 ,
where `mod' is a function that we will be studying shortly, and where we have
an = ‚àí2, +1, or ‚àí1
2 according as n mod 3 = 0, 1, or 2. But this recurrence
is too horrible to pursue.
There's another approach to the Josephus problem that gives a much
better setup. Whenever a person is passed over, we can assign a new number.
Thus, 1 and 2 become n + 1 and n + 2, then 3 is executed; 4 and 5 become
n + 3 and n + 4, then 6 is executed; . . . ; 3k + 1 and 3k + 2 become n + 2k + 1
and n + 2k + 2, then 3k + 3 is executed; . . . then 3n is executed (or left to
survive). For example, when n = 10 the numbers are
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
The kth person eliminated ends up with number 3k. So we can gure out who
the survivor is if we can gure out the original number of person number 3n.
If N > n, person number N must have had a previous number, and we
can nd it as follows: We have N = n + 2k + 1 or N = n + 2k + 2, hence
k = ‚åä(N ‚àín ‚àí1)/2‚åã; the previous number was 3k + 1 or 3k + 2, respectively.
That is, it was 3k + (N ‚àín ‚àí2k) = k + N ‚àín. Hence we can calculate the
survivor's number J3(n) as follows:
N := 3n ;
while N > n do N :=
¬πN ‚àín ‚àí1
2
¬∫
+ N ‚àín ;
J3(n) := N .
This is not a closed form for J3(n); it's not even a recurrence. But at least it
\Not too slow,
not too fast."
|L. Armstrong
tells us how to calculate the answer reasonably fast, if n is large.

3.3 FLOOR/CEILING RECURRENCES
81
Fortunately there's a way to simplify this algorithm if we use the variable
D = 3n + 1 ‚àíN in place of N.
(This change in notation corresponds to
assigning numbers from 3n down to 1, instead of from 1 up to 3n; it's sort of
like a countdown.) Then the complicated assignment to N becomes
D := 3n + 1 ‚àí
¬µ¬π(3n + 1 ‚àíD) ‚àín ‚àí1
2
¬∫
+ (3n + 1 ‚àíD) ‚àín
¬∂
= n + D ‚àí
¬π2n ‚àíD
2
¬∫
= D ‚àí
¬π‚àíD
2
¬∫
= D +
¬ªD
2
¬º
=
¬ß 3
2D
¬®
,
and we can rewrite the algorithm as follows:
D := 1 ;
while D  2n do D :=
¬ß 3
2D
¬®
;
J3(n) := 3n + 1 ‚àíD .
Aha! This looks much nicer, because n enters the calculation in a very simple
way. In fact, we can show by the same reasoning that the survivor Jq(n) when
every qth person is eliminated can be calculated as follows:
D := 1 ;
while D  (q ‚àí1)n do D :=
¬ß
q
q‚àí1D
¬®
;
(3.19)
Jq(n) := qn + 1 ‚àíD .
In the case q = 2 that we know so well, this makes D grow to 2m+1 when
n = 2m + l; hence J2(n) = 2(2m + l) + 1 ‚àí2m+1 = 2l + 1. Good.
The recipe in (3.19) computes a sequence of integers that can be dened
by the following recurrence:
D(q)
0
= 1 ;
D(q)
n
=
l
q
q ‚àí1D(q)
n‚àí1
m
for n > 0.
(3.20)
These numbers don't seem to relate to any familiar functions in a simple
way, except when q = 2; hence they probably don't have a nice closed form.
But if we're willing to accept the sequence D(q)
n
as \known," then it's easy to
\Known" like, say,
harmonic numbers.
A.M. Odlyzko and
H.S. Wilf have
shown [283] that
D(3)
n
= ‚åä( 3
2)nC‚åã,
where
C ‚âà1.622270503.
describe the solution to the generalized Josephus problem: The survivor Jq(n)
is qn + 1 ‚àíD(q)
k , where k is as small as possible such that D(q)
k
> (q ‚àí1)n.
3.4
'MOD': THE BINARY OPERATION
The quotient of n divided by m is ‚åän/m‚åã, when m and n are positive
integers. It's handy to have a simple notation also for the remainder of this

82
INTEGER FUNCTIONS
division, and we call it `n mod m'. The basic formula
n = m ‚åän/m‚åã
| {z }
quotient
+ n mod m
|
{z
}
remainder
tells us that we can express n mod m as n‚àím‚åän/m‚åã. We can generalize this
to negative integers, and in fact to arbitrary real numbers:
x mod y = x ‚àíy‚åäx/y‚åã,
for y Ã∏= 0.
(3.21)
This denes `mod' as a binary operation, just as addition and subtraction are
binary operations. Mathematicians have used mod this way informally for a
Why do they call it
`mod': The Binary
Operation? Stay
tuned to nd out in
the next, exciting,
chapter!
long time, taking various quantities mod 10, mod 2œÄ, and so on, but only in
the last twenty years has it caught on formally. Old notion, new notation.
We can easily grasp the intuitive meaning of x mod y, when x and y
are positive real numbers, if we imagine a circle of circumference y whose
points have been assigned real numbers in the interval [0 . . y). If we travel a
distance x around the circle, starting at 0, we end up at x mod y. (And the
number of times we encounter 0 as we go is ‚åäx/y‚åã.)
When x or y is negative, we need to look at the denition carefully in
order to see exactly what it means. Here are some integer-valued examples:
Beware of computer
languages that use
another denition.
5 mod 3 = 5 ‚àí3‚åä5/3‚åã
= 2 ;
5 mod ‚àí3 = 5 ‚àí(‚àí3)‚åä5/(‚àí3)‚åã
= ‚àí1 ;
‚àí5 mod 3 = ‚àí5 ‚àí3‚åä‚àí5/3‚åã
= 1 ;
‚àí5 mod ‚àí3 = ‚àí5 ‚àí(‚àí3)‚åä‚àí5/(‚àí3)‚åã= ‚àí2 .
The number after `mod' is called the modulus; nobody has yet decided what
How about calling
the other number
the modumor?
to call the number before `mod'.
In applications, the modulus is usually
positive, but the denition makes perfect sense when the modulus is negative.
In both cases the value of x mod y is between 0 and the modulus:
0  x mod y < y ,
for y > 0;
0  x mod y > y ,
for y < 0.
What about y = 0? Denition (3.21) leaves this case undened, in order to
avoid division by zero, but to be complete we can dene
x mod 0 = x .
(3.22)
This convention preserves the property that x mod y always diers from x by
a multiple of y. (It might seem more natural to make the function continuous
at 0, by dening x mod 0 = limy‚Üí0 x mod y = 0. But we'll see in Chapter 4

3.4 'MOD': THE BINARY OPERATION
83
that this would be much less useful. Continuity is not an important aspect
of the mod operation.)
We've already seen one special case of mod in disguise, when we wrote x
in terms of its integer and fractional parts, x = ‚åäx‚åã+ fxg. The fractional part
can also be written x mod 1, because we have
x = ‚åäx‚åã+ x mod 1 .
Notice that parentheses aren't needed in this formula; we take mod to bind
more tightly than addition or subtraction.
The oor function has been used to dene mod, and the ceiling function
hasn't gotten equal time. We could perhaps use the ceiling to dene a mod
analog like
x mumble y = y‚åàx/y‚åâ‚àíx ;
in our circle analogy this represents the distance the traveler needs to continue,
There was a time in
the 70s when `mod'
was the fashion.
Maybe the new
mumble function
should be called
`punk'?
No|I like
`mumble'.
after going a distance x, to get back to the starting point 0. But of course
we'd need a better name than `mumble'. If sucient applications come along,
an appropriate name will probably suggest itself.
The distributive law is mod's most important algebraic property: We
have
c(x mod y) = (cx) mod (cy)
(3.23)
for all real c, x, and y. (Those who like mod to bind less tightly than multi-
plication may remove the parentheses from the right side here, too.) It's easy
to prove this law from denition (3.21), since
c(x mod y) = c(x ‚àíy‚åäx/y‚åã) = cx ‚àícy‚åäcx/cy‚åã= cx mod cy ,
if cy Ã∏= 0; and the zero-modulus cases are trivially true. Our four examples
using ¬±5 and ¬±3 illustrate this law twice, with c = ‚àí1. An identity like
(3.23) is reassuring, because it gives us reason to believe that `mod' has not
been dened improperly.
In the remainder of this section, we'll consider an application in which
The remainder, eh?
`mod' turns out to be helpful although it doesn't play a central role. The
problem arises frequently in a variety of situations: We want to partition
n things into m groups as equally as possible.
Suppose, for example, that we have n short lines of text that we'd like
to arrange in m columns. For sthetic reasons, we want the columns to be
arranged in decreasing order of length (actually nonincreasing order); and the
lengths should be approximately the same | no two columns should dier by

84
INTEGER FUNCTIONS
more than one line's worth of text. If 37 lines of text are being divided into
ve columns, we would therefore prefer the arrangement on the right:
8
8
8
8
5
line 1
line 9
line 17
line 25
line 33
line 2
line 10
line 18
line 26
line 34
line 3
line 11
line 19
line 27
line 35
line 4
line 12
line 20
line 28
line 36
line 5
line 13
line 21
line 29
line 37
line 6
line 14
line 22
line 30
line 7
line 15
line 23
line 31
line 8
line 16
line 24
line 32
8
8
7
7
7
line 1
line 9
line 17
line 24
line 31
line 2
line 10
line 18
line 25
line 32
line 3
line 11
line 19
line 26
line 33
line 4
line 12
line 20
line 27
line 34
line 5
line 13
line 21
line 28
line 35
line 6
line 14
line 22
line 29
line 36
line 7
line 15
line 23
line 30
line 37
line 8
line 16
Furthermore we want to distribute the lines of text columnwise | rst decid-
ing how many lines go into the rst column and then moving on to the second,
the third, and so on | because that's the way people read. Distributing row
by row would give us the correct number of lines in each column, but the
ordering would be wrong. (We would get something like the arrangement on
the right, but column 1 would contain lines 1, 6, 11, . . . , 36, instead of lines
1, 2, 3, . . . , 8 as desired.)
A row-by-row distribution strategy can't be used, but it does tell us how
many lines to put in each column.
If n is not a multiple of m, the row-
by-row procedure makes it clear that the long columns should each contain
‚åàn/m‚åâlines, and the short columns should each contain ‚åän/m‚åã. There will
be exactly n mod m long columns (and, as it turns out, there will be exactly
n mumble m short ones).
Let's generalize the terminology and talk about `things' and `groups'
instead of `lines' and `columns'. We have just decided that the rst group
should contain ‚åàn/m‚åâthings; therefore the following sequential distribution
scheme ought to work: To distribute n things into m groups, when m > 0,
put ‚åàn/m‚åâthings into one group, then use the same procedure recursively to
put the remaining n‚Ä≤ = n‚àí‚åàn/m‚åâthings into m‚Ä≤ = m‚àí1 additional groups.
For example, if n = 314 and m = 6, the distribution goes like this:
remaining things
remaining groups
‚åàthings/groups‚åâ
314
6
53
261
5
53
208
4
52
156
3
52
104
2
52
52
1
52
It works. We get groups of approximately the same size, even though the
divisor keeps changing.
Why does it work? In general we can suppose that n = qm + r, where
q = ‚åän/m‚åãand r = n mod m.
The process is simple if r = 0: We put
‚åàn/m‚åâ= q things into the rst group and replace n by n‚Ä≤ = n ‚àíq, leaving

3.4 'MOD': THE BINARY OPERATION
85
n‚Ä≤ = qm‚Ä≤ things to put into the remaining m‚Ä≤ = m ‚àí1 groups.
And if
r > 0, we put ‚åàn/m‚åâ= q + 1 things into the rst group and replace n
by n‚Ä≤ = n ‚àíq ‚àí1, leaving n‚Ä≤ = qm‚Ä≤ + r ‚àí1 things for subsequent groups.
The new remainder is r‚Ä≤ = r ‚àí1, but q stays the same. It follows that there
will be r groups with q + 1 things, followed by m ‚àír groups with q things.
How many things are in the kth group? We'd like a formula that gives
‚åàn/m‚åâwhen k  n mod m, and ‚åän/m‚åãotherwise. It's not hard to verify
that
¬ªn ‚àík + 1
m
¬º
has the desired properties, because this reduces to q + ‚åà(r ‚àík + 1)/m‚åâif we
write n = qm + r as in the preceding paragraph; here q = ‚åän/m‚åã. We have
‚åà(r ‚àík + 1)/m‚åâ= [k  r], if 1  k  m and 0  r < m. Therefore we can
write an identity that expresses the partition of n into m as-equal-as-possible
parts in nonincreasing order:
n =
¬ª n
m
¬º
+
¬ªn ‚àí1
m
¬º
+ ¬∑ ¬∑ ¬∑ +
¬ªn ‚àím + 1
m
¬º
.
(3.24)
This identity is valid for all positive integers m, and for all integers n (whether
positive, negative, or zero). We have already encountered the case m = 2 in
(3.17), although we wrote it in a slightly dierent form, n = ‚åàn/2‚åâ+ ‚åän/2‚åã.
If we had wanted the parts to be in nondecreasing order, with the small
groups coming before the larger ones, we could have proceeded in the same
way but with ‚åän/m‚åãthings in the rst group. Then we would have derived
the corresponding identity
n =
¬π n
m
¬∫
+
¬πn + 1
m
¬∫
+ ¬∑ ¬∑ ¬∑ +
¬πn + m ‚àí1
m
¬∫
.
(3.25)
It's possible to convert between (3.25) and (3.24) by using either (3.4) or the
identity of exercise 12.
Now if we replace n in (3.25) by ‚åämx‚åã, and apply rule (3.11) to remove
Some claim that it's
too dangerous to
replace anything by
an mx.
oors inside of oors, we get an identity that holds for all real x:
‚åämx‚åã= ‚åäx‚åã+
¬π
x + 1
m
¬∫
+ ¬∑ ¬∑ ¬∑ +
¬π
x + m ‚àí1
m
¬∫
.
(3.26)
This is rather amazing, because the oor function is an integer approximation
of a real value, but the single approximation on the left equals the sum of a
bunch of them on the right. If we assume that ‚åäx‚åãis roughly x ‚àí1
2 on the
average, the left-hand side is roughly mx‚àí1
2, while the right-hand side comes
to roughly (x ‚àí1
2) + (x ‚àí1
2 + 1
m) + ¬∑ ¬∑ ¬∑ + (x ‚àí1
2 + m‚àí1
m ) = mx ‚àí1
2; the sum
of all these rough approximations turns out to be exact!

86
INTEGER FUNCTIONS
3.5
FLOOR/CEILING SUMS
Equation (3.26) demonstrates that it's possible to get a closed form
for at least one kind of sum that involves ‚åä‚åã. Are there others? Yes. The
trick that usually works in such cases is to get rid of the oor or ceiling by
introducing a new variable.
For example, let's see if it's possible to do the sum
X
0k<n
‚åä
‚àö
k‚åã
in closed form. One idea is to introduce the variable m = ‚åä
‚àö
k‚åã; we can do
this \mechanically" by proceeding as we did in the roulette problem:
X
0k<n
‚åä
‚àö
k‚åã=
X
k,m0
m[k < n]
¬£
m = ‚åä
‚àö
k‚åã
¬§
=
X
k,m0
m[k < n]
¬£
m 
‚àö
k < m + 1
¬§
=
X
k,m0
m[k < n]
¬£
m2  k < (m + 1)2¬§
=
X
k,m0
m
¬£
m2  k < (m + 1)2  n
¬§
+
X
k,m0
m
¬£
m2  k < n < (m + 1)2¬§
.
Once again the boundary conditions are a bit delicate. Let's assume rst that
n = a2 is a perfect square. Then the second sum is zero, and the rst can be
evaluated by our usual routine:
Falling powers
make the sum come
tumbling down.
X
k,m0
m
¬£
m2  k < (m + 1)2  a2¬§
=
X
m0
m
¬°
(m + 1)2 ‚àím2¬¢
[m + 1  a]
=
X
m0
m(2m + 1)[m < a]
=
X
m0
(2m2 + 3m1)[m < a]
=
Xa
0 (2m2 + 3m1) Œ¥m
=
2
3a(a ‚àí1)(a ‚àí2) + 3
2a(a ‚àí1) =
1
6(4a + 1)a(a ‚àí1) .

3.5 FLOOR/CEILING SUMS
87
In the general case we can let a = ‚åä‚àön‚åã; then we merely need to add the
terms for a2  k < n, which are all equal to a, so they sum to (n ‚àía2)a.
This gives the desired closed form,
X
0k<n
‚åä
‚àö
k‚åã= na ‚àí1
3a3 ‚àí1
2a2 ‚àí1
6a ,
a = ‚åä‚àön‚åã.
(3.27)
Another approach to such sums is to replace an expression of the form
‚åäx‚åãby P
j[1  j  x]; this is legal whenever x  0. Here's how that method
works in the sum of ‚åäsquare roots‚åã, if we assume for convenience that n = a2:
X
0k<n
‚åä
‚àö
k‚åã=
X
j,k
[1  j 
‚àö
k ][0  k < a2]
=
X
1j<a
X
k
[j2  k < a2]
=
X
1j<a
(a2 ‚àíj2) = a3 ‚àí1
3a(a + 1
2)(a + 1) .
Now here's another example where a change of variable leads to a trans-
formed sum. A remarkable theorem was discovered independently by three
mathematicians | Bohl [34], Sierpinski [326], and Weyl [368] | at about the
same time in 1909: If Œ± is irrational then the fractional parts fnŒ±g are very uni-
formly distributed between 0 and 1, as n ‚Üí‚àû. One way to state this is that
lim
n‚Üí‚àû
1
n
X
0k<n
f
¬°
fkŒ±g
¬¢
=
Z 1
0
f(x) dx
(3.28)
for all irrational Œ± and all functions f that are continuous almost everywhere.
For example, the average value of fnŒ±g can be found by setting f(x) = x; we
get 1
2. (That's exactly what we might expect; but it's nice to know that it is
really, provably true, no matter how irrational Œ± is.)
The theorem of Bohl, Sierpinski, and Weyl is proved by approximating
f(x) above and below by \step functions," which are linear combinations of
Warning: This stu
is fairly advanced.
Better skim the
next two pages on
rst reading; they
aren't crucial.
|Friendly TA
?
Start
Skimming
the simple functions
fv(x) = [0  x < v]
when 0  v  1. Our purpose here is not to prove the theorem; that's a job
for calculus books. But let's try to gure out the basic reason why it holds,
by seeing how well it works in the special case f(x) = fv(x). In other words,
let's try to see how close the sum
X
0k<n
¬£
fkŒ±g < v
¬§
gets to the \ideal" value nv, when n is large and Œ± is irrational.

88
INTEGER FUNCTIONS
For this purpose we dene the discrepancy D(Œ±, n) to be the maximum
absolute value, over all 0  v  1, of the sum
s(Œ±, n, v) =
X
0k<n
¬≥¬£
fkŒ±g < v
¬§
‚àív
¬¥
.
(3.29)
Our goal is to show that D(Œ±, n) is \not too large" when compared with n,
by showing that js(Œ±, n, v)j is always reasonably small when Œ± is irrational.
First we can rewrite s(Œ±, n, v) in simpler form, then introduce a new
index variable j:
X
0k<n
¬≥¬£
fkŒ±g < v
¬§
‚àív
¬¥
=
X
0k<n
¬°
‚åäkŒ±‚åã‚àí‚åäkŒ± ‚àív‚åã‚àív
¬¢
= ‚àínv +
X
0k<n
X
j
[kŒ± ‚àív < j  kŒ±]
= ‚àínv +
X
0j<‚åànŒ±‚åâ
X
k<n
¬£
jŒ±‚àí1  k < (j + v)Œ±‚àí1¬§
.
If we're lucky, we can do the sum on k. But we ought to introduce some
new variables, so that the formula won't be such a mess. Without loss of
generality, we can assume that 0 < Œ± < 1; let us write
Right, name and
conquer.
The change of vari-
able from k to j is
the main point.
|Friendly TA
a = ‚åäŒ±‚àí1‚åã,
Œ±‚àí1 = a + Œ±‚Ä≤ ;
b = ‚åàvŒ±‚àí1‚åâ,
vŒ±‚àí1 = b ‚àív‚Ä≤ .
Thus Œ±‚Ä≤ = fŒ±‚àí1g is the fractional part of Œ±‚àí1, and v‚Ä≤ is the mumble-fractional
part of vŒ±‚àí1.
Once again the boundary conditions are our only source of grief. For
now, let's forget the restriction `k < n' and evaluate the sum on k without it:
X
k
h
k ‚àà
¬£
jŒ±‚àí1 . . (j + v)Œ±‚àí1¬¢i
=
¬ß
(j + v)(a + Œ±‚Ä≤)
¬®
‚àí
¬ß
j(a + Œ±‚Ä≤)
¬®
= b + ‚åàjŒ±‚Ä≤‚àív‚Ä≤ ‚åâ‚àí‚åàjŒ±‚Ä≤ ‚åâ.
OK, that's pretty simple; we plug it in and plug away:
s(Œ±, n, v) = ‚àínv + ‚åànŒ±‚åâb +
X
0j<‚åànŒ±‚åâ
¬°
‚åàjŒ±‚Ä≤‚àív‚Ä≤ ‚åâ‚àí‚åàjŒ±‚Ä≤ ‚åâ
¬¢
‚àíS ,
(3.30)
where S is a correction for the cases with k  n that we have failed to exclude.
The quantity jŒ±‚Ä≤ will never be an integer, since Œ± (hence Œ±‚Ä≤) is irrational; and
jŒ±‚Ä≤ ‚àív‚Ä≤ will be an integer for at most one value of j. So we can change the

3.5 FLOOR/CEILING SUMS
89
ceiling terms to oors:
s(Œ±, n, v) = ‚àínv + ‚åànŒ±‚åâb ‚àí
X
0j<‚åànŒ±‚åâ
¬°
‚åäjŒ±‚Ä≤‚åã‚àí‚åäjŒ±‚Ä≤‚àív‚Ä≤‚åã
¬¢
‚àíS + f0 or 1g .
Interesting. Instead of a closed form, we're getting a sum that looks rather
(The formula
f 0 or 1g stands
for something that's
either 0 or 1; we
needn't commit
ourselves, because
the details don't
really matter.)
like s(Œ±, n, v) but with dierent parameters: Œ±‚Ä≤ instead of Œ±, ‚åànŒ±‚åâinstead
of n, and v‚Ä≤ instead of v. So we'll have a recurrence for s(Œ±, n, v), which
(hopefully) will lead to a recurrence for the discrepancy D(Œ±, n). This means
we want to get
s(Œ±‚Ä≤, ‚åànŒ±‚åâ, v‚Ä≤) =
X
0j<‚åànŒ±‚åâ
¬°
‚åäjŒ±‚Ä≤‚åã‚àí‚åäjŒ±‚Ä≤ ‚àív‚Ä≤‚åã‚àív‚Ä≤¬¢
into the act:
s(Œ±, n, v) = ‚àínv + ‚åànŒ±‚åâb ‚àí‚åànŒ±‚åâv‚Ä≤ ‚àís(Œ±‚Ä≤, ‚åànŒ±‚åâ, v‚Ä≤) ‚àíS + f0 or 1g .
Recalling that b ‚àív‚Ä≤ = vŒ±‚àí1, we see that everything will simplify beautifully
if we replace ‚åànŒ±‚åâ(b ‚àív‚Ä≤) by nŒ±(b ‚àív‚Ä≤) = nv:
s(Œ±, n, v) = ‚àís(Œ±‚Ä≤, ‚åànŒ±‚åâ, v‚Ä≤) ‚àíS + œµ + f0 or 1g .
Here œµ is a positive error of at most vŒ±‚àí1. Exercise 18 proves that S is, simi-
larly, between 0 and ‚åàvŒ±‚àí1‚åâ. And we can remove the term for j = ‚åànŒ±‚åâ‚àí1 =
‚åänŒ±‚åãfrom the sum, since it contributes either v‚Ä≤ or v‚Ä≤ ‚àí1. Hence, if we take
the maximum of absolute values over all v, we get
D(Œ±, n)  D(Œ±‚Ä≤, ‚åäŒ±n‚åã) + Œ±‚àí1 + 2 .
(3.31)
The methods we'll learn in succeeding chapters will allow us to conclude
from this recurrence that D(Œ±, n) is always much smaller than n, when n is
suciently large. Hence the theorem (3.28) is not only true, it can also be
strengthened: Convergence to the limit is very fast.
Whew; that was quite an exercise in manipulation of sums, oors, and
ceilings. Readers who are not accustomed to \proving that errors are small"
might nd it hard to believe that anybody would have the courage to keep
?
Stop
Skimming
going, when faced with such weird-looking sums. But actually, a second look
shows that there's a simple motivating thread running through the whole
calculation. The main idea is that a certain sum s(Œ±, n, v) of n terms can be
reduced to a similar sum of at most ‚åàŒ±n‚åâterms. Everything else cancels out
except for a small residual left over from terms near the boundaries.
Let's take a deep breath now and do one more sum, which is not trivial
but has the great advantage (compared with what we've just been doing) that

90
INTEGER FUNCTIONS
it comes out in closed form so that we can easily check the answer. Our goal
now will be to generalize the sum in (3.26) by nding an expression for
Is this a harder sum
of oors, or a sum
of harder oors?
X
0k<m
¬πnk + x
m
¬∫
,
integer m > 0,
integer n.
Finding a closed form for this sum is tougher than what we've done so far
(except perhaps for the discrepancy problem we just looked at).
But it's
Be forewarned: This
is the beginning of
a pattern, in that
the last part of the
chapter consists
of the solution of
some long, dicult
problem, with little
more motivation
than curiosity.
|Students
Touche. But c'mon,
gang, do you always
need to be told
about applications
before you can get
interested in some-
thing? This sum
arises, for example,
in the study of
random number
generation and
testing. But math-
ematicians looked
at it long before
computers came
along, because they
found it natural to
ask if there's a way
to sum arithmetic
progressions that
have been \oored."
|Your instructor
instructive, so we'll hack away at it for the rest of this chapter.
As usual, especially with tough problems, we start by looking at small
cases. The special case n = 1 is (3.26), with x replaced by x/m:
j x
m
k
+
¬π1 + x
m
¬∫
+ ¬∑ ¬∑ ¬∑ +
¬πm ‚àí1 + x
m
¬∫
= ‚åäx‚åã.
And as in Chapter 1, we nd it useful to get more data by generalizing
downwards to the case n = 0:
j x
m
k
+
j x
m
k
+ ¬∑ ¬∑ ¬∑ +
j x
m
k
= m
j x
m
k
.
Our problem has two parameters, m and n; let's look at some small cases
for m. When m = 1 there's just a single term in the sum and its value is ‚åäx‚åã.
When m = 2 the sum is ‚åäx/2‚åã+ ‚åä(x + n)/2‚åã. We can remove the interaction
between x and n by removing n from inside the oor function, but to do that
we must consider even and odd n separately. If n is even, n/2 is an integer,
so we can remove it from the oor:
jx
2
k
+
¬≥jx
2
k
+ n
2
¬¥
= 2
jx
2
k
+ n
2 .
If n is odd, (n ‚àí1)/2 is an integer so we get
jx
2
k
+
¬µ¬πx + 1
2
¬∫
+ n ‚àí1
2
¬∂
= ‚åäx‚åã+ n ‚àí1
2
.
The last step follows from (3.26) with m = 2.
These formulas for even and odd n slightly resemble those for n = 0 and 1,
but no clear pattern has emerged yet; so we had better continue exploring
some more small cases. For m = 3 the sum is
jx
3
k
+
¬πx + n
3
¬∫
+
¬πx + 2n
3
¬∫
,
and we consider three cases for n: Either it's a multiple of 3, or it's 1 more
than a multiple, or it's 2 more. That is, n mod 3 = 0, 1, or 2. If n mod 3 = 0

3.5 FLOOR/CEILING SUMS
91
then n/3 and 2n/3 are integers, so the sum is
jx
3
k
+
¬≥jx
3
k
+ n
3
¬¥
+
¬µjx
3
k
+ 2n
3
¬∂
= 3
jx
3
k
+ n .
If n mod 3 = 1 then (n ‚àí1)/3 and (2n ‚àí2)/3 are integers, so we have
jx
3
k
+
¬µ¬πx + 1
3
¬∫
+ n ‚àí1
3
¬∂
+
¬µ¬πx + 2
3
¬∫
+ 2n ‚àí2
3
¬∂
= ‚åäx‚åã+ n ‚àí1 .
Again this last step follows from (3.26), this time with m = 3. And nally, if
n mod 3 = 2 then
jx
3
k
+
¬µ¬πx + 2
3
¬∫
+ n ‚àí2
3
¬∂
+
¬µ¬πx + 1
3
¬∫
+ 2n ‚àí1
3
¬∂
= ‚åäx‚åã+ n ‚àí1 .
The left hemispheres of our brains have nished the case m = 3, but the
\Inventive genius
requires pleasurable
mental activity as
a condition for its
vigorous exercise.
`Necessity is the
mother of invention'
is a silly proverb.
`Necessity is the
mother of futile
dodges' is much
nearer to the truth.
The basis of the
growth of modern
invention is science,
and science is al-
most wholly the
outgrowth of plea-
surable intellectual
curiosity."
|A.N. White-
head [371]
right hemispheres still can't recognize the pattern, so we proceed to m = 4:
jx
4
k
+
¬πx + n
4
¬∫
+
¬πx + 2n
4
¬∫
+
¬πx + 3n
4
¬∫
.
At least we know enough by now to consider cases based on n mod m. If
n mod 4 = 0 then
jx
4
k
+
¬≥jx
4
k
+ n
4
¬¥
+
¬µjx
4
k
+ 2n
4
¬∂
+
¬µjx
4
k
+ 3n
4
¬∂
= 4
jx
4
k
+ 3n
2 .
And if n mod 4 = 1,
jx
4
k
+
¬µ¬πx+1
4
¬∫
+ n‚àí1
4
¬∂
+
¬µ¬πx+2
4
¬∫
+ 2n‚àí2
4
¬∂
+
¬µ¬πx+3
4
¬∫
+ 3n‚àí3
4
¬∂
= ‚åäx‚åã+ 3n
2 ‚àí3
2 .
The case n mod 4 = 3 turns out to give the same answer. Finally, in the case
n mod 4 = 2 we get something a bit dierent, and this turns out to be an
important clue to the behavior in general:
jx
4
k
+
¬µ¬πx+2
4
¬∫
+ n‚àí2
4
¬∂
+
¬µjx
4
k
+ 2n
4
¬∂
+
¬µ¬πx+2
4
¬∫
+ 3n‚àí2
4
¬∂
= 2
¬µjx
4
k
+
¬πx + 2
4
¬∫¬∂
+ 3n
2
‚àí1 = 2
jx
2
k
+ 3n
2 ‚àí1 .
This last step simplies something of the form ‚åäy/2‚åã+ ‚åä(y + 1)/2‚åã, which
again is a special case of (3.26).

92
INTEGER FUNCTIONS
To summarize, here's the value of our sum for small m:
m
n mod m = 0
n mod m = 1
n mod m = 2
n mod m = 3
1
¬•
x
¬¶
2
2
jx
2
k
+ n
2
‚åäx‚åã+ n
2 ‚àí1
2
3
3
jx
3
k
+ n
‚åäx‚åã+ n ‚àí1
‚åäx‚åã+ n ‚àí1
4
4
jx
4
k
+ 3n
2
‚åäx‚åã+ 3n
2 ‚àí3
2
2
jx
2
k
+ 3n
2 ‚àí1
‚åäx‚åã+ 3n
2 ‚àí3
2
It looks as if we're getting something of the form
a
j x
a
k
+ bn + c ,
where a, b, and c somehow depend on m and n. Even the myopic among
us can see that b is probably (m ‚àí1)/2. It's harder to discern an expression
for a; but the case n mod 4 = 2 gives us a hint that a is probably gcd(m, n),
the greatest common divisor of m and n. This makes sense because gcd(m, n)
is the factor we remove from m and n when reducing the fraction n/m to
lowest terms, and our sum involves the fraction n/m. (We'll look carefully
at gcd operations in Chapter 4.) The value of c seems more mysterious, but
perhaps it will drop out of our proofs for a and b.
In computing the sum for small m, we've eectively rewritten each term
of the sum as
¬πx + kn
m
¬∫
=
¬πx + kn mod m
m
¬∫
+ kn
m ‚àíkn mod m
m
,
because (kn ‚àíkn mod m)/m is an integer that can be removed from inside
the oor brackets. Thus the original sum can be expanded into the following
tableau:
j x
m
k
+
0
m
‚àí
0 mod m
m
+
¬πx + n mod m
m
¬∫
+
n
m
‚àí
n mod m
m
+
¬πx + 2n mod m
m
¬∫
+
2n
m
‚àí
2n mod m
m
...
...
...
+
¬πx + (m ‚àí1)n mod m
m
¬∫
+ (m ‚àí1)n
m
‚àí(m ‚àí1)n mod m
m
.

3.5 FLOOR/CEILING SUMS
93
When we experimented with small values of m, these three columns led re-
spectively to a‚åäx/a‚åã, bn, and c.
In particular, we can see how b arises. The second column is an arithmetic
progression, whose sum we know | it's the average of the rst and last terms,
times the number of terms:
1
2
¬µ
0 + (m ‚àí1)n
m
¬∂
¬∑ m = (m ‚àí1)n
2
.
So our guess that b = (m ‚àí1)/2 has been veried.
The rst and third columns seem tougher; to determine a and c we must
take a closer look at the sequence of numbers
0 mod m, n mod m, 2n mod m, . . . , (m ‚àí1)n mod m.
Suppose, for example, that m = 12 and n = 5.
If we think of the
sequence as times on a clock, the numbers are 0 o'clock (we take 12 o'clock
to be 0 o'clock), then 5 o'clock, 10 o'clock, 3 o'clock (= 15 o'clock), 8 o'clock,
and so on. It turns out that we hit every hour exactly once.
Now suppose m = 12 and n = 8. The numbers are 0 o'clock, 8 o'clock,
4 o'clock (= 16 o'clock), but then 0, 8, and 4 repeat. Since both 8 and 12 are
multiples of 4, and since the numbers start at 0 (also a multiple of 4), there's
no way to break out of this pattern | they must all be multiples of 4.
In these two cases we have gcd(12, 5) = 1 and gcd(12, 8) = 4. The general
rule, which we will prove next chapter, states that if d = gcd(m, n) then we
Lemma now,
dilemma later.
get the numbers 0, d, 2d, . . . , m ‚àíd in some order, followed by d ‚àí1 more
copies of the same sequence. For example, with m = 12 and n = 8 the pattern
0, 8, 4 occurs four times.
The rst column of our sum now makes complete sense.
It contains
d copies of the terms ‚åäx/m‚åã, ‚åä(x + d)/m‚åã, . . . , ‚åä(x + m ‚àíd)/m‚åã, in some
order, so its sum is
d
¬µj x
m
k
+
¬πx + d
m
¬∫
+ ¬∑ ¬∑ ¬∑ +
¬πx + m ‚àíd
m
¬∫¬∂
= d
¬µ¬π x/d
m/d
¬∫
+
¬πx/d + 1
m/d
¬∫
+ ¬∑ ¬∑ ¬∑ +
¬πx/d + m/d ‚àí1
m/d
¬∫¬∂
= d
j x
d
k
.
This last step is yet another application of (3.26). Our guess for a has been
veried:
a = d = gcd(m, n) .

94
INTEGER FUNCTIONS
Also, as we guessed, we can now compute c, because the third column
has become easy to fathom. It contains d copies of the arithmetic progression
0/m, d/m, 2d/m, . . . , (m ‚àíd)/m, so its sum is
d
√É
1
2
¬µ
0 + m ‚àíd
m
¬∂
¬∑ m
d
!
= m ‚àíd
2
;
the third column is actually subtracted, not added, so we have
c = d ‚àím
2
.
End of mystery, end of quest. The desired closed form is
X
0k<m
¬πnk + x
m
¬∫
= d
j x
d
k
+ m ‚àí1
2
n + d ‚àím
2
,
where d = gcd(m, n). As a check, we can make sure this works in the special
cases n = 0 and n = 1 that we knew before: When n = 0 we get d =
gcd(m, 0) = m; the last two terms of the formula are zero so the formula
properly gives m‚åäx/m‚åã. And for n = 1 we get d = gcd(m, 1) = 1; the last
two terms cancel nicely, and the sum is just ‚åäx‚åã.
By manipulating the closed form a bit, we can actually make it symmetric
in m and n:
X
0k<m
¬πnk + x
m
¬∫
= d
j x
d
k
+ m ‚àí1
2
n + d ‚àím
2
= d
j x
d
k
+ (m ‚àí1)(n ‚àí1)
2
+ m ‚àí1
2
+ d ‚àím
2
= d
j x
d
k
+ (m ‚àí1)(n ‚àí1)
2
+ d ‚àí1
2
.
(3.32)
This is astonishing, because there's no algebraic reason to suspect that such
Yup, I'm oored.
a sum should be symmetrical. We have proved a \reciprocity law,"
X
0k<m
¬πnk + x
m
¬∫
=
X
0k<n
¬πmk + x
n
¬∫
,
integers m, n > 0.
For example, if m = 41 and n = 127, the left sum has 41 terms and the right
has 127; but they still come out equal, for all real x.

3 EXERCISES
95
Exercises
Warmups
1
When we analyzed the Josephus problem in Chapter 1, we represented
an arbitrary positive integer n in the form n = 2m +l, where 0  l < 2m.
Give explicit formulas for l and m as functions of n, using oor and/or
ceiling brackets.
2
What is a formula for the nearest integer to a given real number x? In case
of ties, when x is exactly halfway between two integers, give an expression
that rounds (a) up | that is, to ‚åàx‚åâ; (b) down | that is, to ‚åäx‚åã.
3
Evaluate
¬•
‚åämŒ±‚åãn/Œ±
¬¶
, when m and n are positive integers and Œ± is an
irrational number greater than n.
4
The text describes problems at levels 1 through 5. What is a level 0
problem? (This, by the way, is not a level 0 problem.)
5
Find a necessary and sucient condition that ‚åänx‚åã= n‚åäx‚åã, when n is a
positive integer. (Your condition should involve fxg.)
6
Can something interesting be said about ‚åäf(x)‚åãwhen f(x) is a continuous,
monotonically decreasing function that takes integer values only when
x is an integer?
7
Solve the recurrence
Xn = n ,
for 0  n < m;
Xn = Xn‚àím + 1 ,
for n  m.
8
Prove the Dirichlet box principle: If n objects are put into m boxes,
You know you're
in college when the
book doesn't tell
you how to pro-
nounce `Dirichlet'.
some box must contain  ‚åàn/m‚åâobjects, and some box must contain
 ‚åän/m‚åã.
9
Egyptian mathematicians in 1800 b.c. represented rational numbers be-
tween 0 and 1 as sums of unit fractions 1/x1 + ¬∑ ¬∑ ¬∑ + 1/xk, where the x's
were distinct positive integers. For example, they wrote 1
3 +
1
15 instead
of 2
5. Prove that it is always possible to do this in a systematic way: If
0 < m/n < 1, then
m
n
= 1
q +
¬Ø
representation of m
n ‚àí1
q
¬∞
,
q =
l n
m
m
.
(This is Fibonacci's algorithm, due to Leonardo Fibonacci, a.d. 1202.)

96
INTEGER FUNCTIONS
Basics
10
Show that the expression
¬ª2x + 1
2
¬º
‚àí
¬ª2x + 1
4
¬º
+
¬π2x + 1
4
¬∫
is always either ‚åäx‚åãor ‚åàx‚åâ. In what circumstances does each case arise?
11
Give details of the proof alluded to in the text, that the open interval
(Œ± . . Œ≤) contains exactly ‚åàŒ≤‚åâ‚àí‚åäŒ±‚åã‚àí1 integers when Œ± < Œ≤. Why does
the case Œ± = Œ≤ have to be excluded in order to make the proof correct?
12
Prove that
l n
m
m
=
¬πn + m ‚àí1
m
¬∫
,
for all integers n and all positive integers m.
[This identity gives us
another way to convert ceilings to oors and vice versa, instead of using
the reective law (3.4).]
13
Let Œ± and Œ≤ be positive real numbers. Prove that Spec(Œ±) and Spec(Œ≤)
partition the positive integers if and only if Œ± and Œ≤ are irrational and
1/Œ± + 1/Œ≤ = 1.
14
Prove or disprove:
(x mod ny) mod y = x mod y ,
integer n.
15
Is there an identity analogous to (3.26) that uses ceilings instead of oors?
16
Prove that n mod 2 =
¬°
1‚àí(‚àí1)n¬¢
/2. Find and prove a similar expression
for n mod 3 in the form a+bœân+cœâ2n, where œâ is the complex number
(‚àí1 + i
‚àö
3 )/2. Hint: œâ3 = 1 and 1 + œâ + œâ2 = 0.
17
Evaluate the sum P
0k<m‚åäx + k/m‚åãin the case x  0 by substituting
P
j[1  j  x + k/m] for ‚åäx + k/m‚åãand summing rst on k. Does your
answer agree with (3.26)?
18
Prove that the boundary-value error term S in (3.30) is at most ‚åàŒ±‚àí1v‚åâ.
Hint: Show that small values of j are not involved.
Homework exercises
19
Find a necessary and sucient condition on the real number b > 1 such
that
‚åälogb x‚åã=
¬•
logb‚åäx‚åã
¬¶
for all real x  1.

3 EXERCISES
97
20
Find the sum of all multiples of x in the closed interval [Œ± . . Œ≤], when
x > 0.
21
How many of the numbers 2m, for 0  m  M, have leading digit 1 in
decimal notation?
22
Evaluate the sums Sn = P
k1
¬•
n/2k+ 1
2
¬¶
and Tn = P
k1 2k¬•
n/2k+ 1
2
¬¶2.
23
Show that the nth element of the sequence
1, 2, 2, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 5, . . .
is
¬•‚àö
2n + 1
2
¬¶
. (The sequence contains exactly m occurrences of m.)
24
Exercise 13 establishes an interesting relation between the two multisets
Spec(Œ±) and Spec
¬°
Œ±/(Œ± ‚àí1)
¬¢
, when Œ± is any irrational number > 1,
because 1/Œ± + (Œ± ‚àí1)/Œ± = 1. Find (and prove) an interesting relation
between the two multisets Spec(Œ±) and Spec
¬°
Œ±/(Œ± + 1)
¬¢
, when Œ± is any
positive real number.
25
Prove or disprove that the Knuth numbers, dened by (3.16), satisfy
Kn  n for all nonnegative n.
26
Show that the auxiliary Josephus numbers (3.20) satisfy
¬µ
q
q ‚àí1
¬∂n
 D(q)
n
 q
¬µ
q
q ‚àí1
¬∂n
,
for n  0.
27
Prove that innitely many of the numbers D(3)
n
dened by (3.20) are
even, and that innitely many are odd.
28
Solve the recurrence
a0 = 1 ;
an = an‚àí1 + ‚åä‚àöan‚àí1‚åã,
for n > 0.
29
Show that, in addition to (3.31), we have
There's a discrep-
ancy between this
formula and (3.31).
D(Œ±, n)  D
¬°
Œ±‚Ä≤, ‚åäŒ±n‚åã
¬¢
‚àíŒ±‚àí1 ‚àí2 .
30
Show that the recurrence
X0 = m ,
Xn = X2
n‚àí1 ‚àí2 ,
for n > 0,
has the solution Xn = ‚åàŒ±2n‚åâ, if m is an integer greater than 2, where
Œ± + Œ±‚àí1 = m and Œ± > 1. For example, if m = 3 the solution is
Xn = ‚åàœÜ2n+1 ‚åâ,
œÜ = 1 +
‚àö
5
2
,
Œ± = œÜ2 .

98
INTEGER FUNCTIONS
31
Prove or disprove: ‚åäx‚åã+ ‚åäy‚åã+ ‚åäx + y‚åã ‚åä2x‚åã+ ‚åä2y‚åã.
32
Let ‚à•x‚à•= min
¬°
x‚àí‚åäx‚åã, ‚åàx‚åâ‚àíx
¬¢
denote the distance from x to the nearest
integer. What is the value of
X
k
2k¬∞¬∞x/2k¬∞¬∞2 ?
(Note that this sum can be doubly innite. For example, when x = 1/3
the terms are nonzero as k ‚Üí‚àí‚àûand also as k ‚Üí+‚àû.)
Exam problems
33
A circle, 2n ‚àí1 units in diameter, has been drawn symmetrically on a
2n √ó 2n chessboard, illustrated here for n = 3:
'$
&%
a
How many cells of the board contain a segment of the circle?
b
Find a function f(n, k) such that exactly Pn‚àí1
k=1 f(n, k) cells of the
board lie entirely within the circle.
34
Let f(n) = Pn
k=1‚åàlg k‚åâ.
a
Find a closed form for f(n), when n  1.
b
Prove that f(n) = n ‚àí1 + f
¬°
‚åàn/2‚åâ
¬¢
+ f
¬°
‚åän/2‚åã
¬¢
for all n  1.
35
Simplify the formula
¬•
(n + 1)2n!e
¬¶
mod n.
Simplify it, but
don't change the
value.
36
Assuming that n is a nonnegative integer, nd a closed form for the sum
X
1<k<22n
1
2‚åälg k‚åã4‚åälg lg k‚åã.
37
Prove the identity
X
0k<m
¬µjm+k
n
k
‚àí
j k
n
k¬∂
=
¬πm2
n
¬∫
‚àí
¬πmin
¬°
m mod n, (‚àím) mod n
¬¢2
n
¬∫
for all positive integers m and n.
38
Let x1, . . . , xn be real numbers such that the identity
n
X
k=1
‚åämxk‚åã=
¬π
m
X
1kn
xk
¬∫
holds for all positive integers m.
Prove something interesting about
x1, . . . , xn.

3 EXERCISES
99
39
Prove that the double sum P
0klogbx
P
0<j<b‚åà(x + jbk)/bk+1‚åâequals
(b ‚àí1)
¬°
‚åälogb x‚åã+ 1
¬¢
+ ‚åàx‚åâ‚àí1, for every real number x  1 and every
integer b > 1.
40
The spiral function œÉ(n), indicated in the diagram below, maps a non-
negative integer n onto an ordered pair of integers
¬°
x(n), y(n)
¬¢
.
For
example, it maps n = 9 onto the ordered pair (1, 2).
People in the south-
ern hemisphere use
a dierent spiral.
-
x
6
y
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
r
0
1
2
3
4
5
6
7
8
9
6
a
Prove that if m = ‚åä‚àön‚åã,
x(n) = (‚àí1)m¬≥¬°
n ‚àím(m + 1)
¬¢
¬∑
¬£
‚åä2‚àön‚åãis even
¬§
+ ‚åà1
2m‚åâ
¬¥
,
and nd a similar formula for y(n). Hint: Classify the spiral into
segments Wk, Sk, Ek, Nk according as ‚åä2‚àön‚åã= 4k ‚àí2, 4k ‚àí1, 4k,
4k + 1.
b
Prove that, conversely, we can determine n from œÉ(n) by a formula
of the form
n = (2k)2 ¬±
¬°
2k + x(n) + y(n)
¬¢
,
k = max
¬°
jx(n)j, jy(n)j
¬¢
.
Give a rule for when the sign is + and when the sign is ‚àí.
Bonus problems
41
Let f and g be increasing functions such that the sets ff(1), f(2), . . . g and
fg(1), g(2), . . . g partition the positive integers. Suppose that f and g are
related by the condition g(n) = f
¬°
f(n)
¬¢
+ 1 for all n > 0. Prove that
f(n) = ‚åänœÜ‚åãand g(n) = ‚åänœÜ2‚åã, where œÜ = (1 +
‚àö
5 )/2.
42
Do there exist real numbers Œ±, Œ≤, and Œ≥ such that Spec(Œ±), Spec(Œ≤), and
Spec(Œ≥) together partition the set of positive integers?

100 INTEGER FUNCTIONS
43
Find an interesting interpretation of the Knuth numbers, by unfolding
the recurrence (3.16).
44
Show that there are integers a(q)
n
and d(q)
n
such that
a(q)
n
= D(q)
n‚àí1 + d(q)
n
q ‚àí1
= D(q)
n
+ d(q)
n
q
,
for n > 0,
when D(q)
n
is the solution to (3.20). Use this fact to obtain another form
of the solution to the generalized Josephus problem:
Jq(n) = 1 + d(q)
k
+ q(n ‚àía(q)
k ),
for a(q)
k
 n < a(q)
k+1.
45
Extend the trick of exercise 30 to nd a closed-form solution to
Y0 = m ,
Yn = 2Y2
n‚àí1 ‚àí1 ,
for n > 0,
if m is a positive integer.
46
Prove that if n =
¬•¬°‚àö
2
l +
‚àö
2
l‚àí1¬¢
m
¬¶
, where m and l are nonnegative
integers, then
¬•p
2n(n + 1)
¬¶
=
¬•¬°‚àö
2
l+1 +
‚àö
2
l¬¢
m
¬¶
. Use this remarkable
property to nd a closed form solution to the recurrence
L0 = a ,
integer a > 0;
Ln =
¬• p
2Ln‚àí1(Ln‚àí1 + 1)
¬¶
,
for n > 0.
Hint:
¬•p
2n(n + 1)
¬¶
=
¬•‚àö
2(n + 1
2)
¬¶
.
47
The function f(x) is said to be replicative if it satises
f(mx) = f(x) + f
¬≥
x + 1
m
¬¥
+ ¬∑ ¬∑ ¬∑ + f
¬≥
x + m ‚àí1
m
¬¥
for every positive integer m. Find necessary and sucient conditions on
the real number c for the following functions to be replicative:
a
f(x) = x + c.
b
f(x) = [x + c is an integer].
c
f(x) = max
¬°
‚åäx‚åã, c
¬¢
.
d
f(x) = x + c‚åäx‚åã‚àí1
2[x is not an integer].
48
Prove the identity
x3 = 3x
¬•
x‚åäx‚åã
¬¶
+ 3fxg
¬©
x‚åäx‚åã
¬™
+ fxg3 ‚àí3‚åäx‚åã
¬•
x‚åäx‚åã
¬¶
+ ‚åäx‚åã3 ,
and show how to obtain similar formulas for xn when n > 3.

3 EXERCISES 101
49
Find a necessary and sucient condition on the real numbers 0  Œ± < 1
and Œ≤  0 such that we can determine Œ± and Œ≤ from the innite multiset
of values
¬©
‚åänŒ±‚åã+ ‚åänŒ≤‚åã
¬Ø¬Ø n > 0
¬™
.
Research problems
50
Find a necessary and sucient condition on the nonnegative real numbers
Œ± and Œ≤ such that we can determine Œ± and Œ≤ from the innite multiset
of values
¬© ¬•
‚åänŒ±‚åãŒ≤
¬¶ ¬Ø¬Ø n > 0
¬™
.
51
Let x be a real number  œÜ = 1
2(1+
‚àö
5). The solution to the recurrence
Z0(x) = x ,
Zn(x) = Zn‚àí1(x)2 ‚àí1 ,
for n > 0,
can be written Zn(x) =
¬ß
f(x)2n¬®
, if x is an integer, where
f(x) =
lim
n‚Üí‚àûZn(x)1/2n ,
because Zn(x)‚àí1 < f(x)2n < Zn(x) in that case. What other interesting
properties does this function f(x) have?
52
Given nonnegative real numbers Œ± and Œ≤, let
Spec(Œ±; Œ≤) =
¬©
‚åäŒ± + Œ≤‚åã, ‚åä2Œ± + Œ≤‚åã, ‚åä3Œ± + Œ≤‚åã, . . .
¬™
be a multiset that generalizes Spec(Œ±) = Spec(Œ±; 0). Prove or disprove:
Spec this be hard.
If the m  3 multisets Spec(Œ±1; Œ≤1), Spec(Œ±2; Œ≤2), . . . , Spec(Œ±m; Œ≤m)
partition the positive integers, and if the parameters Œ±1 < Œ±2 < ¬∑ ¬∑ ¬∑ < Œ±m
are rational, then
Œ±k = 2m ‚àí1
2k‚àí1
,
for 1  k  m.
53
Fibonacci's algorithm (exercise 9) is \greedy" in the sense that it chooses
the least conceivable q at every step. A more complicated algorithm is
known by which every fraction m/n with n odd can be represented as a
sum of distinct unit fractions 1/q1 + ¬∑ ¬∑ ¬∑ + 1/qk with odd denominators.
Does the greedy algorithm for such a representation always terminate?

4
Number Theory
INTEGERS ARE CENTRAL to the discrete mathematics we are emphasiz-
ing in this book. Therefore we want to explore the theory of numbers, an
important branch of mathematics concerned with the properties of integers.
We tested the number theory waters in the previous chapter, by intro-
ducing binary operations called `mod' and `gcd'. Now let's plunge in and
In other words, be
prepared to drown.
really immerse ourselves in the subject.
4.1
DIVISIBILITY
We say that m divides n (or n is divisible by m) if m > 0 and the
ratio n/m is an integer. This property underlies all of number theory, so it's
convenient to have a special notation for it. We therefore write
mnn
‚áê‚áí
m > 0 and n = mk for some integer k .
(4.1)
(The notation `mjn' is actually much more common than `mnn' in current
mathematics literature.
But vertical lines are overused | for absolute val-
ues, set delimiters, conditional probabilities, etc. | and backward slashes are
underused. Moreover, `mnn' gives an impression that m is the denominator of
an implied ratio. So we shall boldly let our divisibility symbol lean leftward.)
If m does not divide n we write `m//nn'.
There's a similar relation, \n is a multiple of m," which means almost
the same thing except that m doesn't have to be positive. In this case we
simply mean that n = mk for some integer k. Thus, for example, there's only
\. . . no integer is
divisible by ‚àí1
(strictly speaking)."
|Graham, Knuth,
and Patashnik [161]
one multiple of 0 (namely 0), but nothing is divisible by 0. Every integer is
a multiple of ‚àí1, but no integer is divisible by ‚àí1 (strictly speaking). These
denitions apply when m and n are any real numbers; for example, 2œÄ is
divisible by œÄ. But we'll almost always be using them when m and n are
integers. After all, this is number theory.
102

4.1 DIVISIBILITY 103
The greatest common divisor of two integers m and n is the largest
In Britain we call
this `hcf' (highest
common factor).
integer that divides them both:
gcd(m, n) = max f k | knm
and
knn g .
(4.2)
For example, gcd(12, 18) = 6.
This is a familiar notion, because it's the
common factor that fourth graders learn to take out of a fraction m/n when
reducing it to lowest terms: 12/18 = (12/6)
¬±
(18/6) = 2/3. Notice that if
n > 0 we have gcd(0, n) = n, because any positive number divides 0, and
because n is the largest divisor of itself. The value of gcd(0, 0) is undened.
Another familiar notion is the least common multiple,
Not to be confused
with the greatest
common multiple.
lcm(m, n) = min f k | k > 0,
mnk
and
nnk g ;
(4.3)
this is undened if m  0 or n  0. Students of arithmetic recognize this
as the least common denominator, which is used when adding fractions with
denominators m and n. For example, lcm(12, 18) = 36, and fourth graders
know that
7
12 +
1
18 = 21
36 +
2
36 = 23
36. The lcm is somewhat analogous to the
gcd, but we don't give it equal time because the gcd has nicer properties.
One of the nicest properties of the gcd is that it is easy to compute, using
a 2300-year-old method called Euclid's algorithm. To calculate gcd(m, n),
for given values 0  m < n, Euclid's algorithm uses the recurrence
gcd(0, n) = n ;
gcd(m, n) = gcd(n mod m, m) ,
for m > 0.
(4.4)
Thus, for example, gcd(12, 18) = gcd(6, 12) = gcd(0, 6) = 6.
The stated
recurrence is valid, because any common divisor of m and n must also be a
common divisor of both m and the number n mod m, which is n ‚àí‚åän/m‚åãm.
There doesn't seem to be any recurrence for lcm(m, n) that's anywhere near
as simple as this. (See exercise 2.)
Euclid's algorithm also gives us more: We can extend it so that it will
compute integers m‚Ä≤ and n‚Ä≤ satisfying
m‚Ä≤m + n‚Ä≤n = gcd(m, n) .
(4.5)
Here's how. If m = 0, we simply take m‚Ä≤ = 0 and n‚Ä≤ = 1. Otherwise we
(Remember that
m‚Ä≤ or n‚Ä≤ can be
negative.)
let r = n mod m and apply the method recursively with r and m in place of
m and n, computing r and m such that
r r + m m = gcd(r, m) .
Since r = n ‚àí‚åän/m‚åãm and gcd(r, m) = gcd(m, n), this equation tells us that
r
¬°
n ‚àí‚åän/m‚åãm
¬¢
+ m m = gcd(m, n) .

104 NUMBER THEORY
The left side can be rewritten to show its dependency on m and n:
¬°
m ‚àí‚åän/m‚åãr
¬¢
m + r n = gcd(m, n) ;
hence m‚Ä≤ = m ‚àí‚åän/m‚åãr and n‚Ä≤ = r are the integers we need in (4.5). For
example, in our favorite case m = 12, n = 18, this method gives 6 = 0¬∑0+1¬∑6 =
1¬∑6 + 0¬∑12 = (‚àí1)¬∑12 + 1¬∑18.
But why is (4.5) such a neat result? The main reason is that there's a
sense in which the numbers m‚Ä≤ and n‚Ä≤ actually prove that Euclid's algorithm
has produced the correct answer in any particular case. Let's suppose that
our computer has told us after a lengthy calculation that gcd(m, n) = d and
that m‚Ä≤m + n‚Ä≤n = d; but we're skeptical and think that there's really a
greater common divisor, which the machine has somehow overlooked. This
cannot be, however, because any common divisor of m and n has to divide
m‚Ä≤m + n‚Ä≤n; so it has to divide d; so it has to be  d. Furthermore we can
easily check that d does divide both m and n. (Algorithms that output their
own proofs of correctness are called self-certifying.)
We'll be using (4.5) a lot in the rest of this chapter. One of its important
consequences is the following mini-theorem:
knm
and
knn
‚áê‚áí
kn gcd(m, n) .
(4.6)
(Proof: If k divides both m and n, it divides m‚Ä≤m + n‚Ä≤n, so it divides
gcd(m, n). Conversely, if k divides gcd(m, n), it divides a divisor of m and a
divisor of n, so it divides both m and n.) We always knew that any common
divisor of m and n must be less than or equal to their gcd; that's the
denition of greatest common divisor. But now we know that any common
divisor is, in fact, a divisor of their gcd.
Sometimes we need to do sums over all divisors of n. In this case it's
often useful to use the handy rule
X
mnn
am =
X
mnn
an/m ,
integer n > 0,
(4.7)
which holds since n/m runs through all divisors of n when m does.
For
example, when n = 12 this says that a1 + a2 + a3 + a4 + a6 + a12 = a12 +
a6 + a4 + a3 + a2 + a1.
There's also a slightly more general identity,
X
mnn
am =
X
k
X
m>0
am[n = mk] ,
(4.8)
which is an immediate consequence of the denition (4.1). If n is positive, the
right-hand side of (4.8) is P
knn an/k; hence (4.8) implies (4.7). And equation

4.1 DIVISIBILITY 105
(4.8) works also when n is negative. (In such cases, the nonzero terms on the
right occur when k is the negative of a divisor of n.)
Moreover, a double sum over divisors can be \interchanged" by the law
X
mnn
X
knm
ak,m =
X
knn
X
ln(n/k)
ak,kl .
(4.9)
For example, this law takes the following form when n = 12:
a1,1 + (a1,2 + a2,2) + (a1,3 + a3,3)
+ (a1,4 + a2,4 + a4,4) + (a1,6 + a2,6 + a3,6 + a6,6)
+ (a1,12 + a2,12 + a3,12 + a4,12 + a6,12 + a12,12)
= (a1,1 + a1,2 + a1,3 + a1,4 + a1,6 + a1,12)
+ (a2,2 + a2,4 + a2,6 + a2,12) + (a3,3 + a3,6 + a3,12)
+ (a4,4 + a4,12) + (a6,6 + a6,12) + a12,12 .
We can prove (4.9) with Iversonian manipulation. The left-hand side is
X
j,l
X
k,m>0
ak,m[n = jm][m = kl] =
X
j
X
k,l>0
ak,kl[n = jkl] ;
the right-hand side is
X
j,m
X
k,l>0
ak,kl[n = jk][n/k = ml] =
X
m
X
k,l>0
ak,kl[n = mlk] ,
which is the same except for renaming the indices. This example indicates
that the techniques we've learned in Chapter 2 will come in handy as we study
number theory.
4.2
PRIMES
A positive integer p is called prime if it has just two divisors, namely
1 and p. Throughout the rest of this chapter, the letter p will always stand
for a prime number, even when we don't say so explicitly. By convention,
How about the p in
`explicitly'?
1 isn't prime, so the sequence of primes starts out like this:
2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, . . . .
Some numbers look prime but aren't, like 91 (= 7¬∑13) and 161 (= 7¬∑23). These
numbers and others that have three or more divisors are called composite.
Every integer greater than 1 is either prime or composite, but not both.
Primes are of great importance, because they're the fundamental building
blocks of all the positive integers. Any positive integer n can be written as a

106 NUMBER THEORY
product of primes,
n = p1 . . . pm =
m
Y
k=1
pk ,
p1  ¬∑ ¬∑ ¬∑  pm .
(4.10)
For example, 12 = 2¬∑2¬∑3; 11011 = 7¬∑11¬∑11¬∑13; 11111 = 41¬∑271. (Products
denoted by Q are analogous to sums denoted by P, as explained in exer-
cise 2.25. If m = 0, we consider this to be an empty product, whose value
is 1 by denition; that's the way n = 1 gets represented by (4.10).) Such a
factorization is always possible because if n > 1 is not prime it has a divisor
n1 such that 1 < n1 < n; thus we can write n = n1 ¬∑n2, and (by induction)
we know that n1 and n2 can be written as products of primes.
Moreover, the expansion in (4.10) is unique: There's only one way to
write n as a product of primes in nondecreasing order. This statement is
called the Fundamental Theorem of Arithmetic, and it seems so obvious that
we might wonder why it needs to be proved. How could there be two dierent
sets of primes with the same product? Well, there can't, but the reason isn't
simply \by denition of prime numbers." For example, if we consider the set
of all real numbers of the form m + n
‚àö
10 when m and n are integers, the
product of any two such numbers is again of the same form, and we can call
such a number \prime" if it can't be factored in a nontrivial way. The number
6 has two representations, 2¬∑3 = (4 +
‚àö
10 )(4 ‚àí
‚àö
10 ); yet exercise 36 shows
that 2, 3, 4 +
‚àö
10, and 4 ‚àí
‚àö
10 are all \prime" in this system.
Therefore we should prove rigorously that (4.10) is unique.
There is
certainly only one possibility when n = 1, since the product must be empty
in that case; so let's suppose that n > 1 and that all smaller numbers factor
uniquely. Suppose we have two factorizations
n = p1 . . . pm = q1 . . . qk ,
p1 ¬∑ ¬∑ ¬∑ pm
and
q1 ¬∑ ¬∑ ¬∑ qk ,
where the p's and q's are all prime. We will prove that p1 = q1. If not, we
can assume that p1 < q1, making p1 smaller than all the q's. Since p1 and
q1 are prime, their gcd must be 1; hence Euclid's self-certifying algorithm
gives us integers a and b such that ap1 + bq1 = 1. Therefore
ap1q2 . . . qk + bq1q2 . . . qk = q2 . . . qk .
Now p1 divides both terms on the left, since q1q2 . . . qk = n; hence p1 divides
the right-hand side, q2 . . . qk. Thus q2 . . . qk/p1 is an integer, and q2 . . . qk
has a prime factorization in which p1 appears. But q2 . . . qk < n, so it has a
unique factorization (by induction). This contradiction shows that p1 must
be equal to q1 after all. Therefore we can divide both of n's factorizations by
p1, obtaining p2 . . . pm = q2 . . . qk < n. The other factors must likewise be
equal (by induction), so our proof of uniqueness is complete.

4.2 PRIMES 107
Sometimes it's more useful to state the Fundamental Theorem in another
It's the factor-
ization, not the
theorem, that's
unique.
way: Every positive integer can be written uniquely in the form
n
=
Y
p
pnp ,
where each np  0.
(4.11)
The right-hand side is a product over innitely many primes; but for any
particular n all but a few exponents are zero, so the corresponding factors
are 1. Therefore it's really a nite product, just as many \innite" sums are
really nite because their terms are mostly zero.
Formula (4.11) represents n uniquely, so we can think of the sequence
‚ü®n2, n3, n5, . . . ‚ü©as a number system for positive integers. For example, the
prime-exponent representation of 12 is ‚ü®2, 1, 0, 0, . . . ‚ü©and the prime-exponent
representation of 18 is ‚ü®1, 2, 0, 0, . . . ‚ü©. To multiply two numbers, we simply
add their representations. In other words,
k = mn
‚áê‚áí
kp = mp + np
for all p.
(4.12)
This implies that
mnn
‚áê‚áí
mp  np
for all p,
(4.13)
and it follows immediately that
k = gcd(m, n)
‚áê‚áí
kp = min(mp, np)
for all p;
(4.14)
k = lcm(m, n)
‚áê‚áí
kp = max(mp, np)
for all p.
(4.15)
For example, since 12 = 22 ¬∑31 and 18 = 21 ¬∑32, we can get their gcd and lcm
by taking the min and max of common exponents:
gcd(12, 18) = 2min(2,1) ¬∑ 3min(1,2) = 21 ¬∑31 = 6 ;
lcm(12, 18) = 2max(2,1) ¬∑ 3max(1,2) = 22 ¬∑32 = 36 .
If the prime p divides a product mn then it divides either m or n, perhaps
both, because of the unique factorization theorem. But composite numbers
do not have this property. For example, the nonprime 4 divides 60 = 6¬∑10,
but it divides neither 6 nor 10. The reason is simple: In the factorization
60 = 6 ¬∑ 10 = (2 ¬∑ 3)(2 ¬∑ 5), the two prime factors of 4 = 2 ¬∑ 2 have been split
into two parts, hence 4 divides neither part. But a prime is unsplittable, so
it must divide one of the original factors.
4.3
PRIME EXAMPLES
How many primes are there? A lot. In fact, innitely many. Euclid
proved this long ago in his Theorem 9 : 20, as follows. Suppose there were only

108 NUMBER THEORY
nitely many primes, say k of them | 2, 3, 5, . . . , Pk. Then, said Euclid, we
should consider the number
\O`Œπ œÄœÅ~œâœÑoŒπ
'Œ±œÅŒπŒ∏¬µoŒπ œÄŒªœµŒπoœÖœÇ
œµ'ŒπœÉŒπ œÄŒ±ŒΩœÑoœÇ œÑo~œÖ
œÄœÅoœÑœµŒ∏œµŒΩœÑoœÇ
œÄŒªŒ∑Œ∏oœÖœÇ œÄœÅœâœÑœâŒΩ
'Œ±œÅŒπŒ∏¬µ~œâŒΩ."
|Euclid [98]
[Translation:
\There are more
primes than in
any given set
of primes."]
M = 2 ¬∑ 3 ¬∑ 5 ¬∑ . . . ¬∑ Pk
+ 1 .
None of the k primes can divide M, because each divides M ‚àí1. Thus there
must be some other prime that divides M; perhaps M itself is prime. This
contradicts our assumption that 2, 3, . . . , Pk are the only primes, so there
must indeed be innitely many.
Euclid's proof suggests that we dene Euclid numbers by the recurrence
en = e1e2 . . . en‚àí1 + 1 ,
when n  1.
(4.16)
The sequence starts out
e1 = 1 + 1 = 2 ;
e2 = 2 + 1 = 3 ;
e3 = 2¬∑3 + 1 = 7 ;
e4 = 2¬∑3¬∑7 + 1 = 43 ;
these are all prime. But the next case, e5, is 1807 = 13¬∑139. It turns out that
e6 = 3263443 is prime, while
e7 = 547¬∑607¬∑1033¬∑31051 ;
e8 = 29881¬∑67003¬∑9119521¬∑6212157481 .
It is known that e9, . . . , e17 are composite, and the remaining en are probably
composite as well. However, the Euclid numbers are all relatively prime to
each other; that is,
gcd(em, en) = 1 ,
when m Ã∏= n.
Euclid's algorithm (what else?) tells us this in three short steps, because
en mod em = 1 when n > m:
gcd(em, en) = gcd(1, em) = gcd(0, 1) = 1 .
Therefore, if we let qj be the smallest factor of ej for all j  1, the primes q1,
q2, q3, . . . are all dierent. This is a sequence of innitely many primes.
Let's pause to consider the Euclid numbers from the standpoint of Chap-
ter 1. Can we express en in closed form? Recurrence (4.16) can be simplied
by removing the three dots: If n > 1 we have
en = e1 . . . en‚àí2en‚àí1 + 1 = (en‚àí1 ‚àí1)en‚àí1 + 1 = e2
n‚àí1 ‚àíen‚àí1 + 1 .

4.3 PRIME EXAMPLES 109
Thus en has about twice as many decimal digits as en‚àí1. Exercise 37 proves
that there's a constant E ‚âà1.264 such that
en =
¬•
E2n + 1
2
¬¶
.
(4.17)
And exercise 60 provides a similar formula that gives nothing but primes:
pn =
¬•
P3n¬¶
,
(4.18)
for some constant P. But equations like (4.17) and (4.18) cannot really be
considered to be in closed form, because the constants E and P are computed
from the numbers en and pn in a sort of sneaky way. No independent re-
lation is known (or likely) that would connect them with other constants of
mathematical interest.
Indeed, nobody knows any useful formula that gives arbitrarily large
primes but only primes. Computer scientists at Chevron Geosciences did,
however, strike mathematical oil in 1984.
Using a program developed by
David Slowinski, they discovered the largest prime known at that time,
2216091 ‚àí1 ,
while testing a new Cray X-MP supercomputer. It's easy to compute this
number in a few milliseconds on a personal computer, because modern com-
puters work in binary notation and this number is simply (11 . . . 1)2.
All
216,091 of its bits are `1'. But it's much harder to prove that this number
is prime. In fact, just about any computation with it takes a lot of time,
because it's so large. For example, even a sophisticated algorithm requires
several minutes just to convert 2216091 ‚àí1 to radix 10 on a PC. When printed
out, its 65,050 decimal digits require 75 cents U.S. postage to mail rst class.
Or probably more,
by the time you
read this.
Incidentally, 2216091 ‚àí1 is the number of moves necessary to solve the
Tower of Hanoi problem when there are 216,091 disks. Numbers of the form
2p ‚àí1
(where p is prime, as always in this chapter) are called Mersenne numbers,
after Father Marin Mersenne who investigated some of their properties in
the seventeenth century [269]. . The Mersenne primes known to date occur
for p = 2, 3, 5, 7, 13, 17, 19, 31, 61, 89, 107, 127, 521, 607, 1279, 2203,
2281, 3217, 4253, 4423, 9689, 9941, 11213, 19937, 21701, 23209, 44497, 86243,
110503, 132049, 216091, and 756839.
The number 2n ‚àí1 can't possibly be prime if n is composite, because
2km ‚àí1 has 2m ‚àí1 as a factor:
2km ‚àí1 = (2m ‚àí1)(2m(k‚àí1) + 2m(k‚àí2) + ¬∑ ¬∑ ¬∑ + 1) .

110 NUMBER THEORY
But 2p ‚àí1 isn't always prime when p is prime; 211 ‚àí1 = 2047 = 23¬∑89 is the
smallest such nonprime. (Mersenne knew this.)
Factoring and primality testing of large numbers are hot topics nowadays.
A summary of what was known up to 1981 appears in Section 4.5.4 of [208],
and many new results continue to be discovered. Pages 391{394 of that book
explain a special way to test Mersenne numbers for primality.
For most of the last two hundred years, the largest known prime has
been a Mersenne prime, although only 31 Mersenne primes are known. Many
people are trying to nd larger ones, but it's getting tough. So those really
interested in fame (if not fortune) and a spot in The Guinness Book of World
Records might instead try numbers of the form 2nk + 1, for small values of k
like 3 or 5. These numbers can be tested for primality almost as quickly as
Mersenne numbers can; exercise 4.5.4{27 of [208] gives the details.
We haven't fully answered our original question about how many primes
there are. There are innitely many, but some innite sets are \denser" than
others. For instance, among the positive integers there are innitely many
even numbers and innitely many perfect squares, yet in several important
senses there are more even numbers than perfect squares. One such sense
Weird. I thought
there were the same
number of even
integers as per-
fect squares, since
there's a one-to-one
correspondence
between them.
looks at the size of the nth value. The nth even integer is 2n and the nth
perfect square is n2; since 2n is much less than n2 for large n, the nth even
integer occurs much sooner than the nth perfect square, so we can say there
are many more even integers than perfect squares. A similar sense looks at
the number of values not exceeding x. There are ‚åäx/2‚åãsuch even integers and
‚åä‚àöx‚åãperfect squares; since x/2 is much larger than ‚àöx for large x, again we
can say there are many more even integers.
What can we say about the primes in these two senses? It turns out that
the nth prime, Pn, is about n times the natural log of n:
Pn ‚àºn ln n .
(The symbol `‚àº' can be read \is asymptotic to"; it means that the limit of
the ratio Pn/n ln n is 1 as n goes to innity.) Similarly, for the number of
primes œÄ(x) not exceeding x we have what's known as the prime number
theorem:
œÄ(x) ‚àº
x
ln x .
Proving these two facts is beyond the scope of this book, although we can
show easily that each of them implies the other. In Chapter 9 we will discuss
the rates at which functions approach innity, and we'll see that the func-
tion n ln n, our approximation to Pn, lies between 2n and n2 asymptotically.
Hence there are fewer primes than even integers, but there are more primes
than perfect squares.

4.3 PRIME EXAMPLES 111
These formulas, which hold only in the limit as n or x ‚Üí‚àû, can be
replaced by more exact estimates. For example, Rosser and Schoenfeld [312]
have established the handy bounds
ln x ‚àí3
2 <
x
œÄ(x) < ln x ‚àí1
2 ,
for x  67;
(4.19)
n
¬°
ln n + ln ln n ‚àí3
2
¬¢
< Pn < n
¬°
ln n + ln ln n ‚àí1
2
¬¢
, for n  20.
(4.20)
If we look at a \random" integer n, the chances of its being prime are
about one in ln n. For example, if we look at numbers near 1016, we'll have to
examine about 16 ln 10 ‚âà36.8 of them before nding a prime. (It turns out
that there are exactly 10 primes between 1016 ‚àí370 and 1016 ‚àí1.) Yet the
distribution of primes has many irregularities. For example, all the numbers
between P1P2 . . . Pn + 2 and P1P2 . . . Pn + Pn+1 ‚àí1 inclusive are composite.
Many examples of \twin primes" p and p + 2 are known (5 and 7, 11 and 13,
17 and 19, 29 and 31, . . . , 9999999999999641 and 9999999999999643, . . . ), yet
nobody knows whether or not there are innitely many pairs of twin primes.
(See Hardy and Wright [181, ¬ß1.4 and ¬ß2.8].)
One simple way to calculate all œÄ(x) primes  x is to form the so-called
sieve of Eratosthenes: First write down all integers from 2 through x. Next
circle 2, marking it prime, and cross out all other multiples of 2. Then repeat-
edly circle the smallest uncircled, uncrossed number and cross out its other
multiples. When everything has been circled or crossed out, the circled num-
bers are the primes. For example when x = 10 we write down 2 through 10,
circle 2, then cross out its multiples 4, 6, 8, and 10. Next 3 is the smallest
uncircled, uncrossed number, so we circle it and cross out 6 and 9.
Now
5 is smallest, so we circle it and cross out 10. Finally we circle 7. The circled
numbers are 2, 3, 5, and 7; so these are the œÄ(10) = 4 primes not exceeding 10.
4.4
FACTORIAL FACTORS
Now let's take a look at the factorization of some interesting highly
composite numbers, the factorials:
\Je me sers de la
notation tres simple
n! pour designer le
produit de nombres
decroissans depuis
n jusqu'a l'unite,
savoir n(n ‚àí1)
(n ‚àí2). . . . 3. 2. 1.
L'emploi continuel
de l'analyse combi-
natoire que je fais
dans la plupart de
mes demonstrations,
a rendu cette nota-
tion indispensable."
|Ch. Kramp [228]
n! = 1¬∑2¬∑. . .¬∑n =
n
Y
k=1
k ,
integer n  0.
(4.21)
According to our convention for an empty product, this denes 0! to be 1.
Thus n! = (n ‚àí1)! n for every positive integer n. This is the number of
permutations of n distinct objects. That is, it's the number of ways to arrange
n things in a row: There are n choices for the rst thing; for each choice of
rst thing, there are n ‚àí1 choices for the second; for each of these n(n ‚àí1)
choices, there are n ‚àí2 for the third; and so on, giving n(n ‚àí1)(n ‚àí2) . . . (1)

112 NUMBER THEORY
arrangements in all. Here are the rst few values of the factorial function.
n
0
1
2
3
4
5
6
7
8
9
10
n!
1
1
2
6
24
120
720
5040
40320
362880
3628800
It's useful to know a few factorial facts, like the rst six or so values, and the
fact that 10! is about 3 1
2 million plus change; another interesting fact is that
the number of digits in n! exceeds n when n  25.
We can prove that n! is plenty big by using something like Gauss's trick
of Chapter 1:
n!2 = (1 ¬∑ 2 ¬∑ . . . ¬∑ n)(n ¬∑ . . . ¬∑ 2 ¬∑ 1) =
n
Y
k=1
k(n + 1 ‚àík) .
We have n  k(n + 1 ‚àík) 
1
4(n + 1)2, since the quadratic polynomial
k(n + 1 ‚àík) = 1
4(n + 1)2 ‚àí
¬°
k ‚àí1
2(n + 1)
¬¢2 has its smallest value at k = 1
and its largest value at k = 1
2(n + 1). Therefore
n
Y
k=1
n  n!2 
n
Y
k=1
(n + 1)2
4
;
that is,
nn/2  n!  (n + 1)n
2n
.
(4.22)
This relation tells us that the factorial function grows exponentially!!
To approximate n! more accurately for large n we can use Stirling's
formula, which we will derive in Chapter 9:
n! ‚àº
‚àö
2œÄn
¬≥n
e
¬¥n
.
(4.23)
And a still more precise approximation tells us the asymptotic relative error:
Stirling's formula undershoots n! by a factor of about 1/(12n). Even for fairly
small n this more precise estimate is pretty good. For example, Stirling's
approximation (4.23) gives a value near 3598696 when n = 10, and this is
about 0.83% ‚âà1/120 too small. Good stu, asymptotics.
But let's get back to primes.
We'd like to determine, for any given
prime p, the largest power of p that divides n!; that is, we want the exponent
of p in n!'s unique factorization. We denote this number by œµp(n!), and we
start our investigations with the small case p = 2 and n = 10. Since 10! is the
product of ten numbers, œµ2(10!) can be found by summing the powers-of-2

4.4 FACTORIAL FACTORS 113
contributions of those ten numbers; this calculation corresponds to summing
the columns of the following array:
1 2 3 4 5 6 7 8 9 10 powers of 2
divisible by 2
x
x
x
x
x
5 = ‚åä10/2‚åã
divisible by 4
x
x
2 = ‚åä10/4‚åã
divisible by 8
x
1 = ‚åä10/8‚åã
powers of 2
0 1 0 2 0 1 0 3 0 1
8
(The column sums form what's sometimes called the ruler function œÅ(k),
A powerful ruler.
because of their similarity to `
', the lengths of lines marking
fractions of an inch.) The sum of these ten sums is 8; hence 28 divides 10!
but 29 doesn't.
There's also another way: We can sum the contributions of the rows.
The rst row marks the numbers that contribute a power of 2 (and thus are
divisible by 2); there are ‚åä10/2‚åã= 5 of them. The second row marks those
that contribute an additional power of 2; there are ‚åä10/4‚åã= 2 of them. And
the third row marks those that contribute yet another; there are ‚åä10/8‚åã= 1 of
them. These account for all contributions, so we have œµ2(10!) = 5+2+1 = 8.
For general n this method gives
œµ2(n!) =
jn
2
k
+
jn
4
k
+
jn
8
k
+ ¬∑ ¬∑ ¬∑ =
X
k1
j n
2k
k
.
This sum is actually nite, since the summand is zero when 2k > n. Therefore
it has only ‚åälg n‚åãnonzero terms, and it's computationally quite easy. For
instance, when n = 100 we have
œµ2(100!) = 50 + 25 + 12 + 6 + 3 + 1 = 97 .
Each term is just the oor of half the previous term. This is true for all n,
because as a special case of (3.11) we have ‚åän/2k+1‚åã=
¬•
‚åän/2k‚åã/2
¬¶
. It's espe-
cially easy to see what's going on here when we write the numbers in binary:
100 = (1100100)2 = 100
‚åä100/2‚åã= (110010)2 = 50
‚åä100/4‚åã=
(11001)2 = 25
‚åä100/8‚åã=
(1100)2 = 12
‚åä100/16‚åã=
(110)2 =
6
‚åä100/32‚åã=
(11)2 =
3
‚åä100/64‚åã=
(1)2 =
1
We merely drop the least signicant bit from one term to get the next.

114 NUMBER THEORY
The binary representation also shows us how to derive another formula,
œµ2(n!) = n ‚àíŒΩ2(n) ,
(4.24)
where ŒΩ2(n) is the number of 1's in the binary representation of n. This
simplication works because each 1 that contributes 2m to the value of n
contributes 2m‚àí1 + 2m‚àí2 + ¬∑ ¬∑ ¬∑ + 20 = 2m ‚àí1 to the value of œµ2(n!).
Generalizing our ndings to an arbitrary prime p, we have
œµp(n!) =
¬πn
p
¬∫
+
¬π n
p2
¬∫
+
¬π n
p3
¬∫
+ ¬∑ ¬∑ ¬∑ =
X
k1
¬π n
pk
¬∫
(4.25)
by the same reasoning as before.
About how large is œµp(n!)? We get an easy (but good) upper bound by
simply removing the oor from the summand and then summing an innite
geometric progression:
œµp(n!) < n
p + n
p2 + n
p3 + ¬∑ ¬∑ ¬∑
= n
p
¬µ
1 + 1
p + 1
p2 + ¬∑ ¬∑ ¬∑
¬∂
= n
p
¬µ
p
p ‚àí1
¬∂
=
n
p ‚àí1 .
For p = 2 and n = 100 this inequality says that 97 < 100. Thus the up-
per bound 100 is not only correct, it's also close to the true value 97. In
fact, the true value n ‚àíŒΩ2(n) is ‚àºn in general, because ŒΩ2(n)  ‚åàlg n‚åâis
asymptotically much smaller than n.
When p = 2 and 3 our formulas give œµ2(n!) ‚àºn and œµ3(n!) ‚àºn/2, so
it seems reasonable that every once in awhile œµ3(n!) should be exactly half
as big as œµ2(n!). For example, this happens when n = 6 and n = 7, because
6! = 24 ¬∑ 32 ¬∑ 5 = 7!/7. But nobody has yet proved that such coincidences
happen innitely often.
The bound on œµp(n!) in turn gives us a bound on pœµp(n!), which is p's
contribution to n!:
pœµp(n!) < pn/(p‚àí1) .
And we can simplify this formula (at the risk of greatly loosening the upper
bound) by noting that p  2p‚àí1; hence pn/(p‚àí1)  (2p‚àí1)n/(p‚àí1) = 2n. In
other words, the contribution that any prime makes to n! is less than 2n.

4.4 FACTORIAL FACTORS 115
We can use this observation to get another proof that there are innitely
many primes. For if there were only the k primes 2, 3, . . . , Pk, then we'd
have n! < (2n)k = 2nk for all n > 1, since each prime can contribute at most
a factor of 2n ‚àí1. But we can easily contradict the inequality n! < 2nk by
choosing n large enough, say n = 22k. Then
n! < 2nk = 222kk = nn/2 ,
contradicting the inequality n!  nn/2 that we derived in (4.22). There are
innitely many primes, still.
We can even beef up this argument to get a crude bound on œÄ(n), the
number of primes not exceeding n. Every such prime contributes a factor of
less than 2n to n!; so, as before,
n! < 2nœÄ(n) .
If we replace n! here by Stirling's approximation (4.23), which is a lower
bound, and take logarithms, we get
nœÄ(n) > n lg(n/e) + 1
2 lg(2œÄn) ;
hence
œÄ(n) > lg(n/e) .
This lower bound is quite weak, compared with the actual value œÄ(n) ‚àº
n/ln n, because log n is much smaller than n/log n when n is large. But we
didn't have to work very hard to get it, and a bound is a bound.
4.5
RELATIVE PRIMALITY
When gcd(m, n) = 1, the integers m and n have no prime factors in
common and we say that they're relatively prime.
This concept is so important in practice, we ought to have a special
notation for it; but alas, number theorists haven't agreed on a very good one
yet. Therefore we cry: Hear us, O Mathematicians of the World! Let
us not wait any longer! We can make many formulas clearer by
adopting a new notation now! Let us agree to write `m ‚ä•n', and
Like perpendicular
lines don't have
a common direc-
tion, perpendicular
numbers don't have
common factors.
to say \m is prime to n," if m and n are relatively prime. In other
words, let us declare that
m ‚ä•n
‚áê‚áí
m, n are integers and gcd(m, n) = 1.
(4.26)

116 NUMBER THEORY
A fraction m/n is in lowest terms if and only if m ‚ä•n.
Since we
reduce fractions to lowest terms by casting out the largest common factor of
numerator and denominator, we suspect that, in general,
m/gcd(m, n)
‚ä•
n/gcd(m, n) ;
(4.27)
and indeed this is true. It follows from a more general law, gcd(km, kn) =
k gcd(m, n), proved in exercise 14.
The ‚ä•relation has a simple formulation when we work with the prime-
exponent representations of numbers, because of the gcd rule (4.14):
m ‚ä•n
‚áê‚áí
min(mp, np) = 0
for all p.
(4.28)
Furthermore, since mp and np are nonnegative, we can rewrite this as
The dot product is
zero, like orthogonal
vectors.
m ‚ä•n
‚áê‚áí
mpnp = 0
for all p.
(4.29)
And now we can prove an important law by which we can split and combine
two ‚ä•relations with the same left-hand side:
k ‚ä•m
and
k ‚ä•n
‚áê‚áí
k ‚ä•mn .
(4.30)
In view of (4.29), this law is another way of saying that kpmp = 0 and
kpnp = 0 if and only if kp(mp + np) = 0, when mp and np are nonnegative.
There's a beautiful way to construct the set of all nonnegative fractions
m/n with m ‚ä•n, called the Stern{Brocot tree because it was discovered
Interesting how
mathematicians
will say \discov-
ered" when abso-
lutely anyone else
would have said
\invented."
independently by Moriz Stern [339], a German mathematician, and Achille
Brocot [40], a French clockmaker. The idea is to start with the two fractions
( 0
1, 1
0) and then to repeat the following operation as many times as desired:
Insert m + m‚Ä≤
n + n‚Ä≤
between two adjacent fractions
m
n and m‚Ä≤
n‚Ä≤ .
The new fraction (m+m‚Ä≤)/(n+n‚Ä≤) is called the mediant of m/n and m‚Ä≤/n‚Ä≤.
For example, the rst step gives us one new entry between 0
1 and 1
0,
0
1, 1
1, 1
0 ;
and the next gives two more:
0
1, 1
2, 1
1, 2
1, 1
0 .
The next gives four more,
0
1, 1
3, 1
2, 2
3, 1
1, 3
2, 2
1, 3
1, 1
0 ;

4.5 RELATIVE PRIMALITY 117
and then we'll get 8, 16, and so on. The entire array can be regarded as an
innite binary tree structure whose top levels look like this:
I guess 1/0 is
innity, \in lowest
terms."
0
1
1
0
p p p p p p p p p p p p p p p p p p
pppppppppppppppppp
1
1
¬©¬©¬©¬©
¬©
HHHH
H
1
2
2
1
¬°¬°
¬°¬°
@@
@@
1
3
2
3
3
2
3
1
¬¢¬¢
¬¢¬¢
¬¢¬¢
¬¢¬¢ AA
AA
AA
AA
1
4
2
5
3
5
3
4
4
3
5
3
5
2
4
1
¬§
¬§
¬§
¬§
¬§
¬§
¬§
¬§ C
C
C
C
C
C
C
C
1
5
2
7
3
8
3
7
4
7
5
8
5
7
4
5
5
4
7
5
8
5
7
4
7
3
8
3
7
2
5
1
Each fraction is m+m ‚Ä≤
n+n ‚Ä≤ , where m
n is the nearest ancestor above and to the left,
and m ‚Ä≤
n ‚Ä≤ is the nearest ancestor above and to the right. (An \ancestor" is a
fraction that's reachable by following the branches upward.) Many patterns
can be observed in this tree.
Why does this construction work? Why, for example, does each mediant
fraction (m + m‚Ä≤)/(n + n‚Ä≤) turn out to be in lowest terms when it appears in
this tree? (If m, m‚Ä≤, n, and n‚Ä≤ were all odd, we'd get even/even; somehow the
Conserve parody.
construction guarantees that fractions with odd numerators and denominators
never appear next to each other.) And why do all possible fractions m/n occur
exactly once? Why can't a particular fraction occur twice, or not at all?
All of these questions have amazingly simple answers, based on the fol-
lowing fundamental fact: If m/n and m‚Ä≤/n‚Ä≤ are consecutive fractions at any
stage of the construction, we have
m‚Ä≤n ‚àímn‚Ä≤ = 1 .
(4.31)
This relation is true initially (1 ¬∑ 1 ‚àí0 ¬∑ 0 = 1); and when we insert a new
mediant (m + m‚Ä≤)/(n + n‚Ä≤), the new cases that need to be checked are
(m + m‚Ä≤)n ‚àím(n + n‚Ä≤) = 1 ;
m‚Ä≤(n + n‚Ä≤) ‚àí(m + m‚Ä≤)n‚Ä≤ = 1 .
Both of these equations are equivalent to the original condition (4.31) that
they replace. Therefore (4.31) is invariant at all stages of the construction.
Furthermore, if m/n < m‚Ä≤/n‚Ä≤ and if all values are nonnegative, it's easy
to verify that
m/n < (m + m‚Ä≤)/(n + n‚Ä≤) < m‚Ä≤/n‚Ä≤ .

118 NUMBER THEORY
A mediant fraction isn't halfway between its progenitors, but it does lie some-
where in between. Therefore the construction preserves order, and we couldn't
possibly get the same fraction in two dierent places.
True, but if you get
a compound frac-
ture you'd better go
see a doctor.
One question still remains. Can any positive fraction a/b with a ‚ä•b
possibly be omitted? The answer is no, because we can conne the construc-
tion to the immediate neighborhood of a/b, and in this region the behavior
is easy to analyze: Initially we have
m
n =
0
1 <
¬° a
b
¬¢
<
1
0 =
m ‚Ä≤
n ‚Ä≤ ,
where we put parentheses around a
b to indicate that it's not really present
yet. Then if at some stage we have
m
n <
¬° a
b
¬¢
<
m ‚Ä≤
n ‚Ä≤ ,
the construction forms (m + m‚Ä≤)/(n + n‚Ä≤) and there are three cases. Either
(m + m‚Ä≤)/(n + n‚Ä≤) = a/b and we win; or (m + m‚Ä≤)/(n + n‚Ä≤) < a/b and we
can set m ‚Üêm + m‚Ä≤, n ‚Üên + n‚Ä≤; or (m + m‚Ä≤)/(n + n‚Ä≤) > a/b and we
can set m‚Ä≤ ‚Üêm + m‚Ä≤, n‚Ä≤ ‚Üên + n‚Ä≤. This process cannot go on indenitely,
because the conditions
a
b ‚àím
n > 0
and
m ‚Ä≤
n ‚Ä≤ ‚àía
b > 0
imply that
an ‚àíbm  1
and
bm‚Ä≤ ‚àían‚Ä≤  1 ;
hence
(m‚Ä≤ + n‚Ä≤)(an ‚àíbm) + (m + n)(bm‚Ä≤ ‚àían‚Ä≤)  m‚Ä≤ + n‚Ä≤ + m + n ;
and this is the same as a + b  m‚Ä≤ + n‚Ä≤ + m + n by (4.31). Either m or n or
m‚Ä≤ or n‚Ä≤ increases at each step, so we must win after at most a + b steps.
The Farey series of order N, denoted by FN, is the set of all reduced
fractions between 0 and 1 whose denominators are N or less, arranged in
increasing order. For example, if N = 6 we have
F6 =
0
1, 1
6, 1
5, 1
4, 1
3, 2
5, 1
2, 3
5, 2
3, 3
4, 4
5, 5
6, 1
1 .
We can obtain FN in general by starting with F1 = 0
1, 1
1 and then inserting
mediants whenever it's possible to do so without getting a denominator that
is too large. We don't miss any fractions in this way, because we know that
the Stern{Brocot construction doesn't miss any, and because a mediant with
denominator  N is never formed from a fraction whose denominator is > N.
(In other words, FN denes a subtree of the Stern{Brocot tree, obtained by

4.5 RELATIVE PRIMALITY 119
pruning o unwanted branches.) It follows that m‚Ä≤n ‚àímn‚Ä≤ = 1 whenever
m/n and m‚Ä≤/n‚Ä≤ are consecutive elements of a Farey series.
This method of construction reveals that FN can be obtained in a simple
way from FN‚àí1: We simply insert the fraction (m + m‚Ä≤)/N between con-
secutive fractions m/n, m‚Ä≤/n‚Ä≤ of FN‚àí1 whose denominators sum to N. For
example, it's easy to obtain F7 from the elements of F6, by inserting 1
7, 2
7,
. . . , 6
7 according to the stated rule:
F7 =
0
1, 1
7, 1
6, 1
5, 1
4, 2
7, 1
3, 2
5, 3
7, 1
2, 4
7, 3
5, 2
3, 5
7, 3
4, 4
5, 5
6, 6
7, 1
1 .
When N is prime, N ‚àí1 new fractions will appear; but otherwise we'll have
fewer than N ‚àí1, because this process generates only numerators that are
relatively prime to N.
Long ago in (4.5) we proved | in dierent words | that whenever m ‚ä•n
and 0 < m  n we can nd integers a and b such that
ma ‚àínb = 1 .
(4.32)
(Actually we said m‚Ä≤m + n‚Ä≤n = gcd(m, n), but we can write 1 for gcd(m, n),
a for m‚Ä≤, and b for ‚àín‚Ä≤.) The Farey series gives us another proof of (4.32),
because we can let b/a be the fraction that precedes m/n in Fn. Thus (4.5)
is just (4.31) again. For example, one solution to 3a ‚àí7b = 1 is a = 5, b = 2,
since 2
5 precedes 3
7 in F7. This construction implies that we can always nd a
solution to (4.32) with 0  b < a < n, if 0 < m  n. Similarly, if 0  n < m
and m ‚ä•n, we can solve (4.32) with 0 < a  b  m by letting a/b be the
fraction that follows n/m in Fm.
Sequences of three consecutive terms in a Farey series have an amazing
property that is proved in exercise 61. But we had better not discuss the
Farey series any further, because the entire Stern{Brocot tree turns out to be
Farey 'nough.
even more interesting.
We can, in fact, regard the Stern{Brocot tree as a number system for
representing rational numbers, because each positive, reduced fraction occurs
exactly once. Let's use the letters L and R to stand for going down to the
left or right branch as we proceed from the root of the tree to a particular
fraction; then a string of L's and R's uniquely identies a place in the tree.
For example, LRRL means that we go left from 1
1 down to 1
2, then right to 2
3,
then right to 3
4, then left to 5
7. We can consider LRRL to be a representation
of 5
7. Every positive fraction gets represented in this way as a unique string
of L's and R's.
Well, actually there's a slight problem: The fraction
1
1 corresponds to
the empty string, and we need a notation for that. Let's agree to call it I,
because that looks something like 1 and it stands for \identity."

120 NUMBER THEORY
This representation raises two natural questions: (1) Given positive inte-
gers m and n with m ‚ä•n, what is the string of L's and R's that corresponds
to m/n? (2) Given a string of L's and R's, what fraction corresponds to it?
Question 2 seems easier, so let's work on it rst. We dene
f(S) = fraction corresponding to S
when S is a string of L's and R's. For example, f(LRRL) = 5
7.
According to the construction, f(S) = (m + m‚Ä≤)/(n + n‚Ä≤) if m/n and
m‚Ä≤/n‚Ä≤ are the closest fractions preceding and following S in the upper levels
of the tree.
Initially m/n = 0/1 and m‚Ä≤/n‚Ä≤ = 1/0; then we successively
replace either m/n or m‚Ä≤/n‚Ä≤ by the mediant (m + m‚Ä≤)/(n + n‚Ä≤) as we move
right or left in the tree, respectively.
How can we capture this behavior in mathematical formulas that are
easy to deal with? A bit of experimentation suggests that the best way is to
maintain a 2 √ó 2 matrix
M(S) =
¬µ
n
n‚Ä≤
m
m‚Ä≤
¬∂
that holds the four quantities involved in the ancestral fractions m/n and
m‚Ä≤/n‚Ä≤ enclosing f(S). We could put the m's on top and the n's on the bot-
tom, fractionwise; but this upside-down arrangement works out more nicely
because we have M(I) =
¬°1 0
0 1
¬¢
when the process starts, and
¬°1 0
0 1
¬¢
is tradition-
ally called the identity matrix I.
A step to the left replaces n‚Ä≤ by n + n‚Ä≤ and m‚Ä≤ by m + m‚Ä≤; hence
M(SL) =
¬µ
n
n + n‚Ä≤
m
m + m‚Ä≤
¬∂
=
¬µ
n
n‚Ä≤
m
m‚Ä≤
¬∂ ¬µ
1
1
0
1
¬∂
= M(S)
¬µ
1
1
0
1
¬∂
.
(This is a special case of the general rule
¬µ
a
b
c
d
¬∂ ¬µ
w
x
y
z
¬∂
=
¬µ
aw + by
ax + bz
cw + dy
cx + dz
¬∂
for multiplying 2 √ó 2 matrices.) Similarly it turns out that
If you're clueless
about matrices,
don't panic; this
book uses them
only here.
M(SR) =
¬µ
n + n‚Ä≤
n‚Ä≤
m + m‚Ä≤
m‚Ä≤
¬∂
= M(S)
¬µ
1
0
1
1
¬∂
.
Therefore if we dene L and R as 2 √ó 2 matrices,
L =
¬µ
1
1
0
1
¬∂
,
R =
¬µ
1
0
1
1
¬∂
,
(4.33)

4.5 RELATIVE PRIMALITY 121
we get the simple formula M(S) = S, by induction on the length of S. Isn't
that nice? (The letters L and R serve dual roles, as matrices and as letters in
the string representation.) For example,
M(LRRL) = LRRL =
¬°1 1
0 1
¬¢¬°1 0
1 1
¬¢¬°1 0
1 1
¬¢¬°1 1
0 1
¬¢
=
¬°2 1
1 1
¬¢¬°1 1
1 2
¬¢
=
¬°3 4
2 3
¬¢
;
the ancestral fractions that enclose LRRL = 5
7 are 2
3 and 3
4. And this con-
struction gives us the answer to Question 2:
f(S) = f
¬µ¬µ
n
n‚Ä≤
m
m‚Ä≤
¬∂¬∂
= m + m‚Ä≤
n + n‚Ä≤ .
(4.34)
How about Question 1? That's easy, now that we understand the fun-
damental connection between tree nodes and 2 √ó 2 matrices. Given a pair of
positive integers m and n, with m ‚ä•n, we can nd the position of m/n in
the Stern{Brocot tree by \binary search" as follows:
S := I ;
while m/n Ã∏= f(S) do
if m/n < f(S) then
¬°
output(L); S := SL
¬¢
else
¬°
output(R); S := SR
¬¢
.
This outputs the desired string of L's and R's.
There's also another way to do the same job, by changing m and n instead
of maintaining the state S. If S is any 2 √ó 2 matrix, we have
f(RS) = f(S) + 1
because RS is like S but with the top row added to the bottom row. (Let's
look at it in slow motion:
S =
¬µ
n
n‚Ä≤
m
m‚Ä≤
¬∂
;
RS =
¬µ
n
n‚Ä≤
m + n
m‚Ä≤ + n‚Ä≤
¬∂
;
hence f(S) = (m+m‚Ä≤)/(n+n‚Ä≤) and f(RS) =
¬°
(m+n)+(m‚Ä≤ +n‚Ä≤)
¬¢
/(n+n‚Ä≤).)
If we carry out the binary search algorithm on a fraction m/n with m > n,
the rst output will be R; hence the subsequent behavior of the algorithm will
have f(S) exactly 1 greater than if we had begun with (m ‚àín)/n instead of
m/n. A similar property holds for L, and we have
m
n
= f(RS)
‚áê‚áí
m ‚àín
n
= f(S) ,
when m > n;
m
n
= f(LS)
‚áê‚áí
m
n ‚àím = f(S) ,
when m < n.

122 NUMBER THEORY
This means that we can transform the binary search algorithm to the following
matrix-free procedure:
while m Ã∏= n do
if m < n then
¬°
output(L); n := n ‚àím
¬¢
else
¬°
output(R); m := m ‚àín
¬¢
.
For example, given m/n = 5/7, we have successively
m = 5
5
3
1
1
n = 7
2
2
2
1
output
L
R
R
L
in the simplied algorithm.
Irrational numbers don't appear in the Stern{Brocot tree, but all the
rational numbers that are \close" to them do. For example, if we try the
binary search algorithm with the number e = 2.71828 . . . , instead of with a
fraction m/n, we'll get an innite string of L's and R's that begins
RRLRRLRLLLLRLRRRRRRLRLLLLLLLLRLR . . . .
We can consider this innite string to be the representation of e in the Stern{
Brocot number system, just as we can represent e as an innite decimal
2.718281828459. . . or as an innite binary fraction (10.101101111110 . . . )2.
Incidentally, it turns out that e's representation has a regular pattern in the
Stern{Brocot system:
e = RL0RLR2LRL4RLR6LRL8RLR10LRL12RL . . . ;
this is equivalent to a special case of something that Euler [105] discovered
when he was 24 years old.
From this representation we can deduce that the fractions
1
1,
R
2
1,
R
3
1,
L
5
2,
R
8
3,
R
11
4 ,
L
19
7 ,
R
30
11,
L
49
18,
L
68
25,
L
87
32,
L
106
39 ,
R
193
71 ,
L
299
110,
R
492
181,
R
685
252,
R
878
323,
R
. . .
are the simplest rational upper and lower approximations to e. For if m/n
does not appear in this list, then some fraction in this list whose numerator
is  m and whose denominator is  n lies between m/n and e. For example,
27
10 is not as simple an approximation as
19
7 = 2.714 . . . , which appears in
the list and is closer to e. We can see this because the Stern{Brocot tree
not only includes all rationals, it includes them in order, and because all
fractions with small numerator and denominator appear above all less simple
ones. Thus,
27
10 = RRLRRLL is less than 19
7 = RRLRRL, which is less than

4.5 RELATIVE PRIMALITY 123
e = RRLRRLR . . . . Excellent approximations can be found in this way. For
example, 1264
465 ‚âà2.718280 agrees with e to six decimal places; we obtained this
fraction from the rst 19 letters of e's Stern{Brocot representation, and the
accuracy is about what we would get with 19 bits of e's binary representation.
We can nd the innite representation of an irrational number Œ± by a
simple modication of the matrix-free binary search procedure:
if Œ± < 1 then
¬°
output(L); Œ± := Œ±/(1 ‚àíŒ±)
¬¢
else
¬°
output(R); Œ± := Œ± ‚àí1
¬¢
.
(These steps are to be repeated innitely many times, or until we get tired.)
If Œ± is rational, the innite representation obtained in this way is the same as
before but with RL‚àûappended at the right of Œ±'s (nite) representation. For
example, if Œ± = 1, we get RLLL . . . , corresponding to the innite sequence of
fractions 1
1, 2
1, 3
2, 4
3, 5
4, . . . , which approach 1 in the limit. This situation is
exactly analogous to ordinary binary notation, if we think of L as 0 and R as 1:
Just as every real number x in [0 . . 1) has an innite binary representation
(.b1b2b3 . . . )2 not ending with all 1's, every real number Œ± in [0 . . ‚àû) has
an innite Stern{Brocot representation B1B2B3 . . . not ending with all R's.
Thus we have a one-to-one order-preserving correspondence between [0 . . 1)
and [0 . . ‚àû) if we let 0 ‚ÜîL and 1 ‚ÜîR.
There's an intimate relationship between Euclid's algorithm and the
Stern{Brocot representations of rationals. Given Œ± = m/n, we get ‚åäm/n‚åã
R's, then
¬•
n/(m mod n)
¬¶
L's, then
¬•
(m mod n)
¬±¬°
n mod (m mod n)
¬¢¬¶
R's,
and so on. These numbers m mod n, n mod (m mod n), . . . are just the val-
ues examined in Euclid's algorithm. (A little fudging is needed at the end
to make sure that there aren't innitely many R's.)
We will explore this
relationship further in Chapter 6.
4.6
'MOD': THE CONGRUENCE RELATION
Modular arithmetic is one of the main tools provided by number
theory. We got a glimpse of it in Chapter 3 when we used the binary operation
\Numerorum congru-
entiam hoc signo,
‚â°, in posterum
denotabimus, mod-
ulum ubi opus erit
in clausulis adiun-
gentes, ‚àí16 ‚â°9
(mod. 5), ‚àí7 ‚â°
15 (mod. 11)."
|C.F. Gauss [142]
`mod', usually as one operation amidst others in an expression. In this chapter
we will use `mod' also with entire equations, for which a slightly dierent
notation is more convenient:
a ‚â°b
(mod m)
‚áê‚áí
a mod m = b mod m .
(4.35)
For example, 9 ‚â°‚àí16 (mod 5), because 9 mod 5 = 4 = (‚àí16) mod 5. The
formula `a ‚â°b (mod m)' can be read \a is congruent to b modulo m." The
denition makes sense when a, b, and m are arbitrary real numbers, but we
almost always use it with integers only.

124 NUMBER THEORY
Since x mod m diers from x by a multiple of m, we can understand
congruences in another way:
a ‚â°b
(mod m)
‚áê‚áí
a ‚àíb is a multiple of m.
(4.36)
For if a mod m = b mod m, then the denition of `mod' in (3.21) tells us
that a ‚àíb = a mod m + km ‚àí(b mod m + lm) = (k ‚àíl)m for some integers
k and l. Conversely if a ‚àíb = km, then a = b if m = 0; otherwise
a mod m = a ‚àí‚åäa/m‚åãm = b + km ‚àí
¬•
(b + km)/m
¬¶
m
= b ‚àí‚åäb/m‚åãm = b mod m .
The characterization of ‚â°in (4.36) is often easier to apply than (4.35). For
example, we have 8 ‚â°23 (mod 5) because 8 ‚àí23 = ‚àí15 is a multiple of 5; we
don't have to compute both 8 mod 5 and 23 mod 5.
The congruence sign ` ‚â°' looks conveniently like ` = ', because congru-
\I feel ne today
modulo a slight
headache."
|The Hacker's
Dictionary [337]
ences are almost like equations. For example, congruence is an equivalence
relation; that is, it satises the reexive law `a ‚â°a', the symmetric law
`a ‚â°b
‚áí
b ‚â°a', and the transitive law `a ‚â°b ‚â°c
‚áí
a ‚â°c'.
All these properties are easy to prove, because any relation `‚â°' that satises
`a ‚â°b ‚áê‚áíf(a) = f(b)' for some function f is an equivalence relation. (In
our case, f(x) = x mod m.) Moreover, we can add and subtract congruent
elements without losing congruence:
a ‚â°b
and
c ‚â°d
=‚áí
a + c ‚â°b + d
(mod m) ;
a ‚â°b
and
c ‚â°d
=‚áí
a ‚àíc ‚â°b ‚àíd
(mod m) .
For if a ‚àíb and c ‚àíd are both multiples of m, so are (a + c) ‚àí(b + d) =
(a ‚àíb) + (c ‚àíd) and (a ‚àíc) ‚àí(b ‚àíd) = (a ‚àíb) ‚àí(c ‚àíd). Incidentally, it
isn't necessary to write `(mod m)' once for every appearance of ` ‚â°'; if the
modulus is constant, we need to name it only once in order to establish the
context. This is one of the great conveniences of congruence notation.
Multiplication works too, provided that we are dealing with integers:
a ‚â°b
and
c ‚â°d
=‚áí
ac ‚â°bd
(mod m) ,
integers b, c.
Proof: ac ‚àíbd = (a ‚àíb)c + b(c ‚àíd). Repeated application of this multipli-
cation property now allows us to take powers:
a ‚â°b
=‚áí
an ‚â°bn
(mod m) ,
integers a, b;
integer n  0.

4.6 'MOD': THE CONGRUENCE RELATION 125
For example, since 2 ‚â°‚àí1 (mod 3), we have 2n ‚â°(‚àí1)n (mod 3); this means
that 2n ‚àí1 is a multiple of 3 if and only if n is even.
Thus, most of the algebraic operations that we customarily do with equa-
tions can also be done with congruences. Most, but not all. The operation
of division is conspicuously absent. If ad ‚â°bd (mod m), we can't always
conclude that a ‚â°b. For example, 3¬∑2 ‚â°5¬∑2 (mod 4), but 3 Ã∏‚â°5.
We can salvage the cancellation property for congruences, however, in
the common case that d and m are relatively prime:
ad ‚â°bd
‚áê‚áí
a ‚â°b
(mod m) ,
(4.37)
integers a, b, d, m and d ‚ä•m.
For example, it's legit to conclude from 15 ‚â°35 (mod m) that 3 ‚â°7 (mod m),
unless the modulus m is a multiple of 5.
To prove this property, we use the extended gcd law (4.5) again, nding
d‚Ä≤ and m‚Ä≤ such that d‚Ä≤d + m‚Ä≤m = 1. Then if ad ‚â°bd we can multiply
both sides of the congruence by d‚Ä≤, obtaining ad‚Ä≤d ‚â°bd‚Ä≤d. Since d‚Ä≤d ‚â°1,
we have ad‚Ä≤d ‚â°a and bd‚Ä≤d ‚â°b; hence a ‚â°b. This proof shows that the
number d‚Ä≤ acts almost like 1/d when congruences are considered (mod m);
therefore we call it the \inverse of d modulo m."
Another way to apply division to congruences is to divide the modulus
as well as the other numbers:
ad ‚â°bd (mod md)
‚áê‚áí
a ‚â°b (mod m) ,
for d Ã∏= 0.
(4.38)
This law holds for all real a, b, d, and m, because it depends only on the
distributive law (a mod m)d = ad mod md: We have a mod m = b mod m
‚áê‚áí(a mod m)d = (b mod m)d ‚áê‚áíad mod md = bd mod md. Thus,
for example, from 3¬∑2 ‚â°5¬∑2 (mod 4) we conclude that 3 ‚â°5 (mod 2).
We can combine (4.37) and (4.38) to get a general law that changes the
modulus as little as possible:
ad ‚â°bd
(mod m)
‚áê‚áí
a ‚â°b
¬≥
mod
m
gcd(d, m)
¬¥
,
integers a, b, d, m.
(4.39)
For we can multiply ad ‚â°bd by d‚Ä≤, where d‚Ä≤d+m‚Ä≤m = gcd(d, m); this gives
the congruence a¬∑gcd(d, m) ‚â°b¬∑gcd(d, m) (mod m), which can be divided
by gcd(d, m).
Let's look a bit further into this idea of changing the modulus. If we
know that a ‚â°b (mod 100), then we also must have a ‚â°b (mod 10), or
modulo any divisor of 100. It's stronger to say that a ‚àíb is a multiple of 100

126 NUMBER THEORY
than to say that it's a multiple of 10. In general,
a ‚â°b
(mod md)
=‚áí
a ‚â°b
(mod m) ,
integer d,
(4.40)
because any multiple of md is a multiple of m.
Conversely, if we know that a ‚â°b with respect to two small moduli, can
Modulitos?
we conclude that a ‚â°b with respect to a larger one? Yes; the rule is
a ‚â°b (mod m)
and
a ‚â°b (mod n)
‚áê‚áí
a ‚â°b
¬°
mod lcm(m, n)
¬¢
,
integers m, n > 0.
(4.41)
For example, if we know that a ‚â°b modulo 12 and 18, we can safely conclude
that a ‚â°b (mod 36). The reason is that if a ‚àíb is a common multiple of m
and n, it is a multiple of lcm(m, n). This follows from the principle of unique
factorization.
The special case m ‚ä•n of this law is extremely important, because
lcm(m, n) = mn when m and n are relatively prime. Therefore we will state
it explicitly:
a ‚â°b (mod mn)
‚áê‚áí
a ‚â°b (mod m) and a ‚â°b (mod n) ,
if m ‚ä•n.
(4.42)
For example, a ‚â°b (mod 100) if and only if a ‚â°b (mod 25) and a ‚â°b
(mod 4). Saying this another way, if we know x mod 25 and x mod 4, then
we have enough facts to determine x mod 100. This is a special case of the
Chinese Remainder Theorem (see exercise 30), so called because it was
discovered by Sun Tsu in China, about a.d. 350.
The moduli m and n in (4.42) can be further decomposed into relatively
prime factors until every distinct prime has been isolated. Therefore
a ‚â°b (mod m)
‚áê‚áí
a ‚â°b (mod pmp) for all p ,
if the prime factorization (4.11) of m is Q
p pmp. Congruences modulo powers
of primes are the building blocks for all congruences modulo integers.
4.7
INDEPENDENT RESIDUES
One of the important applications of congruences is a residue num-
ber system, in which an integer x is represented as a sequence of residues (or
remainders) with respect to moduli that are prime to each other:
Res(x) = (x mod m1, . . . , x mod mr) ,
if mj ‚ä•mk for 1  j < k  r.
Knowing x mod m1, . . . , x mod mr doesn't tell us everything about x. But
it does allow us to determine x mod m, where m is the product m1 . . . mr.

4.7 INDEPENDENT RESIDUES 127
In practical applications we'll often know that x lies in a certain range; then
we'll know everything about x if we know x mod m and if m is large enough.
For example, let's look at a small case of a residue number system that
has only two moduli, 3 and 5:
x mod 15 x mod 3 x mod 5
0
0
0
1
1
1
2
2
2
3
0
3
4
1
4
5
2
0
6
0
1
7
1
2
8
2
3
9
0
4
10
1
0
11
2
1
12
0
2
13
1
3
14
2
4
Each ordered pair (x mod 3, x mod 5) is dierent, because x mod 3 = y mod 3
and x mod 5 = y mod 5 if and only if x mod 15 = y mod 15.
We can perform addition, subtraction, and multiplication on the two
components independently, because of the rules of congruences. For example,
if we want to multiply 7 = (1, 2) by 13 = (1, 3) modulo 15, we calculate
1¬∑1 mod 3 = 1 and 2¬∑3 mod 5 = 1. The answer is (1, 1) = 1; hence 7¬∑13 mod 15
must equal 1. Sure enough, it does.
This independence principle is useful in computer applications, because
dierent components can be worked on separately (for example, by dierent
computers). If each modulus mk is a distinct prime pk, chosen to be slightly
less than 231, then a computer whose basic arithmetic operations handle in-
For example, the
Mersenne prime
231 ‚àí1
works well.
tegers in the range [‚àí231 . . 231) can easily compute sums, dierences, and
products modulo pk. A set of r such primes makes it possible to add, sub-
tract, and multiply \multiple-precision numbers" of up to almost 31r bits,
and the residue system makes it possible to do this faster than if such large
numbers were added, subtracted, or multiplied in other ways.
We can even do division, in appropriate circumstances.
For example,
suppose we want to compute the exact value of a large determinant of integers.
The result will be an integer D, and bounds on jDj can be given based on the
size of its entries. But the only fast ways known for calculating determinants

128 NUMBER THEORY
require division, and this leads to fractions (and loss of accuracy, if we resort
to binary approximations). The remedy is to evaluate D mod pk = Dk, for
various large primes pk. We can safely divide modulo pk unless the divisor
happens to be a multiple of pk. That's very unlikely, but if it does happen we
can choose another prime. Finally, knowing Dk for suciently many primes,
we'll have enough information to determine D.
But we haven't explained how to get from a given sequence of residues
(x mod m1, . . . , x mod mr) back to x mod m. We've shown that this conver-
sion can be done in principle, but the calculations might be so formidable
that they might rule out the idea in practice. Fortunately, there is a rea-
sonably simple way to do the job, and we can illustrate it in the situation
(x mod 3, x mod 5) shown in our little table. The key idea is to solve the
problem in the two cases (1, 0) and (0, 1); for if (1, 0) = a and (0, 1) = b, then
(x, y) = (ax + by) mod 15, since congruences can be multiplied and added.
In our case a = 10 and b = 6, by inspection of the table; but how could
we nd a and b when the moduli are huge? In other words, if m ‚ä•n, what
is a good way to nd numbers a and b such that the equations
a mod m = 1,
a mod n = 0,
b mod m = 0,
b mod n = 1
all hold? Once again, (4.5) comes to the rescue: With Euclid's algorithm, we
can nd m‚Ä≤ and n‚Ä≤ such that
m‚Ä≤m + n‚Ä≤n = 1 .
Therefore we can take a = n‚Ä≤n and b = m‚Ä≤m, reducing them both mod mn
if desired.
Further tricks are needed in order to minimize the calculations when the
moduli are large; the details are beyond the scope of this book, but they can
be found in [208, page 274]. Conversion from residues to the corresponding
original numbers is feasible, but it is suciently slow that we save total time
only if a sequence of operations can all be done in the residue number system
before converting back.
Let's rm up these congruence ideas by trying to solve a little problem:
How many solutions are there to the congruence
x2 ‚â°1
(mod m) ,
(4.43)
if we consider two solutions x and x‚Ä≤ to be the same when x ‚â°x‚Ä≤?
According to the general principles explained earlier, we should consider
rst the case that m is a prime power, pk, where k > 0. Then the congruence
x2 ‚â°1 can be written
(x ‚àí1)(x + 1) ‚â°0
(mod pk) ,

4.7 INDEPENDENT RESIDUES 129
so p must divide either x ‚àí1 or x + 1, or both. But p can't divide both
x ‚àí1 and x + 1 unless p = 2; we'll leave that case for later. If p > 2, then
pkn(x ‚àí1)(x + 1) ‚áê‚áípkn(x ‚àí1) or pkn(x + 1); so there are exactly two
solutions, x ‚â°+1 and x ‚â°‚àí1.
The case p = 2 is a little dierent. If 2kn(x ‚àí1)(x + 1) then either x ‚àí1
or x + 1 is divisible by 2 but not by 4, so the other one must be divisible
by 2k‚àí1. This means that we have four solutions when k  3, namely x ‚â°¬±1
and x ‚â°2k‚àí1 ¬± 1. (For example, when pk = 8 the four solutions are x ‚â°1, 3,
5, 7 (mod 8); it's often useful to know that the square of any odd integer has
the form 8n + 1.)
Now x2 ‚â°1 (mod m) if and only if x2 ‚â°1 (mod pmp) for all primes p
with mp > 0 in the complete factorization of m. Each prime is independent
of the others, and there are exactly two possibilities for x mod pmp except
when p = 2. Therefore if m has exactly r dierent prime divisors, the total
All primes are odd
except 2, which is
the oddest of all.
number of solutions to x2 ‚â°1 is 2r, except for a correction when m is even.
The exact number in general is
2r+[8nm]+[4nm]‚àí[2nm] .
(4.44)
For example, there are four \square roots of unity modulo 12," namely 1, 5,
7, and 11. When m = 15 the four are those whose residues mod 3 and mod 5
are ¬±1, namely (1, 1), (1, 4), (2, 1), and (2, 4) in the residue number system.
These solutions are 1, 4, 11, and 14 in the ordinary (decimal) number system.
4.8
ADDITIONAL APPLICATIONS
There's some unnished business left over from Chapter 3: We wish
to prove that the m numbers
0 mod m, n mod m, 2n mod m, . . . , (m ‚àí1)n mod m
(4.45)
consist of precisely d copies of the m/d numbers
0,
d,
2d,
. . . ,
m ‚àíd
in some order, where d = gcd(m, n). For example, when m = 12 and n = 8
we have d = 4, and the numbers are 0, 8, 4, 0, 8, 4, 0, 8, 4, 0, 8, 4.
The rst part of the proof | to show that we get d copies of the rst
m/d values | is now trivial. We have
Mathematicians love
to say that things
are trivial.
jn ‚â°kn (mod m)
‚áê‚áí
j(n/d) ‚â°k(n/d) (mod m/d)
by (4.38); hence we get d copies of the values that occur when 0  k < m/d.

130 NUMBER THEORY
Now we must show that those m/d numbers are f0, d, 2d, . . . , m ‚àídg
in some order.
Let's write m = m‚Ä≤d and n = n‚Ä≤d.
Then kn mod m =
d(kn‚Ä≤ mod m‚Ä≤), by the distributive law (3.23); so the values that occur when
0  k < m‚Ä≤ are d times the numbers
0 mod m‚Ä≤, n‚Ä≤ mod m‚Ä≤, 2n‚Ä≤ mod m‚Ä≤, . . . , (m‚Ä≤ ‚àí1)n‚Ä≤ mod m‚Ä≤ .
But we know that m‚Ä≤ ‚ä•n‚Ä≤ by (4.27); we've divided out their gcd. Therefore
we need only consider the case d = 1, namely the case that m and n are
relatively prime.
So let's assume that m ‚ä•n. In this case it's easy to see that the numbers
(4.45) are just f0, 1, . . . , m ‚àí1g in some order, by using the \pigeonhole
principle." This principle states that if m pigeons are put into m pigeonholes,
there is an empty hole if and only if there's a hole with more than one pigeon.
(Dirichlet's box principle, proved in exercise 3.8, is similar.) We know that
the numbers (4.45) are distinct, because
jn ‚â°kn (mod m)
‚áê‚áí
j ‚â°k (mod m)
when m ‚ä•n; this is (4.37). Therefore the m dierent numbers must ll all the
pigeonholes 0, 1, . . . , m ‚àí1. Therefore the unnished business of Chapter 3
is nished.
The proof is complete, but we can prove even more if we use a direct
method instead of relying on the indirect pigeonhole argument. If m ‚ä•n and
if a value j ‚àà[0 . . m) is given, we can explicitly compute k ‚àà[0 . . m) such
that kn mod m = j by solving the congruence
kn ‚â°j
(mod m)
for k. We simply multiply both sides by n‚Ä≤, where m‚Ä≤m + n‚Ä≤n = 1, to get
k ‚â°jn‚Ä≤
(mod m) ;
hence k = jn‚Ä≤ mod m.
We can use the facts just proved to establish an important result discov-
ered by Pierre de Fermat in 1640. Fermat was a great mathematician who
contributed to the discovery of calculus and many other parts of mathemat-
ics. He left notebooks containing dozens of theorems stated without proof,
and each of those theorems has subsequently been veried | with the possible
exception of one that became the most famous of all, because it baed the
world's best mathematicians for 350 years. The famous one, called \Fermat's
Last Theorem," states that
an + bn Ã∏= cn
(4.46)

4.8 ADDITIONAL APPLICATIONS 131
for all positive integers a, b, c, and n, when n > 2. (Of course there are lots
of solutions to the equations a + b = c and a2 + b2 = c2.) Andrew Wiles
NEWS FLASH
Euler [115] con-
jectured that
a4 +b4 +c4 Ã∏= d4 ,
but Noam Elkies
[92] found innitely
many solutions in
August, 1987.
Now Roger Frye has
done an exhaustive
computer search,
proving (after
about 110 hours
on a Connection
Machine) that the
only solution with
d < 1000000 is:
958004 + 2175194
+ 4145604
= 4224814 .
culminated many years of research by announcing a proof of (4.46) in 1993;
his proof is currently being subjected to intense scrutiny.
Fermat's theorem of 1640 is much easier to verify. It's now called Fermat's
Little Theorem (or just Fermat's theorem, for short), and it states that
np‚àí1 ‚â°1
(mod p) ,
if n ‚ä•p.
(4.47)
Proof: As usual, we assume that p denotes a prime.
We know that the
p‚àí1 numbers n mod p, 2n mod p, . . . , (p‚àí1)n mod p are the numbers 1, 2,
. . . , p ‚àí1 in some order. Therefore if we multiply them together we get
n ¬∑ (2n) ¬∑ . . . ¬∑
¬°
(p ‚àí1)n
¬¢
‚â°(n mod p) ¬∑ (2n mod p) ¬∑ . . . ¬∑
¬°
(p ‚àí1)n mod p
¬¢
‚â°(p ‚àí1)! ,
where the congruence is modulo p. This means that
(p ‚àí1)! np‚àí1 ‚â°(p ‚àí1)!
(mod p) ,
and we can cancel the (p ‚àí1)! since it's not divisible by p. QED.
An alternative form of Fermat's theorem is sometimes more convenient:
np ‚â°n
(mod p) ,
integer n.
(4.48)
This congruence holds for all integers n. The proof is easy: If n ‚ä•p we
simply multiply (4.47) by n. If not, pnn, so np ‚â°0 ‚â°n.
In the same year that he discovered (4.47), Fermat wrote a letter to
Mersenne, saying he suspected that the number
fn = 22n + 1
would turn out to be prime for all n  0. He knew that the rst ve cases
\. . . laquelle propo-
sition, si elle est
vraie, est de tres
grand usage."
|P. de Fermat [121]
gave primes:
21+1 = 3; 22+1 = 5; 24+1 = 17; 28+1 = 257; 216+1 = 65537;
but he couldn't see how to prove that the next case, 232 + 1 = 4294967297,
would be prime.
It's interesting to note that Fermat could have proved that 232 + 1 is not
prime, using his own recently discovered theorem, if he had taken time to
perform a few dozen multiplications: We can set n = 3 in (4.47), deducing
that
3232 ‚â°1
(mod 232 + 1),
if 232 + 1 is prime.

132 NUMBER THEORY
And it's possible to test this relation by hand, beginning with 3 and squaring
32 times, keeping only the remainders mod 232 + 1. First we have 32 = 9,
If this is Fermat's
Little Theorem,
the other one was
last but not least.
then 322 = 81, then 323 = 6561, and so on until we reach
3232 ‚â°3029026160
(mod 232 + 1) .
The result isn't 1, so 232 + 1 isn't prime. This method of disproof gives us
no clue about what the factors might be, but it does prove that factors exist.
(They are 641 and 6700417, rst found by Euler in 1732 [102].)
If 3232 had turned out to be 1, modulo 232 + 1, the calculation wouldn't
have proved that 232 + 1 is prime; it just wouldn't have disproved it. But
exercise 47 discusses a converse to Fermat's theorem by which we can prove
that large prime numbers are prime, without doing an enormous amount of
laborious arithmetic.
We proved Fermat's theorem by cancelling (p ‚àí1)! from both sides of a
congruence. It turns out that (p ‚àí1)! is always congruent to ‚àí1, modulo p;
this is part of a classical result known as Wilson's theorem:
(n ‚àí1)! ‚â°‚àí1
(mod n)
‚áê‚áí
n is prime,
if n > 1.
(4.49)
One half of this theorem is trivial: If n > 1 is not prime, it has a prime
divisor p that appears as a factor of (n ‚àí1)!, so (n ‚àí1)! cannot be congruent
to ‚àí1. (If (n‚àí1)! were congruent to ‚àí1 modulo n, it would also be congruent
to ‚àí1 modulo p, but it isn't.)
The other half of Wilson's theorem states that (p ‚àí1)! ‚â°‚àí1 (mod p).
We can prove this half by pairing up numbers with their inverses mod p. If
n ‚ä•p, we know that there exists n‚Ä≤ such that
n‚Ä≤n ‚â°1
(mod p) ;
here n‚Ä≤ is the inverse of n, and n is also the inverse of n‚Ä≤. Any two inverses
of n must be congruent to each other, since nn‚Ä≤ ‚â°nn‚Ä≤‚Ä≤ implies n‚Ä≤ ‚â°n‚Ä≤‚Ä≤.
If p is prime, is p‚Ä≤
prime prime?
Now suppose we pair up each number between 1 and p‚àí1 with its inverse.
Since the product of a number and its inverse is congruent to 1, the product
of all the numbers in all pairs of inverses is also congruent to 1; so it seems
that (p ‚àí1)! is congruent to 1. Let's check, say for p = 5. We get 4! = 24;
but this is congruent to 4, not 1, modulo 5. Oops | what went wrong? Let's
take a closer look at the inverses:
1‚Ä≤ = 1 ,
2‚Ä≤ = 3 ,
3‚Ä≤ = 2 ,
4‚Ä≤ = 4 .
Ah so; 2 and 3 pair up but 1 and 4 don't | they're their own inverses.
To resurrect our analysis we must determine which numbers are their
own inverses. If x is its own inverse, then x2 ‚â°1 (mod p); and we have

4.8 ADDITIONAL APPLICATIONS 133
already proved that this congruence has exactly two roots when p > 2. (If
p = 2 it's obvious that (p ‚àí1)! ‚â°‚àí1, so we needn't worry about that case.)
The roots are 1 and p ‚àí1, and the other numbers (between 1 and p ‚àí1) pair
up; hence
(p ‚àí1)! ‚â°1 ¬∑ (p ‚àí1) ‚â°‚àí1 ,
as desired.
Unfortunately, we can't compute factorials eciently, so Wilson's theo-
rem is of no use as a practical test for primality. It's just a theorem.
4.9
PHI AND MU
How many of the integers f0, 1, . . . , m‚àí1g are relatively prime to m?
This is an important quantity called œï(m), the \totient" of m (so named by
J. J. Sylvester [347], a British mathematician who liked to invent new words).
We have œï(1) = 1, œï(p) = p ‚àí1, and œï(m) < m ‚àí1 for all composite
numbers m.
The œï function is called Euler's totient function, because Euler was the
rst person to study it. Euler discovered, for example, that Fermat's theorem
(4.47) can be generalized to nonprime moduli in the following way:
nœï(m) ‚â°1
(mod m) ,
if n ‚ä•m.
(4.50)
(Exercise 32 asks for a proof of Euler's theorem.)
\Si fuerit N ad x
numerus primus
et n numerus
partium ad N
primarum, tum
potestas xn unitate
minuta semper per
numerum N erit
divisibilis."
|L. Euler [111]
If m is a prime power pk, it's easy to compute œï(m), because n ‚ä•
pk ‚áê‚áíp//nn. The multiples of p in f0, 1, . . . , pk ‚àí1g are f0, p, 2p, . . . , pk ‚àípg;
hence there are pk‚àí1 of them, and œï(pk) counts what is left:
œï(pk) = pk ‚àípk‚àí1 .
Notice that this formula properly gives œï(p) = p ‚àí1 when k = 1.
If m > 1 is not a prime power, we can write m = m1m2 where m1 ‚ä•m2.
Then the numbers 0  n < m can be represented in a residue number system
as (n mod m1, n mod m2). We have
n ‚ä•m
‚áê‚áí
n mod m1 ‚ä•m1
and
n mod m2 ‚ä•m2
by (4.30) and (4.4).
Hence, n mod m is \good" if and only if n mod m1
and n mod m2 are both \good," if we consider relative primality to be a
virtue. The total number of good values modulo m can now be computed,
recursively: It is œï(m1)œï(m2), because there are œï(m1) good ways to choose
the rst component n mod m1 and œï(m2) good ways to choose the second
component n mod m2 in the residue representation.

134 NUMBER THEORY
For example, œï(12) = œï(4)œï(3) = 2¬∑2 = 4, because n is prime to 12 if
\Si sint A et B nu-
meri inter se primi
et numerus partium
ad A primarum
sit = a, numerus
vero partium ad B
primarum sit = b,
tum numerus par-
tium ad productum
AB primarum erit
= ab."
|L. Euler [111]
and only if n mod 4 = (1 or 3) and n mod 3 = (1 or 2). The four values prime
to 12 are (1, 1), (1, 2), (3, 1), (3, 2) in the residue number system; they are
1, 5, 7, 11 in ordinary decimal notation. Euler's theorem states that n4 ‚â°1
(mod 12) whenever n ‚ä•12.
A function f(m) of positive integers is called multiplicative if f(1) = 1
and
f(m1m2) = f(m1)f(m2)
whenever m1 ‚ä•m2.
(4.51)
We have just proved that œï(m) is multiplicative. We've also seen another
instance of a multiplicative function earlier in this chapter: The number of
incongruent solutions to x2 ‚â°1 (mod m) is multiplicative.
Still another
example is f(m) = mŒ± for any power Œ±.
A multiplicative function is dened completely by its values at prime
powers, because we can decompose any positive integer m into its prime-
power factors, which are relatively prime to each other. The general formula
f(m) =
Y
p
f(pmp) ,
if m =
Y
p
pmp
(4.52)
holds if and only if f is multiplicative.
In particular, this formula gives us the value of Euler's totient function
for general m:
œï(m) =
Y
pnm
(pmp ‚àípmp‚àí1) = m
Y
pnm
¬≥
1 ‚àí1
p
¬¥
.
(4.53)
For example, œï(12) = (4 ‚àí2)(3 ‚àí1) = 12(1 ‚àí1
2)(1 ‚àí1
3).
Now let's look at an application of the œï function to the study of rational
numbers mod 1. We say that the fraction m/n is basic if 0  m < n. There-
fore œï(n) is the number of reduced basic fractions with denominator n; and
the Farey series Fn contains all the reduced basic fractions with denominator
n or less, as well as the non-basic fraction 1
1.
The set of all basic fractions with denominator 12, before reduction to
lowest terms, is
0
12,
1
12,
2
12,
3
12,
4
12,
5
12,
6
12,
7
12,
8
12,
9
12, 10
12, 11
12 .
Reduction yields
0
1,
1
12,
1
6,
1
4,
1
3,
5
12,
1
2,
7
12,
2
3,
3
4,
5
6,
11
12 ,

4.9 PHI AND MU 135
and we can group these fractions by their denominators:
0
1;
1
2;
1
3, 2
3;
1
4, 3
4;
1
6, 5
6;
1
12,
5
12,
7
12, 11
12.
What can we make of this? Well, every divisor d of 12 occurs as a denomi-
nator, together with all œï(d) of its numerators. The only denominators that
occur are divisors of 12. Thus
œï(1) + œï(2) + œï(3) + œï(4) + œï(6) + œï(12) = 12 .
A similar thing will obviously happen if we begin with the unreduced fractions
0
m,
1
m, . . . , m‚àí1
m
for any m, hence
X
dnm
œï(d) = m .
(4.54)
We said near the beginning of this chapter that problems in number
theory often require sums over the divisors of a number. Well, (4.54) is one
such sum, so our claim is vindicated. (We will see other examples.)
Now here's a curious fact: If f is any function such that the sum
g(m) =
X
dnm
f(d)
is multiplicative, then f itself is multiplicative. (This result, together with
(4.54) and the fact that g(m) = m is obviously multiplicative, gives another
reason why œï(m) is multiplicative.) We can prove this curious fact by in-
duction on m: The basis is easy because f(1) = g(1) = 1. Let m > 1, and
assume that f(m1m2) = f(m1)f(m2) whenever m1 ‚ä•m2 and m1m2 < m. If
m = m1m2 and m1 ‚ä•m2, we have
g(m1m2) =
X
dnm1m2
f(d) =
X
d1nm1
X
d2nm2
f(d1d2) ,
and d1 ‚ä•d2 since all divisors of m1 are relatively prime to all divisors of m2.
By the induction hypothesis, f(d1d2) = f(d1)f(d2) except possibly when
d1 = m1 and d2 = m2; hence we obtain
¬µ X
d1nm1
f(d1)
X
d2nm2
f(d2)
¬∂
‚àíf(m1)f(m2) + f(m1m2)
= g(m1)g(m2) ‚àíf(m1)f(m2) + f(m1m2) .
But this equals g(m1m2) = g(m1)g(m2), so f(m1m2) = f(m1)f(m2).

136 NUMBER THEORY
Conversely, if f(m) is multiplicative, the corresponding sum-over-divisors
function g(m) = P
dnm f(d) is always multiplicative.
In fact, exercise 33
shows that even more is true. Hence the curious fact and its converse are
both facts.
The Mobius function ¬µ(m), named after the nineteenth-century math-
ematician August Mobius who also had a famous band, can be dened for all
integers m  1 by the equation
X
dnm
¬µ(d) = [m = 1] .
(4.55)
This equation is actually a recurrence, since the left-hand side is a sum con-
sisting of ¬µ(m) and certain values of ¬µ(d) with d < m. For example, if we
plug in m = 1, 2, . . . , 12 successively we can compute the rst twelve values:
m
1
2
3
4
5
6
7
8
9
10
11
12
¬µ(m)
1
‚àí1
‚àí1
0
‚àí1
1
‚àí1
0
0
1
‚àí1
0
Richard Dedekind [77] and Joseph Liouville [251] noticed the following
important \inversion principle" in 1857:
g(m) =
X
dnm
f(d)
‚áê‚áí
f(m) =
X
dnm
¬µ(d)g(m
d ) .
(4.56)
According to this principle, the ¬µ function gives us a new way to understand
any function f(m) for which we know P
dnm f(d).
Now is a good time
to try warmup
exercise 11.
The proof of (4.56) uses two tricks (4.7) and (4.9) that we described near
the beginning of this chapter: If g(m) = P
dnm f(d) then
X
dnm
¬µ(d)g(m
d ) =
X
dnm
¬µ(m
d )g(d)
=
X
dnm
¬µ(m
d )
X
knd
f(k)
=
X
knm
X
dn(m/k)
¬µ( m
kd)f(k)
=
X
knm
X
dn(m/k)
¬µ(d)f(k)
=
X
knm
[m/k = 1]f(k) = f(m) .
The other half of (4.56) is proved similarly (see exercise 12).

4.9 PHI AND MU 137
Relation (4.56) gives us a useful property of the Mobius function, and we
have tabulated the rst twelve values; but what is the value of ¬µ(m) when
m is large?
How can we solve the recurrence (4.55)?
Well, the function
g(m) = [m = 1] is obviously multiplicative | after all, it's zero except when
m = 1. So the Mobius function dened by (4.55) must be multiplicative, by
the curious fact we proved a minute or two ago. Therefore we can gure out
Depending on how
fast you read.
what ¬µ(m) is if we compute ¬µ(pk).
When m = pk, (4.55) says that
¬µ(1) + ¬µ(p) + ¬µ(p2) + ¬∑ ¬∑ ¬∑ + ¬µ(pk) = 0
for all k  1, since the divisors of pk are 1, . . . , pk. It follows that
¬µ(p) = ‚àí1 ;
¬µ(pk) = 0
for k > 1.
Therefore by (4.52), we have the general formula
¬µ(m) =
Y
pnm
¬µ(pmp) =
¬Ø (‚àí1)r,
if m = p1p2 . . . pr;
0,
if m is divisible by some p2. (4.57)
That's ¬µ.
If we regard (4.54) as a recurrence for the function œï(m), we can solve
that recurrence by applying the Dedekind-Liouville rule (4.56). We get
œï(m) =
X
dnm
¬µ(d) m
d .
(4.58)
For example,
œï(12) = ¬µ(1)¬∑12 + ¬µ(2)¬∑6 + ¬µ(3)¬∑4 + ¬µ(4)¬∑3 + ¬µ(6)¬∑2 + ¬µ(12)¬∑1
= 12 ‚àí6 ‚àí4 + 0 + 2 + 0 = 4 .
If m is divisible by r dierent primes, say fp1, . . . , prg, the sum (4.58) has
only 2r nonzero terms, because the ¬µ function is often zero. Thus we can see
that (4.58) checks with formula (4.53), which reads
œï(m) = m
¬≥
1 ‚àí1
p1
¬¥
. . .
¬≥
1 ‚àí1
pr
¬¥
;
if we multiply out the r factors (1 ‚àí1/pj), we get precisely the 2r nonzero
terms of (4.58). The advantage of the Mobius function is that it applies in
many situations besides this one.

138 NUMBER THEORY
For example, let's try to gure out how many fractions are in the Farey
series Fn. This is the number of reduced fractions in [0 . . 1] whose denomi-
nators do not exceed n, so it is 1 greater than Œ¶(n) where we dene
Œ¶(x) =
X
1kx
œï(k) .
(4.59)
(We must add 1 to Œ¶(n) because of the nal fraction 1
1.) The sum in (4.59)
looks dicult, but we can determine Œ¶(x) indirectly by observing that
X
d1
Œ¶
¬≥ x
d
¬¥
= 1
2‚åäx‚åã‚åä1 + x‚åã
(4.60)
for all real x  0. Why does this identity hold? Well, it's a bit awesome yet
not really beyond our ken. There are 1
2‚åäx‚åã‚åä1 + x‚åãbasic fractions m/n with
0  m < n  x, counting both reduced and unreduced fractions; that gives
us the right-hand side. The number of such fractions with gcd(m, n) = d
is Œ¶(x/d), because such fractions are m‚Ä≤/n‚Ä≤ with 0  m‚Ä≤ < n‚Ä≤  x/d after
replacing m by m‚Ä≤d and n by n‚Ä≤d. So the left-hand side counts the same
fractions in a dierent way, and the identity must be true.
Let's look more closely at the situation, so that equations (4.59) and
(4.60) become clearer. The denition of Œ¶(x) implies that Œ¶(x) = Œ¶
¬°
‚åäx‚åã
¬¢
;
but it turns out to be convenient to dene Œ¶(x) for arbitrary real values, not
(This extension to
real values is a use-
ful trick for many
recurrences that
arise in the analysis
of algorithms.)
just for integers. At integer values we have the table
n
0
1
2
3
4
5
6
7
8
9
10
11
12
œï(n)
‚àí
1
1
2
2
4
2
6
4
6
4
10
4
Œ¶(n)
0
1
2
4
6
10
12
18
22
28
32
42
46
and we can check (4.60) when x = 12:
Œ¶(12) + Œ¶(6) + Œ¶(4) + Œ¶(3) + Œ¶(2) + Œ¶(2) + 6¬∑Œ¶(1)
= 46 + 12 + 6 + 4 + 2 + 2 + 6 = 78 =
1
2 ¬∑ 12 ¬∑ 13 .
Amazing.
Identity (4.60) can be regarded as an implicit recurrence for Œ¶(x); for
example, we've just seen that we could have used it to calculate Œ¶(12) from
certain values of Œ¶(m) with m < 12. And we can solve such recurrences by
using another beautiful property of the Mobius function:
In fact, Mobius
[273] invented his
function because
of (4.61), not (4.56).
g(x) =
X
d1
f(x/d)
‚áê‚áí
f(x) =
X
d1
¬µ(d)g(x/d) .
(4.61)

4.9 PHI AND MU 139
This inversion law holds for all functions f such that P
k,d1
¬Ø¬Øf(x/kd)
¬Ø¬Ø < ‚àû;
we can prove it as follows. Suppose g(x) = P
d1 f(x/d). Then
X
d1
¬µ(d)g(x/d) =
X
d1
¬µ(d)
X
k1
f(x/kd)
=
X
m1
f(x/m)
X
d,k1
¬µ(d)[m = kd]
=
X
m1
f(x/m)
X
dnm
¬µ(d) =
X
m1
f(x/m)[m = 1] = f(x) .
The proof in the other direction is essentially the same.
So now we can solve the recurrence (4.60) for Œ¶(x):
Œ¶(x) = 1
2
X
d1
¬µ(d)‚åäx/d‚åã‚åä1 + x/d‚åã.
(4.62)
This is always a nite sum. For example,
Œ¶(12) =
1
2(12¬∑13 ‚àí6¬∑7 ‚àí4¬∑5 + 0 ‚àí2¬∑3 + 2¬∑3
‚àí1¬∑2 + 0 + 0 + 1¬∑2 ‚àí1¬∑2 + 0)
= 78 ‚àí21 ‚àí10 ‚àí3 + 3 ‚àí1 + 1 ‚àí1 = 46 .
In Chapter 9 we'll see how to use (4.62) to get a good approximation to Œ¶(x);
in fact, we'll prove a result due to Mertens in 1874 [270],
Œ¶(x) =
3
œÄ2 x2 + O(x log x) .
Therefore the function Œ¶(x) grows \smoothly"; it averages out the erratic
behavior of œï(k).
In keeping with the tradition established last chapter, let's conclude this
chapter with a problem that illustrates much of what we've just seen and that
also points ahead to the next chapter. Suppose we have beads of n dierent
colors; our goal is to count how many dierent ways there are to string them
into circular necklaces of length m. We can try to \name and conquer" this
problem by calling the number of possible necklaces N(m, n).
For example, with two colors of beads R and B, we can make necklaces
of length 4 in N(4, 2) = 6 dierent ways:
¬©


¬™
R
R
R
R
¬©


¬™
R
R
B
R
¬©


¬™
R
B
B
R
¬©


¬™
R
B
R
B
¬©


¬™
R
B
B
B
¬©


¬™
B
B
B
B
All other ways are equivalent to one of these, because rotations of a necklace
do not change it. However, reections are considered to be dierent; in the

140 NUMBER THEORY
case m = 6, for example,
¬©


¬™
B
R
B
B
R
R
is dierent from
¬©


¬™
B
R
R
B
B
R
.
The problem of counting these congurations was rst solved by P. A. Mac-
Mahon in 1892 [264].
There's no obvious recurrence for N(m, n), but we can count the neck-
laces by breaking them each into linear strings in m ways and considering the
resulting fragments. For example, when m = 4 and n = 2 we get
RRRR
RRRR
RRRR
RRRR
RRBR
RRRB
BRRR
RBRR
RBBR
RRBB
BRRB
BBRR
RBRB
BRBR
RBRB
BRBR
RBBB
BRBB
BBRB
BBBR
BBBB
BBBB
BBBB
BBBB
Each of the nm possible patterns appears at least once in this array of
mN(m, n) strings, and some patterns appear more than once. How many
times does a pattern a0 . . . am‚àí1 appear? That's easy: It's the number of
cyclic shifts ak . . . am‚àí1a0 . . . ak‚àí1 that produce the same pattern as the orig-
inal a0 . . . am‚àí1. For example, BRBR occurs twice, because the four ways to
cut the necklace formed from BRBR produce four cyclic shifts (BRBR, RBRB,
BRBR, RBRB); two of these coincide with BRBR itself. This argument shows
that
mN(m, n) =
X
a0,...,am‚àí1‚ààSn
X
0k<m
¬£
a0 . . . am‚àí1 = ak . . . am‚àí1a0 . . . ak‚àí1
¬§
=
X
0k<m
X
a0,...,am‚àí1‚ààSn
¬£
a0 . . . am‚àí1 = ak . . . am‚àí1a0 . . . ak‚àí1
¬§
.
Here Sn is a set of n dierent colors.
Let's see how many patterns satisfy a0 . . .am‚àí1 = ak . . .am‚àí1a0 . . .ak‚àí1,
when k is given. For example, if m = 12 and k = 8, we want to count the
number of solutions to
a0a1a2a3a4a5a6a7a8a9a10a11 = a8a9a10a11a0a1a2a3a4a5a6a7 .
This means a0 = a8 = a4; a1 = a9 = a5; a2 = a10 = a6; and a3 = a11 = a7.
So the values of a0, a1, a2, and a3 can be chosen in n4 ways, and the

4.9 PHI AND MU 141
remaining a's depend on them.
Does this look familiar?
In general, the
solution to
aj = a(j+k) mod m ,
for 0  j < m
makes us equate aj with a(j+kl) mod m for l = 1, 2, . . . ; and we know that
the multiples of k modulo m are f0, d, 2d, . . . , m ‚àídg, where d = gcd(k, m).
Therefore the general solution is to choose a0, . . . , ad‚àí1 independently and
then to set aj = aj‚àíd for d  j < m. There are nd solutions.
We have just proved that
mN(m, n) =
X
0k<m
ngcd(k,m) .
This sum can be simplied, since it includes only terms nd where dnm. Sub-
stituting d = gcd(k, m) yields
N(m, n) =
1
m
X
dnm
nd
X
0k<m
¬£
d = gcd(k, m)
¬§
=
1
m
X
dnm
nd
X
0k<m
¬£
k/d ‚ä•m/d
¬§
=
1
m
X
dnm
nd
X
0k<m/d
¬£
k ‚ä•m/d
¬§
.
(We are allowed to replace k/d by k because k must be a multiple of d.)
Finally, we have P
0k<m/d[k ‚ä•m/d] = œï(m/d) by denition, so we obtain
MacMahon's formula:
N(m, n) =
1
m
X
dnm
nd œï
¬≥m
d
¬¥
=
1
m
X
dnm
œï(d) nm/d .
(4.63)
When m = 4 and n = 2, for example, the number of necklaces is 1
4(1¬∑24 +
1¬∑22 + 2¬∑21) = 6, just as we suspected.
It's not immediately obvious that the value N(m, n) dened by Mac-
Mahon's sum is an integer! Let's try to prove directly that
X
dnm
œï(d) nm/d ‚â°0
(mod m) ,
(4.64)
without using the clue that this is related to necklaces. In the special case
that m is prime, this congruence reduces to np + (p ‚àí1)n ‚â°0 (mod p); that
is, it reduces to np ‚â°n. We've seen in (4.48) that this congruence is an
alternative form of Fermat's theorem. Therefore (4.64) holds when m = p;

142 NUMBER THEORY
we can regard it as a generalization of Fermat's theorem to the case when the
modulus is not prime. (Euler's generalization (4.50) is dierent.)
We've proved (4.64) for all prime moduli, so let's look at the smallest
case left, m = 4. We must prove that
n4 + n2 + 2n ‚â°0
(mod 4) .
The proof is easy if we consider even and odd cases separately. If n is even,
all three terms on the left are congruent to 0 modulo 4, so their sum is too. If
n is odd, n4 and n2 are each congruent to 1, and 2n is congruent to 2; hence
the left side is congruent to 1+1+2 and thus to 0 modulo 4, and we're done.
Next, let's be a bit daring and try m = 12. This value of m ought to
be interesting because it has lots of factors, including the square of a prime,
yet it is fairly small. (Also there's a good chance we'll be able to generalize a
proof for 12 to a proof for general m.) The congruence we must prove is
n12 + n6 + 2n4 + 2n3 + 2n2 + 4n ‚â°0
(mod 12) .
Now what? By (4.42) this congruence holds if and only if it also holds mod-
ulo 3 and modulo 4. So let's prove that it holds modulo 3. Our congru-
ence (4.64) holds for primes, so we have n3 + 2n ‚â°0 (mod 3).
Careful
scrutiny reveals that we can use this fact to group terms of the larger sum:
n12 + n6 + 2n4 + 2n3 + 2n2 + 4n
= (n12 + 2n4) + (n6 + 2n2) + 2(n3 + 2n)
‚â°0 + 0 + 2¬∑0 ‚â°0
(mod 3) .
So it works modulo 3.
We're half done. To prove congruence modulo 4 we use the same trick.
We've proved that n4 +n2 +2n ‚â°0 (mod 4), so we use this pattern to group:
n12 + n6 + 2n4 + 2n3 + 2n2 + 4n
= (n12 + n6 + 2n3) + 2(n4 + n2 + 2n)
‚â°0 + 2¬∑0 ‚â°0
(mod 4) .
QED for the case m = 12.
QED: Quite Easily
Done.
So far we've proved our congruence for prime m, for m = 4, and for m =
12. Now let's try to prove it for prime powers. For concreteness we may
suppose that m = p3 for some prime p. Then the left side of (4.64) is
np3 + œï(p)np2 + œï(p2)np + œï(p3)n
= np3 + (p ‚àí1)np2 + (p2 ‚àíp)np + (p3 ‚àíp2)n
= (np3 ‚àínp2) + p(np2 ‚àínp) + p2(np ‚àín) + p3n .

4.9 PHI AND MU 143
We can show that this is congruent to 0 modulo p3 if we can prove that
np3‚àínp2 is divisible by p3, that np2‚àínp is divisible by p2, and that np ‚àín
is divisible by p, because the whole thing will then be divisible by p3. By the
alternative form of Fermat's theorem we have np ‚â°n (mod p), so p divides
np ‚àín; hence there is an integer q such that
np = n + pq .
Now we raise both sides to the pth power, expand the right side according to
the binomial theorem (which we'll meet in Chapter 5), and regroup, giving
np2 = (n + pq)p = np + (pq)1np‚àí1
¬µp
1
¬∂
+ (pq)2np‚àí2
¬µp
2
¬∂
+ ¬∑ ¬∑ ¬∑
= np
+ p2Q
for some other integer Q. We're able to pull out a factor of p2 here because
¬°p
1
¬¢
= p in the second term, and because a factor of (pq)2 appears in all the
terms that follow. So we nd that p2 divides np2 ‚àínp.
Again we raise both sides to the pth power, expand, and regroup, to get
np3 = (np + p2Q)p
= np2 + (p2Q)1np(p‚àí1)
¬µp
1
¬∂
+ (p2Q)2np(p‚àí2)
¬µp
2
¬∂
+ ¬∑ ¬∑ ¬∑
= np2 + p3Q
for yet another integer Q. So p3 divides np3 ‚àínp2. This nishes the proof
for m = p3, because we've shown that p3 divides the left-hand side of (4.64).
Moreover we can prove by induction that
npk = npk‚àí1 + pkQ
for some nal integer Q (nal because we're running out of fonts); hence
npk ‚â°npk‚àí1
(mod pk),
for k > 0.
(4.65)
Thus the left side of (4.64), which is
(npk‚àínpk‚àí1) + p(npk‚àí1‚àínpk‚àí2) + ¬∑ ¬∑ ¬∑ + pk‚àí1(np‚àín) + pkn ,
is divisible by pk and so is congruent to 0 modulo pk.
We're almost there. Now that we've proved (4.64) for prime powers, all
that remains is to prove it when m = m1m2, where m1 ‚ä•m2, assuming that
the congruence is true for m1 and m2. Our examination of the case m = 12,
which factored into instances of m = 3 and m = 4, encourages us to think
that this approach will work.

144 NUMBER THEORY
We know that the œï function is multiplicative, so we can write
X
dnm
œï(d) nm/d =
X
d1nm1, d2nm2
œï(d1d2) nm1m2/d1d2
=
X
d1nm1
œï(d1)
¬µ X
d2nm2
œï(d2)(nm1/d1)m2/d2
¬∂
.
But the inner sum is congruent to 0 modulo m2, because we've assumed that
(4.64) holds for m2; so the entire sum is congruent to 0 modulo m2. By a
symmetric argument, we nd that the entire sum is congruent to 0 modulo m1
as well. Thus by (4.42) it's congruent to 0 modulo m. QED.
Exercises
Warmups
1
What is the smallest positive integer that has exactly k divisors, for
1  k  6?
2
Prove that gcd(m, n)¬∑lcm(m, n) = m¬∑n, and use this identity to express
lcm(m, n) in terms of lcm(n mod m, m), when n mod m Ã∏= 0. Hint: Use
(4.12), (4.14), and (4.15).
3
Let œÄ(x) be the number of primes not exceeding x. Prove or disprove:
œÄ(x) ‚àíœÄ(x ‚àí1) = [x is prime] .
4
What would happen if the Stern{Brocot construction started with the
ve fractions
¬° 0
1, 1
0,
0
‚àí1, ‚àí1
0 , 0
1
¬¢
instead of with
¬° 0
1, 1
0
¬¢
?
5
Find simple formulas for Lk and Rk, when L and R are the 2√ó2 matrices
of (4.33).
6
What does `a ‚â°b (mod 0)' mean?
7
Ten people numbered 1 to 10 are lined up in a circle as in the Josephus
problem, and every mth person is executed. (The value of m may be
much larger than 10.) Prove that the rst three people to go cannot be
10, k, and k + 1 (in this order), for any k.
8
The residue number system (x mod 3, x mod 5) considered in the text has
the curious property that 13 corresponds to (1, 3), which looks almost the
same. Explain how to nd all instances of such a coincidence, without
calculating all fteen pairs of residues. In other words, nd all solutions
to the congruences
10x + y ‚â°x
(mod 3) ,
10x + y ‚â°y
(mod 5) .
Hint: Use the facts that 10u+6v ‚â°u (mod 3) and 10u+6v ‚â°v (mod 5).

4 EXERCISES 145
9
Show that (377 ‚àí1)/2 is odd and composite. Hint: What is 377 mod 4?
10
Compute œï(999).
11
Find a function œÉ(n) with the property that
g(n) =
X
0kn
f(k)
‚áê‚áí
f(n) =
X
0kn
œÉ(k) g(n ‚àík) .
(This is analogous to the Mobius function; see (4.56).)
12
Simplify the formula P
dnm
P
knd ¬µ(k) g(d/k).
13
A positive integer n is called squarefree if it is not divisible by m2 for
any m > 1. Find a necessary and sucient condition that n is squarefree,
a
in terms of the prime-exponent representation (4.11) of n;
b
in terms of ¬µ(n).
Basics
14
Prove or disprove:
a
gcd(km, kn) = k gcd(m, n) ;
b
lcm(km, kn) = k lcm(m, n) .
15
Does every prime occur as a factor of some Euclid number en?
16
What is the sum of the reciprocals of the rst n Euclid numbers?
17
Let fn be the \Fermat number" 22n + 1. Prove that fm ‚ä•fn if m < n.
18
Show that if 2n + 1 is prime then n is a power of 2.
19
Prove the following identities when n is a positive integer:
X
1k<n
¬πœï(k + 1)
k
¬∫
=
X
1<mn
$¬µ X
1k<m
¬•
(m/k)/‚åàm/k‚åâ
¬¶¬∂‚àí1%
= n ‚àí1 ‚àí
n
X
k=1
&¬Ø(k ‚àí1)! + 1
k
¬∞'
.
Hint: This is a trick question and the answer is pretty easy.
20
For every positive integer n there's a prime p such that n < p  2n. (This
is essentially \Bertrand's postulate," which Joseph Bertrand veried for
n < 3000000 in 1845 and Chebyshev proved for all n in 1850.)
Use
Bertrand's postulate to prove that there's a constant b ‚âà1.25 such that
the numbers
‚åä2b‚åã, ‚åä22b‚åã, ‚åä222b
‚åã, . . .
are all prime.

146 NUMBER THEORY
21
Let Pn be the nth prime number. Find a constant K such that
¬•
(10n2K) mod 10n¬¶
= Pn .
22
The number 1111111111111111111 is prime. Prove that, in any radix b,
Is this a test for
strabismus?
(11 . . . 1)b can be prime only if the number of 1's is prime.
23
State a recurrence for œÅ(k), the ruler function in the text's discussion of
œµ2(n!). Show that there's a connection between œÅ(k) and the disk that's
moved at step k when an n-disk Tower of Hanoi is being transferred in
2n ‚àí1 moves, for 1  k  2n ‚àí1.
24
Express œµp(n!) in terms of ŒΩp(n), the sum of the digits in the radix p
Look, ma,
sideways addition.
representation of n, thereby generalizing (4.24).
25
We say that m exactly divides n, written mnnn, if mnn and m ‚ä•n/m.
For example, in the text's discussion of factorial factors, pœµp(n!)nnn!.
Prove or disprove the following:
a
knnn and mnnn ‚áê‚áíkmnnn, if k ‚ä•m.
b
For all m, n > 0, either gcd(m, n)nnm or gcd(m, n)nnn.
26
Consider the sequence GN of all nonnegative reduced fractions m/n such
that mn  N. For example,
G10 =
0
1, 1
10, 1
9, 1
8, 1
7, 1
6, 1
5, 1
4, 1
3, 2
5, 1
2, 2
3, 1
1, 3
2, 2
1, 5
2, 3
1, 4
1, 5
1, 6
1, 7
1, 8
1, 9
1, 10
1 .
Is it true that m‚Ä≤n ‚àímn‚Ä≤ = 1 whenever m/n immediately precedes
m‚Ä≤/n‚Ä≤ in GN?
27
Give a simple rule for comparing rational numbers based on their repre-
sentations as L's and R's in the Stern{Brocot number system.
28
The Stern{Brocot representation of œÄ is
œÄ = R3L7R15LR292LRLR2LR3LR14L2R . . . ;
use it to nd all the simplest rational approximations to œÄ whose denom-
inators are less than 50. Is 22
7 one of them?
29
The text describes a correspondence between binary real numbers x =
(.b1b2b3 . . . )2 in [0 . . 1) and Stern{Brocot real numbers Œ± = B1B2B3 . . .
in [0 . . ‚àû). If x corresponds to Œ± and x Ã∏= 0, what number corresponds
to 1 ‚àíx?
30
Prove the following statement (the Chinese Remainder Theorem): Let
m1, . . . , mr be integers with mj ‚ä•mk for 1  j < k  r; let m =
m1 . . . mr; and let a1, . . . , ar, A be integers. Then there is exactly one
integer a such that
a ‚â°ak (mod mk) for 1  k  r
and
A  a < A + m .

4 EXERCISES 147
31
A number in decimal notation is divisible by 3 if and only if the sum of
its digits is divisible by 3. Prove this well-known rule, and generalize it.
32
Prove Euler's theorem (4.50) by generalizing the proof of (4.47).
Why is \Euler"
pronounced \Oiler"
when \Euclid" is
\Yooklid"?
33
Show that if f(m) and g(m) are multiplicative functions, then so is
h(m) = P
dnm f(d) g(m/d).
34
Prove that (4.56) is a special case of (4.61).
Homework exercises
35
Let I(m, n) be a function that satises the relation
I(m, n)m + I(n, m)n = gcd(m, n) ,
when m and n are nonnegative integers with m Ã∏= n. Thus, I(m, n) = m‚Ä≤
and I(n, m) = n‚Ä≤ in (4.5); the value of I(m, n) is an inverse of m with
respect to n. Find a recurrence that denes I(m, n).
36
Consider the set Z(
‚àö
10) = f m + n
‚àö
10 | integer m, n g. The number
m + n
‚àö
10 is called a unit if m2 ‚àí10n2 = ¬±1, since it has an inverse
(that is, since (m + n
‚àö
10 ) ¬∑ ¬±(m ‚àín
‚àö
10 ) = 1). For example, 3 +
‚àö
10 is
a unit, and so is 19‚àí6
‚àö
10. Pairs of cancelling units can be inserted into
any factorization, so we ignore them. Nonunit numbers of Z(
‚àö
10) are
called prime if they cannot be written as a product of two nonunits. Show
that 2, 3, and 4 ¬±
‚àö
10 are primes of Z(
‚àö
10). Hint: If 2 = (k + l
‚àö
10 ) √ó
(m + n
‚àö
10 ) then 4 = (k2 ‚àí10l2)(m2 ‚àí10n2). Furthermore, the square
of any integer mod 10 is 0, 1, 4, 5, 6, or 9.
37
Prove (4.17). Hint: Show that en ‚àí1
2 = (en‚àí1 ‚àí1
2)2 + 1
4, and consider
2‚àín log(en ‚àí1
2).
38
Prove that if a ‚ä•b and a > b then
gcd(am ‚àíbm, an ‚àíbn) = agcd(m,n) ‚àíbgcd(m,n) ,
0  m < n.
(All variables are integers.) Hint: Use Euclid's algorithm.
39
Let S(m) be the smallest positive integer n for which there exists an
increasing sequence of integers
m = a1 < a2 < ¬∑ ¬∑ ¬∑ < at = n
such that a1a2 . . . at is a perfect square. (If m is a perfect square, we
can let t = 1 and n = m.) For example, S(2) = 6 because the best such
sequence is a1 = 2, a2 = 3, a3 = 6. We have
n
1
2
3
4
5
6
7
8
9
10
11
12
S(n)
1
6
8
4
10
12
14
15
9
18
22
20
Prove that S(m) Ã∏= S(m‚Ä≤) whenever 0 < m < m‚Ä≤.

148 NUMBER THEORY
40
If the radix p representation of n is (am . . . a1a0)p, prove that
n!/pœµp(n!) ‚â°(‚àí1)œµp(n!)am! . . . a1! a0!
(mod p) .
(The left side is simply n! with all p factors removed. When n = p this
reduces to Wilson's theorem.)
Wilson's theorem:
\Martha, that boy is
a menace."
41
a
Show that if p mod 4 = 3, there is no integer n such that p divides
n2 + 1. Hint: Use Fermat's theorem.
b
But show that if p mod 4 = 1, there is such an integer. Hint: Write
(p ‚àí1)! as
¬°Q(p‚àí1)/2
k=1
k(p ‚àík)
¬¢
and think about Wilson's theorem.
42
Consider two fractions m/n and m‚Ä≤/n‚Ä≤ in lowest terms. Prove that when
the sum m/n+m‚Ä≤/n‚Ä≤ is reduced to lowest terms, the denominator will be
nn‚Ä≤ if and only if n ‚ä•n‚Ä≤. (In other words, (mn‚Ä≤+m‚Ä≤n)/nn‚Ä≤ will already
be in lowest terms if and only if n and n‚Ä≤ have no common factor.)
43
There are 2k nodes at level k of the Stern{Brocot tree, corresponding to
the matrices Lk, Lk‚àí1R, . . . , Rk. Show that this sequence can be obtained
by starting with Lk and then multiplying successively by
¬µ
0
‚àí1
1
2œÅ(n) + 1
¬∂
for 1  n < 2k, where œÅ(n) is the ruler function.
44
Prove that a baseball player whose batting average is .316 must have
Radio announcer:
\. . . pitcher Mark
LeChire hits a
two-run single!
Mark, who was
batting .080, gets
his second hit of
the year."
Anything wrong?
batted at least 19 times.
(If he has m hits in n times at bat, then
m/n ‚àà[0.3155 . . 0.3165).)
45
The number 9376 has the peculiar self-reproducing property that
93762 = 87909376 .
How many 4-digit numbers x satisfy the equation x2 mod 10000 = x?
How many n-digit numbers x satisfy the equation x2 mod 10n = x?
46
a
Prove that if nj ‚â°1 and nk ‚â°1 (mod m), then ngcd(j,k) ‚â°1.
b
Show that 2n Ã∏‚â°1 (mod n), if n > 1. Hint: Consider the least prime
factor of n.
47
Show that if nm‚àí1 ‚â°1 (mod m) and if n(m‚àí1)/p Ã∏‚â°1 (mod m) for all
primes such that pn(m ‚àí1), then m is prime. Hint: Show that if this
condition holds, the numbers nk mod m are distinct, for 1  k < m.
48
Generalize Wilson's theorem (4.49) by ascertaining the value of the ex-
pression
¬°Q
1n<m, n‚ä•m n
¬¢
mod m, when m > 1.

4 EXERCISES 149
49
Let R(N) be the number of pairs of integers (m, n) such that 0  m < N,
0  n < N, and m ‚ä•n.
a
Express R(N) in terms of the Œ¶ function.
b
Prove that R(N) = P
d1‚åäN/d‚åã2¬µ(d).
50
Let m be a positive integer and let
œâ = e2œÄi/m = cos(2œÄ/m) + i sin(2œÄ/m) .
We say that œâ is an mth root of unity, since œâm = e2œÄi = 1. In fact,
What are the roots
of disunity?
each of the m complex numbers œâ0, œâ1, . . . , œâm‚àí1 is an mth root of
unity, because (œâk)m = e2œÄki = 1; therefore z ‚àíœâk is a factor of the
polynomial zm ‚àí1, for 0  k < m. Since these factors are distinct, the
complete factorization of zm ‚àí1 over the complex numbers must be
zm ‚àí1 =
Y
0k<m
(z ‚àíœâk) .
a
Let Œ®m(z) = Q
0k<m, k‚ä•m(z ‚àíœâk). (This polynomial of degree
œï(m) is called the cyclotomic polynomial of order m.) Prove that
zm ‚àí1 =
Y
dnm
Œ®d(z) .
b
Prove that Œ®m(z) = Q
dnm(zd ‚àí1)¬µ(m/d).
Exam problems
51
Prove Fermat's theorem (4.48) by expanding (1 + 1 + ¬∑ ¬∑ ¬∑ + 1)p via the
multinomial theorem.
52
Let n and x be positive integers such that x has no divisors  n (except 1),
and let p be a prime number. Prove that at least ‚åän/p‚åãof the numbers
fx ‚àí1, x2 ‚àí1, . . . , xn‚àí1 ‚àí1g are multiples of p.
53
Find all positive integers n such that n
¬≤ ¬•
(n ‚àí1)!/(n + 1)
¬¶
.
54
Determine the value of 1000! mod 10250 by hand calculation.
55
Let Pn be the product of the rst n factorials, Qn
k=1 k!.
Prove that
P2n/P4
n is an integer, for all positive integers n.
56
Show that
¬µ2n‚àí1
Y
k=1
kmin(k, 2n‚àík)
¬∂√Å¬µ n‚àí1
Y
k=1
(2k + 1)2n‚àí2k‚àí1
¬∂
is a power of 2.

150 NUMBER THEORY
57
Let S(m, n) be the set of all integers k such that
m mod k + n mod k  k .
For example, S(7, 9) = f2, 4, 5, 8, 10, 11, 12, 13, 14, 15, 16g. Prove that
X
k‚ààS(m,n)
œï(k) = mn .
Hint: Prove rst that P
1mn
P
dnm œï(d) = P
d1 œï(d)‚åän/d‚åã. Then
consider ‚åä(m + n)/d‚åã‚àí‚åäm/d‚åã‚àí‚åän/d‚åã.
58
Let f(m) = P
dnm d. Find a necessary and sucient condition that f(m)
is a power of 2.
Bonus problems
59
Prove that if x1, . . . , xn are positive integers with 1/x1 + ¬∑ ¬∑ ¬∑ + 1/xn = 1,
then max(x1, . . . , xn) < en. Hint: Prove the following stronger result by
induction: \If 1/x1 +¬∑ ¬∑ ¬∑+1/xn +1/Œ± = 1, where x1, . . . , xn are positive
integers and Œ± is a rational number  max(x1, . . . , xn), then Œ±+1  en+1
and x1 . . . xn(Œ± + 1)  e1 . . . enen+1." (The proof is nontrivial.)
60
Prove that there's a constant P such that (4.18) gives only primes. You
may use the following (highly nontrivial) fact: There is a prime between
p and p + pŒ∏, for all suciently large p, if Œ∏ >
6
11.
61
Prove that if m/n, m‚Ä≤/n‚Ä≤, and m‚Ä≤‚Ä≤/n‚Ä≤‚Ä≤ are consecutive elements of FN,
then
m‚Ä≤‚Ä≤ =
¬•
(n + N)/n‚Ä≤¬¶
m‚Ä≤ ‚àím ,
n‚Ä≤‚Ä≤ =
¬•
(n + N)/n‚Ä≤¬¶
n‚Ä≤ ‚àín .
(This recurrence allows us to compute the elements of FN in order, start-
ing with 0
1 and
1
N.)
62
What binary number corresponds to e, in the binary ‚ÜîStern{Brocot
correspondence? (Express your answer as an innite sum; you need not
evaluate it in closed form.)
63
Using only the methods of this chapter, show that if Fermat's Last The-
orem (4.46) were false, the least n for which it fails would have to be
prime. (You may assume that (4.46) holds when n = 4.) Furthermore,
if ap + bp = cp is the smallest counterexample, show that
a + b =
¬Ø mp,
if p//nc,
pp‚àí1mp,
if pnc,
for some integer m. Thus c  mp/2 must be really huge. Hint: Let
x = a + b, and note that gcd
¬°
x, (ap + (x ‚àía)p)/x
¬¢
= gcd(x, pap‚àí1).

4 EXERCISES 151
64
The Peirce sequence PN of order N is an innite string of fractions
separated by `<' or `=' signs, containing all the nonnegative fractions
m/n with m  0 and n  N (including fractions that are not reduced).
It is dened recursively by starting with
P1 =
0
1< 1
1< 2
1< 3
1< 4
1< 5
1< 6
1< 7
1< 8
1< 9
1< 10
1 < ¬∑ ¬∑ ¬∑ .
For N  1, we form PN+1 by inserting two symbols just before the kNth
symbol of PN, for all k > 0. The two inserted symbols are
k ‚àí1
N + 1
= ,
if kN is odd;
PN,kN
k ‚àí1
N + 1 ,
if kN is even.
Here PN,j denotes the jth symbol of PN, which will be either `<' or `='
when j is even; it will be a fraction when j is odd. For example,
P2 = 0
2= 0
1< 1
2< 2
2= 1
1< 3
2< 4
2= 2
1< 5
2< 6
2= 3
1< 7
2< 8
2= 4
1< 9
2< 10
2 = 5
1< ¬∑ ¬∑ ¬∑ ;
P3 = 0
2= 0
3= 0
1< 1
3< 1
2< 2
3< 2
2= 3
3= 1
1< 4
3< 3
2< 5
3< 4
2= 6
3= 2
1< 7
3< 5
2< ¬∑ ¬∑ ¬∑ ;
P4 = 0
2= 0
4= 0
3= 0
1< 1
4< 1
3< 2
4= 1
2< 2
3< 3
4< 2
2= 4
4= 3
3= 1
1< 5
4< 4
3< 6
4= ¬∑ ¬∑ ¬∑ ;
P5 = 0
2= 0
4= 0
5= 0
3= 0
1< 1
5< 1
4< 1
3< 2
5< 2
4= 1
2< 2
5< 2
3< 3
4< 4
5< 2
2= 4
4= ¬∑ ¬∑ ¬∑ ;
P6 = 0
2= 0
4= 0
6= 0
5= 0
3= 0
1< 1
6< 1
5< 1
4< 2
6= 1
3< 2
5< 2
4= 3
6= 1
2< 3
5< 4
6= ¬∑ ¬∑ ¬∑ .
(Equal elements occur in a slightly peculiar order.) Prove that the `<'
and `=' signs dened by the rules above correctly describe the relations
between adjacent fractions in the Peirce sequence.
Research problems
65
Are the Euclid numbers en all squarefree?
66
Are the Mersenne numbers 2p ‚àí1 all squarefree?
67
Prove or disprove that max1j<kn ak/gcd(aj, ak)  n, for all sequences
of integers 0 < a1 < ¬∑ ¬∑ ¬∑ < an.
68
Is there a constant Q such that ‚åäQ2n‚åãis prime for all n  0?
69
Let Pn denote the nth prime.
Prove or disprove that Pn+1 ‚àíPn =
O(log Pn)2.
70
Does œµ3(n!) = œµ2(n!)/2 for innitely many n?
71
Prove or disprove: If k Ã∏= 1 there exists n > 1 such that 2n ‚â°k (mod n).
Are there innitely many such n?
72
Prove or disprove: For all integers a, there exist innitely many n such
that œï(n)n(n + a).

152 NUMBER THEORY
73
If the Œ¶(n) + 1 terms of the Farey series
Fn =
¬≠
Fn(0), Fn(1), . . . , Fn
¬°
Œ¶(n)
¬¢¬Æ
were fairly evenly distributed, we would expect Fn(k) ‚âàk/Œ¶(n). There-
fore the sum D(n) = PŒ¶(n)
k=0
¬Ø¬ØFn(k) ‚àík/Œ¶(n)
¬Ø¬Ø measures the \deviation
of Fn from uniformity." Is it true that D(n) = O(n1/2+œµ) for all œµ > 0?
74
Approximately how many distinct values are there in the set f0! mod p,
1! mod p, . . . , (p ‚àí1)! mod pg, as p ‚Üí‚àû?

5
Binomial CoeÔ¨Écients
LET'S TAKE A BREATHER. The previous chapters have seen some heavy
going, with sums involving oor, ceiling, mod, phi, and mu functions. Now
we're going to study binomial coecients, which turn out to be (a) more
important in applications, and (b) easier to manipulate, than all those other
Lucky us!
quantities.
5.1
BASIC IDENTITIES
The symbol
¬°n
k
¬¢
is a binomial coecient, so called because of an im-
portant property we look at later this section, the binomial theorem. But we
read the symbol \n choose k." This incantation arises from its combinatorial
interpretation | it is the number of ways to choose a k-element subset from
an n-element set. For example, from the set f1, 2, 3, 4g we can choose two
Otherwise known
as combinations of
n things, k at a
time.
elements in six ways,
f1, 2g ,
f1, 3g ,
f1, 4g ,
f2, 3g ,
f2, 4g ,
f3, 4g ;
so
¬°4
2
¬¢
= 6.
To express the number
¬°n
k
¬¢
in more familiar terms it's easiest to rst
determine the number of k-element sequences, rather than subsets, chosen
from an n-element set; for sequences, the order of the elements counts. We
use the same argument we used in Chapter 4 to show that n! is the number
of permutations of n objects. There are n choices for the rst element of the
sequence; for each, there are n‚àí1 choices for the second; and so on, until there
are n‚àík+1 choices for the kth. This gives n(n‚àí1) . . . (n‚àík+1) = nk choices
in all. And since each k-element subset has exactly k! dierent orderings, this
number of sequences counts each subset exactly k! times. To get our answer,
we simply divide by k!:
¬µn
k
¬∂
= n(n ‚àí1) . . . (n ‚àík + 1)
k(k ‚àí1) . . . (1)
.
153

154 BINOMIAL COEFFICIENTS
For example,
¬µ4
2
¬∂
= 4¬∑3
2¬∑1 = 6 ;
this agrees with our previous enumeration.
We call n the upper index and k the lower index.
The indices are
restricted to be nonnegative integers by the combinatorial interpretation, be-
cause sets don't have negative or fractional numbers of elements. But the
binomial coecient has many uses besides its combinatorial interpretation,
so we will remove some of the restrictions.
It's most useful, it turns out,
to allow an arbitrary real (or even complex) number to appear in the upper
index, and to allow an arbitrary integer in the lower. Our formal denition
therefore takes the following form:
¬µr
k
¬∂
=
Ô£±
Ô£¥
Ô£≤
Ô£¥
Ô£≥
r(r ‚àí1) . . . (r ‚àík + 1)
k(k ‚àí1) . . . (1)
= rk
k! ,
integer k  0;
0 ,
integer k < 0.
(5.1)
This denition has several noteworthy features. First, the upper index is
called r, not n; the letter r emphasizes the fact that binomial coecients make
sense when any real number appears in this position. For instance, we have
¬°‚àí1
3
¬¢
= (‚àí1)(‚àí2)(‚àí3)/(3¬∑2¬∑1) = ‚àí1. There's no combinatorial interpretation
here, but r = ‚àí1 turns out to be an important special case. A noninteger
index like r = ‚àí1/2 also turns out to be useful.
Second, we can view
¬°r
k
¬¢
as a kth-degree polynomial in r. We'll see that
this viewpoint is often helpful.
Third, we haven't dened binomial coecients for noninteger lower in-
dices. A reasonable denition can be given, but actual applications are rare,
so we will defer this generalization to later in the chapter.
Final note: We've listed the restrictions `integer k  0' and `integer
k < 0' at the right of the denition. Such restrictions will be listed in all
the identities we will study, so that the range of applicability will be clear.
In general the fewer restrictions the better, because an unrestricted identity
is most useful; still, any restrictions that apply are an important part of
the identity. When we manipulate binomial coecients, it's easier to ignore
dicult-to-remember restrictions temporarily and to check later that nothing
has been violated. But the check needs to be made.
For example, almost every time we encounter
¬°n
n
¬¢
it equals 1, so we can
get lulled into thinking that it's always 1. But a careful look at denition (5.1)
tells us that
¬°n
n
¬¢
is 1 only when n  0 (assuming that n is an integer); when
n < 0 we have
¬°n
n
¬¢
= 0. Traps like this can (and will) make life adventuresome.

5.1 BASIC IDENTITIES 155
Before getting to the identities that we will use to tame binomial coe-
cients, let's take a peek at some small values. The numbers in Table 155 form
the beginning of Pascal's triangle, named after Blaise Pascal (1623{1662)
Table 155 Pascal's triangle.
n
¬µn
0
¬∂ ¬µn
1
¬∂ ¬µn
2
¬∂ ¬µn
3
¬∂ ¬µn
4
¬∂ ¬µn
5
¬∂ ¬µn
6
¬∂ ¬µn
7
¬∂ ¬µn
8
¬∂ ¬µn
9
¬∂ ¬µ n
10
¬∂
0
1
1
1
1
2
1
2
1
3
1
3
3
1
4
1
4
6
4
1
5
1
5
10
10
5
1
6
1
6
15
20
15
6
1
7
1
7
21
35
35
21
7
1
8
1
8
28
56
70
56
28
8
1
9
1
9
36
84
126
126
84
36
9
1
10
1
10
45
120
210
252
210
120
45
10
1
because he wrote an inuential treatise about them [285]. The empty entries
Binomial coecients
were well known
in Asia, many cen-
turies before Pascal
was born [90], but
he had no way to
know that.
in this table are actually 0's, because of a zero in the numerator of (5.1); for
example,
¬°1
2
¬¢
= (1¬∑0)/(2¬∑1) = 0. These entries have been left blank simply to
help emphasize the rest of the table.
It's worthwhile to memorize formulas for the rst three columns,
¬µr
0
¬∂
= 1 ,
¬µr
1
¬∂
= r ,
¬µr
2
¬∂
= r(r ‚àí1)
2
;
(5.2)
these hold for arbitrary reals. (Recall that
¬°n+1
2
¬¢
= 1
2n(n + 1) is the formula
we derived for triangular numbers in Chapter 1; triangular numbers are con-
spicuously present in the
¬°n
2
¬¢
column of Table 155.) It's also a good idea to
memorize the rst ve rows or so of Pascal's triangle, so that when the pat-
tern 1, 4, 6, 4, 1 appears in some problem we will have a clue that binomial
coecients probably lurk nearby.
The numbers in Pascal's triangle satisfy, practically speaking, innitely
In Italy it's called
Tartaglia's triangle.
many identities, so it's not too surprising that we can nd some surprising
relationships by looking closely.
For example, there's a curious \hexagon
property," illustrated by the six numbers 56, 28, 36, 120, 210, 126 that sur-
round 84 in the lower right portion of Table 155. Both ways of multiplying
alternate numbers from this hexagon give the same product: 56 ¬∑ 36 ¬∑ 210 =
28 ¬∑ 120 ¬∑ 126 = 423360. The same thing holds if we extract such a hexagon
from any other part of Pascal's triangle.

156 BINOMIAL COEFFICIENTS
And now the identities. Our goal in this section will be to learn a few
\C'est une chose
estrange combien
il est fertile en
proprietez."
|B. Pascal [285]
simple rules by which we can solve the vast majority of practical problems
involving binomial coecients.
Denition (5.1) can be recast in terms of factorials in the common case
that the upper index r is an integer, n, that's greater than or equal to the
lower index k:
¬µn
k
¬∂
=
n!
k! (n ‚àík)! ,
integers n  k  0.
(5.3)
To get this formula, we just multiply the numerator and denominator of (5.1)
by (n ‚àík)!. It's occasionally useful to expand a binomial coecient into this
factorial form (for example, when proving the hexagon property). And we
often want to go the other way, changing factorials into binomials.
The factorial representation hints at a symmetry in Pascal's triangle:
Each row reads the same left-to-right as right-to-left. The identity reecting
this | called the symmetry identity | is obtained by changing k to n ‚àík:
¬µn
k
¬∂
=
¬µ
n
n ‚àík
¬∂
,
integer n  0,
integer k.
(5.4)
This formula makes combinatorial sense, because by specifying the k chosen
things out of n we're in eect specifying the n ‚àík unchosen things.
The restriction that n and k be integers in identity (5.4) is obvious, since
each lower index must be an integer. But why can't n be negative? Suppose,
for example, that n = ‚àí1. Is
¬µ‚àí1
k
¬∂
?=
¬µ
‚àí1
‚àí1 ‚àík
¬∂
a valid equation? No. For instance, when k = 0 we get 1 on the left and 0 on
the right. In fact, for any integer k  0 the left side is
¬µ‚àí1
k
¬∂
= (‚àí1)(‚àí2) . . . (‚àík)
k!
= (‚àí1)k ,
which is either 1 or ‚àí1; but the right side is 0, because the lower index is
negative. And for negative k the left side is 0 but the right side is
¬µ
‚àí1
‚àí1 ‚àík
¬∂
= (‚àí1)‚àí1‚àík ,
which is either 1 or ‚àí1. So the equation `
¬°‚àí1
k
¬¢
=
¬° ‚àí1
‚àí1‚àík
¬¢
' is always false!
The symmetry identity fails for all other negative integers n, too. But
unfortunately it's all too easy to forget this restriction, since the expression
in the upper index is sometimes negative only for obscure (but legal) values

5.1 BASIC IDENTITIES 157
of its variables. Everyone who's manipulated binomial coecients much has
I just hope I don't
fall into this trap
during the midterm.
fallen into this trap at least three times.
But the symmetry identity does have a big redeeming feature: It works
for all values of k, even when k < 0 or k > n. (Because both sides are zero in
such cases.) Otherwise 0  k  n, and symmetry follows immediately from
(5.3):
¬µn
k
¬∂
=
n!
k! (n ‚àík)! =
n!
¬°
n ‚àí(n ‚àík)
¬¢
! (n ‚àík)! =
¬µ
n
n ‚àík
¬∂
.
Our next important identity lets us move things in and out of binomial
coecients:
¬µr
k
¬∂
= r
k
¬µr ‚àí1
k ‚àí1
¬∂
,
integer k Ã∏= 0.
(5.5)
The restriction on k prevents us from dividing by 0 here.
We call (5.5)
an absorption identity, because we often use it to absorb a variable into a
binomial coecient when that variable is a nuisance outside. The equation
follows from denition (5.1), because rk = r(r ‚àí1)k‚àí1 and k! = k(k ‚àí1)!
when k > 0; both sides are zero when k < 0.
If we multiply both sides of (5.5) by k, we get an absorption identity that
works even when k = 0:
k
¬µr
k
¬∂
= r
¬µr ‚àí1
k ‚àí1
¬∂
,
integer k.
(5.6)
This one also has a companion that keeps the lower index intact:
(r ‚àík)
¬µr
k
¬∂
= r
¬µr ‚àí1
k
¬∂
,
integer k.
(5.7)
We can derive (5.7) by sandwiching an application of (5.6) between two ap-
plications of symmetry:
(r ‚àík)
¬µr
k
¬∂
= (r ‚àík)
¬µ
r
r ‚àík
¬∂
(by symmetry)
= r
¬µ
r ‚àí1
r ‚àík ‚àí1
¬∂
¬°
by (5.6)
¬¢
= r
¬µr ‚àí1
k
¬∂
.
(by symmetry)
But wait a minute. We've claimed that the identity holds for all real r,
yet the derivation we just gave holds only when r is a positive integer. (The
upper index r ‚àí1 must be a nonnegative integer if we're to use the symmetry

158 BINOMIAL COEFFICIENTS
property (5.4) with impunity.) Have we been cheating? No. It's true that
(Well, not here
anyway.)
the derivation is valid only for positive integers r; but we can claim that the
identity holds for all values of r, because both sides of (5.7) are polynomials
in r of degree k + 1. A nonzero polynomial of degree d or less can have at
most d distinct zeros; therefore the dierence of two such polynomials, which
also has degree d or less, cannot be zero at more than d points unless it is
identically zero. In other words, if two polynomials of degree d or less agree
at more than d points, they must agree everywhere. We have shown that
(r ‚àík)
¬°r
k
¬¢
= r
¬°r‚àí1
k
¬¢
whenever r is a positive integer; so these two polynomials
agree at innitely many points, and they must be identically equal.
The proof technique in the previous paragraph, which we will call the
polynomial argument, is useful for extending many identities from integers
to reals; we'll see it again and again.
Some equations, like the symmetry
identity (5.4), are not identities between polynomials, so we can't always use
this method. But many identities do have the necessary form.
For example, here's another polynomial identity, perhaps the most im-
portant binomial identity of all, known as the addition formula:
¬µr
k
¬∂
=
¬µr ‚àí1
k
¬∂
+
¬µr ‚àí1
k ‚àí1
¬∂
,
integer k.
(5.8)
When r is a positive integer, the addition formula tells us that every number
in Pascal's triangle is the sum of two numbers in the previous row, one directly
above it and the other just to the left. And the formula applies also when r
is negative, real, or complex; the only restriction is that k be an integer, so
that the binomial coecients are dened.
One way to prove the addition formula is to assume that r is a positive
integer and to use the combinatorial interpretation. Recall that
¬°r
k
¬¢
is the
number of possible k-element subsets chosen from an r-element set. If we
have a set of r eggs that includes exactly one bad egg, there are
¬°r
k
¬¢
ways to
select k of the eggs. Exactly
¬°r‚àí1
k
¬¢
of these selections involve nothing but good
eggs; and
¬°r‚àí1
k‚àí1
¬¢
of them contain the bad egg, because such selections have
k ‚àí1 of the r ‚àí1 good eggs. Adding these two numbers together gives (5.8).
This derivation assumes that r is a positive integer, and that k  0. But
both sides of the identity are zero when k < 0, and the polynomial argument
establishes (5.8) in all remaining cases.
We can also derive (5.8) by adding together the two absorption identities
(5.7) and (5.6):
(r ‚àík)
¬µr
k
¬∂
+ k
¬µr
k
¬∂
= r
¬µr ‚àí1
k
¬∂
+ r
¬µr ‚àí1
k ‚àí1
¬∂
;
the left side is r
¬°r
k
¬¢
, and we can divide through by r. This derivation is valid
for everything but r = 0, and it's easy to check that remaining case.

5.1 BASIC IDENTITIES 159
Those of us who tend not to discover such slick proofs, or who are oth-
erwise into tedium, might prefer to derive (5.8) by a straightforward manip-
ulation of the denition. If k > 0,
¬µr ‚àí1
k
¬∂
+
¬µr ‚àí1
k ‚àí1
¬∂
= (r ‚àí1)k
k!
+ (r ‚àí1)k‚àí1
(k ‚àí1)!
= (r ‚àí1)k‚àí1 (r ‚àík)
k!
+ (r ‚àí1)k‚àí1 k
k!
= (r ‚àí1)k‚àí1 r
k!
= rk
k! =
¬µr
k
¬∂
.
Again, the cases for k  0 are easy to handle.
We've just seen three rather dierent proofs of the addition formula. This
is not surprising; binomial coecients have many useful properties, several of
which are bound to lead to proofs of an identity at hand.
The addition formula is essentially a recurrence for the numbers of Pas-
cal's triangle, so we'll see that it is especially useful for proving other identities
by induction. We can also get a new identity immediately by unfolding the
recurrence. For example,
¬µ5
3
¬∂
=
¬µ4
3
¬∂
+
¬µ4
2
¬∂
=
¬µ4
3
¬∂
+
¬µ3
2
¬∂
+
¬µ3
1
¬∂
=
¬µ4
3
¬∂
+
¬µ3
2
¬∂
+
¬µ2
1
¬∂
+
¬µ2
0
¬∂
=
¬µ4
3
¬∂
+
¬µ3
2
¬∂
+
¬µ2
1
¬∂
+
¬µ1
0
¬∂
+
¬µ 1
‚àí1
¬∂
.
Since
¬° 1
‚àí1
¬¢
= 0, that term disappears and we can stop. This method yields
the general formula
X
kn
¬µr + k
k
¬∂
=
¬µr
0
¬∂
+
¬µr + 1
1
¬∂
+ ¬∑ ¬∑ ¬∑ +
¬µr + n
n
¬∂
=
¬µr + n + 1
n
¬∂
,
integer n.
(5.9)
Notice that we don't need the lower limit k  0 on the index of summation,
because the terms with k < 0 are zero.
This formula expresses one binomial coecient as the sum of others whose
upper and lower indices stay the same distance apart. We found it by repeat-
edly expanding the binomial coecient with the smallest lower index: rst

160 BINOMIAL COEFFICIENTS
¬°5
3
¬¢
, then
¬°4
2
¬¢
, then
¬°3
1
¬¢
, then
¬°2
0
¬¢
. What happens if we unfold the other way,
repeatedly expanding the one with largest lower index? We get
¬µ5
3
¬∂
=
¬µ4
3
¬∂
+
¬µ4
2
¬∂
=
¬µ3
3
¬∂
+
¬µ3
2
¬∂
+
¬µ4
2
¬∂
=
¬µ2
3
¬∂
+
¬µ2
2
¬∂
+
¬µ3
2
¬∂
+
¬µ4
2
¬∂
=
¬µ1
3
¬∂
+
¬µ1
2
¬∂
+
¬µ2
2
¬∂
+
¬µ3
2
¬∂
+
¬µ4
2
¬∂
=
¬µ0
3
¬∂
+
¬µ0
2
¬∂
+
¬µ1
2
¬∂
+
¬µ2
2
¬∂
+
¬µ3
2
¬∂
+
¬µ4
2
¬∂
.
Now
¬°0
3
¬¢
is zero (so are
¬°0
2
¬¢
and
¬°1
2
¬¢
, but these make the identity nicer), and
we can spot the general pattern:
X
0kn
¬µ k
m
¬∂
=
¬µ 0
m
¬∂
+
¬µ 1
m
¬∂
+ ¬∑ ¬∑ ¬∑ +
¬µn
m
¬∂
=
¬µn + 1
m + 1
¬∂
,
integers m, n  0.
(5.10)
This identity, which we call summation on the upper index, expresses a
binomial coecient as the sum of others whose lower indices are constant. In
this case the sum needs the lower limit k  0, because the terms with k < 0
aren't zero. Also, m and n can't in general be negative.
Identity (5.10) has an interesting combinatorial interpretation. If we want
to choose m + 1 tickets from a set of n + 1 tickets numbered 0 through n,
there are
¬° k
m
¬¢
ways to do this when the largest ticket selected is number k.
We can prove both (5.9) and (5.10) by induction using the addition
formula, but we can also prove them from each other.
For example, let's
prove (5.9) from (5.10); our proof will illustrate some common binomial co-
ecient manipulations.
Our general plan will be to massage the left side
P ¬°r+k
k
¬¢
of (5.9) so that it looks like the left side P ¬° k
m
¬¢
of (5.10); then we'll
invoke that identity, replacing the sum by a single binomial coecient; nally
we'll transform that coecient into the right side of (5.9).
We can assume for convenience that r and n are nonnegative integers;
the general case of (5.9) follows from this special case, by the polynomial
argument. Let's write m instead of r, so that this variable looks more like
a nonnegative integer. The plan can now be carried out systematically as

5.1 BASIC IDENTITIES 161
follows:
X
kn
¬µm + k
k
¬∂
=
X
‚àímkn
¬µm + k
k
¬∂
=
X
‚àímkn
¬µm + k
m
¬∂
=
X
0km+n
¬µ k
m
¬∂
=
¬µm + n + 1
m + 1
¬∂
=
¬µm + n + 1
n
¬∂
.
Let's look at this derivation blow by blow. The key step is in the second line,
where we apply the symmetry law (5.4) to replace
¬°m+k
k
¬¢
by
¬°m+k
m
¬¢
. We're
allowed to do this only when m + k  0, so our rst step restricts the range
of k by discarding the terms with k < ‚àím. (This is legal because those terms
are zero.) Now we're almost ready to apply (5.10); the third line sets this up,
replacing k by k ‚àím and tidying up the range of summation. This step, like
the rst, merely plays around with P-notation. Now k appears by itself in
the upper index and the limits of summation are in the proper form, so the
fourth line applies (5.10). One more use of symmetry nishes the job.
Certain sums that we did in Chapters 1 and 2 were actually special cases
of (5.10), or disguised versions of this identity. For example, the case m = 1
gives the sum of the nonnegative integers up through n:
¬µ0
1
¬∂
+
¬µ1
1
¬∂
+ ¬∑ ¬∑ ¬∑ +
¬µn
1
¬∂
= 0 + 1 + ¬∑ ¬∑ ¬∑ + n = (n + 1)n
2
=
¬µn + 1
2
¬∂
.
And the general case is equivalent to Chapter 2's rule
X
0kn
km = (n + 1)m+1
m + 1
,
integers m, n  0,
if we divide both sides of this formula by m!. In fact, the addition formula
(5.8) tells us that
‚àÜ
¬µ¬µ x
m
¬∂¬∂
=
¬µx + 1
m
¬∂
‚àí
¬µ x
m
¬∂
=
¬µ
x
m ‚àí1
¬∂
,
if we replace r and k respectively by x + 1 and m. Hence the methods of
Chapter 2 give us the handy indenite summation formula
X ¬µ x
m
¬∂
Œ¥x =
¬µ
x
m + 1
¬∂
+ C .
(5.11)

162 BINOMIAL COEFFICIENTS
Binomial coecients get their name from the binomial theorem, which
deals with powers of the binomial expression x + y. Let's look at the smallest
\At the age of
twenty-one
he [Moriarty] wrote
a treatise upon the
Binomial Theorem,
which has had a Eu-
ropean vogue. On
the strength of it,
he won the Math-
ematical Chair at
one of our smaller
Universities."
|S. Holmes [84]
cases of this theorem:
(x + y)0 = 1x0y0
(x + y)1 = 1x1y0 + 1x0y1
(x + y)2 = 1x2y0 + 2x1y1 + 1x0y2
(x + y)3 = 1x3y0 + 3x2y1 + 3x1y2 + 1x0y3
(x + y)4 = 1x4y0 + 4x3y1 + 6x2y2 + 4x1y3 + 1x0y4 .
It's not hard to see why these coecients are the same as the numbers in
Pascal's triangle: When we expand the product
(x + y)n =
n factors
z
}|
{
(x + y)(x + y) . . . (x + y) ,
every term is itself the product of n factors, each either an x or y. The number
of such terms with k factors of x and n ‚àík factors of y is the coecient
of xkyn‚àík after we combine like terms. And this is exactly the number of
ways to choose k of the n binomials from which an x will be contributed; that
is, it's
¬°n
k
¬¢
.
Some textbooks leave the quantity 00 undened, because the functions
x0 and 0x have dierent limiting values when x decreases to 0. But this is a
mistake. We must dene
x0 = 1 ,
for all x,
if the binomial theorem is to be valid when x = 0, y = 0, and/or x = ‚àíy.
The theorem is too important to be arbitrarily restricted! By contrast, the
function 0x is quite unimportant. (See [220] for further discussion.)
But what exactly is the binomial theorem?
In its full glory it is the
following identity:
(x + y)r =
X
k
¬µr
k
¬∂
xkyr‚àík ,
integer r  0
or jx/yj < 1.
(5.12)
The sum is over all integers k; but it is really a nite sum when r is a nonneg-
ative integer, because all terms are zero except those with 0  k  r. On the
other hand, the theorem is also valid when r is negative, or even when r is
an arbitrary real or complex number. In such cases the sum really is innite,
and we must have jx/yj < 1 to guarantee the sum's absolute convergence.

5.1 BASIC IDENTITIES 163
Two special cases of the binomial theorem are worth special attention,
even though they are extremely simple. If x = y = 1 and r = n is nonnegative,
we get
2n =
¬µn
0
¬∂
+
¬µn
1
¬∂
+ ¬∑ ¬∑ ¬∑ +
¬µn
n
¬∂
,
integer n  0.
This equation tells us that row n of Pascal's triangle sums to 2n. And when
x is ‚àí1 instead of +1, we get
0n =
¬µn
0
¬∂
‚àí
¬µn
1
¬∂
+ ¬∑ ¬∑ ¬∑ + (‚àí1)n
¬µn
n
¬∂
,
integer n  0.
For example, 1 ‚àí4 + 6 ‚àí4 + 1 = 0; the elements of row n sum to zero if we
give them alternating signs, except in the top row (when n = 0 and 00 = 1).
When r is not a nonnegative integer, we most often use the binomial
theorem in the special case y = 1. Let's state this special case explicitly,
writing z instead of x to emphasize the fact that an arbitrary complex number
can be involved here:
(1 + z)r =
X
k
¬µr
k
¬∂
zk ,
jzj < 1.
(5.13)
The general formula in (5.12) follows from this one if we set z = x/y and
multiply both sides by yr.
We have proved the binomial theorem only when r is a nonnegative in-
teger, by using a combinatorial interpretation. We can't deduce the general
case from the nonnegative-integer case by using the polynomial argument,
because the sum is innite in the general case. But when r is arbitrary, we
can use Taylor series and the theory of complex variables:
f(z) = f(0)
0! z0 + f‚Ä≤(0)
1! z1 + f‚Ä≤‚Ä≤(0)
2!
z2 + ¬∑ ¬∑ ¬∑
=
X
k0
f(k)(0)
k!
zk .
The derivatives of the function f(z) = (1 + z)r are easily evaluated; in fact,
f(k)(z) = rk (1 + z)r‚àík. Setting z = 0 gives (5.13).
We also need to prove that the innite sum converges, when jzj < 1. It
(Chapter 9 tells the
meaning of O.)
does, because
¬°r
k
¬¢
= O(k‚àí1‚àír) by equation (5.83) below.
Now let's look more closely at the values of
¬°n
k
¬¢
when n is a negative
integer. One way to approach these values is to use the addition law (5.8) to
ll in the entries that lie above the numbers in Table 155, thereby obtaining
Table 164. For example, we must have
¬°‚àí1
0
¬¢
= 1, since
¬°0
0
¬¢
=
¬°‚àí1
0
¬¢
+
¬°‚àí1
‚àí1
¬¢
and
¬°‚àí1
‚àí1
¬¢
= 0; then we must have
¬°‚àí1
1
¬¢
= ‚àí1, since
¬°0
1
¬¢
=
¬°‚àí1
1
¬¢
+
¬°‚àí1
0
¬¢
; and so on.

164 BINOMIAL COEFFICIENTS
Table 164 Pascal's triangle, extended upward.
n
¬µn
0
¬∂ ¬µn
1
¬∂ ¬µn
2
¬∂ ¬µn
3
¬∂ ¬µn
4
¬∂ ¬µn
5
¬∂ ¬µn
6
¬∂
¬µn
7
¬∂
¬µn
8
¬∂
¬µn
9
¬∂
¬µ n
10
¬∂
‚àí4
1
‚àí4
10
‚àí20
35
‚àí56
84
‚àí120
165
‚àí220
286
‚àí3
1
‚àí3
6
‚àí10
15
‚àí21
28
‚àí36
45
‚àí55
66
‚àí2
1
‚àí2
3
‚àí4
5
‚àí6
7
‚àí8
9
‚àí10
11
‚àí1
1
‚àí1
1
‚àí1
1
‚àí1
1
‚àí1
1
‚àí1
1
0
1
0
0
0
0
0
0
0
0
0
0
All these numbers are familiar. Indeed, the rows and columns of Ta-
ble 164 appear as columns in Table 155 (but minus the minus signs).
So
there must be a connection between the values of
¬°n
k
¬¢
for negative n and the
values for positive n. The general rule is
¬µr
k
¬∂
= (‚àí1)k
¬µk ‚àír ‚àí1
k
¬∂
,
integer k;
(5.14)
it is easily proved, since
rk = r(r ‚àí1) . . . (r ‚àík + 1)
= (‚àí1)k(‚àír)(1 ‚àír) . . . (k ‚àí1 ‚àír) = (‚àí1)k(k ‚àír ‚àí1)k
when k  0, and both sides are zero when k < 0.
Identity (5.14) is particularly valuable because it holds without any re-
striction. (Of course, the lower index must be an integer so that the binomial
coecients are dened.) The transformation in (5.14) is called negating the
upper index, or \upper negation."
But how can we remember this important formula? The other identities
we've seen | symmetry, absorption, addition, etc. | are pretty simple, but
this one looks rather messy. Still, there's a mnemonic that's not too bad: To
You call this a
mnemonic? I'd call
it pneumatic|
full of air.
It does help me
remember, though.
negate the upper index, we begin by writing down (‚àí1)k, where k is the lower
index. (The lower index doesn't change.) Then we immediately write k again,
twice, in both lower and upper index positions. Then we negate the original
upper index by subtracting it from the new upper index. And we complete
the job by subtracting 1 more (always subtracting, not adding, because this
is a negation process).
Let's negate the upper index twice in succession, for practice. We get
(Now is a good
time to do warmup
exercise 4.)
¬µr
k
¬∂
= (‚àí1)k
¬µk ‚àír ‚àí1
k
¬∂
= (‚àí1)2k
¬µk ‚àí(k ‚àír ‚àí1) ‚àí1
k
¬∂
=
¬µr
k
¬∂
,

5.1 BASIC IDENTITIES 165
so we're right back where we started. This is probably not what the framers of
the identity intended; but it's reassuring to know that we haven't gone astray.
It's also frustrating,
if we're trying to
get somewhere else.
Some applications of (5.14) are, of course, more useful than this. We can
use upper negation, for example, to move quantities between upper and lower
index positions. The identity has a symmetric formulation,
(‚àí1)m
¬µ‚àín ‚àí1
m
¬∂
= (‚àí1)n
¬µ‚àím ‚àí1
n
¬∂
,
integers m, n  0,
(5.15)
which holds because both sides are equal to
¬°m+n
n
¬¢
.
Upper negation can also be used to derive the following interesting sum:
X
km
¬µr
k
¬∂
(‚àí1)k =
¬µr
0
¬∂
‚àí
¬µr
1
¬∂
+ ¬∑ ¬∑ ¬∑ + (‚àí1)m
¬µ r
m
¬∂
= (‚àí1)m
¬µr ‚àí1
m
¬∂
,
integer m.
(5.16)
The idea is to negate the upper index, then apply (5.9), and negate again:
(Here double nega-
tion helps, because
we've sandwiched
another operation in
between.)
X
km
¬µr
k
¬∂
(‚àí1)k =
X
km
¬µk ‚àír ‚àí1
k
¬∂
=
¬µ‚àír + m
m
¬∂
= (‚àí1)m
¬µr ‚àí1
m
¬∂
.
This formula gives us a partial sum of the rth row of Pascal's triangle, provided
that the entries of the row have been given alternating signs. For instance, if
r = 5 and m = 2 the formula gives 1 ‚àí5 + 10 = 6 = (‚àí1)2¬°4
2
¬¢
.
Notice that if m  r, (5.16) gives the alternating sum of the entire row,
and this sum is zero when r is a positive integer. We proved this before, when
we expanded (1 ‚àí1)r by the binomial theorem; it's interesting to know that
the partial sums of this expression can also be evaluated in closed form.
How about the simpler partial sum,
X
km
¬µn
k
¬∂
=
¬µn
0
¬∂
+
¬µn
1
¬∂
+ ¬∑ ¬∑ ¬∑ +
¬µn
m
¬∂
;
(5.17)
surely if we can evaluate the corresponding sum with alternating signs, we
ought to be able to do this one? But no; there is no closed form for the partial
sum of a row of Pascal's triangle. We can do columns | that's (5.10) | but

166 BINOMIAL COEFFICIENTS
not rows. Curiously, however, there is a way to partially sum the row elements
if they have been multiplied by their distance from the center:
X
km
¬µr
k
¬∂¬≥ r
2 ‚àík
¬¥
= m + 1
2
¬µ
r
m + 1
¬∂
,
integer m.
(5.18)
(This formula is easily veried by induction on m.) The relation between
these partial sums with and without the factor of (r/2 ‚àík) in the summand
is analogous to the relation between the integrals
Z Œ±
‚àí‚àû
xe‚àíx2dx = ‚àí1
2e‚àíŒ±2
and
Z Œ±
‚àí‚àû
e‚àíx2dx .
The apparently more complicated integral on the left, with the factor of x,
has a closed form, while the simpler-looking integral on the right, without the
factor, has none. Appearances can be deceiving.
(Well, the right-
hand integral is
1
2
‚àöœÄ(1 + erf Œ±),
a constant plus a
multiple of the \er-
ror function" of Œ±,
if we're willing to
accept that as a
closed form.)
Near the end of this chapter, we'll study a method by which it's possible
to determine whether or not there is a closed form for the partial sums of a
given series involving binomial coecients, in a fairly general setting. This
method is capable of discovering identities (5.16) and (5.18), and it also will
tell us that (5.17) is a dead end.
Partial sums of the binomial series lead to a curious relationship of an-
other kind:
X
km
¬µm+r
k
¬∂
xkym‚àík =
X
km
¬µ‚àír
k
¬∂
(‚àíx)k(x + y)m‚àík ,
integer m.(5.19)
This identity isn't hard to prove by induction: Both sides are zero when
m < 0 and 1 when m = 0. If we let Sm stand for the sum on the left, we can
apply the addition formula (5.8) and show easily that
Sm =
X
km
¬µm ‚àí1 + r
k
¬∂
xkym‚àík +
X
km
¬µm ‚àí1 + r
k ‚àí1
¬∂
xkym‚àík ;
and
X
km
¬µm ‚àí1 + r
k
¬∂
xkym‚àík = ySm‚àí1 +
¬µm ‚àí1 + r
m
¬∂
xm ,
X
km
¬µm ‚àí1 + r
k ‚àí1
¬∂
xkym‚àík = xSm‚àí1 ,
when m > 0. Hence
Sm = (x + y)Sm‚àí1 +
¬µ‚àír
m
¬∂
(‚àíx)m ,

5.1 BASIC IDENTITIES 167
and this recurrence is satised also by the right-hand side of (5.19).
By
induction, both sides must be equal; QED.
But there's a neater proof. When r is an integer in the range 0  r  ‚àím,
the binomial theorem tells us that both sides of (5.19) are (x + y)m+ry‚àír.
And since both sides are polynomials in r of degree m or less, agreement at
m+1 dierent values is enough (but just barely!) to prove equality in general.
It may seem foolish to have an identity where one sum equals another.
Neither side is in closed form. But sometimes one side turns out to be easier
to evaluate than the other. For example, if we set x = ‚àí1 and y = 1, we get
X
km
¬µm + r
k
¬∂
(‚àí1)k =
¬µ‚àír
m
¬∂
,
integer m  0,
an alternative form of identity (5.16). And if we set x = y = 1 and r = m+1,
we get
X
km
¬µ2m + 1
k
¬∂
=
X
km
¬µm + k
k
¬∂
2m‚àík .
The left-hand side sums just half of the binomial coecients with upper index
2m + 1, and these are equal to their counterparts in the other half because
Pascal's triangle has left-right symmetry.
Hence the left-hand side is just
1
222m+1 = 22m. This yields a formula that is quite unexpected,
(There's a nice com-
binatorial proof of
this formula [247].)
X
km
¬µm + k
k
¬∂
2‚àík = 2m ,
integer m  0.
(5.20)
Let's check it when m = 2:
¬°2
0
¬¢
+ 1
2
¬°3
1
¬¢
+ 1
4
¬°4
2
¬¢
= 1 + 3
2 + 6
4 = 4. Astounding.
So far we've been looking either at binomial coecients by themselves or
at sums of terms in which there's only one binomial coecient per term. But
many of the challenging problems we face involve products of two or more
binomial coecients, so we'll spend the rest of this section considering how
to deal with such cases.
Here's a handy rule that often helps to simplify the product of two bino-
mial coecients:
¬µ r
m
¬∂¬µm
k
¬∂
=
¬µr
k
¬∂¬µ r ‚àík
m ‚àík
¬∂
,
integers m, k.
(5.21)
We've already seen the special case k = 1; it's the absorption identity (5.6).
Although both sides of (5.21) are products of binomial coecients, one side
often is easier to sum because of interactions with the rest of a formula. For
example, the left side uses m twice, the right side uses it only once. Therefore
we usually want to replace
¬° r
m
¬¢¬°m
k
¬¢
by
¬°r
k
¬¢¬° r‚àík
m‚àík
¬¢
when summing on m.

168 BINOMIAL COEFFICIENTS
Equation (5.21) holds primarily because of cancellation between m!'s in
the factorial representations of
¬° r
m
¬¢
and
¬°m
k
¬¢
. If all variables are integers and
r  m  k  0, we have
¬µ r
m
¬∂¬µm
k
¬∂
=
r!
m! (r ‚àím)!
m!
k! (m ‚àík)!
=
r!
k! (m ‚àík)! (r ‚àím)!
=
r!
k! (r ‚àík)!
(r ‚àík)!
(m ‚àík)! (r ‚àím)! =
¬µr
k
¬∂¬µ r ‚àík
m ‚àík
¬∂
.
That was easy. Furthermore, if m < k or k < 0, both sides of (5.21) are
Yeah, right.
zero; so the identity holds for all integers m and k. Finally, the polynomial
argument extends its validity to all real r.
A binomial coecient
¬°r
k
¬¢
= r!/(r ‚àík)! k! can be written in the form
(a + b)!/a! b! after a suitable renaming of variables. Similarly, the quantity
in the middle of the derivation above, r!/k! (m ‚àík)! (r ‚àím)!, can be written
in the form (a + b + c)!/a! b! c!. This is a \trinomial coecient," which arises
in the \trinomial theorem":
(x + y + z)n =
X
0a,b,cn
a+b+c=n
(a + b + c)!
a! b! c!
xaybzc
=
X
0a,b,cn
a+b+c=n
¬µa + b + c
b + c
¬∂¬µb + c
c
¬∂
xaybzc .
So
¬° r
m
¬¢¬°m
k
¬¢
is really a trinomial coecient in disguise. Trinomial coecients
\Excogitavi autem
olim mirabilem
regulam pro nu-
meris coecientibus
potestatum, non
tantum a binomio
x + y, sed et a
trinomio x + y + z,
imo a polynomio
quocunque, ut data
potentia gradus
cujuscunque v.
gr. decimi, et
potentia in ejus
valore comprehensa,
ut x5y3z2 , possim
statim assignare
numerum coef-
cientem, quem
habere debet, sine
ulla Tabula jam
calculata."
|G.W.Leibniz [245]
pop up occasionally in applications, and we can conveniently write them as
¬µa + b + c
a, b, c
¬∂
= (a + b + c)!
a! b! c!
in order to emphasize the symmetry present.
Binomial and trinomial coecients generalize to multinomial coe-
cients, which are always expressible as products of binomial coecients:
¬µa1 + a2 + ¬∑ ¬∑ ¬∑ + am
a1, a2, . . . , am
¬∂
= (a1 + a2 + ¬∑ ¬∑ ¬∑ + am)!
a1! a2! . . . am!
=
¬µa1 + a2 + ¬∑ ¬∑ ¬∑ + am
a2 + ¬∑ ¬∑ ¬∑ + am
¬∂
. . .
¬µam‚àí1 + am
am
¬∂
.
Therefore, when we run across such a beastie, our standard techniques apply.

5.1 BASIC IDENTITIES 169
Table 169 Sums of products of binomial coecients.
X
k
¬µ
r
m + k
¬∂¬µ
s
n ‚àík
¬∂
=
¬µ r + s
m + n
¬∂
,
integers m, n. (5.22)
X
k
¬µ
l
m + k
¬∂¬µ
s
n + k
¬∂
=
¬µ
l + s
l ‚àím + n
¬∂
,
integer l  0,
integers m, n. (5.23)
X
k
¬µ
l
m + k
¬∂¬µs + k
n
¬∂
(‚àí1)k = (‚àí1)l+m
¬µs ‚àím
n ‚àíl
¬∂
,
integer l  0,
integers m, n. (5.24)
X
kl
¬µl ‚àík
m
¬∂¬µ
s
k ‚àín
¬∂
(‚àí1)k = (‚àí1)l+m
¬µs ‚àím ‚àí1
l ‚àím ‚àín
¬∂
,
integers
l, m, n  0. (5.25)
X
0kl
¬µl ‚àík
m
¬∂¬µq + k
n
¬∂
=
¬µ l + q + 1
m + n + 1
¬∂
,
integers l, m  0,
integers n  q  0. (5.26)
Now we come to Table 169, which lists identities that are among the most
important of our standard techniques. These are the ones we rely on when
struggling with a sum involving a product of two binomial coecients. Each
of these identities is a sum over k, with one appearance of k in each binomial
coecient; there also are four nearly independent parameters, called m, n, r,
etc., one in each index position. Dierent cases arise depending on whether k
appears in the upper or lower index, and on whether it appears with a plus or
minus sign. Sometimes there's an additional factor of (‚àí1)k, which is needed
to make the terms summable in closed form.
Table 169 is far too complicated to memorize in full; it is intended only
Fold down the
corner on this page,
so you can nd the
table quickly later.
You'll need it!
for reference. But the rst identity in this table is by far the most memorable,
and it should be remembered. It states that the sum (over all integers k) of the
product of two binomial coecients, in which the upper indices are constant
and the lower indices have a constant sum for all k, is the binomial coecient
obtained by summing both lower and upper indices. This identity is known
as Vandermonde's convolution, because Alexandre Vandermonde wrote a
signicant paper about it in the late 1700s [357]; it was, however, known
to Chu Shih-Chieh in China as early as 1303. All of the other identities in
Table 169 can be obtained from Vandermonde's convolution by doing things
like negating upper indices or applying the symmetry law, etc., with care;
therefore Vandermonde's convolution is the most basic of all.
We can prove Vandermonde's convolution by giving it a nice combinato-
rial interpretation. If we replace k by k ‚àím and n by n ‚àím, we can assume

170 BINOMIAL COEFFICIENTS
that m = 0; hence the identity to be proved is
X
k
¬µr
k
¬∂¬µ
s
n ‚àík
¬∂
=
¬µr + s
n
¬∂
,
integer n.
(5.27)
Let r and s be nonnegative integers; the general case then follows by the
polynomial argument.
On the right side,
¬°r+s
n
¬¢
is the number of ways to
choose n people from among r men and s women. On the left, each term
Sexist! You men-
tioned men rst.
of the sum is the number of ways to choose k of the men and n ‚àík of the
women. Summing over all k counts each possibility exactly once.
Much more often than not we use these identities left to right, since that's
the direction of simplication. But every once in a while it pays to go the
other direction, temporarily making an expression more complicated. When
this works, we've usually created a double sum for which we can interchange
the order of summation and then simplify.
Before moving on let's look at proofs for two more of the identities in
Table 169. It's easy to prove (5.23); all we need to do is replace the rst
binomial coecient by
¬°
l
l‚àím‚àík
¬¢
, then Vandermonde's (5.22) applies.
The next one, (5.24), is a bit more dicult. We can reduce it to Van-
dermonde's convolution by a sequence of transformations, but we can just
as easily prove it by resorting to the old reliable technique of mathematical
induction. Induction is often the rst thing to try when nothing else obvious
jumps out at us, and induction on l works just ne here.
For the basis l = 0, all terms are zero except when k = ‚àím; so both sides
of the equation are (‚àí1)m¬°s‚àím
n
¬¢
. Now suppose that the identity holds for all
values less than some xed l, where l > 0. We can use the addition formula
to replace
¬°
l
m+k
¬¢
by
¬° l‚àí1
m+k
¬¢
+
¬°
l‚àí1
m+k‚àí1
¬¢
; the original sum now breaks into two
sums, each of which can be evaluated by the induction hypothesis:
X
k
¬µ l ‚àí1
m + k
¬∂¬µs + k
n
¬∂
(‚àí1)k +
X
k
¬µ
l ‚àí1
m + k ‚àí1
¬∂¬µs + k
n
¬∂
(‚àí1)k
= (‚àí1)l‚àí1+m
¬µ s ‚àím
n ‚àíl + 1
¬∂
+ (‚àí1)l+m
¬µs ‚àím + 1
n ‚àíl + 1
¬∂
.
And this simplies to the right-hand side of (5.24), if we apply the addition
formula once again.
Two things about this derivation are worthy of note. First, we see again
the great convenience of summing over all integers k, not just over a certain
range, because there's no need to fuss over boundary conditions.
Second,
the addition formula works nicely with mathematical induction, because it's
a recurrence for binomial coecients.
A binomial coecient whose upper
index is l is expressed in terms of two whose upper indices are l ‚àí1, and
that's exactly what we need to apply the induction hypothesis.

5.1 BASIC IDENTITIES 171
So much for Table 169. What about sums with three or more binomial
coecients? If the index of summation is spread over all the coecients, our
chances of nding a closed form aren't great: Only a few closed forms are
known for sums of this kind, hence the sum we need might not match the
given specs. One of these rarities, proved in exercise 43, is
X
k
¬µm ‚àír + s
k
¬∂¬µn + r ‚àís
n ‚àík
¬∂¬µ r + k
m + n
¬∂
=
¬µ r
m
¬∂¬µs
n
¬∂
,
integers m, n  0.
(5.28)
Here's another, more symmetric example:
X
k
¬µa + b
a + k
¬∂¬µb + c
b + k
¬∂¬µc + a
c + k
¬∂
(‚àí1)k
= (a + b + c)!
a! b! c!
,
integers a, b, c  0.
(5.29)
This one has a two-coecient counterpart,
X
k
¬µa + b
a + k
¬∂¬µb + a
b + k
¬∂
(‚àí1)k = (a + b)!
a! b!
,
integers a, b  0,
(5.30)
which incidentally doesn't appear in Table 169. The analogous four-coecient
sum doesn't have a closed form, but a similar sum does:
X
k
(‚àí1)k
¬µa + b
a + k
¬∂¬µb + c
b + k
¬∂¬µc + d
c + k
¬∂¬µd + a
d + k
¬∂√Å¬µ2a + 2b + 2c + 2d
a + b + c + d + k
¬∂
= (a+b+c+d)! (a+b+c)! (a+b+d)! (a+c+d)! (b+c+d)!
(2a+2b+2c+2d)! (a+c)! (b+d)! a! b! c! d!
,
integers a, b, c, d  0.
This was discovered by John Dougall [82] early in the twentieth century.
Is Dougall's identity the hairiest sum of binomial coecients known? No!
The champion so far is
X
kij
(‚àí1)Œ£i<jkij
√É
Y
1i<j<n
¬µai+aj
aj+kij
¬∂!√É Y
1j<n
¬µ
aj + an
an + Œ£i<jkij ‚àíŒ£i>jkji
¬∂!
=
¬µa1 + ¬∑ ¬∑ ¬∑ + an
a1, a2, . . . , an
¬∂
,
integers a1, a2, . . . , an  0.
(5.31)
Here the sum is over
¬°n‚àí1
2
¬¢
index variables kij for 1  i < j < n. Equation
(5.29) is the special case n = 3; the case n = 4 can be written out as follows,

172 BINOMIAL COEFFICIENTS
if we use (a, b, c, d) for (a1, a2, a3, a4) and (i, j, k) for (k12, k13, k23):
X
i,j,k
(‚àí1)i+j+k
¬µa+b
b+i
¬∂¬µa+c
c+j
¬∂¬µb+c
c+k
¬∂¬µ a+d
d‚àíi‚àíj
¬∂¬µ b+d
d+i‚àík
¬∂¬µ c+d
d+j+k
¬∂
= (a + b + c + d)!
a! b! c! d!
,
integers a, b, c, d  0.
The left side of (5.31) is the coecient of z0
1z0
2 . . . z0
n after the product of
n(n ‚àí1) fractions
Y
1i,jn
iÃ∏=j
¬µ
1 ‚àízi
zj
¬∂ai
has been fully expanded into positive and negative powers of the z's. The
right side of (5.31) was conjectured by Freeman Dyson in 1962 and proved by
several people shortly thereafter. Exercise 89 gives a \simple" proof of (5.31).
Another noteworthy identity involving lots of binomial coecients is
X
j,k
(‚àí1)j+k
¬µj + k
k + l
¬∂¬µr
j
¬∂¬µn
k
¬∂¬µs + n ‚àíj ‚àík
m ‚àíj
¬∂
= (‚àí1)l
¬µn + r
n + l
¬∂¬µ
s ‚àír
m ‚àín ‚àíl
¬∂
,
integers l, m, n;
n  0. (5.32)
This one, proved in exercise 83, even has a chance of arising in practical
applications. But we're getting far aeld from our theme of \basic identities,"
so we had better stop and take stock of what we've learned.
We've seen that binomial coecients satisfy an almost bewildering va-
riety of identities. Some of these, fortunately, are easily remembered, and
we can use the memorable ones to derive most of the others in a few steps.
Table 174 collects ten of the most useful formulas, all in one place; these are
the best identities to know.
5.2
BASIC PRACTICE
In the previous section we derived a bunch of identities by manipu-
lating sums and plugging in other identities. It wasn't too tough to nd those
derivations | we knew what we were trying to prove, so we could formulate
a general plan and ll in the details without much trouble. Usually, however,
out in the real world, we're not faced with an identity to prove; we're faced
with a sum to simplify. And we don't know what a simplied form might
look like (or even if one exists). By tackling many such sums in this section
and the next, we will hone our binomial coecient tools.

5.2 BASIC PRACTICE 173
To start, let's try our hand at a few sums involving a single binomial
coecient.
Problem 1: A sum of ratios.
We'd like to have a closed form for
m
X
k=0
¬µm
k
¬∂√Å¬µn
k
¬∂
,
integers n  m  0.
At rst glance this sum evokes panic, because we haven't seen any identi-
ties that deal with a quotient of binomial coecients. (Furthermore the sum
involves two binomial coecients, which seems to contradict the sentence
preceding this problem.) However, just as we can use the factorial represen-
Algorithm
self-teach:
1 read problem
2 attempt solution
3 skim book solu-
tion
4 if attempt failed
goto 1
else goto next
problem
Unfortunately,
that algorithm
can put you in an
innite loop.
Suggested patches:
0
set c ‚Üê0
3a set c ‚Üêc + 1
3b if c = N
goto your TA


goto
¬°
¬°
|E.W. Dijkstra
. . . But this sub-
chapter is called
BASIC practice.
tations to reexpress a product of binomial coecients as another product |
that's how we got identity (5.21) | we can do likewise with a quotient. In
fact we can avoid the grubby factorial representations by letting r = n and
dividing both sides of equation (5.21) by
¬°n
k
¬¢¬°n
m
¬¢
; this yields
¬µm
k
¬∂√Å¬µn
k
¬∂
=
¬µn ‚àík
m ‚àík
¬∂√Å¬µn
m
¬∂
.
So we replace the quotient on the left, which appears in our sum, by the one
on the right; the sum becomes
m
X
k=0
¬µn ‚àík
m ‚àík
¬∂√Å¬µn
m
¬∂
.
We still have a quotient, but the binomial coecient in the denominator
doesn't involve the index of summation k, so we can remove it from the sum.
We'll restore it later.
We can also simplify the boundary conditions by summing over all k  0;
the terms for k > m are zero. The sum that's left isn't so intimidating:
X
k0
¬µn ‚àík
m ‚àík
¬∂
.
It's similar to the one in identity (5.9), because the index k appears twice
with the same sign. But here it's ‚àík and in (5.9) it's not. The next step
should therefore be obvious; there's only one reasonable thing to do:
X
k0
¬µn ‚àík
m ‚àík
¬∂
=
X
m‚àík0
¬µn ‚àí(m ‚àík)
m ‚àí(m ‚àík)
¬∂
=
X
km
¬µn ‚àím + k
k
¬∂
.

174 BINOMIAL COEFFICIENTS
Table 174 The top ten binomial coecient identities.
¬µn
k
¬∂
=
n!
k! (n ‚àík)! ,
integers
n  k  0.
factorial expansion
¬µn
k
¬∂
=
¬µ
n
n ‚àík
¬∂
,
integer n  0,
integer k.
symmetry
¬µr
k
¬∂
= r
k
¬µr ‚àí1
k ‚àí1
¬∂
,
integer k Ã∏= 0.
absorption/extraction
¬µr
k
¬∂
=
¬µr ‚àí1
k
¬∂
+
¬µr ‚àí1
k ‚àí1
¬∂
,
integer k.
addition/induction
¬µr
k
¬∂
= (‚àí1)k
¬µk ‚àír ‚àí1
k
¬∂
,
integer k.
upper negation
¬µ r
m
¬∂¬µm
k
¬∂
=
¬µr
k
¬∂¬µ r ‚àík
m ‚àík
¬∂
,
integers m, k.
trinomial revision
X
k
¬µr
k
¬∂
xkyr‚àík = (x + y)r ,
integer r  0,
or jx/yj < 1.
binomial theorem
X
kn
¬µr + k
k
¬∂
=
¬µr + n + 1
n
¬∂
,
integer n.
parallel summation
X
0kn
¬µ k
m
¬∂
=
¬µn + 1
m + 1
¬∂
,
integers
m, n  0.
upper summation
X
k
¬µr
k
¬∂¬µ
s
n ‚àík
¬∂
=
¬µr + s
n
¬∂
,
integer n.
Vandermonde convolution
And now we can apply the parallel summation identity, (5.9):
X
km
¬µn ‚àím + k
k
¬∂
=
¬µ(n ‚àím) + m + 1
m
¬∂
=
¬µn + 1
m
¬∂
.
Finally we reinstate the
¬°n
m
¬¢
in the denominator that we removed from
the sum earlier, and then apply (5.7) to get the desired closed form:
¬µn + 1
m
¬∂√Å¬µn
m
¬∂
=
n + 1
n + 1 ‚àím .
This derivation actually works for any real value of n, as long as no division
by zero occurs; that is, as long as n isn't one of the integers 0, 1, . . . , m ‚àí1.

5.2 BASIC PRACTICE 175
The more complicated the derivation, the more important it is to check
the answer. This one wasn't too complicated but we'll check anyway. In the
small case m = 2 and n = 4 we have
¬µ2
0
¬∂√Å¬µ4
0
¬∂
+
¬µ2
1
¬∂√Å¬µ4
1
¬∂
+
¬µ2
2
¬∂√Å¬µ4
2
¬∂
= 1 + 1
2 + 1
6 = 5
3 ;
yes, this agrees perfectly with our closed form (4 + 1)/(4 + 1 ‚àí2).
Problem 2: From the literature of sorting.
Our next sum appeared way back in ancient times (the early 1970s)
before people were uent with binomial coecients. A paper that introduced
an improved merging technique [196] concludes with the following remarks:
\It can be shown that the expected number of saved transfers . . . is given by
the expression
T =
n
X
r=0
r m‚àír‚àí1Cm‚àín‚àí1
mCn
Here m and n are as dened above, and mCn is the symbol for the number
of combinations of m objects taken n at a time. . . . The author is grateful to
the referee for reducing a more complex equation for expected transfers saved
to the form given here."
We'll see that this is denitely not a nal answer to the author's problem.
It's not even a midterm answer.
Please, don't re-
mind me of the
midterm.
First we should translate the sum into something we can work with; the
ghastly notation m‚àír‚àí1Cm‚àín‚àí1 is enough to stop anybody, save the enthu-
siastic referee (please). In our language we'd write
T =
n
X
k=0
k
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂√Å¬µm
n
¬∂
,
integers m > n  0.
The binomial coecient in the denominator doesn't involve the index of sum-
mation, so we can remove it and work with the new sum
S =
n
X
k=0
k
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
.
What next? The index of summation appears in the upper index of the
binomial coecient but not in the lower index. So if the other k weren't there,
we could massage the sum and apply summation on the upper index (5.10).
With the extra k, though, we can't. If we could somehow absorb that k into
the binomial coecient, using one of our absorption identities, we could then

176 BINOMIAL COEFFICIENTS
sum on the upper index. Unfortunately those identities don't work here. But
if the k were instead m ‚àík, we could use absorption identity (5.6):
(m ‚àík)
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
= (m ‚àín)
¬µm ‚àík
m ‚àín
¬∂
.
So here's the key: We'll rewrite k as m ‚àí(m ‚àík) and split the sum S
into two sums:
n
X
k=0
k
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
=
n
X
k=0
¬°
m ‚àí(m ‚àík)
¬¢¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
=
n
X
k=0
m
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
‚àí
n
X
k=0
(m ‚àík)
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
= m
n
X
k=0
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
‚àí
n
X
k=0
(m ‚àín)
¬µm ‚àík
m ‚àín
¬∂
= mA ‚àí(m ‚àín)B ,
where
A =
n
X
k=0
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
,
B =
n
X
k=0
¬µm ‚àík
m ‚àín
¬∂
.
The sums A and B that remain are none other than our old friends in
which the upper index varies while the lower index stays xed. Let's do B
rst, because it looks simpler. A little bit of massaging is enough to make the
summand match the left side of (5.10):
X
0kn
¬µm ‚àík
m ‚àín
¬∂
=
X
0m‚àíkn
¬µm ‚àí(m ‚àík)
m ‚àín
¬∂
=
X
m‚àínkm
¬µ
k
m ‚àín
¬∂
=
X
0km
¬µ
k
m ‚àín
¬∂
.
In the last step we've included the terms with 0  k < m ‚àín in the sum;
they're all zero, because the upper index is less than the lower. Now we sum
on the upper index, using (5.10), and get
B =
X
0km
¬µ
k
m ‚àín
¬∂
=
¬µ
m + 1
m ‚àín + 1
¬∂
.

5.2 BASIC PRACTICE 177
The other sum A is the same, but with m replaced by m ‚àí1. Hence we
have a closed form for the given sum S, which can be further simplied:
S = mA ‚àí(m ‚àín)B = m
¬µ
m
m ‚àín
¬∂
‚àí(m ‚àín)
¬µ
m + 1
m ‚àín + 1
¬∂
=
¬µ
m ‚àí(m ‚àín)
m + 1
m ‚àín + 1
¬∂ ¬µ
m
m ‚àín
¬∂
=
¬µ
n
m ‚àín + 1
¬∂ ¬µ
m
m ‚àín
¬∂
.
And this gives us a closed form for the original sum:
T = S
√Å¬µm
n
¬∂
=
n
m ‚àín + 1
¬µ
m
m ‚àín
¬∂√Å¬µm
n
¬∂
=
n
m ‚àín + 1 .
Even the referee can't simplify this.
Again we use a small case to check the answer. When m = 4 and n = 2,
we have
T = 0¬∑
¬°3
1
¬¢¬±¬°4
2
¬¢
+ 1¬∑
¬°2
1
¬¢¬±¬°4
2
¬¢
+ 2¬∑
¬°1
1
¬¢¬±¬°4
2
¬¢
= 0 + 2
6 + 2
6 =
2
3 ,
which agrees with our formula 2/(4 ‚àí2 + 1).
Problem 3: From an old exam.
Let's do one more sum that involves a single binomial coecient. This
one, unlike the last, originated in the halls of academia; it was a problem on
Do old exams
ever die?
a take-home test. We want the value of Q1000000, when
Qn =
X
k2n
¬µ2n ‚àík
k
¬∂
(‚àí1)k ,
integer n  0.
This one's harder than the others; we can't apply any of the identities we've
seen so far. And we're faced with a sum of 21000000 terms, so we can't just
add them up. The index of summation k appears in both indices, upper and
lower, but with opposite signs. Negating the upper index doesn't help, either;
it removes the factor of (‚àí1)k, but it introduces a 2k in the upper index.
When nothing obvious works, we know that it's best to look at small
cases. If we can't spot a pattern and prove it by induction, at least we'll have

178 BINOMIAL COEFFICIENTS
some data for checking our results. Here are the nonzero terms and their sums
for the rst four values of n.
n
Qn
0
¬°1
0
¬¢
= 1
= 1
1
¬°2
0
¬¢
‚àí
¬°1
1
¬¢
= 1 ‚àí1
= 0
2
¬°4
0
¬¢
‚àí
¬°3
1
¬¢
+
¬°2
2
¬¢
= 1 ‚àí3 + 1
= ‚àí1
3
¬°8
0
¬¢
‚àí
¬°7
1
¬¢
+
¬°6
2
¬¢
‚àí
¬°5
3
¬¢
+
¬°4
4
¬¢
= 1 ‚àí7 + 15 ‚àí10 + 1 = 0
We'd better not try the next case, n = 4; the chances of making an arithmetic
error are too high. (Computing terms like
¬°12
4
¬¢
and
¬°11
5
¬¢
by hand, let alone
combining them with the others, is worthwhile only if we're desperate.)
So the pattern starts out 1, 0, ‚àí1, 0. Even if we knew the next term or
two, the closed form wouldn't be obvious. But if we could nd and prove a
recurrence for Qn we'd probably be able to guess and prove its closed form.
To nd a recurrence, we need to relate Qn to Qn‚àí1 (or to Qsmaller values); but
to do this we need to relate a term like
¬°128‚àí13
13
¬¢
, which arises when n = 7 and
k = 13, to terms like
¬°64‚àí13
13
¬¢
. This doesn't look promising; we don't know
any neat relations between entries in Pascal's triangle that are 64 rows apart.
The addition formula, our main tool for induction proofs, only relates entries
that are one row apart.
But this leads us to a key observation: There's no need to deal with
entries that are 2n‚àí1 rows apart. The variable n never appears by itself, it's
always in the context 2n. So the 2n is a red herring! If we replace 2n by m,
Oh, the sneakiness
of the instructor
who set that exam.
all we need to do is nd a closed form for the more general (but easier) sum
Rm =
X
km
¬µm ‚àík
k
¬∂
(‚àí1)k ,
integer m  0;
then we'll also have a closed form for Qn = R2n. And there's a good chance
that the addition formula will give us a recurrence for the sequence Rm.
Values of Rm for small m can be read from Table 155, if we alternately
add and subtract values that appear in a southwest-to-northeast diagonal.
The results are:
m
0
1
2
3
4
5
6
7
8
9
10
Rm
1
1
0
‚àí1
‚àí1
0
1
1
0
‚àí1
‚àí1
There seems to be a lot of cancellation going on.
Let's look now at the formula for Rm and see if it denes a recurrence.
Our strategy is to apply the addition formula (5.8) and to nd sums that

5.2 BASIC PRACTICE 179
have the form Rk in the resulting expression, somewhat as we did in the
perturbation method of Chapter 2:
Rm =
X
km
¬µm ‚àík
k
¬∂
(‚àí1)k
=
X
km
¬µm ‚àí1 ‚àík
k
¬∂
(‚àí1)k
+
X
km
¬µm ‚àí1 ‚àík
k ‚àí1
¬∂
(‚àí1)k
=
X
km
¬µm ‚àí1 ‚àík
k
¬∂
(‚àí1)k
+
X
k+1m
¬µm ‚àí2 ‚àík
k
¬∂
(‚àí1)k+1
=
X
km‚àí1
¬µm ‚àí1 ‚àík
k
¬∂
(‚àí1)k
+
¬µ‚àí1
m
¬∂
(‚àí1)m
‚àí
X
km‚àí2
¬µm ‚àí2 ‚àík
k
¬∂
(‚àí1)k
‚àí
¬µ ‚àí1
m ‚àí1
¬∂
(‚àí1)m‚àí1
= Rm‚àí1 + (‚àí1)2m ‚àíRm‚àí2 ‚àí(‚àí1)2(m‚àí1) = Rm‚àí1 ‚àíRm‚àí2 .
(In the next-to-last step we've used the formula
¬°‚àí1
m
¬¢
= (‚àí1)m, which we
know is true when m  0.) This derivation is valid for m  2.
Anyway those of
us who've done
warmup exercise 4
know it.
From this recurrence we can generate values of Rm quickly, and we soon
perceive that the sequence is periodic. Indeed,
Rm =
Ô£±
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£≤
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£≥
1
1
0
‚àí1
‚àí1
0
if m mod 6 =
Ô£±
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£≤
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£≥
0
1
2
3
4
5
.
The proof by induction is by inspection. Or, if we must give a more academic
proof, we can unfold the recurrence one step to obtain
Rm = (Rm‚àí2 ‚àíRm‚àí3) ‚àíRm‚àí2 = ‚àíRm‚àí3 ,
whenever m  3. Hence Rm = Rm‚àí6 whenever m  6.
Finally, since Qn = R2n, we can determine Qn by determining 2n mod 6
and using the closed form for Rm. When n = 0 we have 20 mod 6 = 1; after
that we keep multiplying by 2 (mod 6), so the pattern 2, 4 repeats. Thus
Qn = R2n =
Ô£±
Ô£≤
Ô£≥
R1 = 1,
if n = 0;
R2 = 0,
if n is odd;
R4 = ‚àí1,
if n > 0 is even.
This closed form for Qn agrees with the rst four values we calculated when
we started on the problem. We conclude that Q1000000 = R4 = ‚àí1.

180 BINOMIAL COEFFICIENTS
Problem 4: A sum involving two binomial coeÔ¨Écients.
Our next task is to nd a closed form for
n
X
k=0
k
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
,
integers m > n  0.
Wait a minute. Where's the second binomial coecient promised in the title
of this problem? And why should we try to simplify a sum we've already
simplied? (This is the sum S from Problem 2.)
Well, this is a sum that's easier to simplify if we view the summand
as a product of two binomial coecients, and then use one of the general
identities found in Table 169. The second binomial coecient materializes
when we rewrite k as
¬°k
1
¬¢
:
n
X
k=0
k
¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
=
X
0kn
¬µk
1
¬∂¬µm ‚àík ‚àí1
m ‚àín ‚àí1
¬∂
.
And identity (5.26) is the one to apply, since its index of summation appears
in both upper indices and with opposite signs.
But our sum isn't quite in the correct form yet.
The upper limit of
summation should be m ‚àí1, if we're to have a perfect match with (5.26). No
problem; the terms for n < k  m ‚àí1 are zero. So we can plug in, with
(l, m, n, q) ‚Üê(m ‚àí1, m ‚àín ‚àí1, 1, 0); the answer is
S =
¬µ
m
m ‚àín + 1
¬∂
.
This is cleaner than the formula we got before. We can convert it to the
previous formula by using (5.7):
¬µ
m
m ‚àín + 1
¬∂
=
n
m ‚àín + 1
¬µ
m
m ‚àín
¬∂
.
Similarly, we can get interesting results by plugging special values into
the other general identities we've seen. Suppose, for example, that we set
m = n = 1 and q = 0 in (5.26). Then the identity reads
X
0kl
(l ‚àík)k =
¬µl + 1
3
¬∂
.
The left side is l
¬°
(l+1)l/2
¬¢
‚àí(12 +22 +¬∑ ¬∑ ¬∑+l2), so this gives us a brand new
way to solve the sum-of-squares problem that we beat to death in Chapter 2.
The moral of this story is: Special cases of very general sums are some-
times best handled in the general form. When learning general forms, it's
wise to learn their simple specializations.

5.2 BASIC PRACTICE 181
Problem 5: A sum with three factors.
Here's another sum that isn't too bad. We wish to simplify
X
k
¬µn
k
¬∂¬µs
k
¬∂
k ,
integer n  0.
The index of summation k appears in both lower indices and with the same
sign; therefore identity (5.23) in Table 169 looks close to what we need. With
a bit of manipulation, we should be able to use it.
The biggest dierence between (5.23) and what we have is the extra k in
our sum. But we can absorb k into one of the binomial coecients by using
one of the absorption identities:
X
k
¬µn
k
¬∂¬µs
k
¬∂
k =
X
k
¬µn
k
¬∂¬µs ‚àí1
k ‚àí1
¬∂
s
= s
X
k
¬µn
k
¬∂¬µs ‚àí1
k ‚àí1
¬∂
.
We don't care that the s appears when the k disappears, because it's constant.
And now we're ready to apply the identity and get the closed form,
s
X
k
¬µn
k
¬∂¬µs ‚àí1
k ‚àí1
¬∂
= s
¬µn + s ‚àí1
n ‚àí1
¬∂
.
If we had chosen in the rst step to absorb k into
¬°n
k
¬¢
, not
¬°s
k
¬¢
, we wouldn't
have been allowed to apply (5.23) directly, because n ‚àí1 might be negative;
the identity requires a nonnegative value in at least one of the upper indices.
Problem 6: A sum with menacing characteristics.
The next sum is more challenging. We seek a closed form for
X
k0
¬µn + k
2k
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1 ,
integer n  0.
One useful measure of a sum's diculty is the number of times the index of
So we should
deep six this sum,
right?
summation appears. By this measure we're in deep trouble | k appears six
times. Furthermore, the key step that worked in the previous problem | to
absorb something outside the binomial coecients into one of them | won't
work here. If we absorb the k + 1 we just get another occurrence of k in its
place. And not only that: Our index k is twice shackled with the coecient 2
inside a binomial coecient. Multiplicative constants are usually harder to
remove than additive constants.

182 BINOMIAL COEFFICIENTS
We're lucky this time, though. The 2k's are right where we need them
for identity (5.21) to apply, so we get
X
k0
¬µn + k
2k
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1
=
X
k0
¬µn + k
k
¬∂¬µn
k
¬∂(‚àí1)k
k + 1 .
The two 2's disappear, and so does one occurrence of k. So that's one down
and ve to go.
The k + 1 in the denominator is the most troublesome characteristic left,
and now we can absorb it into
¬°n
k
¬¢
using identity (5.6):
X
k0
¬µn + k
k
¬∂¬µn
k
¬∂(‚àí1)k
k + 1
=
X
k
¬µn + k
k
¬∂¬µn + 1
k + 1
¬∂(‚àí1)k
n + 1
=
1
n + 1
X
k
¬µn + k
k
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k .
(Recall that n  0.) Two down, four to go.
To eliminate another k we have two promising options. We could use
symmetry on
¬°n+k
k
¬¢
; or we could negate the upper index n + k, thereby
eliminating that k as well as the factor (‚àí1)k. Let's explore both possibilities,
starting with the symmetry option:
1
n + 1
X
k
¬µn + k
k
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k =
1
n + 1
X
k
¬µn + k
n
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k .
Third down, three to go, and we're in position to make a big gain by plugging
For a minute
I thought we'd
have to punt.
into (5.24): Replacing (l, m, n, s) by (n + 1, 1, n, n), we get
1
n + 1
X
k
¬µn + k
n
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k =
1
n + 1(‚àí1)n
¬µn ‚àí1
‚àí1
¬∂
= 0 .
Zero, eh? After all that work? Let's check it when n = 2:
¬°2
0
¬¢¬°0
0
¬¢ 1
1 ‚àí
¬°3
2
¬¢¬°2
1
¬¢ 1
2 +
¬°4
4
¬¢¬°4
2
¬¢ 1
3 = 1 ‚àí6
2 + 6
3 = 0. It checks.
Just for the heck of it, let's explore our other option, negating the upper
index of
¬°n+k
k
¬¢
:
1
n + 1
X
k
¬µn + k
k
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k =
1
n + 1
X
k
¬µ‚àín ‚àí1
k
¬∂¬µn + 1
k + 1
¬∂
.
Now (5.23) applies, with (l, m, n, s) ‚Üê(n + 1, 1, 0, ‚àín ‚àí1), and
1
n + 1
X
k
¬µ‚àín ‚àí1
k
¬∂¬µn + 1
k + 1
¬∂
=
1
n + 1
¬µ0
n
¬∂
.

5.2 BASIC PRACTICE 183
Hey wait. This is zero when n > 0, but it's 1 when n = 0. Our other
path to the solution told us that the sum was zero in all cases! What gives?
The sum actually does turn out to be 1 when n = 0, so the correct answer is
`[n = 0]'. We must have made a mistake in the previous derivation.
Let's do an instant replay on that derivation when n = 0, in order to see
Try binary search:
Replay the middle
formula rst, to see
if the mistake was
early or late.
where the discrepancy rst arises. Ah yes; we fell into the old trap mentioned
earlier: We tried to apply symmetry when the upper index could be negative!
We were not justied in replacing
¬°n+k
k
¬¢
by
¬°n+k
n
¬¢
when k ranges over all
integers, because this converts zero into a nonzero value when k < ‚àín. (Sorry
about that.)
The other factor in the sum,
¬°n+1
k+1
¬¢
, turns out to be zero when k < ‚àín,
except when n = 0 and k = ‚àí1. Hence our error didn't show up when we
checked the case n = 2. Exercise 6 explains what we should have done.
Problem 7: A new obstacle.
This one's even tougher; we want a closed form for
X
k0
¬µ n + k
m + 2k
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1 ,
integers m, n > 0.
If m were 0 we'd have the sum from the problem we just nished. But it's
not, and we're left with a real mess | nothing we used in Problem 6 works
here. (Especially not the crucial rst step.)
However, if we could somehow get rid of the m, we could use the result
just derived. So our strategy is: Replace
¬° n+k
m+2k
¬¢
by a sum of terms like
¬°l+k
2k
¬¢
for some nonnegative integer l; the summand will then look like the summand
in Problem 6, and we can interchange the order of summation.
What should we substitute for
¬° n+k
m+2k
¬¢
? A painstaking examination of the
identities derived earlier in this chapter turns up only one suitable candidate,
namely equation (5.26) in Table 169. And one way to use it is to replace the
parameters (l, m, n, q, k) by (n + k ‚àí1, 2k, m ‚àí1, 0, j), respectively:
X
k0
¬µ n + k
m + 2k
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1
=
X
k0
X
0jn+k‚àí1
¬µn + k ‚àí1 ‚àíj
2k
¬∂¬µ
j
m ‚àí1
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1
=
X
j0
¬µ
j
m ‚àí1
¬∂
X
kj‚àín+1
k0
¬µn + k ‚àí1 ‚àíj
2k
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1 .
In the last step we've changed the order of summation, manipulating the
conditions below the P's according to the rules of Chapter 2.

184 BINOMIAL COEFFICIENTS
We can't quite replace the inner sum using the result of Problem 6,
because it has the extra condition k  j ‚àín + 1. But this extra condition
is superuous unless j ‚àín + 1 > 0; that is, unless j  n. And when j  n,
the rst binomial coecient of the inner sum is zero, because its upper index
is between 0 and k ‚àí1, thus strictly less than the lower index 2k. We may
therefore place the additional restriction j < n on the outer sum, without
aecting which nonzero terms are included. This makes the restriction k 
j ‚àín + 1 superuous, and we can use the result of Problem 6. The double
sum now comes tumbling down:
X
j0
¬µ
j
m ‚àí1
¬∂
X
kj‚àín+1
k0
¬µn + k ‚àí1 ‚àíj
2k
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1
=
X
0j<n
¬µ
j
m ‚àí1
¬∂ X
k0
¬µn + k ‚àí1 ‚àíj
2k
¬∂¬µ2k
k
¬∂(‚àí1)k
k + 1
=
X
0j<n
¬µ
j
m ‚àí1
¬∂
[n ‚àí1 ‚àíj = 0] =
¬µn ‚àí1
m ‚àí1
¬∂
.
The inner sums vanish except when j = n ‚àí1, so we get a simple closed form
as our answer.
Problem 8: A diÔ¨Äerent obstacle.
Let's branch out from Problem 6 in another way by considering the sum
Sm =
X
k0
¬µn + k
2k
¬∂¬µ2k
k
¬∂
(‚àí1)k
k + 1 + m ,
integers m, n  0.
Again, when m = 0 we have the sum we did before; but now the m occurs
in a dierent place. This problem is a bit harder yet than Problem 7, but
(fortunately) we're getting better at nding solutions. We can begin as in
Problem 6,
Sm =
X
k0
¬µn + k
k
¬∂¬µn
k
¬∂
(‚àí1)k
k + 1 + m .
Now (as in Problem 7) we try to expand the part that depends on m into
terms that we know how to deal with. When m was zero, we absorbed k + 1
into
¬°n
k
¬¢
; if m > 0, we can do the same thing if we expand 1/(k + 1 + m) into
absorbable terms. And our luck still holds: We proved a suitable identity
m
X
j=0
¬µm
j
¬∂¬µr
j
¬∂‚àí1
=
r + 1
r + 1 ‚àím ,
integer m  0,
r /‚ààf0, 1, . . . , m ‚àí1g.
(5.33)

5.2 BASIC PRACTICE 185
in Problem 1. Replacing r by ‚àík ‚àí2 gives the desired expansion,
Sm =
X
k0
¬µn + k
k
¬∂¬µn
k
¬∂(‚àí1)k
k + 1
X
j0
¬µm
j
¬∂¬µ‚àík ‚àí2
j
¬∂‚àí1
.
Now the (k + 1)‚àí1 can be absorbed into
¬°n
k
¬¢
, as planned. In fact, it could
also be absorbed into
¬°‚àík‚àí2
j
¬¢‚àí1. Double absorption suggests that even more
cancellation might be possible behind the scenes. Yes | expanding everything
in our new summand into factorials and going back to binomial coecients
gives a formula that we can sum on k:
They expect us to
check this
on a sheet of
scratch paper.
Sm =
m! n!
(m + n + 1)!
X
j0
(‚àí1)j
¬µm + n + 1
n + 1 + j
¬∂ X
k
¬µn + 1 + j
k + j + 1
¬∂¬µ‚àín ‚àí1
k
¬∂
=
m! n!
(m + n + 1)!
X
j0
(‚àí1)j
¬µm + n + 1
n + 1 + j
¬∂¬µ j
n
¬∂
.
The sum over all integers j is zero, by (5.24). Hence ‚àíSm is the sum for j < 0.
To evaluate ‚àíSm for j < 0, let's replace j by ‚àík ‚àí1 and sum for k  0:
Sm =
m! n!
(m + n + 1)!
X
k0
(‚àí1)k
¬µm + n + 1
n ‚àík
¬∂¬µ‚àík ‚àí1
n
¬∂
=
m! n!
(m + n + 1)!
X
kn
(‚àí1)n‚àík
¬µm + n + 1
k
¬∂¬µk ‚àín ‚àí1
n
¬∂
=
m! n!
(m + n + 1)!
X
kn
(‚àí1)k
¬µm + n + 1
k
¬∂¬µ2n ‚àík
n
¬∂
=
m! n!
(m + n + 1)!
X
k2n
(‚àí1)k
¬µm + n + 1
k
¬∂¬µ2n ‚àík
n
¬∂
.
Finally (5.25) applies, and we have our answer:
Sm = (‚àí1)n
m! n!
(m + n + 1)!
¬µm
n
¬∂
= (‚àí1)nmnm‚àín‚àí1 .
Whew; we'd better check it. When n = 2 we nd
Sm =
1
m + 1 ‚àí
6
m + 2 +
6
m + 3 =
m(m ‚àí1)
(m + 1)(m + 2)(m + 3) .
Our derivation requires m to be an integer, but the result holds for all real m,
because the quantity (m + 1)n+1 Sm is a polynomial in m of degree  n.

186 BINOMIAL COEFFICIENTS
5.3
TRICKS OF THE TRADE
Let's look next at three techniques that signicantly amplify the
methods we have already learned.
Trick 1: Going halves.
Many of our identities involve an arbitrary real number r. When r has
This should really
be called Trick 1/2.
the special form \integer minus one half," the binomial coecient
¬°r
k
¬¢
can be
written as a quite dierent-looking product of binomial coecients. This leads
to a new family of identities that can be manipulated with surprising ease.
One way to see how this works is to begin with the duplication formula
rk (r ‚àí1
2)k = (2r)2k/22k ,
integer k  0.
(5.34)
This identity is obvious if we expand the falling powers and interleave the
factors on the left side:
r(r ‚àí1
2)(r ‚àí1)(r ‚àí3
2) . . . (r ‚àík + 1)(r ‚àík + 1
2)
= (2r)(2r ‚àí1) . . . (2r ‚àí2k + 1)
2 ¬∑ 2 ¬∑ . . . ¬∑ 2
.
Now we can divide both sides by k!2, and we get
¬µr
k
¬∂¬µr ‚àí1/2
k
¬∂
=
¬µ2r
2k
¬∂¬µ2k
k
¬∂√Å
22k ,
integer k.
(5.35)
If we set k = r = n, where n is an integer, this yields
¬µn ‚àí1/2
n
¬∂
=
¬µ2n
n
¬∂√Å
22n ,
integer n.
(5.36)
And negating the upper index gives yet another useful formula,
¬µ‚àí1/2
n
¬∂
=
¬µ‚àí1
4
¬∂n ¬µ2n
n
¬∂
,
integer n.
(5.37)
For example, when n = 4 we have
. . . we halve . . .
¬µ‚àí1/2
4
¬∂
= (‚àí1/2)(‚àí3/2)(‚àí5/2)(‚àí7/2)
4!
=
¬µ‚àí1
2
¬∂4 1¬∑3¬∑5¬∑7
1¬∑2¬∑3¬∑4
=
¬µ‚àí1
4
¬∂4 1¬∑3¬∑5¬∑7¬∑2¬∑4¬∑6¬∑8
1¬∑2¬∑3¬∑4¬∑1¬∑2¬∑3¬∑4 =
¬µ‚àí1
4
¬∂4 ¬µ8
4
¬∂
.
Notice how we've changed a product of odd numbers into a factorial.

5.3 TRICKS OF THE TRADE 187
Identity (5.35) has an amusing corollary. Let r = 1
2n, and take the sum
over all integers k. The result is
X
k
¬µ n
2k
¬∂¬µ2k
k
¬∂
2‚àí2k =
X
k
¬µn/2
k
¬∂¬µ(n ‚àí1)/2
k
¬∂
=
¬µn ‚àí1/2
‚åän/2‚åã
¬∂
,
integer n  0
(5.38)
by (5.23), because either n/2 or (n ‚àí1)/2 is ‚åän/2‚åã, a nonnegative integer!
We can also use Vandermonde's convolution (5.27) to deduce that
X
k
¬µ‚àí1/2
k
¬∂¬µ‚àí1/2
n ‚àík
¬∂
=
¬µ‚àí1
n
¬∂
= (‚àí1)n ,
integer n  0.
Plugging in the values from (5.37) gives
¬µ‚àí1/2
k
¬∂¬µ‚àí1/2
n ‚àík
¬∂
=
¬µ‚àí1
4
¬∂k¬µ2k
k
¬∂ ¬µ‚àí1
4
¬∂n‚àík¬µ2(n ‚àík)
n ‚àík
¬∂
= (‚àí1)n
4n
¬µ2k
k
¬∂¬µ2n ‚àí2k
n ‚àík
¬∂
;
this is what sums to (‚àí1)n. Hence we have a remarkable property of the
\middle" elements of Pascal's triangle:
X
k
¬µ2k
k
¬∂¬µ2n ‚àí2k
n ‚àík
¬∂
= 4n ,
integer n  0.
(5.39)
For example,
¬°0
0
¬¢¬°6
3
¬¢
+
¬°2
1
¬¢¬°4
2
¬¢
+
¬°4
2
¬¢¬°2
1
¬¢
+
¬°6
3
¬¢¬°0
0
¬¢
= 1¬∑20+2¬∑6+6¬∑2+20¬∑1 = 64 = 43.
These illustrations of our rst trick indicate that it's wise to try changing
binomial coecients of the form
¬°2k
k
¬¢
into binomial coecients of the form
¬°n‚àí1/2
k
¬¢
, where n is some appropriate integer (usually 0, 1, or k); the resulting
formula might be much simpler.
Trick 2: High-order diÔ¨Äerences.
We saw earlier that it's possible to evaluate partial sums of the series
¬°n
k
¬¢
(‚àí1)k, but not of the series
¬°n
k
¬¢
. It turns out that there are many important
applications of binomial coecients with alternating signs,
¬°n
k
¬¢
(‚àí1)k. One of
the reasons for this is that such coecients are intimately associated with the
dierence operator ‚àÜdened in Section 2.6.
The dierence ‚àÜf of a function f at the point x is
‚àÜf(x) = f(x + 1) ‚àíf(x) ;

188 BINOMIAL COEFFICIENTS
if we apply ‚àÜagain, we get the second dierence
‚àÜ2 f(x) = ‚àÜf(x + 1) ‚àí‚àÜf(x) =
¬°
f(x+2) ‚àíf(x+1)
¬¢
‚àí
¬°
f(x+1) ‚àíf(x)
¬¢
= f(x + 2) ‚àí2f(x + 1) + f(x) ,
which is analogous to the second derivative. Similarly, we have
‚àÜ3 f(x) = f(x + 3) ‚àí3f(x + 2) + 3f(x + 1) ‚àíf(x) ;
‚àÜ4 f(x) = f(x + 4) ‚àí4f(x + 3) + 6f(x + 2) ‚àí4f(x + 1) + f(x) ;
and so on. Binomial coecients enter these formulas with alternating signs.
In general, the nth dierence is
‚àÜn f(x) =
X
k
¬µn
k
¬∂
(‚àí1)n‚àíkf(x + k) ,
integer n  0.
(5.40)
This formula is easily proved by induction, but there's also a nice way to prove
it directly using the elementary theory of operators. Recall that Section 2.6
denes the shift operator E by the rule
Ef(x) = f(x + 1) ;
hence the operator ‚àÜis E ‚àí1, where 1 is the identity operator dened by the
rule 1f(x) = f(x). By the binomial theorem,
‚àÜn = (E ‚àí1)n =
X
k
¬µn
k
¬∂
Ek(‚àí1)n‚àík .
This is an equation whose elements are operators; it is equivalent to (5.40),
since Ek is the operator that takes f(x) into f(x + k).
An interesting and important case arises when we consider negative
falling powers. Let f(x) = (x ‚àí1)‚àí1 = 1/x. Then, by rule (2.45), we have
‚àÜf(x) = (‚àí1)(x ‚àí1)‚àí2, ‚àÜ2 f(x) = (‚àí1)(‚àí2)(x ‚àí1)‚àí3, and in general
‚àÜn¬°
(x ‚àí1)‚àí1¬¢
= (‚àí1)n (x ‚àí1)‚àín‚àí1 = (‚àí1)n
n!
x(x + 1) . . . (x + n) .
Equation (5.40) now tells us that
X
k
¬µn
k
¬∂(‚àí1)k
x + k
=
n!
x(x + 1) . . . (x + n)
= x‚àí1
¬µx + n
n
¬∂‚àí1
,
x /‚ààf0, ‚àí1, . . . , ‚àíng.
(5.41)

5.3 TRICKS OF THE TRADE 189
For example,
1
x ‚àí
4
x + 1 +
6
x + 2 ‚àí
4
x + 3 +
1
x + 4
=
4!
x(x + 1)(x + 2)(x + 3)(x + 4) = 1
√Å
x
¬µx + 4
4
¬∂
.
The sum in (5.41) is the partial fraction expansion of n!/
¬°
x(x+1) . . . (x+n)
¬¢
.
Signicant results can be obtained from positive falling powers too. If
f(x) is a polynomial of degree d, the dierence ‚àÜf(x) is a polynomial of degree
d‚àí1; therefore ‚àÜd f(x) is a constant, and ‚àÜn f(x) = 0 if n > d. This extremely
important fact simplies many formulas.
A closer look gives further information: Let
f(x) = adxd + ad‚àí1xd‚àí1 + ¬∑ ¬∑ ¬∑ + a1x1 + a0x0
be any polynomial of degree d. We will see in Chapter 6 that we can express
ordinary powers as sums of falling powers (for example, x2 = x2 + x1); hence
there are coecients bd, bd‚àí1, . . . , b1, b0 such that
f(x) = bdxd + bd‚àí1xd‚àí1 + ¬∑ ¬∑ ¬∑ + b1x1 + b0x0 .
(It turns out that bd = ad and b0 = a0, but the intervening coecients are
related in a more complicated way.) Let ck = k! bk for 0  k  d. Then
f(x) = cd
¬µx
d
¬∂
+ cd‚àí1
¬µ
x
d ‚àí1
¬∂
+ ¬∑ ¬∑ ¬∑ + c1
¬µx
1
¬∂
+ c0
¬µx
0
¬∂
;
thus, any polynomial can be represented as a sum of multiples of binomial
coecients. Such an expansion is called the Newton series of f(x), because
Isaac Newton used it extensively.
We observed earlier in this chapter that the addition formula implies
‚àÜ
¬µ¬µx
k
¬∂¬∂
=
¬µ
x
k ‚àí1
¬∂
.
Therefore, by induction, the nth dierence of a Newton series is very simple:
‚àÜn f(x) = cd
¬µ x
d‚àín
¬∂
+ cd‚àí1
¬µ
x
d‚àí1‚àín
¬∂
+ ¬∑ ¬∑ ¬∑ + c1
¬µ x
1‚àín
¬∂
+ c0
¬µ x
‚àín
¬∂
.
If we now set x = 0, all terms ck
¬°
x
k‚àín
¬¢
on the right side are zero, except the
term with k ‚àín = 0; hence
‚àÜn f(0) =
¬Ø cn ,
if n  d;
0 ,
if n > d.

190 BINOMIAL COEFFICIENTS
The Newton series for f(x) is therefore
f(x) = ‚àÜd f(0)
¬µx
d
¬∂
+ ‚àÜd‚àí1 f(0)
¬µ
x
d ‚àí1
¬∂
+ ¬∑ ¬∑ ¬∑ + ‚àÜf(0)
¬µx
1
¬∂
+ f(0)
¬µx
0
¬∂
.
For example, suppose f(x) = x3. It's easy to calculate
f(0) = 0,
f(1) = 1,
f(2) = 8,
f(3) = 27;
‚àÜf(0) = 1,
‚àÜf(1) = 7,
‚àÜf(2) = 19;
‚àÜ2 f(0) = 6,
‚àÜ2 f(1) = 12;
‚àÜ3 f(0) = 6.
So the Newton series is x3 = 6
¬°x
3
¬¢
+ 6
¬°x
2
¬¢
+ 1
¬°x
1
¬¢
+ 0
¬°x
0
¬¢
.
Our formula ‚àÜn f(0) = cn can also be stated in the following way, using
(5.40) with x = 0:
X
k
¬µn
k
¬∂
(‚àí1)k
¬µ
c0
¬µk
0
¬∂
+ c1
¬µk
1
¬∂
+ c2
¬µk
2
¬∂
+ ¬∑ ¬∑ ¬∑
¬∂
= (‚àí1)ncn ,
integer n  0.
Here ‚ü®c0, c1, c2, . . . ‚ü©is an arbitrary sequence of coecients; the innite sum
c0
¬°k
0
¬¢
+ c1
¬°k
1
¬¢
+ c2
¬°k
2
¬¢
+ ¬∑ ¬∑ ¬∑ is actually nite for all k  0, so convergence is
not an issue. In particular, we can prove the important identity
X
k
¬µn
k
¬∂
(‚àí1)k(a0 + a1k + ¬∑ ¬∑ ¬∑ + ankn) = (‚àí1)nn! an ,
integer n  0,
(5.42)
because the polynomial a0 + a1k + ¬∑ ¬∑ ¬∑ + ankn can always be written as a
Newton series c0
¬°k
0
¬¢
+ c1
¬°k
1
¬¢
+ ¬∑ ¬∑ ¬∑ + cn
¬°k
n
¬¢
with cn = n! an.
Many sums that appear to be hopeless at rst glance can actually be
summed almost trivially by using the idea of nth dierences. For example,
let's consider the identity
X
k
¬µn
k
¬∂¬µr ‚àísk
n
¬∂
(‚àí1)k = sn ,
integer n  0.
(5.43)
This looks very impressive, because it's quite dierent from anything we've
seen so far. But it really is easy to understand, once we notice the telltale
factor
¬°n
k
¬¢
(‚àí1)k in the summand, because the function
f(k) =
¬µr ‚àísk
n
¬∂
=
1
n!(‚àí1)nsnkn + ¬∑ ¬∑ ¬∑ = (‚àí1)nsn
¬µk
n
¬∂
+ ¬∑ ¬∑ ¬∑

5.3 TRICKS OF THE TRADE 191
is a polynomial in k of degree n, with leading coecient (‚àí1)nsn/n!. There-
fore (5.43) is nothing more than an application of (5.42).
We have discussed Newton series under the assumption that f(x) is a
polynomial. But we've also seen that innite Newton series
f(x) = c0
¬µx
0
¬∂
+ c1
¬µx
1
¬∂
+ c2
¬µx
2
¬∂
+ ¬∑ ¬∑ ¬∑
make sense too, because such sums are always nite when x is a nonnegative
integer. Our derivation of the formula ‚àÜn f(0) = cn works in the innite case,
just as in the polynomial case; so we have the general identity
f(x) = f(0)
¬µx
0
¬∂
+ ‚àÜf(0)
¬µx
1
¬∂
+ ‚àÜ2 f(0)
¬µx
2
¬∂
+ ‚àÜ3 f(0)
¬µx
3
¬∂
+ ¬∑ ¬∑ ¬∑ ,
integer x  0.
(5.44)
This formula is valid for any function f(x) that is dened for nonnegative
integers x. Moreover, if the right-hand side converges for other values of x,
it denes a function that \interpolates" f(x) in a natural way. (There are
innitely many ways to interpolate function values, so we cannot assert that
(5.44) is true for all x that make the innite series converge. For example,
if we let f(x) = sin(œÄx), we have f(x) = 0 at all integer points, so the right-
hand side of (5.44) is identically zero; but the left-hand side is nonzero at all
noninteger x.)
A Newton series is nite calculus's answer to innite calculus's Taylor
series. Just as a Taylor series can be written
g(a + x) = g(a)
0! x0 + g‚Ä≤(a)
1!
x1 + g‚Ä≤‚Ä≤(a)
2!
x2 + g‚Ä≤‚Ä≤‚Ä≤(a)
3!
x3 + ¬∑ ¬∑ ¬∑ ,
the Newton series for f(x) = g(a + x) can be written
(Since E = 1 + ‚àÜ,
Ex = Œ£k
ƒÖx
k
ƒá
‚àÜk ;
and Exg(a) =
g(a + x).)
g(a + x) = g(a)
0! x0 + ‚àÜg(a)
1!
x1 + ‚àÜ2 g(a)
2!
x2 + ‚àÜ3 g(a)
3!
x3 + ¬∑ ¬∑ ¬∑ . (5.45)
(This is the same as (5.44), because ‚àÜn f(0) = ‚àÜn g(a) for all n  0 when
f(x) = g(a + x).) Both the Taylor and Newton series are nite when g is a
polynomial, or when x = 0; in addition, the Newton series is nite when x is a
positive integer. Otherwise the sums may or may not converge for particular
values of x. If the Newton series converges when x is not a nonnegative integer,
it might actually converge to a value that's dierent from g(a + x), because
the Newton series (5.45) depends only on the spaced-out function values g(a),
g(a + 1), g(a + 2), . . . .

192 BINOMIAL COEFFICIENTS
One example of a convergent Newton series is provided by the binomial
theorem. Let g(x) = (1 + z)x, where z is a xed complex number such that
jzj < 1. Then ‚àÜg(x) = (1 + z)x+1 ‚àí(1 + z)x = z(1 + z)x, hence ‚àÜn g(x) =
zn(1 + z)x. In this case the innite Newton series
g(a + x) =
X
n
‚àÜn g(a)
¬µx
n
¬∂
= (1 + z)a X
n
¬µx
n
¬∂
zn
converges to the \correct" value (1 + z)a+x, for all x.
James Stirling tried to use Newton series to generalize the factorial func-
tion to noninteger values. First he found coecients Sn such that
x! =
X
n
Sn
¬µx
n
¬∂
= S0
¬µx
0
¬∂
+ S1
¬µx
1
¬∂
+ S2
¬µx
2
¬∂
+ ¬∑ ¬∑ ¬∑
(5.46)
is an identity for x = 0, x = 1, x = 2, etc. But he discovered that the resulting
\Forasmuch as these
terms increase
very fast, their
dierences will
make a diverging
progression, which
hinders the ordinate
of the parabola
from approaching to
the truth; therefore
in this and the like
cases, I interpolate
the logarithms of
the terms, whose
dierences consti-
tute a series swiftly
converging."
|J. Stirling [343]
series doesn't converge except when x is a nonnegative integer. So he tried
again, this time writing
ln x! =
X
n
sn
¬µx
n
¬∂
= s0
¬µx
0
¬∂
+ s1
¬µx
1
¬∂
+ s2
¬µx
2
¬∂
+ ¬∑ ¬∑ ¬∑ .
(5.47)
Now ‚àÜ(ln x!) = ln(x + 1)! ‚àíln x! = ln(x + 1), hence
sn = ‚àÜn(ln x!)
¬Ø¬Ø
x=0
= ‚àÜn‚àí1¬°
ln(x + 1)
¬¢¬Ø¬Ø
x=0
=
X
k
¬µn ‚àí1
k
¬∂
(‚àí1)n‚àí1‚àík ln(k + 1)
by (5.40). The coecients are therefore s0 = s1 = 0; s2 = ln 2; s3 = ln 3 ‚àí
2 ln 2 = ln 3
4; s4 = ln 4‚àí3 ln 3+3 ln 2 = ln 32
27; etc. In this way Stirling obtained
(Proofs of conver-
gence were not
invented until the
nineteenth century.)
a series that does converge (although he didn't prove it); in fact, his series
converges for all x > ‚àí1. He was thereby able to evaluate 1
2! satisfactorily.
Exercise 88 tells the rest of the story.
Trick 3: Inversion.
A special case of the rule (5.45) we've just derived for Newton's series
can be rewritten in the following way:
g(n) =
X
k
¬µn
k
¬∂
(‚àí1)kf(k)
‚áê‚áí
f(n) =
X
k
¬µn
k
¬∂
(‚àí1)kg(k) .
(5.48)

5.3 TRICKS OF THE TRADE 193
This dual relationship between f and g is called an inversion formula; it's
rather like the Mobius inversion formulas (4.56) and (4.61) that we encoun-
tered in Chapter 4. Inversion formulas tell us how to solve \implicit recur-
Invert this:
`znb ppo'.
rences," where an unknown sequence is embedded in a sum.
For example, g(n) might be a known function, and f(n) might be un-
known; and we might have found a way to show that g(n) = P
k
¬°n
k
¬¢
(‚àí1)kf(k).
Then (5.48) lets us express f(n) as a sum of known values.
We can prove (5.48) directly by using the basic methods at the beginning
of this chapter. If g(n) = P
k
¬°n
k
¬¢
(‚àí1)kf(k) for all n  0, then
X
k
¬µn
k
¬∂
(‚àí1)kg(k) =
X
k
¬µn
k
¬∂
(‚àí1)k X
j
¬µk
j
¬∂
(‚àí1)jf(j)
=
X
j
f(j)
X
k
¬µn
k
¬∂
(‚àí1)k+j
¬µk
j
¬∂
=
X
j
f(j)
X
k
¬µn
j
¬∂
(‚àí1)k+j
¬µn ‚àíj
k ‚àíj
¬∂
=
X
j
f(j)
¬µn
j
¬∂ X
k
(‚àí1)k
¬µn ‚àíj
k
¬∂
=
X
j
f(j)
¬µn
j
¬∂
[n ‚àíj = 0]
=
f(n) .
The proof in the other direction is, of course, the same, because the relation
between f and g is symmetric.
Let's illustrate (5.48) by applying it to the \football victory problem":
A group of n fans of the winning football team throw their hats high into the
air. The hats come back randomly, one hat to each of the n fans. How many
ways h(n, k) are there for exactly k fans to get their own hats back?
For example, if n = 4 and if the hats and fans are named A, B, C, D,
the 4! = 24 possible ways for hats to land generate the following numbers of
rightful owners:
ABCD
4
BACD
2
CABD
1
DABC
0
ABDC
2
BADC
0
CADB
0
DACB
1
ACBD
2
BCAD
1
CBAD
2
DBAC
1
ACDB
1
BCDA
0
CBDA
1
DBCA
2
ADBC
1
BDAC
0
CDAB
0
DCAB
0
ADCB
2
BDCA
1
CDBA
0
DCBA
0
Therefore h(4, 4) = 1; h(4, 3) = 0; h(4, 2) = 6; h(4, 1) = 8; h(4, 0) = 9.

194 BINOMIAL COEFFICIENTS
We can determine h(n, k) by noticing that it is the number of ways to
choose k lucky hat owners, namely
¬°n
k
¬¢
, times the number of ways to arrange
the remaining n‚àík hats so that none of them goes to the right owner, namely
h(n ‚àík, 0). A permutation is called a derangement if it moves every item,
and the number of derangements of n objects is sometimes denoted by the
symbol `n<', read \n subfactorial." Therefore h(n ‚àík, 0) = (n ‚àík)<, and we
have the general formula
h(n, k) =
¬µn
k
¬∂
h(n ‚àík, 0) =
¬µn
k
¬∂
(n ‚àík)< .
(Subfactorial notation isn't standard, and it's not clearly a great idea; but
let's try it awhile to see if we grow to like it. We can always resort to `Dn' or
something, if `n<' doesn't work out.)
Our problem would be solved if we had a closed form for n<, so let's see
what we can nd. There's an easy way to get a recurrence, because the sum
of h(n, k) for all k is the total number of permutations of n hats:
n! =
X
k
h(n, k) =
X
k
¬µn
k
¬∂
(n ‚àík)<
=
X
k
¬µn
k
¬∂
k< ,
integer n  0.
(5.49)
(We've changed k to n ‚àík and
¬° n
n‚àík
¬¢
to
¬°n
k
¬¢
in the last step.) With this
implicit recurrence we can compute all the h(n, k)'s we like:
n
h(n, 0)
h(n, 1)
h(n, 2)
h(n, 3)
h(n, 4)
h(n, 5)
h(n, 6)
0
1
1
0
1
2
1
0
1
3
2
3
0
1
4
9
8
6
0
1
5
44
45
20
10
0
1
6
265
264
135
40
15
0
1
For example, here's how the row for n = 4 can be computed: The two right-
most entries are obvious | there's just one way for all hats to land correctly,
and there's no way for just three fans to get their own. (Whose hat would the
fourth fan get?) When k = 2 and k = 1, we can use our equation for h(n, k),
giving h(4, 2) =
¬°4
2
¬¢
h(2, 0) = 6¬∑1 = 6, and h(4, 1) =
¬°4
1
¬¢
h(3, 0) = 4¬∑2 = 8. We
can't use this equation for h(4, 0); rather, we can, but it gives us h(4, 0) =
¬°4
0
¬¢
h(4, 0), which is true but useless. Taking another tack, we can use the
The art of math-
ematics, as of life,
is knowing which
truths are useless.
relation h(4, 0)+8+6+0+1 = 4! to deduce that h(4, 0) = 9; this is the value
of 4<. Similarly n< depends on the values of k< for k < n.

5.3 TRICKS OF THE TRADE 195
How can we solve a recurrence like (5.49)? Easy; it has the form of (5.48),
with g(n) = n! and f(k) = (‚àí1)kk<. Hence its solution is
n< = (‚àí1)n X
k
¬µn
k
¬∂
(‚àí1)kk! .
Well, this isn't really a solution; it's a sum that should be put into closed form
if possible. But it's better than a recurrence. The sum can be simplied, since
k! cancels with a hidden k! in
¬°n
k
¬¢
, so let's try that: We get
n< =
X
0kn
n!
(n ‚àík)!(‚àí1)n+k = n!
X
0kn
(‚àí1)k
k!
.
(5.50)
The remaining sum converges rapidly to the number P
k0(‚àí1)k/k! = e‚àí1.
In fact, the terms that are excluded from the sum are
n!
X
k>n
(‚àí1)k
k!
= (‚àí1)n+1
n + 1
X
k0
(‚àí1)k
(n + 1)!
(k + n + 1)!
= (‚àí1)n+1
n + 1
¬µ
1 ‚àí
1
n + 2 +
1
(n + 2)(n + 3) ‚àí¬∑ ¬∑ ¬∑
¬∂
,
and the parenthesized quantity lies between 1 and 1 ‚àí
1
n+2 = n+1
n+2. Therefore
the dierence between n< and n!/e is roughly 1/n in absolute value; more
precisely, it lies between 1/(n + 1) and 1/(n + 2).
But n< is an integer.
Therefore it must be what we get when we round n!/e to the nearest integer,
if n > 0. So we have the closed form we seek:
n< =
¬πn!
e + 1
2
¬∫
+ [n = 0] .
(5.51)
This is the number of ways that no fan gets the right hat back. When
n is large, it's more meaningful to know the probability that this happens.
Baseball fans: .367
is also Ty Cobb's
lifetime batting
average, the all-time
record. Can this be
a coincidence?
(Hey wait, you're
fudging. Cobb's
average was
4191/11429 ‚âà
.366699, while
1/e ‚âà.367879.
But maybe if
Wade Boggs has
a few really good
seasons. . . )
If we assume that each of the n! arrangements is equally likely | because the
hats were thrown extremely high | this probability is
n<
n! = n!/e + O(1)
n!
‚àº1
e = .367. . . .
So when n gets large the probability that all hats are misplaced is almost 37%.
Incidentally, recurrence (5.49) for subfactorials is exactly the same as
(5.46), the rst recurrence considered by Stirling when he was trying to gen-
eralize the factorial function. Hence Sk = k<. These coecients are so large,
it's no wonder the innite series (5.46) diverges for noninteger x.
Before leaving this problem, let's look briey at two interesting patterns
that leap out at us in the table of small h(n, k). First, it seems that the num-
bers 1, 3, 6, 10, 15, . . . below the all-0 diagonal are the triangular numbers.

196 BINOMIAL COEFFICIENTS
This observation is easy to prove, since those table entries are the h(n, n‚àí2)'s,
and we have
h(n, n‚àí2) =
¬µ
n
n ‚àí2
¬∂
2< =
¬µn
2
¬∂
.
It also seems that the numbers in the rst two columns dier by ¬±1. Is
this always true? Yes,
h(n, 0) ‚àíh(n, 1) = n< ‚àín(n ‚àí1)<
=
¬µ
n!
X
0kn
(‚àí1)k
k!
¬∂
‚àí
¬µ
n(n ‚àí1)!
X
0kn‚àí1
(‚àí1)k
k!
¬∂
= n!(‚àí1)n
n!
= (‚àí1)n .
In other words, n< = n(n ‚àí1)< + (‚àí1)n. This is a much simpler recurrence
for the derangement numbers than we had before.
Now let's invert something else. If we apply inversion to the formula
But inversion is the
source of smog.
X
k
¬µn
k
¬∂(‚àí1)k
x + k
= 1
x
¬µx + n
n
¬∂‚àí1
that we derived in (5.41), we nd
x
x + n =
X
k0
¬µn
k
¬∂
(‚àí1)k
¬µx + k
k
¬∂‚àí1
.
This is interesting, but not really new. If we negate the upper index in
¬°x+k
k
¬¢
,
we have merely discovered identity (5.33) again.
5.4
GENERATING FUNCTIONS
We come now to the most important idea in this whole book, the
notion of a generating function. An innite sequence ‚ü®a0, a1, a2, . . . ‚ü©that
we wish to deal with in some way can conveniently be represented as a power
series in an auxiliary variable z,
A(z) = a0 + a1z + a2z2 + ¬∑ ¬∑ ¬∑ =
X
k0
akzk .
(5.52)
It's appropriate to use the letter z as the name of the auxiliary variable, be-
cause we'll often be thinking of z as a complex number. The theory of complex
variables conventionally uses `z' in its formulas; power series (a.k.a. analytic
functions or holomorphic functions) are central to that theory.

5.4 GENERATING FUNCTIONS 197
We will be seeing lots of generating functions in subsequent chapters.
Indeed, Chapter 7 is entirely devoted to them. Our present goal is simply to
introduce the basic concepts, and to demonstrate the relevance of generating
functions to the study of binomial coecients.
A generating function is useful because it's a single quantity that repre-
sents an entire innite sequence. We can often solve problems by rst setting
up one or more generating functions, then by fooling around with those func-
tions until we know a lot about them, and nally by looking again at the
coecients. With a little bit of luck, we'll know enough about the function
to understand what we need to know about its coecients.
If A(z) is any power series P
k0 akzk, we will nd it convenient to write
(See [223] for a
discussion of the
history and use-
fulness of this
notation.)
[zn] A(z) = an ;
(5.53)
in other words, [zn] A(z) denotes the coecient of zn in A(z).
Let A(z) be the generating function for ‚ü®a0, a1, a2, . . . ‚ü©as in (5.52),
and let B(z) be the generating function for another sequence ‚ü®b0, b1, b2, . . . ‚ü©.
Then the product A(z)B(z) is the power series
(a0 + a1z + a2z2 + ¬∑ ¬∑ ¬∑ )(b0 + b1z + b2z2 + ¬∑ ¬∑ ¬∑ )
= a0b0 + (a0b1 + a1b0)z + (a0b2 + a1b1 + a2b0)z2 + ¬∑ ¬∑ ¬∑ ;
the coecient of zn in this product is
a0bn + a1bn‚àí1 + ¬∑ ¬∑ ¬∑ + anb0 =
n
X
k=0
akbn‚àík .
Therefore if we wish to evaluate any sum that has the general form
cn =
n
X
k=0
akbn‚àík ,
(5.54)
and if we know the generating functions A(z) and B(z), we have
cn = [zn] A(z)B(z) .
The sequence ‚ü®cn‚ü©dened by (5.54) is called the convolution of the se-
quences ‚ü®an‚ü©and ‚ü®bn‚ü©; two sequences are \convolved" by forming the sums of
all products whose subscripts add up to a given amount. The gist of the previ-
ous paragraph is that convolution of sequences corresponds to multiplication
of their generating functions.

198 BINOMIAL COEFFICIENTS
Generating functions give us powerful ways to discover and/or prove
identities. For example, the binomial theorem tells us that (1 + z)r is the
generating function for the sequence ‚ü®
¬°r
0
¬¢
,
¬°r
1
¬¢
,
¬°r
2
¬¢
, . . . ‚ü©:
(1 + z)r =
X
k0
¬µr
k
¬∂
zk .
Similarly,
(1 + z)s =
X
k0
¬µs
k
¬∂
zk .
If we multiply these together, we get another generating function:
(1 + z)r(1 + z)s = (1 + z)r+s .
And now comes the punch line: Equating coecients of zn on both sides of
this equation gives us
n
X
k=0
¬µr
k
¬∂¬µ
s
n ‚àík
¬∂
=
¬µr + s
n
¬∂
.
We've discovered Vandermonde's convolution, (5.27)!
(5.27)! =
(5.27)(4.27)
(3.27)(2.27)
(1.27)(0.27)!.
That was nice and easy; let's try another. This time we use (1‚àíz)r, which
is the generating function for the sequence
¬≠
(‚àí1)n¬°r
n
¬¢¬Æ
=
¬≠¬°r
0
¬¢
, ‚àí
¬°r
1
¬¢
,
¬°r
2
¬¢
, . . .
¬Æ
.
Multiplying by (1 + z)r gives another generating function whose coecients
we know:
(1 ‚àíz)r(1 + z)r = (1 ‚àíz2)r .
Equating coecients of zn now gives the equation
n
X
k=0
¬µr
k
¬∂¬µ
r
n ‚àík
¬∂
(‚àí1)k = (‚àí1)n/2
¬µ r
n/2
¬∂
[n even] .
(5.55)
We should check this on a small case or two. When n = 3, for example,
the result is
¬µr
0
¬∂¬µr
3
¬∂
‚àí
¬µr
1
¬∂¬µr
2
¬∂
+
¬µr
2
¬∂¬µr
1
¬∂
‚àí
¬µr
3
¬∂¬µr
0
¬∂
= 0 .
Each positive term is cancelled by a corresponding negative term. And the
same thing happens whenever n is odd, in which case the sum isn't very

5.4 GENERATING FUNCTIONS 199
interesting. But when n is even, say n = 2, we get a nontrivial sum that's
dierent from Vandermonde's convolution:
¬µr
0
¬∂¬µr
2
¬∂
‚àí
¬µr
1
¬∂¬µr
1
¬∂
+
¬µr
2
¬∂¬µr
0
¬∂
= 2
¬µr
2
¬∂
‚àír2 = ‚àír .
So (5.55) checks out ne when n = 2. It turns out that (5.30) is a special case
of our new identity (5.55).
Binomial coecients also show up in some other generating functions,
most notably the following important identities in which the lower index
stays xed and the upper index varies:
If you have a high-
lighter pen, these
two equations have
got to be marked.
1
(1 ‚àíz)n+1 =
X
k0
¬µn + k
n
¬∂
zk ,
integer n  0
(5.56)
zn
(1 ‚àíz)n+1 =
X
k0
¬µk
n
¬∂
zk ,
integer n  0.
(5.57)
The second identity here is just the rst one multiplied by zn, that is, \shifted
right" by n places. The rst identity is just a special case of the binomial
theorem in slight disguise: If we expand (1 ‚àíz)‚àín‚àí1 by (5.13), the coecient
of zk is
¬°‚àín‚àí1
k
¬¢
(‚àí1)k, which can be rewritten as
¬°k+n
k
¬¢
or
¬°n+k
n
¬¢
by negating
the upper index. These special cases are worth noting explicitly, because they
arise so frequently in applications.
When n = 0 we get a special case of a special case, the geometric series:
1
1 ‚àíz = 1 + z + z2 + z3 + ¬∑ ¬∑ ¬∑ =
X
k0
zk .
This is the generating function for the sequence ‚ü®1, 1, 1, . . . ‚ü©, and it is espe-
cially useful because the convolution of any other sequence with this one is
the sequence of sums: When bk = 1 for all k, (5.54) reduces to
cn =
n
X
k=0
ak .
Therefore if A(z) is the generating function for the summands ‚ü®a0, a1, a2, . . . ‚ü©,
then A(z)/(1 ‚àíz) is the generating function for the sums ‚ü®c0, c1, c2, . . . ‚ü©.
The problem of derangements, which we solved by inversion in connection
with hats and football fans, can be resolved with generating functions in an
interesting way. The basic recurrence
n! =
X
k
¬µn
k
¬∂
(n ‚àík)<

200 BINOMIAL COEFFICIENTS
can be put into the form of a convolution if we expand
¬°n
k
¬¢
in factorials and
divide both sides by n!:
1 =
n
X
k=0
1
k!
(n ‚àík)<
(n ‚àík)! .
The generating function for the sequence ‚ü®1
0!, 1
1!, 1
2!, . . . ‚ü©is ez; hence if we let
D(z) =
X
k0
k<
k!zk ,
the convolution/recurrence tells us that
1
1 ‚àíz = ez D(z) .
Solving for D(z) gives
D(z) =
1
1 ‚àíz e‚àíz =
1
1 ‚àíz
¬µ 1
0!z0 ‚àí1
1!z1 + 1
2!z2 + ¬∑ ¬∑ ¬∑
¬∂
.
Equating coecients of zn now tells us that
n<
n! =
n
X
k=0
(‚àí1)k
k!
;
this is the formula we derived earlier by inversion.
So far our explorations with generating functions have given us slick
proofs of things that we already knew how to derive by more cumbersome
methods. But we haven't used generating functions to obtain any new re-
sults, except for (5.55). Now we're ready for something new and more sur-
prising. There are two families of power series that generate an especially rich
class of binomial coecient identities: Let us dene the generalized binomial
series Bt(z) and the generalized exponential series Et(z) as follows:
Bt(z) =
X
k0
(tk)k‚àí1 zk
k! ;
Et(z) =
X
k0
(tk + 1)k‚àí1 zk
k! .
(5.58)
It can be shown that these functions satisfy the identities
Bt(z)1‚àít ‚àíBt(z)‚àít = z ;
Et(z)‚àít ln Et(z) = z .
(5.59)
In the special case t = 0, we have
B0(z) = 1 + z ;
E0(z) = ez ;

5.4 GENERATING FUNCTIONS 201
this explains why the series with parameter t are called \generalized" bino-
mials and exponentials.
The following pairs of identities are valid for all real r:
The generalized bi-
nomial series Bt(z)
was discovered in
the 1750s by J.H.
Lambert [236, ¬ß38],
who noticed a few
years later [237]
that its powers
satisfy the rst
identity in (5.60).
Bt(z)r =
X
k0
¬µtk + r
k
¬∂
r
tk + rzk ;
Et(z)r =
X
k0
r(tk + r)k‚àí1
k!
zk ;
(5.60)
Bt(z)r
1 ‚àít + tBt(z)‚àí1 =
X
k0
¬µtk + r
k
¬∂
zk ;
Et(z)r
1 ‚àíztEt(z)t =
X
k0
(tk + r)k
k!
zk .
(5.61)
(When tk + r = 0, we have to be a little careful about how the coecient
of zk is interpreted; each coecient is a polynomial in r. For example, the
constant term of Et(z)r is r(0 + r)‚àí1, and this is equal to 1 even when r = 0.)
Since equations (5.60) and (5.61) hold for all r, we get very general iden-
tities when we multiply together the series that correspond to dierent powers
r and s. For example,
Bt(z)r
Bt(z)s
1 ‚àít + tBt(z)‚àí1 =
X
k0
¬µtk + r
k
¬∂
r
tk + rzk X
j0
¬µtj + s
j
¬∂
zj
=
X
n0
zn X
k0
¬µtk + r
k
¬∂
r
tk + r
¬µt(n ‚àík) + s
n ‚àík
¬∂
.
This power series must equal
Bt(z)r+s
1 ‚àít + tBt(z)‚àí1 =
X
n0
¬µtn + r + s
n
¬∂
zn ;
hence we can equate coecients of zn and get the identity
X
k
¬µtk + r
k
¬∂¬µt(n ‚àík) + s
n ‚àík
¬∂
r
tk + r =
¬µtn + r + s
n
¬∂
,
integer n,
valid for all real r, s, and t. When t = 0 this identity reduces to Vander-
monde's convolution.
(If by chance tk + r happens to equal zero in this
formula, the denominator factor tk + r should be considered to cancel with
the tk+r in the numerator of the binomial coecient. Both sides of the iden-
tity are polynomials in r, s, and t.) Similar identities hold when we multiply
Bt(z)r by Bt(z)s, etc.; Table 202 presents the results.

202 BINOMIAL COEFFICIENTS
Table 202 General convolution identities, valid for integer n  0.
X
k
¬µtk + r
k
¬∂¬µtn ‚àítk + s
n ‚àík
¬∂
r
tk + r =
¬µtn + r + s
n
¬∂
.
(5.62)
X
k
¬µtk + r
k
¬∂¬µtn ‚àítk + s
n ‚àík
¬∂
r
tk + r ¬∑
s
tn ‚àítk + s
=
¬µtn + r + s
n
¬∂
r + s
tn + r + s .
(5.63)
X
k
¬µn
k
¬∂
(tk + r)k¬°
tn ‚àítk + s
¬¢n‚àík
r
tk + r = (tn + r + s)n .
(5.64)
X
k
¬µn
k
¬∂
(tk + r)k¬°
tn ‚àítk + s
¬¢n‚àík
r
tk + r ¬∑
s
tn ‚àítk + s
= (tn + r + s)n
r + s
tn + r + s .
(5.65)
We have learned that it's generally a good idea to look at special cases of
general results. What happens, for example, if we set t = 1? The generalized
binomial B1(z) is very simple | it's just
B1(z) =
X
k0
zk =
1
1 ‚àíz ;
therefore B1(z) doesn't give us anything we didn't already know from Van-
dermonde's convolution. But E1(z) is an important function,
E(z) =
X
k0
(k + 1)k‚àí1 zk
k! = 1 + z + 3
2z2 + 8
3z3 + 125
24 z4 + ¬∑ ¬∑ ¬∑
(5.66)
which we haven't seen before; it satises the basic identity
Aha! This is the
iterated power
function
E(ln z) = zzz...
that I've often
wondered about.
Zzzzzz. . .
E(z) = ezE(z) .
(5.67)
This function, rst studied by Euler [117] and Eisenstein [91], arises in a great
many applications [203, 193].
The special cases t = 2 and t = ‚àí1 of the generalized binomial are of
particular interest, because their coecients occur again and again in prob-
lems that have a recursive structure. Therefore it's useful to display these

5.4 GENERATING FUNCTIONS 203
series explicitly for future reference:
The power series
for B1/2(z)r =
(
‚àö
z2 + 4 + z)2r/4r
is noteworthy too.
B2(z) =
X
k
¬µ2k
k
¬∂ zk
1 + k
=
X
k
¬µ2k + 1
k
¬∂
zk
1 + 2k = 1 ‚àí
‚àö
1 ‚àí4z
2z
.
(5.68)
B‚àí1(z) =
X
k
¬µ1 ‚àík
k
¬∂ zk
1 ‚àík
=
X
k
¬µ2k ‚àí1
k
¬∂ (‚àíz)k
1 ‚àí2k = 1 +
‚àö
1 + 4z
2
.
(5.69)
B2(z)r =
X
k
¬µ2k + r
k
¬∂
r
2k + r zk .
(5.70)
B‚àí1(z)r =
X
k
¬µr ‚àík
k
¬∂
r
r ‚àík zk .
(5.71)
B2(z)r
‚àö
1 ‚àí4z
=
X
k
¬µ2k + r
k
¬∂
zk .
(5.72)
B‚àí1(z)r+1
‚àö
1 + 4z
=
X
k
¬µr ‚àík
k
¬∂
zk .
(5.73)
The coecients
¬°2n
n
¬¢
1
n+1 of B2(z) are called the Catalan numbers Cn, be-
cause Eugene Catalan wrote an inuential paper about them in the 1830s
[52]. The sequence begins as follows:
n
0
1
2
3
4
5
6
7
8
9
10
Cn
1
1
2
5
14
42
132
429
1430
4862
16796
The coecients of B‚àí1(z) are essentially the same, but there's an extra 1 at
the beginning and the other numbers alternate in sign: ‚ü®1,1,‚àí1,2,‚àí5,14,. . .‚ü©.
Thus B‚àí1(z) = 1 + zB2(‚àíz). We also have B‚àí1(z) = B2(‚àíz)‚àí1.
Let's close this section by deriving an important consequence of (5.72)
and (5.73), a relation that shows further connections between the functions
B‚àí1(z) and B2(‚àíz):
B‚àí1(z)n+1 ‚àí(‚àíz)n+1B2(‚àíz)n+1
‚àö
1 + 4z
=
X
kn
¬µn ‚àík
k
¬∂
zk .

204 BINOMIAL COEFFICIENTS
This holds because the coecient of zk in (‚àíz)n+1B2(‚àíz)n+1/
‚àö
1 + 4z is
[zk] (‚àíz)n+1B2(‚àíz)n+1
‚àö
1 + 4z
= (‚àí1)n+1[zk‚àín‚àí1] B2(‚àíz)n+1
‚àö
1 + 4z
= (‚àí1)n+1(‚àí1)k‚àín‚àí1[zk‚àín‚àí1] B2(z)n+1
‚àö
1 ‚àí4z
= (‚àí1)k
¬µ2(k ‚àín ‚àí1) + n + 1
k ‚àín ‚àí1
¬∂
= (‚àí1)k
¬µ2k ‚àín ‚àí1
k ‚àín ‚àí1
¬∂
= (‚àí1)k
¬µ2k ‚àín ‚àí1
k
¬∂
=
¬µn ‚àík
k
¬∂
= [zk] B‚àí1(z)n+1
‚àö
1 + 4z
when k > n. The terms nicely cancel each other out. We can now use (5.68)
and (5.69) to obtain the closed form
X
kn
¬µn ‚àík
k
¬∂
zk =
1
‚àö
1+4z
¬µ¬µ1 +
‚àö
1+4z
2
¬∂n+1
‚àí
¬µ1 ‚àí
‚àö
1+4z
2
¬∂n+1¬∂
,
integer n  0.
(5.74)
(The special case z = ‚àí1 came up in Problem 3 of Section 5.2. Since the
numbers 1
2(1 ¬±
‚àö
‚àí3 ) are sixth roots of unity, the sums P
kn
¬°n‚àík
k
¬¢
(‚àí1)k
have the periodic behavior we observed in that problem.) Similarly we can
combine (5.70) with (5.71) to cancel the large coecients and get
X
k<n
¬µn ‚àík
k
¬∂
n
n ‚àík zk =
¬µ1 +
‚àö
1+4z
2
¬∂n
+
¬µ1 ‚àí
‚àö
1+4z
2
¬∂n
,
integer n > 0.
(5.75)
5.5
HYPERGEOMETRIC FUNCTIONS
The methods we've been applying to binomial coecients are very
eective, when they work, but we must admit that they often appear to be
ad hoc | more like tricks than techniques. When we're working on a problem,
we often have many directions to pursue, and we might nd ourselves going
They're even more
versatile than
chameleons; we
can dissect them
and put them
back together in
dierent ways.
around in circles. Binomial coecients are like chameleons, changing their
appearance easily. Therefore it's natural to ask if there isn't some unifying
principle that will systematically handle a great variety of binomial coecient
summations all at once. Fortunately, the answer is yes. The unifying principle
is based on the theory of certain innite sums called hypergeometric series.

5.5 HYPERGEOMETRIC FUNCTIONS 205
The study of hypergeometric series was launched many years ago by Eu-
ler, Gauss, and Riemann; such series, in fact, are still the subject of consid-
erable research. But hypergeometrics have a somewhat formidable notation,
which takes a little time to get used to.
Anything that has
survived for cen-
turies with such
awesome notation
must be really
useful.
The general hypergeometric series is a power series in z with m + n
parameters, and it is dened as follows in terms of rising factorial powers:
F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
ak
1 . . . ak
m
bk
1 . . . bkn
zk
k!
.
(5.76)
To avoid division by zero, none of the b's may be zero or a negative integer.
Other than that, the a's and b's may be anything we like.
The notation
`F(a1, . . . , am; b1, . . . , bn; z)' is also used as an alternative to the two-line form
(5.76), since a one-line form sometimes works better typographically. The a's
are said to be upper parameters; they occur in the numerator of the terms
of F. The b's are lower parameters, and they occur in the denominator. The
nal quantity z is called the argument.
Standard reference books often use `mFn' instead of `F' as the name of a
hypergeometric with m upper parameters and n lower parameters. But the
extra subscripts tend to clutter up the formulas and waste our time, if we're
compelled to write them over and over. We can count how many parameters
there are, so we usually don't need extra additional unnecessary redundancy.
Many important functions occur as special cases of the general hypergeo-
metric; indeed, that's why hypergeometrics are so powerful. For example, the
simplest case occurs when m = n = 0: There are no parameters at all, and
we get the familiar series
F
¬µ ¬Ø¬Ø¬Ø z
¬∂
=
X
k0
zk
k! = ez .
Actually the notation looks a bit unsettling when m or n is zero. We can add
an extra `1' above and below in order to avoid this:
F
¬µ1
1
¬Ø¬Ø¬Ø z
¬∂
= ez .
In general we don't change the function if we cancel a parameter that occurs
in both numerator and denominator, or if we insert two identical parameters.
The next simplest case has m = 1, a1 = 1, and n = 0; we change the
parameters to m = 2, a1 = a2 = 1, n = 1, and b1 = 1, so that n > 0. This
series also turns out to be familiar, because 1k = k!:
F
¬µ1, 1
1
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
zk =
1
1 ‚àíz .

206 BINOMIAL COEFFICIENTS
It's our old friend, the geometric series; F(a1, . . . , am; b1, . . . , bn; z) is called
hypergeometric because it includes the geometric series F(1, 1; 1; z) as a very
special case.
The general case m = 1 and n = 0 is, in fact, easy to sum in closed form,
F
¬µa, 1
1
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
ak zk
k! =
X
k
¬µa + k ‚àí1
k
¬∂
zk =
1
(1 ‚àíz)a ,
(5.77)
using (5.56). If we replace a by ‚àía and z by ‚àíz, we get the binomial theorem,
F
¬µ‚àía, 1
1
¬Ø¬Ø¬Ø ‚àíz
¬∂
= (1 + z)a .
A negative integer as upper parameter causes the innite series to become
nite, since (‚àía)k = 0 whenever k > a  0 and a is an integer.
The general case m = 0, n = 1 is another famous series, but it's not as
well known in the literature of discrete mathematics:
F
¬µ 1
b, 1
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
(b ‚àí1)!
(b ‚àí1 + k)!
zk
k! = Ib‚àí1
¬°
2‚àöz
¬¢ (b ‚àí1)!
z(b‚àí1)/2 .
(5.78)
This function Ib‚àí1 is called a \modied Bessel function" of order b ‚àí1. The
special case b = 1 gives us F
¬° 1
1,1jz
¬¢
= I0(2‚àöz), which is the interesting series
P
k0 zk/k!2.
The special case m = n = 1 is called a \conuent hypergeometric series"
and often denoted by the letter M:
F
¬µa
b
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
ak
bk
zk
k!
= M(a, b, z) .
(5.79)
This function, which has important applications to engineering, was intro-
duced by Ernst Kummer.
By now a few of us are wondering why we haven't discussed convergence
of the innite series (5.76). The answer is that we can ignore convergence if
we are using z simply as a formal symbol. It is not dicult to verify that
formal innite sums of the form P
kn Œ±kzk form a eld, if the coecients
Œ±k lie in a eld. We can add, subtract, multiply, divide, dierentiate, and do
functional composition on such formal sums without worrying about conver-
gence; any identities we derive will still be formally true. For example, the
hypergeometric F
¬° 1,1,1
1
jz
¬¢
= P
k0 k! zk doesn't converge for any nonzero z;
yet we'll see in Chapter 7 that we can still use it to solve problems. On the
other hand, whenever we replace z by a particular numerical value, we do
have to be sure that the innite sum is well dened.

5.5 HYPERGEOMETRIC FUNCTIONS 207
The next step up in complication is actually the most famous hypergeo-
metric of all. In fact, it was the hypergeometric series until about 1870, when
everything was generalized to arbitrary m and n. This one has two upper
parameters and one lower parameter:
F
¬µa, b
c
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
akbk zk
ck k!
.
(5.80)
It is often called the Gaussian hypergeometric, because many of its subtle
properties were rst proved by Gauss in his doctoral dissertation of 1812 [143],
\There must be
many universities
to-day where 95
per cent, if not
100 per cent, of the
functions studied by
physics, engineering,
and even mathe-
matics students,
are covered by
this single symbol
F(a, b; c; x)."
|W.W.Sawyer[318]
although Euler [118] and Pfa [292] had already discovered some remarkable
things about it. One of its important special cases is
ln(1 + z) = z F
¬µ1, 1
2
¬Ø¬Ø¬Ø ‚àíz
¬∂
= z
X
k0
k! k!
(k + 1)!
(‚àíz)k
k!
= z ‚àíz2
2 + z3
3 ‚àíz4
4 + ¬∑ ¬∑ ¬∑ .
Notice that z‚àí1 ln(1+z) is a hypergeometric function, but ln(1+z) itself can-
not be hypergeometric, since a hypergeometric series always has the value 1
when z = 0.
So far hypergeometrics haven't actually done anything for us except pro-
vide an excuse for name-dropping. But we've seen that several very dierent
functions can all be regarded as hypergeometric; this will be the main point of
interest in what follows. We'll see that a large class of sums can be written as
hypergeometric series in a \canonical" way, hence we will have a good ling
system for facts about binomial coecients.
What series are hypergeometric? It's easy to answer this question if we
look at the ratio between consecutive terms:
F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
tk,
tk = ak
1 . . . ak
m zk
bk
1 . . . bkn k!
.
The rst term is t0 = 1, and the other terms have ratios given by
tk+1
tk
= ak+1
1
. . . ak+1
m
ak
1 . . . akm
bk
1 . . . bk
n
bk+1
1
. . . bk+1
n
k!
(k + 1)!
zk+1
zk
=
(k + a1) . . . (k + am) z
(k + b1) . . . (k + bn)(k + 1) .
(5.81)
This is a rational function of k, that is, a quotient of polynomials in k.
According to the Fundamental Theorem of Algebra, any rational function

208 BINOMIAL COEFFICIENTS
of k can be factored over the complex numbers and put into this form. The
a's are the negatives of the roots of the polynomial in the numerator, and the
b's are the negatives of the roots of the polynomial in the denominator. If the
denominator doesn't already contain the special factor (k+1), we can include
(k + 1) in both numerator and denominator. A constant factor remains, and
we can call it z. Therefore hypergeometric series are precisely those series
whose rst term is 1 and whose term ratio tk+1/tk is a rational function of k.
Suppose, for example, that we're given an innite series with term ratio
tk+1
tk
= k2 + 7k + 10
4k2 + 1
,
a rational function of k. The numerator polynomial splits nicely into two
factors, (k + 2)(k + 5), and the denominator is 4(k + i/2)(k ‚àíi/2). Since the
denominator is missing the required factor (k + 1), we write the term ratio as
tk+1
tk
= (k + 2)(k + 5)(k + 1)(1/4)
(k + i/2)(k ‚àíi/2)(k + 1) ,
and we can read o the results: The given series is
X
k0
tk = t0 F
¬µ
2, 5, 1
i/2, ‚àíi/2
¬Ø¬Ø¬Ø 1/4
¬∂
.
Thus, we have a general method for nding the hypergeometric represen-
tation of a given quantity S, when such a representation is possible: First we
write S as an innite series whose rst term is nonzero. We choose a notation
so that the series is P
k0 tk with t0 Ã∏= 0. Then we calculate tk+1/tk. If the
(Now is a good
time to do warmup
exercise 11.)
term ratio is not a rational function of k, we're out of luck. Otherwise we
express it in the form (5.81); this gives parameters a1, . . . , am, b1, . . . , bn,
and an argument z, such that S = t0 F(a1, . . . , am; b1, . . . , bn; z).
Gauss's hypergeometric series can be written in the recursively factored
form
F
¬µa, b
c
¬Ø¬Ø¬Ø z
¬∂
= 1 + a
1
b
c z
¬µ
1 + a+1
2
b+1
c+1 z
¬µ
1 + a+2
3
b+2
c+2 z (1 + ¬∑ ¬∑ ¬∑ )
¬∂¬∂
if we wish to emphasize the importance of term ratios.
Let's try now to reformulate the binomial coecient identities derived
earlier in this chapter, expressing them as hypergeometrics.
For example,
let's gure out what the parallel summation law,
X
kn
¬µr + k
k
¬∂
=
¬µr + n + 1
n
¬∂
,
integer n,

5.5 HYPERGEOMETRIC FUNCTIONS 209
looks like in hypergeometric notation. We need to write the sum as an innite
series that starts at k = 0, so we replace k by n ‚àík:
X
k0
¬µr + n ‚àík
n ‚àík
¬∂
=
X
k0
(r + n ‚àík)!
r! (n ‚àík)!
=
X
k0
tk .
This series is formally innite but actually nite, because the (n ‚àík)! in the
denominator will make tk = 0 when k > n.
(We'll see later that 1/x! is
dened for all x, and that 1/x! = 0 when x is a negative integer. But for now,
let's blithely disregard such technicalities until we gain more hypergeometric
experience.) The term ratio is
tk+1
tk
= (r + n ‚àík ‚àí1)! r! (n ‚àík)!
r! (n ‚àík ‚àí1)! (r + n ‚àík)! =
n ‚àík
r + n ‚àík
=
(k + 1)(k ‚àín)(1)
(k ‚àín ‚àír)(k + 1) .
Furthermore t0 =
¬°r+n
n
¬¢
. Hence the parallel summation law is equivalent to
the hypergeometric identity
¬µr + n
n
¬∂
F
¬µ 1, ‚àín
‚àín‚àír
¬Ø¬Ø¬Ø 1
¬∂
=
¬µr + n + 1
n
¬∂
.
Dividing through by
¬°r+n
n
¬¢
gives a slightly simpler version,
F
¬µ 1, ‚àín
‚àín‚àír
¬Ø¬Ø¬Ø 1
¬∂
= r + n + 1
r + 1
,
if
¬µr + n
n
¬∂
Ã∏= 0.
(5.82)
Let's do another one. The term ratio of identity (5.16),
X
km
¬µr
k
¬∂
(‚àí1)k = (‚àí1)m
¬µr ‚àí1
m
¬∂
,
integer m,
is (k ‚àím)/(r ‚àím + k + 1) = (k + 1)(k ‚àím)(1)/(k ‚àím + r + 1)(k + 1), after
we replace k by m ‚àík; hence (5.16) gives a closed form for
F
¬µ
1, ‚àím
‚àím+r+1
¬Ø¬Ø¬Ø 1
¬∂
.
This is essentially the same as the hypergeometric function on the left of
(5.82), but with m in place of n and r + 1 in place of ‚àír. Therefore identity
(5.16) could have been derived from (5.82), the hypergeometric version of
(5.9). (No wonder we found it easy to prove (5.16) by using (5.9).)
Before we go further, we should think about degenerate cases, because
First derangements,
now degenerates.
hypergeometrics are not dened when a lower parameter is zero or a negative

210 BINOMIAL COEFFICIENTS
integer. We usually apply the parallel summation identity when r and n are
positive integers; but then ‚àín‚àír is a negative integer and the hypergeometric
(5.76) is undened. How then can we consider (5.82) to be legitimate? The
answer is that we can take the limit of F
¬°
1, ‚àín
‚àín‚àír+œµj1
¬¢
as œµ ‚Üí0.
We will look at such things more closely later in this chapter, but for now
let's just be aware that some denominators can be dynamite. It is interesting,
however, that the very rst sum we've tried to express hypergeometrically
(We proved the
identities originally
for integer r, and
used the polynomial
argument to show
that they hold in
general. Now we're
proving them rst
for irrational r,
and using a limiting
argument to show
that they hold for
integers!)
has turned out to be degenerate.
Another possibly sore point in our derivation of (5.82) is that we ex-
panded
¬°r+n‚àík
n‚àík
¬¢
as (r + n ‚àík)!/r! (n ‚àík)!. This expansion fails when r is a
negative integer, because (‚àím)! has to be ‚àûif the law
0! = 0 ¬∑ (‚àí1) ¬∑ (‚àí2) ¬∑ . . . ¬∑ (‚àím + 1) ¬∑ (‚àím)!
is going to hold. Again, we need to approach integer results by considering a
limit of r + œµ as œµ ‚Üí0.
But we dened the factorial representation
¬°r
k
¬¢
= r!/k! (r‚àík)! only when
r is an integer! If we want to work eectively with hypergeometrics, we need
a factorial function that is dened for all complex numbers. Fortunately there
is such a function, and it can be dened in many ways. Here's one of the most
useful denitions of z!, actually a denition of 1/z!:
1
z! =
lim
n‚Üí‚àû
¬µn + z
n
¬∂
n‚àíz .
(5.83)
(See exercise 21. Euler [99, 100, 72] discovered this when he was 22 years
old.) The limit can be shown to exist for all complex z, and it is zero only
when z is a negative integer. Another signicant denition is
z! =
Z ‚àû
0
tze‚àít dt ,
if <z > ‚àí1.
(5.84)
This integral exists only when the real part of z exceeds ‚àí1, but we can use
the formula
z! = z (z ‚àí1)!
(5.85)
to extend the denition to all complex z (except negative integers).
Still
another denition comes from Stirling's interpolation of ln z! in (5.47). All of
these approaches lead to the same generalized factorial function.
There's a very similar function called the Gamma function, which re-
lates to ordinary factorials somewhat as rising powers relate to falling powers.
Standard reference books often use factorials and Gamma functions simulta-
neously, and it's convenient to convert between them if necessary using the

5.5 HYPERGEOMETRIC FUNCTIONS 211
following formulas:
Œì(z + 1) = z! ;
(5.86)
(‚àíz)! Œì(z) =
œÄ
sin œÄz .
(5.87)
We can use these generalized factorials to dene generalized factorial
How do you write
z to the w power,
when w is the
complex conjugate
of w?
z(w) .
powers, when z and w are arbitrary complex numbers:
zw =
z!
(z ‚àíw)! ;
(5.88)
zw = Œì(z + w)
Œì(z)
.
(5.89)
The only proviso is that we must use appropriate limiting values when these
formulas give ‚àû/‚àû. (The formulas never give 0/0, because factorials and
Gamma-function values are never zero.) A binomial coecient can be written
¬µ z
w
¬∂
= lim
Œ∂‚Üíz lim
œâ‚Üíw
Œ∂!
œâ! (Œ∂ ‚àíœâ)!
(5.90)
when z and w are any complex numbers whatever.
I see, the lower
index arrives at
its limit rst.
That's why
ƒÖ z
w
ƒá
is zero when w is
a negative integer.
Armed with generalized factorial tools, we can return to our goal of re-
ducing the identities derived earlier to their hypergeometric essences. The
binomial theorem (5.13) turns out to be neither more nor less than (5.77),
as we might expect. So the next most interesting identity to try is Vander-
monde's convolution (5.27):
X
k
¬µr
k
¬∂¬µ
s
n ‚àík
¬∂
=
¬µr + s
n
¬∂
,
integer n.
The kth term here is
tk =
r!
(r ‚àík)! k!
s!
(s ‚àín + k)! (n ‚àík)! ,
and we are no longer too shy to use generalized factorials in these expres-
sions. Whenever tk contains a factor like (Œ± + k)!, with a plus sign before
the k, we get (Œ± + k + 1)!/(Œ± + k)! = k + Œ± + 1 in the term ratio tk+1/tk,
by (5.85); this contributes the parameter `Œ± + 1' to the corresponding hyper-
geometric | as an upper parameter if (Œ± + k)! was in the numerator of tk,
but as a lower parameter otherwise. Similarly, a factor like (Œ± ‚àík)! leads to
(Œ± ‚àík ‚àí1)!/(Œ± ‚àík)! = (‚àí1)/(k ‚àíŒ±); this contributes `‚àíŒ±' to the opposite
set of parameters (reversing the roles of upper and lower), and negates the
hypergeometric argument. Factors like r!, which are independent of k, go

212 BINOMIAL COEFFICIENTS
into t0 but disappear from the term ratio. Using such tricks we can predict
without further calculation that the term ratio of (5.27) is
tk+1
tk
= k ‚àír
k + 1
k ‚àín
k + s ‚àín + 1
times (‚àí1)2 = 1, and Vandermonde's convolution becomes
¬µs
n
¬∂
F
¬µ ‚àír, ‚àín
s‚àín+1
¬Ø¬Ø¬Ø 1
¬∂
=
¬µr + s
n
¬∂
.
(5.91)
We can use this equation to determine F(a, b; c; z) in general, when z = 1 and
when b is a negative integer.
Let's rewrite (5.91) in a form so that table lookup is easy when a new
sum needs to be evaluated. The result turns out to be
F
¬µa, b
c
¬Ø¬Ø¬Ø 1
¬∂
= Œì(c ‚àía ‚àíb) Œì(c)
Œì(c ‚àía) Œì(c ‚àíb) ;
integer b  0
or <c > <a + <b.
(5.92)
Vandermonde's convolution (5.27) covers only the case that one of the upper
parameters, say b, is a nonpositive integer; but Gauss proved that (5.92) is
A few weeks ago, we
were studying what
Gauss had done in
kindergarten.
Now we're studying
stu beyond his
Ph.D. thesis.
Is this intimidating
or what?
valid also when a, b, c are complex numbers whose real parts satisfy <c >
<a + <b. In other cases, the innite series F
¬° a,b
c j1
¬¢
doesn't converge. When
b = ‚àín, the identity can be written more conveniently with factorial powers
instead of Gamma functions:
F
¬µa, ‚àín
c
¬Ø¬Ø¬Ø 1
¬∂
= (c ‚àía)n
cn
= (a ‚àíc)n
(‚àíc)n
,
integer n  0.
(5.93)
It turns out that all ve of the identities in Table 169 are special cases of
Vandermonde's convolution; formula (5.93) covers them all, when proper at-
tention is paid to degenerate situations.
Notice that (5.82) is just the special case a = 1 of (5.93). Therefore we
don't really need to remember (5.82); and we don't really need the identity
(5.9) that led us to (5.82), even though Table 174 said that it was memo-
rable. A computer program for formula manipulation, faced with the prob-
lem of evaluating P
kn
¬°r+k
k
¬¢
, could convert the sum to a hypergeometric
and plug into the general identity for Vandermonde's convolution.
Problem 1 in Section 5.2 asked for the value of
X
k0
¬µm
k
¬∂√Å¬µn
k
¬∂
.
This problem is a natural for hypergeometrics, and after a bit of practice any
hypergeometer can read o the parameters immediately as F(1, ‚àím; ‚àín; 1).
Hmmm; that problem was yet another special takeo on Vandermonde!

5.5 HYPERGEOMETRIC FUNCTIONS 213
The sum in Problem 2 and Problem 4 likewise yields F(2, 1‚àín; 2‚àím; 1).
(We need to replace k by k + 1 rst.) And the \menacing" sum in Problem 6
turns out to be just F(n + 1, ‚àín; 2; 1). Is there nothing more to sum, besides
disguised versions of Vandermonde's powerful convolution?
Well, yes, Problem 3 is a bit dierent. It deals with a special case of the
general sum P
k
¬°n‚àík
k
¬¢
zk considered in (5.74), and this leads to a closed-form
expression for
F
¬µ1+2‚åàn/2‚åâ, ‚àín
1/2
¬Ø¬Ø¬Ø ‚àíz/4
¬∂
.
We also proved something new in (5.55), when we looked at the coe-
cients of (1 ‚àíz)r(1 + z)r:
F
¬µ1‚àíc‚àí2n, ‚àí2n
c
¬Ø¬Ø¬Ø ‚àí1
¬∂
= (‚àí1)n (2n)!
n!
(c ‚àí1)!
(c + n ‚àí1)! ,
integer n  0.
This is called Kummer's formula when it's generalized to complex numbers:
Kummer was a
summer.
F
¬µ
a, b
1+b‚àía
¬Ø¬Ø¬Ø ‚àí1
¬∂
= (b/2)!
b!
(b ‚àía)b/2 .
(5.94)
(Ernst Kummer [229] proved this in 1836.)
The summer of '36.
It's interesting to compare these two formulas. Replacing c by 1‚àí2n‚àía,
we nd that the results are consistent if and only if
(‚àí1)n (2n)!
n!
=
lim
b‚Üí‚àí2n
(b/2)!
b!
=
lim
x‚Üí‚àín
x!
(2x)!
(5.95)
when n is a positive integer. Suppose, for example, that n = 3; then we
should have ‚àí6!/3! = limx‚Üí‚àí3 x!/(2x)!. We know that (‚àí3)! and (‚àí6)! are
both innite; but we might choose to ignore that diculty and to imagine
that (‚àí3)! = (‚àí3)(‚àí4)(‚àí5)(‚àí6)!, so that the two occurrences of (‚àí6)! will
cancel. Such temptations must, however, be resisted, because they lead to
the wrong answer! The limit of x!/(2x)! as x ‚Üí‚àí3 is not (‚àí3)(‚àí4)(‚àí5) but
rather ‚àí6!/3! = (‚àí4)(‚àí5)(‚àí6), according to (5.95).
The right way to evaluate the limit in (5.95) is to use equation (5.87),
which relates negative-argument factorials to positive-argument Gamma func-
tions. If we replace x by ‚àín ‚àíœµ and let œµ ‚Üí0, two applications of (5.87)
give
(‚àín ‚àíœµ)!
(‚àí2n ‚àí2œµ)!
Œì(n + œµ)
Œì(2n + 2œµ) = sin(2n + 2œµ)œÄ
sin(n + œµ)œÄ .

214 BINOMIAL COEFFICIENTS
Now sin(x + y) = sin x cos y + cos x sin y; so this ratio of sines is
cos 2nœÄ sin 2œµœÄ
cos nœÄ sin œµœÄ
= (‚àí1)n¬°
2 + O(œµ)
¬¢
,
by the methods of Chapter 9. Therefore, by (5.86), we have
lim
œµ‚Üí0
(‚àín ‚àíœµ)!
(‚àí2n ‚àí2œµ)! = 2(‚àí1)n Œì(2n)
Œì(n)
= 2(‚àí1)n (2n ‚àí1)!
(n ‚àí1)!
= (‚àí1)n (2n)!
n!
,
as desired.
Let's complete our survey by restating the other identities we've seen so
far in this chapter, clothing them in hypergeometric garb. The triple-binomial
sum in (5.29) can be written
F
¬µ1‚àía‚àí2n, 1‚àíb‚àí2n, ‚àí2n
a, b
¬Ø¬Ø¬Ø 1
¬∂
= (‚àí1)n (2n)!
n!
(a + b + 2n ‚àí1)n
an bn
,
integer n  0.
When this one is generalized to complex numbers, it is called Dixon's for-
mula:
F
¬µ
a, b, c
1+c‚àía, 1+c‚àíb
¬Ø¬Ø¬Ø 1
¬∂
= (c/2)!
c!
(c ‚àía)c/2 (c ‚àíb)c/2
(c ‚àía ‚àíb)c/2
,
(5.96)
<a + <b < 1 + <c/2.
One of the most general formulas we've encountered is the triple-binomial
sum (5.28), which yields Saalschutz's identity:
(Historical note:
Saalschutz [315]
independently dis-
covered this formula
almost 100 years
after Pfa [292] had
rst published it.
Taking the limit as
n ‚Üí‚àûyields
equation (5.92).)
F
¬µ
a, b, ‚àín
c, a+b‚àíc‚àín+1
¬Ø¬Ø¬Ø 1
¬∂
= (c ‚àía)n (c ‚àíb)n
cn (c ‚àía ‚àíb)n
(5.97)
=
(a ‚àíc)n (b ‚àíc)n
(‚àíc)n (a + b ‚àíc)n ,
integer n  0.
This formula gives the value at z = 1 of the general hypergeometric series
with three upper parameters and two lower parameters, provided that one of
the upper parameters is a nonpositive integer and that b1 + b2 = a1 + a2 +
a3 + 1. (If the sum of the lower parameters exceeds the sum of the upper
parameters by 2 instead of by 1, the formula of exercise 25 can be used to
express F(a1, a2, a3; b1, b2; 1) in terms of two hypergeometrics that satisfy
Saalschutz's identity.)
Our hard-won identity in Problem 8 of Section 5.2 reduces to
1
1 + x F
¬µx+1, n+1, ‚àín
1, x+2
¬Ø¬Ø¬Ø 1
¬∂
= (‚àí1)nxn x‚àín‚àí1 .

5.5 HYPERGEOMETRIC FUNCTIONS 215
Sigh. This is just the special case c = 1 of Saalschutz's identity (5.97), so we
could have saved a lot of work by going to hypergeometrics directly!
What about Problem 7? That extra-menacing sum gives us the formula
F
¬µ n+1, m‚àín, 1, 1
2
1
2m+1, 1
2m+ 1
2, 2
¬Ø¬Ø¬Ø 1
¬∂
= m
n ,
which is the rst case we've seen with three lower parameters. So it looks
new. But it really isn't; the left-hand side can be replaced by
F
¬µn, m‚àín‚àí1, ‚àí1
2
1
2m,
1
2m‚àí1
2
¬Ø¬Ø¬Ø 1
¬∂
‚àí1 ,
using exercise 26, and Saalschutz's identity wins again.
Well, that's another deating experience, but it's also another reason to
(Historical note:
The great relevance
of hypergeometric
series to binomial
coecient identities
was rst pointed
out by George
Andrews in 1974
[9, section 5].)
appreciate the power of hypergeometric methods.
The convolution identities in Table 202 do not have hypergeometric
equivalents, because their term ratios are rational functions of k only when
t is an integer. Equations (5.64) and (5.65) aren't hypergeometric even when
t = 1. But we can take note of what (5.62) tells us when t has small integer
values:
F
¬µ
1
2r, 1
2r+ 1
2, ‚àín, ‚àín‚àís
r+1, ‚àín‚àí1
2s, ‚àín‚àí1
2s+ 1
2
¬Ø¬Ø¬Ø 1
¬∂
=
¬µr + s + 2n
n
¬∂√Å¬µs + 2n
n
¬∂
;
F
¬µ
1
3r, 1
3r+ 1
3, 1
3r+ 2
3, ‚àín, ‚àín‚àí1
2s, ‚àín‚àí1
2s‚àí1
2
1
2r+ 1
2, 1
2r+1, ‚àín‚àí1
3s, ‚àín‚àí1
3s+ 1
3, ‚àín‚àí1
3s+ 2
3
¬Ø¬Ø¬Ø 1
¬∂
=
¬µr + s + 3n
n
¬∂√Å¬µs + 3n
n
¬∂
.
The rst of these formulas gives the result of Problem 7 again, when the
quantities (r, s, n) are replaced respectively by (1, 2n + 1 ‚àím, ‚àí1 ‚àín).
Finally, the \unexpected" sum (5.20) gives us an unexpected hypergeo-
metric identity that turns out to be quite instructive. Let's look at it in slow
motion. First we convert to an innite sum,
X
km
¬µm + k
k
¬∂
2‚àík = 2m
‚áê‚áí
X
k0
¬µ2m ‚àík
m ‚àík
¬∂
2k = 22m .
The term ratio from (2m ‚àík)! 2k/m! (m ‚àík)! is 2(k ‚àím)/(k ‚àí2m), so we
have a hypergeometric identity with z = 2:
¬µ2m
m
¬∂
F
¬µ1, ‚àím
‚àí2m
¬Ø¬Ø¬Ø 2
¬∂
= 22m ,
integer m  0.
(5.98)

216 BINOMIAL COEFFICIENTS
But look at the lower parameter `‚àí2m'. Negative integers are verboten, so
this identity is undened!
It's high time to look at such limiting cases carefully, as promised earlier,
because degenerate hypergeometrics can often be evaluated by approaching
them from nearby nondegenerate points. We must be careful when we do this,
because dierent results can be obtained if we take limits in dierent ways.
For example, here are two limits that turn out to be quite dierent when one
of the upper parameters is increased by œµ:
lim
œµ‚Üí0 F
¬µ‚àí1+œµ, ‚àí3
‚àí2+œµ
¬Ø¬Ø¬Ø 1
¬∂
= lim
œµ‚Üí0
¬°
1 + (‚àí1+œµ)(‚àí3)
(‚àí2+œµ) 1! + (‚àí1+œµ)(œµ)(‚àí3)(‚àí2)
(‚àí2+œµ)(‚àí1+œµ) 2!
+ (‚àí1+œµ)(œµ)(1+œµ)(‚àí3)(‚àí2)(‚àí1)
(‚àí2+œµ)(‚àí1+œµ)(œµ) 3!
¬¢
= 1 ‚àí3
2 + 0 + 1
2 = 0 ;
lim
œµ‚Üí0 F
¬µ‚àí1, ‚àí3
‚àí2+œµ
¬Ø¬Ø¬Ø 1
¬∂
= lim
œµ‚Üí0
¬°
1 + (‚àí1)(‚àí3)
(‚àí2+œµ) 1! + 0 + 0
¬¢
= 1 ‚àí3
2 + 0 + 0 = ‚àí1
2 .
Similarly, we have dened
¬°‚àí1
‚àí1
¬¢
= 0 = limœµ‚Üí0
¬°‚àí1+œµ
‚àí1
¬¢
; this is not the same
as limœµ‚Üí0
¬°‚àí1+œµ
‚àí1+œµ
¬¢
= 1. The proper way to treat (5.98) as a limit is to re-
alize that the upper parameter ‚àím is being used to make all terms of the
series P
k0
¬°2m‚àík
m‚àík
¬¢
2k zero for k > m; this means that we want to make the
following more precise statement:
¬µ2m
m
¬∂
lim
œµ‚Üí0 F
¬µ 1, ‚àím
‚àí2m+œµ
¬Ø¬Ø¬Ø 2
¬∂
= 22m ,
integer m  0.
(5.99)
Each term of this limit is well dened, because the denominator factor (‚àí2m)k
does not become zero until k > 2m. Therefore this limit gives us exactly the
sum (5.20) we began with.
5.6 HYPERGEOMETRIC TRANSFORMATIONS
It should be clear by now that a database of known hypergeometric
closed forms is a useful tool for doing sums of binomial coecients.
We
simply convert any given sum into its canonical hypergeometric form, then
look it up in the table. If it's there, ne, we've got the answer. If not, we
can add it to the database if the sum turns out to be expressible in closed
form. We might also include entries in the table that say, \This sum does
not have a simple closed form in general." For example, the sum P
km
¬°n
k
¬¢

5.6 HYPERGEOMETRIC TRANSFORMATIONS 217
corresponds to the hypergeometric
¬µn
m
¬∂
F
¬µ 1, ‚àím
n‚àím+1
¬Ø¬Ø¬Ø ‚àí1
¬∂
,
integers n  m  0;
(5.100)
this has a simple closed form only if m is near 0, 1
2n, or n.
But there's more to the story, since hypergeometric functions also obey
identities of their own. This means that every closed form for hypergeometrics
leads to additional closed forms and to additional entries in the database. For
The hypergeo-
metric database
should really be a
\knowledge base."
example, the identities in exercises 25 and 26 tell us how to transform one
hypergeometric into two others with similar but dierent parameters. These
can in turn be transformed again.
In 1797, J. F. Pfa [292] discovered a surprising reection law,
1
(1 ‚àíz)a F
¬µa, b
c
¬Ø¬Ø¬Ø ‚àíz
1‚àíz
¬∂
= F
¬µa, c‚àíb
c
¬Ø¬Ø¬Ø z
¬∂
,
(5.101)
which is a transformation of another type. This is a formal identity in power
series, if the quantity (‚àíz)k/(1 ‚àíz)k+a is replaced by the innite series
(‚àíz)k¬°
1 +
¬°k+a
1
¬¢
z +
¬°k+a+1
2
¬¢
z2 + ¬∑ ¬∑ ¬∑
¬¢
when the left-hand side is expanded
(see exercise 50). We can use this law to derive new formulas from the iden-
tities we already know, when z Ã∏= 1.
For example, Kummer's formula (5.94) can be combined with the reec-
tion law (5.101) if we choose the parameters so that both identities apply:
2‚àía F
¬µa, 1‚àía
1+b‚àía
¬Ø¬Ø¬Ø 1
2
¬∂
= F
¬µ
a, b
1+b‚àía
¬Ø¬Ø¬Ø ‚àí1
¬∂
= (b/2)!
b!
(b ‚àía)b/2 .
(5.102)
We can now set a = ‚àín and go back from this equation to a new identity in
binomial coecients that we might need some day:
X
k0
(‚àín)k (1+n)k
(1+b+n)k
2‚àík
k!
=
X
k
¬µn
k
¬∂ ¬µ‚àí1
2
¬∂k ¬µn+k
k
¬∂√Å¬µn+b+k
k
¬∂
= 2‚àín (b/2)! (b+n)!
b! (b/2+n)! ,
integer n  0.
(5.103)
For example, when n = 3 this identity says that
1 ‚àí3
4
2(4 + b) + 3
4 ¬∑ 5
4(4 + b)(5 + b) ‚àí
4 ¬∑ 5 ¬∑ 6
8(4 + b)(5 + b)(6 + b)
= (b + 3)(b + 2)(b + 1)
(b + 6)(b + 4)(b + 2) .

218 BINOMIAL COEFFICIENTS
It's almost unbelievable, but true, for all b. (Except when a factor in the
denominator vanishes.)
This is fun; let's try again. Maybe we'll nd a formula that will really
astonish our friends. What does Pfa's reection law tell us if we apply it to
the strange form (5.99), where z = 2? In this case we set a = ‚àím, b = 1,
and c = ‚àí2m + œµ, obtaining
(‚àí1)m lim
œµ‚Üí0 F
¬µ ‚àím, 1
‚àí2m+œµ
¬Ø¬Ø¬Ø 2
¬∂
= lim
œµ‚Üí0 F
¬µ‚àím, ‚àí2m‚àí1+œµ
‚àí2m+œµ
¬Ø¬Ø¬Ø 2
¬∂
= lim
œµ‚Üí0
X
k0
(‚àím)k (‚àí2m ‚àí1 + œµ)k
(‚àí2m + œµ)k
2k
k!
=
X
km
¬µm
k
¬∂(2m + 1)k
(2m)k
(‚àí2)k ,
because none of the limiting terms is close to zero. This leads to another
miraculous formula,
(Hysterical note:
See exercise 51 if
you get a dierent
result.)
X
km
¬µm
k
¬∂
2m+1
2m+1‚àík(‚àí2)k = (‚àí1)m22m
√Å¬µ2m
m
¬∂
= 1
√Å¬µ‚àí1/2
m
¬∂
,
integer m  0.
(5.104)
When m = 3, for example, the sum is
1 ‚àí7 + 84
5 ‚àí14 = ‚àí16
5 ,
and
¬°‚àí1/2
3
¬¢
is indeed equal to ‚àí5
16.
When we looked at our binomial coecient identities and converted them
to hypergeometric form, we overlooked (5.19) because it was a relation be-
tween two sums instead of a closed form. But now we can regard (5.19) as
an identity between hypergeometric series. If we dierentiate it n times with
respect to y and then replace k by m ‚àín ‚àík, we get
X
k0
¬µ
m + r
m ‚àín ‚àík
¬∂¬µn + k
n
¬∂
xm‚àín‚àíkyk
=
X
k0
¬µ
‚àír
m ‚àín ‚àík
¬∂¬µn + k
n
¬∂
(‚àíx)m‚àín‚àík(x + y)k .
This yields the following hypergeometric transformation:
F
¬µa, ‚àín
c
¬Ø¬Ø¬Ø z
¬∂
= (a ‚àíc)n
(‚àíc)n
F
¬µ
a, ‚àín
1‚àín+a‚àíc
¬Ø¬Ø¬Ø 1‚àíz
¬∂
,
integer
n  0.
(5.105)

5.6 HYPERGEOMETRIC TRANSFORMATIONS 219
Notice that when z = 1 this reduces to Vandermonde's convolution, (5.93).
Dierentiation seems to be useful, if this example is any indication; we
also found it helpful in Chapter 2, when summing x + 2x2 + ¬∑ ¬∑ ¬∑ + nxn. Let's
see what happens when a general hypergeometric series is dierentiated with
respect to z:
d
dz F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
=
X
k1
ak
1 . . . ak
m zk‚àí1
bk
1 . . . bkn (k ‚àí1)!
=
X
k+11
ak+1
1
. . . ak+1
m
zk
bk+1
1
. . . bk+1
n
k!
=
X
k0
a1(a1+1)k . . . am(am+1)k zk
b1(b1+1)k . . . bn(bn+1)k k!
= a1 . . . am
b1 . . . bn
F
¬µa1+1, . . . , am+1
b1+1, . . . , bn+1
¬Ø¬Ø¬Ø z
¬∂
.
(5.106)
The parameters move out and shift up.
It's also possible to use dierentiation to tweak just one of the parameters
while holding the rest of them xed. For this we use the operator
How do you pro-
nounce œë?
(Dunno, but TEX
calls it `vartheta'.)
œë = z d
dz ,
which acts on a function by dierentiating it and then multiplying by z. This
operator gives
œë F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
= z
X
k1
ak
1 . . . ak
m zk‚àí1
bk
1 . . . bkn (k ‚àí1)!
=
X
k0
k ak
1 . . . ak
m zk
bk
1 . . . bkn k!
,
which by itself isn't too useful.
But if we multiply F by one of its upper
parameters, say a1, and add it to œëF, we get
(œë + a1) F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
(k + a1)ak
1 . . . ak
m zk
bk
1 . . . bkn k!
,
=
X
k0
a1(a1+1)k ak
2 . . . ak
m zk
bk
1 . . . bkn k!
= a1 F
¬µa1+1, a2, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
.
Only one parameter has been shifted.

220 BINOMIAL COEFFICIENTS
A similar trick works with lower parameters, but in this case things shift
down instead of up:
(œë + b1 ‚àí1) F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
(k + b1 ‚àí1)ak
1 . . . ak
m zk
bk
1 . . . bkn k!
,
=
X
k0
(b1 ‚àí1) ak
1 . . . ak
m zk
(b1 ‚àí1)k bk
2 . . . bkn k!
= (b1‚àí1) F
¬µ
a1, . . . , am
b1‚àí1, b2, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
.
We can now combine all these operations and make a mathematical \pun"
Ever hear the one
about the brothers
who named their
cattle ranch Focus,
because it's where
the sons raise meat?
by expressing the same quantity in two dierent ways. Namely, we have
(œë + a1) . . . (œë + am)F = a1 . . . am F
¬µa1+1, . . . , am+1
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
,
and
(œë + b1 ‚àí1) . . . (œë + bn ‚àí1)F
= (b1‚àí1) . . . (bn‚àí1) F
¬µ
a1, . . . , am
b1‚àí1, . . . , bn‚àí1
¬Ø¬Ø¬Ø z
¬∂
,
where F = F(a1, . . . , am; b1, . . . , bn; z). And (5.106) tells us that the top line
is the derivative of the bottom line. Therefore the general hypergeometric
function F satises the dierential equation
D(œë + b1 ‚àí1) . . . (œë + bn ‚àí1)F = (œë + a1) . . . (œë + am)F ,
(5.107)
where D is the operator
d
dz.
This cries out for an example. Let's nd the dierential equation satised
by the standard 2-over-1 hypergeometric series F(z) = F(a, b; c; z). According
to (5.107), we have
D(œë + c ‚àí1)F = (œë + a)(œë + b)F .
What does this mean in ordinary notation? Well, (œë + c ‚àí1)F is zF‚Ä≤(z) +
(c ‚àí1)F(z), and the derivative of this gives the left-hand side,
F‚Ä≤(z) + zF‚Ä≤‚Ä≤(z) + (c ‚àí1)F‚Ä≤(z) .

5.6 HYPERGEOMETRIC TRANSFORMATIONS 221
On the right-hand side we have
(œë+a)
¬°
zF‚Ä≤(z)+bF(z)
¬¢
= z d
dz
¬°
zF‚Ä≤(z)+bF(z)
¬¢
+ a
¬°
zF‚Ä≤(z)+bF(z)
¬¢
= zF‚Ä≤(z)+z2F‚Ä≤‚Ä≤(z)+bzF‚Ä≤(z)+azF‚Ä≤(z)+abF(z) .
Equating the two sides tells us that
z(1 ‚àíz)F‚Ä≤‚Ä≤(z) +
¬°
c ‚àíz(a + b + 1)
¬¢
F‚Ä≤(z) ‚àíabF(z) = 0 .
(5.108)
This equation is equivalent to the factored form (5.107).
Conversely, we can go back from the dierential equation to the power
series. Let's assume that F(z) = P
k0 tkzk is a power series satisfying (5.107).
A straightforward calculation shows that we must have
tk+1
tk
=
(k + a1) . . . (k + am)
(k + b1) . . . (k + bn)(k + 1) ;
hence F(z) must be t0 F(a1, . . . , am; b1, . . . , bn; z).
We've proved that the
hypergeometric series (5.76) is the only formal power series that satises the
dierential equation (5.107) and has the constant term 1.
It would be nice if hypergeometrics solved all the world's dierential
equations, but they don't quite. The right-hand side of (5.107) always expands
into a sum of terms of the form Œ±kzkF(k)(z), where F(k)(z) is the kth derivative
DkF(k); the left-hand side always expands into a sum of terms of the form
Œ≤kzk‚àí1F(k)(z) with k > 0. So the dierential equation (5.107) always takes
the special form
zn‚àí1(Œ≤n ‚àízŒ±n)F(n)(z) + ¬∑ ¬∑ ¬∑ + (Œ≤1 ‚àízŒ±1)F‚Ä≤(z) ‚àíŒ±0F(z) = 0 .
Equation (5.108) illustrates this in the case n = 2. Conversely, we will prove
in exercise 6.13 that any dierential equation of this form can be factored in
terms of the œë operator, to give an equation like (5.107). So these are the dif-
ferential equations whose solutions are power series with rational term ratios.
Multiplying both sides of (5.107) by z dispenses with the D operator and
The function
F(z) = (1 ‚àíz)r
satises
œëF = z(œë ‚àír)F.
This gives another
proof of the bino-
mial theorem.
gives us an instructive all-œë form,
œë(œë + b1 ‚àí1) . . . (œë + bn ‚àí1)F = z(œë + a1) . . . (œë + am)F .
(5.109)
The rst factor œë = (œë + 1 ‚àí1) on the left corresponds to the (k + 1) in
the term ratio (5.81), which corresponds to the k! in the denominator of the
kth term in a general hypergeometric series. The other factors (œë + bj ‚àí1)
correspond to the denominator factor (k + bj), which corresponds to bk
j in
(5.76). On the right, the z corresponds to zk, and (œë+aj) corresponds to ak
j .

222 BINOMIAL COEFFICIENTS
One use of this dierential theory is to nd and prove new transforma-
tions. For example, we can readily verify that both of the hypergeometrics
F
¬µ 2a, 2b
a+b+ 1
2
¬Ø¬Ø¬Ø z
¬∂
and
F
¬µ
a, b
a+b+ 1
2
¬Ø¬Ø¬Ø 4z(1‚àíz)
¬∂
satisfy the dierential equation
z(1 ‚àíz)F‚Ä≤‚Ä≤(z) + (a + b + 1
2)(1 ‚àí2z)F‚Ä≤(z) ‚àí4abF(z) = 0 ;
hence Gauss's identity [143, equation 102]
F
¬µ 2a, 2b
a+b+ 1
2
¬Ø¬Ø¬Ø z
¬∂
= F
¬µ
a, b
a+b+ 1
2
¬Ø¬Ø¬Ø 4z(1‚àíz)
¬∂
(5.110)
must be true. In particular,
(Caution: We can't
use (5.110) safely
when jzj > 1/2,
unless both sides
are polynomials;
see exercise 53.)
F
¬µ 2a, 2b
a+b+ 1
2
¬Ø¬Ø¬Ø 1
2
¬∂
= F
¬µ
a, b
a+b+ 1
2
¬Ø¬Ø¬Ø 1
¬∂
,
(5.111)
whenever both innite sums converge.
Every new identity for hypergeometrics has consequences for binomial
coecients, and this one is no exception. Let's consider the sum
X
km
¬µm ‚àík
n
¬∂¬µm + n + 1
k
¬∂ ¬µ‚àí1
2
¬∂k
,
integers m  n  0.
The terms are nonzero for 0  k  m ‚àín, and with a little delicate limit-
taking as before we can express this sum as the hypergeometric
lim
œµ‚Üí0
¬µm
n
¬∂
F
¬µn‚àím, ‚àín‚àím‚àí1+Œ±œµ
‚àím+œµ
¬Ø¬Ø¬Ø 1
2
¬∂
.
The value of Œ± doesn't aect the limit, since the nonpositive upper parameter
n ‚àím cuts the sum o early. We can set Œ± = 2, so that (5.111) applies.
The limit can now be evaluated because the right-hand side is a special case
of (5.92). The result can be expressed in simplied form,
X
km
¬µm ‚àík
n
¬∂¬µm + n + 1
k
¬∂ ¬µ‚àí1
2
¬∂k
=
¬µ(m + n)/2
n
¬∂
2n‚àím[m + n is even] ,
integers
m  n  0,
(5.112)
as shown in exercise 54.
For example, when m = 5 and n = 2 we get
¬°5
2
¬¢¬°8
0
¬¢
‚àí
¬°4
2
¬¢¬°8
1
¬¢
/2 +
¬°3
2
¬¢¬°8
2
¬¢
/4 ‚àí
¬°2
2
¬¢¬°8
3
¬¢
/8 = 10 ‚àí24 + 21 ‚àí7 = 0; when m = 4
and n = 2, both sides give 3
4.

5.6 HYPERGEOMETRIC TRANSFORMATIONS 223
We can also nd cases where (5.110) gives binomial sums when z = ‚àí1,
but these are really weird. If we set a =
1
6 ‚àín
3 and b = ‚àín, we get the
monstrous formula
F
¬µ 1
3 ‚àí2
3n, ‚àí2n
2
3 ‚àí4
3n
¬Ø¬Ø¬Ø ‚àí1
¬∂
= F
¬µ 1
6 ‚àí1
3n, ‚àín
2
3 ‚àí4
3n
¬Ø¬Ø¬Ø ‚àí8
¬∂
.
These hypergeometrics are nondegenerate polynomials when n Ã∏‚â°2 (mod 3);
and the parameters have been cleverly chosen so that the left-hand side can
be evaluated by (5.94). We are therefore led to a truly mind-boggling result,
X
k
¬µn
k
¬∂¬µ 1
3n ‚àí1
6
k
¬∂
8k
√Å¬µ 4
3n ‚àí2
3
k
¬∂
=
¬µ2n
n
¬∂√Å¬µ 4
3n ‚àí2
3
n
¬∂
,
integer n  0, n Ã∏‚â°2 (mod 3).
(5.113)
This is the most startling identity in binomial coecients that we've seen.
Small cases of the identity aren't even easy to check by hand. (It turns out
that both sides do give
81
7
when n = 3.)
But the identity is completely
The only use of
(5.113) is to demon-
strate the existence
of incredibly useless
identities.
useless, of course; surely it will never arise in a practical problem.
So that's our hype for hypergeometrics. We've seen that hypergeometric
series provide a high-level way to understand what's going on in binomial
coecient sums. A great deal of additional information can be found in the
classic book by Bailey [18] and its sequel by Gasper and Rahman [141].
5.7
PARTIAL HYPERGEOMETRIC SUMS
Most of the sums we've evaluated in this chapter range over all in-
dices k  0, but sometimes we've been able to nd a closed form that works
over a general range a  k < b. For example, we know from (5.16) that
X
k<m
¬µn
k
¬∂
(‚àí1)k = (‚àí1)m‚àí1
¬µn ‚àí1
m ‚àí1
¬∂
,
integer m.
(5.114)
The theory in Chapter 2 gives us a nice way to understand formulas like this:
If f(k) = ‚àÜg(k) = g(k + 1) ‚àíg(k), then we've agreed to write P f(k) Œ¥k =
g(k) + C, and
Xb
a f(k) Œ¥k = g(k)
¬Ø¬Øb
a = g(b) ‚àíg(a) .
Furthermore, when a and b are integers with a  b, we have
Xb
a f(k) Œ¥k =
X
ak<b
f(k) = g(b) ‚àíg(a) .

224 BINOMIAL COEFFICIENTS
Therefore identity (5.114) corresponds to the indenite summation formula
X ¬µn
k
¬∂
(‚àí1)k Œ¥k = (‚àí1)k‚àí1
¬µn ‚àí1
k ‚àí1
¬∂
+ C ,
and to the dierence formula
‚àÜ
¬µ
(‚àí1)k
¬µn
k
¬∂¬∂
= (‚àí1)k+1
¬µn + 1
k + 1
¬∂
.
It's easy to start with a function g(k) and to compute ‚àÜg(k) = f(k), a
function whose sum will be g(k) + C. But it's much harder to start with f(k)
and to gure out its indenite sum P f(k) Œ¥k = g(k) + C; this function g
might not have a simple form. For example, there is apparently no simple
form for P ¬°n
k
¬¢
Œ¥k; otherwise we could evaluate sums like P
kn/3
¬°n
k
¬¢
, about
which we're clueless. Yet maybe there is a simple form for P ¬°n
k
¬¢
Œ¥k and we
just haven't thought of it; how can we be sure?
In 1977, R. W. Gosper [154] discovered a beautiful way to nd indenite
sums P f(k) Œ¥k = g(k) + C whenever f and g belong to a general class of
functions called hypergeometric terms. Let us write
F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
k = ak
1 . . . ak
m
bk
1 . . . bkn
zk
k!
(5.115)
for the kth term of the hypergeometric series F(a1, . . . , am; b1, . . . , bn; z). We
will regard F(a1, . . . , am; b1, . . . , bn; z)k as a function of k, not of z. In many
cases it turns out that there are parameters c, A1, . . . , AM, B1, . . . , BN,
and Z such that
X
F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
k Œ¥k = c F
¬µA1, . . . , AM
B1, . . . , BN
¬Ø¬Ø¬Ø Z
¬∂
k + C ,
(5.116)
given a1, . . . , am, b1, . . . , bn, and z. We will say that a given function
F(a1, . . . , am; b1, . . . , bn; z)k is summable in hypergeometric terms if such
constants c, A1, . . . , AM, B1, . . . , BN, Z exist. Gosper's algorithm either
nds the unknown constants or proves that no such constants exist.
In general, we say that t(k) is a hypergeometric term if t(k+1)/t(k) is a
rational function of k, not identically zero. This means, in essence, that t(k)
is a constant multiple of a term like (5.115). (A technicality arises, however,
with respect to zeros, because we want t(k) to be meaningful when k is neg-
ative and when one or more of the b's in (5.115) is zero or a negative integer.
Strictly speaking, we get the most general hypergeometric term by multiply-
ing (5.115) by a nonzero constant times a power of 0, then cancelling zeros
of the numerator with zeros of the denominator. The examples in exercise 12
help clarify this general rule.)

5.7 PARTIAL HYPERGEOMETRIC SUMS 225
Suppose we want to nd P t(k) Œ¥k, when t(k) is a hypergeometric term.
Gosper's algorithm proceeds in two steps, each of which is fairly straightfor-
ward. Step 1 is to express the term ratio in the special form
t(k + 1)
t(k)
= p(k + 1)
p(k)
q(k)
r(k + 1) ,
(5.117)
where p, q, and r are polynomials subject to the following condition:
(Divisibility of poly-
nomials is analogous
to divisibility of
integers. For exam-
ple, (k + Œ±)nq(k)
means that the quo-
tient q(k)/(k + Œ±)
is a polynomial.
It's easy to see that
(k + Œ±)nq(k)
if and only if
q(‚àíŒ±) = 0.)
(k + Œ±)nq(k)
and
(k + Œ≤)nr(k)
=‚áíŒ± ‚àíŒ≤ is not a positive integer.
(5.118)
This condition is easy to achieve: We start by provisionally setting p(k) = 1,
and we set q(k) and r(k + 1) to the numerator and denominator of the term
ratio, factoring them into linear factors. For example, if t(k) has the form
(5.115), we start with the factorizations q(k) = (k + a1) . . . (k + am)z and
r(k) = (k+b1 ‚àí1) . . . (k+bn ‚àí1)k. Then we check if (5.118) is violated. If q
and r have factors (k + Œ±) and (k + Œ≤) where Œ± ‚àíŒ≤ = N > 0, we divide them
out of q and r and replace p(k) by
p(k)(k+Œ±‚àí1)N‚àí1 = p(k)(k+Œ±‚àí1)(k+Œ±‚àí2) . . . (k+Œ≤+1) .
(5.119)
The new p, q, and r still satisfy (5.117), and we can repeat this process until
(5.118) holds. We'll see in a moment why (5.118) is important.
Step 2 of Gosper's algorithm is to nish the job | to nd a hypergeo-
metric term T(k) such that
t(k) = T(k + 1) ‚àíT(k) ,
(5.120)
whenever possible. But it's not obvious how to do this; we need to develop
some theory before we know how to proceed. Gosper noticed, after studying
a lot of special cases, that it is wise to write the unknown function T(k) in
the form
T(k) = r(k) s(k) t(k)
p(k)
,
(5.121)
where s(k) is a secret function that must be discovered somehow. Plugging
(Exercise 55 gives
a clue about why
we might want to
make this magic
substitution.)
(5.121) into (5.120) and applying (5.117) gives
t(k) = r(k + 1)s(k + 1)t(k + 1)
p(k + 1)
‚àír(k)s(k)t(k)
p(k)
= q(k)s(k + 1)t(k)
p(k)
‚àír(k)s(k)t(k)
p(k)
;

226 BINOMIAL COEFFICIENTS
so we need to have
p(k) = q(k)s(k + 1) ‚àír(k)s(k) .
(5.122)
If we can nd s(k) satisfying this fundamental recurrence relation, we've found
P t(k) Œ¥k. If we can't, there's no T.
We're assuming that T(k) is a hypergeometric term, which means that
T(k + 1)/T(k) is a rational function of k. Therefore, by (5.121) and (5.120),
r(k)s(k)/p(k) = T(k)/
¬°
T(k + 1) ‚àíT(k)
¬¢
is a rational function of k, and s(k)
itself must be a quotient of polynomials:
s(k) = f(k)/g(k) .
But in fact we can prove that s(k) is itself a polynomial. For if g(k) is not
constant, and if f(k) and g(k) have no common factors, let N be the largest
integer such that (k + Œ≤) and (k + Œ≤ + N ‚àí1) both occur as factors of g(k)
for some complex number Œ≤. The value of N is positive, since N = 1 always
satises this condition. Equation (5.122) can be rewritten
p(k)g(k+1)g(k) = q(k)f(k+1)g(k) ‚àír(k)g(k+1)f(k) ,
and if we set k = ‚àíŒ≤ and k = ‚àíŒ≤ ‚àíN we get
r(‚àíŒ≤)g(1‚àíŒ≤)f(‚àíŒ≤) = 0 = q(‚àíŒ≤‚àíN)f(1‚àíŒ≤‚àíN)g(‚àíŒ≤‚àíN) .
Now f(‚àíŒ≤) Ã∏= 0 and f(1 ‚àíŒ≤ ‚àíN) Ã∏= 0, because f and g have no common
roots. Also g(1 ‚àíŒ≤) Ã∏= 0 and g(‚àíŒ≤ ‚àíN) Ã∏= 0, because g(k) would otherwise
contain the factor (k+Œ≤‚àí1) or (k+Œ≤+N), contrary to the maximality of N.
Therefore
r(‚àíŒ≤) = q(‚àíŒ≤ ‚àíN) = 0 .
But this contradicts condition (5.118). Hence s(k) must be a polynomial.
I see: Gosper came
up with condition
(5.118) in order to
make this proof go
through.
Our task now boils down to nding a polynomial s(k) that satises
(5.122), when p(k), q(k), and r(k) are given polynomials, or proving that
no such polynomial exists. It's easy to do this when s(k) has any particular
degree d, since we can write
s(k) = Œ±dkd + Œ±d‚àí1kd‚àí1 + ¬∑ ¬∑ ¬∑ + Œ±0 ,
Œ±d Ã∏= 0
(5.123)
for unknown coecients (Œ±d, . . . , Œ±0) and plug this expression into the fun-
damental recurrence (5.122). The polynomial s(k) will satisfy the recurrence
if and only if the Œ±'s satisfy the linear equations that result when we equate
coecients of each power of k in (5.122).

5.7 PARTIAL HYPERGEOMETRIC SUMS 227
But how can we determine the degree of s?
It turns out that there
actually are at most two possibilities. We can rewrite (5.122) in the form
2p(k) = Q(k)
¬°
s(k + 1) + s(k)
¬¢
+ R(k)
¬°
s(k + 1) ‚àís(k)
¬¢
,
(5.124)
where
Q(k) = q(k) ‚àír(k)
and
R(k) = q(k) + r(k) .
If s(k) has degree d, then the sum s(k + 1) + s(k) = 2Œ±dkd + ¬∑ ¬∑ ¬∑ also has
degree d, while the dierence s(k + 1) ‚àís(k) = ‚àÜs(k) = dŒ±dkd‚àí1 + ¬∑ ¬∑ ¬∑ has
degree d‚àí1. (The zero polynomial can be assumed to have degree ‚àí1.) Let's
write deg(P) for the degree of a polynomial P.
If deg(Q)  deg(R), then
the degree of the right-hand side of (5.124) is deg(Q) + d, so we must have
d = deg(p) ‚àídeg(Q). On the other hand if deg(Q) < deg(R) = d‚Ä≤, we can
write Q(k) = Œª‚Ä≤kd ‚Ä≤‚àí1+¬∑ ¬∑ ¬∑ and R(k) = Œªkd ‚Ä≤ +¬∑ ¬∑ ¬∑ where Œª Ã∏= 0; the right-hand
side of (5.124) has the form
(2Œª‚Ä≤Œ±d + Œªd Œ±d)kd+d ‚Ä≤‚àí1 + ¬∑ ¬∑ ¬∑ .
Ergo, two possibilities: Either 2Œª‚Ä≤ + Œªd Ã∏= 0, and d = deg(p) ‚àídeg(R) + 1;
or 2Œª‚Ä≤ + Œªd = 0, and d > deg(p) ‚àídeg(R) + 1. The second case needs to be
examined only if ‚àí2Œª‚Ä≤/Œª is an integer d greater than deg(p) ‚àídeg(R) + 1.
OK, we now have enough facts to perform Step 2 of Gosper's two-step
algorithm: By trying at most two values of d, we can discover s(k), whenever
equation (5.122) has a polynomial solution.
If s(k) exists, we can plug it
into (5.121) and we have our T. If it doesn't, we've proved that t(k) is not
summable in hypergeometric terms.
Time for an example: Let's try the partial sum (5.114). Gosper's method
should be able to deduce the value of
X ¬µn
k
¬∂
(‚àí1)k Œ¥k
for any xed n, so we seek the sum of
t(k) =
¬µn
k
¬∂
(‚àí1)k =
n! (‚àí1)k
k! (n ‚àík)! .
Step 1 is to put the term ratio into the required form (5.117); we have
t(k + 1)
t(k)
= k ‚àín
k + 1 = p(k + 1) q(k)
p(k) r(k + 1)
so we simply take p(k) = 1, q(k) = k ‚àín, and r(k) = k. This choice of p, q,
Why isn't it
r(k) = k + 1?
Oh, I see.
and r satises (5.118), unless n is a negative integer; let's suppose it isn't.
Now we do Step 2. According to (5.124), we should consider the poly-
nomials Q(k) = ‚àín and R(k) = 2k ‚àín. Since R has larger degree than Q,

228 BINOMIAL COEFFICIENTS
we need to look at two cases. Either d = deg(p) ‚àídeg(R) + 1, which is 0; or
d = ‚àí2Œª‚Ä≤/Œª where Œª‚Ä≤ = ‚àín and Œª = 2, hence d = n. The rst case is nicer,
because it doesn't require n to be a positive integer, so let's try it rst; we'll
need to try the other possibility for d only if the rst case fails. Assuming
that d = 0, the value of s(k) is simply Œ±0, and equation (5.122) reduces to
1 = (k ‚àín)Œ±0 ‚àíkŒ±0 .
Hence we choose Œ±0 = ‚àí1/n. This satises the equation and gives
T(k) = r(k) s(k) t(k)
p(k)
= k ¬∑
¬µ‚àí1
n
¬∂
¬∑
¬µn
k
¬∂
(‚àí1)k
=
¬µn ‚àí1
k ‚àí1
¬∂
(‚àí1)k‚àí1 ,
if n Ã∏= 0,
precisely the answer we were hoping to conrm.
If we apply the same method to nd the indenite sum P ¬°n
k
¬¢
Œ¥k, without
the (‚àí1)k, everything will be almost the same except that q(k) will be n ‚àík;
hence Q(k) = n ‚àí2k will have greater degree than R(k) = n, and we will
conclude that d has the impossible value deg(p)‚àídeg(Q) = ‚àí1. (The polyno-
mial s(k) cannot have negative degree, because it cannot be zero.) Therefore
the function
¬°n
k
¬¢
is not summable in hypergeometric terms.
However, once we have eliminated the impossible, whatever remains |
however improbable | must be the truth (according to S. Holmes [83]). When
we dened p, q, and r in Step 1, we decided to ignore the possibility that n
might be a negative integer. What if it is? Let's set n = ‚àíN, where N is
positive. Then the term ratio for P ¬°n
k
¬¢
Œ¥k is
t(k + 1)
t(k)
= ‚àí(k + N)
(k + 1)
= p(k + 1)
p(k)
q(k)
r(k + 1)
and it should be represented by p(k) = (k + 1)N‚àí1, q(k) = ‚àí1, r(k) = 1,
according to (5.119). Step 2 of Gosper's algorithm now tells us to look for
a polynomial s(k) of degree d = N ‚àí1; maybe there's hope after all. For
example, when N = 2 recurrence (5.122) says that we should solve
k + 1 = ‚àí
¬°
(k + 1)Œ±1 + Œ±0
¬¢
‚àí(kŒ±1 + Œ±0) .
Equating coecients of k and 1 tells us that
1 = ‚àíŒ±1 ‚àíŒ±1;
1 = ‚àíŒ±1 ‚àíŒ±0 ‚àíŒ±0;

5.7 PARTIAL HYPERGEOMETRIC SUMS 229
hence s(k) = ‚àí1
2k ‚àí1
4 is a solution, and
T(k) =
1 ¬∑
¬°
‚àí1
2k ‚àí1
4
¬¢
¬∑
¬°‚àí2
k
¬¢
k + 1
= (‚àí1)k‚àí1 2k + 1
4
.
Can this be the desired sum? Yes, it checks out:
\Excellent, Holmes!"
\Elementary, my
dear Watson."
(‚àí1)k 2k + 3
4
‚àí(‚àí1)k‚àí1 2k + 1
4
= (‚àí1)k(k + 1) =
¬µ‚àí2
k
¬∂
.
Incidentally, we can write this summation formula in another form, by
attaching an upper limit:
X
k<m
¬µ‚àí2
k
¬∂
= (‚àí1)k‚àí1 2k + 1
4
¬Ø¬Ø¬Ø
m
0
= (‚àí1)m‚àí1
2
¬µ
m + 1 ‚àí(‚àí1)m
2
¬∂
= (‚àí1)m‚àí1
¬ªm
2
¬º
,
integer m  0.
This representation conceals the fact that
¬°‚àí2
k
¬¢
is summable in hypergeometric
terms, because ‚åàm/2‚åâis not a hypergeometric term. (See exercise 12.)
A problem might arise in the denominator of (5.121) if p(k) = 0 for
some integer k. Exercise 97 gives some insight into what can be done in such
situations.
Notice that we need not bother to compile a catalog of indenitely
summable hypergeometric terms, analogous to the database of denite hyper-
geometric sums mentioned earlier in this chapter, because Gosper's algorithm
provides a quick, uniform method that works in all summable cases.
Marko Petkovsek [291] has found a nice way to generalize Gosper's algo-
rithm to more complicated inversion problems, by showing how to determine
all hypergeometric terms T(k) that satisfy the lth-order recurrence
t(k) = pl(k)T(k + l) + ¬∑ ¬∑ ¬∑ + p1(k)T(k + 1) + p0(k)T(k) ,
(5.125)
given any hypergeometric term t(k) and polynomials pl(k), . . . , p1(k), p0(k).
5.8
MECHANICAL SUMMATION
Gosper's algorithm, beautiful as it is, nds a closed form for only a
few of the binomial sums we meet in practice. But we need not stop there.
Doron Zeilberger [383] showed how to extend Gosper's algorithm so that it
becomes even more beautiful, making it succeed in vastly more cases. With

230 BINOMIAL COEFFICIENTS
Zeilberger's extension we can handle summation over all k, not just partial
sums, so we have an alternative to the hypergeometric methods of Sections
5.5 and 5.6. Moreover, as with Gosper's original method, the calculations can
be done by computer, almost blindly; we need not rely on cleverness and luck.
The basic idea is to regard the term we want to sum as a function t(n, k)
of two variables n and k. (In Gosper's algorithm we wrote just t(k).) When
t(n, k) does not turn out to be indenitely summable in hypergeometric terms,
with respect to k | and let's face it, relatively few functions are | Zeilberger
noticed that we can often modify t(n, k) in order to obtain another term that
is indenitely summable. For example, it often turns out in practice that
Œ≤0(n)t(n, k)+Œ≤1(n)t(n+1, k) is indenitely summable with respect to k, for
appropriate polynomials Œ≤0(n) and Œ≤1(n). And when we carry out the sum
with respect to k, we obtain a recurrence in n that solves our problem.
Let's start with a simple case in order to get familiar with this general
approach. Suppose we have forgotten the binomial theorem, and we want to
evaluate P
k
¬°n
k
¬¢
zk. How could we discover the answer, without clairvoyance
or inspired guesswork? Earlier in this chapter, for example in Problem 3 of
Or without looking
on page 174.
Section 5.2, we learned how to replace
¬°n
k
¬¢
by
¬°n‚àí1
k
¬¢
+
¬°n‚àí1
k‚àí1
¬¢
and to ddle
around with the result. But there's a more systematic way to proceed.
Let t(n, k) =
¬°n
k
¬¢
zk be the quantity we want to sum. Gosper's algorithm
tells us that we can't evaluate the partial sums P
km t(n, k) for arbitrary n
in hypergeometric terms, except in the case z = ‚àí1. So let's consider a more
general term
^t(n, k) = Œ≤0(n)t(n, k) + Œ≤1(n)t(n + 1, k)
(5.126)
instead. We'll look for values of Œ≤0(n) and Œ≤1(n) that make Gosper's algo-
rithm succeed. First we want to simplify (5.126) by using the relation between
t(n + 1, k) and t(n, k) to eliminate t(n + 1, k) from the expression. Since
t(n + 1, k)
t(n, k)
=
(n + 1)! zk
(n + 1 ‚àík)! k!
(n ‚àík)! k!
n! zk
=
n + 1
n + 1 ‚àík ,
we have
^t(n, k) = p(n, k) t(n, k)
n + 1 ‚àík ,
where
p(n, k) = (n + 1 ‚àík)Œ≤0(n) + (n + 1)Œ≤1(n) .

5.8 MECHANICAL SUMMATION 231
We now apply Gosper's algorithm to ^t(n, k), with n held xed, rst writing
^t(n, k + 1)
^t(n, k)
= ^p(n, k + 1)
^p(n, k)
q(n, k)
r(n, k + 1)
(5.127)
as in (5.117). Gosper's method would nd such a representation by starting
with ^p(n, k) = 1, but with Zeilberger's extension we are better o starting
with ^p(n, k) = p(n, k). Notice that if we set t(n, k) = ^t(n, k)/p(n, k) and
p(n, k) = ^p(n, k)/p(n, k), equation (5.127) is equivalent to
t(n, k + 1)
t(n, k)
= p(n, k + 1)
p(n, k)
q(n, k)
r(n, k + 1) .
(5.128)
So we can nd ^p, q and r satisfying (5.127) by nding p, q and r satisfying
(5.128), starting with p(n, k) = 1. This makes life easy, because t(n, k) does
not involve the unknown quantities Œ≤0(n) and Œ≤1(n) that appear in ^t(n, k).
In our case t(n, k) = t(n, k)/(n + 1 ‚àík) = n! zk/(n + 1 ‚àík)! k!, so we have
t(n, k + 1)
t(n, k)
= (n + 1 ‚àík)z
k + 1
;
we may take q(n, k) = (n + 1 ‚àík)z and r(n, k) = k. These polynomials
This time I remem-
bered why r(n, k)
isn't k + 1.
in k are supposed to satisfy condition (5.118). If they don't, we're supposed
to remove factors from q and r and include corresponding factors (5.119) in
p(n, k); but we should do this only when the quantity Œ± ‚àíŒ≤ in (5.118) is a
positive integer constant, independent of n, because we want our calculations
to be valid for arbitrary n. (The formulas we derive will, in fact, be valid
even when n and k are not integers, using the generalized factorials (5.83).)
Our rst choices of q and r do satisfy (5.118), in this sense, so we can
move right on to Step 2 of Gosper's algorithm: We want to solve the analog
of (5.122), using (5.127) in place of (5.117). So we want to solve
^p(n, k) = q(n, k)s(n, k + 1) ‚àír(n, k)s(n, k)
(5.129)
for the secret polynomial
s(n, k) = Œ±d(n)kd + Œ±d‚àí1(n)kd‚àí1 + ¬∑ ¬∑ ¬∑ + Œ±0(n) .
(5.130)
(The coecients of s are considered to be functions of n, not just constants.)
In our case equation (5.129) is
(n + 1 ‚àík)Œ≤0(n) + (n + 1)Œ≤1(n)
= (n + 1 ‚àík)zs(n, k + 1) ‚àíks(n, k) ,
and we regard this as a polynomial equation in k with coecients that are
functions of n. As before, we determine the degree d of s by considering

232 BINOMIAL COEFFICIENTS
Q(n, k) = q(n, k) ‚àír(n, k) and R(n, k) = q(n, k) + r(n, k). Since deg(Q) =
The degree function
deg(Q) refers
here to the degree
in k, treating n as
constant.
deg(R) = 1 (assuming that z Ã∏= ‚àí1), we have d = deg(^p) ‚àídeg(Q) = 0 and
s(n, k) = Œ±0(n) is independent of k. Our equation becomes
(n + 1 ‚àík)Œ≤0(n) + (n + 1)Œ≤1(n) = (n + 1 ‚àík)zŒ±0(n) ‚àíkŒ±0(n) ;
and by equating powers of k we get the equivalent k-free equations
(n + 1)Œ≤0(n) + (n + 1)Œ≤1(n) ‚àí(n + 1)zŒ±0(n)= 0 ,
‚àíŒ≤0(n)
+ (z + 1)Œ±0(n)= 0 .
Hence we have a solution to (5.129) with
Œ≤0(n) = z + 1 ,
Œ≤1(n) = ‚àí1 ,
Œ±0(n) = s(n, k) = 1 .
(By chance, n has dropped out.)
We have discovered, by a purely mechanical method, that the term
^t(n, k) = (z + 1)t(n, k) ‚àít(n + 1, k) is summable in hypergeometric terms. In
other words,
^t(n, k) = T(n, k + 1) ‚àíT(n, k) ,
(5.131)
where T(n, k) is a hypergeometric term in k. What is this T(n, k)? According
to (5.121) and (5.128), we have
T(n, k) = r(n, k)s(n, k)^t(n, k)
^p(n, k)
= r(n, k)s(n, k)t(n, k) ,
(5.132)
because p(n, k) = 1. (Indeed, p(n, k) almost always turns out to be 1 in
practice.) Hence
T(n, k) =
k
n + 1 ‚àík t(n, k) =
k
n + 1 ‚àík
¬µn
k
¬∂
zk =
¬µ n
k ‚àí1
¬∂
zk.
And sure enough, everything checks out | equation (5.131) is true:
(z + 1)
¬µn
k
¬∂
zk ‚àí
¬µn + 1
k
¬∂
zk =
¬µn
k
¬∂
zk+1 ‚àí
¬µ n
k ‚àí1
¬∂
zk .
But we don't actually need to know T(n, k) precisely, because we are
going to sum t(n, k) over all integers k. All we need to know is that T(n, k) is
nonzero for only nitely many values of k, when n is any given nonnegative
integer. Then the sum of T(n, k + 1) ‚àíT(n, k) over all k must telescope to 0.
Let Sn = P
k t(n, k) = P
k
¬°n
k
¬¢
zk; this is the sum we started with, and
we're now ready to compute it, because we now know a lot about t(n, k). The

5.8 MECHANICAL SUMMATION 233
Gosper-Zeilberger procedure has deduced that
X
k
¬°
(z + 1)t(n, k) ‚àít(n + 1, k)
¬¢
= 0 .
But this sum is (z + 1) P
k t(n, k) ‚àíP
k t(n + 1, k) = (z + 1)Sn ‚àíSn+1.
Therefore we have
In fact,
lim
k‚Üí‚àûT(n, k) = 0
when jzj < 1
and n is any
complex number.
So (5.133) is true
for all n,
and in particular
Sn = (z + 1)n
when n is a nega-
tive integer.
Sn+1 = (z + 1)Sn .
(5.133)
Aha! This is a recurrence we know how to solve, provided that we know S0.
And obviously S0 = 1. Hence we deduce that Sn = (z + 1)n, for all integers
n  0. QED.
Let's look back at this computation and summarize what we did, in a
form that will apply also to other summands t(n, k). The Gosper-Zeilberger
algorithm can be formalated as follows, when t(n, k) is given:
0
Set l := 0. (We'll seek recurrences in n of order l.)
1
Let ^t(n, k) = Œ≤0(n)t(n, k)+¬∑ ¬∑ ¬∑+Œ≤l(n)t(n+l, k), where Œ≤0(n), . . . , Œ≤l(n)
are unknown functions. Use properties of t(n, k) to nd a linear combi-
nation p(n, k) of Œ≤0(n), . . . , Œ≤l(n) with coecients that are polynomials
in n and k, so that ^t(n, k) can be written in the form p(n, k)t(n, k),
where t(n, k) is a hypergeometric term in k. Find polynomials p(n, k),
q(n, k), r(n, k) so that the term ratio of t(n, k) is expressed in the form
(5.128), where q(n, k) and r(n, k) satisfy Gosper's condition (5.118). Set
^p(n, k) = p(n, k)p(n, k).
2a
Set dQ := deg(q ‚àír), dR := deg(q + r), and
d :=
¬Ø deg(^p) ‚àídQ,
if dQ  dR;
deg(^p) ‚àídR + 1,
if dQ < dR.
2b If d  0, dene s(n, k) by (5.130), and consider the linear equations in
Œ±0, . . . , Œ±d, Œ≤0, . . . Œ≤l obtained by equating coecients of powers of k
in the fundamental equation (5.129). If these equations have a solution
with Œ≤0, . . . , Œ≤l not all zero, go to Step 4. Otherwise, if dQ < dR and
if ‚àí2Œª‚Ä≤/Œª is an integer greater than d, where Œª is the coecient of kdR
in q + r and Œª‚Ä≤ is the coecient of kdR‚àí1 in q ‚àír, set d := ‚àí2Œª‚Ä≤/Œª and
repeat Step 2b.
3
(The term ^t(n, k) isn't hypergeometrically summable.) Increase l by 1
and go back to Step 1.
4
(Success.) Set T(n, k) := r(n, k)s(n, k)t(n, k)/p(n, k). The algorithm
has discovered that ^t(n, k) = T(n, k + 1) ‚àíT(n, k).
We'll prove later that this algorithm terminates successfully whenever t(n, k)
belongs to a large class of terms called proper terms.

234 BINOMIAL COEFFICIENTS
The binomial theorem can be derived in many ways, so our rst example
of the Gosper-Zeilberger approach was more instructive than impressive. Let's
tackle Vandermonde's convolution next. Can Gosper and Zeilberger deduce
algorithmically that P
k
¬°a
k
¬¢¬°
b
n‚àík
¬¢
has a simple form? The algorithm starts
with l = 0, which essentially reproduces Gosper's original algorithm, trying
to see if
¬°a
k
¬¢¬°
b
n‚àík
¬¢
is summable in hypergeometric terms. Surprise: That term
actually does turn out to be summable, if a+b is a specic nonnegative integer
(see exercise 94). But we are interested in general values of a and b, and the
algorithm quickly discovers that the indenite sum is not a hypergeometric
term in general. So l is increased from 0 to 1, and the algorithm proceeds to
try ^t(n, k) = Œ≤0(n)t(n, k) + Œ≤1(n)t(n + 1, k) instead. The next step, as in
our derivation of the binomial theorem, is to write ^t(n, k) = p(n, k)t(n, k),
where p(n, k) is obtained by clearing fractions in t(n + 1, k)/t(n, k). In this
case | the reader should please work along on a piece of scratch paper to
check all these calculations | they aren't as hard as they look | everything
goes through in an analogous fashion, but now with
p(n, k) = (n + 1 ‚àík)Œ≤0(n) + (b ‚àín + k)Œ≤1(n) = ^p(n, k) ,
t(n, k) = t(n, k)/(n+1‚àík) = a! b!/(a‚àík)! k! (b‚àín+k)! (n+1‚àík)! ,
q(n, k) = (n + 1 ‚àík)(a ‚àík) ,
r(n, k) = (b ‚àín + k)k .
Step 2a nds deg(q ‚àír) < deg(q + r), and d = deg(^p) ‚àídeg(q + r) + 1 = 0,
so s(n, k) is again independent of k. Gosper's fundamental equation (5.129)
is equivalent to two equations in three unknowns,
The crucial point
is that the Gosper-
Zeilberger method
always leads to
equations that
are linear in the
unknown Œ±'s and
Œ≤'s, because the
left side of (5.129)
is linear in the Œ≤'s
and the right side is
linear in the Œ±'s.
(n + 1)Œ≤0(n) + (b ‚àín)Œ≤1(n)
‚àí(n + 1)aŒ±0(n)= 0 ,
‚àíŒ≤0(n)
+Œ≤1(n) + (a + b + 1)Œ±0(n)= 0 ,
which have the solution
Œ≤0(n) = a + b ‚àín ,
Œ≤1(n) = ‚àín ‚àí1 ,
Œ±0(n) = 1 .
We conclude that (a + b ‚àín)t(n, k) ‚àí(n + 1)t(n + 1, k) is summable with
respect to k; hence if Sn = P
k
¬°a
k
¬¢¬°
b
n‚àík
¬¢
the recurrence
Sn+1 = a + b ‚àín
n + 1
Sn
holds; thus Sn =
¬°a+b
n
¬¢
since S0 = 1. A piece of cake.
What about the Saalschutzian triple-binomial identity in (5.28)? The
proof of (5.28) in exercise 43 is interesting, but it requires inspiration. When
we transform an art into a science, we aim to replace inspiration by perspi-
ration; so let's see if the Gosper-Zeilberger approach to summation is able to

5.8 MECHANICAL SUMMATION 235
discover and prove (5.28) in a purely mechanical way. For convenience we
make the substitutions m = b + d, n = a, r = a + b + c + d, s = a + b + c,
so that (5.28) takes the more symmetrical form
X
k
(a + b + c + d + k)!
(a ‚àík)! (b ‚àík)! (c + k)! (d + k)! k!
= (a + b + c + d)! (a + b + c)! (a + b + d)!
a! b! (a + c)! (a + d)! (b + c)! (b + d)!
.
(5.134)
To make the sum nite, we assume that either a or b is a nonnegative integer.
Let t(n, k) = (n + b + c + d + k)!/(n ‚àík)! (b ‚àík)! (c + k)! (d + k)! k!
and ^t(n, k) = Œ≤0(n)t(n, k) + Œ≤1(n)t(n + 1, k). Proceeding along a path that
Deciding what pa-
rameter to call n
is the only non-
mechanical part.
is beginning to become well worn, we set
p(n, k) = (n + 1 ‚àík)Œ≤0(n) + (n + 1 + b + c + d + k)Œ≤1(n) = ^p(n, k) ,
t(n, k) =
t(n, k)
n + 1 ‚àík =
(n + b + c + d + k)!
(n + 1 ‚àík)! (b ‚àík)! (c + k)! (d + k)! k! ,
q(n, k) = (n + b + c + d + k + 1)(n + 1 ‚àík)(b ‚àík) ,
r(n, k) = (c + k)(d + k)k ,
and we try to solve (5.129) for s(n, k). Again deg(q‚àír) < deg(q+r), but this
time deg(^p)‚àídeg(q+r)+1 = ‚àí1 so it looks like we're stuck. However, Step 2b
has an important second choice, d = ‚àí2Œª‚Ä≤/Œª, for the degree of s; we had better
try it now before we give up. Here R(n, k) = q(n, k) + r(n, k) = 2k3 + ¬∑ ¬∑ ¬∑ , so
Œª = 2, while the polynomial Q(n, k) = q(n, k) ‚àír(n, k) almost miraculously
turns out to have degree 1 in k | the coecient of k2 vanishes! Therefore
Notice that Œª‚Ä≤ is
not the leading
coecient of Q,
although Œª is the
leading coecient
of R. The num-
ber Œª‚Ä≤ is the coe-
cient of kdeg(R)‚àí1
in Q.
Œª‚Ä≤ = 0; Gosper allows us to take d = 0 and s(n, k) = Œ±0(n).
The equations to be solved are now
(n + 1)Œ≤0(n) + (n + 1 + b + c + d)Œ≤1(n)
‚àí(n + 1)(n + 1 + b + c + d)bŒ±0(n) = 0 ,
‚àíŒ≤0(n) + Œ≤1(n)
‚àí
¬°
(n + 1)b ‚àí(n + 1 + b)(n + 1 + b + c + d) ‚àícd
¬¢
Œ±0(n) = 0 ;
and we nd
Œ≤0(n) = (n + 1 + b + c)(n + 1 + b + d)(n + 1 + b + c + d) ,
Œ≤1(n) = ‚àí(n + 1)(n + 1 + c)(n + 1 + d) ,
Œ±0(n) = 2n + 2 + b + c + d ,
after only a modest amount of perspiration.
The identity (5.134) follows
Perspiration ows,
identity follows.
immediately.
A similar proof of (5.134) can be obtained if we work with n = d instead
of n = a. (See exercise 99.)

236 BINOMIAL COEFFICIENTS
The Gosper-Zeilberger approach helps us evaluate denite sums over a
restricted range as well as sums over all k. For example, let's consider
Sn(z) =
n
X
k=0
¬µn + k
k
¬∂
zk .
(5.135)
When z = 1
2 we obtained an \unexpected" result in (5.20); would Gosper and
Zeilberger have expected it? Putting t(n, k) =
¬°n+k
k
¬¢
zk leads us to
p(n, k) = (n + 1)Œ≤0(n) + (n + 1 + k)Œ≤1(n) = ^p(n, k) ,
t(n, k) = t(n, k)/(n + 1) = (n + k)! zk/k! (n + 1)! ,
q(n, k) = (n + 1 + k)z ,
r(n, k) = k ,
and deg(s) = deg(^p)‚àídeg(q‚àír) = 0. Equation (5.129) is solved by Œ≤0(n) = 1,
Œ≤1(n) = z ‚àí1, s(n, k) = 1. Therefore we nd
t(n, k) + (z ‚àí1)t(n + 1, k) = T(n, k + 1) ‚àíT(n, k) ,
(5.136)
where T(n, k) = r(n, k)s(n, k)^t(n, k)/^p(n, k) =
¬°n+k
k‚àí1
¬¢
zk. We can now sum
(5.136) for 0  k  n + 1, getting
Sn(z) + t(n, n + 1) + (z ‚àí1)Sn+1(z) = T(n, n + 2) ‚àíT(n, 0)
=
¬µ2n + 2
n + 1
¬∂
zn+2
= 2
¬µ2n + 1
n
¬∂
zn+2 .
But t(n, n + 1) =
¬°2n+1
n+1
¬¢
zn+1 =
¬°2n+1
n
¬¢
zn+1, so
Sn+1(z) =
1
1 ‚àíz
¬µ
Sn(z) + (1 ‚àí2z)
¬µ2n + 1
n
¬∂
zn+1
¬∂
.
(5.137)
We see immediately that the case z =
1
2 is special, and that Sn+1( 1
2) =
2Sn( 1
2). Moreover, the recurrence (5.137) can be simplied by applying the
summation factor (1 ‚àíz)n+1 to both sides; this yields the general identity
(1 ‚àíz)n
n
X
k=0
¬µn + k
k
¬∂
zk = 1 + 1 ‚àí2z
2 ‚àí2z
n
X
k=1
¬µ2k
k
¬∂¬°
z(1 ‚àíz)
¬¢k ,
(5.138)
which comparatively few people would have expected before Gosper and Zeil-
berger came along. Now the production of such identities is routine.

5.8 MECHANICAL SUMMATION 237
How about the similar sum
Sn(z) =
n
X
k=0
¬µn ‚àík
k
¬∂
zk ,
(5.139)
which we encountered in (5.74)? Flushed with condence, we set t(n, k) =
¬°n‚àík
k
¬¢
zk and proceed to calculate
p(n, k) = (n + 1 ‚àí2k)Œ≤0(n) + (n + 1 ‚àík)Œ≤1(n) = ^p(n, k) ,
t(n, k) = t(n, k)/(n + 1 ‚àí2k) = (n ‚àík)! zk/k! (n + 1 ‚àí2k)! ,
q(n, k) = (n + 1 ‚àí2k)(n ‚àí2k)z ,
r(n, k) = (n + 1 ‚àík)k .
But whoa | there's no way to solve (5.129), if we assume that z Ã∏= ‚àí1
4, because
Sn(‚àí1
4) equals
(n + 1)/2n .
the degree of s would have to be deg(^p) ‚àídeg(q ‚àír) = ‚àí1.
No problem. We simply add another parameter Œ≤2(n) and try ^t(n, k) =
Œ≤0(n)t(n, k) + Œ≤1(n)t(n + 1, k) + Œ≤2(n)t(n + 2, k) instead:
p(n, k) = (n + 1 ‚àí2k)(n + 2 ‚àí2k)Œ≤0(n)
+ (n + 1 ‚àík)(n + 2 ‚àí2k)Œ≤1(n)
+ (n + 1 ‚àík)(n + 2 ‚àík)Œ≤2(n) = ^p(n, k) ,
t(n, k) = t(n, k)/(n+1‚àí2k)(n+2‚àí2k) = (n‚àík)! zk/k! (n+2‚àí2k)! ,
q(n, k) = (n + 2 ‚àí2k)(n + 1 ‚àí2k)z ,
r(n, k) = (n + 1 ‚àík)k .
Now we can try s(n, k) = Œ±0(n) and (5.129) does have a solution:
Œ≤0(n) = z ,
Œ≤1(n) = 1 ,
Œ≤2(n) = ‚àí1 ,
Œ±0(n) = 1 .
We have discovered that
zt(n, k) + t(n + 1, k) ‚àít(n + 2, k) = T(n, k + 1) ‚àíT(n, k) ,
where T(n, k) equals r(n, k)s(n, k)^t(n, k)/^p(n, k) = (n + 1 ‚àík)kt(n, k) =
¬°n+1‚àík
k‚àí1
¬¢
zk. Summing from k = 0 to k = n gives
zSn(z) +
¬°
Sn+1(z) ‚àí
¬°
0
n+1
¬¢
zn+1¬¢
‚àí
¬°
Sn+2(z) ‚àí
¬°
0
n+2
¬¢
zn+2 ‚àí
¬°
1
n+1
¬¢
zn+1¬¢
= T(n, n + 1) ‚àíT(n, 0) .
And
¬°
1
n+1
¬¢
=
¬°0
n
¬¢
zn+1 = T(n, n + 1) for all n  0, so we obtain
Sn+2(z) = Sn+1(z) + zSn(z) ,
n  0.
(5.140)

238 BINOMIAL COEFFICIENTS
We will study the solution of such recurrences in Chapters 6 and 7; the meth-
ods of those chapters lead directly from (5.140) to the closed form (5.74),
when S0(z) = S1(z) = 1.
One more example | a famous one | will complete the picture.
The
French mathematician Roger Apery solved a long-standing problem in 1978
when he proved that the number Œ∂(3) = 1+2‚àí3 +3‚àí3 +4‚àí3 +¬∑ ¬∑ ¬∑ is irrational
[14]. One of the main components of his proof involved the binomial sums
An =
X
k
¬µn
k
¬∂2 ¬µn + k
k
¬∂2
,
(5.141)
for which he announced a recurrence that other mathematicians were unable
to verify at the time. (The numbers An have since become known as Apery
numbers; we have A0 = 1, A1 = 5, A2 = 73, A3 = 1445, A4 = 33001.)
Finally [356] Don Zagier and Henri Cohen found a proof of Apery's claim, and
their proof for this special (but dicult) sum was one of the key clues that
ultimately led Zeilberger to discover the general approach we are discussing.
By now, in fact, we have seen enough examples to make the sum in (5.141)
almost trivial. Putting t(n, k) =
¬°n
k
¬¢2¬°n+k
k
¬¢2 and ^t(n, k) = Œ≤0(n)t(n, k) +
(First we try do-
ing without Œ≤2 ,
but that attempt
quickly peters out.)
Œ≤1(n)t(n + 1, k) + Œ≤2(n)t(n + 2, k), we try to solve (5.129) with
p(n, k) = (n + 1 ‚àík)2(n + 2 ‚àík)2Œ≤0(n)
+ (n + 1 + k)2(n + 2 ‚àík)2Œ≤1(n)
+ (n + 1 + k)2(n + 2 + k)2Œ≤2(n) = ^p(n, k) ,
t(n, k) = t(n, k)/(n+1‚àík)2(n+2‚àík)2 = (n+k)!2/k!4(n+2‚àík)!2 ,
q(n, k) = (n + 1 + k)2(n + 2 ‚àík)2 ,
r(n, k) = k4 .
(We don't worry about the fact that q has the factor (k + n + 1) while r has
the factor k; this does not violate (5.118), because we are regarding n as a
variable parameter, not a xed integer.) Since q(n, k) ‚àír(n, k) = ‚àí2k3 + ¬∑ ¬∑ ¬∑ ,
we are allowed to set deg(s) = ‚àí2Œª‚Ä≤/Œª = 2, so we take
s(n, k) = Œ±2(n)k2 + Œ±1(n)k + Œ±0(n) .
With this choice of s, the recurrence (5.129) boils down to ve equations in
the six unknown quantities Œ≤0(n), Œ≤1(n), Œ≤2(n), Œ±0(n), Œ±1(n), Œ±2(n). For
example, the equation arising from the coecients of k0 simplies to
Œ≤0 + Œ≤1 + Œ≤2 ‚àíŒ±0 ‚àíŒ±1 ‚àíŒ±2 = 0 ;
the equation arising from the coecients of k4 is
Œ≤0 + Œ≤1 + Œ≤2 + Œ±1 + (6 + 6n + 2n2)Œ±2 = 0 .

5.8 MECHANICAL SUMMATION 239
The other three equations are more complicated. But the main point is that
these linear equations | like all the equations that arise when we come to this
stage of the Gosper-Zeilberger algorithm | are homogeneous (their right-
hand sides are 0). So they always have a nonzero solution when the number
of unknowns exceeds the number of equations. A solution, in our case, turns
out to be
Œ≤0(n) = (n + 1)3 ,
Œ≤1(n) = ‚àí(2n + 3)(17n2 + 51n + 39) ,
Œ≤2(n) = (n + 2)3 ,
Œ±0(n) = ‚àí16(n + 1)(n + 2)(2n + 3) ,
Œ±1(n) = ‚àí12(2n + 3) ,
Œ±2(n) = 8(2n + 3) .
Consequently
(n + 1)3t(n, k) ‚àí(2n + 3)(17n2 + 51n + 39)t(n + 1, k)
+ (n + 2)3t(n + 2, k) = T(n, k + 1) ‚àíT(n, k) ,
where T(n, k) = k4s(n, k)t(n, k) = (2n + 3)(8k2 ‚àí12k ‚àí16(n + 1)(n + 2)) √ó
(n + k)!2/(k ‚àí1)!4(n + 2 ‚àík)!2. Summing on k gives Apery's once-incredible
\Professor Little-
wood, when he
makes use of an
algebraic identity,
always saves himself
the trouble of prov-
ing it; he maintains
that an identity, if
true, can be veried
in a few lines by
anybody obtuse
enough to feel the
need of verication.
My object in the
following pages
is to confute this
assertion."
|F.J. Dyson [89]
recurrence,
(n + 1)3An + (n + 2)3An+2 = (2n + 3)(17n2+51n+39)An+1 . (5.142)
Does the Gosper-Zeilberger method work with all the sums we've en-
countered in this chapter? No. It doesn't apply when t(n, k) is the summand
¬°n
k
¬¢
(k + 1)k‚àí1(n ‚àík + 1)n‚àík‚àí1 in (5.65), because the term ratio t(n, k +
1)/t(n, k) is not a rational function of k. It also fails to handle cases like
t(n, k) =
¬°n
k
¬¢
nk, because the other term ratio t(n + 1, k)/t(n, k) is not a
rational function of k. (We can do that one, however, by summing
¬°n
k
¬¢
zk
and then setting z = n.)
And it fails on a comparatively simple sum-
mand like t(n, k) = 1/(nk + 1), even though both t(n, k + 1)/t(n, k) and
t(n + 1, k)/t(n, k) are rational functions of n and k; see exercise 107.
But the Gosper-Zeilberger algorithm is guaranteed to succeed in an enor-
mous number of cases, namely whenever the summand t(n, k) is a so-called
proper term | a term that can be written in the form
t(n, k) = f(n, k)(a1n+a‚Ä≤
1k+a‚Ä≤‚Ä≤
1 )! . . . (apn+a‚Ä≤
pk+a‚Ä≤‚Ä≤
p)!
(b1n+b‚Ä≤
1k+b‚Ä≤‚Ä≤
1 )! . . . (bqn+b‚Ä≤qk+b‚Ä≤‚Ä≤q)! wnzk . (5.143)
Here f(n, k) is a polynomial in n and k; the coecients a1, a‚Ä≤
1, . . . , ap, a‚Ä≤
p,
b1, b‚Ä≤
1, . . . , bq, b‚Ä≤
q are specic integer constants; the parameters w and z

240 BINOMIAL COEFFICIENTS
are nonzero; and the other quantities a‚Ä≤‚Ä≤
1 , . . . , a‚Ä≤‚Ä≤
p, b‚Ä≤‚Ä≤
1 , . . . , b‚Ä≤‚Ä≤
q are arbitrary
complex numbers. We will prove that whenever t(n, k) is a proper term, there
exist polynomials Œ≤0(n), . . . , Œ≤l(n), not all zero, and a proper term T(n, k),
such that
What happens if
t(n, k) is indepen-
dent of n?
Œ≤0(n)t(n, k) + ¬∑ ¬∑ ¬∑ + Œ≤l(n)t(n + l, k) = T(n, k + 1) ‚àíT(n, k) .
(5.144)
The following proof is due to Wilf and Zeilberger [374].
Let N be the operator that increases n by 1, and let K be the operator
that increases k by 1, so that, for example, N2K3t(n, k) = t(n + 2, k + 3).
We will study linear dierence operators in N, K, and n, namely operator
polynomials of the form
H(N, K, n) =
I
X
i=0
J
X
j=0
Œ±i,j(n)NiKj ,
(5.145)
where each Œ±i,j(n) is a polynomial in n. Our rst observation is that, if t(n, k)
is any proper term and H(N, K, n) is any linear dierence operator, then
H(N, K, n)t(n, k) is a proper term. Suppose t and H are given respectively
by (5.143) and (5.145); then we dene a \base term"
t(n, k)I,J =
Qp
i=1
¬°
ain + a‚Ä≤
ik + aiI[ai < 0] + a‚Ä≤
iJ[a‚Ä≤
i < 0] + a‚Ä≤‚Ä≤
i
¬¢
!
Qq
i=1
¬°
bin + b‚Ä≤
ik + biI[bi > 0] + b‚Ä≤
iJ[b‚Ä≤
i > 0] + b‚Ä≤‚Ä≤
i
¬¢
!
wnzk .
For example, if t(n, k) is
¬°n‚àí2k
k
¬¢
= (n ‚àí2k)!/k! (n ‚àí3k)!, the base term
corresponding to a linear dierence operator of degrees I and J is t(n, k)I,J =
(n ‚àí2k ‚àí2J)!/(k + J)! (n ‚àí3k + I)!. The point is that Œ±i,j(n)NiKjt(n, k) is
equal to t(n, k)I,J times a polynomial in n and k, whenever 0  i  I and
0  j  J. A nite sum of polynomials is a polynomial, so H(N, K, n)t(n, k)
has the required form (5.143).
The next step is to show that whenever t(n, k) is a proper term, there is
always a nonzero linear dierence operator H(N, K, n) such that
H(N, K, n)t(n, k) = 0 .
If 0  i  I and 0  j  J, the shifted term NiKjt(n, k) is t(n, k)I,J times a
polynomial in n and k that has degree at most
DI,J = deg(f) + ja1jI + ja‚Ä≤
1jJ + ¬∑ ¬∑ ¬∑ + japjI + ja‚Ä≤
pjJ
+ jb1jI + jb‚Ä≤
1jJ + ¬∑ ¬∑ ¬∑ + jbqjI + jb‚Ä≤
qjJ
in the variable k. Hence the desired H exists if we can solve DI,J + 1 homo-
geneous linear equations in the (I+1)(J+1) variables Œ±i,j(n), with coecients

5.8 MECHANICAL SUMMATION 241
that are polynomials in n. All we need to do is choose I and J large enough
that (I + 1)(J + 1) > DI,J + 1. For example, we can take I = 2A‚Ä≤ + 1 and
J = 2A + deg(f), where
A = ja1j + ¬∑ ¬∑ ¬∑ + japj + jb1j + ¬∑ ¬∑ ¬∑ + jbqj ;
A‚Ä≤ = ja‚Ä≤
1j + ¬∑ ¬∑ ¬∑ + ja‚Ä≤
pj + jb‚Ä≤
1j + ¬∑ ¬∑ ¬∑ + jb‚Ä≤
qj .
The last step in the proof is to go from the equation H(N, K, n)t(n, k) = 0
to a solution of (5.144). Let H be chosen so that J is minimized, i.e., so that
H has the smallest possible degree in K. We can write
The trick here is
based on regarding
H as a polynomial
in K and then
replacing K by
‚àÜ+ 1.
H(N, K, n) = H(N, 1, n) ‚àí(K ‚àí1)G(N, K, n)
for some linear dierence operator G(N, K, n).
Let H(N, 1, n) = Œ≤0(n) +
Œ≤1(n)N + ¬∑ ¬∑ ¬∑ + Œ≤l(n)Nl and T(n, k) = G(N, K, n)t(n, k). Then T(n, k) is a
proper term, and (5.144) holds.
The proof is almost complete; we still have to verify that H(N, 1, n) is not
simply the zero operator. If it is, then T(n, k) is independent of k. So there
are polynomials Œ≤0(n) and Œ≤1(n) such that
¬°
Œ≤0(n) + Œ≤1(n)N
¬¢
T(n, k) = 0.
But then
¬°
Œ≤0(n) + Œ≤1(n)N
¬¢
G(N, K, n) is a nonzero linear dierence operator
of degree J ‚àí1 that annihilates t(n, k); this contradicts the minimality of J,
and our proof of (5.144) is complete.
Once we know that (5.144) holds, for some proper term T, we can be
sure that Gosper's algorithm will succeed in nding T (or T plus a constant).
Although we proved Gosper's algorithm only for the case of hypergeometric
terms t(k) in a single variable k, our proof can be extended to the two-variable
case, as follows: There are innitely many complex numbers n for which
condition (5.118) holds when q(n, k) and r(n, k) are completely factored as
polynomials in k, and for which the calculations of d in Step 2 agree with the
calculations of Gosper's one-variable algorithm. For all such n, our previous
proof shows that a suitable polynomial s(n, k) in k exists; therefore a suitable
polynomial s(n, k) in n and k exists; QED.
We have proved that the Gosper-Zeilberger algorithm will discover a
solution to (5.144), for some l, where l is as small as possible. That solution
gives us a recurrence in n for evaluating the sum over k of any proper term
t(n, k), provided that t(n, k) is nonzero for only nitely many k. And the
roles of n and k can, of course, be reversed, because the denition of proper
term in (5.143) is symmetrical in n and k.
Exercises 99{108 provide additional examples of the Gosper-Zeilberger
algorithm, illustrating some of its versatility. Wilf and Zeilberger [374] have
signicantly extended these results to methods that handle generalized bino-
mial coecients and multiple indices of summation.

242 BINOMIAL COEFFICIENTS
Exercises
Warmups
1
What is 114 ? Why is this number easy to compute, for a person who
knows binomial coecients?
2
For which value(s) of k is
¬°n
k
¬¢
a maximum, when n is a given positive
integer? Prove your answer.
3
Prove the hexagon property,
¬µn ‚àí1
k ‚àí1
¬∂¬µ n
k + 1
¬∂¬µn + 1
k
¬∂
=
¬µn ‚àí1
k
¬∂¬µn + 1
k + 1
¬∂¬µ n
k ‚àí1
¬∂
.
4
Evaluate
¬°‚àí1
k
¬¢
by negating (actually un-negating) its upper index.
5
Let p be prime. Show that
¬°p
k
¬¢
mod p = 0 for 0 < k < p. What does this
imply about the binomial coecients
¬°p‚àí1
k
¬¢
?
6
Fix up the text's derivation in Problem 6, Section 5.2, by correctly ap-
A case of
mistaken identity.
plying symmetry.
7
Is (5.34) true also when k < 0?
8
Evaluate
X
k
¬µn
k
¬∂
(‚àí1)k(1 ‚àík/n)n .
What is the approximate value of this sum, when n is very large? Hint:
The sum is ‚àÜn f(0) for some function f.
9
Show that the generalized exponentials of (5.58) obey the law
Et(z) = E(tz)1/t ,
if t Ã∏= 0,
where E(z) is an abbreviation for E1(z).
10
Show that ‚àí2
¬°
ln(1 ‚àíz) + z
¬¢
/z2 is a hypergeometric function.
11
Express the two functions
sin z = z ‚àíz3
3! + z5
5! ‚àíz7
7! + ¬∑ ¬∑ ¬∑
arcsin z = z + 1¬∑z3
2¬∑3 + 1¬∑3¬∑z5
2¬∑4¬∑5 + 1¬∑3¬∑5¬∑z7
2¬∑4¬∑6¬∑7 + ¬∑ ¬∑ ¬∑
in terms of hypergeometric series.

5 EXERCISES 243
12
Which of the following functions of k is a hypergeometric term, as dened
in Section 5.7? Explain why or why not.
a
nk.
b
kn.
c
¬°
k! + (k + 1)!
¬¢
/2.
d
Hk, that is, 1
1 + 1
2 + ¬∑ ¬∑ ¬∑ + 1
k.
e
1/
¬°n
k
¬¢
.
f
t(k)T(k), when t and T are hypergeometric terms.
(Here t and T
aren't necessar-
ily related as in
(5.120).)
g
t(k) + T(k), when t and T are hypergeometric terms.
h
t(n ‚àík), when t is a hypergeometric term.
i
a t(k) + b t(k+1) + c t(k+2), when t is a hypergeometric term.
j
‚åàk/2‚åâ.
k
k [k > 0].
Basics
13
Find relations between the superfactorial function Pn = Qn
k=1 k! of ex-
ercise 4.55, the hyperfactorial function Qn = Qn
k=1 kk, and the product
Rn = Qn
k=0
¬°n
k
¬¢
.
14
Prove identity (5.25) by negating the upper index in Vandermonde's con-
volution (5.22). Then show that another negation yields (5.26).
15
What is P
k
¬°n
k
¬¢3(‚àí1)k ? Hint: See (5.29).
16
Evaluate the sum
X
k
¬µ 2a
a + k
¬∂¬µ 2b
b + k
¬∂¬µ 2c
c + k
¬∂
(‚àí1)k
when a, b, c are nonnegative integers.
17
Find a simple relation between
¬°2n‚àí1/2
n
¬¢
and
¬°2n‚àí1/2
2n
¬¢
.
18
Find an alternative form analogous to (5.35) for the product
¬µr
k
¬∂¬µr ‚àí1/3
k
¬∂¬µr ‚àí2/3
k
¬∂
.
19
Show that the generalized binomials of (5.58) obey the law
Bt(z) = B1‚àít(‚àíz)‚àí1 .
20
Dene a \generalized bloopergeometric series" by the formula
G
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
=
X
k0
ak
1 . . . ak
m
bk
1 . . . bk
n
zk
k!
,
using falling powers instead of the rising ones in (5.76). Explain how G is
related to F.

244 BINOMIAL COEFFICIENTS
21
Show that Euler's denition of factorials is consistent with the ordinary
denition, by showing that the limit in (5.83) is 1
¬±¬°
(m‚àí1) . . . (1)
¬¢
when
z = m is a positive integer.
22
Use (5.83) to prove the factorial duplication formula:
By the way,
(‚àí1
2)! = ‚àöœÄ.
x! (x ‚àí1
2)! = (2x)! (‚àí1
2)!/22x .
23
What is the value of F(‚àín, 1; ; 1)?
24
Find P
k
¬°
n
m+k
¬¢¬°m+k
2k
¬¢
4k by using hypergeometric series.
25
Show that
(a1 ‚àíb1) F
¬µ a1, a2, . . . , am
b1+1, b2, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
= a1 F
¬µa1+1, a2, . . . , am
b1+1, b2, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
‚àíb1 F
¬µa1, a2, . . . , am
b1, b2, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
.
Find a similar relation between the hypergeometrics
F
¬µa1, a2, a3, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
,
F
¬µa1+1, a2, a3, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
,
and
F
¬µa1, a2+1, a3, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
.
26
Express the function G(z) in the formula
F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
= 1 + G(z)
as a multiple of a hypergeometric series.
27
Prove that
F
¬µ a1, a1+ 1
2, . . . , am, am+ 1
2
b1, b1+ 1
2, . . . , bn, bn+ 1
2, 1
2
¬Ø¬Ø¬Ø (2m‚àín‚àí1z)2
¬∂
= 1
2
¬µ
F
¬µ2a1, . . . , 2am
2b1, . . . , 2bn
¬Ø¬Ø¬Ø z
¬∂
+ F
¬µ2a1, . . . , 2am
2b1, . . . , 2bn
¬Ø¬Ø¬Ø ‚àíz
¬∂¬∂
.
28
Prove Euler's identity
F
¬µa, b
c
¬Ø¬Ø¬Ø z
¬∂
= (1 ‚àíz)c‚àía‚àíb F
¬µc‚àía, c‚àíb
c
¬Ø¬Ø¬Ø z
¬∂
by applying Pfa's reection law (5.101) twice.

5 EXERCISES 245
29
Show that conuent hypergeometrics satisfy
ez F
¬µa
b
¬Ø¬Ø¬Ø ‚àíz
¬∂
= F
¬µb‚àía
b
¬Ø¬Ø¬Ø z
¬∂
.
30
What hypergeometric series F satises zF‚Ä≤(z) + F(z) = 1/(1 ‚àíz)?
31
Show that if f(k) is any function summable in hypergeometric terms,
then f itself is a hypergeometric term.
For example, if P f(k) Œ¥k =
cF(A1, . . . , AM; B1, . . . , BN; Z)k+C, then there are constants a1, . . . , am,
b1, . . . , bn, and z such that f(k) is a multiple of (5.115).
32
Find P k2 Œ¥k by Gosper's method.
33
Use Gosper's method to nd P Œ¥k/(k2 ‚àí1).
34
Show that a partial hypergeometric sum can always be represented as a
limit of ordinary hypergeometrics:
X
kc
F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
k = lim
œµ‚Üí0 F
¬µ ‚àíc, a1, . . . , am
œµ‚àíc, b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
,
when c is a nonnegative integer. (See (5.115.) Use this idea to evaluate
P
km
¬°n
k
¬¢
(‚àí1)k.
Homework exercises
35
The notation P
kn
¬°n
k
¬¢
2k‚àín is ambiguous without context. Evaluate it
a
as a sum on k;
b
as a sum on n.
36
Let pk be the largest power of the prime p that divides
¬°m+n
m
¬¢
, when m
and n are nonnegative integers. Prove that k is the number of carries
that occur when m is added to n in the radix p number system. Hint:
Exercise 4.24 helps here.
37
Show that an analog of the binomial theorem holds for factorial powers.
That is, prove the identities
(x + y)n =
X
k
¬µn
k
¬∂
xk yn‚àík ,
(x + y)n =
X
k
¬µn
k
¬∂
xk yn‚àík ,
for all nonnegative integers n.
38
Show that all nonnegative integers n can be represented uniquely in the
form n =
¬°a
1
¬¢
+
¬°b
2
¬¢
+
¬°c
3
¬¢
where a, b, and c are integers with 0  a < b < c.
(This is called the binomial number system.)

246 BINOMIAL COEFFICIENTS
39
Show that if xy = ax + by then
xnyn =
n
X
k=1
¬µ2n ‚àí1 ‚àík
n ‚àí1
¬∂
(anbn‚àíkxk + an‚àíkbnyk)
for all n > 0. Find a similar formula for the more general product xmyn.
(These formulas give useful partial fraction expansions, for example when
x = 1/(z ‚àíc) and y = 1/(z ‚àíd).)
40
Find a closed form for
m
X
j=1
(‚àí1)j+1
¬µr
j
¬∂
n
X
k=1
¬µ‚àíj + rk + s
m ‚àíj
¬∂
,
integers m, n  0.
41
Evaluate P
k
¬°n
k
¬¢
k!/(n + 1 + k)! when n is a nonnegative integer.
42
Find the indenite sum P¬°
(‚àí1)x¬±¬°n
x
¬¢¬¢
Œ¥x, and use it to compute the sum
Pn
k=0(‚àí1)k¬±¬°n
k
¬¢
in closed form.
43
Prove the triple-binomial identity (5.28). Hint: First replace
¬° r+k
m+n
¬¢
by
P
j
¬°
r
m+n‚àíj
¬¢¬°k
j
¬¢
.
44
Use identity (5.32) to nd closed forms for the double sums
X
j,k
(‚àí1)j+k
¬µj + k
j
¬∂¬µa
j
¬∂¬µb
k
¬∂¬µm + n ‚àíj ‚àík
m ‚àíj
¬∂
and
X
j,k0
(‚àí1)j+k
¬µa
j
¬∂¬µm
j
¬∂¬µb
k
¬∂¬µn
k
¬∂√Å¬µm + n
j + k
¬∂
,
given integers m  a  0 and n  b  0.
45
Find a closed form for P
kn
¬°2k
k
¬¢
4‚àík.
46
Evaluate the following sum in closed form, when n is a positive integer:
X
k
¬µ2k ‚àí1
k
¬∂¬µ4n ‚àí2k ‚àí1
2n ‚àík
¬∂
(‚àí1)k‚àí1
(2k ‚àí1)(4n ‚àí2k ‚àí1) .
Hint: Generating functions win again.
47
The sum
X
k
¬µrk + s
k
¬∂¬µrn ‚àírk ‚àís
n ‚àík
¬∂
is a polynomial in r and s. Show that it doesn't depend on s.

5 EXERCISES 247
48
The identity P
kn
¬°n+k
n
¬¢
2‚àík = 2n can be combined with the formula
P
k0
¬°n+k
n
¬¢
zk = 1/(1 ‚àíz)n+1 to yield
X
k>n
¬µn + k
n
¬∂
2‚àík = 2n .
What is the hypergeometric form of the latter identity?
49
Use the hypergeometric method to evaluate
X
k
(‚àí1)k
¬µx
k
¬∂¬µx + n ‚àík
n ‚àík
¬∂
y
y + n ‚àík .
50
Prove Pfa's reection law (5.101) by comparing the coecients of zn
on both sides of the equation.
51
The derivation of (5.104) shows that
limœµ‚Üí0 F(‚àím, ‚àí2m ‚àí1 + œµ; ‚àí2m + œµ; 2) = 1
¬±¬°‚àí1/2
m
¬¢
.
In this exercise we will see that slightly dierent limiting processes lead
to distinctly dierent answers for the degenerate hypergeometric series
F(‚àím, ‚àí2m ‚àí1; ‚àí2m; 2).
a
Show that limœµ‚Üí0 F(‚àím + œµ, ‚àí2m ‚àí1; ‚àí2m + 2œµ; 2) = 0, by using
Pfa's reection law to prove the identity F(a, ‚àí2m ‚àí1; 2a; 2) = 0
for all integers m  0.
b
What is limœµ‚Üí0 F(‚àím + œµ, ‚àí2m ‚àí1; ‚àí2m + œµ; 2)?
52
Prove that if N is a nonnegative integer,
bN
1 . . . bN
n F
¬µa1, . . . , am, ‚àíN
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
= aN
1 . . . aN
m(‚àíz)N F
¬µ1‚àíb1‚àíN, . . . , 1‚àíbn‚àíN, ‚àíN
1‚àía1‚àíN, . . . , 1‚àíam‚àíN
¬Ø¬Ø¬Ø (‚àí1)m+n
z
¬∂
.
53
If we put b = ‚àí1
2 and z = 1 in Gauss's identity (5.110), the left side
reduces to ‚àí1 while the right side is +1. Why doesn't this prove that
‚àí1 = +1?
54
Explain how the right-hand side of (5.112) was obtained.
55
If the hypergeometric terms t(k) = F(a1, . . . , am; b1, . . . , bn; z)k and
T(k) = F(A1, . . . , AM; B1, . . . , BN; Z)k satisfy t(k) = c
¬°
T(k + 1) ‚àíT(k)
¬¢
for all k  0, show that z = Z and m ‚àín = M ‚àíN.
56
Find a general formula for P ¬°‚àí3
k
¬¢
Œ¥k using Gosper's method. Show that
(‚àí1)k‚àí1¬• k+1
2
¬¶¬• k+2
2
¬¶
is also a solution.

248 BINOMIAL COEFFICIENTS
57
Use Gosper's method to nd a constant Œ∏ such that
X ¬µn
k
¬∂
zk(k + Œ∏) Œ¥k
is summable in hypergeometric terms.
58
If m and n are integers with 0  m  n, let
Tm,n =
X
0k<n
¬µ k
m
¬∂
1
n ‚àík .
Find a relation between Tm,n and Tm‚àí1,n‚àí1, then solve your recurrence
by applying a summation factor.
Exam problems
59
Find a closed form for
X
k1
¬µ
n
‚åälogm k‚åã
¬∂
when m and n are positive integers.
60
Use Stirling's approximation (4.23) to estimate
¬°m+n
n
¬¢
when m and n
are both large. What does your formula reduce to when m = n?
61
Prove that when p is prime, we have
¬µn
m
¬∂
‚â°
¬µ‚åän/p‚åã
‚åäm/p‚åã
¬∂¬µn mod p
m mod p
¬∂
(mod p) ,
for all nonnegative integers m and n.
62
Assuming that p is prime and that m and n are positive integers, deter-
mine the value of
¬°np
mp
¬¢
mod p2. Hint: You may wish to use the following
generalization of Vandermonde's convolution:
X
k1+k2+¬∑¬∑¬∑+km=n
¬µr1
k1
¬∂¬µr2
k2
¬∂
. . .
¬µrm
km
¬∂
=
¬µr1 + r2 + ¬∑ ¬∑ ¬∑ + rm
n
¬∂
.
63
Find a closed form for
n
X
k=0
(‚àí4)k
¬µn + k
2k
¬∂
,
given an integer n  0.

5 EXERCISES 249
64
Evaluate
n
X
k=0
¬µn
k
¬∂√Å¬ªk + 1
2
¬º
, given an integer n  0.
65
Prove that
X
k
¬µn ‚àí1
k
¬∂
n‚àík(k + 1)! = n .
66
Evaluate \Harry's double sum,"
X
0jk
¬µ
‚àí1
j ‚àí‚åä
p
k ‚àíj‚åã
¬∂¬µ j
m
¬∂ 1
2j ,
integer m  0,
as a function of m. (The sum is over both j and k.)
67
Find a closed form for
n
X
k=0
¬µ¬°k
2
¬¢
2
¬∂¬µ2n ‚àík
n
¬∂
,
integer n  0.
68
Find a closed form for
X
k
¬µn
k
¬∂
min(k, n ‚àík) ,
integer n  0.
69
Find a closed form for
min
k1,...,km0
k1+¬∑¬∑¬∑+km=n
m
X
j=1
¬µkj
2
¬∂
as a function of m and n.
70
Find a closed form for
X
k
¬µn
k
¬∂¬µ2k
k
¬∂ ¬µ‚àí1
2
¬∂k
,
integer n  0.
71
Let
Sn =
X
k0
¬µ n + k
m + 2k
¬∂
ak ,
where m and n are nonnegative integers, and let A(z) = P
k0 akzk be
the generating function for the sequence ‚ü®a0, a1, a2, . . . ‚ü©.
a
Express the generating function S(z) = P
n0 Snzn in terms of A(z).
b
Use this technique to solve Problem 7 in Section 5.2.

250 BINOMIAL COEFFICIENTS
72
Prove that, if m, n, and k are integers and n > 0,
¬µm/n
k
¬∂
n2k‚àíŒΩ(k)
is an integer,
where ŒΩ(k) is the number of 1's in the binary representation of k.
73
Use the repertoire method to solve the recurrence
X0 = Œ± ;
X1 = Œ≤ ;
Xn = (n ‚àí1)(Xn‚àí1 + Xn‚àí2) ,
for n > 1.
Hint: Both n! and n< satisfy this recurrence.
74
This problem concerns a deviant version of Pascal's triangle in which the
sides consist of the numbers 1, 2, 3, 4, . . . instead of all 1's, although the
interior numbers still satisfy the addition formula:
1
2
2
3
4
3
4
7
7
4
5
11
14
11
5
.
.
.
.
.
.
If
¬°¬°n
k
¬¢¬¢
denotes the kth number in row n, for 1  k  n, we have
¬°¬°n
1
¬¢¬¢
=
¬°¬°n
n
¬¢¬¢
= n, and
¬°¬°n
k
¬¢¬¢
=
¬°¬°n‚àí1
k
¬¢¬¢
+
¬°¬°n‚àí1
k‚àí1
¬¢¬¢
for 1 < k < n. Express
the quantity
¬°¬°n
k
¬¢¬¢
in closed form.
75
Find a relation between the functions
S0(n) =
X
k
¬µ n
3k
¬∂
,
S1(n) =
X
k
¬µ
n
3k + 1
¬∂
,
S2(n) =
X
k
¬µ
n
3k + 2
¬∂
and the quantities ‚åä2n/3‚åãand ‚åà2n/3‚åâ.
76
Solve the following recurrence for n, k  0:
Qn,0 = 1 ;
Q0,k = [k = 0] ;
Qn,k = Qn‚àí1,k + Qn‚àí1,k‚àí1 +
¬µn
k
¬∂
,
for n, k > 0.

5 EXERCISES 251
77
What is the value of
X
0k1,...,kmn
Y
1j<m
¬µkj+1
kj
¬∂
,
if m > 1?
78
Assuming that m is a positive integer, nd a closed form for
2m2
X
k=0
¬µ
k mod m
(2k + 1) mod (2m + 1)
¬∂
.
79
a
What is the greatest common divisor of
¬°2n
1
¬¢
,
¬°2n
3
¬¢
, . . . ,
¬° 2n
2n‚àí1
¬¢
?
Hint: Consider the sum of these n numbers.
b
Show that the least common multiple of
¬°n
0
¬¢
,
¬°n
1
¬¢
, . . . ,
¬°n
n
¬¢
is equal
to L(n + 1)/(n + 1), where L(n) = lcm(1, 2, . . . , n).
80
Prove that
¬°n
k
¬¢
 (en/k)k for all integers k, n  0.
Handy to know.
81
If 0 < Œ∏ < 1 and 0  x  1, and if l, m, n are nonnegative integers with
m < n, prove the inequality
(‚àí1)n‚àím‚àí1 X
k
¬µl
k
¬∂¬µm + Œ∏
n + k
¬∂
xk > 0 .
Hint: Consider taking the derivative with respect to x.
Bonus problems
82
Prove that Pascal's triangle has an even more surprising hexagon prop-
erty than the one cited in the text:
gcd
¬≥¬°n‚àí1
k‚àí1
¬¢
,
¬° n
k+1
¬¢
,
¬°n+1
k
¬¢¬¥
= gcd
¬≥¬°n‚àí1
k
¬¢
,
¬°n+1
k+1
¬¢
,
¬° n
k‚àí1
¬¢¬¥
,
if 0 < k < n. For example, gcd(56, 36, 210) = gcd(28, 120, 126) = 2.
83
Prove the amazing ve-parameter double-sum identity (5.32).
84
Show that the second pair of convolution formulas, (5.61), follows from
the rst pair, (5.60). Hint: Dierentiate with respect to z.
85
Prove that
n
X
m=1
(‚àí1)m
X
1k1<k2<¬∑¬∑¬∑<kmn
¬µk3
1 + k3
2 + ¬∑ ¬∑ ¬∑ + k3
m + 2n
n
¬∂
= (‚àí1)nn!3 ‚àí
¬µ2n
n
¬∂
.
(The left side is a sum of 2n ‚àí1 terms.) Hint: Much more is true.

252 BINOMIAL COEFFICIENTS
86
Let a1, . . . , an be nonnegative integers, and let C(a1, . . . , an) be the
coecient of the constant term z0
1 . . . z0
n when the n(n ‚àí1) factors
Y
1i,jn
iÃ∏=j
¬µ
1 ‚àízi
zj
¬∂ai
are fully expanded into positive and negative powers of the complex vari-
ables z1, . . . , zn.
a
Prove that C(a1, . . . , an) equals the left-hand side of (5.31).
b
Prove that if z1, . . . , zn are distinct complex numbers, then the
polynomial
f(z) =
n
X
k=1
Y
1jn
jÃ∏=k
z ‚àízj
zk ‚àízj
is identically equal to 1.
c
Multiply the original product of n(n‚àí1) factors by f(0) and deduce
that C(a1, a2, . . . , an) is equal to
C(a1 ‚àí1, a2, . . . , an) + C(a1, a2 ‚àí1, . . . , an)
+ ¬∑ ¬∑ ¬∑ + C(a1, a2, . . . , an ‚àí1) .
(This recurrence denes multinomial coecients, so C(a1, . . . , an)
must equal the right-hand side of (5.31).)
87
Let m be a positive integer and let Œ∂ = eœÄi/m. Show that
X
kn/m
¬µn ‚àímk
k
¬∂
zmk
=
B‚àím(zm)n+1
(1 + m)B‚àím(zm) ‚àím
‚àí
X
0j<m
¬°
Œ∂2j+1z B1+1/m(Œ∂2j+1z)1/m¬¢n+1
(m + 1)B1+1/m(Œ∂2j+1z)‚àí1 ‚àí1
.
(This reduces to (5.74) in the special case m = 1.)
88
Prove that the coecients sk in (5.47) are equal to
(‚àí1)k
Z ‚àû
0
e‚àít(1 ‚àíe‚àít)k‚àí1 dt
t ,
for all k > 1; hence jskj < 1/(k ‚àí1).

5 EXERCISES 253
89
Prove that (5.19) has an innite counterpart,
X
k>m
¬µm+r
k
¬∂
xkym‚àík =
X
k>m
¬µ‚àír
k
¬∂
(‚àíx)k(x+y)m‚àík ,
integer m,
if jxj < jyj and jxj < jx + yj.
Dierentiate this identity n times with
respect to y and express it in terms of hypergeometrics; what relation do
you get?
90
Problem 1 in Section 5.2 considers P
k0
¬°r
k
¬¢¬±¬°s
k
¬¢
when r and s are in-
tegers with s  r  0. What is the value of this sum if r and s aren't
integers?
91
Prove Whipple's identity,
F
¬µ 1
2a, 1
2a+ 1
2, 1+a‚àíb‚àíc
1+a‚àíb, 1+a‚àíc
¬Ø¬Ø¬Ø
‚àí4z
(1‚àíz)2
¬∂
= (1 ‚àíz)a F
¬µ
a, b, c
1+a‚àíb, 1+a‚àíc
¬Ø¬Ø¬Ø z
¬∂
,
by showing that both sides satisfy the same dierential equation.
92
Prove Clausen's product identities
F
¬µ
a, b
a+b+ 1
2
¬Ø¬Ø¬Ø z
¬∂
2 = F
¬µ
2a, a+b, 2b
2a+2b, a+b+ 1
2
¬Ø¬Ø¬Ø z
¬∂
;
F
¬µ 1
4 +a, 1
4 +b
1+a+b
¬Ø¬Ø¬Ø z
¬∂
F
¬µ 1
4 ‚àía, 1
4 ‚àíb
1‚àía‚àíb
¬Ø¬Ø¬Ø z
¬∂
= F
¬µ 1
2, 1
2 +a‚àíb, 1
2 ‚àía+b
1+a+b, 1‚àía‚àíb
¬Ø¬Ø¬Ø z
¬∂
.
What identities result when the coecients of zn on both sides of these
formulas are equated?
93
Show that the indenite sum
X√É k‚àí1
Y
j=1
¬°
f(j) + Œ±
¬¢√Å
k
Y
j=1
f(j)
!
Œ¥k
has a (fairly) simple form, given any function f and any constant Œ±.
94
Find P ¬°a
k
¬¢¬° ‚àía
n‚àík
¬¢
Œ¥k.
95
What conditions in addition to (5.118) will make the polynomials p, q, r
of (5.117) uniquely determined?

254 BINOMIAL COEFFICIENTS
96
Prove that if Gosper's algorithm nds no solution to (5.120), given a
hypergeometric term t(k), then there is no solution to the more general
equation
t(k) =
¬°
T1(k + 1) + ¬∑ ¬∑ ¬∑ + Tm(k + 1)
¬¢
‚àí
¬°
T1(k) + ¬∑ ¬∑ ¬∑ + Tm(k)
¬¢
,
where T1(k), . . . , Tm(k) are hypergeometric terms.
97
Find all complex numbers z such that k!2¬± Qk
j=1(j2 +jz+1) is summable
in hypergeometric terms.
98
What recurrence does the Gosper-Zeilberger method give for the sum
Sn = P
k
¬° n
2k
¬¢
?
99
Use the Gosper-Zeilberger method to discover a closed form for P
kt(n, k)
when t(n, k) = (n + a + b + c + k)!/(n ‚àík)! (c + k)! (b ‚àík)! (a ‚àík)! k!,
assuming that a is a nonnegative integer.
100 Find a recurrence relation for the sum
Sn =
n
X
k=0
1
¬µn
k
¬∂ ,
and use the recurrence to nd another formula for Sn.
101 Find recurrence relations satised by the sums
Better use computer
algebra for this one
(and the next few).
a
Sm,n(z) =
X
k
¬µm
k
¬∂¬µn
k
¬∂
zk ;
b
Sn(z) = Sn,n(z) =
X
k
¬µn
k
¬∂2
zk .
102 Use the Gosper-Zeilberger procedure to generalize the \useless" identity
(5.113): Find additional values of a, b, and z such that
X
k
¬µn
k
¬∂¬µ 1
3n ‚àía
k
¬∂
zk
√Å¬µ 4
3n ‚àíb
k
¬∂
has a simple closed form.
103 Let t(n, k) be the proper term (5.143). What are the degrees of ^p(n, k),
q(n, k), and r(n, k) in terms of the variable k, when the Gosper-Zeilberger
procedure is applied to ^t(n, k) = Œ≤0(n)t(n, k) + ¬∑ ¬∑ ¬∑ + Œ≤l(n)t(n + l, k)?
(Ignore the rare, exceptional cases.)

5 EXERCISES 255
104 Use the Gosper-Zeilberger procedure to verify the remarkable identity
X
k
(‚àí1)k
¬µr ‚àís ‚àík
k
¬∂¬µr ‚àí2k
n ‚àík
¬∂
1
r ‚àín ‚àík + 1 =
¬µs
n
¬∂
1
r ‚àí2n + 1 .
Explain why the simplest recurrence for this sum is not found.
105 Show that if œâ = e2œÄi/3 we have
X
k+l+m=3n
¬µ 3n
k, l, m
¬∂2
œâl‚àím =
¬µ
4n
n, n, 2n
¬∂
,
integer n  0.
106 Prove the amazing identity (5.32) by letting t(r, j, k) be the summand
divided by the right-hand side, then showing that there are functions
T(r, j, k) and U(r, j, k) for which
t(r + 1, j, k) ‚àít(r, j, k) = T(r, j + 1, k) ‚àíT(r, j, k)
+ U(r, j, k + 1) ‚àíU(r, j, k) .
107 Prove that 1/(nk + 1) is not a proper term.
108 Show that the Apery numbers An of (5.141) are the diagonal elements
An,n of a matrix of numbers dened by
Am,n =
X
j,k
¬µm
j
¬∂2 ¬µm
k
¬∂2 ¬µ2m + n ‚àíj ‚àík
2m
¬∂
.
Prove, in fact, that this matrix is symmetric, and that
Am,n =
X
k
¬µm + n ‚àík
k
¬∂2 ¬µm + n ‚àí2k
m ‚àík
¬∂2
=
X
k
¬µm
k
¬∂ ¬µn
k
¬∂ ¬µm + k
k
¬∂ ¬µn + k
k
¬∂
.
109 Prove that the Apery numbers (5.141) satisfy
An ‚â°A‚åän/p‚åãAn mod p
(mod p)
for all primes p and all integers n  0.
Research problems
110 For what values of n is
¬°2n
n
¬¢
‚â°(‚àí1)n (mod (2n + 1))?

256 BINOMIAL COEFFICIENTS
111 Let q(n) be the smallest odd prime factor of the middle binomial co-
ecient
¬°2n
n
¬¢
. According to exercise 36, the odd primes p that do not
divide
¬°2n
n
¬¢
are those for which all digits in n's radix p representation
are (p ‚àí1)/2 or less. Computer experiments have shown that q(n)  11
for 1 < n < 1010000, except that q(3160) = 13.
a
Is q(n)  11 for all n > 3160?
b
Is q(n) = 11 for innitely many n?
A reward of $7 ¬∑ 11 ¬∑ 13 is oered for a solution to either (a) or (b).
112 Is
¬°2n
n
¬¢
divisible either by 4 or by 9, for all n > 4 except n = 64 and
n = 256?
113 If t(n + 1, k)/t(n, k) and t(n, k + 1)/t(n, k) are rational functions of n
and k, and if there is a nonzero linear dierence operator H(N, K, n) such
that H(N, K, n)t(n, k) = 0, does it follow that t(n, k) is a proper term?
114 Let m be a positive integer, and dene the sequence c(m)
n
by the recur-
rence
X
k
¬µn
k
¬∂m¬µn + k
k
¬∂m
=
X
k
¬µn
k
¬∂¬µn + k
k
¬∂
c(m)
k
.
Are these numbers c(m)
n
integers?

6
Special Numbers
SOME SEQUENCES of numbers arise so often in mathematics that we rec-
ognize them instantly and give them special names. For example, everybody
who learns arithmetic knows the sequence of square numbers ‚ü®1, 4, 9, 16, . . . ‚ü©.
In Chapter 1 we encountered the triangular numbers ‚ü®1, 3, 6, 10, . . . ‚ü©; in Chap-
ter 4 we studied the prime numbers ‚ü®2, 3, 5, 7, . . . ‚ü©; in Chapter 5 we looked
briey at the Catalan numbers ‚ü®1, 2, 5, 14, . . . ‚ü©.
In the present chapter we'll get to know a few other important sequences.
First on our agenda will be the Stirling numbers
¬©n
k
¬™
and
¬£n
k
¬§
, and the Eulerian
numbers
¬≠n
k
¬Æ
; these form triangular patterns of coecients analogous to the
binomial coecients
¬°n
k
¬¢
in Pascal's triangle. Then we'll take a good look
at the harmonic numbers Hn, and the Bernoulli numbers Bn; these dier
from the other sequences we've been studying because they're fractions, not
integers. Finally, we'll examine the fascinating Fibonacci numbers Fn and
some of their important generalizations.
6.1
STIRLING NUMBERS
We begin with some close relatives of the binomial coecients, the
Stirling numbers, named after James Stirling (1692{1770). These numbers
come in two avors, traditionally called by the no-frills names \Stirling num-
bers of the rst and second kind." Although they have a venerable history
and numerous applications, they still lack a standard notation. Following Jo-
van Karamata, we will write
¬©n
k
¬™
for Stirling numbers of the second kind and
\. . . par cette nota-
tion, les formules
deviennent plus
symetriques."
|J. Karamata [199]
¬£n
k
¬§
for Stirling numbers of the rst kind; these symbols turn out to be more
user-friendly than the many other notations that people have tried.
Tables 258 and 259 show what
¬©n
k
¬™
and
¬£n
k
¬§
look like when n and k are
small. A problem that involves the numbers \1, 7, 6, 1" is likely to be related
to
¬©n
k
¬™
, and a problem that involves \6, 11, 6, 1" is likely to be related to
¬£n
k
¬§
, just as we assume that a problem involving \1, 4, 6, 4, 1" is likely to be
related to
¬°n
k
¬¢
; these are the trademark sequences that appear when n = 4.
257

258 SPECIAL NUMBERS
Table 258 Stirling's triangle for subsets.
n
¬Øn
0
¬∞ ¬Øn
1
¬∞
¬Øn
2
¬∞
¬Øn
3
¬∞
¬Øn
4
¬∞
¬Øn
5
¬∞
¬Øn
6
¬∞
¬Øn
7
¬∞ ¬Øn
8
¬∞ ¬Øn
9
¬∞
0
1
1
0
1
2
0
1
1
3
0
1
3
1
4
0
1
7
6
1
5
0
1
15
25
10
1
6
0
1
31
90
65
15
1
7
0
1
63
301
350
140
21
1
8
0
1
127
966
1701
1050
266
28
1
9
0
1
255
3025
7770
6951
2646
462
36
1
Stirling numbers of the second kind show up more often than those of
the other variety, so let's consider last things rst. The symbol
¬©n
k
¬™
stands
(Stirling himself
considered this
kind rst in his
book [343].)
for the number of ways to partition a set of n things into k nonempty subsets.
For example, there are seven ways to split a four-element set into two parts:
f1, 2, 3g ‚à™f4g ,
f1, 2, 4g ‚à™f3g ,
f1, 3, 4g ‚à™f2g ,
f2, 3, 4g ‚à™f1g ,
f1, 2g ‚à™f3, 4g ,
f1, 3g ‚à™f2, 4g ,
f1, 4g ‚à™f2, 3g ;
(6.1)
thus
¬©4
2
¬™
= 7. Notice that curly braces are used to denote sets as well as
the numbers
¬©n
k
¬™
. This notational kinship helps us remember the meaning of
¬©n
k
¬™
, which can be read \n subset k."
Let's look at small k. There's just one way to put n elements into a single
nonempty set; hence
¬©n
1
¬™
= 1, for all n > 0. On the other hand
¬©0
1
¬™
= 0,
because a 0-element set is empty.
The case k = 0 is a bit tricky. Things work out best if we agree that
there's just one way to partition an empty set into zero nonempty parts; hence
¬©0
0
¬™
= 1. But a nonempty set needs at least one part, so
¬©n
0
¬™
= 0 for n > 0.
What happens when k = 2? Certainly
¬©0
2
¬™
= 0. If a set of n > 0 objects
is divided into two nonempty parts, one of those parts contains the last object
and some subset of the rst n‚àí1 objects. There are 2n‚àí1 ways to choose the
latter subset, since each of the rst n ‚àí1 objects is either in it or out of it;
but we mustn't put all of those objects in it, because we want to end up with
two nonempty parts. Therefore we subtract 1:
¬Øn
2
¬∞
= 2n‚àí1 ‚àí1 ,
integer n > 0.
(6.2)
(This tallies with our enumeration of
¬©4
2
¬™
= 7 = 23 ‚àí1 ways above.)

6.1 STIRLING NUMBERS 259
Table 259 Stirling's triangle for cycles.
n
¬∑n
0
¬∏
¬∑n
1
¬∏
¬∑n
2
¬∏
¬∑n
3
¬∏
¬∑n
4
¬∏
¬∑n
5
¬∏
¬∑n
6
¬∏
¬∑n
7
¬∏ ¬∑n
8
¬∏ ¬∑n
9
¬∏
0
1
1
0
1
2
0
1
1
3
0
2
3
1
4
0
6
11
6
1
5
0
24
50
35
10
1
6
0
120
274
225
85
15
1
7
0
720
1764
1624
735
175
21
1
8
0
5040
13068
13132
6769
1960
322
28
1
9
0
40320
109584
118124
67284
22449
4536
546
36
1
A modication of this argument leads to a recurrence by which we can
compute
¬©n
k
¬™
for all k: Given a set of n > 0 objects to be partitioned into k
nonempty parts, we either put the last object into a class by itself (in
¬©n‚àí1
k‚àí1
¬™
ways), or we put it together with some nonempty subset of the rst n ‚àí1
objects. There are k
¬©n‚àí1
k
¬™
possibilities in the latter case, because each of the
¬©n‚àí1
k
¬™
ways to distribute the rst n ‚àí1 objects into k nonempty parts gives
k subsets that the nth object can join. Hence
¬Øn
k
¬∞
= k
¬Øn ‚àí1
k
¬∞
+
¬Øn ‚àí1
k ‚àí1
¬∞
,
integer n > 0.
(6.3)
This is the law that generates Table 258; without the factor of k it would
reduce to the addition formula (5.8) that generates Pascal's triangle.
And now, Stirling numbers of the rst kind. These are somewhat like
the others, but
¬£n
k
¬§
counts the number of ways to arrange n objects into k
cycles instead of subsets. We verbalize `
¬£n
k
¬§
' by saying \n cycle k."
Cycles are cyclic arrangements, like the necklaces we considered in Chap-
ter 4. The cycle
¬©


¬™
A
B
C
D
can be written more compactly as `[A, B, C, D]', with the understanding that
[A, B, C, D] = [B, C, D, A] = [C, D, A, B] = [D, A, B, C] ;
a cycle \wraps around" because its end is joined to its beginning. On the other
hand, the cycle [A, B, C, D] is not the same as [A, B, D, C] or [D, C, B, A].

260 SPECIAL NUMBERS
There are eleven dierent ways to make two cycles from four elements:
\There are nine
and sixty ways
of constructing
tribal lays,
And-every-single-
one-of-them-is-
right."
|Rudyard Kipling
[1, 2, 3] [4] ,
[1, 2, 4] [3] ,
[1, 3, 4] [2] ,
[2, 3, 4] [1] ,
[1, 3, 2] [4] ,
[1, 4, 2] [3] ,
[1, 4, 3] [2] ,
[2, 4, 3] [1] ,
[1, 2] [3, 4] ,
[1, 3] [2, 4] ,
[1, 4] [2, 3] ;
(6.4)
hence
¬£4
2
¬§
= 11.
A singleton cycle (that is, a cycle with only one element) is essentially
the same as a singleton set (a set with only one element). Similarly, a 2-cycle
is like a 2-set, because we have [A, B] = [B, A] just as fA, Bg = fB, Ag. But
there are two dierent 3-cycles, [A, B, C] and [A, C, B]. Notice, for example,
that the eleven cycle pairs in (6.4) can be obtained from the seven set pairs
in (6.1) by making two cycles from each of the 3-element sets.
In general, n!/n = (n ‚àí1)! dierent n-cycles can be made from any n-
element set, whenever n > 0. (There are n! permutations, and each n-cycle
corresponds to n of them because any one of its elements can be listed rst.)
Therefore we have
¬∑n
1
¬∏
= (n ‚àí1)! ,
integer n > 0.
(6.5)
This is much larger than the value
¬©n
1
¬™
= 1 we had for Stirling subset numbers.
In fact, it is easy to see that the cycle numbers must be at least as large as
the subset numbers,
¬∑n
k
¬∏

¬Øn
k
¬∞
,
integers n, k  0,
(6.6)
because every partition into nonempty subsets leads to at least one arrange-
ment of cycles.
Equality holds in (6.6) when all the cycles are necessarily singletons or
doubletons, because cycles are equivalent to subsets in such cases. This hap-
pens when k = n and when k = n ‚àí1; hence
¬∑n
n
¬∏
=
¬Øn
n
¬∞
;
¬∑
n
n ‚àí1
¬∏
=
¬Ø
n
n ‚àí1
¬∞
.
In fact, it is easy to see that
¬∑n
n
¬∏
=
¬Øn
n
¬∞
= 1 ;
¬∑
n
n ‚àí1
¬∏
=
¬Ø
n
n ‚àí1
¬∞
=
¬µn
2
¬∂
.
(6.7)
(The number of ways to arrange n objects into n ‚àí1 cycles or subsets is the
number of ways to choose the two objects that will be in the same cycle or
subset.) The triangular numbers
¬°n
2
¬¢
= 1, 3, 6, 10, . . . are conspicuously
present in both Table 258 and Table 259.

6.1 STIRLING NUMBERS 261
We can derive a recurrence for
¬£n
k
¬§
by modifying the argument we used
for
¬©n
k
¬™
. Every arrangement of n objects in k cycles either puts the last object
into a cycle by itself (in
¬£n‚àí1
k‚àí1
¬§
ways) or inserts that object into one of the
¬£n‚àí1
k
¬§
cycle arrangements of the rst n ‚àí1 objects. In the latter case, there
are n ‚àí1 dierent ways to do the insertion. (This takes some thought, but
it's not hard to verify that there are j ways to put a new element into a j-cycle
in order to make a (j + 1)-cycle. When j = 3, for example, the cycle [A, B, C]
leads to
[A, B, C, D] ,
[A, B, D, C] ,
or
[A, D, B, C]
when we insert a new element D, and there are no other possibilities. Sum-
ming over all j gives a total of n ‚àí1 ways to insert an nth object into a cycle
decomposition of n ‚àí1 objects.) The desired recurrence is therefore
¬∑n
k
¬∏
= (n ‚àí1)
¬∑n ‚àí1
k
¬∏
+
¬∑n ‚àí1
k ‚àí1
¬∏
,
integer n > 0.
(6.8)
This is the addition-formula analog that generates Table 259.
Comparison of (6.8) and (6.3) shows that the rst term on the right side is
multiplied by its upper index (n‚àí1) in the case of Stirling cycle numbers, but
by its lower index k in the case of Stirling subset numbers. We can therefore
perform \absorption" in terms like n
¬£n
k
¬§
and k
¬©n
k
¬™
, when we do proofs by
mathematical induction.
Every permutation is equivalent to a set of cycles. For example, consider
the permutation that takes 123456789 into 384729156. We can conveniently
represent it in two rows,
1 2 3 4 5 6 7 8 9
3 8 4 7 2 9 1 5 6 ,
showing that 1 becomes 3 and 2 becomes 8, etc. The cycle structure comes
about because 1 becomes 3, which becomes 4, which becomes 7, which be-
comes the original element 1; that's the cycle [1, 3, 4, 7]. Another cycle in
this permutation is [2, 8, 5]; still another is [6, 9]. Therefore the permutation
384729156 is equivalent to the cycle arrangement
[1, 3, 4, 7] [2, 8, 5] [6, 9] .
If we have any permutation œÄ1œÄ2 . . . œÄn of f1, 2, . . . , ng, every element is in a
unique cycle. For if we start with m0 = m and look at m1 = œÄm0, m2 = œÄm1,
etc., we must eventually come back to mk = m0. (The numbers must repeat
sooner or later, and the rst number to reappear must be m0 because we
know the unique predecessors of the other numbers m1, m2, . . . , mk‚àí1.)

262 SPECIAL NUMBERS
Therefore every permutation denes a cycle arrangement. Conversely, every
cycle arrangement obviously denes a permutation if we reverse the construc-
tion, and this one-to-one correspondence shows that permutations and cycle
arrangements are essentially the same thing.
Therefore
¬£n
k
¬§
is the number of permutations of n objects that contain
exactly k cycles. If we sum
¬£n
k
¬§
over all k, we must get the total number of
permutations:
n
X
k=0
¬∑n
k
¬∏
= n! ,
integer n  0.
(6.9)
For example, 6 + 11 + 6 + 1 = 24 = 4!.
Stirling numbers are useful because the recurrence relations (6.3) and
(6.8) arise in a variety of problems. For example, if we want to represent
ordinary powers xn by falling powers xn, we nd that the rst few cases are
x0 = x0 ;
x1 = x1 ;
x2 = x2 + x1 ;
x3 = x3 + 3x2 + x1 ;
x4 = x4 + 6x3 + 7x2 + x1 .
These coecients look suspiciously like the numbers in Table 258, reected
between left and right; therefore we can be pretty condent that the general
formula is
We'd better dene
¬©n
k
¬™
=
ƒçn
k
ƒè
= 0
when k < 0 and
n  0.
xn =
X
k
¬Øn
k
¬∞
xk ,
integer n  0.
(6.10)
And sure enough, a simple proof by induction clinches the argument: We
have x¬∑xk = xk+1 + kxk, because xk+1 = xk(x ‚àík); hence x¬∑xn‚àí1 is
x
X
k
¬Øn ‚àí1
k
¬∞
xk =
X
k
¬Øn ‚àí1
k
¬∞
xk+1 +
X
k
¬Øn ‚àí1
k
¬∞
kxk
=
X
k
¬Øn ‚àí1
k ‚àí1
¬∞
xk +
X
k
¬Øn ‚àí1
k
¬∞
kxk
=
X
k
¬µ
k
¬Øn ‚àí1
k
¬∞
+
¬Øn ‚àí1
k ‚àí1
¬∞¬∂
xk =
X
k
¬Øn
k
¬∞
xk .
In other words, Stirling subset numbers are the coecients of factorial powers
that yield ordinary powers.

6.1 STIRLING NUMBERS 263
We can go the other way too, because Stirling cycle numbers are the
coecients of ordinary powers that yield factorial powers:
x0 = x0 ;
x1 = x1 ;
x2 = x2 + x1 ;
x3 = x3 + 3x2 + 2x1 ;
x4 = x4 + 6x3 + 11x2 + 6x1 .
We have (x + n ‚àí1)¬∑xk = xk+1 + (n ‚àí1)xk, so a proof like the one just given
shows that
(x + n ‚àí1)xn‚àí1 = (x + n ‚àí1)
X
k
¬∑n ‚àí1
k
¬∏
xk =
X
k
¬∑n
k
¬∏
xk .
This leads to a proof by induction of the general formula
xn =
X
k
¬∑n
k
¬∏
xk ,
integer n  0.
(6.11)
(Setting x = 1 gives (6.9) again.)
But wait, you say.
This equation involves rising factorial powers xn,
while (6.10) involves falling factorials xn. What if we want to express xn
in terms of ordinary powers, or if we want to express xn in terms of rising
powers? Easy; we just throw in some minus signs and get
xn =
X
k
¬Øn
k
¬∞
(‚àí1)n‚àíkxk ,
integer n  0;
(6.12)
xn =
X
k
¬∑n
k
¬∏
(‚àí1)n‚àíkxk ,
integer n  0.
(6.13)
This works because, for example, the formula
x4 = x(x ‚àí1)(x ‚àí2)(x ‚àí3) = x4 ‚àí6x3 + 11x2 ‚àí6x
is just like the formula
x4 = x(x + 1)(x + 2)(x + 3) = x4 + 6x3 + 11x2 + 6x
but with alternating signs. The general identity
xn = (‚àí1)n(‚àíx)n
(6.14)
of exercise 2.17 converts (6.10) to (6.12) and (6.11) to (6.13) if we negate x.

264 SPECIAL NUMBERS
Table 264 Basic Stirling number identities, for integer n  0.
Recurrences:
¬Øn
k
¬∞
= k
¬Øn ‚àí1
k
¬∞
+
¬Øn ‚àí1
k ‚àí1
¬∞
.
¬∑n
k
¬∏
= (n ‚àí1)
¬∑n ‚àí1
k
¬∏
+
¬∑n ‚àí1
k ‚àí1
¬∏
.
Special values:
¬Øn
0
¬∞
=
¬∑n
0
¬∏
= [n = 0] .
¬Øn
1
¬∞
= [n > 0] ;
¬∑n
1
¬∏
= (n ‚àí1)! [n > 0] .
¬Øn
2
¬∞
= (2n‚àí1 ‚àí1)[n > 0] ;
¬∑n
2
¬∏
= (n ‚àí1)! Hn‚àí1 [n > 0] .
¬Ø
n
n ‚àí1
¬∞
=
¬∑
n
n ‚àí1
¬∏
=
¬µn
2
¬∂
.
¬Øn
n
¬∞
=
¬∑n
n
¬∏
=
¬µn
n
¬∂
= 1 .
¬Øn
k
¬∞
=
¬∑n
k
¬∏
=
¬µn
k
¬∂
= 0 ,
if k > n.
Converting between powers:
xn =
X
k
¬Øn
k
¬∞
xk =
X
k
¬Øn
k
¬∞
(‚àí1)n‚àíkxk .
xn =
X
k
¬∑n
k
¬∏
(‚àí1)n‚àíkxk ;
xn =
X
k
¬∑n
k
¬∏
xk .
Inversion formulas:
X
k
¬∑n
k
¬∏¬Ø k
m
¬∞
(‚àí1)n‚àík = [m = n] ;
X
k
¬Øn
k
¬∞¬∑ k
m
¬∏
(‚àí1)n‚àík = [m = n] .

6.1 STIRLING NUMBERS 265
Table 265 Additional Stirling number identities, for integers l, m, n  0.
¬Øn + 1
m + 1
¬∞
=
X
k
¬µn
k
¬∂¬Ø k
m
¬∞
.
(6.15)
¬∑n + 1
m + 1
¬∏
=
X
k
¬∑n
k
¬∏¬µ k
m
¬∂
.
(6.16)
¬Øn
m
¬∞
=
X
k
¬µn
k
¬∂¬Ø k + 1
m + 1
¬∞
(‚àí1)n‚àík .
(6.17)
nm(‚àí1)n‚àímƒçn
m
ƒè
= P
k
ƒç n
k
ƒèƒÖ ‚àím
k‚àím
ƒá
nk .
¬∑ n
m
¬∏
=
X
k
¬∑n + 1
k + 1
¬∏¬µ k
m
¬∂
(‚àí1)m‚àík .
(6.18)
m!
¬Øn
m
¬∞
=
X
k
¬µm
k
¬∂
kn(‚àí1)m‚àík .
(6.19)
¬Øn + 1
m + 1
¬∞
=
n
X
k=0
¬Ø k
m
¬∞
(m + 1)n‚àík .
(6.20)
¬∑n + 1
m + 1
¬∏
=
n
X
k=0
¬∑ k
m
¬∏
nn‚àík = n!
n
X
k=0
¬∑ k
m
¬∏¬±
k! .
(6.21)
¬Øm + n + 1
m
¬∞
=
m
X
k=0
k
¬Øn + k
k
¬∞
.
(6.22)
¬∑m + n + 1
m
¬∏
=
m
X
k=0
(n + k)
¬∑n + k
k
¬∏
.
(6.23)
¬µn
m
¬∂
=
X
k
¬Øn + 1
k + 1
¬∞¬∑ k
m
¬∏
(‚àí1)m‚àík .
(6.24)
Also,
ƒÖn
m
ƒá
(n ‚àí1)n‚àím
= P
k
ƒç n
k
ƒè¬© k
m
¬™
,
a generalization
of (6.9).
nn‚àím [n  m] =
X
k
¬∑n + 1
k + 1
¬∏¬Ø k
m
¬∞
(‚àí1)m‚àík .
(6.25)
¬Ø
n
n ‚àím
¬∞
=
X
k
¬µm ‚àín
m + k
¬∂¬µm + n
n + k
¬∂¬∑m + k
k
¬∏
.
(6.26)
¬∑
n
n ‚àím
¬∏
=
X
k
¬µm ‚àín
m + k
¬∂¬µm + n
n + k
¬∂¬Øm + k
k
¬∞
.
(6.27)
¬Ø
n
l + m
¬∞¬µl + m
l
¬∂
=
X
k
¬Øk
l
¬∞¬Øn ‚àík
m
¬∞¬µn
k
¬∂
.
(6.28)
¬∑
n
l + m
¬∏¬µl + m
l
¬∂
=
X
k
¬∑k
l
¬∏¬∑n ‚àík
m
¬∏¬µn
k
¬∂
.
(6.29)

266 SPECIAL NUMBERS
We can remember when to stick the (‚àí1)n‚àík factor into a formula like
(6.12) because there's a natural ordering of powers when x is large:
xn > xn > xn ,
for all x > n > 1.
(6.30)
The Stirling numbers
¬£n
k
¬§
and
¬©n
k
¬™
are nonnegative, so we have to use minus
signs when expanding a \small" power in terms of \large" ones.
We can plug (6.11) into (6.12) and get a double sum:
xn =
X
k
¬Øn
k
¬∞
(‚àí1)n‚àíkxk =
X
k,m
¬Øn
k
¬∞¬∑ k
m
¬∏
(‚àí1)n‚àíkxm .
This holds for all x, so the coecients of x0, x1, . . . , xn‚àí1, xn+1, xn+2, . . .
on the right must all be zero and we must have the identity
X
k
¬Øn
k
¬∞¬∑ k
m
¬∏
(‚àí1)n‚àík = [m = n] ,
integers m, n  0.
(6.31)
Stirling numbers, like binomial coecients, satisfy many surprising iden-
tities. But these identities aren't as versatile as the ones we had in Chapter 5,
so they aren't applied nearly as often. Therefore it's best for us just to list
the simplest ones, for future reference when a tough Stirling nut needs to be
cracked. Tables 264 and 265 contain the formulas that are most frequently
useful; the principal identities we have already derived are repeated there.
When we studied binomial coecients in Chapter 5, we found that it
was advantageous to dene
¬°n
k
¬¢
for negative n in such a way that the identity
¬°n
k
¬¢
=
¬°n‚àí1
k
¬¢
+
¬°n‚àí1
k‚àí1
¬¢
is valid without any restrictions. Using that identity to
extend the
¬°n
k
¬¢
's beyond those with combinatorial signicance, we discovered
(in Table 164) that Pascal's triangle essentially reproduces itself in a rotated
form when we extend it upward.
Let's try the same thing with Stirling's
triangles: What happens if we decide that the basic recurrences
¬Øn
k
¬∞
= k
¬Øn ‚àí1
k
¬∞
+
¬Øn ‚àí1
k ‚àí1
¬∞
¬∑n
k
¬∏
= (n ‚àí1)
¬∑n ‚àí1
k
¬∏
+
¬∑n ‚àí1
k ‚àí1
¬∏
are valid for all integers n and k? The solution becomes unique if we make
the reasonable additional stipulations that
¬Ø0
k
¬∞
=
¬∑0
k
¬∏
= [k = 0]
and
¬Øn
0
¬∞
=
¬∑n
0
¬∏
= [n = 0] .
(6.32)

6.1 STIRLING NUMBERS 267
Table 267 Stirling's triangles in tandem.
n
¬Ø n
‚àí5
¬∞ ¬Ø n
‚àí4
¬∞ ¬Ø n
‚àí3
¬∞ ¬Ø n
‚àí2
¬∞ ¬Ø n
‚àí1
¬∞ ¬Øn
0
¬∞ ¬Øn
1
¬∞ ¬Øn
2
¬∞ ¬Øn
3
¬∞ ¬Øn
4
¬∞ ¬Øn
5
¬∞
‚àí5
1
‚àí4
10
1
‚àí3
35
6
1
‚àí2
50
11
3
1
‚àí1
24
6
2
1
1
0
0
0
0
0
0
1
1
0
0
0
0
0
0
1
2
0
0
0
0
0
0
1
1
3
0
0
0
0
0
0
1
3
1
4
0
0
0
0
0
0
1
7
6
1
5
0
0
0
0
0
0
1
15
25
10
1
In fact, a surprisingly pretty pattern emerges: Stirling's triangle for cycles
appears above Stirling's triangle for subsets, and vice versa! The two kinds
of Stirling numbers are related by an extremely simple law [220, 221]:
¬∑n
k
¬∏
=
¬Ø‚àík
‚àín
¬∞
,
integers k, n.
(6.33)
We have \duality," something like the relations between min and max, between
‚åäx‚åãand ‚åàx‚åâ, between xn and xn, between gcd and lcm. It's easy to check that
both of the recurrences
¬£n
k
¬§
= (n‚àí1)
¬£n‚àí1
k
¬§
+
¬£n‚àí1
k‚àí1
¬§
and
¬©n
k
¬™
= k
¬©n‚àí1
k
¬™
+
¬©n‚àí1
k‚àí1
¬™
amount to the same thing, under this correspondence.
6.2
EULERIAN NUMBERS
Another triangle of values pops up now and again, this one due to
Euler [104, ¬ß13; 110, page 485], and we denote its elements by
¬≠n
k
¬Æ
.
The
angle brackets in this case suggest \less than" and \greater than" signs;
¬≠n
k
¬Æ
is the number of permutations œÄ1œÄ2 . . . œÄn of f1, 2, . . . , ng that have k ascents,
namely, k places where œÄj < œÄj+1. (Caution: This notation is less standard
than our notations
¬£n
k
¬§
,
¬©n
k
¬™
for Stirling numbers. But we'll see that it makes
(Knuth [209, rst
edition] used
≈ã n
k+1
≈ë
for
≈ãn
k
≈ë
.)
good sense.)
For example, eleven permutations of f1, 2, 3, 4g have two ascents:
1324 ,
1423 ,
2314 ,
2413 ,
3412 ;
1243 ,
1342 ,
2341 ;
2134 ,
3124 ,
4123 .
(The rst row lists the permutations with œÄ1 < œÄ2 > œÄ3 < œÄ4; the second row
lists those with œÄ1 < œÄ2 < œÄ3 > œÄ4 and œÄ1 > œÄ2 < œÄ3 < œÄ4.) Hence
¬≠4
2
¬Æ
= 11.

268 SPECIAL NUMBERS
Table 268 Euler's triangle.
n
¬øn
0
√Ä ¬øn
1
√Ä
¬øn
2
√Ä
¬øn
3
√Ä
¬øn
4
√Ä
¬øn
5
√Ä
¬øn
6
√Ä ¬øn
7
√Ä ¬øn
8
√Ä ¬øn
9
√Ä
0
1
1
1
0
2
1
1
0
3
1
4
1
0
4
1
11
11
1
0
5
1
26
66
26
1
0
6
1
57
302
302
57
1
0
7
1
120
1191
2416
1191
120
1
0
8
1
247
4293
15619
15619
4293
247
1
0
9
1
502
14608
88234
156190
88234
14608
502
1
0
Table 268 lists the smallest Eulerian numbers; notice that the trademark
sequence is 1, 11, 11, 1 this time. There can be at most n ‚àí1 ascents, when
n > 0, so we have
¬≠n
n
¬Æ
= [n = 0] on the diagonal of the triangle.
Euler's triangle, like Pascal's, is symmetric between left and right. But
in this case the symmetry law is slightly dierent:
¬øn
k
√Ä
=
¬ø
n
n ‚àí1 ‚àík
√Ä
,
integer n > 0;
(6.34)
The permutation œÄ1œÄ2 . . . œÄn has n‚àí1‚àík ascents if and only if its \reection"
œÄn . . . œÄ2œÄ1 has k ascents.
Let's try to nd a recurrence for
¬≠n
k
¬Æ
. Each permutation œÅ = œÅ1 . . . œÅn‚àí1
of f1, . . . , n ‚àí1g leads to n permutations of f1, 2, . . . , ng if we insert the new
element n in all possible ways. Suppose we put n in position j, obtaining the
permutation œÄ = œÅ1 . . . œÅj‚àí1 n œÅj . . . œÅn‚àí1. The number of ascents in œÄ is the
same as the number in œÅ, if j = 1 or if œÅj‚àí1 < œÅj; it's one greater than the
number in œÅ, if œÅj‚àí1 > œÅj or if j = n. Therefore œÄ has k ascents in a total
of (k + 1)
¬≠n‚àí1
k
¬Æ
ways from permutations œÅ that have k ascents, plus a total
of
¬°
(n ‚àí2) ‚àí(k ‚àí1) + 1
¬¢¬≠n‚àí1
k‚àí1
¬Æ
ways from permutations œÅ that have k ‚àí1
ascents. The desired recurrence is
¬øn
k
√Ä
= (k + 1)
¬øn ‚àí1
k
√Ä
+ (n ‚àík)
¬øn ‚àí1
k ‚àí1
√Ä
,
integer n > 0.
(6.35)
Once again we start the recurrence o by setting
¬ø0
k
√Ä
= [k = 0] ,
integer k,
(6.36)
and we will assume that
¬≠n
k
¬Æ
= 0 when k < 0.

6.2 EULERIAN NUMBERS 269
Eulerian numbers are useful primarily because they provide an unusual
connection between ordinary powers and consecutive binomial coecients:
xn =
X
k
¬øn
k
√Ä¬µx + k
n
¬∂
,
integer n  0.
(6.37)
(This is called \Worpitzky's identity" [378].) For example, we have
Western schol-
ars have recently
learned of a sig-
nicant Chinese
book by Li Shan-
Lan [249; 265, pages
320{325], published
in 1867, which
contains the rst
known appearance
of formula (6.37).
x2 =
¬µx
2
¬∂
+
¬µx+1
2
¬∂
,
x3 =
¬µx
3
¬∂
+4
¬µx+1
3
¬∂
+
¬µx+2
3
¬∂
,
x4 =
¬µx
4
¬∂
+11
¬µx+1
4
¬∂
+11
¬µx+2
4
¬∂
+
¬µx+3
4
¬∂
,
and so on. It's easy to prove (6.37) by induction (exercise 14).
Incidentally, (6.37) gives us yet another way to obtain the sum of the
rst n squares: We have k2 =
¬≠2
0
¬Æ¬°k
2
¬¢
+
¬≠2
1
¬Æ¬°k+1
2
¬¢
=
¬°k
2
¬¢
+
¬°k+1
2
¬¢
, hence
12 + 22 + ¬∑ ¬∑ ¬∑ + n2 =
¬°¬°1
2
¬¢
+
¬°2
2
¬¢
+ ¬∑ ¬∑ ¬∑ +
¬°n
2
¬¢¬¢
+
¬°¬°2
2
¬¢
+
¬°3
2
¬¢
+ ¬∑ ¬∑ ¬∑ +
¬°n+1
2
¬¢¬¢
=
¬°n+1
3
¬¢
+
¬°n+2
3
¬¢
=
1
6(n + 1)n
¬°
(n ‚àí1) + (n + 2)
¬¢
.
The Eulerian recurrence (6.35) is a bit more complicated than the Stirling
recurrences (6.3) and (6.8), so we don't expect the numbers
¬≠n
k
¬Æ
to satisfy as
many simple identities. Still, there are a few:
¬øn
m
√Ä
=
m
X
k=0
¬µn + 1
k
¬∂
(m + 1 ‚àík)n(‚àí1)k ;
(6.38)
m!
¬Øn
m
¬∞
=
X
k
¬øn
k
√Ä¬µ
k
n ‚àím
¬∂
;
(6.39)
¬øn
m
√Ä
=
X
k
¬Øn
k
¬∞¬µn ‚àík
m
¬∂
(‚àí1)n‚àík‚àím k! .
(6.40)
If we multiply (6.39) by zn‚àím and sum on m, we get P
m
¬©n
m
¬™
m! zn‚àím =
P
k
¬≠n
k
¬Æ
(z + 1)k. Replacing z by z ‚àí1 and equating coecients of zk gives
(6.40). Thus the last two of these identities are essentially equivalent. The
rst identity, (6.38), gives us special values when m is small:
¬øn
0
√Ä
= 1 ;
¬øn
1
√Ä
= 2n‚àín‚àí1 ;
¬øn
2
√Ä
= 3n‚àí(n+1)2n+
¬µn+1
2
¬∂
.

270 SPECIAL NUMBERS
Table 270 Second-order Eulerian triangle.
n
¬ø¬øn
0
√Ä√Ä ¬ø¬øn
1
√Ä√Ä ¬ø¬øn
2
√Ä√Ä
¬ø¬øn
3
√Ä√Ä
¬ø¬øn
4
√Ä√Ä
¬ø¬øn
5
√Ä√Ä ¬ø¬øn
6
√Ä√Ä ¬ø¬øn
7
√Ä√Ä ¬ø¬øn
8
√Ä√Ä
0
1
1
1
0
2
1
2
0
3
1
8
6
0
4
1
22
58
24
0
5
1
52
328
444
120
0
6
1
114
1452
4400
3708
720
0
7
1
240
5610
32120
58140
33984
5040
0
8
1
494
19950
195800
644020
785304
341136
40320
0
We needn't dwell further on Eulerian numbers here; it's usually sucient
simply to know that they exist, and to have a list of basic identities to fall
back on when the need arises. However, before we leave this topic, we should
take note of yet another triangular pattern of coecients, shown in Table 270.
We call these \second-order Eulerian numbers"
¬≠¬≠n
k
¬Æ¬Æ
, because they satisfy a
recurrence similar to (6.35) but with n replaced by 2n ‚àí1 in one place:
¬ø¬øn
k
√Ä√Ä
= (k + 1)
¬ø¬øn ‚àí1
k
√Ä√Ä
+ (2n ‚àí1 ‚àík)
¬ø¬øn ‚àí1
k ‚àí1
√Ä√Ä
.
(6.41)
These numbers have a curious combinatorial interpretation, rst noticed by
Gessel and Stanley [147]: If we form permutations of the multiset f1, 1, 2, 2,
. . . , n, ng with the special property that all numbers between the two occur-
rences of m are greater than m, for 1  m  n, then
¬≠¬≠n
k
¬Æ¬Æ
is the number of
such permutations that have k ascents. For example, there are eight suitable
single-ascent permutations of f1, 1, 2, 2, 3, 3g:
113322, 133221, 221331, 221133, 223311, 233211, 331122, 331221.
Thus
¬≠¬≠3
1
¬Æ¬Æ
= 8. The multiset f1, 1, 2, 2, . . . , n, ng has a total of
X
k
¬ø¬øn
k
√Ä√Ä
= (2n ‚àí1)(2n ‚àí3) . . . (1) = (2n)n
2n
(6.42)
suitable permutations, because the two appearances of n must be adjacent
and there are 2n ‚àí1 places to insert them within a permutation for n ‚àí1.
For example, when n = 3 the permutation 1221 has ve insertion points,
yielding 331221, 133221, 123321, 122331, and 122133. Recurrence (6.41) can
be proved by extending the argument we used for ordinary Eulerian numbers.

6.2 EULERIAN NUMBERS 271
Second-order Eulerian numbers are important chiey because of their
connection with Stirling numbers [148]: We have, by induction on n,
¬Ø
x
x ‚àín
¬∞
=
X
k
¬ø¬øn
k
√Ä√Ä¬µx + n ‚àí1 ‚àík
2n
¬∂
,
integer n  0;
(6.43)
¬∑
x
x ‚àín
¬∏
=
X
k
¬ø¬øn
k
√Ä√Ä¬µx + k
2n
¬∂
,
integer n  0.
(6.44)
For example,
¬Ø x
x‚àí1
¬∞
=
¬µx
2
¬∂
,
¬∑ x
x‚àí1
¬∏
=
¬µx
2
¬∂
;
¬Ø x
x‚àí2
¬∞
=
¬µx+1
4
¬∂
+ 2
¬µx
4
¬∂
,
¬∑ x
x‚àí2
¬∏
=
¬µx
4
¬∂
+ 2
¬µx+1
4
¬∂
;
¬Ø x
x‚àí3
¬∞
=
¬µx+2
6
¬∂
+ 8
¬µx+1
6
¬∂
+ 6
¬µx
6
¬∂
,
¬∑ x
x‚àí3
¬∏
=
¬µx
6
¬∂
+ 8
¬µx+1
6
¬∂
+ 6
¬µx+2
6
¬∂
.
(We already encountered the case n = 1 in (6.7).)
These identities hold
whenever x is an integer and n is a nonnegative integer. Since the right-hand
sides are polynomials in x, we can use (6.43) and (6.44) to dene Stirling
numbers
¬©
x
x‚àín
¬™
and
¬£
x
x‚àín
¬§
for arbitrary real (or complex) values of x.
If n > 0, these polynomials
¬©
x
x‚àín
¬™
and
¬£
x
x‚àín
¬§
are zero when x = 0, x = 1,
. . . , and x = n; therefore they are divisible by (x‚àí0), (x‚àí1), . . . , and (x‚àín).
It's interesting to look at what's left after these known factors are divided out.
We dene the Stirling polynomials œÉn(x) by the rule
œÉn(x) =
¬∑
x
x ‚àín
¬∏ ¬± ¬°
x(x ‚àí1) . . . (x ‚àín)
¬¢
.
(6.45)
(The degree of œÉn(x) is n ‚àí1.) The rst few cases are
So 1/x is a
polynomial?
(Sorry about that.)
œÉ0(x) = 1/x ;
œÉ1(x) = 1/2 ;
œÉ2(x) = (3x ‚àí1)/24 ;
œÉ3(x) = (x2 ‚àíx)/48 ;
œÉ4(x) = (15x3 ‚àí30x2 + 5x + 2)/5760 .
They can be computed via the second-order Eulerian numbers; for example,
œÉ3(x) =
¬°
(x‚àí4)(x‚àí5) + 8(x‚àí4)(x+1) + 6(x+2)(x+1)
¬¢
/6! .

272 SPECIAL NUMBERS
Table 272 Stirling convolution formulas.
rs
n
X
k=0
œÉk(r + tk) œÉn‚àík(s + t(n ‚àík)) = (r + s)œÉn(r + s + tn)
(6.46)
s
n
X
k=0
kœÉk(r + tk) œÉn‚àík(s + t(n ‚àík)) = nœÉn(r + s + tn)
(6.47)
¬Øn
m
¬∞
= (‚àí1)n‚àím+1
n!
(m ‚àí1)!œÉn‚àím(‚àím)
(6.48)
¬∑ n
m
¬∏
=
n!
(m ‚àí1)!œÉn‚àím(n)
(6.49)
It turns out that these polynomials satisfy two very pretty identities:
¬µ zez
ez ‚àí1
¬∂x
= x
X
n0
œÉn(x) zn ;
(6.50)
¬µ1
z ln
1
1 ‚àíz
¬∂x
= x
X
n0
œÉn(x + n) zn .
(6.51)
And in general, if St(z) is the power series that satises
ln
¬°
1 ‚àízSt(z)t‚àí1¬¢
= ‚àízSt(z)t ,
(6.52)
then
St(z)x = x
X
n0
œÉn(x + tn) zn .
(6.53)
Therefore we can obtain general convolution formulas for Stirling numbers, as
we did for binomial coecients in Table 202; the results appear in Table 272.
When a sum of Stirling numbers doesn't t the identities of Table 264 or 265,
Table 272 may be just the ticket. (An example appears later in this chapter,
following equation (6.100). Exercise 7.19 discusses the general principles of
convolutions based on identities like (6.50) and (6.53).)
6.3
HARMONIC NUMBERS
It's time now to take a closer look at harmonic numbers, which we
rst met back in Chapter 2:
Hn = 1 + 1
2 + 1
3 + ¬∑ ¬∑ ¬∑ + 1
n =
n
X
k=1
1
k ,
integer n  0.
(6.54)

6.3 HARMONIC NUMBERS 273
These numbers appear so often in the analysis of algorithms that computer
scientists need a special notation for them. We use Hn, the `H' standing for
\harmonic," since a tone of wavelength 1/n is called the nth harmonic of a
tone whose wavelength is 1. The rst few values look like this:
n
0
1
2
3
4
5
6
7
8
9
10
Hn
0
1
3
2
11
6
25
12
137
60
49
20
363
140
761
280
7129
2520
7381
2520
Exercise 21 shows that Hn is never an integer when n > 1.
Here's a card trick, based on an idea by R. T. Sharp [325], that illustrates
how the harmonic numbers arise naturally in simple situations. Given n cards
and a table, we'd like to create the largest possible overhang by stacking the
cards up over the table's edge, subject to the laws of gravity:
This must be
Table 273.
XX
z
card 1
XX
z
card 2
XX
z
card n

-
d2

-
d3

-
dn+1
table
To dene the problem a bit more, we require the edges of the cards to be
parallel to the edge of the table; otherwise we could increase the overhang by
rotating the cards so that their corners stick out a little farther. And to make
the answer simpler, we assume that each card is 2 units long.
With one card, we get maximum overhang when its center of gravity is
just above the edge of the table. The center of gravity is in the middle of the
card, so we can create half a cardlength, or 1 unit, of overhang.
With two cards, it's not hard to convince ourselves that we get maximum
overhang when the center of gravity of the top card is just above the edge
of the second card, and the center of gravity of both cards combined is just
above the edge of the table. The joint center of gravity of two cards will be
in the middle of their common part, so we are able to achieve an additional
half unit of overhang.
This pattern suggests a general method, where we place cards so that the
center of gravity of the top k cards lies just above the edge of the k+1st card
(which supports those top k). The table plays the role of the n+1st card. To
express this condition algebraically, we can let dk be the distance from the
extreme edge of the top card to the corresponding edge of the kth card from
the top. Then d1 = 0, and we want to make dk+1 the center of gravity of the
rst k cards:
dk+1 = (d1 + 1) + (d2 + 1) + ¬∑ ¬∑ ¬∑ + (dk + 1)
k
,
for 1  k  n.
(6.55)

274 SPECIAL NUMBERS
(The center of gravity of k objects, having respective weights w1, . . . , wk
and having respective centers of gravity at positions p1, . . . pk, is at position
(w1p1 + ¬∑ ¬∑ ¬∑ + wkpk)/(w1 + ¬∑ ¬∑ ¬∑ + wk).) We can rewrite this recurrence in two
equivalent forms
kdk+1 = k + d1 + ¬∑ ¬∑ ¬∑ + dk‚àí1 + dk ,
k  0;
(k ‚àí1)dk = k ‚àí1 + d1 + ¬∑ ¬∑ ¬∑ + dk‚àí1 ,
k  1.
Subtracting these equations tells us that
kdk+1 ‚àí(k ‚àí1)dk = 1 + dk ,
k  1;
hence dk+1 = dk + 1/k. The second card will be oset half a unit past the
third, which is a third of a unit past the fourth, and so on.
The general
formula
dk+1 = Hk
(6.56)
follows by induction, and if we set k = n we get dn+1 = Hn as the total
overhang when n cards are stacked as described.
Could we achieve greater overhang by holding back, not pushing each
card to an extreme position but storing up \potential gravitational energy"
for a later advance? No; any well-balanced card placement has
dk+1  (1 + d1) + (1 + d2) + ¬∑ ¬∑ ¬∑ + (1 + dk)
k
,
1  k  n.
Furthermore d1 = 0. It follows by induction that dk+1  Hk.
Notice that it doesn't take too many cards for the top one to be com-
pletely past the edge of the table. We need an overhang of more than one
cardlength, which is 2 units.
The rst harmonic number to exceed 2 is
H4 = 25
12, so we need only four cards.
And with 52 cards we have an H52-unit overhang, which turns out to be
Anyone who actu-
ally tries to achieve
this maximum
overhang with 52
cards is probably
not dealing with
a full deck|or
maybe he's a real
joker.
H52/2 ‚âà2.27 cardlengths. (We will soon learn a formula that tells us how to
compute an approximate value of Hn for large n without adding up a whole
bunch of fractions.)
An amusing problem called the \worm on the rubber band" shows har-
monic numbers in another guise. A slow but persistent worm, W, starts at
one end of a meter-long rubber band and crawls one centimeter per minute
toward the other end. At the end of each minute, an equally persistent keeper
of the band, K, whose sole purpose in life is to frustrate W, stretches it one
meter. Thus after one minute of crawling, W is 1 centimeter from the start
and 99 from the nish; then K stretches it one meter. During the stretching
operation W maintains his relative position, 1% from the start and 99% from

6.3 HARMONIC NUMBERS 275
the nish; so W is now 2 cm from the starting point and 198 cm from the
goal. After W crawls for another minute the score is 3 cm traveled and 197
to go; but K stretches, and the distances become 4.5 and 295.5. And so on.
Does the worm ever reach the nish? He keeps moving, but the goal seems to
Metric units make
this problem more
scientic.
move away even faster. (We're assuming an innite longevity for K and W,
an innite elasticity of the band, and an innitely tiny worm.)
Let's write down some formulas. When K stretches the rubber band, the
fraction of it that W has crawled stays the same. Thus he crawls 1/100th of
it the rst minute, 1/200th the second, 1/300th the third, and so on. After
n minutes the fraction of the band that he's crawled is
1
100
¬µ1
1 + 1
2 + 1
3 + ¬∑ ¬∑ ¬∑ + 1
n
¬∂
= Hn
100 .
(6.57)
So he reaches the nish if Hn ever surpasses 100.
We'll see how to estimate Hn for large n soon; for now, let's simply
check our analysis by considering how \Superworm" would perform in the
same situation. Superworm, unlike W, can crawl 50 cm per minute; so she
will crawl Hn/2 of the band length after n minutes, according to the argument
we just gave. If our reasoning is correct, Superworm should nish before n
reaches 4, since H4 > 2. And yes, a simple calculation shows that Superworm
has only 33 1
3 cm left to travel after three minutes have elapsed. She nishes
in 3 minutes and 40 seconds at.
A atworm, eh?
Harmonic numbers appear also in Stirling's triangle. Let's try to nd
a closed form for
¬£n
2
¬§
, the number of permutations of n objects that have
exactly two cycles. Recurrence (6.8) tells us that
¬∑n + 1
2
¬∏
= n
¬∑n
2
¬∏
+
¬∑n
1
¬∏
= n
¬∑n
2
¬∏
+ (n ‚àí1)! ,
if n > 0;
and this recurrence is a natural candidate for the summation factor technique
of Chapter 2:
1
n!
¬∑n + 1
2
¬∏
=
1
(n ‚àí1)!
¬∑n
2
¬∏
+ 1
n .
Unfolding this recurrence tells us that
1
n!
¬£n+1
2
¬§
= Hn; hence
¬∑n + 1
2
¬∏
= n!Hn .
(6.58)
We proved in Chapter 2 that the harmonic series P
k 1/k diverges, which
means that Hn gets arbitrarily large as n ‚Üí‚àû. But our proof was indirect;

276 SPECIAL NUMBERS
we found that a certain innite sum (2.58) gave dierent answers when it was
rearranged, hence P
k 1/k could not be bounded. The fact that Hn ‚Üí‚àû
seems counter-intuitive, because it implies among other things that a large
enough stack of cards will overhang a table by a mile or more, and that the
worm W will eventually reach the end of his rope. Let us therefore take a
closer look at the size of Hn when n is large.
The simplest way to see that Hn ‚Üí‚àûis probably to group its terms
according to powers of 2.
We put one term into group 1, two terms into
group 2, four into group 3, eight into group 4, and so on:
1
1
|{z}
group 1
+ 1
2+1
3
| {z }
group 2
+ 1
4+1
5+1
6+1
7
|
{z
}
group 3
+ 1
8+1
9+ 1
10+ 1
11+ 1
12+ 1
13+ 1
14+ 1
15
|
{z
}
group 4
+ ¬∑ ¬∑ ¬∑ .
Both terms in group 2 are between
1
4 and
1
2, so the sum of that group is
between 2 ¬∑ 1
4 = 1
2 and 2 ¬∑ 1
2 = 1. All four terms in group 3 are between 1
8
and 1
4, so their sum is also between 1
2 and 1. In fact, each of the 2k‚àí1 terms
in group k is between 2‚àík and 21‚àík; hence the sum of each individual group
is between 1
2 and 1.
This grouping procedure tells us that if n is in group k, we must have
Hn > k/2 and Hn  k (by induction on k). Thus Hn ‚Üí‚àû, and in fact
‚åälg n‚åã+ 1
2
< Hn  ‚åälg n‚åã+ 1 .
(6.59)
We now know Hn within a factor of 2.
Although the harmonic numbers
approach innity, they approach it only logarithmically | that is, quite slowly.
We should call them
the worm numbers,
they're so slow.
Better bounds can be found with just a little more work and a dose
of calculus. We learned in Chapter 2 that Hn is the discrete analog of the
continuous function ln n. The natural logarithm is dened as the area under
a curve, so a geometric comparison is suggested:
6
-
f(x)
x
0
1
2
3
. . .
n
n+1
f(x) = 1/x
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
The area under the curve between 1 and n, which is
Rn
1 dx/x = ln n, is less
than the area of the n rectangles, which is Pn
k=1 1/k = Hn. Thus ln n < Hn;
this is a sharper result than we had in (6.59). And by placing the rectangles

6.3 HARMONIC NUMBERS 277
a little dierently, we get a similar upper bound:
\I now see a way too
how y e aggregate
of y e termes of
Musicall progres-
sions may bee found
(much after y e
same manner) by
Logarithms, but
y e calculations for
nding out those
rules would bee still
more troublesom."
|I. Newton [280]
6
-
f(x)
x
0
1
2
3
. . .
n
f(x) = 1/x
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
This time the area of the n rectangles, Hn, is less than the area of the rst
rectangle plus the area under the curve. We have proved that
ln n < Hn < ln n + 1 ,
for n > 1.
(6.60)
We now know the value of Hn with an error of at most 1.
\Second order" harmonic numbers H(2)
n
arise when we sum the squares
of the reciprocals, instead of summing simply the reciprocals:
H(2)
n
= 1 + 1
4 + 1
9 + ¬∑ ¬∑ ¬∑ + 1
n2 =
n
X
k=1
1
k2 .
Similarly, we dene harmonic numbers of order r by summing (‚àír)th powers:
H(r)
n
=
n
X
k=1
1
kr .
(6.61)
If r > 1, these numbers approach a limit as n ‚Üí‚àû; we noted in exercise 2.31
that this limit is conventionally called Riemann's zeta function:
Œ∂(r) = H(r)
‚àû
=
X
k1
1
kr .
(6.62)
Euler [103] discovered a neat way to use generalized harmonic numbers
to approximate the ordinary ones, H(1)
n . Let's consider the innite series
ln
¬µ
k
k ‚àí1
¬∂
= 1
k +
1
2k2 +
1
3k3 +
1
4k4 + ¬∑ ¬∑ ¬∑ ,
(6.63)
which converges when k > 1. The left-hand side is ln k ‚àíln(k ‚àí1); therefore
if we sum both sides for 2  k  n the left-hand sum telescopes and we get
ln n ‚àíln 1 =
n
X
k=2
¬µ1
k +
1
2k2 +
1
3k3 +
1
4k4 + ¬∑ ¬∑ ¬∑
¬∂
=
¬°
Hn‚àí1
¬¢
+ 1
2
¬°
H(2)
n ‚àí1
¬¢
+ 1
3
¬°
H(3)
n ‚àí1
¬¢
+ 1
4
¬°
H(4)
n ‚àí1
¬¢
+ ¬∑ ¬∑ ¬∑ .

278 SPECIAL NUMBERS
Rearranging, we have an expression for the dierence between Hn and ln n:
Hn ‚àíln n = 1 ‚àí1
2
¬°
H(2)
n ‚àí1
¬¢
‚àí1
3
¬°
H(3)
n ‚àí1
¬¢
‚àí1
4
¬°
H(4)
n ‚àí1
¬¢
‚àí¬∑ ¬∑ ¬∑ .
When n ‚Üí‚àû, the right-hand side approaches the limiting value
1 ‚àí1
2
¬°
Œ∂(2)‚àí1
¬¢
‚àí1
3
¬°
Œ∂(3)‚àí1
¬¢
‚àí1
4
¬°
Œ∂(4)‚àí1
¬¢
‚àí¬∑ ¬∑ ¬∑ ,
which is now known as Euler's constant and conventionally denoted by the
Greek letter Œ≥. In fact, Œ∂(r) ‚àí1 is approximately 1/2r, so this innite series
\Huius igitur quan-
titatis constantis
C valorem detex-
imus, quippe est
C = 0, 577218."
|L. Euler [103]
converges rather rapidly and we can compute the decimal value
Œ≥ = 0.5772156649 . . . .
(6.64)
Euler's argument establishes the limiting relation
lim
n‚Üí‚àû(Hn ‚àíln n) = Œ≥ ;
(6.65)
thus Hn lies about 58% of the way between the two extremes in (6.60). We
are gradually homing in on its value.
Further renements are possible, as we will see in Chapter 9. We will
prove, for example, that
Hn = ln n + Œ≥ + 1
2n ‚àí
1
12n2 +
œµn
120n4 ,
0 < œµn < 1.
(6.66)
This formula allows us to conclude that the millionth harmonic number is
H1000000 ‚âà14.3927267228657236313811275 ,
without adding up a million fractions. Among other things, this implies that
a stack of a million cards can overhang the edge of a table by more than seven
cardlengths.
What does (6.66) tell us about the worm on the rubber band? Since Hn is
unbounded, the worm will denitely reach the end, when Hn rst exceeds 100.
Our approximation to Hn says that this will happen when n is approximately
e100‚àíŒ≥ ‚âàe99.423 .
In fact, exercise 9.49 proves that the critical value of n is either ‚åäe100‚àíŒ≥‚åãor
Well, they can't
really go at it this
long; the world will
have ended much
earlier, when the
Tower of Brahma is
fully transferred.
‚åàe100‚àíŒ≥‚åâ. We can imagine W's triumph when he crosses the nish line at
last, much to K's chagrin, some 287 decillion centuries after his long crawl
began. (The rubber band will have stretched to more than 1027 light years
long; its molecules will be pretty far apart.)

6.4 HARMONIC SUMMATION 279
6.4
HARMONIC SUMMATION
Now let's look at some sums involving harmonic numbers, starting
with a review of a few ideas we learned in Chapter 2. We proved in (2.36)
and (2.57) that
X
0k<n
Hk = nHn ‚àín ;
(6.67)
X
0k<n
kHk = n(n ‚àí1)
2
Hn
‚àí
n(n ‚àí1)
4
.
(6.68)
Let's be bold and take on a more general sum, which includes both of these
as special cases: What is the value of
X
0k<n
¬µ k
m
¬∂
Hk ,
when m is a nonnegative integer?
The approach that worked best for (6.67) and (6.68) in Chapter 2 was
called summation by parts. We wrote the summand in the form u(k)‚àÜv(k),
and we applied the general identity
Xb
a u(x)‚àÜv(x) Œ¥x = u(x)v(x)
¬Ø¬Øb
a
‚àí
Xb
a v(x + 1)‚àÜu(x) Œ¥x .
(6.69)
Remember? The sum that faces us now, P
0k<n
¬° k
m
¬¢
Hk, is a natural for this
method because we can let
u(k) = Hk ,
‚àÜu(k) = Hk+1 ‚àíHk =
1
k + 1 ;
v(k) =
¬µ
k
m+1
¬∂
,
‚àÜv(k) =
¬µ k+1
m+1
¬∂
‚àí
¬µ
k
m+1
¬∂
=
¬µ k
m
¬∂
.
(In other words, harmonic numbers have a simple ‚àÜand binomial coecients
have a simple ‚àÜ‚àí1, so we're in business.) Plugging into (6.69) yields
X
0k<n
¬µ k
m
¬∂
Hk =
Xn
0
¬µ x
m
¬∂
Hx Œ¥x =
¬µ
x
m+1
¬∂
Hx
¬Ø¬Ø¬Ø¬Ø
n
0
‚àí
Xn
0
¬µ x+1
m+1
¬∂ Œ¥x
x+1
=
¬µ n
m+1
¬∂
Hn ‚àí
X
0k<n
¬µ k+1
m+1
¬∂ 1
k+1 .
The remaining sum is easy, since we can absorb the (k + 1)‚àí1 using our old
standby, equation (5.5):
X
0k<n
¬µ k + 1
m + 1
¬∂
1
k + 1 =
X
0k<n
¬µ k
m
¬∂
1
m + 1 =
¬µ
n
m + 1
¬∂
1
m + 1 .

280 SPECIAL NUMBERS
Thus we have the answer we seek:
X
0k<n
¬µ k
m
¬∂
Hk =
¬µ
n
m + 1
¬∂¬µ
Hn ‚àí
1
m + 1
¬∂
.
(6.70)
(This checks nicely with (6.67) and (6.68) when m = 0 and m = 1.)
The next example sum uses division instead of multiplication: Let us try
to evaluate
Sn =
n
X
k=1
Hk
k .
If we expand Hk by its denition, we obtain a double sum,
Sn =
X
1jkn
1
j ¬∑ k .
Now another method from Chapter 2 comes to our aid; equation (2.33) tells
us that
Sn = 1
2
√É¬µ n
X
k=1
1
k
¬∂2
+
n
X
k=1
1
k2
!
= 1
2
¬°
H2
n + H(2)
n
¬¢
.
(6.71)
It turns out that we could also have obtained this answer in another way if
we had tried to sum by parts (see exercise 26).
Now let's try our hands at a more dicult problem [354], which doesn't
submit to summation by parts:
Un =
X
k1
¬µn
k
¬∂(‚àí1)k‚àí1
k
(n ‚àík)n ,
integer n  1.
(This sum doesn't explicitly mention harmonic numbers either; but who
(Not to give the
answer away or
anything.)
knows when they might turn up?)
We will solve this problem in two ways, one by grinding out the answer
and the other by being clever and/or lucky. First, the grinder's approach. We
expand (n ‚àík)n by the binomial theorem, so that the troublesome k in the
denominator will combine with the numerator:
Un =
X
k1
¬µn
k
¬∂(‚àí1)k‚àí1
k
X
j
¬µn
j
¬∂
(‚àík)jnn‚àíj
=
X
j
¬µn
j
¬∂
(‚àí1)j‚àí1nn‚àíj X
k1
¬µn
k
¬∂
(‚àí1)kkj‚àí1 .
This isn't quite the mess it seems, because the kj‚àí1 in the inner sum is a
polynomial in k, and identity (5.40) tells us that we are simply taking the

6.4 HARMONIC SUMMATION 281
nth dierence of this polynomial. Almost; rst we must clean up a few things.
For one, kj‚àí1 isn't a polynomial if j = 0; so we will need to split o that term
and handle it separately. For another, we're missing the term k = 0 from the
formula for nth dierence; that term is nonzero when j = 1, so we had better
restore it (and subtract it out again). The result is
Un =
X
j1
¬µn
j
¬∂
(‚àí1)j‚àí1nn‚àíj X
k0
¬µn
k
¬∂
(‚àí1)kkj‚àí1
‚àí
X
j1
¬µn
j
¬∂
(‚àí1)j‚àí1nn‚àíj
¬µn
0
¬∂
0j‚àí1
‚àí
¬µn
0
¬∂
nn X
k1
¬µn
k
¬∂
(‚àí1)kk‚àí1 .
OK, now the top line (the only remaining double sum) is zero: It's the sum
of multiples of nth dierences of polynomials of degree less than n, and such
nth dierences are zero. The second line is zero except when j = 1, when it
equals ‚àínn. So the third line is the only residual diculty; we have reduced
the original problem to a much simpler sum:
Un = nn(Tn ‚àí1) ,
where Tn =
X
k1
¬µn
k
¬∂(‚àí1)k‚àí1
k
.
(6.72)
For example, U3 =
¬°3
1
¬¢ 8
1 ‚àí
¬°3
2
¬¢ 1
2 = 45
2 ; T3 =
¬°3
1
¬¢ 1
1 ‚àí
¬°3
2
¬¢ 1
2 +
¬°3
3
¬¢ 1
3 = 11
6 ; hence
U3 = 27(T3 ‚àí1) as claimed.
How can we evaluate Tn? One way is to replace
¬°n
k
¬¢
by
¬°n‚àí1
k
¬¢
+
¬°n‚àí1
k‚àí1
¬¢
,
obtaining a simple recurrence for Tn in terms of Tn‚àí1. But there's a more
instructive way: We had a similar formula in (5.41), namely
X
k
¬µn
k
¬∂(‚àí1)k
x + k
=
n!
x(x + 1) . . . (x + n) .
If we subtract out the term for k = 0 and set x = 0, we get ‚àíTn. So let's do it:
Tn =
¬µ1
x ‚àí
n!
x(x + 1) . . . (x + n)
¬∂ ¬Ø¬Ø¬Ø¬Ø
x=0
=
¬µ(x + 1) . . . (x + n) ‚àín!
x(x + 1) . . . (x + n)
¬∂ ¬Ø¬Ø¬Ø¬Ø
x=0
=
¬µxn¬£n+1
n+1
¬§
+ ¬∑ ¬∑ ¬∑ + x
¬£n+1
2
¬§
+
¬£n+1
1
¬§
‚àín!
x(x + 1) . . . (x + n)
¬∂ ¬Ø¬Ø¬Ø¬Ø
x=0
=
1
n!
¬∑n + 1
2
¬∏
.

282 SPECIAL NUMBERS
(We have used the expansion (6.11) of (x + 1) . . . (x + n) = xn+1/x; we can
divide x out of the numerator because
¬£n+1
1
¬§
= n!.) But we know from (6.58)
that
¬£n+1
2
¬§
= n! Hn; hence Tn = Hn, and we have the answer:
Un = nn(Hn ‚àí1) .
(6.73)
That's one approach. The other approach will be to try to evaluate a
much more general sum,
Un(x, y) =
X
k1
¬µn
k
¬∂(‚àí1)k‚àí1
k
(x + ky)n ,
integer n  0;
(6.74)
the value of the original Un will drop out as the special case Un(n, ‚àí1). (We
are encouraged to try for more generality because the previous derivation
\threw away" most of the details of the given problem; somehow those details
must be irrelevant, because the nth dierence wiped them away.)
We could replay the previous derivation with small changes and discover
the value of Un(x, y). Or we could replace (x + ky)n by (x + ky)n‚àí1(x + ky)
and then replace
¬°n
k
¬¢
by
¬°n‚àí1
k
¬¢
+
¬°n‚àí1
k‚àí1
¬¢
, leading to the recurrence
Un(x, y) = xUn‚àí1(x, y) + xn/n + yxn‚àí1 ;
(6.75)
this can readily be solved with a summation factor (exercise 5).
But it's easiest to use another trick that worked to our advantage in
Chapter 2: dierentiation. The derivative of Un(x, y) with respect to y brings
out a k that cancels with the k in the denominator, and the resulting sum is
trivial:
‚àÇ
‚àÇyUn(x, y) =
X
k1
¬µn
k
¬∂
(‚àí1)k‚àí1n(x + ky)n‚àí1
=
¬µn
0
¬∂
nxn‚àí1 ‚àí
X
k0
¬µn
k
¬∂
(‚àí1)kn(x + ky)n‚àí1 = nxn‚àí1 .
(Once again, the nth dierence of a polynomial of degree < n has vanished.)
We've proved that the derivative of Un(x, y) with respect to y is nxn‚àí1,
independent of y. In general, if f‚Ä≤(y) = c then f(y) = f(0) + cy; therefore we
must have Un(x, y) = Un(x, 0) + nxn‚àí1y.
The remaining task is to determine Un(x, 0). But Un(x, 0) is just xn
times the sum Tn = Hn we've already considered in (6.72); therefore the
general sum in (6.74) has the closed form
Un(x, y) = xnHn + nxn‚àí1y .
(6.76)
In particular, the solution to the original problem is Un(n, ‚àí1) = nn(Hn‚àí1).

6.5 BERNOULLI NUMBERS 283
6.5
BERNOULLI NUMBERS
The next important sequence of numbers on our agenda is named
after Jakob Bernoulli (1654{1705), who discovered curious relationships while
working out the formulas for sums of mth powers [26]. Let's write
Sm(n) = 0m + 1m + ¬∑ ¬∑ ¬∑ + (n ‚àí1)m =
n‚àí1
X
k=0
km =
Xn
0 xm Œ¥x . (6.77)
(Thus, when m > 0 we have Sm(n) = H(‚àím)
n‚àí1
in the notation of generalized
harmonic numbers.) Bernoulli looked at the following sequence of formulas
and spotted a pattern:
S0(n) =
n
S1(n) =
1
2n2 ‚àí1
2n
S2(n) =
1
3n3 ‚àí1
2n2 +
1
6n
S3(n) =
1
4n4 ‚àí1
2n3 +
1
4n2
S4(n) =
1
5n5 ‚àí1
2n4 +
1
3n3 ‚àí
1
30n
S5(n) =
1
6n6 ‚àí1
2n5 +
5
12n4 ‚àí
1
12n2
S6(n) =
1
7n7 ‚àí1
2n6 +
1
2n5 ‚àí
1
6n3 +
1
42n
S7(n) =
1
8n8 ‚àí1
2n7 +
7
12n6 ‚àí
7
24n4 +
1
12n2
S8(n) =
1
9n9 ‚àí1
2n8 +
2
3n7 ‚àí
7
15n5 +
2
9n3 ‚àí
1
30n
S9(n) =
1
10n10 ‚àí1
2n9 +
3
4n8 ‚àí
7
10n6 +
1
2n4 ‚àí
3
20n2
S10(n) =
1
11n11 ‚àí1
2n10 +
5
6n9 ‚àí
n7 +
n5 ‚àí
1
2n3 +
5
66n
Can you see it too? The coecient of nm+1 in Sm(n) is always 1/(m + 1).
The coecient of nm is always ‚àí1/2. The coecient of nm‚àí1 is always . . .
let's see . . . m/12. The coecient of nm‚àí2 is always zero. The coecient
of nm‚àí3 is always . . . let's see . . . hmmm . . . yes, it's ‚àím(m‚àí1)(m‚àí2)/720.
The coecient of nm‚àí4 is always zero. And it looks as if the pattern will
continue, with the coecient of nm‚àík always being some constant times mk.
That was Bernoulli's empirical discovery. (He did not give a proof.) In
modern notation we write the coecients in the form
Sm(n) =
1
m + 1
¬µ
B0 nm+1 +
¬µm + 1
1
¬∂
B1 nm + ¬∑ ¬∑ ¬∑ +
¬µm + 1
m
¬∂
Bm n
¬∂
=
1
m + 1
m
X
k=0
¬µm + 1
k
¬∂
Bk nm+1‚àík .
(6.78)

284 SPECIAL NUMBERS
Bernoulli numbers are dened by an implicit recurrence relation,
m
X
j=0
¬µm + 1
j
¬∂
Bj = [m = 0] ,
for all m  0.
(6.79)
For example,
¬°2
0
¬¢
B0 +
¬°2
1
¬¢
B1 = 0. The rst few values turn out to be
n
0
1
2
3
4
5
6
7
8
9
10
11
12
Bn
1
‚àí1
2
1
6
0
‚àí1
30
0
1
42
0
‚àí1
30
0
5
66
0
‚àí691
2730
(All conjectures about a simple closed form for Bn are wiped out by the
appearance of the strange fraction ‚àí691/2730.)
We can prove Bernoulli's formula (6.78) by induction on m, using the
perturbation method (one of the ways we found S2(n) =
n in Chapter 2):
Sm+1(n) + nm+1 =
n‚àí1
X
k=0
(k + 1)m+1
=
n‚àí1
X
k=0
m+1
X
j=0
¬µm + 1
j
¬∂
kj =
m+1
X
j=0
¬µm + 1
j
¬∂
Sj(n) .(6.80)
Let bSm(n) be the right-hand side of (6.78); we wish to show that Sm(n) =
bSm(n), assuming that Sj(n) = bSj(n) for 0  j < m. We begin as we did for
m = 2 in Chapter 2, subtracting Sm+1(n) from both sides of (6.80). Then we
expand each Sj(n) using (6.78), and regroup so that the coecients of powers
of n on the right-hand side are brought together and simplied:
nm+1 =
m
X
j=0
¬µm + 1
j
¬∂
Sj(n) =
m
X
j=0
¬µm + 1
j
¬∂
bSj(n) +
¬µm + 1
m
¬∂
‚àÜ
=
m
X
j=0
¬µm + 1
j
¬∂
1
j + 1
j
X
k=0
¬µj + 1
k
¬∂
Bknj+1‚àík + (m + 1) ‚àÜ
=
X
0kjm
¬µm + 1
j
¬∂¬µj + 1
k
¬∂ Bk
j + 1nj+1‚àík + (m + 1) ‚àÜ
=
X
0kjm
¬µm + 1
j
¬∂¬µj + 1
j ‚àík
¬∂Bj‚àík
j + 1 nk+1 + (m + 1) ‚àÜ
=
X
0kjm
¬µm + 1
j
¬∂¬µj + 1
k + 1
¬∂Bj‚àík
j + 1 nk+1 + (m + 1) ‚àÜ
=
X
0km
nk+1
k + 1
X
kjm
¬µm + 1
j
¬∂¬µj
k
¬∂
Bj‚àík + (m + 1) ‚àÜ

6.5 BERNOULLI NUMBERS 285
=
X
0km
nk+1
k + 1
¬µm + 1
k
¬∂ X
kjm
¬µm+1‚àík
j ‚àík
¬∂
Bj‚àík + (m + 1) ‚àÜ
=
X
0km
nk+1
k + 1
¬µm + 1
k
¬∂
X
0jm‚àík
¬µm+1‚àík
j
¬∂
Bj + (m + 1) ‚àÜ
=
X
0km
nk+1
k + 1
¬µm + 1
k
¬∂
[m ‚àík = 0] + (m + 1) ‚àÜ
= nm+1
m + 1
¬µm + 1
m
¬∂
+ (m + 1) ‚àÜ
= nm+1 + (m + 1) ‚àÜ,
where ‚àÜ= Sm(n) ‚àíbSm(n).
(This derivation is a good review of the standard manipulations we learned
in Chapter 5.) Thus ‚àÜ= 0 and Sm(n) = bSm(n), QED.
In Chapter 7 we'll use generating functions to obtain a much simpler
Here's some more
neat stu that
you'll probably
want to skim
through the rst
time.
|Friendly TA
?
Start
Skimming
proof of (6.78). The key idea will be to show that the Bernoulli numbers are
the coecients of the power series
z
ez ‚àí1 =
X
n0
Bn
zn
n! .
(6.81)
Let's simply assume for now that equation (6.81) holds, so that we can de-
rive some of its amazing consequences. If we add 1
2z to both sides, thereby
cancelling the term B1z/1! = ‚àí1
2z from the right, we get
z
ez ‚àí1 + z
2 = z
2
ez + 1
ez ‚àí1 = z
2
ez/2 + e‚àíz/2
ez/2 ‚àíe‚àíz/2 = z
2 coth z
2 .
(6.82)
Here coth is the \hyperbolic cotangent" function, otherwise known in calculus
books as cosh z/sinh z; we have
sinh z = ez ‚àíe‚àíz
2
;
cosh z = ez + e‚àíz
2
.
(6.83)
Changing z to ‚àíz gives
¬° ‚àíz
2
¬¢
coth
¬° ‚àíz
2
¬¢
= z
2 coth z
2; hence every odd-numbered
coecient of z
2 coth z
2 must be zero, and we have
B3 = B5 = B7 = B9 = B11 = B13 = ¬∑ ¬∑ ¬∑ = 0 .
(6.84)
Furthermore (6.82) leads to a closed form for the coecients of coth:
z coth z =
2z
e2z ‚àí1 + 2z
2
=
X
n0
B2n
(2z)2n
(2n)!
=
X
n0
4nB2n
z2n
(2n)! . (6.85)
But there isn't much of a market for hyperbolic functions; people are more
interested in the \real" functions of trigonometry. We can express ordinary

286 SPECIAL NUMBERS
trigonometric functions in terms of their hyperbolic cousins by using the rules
sin z = ‚àíi sinh iz ,
cos z = cosh iz ;
(6.86)
the corresponding power series are
sin z = z1
1! ‚àíz3
3! + z5
5! ‚àí¬∑ ¬∑ ¬∑ ,
sinh z = z1
1! + z3
3! + z5
5! + ¬∑ ¬∑ ¬∑ ;
cos z = z0
0! ‚àíz2
2! + z4
4! ‚àí¬∑ ¬∑ ¬∑ ,
cosh z = z0
0! + z2
2! + z4
4! + ¬∑ ¬∑ ¬∑ .
Hence cot z = cos z/sin z = i cosh iz/ sinh iz = i coth iz, and we have
I see, we get \real"
functions by using
imaginary numbers.
z cot z =
X
n0
B2n
(2iz)2n
(2n)!
=
X
n0
(‚àí4)nB2n
z2n
(2n)! .
(6.87)
Another remarkable formula for z cot z was found by Euler (exercise 73):
z cot z = 1 ‚àí2
X
k1
z2
k2œÄ2 ‚àíz2 .
(6.88)
We can expand Euler's formula in powers of z2, obtaining
z cot z = 1 ‚àí2
X
k1
¬µ z2
k2œÄ2 +
z4
k4œÄ4 +
z6
k6œÄ6 + ¬∑ ¬∑ ¬∑
¬∂
= 1 ‚àí2
¬µ z2
œÄ2 H(2)
‚àû+ z4
œÄ4 H(4)
‚àû+ z6
œÄ6 H(6)
‚àû+ ¬∑ ¬∑ ¬∑
¬∂
.
Equating coecients of z2n with those in our other formula, (6.87), gives us
an almost miraculous closed form for innitely many innite sums:
Œ∂(2n) = H(2n)
‚àû
= (‚àí1)n‚àí1 22n‚àí1œÄ2nB2n
(2n)!
,
integer n > 0.
(6.89)
For example,
Œ∂(2) = H(2)
‚àû
= 1 + 1
4 + 1
9 + ¬∑ ¬∑ ¬∑ = œÄ2B2 = œÄ2/6 ;
(6.90)
Œ∂(4) = H(4)
‚àû
= 1 +
1
16 +
1
81 + ¬∑ ¬∑ ¬∑ = ‚àíœÄ4B4/3 = œÄ4/90 .
(6.91)
Formula (6.89) is not only a closed form for H(2n)
‚àû
, it also tells us the approx-
imate size of B2n, since H(2n)
‚àû
is very near 1 when n is large. And it tells
us that (‚àí1)n‚àí1B2n > 0 for all n > 0; thus the nonzero Bernoulli numbers
alternate in sign.

6.5 BERNOULLI NUMBERS 287
And that's not all. Bernoulli numbers also appear in the coecients of
?
Start
Skipping
the tangent function,
tan z = sin z
cos z =
X
n0
(‚àí1)n‚àí14n(4n ‚àí1)B2n
z2n‚àí1
(2n)! ,
(6.92)
as well as other trigonometric functions (exercise 72). Formula (6.92) leads
to another important fact about the Bernoulli numbers, namely that
T2n‚àí1 = (‚àí1)n‚àí1 4n(4n ‚àí1)
2n
B2n
is a positive integer.
(6.93)
We have, for example:
n
1
3
5
7
9
11
13
Tn
1
2
16
272
7936
353792
22368256
(The T's are called tangent numbers.)
One way to prove (6.93), following an idea of B. F. Logan, is to consider
the power series
sin z + x cos z
cos z ‚àíx sin z = x + (1+x2)z + (2x3+2x)z2
2 + (6x4+8x2+2)z3
6 + ¬∑ ¬∑ ¬∑
=
X
n0
Tn(x)zn
n! ,
(6.94)
where Tn(x) is a polynomial in x; setting x = 0 gives Tn(0) = Tn, the nth
When x = tan w,
this is tan(z + w).
Hence, by Taylor's
theorem, the nth
derivative of tan w
is Tn(tan w).
tangent number. If we dierentiate (6.94) with respect to x, we get
1
(cos z ‚àíx sin z)2 =
X
n0
T ‚Ä≤
n(x)zn
n! ;
but if we dierentiate with respect to z, we get
1 + x2
(cos z ‚àíx sin z)2 =
X
n1
Tn(x) zn‚àí1
(n ‚àí1)! =
X
n0
Tn+1(x)zn
n! .
(Try it | the cancellation is very pretty.) Therefore we have
Tn+1(x) = (1 + x2)T ‚Ä≤
n(x) ,
T0(x) = x ,
(6.95)
a simple recurrence from which it follows that the coecients of Tn(x) are
nonnegative integers. Moreover, we can easily prove that Tn(x) has degree
n + 1, and that its coecients are alternately zero and positive. Therefore
T2n+1(0) = T2n+1 is a positive integer, as claimed in (6.93).

288 SPECIAL NUMBERS
Recurrence (6.95) gives us a simple way to calculate Bernoulli numbers,
via tangent numbers, using only simple operations on integers; by contrast,
the dening recurrence (6.79) involves dicult arithmetic with fractions.
If we want to compute the sum of nth powers from a to b ‚àí1 instead of
from 0 to n ‚àí1, the theory of Chapter 2 tells us that
b‚àí1
X
k=a
km =
Xb
a xm Œ¥x = Sm(b) ‚àíSm(a) .
(6.96)
This identity has interesting consequences when we consider negative values
of k: We have
‚àí1
X
k=‚àín+1
km = (‚àí1)m
n‚àí1
X
k=0
km ,
when m > 0,
hence
Sm(0) ‚àíSm(‚àín + 1) = (‚àí1)m¬°
Sm(n) ‚àíSm(0)
¬¢
.
But Sm(0) = 0, so we have the identity
Sm(1 ‚àín) = (‚àí1)m+1Sm(n) ,
m > 0.
(6.97)
Therefore Sm(1) = 0. If we write the polynomial Sm(n) in factored form, it
Johann Faulhaber
implicitly used
(6.97) in 1635 [119]
to nd simple for-
mulas for Sm(n)
as polynomials in
n(n + 1)/2 when
m  17; see [222].)
will always have the factors n and (n‚àí1), because it has the roots 0 and 1. In
general, Sm(n) is a polynomial of degree m + 1 with leading term
1
m+1nm+1.
Moreover, we can set n = 1
2 in (6.97) to deduce that Sm( 1
2) = (‚àí1)m+1Sm( 1
2);
if m is even, this makes Sm( 1
2) = 0, so (n ‚àí1
2) will be an additional factor.
These observations explain why we found the simple factorization
S2(n) =
1
3n(n ‚àí1
2)(n ‚àí1)
in Chapter 2; we could have used such reasoning to deduce the value of S2(n)
without calculating it! Furthermore, (6.97) implies that the polynomial with
the remaining factors, ^Sm(n) = Sm(n)/(n ‚àí1
2), always satises
^Sm(1 ‚àín) = ^Sm(n) ,
m even,
m > 0.
It follows that Sm(n) can always be written in the factored form
Sm(n) =
Ô£±
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£≤
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£≥
1
m + 1
‚åàm/2‚åâ
Y
k=1
(n ‚àí1
2 ‚àíŒ±k)(n ‚àí1
2 + Œ±k) ,
m odd;
(n ‚àí1
2)
m + 1
m/2
Y
k=1
(n ‚àí1
2 ‚àíŒ±k)(n ‚àí1
2 + Œ±k) ,
m even.
(6.98)

6.5 BERNOULLI NUMBERS 289
Here Œ±1 = 1
2, and Œ±2, . . . , Œ±‚åàm/2‚åâare appropriate complex numbers whose
values depend on m. For example,
S3(n) = n2(n ‚àí1)2/4 ;
S4(n) = n(n‚àí1
2)(n‚àí1)(n ‚àí1
2 +
p
7/12 )(n ‚àí1
2 ‚àí
p
7/12 )/5 ;
S5(n) = n2(n ‚àí1)2(n ‚àí1
2 +
p
3/4 )(n ‚àí1
2 ‚àí
p
3/4 )/6 ;
S6(n) = n(n‚àí1
2)(n‚àí1)(n‚àí1
2 + Œ±)(n‚àí1
2 ‚àíŒ±)(n‚àí1
2 + Œ±)(n‚àí1
2 ‚àíŒ±) ,
where Œ± = 2‚àí5/2 3‚àí1/2 311/4¬°p‚àö
31 +
‚àö
27 + i
p‚àö
31 ‚àí
‚àö
27
¬¢
.
If m is odd and greater than 1, we have Bm = 0; hence Sm(n) is divisible
by n2 (and by (n ‚àí1)2). Otherwise the roots of Sm(n) don't seem to obey a
simple law.
?
Stop
Skipping
Let's conclude our study of Bernoulli numbers by looking at how they
relate to Stirling numbers. One way to compute Sm(n) is to change ordinary
powers to falling powers, since the falling powers have easy sums. After doing
those easy sums we can convert back to ordinary powers:
Sm(n) =
n‚àí1
X
k=0
km =
n‚àí1
X
k=0
X
j0
¬Øm
j
¬∞
kj =
X
j0
¬Øm
j
¬∞ n‚àí1
X
k=0
kj
=
X
j0
¬Øm
j
¬∞nj+1
j + 1
=
X
j0
¬Øm
j
¬∞
1
j + 1
X
k0
(‚àí1)j+1‚àík
¬∑j + 1
k
¬∏
nk .
Therefore, equating coecients with those in (6.78), we must have the identity
X
j0
¬Øm
j
¬∞¬∑j + 1
k
¬∏(‚àí1)j+1‚àík
j + 1
=
1
m + 1
¬µm + 1
k
¬∂
Bm+1‚àík .
(6.99)
It would be nice to prove this relation directly, thereby discovering Bernoulli
numbers in a new way. But the identities in Tables 264 or 265 don't give
us any obvious handle on a proof by induction that the left-hand sum in
(6.99) is a constant times mk‚àí1. If k = m + 1, the left-hand sum is just
¬©m
m
¬™¬£m+1
m+1
¬§
/(m+1) = 1/(m+1), so that case is easy. And if k = m, the left-
hand side sums to
¬© m
m‚àí1
¬™¬£m
m
¬§
m‚àí1 ‚àí
¬©m
m
¬™¬£m+1
m
¬§
(m+1)‚àí1 = 1
2(m‚àí1)‚àí1
2m =
‚àí1
2; so that case is pretty easy too. But if k < m, the left-hand sum looks
hairy. Bernoulli would probably not have discovered his numbers if he had
taken this route.

290 SPECIAL NUMBERS
One thing we can do is replace
¬©m
j
¬™
by
¬©m+1
j+1
¬™
‚àí(j+1)
¬© m
j+1
¬™
. The (j+1)
nicely cancels with the awkward denominator, and the left-hand side becomes
X
j0
¬Øm + 1
j + 1
¬∞¬∑j + 1
k
¬∏(‚àí1)j+1‚àík
j + 1
‚àí
X
j0
¬Ø m
j + 1
¬∞¬∑j + 1
k
¬∏
(‚àí1)j+1‚àík .
The second sum is zero, when k < m, by (6.31). That leaves us with the rst
sum, which cries out for a change in notation; let's rename all variables so
that the index of summation is k, and so that the other parameters are m
and n. Then identity (6.99) is equivalent to
X
k
¬Øn
k
¬∞¬∑ k
m
¬∏(‚àí1)k‚àím
k
= 1
n
¬µn
m
¬∂
Bn‚àím + [m = n ‚àí1] .
(6.100)
Good, we have something that looks more pleasant | although Table 265 still
doesn't suggest any obvious next step.
The convolution formulas in Table 272 now come to the rescue. We can
use (6.49) and (6.48) to rewrite the summand in terms of Stirling polynomials:
¬Øn
k
¬∞¬∑ k
m
¬∏
= (‚àí1)n‚àík+1
n!
(k‚àí1)!œÉn‚àík(‚àík)¬∑
k!
(m‚àí1)!œÉk‚àím(k) ;
¬Øn
k
¬∞¬∑ k
m
¬∏(‚àí1)k‚àím
k
= (‚àí1)n+1‚àím
n!
(m‚àí1)! œÉn‚àík(‚àík) œÉk‚àím(k) .
Things are looking up; the convolution in (6.46), with t = 1, yields
n
X
k=0
œÉn‚àík(‚àík) œÉk‚àím(k) =
n‚àím
X
k=0
œÉn‚àím‚àík
¬°
‚àín + (n‚àím‚àík)
¬¢
œÉk(m + k)
=
m ‚àín
(m)(‚àín)œÉn‚àím
¬°
m ‚àín + (n‚àím)
¬¢
.
Formula (6.100) is now veried, and we nd that Bernoulli numbers are related
to the constant terms in the Stirling polynomials:
?
Stop
Skimming
Bm
m!
= ‚àímœÉm(0) .
(6.101)
6.6
FIBONACCI NUMBERS
Now we come to a special sequence of numbers that is perhaps the
most pleasant of all, the Fibonacci sequence ‚ü®Fn‚ü©:
n
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
Fn
0
1
1
2
3
5
8
13
21
34
55
89
144
233
377

6.6 FIBONACCI NUMBERS 291
Unlike the harmonic numbers and the Bernoulli numbers, the Fibonacci num-
bers are nice simple integers. They are dened by the recurrence
F0 = 0 ;
F1 = 1 ;
Fn = Fn‚àí1 + Fn‚àí2 ,
for n > 1.
(6.102)
The simplicity of this rule | the simplest possible recurrence in which each
number depends on the previous two | accounts for the fact that Fibonacci
numbers occur in a wide variety of situations.
\Bee trees" provide a good example of how Fibonacci numbers can arise
The back-to-nature
nature of this ex-
ample is shocking.
This book should be
banned.
naturally. Let's consider the pedigree of a male bee. Each male (also known
as a drone) is produced asexually from a female (also known as a queen); each
female, however, has two parents, a male and a female. Here are the rst few
levels of the tree:
k
¬°
¬°
k
k
¬°
¬°
k
k
k
¬°
¬°
k
k
¬°
¬°
k
k
k
¬°
¬°
k
The drone has one grandfather and one grandmother; he has one great-
grandfather and two great-grandmothers; he has two great-great-grandfathers
and three great-great-grandmothers. In general, it is easy to see by induction
that he has exactly Fn+1 greatn-grandpas and Fn+2 greatn-grandmas.
Fibonacci numbers are often found in nature, perhaps for reasons similar
to the bee-tree law. For example, a typical sunower has a large head that
contains spirals of tightly packed orets, usually with 34 winding in one di-
rection and 55 in another. Smaller heads will have 21 and 34, or 13 and 21;
Phyllotaxis, n.
The love of taxis.
a gigantic sunower with 89 and 144 spirals was once exhibited in England.
Similar patterns are found in some species of pine cones.
And here's an example of a dierent nature [277]: Suppose we put two
panes of glass back-to-back. How many ways an are there for light rays to
pass through or be reected after changing direction n times? The rst few

292 SPECIAL NUMBERS
cases are:
C
C
C
CW
C
C¬§
¬§ C
C
CC¬§
¬§
¬§¬§
C
C¬§¬§C
C
CCW
C
C
CC¬§¬§C
CW
C
C
CC¬§
¬§¬§C
C
CCW
C
C¬§¬§CC¬§
¬§ C
C¬§¬§C
CC¬§
¬§
¬§¬§ C
C
CC¬§¬§CC¬§
¬§
¬§¬§ C
C
CC¬§
¬§¬§CC¬§
¬§ C
C
CC¬§
¬§¬§C
CC¬§
¬§
¬§¬§
a0 = 1
a1 = 2
a2 = 3
a3 = 5
((
((((
((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((((
((((((
((((
((
hh
hhhh
hhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhhhh
hhhhhh
hhhh
hh
When n is even, we have an even number of bounces and the ray passes
through; when n is odd, the ray is reected and it re-emerges on the same
side it entered. The an's seem to be Fibonacci numbers, and a little staring
at the gure tells us why: For n  2, the n-bounce rays either take their rst
bounce o the opposite surface and continue in an‚àí1 ways, or they begin
by bouncing o the middle surface and then bouncing back again to nish
in an‚àí2 ways. Thus we have the Fibonacci recurrence an = an‚àí1 + an‚àí2.
The initial conditions are dierent, but not very dierent, because we have
a0 = 1 = F2 and a1 = 2 = F3; therefore everything is simply shifted two
places, and an = Fn+2.
Leonardo Fibonacci introduced these numbers in 1202, and mathemati-
cians gradually began to discover more and more interesting things about
them.
Edouard Lucas, the perpetrator of the Tower of Hanoi puzzle dis-
cussed in Chapter 1, worked with them extensively in the last half of the nine-
\La suite de Fi-
bonacci possede
des proprietes
nombreuses fort
interessantes."
|E. Lucas [259]
teenth century (in fact it was Lucas who popularized the name \Fibonacci
numbers"). One of his amazing results was to use properties of Fibonacci
numbers to prove that the 39-digit Mersenne number 2127 ‚àí1 is prime.
One of the oldest theorems about Fibonacci numbers, due to the French
astronomer Jean-Dominique Cassini in 1680 [51], is the identity
Fn+1 Fn‚àí1 ‚àíF2
n = (‚àí1)n ,
for n > 0.
(6.103)
When n = 6, for example, Cassini's identity correctly claims that 13¬∑5‚àí82 =
1.
A polynomial formula that involves Fibonacci numbers of the form Fn¬±k
for small values of k can be transformed into a formula that involves only Fn
and Fn+1, because we can use the rule
Fm = Fm+2 ‚àíFm+1
(6.104)
to express Fm in terms of higher Fibonacci numbers when m < n, and we can
use
Fm = Fm‚àí2 + Fm‚àí1
(6.105)
to replace Fm by lower Fibonacci numbers when m > n+1. Thus, for example,
we can replace Fn‚àí1 by Fn+1 ‚àíFn in (6.103) to get Cassini's identity in the

6.6 FIBONACCI NUMBERS 293
form
F2
n+1 ‚àíFn+1 Fn ‚àíF2
n = (‚àí1)n .
(6.106)
Moreover, Cassini's identity reads
Fn+2 Fn ‚àíF2
n+1 = (‚àí1)n+1
when n is replaced by n + 1; this is the same as (Fn+1 + Fn)Fn ‚àíF2
n+1 =
(‚àí1)n+1, which is the same as (6.106). Thus Cassini(n) is true if and only if
Cassini(n+1) is true; equation (6.103) holds for all n by induction.
Cassini's identity is the basis of a geometrical paradox that was one of
Lewis Carroll's favorite puzzles [63], [319], [364]. The idea is to take a chess-
board and cut it into four pieces as shown here, then to reassemble the pieces
into a rectangle:
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
Presto: The original area of 8 √ó 8 = 64 squares has been rearranged to yield
5 √ó 13 = 65 squares!
A similar construction dissects any Fn √ó Fn square
The paradox is
explained be-
cause . . . well,
magic tricks aren't
supposed to be
explained.
into four pieces, using Fn+1, Fn, Fn‚àí1, and Fn‚àí2 as dimensions wherever the
illustration has 13, 8, 5, and 3 respectively. The result is an Fn‚àí1 √ó Fn+1
rectangle; by (6.103), one square has therefore been gained or lost, depending
on whether n is even or odd.
Strictly speaking, we can't apply the reduction (6.105) unless m  2,
because we haven't dened Fn for negative n. A lot of maneuvering becomes
easier if we eliminate this boundary condition and use (6.104) and (6.105) to
dene Fibonacci numbers with negative indices. For example, F‚àí1 turns out
to be F1 ‚àíF0 = 1; then F‚àí2 is F0 ‚àíF‚àí1 = ‚àí1. In this way we deduce the
values
n
0
‚àí1
‚àí2
‚àí3
‚àí4
‚àí5
‚àí6
‚àí7
‚àí8
‚àí9
‚àí10
‚àí11
Fn
0
1
‚àí1
2
‚àí3
5
‚àí8
13
‚àí21
34
‚àí55
89
and it quickly becomes clear (by induction) that
F‚àín = (‚àí1)n‚àí1Fn ,
integer n.
(6.107)
Cassini's identity (6.103) is true for all integers n, not just for n > 0, when
we extend the Fibonacci sequence in this way.

294 SPECIAL NUMBERS
The process of reducing Fn¬±k to a combination of Fn and Fn+1 by using
(6.105) and (6.104) leads to the sequence of formulas
Fn+2 =
Fn+1 + Fn
Fn‚àí1 =
Fn+1
‚àíFn
Fn+3 = 2Fn+1 + Fn
Fn‚àí2 = ‚àíFn+1 + 2Fn
Fn+4 = 3Fn+1 + 2Fn
Fn‚àí3 =
2Fn+1 ‚àí3Fn
Fn+5 = 5Fn+1 + 3Fn
Fn‚àí4 = ‚àí3Fn+1 + 5Fn
in which another pattern becomes obvious:
Fn+k = FkFn+1 + Fk‚àí1Fn .
(6.108)
This identity, easily proved by induction, holds for all integers k and n (pos-
itive, negative, or zero).
If we set k = n in (6.108), we nd that
F2n = FnFn+1 + Fn‚àí1Fn ;
(6.109)
hence F2n is a multiple of Fn. Similarly,
F3n = F2nFn+1 + F2n‚àí1Fn ,
and we may conclude that F3n is also a multiple of Fn. By induction,
Fkn is a multiple of Fn ,
(6.110)
for all integers k and n. This explains, for example, why F15 (which equals
610) is a multiple of both F3 and F5 (which are equal to 2 and 5). Even more
is true, in fact; exercise 27 proves that
gcd(Fm, Fn) = Fgcd(m,n) .
(6.111)
For example, gcd(F12, F18) = gcd(144, 2584) = 8 = F6.
We can now prove a converse of (6.110): If n > 2 and if Fm is a multiple
of Fn, then m is a multiple of n.
For if FnnFm then Fnn gcd(Fm, Fn) =
Fgcd(m,n)  Fn. This is possible only if Fgcd(m,n) = Fn; and our assumption
that n > 2 makes it mandatory that gcd(m, n) = n. Hence nnm.
An extension of these divisibility ideas was used by Yuri Matijasevich in
his famous proof [266] that there is no algorithm to decide if a given multivari-
ate polynomial equation with integer coecients has a solution in integers.
Matijasevich's lemma states that, if n > 2, the Fibonacci number Fm is a
multiple of F2
n if and only if m is a multiple of nFn.
Let's prove this by looking at the sequence ‚ü®Fkn mod F2
n‚ü©for k = 1, 2,
3, . . . , and seeing when Fkn mod F2
n = 0. (We know that m must have the

6.6 FIBONACCI NUMBERS 295
form kn if Fm mod Fn = 0.) First we have Fn mod F2
n = Fn; that's not zero.
Next we have
F2n = FnFn+1 + Fn‚àí1Fn ‚â°2FnFn+1
(mod F2
n) ,
by (6.108), since Fn+1 ‚â°Fn‚àí1 (mod Fn). Similarly
F2n+1 = F2
n+1 + F2
n ‚â°F2
n+1
(mod F2
n) .
This congruence allows us to compute
F3n = F2n+1Fn + F2nFn‚àí1
‚â°F2
n+1Fn + (2FnFn+1)Fn+1 = 3F2
n+1Fn
(mod F2
n) ;
F3n+1 = F2n+1Fn+1 + F2nFn
‚â°F3
n+1 + (2FnFn+1)Fn ‚â°F3
n+1
(mod F2
n) .
In general, we nd by induction on k that
Fkn ‚â°kFnFk‚àí1
n+1
and
Fkn+1 ‚â°Fk
n+1
(mod F2
n) .
Now Fn+1 is relatively prime to Fn, so
Fkn ‚â°0
(mod F2
n)
‚áê‚áí
kFn ‚â°0
(mod F2
n)
‚áê‚áí
k ‚â°0
(mod Fn) .
We have proved Matijasevich's lemma.
One of the most important properties of the Fibonacci numbers is the
special way in which they can be used to represent integers. Let's write
j ‚â´k
‚áê‚áí
j  k + 2 .
(6.112)
Then every positive integer has a unique representation of the form
n = Fk1 + Fk2 + ¬∑ ¬∑ ¬∑ + Fkr ,
k1 ‚â´k2 ‚â´¬∑ ¬∑ ¬∑ ‚â´kr ‚â´0.
(6.113)
(This is \Zeckendorf's theorem" [246], [381].) For example, the representation
of one million turns out to be
1000000 = 832040 + 121393 + 46368 + 144 + 55
=
F30
+
F26
+ F24
+ F12 + F10 .
We can always nd such a representation by using a \greedy" approach,
choosing Fk1 to be the largest Fibonacci number  n, then choosing Fk2
to be the largest that is  n ‚àíFk1, and so on. (More precisely, suppose that

296 SPECIAL NUMBERS
Fk  n < Fk+1; then we have 0  n ‚àíFk < Fk+1 ‚àíFk = Fk‚àí1. If n is a
Fibonacci number, (6.113) holds with r = 1 and k1 = k. Otherwise n ‚àíFk
has a Fibonacci representation Fk2 +¬∑ ¬∑ ¬∑+Fkr, by induction on n; and (6.113)
holds if we set k1 = k, because the inequalities Fk2  n ‚àíFk < Fk‚àí1 imply
that k ‚â´k2.) Conversely, any representation of the form (6.113) implies that
Fk1  n < Fk1+1 ,
because the largest possible value of Fk2 + ¬∑ ¬∑ ¬∑ + Fkr when k ‚â´k2 ‚â´¬∑ ¬∑ ¬∑ ‚â´
kr ‚â´0 is
Fk‚àí2 + Fk‚àí4 + ¬∑ ¬∑ ¬∑ + Fk mod 2+2 = Fk‚àí1 ‚àí1 ,
if k  2.
(6.114)
(This formula is easy to prove by induction on k; the left-hand side is zero
when k is 2 or 3.) Therefore k1 is the greedily chosen value described earlier,
and the representation must be unique.
Any unique system of representation is a number system; therefore Zeck-
endorf's theorem leads to the Fibonacci number system. We can represent
any nonnegative integer n as a sequence of 0's and 1's, writing
n = (bmbm‚àí1 . . . b2)F
‚áê‚áí
n =
m
X
k=2
bkFk .
(6.115)
This number system is something like binary (radix 2) notation, except that
there never are two adjacent 1's. For example, here are the numbers from 1
to 20, expressed Fibonacci-wise:
1 = (000001)F
6 = (001001)F
11 = (010100)F
16 = (100100)F
2 = (000010)F
7 = (001010)F
12 = (010101)F
17 = (100101)F
3 = (000100)F
8 = (010000)F
13 = (100000)F
18 = (101000)F
4 = (000101)F
9 = (010001)F
14 = (100001)F
19 = (101001)F
5 = (001000)F
10 = (010010)F
15 = (100010)F
20 = (101010)F
The Fibonacci representation of a million, shown a minute ago, can be con-
trasted with its binary representation 219 + 218 + 217 + 216 + 214 + 29 + 26:
(1000000)10 = (10001010000000000010100000000)F
= (11110100001001000000)2 .
The Fibonacci representation needs a few more bits because adjacent 1's are
not permitted; but the two representations are analogous.
To add 1 in the Fibonacci number system, there are two cases: If the
\units digit" is 0, we change it to 1; that adds F2 = 1, since the units digit

6.6 FIBONACCI NUMBERS 297
refers to F2. Otherwise the two least signicant digits will be 01, and we
change them to 10 (thereby adding F3 ‚àíF2 = 1). Finally, we must \carry" as
much as necessary by changing the digit pattern `011' to `100' until there are
no two 1's in a row. (This carry rule is equivalent to replacing Fm+1 + Fm
by Fm+2.)
For example, to go from 5 = (1000)F to 6 = (1001)F or from
6 = (1001)F to 7 = (1010)F requires no carrying; but to go from 7 = (1010)F
to 8 = (10000)F we must carry twice.
So far we've been discussing lots of properties of the Fibonacci numbers,
but we haven't come up with a closed formula for them. We haven't found
closed forms for Stirling numbers, Eulerian numbers, or Bernoulli numbers
either; but we were able to discover the closed form Hn =
¬£n+1
2
¬§
/n! for
harmonic numbers. Is there a relation between Fn and other quantities we
know? Can we \solve" the recurrence that denes Fn?
The answer is yes. In fact, there's a simple way to solve the recurrence by
using the idea of generating function that we looked at briey in Chapter 5.
\Sit 1 + x + 2xx +
3x3 + 5x4 + 8x5 +
13x6 + 21x7 +
34x8 &c Series nata
ex divisione Unitatis
per Trinomium
1 ‚àíx ‚àíxx."
|A. de Moivre [76]
\The quantities r,
s, t, which show
the relation of
the terms, are the
same as those in
the denominator of
the fraction. This
property, howsoever
obvious it may
be, M. DeMoivre
was the rst that
applied it to use,
in the solution of
problems about
innite series, which
otherwise would
have been very
intricate."
|J. Stirling [343]
Let's consider the innite series
F(z) = F0 + F1z + F2z2 + ¬∑ ¬∑ ¬∑ =
X
n0
Fnzn .
(6.116)
If we can nd a simple formula for F(z), chances are reasonably good that we
can nd a simple formula for its coecients Fn.
In Chapter 7 we will focus on generating functions in detail, but it will
be helpful to have this example under our belts by the time we get there.
The power series F(z) has a nice property if we look at what happens when
we multiply it by z and by z2:
F(z) = F0 + F1z + F2z2 + F3z3 + F4z4 + F5z5 + ¬∑ ¬∑ ¬∑ ,
zF(z) =
F0z + F1z2 + F2z3 + F3z4 + F4z5 + ¬∑ ¬∑ ¬∑ ,
z2F(z) =
F0z2 + F1z3 + F2z4 + F3z5 + ¬∑ ¬∑ ¬∑ .
If we now subtract the last two equations from the rst, the terms that involve
z2, z3, and higher powers of z will all disappear, because of the Fibonacci
recurrence. Furthermore the constant term F0 never actually appeared in the
rst place, because F0 = 0. Therefore all that's left after the subtraction is
(F1 ‚àíF0)z, which is just z. In other words,
F(z) ‚àízF(z) ‚àíz2F(z) = z ,
and solving for F(z) gives us the compact formula
F(z) =
z
1 ‚àíz ‚àíz2 .
(6.117)

298 SPECIAL NUMBERS
We have now boiled down all the information in the Fibonacci sequence
to a simple (although unrecognizable) expression z/(1‚àíz‚àíz2). This, believe
it or not, is progress, because we can factor the denominator and then use
partial fractions to achieve a formula that we can easily expand in power series.
The coecients in this power series will be a closed form for the Fibonacci
numbers.
The plan of attack just sketched can perhaps be understood better if
we approach it backwards.
If we have a simpler generating function, say
1/(1 ‚àíŒ±z) where Œ± is a constant, we know the coecients of all powers of z,
because
1
1 ‚àíŒ±z = 1 + Œ±z + Œ±2z2 + Œ±3z3 + ¬∑ ¬∑ ¬∑ .
Similarly, if we have a generating function of the form A/(1‚àíŒ±z)+B/(1‚àíŒ≤z),
the coecients are easily determined, because
A
1 ‚àíŒ±z +
B
1 ‚àíŒ≤z = A
X
n0
(Œ±z)n + B
X
n0
(Œ≤z)n
=
X
n0
(AŒ±n + BŒ≤n)zn .
(6.118)
Therefore all we have to do is nd constants A, B, Œ±, and Œ≤ such that
A
1 ‚àíŒ±z +
B
1 ‚àíŒ≤z =
z
1 ‚àíz ‚àíz2 ,
and we will have found a closed form AŒ±n + BŒ≤n for the coecient Fn of zn
in F(z). The left-hand side can be rewritten
A
1 ‚àíŒ±z +
B
1 ‚àíŒ≤z = A ‚àíAŒ≤z + B ‚àíBŒ±z
(1 ‚àíŒ±z)(1 ‚àíŒ≤z)
,
so the four constants we seek are the solutions to two polynomial equations:
(1 ‚àíŒ±z)(1 ‚àíŒ≤z) = 1 ‚àíz ‚àíz2 ;
(6.119)
(A + B) ‚àí(AŒ≤ + BŒ±)z = z .
(6.120)
We want to factor the denominator of F(z) into the form (1 ‚àíŒ±z)(1 ‚àíŒ≤z);
then we will be able to express F(z) as the sum of two fractions in which the
factors (1 ‚àíŒ±z) and (1 ‚àíŒ≤z) are conveniently separated from each other.
Notice that the denominator factors in (6.119) have been written in the
form (1 ‚àíŒ±z)(1 ‚àíŒ≤z), instead of the more usual form c(z ‚àíœÅ1)(z ‚àíœÅ2) where
œÅ1 and œÅ2 are the roots. The reason is that (1 ‚àíŒ±z)(1 ‚àíŒ≤z) leads to nicer
expansions in power series.

6.6 FIBONACCI NUMBERS 299
We can nd Œ± and Œ≤ in several ways, one of which uses a slick trick: Let
As usual, the au-
thors can't resist
a trick.
us introduce a new variable w and try to nd the factorization
w2 ‚àíwz ‚àíz2 = (w ‚àíŒ±z)(w ‚àíŒ≤z) .
Then we can simply set w = 1 and we'll have the factors of 1 ‚àíz ‚àíz2. The
roots of w2 ‚àíwz ‚àíz2 = 0 can be found by the quadratic formula; they are
z ¬±
p
z2 + 4z2
2
= 1 ¬±
‚àö
5
2
z .
Therefore
w2 ‚àíwz ‚àíz2 =
¬µ
w ‚àí1 +
‚àö
5
2
z
¬∂¬µ
w ‚àí1 ‚àí
‚àö
5
2
z
¬∂
and we have the constants Œ± and Œ≤ we were looking for.
The number (1 +
‚àö
5)/2 ‚âà1.61803 is important in many parts of mathe-
The ratio of one's
height to the height
of one's navel is
approximately
1.618, accord-
ing to extensive
empirical observa-
tions by European
scholars [136].
matics as well as in the art world, where it has been considered since ancient
times to be the most pleasing ratio for many kinds of design. Therefore it
has a special name, the golden ratio. We denote it by the Greek letter œÜ, in
honor of Phidias who is said to have used it consciously in his sculpture. The
other root (1 ‚àí
‚àö
5)/2 = ‚àí1/œÜ ‚âà‚àí.61803 shares many properties of œÜ, so it
has the special name bœÜ, \phi hat." These numbers are roots of the equation
w2 ‚àíw ‚àí1 = 0, so we have
œÜ2 = œÜ + 1 ;
bœÜ2 = bœÜ + 1 .
(6.121)
(More about œÜ and bœÜ later.)
We have found the constants Œ± = œÜ and Œ≤ = bœÜ needed in (6.119); now
we merely need to nd A and B in (6.120). Setting z = 0 in that equation
tells us that B = ‚àíA, so (6.120) boils down to
‚àíbœÜA + œÜA = 1 .
The solution is A = 1/(œÜ ‚àíbœÜ) = 1/
‚àö
5; the partial fraction expansion of
(6.117) is therefore
F(z) =
1
‚àö
5
¬µ
1
1 ‚àíœÜz ‚àí
1
1 ‚àíbœÜz
¬∂
.
(6.122)
Good, we've got F(z) right where we want it. Expanding the fractions into
power series as in (6.118) gives a closed form for the coecient of zn:
Fn =
1
‚àö
5
¬°
œÜn ‚àíbœÜn¬¢
.
(6.123)
(This formula was rst published by Leonhard Euler [113] in 1765, but people
forgot about it until it was rediscovered by Jacques Binet [31] in 1843.)

300 SPECIAL NUMBERS
Before we stop to marvel at our derivation, we should check its accuracy.
For n = 0 the formula correctly gives F0 = 0; for n = 1, it gives F1 =
(œÜ ‚àíbœÜ)/
‚àö
5, which is indeed 1. For higher powers, equations (6.121) show
that the numbers dened by (6.123) satisfy the Fibonacci recurrence, so they
must be the Fibonacci numbers by induction. (We could also expand œÜn
and bœÜn by the binomial theorem and chase down the various powers of
‚àö
5;
but that gets pretty messy. The point of a closed form is not necessarily to
provide us with a fast method of calculation, but rather to tell us how Fn
relates to other quantities in mathematics.)
With a little clairvoyance we could simply have guessed formula (6.123)
and proved it by induction. But the method of generating functions is a pow-
erful way to discover it; in Chapter 7 we'll see that the same method leads us
to the solution of recurrences that are considerably more dicult. Inciden-
tally, we never worried about whether the innite sums in our derivation of
(6.123) were convergent; it turns out that most operations on the coecients
of power series can be justied rigorously whether or not the sums actually
converge [182]. Still, skeptical readers who suspect fallacious reasoning with
innite sums can take comfort in the fact that equation (6.123), once found
by using innite series, can be veried by a solid induction proof.
One of the interesting consequences of (6.123) is that the integer Fn is
extremely close to the irrational number œÜn/
‚àö
5 when n is large. (Since bœÜ is
less than 1 in absolute value, bœÜn becomes exponentially small and its eect
is almost negligible.) For example, F10 = 55 and F11 = 89 are very near
œÜ10
‚àö
5
‚âà55.00364
and
œÜ11
‚àö
5
‚âà88.99775 .
We can use this observation to derive another closed form,
Fn =
¬πœÜn
‚àö
5
+ 1
2
¬∫
= œÜn
‚àö
5
rounded to the nearest integer,
(6.124)
because
¬Ø¬ØbœÜn/
‚àö
5
¬Ø¬Ø < 1
2 for all n  0. When n is even, Fn is a little bit less
than œÜn/
‚àö
5 ; otherwise it is a little greater.
Cassini's identity (6.103) can be rewritten
Fn+1
Fn
‚àí
Fn
Fn‚àí1
=
(‚àí1)n
Fn‚àí1 Fn
.
When n is large, 1/Fn‚àí1Fn is very small, so Fn+1/Fn must be very nearly
the same as Fn/Fn‚àí1; and (6.124) tells us that this ratio approaches œÜ. In
fact, we have
Fn+1 = œÜFn + bœÜn .
(6.125)

6.6 FIBONACCI NUMBERS 301
(This identity is true by inspection when n = 0 or n = 1, and by induction
when n > 1; we can also prove it directly by plugging in (6.123).) The ratio
Fn+1/Fn is very close to œÜ, which it alternately overshoots and undershoots.
By coincidence, œÜ is also very nearly the number of kilometers in a mile.
(The exact number is 1.609344, since 1 inch is exactly 2.54 centimeters.)
This gives us a handy way to convert mentally between kilometers and miles,
because a distance of Fn+1 kilometers is (very nearly) a distance of Fn miles.
If the USA ever
goes metric, our
speed limit signs
will go from 55
mi/hr to 89 km/hr.
Or maybe the high-
way people will be
generous and let us
go 90.
Suppose we want to convert a non-Fibonacci number from kilometers
to miles; what is 30 km, American style? Easy: We just use the Fibonacci
number system and mentally convert 30 to its Fibonacci representation 21 +
8+1 by the greedy approach explained earlier. Now we can shift each number
down one notch, getting 13 + 5 + 1. (The former `1' was F2, since kr ‚â´0 in
(6.113); the new `1' is F1.) Shifting down divides by œÜ, more or less. Hence
19 miles is our estimate. (That's pretty close; the correct answer is about
18.64 miles.)
Similarly, to go from miles to kilometers we can shift up a
notch; 30 miles is approximately 34 + 13 + 2 = 49 kilometers. (That's not
quite as close; the correct number is about 48.28.)
It turns out that this shift-down rule gives the correctly rounded number
of miles per n kilometers for all n  100, except in the cases n = 4, 12, 62, 75,
91, and 96, when it is o by less than 2/3 mile. And the shift-up rule gives
either the correctly rounded number of kilometers for n miles, or 1 km too
The \shift down"
rule changes n
to f(n/œÜ) and
the \shift up"
rule changes n
to f(nœÜ), where
f(x) = ‚åäx + œÜ‚àí1‚åã.
many, for all n  126. (The only really embarrassing case is n = 4, where the
individual rounding errors for n = 3 + 1 both go the same direction instead
of cancelling each other out.)
6.7
CONTINUANTS
Fibonacci numbers have important connections to the Stern{Brocot
tree that we studied in Chapter 4, and they have important generalizations to
a sequence of polynomials that Euler studied extensively. These polynomials
are called continuants, because they are the key to the study of continued
fractions like
a0 +
1
a1 +
1
a2 +
1
a3 +
1
a4 +
1
a5 +
1
a6 + 1
a7
.
(6.126)

302 SPECIAL NUMBERS
The continuant polynomial Kn(x1, x2, . . . , xn) has n parameters, and it
is dened by the following recurrence:
K0() = 1 ;
K1(x1) = x1 ;
Kn(x1, . . . , xn) = Kn‚àí1(x1, . . . , xn‚àí1)xn + Kn‚àí2(x1, . . . , xn‚àí2) . (6.127)
For example, the next three cases after K1(x1) are
K2(x1, x2) = x1x2 + 1 ;
K3(x1, x2, x3) = x1x2x3 + x1 + x3 ;
K4(x1, x2, x3, x4) = x1x2x3x4 + x1x2 + x1x4 + x3x4 + 1 .
It's easy to see, inductively, that the number of terms is a Fibonacci number:
Kn(1, 1, . . . , 1) = Fn+1 .
(6.128)
When the number of parameters is implied by the context, we can write
simply `K' instead of `Kn', just as we can omit the number of parameters
when we use the hypergeometric functions F of Chapter 5.
For example,
K(x1, x2) = K2(x1, x2) = x1x2 + 1. The subscript n is of course necessary in
formulas like (6.128).
Euler observed that K(x1, x2, . . . , xn) can be obtained by starting with
the product x1x2 . . . xn and then striking out adjacent pairs xkxk+1 in all
possible ways. We can represent Euler's rule graphically by constructing all
\Morse code" sequences of dots and dashes having length n, where each dot
contributes 1 to the length and each dash contributes 2; here are the Morse
code sequences of length 4:
q q q q
q q
q
q
q q
These dot-dash patterns correspond to the terms of K(x1, x2, x3, x4); a dot
signies a variable that's included and a dash signies a pair of variables
that's excluded. For example, q
q corresponds to x1x4.
A Morse code sequence of length n that has k dashes has n‚àí2k dots and
n ‚àík symbols altogether. These dots and dashes can be arranged in
¬°n‚àík
k
¬¢
ways; therefore if we replace each dot by z and each dash by 1 we get
Kn(z, z, . . . , z) =
n
X
k=0
¬µn ‚àík
k
¬∂
zn‚àí2k .
(6.129)

6.7 CONTINUANTS 303
We also know that the total number of terms in a continuant is a Fibonacci
number; hence we have the identity
Fn+1 =
n
X
k=0
¬µn ‚àík
k
¬∂
.
(6.130)
(A closed form for (6.129), generalizing the Euler{Binet formula (6.123) for
Fibonacci numbers, appears in (5.74).)
The relation between continuant polynomials and Morse code sequences
shows that continuants have a mirror symmetry:
K(xn, . . . , x2, x1) = K(x1, x2, . . . , xn) .
(6.131)
Therefore they obey a recurrence that adjusts parameters at the left, in ad-
dition to the right-adjusting recurrence in denition (6.127):
Kn(x1, . . . , xn) = x1Kn‚àí1(x2, . . . , xn) + Kn‚àí2(x3, . . . , xn) .
(6.132)
Both of these recurrences are special cases of a more general law:
Km+n(x1, . . . , xm, xm+1, . . . , xm+n)
= Km(x1, . . . , xm) Kn(xm+1, . . . , xm+n)
+ Km‚àí1(x1, . . . , xm‚àí1) Kn‚àí1(xm+2, . . . , xm+n) .
(6.133)
This law is easily understood from the Morse code analogy: The rst product
KmKn yields the terms of Km+n in which there is no dash in the [m, m + 1]
position, while the second product yields the terms in which there is a dash
there. If we set all the x's equal to 1, this identity tells us that Fm+n+1 =
Fm+1Fn+1 + FmFn; thus, (6.108) is a special case of (6.133).
Euler [112] discovered that continuants obey an even more remarkable
law, which generalizes Cassini's identity:
Km+n(x1, . . . , xm+n) Kk(xm+1, . . . , xm+k)
= Km+k(x1, . . . , xm+k) Kn(xm+1, . . . , xm+n)
+ (‚àí1)kKm‚àí1(x1, . . . , xm‚àí1) Kn‚àík‚àí1(xm+k+2, . . . , xm+n) . (6.134)
This law (proved in exercise 29) holds whenever the subscripts on the K's are
all nonnegative. For example, when k = 2, m = 1, and n = 3, we have
K(x1, x2, x3, x4) K(x2, x3) = K(x1, x2, x3) K(x2, x3, x4) + 1 .
Continuant polynomials are intimately connected with Euclid's algo-
rithm.
Suppose, for example, that the computation of gcd(m, n) nishes

304 SPECIAL NUMBERS
in four steps:
gcd(m, n) = gcd(n0, n1)
n0 = m ,
n1 = n ;
= gcd(n1, n2)
n2 = n0 mod n1 = n0 ‚àíq1n1 ;
= gcd(n2, n3)
n3 = n1 mod n2 = n1 ‚àíq2n2 ;
= gcd(n3, n4)
n4 = n2 mod n3 = n2 ‚àíq3n3 ;
= gcd(n4, 0) = n4 .
0 = n3 mod n4 = n3 ‚àíq4n4 .
Then we have
n4 = n4
= K()n4 ;
n3 = q4n4
= K(q4)n4 ;
n2 = q3n3 + n4 = K(q3, q4)n4 ;
n1 = q2n2 + n3 = K(q2, q3, q4)n4 ;
n0 = q1n1 + n2 = K(q1, q2, q3, q4)n4 .
In general, if Euclid's algorithm nds the greatest common divisor d in k steps,
after computing the sequence of quotients q1, . . . , qk, then the starting num-
bers were K(q1, q2, . . . , qk)d and K(q2, . . . , qk)d. (This fact was noticed early
in the eighteenth century by Thomas Fantet de Lagny [232], who seems to
have been the rst person to consider continuants explicitly. Lagny pointed
out that consecutive Fibonacci numbers, which occur as continuants when the
q's take their minimum values, are therefore the smallest inputs that cause
Euclid's algorithm to take a given number of steps.)
Continuants are also intimately connected with continued fractions, from
which they get their name. We have, for example,
a0 +
1
a1 +
1
a2 + 1
a3
= K(a0, a1, a2, a3)
K(a1, a2, a3)
.
(6.135)
The same pattern holds for continued fractions of any depth.
It is easily
proved by induction; we have, for example,
K(a0, a1, a2, a3 + 1/a4)
K(a1, a2, a3 + 1/a4)
= K(a0, a1, a2, a3, a4)
K(a1, a2, a3, a4)
,
because of the identity
Kn(x1, . . . , xn‚àí1, xn + y)
= Kn(x1, . . . , xn‚àí1, xn) + Kn‚àí1(x1, . . . , xn‚àí1)y .
(6.136)
(This identity is proved and generalized in exercise 30.)

6.7 CONTINUANTS 305
Moreover, continuants are closely connected with the Stern{Brocot tree
discussed in Chapter 4.
Each node in that tree can be represented as a
sequence of L's and R's, say
Ra0La1Ra2La3 . . . Ran‚àí2Lan‚àí1 ,
(6.137)
where a0  0, a1  1, a2  1, a3  1, . . . , an‚àí2  1, an‚àí1  0, and n is
even. Using the 2 √ó 2 matrices L and R of (4.33), it is not hard to prove by
induction that the matrix equivalent of (6.137) is
¬µ
Kn‚àí2(a1, . . . , an‚àí2)
Kn‚àí1(a1, . . . , an‚àí2, an‚àí1)
Kn‚àí1(a0, a1, . . . , an‚àí2)
Kn(a0, a1, . . . , an‚àí2, an‚àí1)
¬∂
.
(6.138)
(The proof is part of exercise 87.) For example,
RaLbRcLd =
¬µ
bc + 1
bcd + b + d
abc + a + c
abcd + ab + ad + cd + 1
¬∂
.
Finally, therefore, we can use (4.34) to write a closed form for the fraction in
the Stern{Brocot tree whose L-and-R representation is (6.137):
f(Ra0 . . . Lan‚àí1) = Kn+1(a0, a1, . . . , an‚àí1, 1)
Kn(a1, . . . , an‚àí1, 1)
.
(6.139)
(This is \Halphen's theorem" [174].) For example, to nd the fraction for
LRRL we have a0 = 0, a1 = 1, a2 = 2, a3 = 1, and n = 4; equation (6.139)
gives
K(0, 1, 2, 1, 1)
K(1, 2, 1, 1)
=
K(2, 1, 1)
K(1, 2, 1, 1) = K(2, 2)
K(3, 2) = 5
7 .
(We have used the rule Kn(x1, . . . , xn‚àí1, xn + 1) = Kn+1(x1, . . . , xn‚àí1, xn, 1)
to absorb leading and trailing 1's in the parameter lists; this rule is obtained
by setting y = 1 in (6.136).)
A comparison of (6.135) and (6.139) shows that the fraction correspond-
ing to a general node (6.137) in the Stern{Brocot tree has the continued
fraction representation
f(Ra0 . . . Lan‚àí1) = a0 +
1
a1 +
1
a2 +
1
. . . +
1
an‚àí1 + 1
1
.
(6.140)

306 SPECIAL NUMBERS
Thus we can convert at sight between continued fractions and the correspond-
ing nodes in the Stern{Brocot tree. For example,
f(LRRL) = 0 +
1
1 +
1
2 +
1
1 + 1
1
.
We observed in Chapter 4 that irrational numbers dene innite paths in
the Stern{Brocot tree, and that they can be represented as an innite string
of L's and R's. If the innite string for Œ± is Ra0La1Ra2La3 . . . , there is a
corresponding innite continued fraction
Œ± = a0 +
1
a1 +
1
a2 +
1
a3 +
1
a4 +
1
a5 + 1
...
.
(6.141)
This innite continued fraction can also be obtained directly: Let Œ±0 = Œ± and
for k  0 let
ak = ‚åäŒ±k‚åã;
Œ±k = ak +
1
Œ±k+1
.
(6.142)
The a's are called the \partial quotients" of Œ±. If Œ± is rational, say m/n,
this process runs through the quotients found by Euclid's algorithm and then
stops (with Œ±k+1 = ‚àû).
Is Euler's constant Œ≥ rational or irrational? Nobody knows. We can get
Or if they do,
they're not talking.
partial information about this famous unsolved problem by looking for Œ≥ in
the Stern{Brocot tree; if it's rational we will nd it, and if it's irrational we
will nd all the closest rational approximations to it. The continued fraction
for Œ≥ begins with the following partial quotients:
k
0
1
2
3
4
5
6
7
8
ak
0
1
1
2
1
2
1
4
3
Therefore its Stern{Brocot representation begins LRLLRLLRLLLLRRRL . . . ; no
pattern is evident. Calculations by Richard Brent [38] have shown that, if Œ≥
is rational, its denominator must be more than 10,000 decimal digits long.

6.7 CONTINUANTS 307
Therefore nobody believes that Œ≥ is rational; but nobody so far has been able
Well, Œ≥ must be
irrational, because
of a little-known
Einsteinian asser-
tion: \God does
not throw huge
denominators at
the universe."
to prove that it isn't.
Let's conclude this chapter by proving a remarkable identity that ties a lot
of these ideas together. We introduced the notion of spectrum in Chapter 3;
the spectrum of Œ± is the multiset of numbers ‚åänŒ±‚åã, where Œ± is a given constant.
The innite series
X
n1
z‚åänœÜ‚åã= z + z3 + z4 + z6 + z8 + z9 + ¬∑ ¬∑ ¬∑
can therefore be said to be the generating function for the spectrum of œÜ,
where œÜ = (1 +
‚àö
5)/2 is the golden ratio. The identity we will prove, dis-
covered in 1976 by J. L. Davison [73], is an innite continued fraction that
relates this generating function to the Fibonacci sequence:
zF1
1 +
zF2
1 +
zF3
1 + zF4
...
= (1 ‚àíz)
X
n1
z‚åänœÜ‚åã.
(6.143)
Both sides of (6.143) are interesting; let's look rst at the numbers ‚åänœÜ‚åã.
If the Fibonacci representation (6.113) of n is Fk1 + ¬∑ ¬∑ ¬∑ + Fkr, we expect nœÜ
to be approximately Fk1+1 +¬∑ ¬∑ ¬∑+Fkr+1, the number we get from shifting the
Fibonacci representation left (as when converting from miles to kilometers).
In fact, we know from (6.125) that
nœÜ = Fk1+1 + ¬∑ ¬∑ ¬∑ + Fkr+1 ‚àí
¬°bœÜk1 + ¬∑ ¬∑ ¬∑ + bœÜkr¬¢
.
Now bœÜ = ‚àí1/œÜ and k1 ‚â´¬∑ ¬∑ ¬∑ ‚â´kr ‚â´0, so we have
¬Ø¬ØbœÜk1 + ¬∑ ¬∑ ¬∑ + bœÜkr¬Ø¬Ø < œÜ‚àíkr + œÜ‚àíkr‚àí2 + œÜ‚àíkr‚àí4 + ¬∑ ¬∑ ¬∑
=
œÜ‚àíkr
1 ‚àíœÜ‚àí2 = œÜ1‚àíkr  œÜ‚àí1 < 1 ;
and bœÜk1 + ¬∑ ¬∑ ¬∑ + bœÜkr has the same sign as (‚àí1)kr, by a similar argument.
Hence
‚åänœÜ‚åã= Fk1+1 + ¬∑ ¬∑ ¬∑ + Fkr+1
‚àí
¬£
kr(n) is even
¬§
.
(6.144)
Let us say that a number n is Fibonacci odd (or F-odd for short) if its least
signicant Fibonacci bit is 1; this is the same as saying that kr(n) = 2.
Otherwise n is Fibonacci even (F-even). For example, the smallest F-odd

308 SPECIAL NUMBERS
numbers are 1, 4, 6, 9, 12, 14, 17, and 19. If kr(n) is even, then n ‚àí1 is
F-even, by (6.114); similarly, if kr(n) is odd, then n ‚àí1 is F-odd. Therefore
kr(n) is even
‚áê‚áí
n ‚àí1 is F-even.
Furthermore, if kr(n) is even, (6.144) implies that kr
¬°
‚åänœÜ‚åã
¬¢
= 2; if kr(n) is
odd, (6.144) says that kr
¬°
‚åänœÜ‚åã
¬¢
= kr(n) + 1. Therefore kr
¬°
‚åänœÜ‚åã
¬¢
is always
even, and we have proved that
‚åänœÜ‚åã‚àí1 is always F-even.
Conversely, if m is any F-even number, we can reverse this computation and
nd an n such that m + 1 = ‚åänœÜ‚åã. (First add 1 in F-notation as explained
earlier. If no carries occur, n is (m + 2) shifted right; otherwise n is (m + 1)
shifted right.) The right-hand sum of (6.143) can therefore be written
X
n1
z‚åänœÜ‚åã= z
X
m0
zm[m is F-even] .
(6.145)
How about the fraction on the left? Let's rewrite (6.143) so that the
continued fraction looks like (6.141), with all numerators 1:
1
z‚àíF0 +
1
z‚àíF1 +
1
z‚àíF2 + 1
...
= 1 ‚àíz
z
X
n1
z‚åänœÜ‚åã.
(6.146)
(This transformation is a bit tricky! The numerator and denominator of the
original fraction having zFn as numerator should be divided by zFn‚àí1.) If
we stop this new continued fraction at 1/z‚àíFn, its value will be a ratio of
continuants,
Kn+2(0, z‚àíF0, z‚àíF1, . . . , z‚àíFn)
Kn+1(z‚àíF0, z‚àíF1, . . . , z‚àíFn)
=
Kn(z‚àíF1, . . . , z‚àíFn)
Kn+1(z‚àíF0, z‚àíF1, . . . , z‚àíFn) ,
as in (6.135). Let's look at the denominator rst, in hopes that it will be
tractable. Setting Qn = Kn+1(z‚àíF0, . . . , z‚àíFn), we nd Q0 = 1, Q1 = 1+z‚àí1,
Q2 = 1+z‚àí1 +z‚àí2, Q3 = 1+z‚àí1 +z‚àí2 +z‚àí3 +z‚àí4, and in general everything
ts beautifully and gives a geometric series
Qn = 1 + z‚àí1 + z‚àí2 + ¬∑ ¬∑ ¬∑ + z‚àí(Fn+2‚àí1) .

6.7 CONTINUANTS 309
The corresponding numerator is Pn = Kn(z‚àíF1, . . . , z‚àíFn); this turns out to
be like Qn but with fewer terms. For example, we have
P5 = z‚àí1 + z‚àí2 + z‚àí4 + z‚àí5 + z‚àí7 + z‚àí9 + z‚àí10 + z‚àí12 ,
compared with Q5 = 1 + z‚àí1 + ¬∑ ¬∑ ¬∑ + z‚àí12. A closer look reveals the pattern
governing which terms are present: We have
P5 = 1+z2+z3+z5+z7+z8+z10+z11
z12
= z‚àí12
12
X
m=0
zm [m is F-even] ;
and in general we can prove by induction that
Pn = z1‚àíFn+2
Fn+2‚àí1
X
m=0
zm [m is F-even] .
Therefore
Pn
Qn
=
PFn+2‚àí1
m=0
zm [m is F-even]
PFn+2‚àí1
m=0
zm
.
Taking the limit as n ‚Üí‚àûnow gives (6.146), because of (6.145).
Exercises
Warmups
1
What are the
¬£4
2
¬§
= 11 permutations of f1, 2, 3, 4g that have exactly two
cycles? (The cyclic forms appear in (6.4); non-cyclic forms like 2314 are
desired instead.)
2
There are mn functions from a set of n elements into a set of m elements.
How many of them range over exactly k dierent function values?
3
Card stackers in the real world know that it's wise to allow a bit of slack
so that the cards will not topple over when a breath of wind comes along.
Suppose the center of gravity of the top k cards is required to be at least
œµ units from the edge of the k + 1st card. (Thus, for example, the rst
card can overhang the second by at most 1‚àíœµ units.) Can we still achieve
arbitrarily large overhang, if we have enough cards?
4
Express 1/1 + 1/3 + ¬∑ ¬∑ ¬∑ + 1/(2n+1) in terms of harmonic numbers.
5
Explain how to get the recurrence (6.75) from the denition of Un(x, y)
in (6.74), and solve the recurrence.

310 SPECIAL NUMBERS
6
An explorer has left a pair of baby rabbits on an island. If baby rabbits
become adults after one month, and if each pair of adult rabbits produces
If the harmonic
numbers are worm
numbers, the Fi-
bonacci numbers
are rabbit numbers.
one pair of baby rabbits every month, how many pairs of rabbits are
present after n months? (After two months there are two pairs, one of
which is newborn.) Find a connection between this problem and the \bee
tree" in the text.
7
Show that Cassini's identity (6.103) is a special case of (6.108), and a
special case of (6.134).
8
Use the Fibonacci number system to convert 65 mi/hr into an approxi-
mate number of km/hr.
9
About how many square kilometers are in 8 square miles?
10
What is the continued fraction representation of œÜ?
Basics
11
What is P
k(‚àí1)k¬£n
k
¬§
, the row sum of Stirling's cycle-number triangle
with alternating signs, when n is a nonnegative integer?
12
Prove that Stirling numbers have an inversion law analogous to (5.48):
g(n) =
X
k
¬Øn
k
¬∞
(‚àí1)kf(k)
‚áê‚áí
f(n) =
X
k
¬∑n
k
¬∏
(‚àí1)kg(k) .
13
The dierential operators D =
d
dz and œë = zD are mentioned in Chapters
2 and 5. We have
œë2 = z2D2 + zD ,
because œë2f(z) = œëzf‚Ä≤(z) = z d
dzzf‚Ä≤(z) = z2f‚Ä≤‚Ä≤(z) + zf‚Ä≤(z), which is
(z2D2+zD)f(z). Similarly it can be shown that œë3 = z3D3+3z2D2+zD.
Prove the general formulas
œën =
X
k
¬Øn
k
¬∞
zkDk ,
znDn =
X
k
¬∑n
k
¬∏
(‚àí1)n‚àíkœëk ,
for all n  0. (These can be used to convert between dierential expres-
sions of the forms P
k Œ±kzkf(k)(z) and P
k Œ≤kœëkf(z), as in (5.109).)
14
Prove the power identity (6.37) for Eulerian numbers.
15
Prove the Eulerian identity (6.39) by taking the mth dierence of (6.37).

6 EXERCISES 311
16
What is the general solution of the double recurrence
An,0 = an [n  0] ;
A0,k = 0 ,
if k > 0;
An,k = kAn‚àí1,k + An‚àí1,k‚àí1 ,
integers k, n,
when k and n range over the set of all integers?
17
Solve the following recurrences, assuming that
¬Ø¬Øn
k
¬Ø¬Ø is zero when n < 0 or
k < 0:
a
¬Ø¬Ø¬Ø¬Ø
n
k
¬Ø¬Ø¬Ø¬Ø =
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k
¬Ø¬Ø¬Ø¬Ø + n
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k ‚àí1
¬Ø¬Ø¬Ø¬Ø + [n = k = 0] ,
for n, k  0.
b
¬Ø¬Ø¬Ø¬Ø
n
k
¬Ø¬Ø¬Ø¬Ø = (n ‚àík)
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k
¬Ø¬Ø¬Ø¬Ø +
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k ‚àí1
¬Ø¬Ø¬Ø¬Ø + [n = k = 0] ,
for n, k  0.
c
¬Ø¬Ø¬Ø¬Ø
n
k
¬Ø¬Ø¬Ø¬Ø = k
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k
¬Ø¬Ø¬Ø¬Ø + k
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k ‚àí1
¬Ø¬Ø¬Ø¬Ø + [n = k = 0] ,
for n, k  0.
18
Prove that the Stirling polynomials satisfy
(x + 1) œÉn(x + 1) = (x ‚àín) œÉn(x) + xœÉn‚àí1(x) .
19
Prove that the generalized Stirling numbers satisfy
n
X
k=0
¬Øx + k
x
¬∞¬∑
x
x ‚àín + k
¬∏
(‚àí1)k
√Å¬µx + k
n + 1
¬∂
= 0 ,
integer n > 0.
n
X
k=0
¬∑x + k
x
¬∏¬Ø
x
x ‚àín + k
¬∞
(‚àí1)k
√Å¬µx + k
n + 1
¬∂
= 0 ,
integer n > 0.
20
Find a closed form for Pn
k=1 H(2)
k .
21
Show that if Hn = an/bn, where an and bn are integers, the denomina-
tor bn is a multiple of 2‚åälg n‚åã. Hint: Consider the number 2‚åälg n‚åã‚àí1Hn ‚àí
1
2.
22
Prove that the innite sum
X
k1
¬µ1
k ‚àí
1
k + z
¬∂
converges for all complex numbers z, except when z is a negative integer;
and show that it equals Hz when z is a nonnegative integer. (Therefore we
can use this formula to dene harmonic numbers Hz when z is complex.)
23
Equation (6.81) gives the coecients of z/(ez ‚àí1), when expanded in
powers of z. What are the coecients of z/(ez + 1)? Hint: Consider the
identity (ez + 1)(ez ‚àí1) = e2z ‚àí1.

312 SPECIAL NUMBERS
24
Prove that the tangent number T2n+1 is a multiple of 2n. Hint: Prove
that all coecients of T2n(x) and T2n+1(x) are multiples of 2n.
25
Equation (6.57) proves that the worm will eventually reach the end of
the rubber band at some time N.
Therefore there must come a rst
time n when he's closer to the end after n minutes than he was after
n ‚àí1 minutes. Show that n < 1
2N.
26
Use summation by parts to evaluate Sn = Pn
k=1 Hk/k. Hint: Consider
also the related sum Pn
k=1 Hk‚àí1/k.
27
Prove the gcd law (6.111) for Fibonacci numbers.
28
The Lucas number Ln is dened to be Fn+1 + Fn‚àí1. Thus, according to
(6.109), we have F2n = FnLn. Here is a table of the rst few values:
n
0
1
2
3
4
5
6
7
8
9
10
11
12
13
Ln
2
1
3
4
7
11
18
29
47
76
123
199
322
521
a
Use the repertoire method to show that the solution Qn to the gen-
eral recurrence
Q0 = Œ± ;
Q1 = Œ≤ ;
Qn = Qn‚àí1 + Qn‚àí2 ,
n > 1
can be expressed in terms of Fn and Ln.
b
Find a closed form for Ln in terms of œÜ and bœÜ.
29
Prove Euler's identity for continuants, equation (6.134).
30
Generalize (6.136) to nd an expression for the incremented continuant
K(x1, . . . , xm‚àí1, xm + y, xm+1, . . . , xn), when 1  m  n.
Homework exercises
31
Find a closed form for the coecients
¬Ø¬Øn
k
¬Ø¬Ø in the representation of rising
powers by falling powers:
xn =
X
k
¬Ø¬Ø¬Ø¬Ø
n
k
¬Ø¬Ø¬Ø¬Øxk ,
integer n  0.
¬°
For example, x4 = x4 + 12x3 + 36x2 + 24x1, hence
¬Ø¬Ø4
2
¬Ø¬Ø = 36.
¬¢
.
32
In Chapter 5 we obtained the formulas
X
km
¬µn + k
k
¬∂
=
¬µn + m + 1
m
¬∂
and
X
0km
¬µk
n
¬∂
=
¬µm + 1
n + 1
¬∂
by unfolding the recurrence
¬°n
k
¬¢
=
¬°n‚àí1
k
¬¢
+
¬°n‚àí1
k‚àí1
¬¢
in two ways. What
identities appear when the analogous recurrence
¬©n
k
¬™
= k
¬©n‚àí1
k
¬™
+
¬©n‚àí1
k‚àí1
¬™
is unwound?

6 EXERCISES 313
33
Table 264 gives the values of
¬£n
2
¬§
and
¬©n
2
¬™
. What are closed forms (not
involving Stirling numbers) for the next cases,
¬£n
3
¬§
and
¬©n
3
¬™
?
34
What are
¬≠‚àí1
k
¬Æ
and
¬≠‚àí2
k
¬Æ
, if the basic recursion relation (6.35) is assumed
to hold for all integers k and n, and if
¬≠n
k
¬Æ
= 0 for all k < 0?
35
Prove that, for every œµ > 0, there exists an integer n > 1 (depending
on œµ) such that Hn mod 1 < œµ.
36
Is it possible to stack n bricks in such a way that the topmost brick is not
above any point of the bottommost brick, yet a person who weighs the
same as 100 bricks can balance on the middle of the top brick without
toppling the pile?
37
Express Pmn
k=1(k mod m)/k(k + 1) in terms of harmonic numbers, as-
suming that m and n are positive integers. What is the limiting value
as n ‚Üí‚àû?
38
Find the indenite sum P ¬°r
k
¬¢
(‚àí1)kHk Œ¥k.
39
Express Pn
k=1 H2
k in terms of n and Hn.
40
Prove that 1979 divides the numerator of P1319
k=1 (‚àí1)k‚àí1/k, and give a
similar result for 1987.
Hint:
Use Gauss's trick to obtain a sum of
Ah! Those were
prime years.
fractions whose numerators are 1979. See also exercise 4.
41
Evaluate the sum
X
k
¬µ¬•
(n + k)/2
¬¶
k
¬∂
in closed form, when n is an integer (possibly negative).
42
If S is a set of integers, let S + 1 be the \shifted" set fx + 1 | x ‚ààSg.
How many subsets of f1, 2, . . . , ng have the property that S ‚à™(S + 1) =
f1, 2, . . . , n + 1g?
43
Prove that the innite sum
.1
+ .01
+ .002
+ .0003
+ .00005
+ .000008
+ .0000013
...
converges to a rational number.

314 SPECIAL NUMBERS
44
Prove the converse of Cassini's identity (6.106): If k and m are integers
such that jm2‚àíkm‚àík2j = 1, then there is an integer n such that k = ¬±Fn
and m = ¬±Fn+1.
45
Use the repertoire method to solve the general recurrence
X0 = Œ± ;
X1 = Œ≤ ;
Xn = Xn‚àí1 + Xn‚àí2 + Œ≥n + Œ¥ .
46
What are cos 36‚ó¶and cos 72‚ó¶?
47
Show that
2n‚àí1Fn =
X
k
¬µ
n
2k+1
¬∂
5k ,
and use this identity to deduce the values of Fp mod p and Fp+1 mod p
when p is prime.
48
Prove that zero-valued parameters can be removed from continuant poly-
nomials by collapsing their neighbors together:
Kn(x1, . . . , xm‚àí1, 0, xm+1, . . . , xn)
= Kn‚àí2(x1, . . . , xm‚àí2, xm‚àí1+xm+1, xm+2, . . . , xn) ,
1 < m < n.
49
Find the continued fraction representation of the number P
n1 2‚àí‚åänœÜ‚åã.
50
Dene f(n) for all positive integers n by the recurrence
f(1) = 1 ;
f(2n) = f(n) ;
f(2n + 1) = f(n) + f(n + 1) .
a
For which n is f(n) even?
b
Show that f(n) can be expressed in terms of continuants.
Exam problems
51
Let p be a prime number.
a
Prove that
¬©p
k
¬™
‚â°
¬£p
k
¬§
‚â°0 (mod p), for 1 < k < p.
b
Prove that
¬£p‚àí1
k
¬§
‚â°1 (mod p), for 1  k < p.
c
Prove that
¬©2p‚àí2
p
¬™
‚â°
¬£2p‚àí2
p
¬§
‚â°0 (mod p), if p > 2.
d
Prove that if p > 3 we have
¬£p
2
¬§
‚â°0 (mod p2). Hint: Consider pp.
52
Let Hn be written in lowest terms as an/bn.
a
Prove that pnbn ‚áê‚áíp//na‚åän/p‚åã, if p is prime.
b
Find all n > 0 such that an is divisible by 5.

6 EXERCISES 315
53
Find a closed form for Pm
k=0
¬°n
k
¬¢‚àí1(‚àí1)kHk, when 0  m  n. Hint:
Exercise 5.42 has the sum without the Hk factor.
54
Let n > 0. The purpose of this exercise is to show that the denominator
of B2n is the product of all primes p such that (p‚àí1)n(2n).
a
Show that Sm(p) +
¬£
(p‚àí1)nm
¬§
is a multiple of p, when p is prime
and m > 0.
b
Use the result of part (a) to show that
B2n +
X
p prime
¬£
(p‚àí1)n(2n)
¬§
p
= I2n
is an integer.
Hint: It suces to prove that, if p is any prime, the denominator of
the fraction B2n +
¬£
(p‚àí1)n(2n)
¬§
/p is not divisible by p.
c
Prove that the denominator of B2n is always an odd multiple of 6,
and it is equal to 6 for innitely many n.
55
Prove (6.70) as a corollary of a more general identity, by summing
X
0k<n
¬µ k
m
¬∂¬µx + k
k
¬∂
and dierentiating with respect to x.
56
Evaluate P
kÃ∏=m
¬°n
k
¬¢
(‚àí1)kkn+1/(k ‚àím) in closed form as a function of
the integers m and n. (The sum is over all integers k except for the value
k = m.)
57
The \wraparound binomial coecients of order 5" are dened by
¬µ¬µn
k
¬∂¬∂
=
¬µ¬µn ‚àí1
k
¬∂¬∂
+
¬µ¬µ
n ‚àí1
(k ‚àí1) mod 5
¬∂¬∂
,
n > 0,
and
¬°¬°0
k
¬¢¬¢
= [k = 0]. Let Qn be the dierence between the largest and
smallest of these numbers in row n:
Qn =
max
0k<5
¬µ¬µn
k
¬∂¬∂
‚àí
min
0k<5
¬µ¬µn
k
¬∂¬∂
.
Find and prove a relation between Qn and the Fibonacci numbers.
58
Find closed forms for P
n0 F2
nzn and P
n0 F3
nzn. What do you deduce
about the quantity F3
n+1 ‚àí4F3
n ‚àíF3
n‚àí1?
59
Prove that if m and n are positive integers, there exists an integer x such
that Fx ‚â°m (mod 3n).
60
Find all positive integers n such that either Fn + 1 or Fn ‚àí1 is a prime
number.

316 SPECIAL NUMBERS
61
Prove the identity
n
X
k=0
1
F2k = 3 ‚àíF2n‚àí1
F2n
,
integer n  1.
What is Pn
k=0 1/F3¬∑2k?
62
Let An = œÜn + œÜ‚àín and Bn = œÜn ‚àíœÜ‚àín.
a
Find constants Œ± and Œ≤ such that An = Œ±An‚àí1 + Œ≤An‚àí2 and Bn =
Œ±Bn‚àí1 + Œ≤Bn‚àí2 for all n  0.
b
Express An and Bn in terms of Fn and Ln (see exercise 28).
c
Prove that Pn
k=1 1/(F2k+1 + 1) = Bn/An+1.
d
Find a closed form for Pn
k=1 1/(F2k+1 ‚àí1).
Bonus problems
Bogus problems
63
How many permutations œÄ1œÄ2 . . . œÄn of f1, 2, . . . , ng have exactly k in-
dices j such that
a
œÄi < œÄj for all i < j? (Such j are called \left-to-right maxima.")
b
œÄj > j? (Such j are called \excedances.")
64
What is the denominator of
¬£
1/2
1/2‚àín
¬§
, when this fraction is reduced to
lowest terms?
65
Prove the identity
Z 1
0
. . .
Z 1
0
f
¬°
‚åäx1 + ¬∑ ¬∑ ¬∑ + xn‚åã
¬¢
dx1 . . . dxn =
X
k
¬øn
k
√Äf(k)
n! .
66
What is P
k(‚àí1)k¬≠n
k
¬Æ
, the nth alternating row sum of Euler's triangle?
67
Prove that
X
k
¬Øn + 1
k + 1
¬∞¬µn ‚àík
m ‚àík
¬∂
(‚àí1)m‚àíkk! =
¬øn
m
√Ä
.
68
Show that
¬≠¬≠n
1
¬Æ¬Æ
= 2
¬≠n
1
¬Æ
, and nd a closed form for
¬≠¬≠n
2
¬Æ¬Æ
.
69
Find a closed form for Pn
k=1 k2Hn+k.
70
Show that the complex harmonic numbers of exercise 22 have the power
series expansion Hz = P
n2(‚àí1)nH(n)
‚àûzn‚àí1.
71
Prove that the generalized factorial of equation (5.83) can be written
Y
k1
¬≥
1 + z
k
¬¥
e‚àíz/k = eŒ≥z
z! ,
by considering the limit as n ‚Üí‚àûof the rst n factors of this innite
product. Show that
d
dz(z!) is related to the general harmonic numbers
of exercise 22.

6 EXERCISES 317
72
Prove that the tangent function has the power series (6.92), and nd the
corresponding series for z/sin z and ln
¬°
(tan z)/z
¬¢
.
73
Prove that z cot z is equal to
z
2n cot z
2n ‚àíz
2n tan z
2n +
2n‚àí1
X
k=1
z
2n
¬µ
cot z + kœÄ
2n
+ cot z ‚àíkœÄ
2n
¬∂
,
for all integers n  1, and show that the limit of the kth summand is
2z2/(z2 ‚àík2œÄ2) for xed k as n ‚Üí‚àû.
74
Find a relation between the numbers Tn(1) and the coecients of 1/cos z.
75
Prove that the tangent numbers and the coecients of 1/cos z appear at
the edges of the innite triangle that begins as follows:
1
0
1
1
1
0
0
1
2
2
5
5
4
2
0
0
5
10
14
16
16
61
61
56
46
32
16
0
Each row contains partial sums of the previous row, going alternately left-
to-right and right-to-left. Hint: Consider the coecients of the power
series (sin z + cos z)/ cos(w + z).
76
Find a closed form for the sum
X
k
(‚àí1)k
¬Øn
k
¬∞
2n‚àíkk! ,
and show that it is zero when n is even.
77
When m and n are integers, n  0, the value of œÉn(m) is given by (6.48)
if m < 0, by (6.49) if m  n, and by (6.101) if m = 0. Show that in the
remaining cases we have
œÉn(m) = (‚àí1)m+n‚àí1
m! (n ‚àím)!
m‚àí1
X
k=0
¬∑
m
m ‚àík
¬∏Bn‚àík
n ‚àík ,
integer n > m > 0.
78
Prove the following relation that connects Stirling numbers, Bernoulli
numbers, and Catalan numbers:
n
X
k=0
¬Øn + k
k
¬∞¬µ 2n
n + k
¬∂(‚àí1)k
k + 1
= Bn
¬µ2n
n
¬∂
1
n + 1 .
79
Show that the four chessboard pieces of the 64 = 65 paradox can also be
reassembled to prove that 64 = 63.

318 SPECIAL NUMBERS
80
A sequence dened by the recurrence A1 = x, A2 = y, and An = An‚àí1 +
An‚àí2 has Am = 1000000 for some m. What positive integers x and y
make m as large as possible?
81
The text describes a way to change a formula involving Fn¬±k to a formula
that involves Fn and Fn+1 only. Therefore it's natural to wonder if two
such \reduced" formulas can be equal when they aren't identical in form.
Let P(x, y) be a polynomial in x and y with integer coecients. Find a
necessary and sucient condition that P(Fn+1, Fn) = 0 for all n  0.
82
Explain how to add positive integers, working entirely in the Fibonacci
number system.
83
Is it possible that a sequence ‚ü®An‚ü©satisfying the Fibonacci recurrence
An = An‚àí1 + An‚àí2 can contain no prime numbers, if A0 and A1 are
relatively prime?
84
Let m and n be odd, positive integers. Find closed forms for
S+
m,n =
X
k0
1
F2mk+n + Fm
;
S‚àí
m,n =
X
k0
1
F2mk+n ‚àíFm
.
Hint: The sums in exercise 62 are S+
1,3 ‚àíS+
1,2n+3 and S‚àí
1,3 ‚àíS‚àí
1,2n+3.
85
Characterize all N such that the Fibonacci residues Fn mod N for n  0
form the complete set f0, 1, . . . , N ‚àí1g. (See exercise 59.)
86
Let C1, C2, . . . be a sequence of nonzero integers such that
gcd(Cm, Cn) = Cgcd(m,n)
for all positive integers m and n. Prove that the generalized binomial
coecients
¬µn
k
¬∂
C
= CnCn‚àí1 . . . Cn‚àík+1
CkCk‚àí1 . . . C1
are all integers. (In particular, the \Fibonomial coecients" formed in
this way from Fibonacci numbers are integers, by (6.111).)
87
Show that continuant polynomials appear in the matrix product
¬µ
0
1
1
x1
¬∂ ¬µ
0
1
1
x2
¬∂
. . .
¬µ
0
1
1
xn
¬∂

6 EXERCISES 319
and in the determinant
det
Ô£´
Ô£¨
Ô£¨
Ô£¨
Ô£¨
Ô£¨
Ô£¨
Ô£≠
x1
1
0
0
. . .
0
‚àí1
x2
1
0
0
0
‚àí1
x3
1
...
‚àí1
...
...
1
0
0
. . .
‚àí1
xn
Ô£∂
Ô£∑
Ô£∑
Ô£∑
Ô£∑
Ô£∑
Ô£∑
Ô£∏
.
88
Generalizing (6.146), nd a continued fraction related to the generating
function P
n1 z‚åänŒ±‚åã, when Œ± is any positive irrational number.
89
Let Œ± be an irrational number in (0 . . 1) and let a1, a2, a3, . . . be
the partial quotients in its continued fraction representation. Show that
¬Ø¬ØD(Œ±, n)
¬Ø¬Ø < 2 when n = K(a1, . . . , am), where D is the discrepancy
dened in Chapter 3.
90
Let Qn be the largest denominator on level n of the Stern{Brocot tree.
(Thus ‚ü®Q0, Q1, Q2, Q3, Q4, . . . ‚ü©= ‚ü®1, 2, 3, 5, 8, . . . ‚ü©according to the dia-
gram in Chapter 4.) Prove that Qn = Fn+2.
Research problems
91
What is the best way to extend the denition of
¬©n
k
¬™
to arbitrary real
values of n and k?
92
Let Hn be written in lowest terms as an/bn, as in exercise 52.
a
Are there innitely many n with 11nan?
b
Are there innitely many n with bn = lcm(1, 2, . . . , n)? (Two such
values are n = 250 and n = 1000.)
93
Prove that Œ≥ and eŒ≥ are irrational.
94
Develop a general theory of the solutions to the two-parameter recurrence
¬Ø¬Ø¬Ø¬Ø
n
k
¬Ø¬Ø¬Ø¬Ø = (Œ±n + Œ≤k + Œ≥)
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k
¬Ø¬Ø¬Ø¬Ø
+ (Œ±‚Ä≤n + Œ≤‚Ä≤k + Œ≥‚Ä≤)
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k ‚àí1
¬Ø¬Ø¬Ø¬Ø + [n = k = 0] ,
for n, k  0,
assuming that
¬Ø¬Øn
k
¬Ø¬Ø = 0 when n < 0 or k < 0. (Binomial coecients,
Stirling numbers, Eulerian numbers, and the sequences of exercises 17
and 31 are special cases.) What special values (Œ±, Œ≤, Œ≥, Œ±‚Ä≤, Œ≤‚Ä≤, Œ≥‚Ä≤) yield
\fundamental solutions" in terms of which the general solution can be
expressed?
95
Find an ecient way to extend the Gosper-Zeilberger algorithm from
hypergeometric terms to terms that may involve Stirling numbers.

7
Generating Functions
THE MOST POWERFUL WAY to deal with sequences of numbers, as far
as anybody knows, is to manipulate innite series that \generate" those se-
quences. We've learned a lot of sequences and we've seen a few generating
functions; now we're ready to explore generating functions in depth, and to
see how remarkably useful they are.
7.1
DOMINO THEORY AND CHANGE
Generating functions are important enough, and for many of us new
enough, to justify a relaxed approach as we begin to look at them more closely.
So let's start this chapter with some fun and games as we try to develop our
intuitions about generating functions. We will study two applications of the
ideas, one involving dominoes and the other involving coins.
How many ways Tn are there to completely cover a 2 √ó n rectangle with
2 √ó 1 dominoes? We assume that the dominoes are identical (either because
they're face down, or because someone has rendered them indistinguishable,
say by painting them all red); thus only their orientations | vertical or hori-
zontal | matter, and we can imagine that we're working with domino-shaped
tiles. For example, there are three tilings of a 2 √ó 3 rectangle, namely
,
,
and
; so T3 = 3.
To nd a closed form for general Tn we do our usual rst thing, look at
\Let me count the
ways."
|E.B. Browning
small cases. When n = 1 there's obviously just one tiling, ; and when n = 2
there are two,
and
.
How about when n = 0; how many tilings of a 2 √ó 0 rectangle are there?
It's not immediately clear what this question means, but we've seen similar
situations before: There is one permutation of zero objects (namely the empty
permutation), so 0! = 1. There is one way to choose zero things from n things
(namely to choose nothing), so
¬°n
0
¬¢
= 1. There is one way to partition the
empty set into zero nonempty subsets, but there are no such ways to partition
a nonempty set; so
¬©n
0
¬™
= [n = 0]. By such reasoning we can conclude that
321

322 GENERATING FUNCTIONS
there's just one way to tile a 2 √ó 0 rectangle with dominoes, namely to use
no dominoes; therefore T0 = 1. (This spoils the simple pattern Tn = n that
holds when n = 1, 2, and 3; but that pattern was probably doomed anyway,
since T0 wants to be 1 according to the logic of the situation.)
A proper
understanding of the null case turns out to be useful whenever we want to
solve an enumeration problem.
Let's look at one more small case, n = 4. There are two possibilities for
tiling the left edge of the rectangle | we put either a vertical domino or two
horizontal dominoes there. If we choose a vertical one, the partial solution is
and the remaining 2 √ó 3 rectangle can be covered in T3 ways. If we choose
two horizontals, the partial solution
can be completed in T2 ways. Thus
T4 = T3 + T2 = 5. (The ve tilings are
,
,
,
, and
.)
We now know the rst ve values of Tn:
n
0
1
2
3
4
Tn
1
1
2
3
5
These look suspiciously like the Fibonacci numbers, and it's not hard to see
why: The reasoning we used to establish T4 = T3 + T2 easily generalizes to
Tn = Tn‚àí1 + Tn‚àí2, for n  2. Thus we have the same recurrence here as for
the Fibonacci numbers, except that the initial values T0 = 1 and T1 = 1 are a
little dierent. But these initial values are the consecutive Fibonacci numbers
F1 and F2, so the T's are just Fibonacci numbers shifted up one place:
Tn = Fn+1 ,
for n  0.
(We consider this to be a closed form for Tn, because the Fibonacci numbers
are important enough to be considered \known." Also, Fn itself has a closed
form (6.123) in terms of algebraic operations.)
Notice that this equation
conrms the wisdom of setting T0 = 1.
But what does all this have to do with generating functions? Well, we're
about to get to that | there's another way to gure out what Tn is. This new
way is based on a bold idea. Let's consider the \sum" of all possible 2 √ó n
To boldly go
where no tiling has
gone before.
tilings, for all n  0, and call it T:
T = + +
+
+
+
+
+ ¬∑ ¬∑ ¬∑ .
(7.1)
(The rst term ` ' on the right stands for the null tiling of a 2 √ó 0 rectangle.)
This sum T represents lots of information. It's useful because it lets us prove
things about T as a whole rather than forcing us to prove them (by induction)
about its individual terms.
The terms of this sum stand for tilings, which are combinatorial objects.
We won't be fussy about what's considered legal when innitely many tilings

7.1 DOMINO THEORY AND CHANGE 323
are added together; everything can be made rigorous, but our goal right now
is to expand our consciousness beyond conventional algebraic formulas.
We've added the patterns together, and we can also multiply them | by
juxtaposition. For example, we can multiply the tilings
and
to get the
new tiling
. But notice that multiplication is not commutative; that is, the
order of multiplication counts:
is dierent from
.
Using this notion of multiplication it's not hard to see that the null
tiling plays a special role | it is the multiplicative identity.
For instance,
√ó
=
√ó =
.
Now we can use domino arithmetic to manipulate the innite sum T:
T = + +
+
+
+
+
+ ¬∑ ¬∑ ¬∑
= + ( + +
+
+ ¬∑ ¬∑ ¬∑ ) +
( + +
+
+ ¬∑ ¬∑ ¬∑ )
= + T +
T .
(7.2)
Every valid tiling occurs exactly once in each right side, so what we've done is
reasonable even though we're ignoring the cautions in Chapter 2 about \ab-
solute convergence." The bottom line of this equation tells us that everything
I have a gut feel-
ing that these
sums must con-
verge, as long as
the dominoes are
small enough.
in T is either the null tiling, or is a vertical tile followed by something else
in T, or is two horizontal tiles followed by something else in T.
So now let's try to solve the equation for T. Replacing the T on the left
by T and subtracting the last two terms on the right from both sides of the
equation, we get
( ‚àí‚àí
)T =
.
(7.3)
For a consistency check, here's an expanded version:
+
+
+
+
+
+
+ ¬∑ ¬∑ ¬∑
‚àí
‚àí
‚àí
‚àí
‚àí
‚àí
‚àí
‚àí¬∑ ¬∑ ¬∑
‚àí
‚àí
‚àí
‚àí
‚àí
‚àí
‚àí
‚àí¬∑ ¬∑ ¬∑
Every term in the top row, except the rst, is cancelled by a term in either
the second or third row, so our equation is correct.
So far it's been fairly easy to make combinatorial sense of the equations
we've been working with. Now, however, to get a compact expression for T
we cross a combinatorial divide. With a leap of algebraic faith we divide both
sides of equation (7.3) by ‚àí‚àí
to get
T =
‚àí‚àí
.
(7.4)

324 GENERATING FUNCTIONS
(Multiplication isn't commutative, so we're on the verge of cheating, by not
distinguishing between left and right division. In our application it doesn't
matter, because
commutes with everything. But let's not be picky, unless
our wild ideas lead to paradoxes.)
The next step is to expand this fraction as a power series, using the rule
1
1 ‚àíz = 1 + z + z2 + z3 + ¬∑ ¬∑ ¬∑ .
The null tiling , which is the multiplicative identity for our combinatorial
arithmetic, plays the part of 1, the usual multiplicative identity; and
+
plays z. So we get the expansion
‚àí‚àí
= + ( +
) + ( +
)2 + ( +
)3 + ¬∑ ¬∑ ¬∑
= + ( +
) + (
+
+
+
)
+ (
+
+
+
+
+
+
+
) + ¬∑ ¬∑ ¬∑ .
This is T, but the tilings are arranged in a dierent order than we had before.
Every tiling appears exactly once in this sum; for example,
appears
in the expansion of ( +
)7.
We can get useful information from this innite sum by compressing it
down, ignoring details that are not of interest. For example, we can imagine
that the patterns become unglued and that the individual dominoes commute
with each other; then a term like
becomes
4
6, because it contains
four verticals and six horizontals. Collecting like terms gives us the series
T = +
+
2 +
2 +
3 + 2
2 +
4 + 3
2
2 +
4 + ¬∑ ¬∑ ¬∑ .
The 2
2 here represents the two terms of the old expansion,
and
, that
have one vertical and two horizontal dominoes; similarly 3
2
2 represents the
three terms
,
, and
. We're essentially treating
and
as ordinary
(commutative) variables.
We can nd a closed form for the coecients in the commutative version
of T by using the binomial theorem:
‚àí(
+
2) = + (
+
2) + (
+
2)2 + (
+
2)3 + ¬∑ ¬∑ ¬∑
=
X
k0
(
+
2)k
=
X
j,k0
¬µk
j
¬∂
j
2k‚àí2j
=
X
j,m0
¬µj + m
j
¬∂
j
2m .
(7.5)

7.1 DOMINO THEORY AND CHANGE 325
(The last step replaces k ‚àíj by m; this is legal because we have
¬°k
j
¬¢
= 0 when
0  k < j.) We conclude that
¬°j+m
j
¬¢
is the number of ways to tile a 2√ó(j+2m)
rectangle with j vertical dominoes and 2m horizontal dominoes. For example,
we recently looked at the 2 √ó 10 tiling
, which involves four verticals
and six horizontals; there are
¬°4+3
4
¬¢
= 35 such tilings in all, so one of the
terms in the commutative version of T is 35
4
6.
We can suppress even more detail by ignoring the orientation of the
dominoes. Suppose we don't care about the horizontal/vertical breakdown;
we only want to know about the total number of 2 √ó n tilings. (This, in
fact, is the number Tn we started out trying to discover.) We can collect
the necessary information by simply substituting a single quantity, z, for
and
. And we might as well also replace
by 1, getting
Now I'm dis-
oriented.
T =
1
1 ‚àíz ‚àíz2 .
(7.6)
This is the generating function (6.117) for Fibonacci numbers, except for a
missing factor of z in the numerator; so we conclude that the coecient of zn
in T is Fn+1.
The compact representations /( ‚àí‚àí
), /( ‚àí‚àí
2), and 1/(1‚àíz‚àíz2)
that we have deduced for T are called generating functions, because they
generate the coecients of interest.
Incidentally, our derivation implies that the number of 2 √ó n domino
tilings with exactly m pairs of horizontal dominoes is
¬°n‚àím
m
¬¢
. (This follows
because there are j = n ‚àí2m vertical dominoes, hence there are
¬µj + m
j
¬∂
=
¬µj + m
m
¬∂
=
¬µn ‚àím
m
¬∂
ways to do the tiling according to our formula.) We observed in Chapter 6
that
¬°n‚àím
m
¬¢
is the number of Morse code sequences of length n that contain
m dashes; in fact, it's easy to see that 2√ón domino tilings correspond directly
to Morse code sequences.
(The tiling
corresponds to ` q
q q
q'.)
Thus domino tilings are closely related to the continuant polynomials we
studied in Chapter 6. It's a small world.
We have solved the Tn problem in two ways. The rst way, guessing the
answer and proving it by induction, was easier; the second way, using innite
sums of domino patterns and distilling out the coecients of interest, was
fancier. But did we use the second method only because it was amusing to
play with dominoes as if they were algebraic variables? No; the real reason
for introducing the second way was that the innite-sum approach is a lot
more powerful. The second method applies to many more problems, because
it doesn't require us to make magic guesses.

326 GENERATING FUNCTIONS
Let's generalize up a notch, to a problem where guesswork will be beyond
us. How many ways Un are there to tile a 3 √ó n rectangle with dominoes?
The rst few cases of this problem tell us a little: The null tiling gives
U0 = 1. There is no valid tiling when n = 1, since a 2 √ó 1 domino doesn't ll
a 3 √ó 1 rectangle, and since there isn't room for two. The next case, n = 2,
can easily be done by hand; there are three tilings,
,
, and
, so U2 = 3.
(Come to think of it we already knew this, because the previous problem told
us that T3 = 3; the number of ways to tile a 3 √ó 2 rectangle is the same as the
number to tile a 2 √ó 3.) When n = 3, as when n = 1, there are no tilings. We
can convince ourselves of this either by making a quick exhaustive search or
by looking at the problem from a higher level: The area of a 3√ó3 rectangle is
odd, so we can't possibly tile it with dominoes whose area is even. (The same
argument obviously applies to any odd n.) Finally, when n = 4 there seem
to be about a dozen tilings; it's dicult to be sure about the exact number
without spending a lot of time to guarantee that the list is complete.
So let's try the innite-sum approach that worked last time:
U =
+
+
+
+
+
+
+
+
+ ¬∑ ¬∑ ¬∑ .
(7.7)
Every non-null tiling begins with either
or
or
; but unfortunately the
rst two of these three possibilities don't simply factor out and leave us with
U again. The sum of all terms in U that begin with
can, however, be written
as
V, where
V =
+
+
+
+
+ ¬∑ ¬∑ ¬∑
is the sum of all domino tilings of a mutilated 3 √ó n rectangle that has its
lower left corner missing. Similarly, the terms of U that begin with
can be
written
Œõ, where
Œõ =
+
+
+
+
+ ¬∑ ¬∑ ¬∑
consists of all rectangular tilings lacking their upper left corner. The series Œõ
is a mirror image of V. These factorizations allow us to write
U =
+
V +
Œõ +
U .
And we can factor V and Œõ as well, because such tilings can begin in only
two ways:
V =
U +
V ,
Œõ =
U +
Œõ .

7.1 DOMINO THEORY AND CHANGE 327
Now we have three equations in three unknowns (U, V, and Œõ). We can solve
them by rst solving for V and Œõ in terms of U, then plugging the results
into the equation for U:
V = ( ‚àí
)‚àí1 U ,
Œõ = ( ‚àí
)‚àí1 U ;
U =
+
( ‚àí
)‚àí1 U +
( ‚àí
)‚àí1 U +
U .
And the nal equation can be solved for U, giving the compact formula
U =
‚àí
( ‚àí
)‚àí1
‚àí
( ‚àí
)‚àí1
‚àí
.
(7.8)
This expression denes the innite sum U, just as (7.4) denes T.
I learned in another
class about \regular
expressions." If I'm
not mistaken, we
can write
U = (
‚àó
+
‚àó+
)‚àó
in the language of
regular expressions;
so there must be
some connection
between regular
expressions and gen-
erating functions.
The next step is to go commutative. Everything simplies beautifully
when we detach all the dominoes and use only powers of
and
:
U =
1
1 ‚àí
2
(1 ‚àí
3)‚àí1 ‚àí
2
(1 ‚àí
3)‚àí1 ‚àí
3
=
1 ‚àí
3
( 1 ‚àí
3)2 ‚àí2
2
=
(1 ‚àí
3)‚àí1
1 ‚àí2
2
(1 ‚àí
3)‚àí2
=
1
1 ‚àí
3 +
2
2
(1 ‚àí
3)3 +
4
4
2
(1 ‚àí
3)5 +
8
6
3
(1 ‚àí
3)7 + ¬∑ ¬∑ ¬∑
=
X
k0
2k
2k
k
(1 ‚àí
3)2k+1
=
X
k,m0
¬µm + 2k
m
¬∂
2k
2k
k+3m .
(This derivation deserves careful scrutiny.
The last step uses the formula
(1 ‚àíw)‚àí2k‚àí1 = P
m
¬°m+2k
m
¬¢
wm, identity (5.56).) Let's take a good look at
the bottom line to see what it tells us. First, it says that every 3 √ó n tiling
uses an even number of vertical dominoes. Moreover, if there are 2k verticals,
there must be at least k horizontals, and the total number of horizontals must
be k + 3m for some m  0. Finally, the number of possible tilings with 2k
verticals and k + 3m horizontals is exactly
¬°m+2k
m
¬¢
2k.
We now are able to analyze the 3√ó4 tilings that left us doubtful when we
began looking at the 3 √ó n problem. When n = 4 the total area is 12, so we
need six dominoes altogether. There are 2k verticals and k + 3m horizontals,

328 GENERATING FUNCTIONS
for some k and m; hence 2k + k + 3m = 6. In other words, k + m = 2.
If we use no verticals, then k = 0 and m = 2; the number of possibilities
is
¬°2+0
2
¬¢
20 = 1. (This accounts for the tiling
.) If we use two verticals,
then k = 1 and m = 1; there are
¬°1+2
1
¬¢
21 = 6 such tilings. And if we use
four verticals, then k = 2 and m = 0; there are
¬°0+4
0
¬¢
22 = 4 such tilings,
making a total of U4 = 11. In general if n is even, this reasoning shows that
k + m = 1
2n, hence
¬°m+2k
m
¬¢
=
¬°n/2+k
n/2‚àík
¬¢
and the total number of 3 √ó n tilings
is
Un =
X
k
¬µn/2 + k
n/2 ‚àík
¬∂
2k =
X
m
¬µn ‚àím
m
¬∂
2n/2‚àím .
(7.9)
As before, we can also substitute z for both
and
, getting a gen-
erating function that doesn't discriminate between dominoes of particular
persuasions. The result is
U =
1
1 ‚àíz3(1 ‚àíz3)‚àí1 ‚àíz3(1 ‚àíz3)‚àí1 ‚àíz3 =
1 ‚àíz3
1 ‚àí4z3 + z6 .
(7.10)
If we expand this quotient into a power series, we get
U = 1 + U2 z3 + U4 z6 + U6 z9 + U8 z12 + ¬∑ ¬∑ ¬∑ ,
a generating function for the numbers Un. (There's a curious mismatch be-
tween subscripts and exponents in this formula, but it is easily explained. The
coecient of z9, for example, is U6, which counts the tilings of a 3√ó6 rectan-
gle. This is what we want, because every such tiling contains nine dominoes.)
We could proceed to analyze (7.10) and get a closed form for the coe-
cients, but it's better to save that for later in the chapter after we've gotten
more experience. So let's divest ourselves of dominoes for the moment and
proceed to the next advertised problem, \change."
How many ways are there to pay 50 cents? We assume that the payment
must be made with pennies
f
1 , nickels
g
5 , dimes
f
10, quarters
h
25 , and half-
dollars
j
50 . George Polya [298] popularized this problem by showing that it
Ah yes, I remember
when we had half-
dollars.
can be solved with generating functions in an instructive way.
Let's set up innite sums that represent all possible ways to give change,
just as we tackled the domino problems by working with innite sums that
represent all possible domino patterns. It's simplest to start by working with
fewer varieties of coins, so let's suppose rst that we have nothing but pennies.
The sum of all ways to leave some number of pennies (but just pennies) in
change can be written
P = Ã∏ 1 + f
1 + f
1 f
1 + f
1 f
1 f
1 + f
1 f
1 f
1 f
1 + ¬∑ ¬∑ ¬∑
= Ã∏ 1 + f
1 + f
1 2 + f
1 3 + f
1 4 + ¬∑ ¬∑ ¬∑ .

7.1 DOMINO THEORY AND CHANGE 329
The rst term stands for the way to leave no pennies, the second term stands
for one penny, then two pennies, three pennies, and so on.
Now if we're
allowed to use both pennies and nickels, the sum of all possible ways is
N = P + g
5 P + g
5
g
5 P + g
5
g
5
g
5 P + g
5
g
5
g
5
g
5 P + ¬∑ ¬∑ ¬∑
= (Ã∏ 5 + g
5 + g
5 2 + g
5 3 + g
5 4 + ¬∑ ¬∑ ¬∑ ) P ,
since each payment has a certain number of nickels chosen from the rst
factor and a certain number of pennies chosen from P.
(Notice that N is
not the sum Ã∏ 1 + f
1 +
g
5 + ( f
1 +
g
5 )2 + ( f
1 +
g
5 )3 + ¬∑ ¬∑ ¬∑ , because such a
sum includes many types of payment more than once. For example, the term
( f
1 + g
5 )2 = f
1 f
1 + f
1 g
5 + g
5
f
1 + g
5
g
5 treats
f
1 g
5 and
g
5
f
1 as if they were
dierent, but we want to list each set of coins only once without respect to
order.)
Similarly, if dimes are permitted as well, we get the innite sum
D = (Ã∏ 10 + f
10 + f
10 2 + f
10 3 + f
10 4 + ¬∑ ¬∑ ¬∑ ) N ,
which includes terms like
f
10 3 g
5 3 f
1 5 =
f
10 f
10 f
10 g
5
g
5
g
5 f
1 f
1 f
1 f
1 f
1 when it is
expanded in full.
Each of these terms is a dierent way to make change.
Adding quarters and then half-dollars to the realm of possibilities gives
Coins of the realm.
Q = (Ã∏ 25 + h
25 + h
25 2 + h
25 3 + h
25 4 + ¬∑ ¬∑ ¬∑ ) D ;
C = (Ã∏ 50 +
j
50 +
j
50 2 +
j
50 3 +
j
50 4 + ¬∑ ¬∑ ¬∑ ) Q .
Our problem is to nd the number of terms in C worth exactly 50/c.
A simple trick solves this problem nicely: We can replace
f
1 by z,
g
5
by z5,
f
10 by z10,
h
25 by z25, and
j
50 by z50. Then each term is replaced
by zn, where n is the monetary value of the original term.
For example,
the term
j
50 f
10 g
5
g
5
f
1 becomes z50+10+5+5+1 = z71. The four ways of paying
13 cents, namely
f
10 f
1 3,
g
5 f
1 8,
g
5 2 f
1 3, and
f
1 13, each reduce to z13; hence
the coecient of z13 will be 4 after the z-substitutions are made.
Let Pn, Nn, Dn, Qn, and Cn be the numbers of ways to pay n cents
when we're allowed to use coins that are worth at most 1, 5, 10, 25, and 50
cents, respectively. Our analysis tells us that these are the coecients of zn
in the respective power series
P = 1 + z + z2 + z3 + z4 + ¬∑ ¬∑ ¬∑ ,
N = (1 + z5 + z10 + z15 + z20 + ¬∑ ¬∑ ¬∑ )P ,
D = (1 + z10 + z20 + z30 + z40 + ¬∑ ¬∑ ¬∑ )N ,
Q = (1 + z25 + z50 + z75 + z100 + ¬∑ ¬∑ ¬∑ )D ,
C = (1 + z50 + z100 + z150 + z200 + ¬∑ ¬∑ ¬∑ )Q .

330 GENERATING FUNCTIONS
Obviously Pn = 1 for all n  0. And a little thought proves that we have
How many pennies
are there, really?
If n is greater
than, say, 1010 ,
I bet that Pn = 0
in the \real world."
Nn = ‚åän/5‚åã+ 1: To make n cents out of pennies and nickels, we must choose
either 0 or 1 or . . . or ‚åän/5‚åãnickels, after which there's only one way to supply
the requisite number of pennies. Thus Pn and Nn are simple; but the values
of Dn, Qn, and Cn are increasingly more complicated.
One way to deal with these formulas is to realize that 1 + zm + z2m + ¬∑ ¬∑ ¬∑
is just 1/(1 ‚àízm). Thus we can write
P = 1/(1 ‚àíz) ,
N = P/(1 ‚àíz5) ,
D = N/(1 ‚àíz10) ,
Q = D/(1 ‚àíz25) ,
C = Q/(1 ‚àíz50) .
Multiplying by the denominators, we have
(1 ‚àíz) P = 1 ,
(1 ‚àíz5) N = P ,
(1 ‚àíz10) D = N ,
(1 ‚àíz25) Q = D ,
(1 ‚àíz50) C = Q .
Now we can equate coecients of zn in these equations, getting recurrence
relations from which the desired coecients can quickly be computed:
Pn = Pn‚àí1 + [n = 0] ,
Nn = Nn‚àí5 + Pn ,
Dn = Dn‚àí10 + Nn ,
Qn = Qn‚àí25 + Dn ,
Cn = Cn‚àí50 + Qn .
For example, the coecient of zn in D = (1 ‚àíz25)Q is equal to Qn ‚àíQn‚àí25;
so we must have Qn ‚àíQn‚àí25 = Dn, as claimed.
We could unfold these recurrences and nd, for example, that Qn =
Dn+Dn‚àí25+Dn‚àí50+Dn‚àí75+¬∑ ¬∑ ¬∑ , stopping when the subscripts get negative.
But the non-iterated form is convenient because each coecient is computed
with just one addition, as in Pascal's triangle.
Let's use the recurrences to nd C50. First, C50 = C0 + Q50; so we want
to know Q50. Then Q50 = Q25 + D50, and Q25 = Q0 + D25; so we also want
to know D50 and D25. These Dn depend in turn on D40, D30, D20, D15,
D10, D5, and on N50, N45, . . . , N5. A simple calculation therefore suces

7.1 DOMINO THEORY AND CHANGE 331
to determine all the necessary coecients:
n
0
5
10
15
20
25
30
35
40
45
50
Pn
1
1
1
1
1
1
1
1
1
1
1
Nn
1
2
3
4
5
6
7
8
9
10
11
Dn
1
2
4
6
9
12
16
25
36
Qn
1
13
49
Cn
1
50
The nal value in the table gives us our answer, C50: There are exactly
50 ways to leave a 50-cent tip.
(Not counting the
option of charging
the tip to a credit
card.)
How about a closed form for Cn? Multiplying the equations together
gives us the compact expression
C =
1
1 ‚àíz
1
1 ‚àíz5
1
1 ‚àíz10
1
1 ‚àíz25
1
1 ‚àíz50 ,
(7.11)
but it's not obvious how to get from here to the coecient of zn. Fortunately
there is a way; we'll return to this problem later in the chapter.
More elegant formulas arise if we consider the problem of giving change
when we live in a land that mints coins of every positive integer denomination
( f
1 , g
2 ,
h
3 , . . . ) instead of just the ve we allowed before. The corresponding
generating function is an innite product of fractions,
1
(1 ‚àíz)(1 ‚àíz2)(1 ‚àíz3) . . . ,
and the coecient of zn when these factors are fully multiplied out is called
p(n), the number of partitions of n. A partition of n is a representation of n
as a sum of positive integers, disregarding order. For example, there are seven
dierent partitions of 5, namely
5 = 4+1 = 3+2 = 3+1+1 = 2+2+1 = 2+1+1+1 = 1+1+1+1+1 ;
hence p(5) = 7. (Also p(2) = 2, p(3) = 3, p(4) = 5, and p(6) = 11; it begins
to look as if p(n) is always a prime number. But p(7) = 15, spoiling the
pattern.) There is no closed form for p(n), but the theory of partitions is a
fascinating branch of mathematics in which many remarkable discoveries have
been made. For example, Ramanujan proved that p(5n + 4) ‚â°0 (mod 5),
p(7n + 5) ‚â°0 (mod 7), and p(11n + 6) ‚â°0 (mod 11), by making ingenious
transformations of generating functions (see Andrews [11, Chapter 10]).

332 GENERATING FUNCTIONS
7.2
BASIC MANEUVERS
Now let's look more closely at some of the techniques that make
power series powerful.
First a few words about terminology and notation. Our generic generat-
ing function has the form
G(z) = g0 + g1z + g2z2 + ¬∑ ¬∑ ¬∑ =
X
n0
gnzn ,
(7.12)
and we say that G(z), or G for short, is the generating function for the se-
quence ‚ü®g0, g1, g2, . . . ‚ü©, which we also call ‚ü®gn‚ü©.
The coecient gn of zn
in G(z) is often denoted [zn] G(z), as in Section 5.4.
The sum in (7.12) runs over all n  0, but we often nd it more con-
venient to extend the sum over all integers n.
We can do this by simply
regarding g‚àí1 = g‚àí2 = ¬∑ ¬∑ ¬∑ = 0. In such cases we might still talk about the
sequence ‚ü®g0, g1, g2, . . . ‚ü©, as if the gn's didn't exist for negative n.
Two kinds of \closed forms" come up when we work with generating
functions. We might have a closed form for G(z), expressed in terms of z; or
we might have a closed form for gn, expressed in terms of n. For example, the
generating function for Fibonacci numbers has the closed form z/(1 ‚àíz ‚àíz2);
the Fibonacci numbers themselves have the closed form (œÜn ‚àíbœÜn)/
‚àö
5. The
context will explain what kind of closed form is meant.
Now a few words about perspective. The generating function G(z) ap-
pears to be two dierent entities, depending on how we view it. Sometimes
it is a function of a complex variable z, satisfying all the standard properties
proved in calculus books. And sometimes it is simply a formal power series,
with z acting as a placeholder. In the previous section, for example, we used
If physicists can get
away with viewing
light sometimes as
a wave and some-
times as a particle,
mathematicians
should be able to
view generating
functions in two
dierent ways.
the second interpretation; we saw several examples in which z was substi-
tuted for some feature of a combinatorial object in a \sum" of such objects.
The coecient of zn was then the number of combinatorial objects having n
occurrences of that feature.
When we view G(z) as a function of a complex variable, its convergence
becomes an issue. We said in Chapter 2 that the innite series P
n0 gnzn
converges (absolutely) if and only if there's a bounding constant A such that
the nite sums P
0nN jgnznj never exceed A, for any N. Therefore it's easy
to see that if P
n0 gnzn converges for some value z = z0, it also converges
for all z with jzj < jz0j.
Furthermore, we must have limn‚Üí‚àûjgnzn
0 j = 0;
hence, in the notation of Chapter 9, gn = O
¬°
j1/z0jn¬¢
if there is convergence
at z0. And conversely if gn = O(Mn), the series P
n0 gnzn converges for
all jzj < 1/M. These are the basic facts about convergence of power series.
But for our purposes convergence is usually a red herring, unless we're
trying to study the asymptotic behavior of the coecients.
Nearly every

7.2 BASIC MANEUVERS 333
operation we perform on generating functions can be justied rigorously as
an operation on formal power series, and such operations are legal even when
the series don't converge. (The relevant theory can be found, for example, in
Bell [23], Niven [282], and Henrici [182, Chapter 1].)
Furthermore, even if we throw all caution to the winds and derive formu-
Even if we remove
the tags from our
mattresses.
las without any rigorous justication, we generally can take the results of our
derivation and prove them by induction. For example, the generating func-
tion for the Fibonacci numbers converges only when jzj < 1/œÜ ‚âà0.618, but
we didn't need to know that when we proved the formula Fn = (œÜn‚àíbœÜn)/
‚àö
5.
The latter formula, once discovered, can be veried directly, if we don't trust
the theory of formal power series. Therefore we'll ignore questions of conver-
gence in this chapter; it's more a hindrance than a help.
So much for perspective. Next we look at our main tools for reshaping
generating functions | adding, shifting, changing variables, dierentiating,
integrating, and multiplying. In what follows we assume that, unless stated
otherwise, F(z) and G(z) are the generating functions for the sequences ‚ü®fn‚ü©
and ‚ü®gn‚ü©. We also assume that the fn's and gn's are zero for negative n,
since this saves us some bickering with the limits of summation.
It's pretty obvious what happens when we add constant multiples of
F and G together:
Œ±F(z) + Œ≤G(z) = Œ±
X
n
fnzn
+ Œ≤
X
n
gnzn
=
X
n
(Œ±fn + Œ≤gn) zn .
(7.13)
This gives us the generating function for the sequence ‚ü®Œ±fn + Œ≤gn‚ü©.
Shifting a generating function isn't much harder. To shift G(z) right by
m places, that is, to form the generating function for the sequence ‚ü®0, . . . , 0,
g0, g1, . . . ‚ü©= ‚ü®gn‚àím‚ü©with m leading 0's, we simply multiply by zm:
zmG(z) =
X
n
gn zn+m =
X
n
gn‚àím zn ,
integer m  0.
(7.14)
This is the operation we used (twice), along with addition, to deduce the
equation (1 ‚àíz ‚àíz2)F(z) = z on our way to nding a closed form for the
Fibonacci numbers in Chapter 6.
And to shift G(z) left m places | that is, to form the generating function
for the sequence ‚ü®gm, gm+1, gm+2, . . . ‚ü©= ‚ü®gn+m‚ü©with the rst m elements
discarded | we subtract o the rst m terms and then divide by zm:
G(z)‚àíg0‚àíg1z‚àí¬∑ ¬∑ ¬∑ ‚àígm‚àí1zm‚àí1
zm
=
X
nm
gnzn‚àím =
X
n0
gn+mzn.(7.15)
(We can't extend this last sum over all n unless g0 = ¬∑ ¬∑ ¬∑ = gm‚àí1 = 0.)

334 GENERATING FUNCTIONS
Replacing the z by a constant multiple is another of our tricks:
G(cz) =
X
n
gn(cz)n =
X
n
cngnzn ;
(7.16)
this yields the generating function for the sequence ‚ü®cngn‚ü©. The special case
c = ‚àí1 is particularly useful.
Often we want to bring down a factor of n into the coecient. Dieren-
I fear dgenerating-
function dz's.
tiation is what lets us do that:
G‚Ä≤(z) = g1 + 2g2z + 3g3z2 + ¬∑ ¬∑ ¬∑ =
X
n
(n + 1)gn+1 zn .
(7.17)
Shifting this right one place gives us a form that's sometimes more useful,
zG‚Ä≤(z) =
X
n
ngn zn .
(7.18)
This is the generating function for the sequence ‚ü®ngn‚ü©. Repeated dierenti-
ation would allow us to multiply gn by any desired polynomial in n.
Integration, the inverse operation, lets us divide the terms by n:
Z z
0
G(t) dt = g0z + 1
2g1z2 + 1
3g2z3 + ¬∑ ¬∑ ¬∑ =
X
n1
1
ngn‚àí1 zn .
(7.19)
(Notice that the constant term is zero.) If we want the generating function
for ‚ü®gn/n‚ü©instead of ‚ü®gn‚àí1/n‚ü©, we should rst shift left one place, replacing
G(t) by
¬°
G(t) ‚àíg0
¬¢
/t in the integral.
Finally, here's how we multiply generating functions together:
F(z)G(z) = (f0 + f1z + f2z2 + ¬∑ ¬∑ ¬∑ )(g0 + g1z + g2z2 + ¬∑ ¬∑ ¬∑ )
= (f0g0) + (f0g1 + f1g0)z + (f0g2 + f1g1 + f2g0)z2 + ¬∑ ¬∑ ¬∑
=
X
n
¬≥X
k
fkgn‚àík
¬¥
zn .
(7.20)
As we observed in Chapter 5, this gives the generating function for the se-
quence ‚ü®hn‚ü©, the convolution of ‚ü®fn‚ü©and ‚ü®gn‚ü©. The sum hn = P
k fkgn‚àík
can also be written hn = Pn
k=0 fkgn‚àík, because fk = 0 when k < 0 and
gn‚àík = 0 when k > n. Multiplication/convolution is a little more compli-
cated than the other operations, but it's very useful | so useful that we will
spend all of Section 7.5 below looking at examples of it.
Multiplication has several special cases that are worth considering as
operations in themselves. We've already seen one of these: When F(z) = zm
we get the shifting operation (7.14). In that case the sum hn becomes the
single term gn‚àím, because all fk's are 0 except for fm = 1.

7.2 BASIC MANEUVERS 335
Table 335 Generating function manipulations.
Œ±F(z) + Œ≤G(z) =
X
n
(Œ±fn + Œ≤gn)zn
zmG(z) =
X
n
gn‚àím zn ,
integer m  0
G(z) ‚àíg0 ‚àíg1z ‚àí¬∑ ¬∑ ¬∑ ‚àígm‚àí1zm‚àí1
zm
=
X
n0
gn+m zn ,
integer m  0
G(cz) =
X
n
cngn zn
G‚Ä≤(z) =
X
n
(n + 1)gn+1 zn
zG‚Ä≤(z) =
X
n
ngn zn
Z z
0
G(t) dt =
X
n1
1
ngn‚àí1 zn
F(z)G(z) =
X
n
¬µX
k
fkgn‚àík
¬∂
zn
1
1 ‚àízG(z) =
X
n
¬µX
kn
gk
¬∂
zn
Another useful special case arises when F(z) is the familiar function
1/(1 ‚àíz) = 1 + z + z2 + ¬∑ ¬∑ ¬∑ ; then all fk's (for k  0) are 1 and we have
the important formula
1
1 ‚àízG(z) =
X
n
¬µX
k0
gn‚àík
¬∂
zn =
X
n
¬µX
kn
gk
¬∂
zn .
(7.21)
Multiplying a generating function by 1/(1‚àíz) gives us the generating function
for the cumulative sums of the original sequence.
Table 335 summarizes the operations we've discussed so far.
To use
all these manipulations eectively it helps to have a healthy repertoire of
generating functions in stock. Table 336 lists the simplest ones; we can use
those to get started and to solve quite a few problems.
Each of the generating functions in Table 336 is important enough to
be memorized. Many of them are special cases of the others, and many of

336 GENERATING FUNCTIONS
Table 336 Simple sequences and their generating functions.
sequence
generating function
closed form
‚ü®1, 0, 0, 0, 0, 0, . . . ‚ü©
X
n0[n = 0] zn
1
‚ü®0, . . . , 0, 1, 0, 0, . . . ‚ü©
X
n0[n = m] zn
zm
‚ü®1, 1, 1, 1, 1, 1, . . . ‚ü©
X
n0 zn
1
1 ‚àíz
‚ü®1, ‚àí1, 1, ‚àí1, 1, ‚àí1, . . . ‚ü©
X
n0(‚àí1)n zn
1
1 + z
‚ü®1, 0, 1, 0, 1, 0, . . . ‚ü©
X
n0[2nn] zn
1
1 ‚àíz2
‚ü®1, 0, . . . , 0, 1, 0, . . . , 0, 1, 0, . . . ‚ü©
X
n0[mnn] zn
1
1 ‚àízm
‚ü®1, 2, 3, 4, 5, 6, . . . ‚ü©
X
n0(n + 1) zn
1
(1 ‚àíz)2
‚ü®1, 2, 4, 8, 16, 32, . . . ‚ü©
X
n0 2n zn
1
1 ‚àí2z
‚ü®1, 4, 6, 4, 1, 0, 0, . . . ‚ü©
X
n0
¬µ4
n
¬∂
zn
(1 + z)4
¬≠
1, c,
¬°c
2
¬¢
,
¬°c
3
¬¢
, . . .
¬Æ
X
n0
¬µc
n
¬∂
zn
(1 + z)c
D
1, c,
¬°c+1
2
¬¢
,
¬°c+2
3
¬¢
, . . .
E
X
n0
¬µc+n‚àí1
n
¬∂
zn
1
(1 ‚àíz)c
¬≠
1, c, c2, c3, . . .
¬Æ
X
n0 cn zn
1
1 ‚àícz
D
1,
¬°m+1
m
¬¢
,
¬°m+2
m
¬¢
,
¬°m+3
m
¬¢
, . . .
E
X
n0
¬µm+n
m
¬∂
zn
1
(1 ‚àíz)m+1
¬≠
0, 1, 1
2, 1
3, 1
4, . . .
¬Æ
X
n1
1
n zn
ln
1
1 ‚àíz
¬≠
0, 1, ‚àí1
2, 1
3, ‚àí1
4, . . .
¬Æ
X
n1
(‚àí1)n+1
n
zn
ln(1 + z)
¬≠
1, 1, 1
2, 1
6, 1
24,
1
120, . . .
¬Æ
X
n0
1
n! zn
ez
them can be derived quickly from the others by using the basic operations of
Hint: If the se-
quence consists
of binomial coe-
cients, its generat-
ing function usually
involves a binomial,
1 ¬± z.
Table 335; therefore the memory work isn't very hard.
For example, let's consider the sequence ‚ü®1, 2, 3, 4, . . . ‚ü©, whose generating
function 1/(1 ‚àíz)2 is often useful. This generating function appears near the

7.2 BASIC MANEUVERS 337
middle of Table 336, and it's also the special case m = 1 of ‚ü®1,
¬°m+1
m
¬¢
,
¬°m+2
m
¬¢
,
¬°m+3
m
¬¢
, . . . ‚ü©, which appears further down; it's also the special case c = 2 of
the closely related sequence ‚ü®1, c,
¬°c+1
2
¬¢
,
¬°c+2
3
¬¢
, . . . ‚ü©. We can derive it from the
generating function for ‚ü®1, 1, 1, 1, . . . ‚ü©by taking cumulative sums as in (7.21);
that is, by dividing 1/(1‚àíz) by (1‚àíz). Or we can derive it from ‚ü®1, 1, 1, 1, . . . ‚ü©
OK, OK, I'm con-
vinced already.
by dierentiation, using (7.17).
The sequence ‚ü®1, 0, 1, 0, . . . ‚ü©is another one whose generating function can
be obtained in many ways. We can obviously derive the formula P
n z2n =
1/(1 ‚àíz2) by substituting z2 for z in the identity P
n zn = 1/(1 ‚àíz); we can
also apply cumulative summation to the sequence ‚ü®1, ‚àí1, 1, ‚àí1, . . . ‚ü©, whose
generating function is 1/(1 + z), getting 1/(1 + z)(1 ‚àíz) = 1/(1 ‚àíz2). And
there's also a third way, which is based on a general method for extracting
the even-numbered terms ‚ü®g0, 0, g2, 0, g4, 0, . . . ‚ü©of any given sequence: If we
add G(‚àíz) to G(+z) we get
G(z) + G(‚àíz) =
X
n
gn
¬°
1 + (‚àí1)n¬¢
zn = 2
X
n
gn[n even]zn ;
therefore
G(z) + G(‚àíz)
2
=
X
n
g2n z2n .
(7.22)
The odd-numbered terms can be extracted in a similar way,
G(z) ‚àíG(‚àíz)
2
=
X
n
g2n+1 z2n+1 .
(7.23)
In the special case where gn = 1 and G(z) = 1/(1‚àíz), the generating function
for ‚ü®1, 0, 1, 0, . . . ‚ü©is 1
2
¬°
G(z) + G(‚àíz)
¬¢
= 1
2
¬°
1
1‚àíz +
1
1+z
¬¢
=
1
1‚àíz2 .
Let's try this extraction trick on the generating function for Fibonacci
numbers. We know that P
n Fnzn = z/(1 ‚àíz ‚àíz2); hence
X
n
F2nz2n = 1
2
¬µ
z
1 ‚àíz ‚àíz2 +
‚àíz
1 + z ‚àíz2
¬∂
= 1
2
¬µz + z2 ‚àíz3 ‚àíz + z2 + z3
(1 ‚àíz2)2 ‚àíz2
¬∂
=
z2
1 ‚àí3z2 + z4 .
This generates the sequence ‚ü®F0, 0, F2, 0, F4, . . . ‚ü©; hence the sequence of alter-
nate F's, ‚ü®F0,F2,F4,F6,. . .‚ü©= ‚ü®0,1,3,8,. . .‚ü©, has a simple generating function:
X
n
F2nzn =
z
1 ‚àí3z + z2 .
(7.24)

338 GENERATING FUNCTIONS
7.3
SOLVING RECURRENCES
Now let's focus our attention on one of the most important uses of
generating functions: the solution of recurrence relations.
Given a sequence ‚ü®gn‚ü©that satises a given recurrence, we seek a closed
form for gn in terms of n. A solution to this problem via generating functions
proceeds in four steps that are almost mechanical enough to be programmed
on a computer:
1
Write down a single equation that expresses gn in terms of other elements
of the sequence. This equation should be valid for all integers n, assuming
that g‚àí1 = g‚àí2 = ¬∑ ¬∑ ¬∑ = 0.
2
Multiply both sides of the equation by zn and sum over all n. This gives,
on the left, the sum P
n gnzn, which is the generating function G(z). The
right-hand side should be manipulated so that it becomes some other
expression involving G(z).
3
Solve the resulting equation, getting a closed form for G(z).
4
Expand G(z) into a power series and read o the coecient of zn; this is
a closed form for gn.
This method works because the single function G(z) represents the entire
sequence ‚ü®gn‚ü©in such a way that many manipulations are possible.
Example 1: Fibonacci numbers revisited.
For example, let's rerun the derivation of Fibonacci numbers from Chap-
ter 6. In that chapter we were feeling our way, learning a new method; now
we can be more systematic. The given recurrence is
g0 = 0 ;
g1 = 1 ;
gn = gn‚àí1 + gn‚àí2 ,
for n  2.
We will nd a closed form for gn by using the four steps above.
Step 1 tells us to write the recurrence as a \single equation" for gn. We
could say
gn =
¬± 0,
if n  0;
1,
if n = 1;
gn‚àí1 + gn‚àí2,
if n > 1;
but this is cheating. Step 1 really asks for a formula that doesn't involve a
case-by-case construction. The single equation
gn = gn‚àí1 + gn‚àí2
works for n  2, and it also holds when n  0 (because we have g0 = 0
and gnegative = 0). But when n = 1 we get 1 on the left and 0 on the right.

7.3 SOLVING RECURRENCES 339
Fortunately the problem is easy to x, since we can add [n = 1] to the right;
this adds 1 when n = 1, and it makes no change when n Ã∏= 1. So, we have
gn = gn‚àí1 + gn‚àí2 + [n = 1] ;
this is the equation called for in Step 1.
Step 2 now asks us to transform the equation for ‚ü®gn‚ü©into an equation
for G(z) = P
n gnzn. The task is not dicult:
G(z) =
X
n
gnzn =
X
n
gn‚àí1 zn +
X
n
gn‚àí2 zn +
X
n
[n = 1]zn
=
X
n
gn zn+1 +
X
n
gn zn+2
+ z
= zG(z) + z2G(z) + z .
Step 3 is also simple in this case; we have
G(z) =
z
1 ‚àíz ‚àíz2 ,
which of course comes as no surprise.
Step 4 is the clincher. We carried it out in Chapter 6 by having a sudden
ash of inspiration; let's go more slowly now, so that we can get through
Step 4 safely later, when we meet problems that are more dicult. What is
[zn]
z
1 ‚àíz ‚àíz2 ,
the coecient of zn when z/(1 ‚àíz ‚àíz2) is expanded in a power series? More
generally, if we are given any rational function
R(z) = P(z)
Q(z) ,
where P and Q are polynomials, what is the coecient [zn] R(z)?
There's one kind of rational function whose coecients are particularly
nice, namely
a
(1 ‚àíœÅz)m+1 =
X
n0
¬µm + n
m
¬∂
aœÅnzn .
(7.25)
(The case œÅ = 1 appears in Table 336, and we can get the general formula
shown here by substituting œÅz for z.) A nite sum of functions like (7.25),
S(z) =
a1
(1 ‚àíœÅ1z)m1+1 +
a2
(1 ‚àíœÅ2z)m2+1 + ¬∑ ¬∑ ¬∑ +
al
(1 ‚àíœÅlz)ml+1 , (7.26)

340 GENERATING FUNCTIONS
also has nice coecients,
[zn] S(z) = a1
¬µm1 + n
m1
¬∂
œÅn
1 + a2
¬µm2 + n
m2
¬∂
œÅn
2
+ ¬∑ ¬∑ ¬∑ + al
¬µml + n
ml
¬∂
œÅn
l .
(7.27)
We will show that every rational function R(z) such that R(0) Ã∏= ‚àûcan be
expressed in the form
R(z) = S(z) + T(z) ,
(7.28)
where S(z) has the form (7.26) and T(z) is a polynomial. Therefore there is a
closed form for the coecients [zn] R(z). Finding S(z) and T(z) is equivalent
to nding the \partial fraction expansion" of R(z).
Notice that S(z) = ‚àûwhen z has the values 1/œÅ1, . . . , 1/œÅl. Therefore
the numbers œÅk that we need to nd, if we're going to succeed in expressing
R(z) in the desired form S(z) + T(z), must be the reciprocals of the numbers
Œ±k where Q(Œ±k) = 0. (Recall that R(z) = P(z)/Q(z), where P and Q are
polynomials; we have R(z) = ‚àûonly if Q(z) = 0.)
Suppose Q(z) has the form
Q(z) = q0 + q1z + ¬∑ ¬∑ ¬∑ + qmzm ,
where q0 Ã∏= 0 and qm Ã∏= 0.
The \reected" polynomial
QR(z) = q0zm + q1zm‚àí1 + ¬∑ ¬∑ ¬∑ + qm
has an important relation to Q(z):
QR(z) = q0(z ‚àíœÅ1) . . . (z ‚àíœÅm)
‚áê‚áí
Q(z) = q0(1 ‚àíœÅ1z) . . . (1 ‚àíœÅmz) .
Thus, the roots of QR are the reciprocals of the roots of Q, and vice versa.
We can therefore nd the numbers œÅk we seek by factoring the reected poly-
nomial QR(z).
For example, in the Fibonacci case we have
Q(z) = 1 ‚àíz ‚àíz2 ;
QR(z) = z2 ‚àíz ‚àí1 .
The roots of QR can be found by setting (a, b, c) = (1, ‚àí1, ‚àí1) in the quad-
ratic formula
¬°
‚àíb ¬±
‚àö
b2 ‚àí4ac
¬¢
/2a; we nd that they are
œÜ = 1 +
‚àö
5
2
and
bœÜ = 1 ‚àí
‚àö
5
2
.
Therefore QR(z) = (z ‚àíœÜ)(z ‚àíbœÜ) and Q(z) = (1 ‚àíœÜz)(1 ‚àíbœÜz).

7.3 SOLVING RECURRENCES 341
Once we've found the œÅ's, we can proceed to nd the partial fraction
expansion. It's simplest if all the roots are distinct, so let's consider that
special case rst. We might as well state and prove the general result formally:
Rational Expansion Theorem for Distinct Roots.
If R(z) = P(z)/Q(z), where Q(z) = q0(1 ‚àíœÅ1z) . . . (1 ‚àíœÅlz) and the
numbers (œÅ1, . . . , œÅl) are distinct, and if P(z) is a polynomial of degree less
than l, then
[zn] R(z) = a1œÅn
1 + ¬∑ ¬∑ ¬∑ + alœÅn
l ,
where ak = ‚àíœÅkP(1/œÅk)
Q‚Ä≤(1/œÅk) .
(7.29)
Proof: Let a1, . . . , al be the stated constants. Formula (7.29) holds if R(z) =
P(z)/Q(z) is equal to
S(z) =
a1
1 ‚àíœÅ1z + ¬∑ ¬∑ ¬∑ +
al
1 ‚àíœÅlz .
And we can prove that R(z) = S(z) by showing that the function T(z) =
R(z) ‚àíS(z) is not innite as z ‚Üí1/œÅk. For this will show that the rational
Impress your par-
ents by leaving the
book open at this
page.
function T(z) is never innite; hence T(z) must be a polynomial. We also can
show that T(z) ‚Üí0 as z ‚Üí‚àû; hence T(z) must be zero.
Let Œ±k = 1/œÅk. To prove that limz‚ÜíŒ±k T(z) Ã∏= ‚àû, it suces to show that
limz‚ÜíŒ±k (z ‚àíŒ±k)T(z) = 0, because T(z) is a rational function of z. Thus we
want to show that
lim
z‚ÜíŒ±k (z ‚àíŒ±k)R(z) =
lim
z‚ÜíŒ±k (z ‚àíŒ±k)S(z) .
The right-hand limit equals limz‚ÜíŒ±k ak(z‚àíŒ±k)/(1‚àíœÅkz) = ‚àíak/œÅk, because
(1 ‚àíœÅkz) = ‚àíœÅk(z ‚àíŒ±k) and (z ‚àíŒ±k)/(1 ‚àíœÅjz) ‚Üí0 for j Ã∏= k. The left-hand
limit is
lim
z‚ÜíŒ±k (z ‚àíŒ±k) P(z)
Q(z) = P(Œ±k) lim
z‚ÜíŒ±k
z ‚àíŒ±k
Q(z)
=
P(Œ±k)
Q‚Ä≤(Œ±k) ,
by L'Hospital's rule. Thus the theorem is proved.
Returning to the Fibonacci example, we have P(z) = z and Q(z) =
1 ‚àíz ‚àíz2 = (1 ‚àíœÜz)(1 ‚àíbœÜz); hence Q‚Ä≤(z) = ‚àí1 ‚àí2z, and
‚àíœÅP(1/œÅ)
Q‚Ä≤(1/œÅ)
=
‚àí1
‚àí1 ‚àí2/œÅ =
œÅ
œÅ + 2 .
According to (7.29), the coecient of œÜn in [zn] R(z) is therefore œÜ/(œÜ+2) =
1/
‚àö
5; the coecient of bœÜn is bœÜ/(bœÜ + 2) = ‚àí1/
‚àö
5. So the theorem tells us
that Fn = (œÜn ‚àíbœÜn)/
‚àö
5, as in (6.123).

342 GENERATING FUNCTIONS
When Q(z) has repeated roots, the calculations become more dicult,
but we can beef up the proof of the theorem and prove the following more
general result:
General Expansion Theorem for Rational Generating Functions.
If R(z) = P(z)/Q(z), where Q(z) = q0(1 ‚àíœÅ1z)d1 . . . (1 ‚àíœÅlz)dl and the
numbers (œÅ1, . . . , œÅl) are distinct, and if P(z) is a polynomial of degree less
than d1 + ¬∑ ¬∑ ¬∑ + dl, then
[zn] R(z) = f1(n)œÅn
1 + ¬∑ ¬∑ ¬∑ + fl(n)œÅn
l
for all n  0,
(7.30)
where each fk(n) is a polynomial of degree dk ‚àí1 with leading coecient
ak = (‚àíœÅk)dkP(1/œÅk)dk
Q(dk)(1/œÅk)
=
P(1/œÅk)
(dk‚àí1)! q0
Q
jÃ∏=k(1‚àíœÅj/œÅk)dj .
(7.31)
This can be proved by induction on max(d1, . . . , dl), using the fact that
R(z) ‚àía1(d1 ‚àí1)!
(1 ‚àíœÅ1z)d1 ‚àí¬∑ ¬∑ ¬∑ ‚àíal(dl ‚àí1)!
(1 ‚àíœÅlz)dl
is a rational function whose denominator polynomial is not divisible by
(1 ‚àíœÅkz)dk for any k.
Example 2: A more-or-less random recurrence.
Now that we've seen some general methods, we're ready to tackle new
problems. Let's try to nd a closed form for the recurrence
g0 = g1 = 1 ;
gn = gn‚àí1 + 2gn‚àí2 + (‚àí1)n ,
for n  2.
(7.32)
It's always a good idea to make a table of small cases rst, and the recurrence
lets us do that easily:
n
0
1
2
3
4
5
6
7
(‚àí1)n
1
‚àí1
1
‚àí1
1
‚àí1
1
‚àí1
gn
1
1
4
5
14
23
52
97
No closed form is evident, and this sequence isn't even listed in Sloane's
Handbook [330]; so we need to go through the four-step process if we want
to discover the solution.

7.3 SOLVING RECURRENCES 343
Step 1 is easy, since we merely need to insert fudge factors to x things
when n < 2: The equation
gn = gn‚àí1 + 2gn‚àí2 + (‚àí1)n[n  0] + [n = 1]
holds for all integers n. Now we can carry out Step 2:
N.B.: The upper
index on P
n=1 zn
is not missing!
G(z) =
X
n
gnzn =
X
n
gn‚àí1zn + 2
X
n
gn‚àí2zn +
X
n0
(‚àí1)nzn +
X
n=1
zn
= zG(z) + 2z2G(z) +
1
1 + z + z .
(Incidentally, we could also have used
¬°‚àí1
n
¬¢
instead of (‚àí1)n[n  0], thereby
getting P
n
¬°‚àí1
n
¬¢
zn = (1+z)‚àí1 by the binomial theorem.) Step 3 is elementary
algebra, which yields
G(z) =
1 + z(1 + z)
(1 + z)(1 ‚àíz ‚àí2z2) =
1 + z + z2
(1 ‚àí2z)(1 + z)2 .
And that leaves us with Step 4.
The squared factor in the denominator is a bit troublesome, since we
know that repeated roots are more complicated than distinct roots; but there
it is. We have two roots, œÅ1 = 2 and œÅ2 = ‚àí1; the general expansion theorem
(7.30) tells us that
gn = a12n + (a2n + c)(‚àí1)n
for some constant c, where
a1 = 1 + 1/2 + 1/4
(1 + 1/2)2
= 7
9 ;
a2 =
1 ‚àí1 + 1
1 ‚àí2/(‚àí1) = 1
3 .
(The second formula for ak in (7.31) is easier to use than the rst one when
the denominator has nice factors. We simply substitute z = 1/œÅk everywhere
in R(z), except in the factor where this gives zero, and divide by (dk ‚àí1)!;
this gives the coecient of ndk‚àí1œÅn
k.) Plugging in n = 0 tells us that the
value of the remaining constant c had better be 2
9; hence our answer is
gn =
7
92n +
¬≥
1
3n + 2
9
¬¥
(‚àí1)n .
(7.33)
It doesn't hurt to check the cases n = 1 and 2, just to be sure that we didn't
foul up. Maybe we should even try n = 3, since this formula looks weird. But
it's correct, all right.
Could we have discovered (7.33) by guesswork? Perhaps after tabulating
a few more values we may have observed that gn+1 ‚âà2gn when n is large.

344 GENERATING FUNCTIONS
And with chutzpah and luck we might even have been able to smoke out
the constant 7
9. But it sure is simpler and more reliable to have generating
functions as a tool.
Example 3: Mutually recursive sequences.
Sometimes we have two or more recurrences that depend on each other.
Then we can form generating functions for both of them, and solve both by
a simple extension of our four-step method.
For example, let's return to the problem of 3 √ó n domino tilings that we
explored earlier this chapter. If we want to know only the total number of
ways, Un, to cover a 3 √ó n rectangle with dominoes, without breaking this
number down into vertical dominoes versus horizontal dominoes, we needn't
go into as much detail as we did before. We can merely set up the recurrences
U0 = 1 ,
U1 = 0 ;
V0 = 0 ,
V1 = 1 ;
Un = 2Vn‚àí1 + Un‚àí2 ,
Vn = Un‚àí1 + Vn‚àí2 ,
for n  2.
Here Vn is the number of ways to cover a 3 √ó n rectangle-minus-corner, using
(3n ‚àí1)/2 dominoes. These recurrences are easy to discover, if we consider
the possible domino congurations at the rectangle's left edge, as before. Here
are the values of Un and Vn for small n:
n
0
1
2
3
4
5
6
7
Un
1
0
3
0
11
0
41
0
(7.34)
Vn
0
1
0
4
0
15
0
56
Let's nd closed forms, in four steps. First (Step 1), we have
Un = 2Vn‚àí1 + Un‚àí2 + [n = 0] ,
Vn = Un‚àí1 + Vn‚àí2 ,
for all n. Hence (Step 2),
U(z) = 2zV(z) + z2U(z) + 1 ,
V(z) = zU(z) + z2V(z) .
Now (Step 3) we must solve two equations in two unknowns; but these are
easy, since the second equation yields V(z) = zU(z)/(1 ‚àíz2); we nd
U(z) =
1 ‚àíz2
1 ‚àí4z2 + z4 ;
V(z) =
z
1 ‚àí4z2 + z4 .
(7.35)
(We had this formula for U(z) in (7.10), but with z3 instead of z2. In that
derivation, n was the number of dominoes; now it's the width of the rectangle.)
The denominator 1 ‚àí4z2 + z4 is a function of z2; this is what makes
U2n+1 = 0 and V2n = 0, as they should be. We can take advantage of this

7.3 SOLVING RECURRENCES 345
nice property of z2 by retaining z2 when we factor the denominator: We need
not take 1 ‚àí4z2 + z4 all the way to a product of four factors (1 ‚àíœÅkz), since
two factors of the form (1 ‚àíœÅkz2) will be enough to tell us the coecients.
In other words if we consider the generating function
W(z) =
1
1 ‚àí4z + z2 = W0 + W1 z + W2 z2 + ¬∑ ¬∑ ¬∑ ,
(7.36)
we will have V(z) = zW(z2) and U(z) = (1 ‚àíz2)W(z2); hence V2n+1 = Wn
and U2n = Wn ‚àíWn‚àí1.
We save time and energy by working with the
simpler function W(z).
The factors of 1‚àí4z+z2 are (z‚àí2‚àí
‚àö
3 ) and (z‚àí2+
‚àö
3 ), and they can
also be written
¬°
1 ‚àí(2+
‚àö
3 )z
¬¢
and
¬°
1 ‚àí(2‚àí
‚àö
3 )z
¬¢
because this polynomial
is its own reection. Thus it turns out that we have
V2n+1 = Wn = 3+2
‚àö
3
6
(2 +
‚àö
3 )n + 3‚àí2
‚àö
3
6
(2 ‚àí
‚àö
3 )n ;
U2n = Wn ‚àíWn‚àí1 = 3+
‚àö
3
6
(2 +
‚àö
3 )n + 3‚àí
‚àö
3
6
(2 ‚àí
‚àö
3 )n
= (2 +
‚àö
3 )n
3 ‚àí
‚àö
3
+ (2 ‚àí
‚àö
3 )n
3 +
‚àö
3
.
(7.37)
This is the desired closed form for the number of 3 √ó n domino tilings.
Incidentally, we can simplify the formula for U2n by realizing that the
second term always lies between 0 and 1. The number U2n is an integer, so
we have
U2n =
¬ª(2 +
‚àö
3 )n
3 ‚àí
‚àö
3
¬º
,
for n  0.
(7.38)
In fact, the other term (2 ‚àí
‚àö
3 )n/(3 +
‚àö
3 ) is extremely small when n is
large, because 2 ‚àí
‚àö
3 ‚âà0.268. This needs to be taken into account if we
try to use formula (7.38) in numerical calculations.
For example, a fairly
expensive name-brand hand calculator comes up with 413403.0005 when asked
to compute (2 +
‚àö
3)10/(3 ‚àí
‚àö
3). This is correct to nine signicant gures;
but the true value is slightly less than 413403, not slightly greater. Therefore
it would be a mistake to take the ceiling of 413403.0005; the correct answer,
U20 = 413403, is obtained by rounding to the nearest integer. Ceilings can
I've known slippery
oors too.
be hazardous.
Example 4: A closed form for change.
When we left the problem of making change, we had just calculated the
number of ways to pay 50/c. Let's try now to count the number of ways there
are to change a dollar, or a million dollars | still using only pennies, nickels,
dimes, quarters, and halves.

346 GENERATING FUNCTIONS
The generating function derived earlier is
C(z) =
1
1 ‚àíz
1
1 ‚àíz5
1
1 ‚àíz10
1
1 ‚àíz25
1
1 ‚àíz50 ;
this is a rational function of z with a denominator of degree 91. Therefore
we can decompose the denominator into 91 factors and come up with a 91-
term \closed form" for Cn, the number of ways to give n cents in change.
But that's too horrible to contemplate. Can't we do better than the general
method suggests, in this particular case?
One ray of hope suggests itself immediately, when we notice that the
denominator is almost a function of z5. The trick we just used to simplify
the calculations by noting that 1 ‚àí4z2 + z4 is a function of z2 can be applied
to C(z), if we replace 1/(1 ‚àíz) by (1 + z + z2 + z3 + z4)/(1 ‚àíz5):
C(z) = 1 + z + z2 + z3 + z4
1 ‚àíz5
1
1 ‚àíz5
1
1 ‚àíz10
1
1 ‚àíz25
1
1 ‚àíz50
= (1 + z + z2 + z3 + z4) C(z5) ,
C(z) =
1
1 ‚àíz
1
1 ‚àíz
1
1 ‚àíz2
1
1 ‚àíz5
1
1 ‚àíz10 .
The compressed function C(z) has a denominator whose degree is only 19,
so it's much more tractable than the original. This new expression for C(z)
shows us, incidentally, that C5n = C5n+1 = C5n+2 = C5n+3 = C5n+4; and
indeed, this set of equations is obvious in retrospect: The number of ways to
leave a 53/c tip is the same as the number of ways to leave a 50/c tip, because
the number of pennies is predetermined modulo 5.
But C(z) still doesn't have a really simple closed form based on the roots
Now we're also
getting compressed
reasoning.
of the denominator. The easiest way to compute the coecients of C(z) is
probably to recognize that each of the denominator factors is a divisor of
1 ‚àíz10. Hence we can write
C(z) =
A(z)
(1 ‚àíz10)5 ,
where A(z) = A0 + A1z + ¬∑ ¬∑ ¬∑ + A31z31.
(7.39)
The actual value of A(z), for the curious, is
(1 + z + ¬∑ ¬∑ ¬∑ + z9)2(1 + z2 + ¬∑ ¬∑ ¬∑ + z8)(1 + z5)
= 1 + 2z + 4z2 + 6z3 + 9z4 + 13z5 + 18z6 + 24z7
+ 31z8 + 39z9 + 45z10 + 52z11 + 57z12 + 63z13 + 67z14 + 69z15
+ 69z16 + 67z17 + 63z18 + 57z19 + 52z20 + 45z21 + 39z22 + 31z23
+ 24z24 + 18z25 + 13z26 + 9z27 + 6z28 + 4z29 + 2z30 + z31 .

7.3 SOLVING RECURRENCES 347
Finally, since 1/(1‚àíz10)5 = P
k0
¬°k+4
4
¬¢
z10k, we can determine the coecient
Cn = [zn] C(z) as follows, when n = 10q + r and 0  r < 10:
C10q+r =
X
j,k
Aj
¬°k+4
4
¬¢
[10q + r = 10k + j]
= Ar
¬°q+4
4
¬¢
+ Ar+10
¬°q+3
4
¬¢
+ Ar+20
¬°q+2
4
¬¢
+ Ar+30
¬°q+1
4
¬¢
. (7.40)
This gives ten cases, one for each value of r; but it's a pretty good closed
form, compared with alternatives that involve powers of complex numbers.
For example, we can use this expression to deduce the value of C50q =
C10q. Then r = 0 and we have
C50q =
¬µq+4
4
¬∂
+ 45
¬µq+3
4
¬∂
+ 52
¬µq+2
4
¬∂
+ 2
¬µq+1
4
¬∂
.
The number of ways to change 50/c is
¬°5
4
¬¢
+ 45
¬°4
4
¬¢
= 50; the number of ways
to change $1 is
¬°6
4
¬¢
+ 45
¬°5
4
¬¢
+ 52
¬°4
4
¬¢
= 292; and the number of ways to change
$1,000,000 is
¬µ2000004
4
¬∂
+ 45
¬µ2000003
4
¬∂
+ 52
¬µ2000002
4
¬∂
+ 2
¬µ2000001
4
¬∂
= 66666793333412666685000001 .
Example 5: A divergent series.
Now let's try to get a closed form for the numbers gn dened by
g0 = 1 ;
gn = ngn‚àí1 ,
for n > 0.
After staring at this for a few nanoseconds we realize that gn is just n!; in
Nowadays peo-
ple are talking
femtoseconds.
fact, the method of summation factors described in Chapter 2 suggests this
answer immediately. But let's try to solve the recurrence with generating
functions, just to see what happens. (A powerful technique should be able to
handle easy recurrences like this, as well as others that have answers we can't
guess so easily.)
The equation
gn = ngn‚àí1 + [n = 0]
holds for all n, and it leads to
G(z) =
X
n
gnzn =
X
n
ngn‚àí1 zn +
X
n=0
zn .
To complete Step 2, we want to express P
n ngn‚àí1 zn in terms of G(z),
and the basic maneuvers in Table 335 suggest that the derivative G‚Ä≤(z) =

348 GENERATING FUNCTIONS
P
n ngnzn‚àí1 is somehow involved. So we steer toward that kind of sum:
G(z) = 1 +
X
n
(n + 1)gn zn+1
= 1 +
X
n
ngn zn+1 +
X
n
gn zn+1
= 1 + z2G‚Ä≤(z) + zG(z) .
Let's check this equation, using the values of gn for small n. Since
G = 1 + z + 2z2 + 6z3 + 24z4 + ¬∑ ¬∑ ¬∑ ,
G‚Ä≤ =
1 + 4z + 18z2 + 96z3 + ¬∑ ¬∑ ¬∑ ,
we have
z2G‚Ä≤ =
z2 + 4z3 + 18z4 + 96z5 + ¬∑ ¬∑ ¬∑ ,
zG =
z + z2 + 2z3 + 6z4 + 24z5 + ¬∑ ¬∑ ¬∑ ,
1 = 1 .
These three lines add up to G, so we're ne so far. Incidentally, we often nd
it convenient to write `G' instead of `G(z)'; the extra `(z)' just clutters up the
formula when we aren't changing z.
Step 3 is next, and it's dierent from what we've done before because we
have a dierential equation to solve. But this is a dierential equation that
we can handle with the hypergeometric series techniques of Section 5.6; those
techniques aren't too bad. (Readers who are unfamiliar with hypergeometrics
needn't worry | this will be quick.)
\This will be quick."
That's what the
doctor said just
before he stuck me
with that needle.
Come to think of it,
\hypergeometric"
sounds a lot like
\hypodermic."
First we must get rid of the constant `1', so we take the derivative of
both sides:
G‚Ä≤ = (z2G‚Ä≤ + zG + 1)‚Ä≤ = (2zG‚Ä≤ + z2G‚Ä≤‚Ä≤) + (G + zG‚Ä≤)
= z2G‚Ä≤‚Ä≤ + 3zG‚Ä≤ + G .
The theory in Chapter 5 tells us to rewrite this using the œë operator, and we
know from exercise 6.13 that
œëG = zG‚Ä≤ ,
œë2G = z2G‚Ä≤‚Ä≤ + zG‚Ä≤ .
Therefore the desired form of the dierential equation is
œëG = zœë2G + 2zœëG + zG = z(œë + 1)2G .
According to (5.109), the solution with g0 = 1 is the hypergeometric series
F(1, 1; ; z).

7.3 SOLVING RECURRENCES 349
Step 3 was more than we bargained for; but now that we know what the
function G is, Step 4 is easy | the hypergeometric denition (5.76) gives us
the power series expansion:
G(z) = F
¬µ1, 1¬Ø¬Ø¬Ø z
¬∂
=
X
n0
1n 1n zn
n!
=
X
n0
n! zn .
We've conrmed the closed form we knew all along, gn = n!.
Notice that the technique gave the right answer even though G(z) di-
verges for all nonzero z.
The sequence n! grows so fast, the terms jn! znj
approach ‚àûas n ‚Üí‚àû, unless z = 0. This shows that formal power series
can be manipulated algebraically without worrying about convergence.
Example 6: A recurrence that goes all the way back.
Let's close this section by applying generating functions to a problem in
graph theory. A fan of order n is a graph on the vertices f0, 1, . . . , ng with
2n ‚àí1 edges dened as follows: Vertex 0 is connected by an edge to each of
the other n vertices, and vertex k is connected by an edge to vertex k + 1, for
1  k < n. Here, for example, is the fan of order 4, which has ve vertices
and seven edges.
s
s
s
s
s
0
1
2
3
4
¬©¬©¬©
¬°
¬°¬°




The problem of interest: How many spanning trees fn are in such a graph?
A spanning tree is a subgraph containing all the vertices, and containing
enough edges to make the subgraph connected yet not so many that it has
a cycle. It turns out that every spanning tree of a graph on n + 1 vertices
has exactly n edges.
With fewer than n edges the subgraph wouldn't be
connected, and with more than n it would have a cycle; graph theory books
prove this.
There are
¬°2n‚àí1
n
¬¢
ways to choose n edges from among the 2n ‚àí1 present
in a fan of order n, but these choices don't always yield a spanning tree. For
instance the subgraph
s
s
s
s
s
0
1
2
3
4
¬°
¬°¬°




has four edges but is not a spanning tree; it has a cycle from 0 to 4 to 3 to 0,
and it has no connection between f1, 2g and the other vertices. We want to
count how many of the
¬°2n‚àí1
n
¬¢
choices actually do yield spanning trees.

350 GENERATING FUNCTIONS
Let's look at some small cases. It's pretty easy to enumerate the spanning
trees for n = 1, 2, and 3:
r
r
f1 = 1
r
r
r
¬©¬©
r
r
r
¬©¬©
r
r
r
f2 = 3
r
r
r
r
¬°
¬°
¬©¬©
r
r
r
r
¬°
¬°
¬©¬©
r
r
r
r
¬°
¬°
r
r
r
r
¬°
¬°
r
r
r
r
¬°
¬°
r
r
r
r
¬©¬©
r
r
r
r
¬©¬©
r
r
r
r
f3 = 8
(We need not show the labels on the vertices, if we always draw vertex 0 at
the left.) What about the case n = 0? At rst it seems reasonable to set
f0 = 1; but we'll take f0 = 0, because the existence of a fan of order 0 (which
should have 2n ‚àí1 = ‚àí1 edges) is dubious.
Our four-step procedure tells us to nd a recurrence for fn that holds
for all n.
We can get a recurrence by observing how the topmost vertex
(vertex n) is connected to the rest of the spanning tree. If it's not connected
to vertex 0, it must be connected to vertex n ‚àí1, since it must be connected
to the rest of the graph. In this case, any of the fn‚àí1 spanning trees for the
remaining fan (on the vertices 0 through n ‚àí1) will complete a spanning tree
for the whole graph. Otherwise vertex n is connected to 0, and there's some
number k  n such that vertices n, n ‚àí1, . . . , k are connected directly but
the edge between k and k ‚àí1 is not present. Then there can't be any edges
between 0 and fn‚àí1, . . . , kg, or there would be a cycle. If k = 1, the spanning
tree is therefore determined completely. And if k > 1, any of the fk‚àí1 ways
to produce a spanning tree on f0, 1, . . . , k‚àí1g will yield a spanning tree on the
whole graph. For example, here's what this analysis produces when n = 4:
r
r
r
r
r




p ppp ppppp
ppppppp
ppppppppp
p ppp ppppp
pppppppp
f4
=
r
r
r
r
r
¬°
¬°
p pp ppp ppppp
ppppppp
p pp pppp
ppppp
f3
+
k = 4
r
r
r
r
r
¬°
¬°
p pp ppp ppppp
ppppppp
p pp pppp
ppppp



f3
+
k = 3
r
r
r
r
r
¬©¬©
p pp ppp pppp
p pp pp




f2
+
k = 2
r
r
r
r
r




f1
+
k = 1
r
r
r
r
r




1
The general equation, valid for n  1, is
fn = fn‚àí1 + fn‚àí1 + fn‚àí2 + fn‚àí3 + ¬∑ ¬∑ ¬∑ + f1 + 1 .
(It almost seems as though the `1' on the end is f0 and we should have chosen
f0 = 1; but we will doggedly stick with our choice.) A few changes suce to
make the equation valid for all integers n:
fn = fn‚àí1
+
X
k<n
fk
+ [n > 0] .
(7.41)

7.3 SOLVING RECURRENCES 351
This is a recurrence that \goes all the way back" from fn‚àí1 through all
previous values, so it's dierent from the other recurrences we've seen so far
in this chapter. We used a special method to get rid of a similar right-side
sum in Chapter 2, when we solved the quicksort recurrence (2.12); namely,
we subtracted one instance of the recurrence from another (fn+1 ‚àífn). This
trick would get rid of the P now, as it did then; but we'll see that generating
functions allow us to work directly with such sums. (And it's a good thing
that they do, because we will be seeing much more complicated recurrences
before long.)
Step 1 is nished; Step 2 is where we need to do a new thing:
F(z) =
X
n
fnzn =
X
n
fn‚àí1zn +
X
k,n
fkzn[k < n] +
X
n
[n > 0]zn
= zF(z) +
X
k
fkzk X
n
[n > k]zn‚àík
+
z
1 ‚àíz
= zF(z) + F(z)
X
m>0
zm
+
z
1 ‚àíz
= zF(z) + F(z)
z
1 ‚àíz
+
z
1 ‚àíz .
The key trick here was to change zn to zk zn‚àík; this made it possible to
express the value of the double sum in terms of F(z), as required in Step 2.
Now Step 3 is simple algebra, and we nd
F(z) =
z
1 ‚àí3z + z2 .
Those of us with a zest for memorization will recognize this as the generating
function (7.24) for the even-numbered Fibonacci numbers. So, we needn't go
through Step 4; we have found a somewhat surprising answer to the spans-
of-fans problem:
fn = F2n ,
for n  0.
(7.42)
7.4
SPECIAL GENERATING FUNCTIONS
Step 4 of the four-step procedure becomes much easier if we know
the coecients of lots of dierent power series. The expansions in Table 336
are quite useful, as far as they go, but many other types of closed forms are
possible.
Therefore we ought to supplement that table with another one,
which lists power series that correspond to the \special numbers" considered
in Chapter 6.

352 GENERATING FUNCTIONS
Table 352 Generating functions for special numbers.
1
(1 ‚àíz)m+1 ln
1
1 ‚àíz =
X
n0
(Hm+n ‚àíHm)
¬µm+n
n
¬∂
zn
(7.43)
z
ez ‚àí1 =
X
n0
Bn
zn
n!
(7.44)
Fmz
1 ‚àí(Fm‚àí1+Fm+1)z + (‚àí1)mz2 =
X
n0
Fmn zn
(7.45)
X
k
¬Øm
k
¬∞
k! zk
(1 ‚àíz)k+1 =
X
n0
nmzn
(7.46)
¬°
z‚àí1¬¢‚àím =
zm
(1 ‚àíz)(1 ‚àí2z) . . . (1 ‚àímz) =
X
n0
¬Øn
m
¬∞
zn
(7.47)
zm = z(z + 1) . . . (z + m ‚àí1) =
X
n0
¬∑m
n
¬∏
zn
(7.48)
¬°
ez ‚àí1
¬¢m = m!
X
n0
¬Øn
m
¬∞zn
n!
(7.49)
¬≥
ln
1
1 ‚àíz
¬¥m
= m!
X
n0
¬∑n
m
¬∏zn
n!
(7.50)
¬µ
z
ln(1 + z)
¬∂m
=
X
n0
zn
n!
¬Ø m
m‚àín
¬∞√Å¬µm‚àí1
n
¬∂
(7.51)
¬µ
z
1 ‚àíe‚àíz
¬∂m
=
X
n0
zn
n!
¬∑ m
m‚àín
¬∏√Å¬µm‚àí1
n
¬∂
(7.52)
ez+wz =
X
m,n0
¬µn
m
¬∂
wm zn
n!
(7.53)
ew(ez‚àí1) =
X
m,n0
¬Øn
m
¬∞
wm zn
n!
(7.54)
1
(1 ‚àíz)w =
X
m,n0
¬∑n
m
¬∏
wm zn
n!
(7.55)
1 ‚àíw
e(w‚àí1)z ‚àíw =
X
m,n0
¬øn
m
√Ä
wm zn
n!
(7.56)

7.4 SPECIAL GENERATING FUNCTIONS 353
Table 352 is the database we need. The identities in this table are not
dicult to prove, so we needn't dwell on them; this table is primarily for
reference when we meet a new problem. But there's a nice proof of the rst
formula, (7.43), that deserves mention: We start with the identity
1
(1 ‚àíz)x+1 =
X
n
¬µx + n
n
¬∂
zn
and dierentiate it with respect to x. On the left, (1 ‚àíz)‚àíx‚àí1 is equal to
e(x+1) ln(1/(1‚àíz)), so d/dx contributes a factor of ln
¬°
1/(1 ‚àíz)
¬¢
. On the right,
the numerator of
¬°x+n
n
¬¢
is (x+n) . . . (x+1), and d/dx splits this into n terms
whose sum is equivalent to multiplying
¬°x+n
n
¬¢
by
1
x + n + ¬∑ ¬∑ ¬∑ +
1
x + 1 = Hx+n ‚àíHx .
Replacing x by m gives (7.43). Notice that Hx+n ‚àíHx is meaningful even
when x is not an integer.
By the way, this method of dierentiating a complicated product | leav-
ing it as a product | is usually better than expressing the derivative as a sum.
For example the right side of
d
dx
¬°
(x+n)n . . . (x+1)1¬¢
= (x+n)n . . . (x+1)1
¬µ
n
x+n +¬∑ ¬∑ ¬∑+
1
x+1
¬∂
would be a lot messier written out as a sum.
The general identities in Table 352 include many important special cases.
For example, (7.43) simplies to the generating function for Hn when m = 0:
1
1 ‚àíz ln
1
1 ‚àíz =
X
n
Hnzn .
(7.57)
This equation can also be derived in other ways; for example, we can take the
power series for ln
¬°
1/(1 ‚àíz)
¬¢
and divide it by 1 ‚àíz to get cumulative sums.
Identities (7.51) and (7.52) involve the respective ratios
¬©
m
m‚àín
¬™¬±¬°m‚àí1
n
¬¢
and
¬£
m
m‚àín
¬§¬±¬°m‚àí1
n
¬¢
, which have the undened form 0/0 when n  m. However,
there is a way to give them a proper meaning using the Stirling polynomials
of (6.45), because we have
¬Ø
m
m ‚àín
¬∞√Å¬µm ‚àí1
n
¬∂
= (‚àí1)n+1n! mœÉn(n ‚àím) ;
(7.58)
¬∑
m
m ‚àín
¬∏√Å¬µm ‚àí1
n
¬∂
= n! mœÉn(m) .
(7.59)
Thus, for example, the case m = 1 of (7.51) should not be regarded as the
power series P
n0(zn/n!)
¬©
1
1‚àín
¬™¬±¬°0
n
¬¢
, but rather as
z
ln(1 + z) = ‚àí
X
n0
(‚àíz)nœÉn(n ‚àí1) = 1 + 1
2z ‚àí
1
12z2 + ¬∑ ¬∑ ¬∑ .

354 GENERATING FUNCTIONS
Identities (7.53), (7.55), (7.54), and (7.56) are \double generating func-
tions" or \super generating functions" because they have the form G(w, z) =
P
m,n gm,nwmzn.
The coecient of wm is a generating function in the
variable z; the coecient of zn is a generating function in the variable w.
Equation (7.56) can be put into the more symmetrical form
ew ‚àíez
wez ‚àízew =
X
m,n
¬øm + n + 1
m
√Ä
wmzn
(m + n + 1)! .
(7.60)
7.5
CONVOLUTIONS
The convolution of two given sequences ‚ü®f0, f1, . . . ‚ü©= ‚ü®fn‚ü©and
I always thought
convolution was
what happens to
my brain when I
try to do a proof.
‚ü®g0, g1, . . . ‚ü©= ‚ü®gn‚ü©is the sequence ‚ü®f0g0, f0g1 + f1g0, . . . ‚ü©= ‚ü®P
k fkgn‚àík‚ü©.
We have observed in Sections 5.4 and 7.2 that convolution of sequences cor-
responds to multiplication of their generating functions. This fact makes it
easy to evaluate many sums that would otherwise be dicult to handle.
Example 1: A Fibonacci convolution.
For example, let's try to evaluate Pn
k=0 FkFn‚àík in closed form. This is
the convolution of ‚ü®Fn‚ü©with itself, so the sum must be the coecient of zn
in F(z)2, where F(z) is the generating function for ‚ü®Fn‚ü©. All we have to do is
gure out the value of this coecient.
The generating function F(z) is z/(1‚àíz‚àíz2), a quotient of polynomials; so
the general expansion theorem for rational functions tells us that the answer
can be obtained from a partial fraction representation. We can use the general
expansion theorem (7.30) and grind away; or we can use the fact that
F(z)2 =
¬µ 1
‚àö
5
¬µ
1
1 ‚àíœÜz ‚àí
1
1 ‚àíbœÜz
¬∂¬∂2
= 1
5
¬µ
1
(1 ‚àíœÜz)2 ‚àí
2
(1 ‚àíœÜz)(1 ‚àíbœÜz) +
1
(1 ‚àíbœÜz)2
¬∂
= 1
5
X
n0
(n + 1)œÜnzn ‚àí2
5
X
n0
Fn+1zn + 1
5
X
n0
(n + 1)bœÜnzn .
Instead of expressing the answer in terms of œÜ and bœÜ, let's try for a closed
form in terms of Fibonacci numbers. Recalling that œÜ + bœÜ = 1, we have
œÜn + bœÜn = [zn]
¬µ
1
1 ‚àíœÜz +
1
1 ‚àíbœÜz
¬∂
= [zn]
2 ‚àí(œÜ + bœÜ)z
(1 ‚àíœÜz)(1 ‚àíbœÜz) = [zn]
2 ‚àíz
1 ‚àíz ‚àíz2 = 2Fn+1 ‚àíFn .

7.5 CONVOLUTIONS 355
Hence
F(z)2 = 1
5
X
n0
(n + 1)(2Fn+1 ‚àíFn)zn ‚àí2
5
X
n0
Fn+1 zn ,
and we have the answer we seek:
n
X
k=0
FkFn‚àík = 2nFn+1 ‚àí(n + 1)Fn
5
.
(7.61)
For example, when n = 3 this formula gives F0F3 + F1F2 + F2F1 + F3F0 =
0 + 1 + 1 + 0 = 2 on the left and (6F4 ‚àí4F3)/5 = (18 ‚àí8)/5 = 2 on the right.
Example 2: Harmonic convolutions.
The eciency of a certain computer method called \samplesort" depends
on the value of the sum
Tm,n =
X
0k<n
¬µ k
m
¬∂
1
n ‚àík ,
integers m, n  0.
Exercise 5.58 obtains the value of this sum by a somewhat intricate double
induction, using summation factors. It's much easier to realize that Tm,n is
just the nth term in the convolution of ‚ü®
¬° 0
m
¬¢
,
¬° 1
m
¬¢
,
¬° 2
m
¬¢
, . . . ‚ü©with ‚ü®0, 1
1, 1
2, . . . ‚ü©.
Both sequences have simple generating functions in Table 336:
X
n0
¬µn
m
¬∂
zn =
zm
(1 ‚àíz)m+1 ;
X
n>0
zn
n
= ln
1
1 ‚àíz .
Therefore, by (7.43),
Tm,n = [zn]
zm
(1 ‚àíz)m+1 ln
1
1 ‚àíz = [zn‚àím]
1
(1 ‚àíz)m+1 ln
1
1 ‚àíz
= (Hn ‚àíHm)
¬µ
n
n ‚àím
¬∂
.
In fact, there are many more sums that boil down to this same sort of
convolution, because we have
1
(1 ‚àíz)r+1 ln
1
1 ‚àíz ¬∑
1
(1 ‚àíz)s+1 =
1
(1 ‚àíz)r+s+2 ln
1
1 ‚àíz
for all r and s. Equating coecients of zn gives the general identity
X
k
¬µr + k
k
¬∂¬µs + n ‚àík
n ‚àík
¬∂
(Hr+k ‚àíHr)
=
¬µr + s + n + 1
n
¬∂
(Hr+s+n+1 ‚àíHr+s+1) .
(7.62)

356 GENERATING FUNCTIONS
This seems almost too good to be true. But it checks, at least when n = 2:
Because it's so
harmonic.
¬µr + 1
1
¬∂¬µs + 1
1
¬∂
1
r + 1 +
¬µr + 2
2
¬∂¬µs + 0
0
¬∂¬µ
1
r + 2 +
1
r + 1
¬∂
=
¬µr + s + 3
2
¬∂¬µ
1
r + s + 3 +
1
r + s + 2
¬∂
.
Special cases like s = 0 are as remarkable as the general case.
And there's more. We can use the convolution identity
X
k
¬µr + k
k
¬∂¬µs + n ‚àík
n ‚àík
¬∂
=
¬µr + s + n + 1
n
¬∂
to transpose Hr to the other side, since Hr is independent of k:
X
k
¬µr + k
k
¬∂¬µs + n ‚àík
n ‚àík
¬∂
Hr+k
=
¬µr + s + n + 1
n
¬∂
(Hr+s+n+1 ‚àíHr+s+1 + Hr) .
(7.63)
There's still more: If r and s are nonnegative integers l and m, we can replace
¬°r+k
k
¬¢
by
¬°l+k
l
¬¢
and
¬°s+n‚àík
n‚àík
¬¢
by
¬°m+n‚àík
m
¬¢
; then we can change k to k ‚àíl and
n to n ‚àím ‚àíl, getting
n
X
k=0
¬µk
l
¬∂¬µn ‚àík
m
¬∂
Hk =
¬µ
n + 1
l + m + 1
¬∂
(Hn+1 ‚àíHl+m+1 + Hl) ,
integers l, m, n  0.
(7.64)
Even the special case l = m = 0 of this identity was dicult for us to handle
in Chapter 2!
¬°
See (2.36).
¬¢
We've come a long way.
Example 3: Convolutions of convolutions.
If we form the convolution of ‚ü®fn‚ü©and ‚ü®gn‚ü©, then convolve this with a
third sequence ‚ü®hn‚ü©, we get a sequence whose nth term is
X
j+k+l=n
fj gk hl .
The generating function of this three-fold convolution is, of course, the three-
fold product F(z)G(z)H(z).
In a similar way, the m-fold convolution of a
sequence ‚ü®gn‚ü©with itself has nth term equal to
X
k1+k2+¬∑¬∑¬∑+km=n
gk1 gk2 . . . gkm
and its generating function is G(z)m.

7.5 CONVOLUTIONS 357
We can apply these observations to the spans-of-fans problem considered
earlier (Example 6 in Section 7.3). It turns out that there's another way to
compute fn, the number of spanning trees of an n-fan, based on the cong-
urations of tree edges between the vertices f1, 2, . . . , ng: The edge between
vertex k and vertex k+1 may or may not be selected for the tree; and each of
the ways to select these edges connects up certain blocks of adjacent vertices.
Concrete blocks.
For example, when n = 10 we might connect vertices f1, 2g, f3g, f4, 5, 6, 7g, and
f8, 9, 10g:
s
s
s
s
s
s
s
s
s
s
s
0
1
2
3
4
5
6
7
8
9
10
How many spanning trees can we make, by adding additional edges to ver-
tex 0? We need to connect 0 to each of the four blocks; and there are two
ways to join 0 with f1, 2g, one way to join it with f3g, four ways with f4, 5, 6, 7g,
and three ways with f8, 9, 10g, or 2 ¬∑ 1 ¬∑ 4 ¬∑ 3 = 24 ways altogether. Summing
over all possible ways to make blocks gives us the following expression for the
total number of spanning trees:
fn =
X
m>0
X
k1+k2+¬∑¬∑¬∑+km=n
k1,k2,...,km>0
k1k2 . . . km .
(7.65)
For example, f4 = 4 + 3¬∑1 + 2¬∑2 + 1¬∑3 + 2¬∑1¬∑1 + 1¬∑2¬∑1 + 1¬∑1¬∑2 + 1¬∑1¬∑1¬∑1 = 21.
This is the sum of m-fold convolutions of the sequence ‚ü®0, 1, 2, 3, . . . ‚ü©, for
m = 1, 2, 3, . . . ; hence the generating function for ‚ü®fn‚ü©is
F(z) = G(z) + G(z)2 + G(z)3 + ¬∑ ¬∑ ¬∑ =
G(z)
1 ‚àíG(z)
where G(z) is the generating function for ‚ü®0, 1, 2, 3, . . . ‚ü©, namely z/(1 ‚àíz)2.
Consequently we have
F(z) =
z
(1 ‚àíz)2 ‚àíz =
z
1 ‚àí3z + z2 ,
as before. This approach to ‚ü®fn‚ü©is more symmetrical and appealing than the
complicated recurrence we had earlier.

358 GENERATING FUNCTIONS
Example 4: A convoluted recurrence.
Our next example is especially important. In fact, it's the \classic exam-
ple" of why generating functions are useful in the solution of recurrences.
Suppose we have n + 1 variables x0, x1, . . . , xn whose product is to be
computed by doing n multiplications. How many ways Cn are there to insert
parentheses into the product x0¬∑x1¬∑. . .¬∑xn so that the order of multiplication is
completely specied? For example, when n = 2 there are two ways, x0¬∑(x1¬∑x2)
and (x0 ¬∑x1) ¬∑ x2. And when n = 3 there are ve ways,
x0 ¬∑(x1 ¬∑(x2 ¬∑x3)) , x0 ¬∑((x1 ¬∑x2)¬∑x3) , (x0 ¬∑x1)¬∑(x2 ¬∑x3) ,
(x0 ¬∑(x1 ¬∑x2))¬∑x3 , ((x0 ¬∑x1)¬∑x2)¬∑x3 .
Thus C2 = 2, C3 = 5; we also have C1 = 1 and C0 = 1.
Let's use the four-step procedure of Section 7.3. What is a recurrence
for the C's? The key observation is that there's exactly one ` ¬∑ ' operation
outside all of the parentheses, when n > 0; this is the nal multiplication
that ties everything together. If this ` ¬∑ ' occurs between xk and xk+1, there
are Ck ways to fully parenthesize x0 ¬∑. . .¬∑xk, and there are Cn‚àík‚àí1 ways to
fully parenthesize xk+1 ¬∑. . .¬∑xn; hence
Cn = C0Cn‚àí1 + C1Cn‚àí2 + ¬∑ ¬∑ ¬∑ + Cn‚àí1C0 ,
if n > 0.
By now we recognize this expression as a convolution, and we know how to
patch the formula so that it holds for all integers n:
Cn =
X
k
CkCn‚àí1‚àík + [n = 0] .
(7.66)
Step 1 is now complete. Step 2 tells us to multiply by zn and sum:
C(z) =
X
n
Cnzn
=
X
k,n
CkCn‚àí1‚àíkzn +
X
n=0
zn
=
X
k
Ckzk X
n
Cn‚àí1‚àíkzn‚àík + 1
= C(z) ¬∑ zC(z) + 1 .
Lo and behold, the convolution has become a product, in the generating-
function world. Life is full of surprises.
The authors jest.

7.5 CONVOLUTIONS 359
Step 3 is also easy. We solve for C(z) by the quadratic formula:
C(z) = 1 ¬±
p
1 ‚àí4z
2z
.
But should we choose the + sign or the ‚àísign? Both choices yield a function
that satises C(z) = zC(z)2 +1, but only one of the choices is suitable for our
problem. We might choose the + sign on the grounds that positive thinking
is best; but we soon discover that this choice gives C(0) = ‚àû, contrary to
the facts. (The correct function C(z) is supposed to have C(0) = C0 = 1.)
Therefore we conclude that
C(z) = 1 ‚àí
p
1 ‚àí4z
2z
.
Finally, Step 4. What is [zn] C(z)? The binomial theorem tells us that
‚àö
1 ‚àí4z =
X
k0
¬µ1/2
k
¬∂
(‚àí4z)k = 1 +
X
k1
1
2k
¬µ‚àí1/2
k ‚àí1
¬∂
(‚àí4z)k ;
hence, using (5.37),
1 ‚àí
p
1 ‚àí4z
2z
=
X
k1
1
k
¬µ‚àí1/2
k ‚àí1
¬∂
(‚àí4z)k‚àí1
=
X
n0
¬µ‚àí1/2
n
¬∂(‚àí4z)n
n + 1
=
X
n0
¬µ2n
n
¬∂ zn
n + 1 .
The number of ways to parenthesize, Cn, is
¬°2n
n
¬¢
1
n+1.
We anticipated this result in Chapter 5, when we introduced the sequence
So the convo-
luted recurrence
has led us to an
oft-recurring con-
volution.
of Catalan numbers ‚ü®1, 1, 2, 5, 14, . . . ‚ü©= ‚ü®Cn‚ü©. This sequence arises in dozens
of problems that seem at rst to be unrelated to each other [46], because
many situations have a recursive structure that corresponds to the convolution
recurrence (7.66).
For example, let's consider the following problem: How many sequences
‚ü®a1, a2 . . . , a2n‚ü©of +1's and ‚àí1's have the property that
a1 + a2 + ¬∑ ¬∑ ¬∑ + a2n = 0
and have all their partial sums
a1,
a1 + a2,
. . . ,
a1 + a2 + ¬∑ ¬∑ ¬∑ + a2n
nonnegative? There must be n occurrences of +1 and n occurrences of ‚àí1.
We can represent this problem graphically by plotting the sequence of partial

360 GENERATING FUNCTIONS
sums sn = Pn
k=1 ak as a function of n: The ve solutions for n = 3 are
q¬°
q¬°
q¬°
q
@q
@q
@q ,
q¬°
q¬°
q
@q¬°
q
@q
@q ,
q¬°
q
@q¬°
q¬°
q
@q
@q ,
q¬°
q¬°
q
@q
@q¬°
q
@q ,
q¬°
q
@q¬°
q
@q¬°
q
@q .
These are \mountain ranges" of width 2n that can be drawn with line seg-
ments of the forms q¬°
q
and
q
@q. It turns out that there are exactly Cn ways to
do this, and the sequences can be related to the parenthesis problem in the
following way: Put an extra pair of parentheses around the entire formula, so
that there are n pairs of parentheses corresponding to the n multiplications.
Now replace each ` ¬∑ ' by +1 and each `)' by ‚àí1 and erase everything else.
For example, the formula x0 ¬∑
¬°
(x1 ¬∑x2)¬∑(x3 ¬∑x4)
¬¢
corresponds to the sequence
‚ü®+1, +1, ‚àí1, +1, +1, ‚àí1, ‚àí1, ‚àí1‚ü©by this rule. The ve ways to parenthesize
x0 ¬∑x1 ¬∑x2 ¬∑x3 correspond to the ve mountain ranges for n = 3 shown above.
Moreover, a slight reformulation of our sequence-counting problem leads
to a surprisingly simple combinatorial solution that avoids the use of gener-
ating functions: How many sequences ‚ü®a0, a1, a2, . . . , a2n‚ü©of +1's and ‚àí1's
have the property that
a0 + a1 + a2 + ¬∑ ¬∑ ¬∑ + a2n = 1 ,
when all the partial sums
a0,
a0 + a1,
a0 + a1 + a2,
. . . ,
a0 + a1 + ¬∑ ¬∑ ¬∑ + a2n
are required to be positive? Clearly these are just the sequences of the pre-
vious problem, with the additional element a0 = +1 placed in front. But
the sequences in the new problem can be enumerated by a simple counting
argument, using a remarkable fact discovered by George Raney [302] in 1959:
If ‚ü®x1, x2, . . . , xm‚ü©is any sequence of integers whose sum is +1, exactly one
of the cyclic shifts
‚ü®x1, x2, . . . , xm‚ü©, ‚ü®x2, . . . , xm, x1‚ü©, . . . , ‚ü®xm, x1, . . . , xm‚àí1‚ü©
has all of its partial sums positive.
For example, consider the sequence
‚ü®3, ‚àí5, 2, ‚àí2, 3, 0‚ü©. Its cyclic shifts are
‚ü®3, ‚àí5, 2, ‚àí2, 3, 0‚ü©
‚ü®‚àí2, 3, 0, 3, ‚àí5, 2‚ü©
‚ü®‚àí5, 2, ‚àí2, 3, 0, 3‚ü©
‚ü®3, 0, 3, ‚àí5, 2, ‚àí2‚ü©
‚àö
‚ü®2, ‚àí2, 3, 0, 3, ‚àí5‚ü©
‚ü®0, 3, ‚àí5, 2, ‚àí2, 3‚ü©
and only the one that's checked has entirely positive partial sums.

7.5 CONVOLUTIONS 361
Raney's lemma can be proved by a simple geometric argument. Let's
extend the sequence periodically to get an innite sequence
‚ü®x1, x2, . . . , xm, x1, x2, . . . , xm, x1, x2, . . . ‚ü©;
thus we let xm+k = xk for all k  0.
If we now plot the partial sums
sn = x1 + ¬∑ ¬∑ ¬∑ + xn as a function of n, the graph of sn has an \average slope"
of 1/m, because sm+n = sn + 1. For example, the graph corresponding to
our example sequence ‚ü®3, ‚àí5, 2, ‚àí2, 3, 0, 3, ‚àí5, 2, . . . ‚ü©begins as follows:
q¬£
¬£
¬£
q
D
D
D
D
DDq¬¢
¬¢
q
A
Aq¬£
¬£
¬£
q q¬£
¬£
¬£¬£
q
D
D
D
D
Dq¬¢
¬¢
q
A
Aq¬£
¬£
¬£
q q¬£
¬£
¬£¬£
q
D
D
D
D
Dq¬¢
¬¢
q
A
Aq¬£
¬£
¬£
q q¬£
¬£
¬£¬£
q
D
D
D
D
Dq¬¢
¬¢
q
A
Aq¬£
¬£
¬£
q q
. . .
((((((((((((((((((((((((((
((((
(((((((((((((((((((((((((((((
(
The entire graph can be contained between two lines of slope 1/m, as shown;
Ah, if stock prices
would only continue
to rise like this.
we have m = 6 in the illustration. In general these bounding lines touch the
graph just once in each cycle of m points, since lines of slope 1/m hit points
with integer coordinates only once per m units. The unique lower point of
intersection is the only place in the cycle from which all partial sums will
be positive, because every other point on the curve has an intersection point
within m units to its right.
With Raney's lemma we can easily enumerate the sequences ‚ü®a0, . . . , a2n‚ü©
(Attention, com-
puter scientists:
The partial sums
in this problem
represent the stack
size as a function of
time, when a prod-
uct of n + 1 factors
is evaluated, be-
cause each \push"
operation changes
the size by +1 and
each multiplication
changes it by ‚àí1.)
of +1's and ‚àí1's whose partial sums are entirely positive and whose total
sum is +1. There are
¬°2n+1
n
¬¢
sequences with n occurrences of ‚àí1 and n + 1
occurrences of +1, and Raney's lemma tells us that exactly 1/(2n + 1) of
these sequences have all partial sums positive. (List all N =
¬°2n+1
n
¬¢
of these
sequences and all 2n + 1 of their cyclic shifts, in an N √ó (2n + 1) array. Each
row contains exactly one solution. Each solution appears exactly once in each
column. So there are N/(2n+1) distinct solutions in the array, each appearing
(2n + 1) times.) The total number of sequences with positive partial sums is
¬µ2n + 1
n
¬∂
1
2n + 1 =
¬µ2n
n
¬∂
1
n + 1 = Cn .
Example 5: A recurrence with m-fold convolution.
We can generalize the problem just considered by looking at sequences
‚ü®a0, . . . , amn‚ü©of +1's and (1 ‚àím)'s whose partial sums are all positive and

362 GENERATING FUNCTIONS
whose total sum is +1. Such sequences can be called m-Raney sequences. If
there are k occurrences of (1‚àím) and mn+1‚àík occurrences of +1, we have
k(1 ‚àím) + (mn + 1 ‚àík) = 1 ,
hence k = n. There are
¬°mn+1
n
¬¢
sequences with n occurrences of (1 ‚àím) and
(Attention, com-
puter scientists:
The stack interpre-
tation now applies
with respect to an
m-ary operation,
instead of the bi-
nary multiplication
considered earlier.)
mn + 1 ‚àín occurrences of +1, and Raney's lemma tells us that the number
of such sequences with all partial sums positive is exactly
¬µmn + 1
n
¬∂
1
mn + 1 =
¬µmn
n
¬∂
1
(m ‚àí1)n + 1 .
(7.67)
So this is the number of m-Raney sequences. Let's call this a Fuss-Catalan
number C(m)
n
, because the sequence ‚ü®C(m)
n
‚ü©was rst investigated by N. I.
Fuss [135] in 1791 (many years before Catalan himself got into the act). The
ordinary Catalan numbers are Cn = C(2)
n .
Now that we know the answer, (7.67), let's play \Jeopardy" and gure
out a question that leads to it. In the case m = 2 the question was: \What
numbers Cn satisfy the recurrence Cn = P
k CkCn‚àí1‚àík + [n = 0]?" We will
try to nd a similar question (a similar recurrence) in the general case.
The trivial sequence ‚ü®+1‚ü©of length 1 is clearly an m-Raney sequence. If
we put the number (1‚àím) at the right of any m sequences that are m-Raney,
we get an m-Raney sequence; the partial sums stay positive as they increase
to +2, then +3, . . . , +m, and +1. Conversely, we can show that all m-Raney
sequences ‚ü®a0, . . . , amn‚ü©arise in this way, if n > 0: The last term amn must
be (1‚àím). The partial sums sj = a0 +¬∑ ¬∑ ¬∑+aj‚àí1 are positive for 1  j  mn,
and smn = m because smn+amn = 1. Let k1 be the largest index  mn such
that sk1 = 1; let k2 be largest such that sk2 = 2; and so on. Thus skj = j and
sk > j, for kj < k  mn and 1  j  m. It follows that km = mn, and we
can verify without diculty that each of the subsequences ‚ü®a0, . . . , ak1‚àí1‚ü©,
‚ü®ak1, . . . , ak2‚àí1‚ü©, . . . , ‚ü®akm‚àí1, . . . , akm‚àí1‚ü©is an m-Raney sequence. We must
have k1 = mn1 + 1, k2 ‚àík1 = mn2 + 1, . . . , km ‚àíkm‚àí1 = mnm + 1, for
some nonnegative integers n1, n2, . . . , nm.
Therefore
¬°mn+1
n
¬¢
1
mn+1 is the answer to the following two interesting
questions: \What are the numbers C(m)
n
dened by the recurrence
C(m)
n
=
√É
X
n1+n2+¬∑¬∑¬∑+nm=n‚àí1
C(m)
n1 C(m)
n2 . . . C(m)
nm
!
+ [n = 0]
(7.68)
for all integers n?" \If G(z) is a power series that satises
G(z) = z G(z)m + 1 ,
(7.69)
what is [zn] G(z)?"

7.5 CONVOLUTIONS 363
Notice that these are not easy questions. In the ordinary Catalan case
(m = 2), we solved (7.69) for G(z) and its coecients by using the quadratic
formula and the binomial theorem; but when m = 3, none of the standard
techniques gives any clue about how to solve the cubic equation G = zG3 +1.
So it has turned out to be easier to answer this question before asking it.
Now, however, we know enough to ask even harder questions and deduce
their answers. How about this one: \What is [zn] G(z)l, if l is a positive
integer and if G(z) is the power series dened by (7.69)?" The argument we
just gave can be used to show that [zn] G(z)l is the number of sequences of
length mn + l with the following three properties:
‚Ä¢
Each element is either +1 or (1 ‚àím).
‚Ä¢
The partial sums are all positive.
‚Ä¢
The total sum is l.
For we get all such sequences in a unique way by putting together l sequences
that have the m-Raney property. The number of ways to do this is
X
n1+n2+¬∑¬∑¬∑+nl=n
C(m)
n1 C(m)
n2 . . . C(m)
nl
= [zn] G(z)l .
Raney proved a generalization of his lemma that tells us how to count
such sequences: If ‚ü®x1, x2, . . . , xm‚ü©is any sequence of integers with xj  1 for
all j, and with x1 + x2 + ¬∑ ¬∑ ¬∑ + xm = l > 0, then exactly l of the cyclic shifts
‚ü®x1, x2, . . . , xm‚ü©, ‚ü®x2, . . . , xm, x1‚ü©, . . . , ‚ü®xm, x1, . . . , xm‚àí1‚ü©
have all positive partial sums.
For example, we can check this statement on the sequence ‚ü®‚àí2, 1, ‚àí1, 0,
1, 1, ‚àí1, 1, 1, 1‚ü©. The cyclic shifts are
‚ü®‚àí2, 1, ‚àí1, 0, 1, 1, ‚àí1, 1, 1, 1‚ü©
‚ü®1, ‚àí1, 1, 1, 1, ‚àí2, 1, ‚àí1, 0, 1‚ü©
‚ü®1, ‚àí1, 0, 1, 1, ‚àí1, 1, 1, 1, ‚àí2‚ü©
‚ü®‚àí1, 1, 1, 1, ‚àí2, 1, ‚àí1, 0, 1, 1‚ü©
‚ü®‚àí1, 0, 1, 1, ‚àí1, 1, 1, 1, ‚àí2, 1‚ü©
‚ü®1, 1, 1, ‚àí2, 1, ‚àí1, 0, 1, 1, ‚àí1‚ü©
‚àö
‚ü®0, 1, 1, ‚àí1, 1, 1, 1, ‚àí2, 1, ‚àí1‚ü©
‚ü®1, 1, ‚àí2, 1, ‚àí1, 0, 1, 1, ‚àí1, 1‚ü©
‚ü®1, 1, ‚àí1, 1, 1, 1, ‚àí2, 1, ‚àí1, 0‚ü©
‚àö
‚ü®1, ‚àí2, 1, ‚àí1, 0, 1, 1, ‚àí1, 1, 1‚ü©
and only the two examples marked `
‚àö' have all partial sums positive. This
generalized lemma is proved in exercise 13.
A sequence of +1's and (1 ‚àím)'s that has length mn + l and total sum l
must have exactly n occurrences of (1 ‚àím). The generalized lemma tells
us that l/(mn + l) of these
¬°mn+l
n
¬¢
sequences have all partial sums positive;

364 GENERATING FUNCTIONS
hence our tough question has a surprisingly simple answer:
[zn] G(z)l =
¬µmn + l
n
¬∂
l
mn + l ,
(7.70)
for all integers l > 0.
Readers who haven't forgotten Chapter 5 might well be experiencing deja
vu: \That formula looks familiar; haven't we seen it before?" Yes, indeed;
Lambert's equation (5.60) says that
[zn] Bt(z)r =
¬µtn + r
n
¬∂
r
tn + r .
Therefore the generating function G(z) in (7.69) must actually be the gener-
alized binomial series Bm(z). Sure enough, equation (5.59) says
Bm(z)1‚àím ‚àíBm(z)‚àím = z ,
which is the same as
Bm(z) ‚àí1 = zBm(z)m .
Let's switch to the notation of Chapter 5, now that we know we're dealing
with generalized binomials. Chapter 5 stated a bunch of identities without
proof. We have now closed part of the gap by proving that the power series
Bt(z) dened by
Bt(z) =
X
n
¬µtn + 1
n
¬∂
zn
tn + 1
has the remarkable property that
Bt(z)r =
X
n
¬µtn + r
n
¬∂ r zn
tn + r ,
whenever t and r are positive integers.
Can we extend these results to arbitrary values of t and r? Yes; because
the coecients
¬°tn+r
n
¬¢
r
tn+r are polynomials in t and r. The general rth power
dened by
Bt(z)r = er ln Bt(z) =
X
n0
¬°
r ln Bt(z)
¬¢n
n!
=
X
n0
rn
n!
¬µ
‚àí
X
m1
¬°
1‚àíBt(z)
¬¢m
m
¬∂n
has coecients that are polynomials in t and r; and those polynomials are
equal to
¬°tn+r
n
¬¢
r
tn+r for innitely many values of t and r. So the two sequences
of polynomials must be identically equal.

7.5 CONVOLUTIONS 365
Chapter 5 also mentions the generalized exponential series
Et(z) =
X
n0
(tn + 1)n‚àí1
n!
zn ,
which is said in (5.60) to have an equally remarkable property:
[zn] Et(z)r = r(tn + r)n‚àí1
n!
.
(7.71)
We can prove this as a limiting case of the formulas for Bt(z), because it is
not dicult to show that
Et(z)r =
lim
x‚Üí‚àûBxt(z/x)xr .
7.6
EXPONENTIAL GF'S
Sometimes a sequence ‚ü®gn‚ü©has a generating function whose proper-
ties are quite complicated, while the related sequence ‚ü®gn/n!‚ü©has a generating
function that's quite simple. In such cases we naturally prefer to work with
‚ü®gn/n!‚ü©and then multiply by n! at the end. This trick works suciently
often that we have a special name for it: We call the power series
bG(z) =
X
n0
gn
zn
n!
(7.72)
the exponential generating function or \egf" of the sequence ‚ü®g0, g1, g2, . . . ‚ü©.
This name arises because the exponential function ez is the egf of ‚ü®1, 1, 1, . . . ‚ü©.
Many of the generating functions in Table 352 are actually egf's. For
example, equation (7.50) says that
¬°
ln
1
1‚àíz
¬¢m/m! is the egf for the sequence
‚ü®
¬£ 0
m
¬§
,
¬£ 1
m
¬§
,
¬£ 2
m
¬§
, . . . ‚ü©.
The ordinary generating function for this sequence is
much more complicated (and also divergent).
Exponential generating functions have their own basic maneuvers, analo-
gous to the operations we learned in Section 7.2. For example, if we multiply
the egf of ‚ü®gn‚ü©by z, we get
X
n0
gn
zn+1
n!
=
X
n1
gn‚àí1
zn
(n ‚àí1)! =
X
n0
ngn‚àí1
zn
n! ;
this is the egf of ‚ü®0, g0, 2g1, . . . ‚ü©= ‚ü®ngn‚àí1‚ü©.
Dierentiating the egf of ‚ü®g0, g1, g2, . . . ‚ü©with respect to z gives
Are we having
fun yet?
X
n0
ngn
zn‚àí1
n!
=
X
n1
gn
zn‚àí1
(n ‚àí1)! =
X
n0
gn+1
zn
n! ;
(7.73)

366 GENERATING FUNCTIONS
this is the egf of ‚ü®g1, g2, . . . ‚ü©. Thus dierentiation on egf's corresponds to the
left-shift operation
¬°
G(z) ‚àíg0
¬¢
/z on ordinary gf's. (We used this left-shift
property of egf's when we studied hypergeometric series, (5.106).) Integration
of an egf gives
Z z
0
X
n0
gn
tn
n! dt =
X
n0
gn
zn+1
(n + 1)! =
X
n1
gn‚àí1
zn
n! ;
(7.74)
this is a right shift, the egf of ‚ü®0, g0, g1, . . . ‚ü©.
The most interesting operation on egf's, as on ordinary gf's, is multipli-
cation. If bF(z) and bG(z) are egf's for ‚ü®fn‚ü©and ‚ü®gn‚ü©, then bF(z) bG(z) = bH(z)
is the egf for a sequence ‚ü®hn‚ü©called the binomial convolution of ‚ü®fn‚ü©and
‚ü®gn‚ü©:
hn =
X
k
¬µn
k
¬∂
fk gn‚àík .
(7.75)
Binomial coecients appear here because
¬°n
k
¬¢
= n!/k! (n ‚àík)!, hence
hn
n!
=
n
X
k=0
fk
k!
gn‚àík
(n ‚àík)! ;
in other words, ‚ü®hn/n!‚ü©is the ordinary convolution of ‚ü®fn/n!‚ü©and ‚ü®gn/n!‚ü©.
Binomial convolutions occur frequently in applications. For example, we
dened the Bernoulli numbers in (6.79) by the implicit recurrence
m
X
j=0
¬µm + 1
j
¬∂
Bj = [m = 0] ,
for all m  0;
this can be rewritten as a binomial convolution, if we substitute n for m + 1
and add the term Bn to both sides:
X
k
¬µn
k
¬∂
Bk = Bn + [n = 1] ,
for all n  0.
(7.76)
We can now relate this recurrence to power series (as promised in Chapter 6)
by introducing the egf for Bernoulli numbers, bB(z) = P
n0 Bnzn/n!. The
left-hand side of (7.76) is the binomial convolution of ‚ü®Bn‚ü©with the constant
sequence ‚ü®1, 1, 1, . . . ‚ü©; hence the egf of the left-hand side is bB(z)ez. The egf
of the right-hand side is P
n0
¬°
Bn + [n = 1]
¬¢
zn/n! = bB(z) + z. Therefore we
must have bB(z) = z/(ez ‚àí1); we have proved equation (6.81), which appears
also in Table 352 as equation (7.44).

7.6 EXPONENTIAL GENERATING FUNCTIONS 367
Now let's look again at a sum that has been popping up frequently in
this book,
Sm(n) = 0m + 1m + 2m + ¬∑ ¬∑ ¬∑ + (n ‚àí1)m =
X
0k<n
km .
This time we will try to analyze the problem with generating functions, in
hopes that it will suddenly become simpler. We will consider n to be xed
and m variable; thus our goal is to understand the coecients of the power
series
S(z) = S0(n) + S1(n) z + S2(n) z2 + ¬∑ ¬∑ ¬∑ =
X
m0
Sm(n) zm .
We know that the generating function for ‚ü®1, k, k2, . . . ‚ü©is
1
1 ‚àíkz =
X
m0
km zm ,
hence
S(z) =
X
m0
X
0k<n
km zm =
X
0k<n
1
1 ‚àíkz
by interchanging the order of summation. We can put this sum in closed
form,
S(z) = 1
z
¬µ
1
z‚àí1 ‚àí0 +
1
z‚àí1 ‚àí1 + ¬∑ ¬∑ ¬∑ +
1
z‚àí1 ‚àín + 1
¬∂
= 1
z
¬°
Hz‚àí1 ‚àíHz‚àí1‚àín
¬¢
;
(7.77)
but we know nothing about expanding such a closed form in powers of z.
Exponential generating functions come to the rescue.
The egf of our
sequence ‚ü®S0(n), S1(n), S2(n), . . . ‚ü©is
bS(z, n) = S0(n) + S1(n) z
1! + S2(n) z2
2! + ¬∑ ¬∑ ¬∑ =
X
m0
Sm(n) zm
m! .
To get these coecients Sm(n) we can use the egf for ‚ü®1, k, k2, . . . ‚ü©, namely
ekz =
X
m0
km zm
m! ,
and we have
bS(z, n) =
X
m0
X
0k<n
km zm
m! =
X
0k<n
ekz .

368 GENERATING FUNCTIONS
And the latter sum is a geometric progression, so there's a closed form
bS(z, n) = enz ‚àí1
ez ‚àí1 .
(7.78)
Eureka! All we need to do is gure out the coecients of this relatively simple
function, and we'll know Sm(n), because Sm(n) = m! [zm]bS(z, n).
Here's where Bernoulli numbers come into the picture. We observed a
moment ago that the egf for Bernoulli numbers is
bB(z) =
X
k0
Bk
zk
k! =
z
ez ‚àí1 ;
hence we can write
bS(z, n) = bB(z) enz ‚àí1
z
=
¬≥
B0
z0
0! + B1
z1
1! + B2
z2
2! + ¬∑ ¬∑ ¬∑
¬¥¬≥
n z0
1! + n2 z1
2! + n3 z2
3! + ¬∑ ¬∑ ¬∑
¬¥
.
The sum Sm(n) is m! times the coecient of zm in this product. For example,
S0(n) = 0!
¬≥
B0
n
1! 0!
¬¥
= n ;
S1(n) = 1!
¬≥
B0
n2
2! 0! + B1
n
1! 1!
¬¥
=
1
2n2 ‚àí1
2n ;
S2(n) = 2!
¬≥
B0
n3
3! 0! + B1
n2
2! 1! + B2
n
1! 2!
¬¥
=
1
3n3 ‚àí1
2n2 + 1
6n .
We have therefore derived the formula
n = S2(n) = 1
3n(n ‚àí1
2)(n ‚àí1) for
the umpteenth time, and this was the simplest derivation of all: In a few lines
we have found the general behavior of Sm(n) for all m.
The general formula can be written
Sm‚àí1(n) =
1
m
¬°
Bm(n) ‚àíBm(0)
¬¢
,
(7.79)
where Bm(x) is the Bernoulli polynomial dened by
Bm(x) =
X
k
¬µm
k
¬∂
Bk xm‚àík .
(7.80)
Here's why: The Bernoulli polynomial is the binomial convolution of the
sequence ‚ü®B0, B1, B2, . . . ‚ü©with ‚ü®1, x, x2, . . . ‚ü©; hence the exponential generating

7.6 EXPONENTIAL GENERATING FUNCTIONS 369
function for ‚ü®B0(x), B1(x), B2(x), . . . ‚ü©is the product of their egf's,
bB(z, x) =
X
m0
Bm(x)zm
m! =
z
ez ‚àí1
X
m0
xm zm
m! =
zexz
ez ‚àí1 .
(7.81)
Equation (7.79) follows because the egf for ‚ü®0, S0(n), 2S1(n), . . . ‚ü©is, by (7.78),
z enz ‚àí1
ez ‚àí1
= bB(z, n) ‚àíbB(z, 0) .
Let's turn now to another problem for which egf's are just the thing:
How many spanning trees are possible in the complete graph on n vertices
f1, 2, . . . , ng? Let's call this number tn. The complete graph has 1
2n(n ‚àí1)
edges, one edge joining each pair of distinct vertices; so we're essentially
looking for the total number of ways to connect up n given things by drawing
n ‚àí1 lines between them.
We have t1 = t2 = 1. Also t3 = 3, because a complete graph on three
vertices is a fan of order 2; we know that f2 = 3.
And there are sixteen
spanning trees when n = 4:
r
r
r
r
@@
r
r
r
r
¬°¬°
@@
r
r
r
r
@@
r
r
r
r
r
r
r
r
¬°¬°
r
r
r
r
r
r
r
r
@@
r
r
r
r
¬°¬°
@@
r
r
r
r
@@
r
r
r
r
¬°¬°
r
r
r
r
r
r
r
r
¬°¬°
@@
r
r
r
r
¬°¬°
@@
r
r
r
r
r
r
r
r
¬°¬°
r
r
r
r
¬°¬°
(7.82)
Hence t4 = 16.
Our experience with the analogous problem for fans suggests that the best
way to tackle this problem is to single out one vertex, and to look at the blocks
or components that the spanning tree joins together when we ignore all edges
that touch the special vertex. If the non-special vertices form m components
of sizes k1, k2, . . . , km, then we can connect them to the special vertex in
k1k2 . . . km ways. For example, in the case n = 4, we can consider the lower
left vertex to be special. The top row of (7.82) shows 3t3 cases where the other
three vertices are joined among themselves in t3 ways and then connected to
the lower left in 3 ways. The bottom row shows 2¬∑1√ót2t1√ó
¬°3
2
¬¢
solutions where
the other three vertices are divided into components of sizes 2 and 1 in
¬°3
2
¬¢
ways; there's also the case q
q
q
q
¬° where the other three vertices are completely
unconnected among themselves.
This line of reasoning leads to the recurrence
tn =
X
m>0
1
m!
X
k1+¬∑¬∑¬∑+km=n‚àí1
¬µ
n ‚àí1
k1, k2, . . . , km
¬∂
k1k2 . . . km tk1tk2 . . . tkm

370 GENERATING FUNCTIONS
for all n > 1. Here's why: There are
¬°
n‚àí1
k1,k2,...,km
¬¢
ways to assign n‚àí1 elements
to a sequence of m components of respective sizes k1, k2, . . . , km; there are
tk1tk2 . . . tkm ways to connect up those individual components with spanning
trees; there are k1k2 . . . km ways to connect vertex n to those components; and
we divide by m! because we want to disregard the order of the components.
For example, when n = 4 the recurrence says that
t4 = 3t3 + 1
2
¬°¬° 3
1,2
¬¢
2t1t2 +
¬° 3
2,1
¬¢
2t2t1
¬¢
+ 1
6
¬°¬°
3
1,1,1
¬¢
t3
1
¬¢
= 3t3 + 6t2t1 + t3
1 .
The recurrence for tn looks formidable at rst, possibly even frightening;
but it really isn't bad, only convoluted. We can dene
un = n tn
and then everything simplies considerably:
un
n!
=
X
m>0
1
m!
X
k1+k2+¬∑¬∑¬∑+km=n‚àí1
uk1
k1!
uk2
k2! . . . ukm
km! ,
if n > 1. (7.83)
The inner sum is the coecient of zn‚àí1 in the egf bU(z), raised to the mth
power; and we obtain the correct formula also when n = 1, if we add in the
term bU(z)0 that corresponds to the case m = 0. So
un
n!
= [zn‚àí1]
X
m0
1
m!
bU(z)m = [zn‚àí1] eb
U(z) = [zn] zeb
U(z)
for all n > 0, and we have the equation
bU(z) = z eb
U(z) .
(7.84)
Progress! Equation (7.84) is almost like
E(z) = ez E(z) ,
which denes the generalized exponential series E(z) = E1(z) in (5.59) and
(7.71); indeed, we have
bU(z) = z E(z) .
So we can read o the answer to our problem:
tn = un
n
= n!
n [zn] bU(z) = (n ‚àí1)! [zn‚àí1] E(z) = nn‚àí2 .
(7.85)
The complete graph on f1, 2, . . . , ng has exactly nn‚àí2 spanning trees, for all
n > 0.

7.7 DIRICHLET GENERATING FUNCTIONS 371
7.7
DIRICHLET GENERATING FUNCTIONS
There are many other possible ways to generate a sequence from a
series; any system of \kernel" functions Kn(z) such that
X
n
gn Kn(z) = 0
=‚áí
gn = 0 for all n
can be used, at least in principle. Ordinary generating functions use Kn(z) =
zn, and exponential generating functions use Kn(z) = zn/n!; we could also
try falling factorial powers zn, or binomial coecients zn/n! =
¬°z
n
¬¢
.
The most important alternative to gf's and egf's uses the kernel functions
1/nz; it is intended for sequences ‚ü®g1, g2, . . . ‚ü©that begin with n = 1 instead
of n = 0:
eG(z) =
X
n1
gn
nz .
(7.86)
This is called a Dirichlet generating function (dgf), because the German
mathematician Gustav Lejeune Dirichlet (1805{1859) made much of it.
For example, the dgf of the constant sequence ‚ü®1, 1, 1, . . . ‚ü©is
X
n1
1
nz = Œ∂(z) .
(7.87)
This is Riemann's zeta function, which we have also called the generalized
harmonic number H(z)
‚àûwhen z > 1.
The product of Dirichlet generating functions corresponds to a special
kind of convolution:
eF(z) eG(z) =
X
l,m1
fl
lz
gm
mz =
X
n1
1
nz
X
l,m1
fl gm [l¬∑m = n] .
Thus eF(z) eG(z) = eH(z) is the dgf of the sequence
hn =
X
dnn
fd gn/d .
(7.88)
For example, we know from (4.55) that P
dnn ¬µ(d) = [n = 1]; this is
the Dirichlet convolution of the Mobius sequence ‚ü®¬µ(1), ¬µ(2), ¬µ(3), . . . ‚ü©with
‚ü®1, 1, 1, . . . ‚ü©, hence
f
M(z)Œ∂(z) =
X
n1
[n = 1]
nz
= 1 .
(7.89)
In other words, the dgf of ‚ü®¬µ(1), ¬µ(2), ¬µ(3), . . . ‚ü©is Œ∂(z)‚àí1.

372 GENERATING FUNCTIONS
Dirichlet generating functions are particularly valuable when the se-
quence ‚ü®g1, g2, . . . ‚ü©is a multiplicative function, namely when
gmn = gm gn
for m ‚ä•n.
In such cases the values of gn for all n are determined by the values of gn when
n is a power of a prime, and we can factor the dgf into a product over primes:
eG(z) =
Y
p prime
¬µ
1 + gp
pz + gp2
p2z + gp3
p3z + ¬∑ ¬∑ ¬∑
¬∂
.
(7.90)
If, for instance, we set gn = 1 for all n, we obtain a product representation
of Riemann's zeta function:
Œ∂(z) =
Y
p prime
¬µ
1
1 ‚àíp‚àíz
¬∂
.
(7.91)
The Mobius function has ¬µ(p) = ‚àí1 and ¬µ(pk) = 0 for k > 1, hence its dgf is
f
M(z) =
Y
p prime
(1 ‚àíp‚àíz) ;
(7.92)
this agrees, of course, with (7.89) and (7.91). Euler's œï function has œï(pk) =
pk ‚àípk‚àí1, hence its dgf has the factored form
eŒ¶(z) =
Y
p prime
¬µ
1 + p ‚àí1
pz ‚àíp
¬∂
=
Y
p prime
1 ‚àíp‚àíz
1 ‚àíp1‚àíz .
(7.93)
We conclude that eŒ¶(z) = Œ∂(z ‚àí1)/Œ∂(z).
Exercises
Warmups
1
An eccentric collector of 2 √ó n domino tilings pays $4 for each vertical
domino and $1 for each horizontal domino. How many tilings are worth
exactly $m by this criterion? For example, when m = 6 there are three
solutions:
,
, and
.
2
Give the generating function and the exponential generating function for
the sequence ‚ü®2, 5, 13, 35, . . . ‚ü©= ‚ü®2n + 3n‚ü©in closed form.
3
What is P
n0 Hn/10n?
4
The general expansion theorem for rational functions P(z)/Q(z) is not
completely general, because it restricts the degree of P to be less than
the degree of Q. What happens if P has a larger degree than this?

7 EXERCISES 373
5
Find a generating function S(z) such that
[zn] S(z) =
X
k
¬µr
k
¬∂¬µ
r
n ‚àí2k
¬∂
.
Basics
6
Show that the recurrence (7.32) can be solved by the repertoire method,
without using generating functions.
7
Solve the recurrence
g0 = 1 ;
gn = gn‚àí1 + 2gn‚àí2 + ¬∑ ¬∑ ¬∑ + ng0 ,
for n > 0.
8
What is [zn]
¬°
ln(1 ‚àíz)
¬¢2/(1 ‚àíz)m+1?
9
Use the result of the previous exercise to evaluate Pn
k=0 HkHn‚àík.
10
Set r = s = ‚àí1/2 in identity (7.62) and then remove all occurrences of
1/2 by using tricks like (5.36). What amazing identity do you deduce?
I deduce that Clark
Kent is really
Superman.
11
This problem, whose three parts are independent, gives practice in the
manipulation of generating functions. We assume that A(z) = P
n anzn,
B(z) = P
n bnzn, C(z) = P
n cnzn, and that the coecients are zero for
negative n.
a
If cn = P
j+2kn ajbk, express C in terms of A and B.
b
If nbn = Pn
k=0 2kak/(n ‚àík)!, express A in terms of B.
c
If r is a real number and if an = Pn
k=0
¬°r+k
k
¬¢
bn‚àík, express A in
terms of B; then use your formula to nd coecients fk(r) such that
bn = Pn
k=0 fk(r)an‚àík.
12
How many ways are there to put the numbers f1, 2, . . . , 2ng into a 2 √ó n
array so that rows and columns are in increasing order from left to right
and from top to bottom? For example, one solution when n = 5 is
¬µ
1
2
4
5
8
3
6
7
9
10
¬∂
.
13
Prove Raney's generalized lemma, which is stated just before (7.70).
14
Solve the recurrence
g0 = 0 ,
g1 = 1 ,
gn = ‚àí2ngn‚àí1 +
X
k
¬µn
k
¬∂
gkgn‚àík ,
for n > 1,
by using an exponential generating function.

374 GENERATING FUNCTIONS
15
The Bell number œñn is the number of ways to partition n things into
subsets. For example, œñ3 = 5 because we can partition f1, 2, 3g in the
following ways:
f1, 2, 3g ;
f1, 2g ‚à™f3g ;
f1, 3g ‚à™f2g ;
f1g ‚à™f2, 3g ;
f1g ‚à™f2g ‚à™f3g .
Prove that œñn+1 = P
k
¬°n
k
¬¢
œñn‚àík, and use this recurrence to nd a closed
form for the exponential generating function P(z) = P
n œñnzn/n!.
16
Two sequences ‚ü®an‚ü©and ‚ü®bn‚ü©are related by the convolution formula
bn =
X
k1+2k2+¬∑¬∑¬∑nkn=n
¬µa1+k1‚àí1
k1
¬∂¬µa2+k2‚àí1
k2
¬∂
. . .
¬µan+kn‚àí1
kn
¬∂
;
also a0 = 0 and b0 = 1. Prove that the corresponding generating func-
tions satisfy ln B(z) = A(z) + 1
2A(z2) + 1
3A(z3) + ¬∑ ¬∑ ¬∑ .
17
Show that the exponential generating function bG(z) of a sequence is re-
lated to the ordinary generating function G(z) by the formula
Z ‚àû
0
bG(zt)e‚àít dt = G(z) ,
if the integral exists.
18
Find the Dirichlet generating functions for the sequences
a
gn = ‚àön;
b
gn = ln n;
c
gn = [n is squarefree].
Express your answers in terms of the zeta function. (Squarefreeness is
dened in exercise 4.13.)
19
Every power series F(z) = P
n0 fnzn with f0 = 1 denes a sequence of
polynomials fn(x) by the rule
F(z)x =
X
n0
fn(x)zn ,
where fn(1) = fn and fn(0) = [n = 0]. In general, fn(x) has degree n.
Show that such polynomials always satisfy the convolution formulas
What do you mean,
\in general"? If
f1 = f2 = ¬∑ ¬∑ ¬∑ =
fm‚àí1 = 0, the
degree of fn(x) is
at most ‚åän/m‚åã.
n
X
k=0
fk(x)fn‚àík(y) = fn(x + y) ;
(x + y)
n
X
k=0
kfk(x)fn‚àík(y) = xnfn(x + y) .
(The identities in Tables 202 and 272 are special cases of this trick.)

7 EXERCISES 375
20
A power series G(z) is called dierentiably nite if there exist nitely
many polynomials P0(z), . . . , Pm(z), not all zero, such that
P0(z)G(z) + P1(z)G‚Ä≤(z) + ¬∑ ¬∑ ¬∑ + Pm(z)G(m)(z) = 0 .
A sequence of numbers ‚ü®g0, g1, g2, . . . ‚ü©is called polynomially recursive
if there exist nitely many polynomials p0(z), . . . , pm(z), not all zero,
such that
p0(n)gn + p1(n)gn+1 + ¬∑ ¬∑ ¬∑ + pm(n)gn+m = 0
for all integers n  0. Prove that a generating function is dierentiably
nite if and only if its sequence of coecients is polynomially recursive.
Homework exercises
21
A robber holds up a bank and demands $500 in tens and twenties. He
also demands to know the number of ways in which the cashier can give
him the money. Find a generating function G(z) for which this number
Will he settle for
2 √ó n domino
tilings?
is [z500] G(z), and a more compact generating function G(z) for which
this number is [z50] G(z). Determine the required number of ways by
(a) using partial fractions; (b) using a method like (7.39).
22
Let P be the sum of all ways to \triangulate" polygons:
P =
+ ¬¢¬¢AA + @@ + ¬°¬°
+ B
Q
¬£
bbLL
+ B
Q
¬£
bb
+ B
Q
¬£
LL
+ B
Q
¬£
"" + B
Q
¬£
"" + ¬∑ ¬∑ ¬∑ .
(The rst term represents a degenerate polygon with only two vertices;
every other term shows a polygon that has been divided into triangles.
For example, a pentagon can be triangulated in ve ways.)
Dene a
\multiplication" operation A‚ñ≥B on triangulated polygons A and B so
that the equation
P =
+ P‚ñ≥P
is valid. Then replace each triangle by `z'; what does this tell you about
the number of ways to decompose an n-gon into triangles?
23
In how many ways can a 2 √ó 2 √ó n pillar be built out of 2 √ó 1 √ó 1 bricks?
At union rates, as
many as you can
aord, plus a few.
24
How many spanning trees are in an n-wheel (a graph with n \outer"
vertices in a cycle, each connected to an (n + 1)st \hub" vertex), when
n  3?

376 GENERATING FUNCTIONS
25
Let m  2 be an integer.
What is a closed form for the generating
function of the sequence ‚ü®n mod m‚ü©, as a function of z and m?
Use
this generating function to express `n mod m' in terms of the complex
number œâ = e2œÄi/m. (For example, when m = 2 we have œâ = ‚àí1 and
n mod 2 = 1
2 ‚àí1
2(‚àí1)n.)
26
The second-order Fibonacci numbers ‚ü®Fn‚ü©are dened by the recurrence
F0 = 0 ;
F1 = 1 ;
Fn = Fn‚àí1 + Fn‚àí2 + Fn ,
for n > 1.
Express Fn in terms of the usual Fibonacci numbers Fn and Fn+1.
27
A 2 √ó n domino tiling can also be regarded as a way to draw n disjoint
lines in a 2 √ó n array of points:
q q q q q q q q q q
q q q q q q q q q q
If we superimpose two such patterns, we get a set of cycles, since ev-
ery point is touched by two lines. For example, if the lines above are
combined with the lines
q q q q q q q q q q
q q q q q q q q q q ,
the result is
q q q q q q q q q q
q q q q q q q q q q .
The same set of cycles is also obtained by combining
q q q q q q q q q q
q q q q q q q q q q
with
q q q q q q q q q q
q q q q q q q q q q .
But we get a unique way to reconstruct the original patterns from the
superimposed ones if we assign orientations to the vertical lines by using
arrows that go alternately up/down/up/down/¬∑ ¬∑ ¬∑ in the rst pattern and
alternately down/up/down/up/¬∑ ¬∑ ¬∑ in the second. For example,
q q q q q q q q q q
q q q q q q q q q q
6
?
6? +
q q q q q q q q q q
q q q q q q q q q q
?6
=
q q q q q q q q q q
q q q q q q q q q q
6
?
6?
?6
.
The number of such oriented cycle patterns must therefore be T 2
n = F2
n+1,
and we should be able to prove this via algebra. Let Qn be the number
of oriented 2 √ó n cycle patterns. Find a recurrence for Qn, solve it with
generating functions, and deduce algebraically that Qn = F2
n+1.
28
The coecients of A(z) in (7.39) satisfy Ar+Ar+10+Ar+20+Ar+30 = 100
for 0  r < 10. Find a \simple" explanation for this.

7 EXERCISES 377
29
What is the sum of Fibonacci products
X
m>0
X
k1+k2+¬∑¬∑¬∑+km=n
k1,k2,...,km>0
Fk1Fk2 . . . Fkm ?
30
If the generating function G(z) = 1/(1 ‚àíŒ±z)(1 ‚àíŒ≤z) has the partial
fraction decomposition a/(1‚àíŒ±z)+b/(1‚àíŒ≤z), what is the partial fraction
decomposition of G(z)n?
31
What function g(n) of the positive integer n satises the recurrence
X
dnn
g(d) œï(n/d) = 1 ,
where œï is Euler's totient function?
32
An arithmetic progression is an innite set of integers
fan + bg = fb, a + b, 2a + b, 3a + b, . . . g .
A set of arithmetic progressions fa1n + b1g, . . . , famn + bmg is called an
exact cover if every nonnegative integer occurs in one and only one of the
progressions. For example, the three progressions f2ng, f4n + 1g, f4n + 3g
constitute an exact cover. Show that if fa1n + b1g, . . . , famn + bmg is
an exact cover such that 2  a1  ¬∑ ¬∑ ¬∑  am, then am‚àí1 = am. Hint:
Use generating functions.
Exam problems
33
What is [wmzn]
¬°
ln(1 + z)
¬¢
/(1 ‚àíwz)?
34
Find a closed form for the generating function P
n0 Gn(z)wn, if
Gn(z) =
X
kn/m
¬µn ‚àímk
k
¬∂
zmk .
(Here m is a xed positive integer.)
35
Evaluate the sum P
0<k<n 1/k(n ‚àík) in two ways:
a
Expand the summand in partial fractions.
b
Treat the sum as a convolution and use generating functions.
36
Let A(z) be the generating function for ‚ü®a0, a1, a2, a3, . . . ‚ü©.
Express
P
n a‚åän/m‚åãzn in terms of A, z, and m.

378 GENERATING FUNCTIONS
37
Let an be the number of ways to write the positive integer n as a sum of
powers of 2, disregarding order. For example, a4 = 4, since 4 = 2 + 2 =
2+1+1 = 1+1+1+1. By convention we let a0 = 1. Let bn = Pn
k=0 ak
be the cumulative sum of the rst a's.
a
Make a table of the a's and b's up through n = 10. What amazing
relation do you observe in your table? (Don't prove it yet.)
b
Express the generating function A(z) as an innite product.
c
Use the expression from part (b) to prove the result of part (a).
38
Find a closed form for the double generating function
M(w, z) =
X
m,n0
min(m, n) wmzn .
Generalize your answer to obtain, for xed m  2, a closed form for
M(z1, . . . , zm) =
X
n1,...,nm0
min(n1, . . . , nm) zn1
1 . . . znm
m .
39
Given positive integers m and n, nd closed forms for
X
1k1<k2<¬∑¬∑¬∑<kmn
k1k2 . . . km
and
X
1k1k2¬∑¬∑¬∑kmn
k1k2 . . . km .
(For example, when m = 2 and n = 3 the sums are 1¬∑2 + 1¬∑3 + 2¬∑3 and
1¬∑1+1¬∑2+1¬∑3+2¬∑2+2¬∑3+3¬∑3.) Hint: What are the coecients of zm in the
generating functions (1+a1z) . . . (1+anz) and 1/(1‚àía1z) . . . (1‚àíanz)?
40
Express P
k
¬°n
k
¬¢
(kFk‚àí1 ‚àíFk)(n ‚àík)< in closed form.
41
An up-down permutation of order n is an arrangement a1a2 . . . an of
the integers f1, 2, . . . , ng that goes alternately up and down:
a1 < a2 > a3 < a4 > ¬∑ ¬∑ ¬∑ .
For example, 35142 is an up-down permutation of order 5. If An de-
notes the number of up-down permutations of order n, show that the
exponential generating function of ‚ü®An‚ü©is (1 + sin z)/cos z.
42
A space probe has discovered that organic material on Mars has DNA
composed of ve symbols, denoted by (a, b, c, d, e), instead of the four
components in earthling DNA. The four pairs cd, ce, ed, and ee never
occur consecutively in a string of Martian DNA, but any string with-
out forbidden pairs is possible. (Thus bbcda is forbidden but bbdca is
OK.) How many Martian DNA strings of length n are possible? (When
n = 2 the answer is 21, because the left and right ends of a string are
distinguishable.)

7 EXERCISES 379
43
The Newtonian generating function of a sequence ‚ü®gn‚ü©is dened to be
_G(z) =
X
n
gn
¬µz
n
¬∂
.
Find a convolution formula that denes the relation between sequences
‚ü®fn‚ü©, ‚ü®gn‚ü©, and ‚ü®hn‚ü©whose Newtonian generating functions are related
by the equation _F(z) _G(z) = _H(z). Try to make your formula as simple
and symmetric as possible.
44
Let qn be the number of possible outcomes when n numbers fx1, . . . , xng
are compared with each other. For example, q3 = 13 because the possi-
bilities are
x1 < x2 < x3 ;
x1 < x2 = x3 ;
x1 < x3 < x2 ;
x1 = x2 < x3 ;
x1 = x2 = x3 ;
x1 = x3 < x2 ;
x2 < x1 < x3 ;
x2 < x1 = x3 ;
x2 < x3 < x1 ;
x2 = x3 < x1 ;
x3 < x1 < x2 ;
x3 < x1 = x2 ;
x3 < x2 < x1 .
Find a closed form for the egf bQ(z) = P
n qnzn/n!. Also nd sequences
‚ü®an‚ü©, ‚ü®bn‚ü©, ‚ü®cn‚ü©such that
qn =
X
k0
knak =
X
k
¬Øn
k
¬∞
bk =
X
k
¬øn
k
√Ä
ck ,
for all n > 0.
45
Evaluate P
m,n>0[m ‚ä•n]/m2n2.
46
Evaluate
X
0kn/2
¬µn ‚àí2k
k
¬∂ ¬µ‚àí4
27
¬∂k
in closed form. Hint: z3 ‚àíz2 +
4
27 = (z + 1
3)(z ‚àí2
3)2.
47
Show that the numbers Un and Vn of 3 √ó n domino tilings, as given in
(7.34), are closely related to the fractions in the Stern{Brocot tree that
converge to
‚àö
3.
48
A certain sequence ‚ü®gn‚ü©satises the recurrence
agn + bgn+1 + cgn+2 + d = 0 ,
integer n  0,
for some integers (a, b, c, d) with gcd(a, b, c, d) = 1. It also has the closed
form
gn =
¬•
Œ±(1 +
‚àö
2 )n¬¶
,
integer n  0,
for some real number Œ± between 0 and 1. Find a, b, c, d, and Œ±.

380 GENERATING FUNCTIONS
49
This is a problem about powers and parity.
Kissinger, take note.
a
Consider the sequence ‚ü®a0, a1, a2, . . . ‚ü©= ‚ü®2, 2, 6, . . . ‚ü©dened by the
formula
an = (1 +
‚àö
2)n + (1 ‚àí
‚àö
2)n .
Find a simple recurrence relation that is satised by this sequence.
b
Prove that
¬ß
(1 +
‚àö
2)n¬®
‚â°n (mod 2) for all integers n > 0.
c
Find a number Œ± of the form (p+‚àöq)/2, where p and q are positive
integers, such that ‚åäŒ±n‚åã‚â°n (mod 2) for all integers n > 0.
Bonus problems
50
Continuing exercise 22, consider the sum of all ways to decompose poly-
gons into polygons:
Q =
+ ¬¢¬¢AA +
+ @@ + ¬°¬°
+ B
Q
¬£ + B
Q
¬£
LL + B
Q
¬£
bb + B
Q
¬£ + B
Q
¬£

+ B
Q
¬£
"" + B
Q
¬£
bbLL + ¬∑ ¬∑ ¬∑ .
Find a symbolic equation for Q and use it to nd a generating function
for the number of ways to draw nonintersecting diagonals inside a convex
n-gon. (Give a closed form for the generating function as a function of z;
you need not nd a closed form for the coecients.)
51
Prove that the product
2mn/2
Y
1jm
1kn
¬µ¬≥
cos2
jœÄ
m + 1
¬¥
2 +
¬≥
cos2
kœÄ
n + 1
¬¥
2
¬∂1/4
is the generating function for tilings of an m√ón rectangle with dominoes.
(There are mn factors, which we can imagine are written in the mn cells
of the rectangle. If mn is odd, the middle factor is zero. The coecient
of
j
k is the number of ways to do the tiling with j vertical and k
horizontal dominoes.) Hint: This is a dicult problem, really beyond
Is this a hint or a
warning?
the scope of this book. You may wish to simply verify the formula in the
case m = 3, n = 4.
52
Prove that the polynomials dened by the recurrence
pn(y) =
¬≥
y ‚àí1
4
¬¥n
‚àí
n‚àí1
X
k=0
¬µ2n
2k
¬∂¬µ‚àí1
4
¬∂n‚àík
pk(y) ,
integer n  0,
have the form pn(y) = Pn
m=0
¬Ø¬Øn
m
¬Ø¬Øyn, where
¬Ø¬Øn
m
¬Ø¬Ø is a positive integer for
1  m  n. Hint: This exercise is very instructive but not very easy.

7 EXERCISES 381
53
The sequence of pentagonal numbers ‚ü®1, 5, 12, 22, . . . ‚ü©generalizes the
triangular and square numbers in an obvious way:
ZZZZ

¬£
B
¬£
¬£
B
B
¬£
¬£
¬£
B
B
B
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
s
Let the nth triangular number be Tn = n(n+1)/2; let the nth pentagonal
number be Pn = n(3n ‚àí1)/2; and let Un be the 3 √ó n domino-tiling
number dened in (7.38). Prove that the triangular number T(U4n+2‚àí1)/2
is also a pentagonal number. Hint: 3U2
2n = (V2n‚àí1 + V2n+1)2 + 2.
54
Consider the following curious construction:
1
2
3
4
5
6
7
8
9 10 11
12
13 14 15 16 . . .
1
2
3
4
6
7
8
9
11
12
13 14
16 . . .
1
3
6 10
16 23 31 40
51
63
76 90
106 . . .
1
3
6
16 23 31
51
63
76
106 . . .
1
4 10
26 49 80
131 194 270
376 . . .
1
4
26 49
131 194
376 . . .
1
5
31 80
211 405
781 . . .
1
31
211
781 . . .
1
32
243
1024 . . .
(Start with a row containing all the positive integers. Then delete every
mth column; here m = 5. Then replace the remaining entries by partial
sums. Then delete every (m ‚àí1)st column. Then replace with partial
sums again, and so on.) Use generating functions to show that the nal
result is the sequence of mth powers. For example, when m = 5 we get
‚ü®15, 25, 35, 45, . . . ‚ü©as shown.
55
Prove that if the power series F(z) and G(z) are dierentiably nite (as
dened in exercise 20), then so are F(z) + G(z) and F(z)G(z).
Research problems
56
Prove that there is no \simple closed form" for the coecient of zn in
(1 + z + z2)n, as a function of n, in some large class of \simple closed
forms."
57
Prove or disprove: If all the coecients of G(z) are either 0 or 1, and if
all the coecients of G(z)2 are less than some constant M, then innitely
many of the coecients of G(z)2 are zero.

8
Discrete Probability
THE ELEMENT OF CHANCE enters into many of our attempts to under-
stand the world we live in. A mathematical theory of probability allows us
to calculate the likelihood of complex events if we assume that the events are
governed by appropriate axioms. This theory has signicant applications in
all branches of science, and it has strong connections with the techniques we
have studied in previous chapters.
Probabilities are called \discrete" if we can compute the probabilities of
all events by summation instead of by integration. We are getting pretty good
at sums, so it should come as no great surprise that we are ready to apply
our knowledge to some interesting calculations of probabilities and averages.
8.1
DEFINITIONS
Probability theory starts with the idea of a probability space, which
(Readers unfamiliar
with probability
theory will, with
high probability,
benet from a
perusal of Feller's
classic introduc-
tion to the subject
[120].)
is a set ‚Ñ¶of all things that can happen in a given problem together with a
rule that assigns a probability Pr(œâ) to each elementary event œâ ‚àà‚Ñ¶. The
probability Pr(œâ) must be a nonnegative real number, and the condition
X
œâ‚àà‚Ñ¶
Pr(œâ) = 1
(8.1)
must hold in every discrete probability space. Thus, each value Pr(œâ) must lie
in the interval [0 . . 1]. We speak of Pr as a probability distribution, because
it distributes a total probability of 1 among the events œâ.
Here's an example: If we're rolling a pair of dice, the set ‚Ñ¶of elementary
events is D2 = f q
q ,
q q q , . . . , qqq qqq qqq qqq g, where
D = f q , q q , qqq , q qq q , qqqq q , qqq qqq g
is the set of all six ways that a given die can land. Two rolls such as
q q q
Never say die.
and q q q
are considered to be distinct; hence this probability space has a
total of 62 = 36 elements.
381

382 DISCRETE PROBABILITY
We usually assume that dice are \fair" | that each of the six possibilities
for a particular die has probability 1
6, and that each of the 36 possible rolls
in ‚Ñ¶has probability
1
36. But we can also consider \loaded" dice in which
Careful: They
might go o.
there is a dierent distribution of probabilities. For example, let
Pr1( q ) = Pr1( qqq qqq ) =
1
4 ;
Pr1( q q ) = Pr1( qqq ) = Pr1( q qq q ) = Pr1( qqqq q ) =
1
8 .
Then P
d‚ààD Pr1(d) = 1, so Pr1 is a probability distribution on the set D,
and we can assign probabilities to the elements of ‚Ñ¶= D2 by the rule
Pr11(d d‚Ä≤) = Pr1(d) Pr1(d‚Ä≤) .
(8.2)
For example, Pr11( qqq qqq qqq ) = 1
4 ¬∑ 1
8 =
1
32. This is a valid distribution because
X
œâ‚àà‚Ñ¶
Pr11(œâ) =
X
dd ‚Ä≤‚ààD2
Pr11(d d‚Ä≤) =
X
d,d ‚Ä≤‚ààD
Pr1(d) Pr1(d‚Ä≤)
=
X
d‚ààD
Pr1(d)
X
d ‚Ä≤‚ààD
Pr1(d‚Ä≤) = 1 ¬∑ 1 = 1 .
We can also consider the case of one fair die and one loaded die,
Pr01(d d‚Ä≤) = Pr0(d) Pr1(d‚Ä≤) ,
where Pr0(d) = 1
6,
(8.3)
in which case Pr01( qqq qqq qqq ) =
1
6 ¬∑ 1
8 =
1
48.
Dice in the \real world" can't
really be expected to turn up equally often on each side, because they aren't
If all sides of a cube
were identical, how
could we tell which
side is face up?
perfectly symmetrical; but 1
6 is usually pretty close to the truth.
An event is a subset of ‚Ñ¶. In dice games, for example, the set
f q
q , q q q q , qqq qqq , q qq q q qq q , qqqq q qqqq q , qqq qqq qqq qqq g
is the event that \doubles are thrown." The individual elements œâ of ‚Ñ¶are
called elementary events because they cannot be decomposed into smaller
subsets; we can think of œâ as a one-element event fœâg.
The probability of an event A is dened by the formula
Pr(œâ ‚ààA) =
X
œâ‚ààA
Pr(œâ) ;
(8.4)
and in general if R(œâ) is any statement about œâ, we write `Pr
¬°
R(œâ)
¬¢
' for the
sum of all Pr(œâ) such that R(œâ) is true. Thus, for example, the probability of
doubles with fair dice is
1
36 + 1
36 + 1
36 + 1
36 + 1
36 + 1
36 = 1
6; but when both dice are
loaded with probability distribution Pr1 it is
1
16 + 1
64 + 1
64 + 1
64 + 1
64 + 1
16 =
3
16 >
1
6. Loading the dice makes the event \doubles are thrown" more probable.

8.1 DEFINITIONS 383
(We have been using P-notation in a more general sense here than de-
ned in Chapter 2: The sums in (8.1) and (8.4) occur over all elements œâ
of an arbitrary set, not over integers only. However, this new development is
not really alarming; we can agree to use special notation under a P whenever
nonintegers are intended, so there will be no confusion with our ordinary con-
ventions. The other denitions in Chapter 2 are still valid; in particular, the
denition of innite sums in that chapter gives the appropriate interpretation
to our sums when the set ‚Ñ¶is innite. Each probability is nonnegative, and
the sum of all probabilities is bounded, so the probability of event A in (8.4)
is well dened for all subsets A ‚äÜ‚Ñ¶.)
A random variable is a function dened on the elementary events œâ of a
probability space. For example, if ‚Ñ¶= D2 we can dene S(œâ) to be the sum
of the spots on the dice roll œâ, so that S( qqq qqq qqq ) = 6 + 3 = 9. The probability
that the spots total seven is the probability of the event S(œâ) = 7, namely
Pr( q qqq qqq ) + Pr( q q qqqq q ) + Pr( qqq q qq q )
+ Pr( q qq q qqq ) + Pr( qqqq q q q ) + Pr( qqq qqq q ) .
With fair dice (Pr = Pr00), this happens with probability 1
6; but with loaded
dice (Pr = Pr11), it happens with probability
1
16 + 1
64 + 1
64 + 1
64 + 1
64 + 1
16 =
3
16,
the same as we observed for doubles.
It's customary to drop the `(œâ)' when we talk about random variables,
because there's usually only one probability space involved when we're work-
ing on any particular problem. Thus we say simply `S = 7' for the event that
a 7 was rolled, and `S = 4' for the event f q qqq , q q q q , qqq q g.
A random variable can be characterized by the probability distribution of
its values. Thus, for example, S takes on eleven possible values f2, 3, . . . , 12g,
and we can tabulate the probability that S = s for each s in this set:
s
2
3
4
5
6
7
8
9
10
11
12
Pr00(S = s)
1
36
2
36
3
36
4
36
5
36
6
36
5
36
4
36
3
36
2
36
1
36
Pr11(S = s)
4
64
4
64
5
64
6
64
7
64
12
64
7
64
6
64
5
64
4
64
4
64
If we're working on a problem that involves only the random variable S and no
other properties of dice, we can compute the answer from these probabilities
alone, without regard to the details of the set ‚Ñ¶= D2. In fact, we could
dene the probability space to be the smaller set ‚Ñ¶= f2, 3, . . . , 12g, with
whatever probability distribution Pr(s) is desired. Then `S = 4' would be
an elementary event. Thus we can often ignore the underlying probability
space ‚Ñ¶and work directly with random variables and their distributions.
If two random variables X and Y are dened over the same probabil-
ity space ‚Ñ¶, we can characterize their behavior without knowing everything

384 DISCRETE PROBABILITY
about ‚Ñ¶if we know the \joint distribution"
Just Say No.
Pr(X = x and Y = y)
for each x in the range of X and each y in the range of Y. We say that X and
Y are independent random variables if
Pr(X = x and Y = y) = Pr(X = x) ¬∑ Pr(Y = y)
(8.5)
for all x and y. Intuitively, this means that the value of X has no eect on
the value of Y.
For example, if ‚Ñ¶is the set of dice rolls D2, we can let S1 be the number
of spots on the rst die and S2 the number of spots on the second. Then
the random variables S1 and S2 are independent with respect to each of the
probability distributions Pr00, Pr11, and Pr01 discussed earlier, because we
dened the dice probability for each elementary event dd‚Ä≤ as a product of a
probability for S1 = d multiplied by a probability for S2 = d‚Ä≤. We could have
dened probabilities dierently so that, say,
A dicey inequality.
Pr( q qqqq q )
¬±
Pr( q qqq qqq ) Ã∏= Pr( q q qqqq q )
¬±
Pr( q q qqq qqq ) ;
but we didn't do that, because dierent dice aren't supposed to inuence each
other. With our denitions, both of these ratios are Pr(S2 = 5)/ Pr(S2 = 6).
We have dened S to be the sum of the two spot values, S1 + S2. Let's
consider another random variable P, the product S1S2. Are S and P indepen-
dent? Informally, no; if we are told that S = 2, we know that P must be 1.
Formally, no again, because the independence condition (8.5) fails spectacu-
larly (at least in the case of fair dice): For all legal values of s and p, we have
0 < Pr00(S = s) ¬∑ Pr00(P = p)  1
6 ¬∑ 1
9; this can't equal Pr00(S = s and P = p),
which is a multiple of
1
36.
If we want to understand the typical behavior of a given random vari-
able, we often ask about its \average" value. But the notion of \average"
is ambiguous; people generally speak about three dierent kinds of averages
when a sequence of numbers is given:
‚Ä¢
the mean (which is the sum of all values, divided by the number of
values);
‚Ä¢
the median (which is the middle value, numerically);
‚Ä¢
the mode (which is the value that occurs most often).
For example, the mean of (3, 1, 4, 1, 5) is 3+1+4+1+5
5
= 2.8; the median is 3;
the mode is 1.
But probability theorists usually work with random variables instead of
with sequences of numbers, so we want to dene the notion of an \average" for
random variables too. Suppose we repeat an experiment over and over again,

8.1 DEFINITIONS 385
making independent trials in such a way that each value of X occurs with
a frequency approximately proportional to its probability. (For example, we
might roll a pair of dice many times, observing the values of S and/or P.) We'd
like to dene the average value of a random variable so that such experiments
will usually produce a sequence of numbers whose mean, median, or mode is
approximately the same as the mean, median, or mode of X, according to our
denitions.
Here's how it can be done: The mean of a random real-valued variable X
on a probability space ‚Ñ¶is dened to be
X
x‚ààX(‚Ñ¶)
x¬∑Pr(X = x)
(8.6)
if this potentially innite sum exists. (Here X(‚Ñ¶) stands for the set of all
values that X can assume.) The median of X is dened to be the set of all x
such that
Pr(X  x)  1
2
and
Pr(X  x)  1
2 .
(8.7)
And the mode of X is dened to be the set of all x such that
Pr(X = x)  Pr(X = x‚Ä≤)
for all x‚Ä≤ ‚ààX(‚Ñ¶).
(8.8)
In our dice-throwing example, the mean of S turns out to be 2 ¬∑ 1
36 + 3 ¬∑
2
36 + ¬∑ ¬∑ ¬∑ + 12 ¬∑ 1
36 = 7 in distribution Pr00, and it also turns out to be 7 in
distribution Pr11. The median and mode both turn out to be f7g as well,
in both distributions. So S has the same average under all three denitions.
On the other hand the P in distribution Pr00 turns out to have a mean value
of 49
4 = 12.25; its median is f10g, and its mode is f6, 12g. The mean of P is
unchanged if we load the dice with distribution Pr11, but the median drops
to f8g and the mode becomes f6g alone.
Probability theorists have a special name and notation for the mean of a
random variable: They call it the expected value, and write
EX =
X
œâ‚àà‚Ñ¶
X(œâ) Pr(œâ) .
(8.9)
In our dice-throwing example, this sum has 36 terms (one for each element
of ‚Ñ¶), while (8.6) is a sum of only eleven terms. But both sums have the
same value, because they're both equal to
X
œâ‚àà‚Ñ¶
x‚ààX(‚Ñ¶)
x Pr(œâ)
¬£
x = X(œâ)
¬§
.

386 DISCRETE PROBABILITY
The mean of a random variable turns out to be more meaningful in
I get it:
On average, \aver-
age" means \mean."
applications than the other kinds of averages, so we shall largely forget about
medians and modes from now on. We will use the terms \expected value,"
\mean," and \average" almost interchangeably in the rest of this chapter.
If X and Y are any two random variables dened on the same probability
space, then X + Y is also a random variable on that space. By formula (8.9),
the average of their sum is the sum of their averages:
E(X + Y) =
X
œâ‚àà‚Ñ¶
¬°
X(œâ) + Y(œâ)
¬¢
Pr(œâ) = EX + EY .
(8.10)
Similarly, if Œ± is any constant we have the simple rule
E(Œ±X) = Œ±EX .
(8.11)
But the corresponding rule for multiplication of random variables is more
complicated in general; the expected value is dened as a sum over elementary
events, and sums of products don't often have a simple form. In spite of this
diculty, there is a very nice formula for the mean of a product in the special
case that the random variables are independent:
E(XY) = (EX)(EY),
if X and Y are independent.
(8.12)
We can prove this by the distributive law for products,
E(XY) =
X
œâ‚àà‚Ñ¶
X(œâ)Y(œâ)¬∑Pr(œâ)
=
X
x‚ààX(‚Ñ¶)
y‚ààY(‚Ñ¶)
xy¬∑Pr(X = x and Y = y)
=
X
x‚ààX(‚Ñ¶)
y‚ààY(‚Ñ¶)
xy¬∑Pr(X = x) Pr(Y = y)
=
X
x‚ààX(‚Ñ¶)
x Pr(X = x) ¬∑
X
y‚ààY(‚Ñ¶)
y Pr(Y = y) = (EX)(EY) .
For example, we know that S = S1+S2 and P = S1S2, when S1 and S2 are
the numbers of spots on the rst and second of a pair of random dice. We have
ES1 = ES2 = 7
2, hence ES = 7; furthermore S1 and S2 are independent, so
EP = 7
2 ¬∑ 7
2 = 49
4 , as claimed earlier. We also have E(S+P) = ES+EP = 7+ 49
4 .
But S and P are not independent, so we cannot assert that E(SP) = 7¬∑ 49
4 =
343
4 . In fact, the expected value of SP turns out to equal 637
6
in distribution
Pr00, while it equals 112 (exactly) in distribution Pr11.

8.2 MEAN AND VARIANCE 387
8.2
MEAN AND VARIANCE
The next most important property of a random variable, after we
know its expected value, is its variance, dened as the mean square deviation
from the mean:
VX = E
¬°
(X ‚àíEX)2¬¢
.
(8.13)
If we denote EX by ¬µ, the variance VX is the expected value of (X‚àí¬µ)2. This
measures the \spread" of X's distribution.
As a simple example of variance computation, let's suppose we have just
been made an oer we can't refuse: Someone has given us two gift certicates
for a certain lottery. The lottery organizers sell 100 tickets for each weekly
drawing. One of these tickets is selected by a uniformly random process |
that is, each ticket is equally likely to be chosen | and the lucky ticket holder
wins a hundred million dollars. The other 99 ticket holders win nothing.
We can use our gift in two ways: Either we buy two tickets in the same
(Slightly subtle
point:
There are two
probability spaces,
depending on what
strategy we use; but
EX1 and EX2 are
the same in both.)
lottery, or we buy one ticket in each of two lotteries.
Which is a better
strategy? Let's try to analyze this by letting X1 and X2 be random variables
that represent the amount we win on our rst and second ticket. The expected
value of X1, in millions, is
EX1 =
99
100 ¬∑ 0 +
1
100 ¬∑ 100 = 1 ,
and the same holds for X2. Expected values are additive, so our average total
winnings will be
E(X1 + X2) = EX1 + EX2 = 2 million dollars,
regardless of which strategy we adopt.
Still, the two strategies seem dierent. Let's look beyond expected values
and study the exact probability distribution of X1 + X2:
winnings (millions)
0
100
200
same drawing
.9800
.0200
dierent drawings
.9801
.0198
.0001
If we buy two tickets in the same lottery we have a 98% chance of winning
nothing and a 2% chance of winning $100 million. If we buy them in dierent
lotteries we have a 98.01% chance of winning nothing, so this is slightly more
likely than before; and we have a 0.01% chance of winning $200 million, also
slightly more likely than before; and our chances of winning $100 million are
now 1.98%. So the distribution of X1 + X2 in this second situation is slightly

388 DISCRETE PROBABILITY
more spread out; the middle value, $100 million, is slightly less likely, but the
extreme values are slightly more likely.
It's this notion of the spread of a random variable that the variance is
intended to capture. We measure the spread in terms of the squared deviation
of the random variable from its mean. In case 1, the variance is therefore
.98(0M ‚àí2M)2 + .02(100M ‚àí2M)2 = 196M2 ;
in case 2 it is
.9801(0M ‚àí2M)2 + .0198(100M ‚àí2M)2 + .0001(200M ‚àí2M)2
= 198M2 .
As we expected, the latter variance is slightly larger, because the distribution
of case 2 is slightly more spread out.
When we work with variances, everything is squared, so the numbers can
get pretty big. (The factor M2 is one trillion, which is somewhat imposing
Interesting: The
variance of a dollar
amount is expressed
in units of square
dollars.
even for high-stakes gamblers.) To convert the numbers back to the more
meaningful original scale, we often take the square root of the variance. The
resulting number is called the standard deviation, and it is usually denoted
by the Greek letter œÉ:
œÉ =
‚àö
VX .
(8.14)
The standard deviations of the random variables X1 + X2 in our two lottery
strategies are
‚àö
196M2 = 14.00M and
‚àö
198M2 ‚âà14.071247M. In some sense
the second alternative is about $71,247 riskier.
How does the variance help us choose a strategy? It's not clear. The
strategy with higher variance is a little riskier; but do we get the most for our
money by taking more risks or by playing it safe? Suppose we had the chance
Another way to
reduce risk might
be to bribe the
lottery ocials.
I guess that's where
probability becomes
indiscreet.
(N.B.: Opinions
expressed in these
margins do not
necessarily represent
the opinions of the
management.)
to buy 100 tickets instead of only two. Then we could have a guaranteed
victory in a single lottery (and the variance would be zero); or we could
gamble on a hundred dierent lotteries, with a .99100 ‚âà.366 chance of winning
nothing but also with a nonzero probability of winning up to $10,000,000,000.
To decide between these alternatives is beyond the scope of this book; all we
can do here is explain how to do the calculations.
In fact, there is a simpler way to calculate the variance, instead of using
the denition (8.13). (We suspect that there must be something going on
in the mathematics behind the scenes, because the variances in the lottery
example magically came out to be integer multiples of M2.) We have
E
¬°
(X ‚àíEX)2¬¢
= E
¬°
X2 ‚àí2X(EX) + (EX)2¬¢
= E(X2) ‚àí2(EX)(EX) + (EX)2 ,

8.2 MEAN AND VARIANCE 389
since (EX) is a constant; hence
VX = E(X2) ‚àí(EX)2 .
(8.15)
\The variance is the mean of the square minus the square of the mean."
For example, the mean of (X1 +X2)2 comes to .98(0M)2 +.02(100M)2 =
200M2 or to .9801(0M)2 + .0198(100M)2 + .0001(200M)2 = 202M2 in the
lottery problem. Subtracting 4M2 (the square of the mean) gives the results
we obtained the hard way.
There's an even easier formula yet, if we want to calculate V(X+Y) when
X and Y are independent: We have
E
¬°
(X + Y)2¬¢
= E(X2 + 2XY + Y2)
= E(X2) + 2(EX)(EY) + E(Y2) ,
since we know that E(XY) = (EX)(EY) in the independent case. Therefore
V(X + Y) = E
¬°
(X + Y)2¬¢
‚àí(EX + EY)2
= E(X2) + 2(EX)(EY) + E(Y2)
‚àí(EX)2 ‚àí2(EX)(EY) ‚àí(EY)2
= E(X2) ‚àí(EX)2 + E(Y2) ‚àí(EY)2
= VX + VY .
(8.16)
\The variance of a sum of independent random variables is the sum of their
variances." For example, the variance of the amount we can win with a single
lottery ticket is
E(X2
1) ‚àí(EX1)2 = .99(0M)2 + .01(100M)2 ‚àí(1M)2 = 99M2 .
Therefore the variance of the total winnings of two lottery tickets in two
separate (independent) lotteries is 2√ó99M2 = 198M2. And the corresponding
variance for n independent lottery tickets is n √ó 99M2.
The variance of the dice-roll sum S drops out of this same formula, since
S = S1 + S2 is the sum of two independent random variables. We have
VS1 = 1
6(12 + 22 + 32 + 42 + 52 + 62) ‚àí
¬µ7
2
¬∂2
= 35
12
when the dice are fair; hence VS = 35
12 + 35
12 = 35
6 . The loaded die has
VS1 = 1
8(2¬∑12 + 22 + 32 + 42 + 52 + 2¬∑62) ‚àí
¬µ7
2
¬∂2
= 45
12 ;

390 DISCRETE PROBABILITY
hence VS = 45
6 = 7.5 when both dice are loaded. Notice that the loaded dice
give S a larger variance, although S actually assumes its average value 7 more
often than it would with fair dice. If our goal is to shoot lots of lucky 7's, the
variance is not our best indicator of success.
OK, we have learned how to compute variances. But we haven't really
seen a good reason why the variance is a natural thing to compute. Everybody
does it, but why? The main reason is Chebyshev's inequality ([29] and [57]),
If he proved it in
1867, it's a classic
'67 Chebyshev.
which states that the variance has a signicant property:
Pr
¬°
(X ‚àíEX)2  Œ±
¬¢
 VX/Œ± ,
for all Œ± > 0.
(8.17)
(This is dierent from the monotonic inequalities of Chebyshev that we en-
countered in Chapter 2.) Very roughly, (8.17) tells us that a random variable X
will rarely be far from its mean EX if its variance VX is small. The proof is
amazingly simple. We have
VX =
X
œâ‚àà‚Ñ¶
¬°
X(œâ) ‚àíEX
¬¢2 Pr(œâ)

X
œâ‚àà‚Ñ¶
(X(œâ)‚àíEX)2Œ±
¬°
X(œâ) ‚àíEX
¬¢2 Pr(œâ)

X
œâ‚àà‚Ñ¶
(X(œâ)‚àíEX)2Œ±
Œ± Pr(œâ)
=
Œ±¬∑Pr
¬°
(X ‚àíEX)2  Œ±
¬¢
;
dividing by Œ± nishes the proof.
If we write ¬µ for the mean and œÉ for the standard deviation, and if we
replace Œ± by c2VX in (8.17), the condition (X ‚àíEX)2  c2VX is the same as
(X ‚àí¬µ)2  (cœÉ)2; hence (8.17) says that
Pr
¬°
jX ‚àí¬µj  cœÉ
¬¢
 1/c2 .
(8.18)
Thus, X will lie within c standard deviations of its mean value except with
probability at most 1/c2. A random variable will lie within 2œÉ of ¬µ at least
75% of the time; it will lie between ¬µ ‚àí10œÉ and ¬µ + 10œÉ at least 99% of the
time. These are the cases Œ± = 4VX and Œ± = 100VX of Chebyshev's inequality.
If we roll a pair of fair dice n times, the total value of the n rolls will
almost always be near 7n, for large n. Here's why: The variance of n in-
dependent rolls is
35
6 n. A variance of
35
6 n means a standard deviation of
only
q
35
6 n .

8.2 MEAN AND VARIANCE 391
So Chebyshev's inequality tells us that the nal sum will lie between
7n ‚àí10
q
35
6 n
and
7n + 10
q
35
6 n
in at least 99% of all experiments when n fair dice are rolled. For example,
the odds are better than 99 to 1 that the total value of a million rolls will be
between 6.976 million and 7.024 million.
In general, let X be any random variable over a probability space ‚Ñ¶, hav-
ing nite mean ¬µ and nite standard deviation œÉ. Then we can consider the
probability space ‚Ñ¶n whose elementary events are n-tuples (œâ1, œâ2, . . . , œân)
with each œâk ‚àà‚Ñ¶, and whose probabilities are
Pr(œâ1, œâ2, . . . , œân) = Pr(œâ1) Pr(œâ2) . . . Pr(œân) .
If we now dene random variables Xk by the formula
Xk(œâ1, œâ2, . . . , œân) = X(œâk) ,
the quantity
X1 + X2 + ¬∑ ¬∑ ¬∑ + Xn
is a sum of n independent random variables, which corresponds to taking n
independent \samples" of X on ‚Ñ¶and adding them together. The mean of
X1 + X2 + ¬∑ ¬∑ ¬∑ + Xn is n¬µ, and the standard deviation is ‚àön œÉ; hence the
average of the n samples,
1
n(X1 + X2 + ¬∑ ¬∑ ¬∑ + Xn) ,
will lie between ¬µ ‚àí10œÉ/‚àön and ¬µ + 10œÉ/‚àön at least 99% of the time. In
(That is, the aver-
age will fall between
the stated limits in
at least 99% of all
cases when we look
at a set of n inde-
pendent samples,
for any xed value
of n. Don't mis-
understand this as
a statement about
the averages of an
innite sequence
X1 , X2 , X3 , . . .
as n varies.)
other words, if we choose a large enough value of n, the average of n inde-
pendent samples will almost always be very near the expected value EX. (An
even stronger theorem called the Strong Law of Large Numbers is proved in
textbooks of probability theory; but the simple consequence of Chebyshev's
inequality that we have just derived is enough for our purposes.)
Sometimes we don't know the characteristics of a probability space, and
we want to estimate the mean of a random variable X by sampling its value
repeatedly. (For example, we might want to know the average temperature
at noon on a January day in San Francisco; or we may wish to know the
mean life expectancy of insurance agents.) If we have obtained independent
empirical observations X1, X2, . . . , Xn, we can guess that the true mean is
approximately
bEX = X1 + X2 + ¬∑ ¬∑ ¬∑ + Xn
n
.
(8.19)

392 DISCRETE PROBABILITY
And we can also make an estimate of the variance, using the formula
bVX = X2
1 + X2
2 + ¬∑ ¬∑ ¬∑ + X2
n
n ‚àí1
‚àí(X1 + X2 + ¬∑ ¬∑ ¬∑ + Xn)2
n(n ‚àí1)
.
(8.20)
The (n‚àí1)'s in this formula look like typographic errors; it seems they should
be n's, as in (8.19), because the true variance VX is dened by expected values
in (8.15). Yet we get a better estimate with n ‚àí1 instead of n here, because
denition (8.20) implies that
E(bVX) = VX .
(8.21)
Here's why:
E(bVX) =
1
n ‚àí1E
¬≥
n
X
k=1
X2
k ‚àí1
n
n
X
j=1
n
X
k=1
XjXk
¬¥
=
1
n ‚àí1
¬≥
n
X
k=1
E(X2
k) ‚àí1
n
n
X
j=1
n
X
k=1
E(XjXk)
¬¥
=
1
n ‚àí1
¬≥
n
X
k=1
E(X2) ‚àí1
n
n
X
j=1
n
X
k=1
¬°
E(X)2[j Ã∏= k] + E(X2)[j = k]
¬¢¬¥
=
1
n ‚àí1
¬≥
nE(X2) ‚àí1
n
¬°
nE(X2) + n(n ‚àí1)E(X)2¬¢¬¥
= E(X2) ‚àíE(X)2 = VX .
(This derivation uses the independence of the observations when it replaces
E(XjXk) by (EX)2[j Ã∏= k] + E(X2)[j = k].)
In practice, experimental results about a random variable X are usually
obtained by calculating a sample mean ^¬µ = bEX and a sample standard de-
viation ^œÉ =
p
bVX, and presenting the answer in the form ` ^¬µ ¬± ^œÉ/‚àön '. For
example, here are ten rolls of two supposedly fair dice:
q qq q qqq
qqqq q qqq
qqq q
qqq qqq q qq q
q q qqq qqq
qqqq q qqq qqq
q qq q q
qqqq q q
q q qqq qqq
q qq q qqq
The sample mean of the spot sum S is
^¬µ = (7 + 11 + 8 + 5 + 4 + 6 + 10 + 8 + 8 + 7)/10 = 7.4 ;
the sample variance is
(72 + 112 + 82 + 52 + 42 + 62 + 102 + 82 + 82 + 72 ‚àí10^¬µ2)/9 ‚âà2.12 .

8.2 MEAN AND VARIANCE 393
We estimate the average spot sum of these dice to be 7.4¬±2.1/
‚àö
10 = 7.4¬±0.7,
on the basis of these experiments.
Let's work one more example of means and variances, in order to show
how they can be calculated theoretically instead of empirically. One of the
questions we considered in Chapter 5 was the \football victory problem,"
where n hats are thrown into the air and the result is a random permutation
of hats. We showed in equation (5.51) that there's a probability of n</n! ‚âà1/e
that nobody gets the right hat back. We also derived the formula
P(n, k) =
1
n!
¬µn
k
¬∂
(n ‚àík)< =
1
k!
(n ‚àík)<
(n ‚àík)!
(8.22)
for the probability that exactly k people end up with their own hats.
Restating these results in the formalism just learned, we can consider the
probability space Œ†n of all n! permutations œÄ of f1, 2, . . . , ng, where Pr(œÄ) =
1/n! for all œÄ ‚ààŒ†n. The random variable
Fn(œÄ) = number of \xed points" of œÄ ,
for œÄ ‚ààŒ†n,
measures the number of correct hat-falls in the football victory problem.
Not to be confused
with a Fibonacci
number.
Equation (8.22) gives Pr(Fn = k), but let's pretend that we don't know any
such formula; we merely want to study the average value of Fn, and its stan-
dard deviation.
The average value is, in fact, extremely easy to calculate, avoiding all the
complexities of Chapter 5. We simply observe that
Fn(œÄ) = Fn,1(œÄ) + Fn,2(œÄ) + ¬∑ ¬∑ ¬∑ + Fn,n(œÄ) ,
Fn,k(œÄ) = [position k of œÄ is a xed point] ,
for œÄ ‚ààŒ†n.
Hence
EFn = EFn,1 + EFn,2 + ¬∑ ¬∑ ¬∑ + EFn,n .
And the expected value of Fn,k is simply the probability that Fn,k = 1, which
is 1/n because exactly (n ‚àí1)! of the n! permutations œÄ = œÄ1œÄ2 . . . œÄn ‚ààŒ†n
have œÄk = k. Therefore
EFn = n/n = 1 ,
for n > 0.
(8.23)
On the average, one hat will be in its correct place. \A random permutation
One the average.
has one xed point, on the average."
Now what's the standard deviation? This question is more dicult, be-
cause the Fn,k's are not independent of each other. But we can calculate the

394 DISCRETE PROBABILITY
variance by analyzing the mutual dependencies among them:
E(F2
n) = E
¬µ¬≥
n
X
k=1
Fn,k
¬¥2 ¬∂
= E
¬≥
n
X
j=1
n
X
k=1
Fn,j Fn,k
¬¥
=
n
X
j=1
n
X
k=1
E(Fn,j Fn,k) =
X
1kn
E(F2
n,k)+2
X
1j<kn
E(Fn,j Fn,k) .
(We used a similar trick when we derived (2.33) in Chapter 2.) Now F2
n,k =
Fn,k, since Fn,k is either 0 or 1; hence E(F2
n,k) = EFn,k = 1/n as before. And
if j < k we have E(Fn,j Fn,k) = Pr(œÄ has both j and k as xed points) =
(n ‚àí2)!/n! = 1/n(n ‚àí1). Therefore
E(F2
n) = n
n +
¬µn
2
¬∂
2
n(n ‚àí1) = 2 ,
for n  2.
(8.24)
(As a check when n = 3, we have 2
602 + 3
612 + 0
622 + 1
632 = 2.) The variance
is E(F2
n) ‚àí(EFn)2 = 1, so the standard deviation (like the mean) is 1. \A
random permutation of n  2 elements has 1 ¬± 1 xed points."
8.3 PROBABILITY GENERATING FUNCTIONS
If X is a random variable that takes only nonnegative integer values,
we can capture its probability distribution nicely by using the techniques of
Chapter 7. The probability generating function or pgf of X is
GX(z) =
X
k0
Pr(X = k) zk .
(8.25)
This power series in z contains all the information about the random vari-
able X. We can also express it in two other ways:
GX(z) =
X
œâ‚àà‚Ñ¶
Pr(œâ) zX(œâ) = E(zX) .
(8.26)
The coecients of GX(z) are nonnegative, and they sum to 1; the latter
condition can be written
GX(1) = 1 .
(8.27)
Conversely, any power series G(z) with nonnegative coecients and with
G(1) = 1 is the pgf of some random variable.

8.3 PROBABILITY GENERATING FUNCTIONS 395
The nicest thing about pgf's is that they usually simplify the computation
of means and variances. For example, the mean is easily expressed:
EX =
X
k0
k¬∑Pr(X = k)
=
X
k0
Pr(X = k)¬∑kzk‚àí1¬Ø¬Ø
z=1
= G‚Ä≤
X(1) .
(8.28)
We simply dierentiate the pgf with respect to z and set z = 1.
The variance is only slightly more complicated:
E(X2) =
X
k0
k2 ¬∑Pr(X = k)
=
X
k0
Pr(X = k)¬∑
¬°
k(k ‚àí1)zk‚àí2 + kzk‚àí1¬¢ ¬Ø¬Ø
z=1 = G‚Ä≤‚Ä≤
X(1) + G‚Ä≤
X(1) .
Therefore
VX = G‚Ä≤‚Ä≤
X(1) + G‚Ä≤
X(1) ‚àíG‚Ä≤
X(1)2 .
(8.29)
Equations (8.28) and (8.29) tell us that we can compute the mean and variance
if we can compute the values of two derivatives, G‚Ä≤
X(1) and G‚Ä≤‚Ä≤
X(1). We don't
have to know a closed form for the probabilities; we don't even have to know
a closed form for GX(z) itself.
It is convenient to write
Mean(G) = G‚Ä≤(1) ,
(8.30)
Var(G) = G‚Ä≤‚Ä≤(1) + G‚Ä≤(1) ‚àíG‚Ä≤(1)2 ,
(8.31)
when G is any function, since we frequently want to compute these combina-
tions of derivatives.
The second-nicest thing about pgf's is that they are comparatively sim-
ple functions of z, in many important cases. For example, let's look at the
uniform distribution of order n, in which the random variable takes on each
of the values f0, 1, . . . , n ‚àí1g with probability 1/n. The pgf in this case is
Un(z) = 1
n(1 + z + ¬∑ ¬∑ ¬∑ + zn‚àí1) = 1
n
1 ‚àízn
1 ‚àíz ,
for n  1.
(8.32)
We have a closed form for Un(z) because this is a geometric series.
But this closed form proves to be somewhat embarrassing: When we plug
in z = 1 (the value of z that's most critical for the pgf), we get the undened
ratio 0/0, even though Un(z) is a polynomial that is perfectly well dened
at any value of z. The value Un(1) = 1 is obvious from the non-closed form

396 DISCRETE PROBABILITY
(1 + z + ¬∑ ¬∑ ¬∑ + zn‚àí1)/n, yet it seems that we must resort to L'Hospital's rule
to nd limz‚Üí1 Un(z) if we want to determine Un(1) from the closed form.
The determination of U‚Ä≤
n(1) by L'Hospital's rule will be even harder, because
there will be a factor of (z‚àí1)2 in the denominator; U‚Ä≤‚Ä≤
n(1) will be harder still.
Luckily there's a nice way out of this dilemma. If G(z) = P
n0 gnzn is
any power series that converges for at least one value of z with jzj > 1, the
power series G‚Ä≤(z) = P
n0 ngnzn‚àí1 will also have this property, and so will
G‚Ä≤‚Ä≤(z), G‚Ä≤‚Ä≤‚Ä≤(z), etc. Therefore by Taylor's theorem we can write
G(1 + t) = G(1) + G‚Ä≤(1)
1!
t + G‚Ä≤‚Ä≤(1)
2!
t2 + G‚Ä≤‚Ä≤‚Ä≤(1)
3!
t3 + ¬∑ ¬∑ ¬∑ ;
(8.33)
all derivatives of G(z) at z = 1 will appear as coecients, when G(1 + t) is
expanded in powers of t.
For example, the derivatives of the uniform pgf Un(z) are easily found
in this way:
Un(1 + t) = 1
n
(1 + t)n ‚àí1
t
= 1
n
¬µn
1
¬∂
+ 1
n
¬µn
2
¬∂
t + 1
n
¬µn
3
¬∂
t2 + ¬∑ ¬∑ ¬∑ + 1
n
¬µn
n
¬∂
tn‚àí1 .
Comparing this to (8.33) gives
Un(1) = 1 ;
U‚Ä≤
n(1) = n ‚àí1
2
;
U‚Ä≤‚Ä≤
n(1) = (n ‚àí1)(n ‚àí2)
3
;
(8.34)
and in general U(m)
n
(1) = (n ‚àí1)m/(m + 1), although we need only the cases
m = 1 and m = 2 to compute the mean and the variance. The mean of the
uniform distribution is
U‚Ä≤
n(1) = n ‚àí1
2
,
(8.35)
and the variance is
U‚Ä≤‚Ä≤
n(1) + U‚Ä≤
n(1) ‚àíU‚Ä≤
n(1)2 = 4 (n ‚àí1)(n ‚àí2)
12
+ 6 (n ‚àí1)
12
‚àí3 (n ‚àí1)2
12
= n2 ‚àí1
12
.
(8.36)
The third-nicest thing about pgf's is that the product of pgf's corresponds
to the sum of independent random variables. We learned in Chapters 5 and 7
that the product of generating functions corresponds to the convolution of
sequences; but it's even more important in applications to know that the
convolution of probabilities corresponds to the sum of independent random

8.3 PROBABILITY GENERATING FUNCTIONS 397
variables. Indeed, if X and Y are random variables that take on nothing but
integer values, the probability that X + Y = n is
Pr(X + Y = n) =
X
k
Pr(X = k and Y = n ‚àík) .
If X and Y are independent, we now have
Pr(X + Y = n) =
X
k
Pr(X = k) Pr(Y = n ‚àík) ,
a convolution. Therefore | and this is the punch line |
GX+Y(z) = GX(z) GY(z) ,
if X and Y are independent.
(8.37)
Earlier this chapter we observed that V(X + Y) = VX + VY when X and Y are
independent. Let F(z) and G(z) be the pgf's for X and Y, and let H(z) be the
pgf for X + Y. Then
H(z) = F(z)G(z) ,
and our formulas (8.28) through (8.31) for mean and variance tell us that we
must have
Mean(H) = Mean(F) + Mean(G) ;
(8.38)
Var(H) = Var(F) + Var(G) .
(8.39)
These formulas, which are properties of the derivatives Mean(H) = H‚Ä≤(1) and
Var(H) = H‚Ä≤‚Ä≤(1)+H‚Ä≤(1)‚àíH‚Ä≤(1)2, aren't valid for arbitrary function products
H(z) = F(z)G(z); we have
H‚Ä≤(z) = F‚Ä≤(z)G(z) + F(z)G‚Ä≤(z) ,
H‚Ä≤‚Ä≤(z) = F‚Ä≤‚Ä≤(z)G(z) + 2F‚Ä≤(z)G‚Ä≤(z) + F(z)G‚Ä≤‚Ä≤(z) .
But if we set z = 1, we can see that (8.38) and (8.39) will be valid in general
provided only that
F(1) = G(1) = 1
(8.40)
and that the derivatives exist. The \probabilities" don't have to be in [0 . . 1]
for these formulas to hold. We can normalize the functions F(z) and G(z)
by dividing through by F(1) and G(1) in order to make this condition valid,
whenever F(1) and G(1) are nonzero.
Mean and variance aren't the whole story. They are merely two of an
innite series of so-called cumulant statistics introduced by the Danish as-
I'll graduate magna
cum ulant.
tronomer Thorvald Nicolai Thiele [351] in 1903.
The rst two cumulants

398 DISCRETE PROBABILITY
Œ∫1 and Œ∫2 of a random variable are what we have called the mean and the
variance; there also are higher-order cumulants that express more subtle prop-
erties of a distribution. The general formula
ln G(et) = Œ∫1
1! t + Œ∫2
2! t2 + Œ∫3
3! t3 + Œ∫4
4! t4 + ¬∑ ¬∑ ¬∑
(8.41)
denes the cumulants of all orders, when G(z) is the pgf of a random variable.
Let's look at cumulants more closely. If G(z) is the pgf for X, we have
G(et) =
X
k0
Pr(X = k)ekt =
X
k,m0
Pr(X = k)kmtm
m!
= 1 + ¬µ1
1! t + ¬µ2
2! t2 + ¬µ3
3! t3 + ¬∑ ¬∑ ¬∑ ,
(8.42)
where
¬µm =
X
k0
km Pr(X = k) = E(Xm) .
(8.43)
This quantity ¬µm is called the \mth moment" of X. We can take exponentials
on both sides of (8.41), obtaining another formula for G(et):
G(et) = 1 + (Œ∫1t + 1
2Œ∫2t2 + ¬∑ ¬∑ ¬∑ )
1!
+ (Œ∫1t + 1
2Œ∫2t2 + ¬∑ ¬∑ ¬∑ )2
2!
+ ¬∑ ¬∑ ¬∑
= 1 + Œ∫1t + 1
2(Œ∫2 + Œ∫2
1)t2 + ¬∑ ¬∑ ¬∑ .
Equating coecients of powers of t leads to a series of formulas
Œ∫1 = ¬µ1 ,
(8.44)
Œ∫2 = ¬µ2 ‚àí¬µ2
1 ,
(8.45)
Œ∫3 = ¬µ3 ‚àí3¬µ1¬µ2 + 2¬µ3
1 ,
(8.46)
Œ∫4 = ¬µ4 ‚àí4¬µ1¬µ3 + 12¬µ2
1¬µ2 ‚àí3¬µ2
2 ‚àí6¬µ4
1 ,
(8.47)
Œ∫5 = ¬µ5 ‚àí5¬µ1¬µ4 + 20¬µ2
1¬µ3 ‚àí10¬µ2¬µ3
+ 30¬µ1¬µ2
2 ‚àí60¬µ3
1¬µ2 + 24¬µ5
1 ,
(8.48)
...
dening the cumulants in terms of the moments. Notice that Œ∫2 is indeed the
variance, E(X2) ‚àí(EX)2, as claimed.
Equation (8.41) makes it clear that the cumulants dened by the product
\For these higher
half-invariants we
shall propose no
special names."
|T.N.Thiele[351]
F(z)G(z) of two pgf's will be the sums of the corresponding cumulants of F(z)
and G(z), because logarithms of products are sums. Therefore all cumulants
of the sum of independent random variables are additive, just as the mean and
variance are. This property makes cumulants more important than moments.

8.3 PROBABILITY GENERATING FUNCTIONS 399
If we take a slightly dierent tack, writing
G(1 + t) = 1 + Œ±1
1! t + Œ±2
2! t2 + Œ±3
3! t3 + ¬∑ ¬∑ ¬∑ ,
equation (8.33) tells us that the Œ±'s are the \factorial moments"
Œ±m = G(m)(1)
=
X
k0
Pr(X = k)km zk‚àím ¬Ø¬Ø
z=1
=
X
k0
km Pr(X = k)
= E(Xm) .
(8.49)
It follows that
G(et) = 1 + Œ±1
1! (et ‚àí1) + Œ±2
2! (et ‚àí1)2 + ¬∑ ¬∑ ¬∑
= 1 + Œ±1
1! (t + 1
2t2 + ¬∑ ¬∑ ¬∑ ) + Œ±2
2! (t2 + t3 + ¬∑ ¬∑ ¬∑ ) + ¬∑ ¬∑ ¬∑
= 1 + Œ±1t + 1
2(Œ±2 + Œ±1)t2 + ¬∑ ¬∑ ¬∑ ,
and we can express the cumulants in terms of the derivatives G(m)(1):
Œ∫1 = Œ±1 ,
(8.50)
Œ∫2 = Œ±2 + Œ±1 ‚àíŒ±2
1 ,
(8.51)
Œ∫3 = Œ±3 + 3Œ±2 + Œ±1 ‚àí3Œ±2Œ±1 ‚àí3Œ±2
1 + 2Œ±3
1 ,
(8.52)
...
This sequence of formulas yields \additive" identities that extend (8.38) and
(8.39) to all the cumulants.
Let's get back down to earth and apply these ideas to simple examples.
The simplest case of a random variable is a \random constant," where X has
a certain xed value x with probability 1.
In this case GX(z) = zx, and
ln GX(et) = xt; hence the mean is x and all other cumulants are zero. It
follows that the operation of multiplying any pgf by zx increases the mean
by x but leaves the variance and all other cumulants unchanged.
How do probability generating functions apply to dice? The distribution
of spots on one fair die has the pgf
G(z) = z + z2 + z3 + z4 + z5 + z6
6
= zU6(z) ,

400 DISCRETE PROBABILITY
where U6 is the pgf for the uniform distribution of order 6. The factor `z'
adds 1 to the mean, so the mean is 3.5 instead of n‚àí1
2
= 2.5 as given in (8.35);
but an extra `z' does not aect the variance (8.36), which equals 35
12.
The pgf for total spots on two independent dice is the square of the pgf
for spots on one die,
GS(z) = z2 + 2z3 + 3z4 + 4z5 + 5z6 + 6z7 + 5z8 + 4z9 + 3z10 + 2z11 + z12
36
= z2U6(z)2 .
If we roll a pair of fair dice n times, the probability that we get a total of
k spots overall is, similarly,
[zk] GS(z)n = [zk] z2nU6(z)2n
= [zk‚àí2n] U6(z)2n .
In the hats-o-to-football-victory problem considered earlier, otherwise
Hat distribution is
a dierent kind of
uniform distribu-
tion.
known as the problem of enumerating the xed points of a random permuta-
tion, we know from (5.49) that the pgf is
Fn(z) =
X
0kn
(n ‚àík)<
(n ‚àík)!
zk
k! ,
for n  0.
(8.53)
Therefore
F‚Ä≤
n(z) =
X
1kn
(n ‚àík)<
(n ‚àík)!
zk‚àí1
(k ‚àí1)!
=
X
0kn‚àí1
(n ‚àí1 ‚àík)<
(n ‚àí1 ‚àík)!
zk
k!
= Fn‚àí1(z) .
Without knowing the details of the coecients, we can conclude from this
recurrence F‚Ä≤
n(z) = Fn‚àí1(z) that F(m)
n
(z) = Fn‚àím(z); hence
F(m)
n
(1) = Fn‚àím(1) = [n  m] .
(8.54)
This formula makes it easy to calculate the mean and variance; we nd as
before (but more quickly) that they are both equal to 1 when n  2.
In fact, we can now show that the mth cumulant Œ∫m of this random
variable is equal to 1 whenever n  m. For the mth cumulant depends only
on F‚Ä≤
n(1), F‚Ä≤‚Ä≤
n(1), . . . , F(m)
n
(1), and these are all equal to 1; hence we obtain

8.3 PROBABILITY GENERATING FUNCTIONS 401
the same answer for the mth cumulant as we do when we replace Fn(z) by
the limiting pgf
F‚àû(z) = ez‚àí1 ,
(8.55)
which has F(m)
‚àû(1) = 1 for derivatives of all orders. The cumulants of F‚àûare
identically equal to 1, because
ln F‚àû(et) = ln eet‚àí1 = et ‚àí1 =
t
1! + t2
2! + t3
3! + ¬∑ ¬∑ ¬∑ .
8.4
FLIPPING COINS
Now let's turn to processes that have just two outcomes. If we ip
a coin, there's probability p that it comes up heads and probability q that it
Con artists know
that p ‚âà0.1
when you spin a
newly minted U.S.
penny on a smooth
table. (The weight
distribution makes
Lincoln's head fall
downward.)
comes up tails, where
p + q = 1 .
(We assume that the coin doesn't come to rest on its edge, or fall into a hole,
etc.) Throughout this section, the numbers p and q will always sum to 1. If
the coin is fair, we have p = q = 1
2; otherwise the coin is said to be biased.
The probability generating function for the number of heads after one
toss of a coin is
H(z) = q + pz .
(8.56)
If we toss the coin n times, always assuming that dierent coin tosses are
independent, the number of heads is generated by
H(z)n = (q + pz)n =
X
k0
¬µn
k
¬∂
pkqn‚àíkzk ,
(8.57)
according to the binomial theorem. Thus, the chance that we obtain exactly k
heads in n tosses is
¬°n
k
¬¢
pkqn‚àík. This sequence of probabilities is called the
binomial distribution.
Suppose we toss a coin repeatedly until heads rst turns up. What is
the probability that exactly k tosses will be required? We have k = 1 with
probability p (since this is the probability of heads on the rst ip); we
have k = 2 with probability qp (since this is the probability of tails rst, then
heads); and for general k the probability is qk‚àí1p. So the generating function
is
pz + qpz2 + q2pz3 + ¬∑ ¬∑ ¬∑ =
pz
1 ‚àíqz .
(8.58)

402 DISCRETE PROBABILITY
Repeating the process until n heads are obtained gives the pgf
¬µ
pz
1 ‚àíqz
¬∂n
= pnzn X
k
¬µn + k ‚àí1
k
¬∂
(qz)k
=
X
k
¬µk ‚àí1
k ‚àín
¬∂
pnqk‚àínzk .
(8.59)
This, incidentally, is zn times
¬µ
p
1 ‚àíqz
¬∂n
=
X
k
¬µn + k ‚àí1
k
¬∂
pnqkzk ,
(8.60)
the generating function for the negative binomial distribution.
The probability space in example (8.59), where we ip a coin until
n heads have appeared, is dierent from the probability spaces we've seen
earlier in this chapter, because it contains innitely many elements. Each el-
ement is a nite sequence of heads and/or tails, containing precisely n heads
in all, and ending with heads; the probability of such a sequence is pnqk‚àín,
Heads I win,
tails you lose.
No? OK; tails you
lose, heads I win.
No? Well, then,
heads you lose,
tails I win.
where k ‚àín is the number of tails. Thus, for example, if n = 3 and if we
write H for heads and T for tails, the sequence THTTTHH is an element of the
probability space, and its probability is qpqqqpp = p3q4.
Let X be a random variable with the binomial distribution (8.57), and let
Y be a random variable with the negative binomial distribution (8.60). These
distributions depend on n and p. The mean of X is nH‚Ä≤(1) = np, since its
pgf is H(z)n; the variance is
n
¬°
H‚Ä≤‚Ä≤(1) + H‚Ä≤(1) ‚àíH‚Ä≤(1)2¬¢
= n(0 + p ‚àíp2) = npq .
(8.61)
Thus the standard deviation is ‚àönpq : If we toss a coin n times, we expect
to get heads about np ¬± ‚àönpq times. The mean and variance of Y can be
found in a similar way: If we let
G(z) =
p
1 ‚àíqz ,
we have
G‚Ä≤(z) =
pq
(1 ‚àíqz)2 ,
G‚Ä≤‚Ä≤(z) =
2pq2
(1 ‚àíqz)3 ;
hence G‚Ä≤(1) = pq/p2 = q/p and G‚Ä≤‚Ä≤(1) = 2pq2/p3 = 2q2/p2. It follows that
the mean of Y is nq/p and the variance is nq/p2.

8.4 FLIPPING COINS 403
A simpler way to derive the mean and variance of Y is to use the reciprocal
generating function
F(z) = 1 ‚àíqz
p
= 1
p ‚àíq
pz ,
(8.62)
and to write
G(z)n = F(z)‚àín .
(8.63)
This polynomial F(z) is not a probability generating function, because it has
a negative coecient.
But it does satisfy the crucial condition F(1) = 1.
Thus F(z) is formally a binomial that corresponds to a coin for which we
get heads with \probability" equal to ‚àíq/p; and G(z) is formally equivalent
The probability is
negative that I'm
getting younger.
Oh? Then it's > 1
that you're getting
older, or staying
the same.
to ipping such a coin ‚àí1 times(!).
The negative binomial distribution
with parameters (n, p) can therefore be regarded as the ordinary binomial
distribution with parameters (n‚Ä≤, p‚Ä≤) = (‚àín, ‚àíq/p).
Proceeding formally,
the mean must be n‚Ä≤p‚Ä≤ = (‚àín)(‚àíq/p) = nq/p, and the variance must be
n‚Ä≤p‚Ä≤q‚Ä≤ = (‚àín)(‚àíq/p)(1 + q/p) = nq/p2. This formal derivation involving
negative probabilities is valid, because our derivation for ordinary binomials
was based on identities between formal power series in which the assumption
0  p  1 was never used.
Let's move on to another example: How many times do we have to ip
a coin until we get heads twice in a row? The probability space now consists
of all sequences of H's and T's that end with HH but have no consecutive H's
until the nal position:
‚Ñ¶= fHH, THH, TTHH, HTHH, TTTHH, THTHH, HTTHH, . . . g .
The probability of any given sequence is obtained by replacing H by p and T
by q; for example, the sequence THTHH will occur with probability
Pr(THTHH) = qpqpp = p3q2 .
We can now play with generating functions as we did at the beginning
of Chapter 7, letting S be the innite sum
S = HH + THH + TTHH + HTHH + TTTHH + THTHH + HTTHH + ¬∑ ¬∑ ¬∑
of all the elements of ‚Ñ¶. If we replace each H by pz and each T by qz, we get
the probability generating function for the number of ips needed until two
consecutive heads turn up.

404 DISCRETE PROBABILITY
There's a curious relation between S and the sum of domino tilings
T = + +
+
+
+
+
+ ¬∑ ¬∑ ¬∑
in equation (7.1). Indeed, we obtain S from T if we replace each
by T and
each
by HT, then tack on an HH at the end. This correspondence is easy to
prove because each element of ‚Ñ¶has the form (T + HT)nHH for some n  0,
and each term of T has the form ( +
)n. Therefore by (7.4) we have
S = (1 ‚àíT ‚àíHT)‚àí1HH ,
and the probability generating function for our problem is
G(z) =
¬°
1 ‚àíqz ‚àí(pz)(qz)
¬¢‚àí1(pz)2
=
p2z2
1 ‚àíqz ‚àípqz2 .
(8.64)
Our experience with the negative binomial distribution gives us a clue
that we can most easily calculate the mean and variance of (8.64) by writing
G(z) =
z2
F(z) ,
where
F(z) = 1 ‚àíqz ‚àípqz2
p2
,
and by calculating the \mean" and \variance" of this pseudo-pgf F(z). (Once
again we've introduced a function with F(1) = 1.) We have
F‚Ä≤(1) = (‚àíq ‚àí2pq)/p2 = 2 ‚àíp‚àí1 ‚àíp‚àí2 ;
F‚Ä≤‚Ä≤(1) = ‚àí2pq/p2 = 2 ‚àí2p‚àí1 .
Therefore, since z2 = F(z)G(z), Mean(z2) = 2, and Var(z2) = 0, the mean
and variance of distribution G(z) are
Mean(G) = 2 ‚àíMean(F) = p‚àí2 + p‚àí1 ;
(8.65)
Var(G) = ‚àíVar(F)
= p‚àí4 + 2p‚àí3 ‚àí2p‚àí2 ‚àíp‚àí1 .
(8.66)
When p = 1
2 the mean and variance are 6 and 22, respectively. (Exercise 4
discusses the calculation of means and variances by subtraction.)

8.4 FLIPPING COINS 405
Now let's try a more intricate experiment: We will ip coins until the
pattern THTTH is rst obtained. The sum of winning positions is now
S = THTTH + HTHTTH + TTHTTH
+ HHTHTTH + HTTHTTH + THTHTTH + TTTHTTH + ¬∑ ¬∑ ¬∑ ;
this sum is more dicult to describe than the previous one. If we go back to
the method by which we solved the domino problems in Chapter 7, we can
obtain a formula for S by considering it as a \nite state language" dened
by the following \automaton":
\`You really are an
automaton|a cal-
culating machine,'
I cried. `There is
something positively
inhuman in you at
times.'"
|J.H. Watson [83]












-
-
-
-
-
-
0
1
2
3
4
5
T
H
T
T
H
H
T
H
H
T
 






66
66
6
The elementary events in the probability space are the sequences of H's and
T's that lead from state 0 to state 5. Suppose, for example, that we have
just seen THT; then we are in state 3. Flipping tails now takes us to state 4;
ipping heads in state 3 would take us to state 2 (not all the way back to
state 0, since the TH we've just seen may be followed by TTH).
In this formulation, we can let Sk be the sum of all sequences of H's and
T's that lead to state k; it follows that
S0 = 1 + S0 H + S2 H ,
S1 = S0 T + S1 T + S4 T ,
S2 = S1 H + S3 H ,
S3 = S2 T ,
S4 = S3 T ,
S5 = S4 H .
Now the sum S in our problem is S5; we can obtain it by solving these six
equations in the six unknowns S0, S1, . . . , S5. Replacing H by pz and T by qz
gives generating functions where the coecient of zn in Sk is the probability
that we are in state k after n ips.
In the same way, any diagram of transitions between states, where the
transition from state j to state k occurs with given probability pj,k, leads to
a set of simultaneous linear equations whose solutions are generating func-
tions for the state probabilities after n transitions have occurred. Systems
of this kind are called Markov processes, and the theory of their behavior is
intimately related to the theory of linear equations.

406 DISCRETE PROBABILITY
But the coin-ipping problem can be solved in a much simpler way,
without the complexities of the general nite-state approach. Instead of six
equations in six unknowns S0, S1, . . . , S5, we can characterize S with only
two equations in two unknowns. The trick is to consider the auxiliary sum
N = S0 + S1 + S2 + S3 + S4 of all ip sequences that don't contain any
occurrences of the given pattern THTTH:
N = 1 + H + T + HH + ¬∑ ¬∑ ¬∑ + THTHT + THTTT + ¬∑ ¬∑ ¬∑ .
We have
1 + N(H + T) = N + S ,
(8.67)
because every term on the left either ends with THTTH (and belongs to S) or
doesn't (and belongs to N); conversely, every term on the right is either empty
or belongs to N H or N T. And we also have the important additional equation
N THTTH = S + S TTH ,
(8.68)
because every term on the left completes a term of S after either the rst H
or the second H, and because every term on the right belongs to the left.
The solution to these two simultaneous equations is easily obtained: We
have N = (1 ‚àíS)(1 ‚àíH ‚àíT)‚àí1 from (8.67), hence
(1 ‚àíS)(1 ‚àíT ‚àíH)‚àí1 THTTH = S(1 + TTH) .
As before, we get the probability generating function G(z) for the number of
ips if we replace H by pz and T by qz. A bit of simplication occurs since
p + q = 1, and we nd
¬°
1 ‚àíG(z)
¬¢
p2q3z5
1 ‚àíz
= G(z)(1 + pq2z3) ;
hence the solution is
G(z) =
p2q3z5
p2q3z5 + (1 + pq2z3)(1 ‚àíz) .
(8.69)
Notice that G(1) = 1, if pq Ã∏= 0; we do eventually encounter the pattern
THTTH, with probability 1, unless the coin is rigged so that it always comes
up heads or always tails.
To get the mean and variance of the distribution (8.69), we invert G(z)
as we did in the previous problem, writing G(z) = z5/F(z) where F is a poly-
nomial:
F(z) = p2q3z5 + (1 + pq2z3)(1 ‚àíz)
p2q3
.
(8.70)

8.4 FLIPPING COINS 407
The relevant derivatives are
F‚Ä≤(1) = 5 ‚àí(1 + pq2)/p2q3 ,
F‚Ä≤‚Ä≤(1) = 20 ‚àí6pq2/p2q3 ;
and if X is the number of ips we get
EX = Mean(G) = 5 ‚àíMean(F) = p‚àí2q‚àí3 + p‚àí1q‚àí1 ;
(8.71)
VX = Var(G) = ‚àíVar(F)
= ‚àí25 + p‚àí2q‚àí3 + 7p‚àí1q‚àí1 + Mean(F)2
= (EX)2 ‚àí9p‚àí2q‚àí3 ‚àí3p‚àí1q‚àí1 .
(8.72)
When p = 1
2, the mean and variance are 36 and 996.
Let's get general: The problem we have just solved was \random" enough
to show us how to analyze the case that we are waiting for the rst appearance
of an arbitrary pattern A of heads and tails. Again we let S be the sum of
all winning sequences of H's and T's, and we let N be the sum of all sequences
that haven't encountered the pattern A yet. Equation (8.67) will remain the
same; equation (8.68) will become
NA = S
¬°
1 + A(1) [A(m‚àí1) = A(m‚àí1)] + A(2) [A(m‚àí2) = A(m‚àí2)]
+ ¬∑ ¬∑ ¬∑ + A(m‚àí1) [A(1) = A(1)]
¬¢
,
(8.73)
where m is the length of A, and where A(k) and A(k) denote respectively the
last k characters and the rst k characters of A. For example, if A is the
pattern THTTH we just studied, we have
A(1) = H ,
A(2) = TH ,
A(3) = TTH ,
A(4) = HTTH ;
A(1) = T ,
A(2) = TH ,
A(3) = THT ,
A(4) = THTT .
Since the only perfect match is A(2) = A(2), equation (8.73) reduces to (8.68).
Let eA be the result of substituting p‚àí1 for H and q‚àí1 for T in the pat-
tern A. Then it is not dicult to generalize our derivation of (8.71) and (8.72)
to conclude (exercise 20) that the general mean and variance are
EX =
m
X
k=1
eA(k) [A(k) = A(k)] ;
(8.74)
VX = (EX)2 ‚àí
m
X
k=1
(2k ‚àí1)eA(k) [A(k) = A(k)] .
(8.75)

408 DISCRETE PROBABILITY
In the special case p = 1
2 we can interpret these formulas in a particularly
simple way. Given a pattern A of m heads and tails, let
A:A =
m
X
k=1
2k‚àí1 [A(k) = A(k)] .
(8.76)
We can easily nd the binary representation of this number by placing a `1'
under each position such that the string matches itself perfectly when it is
superimposed on a copy of itself that has been shifted to start in this position:
A = HTHTHHTHTH
A:A = (1000010101)2 = 512 + 16 + 4 + 1 = 533
HTHTHHTHTH
‚àö
HTHTHHTHTH
HTHTHHTHTH
HTHTHHTHTH
HTHTHHTHTH
HTHTHHTHTH
‚àö
HTHTHHTHTH
HTHTHHTHTH
‚àö
HTHTHHTHTH
HTHTHHTHTH
‚àö
Equation (8.74) now tells us that the expected number of ips until pattern A
appears is exactly 2(A:A), if we use a fair coin, because eA(k) = 2k when
p = q = 1
2. This result, rst discovered by the Soviet mathematician A. D.
\Chem bol'she
periodov u nashego
slova, tem pozzhe
ono po√Ñavl√Ñaets√Ña."
|A.D. Solov'ev
Solov'ev in 1966 [331], seems paradoxical at rst glance: Patterns with no
self-overlaps occur sooner than overlapping patterns do! It takes almost twice
as long to encounter HHHHH as it does to encounter HHHHT or THHHH.
Now let's consider an amusing game that was invented by (of all people)
Walter Penney [289] in 1969. Alice and Bill ip a coin until either HHT or
HTT occurs; Alice wins if the pattern HHT comes rst, Bill wins if HTT comes
rst. This game | now called \Penney ante" | certainly seems to be fair, if
played with a fair coin, because both patterns HHT and HTT have the same
characteristics if we look at them in isolation: The probability generating
function for the waiting time until HHT rst occurs is
G(z) =
z3
z3 ‚àí8(z ‚àí1) ,
and the same is true for HTT. Therefore neither Alice nor Bill has an advan-
Of course not! Who
could they have an
advantage over?
tage, if they play solitaire.

8.4 FLIPPING COINS 409
But there's an interesting interplay between the patterns when both are
considered simultaneously. Let SA be the sum of Alice's winning congura-
tions, and let SB be the sum of Bill's:
SA = HHT + HHHT + THHT + HHHHT + HTHHT + THHHT + ¬∑ ¬∑ ¬∑ ;
SB = HTT + THTT + HTHTT + TTHTT + THTHTT + TTTHTT + ¬∑ ¬∑ ¬∑ .
Also | taking our cue from the trick that worked when only one pattern was
involved | let us denote by N the sum of all sequences in which neither player
has won so far:
N = 1 + H + T + HH + HT + TH + TT + HHH + HTH + THH + ¬∑ ¬∑ ¬∑ .
(8.77)
Then we can easily verify the following set of equations:
1 + N(H + T) = N + SA + SB ;
N HHT = SA ;
(8.78)
N HTT = SA T + SB .
If we now set H = T = 1
2, the resulting value of SA becomes the probability
that Alice wins, and SB becomes the probability that Bill wins. The three
equations reduce to
1 + N = N + SA + SB ;
1
8N = SA ;
1
8N =
1
2SA + SB ;
and we nd SA = 2
3, SB = 1
3. Alice will win about twice as often as Bill!
In a generalization of this game, Alice and Bill choose patterns A and B
of heads and tails, and they ip coins until either A or B appears.
The
two patterns need not have the same length, but we assume that A doesn't
occur within B, nor does B occur within A. (Otherwise the game would be
degenerate. For example, if A = HT and B = THTH, poor Bill could never win;
and if A = HTH and B = TH, both players might claim victory simultaneously.)
Then we can write three equations analogous to (8.73) and (8.78):
1 + N(H + T) = N + SA + SB ;
NA = SA
l
X
k=1
A(l‚àík) [A(k) = A(k)] + SB
min(l,m)
X
k=1
A(l‚àík) [B(k) = A(k)] ;
NB = SA
min(l,m)
X
k=1
B(m‚àík) [A(k) = B(k)] + SB
m
X
k=1
B(m‚àík) [B(k) = B(k)] .
(8.79)

410 DISCRETE PROBABILITY
Here l is the length of A and m is the length of B. For example, if we have
A = HTTHTHTH and B = THTHTTH, the two pattern-dependent equations are
N HTTHTHTH = SA TTHTHTH + SA + SB TTHTHTH + SB THTH ;
N THTHTTH = SA THTTH + SA TTH + SB THTTH + SB .
We obtain the victory probabilities by setting H = T = 1
2, if we assume that a
fair coin is being used; this reduces the two crucial equations to
N = SA
l
X
k=1
2k [A(k) = A(k)] + SB
min(l,m)
X
k=1
2k [B(k) = A(k)] ;
N = SA
min(l,m)
X
k=1
2k [A(k) = B(k)] + SB
m
X
k=1
2k [B(k) = B(k)] .
(8.80)
We can see what's going on if we generalize the A:A operation of (8.76) to a
function of two independent strings A and B:
A:B =
min(l,m)
X
k=1
2k‚àí1 [A(k) = B(k)] .
(8.81)
Equations (8.80) now become simply
SA(A:A) + SB(B:A) = SA(A:B) + SB(B:B) ;
the odds in Alice's favor are
SA
SB
= B:B ‚àíB:A
A:A ‚àíA:B .
(8.82)
(This beautiful formula was discovered by John Horton Conway [137].)
For example, if A = HTTHTHTH and B = THTHTTH as above, we have
A:A = (10000001)2 = 129, A:B = (0001010)2 = 10, B:A = (0001001)2 = 9,
and B:B = (1000010)2 = 66; so the ratio SA/SB is (66‚àí9)/(129‚àí10) = 57/119.
Alice will win this one only 57 times out of every 176, on the average.
Strange things can happen in Penney's game. For example, the pattern
HHTH wins over the pattern HTHH with 3/2 odds, and HTHH wins over THHH with
7/5 odds. So HHTH ought to be much better than THHH. Yet THHH actually wins
over HHTH, with 7/5 odds! The relation between patterns is not transitive. In
Odd, odd.
fact, exercise 57 proves that if Alice chooses any pattern œÑ1œÑ2 . . . œÑl of length
l  3, Bill can always ensure better than even chances of winning if he chooses
the pattern œÑ2œÑ1œÑ2 . . . œÑl‚àí1, where œÑ2 is the heads/tails opposite of œÑ2.

8.5 HASHING 411
8.5
HASHING
Let's conclude this chapter by applying probability theory to com-
puter programming. Several important algorithms for storing and retrieving
information inside a computer are based on a technique called \hashing."
The general problem is to maintain a set of records that each contain a \key"
\Somehow the verb
`to hash' magically
became standard
terminology for key
transformation dur-
ing the mid-1960s,
yet nobody was rash
enough to use such
an undignied word
publicly until 1967."
|D.E. Knuth [209]
value, K, and some data D(K) about that key; we want to be able to nd
D(K) quickly when K is given. For example, each key might be the name of
a student, and the associated data might be that student's homework grades.
In practice, computers don't have enough capacity to set aside one mem-
ory cell for every possible key; billions of keys are possible, but comparatively
few keys are actually present in any one application. One solution to the
problem is to maintain two tables KEY[j] and DATA[j] for 1  j  N, where
N is the total number of records that can be accommodated; another vari-
able n tells how many records are actually present. Then we can search for a
given key K by going through the table sequentially in an obvious way:
S1 Set j := 1. (We've searched through all positions < j.)
S2 If j > n, stop. (The search was unsuccessful.)
S3 If KEY[j] = K, stop. (The search was successful.)
S4 Increase j by 1 and return to step S2. (We'll try again.)
After a successful search, the desired data entry D(K) appears in DATA[j].
After an unsuccessful search, we can insert K and D(K) into the table by
setting
n := j,
KEY[n] := K,
DATA[n] := D(K),
assuming that the table was not already lled to capacity.
This method works, but it can be dreadfully slow; we need to repeat
step S2 a total of n + 1 times whenever an unsuccessful search is made, and
n can be quite large.
Hashing was invented to speed things up. The basic idea, in one of its
popular forms, is to use m separate lists instead of one giant list. A \hash
function" transforms every possible key K into a list number h(K) between 1
and m. An auxiliary table FIRST[i] for 1  i  m points to the rst record
in list i; another auxiliary table NEXT[j] for 1  j  N points to the record
following record j in its list. We assume that
FIRST[i] = ‚àí1 ,
if list i is empty;
NEXT[j] = 0 ,
if record j is the last in its list.
As before, there's a variable n that tells how many records have been stored
altogether.

412 DISCRETE PROBABILITY
For example, suppose the keys are names, and suppose that there are
m = 4 lists based on the rst letter of a name:
h(name) =
Ô£±
Ô£¥
Ô£≤
Ô£¥
Ô£≥
1,
for A{F;
2,
for G{L;
3,
for M{R;
4,
for S{Z.
We start with four empty lists and with n = 0. If, say, the rst record has
Nora as its key, we have h(Nora) = 3, so Nora becomes the key of the rst
item in list 3. If the next two names are Glenn and Jim, they both go into
list 2. Now the tables in memory look like this:
FIRST[1] = ‚àí1,
FIRST[2] = 2,
FIRST[3] = 1,
FIRST[4] = ‚àí1.
KEY[1] = Nora,
NEXT[1] = 0 ;
KEY[2] = Glenn,
NEXT[2] = 3 ;
KEY[3] = Jim,
NEXT[3] = 0 ;
n = 3.
(The values of DATA[1], DATA[2], and DATA[3] are condential and will not
be shown.) After 18 records have been inserted, the lists might contain the
Let's hear it for
the Concrete Math
students who sat in
the front rows and
lent their names to
this experiment.
names
list 1
list 2
list 3
list 4
Dianne
Glenn
Nora
Scott
Ari
Jim
Mike
Tina
Brian
Jennifer
Michael
Fran
Joan
Ray
Doug
Jerry
Paula
Jean
and these names would appear intermixed in the KEY array with NEXT entries
to keep the lists eectively separate. If we now want to search for John, we
have to scan through the six names in list 2 (which happens to be the longest
list); but that's not nearly as bad as looking at all 18 names.
Here's a precise specication of the algorithm that searches for key K in
accordance with this scheme:
H1 Set i := h(K) and j := FIRST[i].
H2 If j  0, stop. (The search was unsuccessful.)
H3 If KEY[j] = K, stop. (The search was successful.)
H4 Set i := j, then set j := NEXT[i] and return to step H2. (We'll try again.)
For example, to search for Jennifer in the example given, step H1 would set
i := 2 and j := 2; step H3 would nd that Glenn Ã∏= Jennifer; step H4 would
I bet their parents
are glad about that.
set j := 3; and step H3 would nd Jim Ã∏= Jennifer. One more iteration of
steps H4 and H3 would locate Jennifer in the table.

8.5 HASHING 413
After a successful search, the desired data D(K) appears in DATA[j], as in
the previous algorithm. After an unsuccessful search, we can enter K and D(K)
in the table by doing the following operations:
n := n + 1;
if j < 0 then FIRST[i] := n else NEXT[i] := n;
KEY[n] := K;
DATA[n] := D(K);
NEXT[n] := 0.
(8.83)
Now the table will once again be up to date.
We hope to get lists of roughly equal length, because this will make the
task of searching about m times faster. The value of m is usually much greater
than 4, so a factor of 1/m will be a signicant improvement.
We don't know in advance what keys will be present, but it is generally
possible to choose the hash function h so that we can consider h(K) to be a
random variable that is uniformly distributed between 1 and m, independent
of the hash values of other keys that are present. In such cases computing the
hash function is like rolling a die that has m faces. There's a chance that all
the records will fall into the same list, just as there's a chance that a die will
always turn up qqq qqq ; but probability theory tells us that the lists will almost
always be pretty evenly balanced.
Analysis of Hashing: Introduction.
\Algorithmic analysis" is a branch of computer science that derives quan-
titative information about the eciency of computer methods. \Probabilistic
analysis of an algorithm" is the study of an algorithm's running time, con-
sidered as a random variable that depends on assumed characteristics of the
input data. Hashing is an especially good candidate for probabilistic analysis,
because it is an extremely ecient method on the average, even though its
worst case is too horrible to contemplate. (The worst case occurs when all
keys have the same hash value.) Indeed, a computer programmer who uses
hashing had better be a believer in probability theory.
Let P be the number of times step H3 is performed when the algorithm
above is used to carry out a search. (Each execution of H3 is called a \probe"
in the table.)
If we know P, we know how often each step is performed,
depending on whether the search is successful or unsuccessful:
Step
Unsuccessful search
Successful search
H1
1 time
1 time
H2
P + 1 times
P times
H3
P times
P times
H4
P times
P ‚àí1 times

414 DISCRETE PROBABILITY
Thus the main quantity that governs the running time of the search procedure
is the number of probes, P.
We can get a good mental picture of the algorithm by imagining that we
are keeping an address book that is organized in a special way, with room for
only one entry per page. On the cover of the book we note down the page
number for the rst entry in each of m lists; each name K determines the list
h(K) that it belongs to. Every page inside the book refers to the successor
page in its list. The number of probes needed to nd an address in such a
book is the number of pages we must consult.
If n items have been inserted, their positions in the table depend only
on their respective hash values, ‚ü®h1, h2, . . . , hn‚ü©. Each of the mn possible
sequences ‚ü®h1, h2, . . . , hn‚ü©is considered to be equally likely, and P is a random
variable depending on such a sequence.
Case 1: The key is not present.
Check under the
doormat.
Let's consider rst the behavior of P in an unsuccessful search, assuming
that n records have previously been inserted into the hash table. In this case
the relevant probability space consists of mn+1 elementary events
œâ = (h1, h2, . . . , hn, hn+1)
where hj is the hash value of the jth key inserted, and where hn+1 is the
hash value of the key for which the search is unsuccessful. We assume that
the hash function h has been chosen properly so that Pr(œâ) = 1/mn+1 for
every such œâ.
For example, if m = n = 2, there are eight equally likely possibilities:
h1
h2
h3:
P
1
1
1 :
2
1
1
2 :
0
1
2
1 :
1
1
2
2 :
1
2
1
1 :
1
2
1
2 :
1
2
2
1 :
0
2
2
2 :
2
If h1 = h2 = h3 we make two unsuccessful probes before concluding that the
new key K is not present; if h1 = h2 Ã∏= h3 we make none; and so on. This list
of all possibilities shows that P has a probability distribution given by the pgf
( 2
8 + 4
8z + 2
8z2) = ( 1
2 + 1
2z)2, when m = n = 2.
An unsuccessful search makes one probe for every item in list number
hn+1, so we have the general formula
P = [h1 = hn+1] + [h2 = hn+1] + ¬∑ ¬∑ ¬∑ + [hn = hn+1] .
(8.84)

8.5 HASHING 415
The probability that hj = hn+1 is 1/m, for 1  j  n; so it follows that
EP = E[h1 = hn+1] + E[h2 = hn+1] + ¬∑ ¬∑ ¬∑ + E[hn = hn+1] =
n
m .
Maybe we should do that more slowly: Let Xj be the random variable
Xj = Xj(œâ) = [hj = hn+1] .
Then P = X1 + ¬∑ ¬∑ ¬∑ + Xn, and EXj = 1/m for all j  n; hence
EP = EX1 + ¬∑ ¬∑ ¬∑ + EXn = n/m .
Good: As we had hoped, the average number of probes is 1/m times what it
was without hashing. Furthermore the random variables Xj are independent,
and they each have the same probability generating function
Xj(z) = m ‚àí1 + z
m
;
therefore the pgf for the total number of probes in an unsuccessful search is
P(z) = X1(z) . . . Xn(z) =
¬≥m ‚àí1 + z
m
¬¥n
.
(8.85)
This is a binomial distribution, with p = 1/m and q = (m ‚àí1)/m; in other
words, the number of probes in an unsuccessful search behaves just like the
number of heads when we toss a biased coin whose probability of heads is
1/m on each toss. Equation (8.61) tells us that the variance of P is therefore
npq = n(m ‚àí1)
m2
.
When m is large, the variance of P is approximately n/m, so the standard
deviation is approximately
p
n/m.
Case 2: The key is present.
Now let's look at successful searches. In this case the appropriate proba-
bility space is a bit more complicated, depending on our application: We will
let ‚Ñ¶be the set of all elementary events
œâ = (h1, . . . , hn; k) ,
(8.86)
where hj is the hash value for the jth key as before, and where k is the index
of the key being sought (the key whose hash value is hk).
Thus we have
1  hj  m for 1  j  n, and 1  k  n; there are mn ¬∑ n elementary
events œâ in all.

416 DISCRETE PROBABILITY
Let sj be the probability that we are searching for the jth key that was
inserted into the table. Then
Pr(œâ) = sk/mn
(8.87)
if œâ is the event (8.86). (Some applications search most often for the items
that were inserted rst, or for the items that were inserted last, so we will
not assume that each sj = 1/n.) Notice that P
œâ‚àà‚Ñ¶Pr(œâ) = Pn
k=1 sk = 1,
hence (8.87) denes a legal probability distribution.
The number of probes P in a successful search is p if key K was the pth
key to be inserted into its list. Therefore
P(h1, . . . , hn; k) = [h1 = hk] + [h2 = hk] + ¬∑ ¬∑ ¬∑ + [hk = hk] ;
(8.88)
or, if we let Xj be the random variable [hj = hk], we have
P = X1 + X2 + ¬∑ ¬∑ ¬∑ + Xk .
(8.89)
Suppose, for example, that we have m = 10 and n = 16, and that the hash
values have the following \random" pattern:
Where have I seen
that pattern before?
(h1, . . . , h16) = 3 1 4 1 5 9 2 6 5 3 5 8 9 7 9 3 ;
(P1, . . . , P16) = 1 1 1 2 1 1 1 1 2 2 3 1 2 1 3 3 .
The number of probes Pj needed to nd the jth key is shown below hj.
Equation (8.89) represents P as a sum of random variables, but we can't
simply calculate EP as EX1+¬∑ ¬∑ ¬∑+EXk because the quantity k itself is a random
variable. What is the probability generating function for P? To answer this
question we should digress a moment to talk about conditional probability.
Equation (8.43) was
also a momentary
digression.
If A and B are events in a probability space, we say that the conditional
probability of A, given B, is
Pr(œâ ‚ààA | œâ ‚ààB) = Pr(œâ ‚ààA ‚à©B)
Pr(œâ ‚ààB)
.
(8.90)
For example, if X and Y are random variables, the conditional probability of
the event X = x, given that Y = y, is
Pr(X = x | Y = y) = Pr(X = x and Y = y)
Pr(Y = y)
.
(8.91)
For any xed y in the range of Y, the sum of these conditional probabil-
ities over all x in the range of X is Pr(Y = y)/Pr(Y = y) = 1; therefore (8.91)
denes a probability distribution, and we can dene a new random variable
`Xjy' such that Pr
¬°
(Xjy) = x
¬¢
= Pr(X = x | Y = y).

8.5 HASHING 417
If X and Y are independent, the random variable Xjy will be essentially
the same as X, regardless of the value of y, because Pr(X = x | Y = y) is equal
to Pr(X = x) by (8.5); that's what independence means. But if X and Y are
dependent, the random variables Xjy and Xjy‚Ä≤ need not resemble each other
in any way when y Ã∏= y‚Ä≤.
If X takes only nonnegative integer values, we can decompose its pgf into
a sum of conditional pgf's with respect to any other random variable Y:
GX(z) =
X
y‚ààY(‚Ñ¶)
Pr(Y = y)GXjy(z) .
(8.92)
This holds because the coecient of zx on the left side is Pr(X = x), for all
x ‚ààX(‚Ñ¶), and on the right it is
X
y‚ààY(‚Ñ¶)
Pr(Y = y) Pr(X = x | Y = y) =
X
y‚ààY(‚Ñ¶)
Pr(X = x and Y = y)
= Pr(X = x) .
For example, if X is the product of the spots on two fair dice and if Y is the
sum of the spots, the pgf for Xj6 is
GXj6(z) =
2
5z5 + 2
5z8 + 1
5z9
because the conditional probabilities for Y = 6 consist of ve equally probable
events f q qqqq q ,
q q q qq q ,
qqq qqq ,
q qq q q q ,
qqqq q q g.
Equation (8.92) in this case
reduces to
GX(z) =
1
36GXj2(z) +
2
36GXj3(z) +
3
36GXj4(z) +
4
36GXj5(z)
5
36GXj6(z) +
6
36GXj7(z) +
5
36GXj8(z) +
4
36GXj9(z)
3
36GXj10(z) +
2
36GXj11(z) +
1
36GXj12(z) ,
a formula that is obvious once you understand it. (End of digression.)
Oh, now I un-
derstand what
mathematicians
mean when they
say something is
\obvious," \clear,"
or \trivial."
In the case of hashing, (8.92) tells us how to write down the pgf for probes
in a successful search, if we let X = P and Y = K. For any xed k between 1
and n, the random variable Pjk is dened as a sum of independent random
variables X1 + ¬∑ ¬∑ ¬∑ + Xk; this is (8.89). So it has the pgf
GPjk(z) =
¬≥m ‚àí1 + z
m
¬¥k‚àí1
z .

418 DISCRETE PROBABILITY
Therefore the pgf for P itself is clearly
\By clearly, I mean
a good freshman
should be able to do
it, although it's not
completely trivial."
|Paul Erd}os [94].
GP(z) =
n
X
k=1
skGPjk(z)
=
n
X
k=1
sk
¬≥m ‚àí1 + z
m
¬¥k‚àí1
z
= z S
¬≥m ‚àí1 + z
m
¬¥
,
(8.93)
where
S(z) = s1 + s2z + s3z2 + ¬∑ ¬∑ ¬∑ + snzn‚àí1
(8.94)
is the pgf for the search probabilities sk (divided by z for convenience).
Good. We have a probability generating function for P; we can now nd
the mean and variance by dierentiation. It's somewhat easier to remove the
z factor rst, as we've done before, thus nding the mean and variance of
P ‚àí1 instead:
F(z) = GP(z)/z = S
¬≥m ‚àí1 + z
m
¬¥
;
F‚Ä≤(z) =
1
mS‚Ä≤¬≥m ‚àí1 + z
m
¬¥
;
F‚Ä≤‚Ä≤(z) =
1
m2 S‚Ä≤‚Ä≤¬≥m ‚àí1 + z
m
¬¥
.
Therefore
EP = 1 + Mean(F) = 1 + F‚Ä≤(1) = 1 + m‚àí1 Mean(S) ;
(8.95)
VP = Var(F) = F‚Ä≤‚Ä≤(1) + F‚Ä≤(1) ‚àíF‚Ä≤(1)2
= m‚àí2S‚Ä≤‚Ä≤(1) + m‚àí1S‚Ä≤(1) ‚àím‚àí2S‚Ä≤(1)2
= m‚àí2 Var(S) + (m‚àí1 ‚àím‚àí2) Mean(S) .
(8.96)
These are general formulas expressing the mean and variance of the num-
ber of probes P in terms of the mean and variance of the assumed search
distribution S.
For example, suppose we have sk = 1/n for 1  k  n. This means
we are doing a purely \random" successful search, with all keys in the table
equally likely.
Then S(z) is the uniform probability distribution Un(z) in

8.5 HASHING 419
(8.32), and we have Mean(S) = (n ‚àí1)/2, Var(S) = (n2 ‚àí1)/12. Hence
EP = n ‚àí1
2m
+ 1 ;
(8.97)
VP = n2 ‚àí1
12m2 + (m ‚àí1)(n ‚àí1)
2m2
= (n ‚àí1)(6m + n ‚àí5)
12m2
.
(8.98)
Once again we have gained the desired speedup factor of 1/m. If m = n/ln n
and n ‚Üí‚àû, the average number of probes per successful search in this case
is about 1
2 ln n, and the standard deviation is asymptotically (ln n)/
‚àö
12.
On the other hand, we might suppose that sk = (kHn)‚àí1 for 1  k  n;
this distribution is called \Zipf's law." Then Mean(G) = n/Hn and Var(G) =
1
2n(n + 1)/Hn ‚àín2/H2
n. The average number of probes for m = n/ln n as
n ‚Üí‚àûis approximately 2, with standard deviation asymptotic to
‚àö
ln n/
‚àö
2.
In both cases the analysis allows the cautious souls among us, who fear
the worst case, to rest easily: Chebyshev's inequality tells us that the lists
will be nice and short, except in extremely rare cases.
Case 2, continued: Variants of the variance.
We have just computed the variance of the number of probes in a success-
ful search, by considering P to be a random variable over a probability space
with mn¬∑n elements (h1, . . . , hn; k). But we could have adopted another point
of view: Each pattern (h1, . . . , hn) of hash values denes a random variable
OK, gang, time
to put on your
skim suits again.
|Friendly TA
Pj(h1, . . . , hn), representing the probes we make in a successful search of a
particular hash table on n given keys. The average value of Pj(h1, . . . , hn),
A(h1, . . . , hn) =
n
X
p=1
p ¬∑ Pr
¬°¬°
Pj(h1, . . . , hn)
¬¢
= p
¬¢
,
(8.99)
can be said to represent the running time of a successful search. This quantity
A(h1, . . . , hn) is a random variable that depends only on (h1, . . . , hn), not on
the nal component k. We can write it in the form
A(h1, . . . , hn) =
n
X
k=1
sk P(h1, . . . , hn; k) ,
where P(h1, . . . , hn; k) is dened in (8.88), since Pj(h1, . . . , hn) = p with
probability
Pn
k=1 Pr
¬°
P(h1, . . . , hn; k) = p
¬¢
Pn
k=1 Pr(h1, . . . , hn; k)
=
Pn
k=1 m‚àínsk
¬£
P(h1, . . . , hn; k) = p
¬§
Pn
k=1 m‚àínsk
=
n
X
k=1
sk
¬£
P(h1, . . . , hn; k) = p
¬§
.

420 DISCRETE PROBABILITY
The mean value of A(h1, . . . , hn), obtained by summing over all mn pos-
sibilities (h1, . . . , hn) and dividing by mn, will be the same as the mean value
we obtained before in (8.95). But the variance of A(h1, . . . , hn) is something
dierent; this is a variance of mn averages, not a variance of mn ¬∑n probe
counts. For example, if m = 1 (so that there is only one list), the \average"
value A(h1, . . . , hn) = A(1, . . . , 1) is actually constant, so its variance VA is
zero; but the number of probes in a successful search is not constant, so the
variance VP is nonzero.
But the VP is
nonzero only in an
election year.
We can illustrate this dierence between variances by carrying out the
calculations for general m and n in the simplest case, when sk = 1/n for
1  k  n. In other words, we will assume temporarily that there is a uniform
distribution of search keys. Any given sequence of hash values (h1, . . . , hn)
denes m lists that contain respectively (n1, n2, . . . , nm) entries for some
numbers nj, where
n1 + n2 + ¬∑ ¬∑ ¬∑ + nm = n .
A successful search in which each of the n keys in the table is equally likely
will have an average running time of
A(h1, . . . , hn) = (1+ ¬∑ ¬∑ ¬∑ +n1) + (1+ ¬∑ ¬∑ ¬∑ +n2) + ¬∑ ¬∑ ¬∑ + (1+ ¬∑ ¬∑ ¬∑ +nm)
n
= n1(n1+1) + n2(n2+1) + ¬∑ ¬∑ ¬∑ + nm(nm+1)
2n
= n2
1 + n2
2 + ¬∑ ¬∑ ¬∑ + n2
m + n
2n
probes. Our goal is to calculate the variance of this quantity A(h1, . . . , hn),
over the probability space consisting of all mn sequences (h1, . . . , hn).
The calculations will be simpler, it turns out, if we compute the variance
of a slightly dierent quantity,
B(h1, . . . , hn) =
¬µn1
2
¬∂
+
¬µn2
2
¬∂
+ ¬∑ ¬∑ ¬∑ +
¬µnm
2
¬∂
.
We have
A(h1, . . . , hn) = 1 + B(h1, . . . , hn)/n ,
hence the mean and variance of A satisfy
EA = 1 + EB
n ;
VA = VB
n2 .
(8.100)

8.5 HASHING 421
The probability that the list sizes will be n1, n2, . . . , nm is the multinomial
coecient
¬µ
n
n1, n2, . . . , nm
¬∂
=
n!
n1! n2! . . . nm!
divided by mn; hence the pgf for B(h1, . . . , hn) is
Bn(z) =
X
n1,n2,...,nm0
n1+n2+¬∑¬∑¬∑+nm=n
¬µ
n
n1, n2, . . . , nm
¬∂
z(
n1
2 )+(
n2
2 )+¬∑¬∑¬∑+(
nm
2 ) m‚àín .
This sum looks a bit scary to inexperienced eyes, but our experiences in
Chapter 7 have taught us to recognize it as an m-fold convolution. Indeed, if
we consider the exponential super-generating function
G(w, z) =
X
n0
Bn(z)mnwn
n!
,
we can readily verify that G(w, z) is simply an mth power:
G(w, z) =
¬µX
k0
z(
k
2) wk
k!
¬∂m
.
As a check, we can try setting z = 1; we get G(w, 1) = (ew)m, so the coecient
of mnwn/n! is Bn(1) = 1.
If we knew the values of B‚Ä≤
n(1) and B‚Ä≤‚Ä≤
n(1), we would be able to calculate
Var(Bn). So we take partial derivatives of G(w, z) with respect to z:
‚àÇ
‚àÇzG(w, z) =
X
n0
B‚Ä≤
n(z)mnwn
n!
= m
¬µX
k0
z(
k
2) wk
k!
¬∂m‚àí1 X
k0
¬µk
2
¬∂
z(
k
2)‚àí1 wk
k! ;
‚àÇ2
‚àÇz2 G(w, z) =
X
n0
B‚Ä≤‚Ä≤
n(z)mnwn
n!
= m(m‚àí1)
¬µX
k0
z(
k
2) wk
k!
¬∂m‚àí2¬µX
k0
¬µk
2
¬∂
z(
k
2)‚àí1 wk
k!
¬∂2
+ m
¬µX
k0
z(
k
2) wk
k!
¬∂m‚àí1 X
k0
¬µk
2
¬∂¬µ¬µk
2
¬∂
‚àí1
¬∂
z(
k
2)‚àí2 wk
k! .

422 DISCRETE PROBABILITY
Complicated, yes; but everything simplies greatly when we set z = 1. For
example, we have
X
n0
B‚Ä≤
n(1)mnwn
n!
= me(m‚àí1)w X
k2
wk
2(k ‚àí2)!
= me(m‚àí1)w X
k0
wk+2
2k!
= mw2e(m‚àí1)w
2
ew =
X
n0
(mw)n+2
2m n!
=
X
n0
n(n‚àí1)mnwn
2m n!
,
and it follows that
B‚Ä≤
n(1) =
¬µn
2
¬∂ 1
m .
(8.101)
The expression for EA in (8.100) now gives EA = 1+(n‚àí1)/2m, in agreement
with (8.97).
The formula for B‚Ä≤‚Ä≤
n(1) involves the similar sum
X
k0
¬µk
2
¬∂¬µ¬µk
2
¬∂
‚àí1
¬∂wk
k!
= 1
4
X
k0
(k + 1)k(k ‚àí1)(k ‚àí2)wk
k!
= 1
4
X
k3
(k + 1)wk
(k ‚àí3)!
= 1
4
X
k0
(k + 4)wk+3
k!
=
¬° 1
4w4 + w3¬¢
ew ;
hence we nd that
X
n0
B‚Ä≤‚Ä≤
n(1)mnwn
n!
= m(m‚àí1)ew(m‚àí2)¬° 1
2w2ew¬¢2+mew(m‚àí1)¬° 1
4w4+w3¬¢
ew
= mewm¬° 1
4mw4 + w3¬¢
;
B‚Ä≤‚Ä≤
n(1) =
¬µn
2
¬∂¬µ¬µn
2
¬∂
‚àí1
¬∂ 1
m2 .
(8.102)
Now we can put all the pieces together and evaluate the desired variance VA.
Massive cancellation occurs, and the result is surprisingly simple:
VA = VB
n2
= B‚Ä≤‚Ä≤
n(1) + B‚Ä≤
n(1) ‚àíB‚Ä≤
n(1)2
n2
= n(n ‚àí1)
m2n2
¬µ(n + 1)(n ‚àí2)
4
+ m
2 ‚àín(n ‚àí1)
4
¬∂
= (m ‚àí1)(n ‚àí1)
2m2n
.
(8.103)

8.5 HASHING 423
When such \coincidences" occur, we suspect that there's a mathematical
reason; there might be another way to attack the problem, explaining why
the answer has such a simple form. And indeed, there is another approach (in
exercise 61), which shows that the variance of the average successful search
has the general form
VA = m ‚àí1
m2
n
X
k=1
s2
k(k ‚àí1)
(8.104)
when sk is the probability that the kth-inserted element is being sought.
Equation (8.103) is the special case sk = 1/n for 1  k  n.
Besides the variance of the average, we might also consider the average of
the variance. In other words, each sequence (h1, . . . , hn) that denes a hash
table also denes a probability distribution for successful searching, and the
variance of this probability distribution tells how spread out the number of
probes will be in dierent successful searches. For example, let's go back to
the case where we inserted n = 16 things into m = 10 lists:
Where have I seen
that pattern before?
Where have I seen
that grato before?
IŒ∑ŒΩPœÄ .
(h1, . . . , h16) = 3 1 4 1 5 9 2 6 5 3 5 8 9 7 9 3
(P1, . . . , P16) = 1 1 1 2 1 1 1 1 2 2 3 1 2 1 3 3
A successful search in the resulting hash table has the pgf
G(3, 1, 4, 1, . . . , 3) =
16
X
k=1
skzP(3,1,4,1,...,3;k)
= s1z + s2z + s3z + s4z2 + ¬∑ ¬∑ ¬∑ + s16z3 .
We have just considered the average number of probes in a successful search
of this table, namely A(3, 1, 4, 1, . . . , 3) = Mean
¬°
G(3, 1, 4, 1, . . . , 3)
¬¢
. We can
also consider the variance,
s1 ¬∑12 + s2 ¬∑12 + s3 ¬∑12 + s4 ¬∑22 + ¬∑ ¬∑ ¬∑ + s16 ¬∑32
‚àí(s1 ¬∑1 + s2 ¬∑1 + s3 ¬∑1 + s4 ¬∑2 + ¬∑ ¬∑ ¬∑ + s16 ¬∑3)2 .
This variance is a random variable, depending on (h1, . . . , hn), so it is natural
to consider its average value.
In other words, there are three natural kinds of variance that we may
wish to know, in order to understand the behavior of a successful search: The
overall variance of the number of probes, taken over all (h1, . . . , hn) and k;
the variance of the average number of probes, where the average is taken
over all k and the variance is then taken over all (h1, . . . , hn); and the average
of the variance of the number of the probes, where the variance is taken over

424 DISCRETE PROBABILITY
all k and the average is then taken over all (h1, . . . , hn). In symbols, the
overall variance is
VP =
X
1h1,...,hnm
n
X
k=1
sk
mn P(h1, . . . , hn; k)2
‚àí
¬µ
X
1h1,...,hnm
n
X
k=1
sk
mn P(h1, . . . , hn; k)
¬∂2
;
the variance of the average is
VA =
X
1h1,...,hnm
1
mn
¬µ n
X
k=1
skP(h1, . . . , hn; k)
¬∂2
‚àí
¬µ
X
1h1,...,hnm
1
mn
n
X
k=1
skP(h1, . . . , hn; k)
¬∂2
;
and the average of the variance is
AV =
X
1h1,...,hnm
1
mn
√É n
X
k=1
skP(h1, . . . , hn; k)2
‚àí
¬µ n
X
k=1
skP(h1, . . . , hn; k)
¬∂2!
.
It turns out that these three quantities are interrelated in a simple way:
VP = VA + AV .
(8.105)
In fact, conditional probability distributions always satisfy the identity
VX = V
¬°
E(XjY)
¬¢
+ E
¬°
V(XjY)
¬¢
(8.106)
if X and Y are random variables in any probability space and if X takes real
values.
(This identity is proved in exercise 22.)
Equation (8.105) is the
special case where X is the number of probes in a successful search and Y is
the sequence of hash values (h1, . . . , hn).
The general equation (8.106) needs to be understood carefully, because
the notation tends to conceal the dierent random variables and probability
spaces in which expectations and variances are being calculated. For each y
in the range of Y, we have dened the random variable Xjy in (8.91), and this
random variable has an expected value E(Xjy) depending on y. Now E(XjY)
denotes the random variable whose values are E(Xjy) as y ranges over all

8.5 HASHING 425
possible values of Y, and V
¬°
E(XjY)
¬¢
is the variance of this random variable
with respect to the probability distribution of Y. Similarly, E
¬°
V(XjY)
¬¢
is the
(Now is a good
time to do warmup
exercise 6.)
average of the random variables V(Xjy) as y varies. On the left of (8.106)
is VX, the unconditional variance of X. Since variances are nonnegative, we
always have
VX  V
¬°
E(XjY)
¬¢
and
VX  E
¬°
V(XjY)
¬¢
.
(8.107)
Case 1, again: Unsuccessful search revisited.
Let's bring our microscopic examination of hashing to a close by doing one
more calculation typical of algorithmic analysis. This time we'll look more
closely at the total running time associated with an unsuccessful search,
assuming that the computer will insert the previously unknown key into its
memory.
The insertion process in (8.83) has two cases, depending on whether j is
negative or zero. We have j < 0 if and only if P = 0, since a negative value
P is still the num-
ber of probes.
comes from the FIRST entry of an empty list. Thus, if the list was previously
empty, we have P = 0 and we must set FIRST[hn+1] := n + 1. (The new
record will be inserted into position n + 1.) Otherwise we have P > 0 and we
must set a LINK entry to n + 1. These two cases may take dierent amounts
of time; therefore the total running time for an unsuccessful search has the
form
T = Œ± + Œ≤P + Œ¥[P = 0] ,
(8.108)
where Œ±, Œ≤, and Œ¥ are constants that depend on the computer being used and
on the way in which hashing is encoded in that machine's internal language.
It would be nice to know the mean and variance of T, since such information
is more relevant in practice than the mean and variance of P.
So far we have used probability generating functions only in connection
with random variables that take nonnegative integer values. But it turns out
that we can deal in essentially the same way with
GX(z) =
X
œâ‚àà‚Ñ¶
Pr(œâ)zX(œâ)
when X is any real-valued random variable, because the essential characteris-
tics of X depend only on the behavior of GX near z = 1, where powers of z are
well dened. For example, the running time (8.108) of an unsuccessful search
is a random variable, dened on the probability space of equally likely hash
values (h1, . . . , hn, hn+1) with 1  hj  m; we can consider the series
GT(z) =
1
mn+1
m
X
h1=1
¬∑ ¬∑ ¬∑
m
X
hn=1
m
X
hn+1=1
zŒ±+Œ≤P(h1,...,hn+1)+Œ¥[P(h1,...,hn+1)=0]

426 DISCRETE PROBABILITY
to be a pgf even when Œ±, Œ≤, and Œ¥ are not integers. (In fact, the parameters
Œ±, Œ≤, Œ¥ are physical quantities that have dimensions of time; they aren't even
pure numbers!
Yet we can use them in the exponent of z.)
We can still
calculate the mean and variance of T, by evaluating G‚Ä≤
T(1) and G‚Ä≤‚Ä≤
T (1) and
combining these values in the usual way.
The generating function for P instead of T is
P(z) =
¬≥m ‚àí1 + z
m
¬¥n
=
X
p0
Pr(P = p)zp .
Therefore we have
GT(z) =
X
p0
Pr(P = p)zŒ±+Œ≤p+Œ¥[p=0]
= zŒ±¬≥
(zŒ¥ ‚àí1) Pr(P = 0) +
X
p0
Pr(P = p)zŒ≤p¬¥
= zŒ±
¬µ
(zŒ¥ ‚àí1)
¬≥m ‚àí1
m
¬¥n
+
¬≥m ‚àí1 + zŒ≤
m
¬¥n¬∂
.
The determination of Mean(GT) and Var(GT) is now routine:
Mean(GT) = G‚Ä≤
T(1) = Œ± + Œ≤ n
m + Œ¥
¬≥m ‚àí1
m
¬¥n
;
(8.109)
G‚Ä≤‚Ä≤
T (1) = Œ±(Œ± ‚àí1) + 2Œ±Œ≤ n
m + Œ≤(Œ≤ ‚àí1) n
m + Œ≤2 n(n ‚àí1)
m2
+ 2Œ±Œ¥
¬≥m ‚àí1
m
¬¥n
+ Œ¥(Œ¥ ‚àí1)
¬≥m ‚àí1
m
¬¥n
;
Var(GT) = G‚Ä≤‚Ä≤
T (1) + G‚Ä≤
T(1) ‚àíG‚Ä≤
T(1)2
= Œ≤2 n(m ‚àí1)
m2
‚àí2Œ≤Œ¥
¬≥m ‚àí1
m
¬¥n n
m
+ Œ¥2
¬µ¬≥m ‚àí1
m
¬¥n
‚àí
¬≥m ‚àí1
m
¬¥2n¬∂
.
(8.110)
In Chapter 9 we will learn how to estimate quantities like this when
m and n are large.
If, for example, m = n and n ‚Üí‚àû, the techniques
of Chapter 9 will show that the mean and variance of T are respectively
Œ± + Œ≤ + Œ¥e‚àí1 + O(n‚àí1) and Œ≤2 ‚àí2Œ≤Œ¥e‚àí1 + Œ¥2(e‚àí1 ‚àíe‚àí2) + O(n‚àí1).
If
m = n/ln n and n ‚Üí‚àûthe corresponding results are
Mean(GT) = Œ≤ ln n + Œ± + Œ¥/n + O
¬°
(log n)2/n2¬¢
;
Var(GT) = Œ≤2 ln n ‚àí
¬°
(Œ≤ ln n)2 + 2Œ≤Œ¥ ln n ‚àíŒ¥2¬¢
/n + O
¬°
(log n)3/n2¬¢
.

8 EXERCISES 427
Exercises
Warmups
1
What's the probability of doubles in the probability distribution Pr01
of (8.3), when one die is fair and the other is loaded? What's the proba-
bility that S = 7 is rolled?
2
What's the probability that the top and bottom cards of a randomly shuf-
ed deck are both aces? (All 52! permutations have probability 1/52!.)
3
Stanford's Concrete Math students were asked in 1979 to ip coins until
they got heads twice in succession, and to report the number of ips
Why only ten
numbers?
The other students
either weren't
empiricists or
they were just too
ipped out.
required. The answers were
3, 2, 3, 5, 10, 2, 6, 6, 9, 2 .
Princeton's Concrete Math students were asked in 1987 to do a similar
thing, with the following results:
10, 2, 10, 7, 5, 2, 10, 6, 10, 2 .
Estimate the mean and variance, based on (a) the Stanford sample;
(b) the Princeton sample.
4
Let H(z) = F(z)/G(z), where F(1) = G(1) = 1. Prove that
Mean(H) = Mean(F) ‚àíMean(G) ,
Var(H) = Var(F) ‚àíVar(G) ,
in analogy with (8.38) and (8.39), if the indicated derivatives exist at
z = 1.
5
Suppose Alice and Bill play the game (8.78) with a biased coin that comes
up heads with probability p. Is there a value of p for which the game
becomes fair?
6
What does the conditional variance law (8.106) reduce to, when X and Y
are independent random variables?
Basics
7
Show that if two dice are loaded with the same probability distribution,
the probability of doubles is always at least 1
6.
8
Let A and B be events such that A ‚à™B = ‚Ñ¶. Prove that
Pr(œâ ‚ààA ‚à©B) = Pr(œâ ‚ààA) Pr(œâ ‚ààB) ‚àíPr(œâ /‚ààA) Pr(œâ /‚ààB) .
9
Prove or disprove: If X and Y are independent random variables, then so
are F(X) and G(Y), when F and G are any functions.

428 DISCRETE PROBABILITY
10
What's the maximum number of elements that can be medians of a ran-
dom variable X, according to denition (8.7)?
11
Construct a random variable that has nite mean and innite variance.
12
a
If P(z) is the pgf for the random variable X, prove that
Pr(X  r)  x‚àírP(x)
for 0 < x  1;
Pr(X  r)  x‚àírP(x)
for x  1.
(These important relations are called the tail inequalities.)
b
In the special case P(z) = (1 + z)n/2n, use the rst tail inequality to
prove that P
kŒ±n
¬°n
k
¬¢
 1/Œ±Œ±n(1 ‚àíŒ±)(1‚àíŒ±)n when 0 < Œ± < 1
2.
13
If X1, . . . , X2n are independent random variables with the same distri-
bution, and if Œ± is any real number whatsoever, prove that
Pr
¬µ¬Ø¬Ø¬ØX1 + ¬∑ ¬∑ ¬∑ + X2n
2n
‚àíŒ±
¬Ø¬Ø¬Ø 
¬Ø¬Ø¬ØX1 + ¬∑ ¬∑ ¬∑ + Xn
n
‚àíŒ±
¬Ø¬Ø¬Ø
¬∂

1
2 .
14
Let F(z) and G(z) be probability generating functions, and let
H(z) = p F(z) + q G(z)
where p + q = 1. (This is called a mixture of F and G; it corresponds to
ipping a coin and choosing probability distribution F or G depending on
whether the coin comes up heads or tails.) Find the mean and variance
of H in terms of p, q, and the mean and variance of F and G.
15
If F(z) and G(z) are probability generating functions, we can dene an-
other pgf H(z) by \composition":
H(z) = F
¬°
G(z)
¬¢
.
Express Mean(H) and Var(H) in terms of Mean(F), Var(F), Mean(G),
and Var(G). (Equation (8.93) is a special case.)
16
Find a closed form for the super generating function P
n0 Fn(z)wn,
when Fn(z) is the football-xation generating function dened in (8.53).
17
Let Xn,p and Yn,p have the binomial and negative binomial distributions,
respectively, with parameters (n, p). (These distributions are dened in
(8.57) and (8.60).) Prove that Pr(Yn,p  m) = Pr(Xm+n,p  n). What
identity in binomial coecients does this imply?
18
A random variable X is said to have the Poisson distribution with
The distribution of
sh per unit volume
of water.
mean ¬µ if Pr(X = k) = e‚àí¬µ¬µk/k! for all k  0.
a
What is the pgf of such a random variable?
b
What are its mean, variance, and other cumulants?

8 EXERCISES 429
19
Continuing the previous exercise, let X1 be a random Poisson variable
with mean ¬µ1, and let X2 be a random Poisson variable with mean ¬µ2,
independent of X1.
a
What is the probability that X1 + X2 = n?
b
What are the mean, variance, and other cumulants of 2X1 + 3X2?
20
Prove (8.74) and (8.75), the general formulas for mean and variance of
the time needed to wait for a given pattern of heads and tails.
21
What does the value of N represent, if H and T are both set equal to 1
2
in (8.77)?
22
Prove (8.106), the law of conditional expectations and variances.
Homework exercises
23
Let Pr00 be the probability distribution of two fair dice, and let Pr11 be
the probability distribution of two loaded dice as given in (8.2). Find all
events A such that Pr00(A) = Pr11(A). Which of these events depend
only on the random variable S? (A probability space with ‚Ñ¶= D2 has
236 events; only 211 of those events depend on S alone.)
24
Player J rolls 2n+1 fair dice and removes those that come up qqq qqq . Player
K then calls a number between 1 and 6, rolls the remaining dice, and
removes those that show the number called. This process is repeated
until no dice remain. The player who has removed the most total dice
(n + 1 or more) is the winner.
a
What are the mean and variance of the total number of dice that
J removes? Hint: The dice are independent.
b
What's the probability that J wins, when n = 2?
25
Consider a gambling game in which you stake a given amount A and you
roll a fair die. If k spots turn up, you multiply your stake by 2(k ‚àí1)/5.
(In particular, you double the stake whenever you roll qqq qqq , but you lose
everything if you roll
q .) You can stop at any time and reclaim the
current stake. What are the mean and variance of your stake after n rolls?
(Ignore any eects of rounding to integer amounts of currency.)
26
Find the mean and variance of the number of l-cycles in a random permu-
tation of n elements. (The football victory problem discussed in (8.23),
(8.24), and (8.53) is the special case l = 1.)
27
Let X1, X2, . . . , Xn be independent samples of the random variable X.
Equations (8.19) and (8.20) explain how to estimate the mean and vari-
ance of X on the basis of these observations; give an analogous formula
for estimating the third cumulant Œ∫3. (Your formula should be an \un-
biased" estimate, in the sense that its expected value should be Œ∫3.)

430 DISCRETE PROBABILITY
28
What is the average length of the coin-ipping game (8.78),
a
given that Alice wins?
b
given that Bill wins?
29
Alice, Bill, and Computer ip a fair coin until one of the respective
patterns A = HHTH, B = HTHH, or C = THHH appears for the rst time.
(If only two of these patterns were involved, we know from (8.82) that A
would probably beat B, that B would probably beat C, and that C would
probably beat A; but all three patterns are simultaneously in the game.)
What are each player's chances of winning?
30
The text considers three kinds of variances associated with successful
search in a hash table. Actually there are two more: We can consider the
average (over k) of the variances (over h1, . . . , hn) of P(h1, . . . , hn; k);
and we can consider the variance (over k) of the averages (over h1,
. . . , hn). Evaluate these quantities.
31
An apple is located at vertex A of pentagon ABCDE, and a worm is
located two vertices away, at C. Every day the worm crawls with equal
probability to one of the two adjacent vertices. Thus after one day the
Schrodinger's worm.
worm is at vertex B or vertex D, each with probability
1
2. After two
days, the worm might be back at C again, because it has no memory of
previous positions. When it reaches vertex A, it stops to dine.
a
What are the mean and variance of the number of days until dinner?
b
Let p be the probability that the number of days is 100 or more.
What does Chebyshev's inequality say about p?
c
What do the tail inequalities (exercise 12) tell us about p?
32
Alice and Bill are in the military, stationed in one of the ve states
Kansas, Nebraska, Missouri, Oklahoma, or Colorado. Initially Alice is in
Nebraska and Bill is in Oklahoma. Every month each person is reassigned
to an adjacent state, each adjacent state being equally likely. (Here's a
diagram of the adjacencies:
r
r
r
r
r
h
h
bbbbb
"""""
bbbbb
"""""
Kansas
Nebraska
Missouri
Oklahoma
Colorado
The initial states are circled.) For example, Alice is restationed after the
Denitely a nite-
state situation.
rst month to Colorado, Kansas, or Missouri, each with probability 1/3.
Find the mean and variance of the number of months it takes Alice and
Bill to nd each other. (You may wish to enlist a computer's help.)

8 EXERCISES 431
33
Are the random variables X1 and X2 in (8.89) independent?
34
Gina is a golfer who has probability p = .05 on each stroke of making a
\supershot" that gains a stroke over par, probability q = .91 of making
an ordinary shot, and probability r = .04 of making a \subshot" that
costs her a stroke with respect to par. (Non-golfers: At each turn she
advances 2, 1, or 0 steps toward her goal, with probability p, q, or r,
respectively. On a par-m hole, her score is the minimum n such that she
has advanced m or more steps after taking n turns. A low score is better
than a high score.)
(Use a calculator for
the numerical work
on this problem.)
a
Show that Gina wins a par-4 hole more often than she loses, when
she plays against a player who shoots par.
(In other words, the
probability that her score is less than 4 is greater than the probability
that her score is greater than 4.)
b
Show that her average score on a par-4 hole is greater than 4. (There-
fore she tends to lose against a \steady" player on total points, al-
though she would tend to win in match play by holes.)
Exam problems
35
A die has been loaded with the probability distribution
Pr( q ) = p1 ;
Pr( q q ) = p2 ;
. . . ;
Pr( qqq qqq ) = p6 .
Let Sn be the sum of the spots after this die has been rolled n times. Find
a necessary and sucient condition on the \loading distribution" such
that the two random variables Sn mod 2 and Sn mod 3 are independent
of each other, for all n.
36
The six faces of a certain die contain the spot patterns
q
qqq
q qq q
qqqq q
qqq qqq
qqq qqqqq
instead of the usual
q through qqq qqq .
a
Show that there is a way to assign spots to the six faces of another
die so that, when these two dice are thrown, the sum of spots has the
same probability distribution as the sum of spots on two ordinary
dice. (Assume that all 36 face pairs are equally likely.)
b
Generalizing, nd all ways to assign spots to the 6n faces of n dice so
that the distribution of spot sums will be the same as the distribution
of spot sums on n ordinary dice. (Each face should receive a positive
integer number of spots.)
37
Let pn be the probability that exactly n tosses of a fair coin are needed
before heads are seen twice in a row, and let qn = P
kn pk. Find closed
forms for both pn and qn in terms of Fibonacci numbers.

432 DISCRETE PROBABILITY
38
What is the probability generating function for the number of times you
need to roll a fair die until all six faces have turned up? Generalize to
m-sided fair dice: Give closed forms for the mean and variance of the
number of rolls needed to see l of the m faces. What is the probability
that this number will be exactly n?
39
A Dirichlet probability generating function has the form
P(z) =
X
n1
pn
nz .
Thus P(0) = 1. If X is a random variable with Pr(X = n) = pn, express
E(X), V(X), and E(ln X) in terms of P(z) and its derivatives.
40
The mth cumulant Œ∫m of the binomial distribution (8.57) has the form
nfm(p), where fm is a polynomial of degree m. (For example, f1(p) = p
and f2(p) = p ‚àíp2, because the mean and variance are np and npq.)
a
Find a closed form for the coecient of pk in fm(p).
b
Prove that fm( 1
2) = (2m ‚àí1)Bm/m + [m = 1], where Bm is the mth
Bernoulli number.
41
Let the random variable Xn be the number of ips of a fair coin un-
til heads have turned up a total of n times.
Show that E(X‚àí1
n+1) =
(‚àí1)n(ln 2 + H‚åän/2‚åã‚àíHn). Use the methods of Chapter 9 to estimate
this value with an absolute error of O(n‚àí3).
42
A certain man has a problem nding work.
If he is unemployed on
any given morning, there's constant probability ph (independent of past
history) that he will be hired before that evening; but if he's got a job
when the day begins, there's constant probability pf that he'll be laid
Does TEX choose
optimal line breaks?
o by nightfall. Find the average number of evenings on which he will
have a job lined up, assuming that he is initially employed and that this
process goes on for n days. (For example, if n = 1 the answer is 1 ‚àípf.)
43
Find a closed form for the pgf Gn(z) = P
k0 pk,nzk, where pk,n is the
probability that a random permutation of n objects has exactly k cycles.
What are the mean and standard deviation of the number of cycles?
44
The athletic department runs an intramural \knockout tournament" for
2n tennis players as follows. In the rst round, the players are paired o
randomly, with each pairing equally likely, and 2n‚àí1 matches are played.
The winners advance to the second round, where the same process pro-
duces 2n‚àí2 winners. And so on; the kth round has 2n‚àík randomly chosen
matches between the 2n‚àík+1 players who are still undefeated. The nth
round produces the champion. Unbeknownst to the tournament organiz-
ers, there is actually an ordering among the players, so that x1 is best, x2

8 EXERCISES 433
is second best, . . . , x2n is worst. When xj plays xk and j < k, the winner
is xj with probability p and xk with probability 1 ‚àíp, independent of
A peculiar set of
tennis players.
the other matches. We assume that the same probability p applies to all
j and k.
a
What's the probability that x1 wins the tournament?
b
What's the probability that the nth round (the nal match) is be-
tween the top two players, x1 and x2?
c
What's the probability that the best 2k players are the competitors
in the kth-to-last round? (The previous questions were the cases
k = 0 and k = 1.)
d
Let N(n) be the number of essentially dierent tournament results;
two tournaments are essentially the same if the matches take place
between the same players and have the same winners. Prove that
N(n) = 2n!.
e
What's the probability that x2 wins the tournament?
f
Prove that if
1
2 < p < 1, the probability that xj wins is strictly
greater than the probability that xj+1 wins, for 1  j < 2n.
45
True sherry is made in Spain according to a multistage system called
\Solera." For simplicity we'll assume that the winemaker has only three
barrels, called A, B, and C. Every year a third of the wine from barrel C
\A fast arithmetic
computation shows
that the sherry is
always at least three
years old. Taking
computation further
gives the vertigo."
|Revue du vin de
France (Nov 1984)
is bottled and replaced by wine from B; then B is topped o with a third
of the wine from A; nally A is topped o with new wine. Let A(z), B(z),
C(z) be probability generating functions, where the coecient of zn is
the fraction of n-year-old wine in the corresponding barrel just after the
transfers have been made.
a
Assume that the operation has been going on since time immemorial,
so that we have a steady state in which A(z), B(z), and C(z) are the
same at the beginning of each year.
Find closed forms for these
generating functions.
b
Find the mean and standard deviation of the age of the wine in each
barrel, under the same assumptions. What is the average age of the
sherry when it is bottled? How much of it is exactly 25 years old?
c
Now take the niteness of time into account: Suppose that all three
barrels contained new wine at the beginning of year 0. What is the
average age of the sherry that is bottled at the beginning of year n?
46
Stefan Banach used to carry two boxes of matches, each containing
n matches initially. Whenever he needed a light he chose a box at ran-
dom, each with probability 1
2, independent of his previous choices. After
taking out a match he'd put the box back in its pocket (even if the box
became empty | all famous mathematicians used to do this). When his
chosen box was empty he'd throw it away and reach for the other box.

434 DISCRETE PROBABILITY
a
Once he found that the other box was empty too. What's the prob-
ability that this occurs? (For n = 1 it happens half the time and
for n = 2 it happens 3/8 of the time.) To answer this part, nd a
closed form for the generating function P(w, z) = P
m,n pm,nwmzn,
where pm,n is the probability that, starting with m matches in one
box and n in the other, both boxes are empty when an empty box
is rst chosen. Then nd a closed form for pn,n.
b
Generalizing your answer to part (a), nd a closed form for the
probability that exactly k matches are in the other box when an
empty one is rst thrown away.
c
Find a closed form for the average number of matches in that other
And for the number
in the empty box.
box.
47
Some physicians, collaborating with some physicists, recently discovered
a pair of microbes that reproduce in a peculiar way. The male microbe,
called a diphage, has two receptors on its surface; the female microbe,
called a triphage, has three:
diphage: 

¬°
¬°
triphage:


receptor:
When a culture of diphages and triphages is irradiated with a psi-particle,
exactly one of the receptors on one of the phages absorbs the particle;
each receptor is equally likely. If it was a diphage receptor, that diphage
changes to a triphage; if it was a triphage receptor, that triphage splits
into two diphages. Thus if an experiment starts with one diphage, the
rst psi-particle changes it to a triphage, the second particle splits the
triphage into two diphages, and the third particle changes one of the
diphages to a triphage. The fourth particle hits either the diphage or
the triphage; then there are either two triphages (probability 2
5) or three
diphages (probability
3
5).
Find a closed form for the average number
of diphages present, if we begin with a single diphage and irradiate the
culture n times with single psi-particles.
48
Five people stand at the vertices of a pentagon, throwing frisbees to each
Or, if this pentagon
is in Arlington,
throwing missiles
at each other.
other.
r
r
r
r
r
f
f
l
l
ll
¬¢
¬¢
¬¢¬¢
A
A
AA
,
,
,,
AAK
¬¢¬¢
- 

8 EXERCISES 435
They have two frisbees, initially at adjacent vertices as shown. In each
time interval, each frisbee is thrown either to the left or to the right
(along an edge of the pentagon) with equal probability.
This process
continues until one person is the target of two frisbees simultaneously;
then the game stops. (All throws are independent of past history.)
Frisbee is a trade-
mark of Wham-O
Manufacturing
Company.
a
Find the mean and variance of the number of pairs of throws.
b
Find a closed form for the probability that the game lasts more than
100 steps, in terms of Fibonacci numbers.
49
Luke Snowwalker spends winter vacations at his mountain cabin. The
front porch has m pairs of boots and the back porch has n pairs. Every
time he goes for a walk he ips a (fair) coin to decide whether to leave
from the front porch or the back, and he puts on a pair of boots at that
porch and heads o.
There's a 50/50 chance that he returns to each
porch, independent of his starting point, and he leaves the boots at the
porch he returns to. Thus after one walk there will be m + [‚àí1, 0, or +1]
pairs on the front porch and n ‚àí[‚àí1, 0, or +1] pairs on the back porch.
If all the boots pile up on one porch and if he decides to leave from
the other, he goes without boots and gets frostbite, ending his vacation.
Assuming that he continues his walks until the bitter end, let PN(m, n) be
the probability that he completes exactly N nonfrostbitten trips, starting
with m pairs on the front porch and n on the back. Thus, if both m
and n are positive,
PN(m, n) =
1
4PN‚àí1(m ‚àí1, n + 1) + 1
2PN‚àí1(m, n)
+ 1
4PN‚àí1(m + 1, n ‚àí1) ;
this follows because this rst trip is either front/back, front/front, back/
back, or back/front, each with probability 1
4, and N ‚àí1 trips remain.
a
Complete the recurrence for PN(m, n) by nding formulas that hold
when m = 0 or n = 0. Use the recurrence to obtain equations that
hold among the probability generating functions
gm,n(z) =
X
N0
PN(m, n)zN .
b
Dierentiate your equations and set z = 1, thereby obtaining rela-
tions among the quantities g‚Ä≤
m,n(1). Solve these equations, thereby
determining the mean number of trips before frostbite.
c
Show that gm,n has a closed form if we substitute z = 1/cos2 Œ∏:
gm,n
¬≥
1
cos2 Œ∏
¬¥
= sin(2m + 1)Œ∏ + sin(2n + 1)Œ∏
sin(2m + 2n + 2)Œ∏
cos Œ∏ .

436 DISCRETE PROBABILITY
50
Consider the function
H(z) = 1 + 1 ‚àíz
2z
¬°
z ‚àí3 +
p
(1 ‚àíz)(9 ‚àíz)
¬¢
.
The purpose of this problem is to prove that H(z) = P
k0 hkzk is a
probability generating function, and to obtain some basic facts about it.
a
Let (1 ‚àíz)3/2(9 ‚àíz)1/2 = P
k0 ckzk. Prove that c0 = 3, c1 =
‚àí14/3, c2 = 37/27, and c3+l = 3 P
k
¬°l
k
¬¢¬°1/2
3+k
¬¢¬° 8
9
¬¢k+3 for all l  0.
Hint: Use the identity
(9 ‚àíz)1/2 = 3(1 ‚àíz)1/2¬°
1 + 8
9z/(1 ‚àíz)
¬¢1/2
and expand the last factor in powers of z/(1 ‚àíz).
b
Use part (a) and exercise 5.81 to show that the coecients of H(z)
are all positive.
c
Prove the amazing identity
s
9 ‚àíH(z)
1 ‚àíH(z) =
s
9 ‚àíz
1 ‚àíz + 2 .
d
What are the mean and variance of H?
51
The state lottery in El Dorado uses the payo distribution H dened
in the previous problem. Each lottery ticket costs 1 doubloon, and the
payo is k doubloons with probability hk. Your chance of winning with
each ticket is completely independent of your chance with other tickets;
in other words, winning or losing with one ticket does not aect your
probability of winning with any other ticket you might have purchased
in the same lottery.
a
Suppose you start with one doubloon and play this game. If you win
k doubloons, you buy k tickets in the second game; then you take
the total winnings in the second game and apply all of them to the
third; and so on. If none of your tickets is a winner, you're broke
and you have to stop gambling. Prove that the pgf of your current
holdings after n rounds of such play is
1 ‚àí
4
p
(9 ‚àíz)/(1 ‚àíz) + 2n ‚àí1
+
4
p
(9 ‚àíz)/(1 ‚àíz) + 2n + 1
.
b
Let gn be the probability that you lose all your money for the rst
time on the nth game, and let G(z) = g1z + g2z2 + ¬∑ ¬∑ ¬∑ .
Prove
that G(1) = 1. (This means that you're bound to lose sooner or
later, with probability 1, although you might have fun playing in
the meantime.) What are the mean and the variance of G?

8 EXERCISES 437
c
What is the average total number of tickets you buy, if you continue
to play until going broke?
d
What is the average number of games until you lose everything if
you start with two doubloons instead of just one?
A doubledoubloon.
Bonus problems
52
Show that the text's denitions of median and mode for random variables
correspond in some meaningful sense to the denitions of median and
mode for sequences, when the probability space is nite.
53
Prove or disprove: If X, Y, and Z are random variables with the property
that all three pairs (X, Y), (X, Z) and (Y, Z) are independent, then X + Y
is independent of Z.
54
Equation (8.20) proves that the average value of bVX is VX. What is the
variance of bVX?
55
A normal deck of playing cards contains 52 cards, four each with face
values in the set fA, 2, 3, 4, 5, 6, 7, 8, 9, 10, J, Q, Kg.
Let X and Y denote
the respective face values of the top and bottom cards, and consider the
following algorithm for shuing:
S1 Permute the deck randomly so that each arrangement occurs with
probability 1/52!.
S2 If X Ã∏= Y, ip a biased coin that comes up heads with probability p,
and go back to step S1 if heads turns up. Otherwise stop.
Each coin ip and each permutation is assumed to be independent of all
the other randomizations. What value of p will make X and Y indepen-
dent random variables after this procedure stops?
56
Generalize the frisbee problem of exercise 48 from a pentagon to an
m-gon. What are the mean and variance of the number of collision-free
throws in general, when the frisbees are initially at adjacent vertices?
Show that, if m is odd, the pgf for the number of throws can be written
as a product of coin-ipping distributions:
Gm(z) =
(m‚àí1)/2
Y
k=1
pkz
1 ‚àíqkz ,
where pk = sin2 (2k ‚àí1)œÄ
2m
,
qk = cos2 (2k ‚àí1)œÄ
2m
.
Hint: Try the substitution z = 1/cos2 Œ∏.
57
Prove that the Penney-ante pattern œÑ1œÑ2 . . . œÑl‚àí1œÑl is always inferior to
the pattern œÑ2œÑ1œÑ2 . . . œÑl‚àí1 when a fair coin is ipped, if l  3.

438 DISCRETE PROBABILITY
58
Is there any sequence A = œÑ1œÑ2 . . . œÑl‚àí1œÑl of l  3 heads and tails such
that the sequences HœÑ1œÑ2 . . . œÑl‚àí1 and TœÑ1œÑ2 . . . œÑl‚àí1 both perform equally
well against A in the game of Penney ante?
59
Are there patterns A and B of heads and tails such that A is longer
than B, yet A appears before B more than half the time when a fair coin
is being ipped?
60
Let k and n be xed positive integers with k < n.
a
Find a closed form for the probability generating function
G(w, z) =
1
mn
m
X
h1=1
¬∑ ¬∑ ¬∑
m
X
hn=1
wP(h1,...,hn;k)zP(h1,...,hn;n)
for the joint distribution of the numbers of probes needed to nd the
kth and nth items that have been inserted into a hash table with
m lists.
b
Although the random variables P(h1, . . . , hn; k) and P(h1, . . . , hn; n)
are dependent, show that they are somewhat independent:
E
¬°
P(h1, . . . , hn; k)P(h1, . . . , hn; n)
¬¢
=
¬°
EP(h1, . . . , hn; k)
¬¢¬°
EP(h1, . . . , hn; n)
¬¢
.
61
Use the result of the previous exercise to prove (8.104).
62
Continuing exercise 47, nd the variance of the number of diphages after
n irradiations.
Research problem
63
The normal distribution is a non-discrete probability distribution char-
acterized by having all its cumulants zero except the mean and the vari-
ance.
Is there an easy way to tell if a given sequence of cumulants
‚ü®Œ∫1, Œ∫2, Œ∫3, . . . ‚ü©comes from a discrete distribution? (All the probabilities
must be \atomic" in a discrete distribution.)

9
Asymptotics
EXACT ANSWERS are great when we can nd them; there's something
very satisfying about complete knowledge.
But there's also a time when
approximations are in order.
If we run into a sum or a recurrence whose
solution doesn't have a closed form (as far as we can tell), we still would like
to know something about the answer; we don't have to insist on all or nothing.
And even if we do have a closed form, our knowledge might be imperfect, since
we might not know how to compare it with other closed forms.
For example, there is (apparently) no closed form for the sum
Sn =
n
X
k=0
¬µ3n
k
¬∂
.
But it is nice to know that
Sn ‚àº2
¬µ3n
n
¬∂
,
as n ‚Üí‚àû;
we say that the sum is \asymptotic to" 2
¬°3n
n
¬¢
. It's even nicer to have more
Uh oh . . . here
comes that A-word.
detailed information, like
Sn =
¬µ3n
n
¬∂¬µ
2 ‚àí4
n + O
¬≥ 1
n2
¬¥¬∂
,
(9.1)
which gives us a \relative error of order 1/n2." But even this isn't enough to
tell us how big Sn is, compared with other quantities. Which is larger, Sn or
the Fibonacci number F4n? Answer: We have S2 = 22 > F8 = 21 when n = 2;
but F4n is eventually larger, because F4n ‚àºœÜ4n/
‚àö
5 and œÜ4 ‚âà6.8541, while
Sn =
r
3
œÄn(6.75)n
¬µ
1 ‚àí151
72n + O
¬≥ 1
n2
¬¥¬∂
.
(9.2)
Our goal in this chapter is to learn how to understand and to derive results
like this without great pain.
439

440 ASYMPTOTICS
The word asymptotic stems from a Greek root meaning \not falling
Other words like
`symptom' and
`ptomaine' also
come from this root.
together." When ancient Greek mathematicians studied conic sections, they
considered hyperbolas like the graph of y =
‚àö
1 + x2,
¬°
¬°
¬°
¬°
¬°
¬°
¬°
¬°¬°
@
@
@
@
@
@
@
@@
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
which has the lines y = x and y = ‚àíx as \asymptotes." The curve approaches
but never quite touches these asymptotes, when x ‚Üí‚àû. Nowadays we use
\asymptotic" in a broader sense to mean any approximate value that gets
closer and closer to the truth, when some parameter approaches a limiting
value. For us, asymptotics means \almost falling together."
Some asymptotic formulas are very dicult to derive, well beyond the
scope of this book. We will content ourselves with an introduction to the sub-
ject; we hope to acquire a suitable foundation on which further techniques can
be built. We will be particularly interested in understanding the denitions
of `‚àº' and `O' and similar symbols, and we'll study basic ways to manipulate
asymptotic quantities.
9.1
A HIERARCHY
Functions of n that occur in practice usually have dierent \asymp-
totic growth ratios"; one of them will approach innity faster than another.
We formalize this by saying that
f(n) ‚â∫g(n)
‚áê‚áí
lim
n‚Üí‚àû
f(n)
g(n) = 0 .
(9.3)
This relation is transitive: If f(n) ‚â∫g(n) and g(n) ‚â∫h(n) then f(n) ‚â∫h(n).
We also may write g(n) ‚âªf(n) if f(n) ‚â∫g(n). This notation was introduced
All functions
great and small.
in 1871 by Paul du Bois-Reymond [85].
For example, n ‚â∫n2; informally we say that n grows more slowly
than n2. In fact,
nŒ± ‚â∫nŒ≤
‚áê‚áí
Œ± < Œ≤ ,
(9.4)
when Œ± and Œ≤ are arbitrary real numbers.
There are, of course, many functions of n besides powers of n. We can
use the ‚â∫relation to rank lots of functions into an asymptotic pecking order

9.1 A HIERARCHY 441
that includes entries like this:
1 ‚â∫log log n ‚â∫log n ‚â∫nœµ ‚â∫nc ‚â∫nlog n ‚â∫cn ‚â∫nn ‚â∫ccn .
(Here œµ and c are arbitrary constants with 0 < œµ < 1 < c.)
All functions listed here, except 1, go to innity as n goes to innity.
Thus when we try to place a new function in this hierarchy, we're not trying
to determine whether it becomes innite but rather how fast.
It helps to cultivate an expansive attitude when we're doing asymptotic
analysis: We should think big, when imagining a variable that approaches
innity. For example, the hierarchy says that log n ‚â∫n0.0001; this might
seem wrong if we limit our horizons to teeny-tiny numbers like one googol,
n = 10100. For in that case, log n = 100, while n0.0001 is only 100.01 ‚âà1.0233.
But if we go up to a googolplex, n = 1010100, then log n = 10100 pales in
comparison with n0.0001 = 101096.
Even if œµ is extremely small (smaller than, say, 1/1010100), the value
of log n will be much smaller than the value of nœµ, if n is large enough. For
if we set n = 10102k, where k is so large that œµ  10‚àík, we have log n = 102k
but nœµ  1010k. The ratio (log n)/nœµ therefore approaches zero as n ‚Üí‚àû.
The hierarchy shown above deals with functions that go to innity. Often,
however, we're interested in functions that go to zero, so it's useful to have
a similar hierarchy for those functions.
We get one by taking reciprocals,
A loerarchy?
because when f(n) and g(n) are never zero we have
f(n) ‚â∫g(n)
‚áê‚áí
1
g(n) ‚â∫
1
f(n) .
(9.5)
Thus, for example, the following functions (except 1) all go to zero:
1
ccn ‚â∫
1
nn ‚â∫
1
cn ‚â∫
1
nlog n ‚â∫
1
nc ‚â∫
1
nœµ ‚â∫
1
log n ‚â∫
1
log log n ‚â∫1 .
Let's look at a few other functions to see where they t in. The number
œÄ(n) of primes less than or equal to n is known to be approximately n/ln n.
Since 1/nœµ ‚â∫1/ln n ‚â∫1, multiplying by n tells us that
n1‚àíœµ ‚â∫œÄ(n) ‚â∫n .
We can in fact generalize (9.4) by noticing, for example, that
nŒ±1(log n)Œ±2(log log n)Œ±3 ‚â∫nŒ≤1(log n)Œ≤2(log log n)Œ≤3
‚áê‚áí
(Œ±1, Œ±2, Œ±3) < (Œ≤1, Œ≤2, Œ≤3) .
(9.6)
Here `(Œ±1, Œ±2, Œ±3) < (Œ≤1, Œ≤2, Œ≤3)' means lexicographic order (dictionary or-
der); in other words, either Œ±1 < Œ≤1, or Œ±1 = Œ≤1 and Œ±2 < Œ≤2, or Œ±1 = Œ≤1
and Œ±2 = Œ≤2 and Œ±3 < Œ≤3.

442 ASYMPTOTICS
How about the function e
‚àö
log n; where does it live in the hierarchy? We
can answer questions like this by using the rule
ef(n) ‚â∫eg(n)
‚áê‚áí
lim
n‚Üí‚àû
¬°
f(n) ‚àíg(n)
¬¢
= ‚àí‚àû,
(9.7)
which follows in two steps from denition (9.3) by taking logarithms. Conse-
quently
1 ‚â∫f(n) ‚â∫g(n)
=‚áí
ejf(n)j ‚â∫ejg(n)j .
And since 1 ‚â∫log log n ‚â∫
p
log n ‚â∫œµ log n, we have log n ‚â∫e
‚àö
log n ‚â∫nœµ.
When two functions f(n) and g(n) have the same rate of growth, we
write `f(n) ‚âçg(n)'. The ocial denition is:
f(n) ‚âçg(n)
‚áê‚áí
¬Ø¬Øf(n)
¬Ø¬Ø  C
¬Ø¬Øg(n)
¬Ø¬Ø
and
¬Ø¬Øg(n)
¬Ø¬Ø  C
¬Ø¬Øf(n)
¬Ø¬Ø ,
for some C and for all suciently large n.
(9.8)
This holds, for example, if f(n) is constant and g(n) = cos n + arctan n. We
will prove shortly that it holds whenever f(n) and g(n) are polynomials of
the same degree. There's also a stronger relation, dened by the rule
f(n) ‚àºg(n)
‚áê‚áí
lim
n‚Üí‚àû
f(n)
g(n) = 1 .
(9.9)
In this case we say that \f(n) is asymptotic to g(n)."
G. H. Hardy [179] introduced an interesting and important concept called
the class of logarithmico-exponential functions, dened recursively as the
smallest family L of functions satisfying the following properties:
‚Ä¢
The constant function f(n) = Œ± is in L, for all real Œ±.
‚Ä¢
The identity function f(n) = n is in L.
‚Ä¢
If f(n) and g(n) are in L, so is f(n) ‚àíg(n).
‚Ä¢
If f(n) is in L, so is ef(n).
‚Ä¢
If f(n) is in L and is \eventually positive," then ln f(n) is in L.
A function f(n) is called \eventually positive" if there is an integer n0 such
that f(n) > 0 whenever n  n0.
We can use these rules to show, for example, that f(n) + g(n) is in L
whenever f(n) and g(n) are, because f(n) + g(n) = f(n) ‚àí
¬°
0 ‚àíg(n)
¬¢
. If f(n)
and g(n) are eventually positive members of L, their product f(n)g(n) =
e ln f(n)+ln g(n) and quotient f(n)/g(n) = e ln f(n)‚àíln g(n) are in L; so are func-
tions like
p
f(n) = e
1
2 ln f(n), etc.
Hardy proved that every logarithmico-
exponential function is eventually positive, eventually negative, or identically
zero.
Therefore the product and quotient of any two L-functions is in L,
except that we cannot divide by a function that's identically zero.

9.1 A HIERARCHY 443
Hardy's main theorem about logarithmico-exponential functions is that
they form an asymptotic hierarchy: If f(n) and g(n) are any functions in L,
then either f(n) ‚â∫g(n), or f(n) ‚âªg(n), or f(n) ‚âçg(n). In the last case
there is, in fact, a constant Œ± such that
f(n) ‚àºŒ± g(n) .
The proof of Hardy's theorem is beyond the scope of this book; but it's nice
to know that the theorem exists, because almost every function we ever need
to deal with is in L. In practice, we can generally t a given function into a
given hierarchy without great diculty.
9.2
O NOTATION
A wonderful notational convention for asymptotic analysis was in-
troduced by Paul Bachmann in 1894 and popularized in subsequent years by
Edmund Landau and others. We have seen it in formulas like
\. . . wir durch das
Zeichen O(n) eine
Groe ausdrucken,
deren Ordnung in
Bezug auf n die
Ordnung von n
nicht uberschreitet;
ob sie wirklich
Glieder von der
Ordnung n in sich
enthalt, bleibt bei
dem bisherigen
Schluverfahren
dahingestellt."
|P. Bachmann [17]
Hn = ln n + Œ≥ + O(1/n) ,
(9.10)
which tells us that the nth harmonic number is equal to the natural logarithm
of n plus Euler's constant, plus a quantity that is \Big Oh of 1 over n." This
last quantity isn't specied exactly; but whatever it is, the notation claims
that its absolute value is no more than a constant times 1/n.
The beauty of O-notation is that it suppresses unimportant detail and
lets us concentrate on salient features: The quantity O(1/n) is negligibly
small, if constant multiples of 1/n are unimportant.
Furthermore we get to use O right in the middle of a formula. If we want
to express (9.10) in terms of the notations in Section 9.1, we must transpose
`ln n + Œ≥' to the left side and specify a weaker result like
Hn ‚àíln n ‚àíŒ≥ ‚â∫log log n
n
or a stronger result like
Hn ‚àíln n ‚àíŒ≥ ‚âç1
n .
The Big Oh notation allows us to specify an appropriate amount of detail
in place, without transposition.
The idea of imprecisely specied quantities can be made clearer if we
consider some additional examples. We occasionally use the notation `¬±1' to
stand for something that is either +1 or ‚àí1; we don't know (or perhaps we
don't care) which it is, yet we can manipulate it in formulas.

444 ASYMPTOTICS
N. G. de Bruijn begins his book Asymptotic Methods in Analysis [74] by
considering a Big Ell notation that helps us understand Big Oh. If we write
L(5) for a number whose absolute value is less than 5 (but we don't say what
the number is), then we can perform certain calculations without knowing
the full truth. For example, we can deduce formulas such as 1 + L(5) = L(6);
L(2) + L(3) = L(5); L(2)L(3) = L(6); eL(5) = L(e5); and so on. But we cannot
conclude that L(5) ‚àíL(3) = L(2), since the left side might be 4 ‚àí0. In fact,
the most we can say is L(5) ‚àíL(3) = L(8).
Bachmann's O-notation is similar to L-notation but it's even less precise:
O(Œ±) stands for a number whose absolute value is at most a constant times jŒ±j.
We don't say what the number is and we don't even say what the constant is.
Of course the notion of a \constant" is nonsense if there is nothing variable
It's not nonsense,
but it is pointless.
in the picture, so we use O-notation only in contexts when there's at least
one quantity (say n) whose value is varying. The formula
f(n) = O
¬°
g(n)
¬¢
for all n
(9.11)
means in this context that there is a constant C such that
¬Ø¬Øf(n)
¬Ø¬Ø  C
¬Ø¬Øg(n)
¬Ø¬Ø
for all n;
(9.12)
and when O
¬°
g(n)
¬¢
stands in the middle of a formula it represents a function
f(n) that satises (9.12). The values of f(n) are unknown, but we do know
that they aren't too large.
Similarly, de Bruijn's `L(n)' represents an un-
specied function f(n) whose values satisfy
¬Ø¬Øf(n)
¬Ø¬Ø < jnj. The main dierence
between L and O is that O-notation involves an unspecied constant C; each
appearance of O might involve a dierent C, but each C is independent of n.
I've got a little
list|I've got a
little list,
Of annoying terms
and details that
might well be under
ground,
And that never
would be missed|
that never would be
missed.
For example, we know that the sum of the rst n squares is
n =
1
3n(n + 1
2)(n + 1) =
1
3n3 + 1
2n2 + 1
6n .
We can write
n = O(n3)
because j 1
3n3 + 1
2n2 + 1
6nj  1
3jnj3 + 1
2jnj2+ 1
6jnj  1
3jn3j+ 1
2jn3j+ 1
6jn3j = jn3j
for all integers n. Similarly, we have the more specic formula
n =
1
3n3 + O(n2) ;
we can also be sloppy and throw away information, saying that
n = O(n10) .
Nothing in the denition of O requires us to give a best possible bound.

9.2 O NOTATION 445
But wait a minute. What if the variable n isn't an integer? What if we
have a formula like S(x) = 1
3x3+ 1
2x2+ 1
6x, where x is a real number? Then we
cannot say that S(x) = O(x3), because the ratio S(x)/x3 = 1
3 + 1
2x‚àí1 + 1
6x‚àí2
becomes unbounded when x ‚Üí0. And we cannot say that S(x) = O(x),
because the ratio S(x)/x = 1
3x2 + 1
2x + 1
6 becomes unbounded when x ‚Üí‚àû.
So we apparently can't use O-notation with S(x).
The answer to this dilemma is that variables used with O are generally
subject to side conditions. For example, if we stipulate that jxj  1, or that
x  œµ where œµ is any positive constant, or that x is an integer, then we can
write S(x) = O(x3). If we stipulate that jxj  1, or that jxj  c where c is
any positive constant, then we can write S(x) = O(x). The O-notation is
governed by its environment, by constraints on the variables involved.
These constraints are often specied by a limiting relation. For example,
we might say that
f(n) = O
¬°
g(n)
¬¢
as n ‚Üí‚àû.
(9.13)
This means that the O-condition is supposed to hold when n is \near" ‚àû;
we don't care what happens unless n is quite large.
Moreover, we don't
even specify exactly what \near" means; in such cases each appearance of O
implicitly asserts the existence of two constants C and n0, such that
¬Ø¬Øf(n)
¬Ø¬Ø  C
¬Ø¬Øg(n)
¬Ø¬Ø
whenever n  n0.
(9.14)
The values of C and n0 might be dierent for each O, but they do not depend
on n. Similarly, the notation
You are the fairest
of your sex,
Let me be your
hero;
I love you as
one over x,
As x approaches
zero.
Positively.
f(x) = O
¬°
g(x)
¬¢
as x ‚Üí0
means that there exist two constants C and œµ such that
¬Ø¬Øf(x)
¬Ø¬Ø  C
¬Ø¬Øg(x)
¬Ø¬Ø
whenever jxj  œµ.
(9.15)
The limiting value does not have to be ‚àûor 0; we can write
ln z = z ‚àí1 + O
¬°
(z ‚àí1)2¬¢
as z ‚Üí1,
because it can be proved that j ln z ‚àíz + 1j  jz ‚àí1j2 when jz ‚àí1j  1
2.
Our denition of O has gradually developed, over a few pages, from some-
thing that seemed pretty obvious to something that seems rather complex; we
now have O representing an undened function and either one or two unspec-
ied constants, depending on the environment. This may seem complicated
enough for any reasonable notation, but it's still not the whole story! Another

446 ASYMPTOTICS
subtle consideration lurks in the background. Namely, we need to realize that
it's ne to write
1
3n3 + 1
2n2 + 1
6n = O(n3) ,
but we should never write this equality with the sides reversed. Otherwise
we could deduce ridiculous things like n = n2 from the identities n = O(n2)
and n2 = O(n2). When we work with O-notation and any other formulas
that involve imprecisely specied quantities, we are dealing with one-way
\And to auoide the
tediouse repetition
of these woordes:
is equalle to: I will
sette as I doe often
in woorke use, a
paire of paralleles,
or Gemowe lines of
one lengthe, thus:
==== , bicause
noe .2. thynges, can
be moare equalle."
|R. Recorde [305]
equalities. The right side of an equation does not give more information than
the left side, and it may give less; the right is a \crudication" of the left.
From a strictly formal point of view, the notation O
¬°
g(n)
¬¢
does not
stand for a single function f(n), but for the set of all functions f(n) such
that
¬Ø¬Øf(n)
¬Ø¬Ø  C
¬Ø¬Øg(n)
¬Ø¬Ø for some constant C. An ordinary formula g(n) that
doesn't involve O-notation stands for the set containing a single function
f(n) = g(n). If S and T are sets of functions of n, the notation S + T stands
for the set of all functions of the form f(n) + g(n), where f(n) ‚ààS and
g(n) ‚ààT; other notations like S‚àíT, ST, S/T,
‚àö
S, eS, ln S are dened similarly.
Then an \equation" between such sets of functions is, strictly speaking, a set
inclusion; the `=' sign really means `‚äÜ'. These formal denitions put all of
our O manipulations on rm logical ground.
For example, the \equation"
1
3n3 + O(n2) = O(n3)
means that S1 ‚äÜS2, where S1 is the set of all functions of the form 1
3n3+f1(n)
such that there exists a constant C1 with
¬Ø¬Øf1(n)
¬Ø¬Ø  C1jn2j, and where S2
is the set of all functions f2(n) such that there exists a constant C2 with
¬Ø¬Øf2(n)
¬Ø¬Ø  C2jn3j. We can formally prove this \equation" by taking an arbi-
trary element of the left-hand side and showing that it belongs to the right-
hand side: Given
1
3n3 + f1(n) such that
¬Ø¬Øf1(n)
¬Ø¬Ø  C1jn2j, we must prove
that there's a constant C2 such that j 1
3n3 + f1(n)j  C2jn3j. The constant
C2 = 1
3 + C1 does the trick, since n2  jn3j for all integers n.
If `=' really means `‚äÜ', why don't we use `‚äÜ' instead of abusing the equals
sign? There are four reasons.
First, tradition. Number theorists started using the equals sign with O-
notation and the practice stuck. It's suciently well established by now that
we cannot hope to get the mathematical community to change.
Second, tradition. Computer people are quite used to seeing equals signs
abused | for years FORTRAN and BASIC programmers have been writing
assignment statements like `N = N + 1'. One more abuse isn't much.
Third, tradition. We often read `=' as the word `is'. For instance we
verbalize the formula Hn = O(log n) by saying \H sub n is Big Oh of log n."

9.2 O NOTATION 447
And in English, this `is' is one-way. We say that a bird is an animal, but we
don't say that an animal is a bird; \animal" is a crudication of \bird."
Fourth, for our purposes it's natural. If we limited our use of O-notation
\It is obvious that
the sign = is really
the wrong sign
for such relations,
because it suggests
symmetry, and
there is no such
symmetry. . . .
Once this warning
has been given,
there is, however,
not much harm in
using the sign =,
and we shall main-
tain it, for no other
reason than that it
is customary."
|N.G.deBruijn[74]
to situations where it occupies the whole right side of a formula | as in the
harmonic number approximation Hn = O(log n), or as in the description of
a sorting algorithm's running time T(n) = O(n log n) | it wouldn't matter
whether we used `=' or something else. But when we use O-notation in the
middle of an expression, as we usually do in asymptotic calculations, our
intuition is well satised if we think of the equals sign as an equality, and if
we think of something like O(1/n) as a very small quantity.
So we'll continue to use `=', and we'll continue to regard O
¬°
g(n)
¬¢
as an
incompletely specied function, knowing that we can always fall back on the
set-theoretic denition if we must.
But we ought to mention one more technicality while we're picking nits
about denitions: If there are several variables in the environment, O-notation
formally represents sets of functions of two or more variables, not just one.
The domain of each function is every variable that is currently \free" to vary.
This concept can be a bit subtle, because a variable might be dened only
in parts of an expression, when it's controlled by a P or something similar.
For example, let's look closely at the equation
n
X
k=0
¬°
k2 + O(k)
¬¢
=
1
3n3 + O(n2) ,
integer n  0.
(9.16)
The expression k2 + O(k) on the left stands for the set of all two-variable
functions of the form k2 + f(k, n) such that there exists a constant C with
¬Ø¬Øf(k, n)
¬Ø¬Ø  Ck for 0  k  n. The sum of this set of functions, for 0  k  n,
is the set of all functions g(n) of the form
n
X
k=0
¬°
k2+f(k, n)
¬¢
=
1
3n3 + 1
2n2 + 1
6n + f(0, n) + f(1, n) + ¬∑ ¬∑ ¬∑ + f(n, n) ,
where f has the stated property. Since we have
¬Ø¬Ø 1
2n2 + 1
6n + f(0, n) + f(1, n) + ¬∑ ¬∑ ¬∑ + f(n, n)
¬Ø¬Ø

1
2n2 + 1
6n2 + C¬∑0 + C¬∑1 + ¬∑ ¬∑ ¬∑ + C¬∑n
< n2 + C(n2 + n)/2 < (C + 1)n2 ,
all such functions g(n) belong to the right-hand side of (9.16); therefore (9.16)
(Now is a good
time to do warmup
exercises 3 and 4.)
is true.
People sometimes abuse O-notation by assuming that it gives an exact
order of growth; they use it as if it species a lower bound as well as an
upper bound. For example, an algorithm to sort n numbers might be called

448 ASYMPTOTICS
inecient \because its running time is O(n2)." But a running time of O(n2)
does not imply that the running time is not also O(n).
There's another
notation, Big Omega, for lower bounds:
f(n) = ‚Ñ¶
¬°
g(n)
¬¢
‚áê‚áí
¬Ø¬Øf(n)
¬Ø¬Ø  C
¬Ø¬Øg(n)
¬Ø¬Ø
for some C > 0.
(9.17)
We have f(n) = ‚Ñ¶
¬°
g(n)
¬¢
if and only if g(n) = O
¬°
f(n)
¬¢
. A sorting algorithm
whose running time is ‚Ñ¶(n2) is inecient compared with one whose running
time is O(n log n), if n is large enough.
Finally there's Big Theta, which species an exact order of growth:
Since ‚Ñ¶and Œò are
uppercase Greek
letters, the O in
O-notation must
be a capital Greek
Omicron.
After all, Greeks in-
vented asymptotics.
f(n) = Œò
¬°
g(n)
¬¢
‚áê‚áí
f(n) = O
¬°
g(n)
¬¢
and
f(n) = ‚Ñ¶
¬°
g(n)
¬¢
.
(9.18)
We have f(n) = Œò
¬°
g(n)
¬¢
if and only if f(n) ‚âçg(n) in the notation we saw
previously, equation (9.8).
Edmund Landau [238] invented a \little oh" notation,
f(n) = o
¬°
g(n)
¬¢
‚áê‚áí
¬Ø¬Øf(n)
¬Ø¬Ø  œµ
¬Ø¬Øg(n)
¬Ø¬Ø
for all n  n0(œµ) and
for all constants œµ > 0.
(9.19)
This is essentially the relation f(n) ‚â∫g(n) of (9.3). We also have
f(n) ‚àºg(n)
‚áê‚áí
f(n) = g(n) + o
¬°
g(n)
¬¢
.
(9.20)
Many authors use `o' in asymptotic formulas, but a more explicit `O'
expression is almost always preferable.
For example, the average running
time of a computer method called \bubblesort" depends on the asymptotic
value of the sum P(n) = Pn
k=0 kn‚àík k!/n!. Elementary asymptotic methods
suce to prove the formula P(n) ‚àº
p
œÄn/2, which means that the ratio
P(n)/
p
œÄn/2 approaches 1 as n ‚Üí‚àû. However, the true behavior of P(n) is
best understood by considering the dierence, P(n) ‚àí
p
œÄn/2, not the ratio:
n
P(n)/
p
œÄn/2
P(n) ‚àí
p
œÄn/2
1
0.798
‚àí0.253
10
0.878
‚àí0.484
20
0.904
‚àí0.538
30
0.918
‚àí0.561
40
0.927
‚àí0.575
50
0.934
‚àí0.585
The numerical evidence in the middle column is not very compelling; it cer-
tainly is far from a dramatic proof that P(n)/
p
œÄn/2 approaches 1 rapidly,

9.2 O NOTATION 449
if at all. But the right-hand column shows that P(n) is very close indeed to
p
œÄn/2. Thus we can characterize the behavior of P(n) much better if we can
derive formulas of the form
P(n) =
p
œÄn/2 + O(1) ,
or even sharper estimates like
P(n) =
p
œÄn/2 ‚àí2
3 + O(1/‚àön ) .
Stronger methods of asymptotic analysis are needed to prove O-results, but
the additional eort required to learn these stronger methods is amply com-
pensated by the improved understanding that comes with O-bounds.
Moreover, many sorting algorithms have running times of the form
T(n) = A n lg n + B n + O(log n)
for some constants A and B. Analyses that stop at T(n) ‚àºA n lg n don't tell
the whole story, and it turns out to be a bad strategy to choose a sorting algo-
rithm based just on its A value. Algorithms with a good `A' often achieve this
at the expense of a bad `B'. Since n lg n grows only slightly faster than n, the
algorithm that's faster asymptotically (the one with a slightly smaller A value)
might be faster only for values of n that never actually arise in practice. Thus,
asymptotic methods that allow us to go past the rst term and evaluate B
are necessary if we are to make the right choice of method.
Before we go on to study O, let's talk about one more small aspect of
mathematical style. Three dierent notations for logarithms have been used
in this chapter: lg, ln, and log. We often use `lg' in connection with computer
Also lD, the Dura-
ame logarithm.
methods, because binary logarithms are often relevant in such cases; and
we often use `ln' in purely mathematical calculations, since the formulas for
natural logarithms are nice and simple.
But what about `log'?
Isn't this
the \common" base-10 logarithm that students learn in high school | the
\common" logarithm that turns out to be very uncommon in mathematics
and computer science?
Yes; and many mathematicians confuse the issue
by using `log' to stand for natural logarithms or binary logarithms. There
is no universal agreement here. But we can usually breathe a sigh of relief
when a logarithm appears inside O-notation, because O ignores multiplicative
constants. There is no dierence between O(lg n), O(ln n), and O(log n), as
n ‚Üí‚àû; similarly, there is no dierence between O(lg lg n), O(ln ln n), and
O(log log n). We get to choose whichever we please; and the one with `log'
Notice that
log log log n
is undened when
n  10.
seems friendlier because it is more pronounceable. Therefore we generally
use `log' in all contexts where it improves readability without introducing
ambiguity.

450 ASYMPTOTICS
9.3
O MANIPULATION
Like any mathematical formalism, the O-notation has rules of ma-
nipulation that free us from the grungy details of its denition.
Once we
prove that the rules are correct, using the denition, we can henceforth work
on a higher plane and forget about actually verifying that one set of functions
is contained in another. We don't even need to calculate the constants C that
The secret of being
a bore is to tell
everything.
|Voltaire
are implied by each O, as long as we follow rules that guarantee the existence
of such constants.
For example, we can prove once and for all that
nm = O(nm ‚Ä≤),
when m  m‚Ä≤;
(9.21)
O
¬°
f(n)
¬¢
+ O
¬°
g(n)
¬¢
= O
¬°
jf(n)j + jg(n)j
¬¢
.
(9.22)
Then we can say immediately that 1
3n3+ 1
2n2+ 1
6n = O(n3)+O(n3)+O(n3) =
O(n3), without the laborious calculations in the previous section.
Here are some more rules that follow easily from the denition:
f(n) = O
¬°
f(n)
¬¢
;
(9.23)
c ¬∑ O
¬°
f(n)
¬¢
= O
¬°
f(n)
¬¢
,
if c is constant;
(9.24)
O
¬°
O
¬°
f(n)
¬¢¬¢
= O
¬°
f(n)
¬¢
;
(9.25)
O
¬°
f(n)
¬¢
O
¬°
g(n)
¬¢
= O
¬°
f(n)g(n)
¬¢
;
(9.26)
O
¬°
f(n) g(n)
¬¢
= f(n)O
¬°
g(n)
¬¢
.
(9.27)
Exercise 9 proves (9.22), and the proofs of the others are similar. We can
always replace something of the form on the left by what's on the right,
regardless of the side conditions on the variable n.
Equations (9.27) and (9.23) allow us to derive the identity O
¬°
f(n)2¬¢
=
(Note: The formula
O(f(n))2 does not
denote the set of
all functions g(n)2
where g(n) is in
O(f(n)); such
functions g(n)2
cannot be nega-
tive, but the set
O(f(n))2 includes
negative functions.
In general, when
S is a set, the no-
tation S2 stands
for the set of all
products s1s2 with
s1 and s2 in S,
not for the set of
all squares s2 with
s ‚ààS.)
O
¬°
f(n)
¬¢2. This sometimes helps avoid parentheses, since we can write
O(log n)2
instead of
O
¬°
(log n)2¬¢
.
Both of these are preferable to `O(log2 n)', which is ambiguous because some
authors use it to mean `O(log log n)'.
Can we also write
O(log n)‚àí1
instead of
O
¬°
(log n)‚àí1¬¢
?
No! This is an abuse of notation, since the set of functions 1/O(log n) is
neither a subset nor a superset of O(1/log n). We could legitimately substitute
‚Ñ¶(log n)‚àí1 for O
¬°
(log n)‚àí1¬¢
, but this would be awkward. So we'll restrict
our use of \exponents outside the O" to constant, positive integer exponents.

9.3 O MANIPULATION 451
Power series give us some of the most useful operations of all. If the sum
S(z) =
X
n0
an zn
converges absolutely for some complex number z = z0, then
S(z) = O(1) ,
for all jzj  jz0j.
This is obvious, because
jS(z)j 
X
n0
janj jzjn 
X
n0
janj jz0jn = C < ‚àû.
In particular, S(z) = O(1) as z ‚Üí0, and S(1/n) = O(1) as n ‚Üí‚àû, provided
only that S(z) converges for at least one nonzero value of z. We can use this
principle to truncate a power series at any convenient point and estimate the
remainder with O. For example, not only is S(z) = O(1), but
S(z) = a0 + O(z) ,
S(z) = a0 + a1z + O(z2) ,
and so on, because
S(z) =
X
0k<m
akzk + zm X
nm
anzn‚àím
and the latter sum, like S(z) itself, converges absolutely for z = z0 and is
O(1). Table 452 lists some of the most useful asymptotic formulas, half of
which are simply based on truncation of power series according to this rule.
Dirichlet series, which are sums of the form P
k1 ak/kz, can be trun-
cated in a similar way: If a Dirichlet series converges absolutely when z = z0,
we can truncate it at any term and get the approximation
X
1k<m
ak/kz + O(m‚àíz) ,
valid for <z  <z0. The asymptotic formula for Bernoulli numbers Bn in
Remember that
< stands for \real
part."
Table 452 illustrates this principle.
On the other hand, the asymptotic formulas for Hn, n!, and œÄ(n) in
Table 452 are not truncations of convergent series; if we extended them in-
denitely they would diverge for all values of n. This is particularly easy to
see in the case of œÄ(n), since we have already observed in Section 7.3, Ex-
ample 5, that the power series P
k0 k!/(ln n)k is everywhere divergent. Yet
these truncations of divergent series turn out to be useful approximations.

452 ASYMPTOTICS
Table 452 Asymptotic approximations, valid as n ‚Üí‚àûand z ‚Üí0.
Hn = ln n + Œ≥ + 1
2n ‚àí
1
12n2 +
1
120n4 + O
¬≥ 1
n6
¬¥
.
(9.28)
n! =
‚àö
2œÄn
¬≥n
e
¬¥n¬µ
1 +
1
12n +
1
288n2 ‚àí
139
51840n3 + O
¬≥ 1
n4
¬¥¬∂
. (9.29)
Bn = 2[n even](‚àí1)n/2‚àí1
n!
(2œÄ)n
¬°
1 + 2‚àín + 3‚àín + O(4‚àín)
¬¢
.
(9.30)
œÄ(n) =
n
ln n +
n
(ln n)2 +
2! n
(ln n)3 +
3! n
(ln n)4 + O
¬≥
n
(log n)5
¬¥
.
(9.31)
ez = 1 + z + z2
2! + z3
3! + z4
4! + O(z5) .
(9.32)
ln(1 + z) = z ‚àíz2
2 + z3
3 ‚àíz4
4 + O(z5) .
(9.33)
1
1 ‚àíz = 1 + z + z2 + z3 + z4 + O(z5) .
(9.34)
(1 + z)Œ± = 1 + Œ±z +
¬µŒ±
2
¬∂
z2 +
¬µŒ±
3
¬∂
z3 +
¬µŒ±
4
¬∂
z4 + O(z5) .
(9.35)
An asymptotic approximation is said to have absolute error O
¬°
g(n)
¬¢
if it has the form f(n) + O
¬°
g(n)
¬¢
where f(n) doesn't involve O. The ap-
proximation has relative error O
¬°
g(n)
¬¢
if it has the form f(n)
¬°
1 + O
¬°
g(n)
¬¢¬¢
where f(n) doesn't involve O.
For example, the approximation for Hn in
Table 452 has absolute error O(n‚àí6); the approximation for n! has relative
error O(n‚àí4). (The right-hand side of (9.29) doesn't actually have the re-
quired form f(n)
¬°
1 + O(n‚àí4)
¬¢
, but we could rewrite it
‚àö
2œÄn
¬≥n
e
¬¥n¬µ
1 +
1
12n +
1
288n2 ‚àí
139
51840n3
¬∂¬°
1 + O(n‚àí4)
¬¢
if we wanted to; a similar calculation is the subject of exercise 12.) The ab-
(Relative error
is nice for taking
reciprocals, because
1/(1 + O(œµ)) =
1 + O(œµ).)
solute error of this approximation is O(nn‚àí3.5e‚àín). Absolute error is related
to the number of correct decimal digits to the right of the decimal point if
the O term is ignored; relative error corresponds to the number of correct
\signicant gures."
We can use truncation of power series to prove the general laws
ln
¬°
1 + O(f(n))
¬¢
= O
¬°
f(n)
¬¢
,
if f(n) ‚â∫1;
(9.36)
eO(f(n)) = 1 + O
¬°
f(n)
¬¢
,
if f(n) = O(1).
(9.37)

9.3 O MANIPULATION 453
(Here we assume that n ‚Üí‚àû; similar formulas hold for ln
¬°
1 + O(f(x))
¬¢
and
eO(f(x)) as x ‚Üí0.) For example, let ln
¬°
1 + g(n)
¬¢
be any function belonging
to the left side of (9.36). Then there are constants C, n0, and c such that
¬Ø¬Øg(n)
¬Ø¬Ø  C
¬Ø¬Øf(n)
¬Ø¬Ø  c < 1 ,
for all n  n0.
It follows that the innite sum
ln
¬°
1 + g(n)
¬¢
= g(n) ¬∑
¬°
1 ‚àí1
2g(n) + 1
3g(n)2 ‚àí¬∑ ¬∑ ¬∑
¬¢
converges for all n  n0, and the parenthesized series is bounded by the
constant 1 + 1
2c + 1
3c2 + ¬∑ ¬∑ ¬∑ . This proves (9.36), and the proof of (9.37) is
similar. Equations (9.36) and (9.37) combine to give the useful formula
¬°
1 + O(f(n))
¬¢O(g(n)) = 1 + O
¬°
f(n)g(n)
¬¢
,
if f(n) ‚â∫1 and
f(n)g(n) = O(1).
(9.38)
Problem 1: Return to the Wheel of Fortune.
Let's try our luck now at a few asymptotic problems. In Chapter 3 we
derived equation (3.13) for the number of winning positions in a certain game:
W = ‚åäN/K‚åã+ 1
2K2 + 5
2K ‚àí3 ,
K = ‚åä
3‚àö
N‚åã.
And we promised that an asymptotic version of W would be derived in Chap-
ter 9. Well, here we are in Chapter 9; let's try to estimate W, as N ‚Üí‚àû.
The main idea here is to remove the oor brackets, replacing K by N1/3+
O(1). Then we can go further and write
K = N1/3¬°
1 + O(N‚àí1/3)
¬¢
;
this is called \pulling out the large part." (We will be using this trick a lot.)
Now we have
K2 = N2/3¬°
1 + O(N‚àí1/3)
¬¢2
= N2/3¬°
1 + O(N‚àí1/3)
¬¢
= N2/3 + O(N1/3)
by (9.38) and (9.26). Similarly
‚åäN/K‚åã= N1‚àí1/3¬°
1 + O(N‚àí1/3)
¬¢‚àí1 + O(1)
= N2/3¬°
1 + O(N‚àí1/3)
¬¢
+ O(1) = N2/3 + O(N1/3) .
It follows that the number of winning positions is
W = N2/3 + O(N1/3) + 1
2
¬°
N2/3 + O(N1/3)
¬¢
+ O(N1/3) + O(1)
=
3
2N2/3 + O(N1/3) .
(9.39)

454 ASYMPTOTICS
Notice how the O terms absorb one another until only one remains; this is
typical, and it illustrates why O-notation is useful in the middle of a formula.
Problem 2: Perturbation of Stirling's formula.
Stirling's approximation for n! is undoubtedly the most famous asymp-
totic formula of all. We will prove it later in this chapter; for now, let's just
try to get better acquainted with its properties. We can write one version of
the approximation in the form
n! =
‚àö
2œÄn
¬≥n
e
¬¥n¬µ
1 + a
n + b
n2 + O(n‚àí3)
¬∂
,
as n ‚Üí‚àû,
(9.40)
for certain constants a and b. Since this holds for all large n, it must also be
asymptotically true when n is replaced by n ‚àí1:
(n ‚àí1)! =
p
2œÄ(n ‚àí1)
¬≥n ‚àí1
e
¬¥n‚àí1
√ó
¬µ
1 +
a
n‚àí1 +
b
(n‚àí1)2 + O
¬°
(n‚àí1)‚àí3¬¢¬∂
.
(9.41)
We know, of course, that (n ‚àí1)! = n!/n; hence the right-hand side of this
formula must simplify to the right-hand side of (9.40), divided by n.
Let us therefore try to simplify (9.41). The rst factor becomes tractable
if we pull out the large part:
p
2œÄ(n ‚àí1) =
‚àö
2œÄn (1 ‚àín‚àí1)1/2
=
‚àö
2œÄn
¬≥
1 ‚àí1
2n ‚àí
1
8n2 + O(n‚àí3)
¬¥
.
Equation (9.35) has been used here.
Similarly we have
a
n ‚àí1 = a
n(1 ‚àín‚àí1)‚àí1 = a
n + a
n2 + O(n‚àí3) ;
b
(n ‚àí1)2 =
b
n2 (1 ‚àín‚àí1)‚àí2 =
b
n2 + O(n‚àí3) ;
O
¬°
(n ‚àí1)‚àí3¬¢
= O
¬°
n‚àí3(1 ‚àín‚àí1)‚àí3¬¢
= O(n‚àí3) .
The only thing in (9.41) that's slightly tricky to deal with is the factor
(n ‚àí1)n‚àí1, which equals
nn‚àí1(1 ‚àín‚àí1)n‚àí1 = nn‚àí1(1 ‚àín‚àí1)n¬°
1 + n‚àí1 + n‚àí2 + O(n‚àí3)
¬¢
.

9.3 O MANIPULATION 455
(We are expanding everything out until we get a relative error of O(n‚àí3),
because the relative error of a product is the sum of the relative errors of the
individual factors. All of the O(n‚àí3) terms will coalesce.)
In order to expand (1 ‚àín‚àí1)n, we rst compute ln(1 ‚àín‚àí1) and then
form the exponential, en ln(1‚àín‚àí1):
(1 ‚àín‚àí1)n = exp
¬°
n ln(1 ‚àín‚àí1)
¬¢
= exp
¬°
n
¬°
‚àín‚àí1 ‚àí1
2n‚àí2 ‚àí1
3n‚àí3 + O(n‚àí4)
¬¢¬¢
= exp
¬°
‚àí1 ‚àí1
2n‚àí1 ‚àí1
3n‚àí2 + O(n‚àí3)
¬¢
= exp(‚àí1) ¬∑ exp(‚àí1
2n‚àí1) ¬∑ exp(‚àí1
3n‚àí2) ¬∑ exp
¬°
O(n‚àí3)
¬¢
= exp(‚àí1) ¬∑
¬°
1 ‚àí1
2n‚àí1 + 1
8n‚àí2 + O(n‚àí3)
¬¢
¬∑
¬°
1 ‚àí1
3n‚àí2 + O(n‚àí4)
¬¢
¬∑
¬°
1 + O(n‚àí3)
¬¢
= e‚àí1¬°
1 ‚àí1
2n‚àí1 ‚àí
5
24n‚àí2 + O(n‚àí3)
¬¢
.
Here we use the notation exp z instead of ez, since it allows us to work with
a complicated exponent on the main line of the formula instead of in the
superscript position. We must expand ln(1‚àín‚àí1) with absolute error O(n‚àí4)
in order to end with a relative error of O(n‚àí3), because the logarithm is being
multiplied by n.
The right-hand side of (9.41) has now been reduced to
‚àö
2œÄn times
nn‚àí1/en times a product of several factors:
¬°
1 ‚àí1
2n‚àí1 ‚àí1
8n‚àí2 + O(n‚àí3)
¬¢
¬∑
¬°
1 + n‚àí1 + n‚àí2 + O(n‚àí3)
¬¢
¬∑
¬°
1 ‚àí1
2n‚àí1 ‚àí
5
24n‚àí2 + O(n‚àí3)
¬¢
¬∑
¬°
1 + an‚àí1 + (a + b)n‚àí2 + O(n‚àí3)
¬¢
.
Multiplying these out and absorbing all asymptotic terms into one O(n‚àí3)
yields
1 + an‚àí1 + (a + b ‚àí
1
12)n‚àí2 + O(n‚àí3) .
Hmmm; we were hoping to get 1 + an‚àí1 + bn‚àí2 + O(n‚àí3), since that's what
we need to match the right-hand side of (9.40). Has something gone awry?
No, everything is ne, provided that a + b ‚àí
1
12 = b.
This perturbation argument doesn't prove the validity of Stirling's ap-
proximation, but it does prove something: It proves that formula (9.40) can-
not be valid unless a =
1
12.
If we had replaced the O(n‚àí3) in (9.40) by
cn‚àí3 +O(n‚àí4) and carried out our calculations to a relative error of O(n‚àí4),
we could have deduced that b must be
1
288, as claimed in Table 452. (This is
not the easiest way to determine the values of a and b, but it works.)

456 ASYMPTOTICS
Problem 3: The nth prime number.
Equation (9.31) is an asymptotic formula for œÄ(n), the number of primes
that do not exceed n. If we replace n by p = Pn, the nth prime number, we
have œÄ(p) = n; hence
n =
p
ln p + O
¬≥
p
(log p)2
¬¥
(9.42)
as n ‚Üí‚àû. Let us try to \solve" this equation for p; then we will know the
approximate size of the nth prime.
The rst step is to simplify the O term. If we divide both sides by p/ln p,
we nd that n ln p/p ‚Üí1; hence p/ln p = O(n) and
O
¬≥
p
(log p)2
¬¥
= O
¬≥
n
log p
¬¥
= O
¬≥
n
log n
¬¥
.
(We have (log p)‚àí1  (log n)‚àí1 because p  n.)
The second step is to transpose the two sides of (9.42), except for the
O term. This is legal because of the general rule
an = bn + O
¬°
f(n)
¬¢
‚áê‚áí
bn = an + O
¬°
f(n)
¬¢
.
(9.43)
(Each of these equations follows from the other if we multiply both sides
by ‚àí1 and then add an + bn to both sides.) Hence
p
ln p = n + O
¬≥
n
log n
¬¥
= n
¬°
1 + O(1/log n)
¬¢
,
and we have
p = n ln p
¬°
1 + O(1/log n)
¬¢
.
(9.44)
This is an \approximate recurrence" for p = Pn in terms of itself. Our goal
is to change it into an \approximate closed form," and we can do this by
unfolding the recurrence asymptotically. So let's try to unfold (9.44).
By taking logarithms of both sides we deduce that
ln p = ln n + ln ln p + O(1/log n) .
(9.45)
This value can be substituted for ln p in (9.44), but we would like to get rid
of all p's on the right before making the substitution. Somewhere along the
line, that last p must disappear; we can't get rid of it in the normal way for
recurrences, because (9.44) doesn't specify initial conditions for small p.
One way to do the job is to start by proving the weaker result p = O(n2).
This follows if we square (9.44) and divide by pn2,
p
n2 = (ln p)2
p
¬°
1 + O(1/log n)
¬¢
,

9.3 O MANIPULATION 457
since the right side approaches zero as n ‚Üí‚àû. OK, we know that p = O(n2);
therefore log p = O(log n) and log log p = O(log log n). We can now conclude
from (9.45) that
ln p = ln n + O(log log n) ;
in fact, with this new estimate in hand we can conclude that ln ln p = ln ln n+
O(log log n/log n), and (9.45) now yields
ln p = ln n + ln ln n + O(log log n/log n) .
And we can plug this into the right-hand side of (9.44), obtaining
p = n ln n + n ln ln n + O(n) .
This is the approximate size of the nth prime.
We can rene this estimate by using a better approximation of œÄ(n) in
place of (9.42). The next term of (9.31) tells us that
n =
p
ln p +
p
(ln p)2 + O
¬≥
p
(log p)3
¬¥
;
(9.46)
proceeding as before, we obtain the recurrence
Get out the scratch
paper again, gang.
Boo, Hiss.
p = n ln p
¬°
1 + (ln p)‚àí1¬¢‚àí1¬°
1 + O(1/log n)2¬¢
,
(9.47)
which has a relative error of O(1/log n)2 instead of O(1/log n). Taking loga-
rithms and retaining proper accuracy (but not too much) now yields
ln p = ln n + ln ln p + O(1/log n)
= ln n
¬≥
1 + ln ln p
ln n
+ O(1/log n)2¬¥
;
ln ln p = ln ln n + ln ln n
ln n
+ O
¬≥log log n
log n
¬¥2
.
Finally we substitute these results into (9.47) and our answer nds its way
out:
Pn = n ln n + n ln ln n ‚àín + n ln ln n
ln n
+ O
¬≥
n
log n
¬¥
.
(9.48)
For example, when n = 106 this estimate comes to 15631363.8 + O(n/log n);
the millionth prime is actually 15485863. Exercise 21 shows that a still more
accurate approximation to Pn results if we begin with a still more accurate
approximation to œÄ(n) in place of (9.46).

458 ASYMPTOTICS
Problem 4: A sum from an old Ô¨Ånal exam.
When Concrete Mathematics was rst taught at Stanford University dur-
ing the 1970{1971 term, students were asked for the asymptotic value of the
sum
Sn =
1
n2 + 1 +
1
n2 + 2 + ¬∑ ¬∑ ¬∑ +
1
n2 + n ,
(9.49)
with an absolute error of O(n‚àí7). Let's imagine that we've just been given
this problem on a (take-home) nal; what is our rst instinctive reaction?
No, we don't panic. Our rst reaction is to think big. If we set n =
10100, say, and look at the sum, we see that it consists of n terms, each of
which is slightly less than 1/n2; hence the sum is slightly less than 1/n. In
general, we can usually get a decent start on an asymptotic problem by taking
stock of the situation and getting a ballpark estimate of the answer.
Let's try to improve the rough estimate by pulling out the largest part
of each term. We have
1
n2 + k =
1
n2(1 + k/n2) =
1
n2
¬µ
1 ‚àík
n2 + k2
n4 ‚àík3
n6 + O
¬≥ k4
n8
¬¥¬∂
,
and so it's natural to try summing all these approximations:
1
n2 + 1 =
1
n2 ‚àí1
n4 + 12
n6 ‚àí13
n8 + O
¬≥ 14
n10
¬¥
1
n2 + 2 =
1
n2 ‚àí2
n4 + 22
n6 ‚àí23
n8 + O
¬≥ 24
n10
¬¥
...
1
n2 + n =
1
n2 ‚àín
n4 + n2
n6 ‚àín3
n8 + O
¬≥ n4
n10
¬¥
Sn =
n
n2 ‚àín(n + 1)
2n4
+ ¬∑ ¬∑ ¬∑ .
It looks as if we're getting Sn = n‚àí1 ‚àí1
2n‚àí2 + O(n‚àí3), based on the sums of
the rst two columns; but the calculations are getting hairy.
If we persevere in this approach, we will ultimately reach the goal; but
we won't bother to sum the other columns, for two reasons: First, the last
column is going to give us terms that are O(n‚àí6), when n/2  k  n, so we
will have an error of O(n‚àí5); that's too big, and we will have to include yet
another column in the expansion. Could the exam-giver have been so sadistic?
Do pajamas have
buttons?
We suspect that there must be a better way. Second, there is indeed a much
better way, staring us right in the face.

9.3 O MANIPULATION 459
Namely, we know a closed form for Sn: It's just Hn2+n ‚àíHn2. And we
know a good approximation for harmonic numbers, so we just apply it twice:
Hn2+n = ln(n2 + n) + Œ≥ +
1
2(n2 + n) ‚àí
1
12(n2 + n)2 + O
¬≥ 1
n8
¬¥
;
Hn2 = ln n2 + Œ≥ +
1
2n2 ‚àí
1
12n4 + O
¬≥ 1
n8
¬¥
.
Now we can pull out large terms and simplify, as we did when looking at
Stirling's approximation. We have
ln(n2 + n) = ln n2 + ln
¬≥
1 + 1
n
¬¥
= ln n2 + 1
n ‚àí
1
2n2 +
1
3n3 ‚àí¬∑ ¬∑ ¬∑ ;
1
n2 + n =
1
n2 ‚àí1
n3 + 1
n4 ‚àí¬∑ ¬∑ ¬∑ ;
1
(n2 + n)2 =
1
n4 ‚àí2
n5 + 3
n6 ‚àí¬∑ ¬∑ ¬∑ .
So there's lots of helpful cancellation, and we nd
Sn = n‚àí1 ‚àí1
2n‚àí2 + 1
3n‚àí3 ‚àí1
4n‚àí4 + 1
5n‚àí5 ‚àí1
6n‚àí6
‚àí1
2n‚àí3 + 1
2n‚àí4 ‚àí1
2n‚àí5 + 1
2n‚àí6
+ 1
6n‚àí5 ‚àí1
4n‚àí6
plus terms that are O(n‚àí7). A bit of arithmetic and we're home free:
Sn = n‚àí1 ‚àí1
2n‚àí2 ‚àí1
6n‚àí3 + 1
4n‚àí4 ‚àí2
15n‚àí5 + 1
12n‚àí6 + O(n‚àí7) . (9.50)
It would be nice if we could check this answer numerically, as we did
when we derived exact results in earlier chapters. Asymptotic formulas are
harder to verify; an arbitrarily large constant may be hiding in a O term,
so any numerical test is inconclusive. But in practice, we have no reason to
believe that an adversary is trying to trap us, so we can assume that the
unknown O-constants are reasonably small. With a pocket calculator we nd
that S4 =
1
17 + 1
18 + 1
19 + 1
20 = 0.2170107; and our asymptotic estimate when
n = 4 comes to
1
4
¬°
1 + 1
4
¬°
‚àí1
2 + 1
4(‚àí1
6 + 1
4( 1
4 + 1
4(‚àí2
15 + 1
4 ¬∑ 1
12)))
¬¢¬¢
= 0.2170125 .
If we had made an error of, say,
1
12 in the term for n‚àí6, a dierence of
1
12
1
4096
would have shown up in the fth decimal place; so our asymptotic answer is
probably correct.

460 ASYMPTOTICS
Problem 5: An inÔ¨Ånite sum.
We turn now to an asymptotic question posed by Solomon Golomb [152]:
What is the approximate value of
Sn =
X
k1
1
kNn(k)2 ,
(9.51)
where Nn(k) is the number of digits required to write k in radix n notation?
First let's try again for a ballpark estimate. The number of digits, Nn(k),
is approximately logn k = log k/log n; so the terms of this sum are roughly
(log n)2/k(log k)2. Summing on k gives ‚âà(log n)2 P
k2 1/k(log k)2, and this
sum converges to a constant value because it can be compared to the integral
Z ‚àû
2
dx
x(ln x)2 = ‚àí
1
ln x
¬Ø¬Ø¬Ø¬Ø
‚àû
2
=
1
ln 2 .
Therefore we expect Sn to be about C(log n)2, for some constant C.
Hand-wavy analyses like this are useful for orientation, but we need better
estimates to solve the problem. One idea is to express Nn(k) exactly:
Nn(k) = ‚åälogn k‚åã+ 1 .
(9.52)
Thus, for example, k has three radix n digits when n2  k < n3, and this
happens precisely when ‚åälogn k‚åã= 2. It follows that Nn(k) > logn k, hence
Sn = P
k1 1/kNn(k)2 < 1 + (log n)2 P
k2 1/k(log k)2.
Proceeding as in Problem 1, we can try to write Nn(k) = logn k + O(1)
and substitute this into the formula for Sn. The term represented here by O(1)
is always between 0 and 1, and it is about 1
2 on the average, so it seems rather
well-behaved. But still, this isn't a good enough approximation to tell us
about Sn; it gives us zero signicant gures (that is, high relative error) when
k is small, and these are the terms that contribute the most to the sum. We
need a dierent idea.
The key (as in Problem 4) is to use our manipulative skills to put the
sum into a more tractable form, before we resort to asymptotic estimates. We
can introduce a new variable of summation, m = Nn(k):
Sn =
X
k,m1
¬£
m = Nn(k)
¬§
km2
=
X
k,m1
[nm‚àí1  k < nm]
km2
=
X
m1
1
m2
¬°
Hnm‚àí1 ‚àíHnm‚àí1‚àí1
¬¢
.

9.3 O MANIPULATION 461
This may look worse than the sum we began with, but it's actually a step for-
ward, because we have very good approximations for the harmonic numbers.
Still, we hold back and try to simplify some more. No need to rush into
asymptotics. Summation by parts allows us to group the terms for each value
of Hnm‚àí1 that we need to approximate:
Sn =
X
k1
Hnk‚àí1
¬≥ 1
k2 ‚àí
1
(k + 1)2
¬¥
.
For example, Hn2‚àí1 is multiplied by 1/22 and then by ‚àí1/32. (We have used
the fact that Hn0‚àí1 = H0 = 0.)
Now we're ready to expand the harmonic numbers. Our experience with
estimating (n ‚àí1)! has taught us that it will be easier to estimate Hnk than
Hnk‚àí1, since the (nk ‚àí1)'s will be messy; therefore we write
Hnk‚àí1 = Hnk ‚àí1
nk = ln nk + Œ≥ +
1
2nk + O
¬≥ 1
n2k
¬¥
‚àí1
nk
= k ln n + Œ≥ ‚àí
1
2nk + O
¬≥ 1
n2k
¬¥
.
Our sum now reduces to
Sn =
X
k1
¬≥
k ln n + Œ≥ ‚àí
1
2nk + O
¬≥ 1
n2k
¬¥¬¥¬≥ 1
k2 ‚àí
1
(k + 1)2
¬¥
= (ln n)Œ£1 + Œ≥Œ£2 ‚àí1
2Œ£3(n) + O
¬°
Œ£3(n2)
¬¢
.
(9.53)
There are four easy pieces left: Œ£1, Œ£2, Œ£3(n), and Œ£3(n2).
Let's do the Œ£3's rst, since Œ£3(n2) is the O term; then we'll see what
sort of error we're getting. (There's no sense carrying out other calculations
with perfect accuracy if they will be absorbed into a O anyway.) This sum is
Into a Big Oh.
simply a power series,
Œ£3(x) =
X
k1
¬≥ 1
k2 ‚àí
1
(k + 1)2
¬¥
x‚àík ,
and the series converges when x  1 so we can truncate it at any desired
point. If we stop Œ£3(n2) at the term for k = 1, we get Œ£3(n2) = O(n‚àí2);
hence (9.53) has an absolute error of O(n‚àí2). (To decrease this absolute error,
we could use a better approximation to Hnk; but O(n‚àí2) is good enough for
now.) If we truncate Œ£3(n) at the term for k = 2, we get
Œ£3(n) =
3
4n‚àí1 + O(n‚àí2) ;
this is all the accuracy we need.

462 ASYMPTOTICS
We might as well do Œ£2 now, since it is so easy:
Œ£2 =
X
k1
¬≥ 1
k2 ‚àí
1
(k + 1)2
¬¥
.
This is the telescoping series (1 ‚àí1
4) + ( 1
4 ‚àí1
9) + ( 1
9 ‚àí
1
16) + ¬∑ ¬∑ ¬∑ = 1.
Finally, Œ£1 gives us the leading term of Sn, the coecient of ln n in
(9.53):
Œ£1 =
X
k1
k
¬≥ 1
k2 ‚àí
1
(k + 1)2
¬¥
.
This is (1‚àí1
4)+( 2
4 ‚àí2
9)+( 3
9 ‚àí3
16)+¬∑ ¬∑ ¬∑ = 1
1 + 1
4 + 1
9 +¬∑ ¬∑ ¬∑ = H(2)
‚àû= œÄ2/6. (If
we hadn't applied summation by parts earlier, we would have seen directly
that Sn ‚àºP
k1(ln n)/k2, because Hnk‚àí1 ‚àíHnk‚àí1‚àí1 ‚àºln n; so summation
by parts didn't help us to evaluate the leading term, although it did make
some of our other work easier.)
Now we have evaluated each of the Œ£'s in (9.53), so we can put everything
together and get the answer to Golomb's problem:
Sn = œÄ2
6 ln n + Œ≥ ‚àí3
8n + O
¬≥ 1
n2
¬¥
.
(9.54)
Notice that this grows more slowly than our original hand-wavy estimate of
C(log n)2. Sometimes a discrete sum fails to obey a continuous intuition.
Problem 6: Big Phi.
Near the end of Chapter 4, we observed that the number of fractions in
the Farey series Fn is 1 + Œ¶(n), where
Œ¶(n) = œï(1) + œï(2) + ¬∑ ¬∑ ¬∑ + œï(n) ;
and we showed in (4.62) that
Œ¶(n) = 1
2
X
k1
¬µ(k)‚åän/k‚åã‚åä1 + n/k‚åã.
(9.55)
Let us now try to estimate Œ¶(n) when n is large. (It was sums like this that
led Bachmann to invent O-notation in the rst place.)
Thinking big tells us that Œ¶(n) will probably be proportional to n2.
For if the nal factor were just ‚åän/k‚åãinstead of ‚åä1 + n/k‚åã, we would have
¬Ø¬ØŒ¶(n)
¬Ø¬Ø 
1
2
P
k1‚åän/k‚åã2 
1
2
P
k1(n/k)2 =
œÄ2
12 n2, because the Mobius
function ¬µ(k) is either ‚àí1, 0, or +1. The additional `1 + ' in that nal factor
adds P
k1 ¬µ(k)‚åän/k‚åã; but this is zero for k > n, so it cannot be more than
nHn = O(n log n) in absolute value.

9.3 O MANIPULATION 463
This preliminary analysis indicates that we'll nd it advantageous to
write
Œ¶(n) = 1
2
n
X
k=1
¬µ(k)
¬µ¬≥n
k
¬¥
+ O(1)
¬∂2
= 1
2
n
X
k=1
¬µ(k)
¬µ¬≥n
k
¬¥2
+ O
¬≥n
k
¬¥¬∂
= 1
2
n
X
k=1
¬µ(k)
¬≥n
k
¬¥2
+
n
X
k=1
O
¬≥n
k
¬¥
= 1
2
n
X
k=1
¬µ(k)
¬≥n
k
¬¥2
+ O(n log n) .
This removes the oors; the remaining problem is to evaluate the unoored
sum 1
2
Pn
k=1 ¬µ(k)n2/k2 with an accuracy of O(n log n); in other words, we
want to evaluate Pn
k=1 ¬µ(k)1/k2 with an accuracy of O(n‚àí1 log n). But that's
easy; we can simply run the sum all the way up to k = ‚àû, because the newly
added terms are
X
k>n
¬µ(k)
k2
= O
¬≥X
k>n
1
k2
¬¥
= O
¬≥X
k>n
1
k(k ‚àí1)
¬¥
= O
¬µX
k>n
¬≥
1
k ‚àí1 ‚àí1
k
¬¥¬∂
= O
¬≥ 1
n
¬¥
.
We proved in (7.89) that P
k1 ¬µ(k)/kz = 1/Œ∂(z). Hence P
k1 ¬µ(k)/k2 =
1
¬±¬°P
k1 1/k2¬¢
= 6/œÄ2, and we have our answer:
(The error term was
shown to be at most
O(n(log n)2/3 √ó
(log log n)1+œµ)
by Saltykov in
1960 [316]. On
the other hand, it
is not as small as
o(n(loglogn)1/2),
according to Mont-
gomery [275].)
Œ¶(n) =
3
œÄ2 n2 + O(n log n) .
(9.56)
9.4
TWO ASYMPTOTIC TRICKS
Now that we have some facility with O manipulations, let's look at
what we've done from a slightly higher perspective. Then we'll have some
important weapons in our asymptotic arsenal, when we need to do battle
with tougher problems.
Trick 1: Bootstrapping.
When we estimated the nth prime Pn in Problem 3 of Section 9.3, we
solved an asymptotic recurrence of the form
Pn = n ln Pn
¬°
1 + O(1/log n)
¬¢
.
We proved that Pn = n ln n + O(n) by rst using the recurrence to show
the weaker result O(n2). This is a special case of a general method called
bootstrapping, in which we solve a recurrence asymptotically by starting with

464 ASYMPTOTICS
a rough estimate and plugging it into the recurrence; in this way we can often
derive better and better estimates, \pulling ourselves up by our bootstraps."
Here's another problem that illustrates bootstrapping nicely: What is the
asymptotic value of the coecient gn = [zn] G(z) in the generating function
G(z) = exp
¬≥X
k1
zk
k2
¬¥
,
(9.57)
as n ‚Üí‚àû? If we dierentiate this equation with respect to z, we nd
G‚Ä≤(z) =
‚àû
X
n=0
ngnzn‚àí1 =
¬≥X
k1
zk‚àí1
k
¬¥
G(z) ;
equating coecients of zn‚àí1 on both sides gives the recurrence
ngn =
X
0k<n
gk
n ‚àík .
(9.58)
Our problem is equivalent to nding an asymptotic formula for the solution
to (9.58), with the initial condition g0 = 1. The rst few values
n
0
1
2
3
4
5
6
gn
1
1
3
4
19
36
107
288
641
2400
51103
259200
don't reveal much of a pattern, and the integer sequence ‚ü®n!2gn‚ü©doesn't
appear in Sloane's Handbook [330]; therefore a closed form for gn seems out
of the question, and asymptotic information is probably the best we can hope
to derive.
Our rst handle on this problem is the observation that 0 < gn  1 for
all n  0; this is easy to prove by induction. So we have a start:
gn = O(1) .
This equation can, in fact, be used to \prime the pump" for a bootstrapping
operation: Plugging it in on the right of (9.58) yields
ngn =
X
0k<n
O(1)
n ‚àík = HnO(1) = O(log n) ;
hence we have
gn = O
¬≥log n
n
¬¥
,
for n > 1.

9.4 TWO ASYMPTOTIC TRICKS 465
And we can bootstrap yet again:
ngn = 1
n +
X
0<k<n
O
¬°
(1 + log k)/k
¬¢
n ‚àík
= 1
n +
X
0<k<n
O(log n)
k(n ‚àík)
= 1
n +
X
0<k<n
¬≥1
k +
1
n ‚àík
¬¥O(log n)
n
= 1
n + 2
nHn‚àí1O(log n) = 1
nO(log n)2 ,
obtaining
gn = O
¬≥log n
n
¬¥2
.
(9.59)
Will this go on forever? Perhaps we'll have gn = O(n‚àí1 log n)m for all m.
Actually no; we have just reached a point of diminishing returns. The
next attempt at bootstrapping involves the sum
X
0<k<n
1
k2(n ‚àík) =
X
0<k<n
¬≥ 1
nk2 +
1
n2k +
1
n2(n ‚àík)
¬¥
= 1
nH(2)
n‚àí1 + 2
n2 Hn‚àí1 ,
which is ‚Ñ¶(n‚àí1); so we cannot get an estimate for gn that falls below ‚Ñ¶(n‚àí2).
In fact, we now know enough about gn to apply our old trick of pulling
out the largest part:
ngn =
X
0k<n
gk
n +
X
0k<n
gk
¬≥
1
n ‚àík ‚àí1
n
¬¥
= 1
n
X
k0
gk ‚àí1
n
X
kn
gk + 1
n
X
0k<n
kgk
n ‚àík .
(9.60)
The rst sum here is G(1) = exp( 1
1 + 1
4 + 1
9 + ¬∑ ¬∑ ¬∑ ) = eœÄ2/6, because G(z)
converges for all jzj  1. The second sum is the tail of the rst; we can get an
upper bound by using (9.59):
X
kn
gk = O
¬≥X
kn
(log k)2
k2
¬¥
= O
¬≥(log n)2
n
¬¥
.

466 ASYMPTOTICS
This last estimate follows because, for example,
X
k>n
(log k)2
k2
<
X
m1
X
nm<knm+1
(log nm+1)2
k(k ‚àí1)
<
X
m1
(m + 1)2(log n)2
nm
.
(Exercise 54 discusses a more general way to estimate such tails.)
The third sum in (9.60) is
O
¬µ X
0k<n
(log n)2
k(n ‚àík)
¬∂
= O
¬µ(log n)3
n
¬∂
,
by an argument that's already familiar. So (9.60) proves that
gn = eœÄ2/6
n2
+ O
¬°
log n/n
¬¢3 .
(9.61)
Finally, we can feed this formula back into the recurrence, bootstrapping once
more; the result is
gn = eœÄ2/6
n2
+ O(log n/n3) .
(9.62)
(Exercise 23 peeks inside the remaining O term.)
Trick 2: Trading tails.
We derived (9.62) in somewhat the same way we derived the asymptotic
value (9.56) of Œ¶(n): In both cases we started with a nite sum but got an
asymptotic value by considering an innite sum. We couldn't simply get the
innite sum by introducing O into the summand; we had to be careful to use
one approach when k was small and another when k was large.
Those derivations were special cases of an important three-step asymp-
(This impor-
tant method was
pioneered by
Laplace [240].)
totic summation method we will now discuss in greater generality. Whenever
we want to estimate the value of P
k ak(n), we can try the following approach:
1
First break the sum into two disjoint ranges, Dn and Tn. The summation
over Dn should be the \dominant" part, in the sense that it includes
enough terms to determine the signicant digits of the sum, when n is
large. The summation over the other range Tn should be just the \tail"
end, which contributes little to the overall total.
2
Find an asymptotic estimate
ak(n) = bk(n) + O
¬°
ck(n)
¬¢
that is valid when k ‚ààDn. The O bound need not hold when k ‚ààTn.

9.4 TWO ASYMPTOTIC TRICKS 467
3
Now prove that each of the following three sums is small:
Œ£a(n) =
X
k‚ààTn
ak(n) ;
Œ£b(n) =
X
k‚ààTn
bk(n) ;
Œ£c(n) =
X
k‚ààDn
¬Ø¬Øck(n)
¬Ø¬Ø .
(9.63)
If all three steps can be completed successfully, we have a good estimate:
X
k‚ààDn‚à™Tn
ak(n) =
X
k‚ààDn‚à™Tn
bk(n) + O
¬°
Œ£a(n)
¬¢
+ O
¬°
Œ£b(n)
¬¢
+ O
¬°
Œ£c(n)
¬¢
.
Here's why.
We can \chop o" the tail of the given sum, getting a good
estimate in the range Dn where a good estimate is necessary:
X
k‚ààDn
ak(n) =
X
k‚ààDn
¬°
bk(n) + O(ck(n))
¬¢
=
X
k‚ààDn
bk(n) + O
¬°
Œ£c(n)
¬¢
.
And we can replace the tail with another one, even though the new tail might
be a terrible approximation to the old, because the tails don't really matter:
Asymptotics is
the art of knowing
where to be sloppy
and where to be
precise.
X
k‚ààTn
ak(n) =
X
k‚ààTn
¬°
bk(n) ‚àíbk(n) + ak(n)
¬¢
=
X
k‚ààTn
bk(n) + O
¬°
Œ£b(n)
¬¢
+ O
¬°
Œ£a(n)
¬¢
.
When we evaluated the sum in (9.60), for example, we had
ak(n) = [0  k < n]gk/(n ‚àík) ,
bk(n) = gk/n ,
ck(n) = kgk/n(n ‚àík) ;
the ranges of summation were
Dn = f0, 1, . . . , n ‚àí1g ,
Tn = fn, n + 1, . . . g ;
and we found that
Œ£a(n) = 0 ,
Œ£b(n) = O
¬°
(log n)2/n2¬¢
,
Œ£c(n) = O
¬°
(log n)3/n2¬¢
.
This led to (9.61).
Similarly, when we estimated Œ¶(n) in (9.55) we had
ak(n) = ¬µ(k)‚åän/k‚åã‚åä1+n/k‚åã,
bk(n) = ¬µ(k)n2/k2 ,
ck(n) = n/k ;
Dn = f1, 2, . . . , ng ,
Tn = fn + 1, n + 2, . . . g .
We derived (9.56) by observing that Œ£a(n) = 0, Œ£b(n) = O(n), and Œ£c(n) =
O(n log n).

468 ASYMPTOTICS
Here's another example where tail switching is eective.
(Unlike our
Also, horses switch
their tails when
feeding time ap-
proaches.
previous examples, this one illustrates the trick in its full generality, with
Œ£a(n) Ã∏= 0.) We seek the asymptotic value of
Ln =
X
k0
ln(n + 2k)
k!
.
The big contributions to this sum occur when k is small, because of the k! in
the denominator. In this range we have
ln(n + 2k) = ln n + 2k
n ‚àí22k
2n2 + O
¬≥23k
n3
¬¥
.
(9.64)
We can prove that this estimate holds for 0  k < ‚åälg n‚åã, since the original
terms that have been truncated with O are bounded by the convergent series
X
m3
2km
mnm  23k
n3
X
m3
2k(m‚àí3)
nm‚àí3
 23k
n3
¬≥
1 + 1
2 + 1
4 + ¬∑ ¬∑ ¬∑
¬¥
= 23k
n3 ¬∑ 2 .
(In this range, 2k/n  2‚åälg n‚åã‚àí1/n  1
2.)
Therefore we can apply the three-step method just described, with
ak(n) = ln(n + 2k)/k! ,
bk(n) = (ln n + 2k/n ‚àí4k/2n2)/k! ,
ck(n) = 8k/n3k! ;
Dn = f0, 1, . . . , ‚åälg n‚åã‚àí1g ,
Tn = f‚åälg n‚åã, ‚åälg n‚åã+ 1, . . . g .
All we have to do is nd good bounds on the three Œ£'s in (9.63), and we'll
know that P
k0 ak(n) ‚âàP
k0 bk(n).
The error we have committed in the dominant part of the sum, Œ£c(n) =
P
k‚ààDn 8k/n3k!, is obviously bounded by P
k0 8k/n3k! = e8/n3, so it can
be replaced by O(n‚àí3). The new tail error is
¬Ø¬ØŒ£b(n)
¬Ø¬Ø =
¬Ø¬Ø¬Ø¬Ø
X
k‚åälg n‚åã
bk(n)
¬Ø¬Ø¬Ø¬Ø
<
X
k‚åälg n‚åã
ln n + 2k + 4k
k!
< ln n + 2‚åälg n‚åã+ 4‚åälg n‚åã
‚åälg n‚åã!
X
k0
4k
k! = O
¬≥
n2
‚åälg n‚åã!
¬¥
.

9.4 TWO ASYMPTOTIC TRICKS 469
Since ‚åälg n‚åã! grows faster than any power of n, this minuscule error is over-
\We may not be big,
but we're small."
whelmed by Œ£c(n) = O(n‚àí3). The error that comes from the original tail,
Œ£a(n) =
X
k‚åälg n‚åã
ak(n) <
X
k‚åälg n‚åã
k + ln n
k!
,
is smaller yet.
Finally, it's easy to sum P
k0 bk(n) in closed form, and we have obtained
the desired asymptotic formula:
X
k0
ln(n + 2k)
k!
= e ln n + e2
n ‚àíe4
2n2 + O
¬≥ 1
n3
¬¥
.
(9.65)
The method we've used makes it clear that, in fact,
X
k0
ln(n + 2k)
k!
= e ln n +
m‚àí1
X
k=1
(‚àí1)k+1 e2k
knk + O
¬≥ 1
nm
¬¥
,
(9.66)
for any xed m > 0. (This is a truncation of a series that diverges for all
xed n if we let m ‚Üí‚àû.)
There's only one aw in our solution: We were too cautious. We de-
rived (9.64) on the assumption that k < ‚åälg n‚åã, but exercise 53 proves that
the stated estimate is actually valid for all values of k.
If we had known
the stronger general result, we wouldn't have had to use the two-tail trick;
we could have gone directly to the nal formula! But later we'll encounter
problems where exchange of tails is the only decent approach available.
9.5
EULER'S SUMMATION FORMULA
And now for our next trick | which is, in fact, the last important
technique that will be discussed in this book | we turn to a general method of
approximating sums that was rst published by Leonhard Euler [101] in 1732.
(The idea is sometimes also associated with the name of Colin Maclaurin, a
professor of mathematics at Edinburgh who discovered it independently a
short time later [263, page 305].)
Here's the formula:
X
ak<b
f(k) =
Z b
a
f(x) dx +
m
X
k=1
Bk
k! f(k‚àí1)(x)
¬Ø¬Ø¬Ø¬Ø
b
a
+ Rm ,
(9.67)
where Rm = (‚àí1)m+1
Z b
a
Bm
¬°
fxg
¬¢
m!
f(m)(x) dx ,
integers a  b;
integer m  1. (9.68)

470 ASYMPTOTICS
On the left is a typical sum that we might want to evaluate. On the right is
another expression for that sum, involving integrals and derivatives. If f(x) is
a suciently \smooth" function, it will have m derivatives f‚Ä≤(x), . . . , f(m)(x),
and this formula turns out to be an identity. The right-hand side is often an
excellent approximation to the sum on the left, in the sense that the remain-
der Rm is often small. For example, we'll see that Stirling's approximation
for n! is a consequence of Euler's summation formula; so is our asymptotic
approximation for the harmonic number Hn.
The numbers Bk in (9.67) are the Bernoulli numbers that we met in
Chapter 6; the function Bm
¬°
fxg
¬¢
in (9.68) is the Bernoulli polynomial that we
met in Chapter 7. The notation fxg stands for the fractional part x ‚àí‚åäx‚åã, as
in Chapter 3. Euler's summation formula sort of brings everything together.
Let's recall the values of small Bernoulli numbers, since it's always handy
to have them listed near Euler's general formula:
B0 = 1 , B1 = ‚àí1
2 , B2 =
1
6 , B4 = ‚àí1
30 , B6 =
1
42 , B8 = ‚àí1
30 ;
B3 = B5 = B7 = B9 = B11 = ¬∑ ¬∑ ¬∑ = 0 .
Jakob Bernoulli discovered these numbers when studying the sums of powers
of integers, and Euler's formula explains why: If we set f(x) = xm‚àí1, we have
f(m)(x) = 0; hence Rm = 0, and (9.67) reduces to
X
ak<b
km‚àí1 = xm
m
¬Ø¬Ø¬Ø¬Ø
b
a
+
m
X
k=1
Bk
k! (m ‚àí1)k‚àí1 xm‚àík
¬Ø¬Ø¬Ø¬Ø
b
a
=
1
m
m
X
k=0
¬µm
k
¬∂
Bk ¬∑ (bm‚àík ‚àíam‚àík) .
For example, when m = 3 we have our favorite example of summation:
X
0k<n
k2 = 1
3
√É¬µ3
0
¬∂
B0n3 +
¬µ3
1
¬∂
B1n2 +
¬µ3
2
¬∂
B2n
!
= n3
3 ‚àín2
2 + n
6 .
(This is the last time we shall derive this famous formula in this book.)
All good things
must come to
an end.
Before we prove Euler's formula, let's look at a high-level reason (due
to Lagrange [234]) why such a formula ought to exist. Chapter 2 denes the
dierence operator ‚àÜand explains that P is the inverse of ‚àÜ, just as ‚à´is the
inverse of the derivative operator D. We can express ‚àÜin terms of D using
Taylor's formula as follows:
f(x + œµ) = f(x) + f‚Ä≤(x)
1! œµ + f‚Ä≤‚Ä≤(x)
2!
œµ2 + ¬∑ ¬∑ ¬∑ .

9.5 EULER'S SUMMATION FORMULA 471
Setting œµ = 1 tells us that
‚àÜf(x) = f(x + 1) ‚àíf(x)
= f‚Ä≤(x)/1! + f‚Ä≤‚Ä≤(x)/2! + f‚Ä≤‚Ä≤‚Ä≤(x)/3! + ¬∑ ¬∑ ¬∑
= (D/1! + D2/2! + D3/3! + ¬∑ ¬∑ ¬∑ ) f(x) = (eD ‚àí1) f(x) .
(9.69)
Here eD stands for the dierential operation 1 + D/1! + D2/2! + D3/3! + ¬∑ ¬∑ ¬∑ .
Since ‚àÜ= eD ‚àí1, the inverse operator Œ£ = 1/‚àÜshould be 1/(eD ‚àí1); and
we know from Table 352 that z/(ez ‚àí1) = P
k0 Bkzk/k! is a power series
involving Bernoulli numbers. Thus
P = B0
D + B1
1! + B2
2! D + B3
3! D2 + ¬∑ ¬∑ ¬∑ =
R
+
X
k1
Bk
k! Dk‚àí1 .
(9.70)
Applying this operator equation to f(x) and attaching limits yields
Xb
a f(x) Œ¥x =
Z b
a
f(x) dx +
X
k1
Bk
k! f(k‚àí1)(x)
¬Ø¬Ø¬Ø¬Ø
b
a
,
(9.71)
which is exactly Euler's summation formula (9.67) without the remainder
term. (Euler did not, in fact, consider the remainder, nor did anybody else
until S. D. Poisson [295] published an important memoir about approximate
summation in 1823. The remainder term is important, because the innite
sum P
k1(Bk/k!)f(k‚àí1)(x)
¬Ø¬Øb
a often diverges.
Our derivation of (9.71) has
been purely formal, without regard to convergence.)
Now let's prove (9.67), with the remainder included. It suces to prove
the case a = 0 and b = 1, namely
f(0) =
Z 1
0
f(x) dx +
m
X
k=1
Bk
k! f(k‚àí1)(x)
¬Ø¬Ø¬Ø¬Ø
1
0
‚àí(‚àí1)m
Z 1
0
Bm(x)
m!
f(m)(x) dx ,
because we can then replace f(x) by f(x + l) for any integer l, getting
f(l) =
Z l+1
l
f(x)dx +
m
X
k=1
Bk
k! f(k‚àí1)(x)
¬Ø¬Ø¬Ø¬Ø
l+1
l
‚àí(‚àí1)m
Z l+1
l
Bm
¬°
fxg
¬¢
m!
f(m)(x)dx.
The general formula (9.67) is just the sum of this identity over the range
a  l < b, because intermediate terms telescope nicely.
The proof when a = 0 and b = 1 is by induction on m, starting with
m = 1:
f(0) =
Z 1
0
f(x) dx ‚àí1
2
¬°
f(1) ‚àíf(0)
¬¢
+
Z 1
0
(x ‚àí1
2)f‚Ä≤(x) dx .

472 ASYMPTOTICS
(The Bernoulli polynomial Bm(x) is dened by the equation
Bm(x) =
¬µm
0
¬∂
B0xm +
¬µm
1
¬∂
B1xm‚àí1 + ¬∑ ¬∑ ¬∑ +
¬µm
m
¬∂
Bmx0
(9.72)
in general, hence B1(x) = x ‚àí1
2 in particular.) In other words, we want to
prove that
f(0) + f(1)
2
=
Z 1
0
f(x) dx +
Z 1
0
(x ‚àí1
2)f‚Ä≤(x) dx .
But this is just a special case of the formula
u(x)v(x)
¬Ø¬Ø1
0 =
Z 1
0
u(x) dv(x) +
Z 1
0
v(x) du(x)
(9.73)
for integration by parts, with u(x) = f(x) and v(x) = x ‚àí1
2. Hence the case
m = 1 is easy.
To pass from m ‚àí1 to m and complete the induction when m > 1, we
need to show that Rm‚àí1 = (Bm/m!)f(m‚àí1)(x)
¬Ø¬Ø1
0 + Rm, namely that
(‚àí1)m
Z 1
0
Bm‚àí1(x)
(m ‚àí1)! f(m‚àí1)(x) dx
= Bm
m! f(m‚àí1)(x)
¬Ø¬Ø¬Ø¬Ø
1
0
‚àí(‚àí1)m
Z 1
0
Bm(x)
m!
f(m)(x) dx .
This reduces to the equation
(‚àí1)mBmf(m‚àí1)(x)
¬Ø¬Ø¬Ø¬Ø
1
0
= m
Z 1
0
Bm‚àí1(x)f(m‚àí1)(x) dx +
Z 1
0
Bm(x)f(m)(x) dx .
Once again (9.73) applies to these two integrals, with u(x) = f(m‚àí1)(x) and
Will the authors
never get serious?
v(x) = Bm(x), because the derivative of the Bernoulli polynomial (9.72) is
d
dx
X
k
¬µm
k
¬∂
Bkxm‚àík =
X
k
¬µm
k
¬∂
(m ‚àík)Bkxm‚àík‚àí1
= m
X
k
¬µm‚àí1
k
¬∂
Bkxm‚àí1‚àík = mBm‚àí1(x) . (9.74)
(The absorption identity (5.7) was useful here.) Therefore the required for-
mula will hold if and only if
(‚àí1)mBmf(m‚àí1)(x)
¬Ø¬Ø1
0 = Bm(x)f(m‚àí1)(x)
¬Ø¬Ø1
0 .

9.5 EULER'S SUMMATION FORMULA 473
In other words, we need to have
(‚àí1)mBm = Bm(1) = Bm(0) ,
for m > 1.
(9.75)
This is a bit embarrassing, because Bm(0) is obviously equal to Bm, not
to (‚àí1)mBm. But there's no problem really, because m > 1; we know that
Bm is zero when m is odd. (Still, that was a close call.)
To complete the proof of Euler's summation formula we need to show
that Bm(1) = Bm(0), which is the same as saying that
X
k
¬µm
k
¬∂
Bk = Bm ,
for m > 1.
But this is just the denition of Bernoulli numbers, (6.79), so we're done.
The identity B‚Ä≤
m(x) = mBm‚àí1(x) implies that
Z 1
0
Bm(x) dx = Bm+1(1) ‚àíBm+1(0)
m + 1
,
and we know now that this integral is zero when m  1. Hence the remainder
term in Euler's formula,
Rm = (‚àí1)m+1
m!
Z b
a
Bm
¬°
fxg
¬¢
f(m)(x) dx ,
multiplies f(m)(x) by a function Bm
¬°
fxg
¬¢
whose average value is zero. This
means that Rm has a reasonable chance of being small.
Let's look more closely at Bm(x) for 0  x  1, since Bm(x) governs the
behavior of Rm. Here are the graphs for Bm(x) for the rst twelve values of m:
m = 1
m = 2
m = 3
m = 4
Bm(x)
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
B4+m(x)
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
B8+m(x)
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
Although B3(x) through B9(x) are quite small, the Bernoulli polynomials
and numbers ultimately get quite large. Fortunately Rm has a compensating
factor 1/m!, which helps to calm things down.

474 ASYMPTOTICS
The graph of Bm(x) begins to look very much like a sine wave when
m  3; exercise 58 proves that Bm(x) can in fact be well approximated by a
negative multiple of cos(2œÄx ‚àí1
2œÄm), with relative error 1/2m.
In general, B4k+1(x) is negative for 0 < x < 1
2 and positive for 1
2 < x < 1.
Therefore its integral, B4k+2(x)/(4k+2), decreases for 0 < x < 1
2 and increases
for 1
2 < x < 1. Moreover, we have
B4k+1(1 ‚àíx) = ‚àíB4k+1(x) ,
for 0  x  1,
and it follows that
B4k+2(1 ‚àíx) = B4k+2(x) ,
for 0  x  1.
The constant term B4k+2 causes the integral
R1
0 B4k+2(x) dx to be zero; hence
B4k+2 > 0. The integral of B4k+2(x) is B4k+3(x)/(4k + 3), which must there-
fore be positive when 0 < x < 1
2 and negative when 1
2 < x < 1; furthermore
B4k+3(1‚àíx) = ‚àíB4k+3(x), so B4k+3(x) has the properties stated for B4k+1(x),
but negated. Therefore B4k+4(x) has the properties stated for B4k+2(x), but
negated. Therefore B4k+5(x) has the properties stated for B4k+1(x); we have
completed a cycle that establishes the stated properties inductively for all k.
According to this analysis, the maximum value of B2m(x) must occur
either at x = 0 or at x = 1
2. Exercise 17 proves that
B2m( 1
2) = (21‚àí2m ‚àí1)B2m ;
(9.76)
hence we have
¬Ø¬ØB2m
¬°
fxg
¬¢¬Ø¬Ø  jB2mj .
(9.77)
This can be used to establish a useful upper bound on the remainder in Euler's
summation formula, because we know from (6.89) that
jB2mj
(2m)! =
2
(2œÄ)2m
X
k1
1
k2m = O
¬°
(2œÄ)‚àí2m¬¢
,
when m > 0.
Therefore we can rewrite Euler's formula (9.67) as follows:
X
ak<b
f(k) =
Z b
a
f(x) dx ‚àí1
2f(x)
¬Ø¬Øb
a +
m
X
k=1
B2k
(2k)!f(2k‚àí1)(x)
¬Ø¬Øb
a
+ O
¬°
(2œÄ)‚àí2m¬¢ Z b
a
¬Ø¬Øf(2m)(x)
¬Ø¬Ø dx .
(9.78)
For example, if f(x) = ex, all derivatives are the same and this formula tells
us that P
ak<b ek = (eb ‚àíea)
¬°
1 ‚àí1
2 + B2/2! + B4/4! + ¬∑ ¬∑ ¬∑ + B2m/(2m)!
¬¢
+

9.5 EULER'S SUMMATION FORMULA 475
O
¬°
(2œÄ)‚àí2m¬¢
. Of course, we know that this sum is actually a geometric series,
equal to (eb ‚àíea)/(e ‚àí1) = (eb ‚àíea) P
k0 Bk/k!.
If f(2m)(x)  0 for a  x  b, the integral
Rb
a jf(2m)(x)j dx is just
f(2m‚àí1)(x)
¬Ø¬Øb
a, so we have
jR2mj 
¬Ø¬Ø¬Ø¬Ø
B2m
(2m)!f(2m‚àí1)(x)
¬Ø¬Øb
a
¬Ø¬Ø¬Ø¬Ø ;
in other words, the remainder is bounded by the magnitude of the nal term
(the term just before the remainder), in this case. We can give an even better
estimate if we know that
f(2m+2)(x)  0
and
f(2m+4)(x)  0 ,
for a  x  b.
(9.79)
For it turns out that this implies the relation
R2m = Œ∏m
B2m+2
(2m + 2)!f(2m+1)(x)
¬Ø¬Øb
a ,
for some 0 < Œ∏m < 1;
(9.80)
in other words, the remainder will then lie between 0 and the rst discarded
term in (9.78) | the term that would follow the nal term if we increased m.
Here's the proof: Euler's summation formula is valid for all m, and
B2m+1 = 0 when m > 0; hence R2m = R2m+1, and the rst discarded term
must be
R2m ‚àíR2m+2 .
We therefore want to show that R2m lies between 0 and R2m ‚àíR2m+2; and
this is true if and only if R2m and R2m+2 have opposite signs. We claim that
f(2m+2)(x)  0
for a  x  b
implies
(‚àí1)mR2m  0 .
(9.81)
This, together with (9.79), will prove that R2m and R2m+2 have opposite
signs, so the proof of (9.80) will be complete.
It's not dicult to prove (9.81) if we recall the denition of R2m+1 and
the facts we proved about the graph of B2m+1(x). Namely, we have
R2m = R2m+1 =
Z b
a
B2m+1
¬°
fxg
¬¢
(2m + 1)! f(2m+1)(x) dx ,
and f(2m+1)(x) is increasing because its derivative f(2m+2)(x) is positive.
(More precisely, f(2m+1)(x) is nondecreasing because its derivative is non-
negative.) The graph of B2m+1
¬°
fxg
¬¢
looks like (‚àí1)m+1 times a sine wave, so
it is geometrically obvious that the second half of each sine wave is more inu-
ential than the rst half when it is multiplied by an increasing function. This
makes (‚àí1)mR2m+1  0, as desired. Exercise 16 proves the result formally.

476 ASYMPTOTICS
9.6
FINAL SUMMATIONS
Now comes the summing up, as we prepare to conclude this book.
We will apply Euler's summation formula to some interesting and important
examples.
Summation 1: This one is too easy.
But rst we will consider an interesting unimportant example, namely
a sum that we already know how to do. Let's see what Euler's summation
formula tells us if we apply it to the telescoping sum
Sn =
X
1k<n
1
k(k + 1) =
X
1k<n
¬µ1
k ‚àí
1
k + 1
¬∂
= 1 ‚àí1
n .
It can't hurt to embark on our rst serious application of Euler's formula with
the asymptotic equivalent of training wheels.
We might as well start by writing the function f(x) = 1/x(x+1) in partial
fraction form,
f(x) = 1
x ‚àí
1
x + 1 ,
since this makes it easier to integrate and dierentiate.
Indeed, we have
f‚Ä≤(x) = ‚àí1/x2 + 1/(x + 1)2 and f‚Ä≤‚Ä≤(x) = 2/x3 ‚àí2/(x + 1)3; in general
f(k)(x) = (‚àí1)kk!
¬≥
1
xk+1 ‚àí
1
(x + 1)k+1
¬¥
,
for k  0.
Furthermore
Z n
1
f(x) dx = ln x ‚àíln(x + 1)
¬Ø¬Øn
1 = ln
2n
n + 1 .
Plugging this into the summation formula (9.67) gives
Sn = ln 2n
n+1 ‚àí
m
X
k=1
(‚àí1)k Bk
k
¬µ 1
nk ‚àí
1
(n+1)k ‚àí1 + 1
2k
¬∂
+ Rm(n) ,
where Rm(n) = ‚àí
Z n
1
Bm
¬°
fxg
¬¢¬≥
1
xm+1 ‚àí
1
(x + 1)m+1
¬¥
dx .
For example, the right-hand side when m = 4 is
ln 2n
n+1 ‚àí1
2
¬≥ 1
n ‚àí
1
n + 1 ‚àí1
2
¬¥
‚àí1
12
¬≥ 1
n2 ‚àí
1
(n + 1)2 ‚àí3
4
¬¥
+
1
120
¬≥ 1
n4 ‚àí
1
(n + 1)4 ‚àí15
16
¬¥
+ R4(n) .

9.6 FINAL SUMMATIONS 477
This is kind of a mess; it certainly doesn't look like the real answer 1 ‚àín‚àí1.
But let's keep going anyway, to see what we've got. We know how to expand
the right-hand terms in negative powers of n up to, say, O(n‚àí5):
ln
n
n + 1 = ‚àín‚àí1 + 1
2n‚àí2 ‚àí1
3n‚àí3 + 1
4n‚àí4 + O(n‚àí5) ;
1
n + 1 =
n‚àí1 ‚àí
n‚àí2 +
n‚àí3 ‚àí
n‚àí4 + O(n‚àí5) ;
1
(n + 1)2 =
n‚àí2 ‚àí2n‚àí3 + 3n‚àí4 + O(n‚àí5) ;
1
(n + 1)4 =
n‚àí4 + O(n‚àí5) .
Therefore the terms on the right of our approximation add up to
ln 2 + 1
4 +
1
16 ‚àí
1
128 +
¬°
‚àí1 ‚àí1
2 + 1
2
¬¢
n‚àí1 +
¬° 1
2 ‚àí1
2 ‚àí
1
12 +
1
12
¬¢
n‚àí2
+
¬°
‚àí1
3 + 1
2 ‚àí
2
12
¬¢
n‚àí3 +
¬° 1
4 ‚àí1
2 +
3
12 +
1
120 ‚àí
1
120
¬¢
n‚àí4 + R4(n)
= ln 2 +
39
128 ‚àín‚àí1 + R4(n) + O(n‚àí5) .
The coecients of n‚àí2, n‚àí3, and n‚àí4 cancel nicely, as they should.
If all were well with the world, we would be able to show that R4(n) is
asymptotically small, maybe O(n‚àí5), and we would have an approximation
to the sum. But we can't possibly show this, because we happen to know that
the correct constant term is 1, not ln 2+ 39
128 (which is approximately 0.9978).
So R4(n) is actually equal to
89
128 ‚àíln 2 + O(n‚àí4), but Euler's summation
formula doesn't tell us this.
In other words, we lose.
One way to try xing things is to notice that the constant terms in the
approximation form a pattern, if we let m get larger and larger:
ln 2 ‚àí1
2B1 + 1
2 ¬∑ 3
4B2 ‚àí1
3 ¬∑ 7
8B3 + 1
4 ¬∑ 15
16B4 ‚àí1
5 ¬∑ 31
32B5 + ¬∑ ¬∑ ¬∑ .
Perhaps we can show that this series approaches 1 as the number of terms
becomes innite? But no; the Bernoulli numbers get very large. For example,
B22 = 854513
138
> 6192; therefore
¬Ø¬ØR22(n)
¬Ø¬Ø will be much larger than
¬Ø¬ØR4(n)
¬Ø¬Ø.
We lose totally.
There is a way out, however, and this escape route will turn out to be
important in other applications of Euler's formula. The key is to notice that
R4(n) approaches a denite limit as n ‚Üí‚àû:
lim
n‚Üí‚àûR4(n) = ‚àí
Z ‚àû
1
B4
¬°
fxg
¬¢¬≥ 1
x5 ‚àí
1
(x + 1)5
¬¥
dx = R4(‚àû) .

478 ASYMPTOTICS
The integral
R‚àû
1 Bm
¬°
fxg
¬¢
f(m)(x) dx will exist whenever f(m)(x) = O(x‚àí2) as
x ‚Üí‚àû, and in this case f(4)(x) surely qualies. Moreover, we have
R4(n) = R4(‚àû) +
Z ‚àû
n
B4
¬°
fxg
¬¢¬≥ 1
x5 ‚àí
1
(x + 1)5
¬¥
dx
= R4(‚àû) + O
¬≥Z ‚àû
n
x‚àí6 dx
¬¥
= R4(‚àû) + O(n‚àí5) .
Thus we have used Euler's summation formula to prove that
X
1k<n
1
k(k + 1) = ln 2 +
39
128 ‚àín‚àí1 + R4(‚àû) + O(n‚àí5)
= C ‚àín‚àí1 + O(n‚àí5)
for some constant C. We do not know what the constant is | some other
method must be used to establish it | but Euler's summation formula is able
to let us deduce that the constant exists.
Suppose we had chosen a much larger value of m. Then the same rea-
soning would tell us that
Rm(n) = Rm(‚àû) + O(n‚àím‚àí1) ,
and we would have the formula
X
1k<n
1
k(k+1) = C ‚àín‚àí1+c2n‚àí2+c3n‚àí3 + ¬∑ ¬∑ ¬∑ + cmn‚àím + O(n‚àím‚àí1)
for certain constants c2, c3, . . . . We know that the c's happen to be zero
in this case; but let's prove it, just to restore some of our condence (in
Euler's formula if not in ourselves). The term ln
n
n+1 contributes (‚àí1)m/m
to cm; the term (‚àí1)m+1(Bm/m)n‚àím contributes (‚àí1)m+1Bm/m; and the
term (‚àí1)k(Bk/k)(n + 1)‚àík contributes (‚àí1)m¬°m‚àí1
k‚àí1
¬¢
Bk/k. Therefore
(‚àí1)mcm =
1
m ‚àíBm
m +
m
X
k=1
¬µm ‚àí1
k ‚àí1
¬∂Bk
k
=
1
m ‚àíBm
m + 1
m
m
X
k=1
¬µm
k
¬∂
Bk =
1
m
¬°
1 ‚àíBm + Bm(1) ‚àí1
¬¢
.
Sure enough, it's zero, when m > 1. We have proved that
X
1k<n
1
k(k + 1) = C ‚àín‚àí1 + O(n‚àím‚àí1) ,
for all m  1.
(9.82)
This is not enough to prove that the sum is exactly equal to C ‚àín‚àí1; the
actual value might be C ‚àín‚àí1 + 2‚àín or something. But Euler's summation

9.6 FINAL SUMMATIONS 479
formula does give us the error bound O(n‚àím‚àí1) for arbitrarily large m, even
though we haven't evaluated any remainders explicitly.
Summation 1, again: Recapitulation and generalization.
Before we leave our training wheels, let's review what we just did from
a somewhat higher perspective. We began with a sum
Sn =
X
1k<n
f(k)
and we used Euler's summation formula to write
Sn = F(n) ‚àíF(1) +
m
X
k=1
¬°
Tk(n) ‚àíTk(1)
¬¢
+ Rm(n) ,
(9.83)
where F(x) was
R
f(x) dx and where Tk(x) was a certain term involving Bk
and f(k‚àí1)(x). We also noticed that there was a constant c such that
f(m)(x) = O(xc‚àím)
as x ‚Üí‚àû,
for all large m.
(Namely, f(k) was 1/k(k + 1); F(x) was ln
¬°
x/(x + 1)
¬¢
; c was ‚àí2; and Tk(x)
was (‚àí1)k+1(Bk/k)
¬°
x‚àík ‚àí(x + 1)‚àík¬¢
.) For all large enough values of m, this
implied that the remainders had a small tail,
R‚Ä≤
m(n) = Rm(‚àû) ‚àíRm(n)
= (‚àí1)m+1
Z ‚àû
n
Bm
¬°
fxg
¬¢
m!
f(m)(x) dx = O(nc+1‚àím) .
(9.84)
Therefore we were able to conclude that there exists a constant C such that
Sn = F(n) + C +
m
X
k=1
Tk(n) ‚àíR‚Ä≤
m(n) .
(9.85)
(Notice that C nicely absorbed the Tk(1) terms, which were a nuisance.)
We can save ourselves unnecessary work in future problems by simply
asserting the existence of C whenever Rm(‚àû) exists.
Now let's suppose that f(2m+2)(x)  0 and f(2m+4)(x)  0 for 1  x  n.
We have proved that this implies a simple bound (9.80) on the remainder,
R2m(n) = Œ∏m,n
¬°
T2m+2(n) ‚àíT2m+2(1)
¬¢
,
where Œ∏m,n lies somewhere between 0 and 1. But we don't really want bounds
that involve R2m(n) and T2m+2(1); after all, we got rid of Tk(1) when we
introduced the constant C. What we really want is a bound like
‚àíR‚Ä≤
2m(n) = œÜm,nT2m+2(n) ,

480 ASYMPTOTICS
where 0 < œÜm,n < 1; this will allow us to conclude from (9.85) that
Sn = F(n) + C + T1(n) +
m
X
k=1
T2k(n) + œÜm,nT2m+2(n) ,
(9.86)
hence the remainder will truly be between zero and the rst discarded term.
A slight modication of our previous argument will patch things up per-
fectly. Let us assume that
f(2m+2)(x)  0
and
f(2m+4)(x)  0 ,
as x ‚Üí‚àû.
(9.87)
The right-hand side of (9.85) is just like the negative of the right-hand side of
Euler's summation formula (9.67) with a = n and b = ‚àû, as far as remainder
terms are concerned, and successive remainders are generated by induction
on m. Therefore our previous argument can be applied.
Summation 2: Harmonic numbers harmonized.
Now that we've learned so much from a trivial (but safe) example, we can
readily do a nontrivial one. Let us use Euler's summation formula to derive
the approximation for Hn that we have been claiming for some time.
In this case, f(x) = 1/x. We already know about the integral and deriva-
tives of f, because of Summation 1; also f(m)(x) = O(x‚àím‚àí1) as x ‚Üí‚àû.
Therefore we can immediately plug into formula (9.85):
X
1k<n
1
k = ln n + C + B1n‚àí1 ‚àí
m
X
k=1
B2k
2kn2k ‚àíR‚Ä≤
2m(n) ,
for some constant C. The sum on the left is Hn‚àí1, not Hn; but it's more
convenient to work with Hn‚àí1 and to add 1/n later, than to mess around with
(n + 1)'s on the right-hand side. The B1n‚àí1 will then become (B1 + 1)n‚àí1 =
1/(2n). Let us call the constant Œ≥ instead of C, since Euler's constant Œ≥ is,
in fact, dened to be limn‚Üí‚àû(Hn ‚àíln n).
The remainder term can be estimated nicely by the theory we developed
a minute ago, because f(2m)(x) = (2m)!/x2m+1  0 for all x > 0. Therefore
(9.86) tells us that
Hn = ln n + Œ≥ + 1
2n ‚àí
m
X
k=1
B2k
2kn2k + Œ∏m,n
B2m+2
(2m + 2)n2m+2 ,
(9.88)
where Œ∏m,n is some fraction between 0 and 1. This is the general formula
whose rst few terms are listed in Table 452. For example, when m = 2 we get
Hn = ln n + Œ≥ + 1
2n ‚àí
1
12n2 +
1
120n4 ‚àíŒ∏2,n
252n6 .
(9.89)

9.6 FINAL SUMMATIONS 481
This equation, incidentally, gives us a good approximation to Œ≥ even when
n = 2:
Œ≥ = H2 ‚àíln 2 ‚àí1
4 +
1
48 ‚àí
1
1920 + œµ = 0.577165 . . . + œµ ,
where œµ is between zero and
1
16128. If we take n = 104 and m = 250, we get
the value of Œ≥ correct to 1271 decimal places, beginning thus [205]:
Œ≥ = 0.57721 56649 01532 86060 65120 90082 40243 . . . .
(9.90)
But Euler's constant appears also in other formulas that allow it to be eval-
uated even more eciently [345].
Summation 3: Stirling's approximation.
If f(x) = ln x, we have f‚Ä≤(x) = 1/x, so we can evaluate the sum of
logarithms using almost the same calculations as we did when summing re-
ciprocals. Euler's summation formula yields
X
1k<n
ln k = n ln n ‚àín + œÉ ‚àíln n
2
+
m
X
k=1
B2k
2k(2k‚àí1)n2k‚àí1 + œïm,n
B2m+2
(2m+2)(2m+1)n2m+1
where œÉ is a certain constant, \Stirling's constant," and 0 < œïm,n < 1. (In
this case f(2m)(x) is negative, not positive; but we can still say that the
remainder is governed by the rst discarded term, because we could have
started with f(x) = ‚àíln x instead of f(x) = ln x.) Adding ln n to both sides
gives
ln n! = n ln n ‚àín + ln n
2
+ œÉ +
1
12n ‚àí
1
360n3 +
œï2,n
1260n5
(9.91)
when m = 2. And we can get the approximation in Table 452 by taking `exp'
of both sides. (The value of eœÉ turns out to be
‚àö
2œÄ, but we aren't quite ready
to derive that formula. In fact, Stirling didn't discover the closed form for œÉ
until several years after de Moivre [76] had proved that the constant exists.)
If m is xed and n ‚Üí‚àû, the general formula gives a better and better
approximation to ln n! in the sense of absolute error, hence it gives a better
and better approximation to n! in the sense of relative error. But if n is xed
and m increases, the error bound jB2m+2j/(2m + 2)(2m + 1)n2m+1 decreases
to a certain point and then begins to increase. Therefore the approximation
reaches a point beyond which a sort of uncertainty principle limits the amount
Heisenberg may
have been here.
by which n! can be approximated.

482 ASYMPTOTICS
In Chapter 5, equation (5.83), we generalized factorials to arbitrary real Œ±
by using a denition
1
Œ±! =
lim
n‚Üí‚àû
¬µn + Œ±
n
¬∂
n‚àíŒ±
suggested by Euler. Suppose Œ± is a large number; then
ln Œ±! =
lim
n‚Üí‚àû
¬≥
Œ± ln n + ln n! ‚àí
n
X
k=1
ln(Œ± + k)
¬¥
,
and Euler's summation formula can be used with f(x) = ln(x+Œ±) to estimate
this sum:
n
X
k=1
ln(k + Œ±) = Fm(Œ±, n) ‚àíFm(Œ±, 0) + R2m(Œ±, n) ,
Fm(Œ±, x) = (x + Œ±) ln(x + Œ±) ‚àíx + ln(x + Œ±)
2
+
m
X
k=1
B2k
2k(2k ‚àí1)(x + Œ±)2k‚àí1 ,
R2m(Œ±, n) =
Z n
0
B2m
¬°
fxg
¬¢
2m
dx
(x + Œ±)2m .
(Here we have used (9.67) with a = 0 and b = n, then added ln(n + Œ±) ‚àí
ln Œ± to both sides.) If we subtract this approximation for Pn
k=1 ln(k + Œ±)
from Stirling's approximation for ln n!, then add Œ± ln n and take the limit as
n ‚Üí‚àû, we get
ln Œ±! = Œ± ln Œ± ‚àíŒ± + ln Œ±
2
+ œÉ
+
m
X
k=1
B2k
(2k)(2k ‚àí1)Œ±2k‚àí1 ‚àí
Z ‚àû
0
B2m
¬°
fxg
¬¢
2m
dx
(x + Œ±)2m ,
because Œ± ln n+n ln n‚àín+ 1
2 ln n‚àí(n+Œ±) ln(n+Œ±)+n‚àí1
2 ln(n+Œ±) ‚Üí‚àíŒ± and
the other terms not shown here tend to zero. Thus Stirling's approximation
behaves for generalized factorials (and for the Gamma function Œì(Œ± + 1) = Œ±!)
exactly as for ordinary factorials.
Summation 4: A bell-shaped summand.
Let's turn now to a sum that has quite a dierent avor:
Œòn =
X
k
e‚àík2/n
(9.92)
= ¬∑ ¬∑ ¬∑+e‚àí9/n+e‚àí4/n+e‚àí1/n+1+e‚àí1/n+e‚àí4/n+e‚àí9/n+¬∑ ¬∑ ¬∑ .

9.6 FINAL SUMMATIONS 483
This is a doubly innite sum, whose terms reach their maximum value e0 = 1
when k = 0. We call it Œòn because it is a power series involving the quantity
e‚àí1/n raised to the p(k)th power, where p(k) is a polynomial of degree 2;
such power series are traditionally called \theta functions." If n = 10100, we
have
e‚àík2/n =
¬± e‚àí.01 ‚âà0.99005,
when k = 1049;
e‚àí1
‚âà0.36788,
when k = 1050;
e‚àí100 < 10‚àí43,
when k = 1051.
So the summand stays very near 1 until k gets up to about ‚àön, when it
drops o and stays very near zero. We can guess that Œòn will be proportional
to ‚àön. Here is a graph of e‚àík2/n when n = 10:
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
Larger values of n just stretch the graph horizontally by a factor of ‚àön.
We can estimate Œòn by letting f(x) = e‚àíx2/n and taking a = ‚àí‚àû,
b = +‚àûin Euler's summation formula.
(If innities seem too scary, let
a = ‚àíA and b = +B, then take limits as A, B ‚Üí‚àû.) The integral of f(x) is
Z +‚àû
‚àí‚àû
e‚àíx2/n dx = ‚àön
Z +‚àû
‚àí‚àû
e‚àíu2 du = ‚àön C ,
if we replace x by u‚àön. The value of
R+‚àû
‚àí‚àûe‚àíu2 du is well known, but we'll
call it C for now and come back to it after we have nished plugging into
Euler's summation formula.
The next thing we need to know is the sequence of derivatives f‚Ä≤(x),
f‚Ä≤‚Ä≤(x), . . . , and for this purpose it's convenient to set
f(x) = g
¬°
x/‚àön
¬¢
,
g(x) = e‚àíx2 .
Then the chain rule of calculus says that
df(x)
dx
= dg(y)
dy
dy
dx ,
y =
x
‚àön ;
and this is the same as saying that
f‚Ä≤(x) =
1
‚àön g‚Ä≤¬°
x/‚àön
¬¢
.
By induction we have
f(k)(x) = n‚àík/2g(k)¬°
x/‚àön
¬¢
.

484 ASYMPTOTICS
For example, we have g‚Ä≤(x) = ‚àí2xe‚àíx2 and g‚Ä≤‚Ä≤(x) = (4x2 ‚àí2)e‚àíx2; hence
f‚Ä≤(x) =
1
‚àön
¬µ
‚àí2 x
‚àön
¬∂
e‚àíx2/n ,
f‚Ä≤‚Ä≤(x) = 1
n
¬µ
4
¬≥ x
‚àön
¬¥2
‚àí2
¬∂
e‚àíx2/n .
It's easier to see what's going on if we work with the simpler function g(x).
We don't have to evaluate the derivatives of g(x) exactly, because we're
only going to be concerned about the limiting values when x = ¬±‚àû. And for
this purpose it suces to notice that every derivative of g(x) is e‚àíx2 times a
polynomial in x:
g(k)(x) = Pk(x)e‚àíx2 ,
where Pk is a polynomial of degree k.
This follows by induction.
The negative exponential e‚àíx2 goes to zero much faster than Pk(x) goes
to innity, when x ‚Üí¬±‚àû, so we have
f(k)(+‚àû) = f(k)(‚àí‚àû) = 0
for all k  0. Therefore all of the terms
m
X
k=1
Bk
k! f(k‚àí1)(x)
¬Ø¬Ø+‚àû
‚àí‚àû
vanish, and we are left with the term from
R
f(x) dx and the remainder:
Œòn = C‚àön + (‚àí1)m+1
Z +‚àû
‚àí‚àû
Bm
¬°
fxg
¬¢
m!
f(m)(x) dx
= C‚àön + (‚àí1)m+1
nm/2
Z +‚àû
‚àí‚àû
Bm
¬°
fxg
¬¢
m!
g(m)
¬µ x
‚àön
¬∂
dx
(x = u‚àön )
= C‚àön + (‚àí1)m+1
n(m‚àí1)/2
Z +‚àû
‚àí‚àû
Bm
¬°
fu‚àön g
¬¢
m!
Pm(u)e‚àíu2 du
= C‚àön + O(n(1‚àím)/2) .
The O estimate here follows since
¬Ø¬ØBm
¬°
fu‚àön g
¬¢¬Ø¬Ø is bounded and the integral
R+‚àû
‚àí‚àû
¬Ø¬ØP(u)
¬Ø¬Øe‚àíu2 du exists whenever P is a polynomial. (The constant implied
by this O depends on m.)
We have proved that Œòn = C‚àön + O(n‚àíM), for arbitrarily large M; the
dierence between Œòn and C‚àön is \exponentially small." Let us therefore
determine the constant C that plays such a big role in the value of Œòn.
One way to determine C is to look the integral up in a table; but we
prefer to know how the value can be derived, so that we can do integrals even

9.6 FINAL SUMMATIONS 485
when they haven't been tabulated. Elementary calculus suces to evaluate C
if we are clever enough to look at the double integral
C2 =
Z +‚àû
‚àí‚àû
e‚àíx2 dx
Z +‚àû
‚àí‚àû
e‚àíy2 dy =
Z +‚àû
‚àí‚àû
Z +‚àû
‚àí‚àû
e‚àí(x2+y2) dx dy .
Converting to polar coordinates gives
C2 =
Z 2œÄ
0
Z ‚àû
0
e‚àír2r dr dŒ∏
(u = r2)
= 1
2
Z 2œÄ
0
dŒ∏
Z ‚àû
0
e‚àíu du
= 1
2
Z 2œÄ
0
dŒ∏ = œÄ .
So C = ‚àöœÄ. The fact that x2 + y2 = r2 is the equation of a circle whose
circumference is 2œÄr somehow explains why œÄ gets into the act.
Another way to evaluate C is to replace x by
‚àö
t and dx by 1
2t‚àí1/2 dt:
C =
Z +‚àû
‚àí‚àû
e‚àíx2 dx = 2
Z ‚àû
0
e‚àíx2 dx =
Z ‚àû
0
t‚àí1/2e‚àít dt .
This integral equals Œì
¬° 1
2
¬¢
, since Œì(Œ±) =
R‚àû
0 tŒ±‚àí1e‚àít dt according to (5.84).
Therefore we have demonstrated that Œì
¬° 1
2
¬¢
= ‚àöœÄ.
Our nal formula, then, is
Œòn =
X
k
e‚àík2/n = ‚àöœÄn + O(n‚àíM) ,
for all xed M.
(9.93)
The constant in the O depends on M; that's why we say that M is \xed."
When n = 2, for example, the innite sum Œò2 is approximately equal to
2.506628288; this is already very close to
‚àö
2œÄ ‚âà2.506628275, even though n
is quite small. The value of Œò100 agrees with 10‚àöœÄ to 427 decimal places! Ex-
ercise 59 uses advanced methods to derive a rapidly convergent series for Œòn;
it turns out that
Œòn/‚àöœÄn = 1 + 2e‚àínœÄ2 + O(e‚àí4nœÄ2) .
(9.94)
Summation 5: The clincher.
Now we will do one last sum, which will turn out to tell us the value
of Stirling's constant œÉ.
This last sum also illustrates many of the other
techniques of this last chapter (and of this whole book), so it will be a tting
way for us to conclude our explorations of Concrete Mathematics.

486 ASYMPTOTICS
The nal task seems almost absurdly easy: We will try to nd the asymp-
totic value of
An =
X
k
¬µ2n
k
¬∂
by using Euler's summation formula.
This is another case where we already know the answer (right?); but
it's always interesting to try new methods on old problems, so that we can
compare facts and maybe discover something new.
So we think big and realize that the main contribution to An comes
from the middle terms, near k = n. It's almost always a good idea to choose
notation so that the biggest contribution to a sum occurs near k = 0, because
we can then use the tail-exchange trick to get rid of terms that have large jkj.
Therefore we replace k by n + k:
An =
X
k
¬µ 2n
n + k
¬∂
=
X
k
(2n)!
(n + k)! (n ‚àík)! .
Things are looking reasonably good, since we know how to approximate
(n ¬± k)! when n is large and k is small.
Now we want to carry out the three-step procedure associated with the
tail-exchange trick. Namely, we want to write
(2n)!
(n + k)! (n ‚àík)! = ak(n) = bk(n) + O
¬°
ck(n)
¬¢
,
for k ‚ààDn,
so that we can obtain the estimate
An =
X
k
bk(n) + O
¬≥ X
k/‚ààDn
ak(n)
¬¥
+ O
¬≥ X
k/‚ààDn
bk(n)
¬¥
+
X
k‚ààDn
O
¬°
ck(n)
¬¢
.
Let us therefore try to estimate
¬° 2n
n+k
¬¢
in the region where jkj is small. We
could use Stirling's approximation as it appears in Table 452, but it's easier
to work with the logarithmic equivalent in (9.91):
ln ak(n) = ln(2n)! ‚àíln(n + k)! ‚àíln(n ‚àík)!
= 2n ln 2n ‚àí2n + 1
2 ln 2n + œÉ + O(n‚àí1)
‚àí(n+k) ln(n+k) + n + k ‚àí1
2 ln(n+k) ‚àíœÉ + O
¬°
(n+k)‚àí1¬¢
‚àí(n‚àík) ln(n‚àík) + n ‚àík ‚àí1
2 ln(n‚àík) ‚àíœÉ + O
¬°
(n‚àík)‚àí1¬¢
.
(9.95)
We want to convert this to a nice, simple O estimate.
The tail-exchange method allows us to work with estimates that are valid
only when k is in the \dominant" set Dn. But how should we dene Dn?

9.6 FINAL SUMMATIONS 487
We have to make Dn small enough that we can make a good estimate; for
Actually I'm not
into dominance.
example, we had better not let k get near n, or the term O
¬°
(n ‚àík)‚àí1¬¢
in
(9.95) will blow up. Yet Dn must be large enough that the tail terms (the
terms with k /‚ààDn) are negligibly small compared with the overall sum. Trial
and error is usually necessary to nd an appropriate set Dn; in this problem
the calculations we are about to make will show that it's wise to dene things
as follows:
k ‚ààDn
‚áê‚áí
jkj  n1/2+œµ .
(9.96)
Here œµ is a small positive constant that we can choose later, after we get to
know the territory. (Our O estimates will depend on the value of œµ.) Equation
(9.95) now reduces to
ln ak(n) = (2n + 1
2) ln 2 ‚àíœÉ ‚àí1
2 ln n + O(n‚àí1)
‚àí(n+k+ 1
2) ln(1+k/n) ‚àí(n‚àík+ 1
2) ln(1‚àík/n) .
(9.97)
(We have pulled out the large parts of the logarithms, writing
ln(n ¬± k) = ln n + ln(1 ¬± k/n) ,
and this has made a lot of ln n terms cancel out.)
Now we need to expand the terms ln(1 ¬± k/n) asymptotically, until we
have an error term that approaches zero as n ‚Üí‚àû.
We are multiplying
ln(1 ¬± k/n) by (n ¬± k + 1
2), so we should expand the logarithm until we reach
o(n‚àí1), using the assumption that jkj  n1/2+œµ:
ln
¬≥
1 ¬± k
n
¬¥
= ¬± k
n ‚àík2
2n2 + O(n‚àí3/2+3œµ) .
Multiplication by n ¬± k + 1
2 yields
¬±k ‚àík2
2n + k2
n + O(n‚àí1/2+3œµ) ,
plus other terms that are absorbed in the O(n‚àí1/2+3œµ). So (9.97) becomes
ln ak(n) = (2n + 1
2) ln 2 ‚àíœÉ ‚àí1
2 ln n ‚àík2/n + O(n‚àí1/2+3œµ) .
Taking exponentials, we have
ak(n) = 22n+1/2
eœÉ‚àön e‚àík2/n¬°
1 + O(n‚àí1/2+3œµ)
¬¢
.
(9.98)

488 ASYMPTOTICS
This is our approximation, with
bk(n) = 22n+1/2
eœÉ‚àön e‚àík2/n ,
ck(n) = 22n n‚àí1+3œµ e‚àík2/n .
Notice that k enters bk(n) and ck(n) in a very simple way. We're in luck,
because we will be summing over k.
The tail-exchange trick tells us that P
k ak(n) will be approximately
P
k bk(n) if we have done a good job of estimation. Let us therefore evaluate
X
k
bk(n) = 22n+1/2
eœÉ‚àön
X
k
e‚àík2/n
= 22n+1/2
eœÉ‚àön Œòn = 22n‚àö
2œÄ
eœÉ
¬°
1 + O(n‚àíM)
¬¢
.
(Another stroke of luck: We get to use the sum Œòn from the previous exam-
What an amazing
coincidence.
ple.) This is encouraging, because we know that the original sum is actually
An =
X
k
¬µ2n
k
¬∂
= (1 + 1)2n = 22n .
Therefore it looks as if we will have eœÉ =
‚àö
2œÄ, as advertised.
But there's a catch: We still need to prove that our estimates are good
I'm tired of getting
to the end of long,
hard books and not
even getting a word
of good wishes from
the author. It would
be nice to read a
\thanks for reading
this, hope it comes
in handy," instead
of just running into
a hard, cold, card-
board cover at the
end of a long, dry
proof. You know?
enough. So let's look rst at the error contributed by ck(n):
Œ£c(n) =
X
jkjn1/2+œµ
22nn‚àí1+3œµe‚àík2/n  22nn‚àí1+3œµŒòn = O(22nn‚àí1
2 +3œµ) .
Good; this is asymptotically smaller than the previous sum, if 3œµ < 1
2.
Next we must check the tails. We have
X
k>n1/2+œµ
e‚àík2/n < exp
¬°
‚àí‚åän1/2+œµ‚åã2/n
¬¢
(1 + e‚àí1/n + e‚àí2/n + ¬∑ ¬∑ ¬∑ )
= O(e‚àín2œµ) ¬∑ O(n) ,
which is O(n‚àíM) for all M; so P
k/‚ààDn bk(n) is asymptotically negligible.
(We chose the cuto at n1/2+œµ just so that e‚àík2/n would be exponentially
small outside of Dn.
Other choices like n1/2 log n would have been good
enough too, and the resulting estimates would have been slightly sharper,
but the formulas would have come out more complicated. We need not make
the strongest possible estimates, since our main goal is to establish the value
of the constant œÉ.) Similarly, the other tail
X
k>n1/2+œµ
¬µ 2n
n + k
¬∂

9.6 FINAL SUMMATIONS 489
is bounded by 2n times its largest term, which occurs at the cuto point
k ‚âàn1/2+œµ. This term is known to be approximately bk(n), which is ex-
ponentially small compared with An; and an exponentially small multiplier
wipes out the factor of 2n.
Thus we have successfully applied the tail-exchange trick to prove the
estimate
22n =
X
k
¬µ2n
k
¬∂
=
‚àö
2œÄ
eœÉ 22n + O(22nn‚àí1
2 +3œµ) ,
if 0 < œµ < 1
6. (9.99)
We may choose œµ = 1
8 and conclude that
Thanks for reading
this, hope it comes
in handy.
|The authors
œÉ =
1
2 ln 2œÄ .
QED.
Exercises
Warmups
1
Prove or disprove: If f1(n) ‚â∫g1(n) and f2(n) ‚â∫g2(n), then we have
f1(n) + f2(n) ‚â∫g1(n) + g2(n).
2
Which function grows faster:
a
n(ln n) or (ln n)n?
b
n(ln ln ln n) or (ln n)!?
c
(n!)! or
¬°
(n ‚àí1)!
¬¢
! (n ‚àí1)!n!?
d
F2
‚åàHn‚åâor HFn ?
3
What's wrong with the following argument? \Since n = O(n) and 2n =
O(n) and so on, we have Pn
k=1 kn = Pn
k=1 O(n) = O(n2)."
4
Give an example of a valid equation that has O-notation on the left but
not on the right. (Do not use the trick of multiplying by zero; that's too
easy.) Hint: Consider taking limits.
5
Prove or disprove: O
¬°
f(n) + g(n)
¬¢
= f(n) + O
¬°
g(n)
¬¢
, if f(n) and g(n)
are positive for all n. (Compare with (9.27).)
6
Multiply
¬°
ln n + Œ≥ + O(1/n)
¬¢
by
¬°
n + O(‚àön )
¬¢
, and express your answer
in O-notation.
7
Estimate P
k0 e‚àík/n with absolute error O(n‚àí1).
Basics
8
Give an example of functions f(n) and g(n) such that none of the three
relations f(n) ‚â∫g(n), f(n) ‚âªg(n), f(n) ‚âçg(n) is valid, although f(n)
and g(n) both increase monotonically to ‚àû.

490 ASYMPTOTICS
9
Prove (9.22) rigorously by showing that the left side is a subset of the
right side, according to the set-of-functions denition of O.
10
Prove or disprove: cos O(x) = 1 + O(x2) for all real x.
11
Prove or disprove: O(x + y)2 = O(x2) + O(y2).
12
Prove that
1 + 2
n + O(n‚àí2) =
¬≥
1 + 2
n
¬¥¬°
1 + O(n‚àí2)
¬¢
,
as n ‚Üí‚àû.
13
Evaluate
¬°
n + 2 + O(n‚àí1)
¬¢n with relative error O(n‚àí1).
14
Prove that (n + Œ±)n+Œ≤ = nn+Œ≤eŒ±¬°
1 + Œ±(Œ≤ ‚àí1
2Œ±)n‚àí1 + O(n‚àí2)
¬¢
.
15
Give an asymptotic formula for the \middle" trinomial coecient
¬°
3n
n,n,n
¬¢
,
correct to relative error O(n‚àí3).
16
Show that if B(1 ‚àíx) = ‚àíB(x)  0 for 0 < x < 1
2, we have
Z b
a
B
¬°
fxg
¬¢
f(x) dx  0
if we assume also that f‚Ä≤(x)  0 for a  x  b.
17
Use generating functions to show that Bm( 1
2) = (21‚àím ‚àí1)Bm, for all
m  0.
18
Find P
k
¬°2n
k
¬¢Œ± with relative error O(n‚àí1/4), when Œ± > 0.
Homework exercises
19
Use a computer to compare the left and right sides of the approximations
in Table 452, when n = 10, z = Œ± = 0.1, and O
¬°
f(n)
¬¢
= O
¬°
f(z)
¬¢
= 0.
20
Prove or disprove the following estimates, as n ‚Üí‚àû:
a
O
√É¬µ
n2
log log n
¬∂1/2!
= O
¬°
‚åä‚àön‚åã2¬¢
.
b
e(1+O(1/n))2 = e + O(1/n) .
c
n! = O
¬≥¬°
(1 ‚àí1/n)nn
¬¢n¬¥
.
21
Equation (9.48) gives the nth prime with relative error O(log n)‚àí2. Im-
prove the relative error to O(log n)‚àí3 by starting with another term of
(9.31) in (9.46).
22
Improve (9.54) to O(n‚àí3).
23
Push the approximation (9.62) further, getting absolute error O(n‚àí3).
Hint: Let gn = c/(n + 1)(n + 2) + hn; what recurrence does hn satisfy?

9 EXERCISES 491
24
Suppose an = O
¬°
f(n)
¬¢
and bn = O
¬°
f(n)
¬¢
. Prove or disprove that the
convolution Pn
k=0 akbn‚àík is also O
¬°
f(n)
¬¢
, in the following cases:
a
f(n) = n‚àíŒ±, Œ± > 1.
b
f(n) = Œ±‚àín, Œ± > 1.
25
Prove (9.1) and (9.2), with which we opened this chapter.
26
Equation (9.91) shows how to evaluate ln 10! with an absolute error
<
1
126000000. Therefore if we take exponentials, we get 10! with a relative
error that is less than e1/126000000 ‚àí1 < 10‚àí8. (In fact, the approxima-
tion gives 3628799.9714.) If we now round to the nearest integer, knowing
that 10! is an integer, we get an exact result.
Is it always possible to calculate n! in a similar way, if enough terms of
Stirling's approximation are computed? Estimate the value of m that
gives the best approximation to ln n!, when n is a xed (large) integer.
Compare the absolute error in this approximation with n! itself.
27
Use Euler's summation formula to nd the asymptotic value of H(‚àíŒ±)
n
=
Pn
k=1 kŒ±, where Œ± is any xed real number. (Your answer may involve
a constant that you do not know in closed form.)
28
Exercise 5.13 denes the hyperfactorial function Qn = 1122 . . . nn. Find
the asymptotic value of Qn with relative error O(n‚àí1). (Your answer
may involve a constant that you do not know in closed form.)
29
Estimate the function 11/121/2 . . . n1/n as in the previous exercise.
30
Find the asymptotic value of P
k0 kle‚àík2/n with absolute error O(n‚àí3),
when l is a xed nonnegative integer.
31
Evaluate P
k0 1/(ck + cm) with absolute error O(c‚àí3m), when c > 1
and m is a positive integer.
Exam problems
32
Evaluate eHn+H(2)
n
with absolute error O(n‚àí1).
33
Evaluate P
k0
¬°n
k
¬¢
/nk with absolute error O(n‚àí3).
34
Determine values A through F such that (1 + 1/n)nHn is
An + B(ln n)2 + C ln n + D + E(ln n)2
n
+ F ln n
n
+ O(n‚àí1) .
35
Evaluate Pn
k=1 1/kHk with absolute error O(1).
36
Evaluate Sn = Pn
k=1 1/(n2 + k2) with absolute error O(n‚àí5).
37
Evaluate Pn
k=1(n mod k) with absolute error O(n log n).
38
Evaluate P
k0 kk¬°n
k
¬¢
with relative error O(n‚àí1).

492 ASYMPTOTICS
39
Evaluate P
0k<n ln(n ‚àík)(ln n)k/k! with absolute error O(n‚àí1). Hint:
Show that the terms for k  10 ln n are negligible.
40
Let m be a (xed) positive integer. Evaluate Pn
k=1(‚àí1)kHm
k with abso-
lute error O(1).
41
Evaluate the \Fibonacci factorial" Qn
k=1 Fk with relative error O(n‚àí1)
or better. Your answer may involve a constant whose value you do not
know in closed form.
42
Let Œ± be a constant in the range 0 < Œ± < 1
2. We've seen in previous
chapters that there is no general closed form for the sum P
kŒ±n
¬°n
k
¬¢
.
Show that there is, however, an asymptotic formula
X
kŒ±n
¬µn
k
¬∂
= 2nH(Œ±)‚àí1
2 lg n+O(1) ,
where H(Œ±) = Œ± lg 1
Œ± +(1‚àíŒ±) lg(
1
1‚àíŒ±). Hint: Show that
¬° n
k‚àí1
¬¢
<
Œ±
1‚àíŒ±
¬°n
k
¬¢
for 0 < k  Œ±n.
43
Show that Cn, the number of ways to change n cents (as considered in
Chapter 7) is asymptotically cn4 + O(n3) for some constant c. What is
that constant?
44
Prove that
x1/2 = x1/2
¬∑1/2
1/2
¬∏
‚àíx‚àí1/2
¬∑ 1/2
‚àí1/2
¬∏
+ x‚àí3/2
¬∑ 1/2
‚àí3/2
¬∏
+ O(x‚àí5/2)
as x ‚Üí‚àû. (Recall the denition x1/2 = x!/(x ‚àí1
2)! in (5.88), and the
denition of generalized Stirling numbers in Table 272.)
45
Let Œ± be an irrational number between 0 and 1. Chapter 3 discusses the
quantity D(Œ±, n), which measures the maximum discrepancy by which
the fractional parts fkŒ±g for 0  k < n deviate from a uniform distribu-
tion. The recurrence
D(Œ±, n)  D
¬°
fŒ±‚àí1g, ‚åäŒ±n‚åã
¬¢
+ Œ±‚àí1 + 2
was proved in (3.31); we also have the obvious bounds
0  D(Œ±, n)  n .
Prove that limn‚Üí‚àûD(Œ±, n)/n = 0. Hint: Chapter 6 discusses continued
fractions.

9 EXERCISES 493
46
Show that the Bell number œñn = e‚àí1 P
k0 kn/k! of exercise 7.15 is
asymptotically equal to
m(n)nem(n)‚àín‚àí1/2/
‚àö
ln n ,
where m(n) ln m(n) = n ‚àí1
2, and estimate the relative error in this
approximation.
47
Let m be an integer  2. Analyze the two sums
n
X
k=1
‚åälogm k‚åã
and
n
X
k=1
‚åàlogm k‚åâ;
which is asymptotically closer to logm n! ?
48
Consider a table of the harmonic numbers Hk for 1  k  n in decimal
notation. The kth entry bHk has been correctly rounded to dk signicant
digits, where dk is just large enough to distinguish this value from the
values of Hk‚àí1 and Hk+1. For example, here is an extract from the table,
showing ve entries where Hk passes 10:
k
Hk
bHk
dk
12364
9.99980041‚àí
9.9998
5
12365
9.99988128+
9.9999
5
12366
9.99996215‚àí
9.99996
6
12367
10.00004301‚àí
10.0000
6
12368
10.00012386+
10.0001
6
Estimate the total number of digits in the table, Pn
k=1 dk, with an ab-
solute error of O(n).
49
In Chapter 6 we considered the tale of a worm that reaches the end of a
stretching band after n seconds, where Hn‚àí1 < 100  Hn. Prove that if
n is a positive integer such that Hn‚àí1  Œ±  Hn, then
‚åäeŒ±‚àíŒ≥‚åã n  ‚åàeŒ±‚àíŒ≥‚åâ.
50
Venture capitalists in Silicon Valley are being oered a deal giving them
a chance for an exponential payo on their investments: For an n mil-
lion dollar investment, where n  2, the GKP consortium promises to
pay up to N million dollars after one year, where N = 10n. Of course
there's some risk; the actual deal is that GKP pays k million dollars with
probability 1/(k2H(2)
N ), for each integer k in the range 1  k  N. (All
payments are in megabucks, that is, in exact multiples of $1,000,000; the
payo is determined by a truly random process.) Notice that an investor
always gets at least a million dollars back.

494 ASYMPTOTICS
a
What is the asymptotic expected return after one year, if n million
dollars are invested? (In other words, what is the mean value of the
payment?) Your answer should be correct within an absolute error
I once earned
O(10‚àín) dollars.
of O(10‚àín) dollars.
b
What is the asymptotic probability that you make a prot, if you
invest n million? (In other words, what is the chance that you get
back more than you put in?) Your answer here should be correct
within an absolute error of O(n‚àí3).
Bonus problems
51
Prove or disprove:
R‚àû
n O(x‚àí2) dx = O(n‚àí1) as n ‚Üí‚àû.
52
Show that there exists a power series A(z) = P
k0 anzn, convergent for
all complex z, such that
A(n) ‚âªnnn¬∑¬∑¬∑n ¬Æ
n .
53
Prove that if f(x) is a function whose derivatives satisfy
f‚Ä≤(x)  0 ,
‚àíf‚Ä≤‚Ä≤(x)  0 ,
f‚Ä≤‚Ä≤‚Ä≤(x)  0 ,
. . . ,
(‚àí1)mf(m+1)(x)  0
for all x  0, then we have
f(x) = f(0) + f‚Ä≤(0)
1! x + ¬∑ ¬∑ ¬∑ + f(m‚àí1)(0)
(m ‚àí1)! xm‚àí1 + O(xm) ,
for x  0.
In particular, the case f(x) = ‚àíln(1 + x) proves (9.64) for all k, n > 0.
54
Let f(x) be a positive, dierentiable function such that xf‚Ä≤(x) ‚â∫f(x) as
x ‚Üí‚àû. Prove that
X
kn
f(k)
k1+Œ± = O
¬µf(n)
nŒ±
¬∂
,
if Œ± > 0.
Hint: Consider the quantity f(k ‚àí1
2)/(k ‚àí1
2)Œ± ‚àíf(k + 1
2)/(k + 1
2)Œ±.
55
Improve (9.99) to relative error O(n‚àí3/2+5œµ).
56
The quantity Q(n) = 1 + n‚àí1
n
+ n‚àí1
n
n‚àí2
n
+ ¬∑ ¬∑ ¬∑ = P
k1 nk/nk occurs in
the analysis of many algorithms. Find its asymptotic value, with absolute
error o(1).
57
An asymptotic formula for Golomb's sum P
k1 1/k‚åä1 + logn k‚åã2 is de-
rived in (9.54). Find an asymptotic formula for the analogous sum with-
out oor brackets, P
k1 1/k(1 + logn k)2. Hint: Consider the integral
R‚àû
0 ue‚àíuk‚àítu du = 1/(1 + t ln k)2.

9 EXERCISES 495
58
Prove that
Bm
¬°
fxg
¬¢
= ‚àí2
m!
(2œÄ)m
X
k1
cos(2œÄkx ‚àí1
2œÄm)
km
,
for m  2,
by using residue calculus, integrating
1
2œÄi
I 2œÄi e2œÄizŒ∏
e2œÄiz ‚àí1
dz
zm
on the square contour z = x+iy, where max
¬°
jxj, jyj
¬¢
= M+ 1
2, and letting
the integer M tend to ‚àû.
59
Let Œòn(t) = P
k e‚àí(k+t)2/n, a periodic function of t.
Show that the
expansion of Œòn(t) as a Fourier series is
Œòn(t) = ‚àöœÄn
¬°
1 + 2e‚àíœÄ2n(cos 2œÄt) + 2e‚àí4œÄ2n(cos 4œÄt)
+ 2e‚àí9œÄ2n(cos 6œÄt) + ¬∑ ¬∑ ¬∑
¬¢
.
(This formula gives a rapidly convergent series for the sum Œòn = Œòn(0)
in equation (9.93).)
60
Explain why the coecients in the asymptotic expansion
¬µ2n
n
¬∂
=
4n
‚àöœÄn
¬µ
1 ‚àí1
8n +
1
128n2 +
5
1024n3 ‚àí
21
32768n4 + O(n‚àí5)
¬∂
all have denominators that are powers of 2.
61
Exercise 45 proves that the discrepancy D(Œ±, n) is o(n) for all irrational
numbers Œ±. Exhibit an irrational Œ± such that D(Œ±, n) is not O(n1‚àíœµ)
for any œµ > 0.
62
Given n, let
¬©
n
m(n)
¬™
= maxk
¬©n
k
¬™
be the largest entry in row n of Stirling's
subset triangle. Show that for all suciently large n, we have m(n) =
‚åäm(n)‚åãor m(n) = ‚åàm(n)‚åâ, where
m(n)(m(n) + 2) ln(m(n) + 2) = n(m(n) + 1) .
Hint: This is dicult.
63
Prove that S. W. Golomb's self-describing sequence of exercise 2.36 sat-
ises f(n) = œÜ2‚àíœÜnœÜ‚àí1 + O(nœÜ‚àí1/log n).
64
Find a proof of the identity
X
n1
cos 2nœÄx
n2
= œÄ2¬°
x2 ‚àíx + 1
6
¬¢
for 0  x  1,
that uses only \Eulerian" (eighteenth-century) mathematics.

496 ASYMPTOTICS
65
What are the coecients of the asymptotic series
1+
1
n‚àí1 +
1
(n‚àí1)(n‚àí2) +¬∑ ¬∑ ¬∑+
1
(n‚àí1)!
= a0+ a1
n + a2
n2 +¬∑ ¬∑ ¬∑ ?
Research problems
66
Find a \combinatorial" proof of Stirling's approximation. (Note that nn
is the number of mappings of f1, 2, . . . , ng into itself, and n! is the number
of mappings of f1, 2, . . . , ng onto itself.)
67
Consider an n √ó n array of dots, n  3, in which each dot has four
neighbors. (At the edges we \wrap around" modulo n.) Let œán be the
number of ways to assign the colors red, white, and blue to these dots in
such a way that no neighboring dots have the same color. (Thus œá3 = 12.)
Prove that
œán ‚àº
¬° 4
3
¬¢3n2/2e‚àíœÄ/6 .
68
Let Qn be the least integer m such that Hm > n. Find the smallest
integer n such that Qn Ã∏= ‚åäen‚àíŒ≥ + 1
2‚åã, or prove that no such n exist.
Th-th-th-that's all,
folks!

A
Answers to Exercises
EVERY EXERCISE is answered here (at least briey), and some of these
answers go beyond what was asked. Readers will learn best if they make a
serious attempt to nd their own answers before peeking at this appendix.
The authors will be interested to learn of any solutions (or partial
solutions) to the research problems, or of any simpler (or more correct) ways
(The rst nder of
every error in this
book will receive
a reward of $2.56.)
Does that mean
I have to nd every
error?
(We meant to say
\any error.")
Does that mean
only one person gets
a reward?
(Hmmm. Try it and
see.)
to solve the non-research ones.
1.1
The proof is ne except when n = 2. If all sets of two horses have
horses of the same color, the statement is true for any number of horses.
1.2
If Xn is the number of moves, we have X0 = 0 and Xn = Xn‚àí1 + 1 +
Xn‚àí1 + 1 + Xn‚àí1 when n > 0. It follows (for example by adding 1 to both
sides) that Xn = 3n ‚àí1. (After 1
2Xn moves, it turns out that the entire tower
will be on the middle peg, halfway home!)
1.3
There are 3n possible arrangements, since each disk can be on any of
the pegs. We must hit them all, since the shortest solution takes 3n‚àí1 moves.
(This construction is equivalent to a \ternary Gray code," which runs through
all numbers from (0 . . . 0)3 to (2 . . . 2)3, changing only one digit at a time.)
1.4
No. If the largest disk doesn't have to move, 2n‚àí1‚àí1 moves will suce
(by induction); otherwise (2n‚àí1 ‚àí1) + 1 + (2n‚àí1 ‚àí1) will suce (again by
induction).
1.5
No; dierent circles can intersect in at most two points, so the fourth
The number of
intersection points
turns out to give
the whole story;
convexity was a red
herring.
circle can increase the number of regions to at most 14. However, it is possible
to do the job with ovals:
'$
&%
'$
&%
'
$
&
%
'
$
&
%
497

498 ANSWERS TO EXERCISES
Venn [359] claimed that there is no way to do the ve-set case with ellipses,
but a ve-set construction with ellipses was found by Grunbaum [167].
1.6
If the nth line intersects the previous lines in k > 0 distinct points, we
This answer as-
sumes that n > 0.
get k‚àí1 new bounded regions (assuming that none of the previous lines were
mutually parallel) and two new innite regions. Hence the maximum number
of bounded regions is (n‚àí2)+(n‚àí3)+¬∑ ¬∑ ¬∑ = Sn‚àí2 = (n‚àí1)(n‚àí2)/2 = Ln‚àí2n.
1.7
The basis is unproved; and in fact, H(1) Ã∏= 2.
1.8
Q2 = (1 + Œ≤)/Œ±; Q3 = (1 + Œ± + Œ≤)/Œ±Œ≤; Q4 = (1 + Œ±)/Œ≤; Q5 = Œ±;
Q6 = Œ≤. So the sequence is periodic!
1.9
(a) We get P(n ‚àí1) from the inequality
x1 . . . xn‚àí1
¬µx1 + ¬∑ ¬∑ ¬∑ + xn‚àí1
n ‚àí1
¬∂

¬µx1 + ¬∑ ¬∑ ¬∑ + xn‚àí1
n ‚àí1
¬∂n
.
(b) x1 . . . xnxn+1 . . . x2n 
¬°
((x1 + ¬∑ ¬∑ ¬∑ + xn)/n)((xn+1 + ¬∑ ¬∑ ¬∑ + x2n)/n)
¬¢n by
P(n); the product inside is 
¬°
(x1 +¬∑ ¬∑ ¬∑+x2n)/2n
¬¢2 by P(2). (c) For example,
P(5) follows from P(6) from P(3) from P(4) from P(2).
1.10
First show that Rn = Rn‚àí1 + 1 + Qn‚àí1 + 1 + Rn‚àí1, when n > 0.
Incidentally, the methods of Chapter 7 will tell us that Qn =
¬°
(1+
‚àö
3 )n+1 ‚àí
(1 ‚àí
‚àö
3 )n+1¬¢¬±¬°
2
‚àö
3
¬¢
‚àí1.
1.11
(a) We cannot do better than to move a double (n ‚àí1)-tower, then
move (and invert the order of) the two largest disks, then move the double
(n ‚àí1)-tower again; hence An = 2An‚àí1 + 2 and An = 2Tn = 2n+1 ‚àí2. This
solution interchanges the two largest disks but returns the other 2n ‚àí2 to
their original order.
(b) Let Bn be the minimum number of moves. Then B1 = 3, and it can
be shown that no strategy does better than Bn = An‚àí1 +2+An‚àí1 +2+Bn‚àí1
when n > 1. Hence Bn = 2n+2‚àí5, for all n > 0. Curiously this is just 2An‚àí1,
and we also have Bn = An‚àí1 + 1 + An‚àí1 + 1 + An‚àí1 + 1 + An‚àí1.
1.12
If all mk > 0, then A(m1, . . . , mn) = 2A(m1, . . . , mn‚àí1)+mn. This is
an equation of the \generalized Josephus" type, with solution (m1 . . . mn)2 =
2n‚àí1m1 + ¬∑ ¬∑ ¬∑ + 2mn‚àí1 + mn.
Incidentally, the corresponding generalization of exercise 11b appears
to satisfy the recurrence
B(m1, . . . , mn) =
Ô£±
Ô£¥
Ô£¥
Ô£≤
Ô£¥
Ô£¥
Ô£≥
A(m1, . . . , mn),
if mn = 1;
2mn ‚àí1,
if n = 1;
2A(m1, . . . , mn‚àí1) + 2mn
+ B(m1, . . . , mn‚àí1),
if n > 1 and mn > 1.

A ANSWERS TO EXERCISES 499
1.13
Given n straight lines that dene Ln regions, we can replace them
by extremely narrow zig-zags with segments suciently long that there are
nine intersections between each pair of zig-zags.
This shows that ZZn =
ZZn‚àí1+9n‚àí8, for all n > 0; consequently ZZn = 9Sn‚àí8n+1 = 9
2n2‚àí7
2n+1.
1.14
The number of new 3-dimensional regions dened by each new cut is
the number of 2-dimensional regions dened in the new plane by its intersec-
tions with the previous planes. Hence Pn = Pn‚àí1 + Ln‚àí1, and it turns out
that P5 = 26. (Six cuts in a cubical piece of cheese can make 27 cubelets, or
up to P6 = 42 cuts of weirder shapes.)
Incidentally, the solution to this recurrence ts into a nice pattern if
we express it in terms of binomial coecients (see Chapter 5):
Xn =
¬µn
0
¬∂
+
¬µn
1
¬∂
;
Ln =
¬µn
0
¬∂
+
¬µn
1
¬∂
+
¬µn
2
¬∂
;
Pn =
¬µn
0
¬∂
+
¬µn
1
¬∂
+
¬µn
2
¬∂
+
¬µn
3
¬∂
.
Here Xn is the maximum number of 1-dimensional regions denable by n
points on a line.
I bet I know what
happens in four
dimensions!
1.15
The function I satises the same recurrence as J when n > 1, but I(1)
is undened. Since I(2) = 2 and I(3) = 1, there's no value of I(1) = Œ± that
will allow us to use our general method; the \end game" of unfolding depends
on the two leading bits in n's binary representation.
If n = 2m + 2m‚àí1 + k, where 0  k < 2m+1 + 2m ‚àí(2m + 2m‚àí1) =
2m+2m‚àí1, the solution is I(n) = 2k+1 for all n > 2. Another way to express
this, in terms of the representation n = 2m + l, is to say that
I(n) =
¬Ø J(n) + 2m‚àí1,
if 0  l < 2m‚àí1;
J(n) ‚àí2m,
if 2m‚àí1  l < 2m.
1.16
Let g(n) = a(n)Œ± + b(n)Œ≤0 + c(n)Œ≤1 + d(n)Œ≥. We know from (1.18)
that a(n)Œ± + b(n)Œ≤0 + c(n)Œ≤1 = (Œ± Œ≤bm‚àí1 Œ≤bm‚àí2 . . . Œ≤b1 Œ≤b0)3 when n =
(1 bm‚àí1 . . . b1 b0)2; this denes a(n), b(n), and c(n). Setting g(n) = n in the
recurrence implies that a(n) + c(n) ‚àíd(n) = n; hence we know everything.
[Setting g(n) = 1 gives the additional identity a(n) ‚àí2b(n) ‚àí2c(n) = 1,
which can be used to dene b(n) in terms of the simpler functions a(n) and
a(n) + c(n).]
1.17
In general we have Wm  2Wm‚àík + Tk, for 0  k  m. (This relation
corresponds to transferring the top m ‚àík, then using only three pegs to

500 ANSWERS TO EXERCISES
move the bottom k, then nishing with the top m ‚àík.) The stated relation
turns out to be based on the unique value of k that minimizes the right-
hand side of this general inequality, when m = n(n + 1)/2. (However, we
cannot conclude that equality holds; many other strategies for transferring
the tower are conceivable.) If we set Yn = (Wn(n+1)/2 ‚àí1)/2n, we nd that
Yn  Yn‚àí1 + 1; hence Wn(n+1)/2  2n(n ‚àí1) + 1.
1.18
It suces to show that both of the lines from (n2j, 0) intersect both of
the lines from (n2k, 0), and that all these intersection points are distinct.
A line from (xj, 0) through (xj ‚àíaj, 1) intersects a line from (xk, 0)
through (xk ‚àíak, 1) at the point (xj ‚àítaj, t) where t = (xk ‚àíxj)/(ak ‚àíaj).
Let xj = n2j and aj = nj + (0 or n‚àín). Then the ratio t = (n2k ‚àín2j)/
¬°
nk ‚àínj + (‚àín‚àín or 0 or n‚àín)
¬¢
lies strictly between nj + nk ‚àí1 and nj +
nk + 1; hence the y coordinate of the intersection point uniquely identies j
and k. Also the four intersections that have the same j and k are distinct.
1.19
Not when n > 11. A bent line whose half-lines run at angles Œ∏ and
Œ∏ + 30‚ó¶from its apex can intersect four times with another whose half-lines
run at angles œÜ and œÜ + 30‚ó¶only if jŒ∏ ‚àíœÜj > 30‚ó¶. We can't choose more
than 11 angles this far apart from each other. (Is it possible to choose 11?)
1.20
Let h(n) = a(n)Œ± + b(n)Œ≤0 + c(n)Œ≤1 + d(n)Œ≥0 + e(n)Œ≥1. We know
from (1.18) that a(n)Œ± + b(n)Œ≤0 + c(n)Œ≤1 = (Œ± Œ≤bm‚àí1 Œ≤bm‚àí2 . . . Œ≤b1 Œ≤b0)4
when n = (1 bm‚àí1 . . . b1 b0)2; this denes a(n), b(n), and c(n).
Setting
h(n) = n in the recurrence implies that a(n) + c(n) ‚àí2d(n) ‚àí2e(n) = n;
setting h(n) = n2 implies that a(n) + c(n) + 4e(n) = n2. Hence d(n) =
¬°
3a(n) + 3c(n) ‚àín2 ‚àí2n
¬¢
/4; e(n) =
¬°
n2 ‚àía(n) ‚àíc(n)
¬¢
/4.
1.21
We can let m be the least (or any) common multiple of 2n, 2n ‚àí1,
. . . , n + 1. [A non-rigorous argument suggests that a \random" value of m
will succeed with probability
n
2n
n ‚àí1
2n ‚àí1 . . .
1
n + 1 = 1
√Å¬µ2n
n
¬∂
‚àº
‚àöœÄn
4n
,
so we might expect to nd such an m less than 4n.]
1.22
Take a regular polygon with 2n sides and label the sides with the
I once rode a
de Bruijn cycle
(when visiting at
his home in Nuenen,
The Netherlands).
elements of a \de Bruijn cycle" of length 2n. (This is a cyclic sequence of
0's and 1's in which all n-tuples of adjacent elements are dierent; see [207,
exercise 2.3.4.2{23] and [208, exercise 3.2.2{17].) Attach a very thin convex
extension to each side that's labeled 1. The n sets are copies of the resulting
polygon, rotated by the length of k sides for k = 0, 1, . . . , n ‚àí1.
1.23
Yes. (We need principles of elementary number theory from Chap-
ter 4.) Let L(n) = lcm(1, 2, . . . , n). We can assume that n > 2; hence by
Bertrand's postulate there is a prime p between n/2 and n. We can also

A ANSWERS TO EXERCISES 501
assume that j > n/2, since q‚Ä≤ = L(n) + 1 ‚àíq leaves j‚Ä≤ = n + 1 ‚àíj if and
only if q leaves j. Choose q so that q ‚â°1 (mod L(n)/p) and q ‚â°j + 1 ‚àín
(mod p). The people are now removed in order 1, 2, . . . , n ‚àíp, j + 1, j + 2,
. . . , n, n ‚àíp + 1, . . . , j ‚àí1.
1.24
The only known examples are: Xn = 1/Xn‚àí1, which has period 2;
Gauss's recurrence of period 5 in exercise 8; H. Todd's even more remarkable
recurrence Xn = (1+Xn‚àí1 +Xn‚àí2)/Xn‚àí3, which has period 8 (see [261]); and
recurrences derived from these when we replace Xn by a constant times Xmn.
We can assume that the rst nonzero coecient in the denominator is unity,
and that the rst nonzero coecient in the numerator (if any) has nonnegative
real part. Computer algebra shows easily that there are no further solutions of
period  5 when k = 2. A partial theory has been developed by Lyness [261,
262] and by Kurshan and Gopinath [231].
An interesting example of another type, with period 9 when the start-
ing values are real, is the recurrence Xn = jXn‚àí1j‚àíXn‚àí2 discovered by Morton
Brown [43]. Nonlinear recurrences having any desired period  5 can be based
on continuants [65].
1.25
If T (k)(n) denotes the minimum number of moves needed to transfer n
disks with k auxiliary pegs (hence T (1)(n) = Tn and T (2)(n) = Wn), we have
T (k)(
¬°n+1
k
¬¢
)  2T (k)(
¬°n
k
¬¢
) + T (k‚àí1)(
¬° n
k‚àí1
¬¢
).
No examples (n, k) are known
where this inequality fails to be an equality. When k is small compared with
n, the formula 2n+1‚àík¬°n‚àí1
k‚àí1
¬¢
gives a convenient (but non-optimum) upper
bound on T (k)(
¬°n
k
¬¢
).
1.26
The execution-order permutation can be computed in O(n log n) steps
for all m and n [209, exercises 5.1.1{2 and 5.1.1{5]. Bjorn Poonen has proved
that non-Josephus sets with exactly four \bad guys" exist whenever n ‚â°0
(mod 3) and n  9; in fact, the number of such sets is at least œµ
¬°n
4
¬¢
for some
œµ > 0. He also found by extensive computations that the only other n < 24
with non-Josephus sets is n = 20, which has 236 such sets with k = 14 and
two with k = 13. (One of the latter is f1, 2, 3, 4, 5, 6, 7, 8, 11, 14, 15, 16, 17g; the
other is its reection with respect to 21.) There is a unique non-Josephus set
with n = 15 and k = 9, namely f3, 4, 5, 6, 8, 10, 11, 12, 13g.
2.1
There's no agreement about this; three answers are defensible: (1) We
can say that Pn
k=m qk is always equivalent to P
mkn qk; then the stated
sum is zero. (2) A person might say that the given sum is q4 + q3 + q2 +
q1 + q0, by summing over decreasing values of k. But this conicts with the
generally accepted convention that Pn
k=1 qk = 0 when n = 0. (3) We can
say that Pn
k=m qk = P
kn qk ‚àíP
k<m qk; then the stated sum is equal to
‚àíq1 ‚àíq2 ‚àíq3. This convention may appear strange, but it obeys the useful
law Pb
k=a + Pc
k=b+1 = Pc
k=a for all a, b, c.

502 ANSWERS TO EXERCISES
It's best to use the notation Pn
k=m only when n ‚àím  ‚àí1; then both
conventions (1) and (3) agree.
2.2
This is jxj. Incidentally, the quantity
¬°
[x > 0] ‚àí[x < 0]
¬¢
is often called
sign(x) or signum(x); it is +1 when x > 0, 0 when x = 0, and ‚àí1 when x < 0.
2.3
The rst sum is, of course, a0+a1+a2+a3+a4+a5; the second is a4+
a1 + a0 + a1 + a4, because the sum is over the values k ‚ààf‚àí2, ‚àí1, 0, +1, +2g.
The commutative law doesn't hold here because the function p(k) = k2 is not
a permutation. Some values of n (e.g., n = 3) have no k such that p(k) = n;
others (e.g., n = 4) have two such k.
2.4
(a) P4
i=1
P4
j=i+1
P4
k=j+1 aijk = P2
i=1
P3
j=i+1
P4
k=j+1 aijk =
¬°
(a123 + a124) + a134
¬¢
+ a234.
(b) P4
k=1
Pk‚àí1
j=1
Pj‚àí1
i=1 aijk = P4
k=3
Pk‚àí1
j=2
Pj‚àí1
i=1 aijk = a123 +
¬°
a124 +
(a134 + a234)
¬¢
.
2.5
The same index `k' is being used for two dierent index variables, al-
though k is bound in the inner sum. This is a famous mistake in mathematics
(and computer programming). The result turns out to be correct if aj = ak
for all j and k, 1  j, k  n.
2.6
It's [1  j  n](n ‚àíj + 1). The rst factor is necessary here because we
should get zero when j < 1 or j > n.
2.7
mxm‚àí1. A version of nite calculus based on ‚àáinstead of ‚àÜwould
therefore give special prominence to rising factorial powers.
2.8
0, if m  1; 1/jmj!, if m  0.
2.9
xm+n = xm (x + m)n, for integers m and n. Setting m = ‚àín tells us
that x‚àín = 1/(x ‚àín)n = 1/(x ‚àí1)n.
2.10
Another possible right-hand side is Eu ‚àÜv + v ‚àÜu.
2.11
Break the left-hand side into two sums, and change k to k + 1 in the
second of these.
2.12
If p(k) = n then n + c = k +
¬°
(‚àí1)k + 1
¬¢
c and
¬°
(‚àí1)k + 1
¬¢
is even;
hence (‚àí1)n+c = (‚àí1)k and k = n ‚àí(‚àí1)n+cc. Conversely, this value of k
yields p(k) = n.
2.13
Let R0 = Œ±, and Rn = Rn‚àí1 + (‚àí1)n(Œ≤ + nŒ≥ + n2Œ¥) for n > 0. Then
R(n) = A(n)Œ± + B(n)Œ≤ + C(n)Œ≥ + D(n)Œ¥. Setting Rn = 1 yields A(n) = 1.
Setting Rn = (‚àí1)n yields A(n) + 2B(n) = (‚àí1)n. Setting Rn = (‚àí1)nn
yields ‚àíB(n)+2C(n) = (‚àí1)nn. Setting Rn = (‚àí1)nn2 yields B(n)‚àí2C(n)+
2D(n) = (‚àí1)nn2. Therefore 2D(n) = (‚àí1)n(n2+n); the stated sum is D(n).

A ANSWERS TO EXERCISES 503
2.14
The suggested rewrite is legitimate since we have k = P
1jk 1 when
1  k  n. Sum rst on k; the multiple sum reduces to
X
1jn
(2n+1 ‚àí2j) = n2n+1 ‚àí(2n+1 ‚àí2) .
2.15
The rst step replaces k(k + 1) by 2 P
1jk j. The second step gives
n +
n =
¬°Pn
k=1 k
¬¢2 +
n.
2.16
xm(x ‚àím)n = xm+n = xn(x ‚àín)m, by (2.52).
2.17
Use induction for the rst two ='s, and (2.52) for the third. The second
line follows from the rst.
2.18
Use the facts that (<z)+  jzj, (<z)‚àí jzj, (=z)+  jzj, (=z)‚àí jzj,
and jzj  (<z)+ + (<z)‚àí+ (=z)+ + (=z)‚àí.
2.19
Multiply both sides by 2n‚àí1/n! and let Sn = 2nTn/n!= Sn‚àí1 + 3 ¬∑
2n‚àí1 = 3(2n ‚àí1) + S0. The solution is Tn = 3 ¬∑ n! + n!/2n‚àí1. (We'll see in
Chapter 4 that Tn is an integer only when n is 0 or a power of 2.)
2.20
The perturbation method gives
\It is a profoundly
erroneous truism,
repeated by all
copybooks and by
eminent people
when they are
making speeches,
that we should
cultivate the habit
of thinking of what
we are doing. The
precise opposite is
the case. Civiliza-
tion advances by
extending the num-
ber of important
operations which
we can perform
without thinking
about them. Opera-
tions of thought are
like cavalry charges
in a battle|they
are strictly limited
in number, they
require fresh horses,
and must only be
made at decisive
moments."
|A.N. White-
head [370]
Sn + (n + 1)Hn+1 = Sn +
¬µ X
0kn
Hk
¬∂
+ n + 1 .
2.21
Extracting the nal term of Sn+1 gives Sn+1 = 1 ‚àíSn; extracting the
rst term gives
Sn+1 = (‚àí1)n+1 +
X
1kn+1
(‚àí1)n+1‚àík = (‚àí1)n+1 +
X
0kn
(‚àí1)n‚àík
= (‚àí1)n+1 + Sn .
Hence 2Sn = 1 + (‚àí1)n and we have Sn = [n is even]. Similarly, we nd
Tn+1 = n + 1 ‚àíTn =
n
X
k=0
(‚àí1)n‚àík(k + 1) = Tn + Sn ,
hence 2Tn = n + 1 ‚àíSn and we have Tn = 1
2
¬°
n + [n is odd]
¬¢
. Finally, the
same approach yields
Un+1 = (n + 1)2 ‚àíUn = Un + 2Tn + Sn
= Un + n + [n is odd] + [n is even]
= Un + n + 1 .
Hence Un is the triangular number 1
2(n + 1)n.

504 ANSWERS TO EXERCISES
2.22
Twice the general sum gives a \vanilla" sum over 1  j, k  n, which
splits and yields twice
¬°P
k akAk
¬¢¬°P
k bkBk
¬¢
‚àí
¬°P
k akBk
¬¢¬°P
k bkAk
¬¢
.
2.23
(a) This approach gives four sums that evaluate to 2n + Hn ‚àí2n +
(Hn +
1
n+1 ‚àí1).
(It would have been easier to replace the summand by
1/k + 1/(k + 1).) (b) Let u(x) = 2x + 1 and ‚àÜv(x) = 1/x(x + 1) = (x ‚àí1)‚àí2;
then ‚àÜu(x) = 2 and v(x) = ‚àí(x ‚àí1)‚àí1 = ‚àí1/x. The answer is 2Hn ‚àí
n
n+1.
2.24
Summing by parts, P xmHx Œ¥x = xm+1Hx/(m+1)‚àíxm+1/(m+1)2 +
C; hence P
0k<n kmHk = nm+1¬°
Hn ‚àí1/(m+1)
¬¢
/(m+1)+0m+1/(m+1)2.
In our case m = ‚àí2, so the sum comes to 1 ‚àí(Hn + 1)/(n + 1).
2.25
Here are some of the basic analogies:
X
k‚ààK
cak = c
X
k‚ààK
ak
‚Üê‚Üí
Y
k‚ààK
ac
k =
¬µY
k‚ààK
ak
¬∂c
X
k‚ààK
(ak+bk) =
X
k‚ààK
ak +
X
k‚ààK
bk ‚Üê‚Üí
Y
k‚ààK
akbk =
¬µY
k‚ààK
ak
¬∂¬µY
k‚ààK
bk
¬∂
X
k‚ààK
ak =
X
p(k)‚ààK
ap(k)
‚Üê‚Üí
Y
k‚ààK
ak =
Y
p(k)‚ààK
ap(k)
X
j‚ààJ
k‚ààK
aj,k =
X
j‚ààJ
X
k‚ààK
aj,k
‚Üê‚Üí
Y
j‚ààJ
k‚ààK
aj,k =
Y
j‚ààJ
Y
k‚ààK
aj,k
X
k‚ààK
ak =
X
k
ak[k ‚ààK]
‚Üê‚Üí
Y
k‚ààK
ak =
Y
k
a[k‚ààK]
k
X
k‚ààK
1 = #K
‚Üê‚Üí
Y
k‚ààK
c = c#K
2.26
P2 =
¬°Q
1j,kn ajak
¬¢¬°Q
1j=kn ajak
¬¢
. The rst factor is equal to
¬°Qn
k=1 an
k
¬¢2; the second factor is Qn
k=1 a2
k. Hence P =
¬°Qn
k=1 ak
¬¢n+1.
2.27
‚àÜ(cx) = cx(c ‚àíx ‚àí1) = cx+2/(c ‚àíx). Setting c = ‚àí2 and decreasing
x by 2 yields ‚àÜ(‚àí(‚àí2)x‚àí2) = (‚àí2)x/x, hence the stated sum is (‚àí2)‚àí1 ‚àí
(‚àí2)n‚àí1 = (‚àí1)nn! ‚àí1.
2.28
The interchange of summation between the second and third lines is
not justiable; the terms of this sum do not converge absolutely. Everything
else is perfectly correct, except that the result of P
k1[k = j ‚àí1]k/j should
As opposed to
imperfectly correct.
perhaps have been written [j ‚àí1  1](j ‚àí1)/j and simplied explicitly.
2.29
Use partial fractions to get
k
4k2 ‚àí1 = 1
4
¬µ
1
2k + 1 +
1
2k ‚àí1
¬∂
.

A ANSWERS TO EXERCISES 505
The (‚àí1)k factor now makes the two halves of each term cancel with their
neighbors. Hence the answer is ‚àí1/4 + (‚àí1)n/(8n + 4).
2.30
Pb
a x Œ¥x = 1
2(b2 ‚àía2) = 1
2(b ‚àía)(b + a ‚àí1). So we have
(b ‚àía)(b + a ‚àí1) = 2100 = 22 ¬∑3¬∑52 ¬∑7 .
There is one solution for each way to write 2100 = x¬∑y where x is even and
y is odd; we let a = 1
2 jx ‚àíyj + 1
2 and b = 1
2(x + y) + 1
2. So the number of
solutions is the number of divisors of 3 ¬∑ 52 ¬∑ 7, namely 12. In general, there
are Q
p>2(np + 1) ways to represent Q
p pnp, where the products range over
primes.
2.31
P
j,k2 j‚àík = P
j2 1/j2(1 ‚àí1/j) = P
j2 1/j(j ‚àí1). The second sum
is, similarly, 3/4.
2.32
If 2n  x < 2n+1, the sums are 0+¬∑ ¬∑ ¬∑+n+(x‚àín‚àí1)+¬∑ ¬∑ ¬∑+(x‚àí2n) =
n(x‚àín) = (x‚àí1) + (x‚àí3) + ¬∑ ¬∑ ¬∑ + (x‚àí2n+1). If 2n ‚àí1  x < 2n they are,
similarly, both equal to n(x ‚àín). (Looking ahead to Chapter 3, the formula
¬• 1
2(x + 1)
¬¶¬°
x ‚àí
¬• 1
2(x + 1)
¬¶¬¢
covers both cases.)
2.33
If K is empty, V
k‚ààK ak = ‚àû. The basic analogies are:
X
k‚ààK
cak = c
X
k‚ààK
ak
‚Üê‚Üí
^
k‚ààK
(c + ak) = c +
^
k‚ààK
ak
X
k‚ààK
(ak+bk) =
X
k‚ààK
ak +
X
k‚ààK
bk
‚Üê‚Üí
^
k‚ààK
min(ak, bk)
= min
¬µ ^
k‚ààK
ak,
^
k‚ààK
bk
¬∂
X
k‚ààK
ak =
X
p(k)‚ààK
ap(k)
‚Üê‚Üí
^
k‚ààK
ak =
^
p(k)‚ààK
ap(k)
X
j‚ààJ
k‚ààK
aj,k =
X
j‚ààJ
X
k‚ààK
aj,k
‚Üê‚Üí
^
j‚ààJ
k‚ààK
aj,k =
^
j‚ààJ
^
k‚ààK
aj,k
X
k‚ààK
ak =
X
k
ak[k ‚ààK]
‚Üê‚Üí
^
k‚ààK
ak =
^
k
ak ¬∑‚àû[k/‚ààK]
2.34
Let K+ = fk | ak  0g and K‚àí= fk | ak < 0g. Then if, for example,
A permutation that
consumes terms of
one sign faster than
those of the other
can steer the sum
toward any value
that it likes.
n is odd, we choose Fn to be Fn‚àí1 ‚à™En, where En ‚äÜK‚àíis suciently large
that P
k‚àà(Fn‚àí1‚à©K+) ak ‚àíP
k‚ààEn(‚àíak) < A‚àí.
2.35
Goldbach's sum can be shown to equal
X
m,n2
m‚àín =
X
m2
1
m(m ‚àí1) = 1

506 ANSWERS TO EXERCISES
as follows: By unsumming a geometric series, it equals P
k‚ààP, l1 k‚àíl ; there-
fore the proof will be complete if we can nd a one-to-one correspondence
between ordered pairs (m, n) with m, n  2 and ordered pairs (k, l) with
k ‚ààP and l  1, where mn = kl when the pairs correspond. If m /‚ààP we let
(m, n) ‚Üê‚Üí(mn, 1); but if m = ab ‚ààP, we let (m, n) ‚Üê‚Üí(an, b).
2.36
(a) By denition, g(n) ‚àíg(n ‚àí1) = f(n). (b) By part (a), g
¬°
g(n)
¬¢
‚àí
With this self-
description,
Golomb's se-
quence wouldn't
do too well on the
Dating Game.
g
¬°
g(n ‚àí1)
¬¢
= P
k f(k)
¬£
g(n ‚àí1) < k  g(n)
¬§
= n
¬°
g(n) ‚àíg(n ‚àí1)
¬¢
= nf(n).
(c) By part (a) again, g
¬°
g(g(n))
¬¢
‚àíg
¬°
g(g(n ‚àí1))
¬¢
is
X
k
f(k)
¬£
g(g(n ‚àí1)) < k  g(g(n))
¬§
=
X
j,k
j
¬£
j = f(k)
¬§¬£
g(g(n ‚àí1)) < k  g(g(n))
¬§
=
X
j,k
j
¬£
j = f(k)
¬§¬£
g(n ‚àí1) < j  g(n)
¬§
=
X
j
j
¬°
g(j) ‚àíg(j ‚àí1)
¬¢¬£
g(n ‚àí1) < j  g(n)
¬§
=
X
j
jf(j)
¬£
g(n‚àí1) < j  g(n)
¬§
= n
X
j
j
¬£
g(n‚àí1) < j  g(n)
¬§
.
Colin Mallows observes that the sequence can also be dened by the recurrence
f(1) = 1 ;
f(n + 1) = 1 + f
¬°
n + 1 ‚àíf(f(n))
¬¢
,
for n  0.
2.37
(RLG thinks they probably won't t; DEK thinks they probably will;
OP is not committing himself.)
3.1
m = ‚åälg n‚åã; l = n ‚àí2m = n ‚àí2‚åälg n‚åã.
3.2
(a) ‚åäx + .5‚åã. (b) ‚åàx ‚àí.5‚åâ.
3.3
This is ‚åämn ‚àífmŒ±gn/Œ±‚åã= mn ‚àí1, since 0 < fmŒ±g < 1.
3.4
Something where no proof is required, only a lucky guess (I guess).
3.5
We have ‚åänx‚åã=
¬•
n‚åäx‚åã+ nfxg
¬¶
= n‚åäx‚åã+
¬•
nfxg
¬¶
by (3.8) and (3.6).
Therefore ‚åänx‚åã= n‚åäx‚åã‚áê‚áí
¬•
nfxg
¬¶
= 0 ‚áê‚áí0  nfxg < 1 ‚áê‚áífxg < 1/n,
assuming that n is a positive integer. (Notice that n‚åäx‚åã ‚åänx‚åãfor all x in
this case.)
3.6
‚åäf(x)‚åã= ‚åäf(‚åàx‚åâ)‚åã.
3.7
‚åän/m‚åã+ n mod m.
3.8
If all boxes contain < ‚åàn/m‚åâobjects, then n 
¬°
‚åàn/m‚åâ‚àí1
¬¢
m, so
n/m + 1  ‚åàn/m‚åâ, contradicting (3.5). The other proof is similar.

A ANSWERS TO EXERCISES 507
3.9
We have m/n‚àí1/q = (n mumble m)/qn. The process must terminate,
because 0  n mumble m < m. The denominators of the representation are
strictly increasing, hence distinct, because qn/(n mumble m) > q.
3.10
‚åàx + 1
2‚åâ‚àí
¬£
(2x + 1)/4 is not an integer
¬§
is the nearest integer to x, if
fxg Ã∏= 1
2; otherwise it's the nearest even integer. (See exercise 2.) Thus the
formula gives an \unbiased" way to round.
3.11
If n is an integer, Œ± < n < Œ≤ ‚áê‚áí‚åäŒ±‚åã< n < ‚åàŒ≤‚åâ. The number of
integers satisfying a < n < b when a and b are integers is (b ‚àía ‚àí1)[b > a].
We would therefore get the wrong answer if Œ± = Œ≤ = integer.
3.12
Subtract ‚åän/m‚åãfrom both sides, by (3.6), getting ‚åà(n mod m)/m‚åâ=
‚åä(n mod m + m ‚àí1)/m‚åã. Both sides are now equal to [n mod m > 0], since
0  n mod m < m.
A shorter but less direct proof simply observes that the rst term in
(3.24) must equal the last term in (3.25).
3.13
If they form a partition, the text's formula for N(Œ±, n) implies that
1/Œ± + 1/Œ≤ = 1, because the coecients of n in the equation N(Œ±, n) +
N(Œ≤, n) = n must agree if the equation is to hold for large n.
Hence Œ±
and Œ≤ are both rational or both irrational. If both are irrational, we do get
a partition, as shown in the text. If both can be written with numerator m,
the value m‚àí1 occurs in neither spectrum, and m occurs in both. (However,
Golomb [151] has observed that the sets f‚åänŒ±‚åã| n  1g and f‚åànŒ≤‚åâ‚àí1 | n  1g
always do form a partition, when 1/Œ± + 1/Œ≤ = 1.)
3.14
It's obvious by (3.22) if ny = 0, otherwise true by (3.21) and (3.6).
3.15
Plug in ‚åàmx‚åâfor n in (3.24): ‚åàmx‚åâ= ‚åàx‚åâ+‚åàx‚àí1
m‚åâ+¬∑ ¬∑ ¬∑+‚åàx‚àím‚àí1
m ‚åâ.
3.16
The formula n mod 3 = 1+ 1
3
¬°
(œâ‚àí1)œân‚àí(œâ+2)œâ2n¬¢
can be veried
by checking it when 0  n < 3.
A general formula for n mod m, when m is any positive integer, ap-
pears in exercise 7.25.
3.17
P
j,k[0  k < m][1  j  x + k/m]
=
P
j,k[0  k < m][1  j  ‚åàx‚åâ] √ó
¬£
k  m(j ‚àíx)
¬§
= P
1j‚åàx‚åâ
P
k[0  k < m] ‚àíP
j=‚åàx‚åâ
P
k
¬£
0  k < m(j ‚àíx)
¬§
=
m‚åàx‚åâ‚àí
¬ß
m(‚åàx‚åâ‚àíx)
¬®
= ‚àí‚åà‚àímx‚åâ= ‚åämx‚åã.
3.18
We have
S =
X
0j<‚åànŒ±‚åâ
X
kn
¬£
jŒ±‚àí1  k < (j + v)Œ±‚àí1¬§
.
If j  nŒ± ‚àí1  nŒ± ‚àív, there is no contribution, because (j + v)Œ±‚àí1  n.
Hence j = ‚åänŒ±‚åãis the only case that matters, and the value in that case
equals
¬ß
(‚åänŒ±‚åã+ v)Œ±‚àí1¬®
‚àín  ‚åàvŒ±‚àí1‚åâ.

508 ANSWERS TO EXERCISES
3.19
If and only if b is an integer. (If b is an integer, logb x is a continuous,
increasing function that takes integer values only at integer points. If b is not
an integer, the condition fails when x = b.)
3.20
We have P
k kx[Œ±  kx  Œ≤] = x P
k k
¬£
‚åàŒ±/x‚åâ k  ‚åäŒ≤/x‚åã
¬§
, which sums
to 1
2x
¬°
‚åäŒ≤/x‚åã‚åäŒ≤/x + 1‚åã‚àí‚åàŒ±/x‚åâ‚åàŒ±/x ‚àí1‚åâ
¬¢
.
3.21
If 10n  2M < 10n+1, there are exactly n+1 such powers of 2, because
there's exactly one such k-digit power of 2 for each k. Therefore the answer
is 1 + ‚åäM log 2‚åã.
Note: The number of powers of 2 with leading digit l is more dicult,
when l > 1; it's P
0nM
¬°
‚åän log 2 ‚àílog l‚åã‚àí‚åän log 2 ‚àílog(l + 1)‚åã
¬¢
.
3.22
All terms are the same for n and n‚àí1 except the kth, where n = 2k‚àí1q
and q is odd; we have Sn = Sn‚àí1 + 1 and Tn = Tn‚àí1 + 2kq. Hence Sn = n
and Tn = n(n + 1).
3.23
Xn = m ‚áê‚áí
1
2m(m ‚àí1) < n  1
2m(m + 1) ‚áê‚áím2 ‚àím + 1
4 <
2n < m2 + m + 1
4 ‚áê‚áím ‚àí1
2 <
‚àö
2n < m + 1
2.
3.24
Let Œ≤ = Œ±/(Œ± + 1). Then the number of times the nonnegative integer
m occurs in Spec(Œ≤) is exactly one more than the number of times it occurs
in Spec(Œ±). Why? Because N(Œ≤, n) = N(Œ±, n) + n + 1.
3.25
Continuing the development in the text, if we could nd a value of m
such that Km  m, we could violate the stated inequality at n + 1 when
\In trying to devise
a proof by mathe-
matical induction,
you may fail for
two opposite rea-
sons. You may fail
because you try to
prove too much:
Your P(n) is too
heavy a burden.
Yet you may also
fail because you try
to prove too little:
Your P(n) is too
weak a support.
In general, you
have to balance
the statement of
your theorem so
that the support is
just enough for the
burden."
|G. Polya [297]
n = 2m + 1. (Also when n = 3m + 1 and n = 3m + 2.) But the existence of
such an m = n‚Ä≤ + 1 requires that 2K‚åän ‚Ä≤/2‚åã n‚Ä≤ or 3K‚åän ‚Ä≤/3‚åã n‚Ä≤, i.e., that
K‚åän ‚Ä≤/2‚åã ‚åän‚Ä≤/2‚åã
or
K‚åän ‚Ä≤/3‚åã ‚åän‚Ä≤/3‚åã.
Aha. This goes down further and further, implying that K0  0; but K0 = 1.
What we really want to prove is that Kn is strictly greater than n, for
all n > 0. In fact, it's easy to prove this by induction, although it's a stronger
result than the one we couldn't prove!
(This exercise teaches an important lesson. It's more an exercise about
the nature of induction than about properties of the oor function.)
3.26
Induction, using the stronger hypothesis
D(q)
n
 (q ‚àí1)
¬µ¬µ
q
q ‚àí1
¬∂n+1
‚àí1
¬∂
,
for n  0.
3.27
If D(3)
n
= 2mb ‚àía, where a is 0 or 1, then D(3)
n+m = 3mb ‚àía.

A ANSWERS TO EXERCISES 509
3.28
The key observation is that an = m2 implies an+2k+1 = (m + k)2 +
m‚àík and an+2k+2 = (m+k)2+2m, for 0  k  m; hence an+2m+1 = (2m)2.
The solution can be written in a nice form discovered by Carl Witty:
an‚àí1 = 2l +
¬π¬µn ‚àíl
2
¬∂2¬∫
,
when 2l + l  n < 2l+1 + l + 1.
3.29
D
¬°
Œ±‚Ä≤, ‚åäŒ±n‚åã
¬¢
is at most the maximum of the right-hand side of
s
¬°
Œ±‚Ä≤, ‚åänŒ±‚åã, ŒΩ‚Ä≤¬¢
= ‚àís(Œ±, n, ŒΩ) + S ‚àíœµ ‚àíf0 or 1g ‚àíŒΩ‚Ä≤ + f0 or 1g .
3.30
Xn = Œ±2n + Œ±‚àí2n, by induction; and Xn is an integer.
3.31
Here's an \elegant," \impressive" proof that gives no clue about how
This logic is seri-
ously oored.
it was discovered:
‚åäx‚åã+ ‚åäy‚åã+ ‚åäx + y‚åã=
¬•
x + ‚åäy‚åã
¬¶
+ ‚åäx + y‚åã

¬•
x + 1
2‚åä2y‚åã
¬¶
+
¬•
x + 1
2‚åä2y‚åã+ 1
2
¬¶
=
¬•
2x + ‚åä2y‚åã
¬¶
= ‚åä2x‚åã+ ‚åä2y‚åã.
But there's also a simple, graphical proof based on the observation that we
need to consider only the case 0  x, y < 1. Then the functions look like this
in the plane:
@
@
@
@
0
1

0
1
1
2
.
A slightly stronger result is possible, namely
‚åàx‚åâ+ ‚åäy‚åã+ ‚åäx + y‚åã ‚åà2x‚åâ+ ‚åä2y‚åã;
but this is stronger only when fxg = 1
2. If we replace (x, y) by (‚àíx, x + y) in
this identity and apply the reective law (3.4), we get
‚åäy‚åã+ ‚åäx + y‚åã+ ‚åä2x‚åã ‚åäx‚åã+ ‚åä2x + 2y‚åã.
3.32
Let f(x) be the sum in question. Since f(x) = f(‚àíx), we may assume
that x  0.
The terms are bounded by 2k as k ‚Üí‚àí‚àûand by x2/2k as
k ‚Üí+‚àû, so the sum exists for all real x.
We have f(2x) = 2 P
k 2k‚àí1‚à•x/2k‚àí1‚à•2 = 2f(x). Let f(x) = l(x) + r(x)
where l(x) is the sum for k  0 and r(x) is the sum for k > 0. Then l(x+1) =
l(x), and l(x)  1/2 for all x. When 0  x < 1, we have r(x) = x2/2 + x2/4 +
¬∑ ¬∑ ¬∑ = x2, and r(x + 1) = (x ‚àí1)2/2 + (x + 1)2/4 + (x + 1)2/8 + ¬∑ ¬∑ ¬∑ = x2 + 1.
Hence f(x + 1) = f(x) + 1, when 0  x < 1.

510 ANSWERS TO EXERCISES
We can now prove by induction that f(x+n) = f(x)+n for all integers
n  0, when 0  x < 1.
In particular, f(n) = n.
Therefore in general,
f(x) = 2‚àímf(2mx) = 2‚àím‚åä2mx‚åã+ 2‚àímf
¬°
f2mxg
¬¢
. But f
¬°
f2mxg
¬¢
= l
¬°
f2mxg
¬¢
+
r
¬°
f2mxg
¬¢
 1
2 + 1; so
¬Ø¬Øf(x) ‚àíx
¬Ø¬Ø 
¬Ø¬Ø2‚àím‚åä2mx‚åã‚àíx
¬Ø¬Ø + 2‚àím ¬∑ 3
2  2‚àím ¬∑ 5
2 for all
integers m.
The inescapable conclusion is that f(x) = jxj for all real x.
3.33
Let r = n‚àí1
2 be the radius of the circle. (a) There are 2n‚àí1 horizontal
lines and 2n‚àí1 vertical lines between cells of the board, and the circle crosses
each of these lines twice. Since r2 is not an integer, the Pythagorean theorem
tells us that the circle doesn't pass through the corner of any cell. Hence
the circle passes through as many cells as there are crossing points, namely
8n ‚àí4 = 8r. (The same formula gives the number of cells at the edge of the
board.) (b) f(n, k) = 4‚åä
‚àö
r2 ‚àík2‚åã.
It follows from (a) and (b) that
1
4œÄr2 ‚àí2r 
X
0<k<r
‚åä
p
r2 ‚àík2‚åã
1
4œÄr2 ,
r = n ‚àí1
2.
The task of obtaining more precise estimates of this sum is a famous problem
in number theory, investigated by Gauss and many others; see Dickson [78,
volume 2, chapter 6].
3.34
(a) Let m = ‚åàlg n‚åâ. We can add 2m ‚àín terms to simplify the calcula-
tions at the boundary:
f(n) + (2m ‚àín)m =
2m
X
k=1
‚åàlg k‚åâ=
X
j,k
j[j = ‚åàlg k‚åâ][1  k  2m]
=
X
j,k
j[2j‚àí1 < k  2j][1  j  m]
=
m
X
j=1
j 2j‚àí1 = 2m(m ‚àí1) + 1 .
Consequently f(n) = nm ‚àí2m + 1.
(b) We have ‚åàn/2‚åâ= ‚åä(n+1)/2‚åã, and it follows that the solution to the
general recurrence g(n) = a(n) + g
¬°
‚åàn/2‚åâ
¬¢
+ g
¬°
‚åän/2‚åã
¬¢
must satisfy ‚àÜg(n) =
‚àÜa(n)+‚àÜg
¬°
‚åän/2‚åã
¬¢
. In particular, when a(n) = n‚àí1, ‚àÜf(n) = 1+‚àÜf
¬°
‚åän/2‚åã
¬¢
is satised by the number of bits in the binary representation of n, namely
‚åàlg(n + 1)‚åâ. Now convert from ‚àÜto Œ£.
A more direct solution can be based on the identities ‚åàlg 2j‚åâ= ‚åàlg j‚åâ+1
and ‚åàlg(2j ‚àí1)‚åâ= ‚åàlg j‚åâ+ [j > 1], for j  1.

A ANSWERS TO EXERCISES 511
3.35
(n + 1)2n!e = An + (n + 1)2 + (n + 1) + Bn, where
An = (n + 1)2n!
0!
+ (n + 1)2n!
1!
+ ¬∑ ¬∑ ¬∑ + (n + 1)2n!
(n ‚àí1)!
is a multiple of n and
Bn = (n + 1)2n!
(n + 2)!
+ (n + 1)2n!
(n + 3)!
+ ¬∑ ¬∑ ¬∑
= n + 1
n + 2
¬µ
1 +
1
n + 3 +
1
(n + 3)(n + 4) + ¬∑ ¬∑ ¬∑
¬∂
< n + 1
n + 2
¬µ
1 +
1
n + 3 +
1
(n + 3)(n + 3) + ¬∑ ¬∑ ¬∑
¬∂
= (n + 1)(n + 3)
(n + 2)2
is less than 1. Hence the answer is 2 mod n.
3.36
The sum is
X
k,l,m
2‚àíl4‚àím¬£
m = ‚åälg l‚åã
¬§¬£
l = ‚åälg k‚åã
¬§
[1 < k < 22n ]
=
X
k,l,m
2‚àíl4‚àím[2m  l < 2m+1][2l  k < 2l+1][0  m < n]
=
X
l,m
4‚àím[2m  l < 2m+1][0  m < n]
=
X
m
2‚àím[0  m < n] = 2(1 ‚àí2‚àín) .
3.37
First consider the case m < n, which breaks into subcases based on
whether m < 1
2n; then show that both sides change in the same way when
m is increased by n.
3.38
At most one xk can be noninteger. Discard all integer xk, and suppose
This is really only a
level 4 problem, in
spite of the way it's
stated.
that n are left. When fxg Ã∏= 0, the average of fmxg as m ‚Üí‚àûlies between 1
4
and 1
2; hence fmx1g + ¬∑ ¬∑ ¬∑ + fmxng ‚àífmx1 + ¬∑ ¬∑ ¬∑ + mxng cannot have average
value zero when n > 1.
But the argument just given relies on a dicult theorem about uniform
distribution. An elementary proof is possible, sketched here for n = 2: Let
Pm be the point
¬°
fmxg, fmyg
¬¢
.
Divide the unit square 0  x, y < 1 into
triangular regions A and B according as x + y < 1 or x + y  1. We want to
show that Pm ‚ààB for some m, if fxg and fyg are nonzero. If P1 ‚ààB, we're
done. Otherwise there is a disk D of radius œµ > 0 centered at P1 such that

512 ANSWERS TO EXERCISES
D ‚äÜA. By Dirichlet's box principle, the sequence P1, . . . , PN must contain
two points with jPk ‚àíPjj < œµ and k > j, if N is large enough.
@
@
@
@
@
@
i
p
¬§
¬§
¬§
¬§
P1
i
p¬§
¬§
¬§
¬§
(1, 1) ‚àíP1
A
B
It follows that Pk‚àíj‚àí1 is within œµ of (1, 1) ‚àíP1; hence Pk‚àíj‚àí1 ‚ààB.
3.39
Replace j by b ‚àíj and add the term j = 0 to the sum, so that exercise
15 can be used for the sum on j. The result,
‚åàx/bk‚åâ‚àí‚åàx/bk+1‚åâ+ b ‚àí1 ,
telescopes when summed on k.
3.40
Let ‚åä2‚àön‚åã= 4k + r where ‚àí2  r < 2, and let m = ‚åä‚àön‚åã. Then the
following relationships can be proved by induction:
segment
r
m
x
y
if and only if
Wk
‚àí2 2k‚àí1 m(m+1) ‚àín ‚àík
k
(2k‚àí1)(2k‚àí1)  n  (2k‚àí1)(2k)
Sk
‚àí1 2k‚àí1
‚àík
m(m+1) ‚àín + k
(2k‚àí1)(2k) < n < (2k)(2k)
Ek
0
2k
n ‚àím(m+1) + k
‚àík
(2k)(2k)  n  (2k)(2k+1)
Nk
1
2k
k
n ‚àím(m+1) ‚àík (2k)(2k+1) < n < (2k+1)(2k+1)
Thus, when k  1, Wk is a segment of length 2k where the path travels west
and y(n) = k; Sk is a segment of length 2k ‚àí2 where the path travels south
and x(n) = ‚àík; etc. (a) The desired formula is therefore
y(n) = (‚àí1)m¬≥¬°
n ‚àím(m + 1)
¬¢
¬∑
¬£
‚åä2‚àön‚åãis odd
¬§
‚àí‚åà1
2m‚åâ
¬¥
.
(b) On all segments, k = max
¬°
jx(n)j, jy(n)j
¬¢
. On segments Wk and Sk we
have x < y and n + x + y = m(m + 1) = (2k)2 ‚àí2k; on segments Ek and Nk
we have x  y and n ‚àíx ‚àíy = m(m + 1) = (2k)2 + 2k. Hence the sign is
(‚àí1)(x(n)<y(n)).
3.41
Since 1/œÜ + 1/œÜ2 = 1, the stated sequences do partition the positive
integers. Since the condition g(n) = f
¬°
f(n)
¬¢
+1 determines f and g uniquely,
we need only show that
¬•
‚åänœÜ‚åãœÜ
¬¶
+ 1 = ‚åänœÜ2‚åãfor all n > 0. This follows
from exercise 3, with Œ± = œÜ and n = 1.

A ANSWERS TO EXERCISES 513
3.42
No; an argument like the analysis of the two-spectrum case in the text
and in exercise 13 shows that a tripartition occurs if and only if 1/Œ± + 1/Œ≤ +
1/Œ≥ = 1 and
¬Øn + 1
Œ±
¬∞
+
¬Øn + 1
Œ≤
¬∞
+
¬Øn + 1
Œ≥
¬∞
= 1 ,
for all n > 0. But the average value of
¬©
(n+1)/Œ±
¬™
is 1/2 if Œ± is irrational, by
the theorem on uniform distribution. The parameters can't all be rational,
and if Œ≥ = m/n the average is 3/2 ‚àí1/(2n). Hence Œ≥ must be an integer, but
this doesn't work either. (There's also a proof of impossibility that uses only
simple principles, without the theorem on uniform distribution; see [155].)
3.43
One step of unfolding the recurrence for Kn gives the minimum of the
four numbers 1 + a + a¬∑b¬∑K‚åä(n‚àí1‚àía)/(a¬∑b)‚åã, where a and b are each 2 or 3.
(This simplication involves an application of (3.11) to remove oors within
oors, together with the identity x + min(y, z) = min(x + y, x + z). We must
omit terms with negative subscripts; i.e., with n ‚àí1 ‚àía < 0.)
Continuing along such lines now leads to the following interpretation:
Kn is the least number > n in the multiset S of all numbers of the form
1 + a1 + a1a2 + a1a2a3 + ¬∑ ¬∑ ¬∑ + a1a2a3 . . . am ,
where m  0 and each ak is 2 or 3. Thus,
S = f1, 3, 4, 7, 9, 10, 13, 15, 19, 21, 22, 27, 28, 31, 31, . . . g ;
the number 31 is in S \twice" because it has two representations 1 + 2 + 4 +
8 + 16 = 1 + 3 + 9 + 18. (Incidentally, Michael Fredman [134] has shown that
limn‚Üí‚àûKn/n = 1, i.e., that S has no enormous gaps.)
3.44
Let d(q)
n
= D(q)
n‚àí1mumble(q‚àí1), so that D(q)
n
= (qD(q)
n‚àí1+d(q)
n )/(q ‚àí1)
and a(q)
n
= ‚åàD(q)
n‚àí1/(q ‚àí1)‚åâ. Now D(q)
k‚àí1  (q ‚àí1)n ‚áê‚áía(q)
k
 n, and the
results follow. (This is the solution found by Euler [116], who determined the
a's and d's sequentially without realizing that a single sequence D(q)
n
would
suce.)
3.45
Let Œ± > 1 satisfy Œ± + 1/Œ± = 2m. Then we nd 2Yn = Œ±2n + Œ±‚àí2n, and
Too easy.
it follows that Yn =
¬ß
Œ±2n/2
¬®
.
3.46
The hint follows from (3.9), since 2n(n+1) =
¬•
2(n+ 1
2)2¬¶
. Let n+Œ∏ =
¬°‚àö
2
l +
‚àö
2
l‚àí1¬¢
m and n‚Ä≤ + Œ∏‚Ä≤ =
¬°‚àö
2
l+1 +
‚àö
2
l¬¢
m, where 0  Œ∏, Œ∏‚Ä≤ < 1.
Then Œ∏‚Ä≤ = 2Œ∏ mod 1 = 2Œ∏ ‚àíd, where d is 0 or 1. We want to prove that
n‚Ä≤ =
¬•‚àö
2(n + 1
2)
¬¶
; this equality holds if and only if
0  Œ∏‚Ä≤(2 ‚àí
‚àö
2 ) +
‚àö
2(1 ‚àíd) < 2 .

514 ANSWERS TO EXERCISES
To solve the recurrence, note that Spec(1+1/
‚àö
2 ) and Spec(1+
‚àö
2 ) partition
the positive integers; hence any positive integer a can be written uniquely in
the form a =
¬•¬°‚àö
2
l +
‚àö
2
l‚àí1¬¢
m
¬¶
, where l and m are integers with m odd
and l  0. It follows that Ln =
¬•
(
‚àö
2
l+n +
‚àö
2
l+n‚àí1)m
¬¶
.
3.47
(a) c = ‚àí1
2. (b) c is an integer. (c) c = 0. (d) c is arbitrary. See the
answer to exercise 1.2.4{40 in [207] for more general results.
3.48
Let x:0 = 1 and x:(k+1) = x‚åäx:k‚åã; also let ak = fx:kg and bk = ‚åäx:k‚åã,
so that the stated identity reads x3 = 3x:3 + 3a1a2 + a3
1 ‚àí3b1b2 + b3
1. Since
ak + bk = x:k = xbk‚àí1 for k  0, we have (1 ‚àíxz)(1 + b1z + b2z2 + ¬∑ ¬∑ ¬∑) =
1 ‚àía1z ‚àía2z2 ‚àí¬∑ ¬∑ ¬∑ ; thus
1
1 ‚àíxz = 1 + b1z + b2z2 + ¬∑ ¬∑ ¬∑
1 ‚àía1z ‚àía2z2 ‚àí¬∑ ¬∑ ¬∑ .
Take the logarithm of both sides, to separate the a's from the b's.
Then
dierentiate with respect to z, obtaining
x
1 ‚àíxz = a1 + 2a2z + 3a3z2 + ¬∑ ¬∑ ¬∑
1 ‚àía1z ‚àía2z2 ‚àí¬∑ ¬∑ ¬∑
+ b1 + 2b2z + 3b3z2 + ¬∑ ¬∑ ¬∑
1 + b1z + b2z2 + ¬∑ ¬∑ ¬∑
.
The coecient of zn‚àí1 on the left is xn; on the right it is a formula that
matches the given identity when n = 3.
Similar identities for the more general product x0x1 . . . xn‚àí1 can also
be derived [170].
3.49
(Solution by Heinrich Rolletschek.)
We can replace (Œ±, Œ≤) by (fŒ≤g,
A more interesting
(still unsolved)
problem: Restrict
both Œ± and Œ≤ to
be < 1, and ask
when the given
multiset determines
the unordered
pair fŒ±, Œ≤g.
Œ± + ‚åäŒ≤‚åã) without changing ‚åänŒ±‚åã+ ‚åänŒ≤‚åã.
Hence the condition Œ± = fŒ≤g is
necessary. It is also sucient: Let m = ‚åäŒ≤‚åãbe the least element of the given
multiset, and let S be the multiset obtained from the given one by subtracting
mn from the nth smallest element, for all n. If Œ± = fŒ≤g, consecutive elements
of S dier by either 0 or 2, hence the multiset 1
2S = Spec(Œ±) determines Œ±.
3.50
According to unpublished notes of William A. Veech, it is sucient to
have Œ±Œ≤, Œ≤, and 1 linearly independent over the rationals.
3.51
H. S. Wilf observes that the functional equation f(x2‚àí1) = f(x)2 would
determine f(x) for all x  œÜ if we knew f(x) on any interval (œÜ . . œÜ + œµ).
3.52
There are innitely many ways to partition the positive integers into
three or more generalized spectra with irrational Œ±k; for example,
Spec(2Œ±; 0) ‚à™Spec(4Œ±; ‚àíŒ±) ‚à™Spec(4Œ±; ‚àí3Œ±) ‚à™Spec(Œ≤; 0)
works. But there's a precise sense in which all such partitions arise by \ex-
panding" a basic one, Spec(Œ±) ‚à™Spec(Œ≤); see [158]. The only known rational

A ANSWERS TO EXERCISES 515
examples, e.g.,
Spec(7; ‚àí3) ‚à™Spec( 7
2; ‚àí1) ‚à™Spec( 7
4; 0) ,
are based on parameters like those in the stated conjecture, which is due to
A. S. Fraenkel [128].
3.53
Partial results are discussed in [95, pages 30{31]. The greedy algorithm
probably does not terminate.
4.1
1, 2, 4, 6, 16, 12.
4.2
Note that mp + np = min(mp, np) + max(mp, np). The recurrence
lcm(m, n) =
¬°
n/(n mod m)
¬¢
lcm(n mod m, m) is valid but not really advis-
able for computing lcm's; the best way known to compute lcm(m, n) is to
compute gcd(m, n) rst and then to divide mn by the gcd.
4.3
This holds if x is an integer, but œÄ(x) is dened for all real x. The
correct formula,
œÄ(x) ‚àíœÄ(x ‚àí1) =
¬£
‚åäx‚åãis prime
¬§
,
is easy to verify.
4.4
Between 1
0 and
0
‚àí1 we'd have a left-right reected Stern{Brocot tree
with all denominators negated, etc. So the result is all fractions m/n with
m ‚ä•n. The condition m‚Ä≤n‚àímn‚Ä≤ = 1 still holds throughout the construction.
(This is called the Stern{Brocot wreath, because we can conveniently regard
the nal 0
1 as identical to the rst 0
1, thereby joining the trees in a cycle at
the top. The Stern{Brocot wreath has interesting applications to computer
graphics because it represents all rational directions in the plane.)
4.5
Lk =
¬°1 k
0 1
¬¢
and Rk =
¬°1 0
k 1
¬¢
; this holds even when k < 0. (We will nd
a general formula for any product of L's and R's in Chapter 6.)
4.6
a = b. (Chapter 3 dened x mod 0 = x, primarily so that this would
After all, `mod y'
sort of means \pre-
tend y is zero." So if
it already is, there's
nothing to pretend.
be true.)
4.7
We need m mod 10 = 0, m mod 9 = k, and m mod 8 = 1. But m can't
be both even and odd.
4.8
We want 10x + 6y ‚â°10x + y (mod 15); hence 5y ‚â°0 (mod 15); hence
y ‚â°0 (mod 3). We must have y = 0 or 3, and x = 0 or 1.
4.9
32k+1 mod 4 = 3, so (32k+1 ‚àí1)/2 is odd.
The stated number is
divisible by (37 ‚àí1)/2 and (311 ‚àí1)/2 (and by other numbers).
4.10
999(1 ‚àí1
3)(1 ‚àí
1
37) = 648.

516 ANSWERS TO EXERCISES
4.11
œÉ(0) = 1; œÉ(1) = ‚àí1; œÉ(n) = 0 for n > 1.
(Generalized Mobius
functions dened on arbitrary partially ordered structures have interesting
and important properties, rst explored by Weisner [366] and developed by
many other people, notably Gian-Carlo Rota [313].)
4.12
P
dnm
P
knd ¬µ(d/k) g(k) = P
knm
P
dn(m/k) ¬µ(d) g(k) = P
knm g(k)√ó
[m/k = 1] = g(m), by (4.7) and (4.9).
4.13
(a) np  1 for all p; (b) ¬µ(n) Ã∏= 0.
4.14
True when k > 0. Use (4.12), (4.14), and (4.15).
4.15
No. For example, en mod 5 = [2 or 3]; en mod 11 = [2, 3, 7, or 10].
4.16
1/e1 + 1/e2 + ¬∑ ¬∑ ¬∑ + 1/en = 1 ‚àí1
¬±¬°
en(en ‚àí1)
¬¢
= 1 ‚àí1/(en+1 ‚àí1).
4.17
We have fn mod fm = 2; hence gcd(fn, fm) = gcd(2, fm) = 1. (Inci-
dentally, the relation fn = f0f1 . . . fn‚àí1 + 2 is very similar to the recurrence
that denes the Euclid numbers en.)
4.18
If n = qm and q is odd, 2n+1 = (2m+1)(2n‚àím‚àí2n‚àí2m+¬∑ ¬∑ ¬∑‚àí2m+1).
4.19
The rst sum is œÄ(n), since the summand is [k+1 is prime]. The inner
sum in the second is P
1k<m[knm], so it is greater than 1 if and only if
m is composite; again we get œÄ(n). Finally
¬ß
fm/ng
¬®
= [n//nm], so the third
sum is an application of Wilson's theorem. To evaluate œÄ(n) by any of these
formulas is, of course, sheer lunacy.
4.20
Let p1 = 2 and let pn be the smallest prime greater than 2pn‚àí1. Then
2pn‚àí1 < pn < 2pn‚àí1+1, and it follows that we can take b = limn‚Üí‚àûlg(n) pn
where lg(n) is the function lg iterated n times. The stated numerical value
comes from p2 = 5, p3 = 37. It turns out that p4 = 237 + 9, and this gives
the more precise value
b ‚âà1.2516475977905
(but no clue about p5).
4.21
By Bertrand's postulate, Pn < 10n. Let
K =
X
k1
10‚àík2Pk = .200300005 . . . .
Then 10n2K ‚â°Pn + fraction (mod 102n‚àí1).
4.22
(bmn ‚àí1)/(b ‚àí1) =
¬°
(bm ‚àí1)/(b ‚àí1)
¬¢
(bmn‚àím + ¬∑ ¬∑ ¬∑ + 1). [The only
prime numbers of the form (10p ‚àí1)/9 for p < 20000 occur when p = 2, 19,
23, 317, 1031.] Numbers of this form are called \repunits."

A ANSWERS TO EXERCISES 517
4.23
œÅ(2k + 1) = 0; œÅ(2k) = œÅ(k) + 1, for k  1. By induction we can show
that œÅ(n) = œÅ(n‚àí2m), if n > 2m and m > œÅ(n). The kth Hanoi move is disk
œÅ(k), if we number the disks 0, 1, . . . , n ‚àí1. This is clear if k is a power of 2.
And if 2m < k < 2m+1, we have œÅ(k) < m; moves k and k ‚àí2m correspond
in the sequence that transfers m + 1 disks in Tm + 1 + Tm steps.
4.24
The digit that contributes dpm to n contributes dpm‚àí1 + ¬∑ ¬∑ ¬∑ + d =
d(pm ‚àí1)/(p ‚àí1) to œµp(n!), hence œµp(n!) =
¬°
n ‚àíŒΩp(n)
¬¢
/(p ‚àí1).
4.25
mnnn ‚áê‚áímp = 0 or mp = np, for all p. It follows that (a) is true.
But (b) fails, in our favorite example m = 12, n = 18. (This is a common
fallacy.)
4.26
Yes, since GN denes a subtree of the Stern{Brocot tree.
4.27
Extend the shorter string with M's (since M lies alphabetically be-
tween L and R) until both strings are the same length, then use dictionary
order. For example, the topmost levels of the tree are LL < LM < LR <
MM < RL < RM < RR. (Another solution is to append the innite string
RL‚àûto both inputs, and to keep comparing until nding L < R.)
4.28
We need to use only the rst part of the representation:
1
1,
R
2
1,
R
3
1,
R
4
1,
L
7
2,
L
10
3 ,
L
13
4 ,
L
16
5 ,
L
19
6 ,
L
22
7 ,
L
25
8 ,
R
47
15,
R
69
22,
R
91
29,
R
113
36 ,
R
135
43 ,
R
. . . .
The fraction 4
1 appears because it's a better upper bound than 1
0, not because
it's closer than 3
1. Similarly, 25
8 is a better lower bound than 3
1. The simplest
upper bounds and the simplest lower bounds all appear, but the next really
good approximation doesn't occur until just before the string of R's switches
back to L.
4.29
1/Œ±. To get 1‚àíx from x in binary notation, we interchange 0 and 1; to
get 1/Œ± from Œ± in Stern{Brocot notation, we interchange L and R. (The nite
cases must also be considered, but they must work since the correspondence
is order preserving.)
4.30
The m integers x ‚àà[A . . A + m) are dierent mod m; so their residues
(x mod m1, . . . , x mod mr) run through all m1 . . . mr = m possible values,
one of which must be equal to (a1 mod m1, . . . , ar mod mr) by the pigeonhole
principle.
4.31
A number in radix b notation is divisible by d if and only if the sum
of its digits is divisible by d, whenever b ‚â°1 (mod d). This follows because
(am . . . a0)b = ambm + ¬∑ ¬∑ ¬∑ + a0b0 ‚â°am + ¬∑ ¬∑ ¬∑ + a0.
4.32
The œï(m) numbers f kn mod m | k ‚ä•m and 0  k < m g are the num-
bers f k | k ‚ä•m and 0  k < m g in some order. Multiply them together and
divide by Q
0k<m, k‚ä•m k.

518 ANSWERS TO EXERCISES
4.33
Obviously h(1) = 1. If m ‚ä•n then h(mn) = P
dnmn f(d) g(mn/d) =
P
cnm,dnn f(cd) g
¬°
(m/c)(n/d)
¬¢
= P
cnm
P
dnn f(c) g(m/c) f(d) g(n/d); this
is h(m) h(n), since c ‚ä•d for every term in the sum.
4.34
g(m) = P
dnm f(d) = P
dnm f(m/d) = P
d1 f(m/d) if f(x) is zero
when x is not an integer.
4.35
The base cases are
I(0, n) = 0 ;
I(m, 0) = 1 .
When m, n > 0, there are two rules, where the rst is trivial if m > n and
the second is trivial if m < n:
I(m, n) = I(m, n mod m) ‚àí‚åän/m‚åãI(n mod m, m) ;
I(m, n) = I(m mod n, n) .
4.36
A factorization of any of the given quantities into nonunits must have
m2 ‚àí10n2 = ¬±2 or ¬±3, but this is impossible mod 10.
4.37
Let an = 2‚àín ln(en ‚àí1
2) and bn = 2‚àín ln(en + 1
2). Then
en = ‚åäE2n + 1
2‚åã
‚áê‚áí
an  ln E < bn .
And an‚àí1 < an < bn < bn‚àí1, so we can take E = limn‚Üí‚àûean. In fact, it
turns out that
E2 = 3
2
Y
n1
¬µ
1 +
1
(2en ‚àí1)2
¬∂1/2n
,
a product that converges rapidly to (1.26408473530530111 . . . )2. But these
observations don't tell us what en is, unless we can nd another expression
for E that doesn't depend on Euclid numbers.
4.38
Let r = n mod m. Then an ‚àíbn = (am ‚àíbm)(an‚àímb0 +an‚àí2mbm +
¬∑ ¬∑ ¬∑ + arbn‚àím‚àír) + bm‚åän/m‚åã(ar ‚àíbr).
4.39
If a1 . . . at and b1 . . . bu are perfect squares, so is
a1 . . . atb1 . . . bu/c2
1 . . . c2
v ,
where fa1, . . . , atg‚à©fb1, . . . , bug = fc1, . . . , cvg. (It can be shown, in fact, that
the sequence ‚ü®S(1), S(2), S(3), . . . , ‚ü©contains every nonprime positive integer
exactly once.)

A ANSWERS TO EXERCISES 519
4.40
Let f(n) = Q
1kn, p//nk k = n!/p‚åän/p‚åã‚åän/p‚åã! and g(n) = n!/pœµp(n!).
Then
g(n) = f(n)f
¬°
‚åän/p‚åã
¬¢
f
¬°
‚åän/p2‚åã
¬¢
. . . = f(n)g
¬°
‚åän/p‚åã
¬¢
.
Also f(n) ‚â°a0!(p ‚àí1)!‚åän/p‚åã‚â°a0!(‚àí1)‚åän/p‚åã(mod p), and œµp(n!) = ‚åän/p‚åã+
œµp
¬°
‚åän/p‚åã!
¬¢
. These recurrences make it easy to prove the result by induction.
(Several other solutions are possible.)
4.41
(a) If n2 ‚â°‚àí1 (mod p) then (n2)(p‚àí1)/2 ‚â°‚àí1; but Fermat says it's
+1. (b) Let n =
¬°
(p ‚àí1)/2
¬¢
!; we have n ‚â°(‚àí1)(p‚àí1)/2 Q
1k<p/2(p ‚àík) =
(p ‚àí1)!/n, hence n2 ‚â°(p ‚àí1)!.
4.42
First we observe that k ‚ä•l ‚áê‚áík ‚ä•l + ak for any integer a, since
gcd(k, l) = gcd(k, l + ak) by Euclid's algorithm. Now
m ‚ä•n
and
n‚Ä≤ ‚ä•n
‚áê‚áí
mn‚Ä≤ ‚ä•n
‚áê‚áí
mn‚Ä≤ + nm‚Ä≤ ‚ä•n .
Similarly
m‚Ä≤ ‚ä•n‚Ä≤
and
n ‚ä•n‚Ä≤
‚áê‚áí
mn‚Ä≤ + nm‚Ä≤ ‚ä•n‚Ä≤ .
Hence
m ‚ä•n
and
m‚Ä≤ ‚ä•n‚Ä≤
and
n ‚ä•n‚Ä≤
‚áê‚áí
mn‚Ä≤+nm‚Ä≤ ‚ä•nn‚Ä≤ .
4.43
We want to multiply by L‚àí1R, then by R‚àí1L‚àí1RL, then L‚àí1R, then
R‚àí2L‚àí1RL2, etc.; the nth multiplier is R‚àíœÅ(n)L‚àí1RLœÅ(n), since we must cancel
œÅ(n) R's. And R‚àímL‚àí1RLm =
¬°0
‚àí1
1 2m+1
¬¢
.
4.44
We can nd the simplest rational number that lies in
John .316
|banner displayed
during the 1993
World Series,
when John Kruk
came to bat.
[0.3155 . . 0.3165) =
¬£ 631
2000 . . 633
2000
¬¢
by looking at the Stern{Brocot representations of
631
2000 and
633
2000 and stopping
just before the former has L where the latter has R:
(m1, n1, m2, n2) := (631, 2000, 633, 2000);
while m1 > n1 or m2 < n2 do
if m2 < n2 then
¬°
output(L); (n1, n2) := (n1, n2) ‚àí(m1, m2)
¬¢
else
¬°
output(R); (m1, m2) := (m1, m2) ‚àí(n1, n2)
¬¢
.
The output is LLLRRRRR =
6
19 ‚âà.3158.
Incidentally, an average of .334
implies at least 287 at bats.

520 ANSWERS TO EXERCISES
4.45
x2 ‚â°x (mod 10n)
‚áê‚áí
x(x ‚àí1) ‚â°0 (mod 2n) and x(x ‚àí1) ‚â°0
(mod 5n) ‚áê‚áíx mod 2n = [0 or 1] and x mod 5n = [0 or 1]. (The last step
is justied because x(x ‚àí1) mod 5 = 0 implies that either x or x ‚àí1 is a
multiple of 5, in which case the other factor is relatively prime to 5n and can
be divided from the congruence.)
So there are at most four solutions, of which two (x = 0 and x = 1)
don't qualify for the title \n-digit number" unless n = 1. The other two
solutions have the forms x and 10n + 1 ‚àíx, and at least one of these numbers
is  10n‚àí1. When n = 4 the other solution, 10001 ‚àí9376 = 625, is not a
four-digit number. We expect to get two n-digit solutions for about 90% of
all n, but this conjecture has not been proved.
(Such self-reproducing numbers have been called \automorphic.")
4.46
(a) If j‚Ä≤j ‚àík‚Ä≤k = gcd(j, k), we have nk ‚Ä≤kngcd(j,k) = nj ‚Ä≤j ‚â°1 and
nk ‚Ä≤k ‚â°1. (b) Let n = pq, where p is the smallest prime divisor of n. If
2n ‚â°1 (mod n) then 2n ‚â°1 (mod p).
Also 2p‚àí1 ‚â°1 (mod p); hence
2gcd(p‚àí1,n) ‚â°1 (mod p). But gcd(p ‚àí1, n) = 1 by the denition of p.
4.47
If nm‚àí1 ‚â°1 (mod m) we must have n ‚ä•m. If nk ‚â°nj for some
1  j < k < m, then nk‚àíj ‚â°1 because we can divide by nj. Therefore if the
numbers n1 mod m, . . . , nm‚àí1 mod m are not distinct, there is a k < m ‚àí1
with nk ‚â°1. The least such k divides m‚àí1, by exercise 46(a). But then kq =
(m ‚àí1)/p for some prime p and some positive integer q; this is impossible,
since nkq Ã∏‚â°1.
Therefore the numbers n1 mod m, . . . , nm‚àí1 mod m are
distinct and relatively prime to m. Therefore the numbers 1, . . . , m ‚àí1 are
relatively prime to m, and m must be prime.
4.48
By pairing numbers up with their inverses, we can reduce the product
(mod m) to Q
1n<m, n2 mod m=1 n. Now we can use our knowledge of the
solutions to n2 mod m = 1. By residue arithmetic we nd that the result is
m ‚àí1 if m = 4, pk, or 2pk (p > 2); otherwise it's +1.
4.49
(a) Either m < n (Œ¶(N ‚àí1) cases) or m = n (one case) or m > n
(Œ¶(N ‚àí1) again). Hence R(N) = 2Œ¶(N ‚àí1) + 1. (b) From (4.62) we get
2Œ¶(N ‚àí1) + 1 = 1 +
X
d1
¬µ(d)‚åäN/d‚åã‚åäN/d ‚àí1‚åã;
hence the stated result holds if and only if
X
d1
¬µ(d)‚åäN/d‚åã= 1 ,
for N  1.
And this is a special case of (4.61) if we set f(x) = [x  1].

A ANSWERS TO EXERCISES 521
4.50
(a) If f is any function,
X
0k<m
f(k) =
X
dnm
X
0k<m
f(k)
¬£
d = gcd(k, m)
¬§
=
X
dnm
X
0k<m
f(k)
¬£
k/d ‚ä•m/d
¬§
=
X
dnm
X
0k<m/d
f(kd)
¬£
k ‚ä•m/d
¬§
=
X
dnm
X
0k<d
f(km/d)
¬£
k ‚ä•d
¬§
;
we saw a special case of this in the derivation of (4.63). An analogous deriva-
tion holds for Q instead of P. Thus we have
zm ‚àí1 =
Y
0k<m
(z ‚àíœâk) =
Y
dnm
Y
0k<d
k‚ä•d
(z ‚àíœâkm/d) =
Y
dnm
Œ®d(z)
because œâm/d = e2œÄi/d.
Part (b) follows from part (a) by the analog of (4.56) for products
instead of sums.
Incidentally, this formula shows that Œ®m(z) has integer
coecients, since Œ®m(z) is obtained by multiplying and dividing polynomials
whose leading coecient is 1.
4.51
(x1 + ¬∑ ¬∑ ¬∑ + xn)p = P
k1+¬∑¬∑¬∑+kn=p p!/(k1! . . . kn!)xk1
1 . . . xkn
n , and the
coecient is divisible by p unless some kj = p. Hence (x1 + ¬∑ ¬∑ ¬∑ + xn)p ‚â°
xp
1 + ¬∑ ¬∑ ¬∑ + xp
n (mod p). Now we can set all the x's to 1, obtaining np ‚â°n.
4.52
If p > n there is nothing to prove. Otherwise x ‚ä•p, so xk(p‚àí1) ‚â°1
(mod p); this means that at least
¬•
(n ‚àí1)/(p ‚àí1)
¬¶
of the given numbers are
multiples of p. And (n ‚àí1)/(p ‚àí1)  n/p since n  p.
4.53
First show that if m  6 and m is not prime then (m‚àí2)! ‚â°0 (mod m).
\Die ganzen Zahlen
hat der liebe Gott
gemacht, alles
andere ist
Menschenwerk."
|L.Kronecker [365]
(If m = p2, the product for (m ‚àí2)! includes p and 2p; otherwise it includes
d and m/d where d < m/d.) Next consider cases:
Case 0, n < 5. The condition holds for n = 1 only.
Case 1, n  5 and n is prime. Then (n ‚àí1)!/(n + 1) is an integer and
it can't be a multiple of n.
Case 2, n  5, n is composite, and n + 1 is composite. Then n and
n + 1 divide (n ‚àí1)!, and n ‚ä•n + 1; hence n(n + 1)n(n ‚àí1)!.
Case 3, n  5, n is composite, and n + 1 is prime. Then (n ‚àí1)! ‚â°1
(mod n + 1) by Wilson's theorem, and
¬•
(n ‚àí1)!/(n + 1)
¬¶
=
¬°
(n ‚àí1)! + n
¬¢
/(n + 1) ;

522 ANSWERS TO EXERCISES
this is divisible by n.
Therefore the answer is: Either n = 1 or n Ã∏= 4 is composite.
4.54
œµ2(1000!) > 500 and œµ5(1000!) = 249, hence 1000! = a¬∑10249 for some
even integer a.
Since 1000 = (1300)5, exercise 40 tells us that a ¬∑ 2249 =
1000!/5249 ‚â°‚àí1 (mod 5). Also 2249 ‚â°2, hence a ‚â°2, hence a mod 10 = 2
or 7; hence the answer is 2¬∑10249.
4.55
One way is to prove by induction that P2n/P4
n(n + 1) is an integer;
this stronger result helps the induction go through. Another way is based
on showing that each prime p divides the numerator at least as often as it
divides the denominator. This reduces to proving the inequality
2n
X
k=1
‚åäk/m‚åã 4
n
X
k=1
‚åäk/m‚åã,
which follows from
¬•
(2n ‚àí1)/m
¬¶
+
¬•
2n/m
¬¶
 ‚åän/m‚åã.
The latter is true when 0  n < m, and both sides increase by 4 when n is
increased by m.
4.56
Let f(m) = P2n‚àí1
k=1 min(k, 2n‚àík)[mnk], g(m) = Pn‚àí1
k=1 (2n‚àí2k‚àí1) √ó
¬£
mn(2k + 1)
¬§
. The number of times p divides the numerator of the stated
product is f(p) + f(p2) + f(p3) + ¬∑ ¬∑ ¬∑ , and the number of times p divides the
denominator is g(p) + g(p2) + g(p3) + ¬∑ ¬∑ ¬∑ . But f(m) = g(m) whenever m is
odd, by exercise 2.32. The stated product therefore reduces to 2n(n‚àí1), by
exercise 3.22.
4.57
The hint suggests a standard interchange of summation, since
X
1mn
[dnm] =
X
0<kn/d
[m = dk] = ‚åän/d‚åã.
Calling the hinted sum Œ£(n), we have
Œ£(m + n) ‚àíŒ£(m) ‚àíŒ£(n) =
X
d‚ààS(m,n)
œï(d) .
On the other hand, we know from (4.54) that Œ£(n) =
1
2n(n + 1).
Hence
Œ£(m + n) ‚àíŒ£(m) ‚àíŒ£(n) = mn.
4.58
The function f(m) is multiplicative, and when m = pk it equals 1 +
p + ¬∑ ¬∑ ¬∑ + pk. This is a power of 2 if and only if p is a Mersenne prime and
k = 1. For k must be odd, and in that case the sum is
(1 + p)(1 + p2 + p4 + ¬∑ ¬∑ ¬∑ + pk‚àí1)

A ANSWERS TO EXERCISES 523
and (k‚àí1)/2 must be odd, etc. The necessary and sucient condition is that
m be a product of distinct Mersenne primes.
4.59
Proof of the hint: If n = 1 we have x1 = Œ± = 2, so there's no problem.
If n > 1 we can assume that x1  ¬∑ ¬∑ ¬∑  xn. Case 1: x‚àí1
1
+ ¬∑ ¬∑ ¬∑ + x‚àí1
n‚àí1 +
(xn ‚àí1)‚àí1  1 and xn > xn‚àí1. Then we can nd Œ≤  xn ‚àí1  xn‚àí1 such
that x‚àí1
1
+ ¬∑ ¬∑ ¬∑ + x‚àí1
n‚àí1 + Œ≤‚àí1 = 1; hence xn  Œ≤ + 1  en and x1 . . . xn 
x1 . . . xn‚àí1(Œ≤ + 1)  e1 . . . en, by induction. There is a positive integer m
such that Œ± = x1 . . . xn/m; hence Œ±  e1 . . . en = en+1 ‚àí1, and we have
x1 . . . xn(Œ± + 1)  e1 . . . enen+1. Case 2: x‚àí1
1
+ ¬∑ ¬∑ ¬∑ + x‚àí1
n‚àí1 + (xn ‚àí1)‚àí1  1
and xn = xn‚àí1. Let a = xn and a‚àí1 + (a ‚àí1)‚àí1 = (a ‚àí2)‚àí1 + Œ∂‚àí1. Then
we can show that a  4 and (a ‚àí2)(Œ∂ + 1)  a2. So there's a Œ≤  Œ∂ such
that x‚àí1
1
+ ¬∑ ¬∑ ¬∑ + x‚àí1
n‚àí2 + (a ‚àí2)‚àí1 + Œ≤‚àí1 = 1; it follows by induction that
x1 . . . xn  x1 . . . xn‚àí2(a ‚àí2)(Œ∂ + 1)  x1 . . . xn‚àí2(a ‚àí2)(Œ≤ + 1)  e1 . . . en,
and we can nish as before. Case 3: x‚àí1
1
+ ¬∑ ¬∑ ¬∑ + x‚àí1
n‚àí1 + (xn ‚àí1)‚àí1 < 1.
Let a = xn, and let a‚àí1 + Œ±‚àí1 = (a ‚àí1)‚àí1 + Œ≤‚àí1. It can be shown that
(a ‚àí1)(Œ≤ + 1) > a(Œ± + 1), because this identity is equivalent to
aŒ±2 ‚àía2Œ± + aŒ± ‚àía2 + Œ± + a > 0 ,
which is a consequence of aŒ±(Œ± ‚àía) + (1 + a)Œ±  (1 + a)Œ± > a2 ‚àía. Hence
we can replace xn and Œ± by a ‚àí1 and Œ≤, repeating this transformation until
cases 1 or 2 apply.
Another consequence of the hint is that 1/x1 + ¬∑ ¬∑ ¬∑ + 1/xn < 1 implies
1/x1 + ¬∑ ¬∑ ¬∑ + 1/xn  1/e1 + ¬∑ ¬∑ ¬∑ + 1/en; see exercise 16.
4.60
The main point is that Œ∏ < 2
3. Then we can take p1 suciently large
(to meet the conditions below) and pn to be the least prime greater than
p3
n‚àí1. With this denition let an = 3‚àín ln pn and bn = 3‚àín ln(pn + 1). If
we can show that an‚àí1  an < bn  bn‚àí1, we can take P = limn‚Üí‚àûean as
in exercise 37. But this hypothesis is equivalent to p3
n‚àí1  pn < (pn‚àí1 +1)3.
If there's no prime pn in this range, there must be a prime p < p3
n‚àí1 such
\Man made
the integers:
All else is
Dieudonne."
|R.K. Guy
that p + cpŒ∏ > (pn‚àí1 + 1)3. But this implies that cpŒ∏ > 3p2/3, which is
impossible when p is suciently large.
We can almost certainly take p1 = 2, since all available evidence indi-
cates that the known bounds on gaps between primes are much weaker than
the truth (see exercise 69). Then p2 = 11, p3 = 1361, p4 = 2521008887, and
1.306377883863 < P < 1.306377883869.
4.61
Let ^m and ^n be the right-hand sides; observe that ^mn‚Ä≤ ‚àím‚Ä≤^n = 1,
hence ^m ‚ä•^n. Also ^m/^n > m‚Ä≤/n‚Ä≤ and N =
¬°
(n + N)/n‚Ä≤¬¢
n‚Ä≤ ‚àín  ^n >
¬°
(n+N)/n‚Ä≤ ‚àí1
¬¢
n‚Ä≤ ‚àín = N‚àín‚Ä≤  0. So we have ^m/^n  m‚Ä≤‚Ä≤/n‚Ä≤‚Ä≤. If equality
doesn't hold, we have n‚Ä≤‚Ä≤ = ( ^mn‚Ä≤ ‚àím‚Ä≤^n)n‚Ä≤‚Ä≤ = n‚Ä≤( ^mn‚Ä≤‚Ä≤ ‚àím‚Ä≤‚Ä≤^n) + ^n(m‚Ä≤‚Ä≤n‚Ä≤ ‚àí
m‚Ä≤n‚Ä≤‚Ä≤)  n‚Ä≤ + ^n > N, a contradiction.

524 ANSWERS TO EXERCISES
Incidentally, this exercise implies that (m + m‚Ä≤‚Ä≤)/(n + n‚Ä≤‚Ä≤) = m‚Ä≤/n‚Ä≤,
although the former fraction is not always reduced.
4.62
2‚àí1 + 2‚àí2 + 2‚àí3 ‚àí2‚àí6 ‚àí2‚àí7 + 2‚àí12 + 2‚àí13 ‚àí2‚àí20 ‚àí2‚àí21 + 2‚àí30 +
2‚àí31 ‚àí2‚àí42 ‚àí2‚àí43 + ¬∑ ¬∑ ¬∑ can be written
1
2 + 3
X
k0
¬°
2‚àí4k2‚àí6k‚àí3 ‚àí2‚àí4k2‚àí10k‚àí7¬¢
.
This sum, incidentally, can be expressed in closed form using the \theta func-
tion" Œ∏(z, Œª) = P
k e‚àíœÄŒªk2+2izk; we have
e
‚Üî
1
2 + 3
8Œ∏( 4
œÄ ln 2, 3i ln 2) ‚àí
3
128Œ∏( 4
œÄ ln 2, 5i ln 2) .
4.63
Any n > 2 either has a prime divisor d or is divisible by d = 4. In
either case, a solution with exponent n implies a solution (an/d)d+(bn/d)d =
I have discovered a
wonderful proof of
Fermat's Last Theo-
rem, but there's no
room for it here.
(cn/d)d with exponent d. Since d = 4 has no solutions, d must be prime.
The hint follows from the binomial theorem, since (ap +(x‚àía)p)/x ‚â°
pap‚àí1 (mod x) when p is odd. The smallest counterexample, if (4.46) fails,
has a ‚ä•x. If x is not divisible by p then x is relatively prime to cp/x; this
means that whenever q is prime and qennx and qfnnc, we have e = fp. Hence
x = mp for some m. On the other hand if x is divisible by p, then cp/x is
divisible by p but not by p2, and cp has no other factors in common with x.
4.64
Equal fractions in PN appear in \organ-pipe order":
2m
2n , 4m
4n , . . . , rm
rn , . . . , 3m
3n , m
n .
Suppose that PN is correct; we want to prove that PN+1 is correct. This
means that if kN is odd, we want to show that
k ‚àí1
N + 1 = PN,kN ;
if kN is even, we want to show that
PN,kN‚àí1 PN,kN
k ‚àí1
N + 1 PN,kN PN,kN+1 .
In both cases it will be helpful to know the number of fractions that are
strictly less than (k ‚àí1)/(N + 1) in PN; this is
N
X
n=1
X
m
h
0  m
n < k ‚àí1
N + 1
i
=
N
X
n=1
¬ª(k ‚àí1)n
N + 1
¬º
=
N
X
n=0
¬π(k ‚àí1)n + N
N + 1
¬∫
= (k ‚àí2)N
2
+ d ‚àí1
2
+ d
¬πN
d
¬∫

A ANSWERS TO EXERCISES 525
by (3.32), where d = gcd(k ‚àí1, N + 1). And this reduces to 1
2(kN ‚àíd + 1),
since N mod d = d ‚àí1.
Furthermore, the number of fractions equal to (k ‚àí1)/(N + 1) in PN
that should precede it in PN+1 is 1
2
¬°
d‚àí1‚àí[d even]
¬¢
, by the nature of organ-
pipe order.
If kN is odd, then d is even and (k‚àí1)/(N+1) is preceded by 1
2(kN‚àí1)
elements of PN; this is just the correct number to make things work. If kN
is even, then d is odd and (k ‚àí1)/(N + 1) is preceded by 1
2(kN) elements
of PN. If d = 1, none of these equals (k ‚àí1)/(N + 1) and PN,kN is `<';
otherwise (k ‚àí1)/(N + 1) falls between two equal elements and PN,kN is `='.
(C. S. Peirce [288] independently discovered the Stern{Brocot tree at about
the same time as he discovered PN.)
4.65
The analogous question for the (analogous) Fermat numbers fn is a
\No square less than
25 √ó 1014 divides a
Euclid number."
|Ilan Vardi
famous unsolved problem. This one might be easier or harder.
4.66
It is known that no square less than 36 √ó 1018 divides a Mersenne
number or Fermat number. But there has still been no proof of Schinzel's
conjecture that there exist innitely many squarefree Mersenne numbers. It
is not even known if there are innitely many p such that pnn(a ¬± b), where
all prime factors of a and b are  31.
4.67
M. Szegedy has proved this conjecture for all large n; see [348], [95,
pp. 78{79], and [55].
4.68
This is a much weaker conjecture than the result in the following ex-
ercise.
4.69
Cramer [66] showed that this conjecture is plausible on probabilistic
grounds, and computational experience bears this out: Brent [37] has shown
that Pn+1 ‚àíPn  602 for Pn+1 < 2.686 √ó 1012. But the much weaker bounds
in exercise 60 are the best that have been published so far [255]. Exercise 68
has a \yes" answer if Pn+1 ‚àíPn < 2P1/2
n
for all suciently large n. According
to Guy [169, problem A8], Paul Erd}os oers $10,000 for proof that there are
innitely many n such that
Pn+1 ‚àíPn > c ln n ln ln n ln ln ln ln n
(ln ln ln n)2
for all c > 0.
4.70
This holds if and only if ŒΩ2(n) = ŒΩ3(n), according to exercise 24. The
methods of [96] may help to crack this conjecture.
4.71
When k = 3 the smallest solution is n = 4700063497 = 19¬∑47¬∑5263229;
no other solutions are known in this case.

526 ANSWERS TO EXERCISES
4.72
This is known to be true for innitely many values of a, including ‚àí1
(of course) and 0 (not so obviously). Lehmer [244] has a famous conjecture
that œï(n)n(n ‚àí1) if and only if n is prime.
4.73
This is known to be equivalent to the Riemann hypothesis (that the
complex zeta function Œ∂(z) is nonzero when the real part of z is greater
than 1/2).
4.74
Experimental evidence suggests that there are about p(1 ‚àí1/e) dis-
tinct values, just as if the factorials were randomly distributed modulo p.
5.1
(11)4
r = (14641)r, in any number system of radix r  7, because of the
What's 114 in
radix 11?
binomial theorem.
5.2
The ratio
¬° n
k+1
¬¢¬±¬°n
k
¬¢
= (n ‚àík)/(k + 1) is  1 when k  ‚åän/2‚åãand  1
when k < ‚åàn/2‚åâ, so the maximum occurs when k = ‚åän/2‚åãand k = ‚åàn/2‚åâ.
5.3
Expand into factorials. Both products are equal to f(n)/f(n ‚àík)f(k),
where f(n) = (n + 1)! n! (n ‚àí1)!.
5.4
¬°‚àí1
k
¬¢
= (‚àí1)k¬°k+1‚àí1
k
¬¢
= (‚àí1)k¬°k
k
¬¢
= (‚àí1)k[k  0].
5.5
If 0 < k < p, there's a p in the numerator of
¬°p
k
¬¢
with nothing to
cancel it in the denominator.
Since
¬°p
k
¬¢
=
¬°p‚àí1
k
¬¢
+
¬°p‚àí1
k‚àí1
¬¢
, we must have
¬°p‚àí1
k
¬¢
‚â°(‚àí1)k (mod p), for 0  k < p.
5.6
The crucial step (after second down) should be
1
n + 1
X
k
¬µn + k
k
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k
=
1
n + 1
X
k0
¬µn + k
n
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k
=
1
n + 1
X
k
¬µn + k
n
¬∂¬µn + 1
k + 1
¬∂
(‚àí1)k
‚àí
1
n + 1
¬µn ‚àí1
n
¬∂¬µn + 1
0
¬∂
(‚àí1)‚àí1 .
The original derivation forgot to include this extra term, which is [n = 0].
5.7
Yes, because r‚àík = (‚àí1)k/(‚àír ‚àí1)k. We also have
rk(r + 1
2)k = (2r)2k/22k .
5.8
f(k) = (k/n‚àí1)n is a polynomial of degree n whose leading coecient
is n‚àín. By (5.40), the sum is n!/nn. When n is large, Stirling's approxima-
tion says that this is approximately
‚àö
2œÄn/en. (This is quite dierent from
(1 ‚àí1/e), which is what we get if we use the approximation (1‚àík/n)n ‚àºe‚àík,
valid for xed k as n ‚Üí‚àû.)

A ANSWERS TO EXERCISES 527
5.9
Et(z)t = P
k0 t(tk + t)k‚àí1zk/k! = P
k0(k + 1)k‚àí1(tz)k/k! = E1(tz),
by (5.60).
5.10
P
k0 2zk/(k + 2) = F(2, 1; 3; z), since tk+1/tk = (k + 2)z/(k + 3).
5.11
The rst is Besselian and the second is Gaussian:
But not Imbesselian.
z‚àí1 sin z = P
k0(‚àí1)kz2k/(2k + 1)! = F(1; 1, 3
2; ‚àíz2/4) ;
z‚àí1 arcsin z = P
k0 z2k( 1
2)k/(2k + 1)k! = F( 1
2, 1
2; 3
2; z2) .
5.12
(a) Yes, if n Ã∏= 0, since the term ratio is n. (b) Yes, when n is an
integer; the term ratio is (k + 1)n/kn. Notice that we get this term from
(5.115) by setting m = n + 1, a1 = ¬∑ ¬∑ ¬∑ = am = 1, b1 = ¬∑ ¬∑ ¬∑ = bn = 0, z = 1,
and multiplying by 0n. (c) Yes, the term ratio is (k+1)(k+3)/(k+2). (d) No,
Each value of a
hypergeometric
term t(k) can be
written 0e(k)v(k),
where e(k) is
an integer and
v(k) Ã∏= 0. Sup-
pose the term ratio
t(k + 1)/t(k) is
p(k)/q(k), and
that p and q have
been completely
factored over the
complex numbers.
Then, for each k,
e(k + 1) is e(k)
plus the number of
zero factors of p(k)
minus the number
of zero factors of
q(k), and v(k + 1)
is v(k) times the
product of the
nonzero factors
of p(k) divided
by the product of
the nonzero factors
of q(k).
the term ratio is 1 + 1/(k + 1)Hk; and Hk ‚àºln k isn't a rational function.
(e) Yes, the reciprocal of any hypergeometric term is a hypergeometric term.
The fact that t(k) = ‚àûwhen k < 0 or k > n does not exclude t(k) from
hypergeometric termhood. (f) Of course. (g) Not when, say, t(k) = 2k and
T(k) = 1. (h) Yes; the term ratio t(n ‚àí1 ‚àík)/t(n ‚àí1 ‚àí(k + 1)) is a rational
function (the reciprocal of the term ratio for t, with k replaced by n ‚àí1 ‚àík),
for arbitrary n. (i) Yes; the term ratio can be written
a t(k+1)/t(k) + b t(k+2)/t(k) + c t(k+3)/t(k)
a + b t(k+1)/t(k) + c t(k+2)/t(k)
,
and t(k + m)/t(k) =
¬°
t(k + m)/t(k + m ‚àí1)
¬¢
. . .
¬°
t(k + 1)/t(k)
¬¢
is a rational
function of k.
(j) No.
Whenever two rational functions p1(k)/q1(k) and
p2(k)/q2(k) are equal for innitely many k, they are equal for all k, because
p1(k)q2(k) = q1(k)p2(k) is a polynomial identity. Therefore the term ratio
‚åà(k+1)/2‚åâ/‚åàk/2‚åâwould have to equal 1 if it were a rational function. (k) No.
The term ratio would have to be (k + 1)/k, since it is (k + 1)/k for all k > 0;
but then t(‚àí1) can be zero only if t(0) is a multiple of 02, while t(1) can be 1
only if t(0) = 01.
5.13
Rn = n!n+1/P2
n = Qn/Pn = Q2
n/n!n+1.
5.14
The rst factor in (5.25) is
¬°
l‚àík
l‚àík‚àím
¬¢
when k  l, so it's (‚àí1)l‚àík‚àím √ó
¬° ‚àím‚àí1
l‚àík‚àím
¬¢
.
The sum for k  l is the sum over all k, since m  0.
(The
condition n  0 isn't really needed, although k must assume negative values
if n < 0.)
To go from (5.25) to (5.26), rst replace s by ‚àí1 ‚àín ‚àíq.
5.15
If n is odd, the sum is zero, since we can replace k by n‚àík. If n = 2m,
the sum is (‚àí1)m(3m)!/m!3, by (5.29) with a = b = c = m.

528 ANSWERS TO EXERCISES
5.16
This is just (2a)! (2b)! (2c)!/(a+b)! (b+c)! (c+a)! times (5.29), if we
write the summands in terms of factorials.
5.17
The formulas
¬°2n‚àí1/2
n
¬¢
=
¬°4n
2n
¬¢
/22n and
¬°2n‚àí1/2
2n
¬¢
=
¬°4n
2n
¬¢
/24n yield
¬°2n‚àí1/2
n
¬¢
= 22n¬°2n‚àí1/2
2n
¬¢
.
5.18
¬°3r
3k
¬¢¬° 3k
k,k,k
¬¢
/33k.
5.19
B1‚àít(‚àíz)‚àí1 = P
k0
¬°k‚àítk‚àí1
k
¬¢¬°
‚àí1/(k ‚àítk ‚àí1)
¬¢
(‚àíz)k, by (5.60), and
this is P
k0
¬°tk
k
¬¢¬°
1/(tk ‚àík + 1)
¬¢
zk = Bt(z).
5.20
It equals F(‚àía1, . . . , ‚àíam; ‚àíb1, . . . , ‚àíbn; (‚àí1)m+nz); see exercise 2.17.
5.21
limn‚Üí‚àû(n + m)m/nm = 1.
5.22
Multiplying and dividing instances of (5.83) gives
(‚àí1/2)!
x! (x ‚àí1/2)! =
lim
n‚Üí‚àû
¬µn + x
n
¬∂¬µn + x ‚àí1/2
n
¬∂
n‚àí2x
√Å¬µn ‚àí1/2
n
¬∂
=
lim
n‚Üí‚àû
¬µ2n + 2x
2n
¬∂
n‚àí2x ,
by (5.34) and (5.36). Also
1/(2x)! =
lim
n‚Üí‚àû
¬µ2n + 2x
2n
¬∂
(2n)‚àí2x .
Hence, etc. The Gamma function equivalent, incidentally, is
Œì(x) Œì(x + 1
2) = Œì(2x) Œì( 1
2)/22x‚àí1 .
5.23
(‚àí1)nn< , see (5.50).
5.24
This sum is
¬°n
m
¬¢
F
¬° m‚àín,‚àím
1/2
j1
¬¢
=
¬°2n
2m
¬¢
, by (5.35) and (5.93).
5.25
This is equivalent to the easily proved identity
(a ‚àíb)
ak
(b + 1)k = a (a + 1)k
(b + 1)k ‚àíb ak
bk
as well as to the operator formula a ‚àíb = (œë + a) ‚àí(œë + b).
Similarly, we have
(a1 ‚àía2) F
¬µa1, a2, a3, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
= a1 F
¬µa1+1, a2, a3, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
‚àía2 F
¬µa1, a2+1, a3, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
,

A ANSWERS TO EXERCISES 529
because a1‚àía2 = (a1+k)‚àí(a2+k). If a1‚àíb1 is a nonnegative integer d, this
second identity allows us to express F(a1, . . . , am; b1, . . . , bn; z) as a linear
combination of F(a2 + j, a3, . . . , am; b2, . . . , bn; z) for 0  j  d, thereby
eliminating an upper parameter and a lower parameter. Thus, for example,
we get closed forms for F(a, b; a ‚àí1; z), F(a, b; a ‚àí2; z), etc.
Gauss [143, ¬ß7] derived analogous relations between F(a, b; c; z) and
any two \contiguous" hypergeometrics in which a parameter has been changed
by ¬±1. Rainville [301] generalized this to cases with more parameters.
5.26
If the term ratio in the original hypergeometric series is tk+1/tk = r(k),
the term ratio in the new one is tk+2/tk+1 = r(k + 1). Hence
F
¬µa1, . . . , am
b1, . . . , bn
¬Ø¬Ø¬Ø z
¬∂
= 1 + a1 . . . am z
b1 . . . bn
F
¬µa1+1, . . . , am+1, 1
b1+1, . . . , bn+1, 2
¬Ø¬Ø¬Ø z
¬∂
.
5.27
This is the sum of the even terms of F(2a1, . . . , 2am; 2b1, . . . , 2bm; z).
We have (2a)2k+2/(2a)2k = 4(k + a)(k + a + 1
2), etc.
5.28
F
¬° a, b
c jz
¬¢
= (1 ‚àíz)‚àía F
¬° a, c‚àíb
c
j ‚àíz
1‚àíz
¬¢
= (1 ‚àíz)‚àía F
¬° c‚àíb, a
c
j ‚àíz
1‚àíz
¬¢
=
Equating coe-
cients of zn gives
the Pfa-Saalschutz
formula (5.97).
(1 ‚àíz)c‚àía‚àíb F
¬° c‚àía, c‚àíb
c
jz
¬¢
. (Euler proved the identity by showing that both
sides satisfy the same dierential equation. The reection law is often at-
tributed to Euler, but it does not seem to appear in his published papers.)
5.29
The coecients of zn are equal, by Vandermonde's convolution. (Kum-
mer's original proof was dierent: He considered limm‚Üí‚àûF(m, b‚àía; b; z/m)
in the reection law (5.101).)
5.30
Dierentiate again to get z(1 ‚àíz)F‚Ä≤‚Ä≤(z) + (2 ‚àí3z)F‚Ä≤(z) ‚àíF(z) = 0.
Therefore F(z) = F(1, 1; 2; z) by (5.108).
5.31
The condition f(k) = T(k + 1) ‚àíT(k) implies that f(k + 1)/f(k) =
¬°
T(k + 2)/T(k + 1) ‚àí1
¬¢¬±¬°
1 ‚àíT(k)/T(k + 1)
¬¢
is a rational function of k.
5.32
When summing a polynomial in k, Gosper's method reduces to the
\method of undetermined coecients." We have q(k) = r(k) = 1, and we
try to solve p(k) = s(k + 1) ‚àís(k). The method suggests letting s(k) be a
polynomial whose degree is d = deg(p) + 1.
5.33
The solution to k = (k ‚àí1)s(k + 1) ‚àí(k + 1)s(k) is s(k) = ‚àík + 1
2;
hence the answer is (1 ‚àí2k)/2k(k ‚àí1) + C.
5.34
The limiting relation holds because all terms for k > c vanish, and
œµ ‚àíc cancels with ‚àíc in the limit of the other terms. Therefore the second
partial sum is limœµ‚Üí0 F(‚àím, ‚àín; œµ‚àím; 1) = limœµ‚Üí0(œµ+n‚àím)m/(œµ‚àím)m =
(‚àí1)m¬°n‚àí1
m
¬¢
.
5.35
(a) 2‚àín3n[n  0]. (b) (1 ‚àí1
2)‚àík‚àí1[k  0] = 2k+1[k  0].

530 ANSWERS TO EXERCISES
5.36
The sum of the digits of m + n is the sum of the digits of m plus the
sum of the digits of n, minus p ‚àí1 times the number of carries, because each
carry decreases the digit sum by p ‚àí1. [See [226] for extensions of this result
to generalized binomial coecients.]
5.37
Dividing the rst identity by n! yields
¬°x+y
n
¬¢
= P
k
¬°x
k
¬¢¬°
y
n‚àík
¬¢
, Van-
dermonde's convolution. The second identity follows, for example, from the
formula xk = (‚àí1)k(‚àíx)k if we negate both x and y.
5.38
Choose c as large as possible such that
¬°c
3
¬¢
 n. Then 0  n ‚àí
¬°c
3
¬¢
<
¬°c+1
3
¬¢
‚àí
¬°c
3
¬¢
=
¬°c
2
¬¢
; replace n by n ‚àí
¬°c
3
¬¢
and continue in the same fashion.
Conversely, any such representation is obtained in this way. (We can do the
same thing with
n =
¬µa1
1
¬∂
+
¬µa2
2
¬∂
+ ¬∑ ¬∑ ¬∑ +
¬µam
m
¬∂
,
0  a1 < a2 < ¬∑ ¬∑ ¬∑ < am
for any xed m.)
5.39
xmyn = Pm
k=1
¬°m+n‚àí1‚àík
n‚àí1
¬¢
anbm‚àíkxk + Pn
k=1
¬°m+n‚àí1‚àík
m‚àí1
¬¢
an‚àíkbmyk
for all mn > 0, by induction on m + n.
5.40
(‚àí1)m+1 Pn
k=1
Pm
j=1
¬°r
j
¬¢¬°m‚àírk‚àís‚àí1
m‚àíj
¬¢
= (‚àí1)m Pn
k=1
¬°¬°m‚àírk‚àís‚àí1
m
¬¢
‚àí
¬°m‚àír(k‚àí1)‚àís‚àí1
m
¬¢¬¢
= (‚àí1)m¬°¬°m‚àírn‚àís‚àí1
m
¬¢
‚àí
¬°m‚àís‚àí1
m
¬¢¬¢
=
¬°rn+s
m
¬¢
‚àí
¬° s
m
¬¢
.
5.41
P
k0 n!/(n ‚àík)! (n + k + 1)! =
¬°
n!/(2n + 1)!
¬¢ P
k>n
¬°2n+1
k
¬¢
, which is
22nn!/(2n + 1)!.
5.42
We treat n as an indeterminate real variable. Gosper's method with
q(k) = k + 1 and r(k) = k ‚àí1 ‚àín has the solution s(k) = 1/(n + 2); hence
the desired indenite sum is (‚àí1)x‚àí1 n+1
n+2/
¬°n+1
x
¬¢
. And
n
X
k=0
(‚àí1)k.¬µn
k
¬∂
= (‚àí1)x‚àí1 n + 1
n + 2
√Å¬µn+1
x
¬∂¬Ø¬Ø¬Ø¬Ø
n+1
0
= 2 n + 1
n + 2 [n even] .
This exercise, incidentally, implies the formula
1
n
¬µn ‚àí1
k
¬∂ =
1
(n + 1)
¬µ n
k + 1
¬∂ +
1
(n + 1)
¬µn
k
¬∂ ,
a \dual" to the basic recurrence (5.8).
5.43
After the hinted rst step we can apply (5.21) and sum on k. Then
(5.21) applies again and Vandermonde's convolution nishes the job. (A com-
binatorial proof of this identity has been given by Andrews [10]. There's a
quick way to go from this identity to a proof of (5.29), explained in [207,
exercise 1.2.6{62].)

A ANSWERS TO EXERCISES 531
5.44
Cancellation of factorials shows that
¬µm
j
¬∂¬µn
k
¬∂¬µm + n
m
¬∂
=
¬µm + n ‚àíj ‚àík
m ‚àíj
¬∂¬µj + k
j
¬∂¬µm + n
j + k
¬∂
,
so the second sum is 1/
¬°m+n
m
¬¢
times the rst. And the rst is just the special
case l = 0, n = b, r = a, s = m + n ‚àíb of (5.32), so it is
¬°a+b
a
¬¢¬°m+n‚àía‚àíb
n‚àía
¬¢
.
5.45
According to (5.9), P
kn
¬°k‚àí1/2
k
¬¢
=
¬°n+1/2
n
¬¢
.
If this form of the
answer isn't \closed" enough, we can apply (5.35) and get (2n + 1)
¬°2n
n
¬¢
4‚àín.
5.46
By (5.69), this convolution is the negative of the coecient of z2n
in B‚àí1(z)B‚àí1(‚àíz). Now (2B‚àí1(z) ‚àí1)(2B‚àí1(‚àíz) ‚àí1) =
‚àö
1 ‚àí16z2; hence
B‚àí1(z)B‚àí1(‚àíz) = 1
4
‚àö
1 ‚àí16z2 + 1
2B‚àí1(z) + 1
2B‚àí1(‚àíz) ‚àí1
4. By the binomial
theorem,
(1 ‚àí16z2)1/2 =
X
n
¬µ1/2
n
¬∂
(‚àí16)nz2n = ‚àí
X
n
¬µ2n
n
¬∂ 4nz2n
2n ‚àí1 ,
so the answer is
¬°2n
n
¬¢
4n‚àí1/(2n ‚àí1) +
¬°4n‚àí1
2n
¬¢
/(4n ‚àí1).
5.47
It's the coecient of zn in
¬°
Br(z)s/Qr(z)
¬¢¬°
Br(z)‚àís/Qr(z)
¬¢
= Qr(z)‚àí2,
The boxed
sentence
on the
other side
of this page
is true.
where Qr(z) = 1 ‚àír + rBr(z)‚àí1, by (5.61).
5.48
F(2n + 2, 1; n + 2; 1
2) = 22n+1/
¬°2n+1
n+1
¬¢
, a special case of (5.111).
5.49
Saalschutz's identity (5.97) yields
¬µx + n
n
¬∂
y
y + n F
¬µ ‚àíx, ‚àín, ‚àín‚àíy
‚àíx‚àín, 1‚àín‚àíy
¬Ø¬Ø¬Ø 1
¬∂
= (y ‚àíx)n
(y + 1)n .
5.50
The left-hand side is
X
k0
ak bk
ck
(‚àíz)k
k!
X
m0
¬µk + a + m ‚àí1
m
¬∂
zm
=
X
n0
zn X
k0
ak bk
ck k!
(‚àí1)k
¬µn + a ‚àí1
n ‚àík
¬∂
and the coecient of zn is
¬µn + a ‚àí1
n
¬∂
F
¬µa, b, ‚àín
c, a
¬Ø¬Ø¬Ø 1
¬∂an
n!
= (c ‚àíb)n
cn
by Vandermonde's convolution (5.92).
5.51
(a) Reection gives F(a, ‚àín; 2a; 2) = (‚àí1)nF(a, ‚àín; 2a; 2). (Inciden-
tally, this formula implies the remarkable identity ‚àÜ2m+1 f(0) = 0, when
f(n) = 2nxn/(2x)n.)

532 ANSWERS TO EXERCISES
(b) The term-by-term limit is P
0km
¬°m
k
¬¢
2m+1
2m+1‚àík(‚àí2)k plus an ad-
ditional term for k = 2m ‚àí1. The additional term is
(‚àím) . . . (‚àí1) (1) . . . (m) (‚àí2m + 1) . . . (‚àí1) 22m+1
(‚àí2m) . . . (‚àí1) (2m ‚àí1)!
= (‚àí1)m+1 m! m! 22m+1
(2m)!
=
‚àí2
¬°‚àí1/2
m
¬¢ ;
hence, by (5.104), this limit is ‚àí1
¬±¬°‚àí1/2
m
¬¢
, the negative of what we had.
5.52
The terms of both series are zero for k > N. This identity corresponds
to replacing k by N ‚àík. Notice that
aN = aN‚àík (a + N ‚àík)k
= aN‚àík (a + N ‚àí1)k = aN‚àík (1 ‚àía ‚àíN)k(‚àí1)k .
5.53
When b = ‚àí1
2, the left side of (5.110) is 1 ‚àí2z and the right side is
The boxed
sentence
on the
other side
of this page
is false.
(1 ‚àí4z + 4z2)1/2, independent of a. The right side is the formal power series
1 +
¬µ1/2
1
¬∂
4z(z ‚àí1) +
¬µ1/2
2
¬∂
16z2(z ‚àí1)2 + ¬∑ ¬∑ ¬∑ ,
which can be expanded and rearranged to give 1‚àí2z+0z2 +0z3 +¬∑ ¬∑ ¬∑ ; but the
rearrangement involves divergent series in its intermediate steps when z = 1,
so it is not legitimate.
5.54
If m + n is odd, say 2N ‚àí1, we want to show that
lim
œµ‚Üí0 F
¬µN‚àím‚àí1
2, ‚àíN+œµ
‚àím+œµ
¬Ø¬Ø¬Ø 1
¬∂
= 0 .
Equation (5.92) applies, since ‚àím + œµ > ‚àím ‚àí1
2 + œµ, and the denominator
factor Œì(c‚àíb) = Œì(N‚àím) is innite since N  m; the other factors are nite.
Otherwise m + n is even; setting n = m ‚àí2N we have
lim
œµ‚Üí0 F
¬µ‚àíN, N‚àím‚àí1
2 +œµ
‚àím+œµ
¬Ø¬Ø¬Ø 1
¬∂
= (N ‚àí1/2)N
mN
by (5.93). The remaining job is to show that
¬µ
m
m ‚àí2N
¬∂(N ‚àí1/2)!
(‚àí1/2)!
(m ‚àíN)!
m!
=
¬µ m ‚àíN
m ‚àí2N
¬∂
2‚àí2N ,
and this is the case x = N of exercise 22.

A ANSWERS TO EXERCISES 533
5.55
Let Q(k) = (k + A1) . . . (k + AM)Z and R(k) = (k + B1) . . . (k + BN).
Then t(k + 1)/t(k) = P(k)Q(k ‚àí1)/P(k ‚àí1)R(k), where P(k) = Q(k) ‚àíR(k)
is a nonzero polynomial.
5.56
The solution to ‚àí(k+1)(k+2) = s(k+1)+s(k) is s(k) = ‚àí1
2k2‚àík‚àí1
4;
hence P ¬°‚àí3
k
¬¢
Œ¥k = 1
8(‚àí1)k‚àí1(2k2 + 4k + 1) + C. Also
(‚àí1)k‚àí1
¬πk + 1
2
¬∫ ¬πk + 2
2
¬∫
= (‚àí1)k‚àí1
4
¬µ
k + 1 ‚àí1+(‚àí1)k
2
¬∂ ¬µ
k + 2 ‚àí1‚àí(‚àí1)k
2
¬∂
= (‚àí1)k‚àí1
8
(2k2 + 4k + 1) + 1
8 .
5.57
We have t(k+1)/t(k) = (k‚àín)(k+1+Œ∏)(‚àíz)/(k+1)(k+Œ∏). Therefore
we let p(k) = k + Œ∏, q(k) = (k ‚àín)(‚àíz), r(k) = k. The secret function s(k)
must be a constant Œ±0, and we have
k + Œ∏ =
¬°
‚àíz(k ‚àín) ‚àík) Œ±0 ;
hence Œ±0 = ‚àí1/(1 + z) and Œ∏ = ‚àínz/(1 + z). The sum is
X ¬µn
k
¬∂
zk
¬µ
k ‚àí
nz
1 + z
¬∂
Œ¥k = ‚àí
n
1 + z
¬µn ‚àí1
k ‚àí1
¬∂
zk + C .
(The special case z = 1 was mentioned in (5.18).)
5.58
If m > 0 we can replace
¬° k
m
¬¢
by
k
m
¬° k‚àí1
m‚àí1
¬¢
and derive the formula
Tm,n =
n
mTm‚àí1,n‚àí1 ‚àí
1
m
¬°n‚àí1
m
¬¢
. The summation factor
¬°n
m
¬¢‚àí1 is therefore
appropriate:
Tm,n
¬°n
m
¬¢
= Tm‚àí1,n‚àí1
¬°n‚àí1
m‚àí1
¬¢
‚àí1
m + 1
n .
We can unfold this to get
Tm,n
¬°n
m
¬¢
= T0,n‚àím ‚àíHm + Hn ‚àíHn‚àím .
Finally T0,n‚àím = Hn‚àím, so Tm,n =
¬°n
m
¬¢
(Hn ‚àíHm). (It's also possible to
derive this result by using generating functions; see Example 2 in Section 7.5.)
5.59
P
j0, k1
¬°n
j
¬¢¬£
j = ‚åälogm k‚åã
¬§
= P
j0, k1
¬°n
j
¬¢
[mj  k < mj+1], which is
P
j0
¬°n
j
¬¢
(mj+1 ‚àímj) = (m ‚àí1) P
j0
¬°n
j
¬¢
mj = (m ‚àí1)(m + 1)n.

534 ANSWERS TO EXERCISES
5.60
¬°2n
n
¬¢
‚âà4n/‚àöœÄn is the case m = n of
¬µm + n
n
¬∂
‚âà
r
1
2œÄ
¬≥ 1
m + 1
n
¬¥¬≥
1 + m
n
¬¥n¬≥
1 + n
m
¬¥m
.
5.61
Let ‚åän/p‚åã= q and n mod p = r. The polynomial identity (x + 1)p ‚â°
xp + 1 (mod p) implies that
(x + 1)pq+r ‚â°(x + 1)r(xp + 1)q
(mod p) .
The coecient of xm on the left is
¬°n
m
¬¢
. On the right it's P
k
¬°
r
m‚àípk
¬¢¬°q
k
¬¢
,
which is just
¬°
r
m mod p
¬¢¬°
q
‚åäm/p‚åã
¬¢
because 0  r < p.
5.62
¬°np
mp
¬¢
= P
k1+¬∑¬∑¬∑+kn=mp
¬° p
k1
¬¢
. . .
¬° p
kn
¬¢
‚â°
¬°n
m
¬¢
(mod p2), because all
terms of the sum are multiples of p2 except for the
¬°n
m
¬¢
terms in which
exactly m of the k's are equal to p. (Stanley [335, exercise 1.6(d)] shows that
the congruence actually holds modulo p3 when p > 3.)
5.63
This is Sn = Pn
k=0(‚àí4)k¬°n+k
n‚àík
¬¢
= Pn
k=0(‚àí4)n‚àík¬°2n‚àík
k
¬¢
.
The de-
nominator of (5.74) is zero when z = ‚àí1/4, so we can't simply plug into
that formula.
The recurrence Sn = ‚àí2Sn‚àí1 ‚àíSn‚àí2 leads to the solution
Sn = (‚àí1)n(2n + 1).
5.64
P
k0
¬°¬° n
2k
¬¢
+
¬°
n
2k+1
¬¢¬¢¬±
(k + 1) = P
k0
¬° n+1
2k+1
¬¢
/(k + 1), which is
2
n + 2
X
k0
¬µ n + 2
2k + 2
¬∂
= 2n+2 ‚àí2
n + 2
.
5.65
Multiply both sides by nn‚àí1 and replace k by n ‚àí1 ‚àík to get
X
k
¬µn ‚àí1
k
¬∂
nk(n ‚àík)! = (n ‚àí1)!
n‚àí1
X
k=0
¬°
nk+1/k! ‚àínk/(k ‚àí1)!
¬¢
= (n ‚àí1)! nn/(n ‚àí1)! .
(The partial sums can, in fact, be found by Gosper's algorithm.) Alternatively,
¬°n
k
¬¢
knn‚àí1‚àíkk! can be interpreted as the number of mappings of f1, . . . , ng into
itself with f(1), . . . , f(k) distinct but f(k+1) ‚ààff(1), . . . , f(k)g; summing on k
must give nn.
5.66
This is a walk-the-garden-path problem where there's only one \ob-
vious" way to proceed at every step. First replace k ‚àíj by l, then replace
‚åä
‚àö
l ‚åãby k, getting
X
j,k0
¬µ ‚àí1
j ‚àík
¬∂¬µ j
m
¬∂2k + 1
2j
.

A ANSWERS TO EXERCISES 535
The innite series converges because the terms for xed j are dominated by
a polynomial in j divided by 2j. Now sum over k, getting
X
j0
¬µ j
m
¬∂j + 1
2j
.
Absorb the j + 1 and apply (5.57) to get the answer, 4(m + 1).
5.67
3
¬°2n+2
n+5
¬¢
by (5.26), because
¬µ¬°k
2
¬¢
2
¬∂
= 3
¬µk + 1
4
¬∂
.
5.68
Using the fact that
X
kn/2
¬µn
k
¬∂
= 2n‚àí1 + 1
2
¬µ n
n/2
¬∂
[n is even] ,
we get n
¬°
2n‚àí1 ‚àí
¬° n‚àí1
‚åän/2‚åã
¬¢¬¢
.
5.69
Since
¬°k+1
2
¬¢
+
¬°l‚àí1
2
¬¢

¬°k
2
¬¢
+
¬°l
2
¬¢
‚áê‚áí
k < l, the minimum occurs
The boxed
sentence
on the
other side
of this page
is not a
sentence.
when the k's are as equal as possible. Hence, by the equipartition formula of
Chapter 3, the minimum is
(n mod m)
¬µ‚åàn/m‚åâ
2
¬∂
+
¬°
n ‚àí(n mod m)
¬¢¬µ‚åän/m‚åã
2
¬∂
= n
¬µ‚åän/m‚åã
2
¬∂
+ (n mod m)
j n
m
k
.
A similar result holds for any lower index in place of 2.
5.70
This is F(‚àín, 1
2; 1; 2); but it's also (‚àí2)‚àín¬°2n
n
¬¢
F(‚àín, ‚àín; 1
2 ‚àín; 1
2) if we
replace k by n‚àík. Now F(‚àín, ‚àín; 1
2 ‚àín; 1
2) = F(‚àín
2 , ‚àín
2 ; 1
2 ‚àín; 1) by Gauss's
identity (5.111). (Alternatively, F(‚àín, ‚àín; 1
2 ‚àín; 1
2) = 2‚àínF(‚àín, 1
2; 1
2 ‚àín; ‚àí1)
by the reection law (5.101), and Kummer's formula (5.94) relates this to
(5.55).) The answer is 0 when n is odd, 2‚àín¬° n
n/2
¬¢
when n is even. (See [164,
¬ß1.2] for another derivation. This sum arises in the study of a simple search
algorithm [195].)
5.71
(a) Observe that
S(z) =
X
k0
ak
zm+k
(1 ‚àíz)m+2k+1 =
zm
(1 ‚àíz)m+1 A
¬°
z/(1 ‚àíz)2¬¢
.
(b) Here A(z) = P
k0
¬°2k
k
¬¢
(‚àíz)k/(k + 1) =
¬°‚àö
1 + 4z ‚àí1
¬¢
/2z, so we have
A
¬°
z/(1 ‚àíz)2¬¢
= 1 ‚àíz. Thus Sn = [zn]
¬°
z/(1 ‚àíz)
¬¢m =
¬° n‚àí1
n‚àím
¬¢
.

536 ANSWERS TO EXERCISES
5.72
The stated quantity is m(m ‚àín) . . .
¬°
m ‚àí(k ‚àí1)n
¬¢
nk‚àíŒΩ(k)/k!. Any
prime divisor p of n divides the numerator at least k ‚àíŒΩ(k) times and di-
vides the denominator at most k ‚àíŒΩ(k) times, since this is the number of
times 2 divides k!. A prime p that does not divide n must divide the prod-
uct m(m ‚àín) . . .
¬°
m ‚àí(k ‚àí1)n
¬¢
at least as often as it divides k!, because
m(m ‚àín) . . .
¬°
m ‚àí(pr ‚àí1)n
¬¢
is a multiple of pr for all r  1 and all m.
5.73
Plugging in Xn = n! yields Œ± = Œ≤ = 1; plugging in Xn = n< yields
Œ± = 1, Œ≤ = 0. Therefore the general solution is Xn = Œ±n< + Œ≤(n! ‚àín<).
5.74
¬°n+1
k
¬¢
‚àí
¬°n‚àí1
k‚àí1
¬¢
, for 1  k  n.
5.75
The recurrence Sk(n + 1) = Sk(n) + S(k‚àí1) mod 3(n) makes it possible
to verify inductively that two of the S's are equal and that S(‚àín) mod 3(n)
diers from them by (‚àí1)n. These three values split their sum S0(n)+S1(n)+
S2(n) = 2n as equally as possible, so there must be 2n mod 3 occurrences of
‚åà2n/3‚åâand 3 ‚àí(2n mod 3) occurrences of ‚åä2n/3‚åã.
5.76
Qn,k = (n + 1)
¬°n
k
¬¢
‚àí
¬° n
k+1
¬¢
.
5.77
The terms are zero unless k1  ¬∑ ¬∑ ¬∑  km, when the product is the
The boxed
sentence
on the
other side
of this page
is not boxed.
multinomial coecient
¬µ
km
k1, k2 ‚àík1, . . . , km ‚àíkm‚àí1
¬∂
.
Therefore the sum over k1, . . . , km‚àí1 is mkm, and the nal sum over km
yields (mn+1 ‚àí1)/(m ‚àí1).
5.78
Extend the sum to k = 2m2 + m ‚àí1; the new terms are
¬°1
4
¬¢
+
¬°2
6
¬¢
+
¬∑ ¬∑ ¬∑ +
¬°m‚àí1
2m
¬¢
= 0. Since m ‚ä•(2m + 1), the pairs
¬°
k mod m, k mod (2m + 1)
¬¢
are distinct. Furthermore, the numbers (2j+1) mod (2m+1) as j varies from
0 to 2m are the numbers 0, 1, . . . , 2m in some order. Hence the sum is
X
0k<m
0j<2m+1
¬µk
j
¬∂
=
X
0k<m
2k = 2m ‚àí1 .
5.79
(a) The sum is 22n‚àí1, so the gcd must be a power of 2. If n = 2kq
where q is odd,
¬°2n
1
¬¢
is divisible by 2k+1 and not by 2k+2. Each
¬° 2n
2j+1
¬¢
is
divisible by 2k+1 (see exercise 36), so this must be the gcd. (b) If pr  n+1 <
pr+1, we get the most radix p carries by adding k to n ‚àík when k = pr ‚àí1.
The number of carries in this case is r ‚àíœµp(n + 1), and r = œµp
¬°
L(n + 1)
¬¢
.
5.80
First prove by induction that k!  (k/e)k.

A ANSWERS TO EXERCISES 537
5.81
Let fl,m,n(x) be the left-hand side. It is sucient to show that we have
fl,m,n(1) > 0 and that f ‚Ä≤
l,m,n(x) < 0 for 0  x  1. The value of fl,m,n(1)
is (‚àí1)n‚àím‚àí1¬°l+m+Œ∏
l+n
¬¢
by (5.23), and this is positive because the binomial
coecient has exactly n‚àím‚àí1 negative factors. The inequality is true when
l = 0, for the same reason. If l > 0, we have f ‚Ä≤
l,m,n(x) = ‚àíl fl‚àí1,m,n+1(x),
which is negative by induction.
5.82
Let œµp(a) be the exponent by which the prime p divides a, and let
m = n ‚àík. The identity to be proved reduces to
min
¬°
œµp(m)‚àíœµp(m+k), œµp(m+k+1)‚àíœµp(k+1), œµp(k)‚àíœµp(m+1)
¬¢
= min
¬°
œµp(k)‚àíœµp(m+k), œµp(m)‚àíœµp(k+1), œµp(m+k+1)‚àíœµp(m+1)
¬¢
.
For brevity let's write this as min(x1, y1, z1) = min(x2, y2, z2). Notice that
x1 + y1 + z1 = x2 + y2 + z2. The general relation
œµp(a) < œµp(b)
=‚áí
œµp(a) = œµp
¬°
ja ¬± bj
¬¢
allows us to conclude that x1 Ã∏= x2 =‚áímin(x1, x2) = 0; the same holds also
for (y1, y2) and (z1, z2). It's now a simple matter to complete the proof.
5.83
(Solution by P. Paule.) Let r be a nonnegative integer. The given sum
is the coecient of xlym in
X
j,k
(‚àí1)j+k (1 + x)j+k
xk
¬µr
j
¬∂¬µn
k
¬∂
(1 + y)s+n‚àíj‚àíkyj
=
¬µ
1 ‚àí(1 + x)y
1 + y
¬∂r¬µ
1 ‚àí
1 + x
(1 + y)x
¬∂n
(1 + y)s+n
= (‚àí1)n(1 ‚àíxy)n+r(1 + y)s‚àír/xn ,
so it is clearly (‚àí1)l¬°n+r
n+l
¬¢¬°
s‚àír
m‚àín‚àíl
¬¢
. (See also exercise 106.)
5.84
Following the hint, we get
zBt(z)r‚àí1B‚Ä≤
t(z) =
X
k0
¬µtk + r
k
¬∂ kzk
tk + r ,
and a similar formula for Et(z). Thus the formulas
¬°
ztB‚àí1
t (z)B‚Ä≤
t(z)+1
¬¢
Bt(z)r
and
¬°
ztE‚àí1
t (z)E‚Ä≤
t(z) + 1
¬¢
Et(z)r give the respective right-hand sides of (5.61).
We must therefore prove that
¬°
ztB‚àí1
t (z)B‚Ä≤
t(z) + 1
¬¢
Bt(z)r =
1
1 ‚àít + tBt(z)‚àí1 ,
¬°
ztE‚àí1
t (z)E‚Ä≤
t(z) + 1
¬¢
Et(z)r =
1
1 ‚àíztE(z)t ,
and these follow from (5.59).

538 ANSWERS TO EXERCISES
5.85
If f(x) = anxn + ¬∑ ¬∑ ¬∑ + a1x + a0 is any polynomial of degree  n, we
can prove inductively that
X
0œµ1,...,œµn1
(‚àí1)œµ1+¬∑¬∑¬∑+œµnf(œµ1x1+¬∑ ¬∑ ¬∑+œµnxn) = (‚àí1)nn! anx1 . . . xn .
The stated identity is the special case where an = 1/n! and xk = k3.
5.86
(a) First expand with n(n ‚àí1) index variables lij for all i Ã∏= j. Setting
kij = lij ‚àílji for 1  i < j < n and using the constraints P
iÃ∏=j(lij ‚àílji) = 0
for all i < n allows us to carry out the sums on ljn for 1  j < n and then
on lji for 1  i < j < n by Vandermonde's convolution. (b) f(z) ‚àí1 is a
polynomial of degree < n that has n roots, so it must be zero. (c) Consider
the constant terms in
Y
1i,jn
iÃ∏=j
¬µ
1 ‚àízi
zj
¬∂ai
=
n
X
k=1
Y
1i,jn
iÃ∏=j
¬µ
1 ‚àízi
zj
¬∂ai‚àí[i=k]
.
5.87
The rst term is P
k
¬°n‚àík
k
¬¢
zmk, by (5.61). The summands in the sec-
ond term are
1
m
X
k0
¬µ (n + 1)/m + (1+1/m)k
k
¬∂
(Œ∂z)k+n+1
=
1
m
X
k>n
¬µ(1+1/m)k ‚àín ‚àí1
k ‚àín ‚àí1
¬∂
(Œ∂z)k .
Since P
0j<m(Œ∂2j+1)k = m(‚àí1)l[k = ml], these terms sum to
X
k>n/m
¬µ(1+1/m)mk ‚àín ‚àí1
mk ‚àín ‚àí1
¬∂
(‚àízm)k
=
X
k>n/m
¬µ(m+1)k ‚àín ‚àí1
k
¬∂
(‚àízm)k =
X
k>n/m
¬µn ‚àímk
k
¬∂
zmk .
Incidentally, the functions Bm(zm) and Œ∂2j+1z B1+1/m(Œ∂2j+1z)1/m are the
m + 1 complex roots of the equation wm+1 ‚àíwm = zm.
5.88
Use the facts that
R‚àû
0 (e‚àít ‚àíe‚àínt) dt/t = ln n and (1 ‚àíe‚àít)/t  1.
(We have
¬°x
k
¬¢
= O(k‚àíx‚àí1) as k ‚Üí‚àû, by (5.83); so this bound implies that
Stirling's series P
k sk
¬°x
k
¬¢
converges when x > ‚àí1. Hermite [186] showed that
the sum is ln Œì(1 + x).)

A ANSWERS TO EXERCISES 539
5.89
Adding this to (5.19) gives y‚àír(x + y)m+r on both sides, by the bino-
mial theorem. Dierentiation gives
X
k>m
¬µm + r
k
¬∂¬µm ‚àík
n
¬∂
xkym‚àík‚àín
=
X
k>m
¬µ‚àír
k
¬∂¬µm ‚àík
n
¬∂
(‚àíx)k(x + y)m‚àík‚àín ,
and we can replace k by k + m + 1 and apply (5.15) to get
X
k0
¬µ
m + r
m + 1 + k
¬∂¬µ‚àín ‚àí1
k
¬∂
(‚àíx)m+1+ky‚àí1‚àík‚àín
=
X
k0
¬µ
‚àír
m + 1 + k
¬∂¬µ‚àín ‚àí1
k
¬∂
xm+1+k(x + y)‚àí1‚àík‚àín .
In hypergeometric form, this reduces to
F
¬µ1‚àír, n+1
m+2
¬Ø¬Ø¬Ø ‚àíx
y
¬∂
=
¬µ
1 + x
y
¬∂‚àín‚àí1
F
¬µm+1+r, n+1
m+2
¬Ø¬Ø¬Ø
x
x+y
¬∂
,
which is the special case (a, b, c, z) = (n + 1, m + 1 + r, m + 2, ‚àíx/y) of the
reection law (5.101). (Thus (5.105) is related to reection and to the formula
in exercise 52.)
5.90
If r is a nonnegative integer, the sum is nite, and the derivation in
The boxed
sentence
on the
other side
of this page
is self-
referential.
the text is valid as long as none of the terms of the sum for 0  k  r has
zero in the denominator. Otherwise the sum is innite, and the kth term
¬°k‚àír‚àí1
k
¬¢¬±¬°k‚àís‚àí1
k
¬¢
is approximately ks‚àír(‚àís ‚àí1)!/(‚àír ‚àí1)! by (5.83). So we
need r > s+1 if the innite series is going to converge. (If r and s are complex,
the condition is <r > <s + 1, because jkzj = k<z.) The sum is
F
¬µ‚àír, 1
‚àís
¬Ø¬Ø¬Ø 1
¬∂
= Œì(r ‚àís ‚àí1)Œì(‚àís)
Œì(r ‚àís)Œì(‚àís ‚àí1) =
s + 1
s + 1 ‚àír
by (5.92); this is the same formula we found when r and s were integers.
5.91
(It's best to have computer help for this.)
Incidentally, when c =
(a + 1)/2, this reduces to an identity that's equivalent to Gauss's identity
(5.110), in view of Pfa's reection law.
For if w = ‚àíz/(1 ‚àíz) we have
4w(1 ‚àíw) = ‚àí4z/(1 ‚àíz)2, and
F
¬µ 1
2a, 1
2a+ 1
2 ‚àíb
1+a‚àíb
¬Ø¬Ø¬Ø 4w(1‚àíw)
¬∂
= F
¬µa, a+1‚àí2b
1+a‚àíb
¬Ø¬Ø¬Ø ‚àíz
1‚àíz
¬∂
= (1 ‚àíz)a F
¬µ
a, b
1+a‚àíb
¬Ø¬Ø¬Ø z
¬∂
.

540 ANSWERS TO EXERCISES
5.92
The identities can be proved, as Clausen proved them more than 150
years ago, by showing that both sides satisfy the same dierential equation.
One way to write the resulting equations between coecients of zn is in terms
of binomial coecients:
X
k
¬µr
k
¬∂¬µs
k
¬∂¬µ
r
n ‚àík
¬∂¬µ
s
n ‚àík
¬∂
¬µr + s ‚àí1/2
k
¬∂¬µr + s ‚àí1/2
n ‚àík
¬∂ =
¬µ2r
n
¬∂¬µr + s
n
¬∂¬µ2s
n
¬∂
¬µ2r + 2s
n
¬∂¬µr + s ‚àí1/2
n
¬∂ ;
X
k
¬µ‚àí1/4 + r
k
¬∂¬µ‚àí1/4 + s
k
¬∂¬µ‚àí1/4 ‚àír
n ‚àík
¬∂¬µ‚àí1/4 ‚àís
n ‚àík
¬∂
¬µ‚àí1 + r + s
k
¬∂¬µ‚àí1 ‚àír ‚àís
n ‚àík
¬∂
=
¬µ‚àí1/2
n
¬∂¬µ‚àí1/2 + r ‚àís
n
¬∂¬µ‚àí1/2 ‚àír + s
n
¬∂
¬µ‚àí1 + r + s
n
¬∂¬µ‚àí1 ‚àír ‚àís
n
¬∂
.
Another way is in terms of hypergeometrics:
The boxed
sentence
on the
other side
of this page
is not self-
referential.
F
¬µ
a, b, 1
2 ‚àía‚àíb‚àín, ‚àín
1
2 +a+b, 1‚àía‚àín, 1‚àíb‚àín
¬Ø¬Ø¬Ø 1
¬∂
= (2a)n (a + b)n (2b)n
(2a + 2b)n an bn
;
F
¬µ
1
4 +a, 1
4 +b, a+b‚àín, ‚àín
1+a+b, 3
4 +a‚àín, 3
4 +b‚àín
¬Ø¬Ø¬Ø 1
¬∂
= (1/2)n (1/2 + a ‚àíb)n (1/2 ‚àía + b)n
(1 + a + b)n (1/4 ‚àía)n (1/4 ‚àíb)n
.
5.93
Œ±‚àí1 Qk
j=1
¬°
f(j) + Œ±
¬¢
/f(j).
5.94
Gosper's algorithm nds the answer ‚àí
¬°a‚àí1
k‚àí1
¬¢¬°‚àía‚àí1
n‚àík
¬¢
a/n + C. Conse-
quently, when m  0 is an integer, we have
X ¬µa
k
¬∂¬µm ‚àía
n ‚àík
¬∂
Œ¥k =
X
j
¬µm
j
¬∂ ‚àía
n ‚àíj
¬µa ‚àí1
k ‚àí1
¬∂¬µ ‚àía ‚àí1
n ‚àíj ‚àík
¬∂
+ C .
5.95
The leading coecients of p and r should be unity, and p should have
no factors in common with q or r. It is easy to fulll these additional condi-
tions by shuing factors around.
Now suppose p(k + 1)q(k)/p(k)r(k + 1) = P(k + 1)Q(k)/P(k)R(k + 1),
where the polynomials (p, q, r) and (P, Q, R) both satisfy the new criteria. Let

A ANSWERS TO EXERCISES 541
p0(k) = p(k)/g(k) and P0(k) = P(k)/g(k), where g(k) = gcd
¬°
p(k), P(k)
¬¢
is
the product of all common factors of p and P. Then
p0(k + 1)q(k)P0(k)R(k + 1) = p0(k)r(k + 1)P0(k + 1)Q(k) .
Suppose p0(k) Ã∏= 1. Then there is a complex number Œ± such that p0(Œ±) = 0;
this implies q(Œ±) Ã∏= 0, r(Œ±) Ã∏= 0, and P0(Œ±) Ã∏= 0.
Hence we must have
p0(Œ±+1)R(Œ±+1) = 0 and p0(Œ±‚àí1)Q(Œ±‚àí1) = 0. Let N be a positive integer
such that p0(Œ±+N) Ã∏= 0 and p0(Œ±‚àíN) Ã∏= 0. Repeating the argument N times,
we nd R(Œ±+1) . . . R(Œ±+N) = 0 = Q(Œ±‚àí1) . . . Q(Œ±‚àíN), contradicting (5.118).
Therefore p0(k) = 1. Similarly P0(k) = 1, so p(k) = P(k). Now q(Œ±) = 0
implies r(Œ± + 1) Ã∏= 0, by (5.118), hence q(k)nQ(k).
Similarly Q(k)nq(k),
so q(k) = Q(k) since they have the same leading coecient. That leaves
r(k) = R(k).
5.96
If r(k) is a nonzero rational function and T(k) is a hypergeometric term,
then r(k)T(k) is a hypergeometric term, which is called similar to T(k). (We
allow r(k) to be ‚àûand T(k) to be 0, or vice versa, for nitely many values
of k.) In particular, T(k + 1) is always similar to T(k). If T1(k) and T2(k) are
similar hypergeometric terms, then T1(k) + T2(k) is a hypergeometric term.
If T1(k), . . . , Tm(k) are mutually dissimilar, and m > 1, then T1(k) + ¬∑ ¬∑ ¬∑ +
Tm(k) cannot be zero for all but nitely many k. For if it could, consider
a counterexample for which m is minimum, and let rj(k) = Tj(k + 1)/Tj(k).
Burma-
Shave
Since T1(k) + ¬∑ ¬∑ ¬∑ + Tm(k) = 0, we have rm(k)T1(k) + ¬∑ ¬∑ ¬∑ + rm(k)Tm(k) = 0
and r1(k)T1(k) + ¬∑ ¬∑ ¬∑ + rm(k)Tm(k) = T1(k + 1) + ¬∑ ¬∑ ¬∑ + Tm(k + 1) = 0; hence
¬°
rm(k)‚àír1(k)
¬¢
T1(k)+¬∑ ¬∑ ¬∑+
¬°
rm(k)‚àírm‚àí1(k)
¬¢
Tm‚àí1(k) = 0. We cannot have
rm(k) ‚àírj(k) = 0, for any j < m, since Tj and Tm are dissimilar. But m was
minimum, so this cannot be a counterexample; it follows that m = 2. But
then T1(k) and T2(k) must be similar, since they are both zero for all but
nitely many k.
Now let t(k) be any hypergeometric term with t(k + 1)/t(k) = r(k),
and suppose that t(k) =
¬°
T1(k + 1)+ ¬∑ ¬∑ ¬∑ + Tm(k + 1)
¬¢
‚àí
¬°
T1(k)+ ¬∑ ¬∑ ¬∑ + Tm(k)
¬¢
,
where m is minimal. Then T1, . . . , Tm must be mutually dissimilar. Let rj(k)
be the rational function such that
r(k)
¬°
Tj(k + 1) ‚àíTj(k)
¬¢
‚àí
¬°
Tj(k + 2) ‚àíTj(k + 1)
¬¢
= rj(k)Tj(k) .
Suppose m > 1. Since 0 = r(k)t(k)‚àít(k+1) = r1(k)T1(k)+¬∑ ¬∑ ¬∑+rm(k)Tm(k),
we must have rj(k) = 0 for all but at most one value of j. If rj(k) = 0, the
function t(k) = Tj(k + 1) ‚àíTj(k) satises t(k + 1)/t(k) = t(k + 1)/t(k). So
Gosper's algorithm will nd a solution.
5.97
Suppose rst that z is not equal to ‚àíd ‚àí1/d for any integer d > 0.
Then in Gosper's algorithm we have p(k) = 1, q(k) = (k + 1)2, r(k) =

542 ANSWERS TO EXERCISES
k2 + kz + 1.
Since deg(Q) < deg(R) and deg(p) ‚àídeg(R) + 1 = ‚àí1, the
only possibility is z = d + 2 where d is a nonnegative integer. Trying s(k) =
Œ±dkd + ¬∑ ¬∑ ¬∑ + Œ±0 fails when d = 0 but succeeds whenever d > 0. (The linear
equations obtained by equating coecients of kd, kd‚àí1, . . . , k1 in (5.122)
express Œ±d‚àí1, . . . , Œ±0 as positive multiples of Œ±d, and the remaining equation
1 = Œ±d + ¬∑ ¬∑ ¬∑ + Œ±1 then denes Œ±d.) For example, when z = 3 the indenite
sum is (k + 2)k!2¬± Qk‚àí1
j=1 (j2 + 3j + 1) + C.
If z = ‚àíd ‚àí1/d, on the other hand, the stated terms t(k) are innite
for k  d. There are two reasonable ways to proceed: We can cancel the zero
in the denominator by redening
t(k) =
k!2
Qk
j=d+1
¬°
j2 ‚àíj(d + 1/d) + 1
¬¢ =
(d ‚àí1/d)! k!2
(k ‚àí1/d)! (k ‚àíd)! ,
thereby making t(k) = 0 for 0  k < d and positive for k  d. Then Gosper's
algorithm gives p(k) = kd, q(k) = k + 1, r(k) = k ‚àí1/d, and we can solve
(5.122) for s(k) because the coecient of kj on the right is (j + 1 + 1/d)Œ±j
plus multiples of fŒ±j+1, . . . , Œ±dg. For example, when d = 2 the indenite sum
is (3/2)! k! ( 2
7k2 ‚àí26
35k +
32
105)/(k ‚àí3/2)! + C.
Alternatively, we can try to sum the original terms, but only in the
Look, any nite
sequence is triv-
ially summable,
because we can nd
a polynomial that
matches t(k) for
0  k < d.
range 0  k < d. Then we can replace p(k) = kd by
p‚Ä≤(k) =
d
X
j=1
(‚àí1)d‚àíjj
¬∑d
j
¬∏
kj‚àí1 .
This is justied since (5.117) still holds for 0  k < d ‚àí1; we have p‚Ä≤(k) =
limœµ‚Üí0
¬°
(k+œµ)d ‚àíkd¬¢
/œµ = limœµ‚Üí0(k+œµ)d/œµ, so this trick essentially cancels
a 0 from the numerator and denominator of (5.117) as in L'Hospital's rule.
Gosper's method now yields an indenite sum.
5.98
nSn+1 = 2nSn. (Beware: This gives no information about S1/S0.)
5.99
Let p(n, k) = (n+1+k)Œ≤0(n)+(n+1+a+b+c+k)Œ≤1(n) = ^p(n, k),
t(n, k) = t(n, k)/(n + 1 + k), q(n, k) = (n + 1 + a + b + c + k)(a ‚àík)(b ‚àík),
r(n, k) = (n + 1 + k)(c + k)k. Then (5.129) is solved by Œ≤0(n) = (n + 1 + a +
b+c)(n+ 1+a + b), Œ≤1(n) = ‚àí(n +1+ a)(n +1+ b), Œ±0(n) = s(n, k) = ‚àí1.
We discover (5.134) by observing that it is true when n = ‚àía and using
induction on n.
5.100 The Gosper-Zeilberger algorithm discovers easily that
n + 2
¬µn
k
¬∂ ‚àí
2n + 2
¬µn + 1
k
¬∂ =
n ‚àík
¬µ n
k + 1
¬∂ ‚àín + 1 ‚àík
¬µn
k
¬∂
,
0  k < n.

A ANSWERS TO EXERCISES 543
Summing from k = 0 to n‚àí1 yields (n+2)(Sn‚àí1)‚àí(2n+2)(Sn+1‚àí1‚àí
1
n+1) =
‚àín. Hence (2n + 2)Sn+1 = (n + 2)Sn + 2n + 2. Applying a summation factor
now leads to the expression Sn = (n + 1)2‚àín‚àí1 Pn+1
k=1 2k/k.
5.101 (a) If we hold m xed, the Gosper-Zeilberger algorithm discovers that
(n+2)Sm,n+2(z) = (z‚àí1)(n+1)Sm,n(z)+(2n+3‚àíz(n‚àím+1))Sm,n+1(z).
We can also apply the method to the term
Œ≤0(m, n)t(m, n, k) + Œ≤1(m, n)t(m+1, n, k) + Œ≤2(m, n)t(m, n+1, k) ,
in which case we get a simpler recurrence,
(m + 1)Sm+1,n(z) ‚àí(n + 1)Sm,n+1(z) = (1 ‚àíz)(m ‚àín)Sm,n(z) .
(b) Now we must work a little harder, with ve equations in six unknowns.
The algorithm nds
(n + 1)(z ‚àí1)2
¬µn
k
¬∂2
zk ‚àí(2n + 3)(z + 1)
¬µn + 1
k
¬∂2
zk
+ (n + 2)
¬µn + 2
k
¬∂2
zk = T(n, k + 1) ‚àíT(n, k) ,
T(n, k) =
¬µn + 1
k ‚àí1
¬∂2 s(n, k)
n + 1 zk ,
s(n, k) = (z‚àí1)k2 ‚àí2((n+2)z‚àí2n‚àí3)k + (n+2)((n+2)z‚àí4n‚àí5) .
Therefore (n+1)(z‚àí1)2Sn(z)‚àí(2n+3)(z+1)Sn+1(z)+(n+2)Sn+2(z) = 0.
Incidentally, this recurrence holds also for negative n, and we have S‚àín‚àí1(z) =
Sn(z)/(1 ‚àíz)2n+1.
The sum Sn(z) can be regarded as a modied form of the Legendre
polynomial Pn(z) = P
k
¬°n
k
¬¢2(z‚àí1)n‚àík(z+1)k/2n, since we can write Sn(z) =
(1 ‚àíz)nPn
¬° 1+z
1‚àíz
¬¢
. Similarly, Sm,n(z) = (1 ‚àíz)nP(0,m‚àín)
n
¬° 1+z
1‚àíz
¬¢
is a modied
Jacobi polynomial.
5.102 The sum is F(a‚àí1
3n, ‚àín; b‚àí4
3n; ‚àíz), so we need not consider the case
z = ‚àí1. Let n = 3m. We seek solutions to (5.129) when
How about z = 0?
p(m, k) = (3m + 3 ‚àík)3(m + 1 ‚àík)Œ≤0 + (4m + 4 ‚àíb ‚àík)4Œ≤1 ,
q(m, k) = (3m + 3 ‚àík)(m + 1 ‚àía ‚àík)z ,
r(m, k) = k(4m + 1 ‚àíb ‚àík) ,
s(m, k) = Œ±2k2 + Œ±1k + Œ±0 .
The resulting ve homogeneous equations have a nonzero solution (Œ±0, Œ±1, Œ±2,
Œ≤0, Œ≤1) if and only if the determinant of coecients is zero; and this deter-
minant, a polynomial in m, vanishes only in eight cases. One of those cases

544 ANSWERS TO EXERCISES
is, of course, (5.113); but we can now evaluate the sum for all nonnegative
integers n, not just n Ã∏‚â°2 (mod 3):
X
k
¬µn
k
¬∂¬µ 1
3n ‚àí1
6
k
¬∂
8k
√Å¬µ 4
3n ‚àí2
3
k
¬∂
= [1, 1, ‚àí1
2]
¬µ2n
n
¬∂√Å¬µ 4
3n ‚àí2
3
n
¬∂
.
Here the notation [c0, c1, c2] stands for the single value cn mod 3. Another
case, (a, b, z) = ( 1
2, 0, 8), yields the identity
X
k
¬µn
k
¬∂¬µ 1
3n ‚àí1
2
k
¬∂
8k
√Å¬µ 4
3n
k
¬∂
= [1, 0, 0] 16n/3
¬µ 2
3n
1
3n
¬∂√Å¬µ 4
3n
n
¬∂
.
(This sum, amazingly, is zero unless n is a multiple of 3; and then the identity
can be written
X
k
¬µ3m
k
¬∂¬µ2m
2k
¬∂¬µ2k
k
¬∂
2k
√Å¬µ4m
k
¬∂¬µm
k
¬∂
= 16m (3m)! (2m)!
(4m)! m!
,
which might even be useful.) The remaining six cases generate even weirder
sums
X
k
¬µn
k
¬∂¬µ 1
3n ‚àía
k
¬∂
zk
√Å¬µ 4
3n ‚àíb
k
¬∂
= [c0, c1, c2]
¬µ 1
3n ‚àía
‚åän/3‚åã
¬∂¬µ 1
3n ‚àía‚Ä≤
‚åän/3‚åã
¬∂
x‚åän/3‚åã
¬µ 4
3n ‚àíb
n
¬∂¬µ 1
3n ‚àíb
‚åän/3‚åã
¬∂¬µ 1
3n ‚àíb‚Ä≤
‚åän/3‚åã
¬∂
where the respective values of (a, b, z, c0, c1, c2, a‚Ä≤, b‚Ä≤, x) are
( 7
12, 1
3,
8, 1, ‚àí1,
0, 1
4, 0,
64) ;
( 1
4, 0,
8, 1, 2,
0,
7
12, 1
3,
64) ;
( 5
12, 2
3,
8, 1,
0, ‚àí3, 3
4, 0,
64) ;
( 1
12, 1
3,
8, 1, 3,
0,
3
4, 0,
64) ;
( 1
2, 0, ‚àí4, 1,
2,
0, 1
6, 1
3, ‚àí16) ;
( 1
6, 2
3, ‚àí4, 1, 0, ‚àí3,
5
6, 0, ‚àí16) .
5.103 We assume that each a‚Ä≤
i and b‚Ä≤
i is nonzero, since the corresponding
factors would otherwise have no inuence on the degrees in k. Let ^t(n, k) =
^p(n, k)t(n, k) where
t(n, k) =
Qp
i=1
¬°
ain + a‚Ä≤
ik + ail[ai < 0] + a‚Ä≤‚Ä≤
i
¬¢
!
Qq
i=1
¬°
bin + b‚Ä≤
ik + bil[bi > 0] + b‚Ä≤‚Ä≤
i
¬¢
!
zk .
Then we have deg(^p) = deg(f) + max
¬°Pq
i=1 bi[bi > 0] ‚àíPp
i=1 ai[ai < 0],
Pp
i=1 ai[ai > 0] ‚àíPq
i=1 bi[bi < 0]
¬¢
 deg(f) + 1
2l
¬°
ja1j + ¬∑ ¬∑ ¬∑ + japj + jb1j +

A ANSWERS TO EXERCISES 545
¬∑ ¬∑ ¬∑ + jbqj
¬¢
, except in unusual cases where cancellation occurs in the lead-
ing coecient. And deg(q) = Pp
i=1 a‚Ä≤
i[a‚Ä≤
i > 0] ‚àíPq
i=1 b‚Ä≤
i[b‚Ä≤
i < 0], deg(r) =
Pq
i=1 b‚Ä≤
i[b‚Ä≤
i > 0] ‚àíPp
i=1 a‚Ä≤
i[a‚Ä≤
i < 0], again except in unusual cases.
(These estimates can be used to show directly that, as l increases, the
degree of ^p eventually becomes large enough to make a polynomial s(n, k)
possible, and the number of unknown Œ±j and Œ≤j eventually becomes larger
than the number of homogeneous linear equations to be solved. So we obtain
another proof that the Gosper-Zeilberger algorithm succeeds, if we argue as
in the text that there must be a solution with Œ≤0(n), . . . , Œ≤l(n) not all zero.)
5.104 Let t(n, k) = (‚àí1)k(r‚àís‚àík)! (r‚àí2k)!/
¬°
(r‚àís‚àí2k)! (r‚àín‚àík+1)! (n‚àík)!
k!
¬¢
. Then Œ≤0(n)t(n, k)+Œ≤1(n)t(n+1, k) is not summable in hypergeometric
terms, because deg(^p) = 1, deg(q ‚àír) = 3, deg(q + r) = 4, Œª = ‚àí8, Œª‚Ä≤ = ‚àí4;
but Œ≤0(n)t(n, k) + Œ≤1(n)t(n + 1, k) + Œ≤2(n)t(n + 2, k) is | basically because
Œª‚Ä≤ = 0 when q(n, k) = ‚àí(r ‚àís ‚àí2k)(r ‚àís ‚àí2k ‚àí1)(n + 2 ‚àík)(r ‚àín ‚àík + 1)
and r(k) = (r ‚àís ‚àík + 1)(r ‚àí2k + 2)(r ‚àí2k + 1)k. The solution is
Œ≤0(n) = (s ‚àín)(r ‚àín + 1)(r ‚àí2n + 1) ,
Œ≤1(n) = (rs ‚àís2 ‚àí2rn + 2n2 ‚àí2r + 2n)(r ‚àí2n ‚àí1) ,
Œ≤2(n) = (s ‚àír + n + 1)(n + 2)(r ‚àí2n ‚àí3) ,
Œ±0(n) = r ‚àí2n ‚àí1 ,
and we may conclude that Œ≤0(n)Sn + Œ≤1(n)Sn+1 + Œ≤2(n)Sn+2 = 0 when Sn
denotes the stated sum. This suces to prove the identity by induction, after
verifying the cases n = 0 and n = 1.
But Sn also satises the simpler recurrence Œ≤0(n)Sn + Œ≤1(n)Sn+1 = 0,
where Œ≤0(n) = (s ‚àín)(r ‚àí2n + 1) and Œ≤1(n) = ‚àí(n + 1)(r ‚àí2n ‚àí1).
Why didn't the method discover this? Well, nobody ever said that such a
recurrence necessarily forces the terms Œ≤0(n)t(n, k) + Œ≤1(n)t(n + 1, k) to be
indenitely summable. The surprising thing is that the Gosper-Zeilberger
method actually does nd the simplest recurrence in so many other cases.
Notice that the second-order recurrence we found can be factored:
Œ≤0(n) + Œ≤1(n)N + Œ≤2(n)N2
=
¬°
(r ‚àín + 1)N + (r ‚àís ‚àín ‚àí1)
¬¢ ¬°Œ≤0(n) + Œ≤1(n)N
¬¢
,
where N is the shift operator in (5.145).
5.105 Set a = 1 and compare the coecients of z3n on both sides of Henrici's
\friendly monster" identity,
f(a, z) f(a, œâz) f(a, œâ2z)
= F
¬µ
1
2a‚àí1
4,
1
2a+ 1
4
1
3a,
1
3a+ 1
3,
1
3a+ 2
3,
2
3a‚àí1
3,
2
3a,
2
3a+ 1
3, a
¬Ø¬Ø¬Ø
¬µ4z
9
¬∂3¬∂
,

546 ANSWERS TO EXERCISES
where f(a, z) = F(1; a, 1; z). The identity can be proved by showing that both
sides satisfy the same dierential equation.
Peter Paule has found another interesting way to evaluate the sum:
X
k,l
¬µ
N
k, l, N ‚àík ‚àíl
¬∂2
œâk+2l =
X
k,l
¬µ
N
k ‚àíl, l, N ‚àík
¬∂2
œâk+l
=
X
k,l
¬µN
k
¬∂2¬µk
l
¬∂2
œâk+l
=
X
k
¬µN
k
¬∂2
œâk [zk]
¬°
(1 + z)(œâ + z)
¬¢k
= [z0]
X
k
¬µN
k
¬∂2 ¬µœâ(1 + z)(œâ + z)
z
¬∂k
= [z0]
X
k,j
¬µN
k
¬∂2¬µk
j
¬∂ ¬µœâ(1 + z)(œâ + z)
z
‚àí1
¬∂j
= [z0]
X
k,j
¬µN
k
¬∂¬µN ‚àíj
N ‚àík
¬∂¬µN
j
¬∂ ¬µ(œâz ‚àí1)2
œâz
¬∂j
=
X
j
¬µ2N ‚àíj
N
¬∂¬µN
j
¬∂
[zj] (z ‚àí1)2j
=
X
j
¬µ2N ‚àíj
N
¬∂¬µN
j
¬∂¬µ2j
j
¬∂
(‚àí1)j ,
using the binomial theorem, Vandermonde's convolution, and the fact that
[z0]g(az) = [z0]g(z). We can now set N = 3n and apply the Gosper-Zeilberger
algorithm to this sum Sn, miraculously obtaining the rst-order recurrence
(n + 1)2Sn+1 = 4(4n + 1)(4n + 3)Sn; the result follows by induction.
If 3n is replaced by 3n + 1 or 3n + 2, the stated sum is zero. Indeed,
P
k+l+m=N t(k, l, m)œâl‚àím is always zero when N mod 3 Ã∏= 0 and t(k, l, m) =
t(l, m, k).
5.106 (Solution by Shalosh B Ekhad.) Let
T(r, j, k) =
((1+n+s)(1+r) ‚àí(1+n+r)j + (s‚àír)k)(j‚àíl)j
(l ‚àím + n ‚àír + s)(n + r + 1)(j ‚àír ‚àí1)(j + k)t(r, j, k) ;
U(r, j, k) =
(s + n + 1)(k + l)k
(l ‚àím + n ‚àír + s)(n + r + 1)(j + k)t(r, j, k) .
The stated equality is routinely veriable, and (5.32) follows by summing
with respect to j and k. (We sum T(r, j + 1, k) ‚àíT(r, j, k) rst with respect
to j, then with respect to k; we sum the other terms U(r, j, k + 1) ‚àíU(r, j, k)
rst with respect to k, then with respect to j.)

A ANSWERS TO EXERCISES 547
Well, we also need to verify (5.32) when r = 0. In that case it reduces
via trinomial revision to P
k(‚àí1)k¬° n
n+l
¬¢¬°n+l
k+l
¬¢¬°s+n‚àík
m
¬¢
= (‚àí1)l¬° n
n+l
¬¢¬°
s
m‚àín‚àíl
¬¢
.
We are assuming that l, m, and n are integers and n  0. Both sides are
clearly zero unless n + l  0. Otherwise we can replace k by n ‚àík and use
(5.24).
5.107 If it were proper, there would be a linear dierence operator that an-
Noticee that 1/nk
is proper, since it's
(n ‚àí1)!(k ‚àí1)!/
n! k!. Also
1/(n2 ‚àík2) is
proper. But
1/(n2 + k2) isn't.
nihilates it. In other words, we would have a nite summation identity
I
X
i=0
J
X
j=0
Œ±i,j(n)
¬±¬°
(n + i)(k + j) + 1
¬¢
= 0 ,
where the Œ±'s are polynomials in n, not all zero. Choose integers i, j, and n
such that n > 1 and Œ±i,j(n) Ã∏= 0. Then when k = ‚àí1/(n + i) ‚àíj, the (i, j)
term in the sum is innite but the other terms are nite.
5.108 Replace k by m ‚àík in the double sum, then use (5.28) to sum on k,
getting
Am,n =
X
j
¬µm
j
¬∂2 ¬µm + n ‚àíj
m
¬∂2
;
trinomial revision (5.21) then yields one of the desired formulas.
It appears to be dicult to nd a direct proof that the two symmetrical
sums for Am,n are equal. We can, however, prove the equation indirectly
with the Gosper-Zeilberger algorithm, by showing that both sums satisfy the
recurrence
(n + 1)3Am,n ‚àíf(m, n)Am,n+1 + (n + 2)3Am,n+2 = 0 ,
where f(m, n) = (2n + 3)(n2 + 3n + 2m2 + 2m + 3).
Setting t1(n, k) =
¬°m
k
¬¢¬°n
k
¬¢¬°m+k
k
¬¢¬°n+k
k
¬¢
and t2(n, k) =
¬°m+n‚àík
k
¬¢2¬°m+n‚àí2k
m‚àík
¬¢2, we nd
(n + 1)2tj(n, k) ‚àíf(m, n)tj(n + 1, k) + (n + 2)2tj(n + 2, k)
= Tj(n, k + 1) ‚àíTj(n, k) ,
where T1(n, k) = ‚àí2(2n + 3)k4t1(n, k)/(n + 1 ‚àík)(n + 2 ‚àík) and T2(n, k) =
‚àí
¬°
(n + 2)(4mn + n + 3m2 + 8m + 2) ‚àí2(3mn + n + m2 + 6m + 2)k +
(2m + 1)k2¬¢
k2(m+n+1‚àík)2t2(n, k)/(n+2‚àík)2. This proves the recurrence,
so we need only verify equality when n = 0 and n = 1. (We could also have
used the simpler recurrence
m3Am,n‚àí1 ‚àín3Am‚àí1,n = (m ‚àín)(m2 + n2 ‚àímn)Am‚àí1,n‚àí1 ,
which can be discovered by the method of exercise 101.)

548 ANSWERS TO EXERCISES
The fact that the rst formula for Am,n equals the third implies a
remarkable identity between the generating functions P
m,n Am,nwmzn:
X
k
wkSk(z)2
(1 ‚àíz)2k+1 =
X
k
¬µ2k
k
¬∂2
wk
(1 ‚àíw)2k+1
zk
(1 ‚àíz)2k+1 ,
where Sk(z) = P
j
¬°k
j
¬¢2zj. It turns out, in fact, that
X
k
wkSk(x)Sk(y)
(1 ‚àíx)k(1 ‚àíy)k =
X
k
¬µ2k
k
¬∂
wk
(1 ‚àíw)2k+1
P
j
¬°k
j
¬¢2xjyk‚àíj
(1 ‚àíx)k(1 ‚àíy)k ;
this is a special case of an identity discovered by Bailey [19].
5.109 Let Xn = P
k
¬°n
k
¬¢a0¬°n+k
k
¬¢a1 . . .
¬°n+lk
k
¬¢alxk for any positive integers
a0, a1, . . . , al, and any integer x. Then if 0  m < p we have
Xm+pn =
p‚àí1
X
j=0
X
k
¬µm + pn
j + pk
¬∂a0
. . .
¬µm + pn + l(j + pk)
j + pk
¬∂al
xj+pk ,
XmXn =
p‚àí1
X
j=0
X
k
¬µm
j
¬∂a0¬µn
k
¬∂a0
. . .
¬µm + lj
j
¬∂al¬µn + lk
k
¬∂al
xj+k .
And corresponding terms are congruent (mod p), because exercise 36 implies
that they are multiples of p when lj + m  p, exercise 61 implies that the
binomials are congruent when lj + m < p, and (4.48) implies that xp ‚â°x.
5.110 The congruence surely holds if 2n + 1 is prime. Steven Skiena has also
Ilan Vardi notes
that the condi-
tion holds for
2n + 1 = p2 ,
where p is prime,
if and only if
2p‚àí1 mod p2 = 1.
This yields two
more examples:
n = (10932‚àí1)/2;
n = (35112‚àí1)/2.
found the example n = 2953, when 2n + 1 = 3¬∑11¬∑179.
5.111 See [96] for partial results. The computer experiments were done by
V. A. Vyssotsky.
5.112 If n is not a power of 2,
¬°2n
n
¬¢
is a multiple of 4 because of exercise 36.
Otherwise the stated phenomenon was veried for n  222000 by A. Granville
and O. Ramare, who also sharpened a theorem of Sarkozy [317] by showing
that
¬°2n
n
¬¢
is divisible by the square of a prime for all n > 222000.
This
established a long-standing conjecture that
¬°2n
n
¬¢
is never squarefree when
n > 4.
The analogous conjectures for cubes are that
¬°2n
n
¬¢
is divisible by the
cube of a prime for all n > 1056, and by either 23 or 33 for all n > 229 + 223.
This has been veried for all n < 210000. Paul Erd}os conjectures that, in
fact, maxp œµp
¬°¬°2n
n
¬¢¬¢
tends to innity as n ‚Üí‚àû; this might be true even if
we restrict p to the values 2 and 3.

A ANSWERS TO EXERCISES 549
5.113 The theorem about generating functions in exercise 7.20 may help re-
solve this conjecture.
5.114 Strehl [344] has shown that c(2)
n
= P
k
¬°n
k
¬¢3 = P
k
¬°n
k
¬¢2¬°2k
n
¬¢
is a so-
called Franel number [132], and that c(3)
n
= P
k
¬°n
k
¬¢2¬°2k
k
¬¢2¬° 2k
n‚àík
¬¢
. In another
direction, H. S. Wilf has shown that c(m)
n
is an integer for all m when n  9.
6.1
2314, 2431, 3241, 1342, 3124, 4132, 4213, 1423, 2143, 3412, 4321.
6.2
¬©n
k
¬™
mk, because every such function partitions its domain into k non-
empty subsets, and there are mk ways to assign function values for each
partition. (Summing over k gives a combinatorial proof of (6.10).)
6.3
Now dk+1  (center of gravity) ‚àíœµ = 1 ‚àíœµ + (d1 + ¬∑ ¬∑ ¬∑ + dk)/k. This
recurrence is like (6.55) but with 1 ‚àíœµ in place of 1; hence the optimum
solution is dk+1 = (1 ‚àíœµ)Hk. This is unbounded as long as œµ < 1.
6.4
H2n+1 ‚àí1
2Hn. (Similarly P2n
k=1(‚àí1)k‚àí1/k = H2n ‚àíHn.)
6.5
Un(x, y) is equal to
x P
k1
¬°n
k
¬¢
(‚àí1)k‚àí1k‚àí1(x+ky)n‚àí1+y P
k1
¬°n
k
¬¢
(‚àí1)k‚àí1(x+ky)n‚àí1 ,
and the rst sum is
Un‚àí1(x, y) +
X
k1
¬µn ‚àí1
k ‚àí1
¬∂
(‚àí1)k‚àí1k‚àí1(x + ky)n‚àí1 .
The remaining k‚àí1 can be absorbed, and we have
X
k1
¬µn
k
¬∂
(‚àí1)k‚àí1(x+ky)n‚àí1 = xn‚àí1+
X
k0
¬µn
k
¬∂
(‚àí1)k‚àí1(x+ky)n‚àí1
= xn‚àí1 .
This proves (6.75).
Let Rn(x, y) = x‚àínUn(x, y); then R0(x, y) = 0 and
Rn(x, y) = Rn‚àí1(x, y)+1/n+y/x, hence Rn(x, y) = Hn+ny/x. (Incidentally,
the original sum Un = Un(n, ‚àí1) doesn't lead to a recurrence such as this;
therefore the more general sum, which detaches x from its dependence on n,
is easier to solve inductively than its special case. This is another instructive
example where a strong induction hypothesis makes the dierence between
success and failure.)
6.6
Each pair of babies bb present at the end of a month becomes a pair
The Fibonacci re-
currence is additive,
but the rabbits are
multiplying.
of adults aa at the end of the next month; and each pair aa becomes an
aa and a bb. Thus each bb behaves like a drone in the bee tree and each aa
behaves like a queen, except that the bee tree goes backward in time while the

550 ANSWERS TO EXERCISES
rabbits are going forward. There are Fn+1 pairs of rabbits after n months;
Fn of them are adults and Fn‚àí1 are babies. (This is the context in which
Fibonacci originally introduced his numbers.)
6.7
(a) Set k = 1 ‚àín and apply (6.107). (b) Set m = 1 and k = n ‚àí1 and
apply (6.128).
6.8
55 + 8 + 2 becomes 89 + 13 + 3 = 105; the true value is 104.607361.
That \true value"
is the length of
65 international
miles, but the in-
ternational mile
is actually only
.999998 as big as
a U.S. statute mile.
There are exactly
6336 kilometers in
3937 U.S. statute
miles; the Fibonacci
method converts
3937 to 6370.
6.9
21. (We go from Fn to Fn+2 when the units are squared. The true
answer is about 20.72.)
6.10
The partial quotients a0, a1, a2, . . . are all equal to 1, because œÜ =
1 + 1/œÜ. (The Stern{Brocot representation is therefore RLRLRLRLRL . . . .)
6.11
(‚àí1)n = [n = 0] ‚àí[n = 1]; see (6.11).
6.12
This is a consequence of (6.31) and its dual in Table 264.
6.13
The two formulas are equivalent, by exercise 12. We can use induction.
Or we can observe that znDn applied to f(z) = zx gives xnzx while œën applied
to the same function gives xnzx; therefore the sequence ‚ü®œë0, œë1, œë2, . . . ‚ü©must
relate to ‚ü®z0D0, z1D1, z2D2, . . . ‚ü©as ‚ü®x0, x1, x2, . . . ‚ü©relates to ‚ü®x0, x1, x2, . . . ‚ü©.
6.14
We have
x
¬µx + k
n
¬∂
= (k + 1)
¬µx + k
n + 1
¬∂
+ (n ‚àík)
¬µx + k + 1
n + 1
¬∂
,
because (n+1)x = (k+1)(x+k‚àín)+(n‚àík)(x+k+1). (It suces to verify
the latter identity when k = 0, k = ‚àí1, and k = n.)
6.15
Since ‚àÜ
¬°¬°x+k
n
¬¢¬¢
=
¬°x+k
n‚àí1
¬¢
, we have the general formula
X
k
¬øn
k
√Ä¬µ x + k
n ‚àím
¬∂
= ‚àÜm(xn) =
X
j
¬µm
j
¬∂
(‚àí1)m‚àíj(x + j)n .
Set x = 0 and appeal to (6.19).
6.16
An,k = P
j0 aj
¬©n‚àíj
k
¬™
; this sum is always nite.
6.17
(a)
¬Ø¬Øn
k
¬Ø¬Ø =
¬£ n+1
n+1‚àík
¬§
. (b)
¬Ø¬Øn
k
¬Ø¬Ø = nn‚àík = n! [n  k]/k!. (c)
¬Ø¬Øn
k
¬Ø¬Ø = k!
¬©n
k
¬™
.
6.18
This is equivalent to (6.3) or (6.8).
6.19
Use Table 272.
6.20
P
1jkn 1/j2 = P
1jn(n + 1 ‚àíj)/j2 = (n + 1)H(2)
n
‚àíHn.
6.21
The hinted number is a sum of fractions with odd denominators, so
it has the form a/b with a and b odd. (Incidentally, Bertrand's postulate
implies that bn is also divisible by at least one odd prime, whenever n > 2.)

A ANSWERS TO EXERCISES 551
6.22
¬Ø¬Øz/k(k + z)
¬Ø¬Ø  2jzj/k2 when k > 2jzj, so the sum is well dened when
the denominators are not zero. If z = n we have Pm
k=1
¬°
1/k ‚àí1/(k + n)
¬¢
=
Hm ‚àíHm+n +Hn, which approaches Hn as m ‚Üí‚àû. (The quantity Hz‚àí1 ‚àíŒ≥
is often called the psi function œà(z).)
6.23
z/(ez + 1) = z/(ez ‚àí1) ‚àí2z/(e2z ‚àí1) = P
n0(1 ‚àí2n)Bnzn/n!.
6.24
When n is odd, Tn(x) is a polynomial in x2, hence its coecients
are multiplied by even numbers when we form the derivative and compute
Tn+1(x) by (6.95). (In fact we can prove more: The Bernoulli number B2n
always has 2 to the rst power in its denominator, by exercise 54; hence
22n‚àík nnT2n+1 ‚áê‚áí2knn(n+1). The odd positive integers (n+1)T2n+1/22n
are called Genocchi numbers ‚ü®1, 1, 3, 17, 155, 2073, . . . ‚ü©, after Genocchi [145].)
6.25
100n ‚àínHn < 100(n ‚àí1) ‚àí(n ‚àí1)Hn‚àí1
‚áê‚áí
Hn‚àí1 > 99. (The
least such n is approximately e99‚àíŒ≥, while he nishes at N ‚âàe100‚àíŒ≥, about
e times as long. So he is getting closer during the nal 63% of his journey.)
6.26
Let u(k) = Hk‚àí1 and ‚àÜv(k) = 1/k, so that u(k) = v(k). Then we have
Sn ‚àíH(2)
n
= Pn
k=1 Hk‚àí1/k = H2
k‚àí1
¬Ø¬Øn+1
1
‚àíSn = H2
n ‚àíSn.
6.27
Observe that when m > n we have gcd(Fm, Fn) = gcd(Fm‚àín, Fn) by
(6.108). This yields a proof by induction.
6.28
(a) Qn = Œ±(Ln ‚àíFn)/2 + Œ≤Fn.
(The solution can also be written
Qn = Œ±Fn‚àí1 + Œ≤Fn.) (b) Ln = œÜn + bœÜn.
6.29
When k = 0 the identity is (6.133). When k = 1 it is, essentially,
K(x1, . . . , xn)xm = K(x1, . . . , xm) K(xm, . . . , xn)
‚àíK(x1, . . . , xm‚àí2) K(xm+2, . . . , xn) ;
in Morse code terms, the second product on the right subtracts out the cases
where the rst product has intersecting dashes. When k > 1, an induction
on k suces, using both (6.127) and (6.132). (The identity is also true when
one or more of the subscripts on K become ‚àí1, if we adopt the convention that
K‚àí1 = 0. When multiplication is not commutative, Euler's identity remains
valid if we write it in the form
Km+n(x1, . . . , xm+n) Kk(xm+k, . . . , xm+1)
= Km+k(x1, . . . , xm+k) Kn(xm+n, . . . , xm+1)
+ (‚àí1)kKm‚àí1(x1, . . . , xm‚àí1) Kn‚àík‚àí1(xm+n, . . . , xm+k+2) .
For example, we obtain the somewhat surprising noncommutative factoriza-
tions
(abc + a + c)(1 + ba) = (ab + 1)(cba + a + c)
from the case k = 2, m = 0, n = 3.)

552 ANSWERS TO EXERCISES
6.30
The derivative of K(x1, . . . , xn) with respect to xm is
K(x1, . . . , xm‚àí1) K(xm+1, . . . , xn) ,
and the second derivative is zero; hence the answer is
K(x1, . . . , xn) + K(x1, . . . , xm‚àí1) K(xm+1, . . . , xn)y .
6.31
Since xn = (x + n ‚àí1)n = P
k
¬°n
k
¬¢
xk(n ‚àí1)n‚àík, we have
¬Ø¬Øn
k
¬Ø¬Ø =
¬°n
k
¬¢
(n ‚àí1)n‚àík. These coecients, incidentally, satisfy the recurrence
≈ï≈ïn
k
≈ï≈ï =
≈ï≈ï‚àík
‚àín
≈ï≈ï.
¬Ø¬Ø¬Ø¬Ø
n
k
¬Ø¬Ø¬Ø¬Ø = (n ‚àí1 + k)
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k
¬Ø¬Ø¬Ø¬Ø +
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
k ‚àí1
¬Ø¬Ø¬Ø¬Ø ,
integers n, k > 0.
6.32
P
km k
¬©n+k
k
¬™
=
¬©m+n+1
m
¬™
and P
0kn
¬© k
m
¬™
(m + 1)n‚àík =
¬©n+1
m+1
¬™
,
both of which appear in Table 265.
6.33
If n > 0, we have
¬£n
3
¬§
= 1
2(n ‚àí1)! (H2
n‚àí1 ‚àíH(2)
n‚àí1), by (6.71);
¬©n
3
¬™
=
1
6(3n ‚àí3¬∑2n + 3), by (6.19).
6.34
We have
¬≠‚àí1
k
¬Æ
= 1/(k + 1),
¬≠‚àí2
k
¬Æ
= H(2)
k+1, and in general
¬≠n
k
¬Æ
is given
by (6.38) for all integers n.
6.35
Let n be the least integer > 1/œµ such that ‚åäHn‚åã> ‚åäHn‚àí1‚åã.
6.36
Now dk+1 =
¬°
100+(1+d1)+¬∑ ¬∑ ¬∑+(1+dk)
¬¢
/(100+k), and the solution
is dk+1 = Hk+100 ‚àíH101 + 1 for k  1. This exceeds 2 when k  176.
6.37
The sum (by parts) is Hmn ‚àí
¬° m
m + m
2m +¬∑ ¬∑ ¬∑+ m
mn
¬¢
= Hmn ‚àíHn. The
innite sum is therefore ln m. (It follows that
X
k1
ŒΩm(k)
k(k + 1) =
m
m ‚àí1 ln m ,
because ŒΩm(k) = (m ‚àí1) P
j1(k mod mj)/mj.)
6.38
(‚àí1)k¬°¬°r‚àí1
k
¬¢
r‚àí1 ‚àí
¬°r‚àí1
k‚àí1
¬¢
Hk
¬¢
+ C. (By parts, using (5.16).)
6.39
Write it as P
1jn j‚àí1 P
jkn Hk and sum rst on k via (6.67), to
get
(n + 1)H2
n ‚àí(2n + 1)Hn + 2n .
6.40
If 6n ‚àí1 is prime, the numerator of
4n‚àí1
X
k=1
(‚àí1)k‚àí1
k
= H4n‚àí1 ‚àíH2n‚àí1

A ANSWERS TO EXERCISES 553
is divisible by 6n ‚àí1, because the sum is
4n‚àí1
X
k=2n
1
k =
3n‚àí1
X
k=2n
¬µ1
k +
1
6n ‚àí1 ‚àík
¬∂
=
3n‚àí1
X
k=2n
6n ‚àí1
k(6n ‚àí1 ‚àík) .
Similarly if 6n + 1 is prime, the numerator of P4n
k=1(‚àí1)k‚àí1/k = H4n ‚àíH2n
is a multiple of 6n + 1. For 1987 we sum up to k = 1324.
6.41
Sn+1 = P
k
¬°‚åä(n+1+k)/2‚åã
k
¬¢
= P
k
¬°‚åä(n+k)/2‚åã
k‚àí1
¬¢
, hence we have Sn+1 +
Sn = P
k
¬°‚åä(n+k)/2+1‚åã
k
¬¢
= Sn+2. The answer is Fn+2.
6.42
Fn.
6.43
Set z =
1
10 in P
n0 Fnzn = z/(1 ‚àíz ‚àíz2) to get 10
89. The sum is a
repeating decimal with period length 44:
0.11235 95505 61797 75280 89887 64044 94382 02247 19101 12359 55+ .
6.44
Replace (m, k) by (‚àím, ‚àík) or (k, ‚àím) or (‚àík, m), if necessary, so
that m  k  0. The result is clear if m = k. If m > k, we can replace (m, k)
by (m ‚àík, m) and use induction.
6.45
Xn = A(n)Œ±+B(n)Œ≤+C(n)Œ≥+D(n)Œ¥, where B(n) = Fn, A(n) = Fn‚àí1,
A(n) + B(n) ‚àíD(n) = 1, and B(n) ‚àíC(n) + 3D(n) = n.
6.46
œÜ/2 and œÜ‚àí1/2. Let u = cos 72‚ó¶and v = cos 36‚ó¶; then u = 2v2 ‚àí1 and
v = 1‚àí2 sin2 18‚ó¶= 1‚àí2u2. Hence u+v = 2(u+v)(v‚àíu), and 4v2‚àí2v‚àí1 = 0.
We can pursue this investigation to nd the ve complex fth roots of unity:
1 ,
œÜ‚àí1 ¬± i
p
2 + œÜ
2
,
‚àíœÜ ¬± i
p
3 ‚àíœÜ
2
.
6.47
2n‚àö
5 Fn = (1 +
‚àö
5)n ‚àí(1 ‚àí
‚àö
5)n, and the even powers of
‚àö
5 cancel
\Let p be any old
prime."
(See [171], p. 419.)
out. Now let p be an odd prime. Then
¬°
p
2k+1
¬¢
‚â°0 except when k = (p‚àí1)/2,
and
¬° p+1
2k+1
¬¢
‚â°0 except when k = 0 or k = (p ‚àí1)/2; hence Fp ‚â°5(p‚àí1)/2 and
2Fp+1 ‚â°1 + 5(p‚àí1)/2 (mod p). It can be shown that 5(p‚àí1)/2 ‚â°1 when p
has the form 10k ¬± 1, and 5(p‚àí1)/2 ‚â°‚àí1 when p has the form 10k ¬± 3.
6.48
Let Ki,j = Kj‚àíi+1(xi, . . . , xj).
Using (6.133) repeatedly, both sides
expand to (K1,m‚àí2(xm‚àí1 + xm+1) + K1,m‚àí3)Km+2,n + K1,m‚àí2Km+3,n.
6.49
Set z = 1
2 in (6.146); the partial quotients are 0, 2F0, 2F1, 2F2, . . . .
(Knuth [206] noted that this number is transcendental.)
6.50
(a) f(n) is even
‚áê‚áí
3nn. (b) If the binary representation of n is
(1a10a2. . . 1am‚àí10am)2, where m is even, we have f(n)=K(a1, a2, . . . , am‚àí1).

554 ANSWERS TO EXERCISES
6.51
(a) Combinatorial proof: The arrangements of f1, 2, . . . , pg into k sub-
sets or cycles are divided into \orbits" of 1 or p arrangements each, if we
add 1 to each element modulo p. For example,
f1, 2, 4g ‚à™f3, 5g ‚Üíf2, 3, 5g ‚à™f4, 1g ‚Üíf3, 4, 1g ‚à™f5, 2g
‚Üíf4, 5, 2g ‚à™f1, 3g ‚Üíf5, 1, 3g ‚à™f2, 4g ‚Üíf1, 2, 4g ‚à™f3, 5g .
We get an orbit of size 1 only when this transformation takes an arrangement
into itself; but then k = 1 or k = p. Alternatively, there's an algebraic proof:
We have xp ‚â°xp + x1 and xp ‚â°xp ‚àíx (mod p), since Fermat's theorem tells
us that xp ‚àíx is divisible by (x ‚àí0)(x ‚àí1) . . .
¬°
x ‚àí(p‚àí1)
¬¢
.
(b) This result follows from (a) and Wilson's theorem; or we can use
xp‚àí1 ‚â°xp/(x ‚àí1) ‚â°(xp ‚àíx)/(x ‚àí1) = xp‚àí1 + xp‚àí2 + ¬∑ ¬∑ ¬∑ + x.
(c) We have
¬©p+1
k
¬™
‚â°
¬£p+1
k
¬§
‚â°0 for 3  k  p, then
¬©p+2
k
¬™
‚â°
¬£p+2
k
¬§
‚â°0
for 4  k  p, etc. (Similarly, we have
¬£2p‚àí1
p
¬§
‚â°‚àí
¬©2p‚àí1
p
¬™
‚â°1.)
(d) p! = pp = P
k(‚àí1)p‚àík pk¬£p
k
¬§
= pp¬£p
p
¬§
‚àípp‚àí1¬£ p
p‚àí1
¬§
+ ¬∑ ¬∑ ¬∑ + p3¬£p
3
¬§
‚àí
p2¬£p
2
¬§
+ p
¬£p
1
¬§
. But p
¬£p
1
¬§
= p!, so
¬∑p
2
¬∏
= p
¬∑p
3
¬∏
‚àíp2
¬∑p
4
¬∏
+ ¬∑ ¬∑ ¬∑ + pp‚àí2
¬∑p
p
¬∏
is a multiple of p2. (This is called Wolstenholme's theorem.)
6.52
(a) Observe that Hn = H‚àó
n + H‚åän/p‚åã/p, where H‚àó
n = Pn
k=1[k ‚ä•p]/k.
(b) Working mod 5 we have Hr = ‚ü®0, 1, 4, 1, 0‚ü©for 0  r  4.
Thus the
rst solution is n = 4. By part (a) we know that 5nan =‚áí5na‚åän/5‚åã; so
the next possible range is n = 20 + r, 0  r  4, when we have Hn =
H‚àó
n + 1
5H4 = H‚àó
20 + 1
5H4 + Hr + Pr
k=1 20/k(20 + k).
The numerator of
H‚àó
20, like the numerator of H4, is divisible by 25. Hence the only solutions
in this range are n = 20 and n = 24.
The next possible range is n =
100 + r; now Hn = H‚àó
n + 1
5H20, which is 1
5H20 + Hr plus a fraction whose
numerator is a multiple of 5. If 1
5H20 ‚â°m (mod 5), where m is an integer,
the harmonic number H100+r will have a numerator divisible by 5 if and only
if m + Hr ‚â°0 (mod 5); hence m must be ‚â°0, 1, or 4. Working modulo 5 we
nd 1
5H20 = 1
5H‚àó
20 + 1
25H4 ‚â°
1
25H4 =
1
12 ‚â°3; hence there are no solutions for
100  n  104. Similarly there are none for 120  n  124; we have found
all three solutions.
(By exercise 6.51(d), we always have p2nap‚àí1, pnap2‚àíp, and pnap2‚àí1,
if p is any prime  5. The argument just given shows that these are the only
(Attention, com-
puter programmers:
Here's an interest-
ing condition to
test, for as many
primes as you can.)
solutions to pnan if and only if there are no solutions to p‚àí2Hp‚àí1 + Hr ‚â°0
(mod p) for 0  r < p. The latter condition holds not only for p = 5 but
also for p = 13, 17, 23, 41, and 67 | perhaps for innitely many primes. The
numerator of Hn is divisible by 3 only when n = 2, 7, and 22; it is divisible

A ANSWERS TO EXERCISES 555
by 7 only when n = 6, 42, 48, 295, 299, 337, 341, 2096, 2390, 14675, 16731,
16735, and 102728.)
6.53
Summation by parts yields
n + 1
(n + 2)2
¬µ(‚àí1)m
¬°n+1
m+1
¬¢
¬°
(n + 2)Hm+1 ‚àí1
¬¢
‚àí1
¬∂
.
6.54
(a) If m  p we have Sm(p) ‚â°Sm‚àí(p‚àí1)(p) (mod p), since kp‚àí1 ‚â°1
when 1  k < p. Also Sp‚àí1(p) ‚â°p ‚àí1 ‚â°‚àí1. If 0 < m < p ‚àí1, we can write
Sm(p) =
m
X
j=0
¬∑m
j
¬∏
(‚àí1)m‚àíj
p‚àí1
X
k=0
kj =
m
X
j=0
¬∑m
j
¬∏
(‚àí1)m‚àíj pj+1
j + 1 ‚â°0 .
(b) The condition in the hint implies that the denominator of I2n is not
divisible by any prime p; hence I2n must be an integer. To prove the hint,
(The numerators of
Bernoulli numbers
played an impor-
tant role in early
studies of Fermat's
Last Theorem; see
Ribenboim [308].)
we may assume that n>1. Then
B2n +
¬£
(p‚àí1)n(2n)
¬§
p
+
2n‚àí2
X
k=0
¬µ2n + 1
k
¬∂
Bk
p2n‚àík
2n+1
is an integer, by (6.78), (6.84), and part (a). So we want to verify that none
of the fractions
¬°2n+1
k
¬¢
Bkp2n‚àík/(2n + 1) =
¬°2n
k
¬¢
Bkp2n‚àík/(2n ‚àík + 1) has a
denominator divisible by p. The denominator of
¬°2n
k
¬¢
Bkp isn't divisible by p,
since Bk has no p2 in its denominator (by induction); and the denominator
of p2n‚àík‚àí1/(2n ‚àík + 1) isn't divisible by p, since 2n ‚àík + 1 < p2n‚àík when
k  2n‚àí2; QED. (The numbers I2n are tabulated in [224]. Hermite calculated
them through I18 in 1875 [184].
It turns out that I2 = I4 = I6 = I8 =
I10 = I12 = 1; hence there is actually a \simple" pattern to the Bernoulli
numbers displayed in the text, including ‚àí691
2730 (!). But the numbers I2n don't
seem to have any memorable features when 2n > 12. For example, B24 =
‚àí86579 ‚àí1
2 ‚àí1
3 ‚àí1
5 ‚àí1
7 ‚àí
1
13, and 86579 is prime.)
(c) The numbers 2‚àí1 and 3‚àí1 always divide 2n. If n is prime, the only
divisors of 2n are 1, 2, n, and 2n, so the denominator of B2n for prime n > 2
will be 6 unless 2n+1 is also prime. In the latter case we can try 4n+3, 8n+7,
. . . , until we eventually hit a nonprime (since n divides 2n‚àí1n + 2n‚àí1 ‚àí1).
(This proof does not need the more dicult, but true, theorem that there are
innitely many primes of the form 6k + 1.) The denominator of B2n can be 6
also when n has nonprime values, such as 49.
6.55
The stated sum is
m+1
x+m+1
¬°x+n
n
¬¢¬°
n
m+1
¬¢
, by Vandermonde's convolution.
To get (6.70), dierentiate and set x = 0.

556 ANSWERS TO EXERCISES
6.56
First replace kn+1 by
¬°
(k ‚àím) + m
¬¢n+1 and expand in powers of
k ‚àím; simplications occur as in the derivation of (6.72).
If m > n or
m < 0, the answer is (‚àí1)nn! ‚àímn/
¬°n‚àím
n
¬¢
. Otherwise we need to take the
limit of (5.41) minus the term for k = m, as x ‚Üí‚àím; the answer comes to
(‚àí1)nn! + (‚àí1)m+1¬°n
m
¬¢
mn(n + 1 + mHn‚àím ‚àímHm).
6.57
First prove by induction that the nth row contains at most three
distinct values An  Bn  Cn; if n is even they occur in the cyclic or-
der [Cn, Bn, An, Bn, Cn], while if n is odd they occur in the cyclic order
[Cn, Bn, An, An, Bn]. Also
A2n+1 = A2n + B2n ;
A2n = 2A2n‚àí1 ;
B2n+1 = B2n + C2n ;
B2n = A2n‚àí1 + B2n‚àí1 ;
C2n+1 = 2C2n ;
C2n = B2n‚àí1 + C2n‚àí1 .
It follows that Qn = An ‚àíCn = Fn+1. (See exercise 5.75 for wraparound
binomial coecients of order 3.)
6.58
(a) P
n0 F2
nzn = z(1‚àíz)/(1+z)(1‚àí3z+z2) = 1
5
¬°
(2‚àí3z)/(1‚àí3z+z2)‚àí
2/(1+z)
¬¢
. (Square Binet's formula (6.123) and sum on n, then combine terms
so that œÜ and bœÜ disappear.) (b) Similarly,
X
n0
F3
nzn =
z(1‚àí2z‚àíz2)
(1‚àí4z‚àíz2)(1+z‚àíz2) = 1
5
¬µ
2z
1‚àí4z‚àíz2 +
3z
1+z‚àíz2
¬∂
.
It follows that F3
n+1‚àí4F3
n‚àíF3
n‚àí1 = 3(‚àí1)nFn. (The corresponding recurrence
for mth powers involves the Fibonomial coecients of exercise 86; it was
discovered by Jarden and Motzkin [194].)
6.59
Let m be xed. We can prove by induction on n that it is, in fact,
possible to nd such an x with the additional condition x Ã∏‚â°2 (mod 4). If x
is such a solution, we can move up to a solution modulo 3n+1 because
F8¬∑3n‚àí1 ‚â°3n ,
F8¬∑3n‚àí1‚àí1 ‚â°3n + 1
(mod 3n+1) ;
either x or x + 8¬∑3n‚àí1 or x + 16¬∑3n‚àí1 will do the job.
6.60
F1 + 1, F2 + 1, F3 + 1, F4 ‚àí1, and F6 ‚àí1 are the only cases. Otherwise
the Lucas numbers of exercise 28 arise in the factorizations
F2m + (‚àí1)m = Lm+1 Fm‚àí1 ;
F2m+1 + (‚àí1)m = Lm Fm+1 ;
F2m ‚àí(‚àí1)m = Lm‚àí1 Fm+1 ;
F2m+1 ‚àí(‚àí1)m = Lm+1 Fm .
(We have Fm+n ‚àí(‚àí1)nFm‚àín = LmFn in general.)

A ANSWERS TO EXERCISES 557
6.61
1/F2m = Fm‚àí1/Fm ‚àíF2m‚àí1/F2m when m is even and positive. The
second sum is 5/4 ‚àíF3¬∑2n‚àí1/F3¬∑2n, for n  1.
6.62
(a) An =
‚àö
5 An‚àí1 ‚àíAn‚àí2 and Bn =
‚àö
5 Bn‚àí1 ‚àíBn‚àí2. Incidentally,
we also have
‚àö
5 An + Bn = 2An+1 and
‚àö
5 Bn ‚àíAn = 2Bn‚àí1. (b) A table of
small values reveals that
An =
¬Ø Ln,
n even;
‚àö
5 Fn,
n odd;
Bn =
¬Ø ‚àö
5 Fn,
n even;
Ln,
n odd.
(c) Bn/An+1 ‚àíBn‚àí1/An = 1/(F2n+1 + 1) because BnAn ‚àíBn‚àí1An+1 =
‚àö
5
and AnAn+1 =
‚àö
5 (F2n+1+1). Notice that Bn/An+1 = (Fn/Fn+1)[n even]+
(Ln/Ln+1)[n odd]. (d) Similarly, Pn
k=1 1/(F2k+1 ‚àí1) = (A0/B1 ‚àíA1/B2) +
¬∑ ¬∑ ¬∑ + (An‚àí1/Bn ‚àíAn/Bn+1) = 2 ‚àíAn/Bn+1.
This quantity can also be
expressed as (5Fn/Ln+1)[n even] + (Ln/Fn+1)[n odd].
6.63
(a)
¬£n
k
¬§
. There are
¬£n‚àí1
k‚àí1
¬§
with œÄn = n and (n ‚àí1)
¬£n‚àí1
k
¬§
with œÄn < n.
(b)
¬≠n
k
¬Æ
. Each permutation œÅ1 . . . œÅn‚àí1 of f1, . . . , n‚àí1g leads to n permutations
œÄ1œÄ2 . . . œÄn = œÅ1 . . . œÅj‚àí1 n œÅj+1 . . . œÅn‚àí1œÅj. If œÅ1 . . . œÅn‚àí1 has k excedances,
there are k+1 values of j that yield k excedances in œÄ1œÄ2 . . . œÄn; the remaining
n‚àí1‚àík values yield k+1. Hence the total number of ways to get k excedances
in œÄ1œÄ2 . . . œÄn is (k + 1)
¬≠n‚àí1
k
¬Æ
+
¬°
(n ‚àí1) ‚àí(k ‚àí1)
¬¢¬≠n‚àí1
k‚àí1
¬Æ
=
¬≠n
k
¬Æ
.
6.64
The denominator of
¬°1/2
2n
¬¢
is 24n‚àíŒΩ2(n), by the proof in exercise 5.72.
The denominator of
¬£
1/2
1/2‚àín
¬§
is the same, by (6.44), because
¬≠¬≠n
0
¬Æ¬Æ
= 1 and
¬≠¬≠n
k
¬Æ¬Æ
is even for k > 0.
6.65
This is equivalent to saying that
¬≠n
k
¬Æ
/n! is the probability that we
have ‚åäx1 + ¬∑ ¬∑ ¬∑ + xn‚åã= k, when x1, . . . , xn are independent random numbers
uniformly distributed between 0 and 1. Let yj = (x1 + ¬∑ ¬∑ ¬∑ + xj) mod 1. Then
y1, . . . , yn are independently and uniformly distributed, and ‚åäx1 + ¬∑ ¬∑ ¬∑ + xn‚åã
is the number of descents in the y's. The permutation of the y's is random,
and the probability of k descents is the same as the probability of k ascents.
6.66
2n+1(2n+1 ‚àí1)Bn+1/(n + 1), if n > 0. (See (7.56) and (6.92); the
desired numbers are essentially the coecients of 1 ‚àítanh z.)
6.67
It is P
k
¬°¬© n
k+1
¬™
(k+1)!+
¬©n
k
¬™
k!
¬¢¬° n‚àík
n‚àím
¬¢
(‚àí1)m‚àík = P
k
¬©n
k
¬™
k!(‚àí1)m‚àík√ó
¬°¬° n‚àík
n‚àím
¬¢
‚àí
¬°n+1‚àík
n‚àím
¬¢¬¢
= P
k
¬©n
k
¬™
k!(‚àí1)m+1‚àík¬°
n‚àík
n‚àím‚àí1
¬¢
=
¬≠
n
n‚àím‚àí1
¬Æ
by (6.3) and
(6.40). Now use (6.34). (This identity has a combinatorial interpretation [59].)
6.68
We have the general formula
¬ø¬øn
m
√Ä√Ä
=
m
X
k=0
¬µ2n + 1
k
¬∂¬Øn + m + 1 ‚àík
m + 1 ‚àík
¬∞
(‚àí1)k ,
for n > m  0,

558 ANSWERS TO EXERCISES
analogous to (6.38). When m = 2 this equals
¬ø¬øn
2
√Ä√Ä
=
¬Øn + 3
3
¬∞
‚àí(2n + 1)
¬Øn + 2
2
¬∞
+
¬µ2n + 1
2
¬∂¬Øn + 1
1
¬∞
=
1
23n+2 ‚àí(2n + 3)2n+1 + 1
2(4n2 + 6n + 3) .
6.69
1
3n(n+ 1
2)(n+1)(2H2n ‚àíHn)‚àí1
36n(10n2 +9n‚àí1). (It would be nice
to automate the derivation of formulas such as this.)
6.70
1/k ‚àí1/(k + z) = z/k2 ‚àíz2/k3 + ¬∑ ¬∑ ¬∑ , which converges when jzj < 1.
6.71
Note that Qn
k=1(1 + z/k)e‚àíz/k =
¬°n+z
n
¬¢
n‚àíze(ln n‚àíHn)z.
If f(z) =
d
dz(z!) we nd f(z)/z! + Œ≥ = Hz.
6.72
For tan z, we can use tan z = cot z‚àí2 cot 2z (which is equivalent to the
identity of exercise 23). Also z/sin z = z cot z + z tan 1
2z has the power series
P
n0(‚àí1)n‚àí1(4n ‚àí2)B2nz2n/(2n)!; and
ln tan z
z
= ln sin z
z
‚àíln cos z
=
X
n1
(‚àí1)n 4nB2nz2n
(2n)(2n)!
‚àí
X
n1
(‚àí1)n 4n(4n‚àí1)B2nz2n
(2n)(2n)!
=
X
n1
(‚àí1)n‚àí1 4n(4n ‚àí2)B2nz2n
(2n)(2n)!
,
because
d
dz ln sin z = cot z and
d
dz ln cos z = ‚àítan z.
6.73
cot(z + œÄ) = cot z and cot(z + 1
2œÄ) = ‚àítan z; hence the identity is
equivalent to
cot z =
1
2n
2n‚àí1
X
k=0
cot z + kœÄ
2n
,
which follows by induction from the case n = 1. The stated limit follows since
z cot z ‚Üí1 as z ‚Üí0. It can be shown that term-by-term passage to the limit
is justied, hence (6.88) is valid. (Incidentally, the general formula
cot z = 1
n
n‚àí1
X
k=0
cot z + kœÄ
n
is also true. It can be proved from (6.88), or from
1
enz ‚àí1 = 1
n
n‚àí1
X
k=0
1
ez+2kœÄi/n ‚àí1,
which is equivalent to the partial fraction expansion of 1/(zn ‚àí1).)

A ANSWERS TO EXERCISES 559
6.74
Since tan 2z + sec 2z = (sin z + cos z)/(cos z ‚àísin z), setting x = 1
in (6.94) gives Tn(1) = 2nTn when n is odd, Tn(1) = 2njEnj when n is
even, where 1/cos z = P
n0 jE2njz2n/(2n)!. (The coecients jEnj are called
secant numbers; with alternating signs they are called Euler numbers, not
to be confused with the Eulerian numbers
¬≠n
k
¬Æ
. We have ‚ü®E0, E2, E4, . . . ‚ü©=
‚ü®1, ‚àí1, 5, ‚àí61, 1385, ‚àí50521, 2702765, . . . ‚ü©.)
6.75
Let G(w, z) = sin z/ cos(w+z) and H(w, z) = cos z/ cos(w+z), and let
G(w, z) + H(w, z) = P
m,n Am,nwmzn/m! n!. Then the equations G(w, 0) =
0 and
¬° ‚àÇ
‚àÇz ‚àí
‚àÇ
‚àÇw
¬¢
G(w, z) = H(w, z) imply that Am,0 = 0 when m is odd,
Am,n+1 = Am+1,n + Am,n when m + n is even; the equations H(0, z) = 1
and
¬° ‚àÇ
‚àÇw ‚àí
‚àÇ
‚àÇz
¬¢
H(w, z) = G(w, z) imply that A0,n = [n = 0] when n is even,
Am+1,n = Am,n+1 + Am,n when m + n is odd. Consequently the nth row
below the apex of the triangle contains the numbers An,0, An‚àí1,1, . . . , A0,n.
At the left, An,0 is the secant number jEnj; at the right, A0,n = Tn + [n = 0].
6.76
Let An denote the sum.
Looking ahead to equation (7.49), we see
that P
n Anzn/n! = P
n,k(‚àí1)k¬©n
k
¬™
2n‚àíkk! zn/n! = P
k(‚àí1)k2‚àík(e2z‚àí1)k =
2/(e2z + 1) = 1 ‚àítanh z. Therefore, by exercise 23 or 72,
An = (2n+1 ‚àí4n+1)Bn+1/(n + 1) = (‚àí1)(n+1)/2Tn + [n = 0] .
6.77
This follows by induction on m, using the recurrence in exercise 18. It
can also be proved from (6.50), using the fact that
(‚àí1)m‚àí1(m ‚àí1)!
(ez ‚àí1)m
= (D + 1)m‚àí1
1
ez ‚àí1
=
m‚àí1
X
k=0
¬∑
m
m ‚àík
¬∏ dm‚àík‚àí1
dzm‚àík‚àí1
1
ez ‚àí1 ,
integer m > 0.
The latter equation, incidentally, is equivalent to
dm
dzm
1
ez ‚àí1 = (‚àí1)m X
k
¬Øm + 1
k
¬∞ (k ‚àí1)!
(ez ‚àí1)k ,
integer m  0.
6.78
If p(x) is any polynomial of degree  n, we have
p(x) =
X
k
p(‚àík)
¬µ‚àíx
k
¬∂¬µx + n
n ‚àík
¬∂
,
because this equation holds for x = 0, ‚àí1, . . . , ‚àín. The stated identity is
the special case where p(x) = xœÉn(x) and x = 1. Incidentally, we obtain
a simpler expression for Bernoulli numbers in terms of Stirling numbers by

560 ANSWERS TO EXERCISES
setting k = 1 in (6.99):
X
k0
¬Øm
k
¬∞
(‚àí1)k
k!
k + 1 = Bm .
6.79
Sam Loyd [256, pages 288 and 378] gave the construction
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
and claimed to have invented (but not published) the 64 = 65 arrangement
in 1858. (Similar paradoxes go back at least to the eighteenth century, but
Loyd found better ways to present them.)
6.80
We expect Am/Am‚àí1 ‚âàœÜ, so we try Am‚àí1 = 618034+r and Am‚àí2 =
381966‚àír. Then Am‚àí3 = 236068+2r, etc., and we nd Am‚àí18 = 144‚àí2584r,
Am‚àí19 = 154 + 4181r. Hence r = 0, x = 154, y = 144, m = 20.
6.81
If P(Fn+1, Fn) = 0 for innitely many even values of n, then P(x, y) is
divisible by U(x, y) ‚àí1, where U(x, y) = x2 ‚àíxy ‚àíy2. For if t is the total
degree of P, we can write
P(x, y) =
t
X
k=0
qkxkyt‚àík +
X
j+k<t
rj,kxjyk = Q(x, y) + R(x, y) .
Then
P(Fn+1, Fn)
Ftn
=
t
X
k=0
qk
¬µFn+1
Fn
¬∂k
+ O(1/Fn)
and we have Pt
k=0 qkœÜk = 0 by taking the limit as n ‚Üí‚àû. Hence Q(x, y)
is a multiple of U(x, y), say A(x, y)U(x, y). But U(Fn+1, Fn) = (‚àí1)n and
n is even, so P0(x, y) = P(x, y) ‚àí
¬°
U(x, y) ‚àí1
¬¢
A(x, y) is another polynomial
such that P0(Fn+1, Fn) = 0. The total degree of P0 is less than t, so P0 is a
multiple of U ‚àí1 by induction on t.
Similarly, P(x, y) is divisible by U(x, y) + 1 if P(Fn+1, Fn) = 0 for
innitely many odd values of n. A combination of these two facts gives the
desired necessary and sucient condition: P(x, y) is divisible by U(x, y)2 ‚àí1.

A ANSWERS TO EXERCISES 561
6.82
First add the digits without carrying, getting digits 0, 1, and 2. Then
use the two carry rules
0 (d+1) (e+1) ‚Üí1 d e ,
0 (d+2) 0 e ‚Üí1 d 0 (e + 1) ,
always applying the leftmost applicable carry. This process terminates be-
cause the binary value obtained by reading (bm . . . b2)F as (bm . . . b2)2 in-
creases whenever a carry is performed. But a carry might propagate to the
right of the \Fibonacci point"; for example, (1)F+(1)F becomes (10.01)F. Such
rightward propagation extends at most two positions; and those two digit po-
sitions can be zeroed again by using the text's \add 1" algorithm if necessary.
Incidentally, there's a corresponding \multiplication" operation on
nonnegative integers: If m = Fj1 +¬∑ ¬∑ ¬∑+Fjq and n = Fk1 +¬∑ ¬∑ ¬∑+Fkr in the Fibo-
nacci number system, let m ‚ó¶n = Pq
b=1
Pr
c=1 Fjb+kc, by analogy with mul-
tiplication of binary numbers. (This denition implies that m ‚ó¶n ‚âà
‚àö
5 mn
Exercise: m ‚ó¶n =
mn +
‚åä(m+1)/œÜ‚åãn+
m‚åä(n+1)/œÜ‚åã.
when m and n are large, although 1 ‚ó¶n ‚âàœÜ2n.) Fibonacci addition leads to
a proof of the associative law l ‚ó¶(m ‚ó¶n) = (l ‚ó¶m) ‚ó¶n.
6.83
Yes; for example, we can take
A0 =
331635635998274737472200656430763 ;
A1 = 1510028911088401971189590305498785 .
The resulting sequence has the property that An is divisible by (but un-
equal to) pk when n mod mk = rk, where the numbers (pk, mk, rk) have the
following 18 respective values:
(3, 4, 1)
(2, 3, 2)
(5, 5, 1)
(7, 8, 3)
(17, 9, 4)
(11, 10, 2)
(47, 16, 7)
(19, 18, 10)
(61, 15, 3)
(2207, 32, 15)
(53, 27, 16)
(31, 30, 24)
(1087, 64, 31)
(109, 27, 7)
(41, 20, 10)
(4481, 64, 63)
(5779, 54, 52)
(2521, 60, 60)
One of these triples applies to every integer n; for example, the six triples in
the rst column cover every odd value of n, and the middle column covers all
even n that are not divisible by 6. The remainder of the proof is based on
the fact that Am+n = AmFn‚àí1 + Am+1Fn, together with the congruences
A0 ‚â°Fmk‚àírk mod pk ,
A1 ‚â°Fmk‚àírk+1 mod pk ,

562 ANSWERS TO EXERCISES
for each of the triples (pk, mk, rk).
(An improved solution, in which A0
and A1 are numbers of \only" 17 digits each, is also possible [218].)
6.84
The sequences of exercise 62 satisfy A‚àím = Am, B‚àím = ‚àíBm, and
AmAn = Am+n + Am‚àín ;
AmBn = Bm+n ‚àíBm‚àín ;
BmBn = Am+n ‚àíAm‚àín .
Let fk = Bmk/Amk+l and gk = Amk/Bmk+l, where l = 1
2(n ‚àím). Then
fk+1 ‚àífk = AlBm/(A2mk+n +Am) and gk ‚àígk+1 = AlBm/(A2mk+n ‚àíAm);
hence we have
S+
m,n =
‚àö
5
AlBm
lim
k‚Üí‚àû(fk ‚àíf0)
=
‚àö
5
œÜlAlLm
;
S‚àí
m,n =
‚àö
5
AlBm
lim
k‚Üí‚àû(g0 ‚àígk) =
‚àö
5
AlLm
¬µ 2
Bl
‚àí1
œÜl
¬∂
=
2
FlLlLm
‚àíS+
m,n .
6.85
The property holds if and only if N has one of the seven forms 5k,
2¬∑5k, 4¬∑5k, 3j ¬∑5k, 6¬∑5k, 7¬∑5k, 14¬∑5k.
6.86
For any positive integer m, let r(m) be the smallest index j such that
Cj is divisible by m; if no such j exists, let r(m) = ‚àû. Then Cn is divisible
by m if and only if gcd(Cn, Cr(m)) is divisible by m if and only if Cgcd(n,r(m))
is divisible by m if and only if gcd(n, r(m)) = r(m) if and only if n is divisible
by r(m).
(Conversely, the gcd condition is easily seen to be implied by the con-
dition that the sequence C1, C2, . . . has a function r(m), possibly innite,
such that Cn is divisible by m if and only if n is divisible by r(m).)
Now let Œ†(n) = C1C2 . . . Cn, so that
¬µm + n
m
¬∂
C
=
Œ†(m + n)
Œ†(m) Œ†(n) .
If p is prime, the number of times p divides Œ†(n) is fp(n) = P
k1‚åän/r(pk)‚åã,
since ‚åän/pk‚åãis the number of elements fC1, . . . , Cng that are divisible by pk.
Therefore fp(m + n)  fp(m) + fp(n) for all p, and
¬°m+n
m
¬¢
C is an integer.
6.87
The matrix product is
¬µ
Kn‚àí2(x2, . . . , xn‚àí1)
Kn‚àí1(x2, . . . , xn‚àí1, xn)
Kn‚àí1(x1, x2, . . . , xn‚àí1)
Kn(x1, x2, . . . , xn‚àí1, xn)
¬∂
.

A ANSWERS TO EXERCISES 563
This relates to products of L and R as in (6.137), because we have
Ra
¬µ
0
1
1
0
¬∂
=
¬µ
0
1
1
a
¬∂
=
¬µ
0
1
1
0
¬∂
La .
The determinant is Kn(x1, . . . , xn); the more general tridiagonal determinant
det
Ô£´
Ô£¨
Ô£¨
Ô£¨
Ô£¨
Ô£¨
Ô£≠
x1
1
0
. . .
0
y2
x2
1
0
0
y3
x3
1
...
...
...
1
0
0
. . .
yn
xn
Ô£∂
Ô£∑
Ô£∑
Ô£∑
Ô£∑
Ô£∑
Ô£∏
satises the recurrence Dn = xnDn‚àí1 ‚àíynDn‚àí2.
6.88
Let Œ±‚àí1 = a0 + 1
¬±¬°
a1 + 1/(a2 + ¬∑ ¬∑ ¬∑ )
¬¢
be the continued fraction rep-
resentation of Œ±‚àí1. Then we have
a0
z +
1
A0(z) +
1
A1(z) +
1
A2(z) + 1
...
= 1 ‚àíz
z
X
n1
z‚åänŒ±‚åã,
where
Am(z) = z‚àíqm+1 ‚àíz‚àíqm‚àí1
z‚àíqm ‚àí1
,
qm = Km(a1, . . . , am) .
A proof analogous to the text's proof of (6.146) uses a generalization of Zeck-
endorf's theorem (Fraenkel [129, ¬ß4]). If z = 1/b, where b is an integer  2,
this gives the continued fraction representation of the transcendental number
(b ‚àí1) P
n1 b‚àí‚åänŒ±‚åã, as in exercise 49.
6.89
Let p = K(0, a1, a2, . . . , am), so that p/n is the mth convergent to the
continued fraction. Then Œ± = p/n + (‚àí1)m/nq, where q = K(a1, . . . , am, Œ≤)
and Œ≤ > 1. The points fkŒ±g for 0  k < n can therefore be written
0
n,
1
n + (‚àí1)mœÄ1
nq
, . . . ,
n ‚àí1
n
+ (‚àí1)mœÄn‚àí1
nq
,
where œÄ1 . . . œÄn‚àí1 is a permutation of f1, . . . , n ‚àí1g. Let f(v) be the number
of such points < v; then f(v) and vn both increase by 1 when v increases from
k/n to (k + 1)/n, except when k = 0 or k = n ‚àí1, so they never dier by 2
or more.

564 ANSWERS TO EXERCISES
6.90
By (6.139) and (6.136), we want to maximize K(a1, . . . , am) over all
sequences of positive integers whose sum is  n + 1. The maximum occurs
when all the a's are 1, for if j  1 and a  1 we have
Kj+k+1(1, . . . , 1, a + 1, b1, . . . , bk)
= Kj+k+1(1, . . . , 1, a, b1, . . . , bk) + Kj(1, . . . , 1) Kk(b1, . . . , bk)
 Kj+k+1(1, . . . , 1, a, b1, . . . , bk) + Kj+k(1, . . . , 1, a, b1, . . . , bk)
= Kj+k+2(1, . . . , 1, a, b1, . . . , bk) .
(Motzkin and Straus [278] show how to solve more general maximization
problems on continuants.)
6.91
A candidate for the case n mod 1 = 1
2 appears in [213, ¬ß6], although
it may be best to multiply the integers discussed there by some constant
involving ‚àöœÄ. Alternatively, Renzo Sprugnoli observes that we can dene
¬©n
m
¬™
= P
k
¬°m
k
¬¢
kn(‚àí1)(m ‚àík)/m! for integer m  0 and arbitrary n  0;
then (6.3) holds for all n  1.
6.92
(a) If there are only nitely many solutions, it is natural to conjec-
ture that the same holds for all primes.
(b) The behavior of bn is quite
strange: We have bn = lcm(1, . . . , n) for 968  n  1066; on the other hand,
Another reason to
remember 1066?
b600 = lcm(1, . . . , 600)/(33 ¬∑52 ¬∑43). Andrew Odlyzko observes that p divides
lcm(1, . . . , n)/bn if and only if kpm  n < (k + 1)pm for some m  1 and
some k < p such that p divides the numerator of Hk. Therefore innitely
many such n exist if it can be shown, for example, that almost all primes
have only one such value of k (namely k = p ‚àí1).
6.93
(Brent [38] found the surprisingly large partial quotient 1568705 in eŒ≥,
but this seems to be just a coincidence. For example, Gosper has found even
larger partial quotients in œÄ: The 453,294th is 12996958 and the 11,504,931st
is 878783625.)
6.94
Consider the generating function P
m,n0
¬Ø¬Øm+n
m
¬Ø¬Øwmzn, which has the
form P
n
¬°
wF(a, b, c) + zF(a‚Ä≤, b‚Ä≤, c‚Ä≤)
¬¢n, where F(a, b, c) is the dierential op-
erator a + bœëw + cœëz.
6.95
Complete success might be dicult or impossible, because Stirling
numbers are not \holonomic" in the sense of [382].
7.1
Substitute z4 for
and z for
in the generating function, getting
1/(1‚àíz4 ‚àíz2). This is like the generating function for T, but with z replaced
by z2. Therefore the answer is zero if m is odd, otherwise Fm/2+1.
7.2
G(z) = 1/(1 ‚àí2z) + 1/(1 ‚àí3z); bG(z) = e2z + e3z.
7.3
Set z = 1/10 in the generating function, getting 10
9 ln 10
9 .

A ANSWERS TO EXERCISES 565
7.4
Divide P(z) by Q(z), getting a quotient T(z) and a remainder P0(z)
whose degree is less than the degree of Q. The coecients of T(z) must be
added to the coecients [zn] P0(z)/Q(z) for small n. (This is the polynomial
T(z) in (7.28).)
7.5
This is the convolution of (1 + z2)r with (1 + z)r, so
S(z) = (1 + z + z2 + z3)r .
Incidentally, no simple form is known for the coecients of this generating
function; hence the stated sum probably has no simple closed form. (We can
use generating functions to obtain negative results as well as positive ones.)
7.6
Let the solution to g0 = Œ±, g1 = Œ≤, gn = gn‚àí1 + 2gn‚àí2 + (‚àí1)nŒ≥ be
gn = A(n)Œ± + B(n)Œ≤ + C(n)Œ≥. The function 2n works when Œ± = 1, Œ≤ = 2,
Œ≥ = 0; the function (‚àí1)n works when Œ± = 1, Œ≤ = ‚àí1, Œ≥ = 0; the function
(‚àí1)nn works when Œ± = 0, Œ≤ = ‚àí1, Œ≥ = 3. Hence A(n) + 2B(n) = 2n,
A(n) ‚àíB(n) = (‚àí1)n, and ‚àíB(n) + 3C(n) = (‚àí1)nn.
7.7
G(z) =
¬°
z/(1 ‚àíz)2¬¢
G(z) + 1, hence
G(z) = 1 ‚àí2z + z2
1 ‚àí3z + z2 = 1 +
z
1 ‚àí3z + z2 ;
we have gn = F2n + [n = 0].
I bet that the con-
troversial \fan of
order zero" does
have one spanning
tree.
7.8
Dierentiate (1 ‚àíz)‚àíx‚àí1 twice with respect to x, obtaining
¬µx + n
n
¬∂¬°
(Hx+n ‚àíHx)2 ‚àí(H(2)
x+n ‚àíH(2)
x )
¬¢
.
Now set x = m.
7.9
(n + 1)(H2
n ‚àíH(2)
n ) ‚àí2n(Hn ‚àí1).
7.10
The identity Hk‚àí1/2 ‚àíH‚àí1/2 =
2
2k‚àí1 + ¬∑ ¬∑ ¬∑ + 2
1 = 2H2k ‚àíHk implies
that P
k
¬°2k
k
¬¢¬°2n‚àí2k
n‚àík
¬¢
(2H2k ‚àíHk) = 4nHn.
7.11
(a) C(z) = A(z)B(z2)/(1 ‚àíz). (b) zB‚Ä≤(z) = A(2z)ez, hence A(z) =
z
2e‚àíz/2B‚Ä≤( z
2). (c) A(z) = B(z)/(1 ‚àíz)r+1, hence B(z) = (1 ‚àíz)r+1A(z) and
we have fk(r) =
¬°r+1
k
¬¢
(‚àí1)k.
7.12
Cn. The numbers in the upper row correspond to the positions of +1's
in a sequence of +1's and ‚àí1's that denes a \mountain range"; the numbers
in the lower row correspond to the positions of ‚àí1's. For example, the given
array corresponds to
q¬°
q¬°
q
@q¬°
q¬°
q
@q
@q¬°
q
@q
@q .

566 ANSWERS TO EXERCISES
7.13
Extend the sequence periodically (let xm+k = xk) and dene sn =
x1 + ¬∑ ¬∑ ¬∑ + xn. We have sm = l, s2m = 2l, etc. There must be a largest index
kj such that skj = j, skj+m = l+j, etc. These indices k1, . . . , kl (modulo m)
specify the cyclic shifts in question.
For example, in the sequence ‚ü®‚àí2, 1, ‚àí1, 0, 1, 1, ‚àí1, 1, 1, 1‚ü©with m = 10
and l = 2 we have k1 = 17, k2 = 24.
7.14
bG(z) = ‚àí2zbG(z) + bG(z)2 + z (be careful about the nal term!) leads
via the quadratic formula to
bG(z) = 1 + 2z ‚àí
‚àö
1 + 4z2
2
.
Hence g2n+1 = 0 and g2n = (‚àí1)n(2n)! Cn‚àí1, for all n > 0.
7.15
There are
¬°n
k
¬¢
œñn‚àík partitions with k other objects in the subset con-
taining n+1. Hence bP ‚Ä≤(z) = ezbP(z). The solution to this dierential equation
is bP(z) = eez+c, and c = ‚àí1 since bP(0) = 1. (We can also get this result by
summing (7.49) on m, since œñn = P
m
¬©n
m
¬™
.)
7.16
One way is to take the logarithm of
B(z) = 1
¬±¬°
(1 ‚àíz)a1(1 ‚àíz2)a2(1 ‚àíz3)a3(1 ‚àíz4)a4 . . .
¬¢
,
then use the formula for ln
1
1‚àíz and interchange the order of summation.
7.17
This follows since
R‚àû
0 tne‚àít dt = n!. There's also a formula that goes
in the other direction:
bG(z) =
1
2œÄ
Z +œÄ
‚àíœÄ
G(ze‚àíiŒ∏) eeiŒ∏dŒ∏ .
7.18
(a) Œ∂(z ‚àí1
2);
(b) ‚àíŒ∂‚Ä≤(z);
(c) Œ∂(z)/Œ∂(2z). Every positive integer is
uniquely representable as m2q, where q is squarefree.
7.19
If n > 0, the coecient [zn] exp
¬°
x ln F(z)
¬¢
is a polynomial of degree n
in x that's a multiple of x. The rst convolution formula comes from equating
coecients of zn in F(z)xF(z)y = F(z)x+y. The second comes from equating
coecients of zn‚àí1 in F‚Ä≤(z)F(z)x‚àí1F(z)y = F‚Ä≤(z)F(z)x+y‚àí1, because we have
F‚Ä≤(z)F(z)x‚àí1 = x‚àí1 ‚àÇ
‚àÇz
¬°
F(z)x¬¢
= x‚àí1 X
n0
nfn(x)zn‚àí1 .
(Further convolutions follow by taking ‚àÇ/‚àÇx, as in (7.43).)
Still more is true, as shown in [221]: We have
n
X
k=0
xfk(x + tk)
x + tk
yfn‚àík(y + t(n ‚àík))
y + t(n ‚àík)
= (x + y)fn(x + y + tn)
x + y + tn
,

A ANSWERS TO EXERCISES 567
for arbitrary x, y, and t. In fact, xfn(x + tn)/(x + tn) is the sequence of
polynomials for the coecients of Ft(z)x, where
Ft(z) = F
¬°
zFt(z)t¬¢
.
(We saw special cases in (5.59) and (6.52).)
7.20
Let G(z) = P
n0 gnzn. Then
zlG(k)(z) =
X
n0
nkgnzn‚àík+l =
X
n0
(n + k ‚àíl)kgn+k‚àílzn
for all k, l  0, if we regard gn = 0 for n < 0. Hence if P0(z), . . . , Pm(z) are
polynomials, not all zero, having maximum degree d, then there are polyno-
mials p0(n), . . . , pm+d(n) such that
P0(z)G(z) + ¬∑ ¬∑ ¬∑ + Pm(z)G(m)(z) =
X
n0
m+d
X
j=0
pj(n)gn+j‚àídzn .
Therefore a dierentiably nite G(z) implies that
m+d
X
j=0
pj(n + d)gn+j = 0 ,
for all n  0.
The converse is similar. (One consequence is that G(z) is dierentiably nite
if and only if the corresponding egf, bG(z), is dierentiably nite.)
7.21
This is the problem of giving change with denominations 10 and 20, so
G(z) = 1/(1‚àíz10)(1‚àíz20) = G(z10), where G(z) = 1/(1‚àíz)(1‚àíz2). (a) The
partial fraction decomposition of G(z) is 1
2(1‚àíz)‚àí2 + 1
4(1‚àíz)‚àí1 + 1
4(1+z)‚àí1,
This slow method of
nding the answer
is just the cashier's
way of stalling until
the police come.
so [zn] G(z) = 1
4
¬°
2n + 3 + (‚àí1)n¬¢
. Setting n = 50 yields 26 ways to make
the payment. (b) G(z) = (1 + z)/(1 ‚àíz2)2 = (1 + z)(1 + 2z2 + 3z4 + ¬∑ ¬∑ ¬∑ ),
so [zn] G(z) = ‚åän/2‚åã+ 1. (Compare this with the value Nn = ‚åän/5‚åã+ 1 in
the text's coin-changing problem. The bank robber's problem is equivalent
to the problem of making change with pennies and tuppences.)
The USA has
two-cent pieces, but
they haven't been
minted since 1873.
7.22
Each polygon has a \base" (the line segment at the bottom). If A
and B are triangulated polygons, let A‚ñ≥B be the result of pasting the base
of A to the upper left diagonal of ‚ñ≥, and pasting the base of B to the upper
right diagonal. Thus, for example,
¬° ‚ñ≥
= B
Q
¬£
"" .
(The polygons might need to be warped a bit and/or banged into shape.)
Every triangulation arises in this way, because the base line is part of a unique
triangle and there are triangulated polygons A and B at its left and right.

568 ANSWERS TO EXERCISES
Replacing each triangle by z gives a power series in which the coecient
of zn is the number of triangulations with n triangles, namely the number
of ways to decompose an (n + 2)-gon into triangles. Since P = 1 + zP2, this
is the generating function for Catalan numbers C0 + C1z + C2z2 + ¬∑ ¬∑ ¬∑ ; the
number of ways to triangulate an n-gon is Cn‚àí2 =
¬°2n‚àí4
n‚àí2
¬¢
/(n ‚àí1).
7.23
Let an be the stated number, and bn the number of ways with a 2√ó1√ó1
notch missing at the top. By considering the possible patterns visible on the
top surface, we have
an = 2an‚àí1 + 4bn‚àí1 + an‚àí2 + [n = 0] ;
bn = an‚àí1 + bn‚àí1 .
Hence the generating functions satisfy A = 2zA+4zB+z2A+1, B = zA+zB,
and we have
A(z) =
1 ‚àíz
(1 + z)(1 ‚àí4z + z2) .
This formula relates to the problem of 3 √ó n domino tilings; we have an =
1
3
¬°
U2n + V2n+1 + (‚àí1)n¬¢
= 1
6(2 +
‚àö
3 )n+1 + 1
6(2 ‚àí
‚àö
3 )n+1 + 1
3(‚àí1)n, which
is (2 +
‚àö
3 )n+1/6 rounded to the nearest integer.
7.24
n P
k1+¬∑¬∑¬∑+km=n k1 ¬∑ . . . ¬∑ km/m = F2n+1 + F2n‚àí1 ‚àí2. (Consider the
coecient [zn‚àí1] d
dz ln
¬°
1/(1 ‚àíG(z))
¬¢
, where G(z) = z/(1 ‚àíz)2.)
7.25
The generating function is P(z)/(1 ‚àízm), where P(z) = z + 2z2 +
¬∑ ¬∑ ¬∑ + (m ‚àí1)zm‚àí1 =
¬°
(m ‚àí1)zm+1 ‚àímzm + z)/(1 ‚àíz)2. The denominator
is Q(z) = 1 ‚àízm = (1 ‚àíœâ0z)(1 ‚àíœâ1z) . . . (1 ‚àíœâm‚àí1z). By the rational
expansion theorem for distinct roots, we obtain
n mod m = m ‚àí1
2
+
m‚àí1
X
k=1
œâ‚àíkn
œâk ‚àí1 .
7.26
(1 ‚àíz ‚àíz2)F(z) = F(z) leads to Fn =
¬°
2(n + 1)Fn + nFn+1
¬¢
/5 as in
equation (7.61).
7.27
Each oriented cycle pattern begins with qq
6
?or q q
q q or a 2 √ó k cycle (for
some k  2) oriented in one of two ways. Hence
Qn = Qn‚àí1 + Qn‚àí2 + 2Qn‚àí2 + 2Qn‚àí3 + ¬∑ ¬∑ ¬∑ + 2Q0
for n  2; Q0 = Q1 = 1. The generating function is therefore
Q(z) = zQ(z) + z2Q(z) + 2z2Q(z)/(1 ‚àíz) + 1
= 1/
¬°
1 ‚àíz ‚àíz2 ‚àí2z2/(1 ‚àíz)
¬¢

A ANSWERS TO EXERCISES 569
=
(1 ‚àíz)
(1 ‚àí2z ‚àí2z2 + z3)
=
œÜ2/5
1 ‚àíœÜ2z +
œÜ‚àí2/5
1 ‚àíœÜ‚àí2z + 2/5
1 + z ,
and Qn =
¬°
œÜ2n+2 + œÜ‚àí2n‚àí2 + 2(‚àí1)n¬¢
/5 =
¬°
(œÜn+1 ‚àí^œÜn+1)/
‚àö
5
¬¢2 = F2
n+1.
7.28
In general if A(z) = (1 + z + ¬∑ ¬∑ ¬∑ + zm‚àí1)B(z), we have Ar + Ar+m +
Ar+2m + ¬∑ ¬∑ ¬∑ = B(1) for 0  r < m.
In this case m = 10 and B(z) =
(1 + z + ¬∑ ¬∑ ¬∑ + z9)(1 + z2 + z4 + z6 + z8)(1 + z5).
7.29
F(z) + F(z)2 + F(z)3 + ¬∑ ¬∑ ¬∑ = z/(1 ‚àíz ‚àíz2 ‚àíz) =
¬°
1/(1 ‚àí(1 +
‚àö
2 )z) ‚àí
(1/(1 ‚àí(1 ‚àí
‚àö
2 )z)
¬¢
/
‚àö
8, so the answer is
¬°
(1 +
‚àö
2 )n ‚àí(1 ‚àí
‚àö
2 )n¬¢
/
‚àö
8.
7.30
Pn
k=1
¬°2n‚àí1‚àík
n‚àí1
¬¢¬°
anbn‚àík/(1 ‚àíŒ±z)k + an‚àíkbn/(1 ‚àíŒ≤z)k¬¢
, by exercise
5.39.
7.31
The dgf is Œ∂(z)2/Œ∂(z‚àí1); hence we nd g(n) is the product of (k+1‚àíkp)
over all prime powers pk that exactly divide n.
7.32
We may assume that each bk  0. A set of arithmetic progressions
forms an exact cover if and only if
1
1 ‚àíz =
zb1
1 ‚àíza1 + ¬∑ ¬∑ ¬∑ +
zbm
1 ‚àízam .
Subtract zbm/(1 ‚àízam) from both sides and set z = e2œÄi/am. The left side
is innite, and the right side will be nite unless am‚àí1 = am.
7.33
(‚àí1)n‚àím+1[n > m]/(n ‚àím).
7.34
We can also write Gn(z) = P
k1+(m+1)km+1=n
¬°k1+km+1
km+1
¬¢
(zm)km+1.
In general, if
Gn =
X
k1+2k2+¬∑¬∑¬∑+rkr=n
¬µk1 + k2 + ¬∑ ¬∑ ¬∑ + kr
k1, k2, . . . , kr
¬∂
zk1
1 zk2
2 . . . zkr
r ,
we have Gn = z1Gn‚àí1 + z2Gn‚àí2 + ¬∑ ¬∑ ¬∑ + zrGn‚àír + [n = 0], and the generating
function is 1/(1 ‚àíz1w ‚àíz2w2 ‚àí¬∑ ¬∑ ¬∑ ‚àízrwr). In the stated special case the
answer is 1/(1 ‚àíw ‚àízmwm+1). (See (5.74) for the case m = 1.)
7.35
(a)
1
n
P
0<k<n
¬°
1/k + 1/(n ‚àík)
¬¢
=
2
nHn‚àí1.
(b) [zn]
¬°
ln
1
1‚àíz
¬¢2 =
2!
n!
¬£n
2
¬§
=
2
nHn‚àí1 by (7.50) and (6.58).
Another way to do part (b) is to
use the rule [zn] F(z) = 1
n[zn‚àí1] F‚Ä≤(z) with F(z) =
¬°
ln
1
1‚àíz
¬¢2.
7.36
1‚àízm
1‚àíz A(zm).

570 ANSWERS TO EXERCISES
7.37
(a) The amazing identity a2n = a2n+1 = bn holds in the table
n
0
1
2
3
4
5
6
7
8
9
10
an
1
1
2
2
4
4
6
6
10
10
14
bn
1
2
4
6
10
14
20
26
36
46
60
(b) A(z) = 1/
¬°
(1 ‚àíz)(1 ‚àíz2)(1 ‚àíz4)(1 ‚àíz8) . . .
¬¢
. (c) B(z) = A(z)/(1 ‚àíz),
and we want to show that A(z) = (1 + z)B(z2). This follows from A(z) =
A(z2)/(1 ‚àíz).
7.38
(1 ‚àíwz)M(w, z) = P
m,n1
¬°
min(m, n) ‚àímin(m‚àí1, n‚àí1)
¬¢
wmzn =
P
m,n1 wmzn = wz/(1 ‚àíw)(1 ‚àíz). In general,
M(z1, . . . , zm) =
z1 . . . zm
(1 ‚àíz1) . . . (1 ‚àízm)(1 ‚àíz1 . . . zm) .
7.39
The answers to the hint are
X
1k1<k2<¬∑¬∑¬∑<kmn
ak1ak2 . . . akm
and
X
1k1k2¬∑¬∑¬∑kmn
ak1ak2 . . . akm ,
respectively. Therefore: (a) We want the coecient of zm in the product
(1 + z)(1 + 2z) . . . (1 + nz). This is the reection of (z + 1)n, so it is
¬£n+1
n+1
¬§
+
¬£n+1
n
¬§
z + ¬∑ ¬∑ ¬∑ +
¬£n+1
1
¬§
zn and the answer is
¬£
n+1
n+1‚àím
¬§
. (b) The coecient of zm
in 1/
¬°
(1 ‚àíz)(1 ‚àí2z) . . . (1 ‚àínz)
¬¢
is
¬©m+n
n
¬™
by (7.47).
7.40
The egf for ‚ü®nFn‚àí1 ‚àíFn‚ü©is (z ‚àí1)bF(z) where bF(z) = P
n0 Fnzn/n! =
(eœÜz ‚àíe^œÜz)/
‚àö
5. The egf for ‚ü®n<‚ü©is e‚àíz/(1 ‚àíz). The product is
5‚àí1/2¬°
e(^œÜ‚àí1)z ‚àíe(œÜ‚àí1)z¬¢
= 5‚àí1/2(e‚àíœÜz ‚àíe‚àí^œÜz) .
We have bF(z)e‚àíz = ‚àíbF(‚àíz). So the answer is (‚àí1)nFn.
7.41
The number of up-down permutations with the largest element n in
position 2k is
¬° n‚àí1
2k‚àí1
¬¢
A2k‚àí1An‚àí2k. Similarly, the number of up-down permu-
tations with the smallest element 1 in position 2k + 1 is
¬°n‚àí1
2k
¬¢
A2kAn‚àí2k‚àí1,
because down-up permutations and up-down permutations are equally nu-
merous. Summing over all possibilities gives
2An =
X
k
¬µn ‚àí1
k
¬∂
Ak An‚àí1‚àík + 2[n = 0] + [n = 1] .
The egf bA therefore satises 2bA‚Ä≤(z) = bA(z)2 + 1 and bA(0) = 1; the given
function solves this dierential equation. (Consequently An = jEnj + Tn is a
secant number when n is even, a tangent number when n is odd.)

A ANSWERS TO EXERCISES 571
7.42
Let an be the number of Martian DNA strings that don't end with c
or e; let bn be the number that do. Then
an = 3an‚àí1 + 2bn‚àí1 + [n = 0] ,
bn = 2an‚àí1 + bn‚àí1 ;
A(z) = 3zA(z) + 2zB(z) + 1 ,
B(z) = 2zA(z) + zB(z) ;
A(z) =
1 ‚àíz
1 ‚àí4z ‚àíz2 ,
B(z) =
2z
1 ‚àí4z ‚àíz2 ;
and the total number is [zn](1 + z)/(1 ‚àí4z ‚àíz2) = F3n+2.
7.43
By (5.45), gn = ‚àÜn _G(0).
The nth dierence of a product can be
written
‚àÜnA(z)B(z) =
X
k
¬µn
k
¬∂¬°
‚àÜkEn‚àíkA(z)
¬¢¬°
‚àÜn‚àíkB(z)
¬¢
,
and En‚àík = (1 + ‚àÜ)n‚àík = P
j
¬°n‚àík
j
¬¢
‚àÜj. Therefore we nd
hn =
X
j,k
¬µn
k
¬∂¬µn ‚àík
j
¬∂
fj+k gn‚àík .
This is a sum over all trinomial coecients; it can be put into the more
symmetric form
hn =
X
j+k+l=n
¬µ n
j, k, l
¬∂
fj+k gk+l .
7.44
Each partition into k nonempty subsets can be ordered in k! ways, so
The empty set
is pointless.
bk = k!. Thus bQ(z) = P
n,k0
¬©n
k
¬™
k! zn/n! = P
k0(ez ‚àí1)k = 1/(2 ‚àíez).
And this is the geometric series P
k0 ekz/2k+1, hence ak = 1/2k+1. Finally,
ck = 2k; consider all permutations when the x's are distinct, change each `>'
between subscripts to `<' and allow each `<' between subscripts to become
either `<' or `='. (For example, the permutation x1x3x2 produces x1 < x3 <
x2 and x1 = x3 < x2, because 1 < 3 > 2.)
7.45
This sum is P
n1 r(n)/n2, where r(n) is the number of ways to write
n as a product of two relatively prime factors. If n is divisible by t distinct
primes, r(n) = 2t. Hence r(n)/n2 is multiplicative and the sum is
Y
p
¬µ
1 + 2
p2 + 2
p4 ¬∑ ¬∑ ¬∑
¬∂
=
Y
p
¬µ
1 +
2
p2 ‚àí1
¬∂
=
Y
p
¬µp2 + 1
p2 ‚àí1
¬∂
= Œ∂(2)2/Œ∂(4) = 5
2 .

572 ANSWERS TO EXERCISES
7.46
Let Sn = P
0kn/2
¬°n‚àí2k
k
¬¢
Œ±k. Then Sn = Sn‚àí1 + Œ±Sn‚àí3 + [n = 0],
and the generating function is 1/(1 ‚àíz ‚àíŒ±z3). When Œ± = ‚àí4
27, the hint
tells us that this has a nice factorization 1/(1 + 1
3z)(1 ‚àí2
3z)2. The general
expansion theorem now tells us that Sn = ( 2
3n + c)( 2
3)n + 1
9(‚àí1
3)n, and the
remaining constant c turns out to be 8
9.
7.47
The Stern{Brocot representation of
‚àö
3 is R(LR2)‚àû, because
‚àö
3 + 1 = 2 +
1
1 +
1
‚àö
3 + 1
.
The fractions are 1
1, 2
1, 3
2, 5
3, 7
4, 12
7 , 19
11, 26
15, . . . ; they eventually have the
cyclic pattern
V2n‚àí1+V2n+1
U2n
, U2n+V2n+1
V2n+1
, U2n+2+V2n‚àí1
U2n+V2n+1
, V2n+1+V2n+3
U2n+2
, . . . .
7.48
We have g0 = 0, and if g1 = m the generating function satises
aG(z) + bz‚àí1G(z) + cz‚àí2¬°
G(z) ‚àímz
¬¢
+
d
1 ‚àíz = 0 .
Hence G(z) = P(z)/(az2 + bz + c)(1 ‚àíz) for some polynomial P(z). Let œÅ1
and œÅ2 be the roots of cz2 + bz + a, with jœÅ1j  jœÅ2j. If b2 ‚àí4ac  0 then
jœÅ1j2 = œÅ1œÅ2 = a/c is rational, contradicting the fact that
n‚àögn approaches
1 +
‚àö
2. Hence œÅ1 = (‚àíb +
‚àö
b2 ‚àí4ca)/2c = 1 +
‚àö
2; and this implies that
a = ‚àíc, b = ‚àí2c, œÅ2 = 1 ‚àí
‚àö
2. The generating function now takes the form
G(z) =
z
¬°
m ‚àí(r + m)z
¬¢
(1 ‚àí2z ‚àíz2)(1 ‚àíz)
= ‚àír + (2m + r)z
2(1 ‚àí2z ‚àíz2) +
r
2(1 ‚àíz) = mz + (2m ‚àír)z2 + ¬∑ ¬∑ ¬∑ ,
where r = d/c. Since g2 is an integer, r is an integer. We also have
gn = Œ±(1 +
‚àö
2 )n + ^Œ±(1 ‚àí
‚àö
2 )n + 1
2r =
¬•
Œ±(1 +
‚àö
2 )n¬¶
,
and this can hold only if r = ‚àí1, because (1 ‚àí
‚àö
2 )n alternates in sign as
it approaches zero.
Hence (a, b, c, d) = ¬±(1, 2, ‚àí1, 1).
Now we nd Œ± =
1
4(1 +
‚àö
2 m), which is between 0 and 1 only if 0  m  2.
Each of
these values actually gives a solution; the sequences ‚ü®gn‚ü©are ‚ü®0, 0, 1, 3, 8, . . . ‚ü©,
‚ü®0, 1, 3, 8, 20, . . . ‚ü©, and ‚ü®0, 2, 5, 13, 32, . . . ‚ü©.

A ANSWERS TO EXERCISES 573
7.49
(a) The denominator of
¬°
1/
¬°
1 ‚àí(1 +
‚àö
2)z
¬¢
+ 1/
¬°
1 ‚àí(1 ‚àí
‚àö
2)z
¬¢¬¢
is
1‚àí2z‚àíz2; hence an = 2an‚àí1 + an‚àí2 for n  2. (b) True because an is even
and ‚àí1 < 1 ‚àí
‚àö
2 < 0. (c) Let
bn =
¬µp + ‚àöq
2
¬∂n
+
¬µp ‚àí‚àöq
2
¬∂n
.
We would like bn to be odd for all n > 0, and ‚àí1 < (p‚àí‚àöq)/2 < 0. Working
as in part (a), we nd b0 = 2, b1 = p, and bn = pbn‚àí1 + 1
4(q ‚àíp2)bn‚àí2 for
n  2. One satisfactory solution has p = 3 and q = 17.
7.50
Extending the multiplication idea of exercise 22, we have
Q =
+
¬¢¬¢AA
Q
Q + Q
Q
Q +
B
Q
¬£
Q
Q
Q
Q + ¬∑ ¬∑ ¬∑ .
Replace each n-gon by zn‚àí2. This substitution behaves properly under mul-
tiplication, because the pasting operation takes an m-gon and an n-gon into
an (m + n ‚àí2)-gon. Thus the generating function is
Q = 1 + zQ2 + z2Q3 + z3Q4 + ¬∑ ¬∑ ¬∑ = 1 +
zQ2
1 ‚àízQ
and the quadratic formula gives Q =
¬°
1 + z ‚àí
‚àö
1 ‚àí6z + z2 ¬¢
/4z. The coe-
cient of zn‚àí2 in this power series is the number of ways to put nonoverlapping
diagonals into a convex n-gon. These coecients apparently have no closed
form in terms of other quantities that we have discussed in this book, but
Give me Legen-
dre polynomials
and I'll give you a
closed form.
their asymptotic behavior is known [207, exercise 2.2.1{12].
Incidentally, if each n-gon in Q is replaced by wzn‚àí2 we get
Q = 1 + z ‚àí
‚àö
1 ‚àí(4w + 2)z + z2
2(1 + w)z
,
a formula in which the coecient of wmzn‚àí2 is the number of ways to divide
an n-gon into m polygons by nonintersecting diagonals.
7.51
The key rst step is to observe that the square of the number of ways
is the number of cycle patterns of a certain kind, generalizing exercise 27.
These can be enumerated by evaluating the determinant of a matrix whose
eigenvalues are not dicult to determine. When m = 3 and n = 4, the fact
that cos 36‚ó¶= œÜ/2 is helpful (exercise 6.46).
7.52
The rst few cases are p0(y) = 1, p1(y) = y, p2(y) = y2 + y,
p3(y) = y3 + 3y2 + 3y.
Let pn(y) = q2n(x) where y = x(1 ‚àíx); we
seek a generating function that denes q2n+1(x) in a convenient way. One
such function is P
n qn(x)zn/n! = 2eixz/(eiz + 1), from which it follows

574 ANSWERS TO EXERCISES
that qn(x) = inEn(x), where En(x) is called an Euler polynomial. We have
P(‚àí1)xxn Œ¥x = 1
2(‚àí1)x+1En(x), so Euler polynomials are analogous to Ber-
noulli polynomials, and they have factors analogous to those in (6.98). By
exercise 6.23 we have nEn‚àí1(x) = Pn
k=0
¬°n
k
¬¢
Bkxn‚àík(2 ‚àí2k+1); this polyno-
mial has integer coecients by exercise 6.54. Hence q2n(x), whose coecients
have denominators that are powers of 2, must have integer coecients. Hence
pn(y) has integer coecients. Finally, the relation (4y ‚àí1)p‚Ä≤‚Ä≤
n(y) + 2p‚Ä≤
n(y) =
2n(2n ‚àí1)pn‚àí1(y) shows that
2m(2m ‚àí1)
¬Ø¬Ø¬Ø¬Ø
n
m
¬Ø¬Ø¬Ø¬Ø = m(m + 1)
¬Ø¬Ø¬Ø¬Ø
n
m + 1
¬Ø¬Ø¬Ø¬Ø + 2n(2n ‚àí1)
¬Ø¬Ø¬Ø¬Ø
n ‚àí1
m ‚àí1
¬Ø¬Ø¬Ø¬Ø ,
and it follows that the
¬Ø¬Øn
m
¬Ø¬Ø's are positive. (A similar proof shows that the
related quantity (‚àí1)n(2n + 2)E2n+1(x)/(2x ‚àí1) has positive integer coe-
cients, when expressed as an nth degree polynomial in y.) It can be shown
that
¬Ø¬Øn
1
¬Ø¬Ø is the Genocchi number (‚àí1)n‚àí1(22n+1 ‚àí2)B2n (see exercise 6.24),
and that
¬Ø¬Ø n
n‚àí1
¬Ø¬Ø =
¬°n
2
¬¢
,
¬Ø¬Ø n
n‚àí2
¬Ø¬Ø = 2
¬°n+1
4
¬¢
+ 3
¬°n
4
¬¢
, etc.
7.53
It is P(1+V4n+1+V4n+3)/6. Thus, for example, T20 = P12 = 210; T285 =
P165 = 40755.
7.54
Let Ek be the operation on power series that sets all coecients to zero
except those of zn where n mod m = k. The stated construction is equivalent
to the operation
E0 S E0 S (E0 + E1) S . . . S (E0 + E1 + ¬∑ ¬∑ ¬∑ + Em‚àí1)
applied to 1/(1 ‚àíz), where S means \multiply by 1/(1 ‚àíz)." There are m!
terms
E0 S Ek1 S Ek2 S . . . S Ekm
where 0  kj < j, and every such term evaluates to zrm/(1 ‚àízm)m+1 if r is
the number of places where kj < kj+1. Exactly
¬≠m
r
¬Æ
terms have a given value
of r, so the coecient of zmn is Pm‚àí1
r=0
¬≠m
r
¬Æ¬°n+m‚àír
m
¬¢
= (n + 1)m by (6.37).
(The fact that operation Ek can be expressed with complex roots of unity
seems to be of no help in this problem.)
7.55
Suppose that P0(z)F(z) + ¬∑ ¬∑ ¬∑ + Pm(z)F(m)(z) = Q0(z)G(z) + ¬∑ ¬∑ ¬∑ +
Qn(z)G(n)(z) = 0, where Pm(z) and Qn(z) are nonzero. (a) Let H(z) = F(z)+
G(z). Then there are rational functions Rk,l(z) for 0  l < m + n such that
H(k)(z) = Rk,0(z)F(0)(z) + ¬∑ ¬∑ ¬∑ + Rk,m‚àí1(z)F(m‚àí1)(z) + Rk,m(z)G(0)(z) + ¬∑ ¬∑ ¬∑ +
Rk,m+n‚àí1(z)G(n‚àí1)(z). The m + n + 1 vectors
¬°
Rk,0(z), . . . , Rk,m+n‚àí1(z)
¬¢
are linearly dependent in the (m + n)-dimensional vector space whose com-
ponents are rational functions; hence there are rational functions Sl(z), not

A ANSWERS TO EXERCISES 575
all zero, such that S0(z)H(0)(z) + ¬∑ ¬∑ ¬∑ + Sm+n(z)H(m+n)(z) = 0. (b) Simi-
larly, let H(z) = F(z)G(z). There are rational Rk,l(z) for 0  l < mn with
H(k)(z) = Pm‚àí1
i=0
Pn‚àí1
j=0 Rk,ni+j(z)F(i)(z)G(j)(z), hence S0(z)H(0)(z) + ¬∑ ¬∑ ¬∑ +
Smn(z)H(mn)(z) = 0 for some rational Sl(z), not all zero. (A similar proof
shows that if ‚ü®fn‚ü©and ‚ü®gn‚ü©are polynomially recursive, so are ‚ü®fn + gn‚ü©and
‚ü®fngn‚ü©. Incidentally, there is no similar result for quotients; for example, cos z
is dierentiably nite, but 1/cos z is not.)
7.56
Euler [113] showed that this number is also [zn] 1/
‚àö
1‚àí2z‚àí3z2, and he
gave the formula tn = P
k0 n2k/k!2 = P
k
¬°n
k
¬¢¬°n‚àík
k
¬¢
. He also discovered a
\memorable failure of induction" while examining these numbers: Although
3tn ‚àítn+1 is equal to Fn‚àí1(Fn‚àí1 + 1) for 0  n  8, this empirical law
mysteriously breaks down when n is 9 or more! George Andrews [12] has
explained the mystery by showing that the sum P
k[zn+10k] (1+z+z2)n can
be expressed as a closed form in terms of Fibonacci numbers.
H. S. Wilf observes that [zn] (a+bz+cz2)n= [zn] 1/f(z), where f(z) =
p
1 ‚àí2bz + (b2 ‚àí4ac)z2 (see [373, page 159]), and it follows that the coe-
cients satisfy
(n + 1)An+1 ‚àí(2n + 1)bAn + n(b2 ‚àí4ac)An‚àí1 = 0 .
The algorithm of Petkovsek [291] can be used to prove that this recurrence has
a closed form solution as a nite sum of hypergeometric terms if and only if
abc(b2 ‚àí4ac) = 0. Therefore in particular, the middle trinomial coecients
have no such closed form. The next step is presumably to extend this result
Give me Legen-
dre polynomials
and I'll give you a
closed form.
to a larger class of closed forms (including harmonic numbers and/or Stirling
numbers, for example).
7.57
(Paul Erd}os currently oers $500 for a solution.)
8.1
1
24 +
1
48 +
1
48 +
1
48 +
1
48 +
1
24 = 1
6. (In fact, we always get doubles
with probability 1
6 when at least one of the dice is fair.) Any two faces whose
sum is 7 have the same probability in distribution Pr1, so S = 7 has the same
probability as doubles.
8.2
There are 12 ways to specify the top and bottom cards and 50! ways
to arrange the others; so the probability is 12¬∑50!/52! = 12/(51¬∑52) =
1
17¬∑13 =
1
221.
8.3
1
10(3+2+¬∑ ¬∑ ¬∑+9+2) = 4.8; 1
9(32 +22 +¬∑ ¬∑ ¬∑+92 +22 ‚àí10(4.8)2) = 388
45 ,
which is approximately 8.6. The true mean and variance with a fair coin are
6 and 22, so Stanford had an unusually heads-up class. The corresponding
Princeton gures are 6.4 and 562
45 ‚âà12.5. (This distribution has Œ∫4 = 2974,
which is rather large. Hence the standard deviation of this variance estimate
when n = 10 is also rather large,
p
2974/10 + 2(22)2/9 ‚âà20.1 according to
exercise 54. One cannot complain that the students cheated.)

576 ANSWERS TO EXERCISES
8.4
This follows from (8.38) and (8.39), because F(z) = G(z)H(z).
(A
similar formula holds for all the cumulants, even though F(z) and G(z) may
have negative coecients.)
8.5
Replace H by p and T by q = 1‚àíp. If SA = SB = 1
2 we have p2qN = 1
2
and pq2N = 1
2q + 1
2; the solution is p = 1/œÜ2, q = 1/œÜ.
8.6
In this case Xjy has the same distribution as X, for all y, hence
E(XjY) = EX is constant and V
¬°
E(XjY)
¬¢
= 0. Also V(XjY) is constant and
equal to its expected value.
8.7
We have 1 = (p1+p2+¬∑ ¬∑ ¬∑+p6)2  6(p2
1+p2
2+¬∑ ¬∑ ¬∑+p2
6) by Chebyshev's
monotonic inequality of Chapter 2.
8.8
Let p = Pr(œâ ‚ààA ‚à©B), q = Pr(œâ /‚ààA), and r = Pr(œâ /‚ààB). Then
p + q + r = 1, and the identity to be proved is p = (p + r)(p + q) ‚àíqr.
8.9
This is true (subject to the obvious proviso that F and G are dened
on the respective ranges of X and Y), because
Pr
¬°
F(X) = f and G(Y) = g
¬¢
=
X
x‚ààF‚àí1(f)
y‚ààG‚àí1(g)
Pr(X = x and Y = y)
=
X
x‚ààF‚àí1(f)
y‚ààG‚àí1(g)
Pr(X = x) ¬∑ Pr(Y = y)
= Pr
¬°
F(X) = f
¬¢
¬∑ Pr
¬°
G(y) = g
¬¢
.
8.10
Two. Let x1 < x2 be medians; then 1  Pr(X  x1) + Pr(X  x2) 
1, hence equality holds.
(Some discrete distributions have no median ele-
ments. For example, let ‚Ñ¶be the set of all fractions of the form ¬±1/n, with
Pr(+1/n) = Pr(‚àí1/n) = œÄ2
12 n‚àí2.)
8.11
For example, let K = k with probability 4/(k + 1)(k + 2)(k + 3), for all
integers k  0. Then EK = 1, but E(K2) = ‚àû. (Similarly we can construct
random variables with nite cumulants through Œ∫m but with Œ∫m+1 = ‚àû.)
8.12
(a) Let pk = Pr(X = k). If 0 < x  1, we have Pr(X  r) = P
kr pk 
P
kr xk‚àírpk  P
k xk‚àírpk = x‚àírP(x). The other inequality has a similar
proof. (b) Let x = Œ±/(1‚àíŒ±) to minimize the right-hand side. (A more precise
estimate for the given sum is obtained in exercise 9.42.)
8.13
(Solution by Boris Pittel.)
Let us set Y = (X1 + ¬∑ ¬∑ ¬∑ + Xn)/n and
Z = (Xn+1 + ¬∑ ¬∑ ¬∑ + X2n)/n. Then
Pr
¬µ¬Ø¬Ø¬ØY + Z
2
‚àíŒ±
¬Ø¬Ø¬Ø 
¬Ø¬ØY ‚àíŒ±
¬Ø¬Ø
¬∂

A ANSWERS TO EXERCISES 577

Pr
¬µ¬Ø¬Ø¬ØY ‚àíŒ±
2
¬Ø¬Ø¬Ø +
¬Ø¬Ø¬ØZ ‚àíŒ±
2
¬Ø¬Ø¬Ø 
¬Ø¬ØY ‚àíŒ±
¬Ø¬Ø
¬∂
=
Pr
¬°
jZ ‚àíŒ±j  jY ‚àíŒ±j
¬¢

1
2 .
The last inequality is, in fact, `>' in any discrete probability distribution,
because Pr(Y = Z) > 0.
8.14
Mean(H) = p Mean(F) + q Mean(G); Var(H) = p Var(F) + q Var(G) +
pq
¬°
Mean(F)‚àíMean(G)
¬¢2. (A mixture is actually a special case of conditional
probabilities: Let Y be the coin, let XjH be generated by F(z), and let XjT
be generated by G(z). Then VX = EV(XjY) + VE(XjY), where EV(XjY) =
pV(XjH) + qV(XjT) and VE(XjY) is the variance of pzMean(F) + qzMean(G).)
8.15
By the chain rule, H‚Ä≤(z) = G‚Ä≤(z)F‚Ä≤¬°
G(z)
¬¢
; H‚Ä≤‚Ä≤(z) = G‚Ä≤‚Ä≤(z)F‚Ä≤¬°
G(z)
¬¢
+
G‚Ä≤(z)2F‚Ä≤‚Ä≤¬°
G(z)
¬¢
. Hence
Mean(H) = Mean(F) Mean(G) ;
Var(H) = Var(F) Mean(G)2 + Mean(F) Var(G) .
(The random variable corresponding to probability distribution H can be un-
derstood as follows: Determine a nonnegative integer n by distribution F;
then add the values of n independent random variables that have distribu-
tion G. The identity for variance in this exercise is a special case of (8.106),
when X has distribution H and Y has distribution F.)
8.16
ew(z‚àí1)/(1 ‚àíw).
8.17
Pr(Yn,p  m) = Pr(Yn,p + n  m + n) = probability that we need 
m + n tosses to obtain n heads = probability that m + n tosses yield  n
heads = Pr(Xm+n,p  n). Thus
X
km
¬µn + k ‚àí1
k
¬∂
pnqk =
X
kn
¬µm + n
k
¬∂
pkqm+n‚àík
=
X
km
¬µm + n
k
¬∂
pm+n‚àíkqk ;
and this is (5.19) with n = r, x = q, y = p.
8.18
(a) GX(z) = e¬µ(z‚àí1). (b) The mth cumulant is ¬µ, for all m  1. (The
case ¬µ = 1 is called F‚àûin (8.55).)
8.19
(a) GX1+X2(z) = GX1(z)GX2(z) = e(¬µ1+¬µ2)(z‚àí1). Hence the proba-
bility is e‚àí¬µ1‚àí¬µ2(¬µ1 + ¬µ2)n/n!; the sum of independent Poisson variables is
Poisson. (b) In general, if KmX denotes the mth cumulant of a random vari-
able X, we have Km(aX1 + bX2) = am(KmX1) + bm(KmX2), when a, b  0.
Hence the answer is 2m¬µ1 + 3m¬µ2.

578 ANSWERS TO EXERCISES
8.20
The general pgf will be G(z) = zm/F(z), where
F(z) = zm + (1 ‚àíz)
m
X
k=1
eA(k)[A(k) = A(k)]zm‚àík ,
F‚Ä≤(1) = m ‚àí
m
X
k=1
eA(k)[A(k) = A(k)] ,
F‚Ä≤‚Ä≤(1) = m(m ‚àí1) ‚àí2
m
X
k=1
(m ‚àík)eA(k)[A(k) = A(k)] .
8.21
This is P
n0 qn, where qn is the probability that the game between
Alice and Bill is still incomplete after n ips. Let pn be the probability that
the game ends at the nth ip; then pn + qn = qn‚àí1. Hence the average time
to play the game is P
n1 npn = (q0 ‚àíq1) + 2(q1 ‚àíq2) + 3(q2 ‚àíq3) + ¬∑ ¬∑ ¬∑ =
q0 + q1 + q2 + ¬∑ ¬∑ ¬∑ = N, since limn‚Üí‚àûnqn = 0.
Another way to establish this answer is to replace H and T by
1
2z.
Then the derivative of the rst equation in (8.78) tells us that N(1)+N‚Ä≤(1) =
N‚Ä≤(1) + S‚Ä≤
A(1) + S‚Ä≤
B(1).
By the way, N = 16
3 .
8.22
By denition we have V(XjY) = E(X2jY)‚àí
¬°
E(XjY)
¬¢2 and V
¬°
E(XjY)
¬¢
=
E
¬°
(E(XjY))2¬¢
‚àí
¬°
E
¬°
E(XjY)
¬¢¬¢2; hence E
¬°
V(XjY)
¬¢
+ V
¬°
E(XjY)
¬¢
= E
¬°
E(X2jY)
¬¢
‚àí
¬°
E
¬°
E(XjY)
¬¢¬¢2.
But E
¬°
E(XjY)
¬¢
= P
y Pr(Y = y)E(xjy) = P
x,y Pr(Y = y) √ó
Pr
¬°
(Xjy) = x
¬¢
= EX and E
¬°
E(X2jY)
¬¢
= E(X2), so the result is just VX.
8.23
Let ‚Ñ¶0 = f q , qqq qqq g2 and ‚Ñ¶1 = f q q , qqq , q qq q , qqqq q g2; and let ‚Ñ¶2 be the
other 16 elements of ‚Ñ¶. Then Pr11(œâ) ‚àíPr00(œâ) = +20
576 ,
‚àí7
576,
+2
576 according
as œâ ‚àà‚Ñ¶0, ‚Ñ¶1, ‚Ñ¶2. The events A must therefore be chosen with kj elements
from ‚Ñ¶j, where (k0, k1, k2) is one of the following: (0, 0, 0), (0, 2, 7), (0, 4, 14),
(1, 4, 4), (1, 6, 11), (2, 6, 1), (2, 8, 8), (2, 10, 15), (3, 10, 5), (3, 12, 12), (4, 12, 2),
(4, 14, 9), (4, 16, 16). For example, there are
¬°4
2
¬¢¬°16
6
¬¢¬°16
1
¬¢
events of type (2, 6, 1).
The total number of such events is [z0](1 + z20)4(1 + z‚àí7)16(1 + z2)16, which
turns out to be 1304872090. If we restrict ourselves to events that depend
on S only, we get 40 solutions S ‚ààA, where A = ‚àÖ, f 2
12, 4
10, 6
8g, f 2
12, 5, 9g,
f2, 12, 4
10, 6
8, 5, 9g, f2, 4, 6, 8, 10, 12g, f 3
11, 7, 5
9, 4, 10g, and the complements of
these sets. (Here the notation ` 2
12' means either 2 or 12 but not both.)
8.24
(a) Any one of the dice ends up in J's possession with probability
p = 1
6 +
¬° 5
6
¬¢2p; hence p =
6
11. Let q =
5
11. Then the pgf for J's total holdings
is (q + pz)2n+1, with mean (2n + 1)p and variance (2n + 1)pq, by (8.61).
(b)
¬°5
3
¬¢
p3q2 +
¬°5
4
¬¢
p4q +
¬°5
5
¬¢
p5 =
94176
161051 ‚âà.585.

A ANSWERS TO EXERCISES 579
8.25
The pgf for the current stake after n rolls is Gn(z), where
G0(z) = zA ;
Gn(z) = P6
k=1 Gn‚àí1(z2(k‚àí1)/5)/6 ,
for n > 0.
(The noninteger exponents cause no trouble.) It follows that Mean(Gn) =
This problem can
perhaps be solved
more easily without
generating functions
than with them.
Mean(Gn‚àí1), and Var(Gn) + Mean(Gn)2 = 22
15(Var(Gn‚àí1) + Mean(Gn‚àí1)2).
So the mean is always A, but the variance grows to
¬°¬° 22
15
¬¢n ‚àí1
¬¢
A2.
8.26
The pgf Fl,n(z) satises F‚Ä≤
l,n(z) = Fl,n‚àíl(z)/l; hence Mean(Fl,n) =
F‚Ä≤
l,n(1) = [n  l]/l and F‚Ä≤‚Ä≤
l,n(1) = [n  2l]/l2; the variance is easily computed.
(In fact, we have
Fl,n(z) =
X
0kn/l
1
k!
¬≥z ‚àí1
l
¬¥k
,
which approaches a Poisson distribution with mean 1/l as n ‚Üí‚àû.)
8.27
(n2Œ£3 ‚àí3nŒ£2Œ£1 + 2Œ£3
1)/n(n ‚àí1)(n ‚àí2) has the desired mean, where
Œ£k = Xk
1 + ¬∑ ¬∑ ¬∑ + Xk
n. This follows from the identities
EŒ£3 = n¬µ3 ;
E(Œ£2Œ£1) = n¬µ3 + n(n ‚àí1)¬µ2¬µ1 ;
E(Œ£3
1) = n¬µ3 + 3n(n ‚àí1)¬µ2¬µ1 + n(n ‚àí1)(n ‚àí2)¬µ3
1 .
Incidentally, the third cumulant is Œ∫3 = E
¬°
(X‚àíEX)3¬¢
, but the fourth cumulant
does not have such a simple expression; we have Œ∫4 = E
¬°
(X‚àíEX)4¬¢
‚àí3(VX)2.
8.28
(The exercise implicitly calls for p = q = 1
2, but the general answer is
given here for completeness.) Replace H by pz and T by qz, getting SA(z) =
p2qz3/(1 ‚àípz)(1 ‚àíqz)(1 ‚àípqz2) and SB(z) = pq2z3/(1 ‚àíqz)(1 ‚àípqz2). The
pgf for the conditional probability that Alice wins at the nth ip, given that
she wins the game, is
SA(z)
SA(1) = z3 ¬∑
q
1 ‚àípz ¬∑
p
1 ‚àíqz ¬∑
1 ‚àípq
1 ‚àípqz2 .
This is a product of pseudo-pgf's, whose mean is 3+p/q+q/p+2pq/(1‚àípq).
The formulas for Bill are the same but without the factor q/(1‚àípz), so Bill's
mean is 3 + q/p + 2pq/(1 ‚àípq). When p = q = 1
2, the answer in case (a) is
17
3 ; in case (b) it is 14
3 . Bill wins only half as often, but when he does win he
tends to win sooner. The overall average number of ips is 2
3 ¬∑ 17
3 + 1
3 ¬∑ 14
3 = 16
3 ,
agreeing with exercise 21. The solitaire game for each pattern has a waiting
time of 8.

580 ANSWERS TO EXERCISES
8.29
Set H = T = 1
2 in
1 + N(H + T) = N + SA + SB + SC
N HHTH = SA(HTH + 1) + SB(HTH + TH) + SC(HTH + TH)
N HTHH = SA(THH + H) + SB(THH + 1) + SC(THH)
N THHH = SA(HH) + SB(H) + SC
to get the winning probabilities. In general we will have SA + SB + SC = 1
and
SA(A:A) + SB(B:A) + SC(C:A) = SA(A:B) + SB(B:B) + SC(C:B)
= SA(A:B) + SB(B:C) + SC(C:C) .
In particular, the equations 9SA + 3SB + 3SC = 5SA + 9SB + SC = 2SA +
4SB + 8SC imply that SA = 16
52, SB = 17
52, SC = 19
52.
8.30
The variance of P(h1, . . . , hn; k)jk is the variance of the shifted bino-
mial distribution
¬°
(m‚àí1+z)/m
¬¢k‚àí1z, which is (k‚àí1)( 1
m)(1‚àí1
m) by (8.61).
Hence the average of the variance is Mean(S)(m ‚àí1)/m2. The variance of
the average is the variance of (k ‚àí1)/m, namely Var(S)/m2. According to
(8.106), the sum of these two quantities should be VP, and it is. Indeed, we
have just replayed the derivation of (8.96) in slight disguise. (See exercise 15.)
8.31
(a) A brute force solution would set up ve equations in ve unknowns:
A =
1
2zB + 1
2zE ;
B =
1
2zC ;
C = 1 + 1
2zB + 1
2zD ;
D =
1
2zC + 1
2zE ;
E =
1
2zD .
But positions C and D are equidistant from the goal, as are B and E, so we
can lump them together. If X = B + E and Y = C + D, there are now three
equations:
A =
1
2zX ;
X =
1
2zY ;
Y = 1 + 1
2zX + 1
2zY .
Hence A = z2/(4 ‚àí2z ‚àíz2); we have Mean(A) = 6 and Var(A) = 22. (Rings
a bell? In fact, this problem is equivalent to ipping a fair coin until get-
ting heads twice in a row: Heads means \advance toward the apple" and
tails means \go back.") (b) Chebyshev's inequality says that Pr(S  100) =
Pr
¬°
(S ‚àí6)2  942¬¢
 22/942 ‚âà.0025.
(c) The second tail inequality says
that Pr(S  100)  1/x98(4 ‚àí2x ‚àíx2) for all x  1, and we get the upper
bound 0.00000005 when x = (
‚àö
49001 ‚àí99)/100. (The actual probability is
approximately 0.0000000009, according to exercise 37.)

A ANSWERS TO EXERCISES 581
8.32
By symmetry, we can reduce each month's situation to one of four
possibilities:
\Toto, I have a
feeling we're not in
Kansas anymore."
|Dorothy
D, the states are diagonally opposite;
A, the states are adjacent and not Kansas;
K, the states are Kansas and one other;
S, the states are the same.
Considering the Markovian transitions, we get four equations
D = 1 + z( 2
9D +
2
12K)
A = z( 4
9A +
4
12K)
K = z( 4
9D + 4
9A +
4
12K)
S = z( 3
9D + 1
9A +
2
12K)
whose sum is D + K + A + S = 1 + z(D + A + K). The solution is
S =
81z ‚àí45z2 ‚àí4z3
243 ‚àí243z + 24z2 + 8z3 ,
but the simplest way to nd the mean and variance may be to write z = 1+w
and expand in powers of w, ignoring multiples of w2:
D =
27
16 + 1593
512 w + ¬∑ ¬∑ ¬∑ ;
A =
9
8 + 2115
256 w + ¬∑ ¬∑ ¬∑ ;
K =
15
8 + 2661
256 w + ¬∑ ¬∑ ¬∑ .
Now S‚Ä≤(1) = 27
16 + 9
8 + 15
8 = 75
16, and 1
2S‚Ä≤‚Ä≤(1) = 1593
512 + 2115
256 + 2661
256 = 11145
512 .
The mean is 75
16 and the variance is 105
4 . (Is there a simpler way?)
8.33
First answer: Clearly yes, because the hash values h1, . . . , hn are
independent. Second answer: Certainly no, even though the hash values h1,
. . . , hn are independent. We have Pr(Xj = 0) = Pn
k=1 sk
¬°
[j Ã∏= k](m‚àí1)/m
¬¢
=
(1 ‚àísj)(m ‚àí1)/m, but Pr(X1 = X2 = 0) = Pn
k=1 sk[k > 2](m ‚àí1)2/m2 =
(1 ‚àís1 ‚àís2)(m ‚àí1)2/m2 Ã∏= Pr(X1 = 0) Pr(X2 = 0).
8.34
Let [zn] Sm(z) be the probability that Gina has advanced < m steps
after taking n turns.
Then Sm(1) is her average score on a par-m hole;
[zm] Sm(z) is the probability that she loses such a hole against a steady player;
and 1 ‚àí[zm‚àí1] Sm(z) is the probability that she wins it. We have the recur-
rence
S0(z) = 0 ;
Sm(z) =
¬°
1 + pzSm‚àí2(z) + qzSm‚àí1(z)
¬¢
/(1 ‚àírz) ,
for m > 0.

582 ANSWERS TO EXERCISES
To solve part (a), it suces to compute the coecients for m, n  4; it is
convenient to replace z by 100w so that the computations involve nothing
but integers. We obtain the following tableau of coecients:
S0
0
0
0
0
0
S1
1
4
16
64
256
S2
1
95
744
4432
23552
S3
1
100
9065
104044
819808
S4
1
100
9975
868535
12964304
Therefore Gina wins with probability 1 ‚àí.868535 = .131465; she loses with
probability .12964304. (b) To nd the mean number of strokes, we compute
S1(1) =
25
24 ; S2(1) =
4675
2304 ; S3(1) =
667825
221184 ; S4(1) =
85134475
21233664 .
(Incidentally, S5(1) ‚âà4.9995; she wins with respect to both holes and strokes
on a par-5 hole, but loses either way when par is 3.)
8.35
The condition will be true for all n if and only if it is true for n = 1,
by the Chinese remainder theorem. One necessary and sucient condition is
the polynomial identity
¬°
p2+p4+p6 + (p1+p3+p5)w
¬¢¬°
p3+p6 + (p1+p4)z + (p2+p5)z2¬¢
= (p1wz + p2z2 + p3w + p4z + p5wz2 + p6) ,
but that just more-or-less restates the problem. A simpler characterization is
(p2 + p4 + p6)(p3 + p6) = p6 ,
(p1 + p3 + p5)(p2 + p5) = p5 ,
which checks only two of the coecients in the former product. The general
solution has three degrees of freedom: Let a0 + a1 = b0 + b1 + b2 = 1, and
put p1 = a1b1, p2 = a0b2, p3 = a1b0, p4 = a0b1, p5 = a1b2, p6 = a0b0.
8.36
(a)
q
q q
q q
qqq
qqq
q qq q .
(b) If the kth die has faces with
s1, . . . , s6 spots, let pk(z) = zs1 + ¬∑ ¬∑ ¬∑ + zs6. We want to nd such poly-
nomials with p1(z) . . . pn(z) = (z + z2 + z3 + z4 + z5 + z6)n.
The irre-
ducible factors of this polynomial with rational coecients are zn(z + 1)n √ó
(z2 + z + 1)n(z2 ‚àíz + 1)n; hence pk(z) must be of the form zak(z + 1)bk √ó
(z2 + z + 1)ck(z2 ‚àíz + 1)dk. We must have ak  1, since pk(0) = 0; and in
fact ak = 1, since a1 + ¬∑ ¬∑ ¬∑ + an = n. Furthermore the condition pk(1) = 6
implies that bk = ck = 1.
It is now easy to see that 0  dk  2, since
dk > 2 gives negative coecients. When d = 0 and d = 2, we get the two
dice in part (a); therefore the only solutions have k pairs of dice as in (a),
plus n ‚àí2k ordinary dice, for some k  1
2n.

A ANSWERS TO EXERCISES 583
8.37
The number of coin-toss sequences of length n is Fn‚àí1, for all n > 0,
because of the relation between domino tilings and coin ips. Therefore the
probability that exactly n tosses are needed is Fn‚àí1/2n, when the coin is fair.
Also qn = Fn+1/2n‚àí1, since P
kn Fkzk = (Fnzn + Fn‚àí1zn+1)/(1 ‚àíz ‚àíz2).
(A systematic solution via generating functions is, of course, also possible.)
8.38
When k faces have been seen, the task of rolling a new one is equivalent
to ipping coins with success probability pk = (m ‚àík)/m. Hence the pgf is
Ql‚àí1
k=0 pkz/(1 ‚àíqkz) = Ql‚àí1
k=0(m ‚àík)z/(m ‚àíkz). The mean is Pl‚àí1
k=0 p‚àí1
k
=
m(Hm ‚àíHm‚àíl); the variance is m2¬°
H(2)
m ‚àíH(2)
m‚àíl
¬¢
‚àím(Hm ‚àíHm‚àíl); and
equation (7.47) provides a closed form for the requested probability, namely
m‚àínm!
¬©n‚àí1
l‚àí1
¬™
/(m ‚àíl)!. (The problem discussed in this exercise is tradition-
ally called \coupon collecting.")
8.39
E(X) = P(‚àí1); V(X) = P(‚àí2) ‚àíP(‚àí1)2; E(ln X) = ‚àíP ‚Ä≤(0).
8.40
(a) We have Œ∫m = n
¬°
0!
¬©m
1
¬™
p ‚àí1!
¬©m
2
¬™
p2 + 2!
¬©m
3
¬™
p3 ‚àí¬∑ ¬∑ ¬∑
¬¢
, by (7.49).
Incidentally, the third cumulant is npq(q‚àíp) and the fourth is npq(1‚àí6pq).
The identity q+pet = (p+qe‚àít)et shows that fm(p) = (‚àí1)mfm(q)+[m = 1];
hence we can write fm(p) = gm(pq)(q ‚àíp)[m odd], where gm is a polynomial
of degree ‚åäm/2‚åã, whenever m > 1. (b) Let p = 1
2 and F(t) = ln( 1
2 + 1
2et).
Then P
m1 Œ∫mtm‚àí1/(m‚àí1)! = F‚Ä≤(t) = 1‚àí1/(et+1), and we can use exercise
6.23.
8.41
If G(z) is the pgf for a random variable X that assumes only positive
integer values, then
R1
0 G(z) dz/z = P
k1 Pr(X = k)/k = E(X‚àí1). If X is the
distribution of the number of ips to obtain n + 1 heads, we have G(z) =
¬°
pz/(1 ‚àíqz)
¬¢n+1 by (8.59), and the integral is
Z 1
0
¬µ
pz
1 ‚àíqz
¬∂n+1 dz
z
=
Z 1
0
wn dw
1 + (q/p)w
if we substitute w = pz/(1 ‚àíqz). When p = q the integrand can be written
(‚àí1)n¬°
(1+w)‚àí1‚àí1+w‚àíw2+¬∑ ¬∑ ¬∑+(‚àí1)nwn‚àí1¬¢
, so the integral is (‚àí1)n¬°
ln 2‚àí
1+ 1
2 ‚àí1
3 +¬∑ ¬∑ ¬∑+(‚àí1)n/n
¬¢
. We have H2n‚àíHn = ln 2‚àí1
4n‚àí1+ 1
16n‚àí2+O(n‚àí4)
by (9.28), and it follows that E(X‚àí1
n+1) = 1
2n‚àí1 ‚àí1
4n‚àí2 + O(n‚àí4).
8.42
Let Fn(z) and Gn(z) be pgf's for the number of employed evenings, if
the man is initially unemployed or employed, respectively. Let qh = 1 ‚àíph
and qf = 1 ‚àípf. Then F0(z) = G0(z) = 1, and
Fn(z) = phzGn‚àí1(z) + qhFn‚àí1(z) ;
Gn(z) = pfFn‚àí1(z) + qfzGn‚àí1(z) .

584 ANSWERS TO EXERCISES
The solution is given by the super generating function
G(w, z) =
X
n0
Gn(z)wn = A(w)/
¬°
1 ‚àízB(w)
¬¢
,
where B(w) = w
¬°
qf‚àí(qf‚àíph)w
¬¢
/(1‚àíqhw) and A(w) =
¬°
1‚àíB(w)
¬¢
/(1‚àíw).
Now P
n0 G‚Ä≤
n(1)wn = Œ±w/(1‚àíw)2 +Œ≤/(1‚àíw)‚àíŒ≤/
¬°
1‚àí(qf ‚àíph)w
¬¢
where
Œ± =
ph
ph + pf
,
Œ≤ = pf(qf ‚àíph)
(ph + pf)2 ;
hence G‚Ä≤
n(1) = Œ±n + Œ≤
¬°
1 ‚àí(qf ‚àíph)n¬¢
. (Similarly G‚Ä≤‚Ä≤
n(1) = Œ±2n2 + O(n), so
the variance is O(n).)
8.43
Gn(z) = P
k0
¬£n
k
¬§
zk/n! = zn/n!, by (6.11).
This is a product of
binomial pgf's, Qn
k=1
¬°
(k‚àí1+z)/k
¬¢
, where the kth has mean 1/k and variance
(k ‚àí1)/k2; hence Mean(Gn) = Hn and Var(Gn) = Hn ‚àíH(2)
n .
8.44
(a) The champion must be undefeated in n rounds, so the answer
is pn. (b,c) Players x1, . . . , x2k must be \seeded" (by chance) in distinct
subtournaments and they must win all 2k(n ‚àík) of their matches. The 2n
leaves of the tournament tree can be lled in 2n! ways; to seed it we have
2k!(2n‚àík)2k ways to place the top 2k players, and (2n ‚àí2k)! ways to place
the others.
Hence the probability is (2p)2k(n‚àík)¬±¬°2n
2k
¬¢
.
When k = 1 this
simplies to (2p2)n‚àí1/(2n ‚àí1). (d) Each tournament outcome corresponds
to a permutation of the players: Let y1 be the champ; let y2 be the other
nalist; let y3 and y4 be the players who lost to y1 and y2 in the seminals; let
(y5, . . . , y8) be those who lost respectively to (y1, . . . , y4) in the quarternals;
etc.
(Another proof shows that the rst round has 2n!/2n‚àí1! essentially
dierent outcomes; the second round has 2n‚àí1!/2n‚àí2!; and so on.) (e) Let Sk
be the set of 2k‚àí1 potential opponents of x2 in the kth round. The conditional
probability that x2 wins, given that x1 belongs to Sk, is
Pr(x1 plays x2)¬∑pn‚àí1(1 ‚àíp) + Pr(x1 doesn't play x2)¬∑pn
= pk‚àí1pn‚àí1(1 ‚àíp) + (1 ‚àípk‚àí1)pn .
The chance that x1 ‚ààSk is 2k‚àí1/(2n ‚àí1); summing on k gives the answer:
n
X
k=1
2k‚àí1
2n‚àí1
¬°
pk‚àí1pn‚àí1(1‚àíp)+(1‚àípk‚àí1)pn¬¢
= pn‚àí(2p)n‚àí1
2n‚àí1
pn‚àí1 .
(f) Each of the 2n! tournament outcomes has a certain probability of occur-
ring, and the probability that xj wins is the sum of these probabilities over
all (2n ‚àí1)! tournament outcomes in which xj is champion. Consider inter-
changing xj with xj+1 in all those outcomes; this change doesn't aect the

A ANSWERS TO EXERCISES 585
probability if xj and xj+1 never meet, but it multiplies the probability by
(1 ‚àíp)/p < 1 if they do meet.
8.45
(a) A(z) = 1/(3 ‚àí2z); B(z) = zA(z)2; C(z) = z2A(z)3. The pgf for
sherry when it's bottled is z3A(z)3, which is z3 times a negative binomial
distribution with parameters n = 3, p = 1
3. (b) Mean(A) = 2, Var(A) = 6;
Mean(B) = 5, Var(B) = 2 Var(A) = 12; Mean(C) = 8, Var(C) = 18. The
sherry is nine years old, on the average. The fraction that's 25 years old is
¬°‚àí3
22
¬¢
(‚àí2)223‚àí25 =
¬°24
22
¬¢
2223‚àí25 = 23¬∑( 2
3)24 ‚âà.00137. (c) Let the coecient
of wn be the pgf for the beginning of year n. Then
A =
¬°
1 + 1
3w/(1 ‚àíw)
¬¢
/(1 ‚àí2
3zw) ;
B =
¬°
1 + 1
3zwA
¬¢
/(1 ‚àí2
3zw) ;
C =
¬°
1 + 1
3zwB
¬¢
/(1 ‚àí2
3zw) .
Dierentiate with respect to z and set z = 1; this makes
C‚Ä≤ =
8
1 ‚àíw ‚àí
1/2
(1 ‚àí2
3w)3 ‚àí
3/2
(1 ‚àí2
3w)2 ‚àí
6
1 ‚àí2
3w .
The average age of bottled sherry n years after the process started is 1 greater
than the coecient of wn‚àí1, namely 9‚àí( 2
3)n(3n2+21n+72)/8. (This already
exceeds 8 when n = 11.)
8.46
(a) P(w, z) = 1 + 1
2
¬°
wP(w, z) + zP(w, z)
¬¢
=
¬°
1 ‚àí1
2(w + z)
¬¢‚àí1, hence
pmn = 2‚àím‚àín¬°m+n
n
¬¢
. (b) Pk(w, z) = 1
2(wk + zk)P(w, z); hence
pk,m,n = 2k‚àí1‚àím‚àín
¬µ¬µm + n ‚àík
m
¬∂
+
¬µm + n ‚àík
n
¬∂¬∂
.
(c) P
k kpk,n,n = Pn
k=0 k2k‚àí2n¬°2n‚àík
n
¬¢
= Pn
k=0(n ‚àík)2‚àín‚àík¬°n+k
n
¬¢
; this can
be summed using (5.20):
n
X
k=0
2‚àín‚àík
¬µ
(2n + 1)
¬µn + k
n
¬∂
‚àí(n + 1)
¬µn + 1 + k
n + 1
¬∂¬∂
= (2n + 1) ‚àí(n + 1)2‚àín
¬µ
2n+1 ‚àí2‚àín‚àí1
¬µ2n + 2
n + 1
¬∂¬∂
= 2n + 1
22n
¬µ2n
n
¬∂
‚àí1 .
(The methods of Chapter 9 show that this is 2
p
n/œÄ ‚àí1 + O(n‚àí1/2).)
8.47
After n irradiations there are n + 2 equally likely receptors. Let the
random variable Xn denote the number of diphages present; then Xn+1 =

586 ANSWERS TO EXERCISES
Xn + Yn, where Yn = ‚àí1 if the (n + 1)st particle hits a diphage receptor
(conditional probability 2Xn/(n + 2)) and Yn = +2 otherwise. Hence
EXn+1 = EXn + EYn = EXn ‚àí2EXn/(n+2) + 2
¬°
1 ‚àí2EXn/(n+2)
¬¢
.
The recurrence (n+2)EXn+1 = (n‚àí4)EXn+2n+4 can be solved if we multiply
both sides by the summation factor (n + 1)5; or we can guess the answer and
prove it by induction: EXn = (2n + 4)/7 for all n > 4. (Incidentally, there
are always two diphages and one triphage after ve steps, regardless of the
conguration after four.)
8.48
(a) The distance between frisbees (measured so as to make it an even
number) is either 0, 2, or 4 units, initially 4. The corresponding generating
functions A, B, C (where, say, [zn] C is the probability of distance 4 after n
throws) satisfy
A =
1
4zB ,
B =
1
2zB + 1
4zC ,
C = 1 + 1
4zB + 3
4zC .
It follows that A = z2/(16 ‚àí20z + 5z2) = z2/F(z), and we have Mean(A) =
2 ‚àíMean(F) = 12, Var(A) = ‚àíVar(F) = 100. (A more dicult but more
amusing solution factors A as follows:
A =
p1z
1 ‚àíq1z ¬∑
p2z
1 ‚àíq2z =
p2
p2 ‚àíp1
p1z
1 ‚àíq1z +
p1
p1 ‚àíp2
p2z
1 ‚àíq2z ,
where p1 = œÜ2/4 = (3 +
‚àö
5 )/8, p2 = bœÜ2/4 = (3 ‚àí
‚àö
5 )/8, and p1 + q1 =
p2 + q2 = 1. Thus, the game is equivalent to having two biased coins whose
heads probabilities are p1 and p2; ip the coins one at a time until they
have both come up heads, and the total number of ips will have the same
distribution as the number of frisbee throws. The mean and variance of the
waiting times for these two coins are respectively 6 ‚àì2
‚àö
5 and 50 ‚àì22
‚àö
5,
hence the total mean and variance are 12 and 100 as before.)
(b) Expanding the generating function in partial fractions makes it
possible to sum the probabilities. (Note that
‚àö
5/(4œÜ) + œÜ2/4 = 1, so the
answer can be stated in terms of powers of œÜ.) The game will last more than
n steps with probability 5(n‚àí1)/24‚àín(œÜn+2 ‚àíœÜ‚àín‚àí2); when n is even this is
5n/24‚àínFn+2. So the answer is 5504‚àí100F102 ‚âà.00006.
8.49
(a) If n > 0, PN(0, n) =
1
2[N = 0] + 1
4PN‚àí1(0, n) + 1
4PN‚àí1(1, n‚àí1);
PN(m, 0) is similar; PN(0, 0) = [N = 0]. Hence
gm,n =
1
4zgm‚àí1,n+1 + 1
2zgm,n + 1
4zgm+1,n‚àí1 ;
g0,n =
1
2 + 1
4zg0,n + 1
4g1,n‚àí1 ;
etc.
(b) g‚Ä≤
m,n = 1+ 1
4g‚Ä≤
m‚àí1,n+1+ 1
2g‚Ä≤
m,n+ 1
4g‚Ä≤
m+1,n‚àí1; g‚Ä≤
0,n = 1
2 + 1
4g‚Ä≤
0,n+ 1
4g‚Ä≤
1,n‚àí1;
etc.
By induction on m, we have g‚Ä≤
m,n = (2m + 1)g‚Ä≤
0,m+n ‚àí2m2 for all

A ANSWERS TO EXERCISES 587
m, n  0. And since g‚Ä≤
m,0 = g‚Ä≤
0,m, we must have g‚Ä≤
m,n = m + n + 2mn.
(c) The recurrence is satised when mn > 0, because
sin(2m + 1)Œ∏ =
1
cos2 Œ∏
¬µsin(2m ‚àí1)Œ∏
4
+ sin(2m + 1)Œ∏
2
+ sin(2m + 3)Œ∏
4
¬∂
;
this is a consequence of the identity sin(x ‚àíy) + sin(x + y) = 2 sin x cos y. So
all that remains is to check the boundary conditions.
8.50
(a) Using the hint, we get
3(1 ‚àíz)2 X
k
¬µ1/2
k
¬∂¬µ8
9z
¬∂k
(1 ‚àíz)2‚àík
= 3(1 ‚àíz)2 X
k
¬µ1/2
k
¬∂¬µ8
9
¬∂k X
j
¬µk + j ‚àí3
j
¬∂
zj+k ;
now look at the coecient of z3+l. (b) H(z) = 2
3 +
5
27z + 1
2
P
l0 c3+lz2+l.
(c) Let r =
p
(1 ‚àíz)(9 ‚àíz). One can show that (z‚àí3+r)(z‚àí3‚àír) = 4z, and
hence that
¬°
r/(1 ‚àíz) + 2
¬¢2 = (13 ‚àí5z + 4r)/(1 ‚àíz) =
¬°
9 ‚àíH(z)
¬¢
/
¬°
1 ‚àíH(z)
¬¢
.
(d) Evaluating the rst derivative at z = 1 shows that Mean(H) = 1. The
second derivative diverges at z = 1, so the variance is innite.
8.51
(a) Let Hn(z) be the pgf for your holdings after n rounds of play, with
H0(z) = z. The distribution for n rounds is
Hn+1(z) = Hn
¬°
H(z)
¬¢
,
so the result is true by induction (using the amazing identity of the preceding
problem). (b) gn = Hn(0)‚àíHn‚àí1(0) = 4/n(n+1)(n+ 2) = 4(n‚àí1)‚àí3. The
mean is 2, and the variance is innite. (c) The expected number of tickets you
buy on the nth round is Mean(Hn) = 1, by exercise 15. So the total expected
number of tickets is innite. (Thus, you almost surely lose eventually, and you
expect to lose after the second game, yet you also expect to buy an innite
number of tickets.) (d) Now the pgf after n games is Hn(z)2, and the method
of part (b) yields a mean of 16 ‚àí4
3œÄ2 ‚âà2.8. (The sum P
k1 1/k2 = œÄ2/6
shows up here.)
8.52
If œâ and œâ‚Ä≤ are events with Pr(œâ) > Pr(œâ‚Ä≤), then a sequence of
n independent experiments will encounter œâ more often than œâ‚Ä≤, with high
probability, because œâ will occur very nearly n Pr(œâ) times. Consequently,
as n ‚Üí‚àû, the probability approaches 1 that the median or mode of the

588 ANSWERS TO EXERCISES
values of X in a sequence of independent trials will be a median or mode of
the random variable X.
8.53
We can disprove the statement, even in the special case that each
variable is 0 or 1. Let p0 = Pr(X = Y = Z = 0), p1 = Pr(X = Y = Z = 0), . . . ,
p7 = Pr(X = Y = Z = 0), where X = 1 ‚àíX. Then p0 + p1 + ¬∑ ¬∑ ¬∑ + p7 = 1, and
the variables are independent in pairs if and only if we have
(p4 + p5 + p6 + p7)(p2 + p3 + p6 + p7) = p6 + p7 ,
(p4 + p5 + p6 + p7)(p1 + p3 + p5 + p7) = p5 + p7 ,
(p2 + p3 + p6 + p7)(p1 + p3 + p5 + p7) = p3 + p7 .
But Pr(X + Y = Z = 0) Ã∏= Pr(X + Y = 0) Pr(Z = 0) ‚áê‚áíp0 Ã∏= (p0 + p1)(p0 +
p2 + p4 + p6). One solution is
p0 = p3 = p5 = p6 = 1/4 ;
p1 = p2 = p4 = p7 = 0 .
This is equivalent to ipping two fair coins and letting X = (the rst coin
is heads), Y = (the second coin is heads), Z = (the coins dier). Another
example, with all probabilities nonzero, is
p0 = 4/64 ,
p1 = p2 = p4 = 5/64 ,
p3 = p5 = p6 = 10/64 ,
p7 = 15/64 .
For this reason we say that n variables X1, . . . , Xn are independent if
Pr(X1 = x1 and ¬∑ ¬∑ ¬∑ and Xn = xn) = Pr(X1 = x1) . . . Pr(Xn = xn) ;
pairwise independence isn't enough to guarantee this.
8.54
(See exercise 27 for notation.) We have
E(Œ£2
2) = n¬µ4 + n(n‚àí1)¬µ2
2 ;
E(Œ£2Œ£2
1) = n¬µ4 + 2n(n‚àí1)¬µ3¬µ1 + n(n‚àí1)¬µ2
2 + n(n‚àí1)(n‚àí2)¬µ2¬µ2
1 ;
E(Œ£4
1) = n¬µ4 + 4n(n‚àí1)¬µ3¬µ1 + 3n(n‚àí1)¬µ2
2
+ 6n(n‚àí1)(n‚àí2)¬µ2¬µ2
1 + n(n‚àí1)(n‚àí2)(n‚àí3)¬µ4
1 ;
it follows that V(bVX) = Œ∫4/n + 2Œ∫2
2/(n ‚àí1).
8.55
There are A =
1
17 ¬∑ 52! permutations with X = Y, and B =
16
17 ¬∑ 52!
permutations with X Ã∏= Y.
After the stated procedure, each permutation
with X = Y occurs with probability
1
17
¬±¬°
(1 ‚àí16
17p)A
¬¢
, because we return
to step S1 with probability
16
17p. Similarly, each permutation with X Ã∏= Y
occurs with probability
16
17(1 ‚àíp)
¬±¬°
(1 ‚àí16
17p)B
¬¢
.
Choosing p =
1
4 makes
Pr(X = x and Y = y) =
1
169 for all x and y. (We could therefore make two ips
of a fair coin and go back to S1 if both come up heads.)

A ANSWERS TO EXERCISES 589
8.56
If m is even, the frisbees always stay an odd distance apart and the
game lasts forever. If m = 2l + 1, the relevant generating functions are
Gm =
1
4zA1 ;
A1 =
1
2zA1 + 1
4zA2 ,
Ak =
1
4zAk‚àí1 + 1
2zAk + 1
4zAk+1 ,
for 1 < k < l,
Al =
1
4zAl‚àí1 + 3
4zAl + 1 .
(The coecient [zn] Ak is the probability that the distance between frisbees
is 2k after n throws.) Taking a clue from the similar equations in exercise 49,
we set z = 1/cos2 Œ∏ and A1 = X sin 2Œ∏, where X is to be determined. It follows
by induction (not using the equation for Al) that Ak = X sin 2kŒ∏. Therefore
we want to choose X such that
¬≥
1 ‚àí
3
4 cos2 Œ∏
¬¥
X sin 2lŒ∏ = 1 +
1
4 cos2 Œ∏ X sin(2l ‚àí2)Œ∏ .
It turns out that X = 2 cos2 Œ∏/ sin Œ∏ cos(2l + 1)Œ∏, hence
Gm =
cos Œ∏
cos mŒ∏ .
The denominator vanishes when Œ∏ is an odd multiple of œÄ/(2m); thus 1‚àíqkz is
a root of the denominator for 1  k  l, and the stated product representation
must hold. To nd the mean and variance we can write
Trigonometry wins
again. Is there a
connection with
pitching pennies
along the angles of
the m-gon?
Gm = (1 ‚àí1
2Œ∏2 +
1
24Œ∏4 ‚àí¬∑ ¬∑ ¬∑ )/(1 ‚àí1
2m2Œ∏2 +
1
24m4Œ∏4 ‚àí¬∑ ¬∑ ¬∑ )
= 1 + 1
2(m2 ‚àí1)Œ∏2 +
1
24(5m4 ‚àí6m2 + 1)Œ∏4 + ¬∑ ¬∑ ¬∑
= 1 + 1
2(m2 ‚àí1)(tan Œ∏)2 +
1
24(5m4 ‚àí14m2 + 9)(tan Œ∏)4 + ¬∑ ¬∑ ¬∑
= 1 + G‚Ä≤
m(1)(tan Œ∏)2 + 1
2G‚Ä≤‚Ä≤
m(1)(tan Œ∏)4 + ¬∑ ¬∑ ¬∑ ,
because tan2 Œ∏ = z ‚àí1 and tan Œ∏ = Œ∏ + 1
3Œ∏3 + ¬∑ ¬∑ ¬∑ . So we have Mean(Gm) =
1
2(m2‚àí1) and Var(Gm) = 1
6m2(m2‚àí1). (Note that this implies the identities
m2 ‚àí1
2
=
(m‚àí1)/2
X
k=1
1
pk
=
(m‚àí1)/2
X
k=1
¬≥
1
.
sin (2k ‚àí1)œÄ
2m
¬¥2
;
m2(m2 ‚àí1)
6
=
(m‚àí1)/2
X
k=1
¬≥
cot (2k ‚àí1)œÄ
2m
.
sin (2k ‚àí1)œÄ
2m
¬¥2
.
The third cumulant of this distribution is
1
30m2(m2 ‚àí1)(4m2 ‚àí1); but the
pattern of nice cumulant factorizations stops there. There's a much simpler

590 ANSWERS TO EXERCISES
way to derive the mean: We have Gm + A1 + ¬∑ ¬∑ ¬∑ + Al = z(A1 + ¬∑ ¬∑ ¬∑ + Al) + 1,
hence when z = 1 we have G‚Ä≤
m = A1 + ¬∑ ¬∑ ¬∑ + Al. Since Gm = 1 when z = 1,
an easy induction shows that Ak = 4k.)
8.57
We have A:A  2l‚àí1 and B:B < 2l‚àí1 + 2l‚àí3 and B:A  2l‚àí2, hence
B:B ‚àíB:A  A:A ‚àíA:B is possible only if A:B > 2l‚àí3. This means that
œÑ2 = œÑ3, œÑ1 = œÑ4, œÑ2 = œÑ5, . . . , œÑl‚àí3 = œÑl. But then A:A ‚âà2l‚àí1 + 2l‚àí4 + ¬∑ ¬∑ ¬∑ ,
A:B ‚âà2l‚àí3+2l‚àí6+¬∑ ¬∑ ¬∑ , B:A ‚âà2l‚àí2+2l‚àí5+¬∑ ¬∑ ¬∑ , and B:B ‚âà2l‚àí1+2l‚àí4+¬∑ ¬∑ ¬∑ ;
hence B:B ‚àíB:A is less than A:A ‚àíA:B after all. (Sharper results have been
obtained by Guibas and Odlyzko [168], who show that Bill's chances are
always maximized with one of the two patterns HœÑ1 . . . œÑl‚àí1 or TœÑ1 . . . œÑl‚àí1.
Bill's winning strategy is, in fact, unique; see the following exercise.)
8.58
(Solution by J. Csirik.)
If A is Hl or Tl, one of the two sequences
matches A and cannot be used. Otherwise let ^A = œÑ1 . . . œÑl‚àí1, H = H^A, and
T = T^A. It is not dicult to verify that H:A = T:A = ^A:^A, H:H + T:T =
2l‚àí1 + 2(^A:^A) + 1, and A:H + A:T = 1 + 2(A:A) ‚àí2l. Therefore the equation
H:H ‚àíH:A
A:A ‚àíA:H =
T:T ‚àíT:A
A:A ‚àíA:T
implies that both fractions equal
H:H ‚àíH:A + T:T ‚àíT:A
A:A ‚àíA:H + A:A ‚àíA:T = 2l‚àí1 + 1
2l ‚àí1
.
Then we can rearrange the original fractions to show that
H:H ‚àíH:A
T:T ‚àíT:A
= A:A ‚àíA:H
A:A ‚àíA:T
= p
q ,
where p ‚ä•q. And (p + 1)n gcd(2l‚àí1 + 1, 2l ‚àí1) = gcd(3, 2l ‚àí1); so we may
assume that l is even and that p = 1, q = 2. It follows that A:A ‚àíA:H =
(2l ‚àí1)/3 and A:A‚àíA:T = (2l+1‚àí2)/3, hence A:H‚àíA:T = (2l ‚àí1)/3  2l‚àí2.
We have A:H  2l‚àí2 if and only if A = (TH)l/2. But then H:H ‚àíH:A =
A:A ‚àíA:H, so 2l‚àí1 + 1 = 2l ‚àí1 and l = 2.
(Csirik [69] goes on to show that, when l  4, Alice can do no better
than to play HTl‚àí3H2. But even with this strategy, Bill wins with probability
nearly 2
3.)
8.59
According to (8.82), we want B:B ‚àíB:A > A:A ‚àíA:B. One solution is
A = TTHH, B = HHH.
8.60
(a) Two cases arise depending on whether hk Ã∏= hn or hk = hn:
G(w, z) = m ‚àí1
m
¬≥m ‚àí2 + w + z
m
¬¥k‚àí1
w
¬≥m ‚àí1 + z
m
¬¥n‚àík‚àí1
z

A ANSWERS TO EXERCISES 591
+ 1
m
¬≥m ‚àí1 + wz
m
¬¥k‚àí1
wz
¬≥m ‚àí1 + z
m
¬¥n‚àík‚àí1
z .
(b) We can either argue algebraically, taking partial derivatives of G(w, z)
with respect to w and z and setting w = z = 1; or we can argue com-
binatorially: Whatever the values of h1, . . . , hn‚àí1, the expected value of
P(h1, . . . , hn‚àí1, hn; n) is the same (averaged over hn), because the hash se-
quence (h1, . . . , hn‚àí1) determines a sequence of list sizes (n1, n2, . . . , nm)
such that the stated expected value is
¬°
(n1+1)+(n2+1)+¬∑ ¬∑ ¬∑+(nm+1)
¬¢
/m =
(n ‚àí1 + m)/m. Therefore the random variable EP(h1, . . . , hn; n) is indepen-
dent of (h1, . . . , hn‚àí1), hence independent of P(h1, . . . , hn; k).
8.61
If 1  k < l  n, the previous exercise shows that the coecient of
sksl in the variance of the average is zero. Therefore we need only consider
the coecient of s2
k, which is
X
1h1,...,hnm
P(h1, . . . , hn; k)2
mn
‚àí
¬µ
X
1h1,...,hnm
P(h1, . . . , hn; k)
mn
¬∂2
,
the variance of
¬°
(m ‚àí1 + z)/m
¬¢k‚àí1z; and this is (k ‚àí1)(m ‚àí1)/m2 as in
exercise 30.
8.62
The pgf Dn(z) satises the recurrence
D0(z) = z ;
Dn(z) = z2Dn‚àí1(z) + 2(1 ‚àíz3)D‚Ä≤
n‚àí1(z)/(n + 1) ,
for n > 0.
We can now derive the recurrence
D‚Ä≤‚Ä≤
n(1) = (n ‚àí11)D‚Ä≤‚Ä≤
n‚àí1(1)/(n + 1) + (8n ‚àí2)/7 ,
which has the solution
2
637(n+2)(26n+15) for all n  11 (regardless of initial
conditions). Hence the variance comes to 108
637(n + 2) for n  11.
8.63
(Another question asks if a given sequence of purported cumulants
comes from any distribution whatever; for example, Œ∫2 must be nonnegative,
and Œ∫4 + 3Œ∫2
2 = E
¬°
(X ‚àí¬µ)4¬¢
must be at least
¬°
E
¬°
(X ‚àí¬µ)2¬¢¬¢2 = Œ∫2
2, etc.
A necessary and sucient condition for this other problem was found by
Hamburger [6], [175].)
9.1
True if the functions are all positive. But otherwise we might have,
say, f1(n) = n3 + n2, f2(n) = ‚àín3, g1(n) = n4 + n, g2(n) = ‚àín4.
9.2
(a) We have nln n ‚â∫cn ‚â∫(ln n)n, since (ln n)2 ‚â∫n ln c ‚â∫n ln ln n.
(b) nln ln ln n ‚â∫(ln n)! ‚â∫nln ln n. (c) Take logarithms to show that (n!)! wins.
(d) F2
‚åàHn‚åâ‚âçœÜ2 ln n = n2 ln œÜ; HFn ‚àºn ln œÜ wins because œÜ2 = œÜ + 1 < e.

592 ANSWERS TO EXERCISES
9.3
Replacing kn by O(n) requires a dierent C for each k; but each O
stands for a single C. In fact, the context of this O requires it to stand for
a set of functions of two variables k and n.
It would be correct to write
Pn
k=1 kn = Pn
k=1 O(n2) = O(n3).
9.4
For example, limn‚Üí‚àûO(1/n) = 0. On the left, O(1/n) is the set of all
functions f(n) such that there are constants C and n0 with
¬Ø¬Øf(n)
¬Ø¬Ø  C/n for
all n  n0. The limit of all functions in that set is 0, so the left-hand side is
the singleton set f0g. On the right, there are no variables; 0 represents f0g, the
(singleton) set of all \functions of no variables, whose value is zero." (Can you
see the inherent logic here? If not, come back to it next year; you probably
can still manipulate O-notation even if you can't shape your intuitions into
rigorous formalisms.)
9.5
Let f(n) = n2 and g(n) = 1; then n is in the left set but not in the
right, so the statement is false.
9.6
n ln n + Œ≥n + O(‚àön ln n).
9.7
(1 ‚àíe‚àí1/n)‚àí1 = nB0 ‚àíB1 + B2n‚àí1/2! + ¬∑ ¬∑ ¬∑ = n + 1
2 + O(n‚àí1).
9.8
For example, let f(n) = ‚åän/2‚åã!2 + n, g(n) =
¬°
‚åàn/2‚åâ‚àí1
¬¢
! ‚åàn/2‚åâ! + n.
These functions, incidentally, satisfy f(n) = O
¬°
ng(n)
¬¢
and g(n) = O
¬°
nf(n)
¬¢
;
more extreme examples are clearly possible.
9.9
(For completeness, we assume that there is a side condition n ‚Üí‚àû,
so that two constants are implied by each O.) Every function on the left has
the form a(n) + b(n), where there exist constants m0, B, n0, C such that
¬Ø¬Øa(n)
¬Ø¬Ø  B
¬Ø¬Øf(n)
¬Ø¬Ø for n  m0 and
¬Ø¬Øb(n)
¬Ø¬Ø  C
¬Ø¬Øg(n)
¬Ø¬Ø for n  n0. Therefore the
left-hand function is at most max(B, C)
¬°¬Ø¬Øf(n)
¬Ø¬Ø+
¬Ø¬Øg(n)
¬Ø¬Ø¬¢
, for n  max(m0, n0),
so it is a member of the right side.
9.10
If g(x) belongs to the left, so that g(x) = cos y for some y, where
jyj  Cjxj for some C, then 0  1 ‚àíg(x) = 2 sin2(y/2)  1
2y2  1
2C2x2; hence
the set on the left is contained in the set on the right, and the formula is true.
9.11
The proposition is true. For if, say, jxj  jyj, we have (x + y)2  4y2.
Thus (x + y)2 = O(x2) + O(y2). Thus O(x + y)2 = O
¬°
(x + y)2¬¢
= O
¬°
O(x2) +
O(y2)
¬¢
= O
¬°
O(x2)
¬¢
+ O
¬°
O(y2)
¬¢
= O(x2) + O(y2).
9.12
1 + 2/n + O(n‚àí2) = (1 + 2/n)
¬°
1 + O(n‚àí2)/(1 + 2/n)
¬¢
by (9.26), and
1/(1 + 2/n) = O(1); now use (9.26).
9.13
nn¬°
1 + 2n‚àí1 + O(n‚àí2)
¬¢n = nn exp
¬°
n
¬°
2n‚àí1 + O(n‚àí2)
¬¢¬¢
= e2nn +
O(nn‚àí1).
9.14
It is nn+Œ≤ exp
¬°
(n + Œ≤)
¬°
Œ±/n ‚àí1
2Œ±2/n2 + O(n‚àí3)
¬¢¬¢
.

A ANSWERS TO EXERCISES 593
9.15
ln
¬°
3n
n,n,n
¬¢
= 3n ln 3 ‚àíln n + 1
2 ln 3 ‚àíln 2œÄ +
¬° 1
36 ‚àí1
4
¬¢
n‚àí1 + O(n‚àí3), so
(It's interesting
to compare this
formula with the
corresponding re-
sult for the middle
binomial coecient,
exercise 9.60.)
the answer is
33n+1/2
2œÄn
¬°
1 ‚àí2
9n‚àí1 +
2
81n‚àí2 + O(n‚àí3)
¬¢
.
9.16
If l is any integer in the range a  l < b we have
Z 1
0
B(x)f(l + x) dx =
Z 1
1/2
B(x)f(l + x) dx ‚àí
Z 1/2
0
B(1 ‚àíx)f(l + x) dx
=
Z 1
1/2
B(x)
¬°
f(l + x) ‚àíf(l + 1 ‚àíx)
¬¢
dx .
Since l + x  l + 1 ‚àíx when x  1
2, this integral is positive when f(x) is
nondecreasing.
9.17
P
m0 Bm( 1
2)zm/m! = zez/2/(ez ‚àí1) = z/(ez/2 ‚àí1) ‚àíz/(ez ‚àí1).
9.18
The text's derivation for the case Œ± = 1 generalizes to give
bk(n) = 2(2n+1/2)Œ±
(2œÄn)Œ±/2 e‚àík2Œ±/n , ck(n) = 22nŒ± n‚àí(1+Œ±)/2+3œµe‚àík2Œ±/n ;
the answer is 22nŒ±(œÄn)(1‚àíŒ±)/2Œ±‚àí1/2¬°
1 + O(n‚àí1/2+3œµ)
¬¢
.
9.19
H10 = 2.928968254 ‚âà2.928968256; 10! = 3628800 ‚âà3628712.4; B10 =
0.075757576 ‚âà0.075757494; œÄ(10) = 4 ‚âà10.0017845; e0.1 = 1.10517092 ‚âà
1.10517083; ln 1.1 = 0.0953102 ‚âà0.0953083; 1.1111111 ‚âà1.1111000; 1.10.1 =
1.00957658 ‚âà1.00957643. (The approximation to œÄ(n) gives more signicant
gures when n is larger; for example, œÄ(109) = 50847534 ‚âà50840742.)
9.20
(a) Yes; the left side is o(n) while the right side is equivalent to O(n).
(b) Yes; the left side is e ¬∑ eO(1/n). (c) No; the left side is about ‚àön times the
bound on the right.
9.21
We have Pn = m = n
¬°
ln m ‚àí1 ‚àí1/ln m + O(1/log n)2¬¢
, where
ln m = ln n + ln ln m ‚àí1/ln n + ln ln n/(ln n)2 + O(1/log n)2 ;
ln ln m = ln ln n + ln ln n
ln n
‚àí(ln ln n)2
2(ln n)2 + ln ln n
(ln n)2 + O(1/log n)2 .
It follows that
Pn = n
¬µ
ln n + ln ln n ‚àí1
+ ln ln n ‚àí2
ln n
‚àí
1
2(ln ln n)2 ‚àí3 ln ln n
(ln n)2
+ O(1/log n)2
¬∂
.

594 ANSWERS TO EXERCISES
(A slightly better approximation replaces this O(1/log n)2 by the quantity
What does a drown-
ing analytic number
theorist say?
log log log log . . .
‚àí5/(ln n)2 + O(log log n/log n)3; then we estimate P1000000 ‚âà15483612.4.)
9.22
Replace O(n‚àí2k) by ‚àí1
12n‚àí2k + O(n‚àí4k) in the expansion of Hnk;
this replaces O
¬°
Œ£3(n2)
¬¢
by ‚àí1
12Œ£3(n2) + O
¬°
Œ£3(n4)
¬¢
in (9.53). We have
Œ£3(n) =
3
4n‚àí1 +
5
36n‚àí2 + O(n‚àí3) ,
hence the term O(n‚àí2) in (9.54) can be replaced by ‚àí19
144n‚àí2 + O(n‚àí3).
9.23
nhn = P
0k<n hk/(n‚àík)+2cHn/(n+1)(n+2). Choose c = eœÄ2/6 =
P
k0 gk so that P
k0 hk = 0 and hn = O(log n)/n3. The expansion of
P
0k<n hk/(n ‚àík) as in (9.60) now yields nhn = 2cHn/(n + 1)(n + 2) +
O(n‚àí2), hence
gn = eœÄ2/6
¬µn + 2 ln n + O(1)
n3
¬∂
.
9.24
(a) If P
k0
¬Ø¬Øf(k)
¬Ø¬Ø < ‚àûand if f(n ‚àík) = O
¬°
f(n)
¬¢
when 0  k  n/2,
we have
n
X
k=0
akbn‚àík =
n/2
X
k=0
O
¬°
f(k)
¬¢
O
¬°
f(n)
¬¢
+
n
X
k=n/2
O
¬°
f(n)
¬¢
O
¬°
f(n ‚àík)
¬¢
,
which is 2O
¬°
f(n) P
k0
¬Ø¬Øf(k)
¬Ø¬Ø¬¢
, so this case is proved. (b) But in this case if
an = bn = Œ±‚àín, the convolution (n + 1)Œ±‚àín is not O(Œ±‚àín).
9.25
Sn
¬±¬°3n
n
¬¢
= Pn
k=0 nk/(2n + 1)k. We may restrict the range of summa-
tion to 0  k  (log n)2, say. In this range nk = nk¬°
1 ‚àí
¬°k
2
¬¢
/n + O(k4/n2)
¬¢
and (2n + 1)k = (2n)k¬°
1 +
¬°k+1
2
¬¢
/2n + O(k4/n2)
¬¢
, so the summand is
1
2k
¬µ
1 ‚àí3k2 ‚àík
4n
+ O
¬≥ k4
n2
¬¥¬∂
.
Hence the sum over k is 2‚àí4/n+O(1/n2). Stirling's approximation can now
be applied to
¬°3n
n
¬¢
= (3n)!/(2n)! n!, proving (9.2).
9.26
The minimum occurs at a term B2m/(2m)(2m‚àí1)n2m‚àí1 where 2m ‚âà
2œÄn+ 3
2, and this term is approximately equal to 1/(œÄe2œÄn‚àön ). The absolute
error in ln n! is therefore too large to determine n! exactly by rounding to an
integer, when n is greater than about e2œÄ+1.
9.27
We may assume that Œ± Ã∏= ‚àí1. Let f(x) = xŒ±; the answer is
n
X
k=1
kŒ± = CŒ±+ nŒ±+1
Œ±+1 + nŒ±
2 +
m
X
k=1
B2k
2k
¬µ
Œ±
2k‚àí1
¬∂
nŒ±‚àí2k+1+O(nŒ±‚àí2m‚àí1) .

A ANSWERS TO EXERCISES 595
(The constant CŒ± turns out to be Œ∂(‚àíŒ±), which is in fact dened by this
In particular,
Œ∂(0) = ‚àí1/2,
and Œ∂(‚àín) =
‚àíBn+1/(n+1)
for integer n > 0.
formula when Œ± > ‚àí1.)
9.28
In general, suppose f(x) = xŒ± ln x in Euler's summation formula, when
Œ± Ã∏= ‚àí1. Proceeding as in the previous exercise, we nd
n
X
k=1
kŒ± ln k = C‚Ä≤
Œ± + nŒ±+1 ln n
Œ± + 1
‚àí
nŒ±+1
(Œ± + 1)2 + nŒ± ln n
2
+
m
X
k=1
B2k
2k
¬µ
Œ±
2k ‚àí1
¬∂
nŒ±‚àí2k+1(ln n + HŒ± ‚àíHŒ±‚àí2k+1)
+ O(nŒ±‚àí2m‚àí1 log n) ;
the constant C‚Ä≤
Œ± can be shown [74, ¬ß3.7] to be ‚àíŒ∂‚Ä≤(‚àíŒ±). (The log n factor
in the O term can be removed when Œ± is a positive integer  2m; in that
case we also replace the kth term of the right sum by B2kŒ±! (2k ‚àí2 ‚àíŒ±)! √ó
(‚àí1)Œ±nŒ±‚àí2k+1/(2k)! when Œ± < 2k ‚àí1.) To solve the stated problem, we let
Œ± = 1 and m = 1, taking the exponential of both sides to get
Qn = A ¬∑ nn2/2+n/2+1/12e‚àín2/4¬°
1 + O(n‚àí2)
¬¢
,
where A = e1/12‚àíŒ∂ ‚Ä≤(‚àí1) ‚âà1.2824271291 is \Glaisher's constant."
9.29
Let f(x) = x‚àí1 ln x. A slight modication of the calculation in the
previous exercise gives
n
X
k=1
ln k
k
= (ln n)2
2
+ Œ≥1 + ln n
2n
‚àí
m
X
k=1
B2k
2k n‚àí2k(ln n ‚àíH2k‚àí1) + O(n‚àí2m‚àí1 log n) ,
where Œ≥1 ‚âà‚àí0.07281584548367672486 is a \Stieltjes constant" (see the an-
swer to 9.57). Taking exponentials gives
eŒ≥1p
n ln n
¬µ
1 + ln n
2n + O
¬≥log n
n
¬¥2¬∂
.
9.30
Let g(x) = xle‚àíx2 and f(x) = g(x/‚àön ). Then n‚àíl/2 P
k0 kle‚àík2/n
is
Z ‚àû
0
f(x) dx ‚àí
m
X
k=1
Bk
k! f(k‚àí1)(0) ‚àí(‚àí1)m
Z ‚àû
0
Bm
¬°
fxg
¬¢
m!
f(m)(x) dx
= n1/2
Z ‚àû
0
g(x) dx ‚àí
m
X
k=1
Bk
k! n(k‚àí1)/2g(k‚àí1)(0) + O(n‚àím/2) .

596 ANSWERS TO EXERCISES
Since g(x) = xl ‚àíx2+l/1! + x4+l/2! ‚àíx6+l/3! + ¬∑ ¬∑ ¬∑ , the derivatives g(m)(x)
obey a simple pattern, and the answer is
1
2n(l+1)/2 Œì
¬≥l + 1
2
¬¥
‚àí
Bl+1
(l + 1)! 0! + Bl+3n‚àí1
(l + 3)! 1! ‚àíBl+5n‚àí2
(l + 5)! 2! + O(n‚àí3) .
9.31
The somewhat surprising identity 1/(cm‚àík + cm) + 1/(cm+k + cm) =
1/cm makes the terms for 0  k  2m sum to (m + 1
2)/cm. The remaining
terms are
X
k1
1
c2m+k + cm =
X
k1
¬µ
1
c2m+k ‚àí
1
c3m+2k +
1
c4m+3k ‚àí¬∑ ¬∑ ¬∑
¬∂
=
1
c2m+1 ‚àíc2m ‚àí
1
c3m+2 ‚àíc3m + ¬∑ ¬∑ ¬∑ ,
and this series can be truncated at any desired point, with an error not ex-
ceeding the rst omitted term.
9.32
H(2)
n
= œÄ2/6 ‚àí1/n + O(n‚àí2) by Euler's summation formula, since we
know the constant; and Hn is given by (9.89). So the answer is
The world's top
three constants,
(e, œÄ, Œ≥), all appear
in this answer.
neŒ≥+œÄ2/6¬°
1 ‚àí1
2n‚àí1 + O(n‚àí2)
¬¢
.
9.33
We have nk/nk = 1 ‚àík(k ‚àí1)n‚àí1 + 1
2k2(k ‚àí1)2n‚àí2 + O(k6n‚àí3);
dividing by k! and summing over k  0 yields e ‚àíen‚àí1 + 7
2en‚àí2 + O(n‚àí3).
9.34
A = eŒ≥; B = 0; C = ‚àí1
2eŒ≥; D = 1
2eŒ≥(1‚àíŒ≥); E = 1
8eŒ≥; F =
1
12eŒ≥(3Œ≥+1).
9.35
Since 1/k
¬°
ln k + O(1)
¬¢
= 1/k ln k + O
¬°
1/k(log k)2¬¢
, the given sum
is Pn
k=2 1/k ln k + O(1).
The remaining sum is ln ln n + O(1) by Euler's
summation formula.
9.36
This works out beautifully with Euler's summation formula:
Sn =
X
0k<n
1
n2 + k2 +
1
n2 + x2
¬Ø¬Ø¬Ø¬Ø
n
0
=
Z n
0
dx
n2 + x2 + 1
2
1
n2 + x2
¬Ø¬Ø¬Ø¬Ø
n
0
+ B2
2!
‚àí2x
(n2 + x2)2
¬Ø¬Ø¬Ø¬Ø
n
0
+ O(n‚àí5) .
Hence Sn = 1
4œÄn‚àí1 ‚àí1
4n‚àí2 ‚àí
1
24n‚àí3 + O(n‚àí5).
9.37
This is
X
k,q1
(n ‚àíqk)
¬£
n/(q + 1) < k  n/q
¬§

A ANSWERS TO EXERCISES 597
= n2 ‚àí
X
q1
q
¬µ¬µ‚åän/q‚åã+ 1
2
¬∂
‚àí
¬µ‚åän/(q + 1)‚åã+ 1
2
¬∂¬∂
= n2 ‚àí
X
q1
¬µ‚åän/q‚åã+ 1
2
¬∂
.
The remaining sum is like (9.55) but without the factor ¬µ(q).
The same
method works here as it did there, but we get Œ∂(2) in place of 1/Œ∂(2), so the
answer comes to
¬°
1 ‚àíœÄ2
12
¬¢
n2 + O(n log n).
9.38
Replace k by n ‚àík and let ak(n) = (n ‚àík)n‚àík¬°n
k
¬¢
. Then ln ak(n) =
n ln n ‚àíln k! ‚àík + O(kn‚àí1), and we can use tail-exchange with bk(n) =
nne‚àík/k!, ck(n) = kbk(n)/n, Dn = f k | k  ln n g, to get Pn
k=0 ak(n) =
nne1/e¬°
1 + O(n‚àí1)
¬¢
.
9.39
Tail-exchange with bk(n) = (ln n ‚àík/n ‚àí1
2k2/n2)(ln n)k/k!, ck(n) =
n‚àí3(ln n)k+3/k!, Dn = f k | 0  k  10 ln n g. When k ‚âà10 ln n we have
k! ‚âç
‚àö
k (10/e)k(ln n)k, so the kth term is O(n‚àí10 ln(10/e) log n). The answer
is n ln n ‚àíln n ‚àí1
2(ln n)(1 + ln n)/n + O
¬°
n‚àí2(log n)3¬¢
.
9.40
Combining terms two by two, we nd that Hm
2k ‚àí(H2k ‚àí
1
2k)m =
m
2kHm‚àí1
2k
plus terms whose sum over all k  1 is O(1). Suppose n is even.
Euler's summation formula implies that
n/2
X
k=1
Hm‚àí1
2k
k
=
n/2
X
k=1
(ln 2eŒ≥k)m‚àí1+O(1/k)
k
+ O(1)
= (ln eŒ≥n)m
m
+ O(1) ;
hence the sum is 1
2Hm
n + O(1). In general the answer is 1
2(‚àí1)nHm
n + O(1).
9.41
Let Œ± = bœÜ/œÜ = ‚àíœÜ‚àí2. We have
n
X
k=1
ln Fk =
n
X
k=1
¬°
ln œÜk‚àíln
‚àö
5+ln(1‚àíŒ±k)
¬¢
= n(n+1)
2
ln œÜ‚àín
2 ln 5+
X
k1
ln(1‚àíŒ±k)‚àí
X
k>n
ln(1‚àíŒ±k) .
The latter sum is P
k>n O(Œ±k) = O(Œ±n). Hence the answer is
œÜn(n+1)/25‚àín/2C + O(œÜn(n‚àí3)/25‚àín/2) ,
where C = (1 ‚àíŒ±)(1 ‚àíŒ±2)(1 ‚àíŒ±3) . . . ‚âà1.226742.

598 ANSWERS TO EXERCISES
9.42
The hint follows since
¬° n
k‚àí1
¬¢¬±¬°n
k
¬¢
=
k
n‚àík+1 
Œ±n
n‚àíŒ±n+1 <
Œ±
1‚àíŒ±. Let
m = ‚åäŒ±n‚åã= Œ±n ‚àíœµ. Then
¬µn
m
¬∂
<
X
km
¬µn
k
¬∂
<
¬µn
m
¬∂¬µ
1 +
Œ±
1 ‚àíŒ± +
¬≥
Œ±
1 ‚àíŒ±
¬¥2
+ ¬∑ ¬∑ ¬∑
¬∂
=
¬µn
m
¬∂ 1 ‚àíŒ±
1 ‚àí2Œ± .
So P
kŒ±n
¬°n
k
¬¢
=
¬°n
m
¬¢
O(1), and it remains to estimate
¬°n
m
¬¢
. By Stirling's ap-
proximation we have ln
¬°n
m
¬¢
= ‚àí1
2 ln n‚àí(Œ±n‚àíœµ) ln(Œ±‚àíœµ/n)‚àí
¬°
(1‚àíŒ±)n+œµ
¬¢
√ó
ln(1 ‚àíŒ± + œµ/n) + O(1) = ‚àí1
2 ln n ‚àíŒ±n ln Œ± ‚àí(1 ‚àíŒ±)n ln(1 ‚àíŒ±) + O(1).
9.43
The denominator has factors of the form z ‚àíœâ, where œâ is a complex
root of unity. Only the factor z ‚àí1 occurs with multiplicity 5. Therefore by
(7.31), only one of the roots has a coecient ‚Ñ¶(n4), and the coecient is
c = 5/(5!¬∑1¬∑5¬∑10¬∑25¬∑50) = 1/1500000.
9.44
Stirling's approximation says that ln
¬°
x‚àíŒ±x!/(x ‚àíŒ±)!
¬¢
has an asymp-
totic series
‚àíŒ± ‚àí(x + 1
2 ‚àíŒ±) ln(1 ‚àíŒ±/x) ‚àíB2
2 ¬∑ 1
¬°
x‚àí1 ‚àí(x ‚àíŒ±)‚àí1¬¢
‚àíB4
4 ¬∑ 3
¬°
x‚àí3 ‚àí(x ‚àíŒ±)‚àí3¬¢
‚àí¬∑ ¬∑ ¬∑
in which each coecient of x‚àík is a polynomial in Œ±. Hence x‚àíŒ±x!/(x‚àíŒ±)! =
c0(Œ±) + c1(Œ±)x‚àí1 + ¬∑ ¬∑ ¬∑ + cn(Œ±)x‚àín + O(x‚àín‚àí1) as x ‚Üí‚àû, where cn(Œ±) is a
polynomial in Œ±. We know that cn(Œ±) =
¬£
Œ±
Œ±‚àín
¬§
(‚àí1)n whenever Œ± is an integer,
and
¬£
Œ±
Œ±‚àín
¬§
is a polynomial in Œ± of degree 2n; hence cn(Œ±) =
¬£
Œ±
Œ±‚àín
¬§
(‚àí1)n for
all real Œ±. In other words, the asymptotic formulas
(See [220] for fur-
ther discussion.)
xŒ± =
n
X
k=0
¬∑
Œ±
Œ± ‚àík
¬∏
(‚àí1)kxŒ±‚àík + O(xŒ±‚àín‚àí1) ,
xŒ± =
n
X
k=0
¬∑
Œ±
Œ± ‚àík
¬∏
xŒ±‚àík + O(xŒ±‚àín‚àí1)
generalize equations (6.13) and (6.11), which hold in the all-integer case.
9.45
Let the partial quotients of Œ± be ‚ü®a1, a2, . . . ‚ü©, and let Œ±m be the con-
tinued fraction 1/(am + Œ±m+1) for m  1.
Then D(Œ±, n) = D(Œ±1, n) <
D
¬°
Œ±2, ‚åäŒ±1n‚åã
¬¢
+ a1 + 3 < D
¬°
Œ±3, ‚åäŒ±2‚åäŒ±1n‚åã‚åã
¬¢
+ a1 + a2 + 6 < ¬∑ ¬∑ ¬∑ < D
¬°
Œ±m+1,
‚åäŒ±m‚åä. . . ‚åäŒ±1n‚åã. . .‚åã‚åã
¬¢
+a1 +¬∑ ¬∑ ¬∑+am +3m < Œ±1 . . . Œ±m n+a1 +¬∑ ¬∑ ¬∑+am +3m,

A ANSWERS TO EXERCISES 599
for all m. Divide by n and let n ‚Üí‚àû; the limit is less than Œ±1 . . . Œ±m for
all m. Finally we have
Œ±1 . . . Œ±m =
1
K(a1, . . . , am‚àí1, am + Œ±m) <
1
Fm+1
.
9.46
For convenience we write just m instead of m(n). By Stirling's ap-
proximation, the maximum value of kn/k! occurs when k ‚âàm ‚âàn/ln n, so
we replace k by m + k and nd that
ln (m + k)n
(m + k)!
= n ln m ‚àím ln m + m ‚àíln 2œÄm
2
‚àí(m + n)k2
2m2
+ O(k3m‚àí2 log n) .
Actually we want to replace k by ‚åäm‚åã+k; this adds a further O(km‚àí1 log n).
The tail-exchange method with jkj  m1/2+œµ now allows us to sum on k,
giving a fairly sharp asymptotic estimate in terms of the quantity Œò in (9.93):
A truly Bell-shaped
summand.
œñn = em‚àí1mn‚àím
‚àö
2œÄm
¬°
Œò2m2/(m+n) + O(1)
¬¢
= em‚àín‚àí1/2mn
r
m
m + n
¬µ
1 + O
¬≥log n
n1/2
¬¥¬∂
.
The requested formula follows, with relative error O(log log n/log n).
9.47
Let logm n = l + Œ∏, where 0  Œ∏ < 1. The oor sum is l(n + 1) + 1 ‚àí
(ml+1 ‚àí1)/(m ‚àí1); the ceiling sum is (l + 1)n ‚àí(ml+1 ‚àí1)/(m ‚àí1); the
exact sum is (l + Œ∏)n ‚àín/ln m + O(log n). Ignoring terms that are o(n), the
dierence between ceiling and exact is
¬°
1‚àíf(Œ∏)
¬¢
n, and the dierence between
exact and oor is f(Œ∏)n, where
f(Œ∏) = m1‚àíŒ∏
m ‚àí1 + Œ∏ ‚àí
1
ln m .
This function has maximum value f(0) = f(1) = m/(m ‚àí1) ‚àí1/ln m, and its
minimum value is ln ln m/ln m + 1 ‚àí
¬°
ln(m ‚àí1)
¬¢
/ln m. The ceiling value is
closer when n is nearly a power of m, but the oor value is closer when Œ∏ lies
somewhere between 0 and 1.
9.48
Let dk = ak + bk, where ak counts digits to the left of the decimal
point. Then ak = 1 + ‚åälog Hk‚åã= log log k + O(1), where `log' denotes log10.
To estimate bk, let us look at the number of decimal places necessary to
distinguish y from nearby numbers y ‚àíœµ and y + œµ‚Ä≤: Let Œ¥ = 10‚àíb be the

600 ANSWERS TO EXERCISES
length of the interval of numbers that round to ^y. We have jy ‚àí^yj  1
2Œ¥;
also y ‚àíœµ < ^y ‚àí1
2Œ¥ and y + œµ‚Ä≤ > ^y + 1
2Œ¥. Therefore œµ + œµ‚Ä≤ > Œ¥. And if
Œ¥ < min(œµ, œµ‚Ä≤), the rounding does distinguish ^y from both y ‚àíœµ and y + œµ‚Ä≤.
Hence 10‚àíbk < 1/(k ‚àí1) + 1/k and 101‚àíbk  1/k; we have bk = log k +
O(1). Finally, therefore, Pn
k=1 dk = Pn
k=1(log k + log log k + O(1)), which is
n log n + n log log n + O(n) by Euler's summation formula.
9.49
We have Hn > ln n+Œ≥+ 1
2n‚àí1‚àí1
12n‚àí2 = f(n), where f(x) is increasing
for all x > 0; hence if n  eŒ±‚àíŒ≥ we have Hn  f(eŒ±‚àíŒ≥) > Œ±. Also Hn‚àí1 <
ln n + Œ≥ ‚àí1
2n‚àí1 = g(n), where g(x) is increasing for all x > 0; hence if
n  eŒ±‚àíŒ≥ we have Hn‚àí1  g(eŒ±‚àíŒ≥) < Œ±. Therefore Hn‚àí1  Œ±  Hn implies
that eŒ±‚àíŒ≥ + 1 > n > eŒ±+Œ≥ ‚àí1. (Sharper results have been obtained by Boas
and Wrench [33].)
9.50
(a) The expected return is P
1kN k/(k2H(2)
N ) = HN/H(2)
N , and we
want the asymptotic value to O(N‚àí1):
ln N + Œ≥ + O(N‚àí1)
œÄ2/6 ‚àíN‚àí1 + O(N‚àí2) = 6 ln 10
œÄ2
n + 6Œ≥
œÄ2 + 36 ln 10
œÄ4
n
10n + O(10‚àín) .
The coecient (6 ln 10)/œÄ2 ‚âà1.3998 says that we expect about 40% prot.
(b) The probability of prot is P
n<kN 1/(k2H(2)
N ) = 1 ‚àíH(2)
n /H(2)
N ,
and since H(2)
n
= œÄ2
6 ‚àín‚àí1 + 1
2n‚àí2 + O(n‚àí3) this is
n‚àí1 ‚àí1
2n‚àí2 + O(n‚àí3)
œÄ2/6 + O(N‚àí1)
=
6
œÄ2 n‚àí1 ‚àí3
œÄ2 n‚àí2 + O(n‚àí3) ,
actually decreasing with n. (The expected value in (a) is high because it
includes payos so huge that the entire world's economy would be aected if
they ever had to be made.)
9.51
Strictly speaking, this is false, since the function represented by O(x‚àí2)
might not be integrable. (It might be `[x ‚ààS]/x2', where S is not a measurable
set.) But if we stipulate that f(x) is an integrable function such that f(x) =
(As opposed to an
execrable function.)
O(x‚àí2) as x ‚Üí‚àû, then
¬Ø¬ØR‚àû
n f(x) dx
¬Ø¬Ø 
R‚àû
n
¬Ø¬Øf(x)
¬Ø¬Ø dx 
R‚àû
n Cx‚àí2 dx = Cn‚àí1.
9.52
In fact, the stack of n's can be replaced by any function f(n) that
approaches innity, however fast. Dene the sequence ‚ü®m0, m1, m2, . . . ‚ü©by
setting m0 = 0 and letting mk be the least integer > mk‚àí1 such that
¬≥k + 1
k
¬¥mk  f(k + 1)2 .
Now let A(z) = P
k1(z/k)mk. This power series converges for all z, because
the terms for k > jzj are bounded by a geometric series. Also A(n + 1) 
¬°
(n + 1)/n
¬¢mn  f(n + 1)2, hence limn‚Üí‚àûf(n)/A(n) = 0.

A ANSWERS TO EXERCISES 601
9.53
By induction, the O term is (m ‚àí1)!‚àí1 Rx
0 tm‚àí1f(m)(x ‚àít) dt. Since
f(m+1) has the opposite sign to f(m), the absolute value of this integral is
bounded by
¬Ø¬Øf(m)(0)
¬Ø¬Ø Rx
0 tm‚àí1 dt; so the error is bounded by the absolute
value of the rst discarded term.
9.54
Let g(x) = f(x)/xŒ±. Then g‚Ä≤(x) ‚àº‚àíŒ±g(x)/x as x ‚Üí‚àû. By the mean
value theorem, g(x ‚àí1
2) ‚àíg(x + 1
2) = ‚àíg‚Ä≤(y) ‚àºŒ±g(y)/y for some y between
Sounds like a nasty
theorem.
x ‚àí1
2 and x + 1
2. Now g(y) = g(x)
¬°
1 + O(1/x)
¬¢
, so g(x ‚àí1
2) ‚àíg(x + 1
2) ‚àº
Œ±g(x)/x = Œ±f(x)/x1+Œ±. Therefore
X
kn
f(k)
k1+Œ± = O
¬≥ X
kn
¬°
g(k ‚àí1
2) ‚àíg(k + 1
2)
¬¢¬¥
= O
¬°
g(n ‚àí1
2)
¬¢
.
9.55
The estimate of (n + k + 1
2) ln(1 + k/n) + (n ‚àík + 1
2) ln(1 ‚àík/n) is
extended to k2/n + k4/6n3 + O(n‚àí3/2+5œµ), so we apparently want to have an
extra factor e‚àík4/6n3 in bk(n), and ck(n) = 22nn‚àí2+5œµe‚àík2/n. But it turns
out to be better to leave bk(n) untouched and to let
ck(n) = 22nn‚àí2+5œµe‚àík2/n + 22nn‚àí5+5œµk4e‚àík2/n ,
thereby replacing e‚àík4/6n3 by 1+O(k4/n3). The sum P
kk4e‚àík2/n is O(n5/2),
as shown in exercise 30.
9.56
If k  n1/2+œµ we have ln(nk/nk) = ‚àí1
2k2/n + 1
2k/n ‚àí1
6k3/n2 +
O(n‚àí1+4œµ) by Stirling's approximation, hence
nk/nk = e‚àík2/2n¬°
1 + k/2n ‚àí2
3k3/(2n)2 + O(n‚àí1+4œµ)
¬¢
.
Summing with the identity in exercise 30, and remembering to omit the term
for k = 0, gives ‚àí1 + Œò2n + Œò(1)
2n ‚àí2
3Œò(3)
2n + O(n‚àí1/2+4œµ) =
p
œÄn/2 ‚àí1
3 +
O(n‚àí1/2+4œµ).
9.57
Using the hint, the given sum becomes
R‚àû
0 ue‚àíuŒ∂(1+u/ln n) du. The
zeta function can be dened by the series
Œ∂(1 + z) = z‚àí1 +
X
m0
(‚àí1)mŒ≥mzm/m! ,
where Œ≥0 = Œ≥ and Œ≥m is the Stieltjes constant [341, 201]
lim
n‚Üí‚àû
¬µ n
X
k=1
(ln k)m
k
‚àí
(ln n)m+1
m + 1
¬∂
.
Hence the given sum is
ln n + Œ≥ ‚àí2Œ≥1(ln n)‚àí1 + 3Œ≥2(ln n)‚àí2 ‚àí¬∑ ¬∑ ¬∑ .

602 ANSWERS TO EXERCISES
9.58
Let 0  Œ∏  1 and f(z) = e2œÄizŒ∏/(e2œÄiz ‚àí1). We have
¬Ø¬Øf(z)
¬Ø¬Ø =
e‚àí2œÄyŒ∏
1 + e‚àí2œÄy  1 ,
when x mod 1 = 1
2;
¬Ø¬Øf(z)
¬Ø¬Ø 
e‚àí2œÄyŒ∏
je‚àí2œÄy ‚àí1j 
1
1 ‚àíe‚àí2œÄœµ ,
when jyj  œµ.
Therefore
¬Ø¬Øf(z)
¬Ø¬Ø is bounded on the contour, and the integral is O(M1‚àím).
The residue of 2œÄif(z)/zm at z = k Ã∏= 0 is e2œÄikŒ∏/km; the residue at z = 0 is
the coecient of z‚àí1 in
e2œÄizŒ∏
zm+1
¬≥
B0 + B1
2œÄiz
1!
+ ¬∑ ¬∑ ¬∑
¬¥
=
1
zm+1
¬≥
B0(Œ∏) + B1(Œ∏)2œÄiz
1!
+ ¬∑ ¬∑ ¬∑
¬¥
,
namely (2œÄi)mBm(Œ∏)/m!. Therefore the sum of residues inside the contour
is
(2œÄi)m
m!
Bm(Œ∏) + 2
M
X
k=1
eœÄim/2 cos(2œÄkŒ∏ ‚àíœÄm/2)
km
.
This equals the contour integral O(M1‚àím), so it approaches zero as M ‚Üí‚àû.
9.59
If F(x) is suciently well behaved, we have the general identity
X
k
F(k + t) =
X
n
G(2œÄn)e2œÄint ,
where G(y) =
R+‚àû
‚àí‚àûe‚àíiyxF(x) dx. (This is \Poisson's summation formula,"
which can be found in standard texts such as Henrici [182, Theorem 10.6e].)
9.60
The stated formula is equivalent to
n1/2 = n1/2
¬µ
1 ‚àí1
8n +
1
128n2 +
5
1024n3 ‚àí
21
32768n4 + O(n‚àí5)
¬∂
by exercise 5.22. Hence the result follows from exercises 6.64 and 9.44.
9.61
The idea is to make Œ± \almost" rational. Let ak = 222k
be the kth
partial quotient of Œ±, and let n = 1
2am+1qm, where qm = K(a1, . . . , am) and
m is even. Then 0 < fqmŒ±g < 1/K(a1, . . . , am+1) < 1/(2n), and if we take
v = am+1/(4n) we get a discrepancy  1
4am+1. If this were less than n1‚àíœµ
we would have aœµ
m+1 = O(q1‚àíœµ
m
); but in fact am+1 > q2m
m .
9.62
See Caneld [48]; see also David and Barton [71, Chapter 16] for asymp-
totics of Stirling numbers of both kinds.

A ANSWERS TO EXERCISES 603
9.63
Let c = œÜ2‚àíœÜ. The estimate cnœÜ‚àí1+o(nœÜ‚àí1) was proved by Fine [150].
Ilan Vardi observes that the sharper estimate stated can be deduced from
the fact that the error term e(n) = f(n) ‚àícnœÜ‚àí1 satises the approximate
recurrence cœÜn2‚àíœÜe(n) ‚âà‚àíP
k e(k)[1  k < cnœÜ‚àí1]. The function
nœÜ‚àí1u(ln ln n/ln œÜ)
ln n
satises this recurrence asymptotically, if u(x + 1) = ‚àíu(x). (Vardi conjec-
tures that
f(n) = nœÜ‚àí1
¬µ
c + u
¬≥ln ln n
ln œÜ
¬¥
(ln n)‚àí1 + O
¬°
(log n)‚àí2¬¢¬∂
for some such function u.) Calculations for small n show that f(n) equals the
nearest integer to cnœÜ‚àí1 for 1  n  400 except in one case: f(273) = 39 >
c ¬∑ 273œÜ‚àí1 ‚âà38.4997. But the small errors are eventually magnied, because
of results like those in exercise 2.36.
For example, e(201636503) ‚âà35.73;
e(919986484788) ‚âà‚àí1959.07.
9.64
(From this identity for B2(x) we can easily derive the identity of exer-
\The paradox is now
fully established
that the utmost
abstractions are the
true weapons with
which to control
our thought of
concrete fact."
|A.N. White-
head [372]
cise 58 by induction on m.) If 0 < x < 1, the integral
R1/2
x
sin NœÄt dt/sin œÄt
can be expressed as a sum of N integrals that are each O(N‚àí2), so it is
O(N‚àí1); the constant implied by this O may depend on x. Integrating the
identity PN
n=1 cos 2nœÄt = <
¬°
e2œÄit(e2NœÄit‚àí1)/(e2œÄit‚àí1)
¬¢
= ‚àí1
2 + 1
2 sin(2N+
1)œÄt/sin œÄt and letting N ‚Üí‚àûnow gives P
n1(sin 2nœÄx)/n = œÄ
2 ‚àíœÄx, a re-
lation that Euler knew ([107] and [110, part 2, ¬ß92]). Integrating again yields
the desired formula. (This solution was suggested by E. M. E. Wermuth [367];
Euler's original derivation did not meet modern standards of rigor.)
9.65
Since a0+a1n‚àí1+a2n‚àí2+¬∑ ¬∑ ¬∑ = 1+(n‚àí1)‚àí1(a0+a1(n‚àí1)‚àí1+a2(n‚àí
1)‚àí2 + ¬∑ ¬∑ ¬∑ ), we obtain the recurrence am+1 = P
k
¬°m
k
¬¢
ak, which matches the
recurrence for the Bell numbers. Hence am = œñm.
A slightly longer but more informative proof can be based on the fact
that 1/(n ‚àí1) . . . (n ‚àím) = P
k
¬© k
m
¬™
/nk, by (7.47).
9.66
The expected number of distinct elements in the sequence 1, f(1),
f(f(1)), . . . , when f is a random mapping of f1, 2, . . . , ng into itself, is the
function Q(n) of exercise 56, whose value is 1
2
‚àö
2œÄn+O(1); this might account
somehow for the factor
‚àö
2œÄn.
9.67
It is known that ln œán ‚àº3
2n2 ln 4
3; the constant e‚àíœÄ/6 has been veried
empirically to eight signicant digits.
9.68
This would fail if, for example, en‚àíŒ≥ = m+ 1
2 +œµ/m for some integer m
and some 0 < œµ < 1
8; but no counterexamples are known.

B
Bibliography
HERE ARE THE WORKS cited in this book. Numbers in the margin specify
the page numbers where citations occur.
\This paper lls a
much-needed gap
in the literature."
|Math.Reviews
References to published problems are generally made to the places where
solutions can be found, instead of to the original problem statements.
Wherever possible, names and titles are spelled here as they appeared in
the original publication.
1
N. H. Abel, letter to B. Holmboe (1823), in his uvres Completes, rst
634.
edition, 1839, volume 2, 264{265. Reprinted in the second edition, 1881,
volume 2, 254{255.
2
Milton Abramowitz and Irene A. Stegun, editors, Handbook of Math-
42.
ematical Functions.
United States Government Printing Oce, 1964.
Reprinted by Dover, 1965.
3
William W. Adams and J. L. Davison, \A remarkable class of continued
635.
fractions," Proceedings of the American Mathematical Society 65 (1977),
194{198.
4
A. V. Aho and N. J. A. Sloane, \Some doubly exponential sequences,"
633.
Fibonacci Quarterly 11 (1973), 429{437.
5
W. Ahrens, Mathematische Unterhaltungen und Spiele. Teubner, Leip-
8.
zig, 1901. Second edition, in two volumes, 1910 and 1918.
6
Naum Il'ich Akhiezer, Klassicheska√Ña Problema Momentov i Nekotorye
591.
Voprosy Analiza, Sv√Ñazannye s Ne√Ñu. Moscow, 1961. English translation,
The Classical Moment Problem and Some Related Questions in Analysis,
Hafner, 1965.
7
R. E. Allardice and A. Y. Fraser, \La Tour d'Hano," Proceedings of the
2.
Edinburgh Mathematical Society 2 (1884), 50{53.
8
Desire Andre, \Sur les permutations alternees," Journal de Mathema-
635.
tiques pures et appliquees, series 3, 7 (1881), 167{184.
604

B BIBLIOGRAPHY 605
9
George E. Andrews, \Applications of basic hypergeometric functions,"
215, 634.
SIAM Review 16 (1974), 441{484.
10
George E. Andrews, \On sorting two ordered sets," Discrete Mathemat-
530.
ics 11 (1975), 97{106.
11
George E. Andrews, The Theory of Partitions. Addison-Wesley, 1976.
330.
12
George E. Andrews, \Euler's `exemplum memorabile inductionis fallacis'
575.
and q-trinomial coecients," Journal of the American Mathematical So-
ciety 3 (1990), 653{669.
13
George E. Andrews and K. Uchimura, \Identities in combinatorics IV:
635.
Dierentiation and harmonic numbers," Utilitas Mathematica 28 (1985),
265{269.
14
Roger Apery, \Interpolation de fractions continues et irrationalite de cer-
238, 634.
taines constantes," in Mathematiques, Ministere des universites (France),
Comite des travaux historiques et scientiques, Section des sciences, Bul-
letin de la Section des Sciences 3 (1981), 37{53.
15
V. I. Arnold, \Bernoulli-Euler updown numbers associated with function
635.
singularities, their combinatorics and arithmetics," Duke Mathematical
Journal 63 (1991), 537{555.
16
M. D. Atkinson, \The cyclic towers of Hanoi," Information Processing
633.
Letters 13 (1981), 118{119.
17
Paul Bachmann, Die analytische Zahlentheorie. Teubner, Leipzig, 1894.
443.
18
W. N. Bailey, Generalized Hypergeometric Series. Cambridge University
223, 634.
Press, 1935; second edition, 1964.
19
W. N. Bailey, \The generating function for Jacobi polynomials," Journal
548.
of the London Mathematical Society 13 (1938), 243{246.
20
W. W. Rouse Ball and H. S. M. Coxeter, Mathematical Recreations and
633.
Essays, twelfth edition.
University of Toronto Press, 1974.
(A revi-
sion of Ball's Mathematical Recreations and Problems, rst published
by Macmillan, 1892.)
21
P. Barlow, \Demonstration of a curious numerical proposition," Journal
634.
of Natural Philosophy, Chemistry, and the Arts 27 (1810), 193{205.
22
Samuel Beatty, \Problem 3177," American Mathematical Monthly 34
633.
(1927), 159{160.
23
E. T. Bell, \Euler algebra," Transactions of the American Mathematical
332.
Society 25 (1923), 135{154.
24
E. T. Bell, \Exponential numbers," American Mathematical Monthly 41
635.
(1934), 411{419.

606 BIBLIOGRAPHY
25
Edward A. Bender, \Asymptotic methods in enumeration," SIAM Re-
636.
view 16 (1974), 485{515.
26
Jacobi Bernoulli, Ars Conjectandi, opus posthumum. Basel, 1713. Re-
283.
printed in Die Werke von Jakob Bernoulli, volume 3, 107{286.
27
J. Bertrand, \Memoire sur le nombre de valeurs que peut prendre une
633.
fonction quand on y permute les lettres qu'elle renferme," Journal de
l'Ecole Royale Polytechnique 18, cahier 30 (1845), 123{140.
28
William H. Beyer, editor, CRC Standard Mathematical Tables and For-
42.
mulae, 29th edition. CRC Press, Boca Raton, Florida, 1991.
29
J. Bienayme, \Considerations a l'appui de la decouverte de Laplace sur
390.
la loi de probabilite dans la methode des moindres carres," Comptes
Rendus hebdomadaires des seances de l'Academie des Sciences (Paris)
37 (1853), 309{324.
30
J. Binet, \Memoire sur un systeme de Formules analytiques, et leur ap-
633.
plication a des considerations geometriques," Journal de l'Ecole Poly-
technique 9, cahier 16 (1812), 280{354.
31
J. Binet, \Memoire sur l'integration des equations lineaires aux die-
299.
rences nies, d'un ordre quelconque, a coecients variables," Comptes
Rendus hebdomadaires des seances de l'Academie des Sciences (Paris)
17 (1843), 559{567.
32
Gunnar Blom, \Problem E 3043: Random walk until no shoes," American
636.
Mathematical Monthly 94 (1987), 78{79.
33
R. P. Boas, Jr. and J. W. Wrench, Jr., \Partial sums of the harmonic
600, 636.
series," American Mathematical Monthly 78 (1971), 864{870.
34
P. Bohl, \Uber ein in der Theorie der sakularen Storungen vorkom-
87.
mendes Problem," Journal fur die reine und angewandte Mathematik
135 (1909), 189{283.
35
Emile Borel, Lecons sur les series a termes positifs.
Gauthier-Villars,
636.
1902.
36
Jonathan M. Borwein and Peter B. Borwein, Pi and the AGM. Wiley,
635.
1987.
37
Richard P. Brent, \The rst occurrence of large gaps between successive
525.
primes," Mathematics of Computation 27 (1973), 959{963.
38
Richard P. Brent, \Computation of the regular continued fraction for
306, 564.
Euler's constant," Mathematics of Computation 31 (1977), 771{777.
39
John Brillhart, \Some miscellaneous factorizations," Mathematics of
633.
Computation 17 (1963), 447{450.

B BIBLIOGRAPHY 607
40
Achille Brocot, \Calcul des rouages par approximation, nouvelle me-
116.
thode," Revue Chronometrique 6 (1860), 186{194. (He also published
a 97-page monograph with the same title in 1862.)
41
Maxey Brooke and C. R. Wall, \Problem B-14: A little surprise," Fi-
635.
bonacci Quarterly 1, 3 (1963), 80.
42
Brother U. Alfred [Brousseau], \A mathematician's progress," Mathe-
633.
matics Teacher 59 (1966), 722{727.
43
Morton Brown, \Problem 6439: A periodic sequence," American Math-
501.
ematical Monthly 92 (1985), 218.
44
T. Brown, \Innite multi-variable subpolynormal Woes which do not
(Such papers aren't
cited in this book.)
satisfy the lower regular Q-property (Pies)," in A Collection of 250 Pa-
pers on Woe Theory Dedicated to R. S. Green on His 23rd Birthday.
Cited in A. K. Austin, \Modern research in mathematics," The Mathe-
matical Gazette 51 (1967), 149{150.
45
Thomas C. Brown, \Problem E 2619: Squares in a recursive sequence,"
633.
American Mathematical Monthly 85 (1978), 52{53.
46
William G. Brown, \Historical note on a recurrent combinatorial prob-
358.
lem," American Mathematical Monthly 72 (1965), 973{977.
47
S. A. Burr, \On moduli for which the Fibonacci sequence contains a
635.
complete system of residues," Fibonacci Quarterly 9 (1971), 497{504.
48
E. Rodney Caneld, \On the location of the maximum Stirling num-
602, 636.
ber(s) of the second kind," Studies in Applied Mathematics 59 (1978),
83{93.
49
L. Carlitz, \The generating function for max(n1, n2, ¬∑ ¬∑ ¬∑ , nk), Portugaliae
635.
Mathematica 21 (1962), 201{207.
50
Lewis Carroll [pseudonym of C. L. Dodgson], Through the Looking Glass
31.
and What Alice Found There. Macmillan, 1871.
51
Jean-Dominique Cassini, \Une nouvelle progression de nombres," His-
292.
toire de l'Academie Royale des Sciences, Paris, volume 1, 201. (Cassini's
work is summarized here as one of the mathematical results presented
to the academy in 1680. This volume was published in 1733.)
52
E. Catalan, \Note sur une Equation aux dierences nies," Journal de
203.
Mathematiques pures et appliquees 3 (1838), 508{516.
53
Augustin-Louis Cauchy, Cours d'analyse de l'Ecole Royale Polytech-
633.
nique. Imprimerie Royale, Paris, 1821. Reprinted in his uvres Com-
pletes, series 2, volume 3.

608 BIBLIOGRAPHY
54
Arnold Buum Chace, The Rhind Mathematical Papyrus, volume 1.
633.
Mathematical Association of America, 1927. (Includes an excellent bib-
liography of Egyptian mathematics by R. C. Archibald.)
55
M. Chaimovich, G. Freiman, and J. Schonheim, \On exceptions to
525.
Szegedy's theorem," Acta Arithmetica 49 (1987), 107{112.
56
P. L. Tchebichef [Chebyshev], \Memoire sur les nombres premiers," Jour-
633.
nal de Mathematiques pures et appliquees 17 (1852), 366{390. Reprinted
in his uvres, volume 1, 51{70. Russian translation, \O prostykh chis-
lakh," in his Polnoe Sobranie Sochineni, volume 1, 191{207.
57
P. L. Chebyshev, \O srednikh velichinakh," Matematicheski Sbornik' 2
390.
(1867), 1{9. Reprinted in his Polnoe Sobranie Sochineni, volume 2, 431{
437. French translation, \Des valeurs moyennes," Journal de Mathema-
tiques pures et appliquees, series 2, 12 (1867), 177{184; reprinted in his
uvres, volume 1, 685{694.
58
P. L. Chebyshev, \O priblizhennykh vyrazheni√Ñakh odnikh integralov
38.
cherez drugie, vz√Ñatye v tex zhe predelakh," Soobshchen√Ña i pro-
tokoly zas√Ñedan matematicheskago obshchestva pri Imperatorskum}
Khar'kovskom} Universitet√Ñe 4,2 (1882), 93{98. Reprinted in his Pol-
noe Sobranie Sochineni, volume 3, 128{131.
French translation, \Sur
les expressions approximatives des integrales denies par les autres prises
entre les m^emes limites," in his uvres, volume 2, 716{719.
59
Fan Chung and Ron Graham, \On digraph polynomials," submitted for
557, 635.
publication, 1993.
60
Th. Clausen, \Ueber die Falle, wenn die Reihe von der Form
634.
y = 1 + Œ±
1 ¬∑ Œ≤
Œ≥ x + Œ±.Œ± + 1
1.2
¬∑ Œ≤.Œ≤ + 1
Œ≥.Œ≥ + 1 x2 + etc.
ein Quadrat von der Form
z = 1 + Œ±‚Ä≤
1 ¬∑ Œ≤‚Ä≤
Œ≥‚Ä≤ ¬∑ Œ¥‚Ä≤
œµ‚Ä≤ x + Œ±‚Ä≤.Œ±‚Ä≤+1
1.2
¬∑ Œ≤‚Ä≤.Œ≤‚Ä≤+1
Œ≥‚Ä≤.Œ≥‚Ä≤+1 ¬∑ Œ¥‚Ä≤.Œ¥‚Ä≤+1
œµ‚Ä≤.œµ‚Ä≤+1 x2 + etc. hat,"
Journal fur die reine und angewandte Mathematik 3 (1828), 89{91.
61
Th. Clausen, \Beitrag zur Theorie der Reihen," Journal fur die reine
634.
und angewandte Mathematik 3 (1828), 92{95.
62
Th. Clausen, \Theorem," Astronomische Nachrichten 17 (1840), col-
635.
umns 351{352.
63
Stuart Dodgson Collingwood, The Lewis Carroll Picture Book. T. Fisher
293.
Unwin, 1899. Reprinted by Dover, 1961, with the new title Diversions
and Digressions of Lewis Carroll.

B BIBLIOGRAPHY 609
64
Louis Comtet, Advanced Combinatorics. Dordrecht, Reidel, 1974.
636.
65
J. H. Conway and R. L. Graham, \Problem E 2567: A periodic recur-
501.
rence," American Mathematical Monthly 84 (1977), 570{571.
66
Harald Cramer, \On the order of magnitude of the dierence between
525, 634.
consecutive prime numbers," Acta Arithmetica 2 (1937), 23{46.
67
A. L. Crelle, \Demonstration elementaire du theoreme de Wilson gene-
633.
ralise," Journal fur die reine und angewandte Mathematik 20 (1840),
29{56.
68
D. W. Crowe, \The n-dimensional cube and the Tower of Hanoi," Amer-
633.
ican Mathematical Monthly 63 (1956), 29{30.
69
Janos A. Csirik, \Optimal strategy for the rst player in the Penney ante
590.
game," Combinatorics, Probability and Computing 1 (1992), 311{321.
70
D. R. Curtiss, \On Kellogg's Diophantine problem," American Mathe-
634.
matical Monthly 29 (1922), 380{387.
71
F. N. David and D. E. Barton, Combinatorial Chance. Hafner, 1962.
602.
72
Philip J. Davis, \Leonhard Euler's integral: A historical prole of the
210.
Gamma function," American Mathematical Monthly 66 (1959), 849{
869.
73
J. L. Davison, \A series and its associated continued fraction," Proceed-
307, 635.
ings of the American Mathematical Society 63 (1977), 29{32.
74
N. G. de Bruijn, Asymptotic Methods in Analysis. North-Holland, 1958;
444, 447, 595, 636.
third edition, 1970. Reprinted by Dover, 1981.
75
N. G. de Bruijn, \Problem 9," Nieuw Archief voor Wiskunde, series 3,
635.
12 (1964), 68.
76
Abraham de Moivre, Miscellanea analytica de seriebus et quadraturis.
297, 481.
London, 1730.
77
R. Dedekind, \Abri einer Theorie der hoheren Congruenzen in Bezug
136.
auf einen reellen Primzahl-Modulus," Journal fur die reine und ange-
wandte Mathematik 54 (1857), 1{26. Reprinted in his Gesammelte math-
ematische Werke, volume 1, 40{67.
78
Leonard Eugene Dickson, History of the Theory of Numbers. Carnegie
510.
Institution of Washington, volume 1, 1919; volume 2, 1920; volume 3,
1923. Reprinted by Stechert, 1934, and by Chelsea, 1952, 1971.
79
Edsger W. Dijkstra, Selected Writings on Computing: A Personal Per-
635.
spective. Springer-Verlag, 1982.

610 BIBLIOGRAPHY
80
G. Lejeune Dirichlet, \Verallgemeinerung eines Satzes aus der Lehre
633.
von den Kettenbruchen nebst einigen Anwendungen auf die Theorie
der Zahlen," Bericht uber die Verhandlungen der Koniglich-Preuischen
Akademie der Wissenschaften zu Berlin (1842), 93{95. Reprinted in his
Werke, volume 1, 635{638.
81
A. C. Dixon, \On the sum of the cubes of the coecients in a certain ex-
634.
pansion by the binomial theorem," Messenger of Mathematics 20 (1891),
79{80.
82
John Dougall, \On Vandermonde's theorem, and some more general
171.
expansions," Proceedings of the Edinburgh Mathematical Society 25
(1907), 114{132.
83
A. Conan Doyle, \The sign of the four; or, The problem of the Sholtos,"
228, 405.
Lippincott's Monthly Magazine (Philadelphia) 45 (1890), 147{223.
84
A. Conan Doyle, \The adventure of the nal problem," The Strand Mag-
162.
azine 6 (1893), 558{570.
85
P. du Bois-Reymond, \Sur la grandeur relative des innis des fonctions,"
440.
Annali di Matematica pura ed applicata, series 2, 4 (1871), 338{353.
86
Harvey Dubner, \Generalized repunit primes," Mathematics of Compu-
633.
tation 61 (1993), 927{930.
87
Henry Ernest Dudeney, The Canterbury Puzzles and Other Curious
633.
Problems. E. P. Dutton, New York, 1908; 4th edition, Dover, 1958. (Du-
deney had rst considered the generalized Tower of Hanoi in The Weekly
Dispatch, on 25 May 1902 and 15 March 1903.)
88
G. Waldo Dunnington, Carl Friedrich Gauss: Titan of Science. Exposi-
6.
tion Press, New York, 1955.
89
F. J. Dyson, \Some guesses in the theory of partitions," Eureka 8 (1944),
172, 239.
10{15.
90
A. W. F. Edwards, Pascal's Arithmetical Triangle.
Oxford University
155.
Press, 1987.
91
G. Eisenstein, \Entwicklung von Œ±Œ±Œ±
...
," Journal fur die reine und ange-
202.
wandte Mathematik 28 (1844), 49{52. Reprinted in his Mathematische
Werke 1, 122{125.
92
Noam D. Elkies, \On A4 +B4 +C4 = D4," Mathematics of Computation
131.
51 (1988), 825{835.
93
Erd}os Pal, \Az
1
x1
+ 1
x2
+ ¬∑ ¬∑ ¬∑ + 1
xn
= a
b egyenlet egesz szamu meg-
634.
oldasairol," Matematikai Lapok 1 (1950), 192{209. English abstract on
page 210.

B BIBLIOGRAPHY 611
94
Paul Erd}os, \My Scottish Book `problems'," in The Scottish Book: Math-
418.
ematics from the Scottish Cafe, edited by R. Daniel Mauldin, 1981,
35{45.
95
P. Erd}os and R. L. Graham, Old and New Problems and Results in
515, 525, 634, 635,
636.
Combinatorial Number Theory. Universite de Geneve, L'Enseignement
Mathematique, 1980.
96
P. Erd}os, R. L. Graham, I. Z. Ruzsa, and E. G. Straus, \On the prime
525, 548.
factors of
¬°2n
n
¬¢
," Mathematics of Computation 29 (1975), 83{92.
97
Arulappah Eswarathasan and Eugene Levine, \p-integral harmonic
635.
sums," Discrete Mathematics 91 (1991), 249{257.
98
Euclid, TOIXEIA.
Ancient manuscript rst printed in Basel, 1533.
108.
Scholarly edition (Greek and Latin) by J. L. Heiberg in ve volumes,
Teubner, Leipzig, 1883{1888.
99
Leonhard Euler, letter to Christian Goldbach (13 October 1729), in Cor-
210, 634.
respondance Mathematique et Physique de Quelques Celebres Geometres
du XVIIIeme Siecle, edited by P. H. Fuss, St. Petersburg, 1843, volume 1,
3{7.
100 L. Eulero, \De progressionibus transcendentibus seu quarum termini
210.
generales algebraice dari nequeunt," Commentarii academi scientiarum
imperialis Petropolitan 5 (1730), 36{57. Reprinted in his Opera Omnia,
series 1, volume 14, 1{24.
101 Leonh. Eulero, \Methodus generalis summandi progressiones," Commen-
469.
tarii academi scientiarum imperialis Petropolitan 6 (1732), 68{97.
Reprinted in his Opera Omnia, series 1, volume 14, 42{72.
102 Leonh. Eulero, \Observationes de theoremate quodam Fermatiano, ali-
132.
isque ad numeros primos spectantibus," Commentarii academi scien-
tiarum imperialis Petropolitan 6 (1732), 103{107. Reprinted in his
Opera Omnia, series 1, volume 2, 1{5. Reprinted in his Commentationes
arithmetic collect, volume 1, 1{3.
103 Leonh. Eulero, \De progressionibus harmonicis observationes," Com-
278.
mentarii academi scientiarum imperialis Petropolitan 7 (1734), 150{
161. Reprinted in his Opera Omnia, series 1, volume 14, 87{100.
104 Leonh. Eulero, \Methodus universalis series summandi ulterius pro-
267.
mota," Commentarii academi scientiarum imperialis Petropolitan 8
(1736), 147{158. Reprinted in his Opera Omnia, series 1, volume 14,
124{137.
105 Leonh. Euler, \De fractionibus continuis, Dissertatio," Commentarii
122.
academi scientiarum imperialis Petropolitan 9 (1737), 98{137. Re-
printed in his Opera Omnia, series 1, volume 14, 187{215.

612 BIBLIOGRAPHY
106 Leonh. Euler, \Vari observationes circa series innitas," Commentarii
633.
academi scientiarum imperialis Petropolitan 9 (1737), 160{188. Re-
printed in his Opera Omnia, series 1, volume 14, 216{244.
107 Leonhard Euler, letter to Christian Goldbach (4 July 1744), in Corre-
603.
spondance Mathematique et Physique de Quelques Celebres Geometres
du XVIIIeme Siecle, edited by P. H. Fuss, St. Petersburg, 1843, volume 1,
278{293.
108 Leonhardo Eulero, Introductio in Analysin Innitorum. Tomus primus,
635.
Lausanne, 1748. Reprinted in his Opera Omnia, series 1, volume 8. Trans-
lated into French, 1786; German, 1788; Russian, 1936.
109 L. Eulero, \De partitione numerorum," Novi commentarii academi sci-
635.
entiarum imperialis Petropolitan 3 (1750), 125{169. Reprinted in his
Commentationes arithmetic collect, volume 1, 73{101. Reprinted in
his Opera Omnia, series 1, volume 2, 254{294.
110 Leonhardo Eulero, Institutiones Calculi Dierentialis cum eius usu in
48, 267, 603, 635.
Analysi Finitorum ac Doctrina Serierum. Berlin, Academi Imperialis
Scientiarum Petropolitan, 1755. Reprinted in his Opera Omnia, se-
ries 1, volume 10. Translated into German, 1790.
111 L. Eulero, \Theoremata arithmetica nova methodo demonstrata," Novi
133, 134.
commentarii academi scientiarum imperialis Petropolitan 8 (1760),
74{104. (Also presented in 1758 to the Berlin Academy.) Reprinted in
his Commentationes arithmetic collect, volume 1, 274{286. Reprinted
in his Opera Omnia, series 1, volume 2, 531{555.
112 L. Eulero, \Specimen algorithmi singularis," Novi commentarii academ-
303.
i scientiarum imperialis Petropolitan 9 (1762), 53{69. (Also presented
in 1757 to the Berlin Academy.) Reprinted in his Opera Omnia, series 1,
volume 15, 31{49.
113 L. Eulero, \Observationes analytic," Novi commentarii academi sci-
299, 575, 636.
entiarum imperialis Petropolitan 11 (1765), 124{143. Reprinted in his
Opera Omnia, series 1, volume 15, 50{69.
114 Leonhard Euler, Vollstandige Anleitung zur Algebra. Erster Theil. Von
6, 636.
den verschiedenen Rechnungs-Arten, Verhaltnissen und Proportionen.
St. Petersburg, 1770. Reprinted in his Opera Omnia, series 1, volume 1.
Translated into Russian, 1768; Dutch, 1773; French, 1774; Latin, 1790;
English, 1797.
115 L. Eulero, \Observationes circa bina biquadrata quorum summam in
131.
duo alia biquadrata resolvere liceat," Novi commentarii academi sci-
entiarum imperialis Petropolitan 17 (1772), 64{69. Reprinted in his

B BIBLIOGRAPHY 613
Commentationes arithmetic collect, volume 1, 473{476. Reprinted in
his Opera Omnia, series 1, volume 3, 211{217.
116 L. Eulero, \Observationes circa novum et singulare progressionum
513.
genus," Novi commentarii academi scientiarum imperialis Petropoli-
tan 20 (1775), 123{139. Reprinted in his Opera Omnia, series 1, vol-
ume 7, 246{261.
117 L. Eulero, \De serie Lambertina, plurimisque eius insignibus proprietat-
202.
ibus," Acta academi scientiarum imperialis Petropolitan 3,2 (1779),
29{51. Reprinted in his Opera Omnia, series 1, volume 6, 350{369.
118 L. Eulero, \Specimen transformationis singularis serierum," Nova acta
207, 634.
academi scientiarum imperialis Petropolitan 12 (1794), 58{70. Sub-
mitted for publication in 1778. Reprinted in his Opera Omnia, series 1,
volume 16(2), 41{55.
119 Johann Faulhabern, Academia Algebr, Darinnen die miraculosische In-
288.
ventiones zu den hochsten Cossen weiters continuirt und protiert wer-
den, . . . bi au die regulierte Zensicubiccubic Co durch onen Truck
publiciert worden. Augsburg, 1631.
120 William Feller, An Introduction to Probability Theory and Its Applica-
381, 636.
tions, volume 1. Wiley, 1950; second edition, 1957; third edition, 1968.
121 Pierre de Fermat, letter to Marin Mersenne (25 December 1640), in
131.
uvres de Fermat, volume 2, 212{217.
122 Leonardo Fibonacci [Pisano], Liber Abaci. First edition, 1202 (now lost);
633, 634.
second edition, 1228. Reprinted in Scritti di Leonardo Pisano, edited by
Baldassarre Boncompagni, 1857, volume 1.
123 Bruno de Finetti, Teoria delle Probabilita. Turin, 1970. English trans-
24.
lation, Theory of Probability, Wiley, 1974{1975.
124 Michael E. Fisher, \Statistical mechanics of dimers on a plane lattice,"
636.
Physical Review 124 (1961), 1664{1672.
125 R. A. Fisher, \Moments and product moments of sampling distribu-
636.
tions," Proceedings of the London Mathematical Society, series 2, 30
(1929), 199{238.
126 Pierre Forcadel, L'arithmeticque. Paris, 1557.
634.
127 J. Fourier, \Refroidissement seculaire du globe terrestre," Bulletin des
22.
Sciences par la Societe philomathique de Paris, series 3, 7 (1820), 58{70.
Reprinted in uvres de Fourier, volume 2, 271{288.
128 Aviezri S. Fraenkel, \Complementing and exactly covering sequences,"
515, 633.
Journal of Combinatorial Theory, series A, 14 (1973), 8{20.

614 BIBLIOGRAPHY
129 Aviezri S. Fraenkel, \How to beat your Wytho games' opponent on
563.
three fronts," American Mathematical Monthly 89 (1982), 353{361.
130 J. S. Frame, B. M. Stewart, and Otto Dunkel, \Partial solution to prob-
633.
lem 3918," American Mathematical Monthly 48 (1941), 216{219.
131 Piero della Francesca, Libellus de quinque corporibus regularibus. Vat-
635.
ican Library, manuscript Urbinas 632. Translated into Italian by Luca
Pacioli, as part 3 of Pacioli's Diuine Proportione, Venice, 1509.
132 J. Franel, Solutions to questions 42 and 170, in L'Intermediare des
549.
Mathematiciens 1 (1894), 45{47; 2 (1895), 33{35.
133 W. D. Frazer and A. C. McKellar, \Samplesort: A sampling approach to
634.
minimal storage tree sorting," Journal of the ACM 27 (1970), 496{507.
134 Michael Lawrence Fredman, Growth Properties of a Class of Recursively
513.
Dened Functions. Ph.D. thesis, Stanford University, Computer Science
Department, 1972.
135 Nikolao Fuss, \Solutio qustionis, quot modis polygonum n laterum in
361.
polygona m laterum, per diagonales resolvi quat," Nova acta academi
scientiarum imperialis Petropolitan 9 (1791), 243{251.
136 Martin Gardner, \About phi, an irrational number that has some re-
299.
markable geometrical expressions," Scientic American 201, 2 (August
1959), 128{134. Reprinted with additions in his book The 2nd Scientic
American Book of Mathematical Puzzles & Diversions, 1961, 89{103.
137 Martin Gardner, \On the paradoxical situations that arise from nontran-
410.
sitive relations," Scientic American 231, 4 (October 1974), 120{124. Re-
printed with additions in his book Time Travel and Other Mathematical
Bewilderments, 1988, 55{69.
138 Martin Gardner, \From rubber ropes to rolling cubes, a miscellany of
634.
refreshing problems," Scientic American 232, 3 (March 1975), 112{114;
232, 4 (April 1975), 130, 133. Reprinted with additions in his book Time
Travel and Other Mathematical Bewilderments, 1988, 111{124.
139 Martin Gardner, \On checker jumping, the amazon game, weird dice,
636.
card tricks and other playful pastimes," Scientic American 238, 2
(February 1978), 19, 22, 24, 25, 30, 32. Reprinted with additions in his
book Penrose Tiles to Trapdoor Ciphers, 1989, 265{280.
140 J. Garfunkel, \Problem E 1816: An inequality related to Stirling's for-
636.
mula," American Mathematical Monthly 74 (1967), 202.
141 George Gasper and Mizan Rahman, Basic Hypergeometric Series. Cam-
223.
bridge University Press, 1990.

B BIBLIOGRAPHY 615
142 C. F. Gauss, Disquisitiones Arithmetic. Leipzig, 1801. Reprinted in his
123, 633.
Werke, volume 1.
143 Carolo Friderico Gauss, \Disquisitiones generales circa seriem innitam
207, 222, 529, 634.
1 + Œ±Œ≤
1 . Œ≥ x + Œ±(Œ± + 1)Œ≤(Œ≤ + 1)
1 . 2 . Œ≥(Œ≥ + 1) xx
+ Œ±(Œ± + 1)(Œ± + 2)Œ≤(Œ≤ + 1)(Œ≤ + 2)
1 . 2 . 3 . Œ≥(Œ≥ + 1)(Œ≥ + 2)
x3 + etc.
Pars prior," Commentationes societatis regi scientiarum Gottingensis
recentiores 2 (1813). (Thesis delivered to the Royal Society in Gottingen,
20 January 1812.) Reprinted in his Werke, volume 3, 123{163, together
with an unpublished sequel on pages 207{229.
144 C. F. Gauss, \Pentagramma miricum," written prior to 1836. Published
633.
posthumously in his Werke, volume 3, 480{490.
145 A. Genocchi, \Intorno all' expressioni generali di numeri Bernoulliani,"
551.
Annali di Scienze Matematiche e Fisiche 3 (1852), 395{405.
146 Ira Gessel, \Some congruences for Apery numbers," Journal of Number
634.
Theory 14 (1982), 362{368.
147 Ira Gessel and Richard P. Stanley, \Stirling polynomials," Journal of
270.
Combinatorial Theory, series A, 24 (1978), 24{33.
148 Jekuthiel Ginsburg, \Note on Stirling's numbers," American Mathemat-
271.
ical Monthly 35 (1928), 77{80.
149 J. W. L. Glaisher, \On the product 11.22.33 . . . nn, Messenger of Mathe-
636.
matics 7 (1877), 43{47.
150 Solomon W. Golomb, \Problem 5407: A nondecreasing indicator func-
603, 633.
tion," American Mathematical Monthly 74 (1967), 740{743.
151 Solomon W. Golomb, \The `Sales Tax' theorem," Mathematics Magazine
507.
49 (1976), 187{189.
152 Solomon W. Golomb, \Problem E 2529: An application of œà(x)," Amer-
460.
ican Mathematical Monthly 83 (1976), 487{488.
153 I. J. Good, \Short proof of a conjecture by Dyson," Journal of Mathe-
634.
matical Physics 11 (1970), 1884.
154 R. William Gosper, Jr., \Decision procedure for indenite hypergeo-
224, 634.
metric summation," Proceedings of the National Academy of Sciences
of the United States of America 75 (1978), 40{42.
155 R. L. Graham, \On a theorem of Uspensky," American Mathematical
513.
Monthly 70 (1963), 407{409.

616 BIBLIOGRAPHY
156 R. L. Graham, \A Fibonacci-like sequence of composite numbers," Math-
635.
ematics Magazine 37 (1964), 322{324.
157 R. L. Graham, \Problem 5749," American Mathematical Monthly 77
634.
(1970), 775.
158 Ronald L. Graham, \Covering the positive integers by disjoint sets of
514.
the form f [nŒ± + Œ≤] : n = 1, 2, . . . g," Journal of Combinatorial Theory,
series A, 15 (1973), 354{358.
159 R. L. Graham, \Problem 1242: Bijection between integers and compos-
633.
ites," Mathematics Magazine 60 (1987), 180.
160 R. L. Graham and D. E. Knuth, \Problem E 2982: A double innite sum
633.
for jxj," American Mathematical Monthly 96 (1989), 525{526.
161 Ronald L. Graham, Donald E. Knuth, and Oren Patashnik, Concrete
102.
Mathematics: A Foundation for Computer Science.
Addison-Wesley,
1989; second edition, 1994.
162 R. L. Graham and H. O. Pollak, \Note on a nonlinear recurrence related
633.
to
‚àö
2," Mathematics Magazine 43 (1970), 143{145.
163 Guido Grandi, letter to Leibniz (July 1713), in Leibnizens mathematische
58.
Schriften, volume 4, 215{217.
164 Daniel H. Greene and Donald E. Knuth, Mathematics for the Analysis
535, 636.
of Algorithms. Birkhauser, Boston, 1981; third edition, 1990.
165 Samuel L. Greitzer, International Mathematical Olympiads, 1959{1977.
633.
Mathematical Association of America, 1978.
166 Oliver A. Gross, \Preferential arrangements," American Mathematical
635.
Monthly 69 (1962), 4{8.
167 Branko Grunbaum, \Venn diagrams and independent families of sets,"
498.
Mathematics Magazine 48 (1975), 12{23.
168 L. J. Guibas and A. M. Odlyzko, \String overlaps, pattern matching, and
590, 636.
nontransitive games," Journal of Combinatorial Theory, series A, 30
(1981), 183{208.
169 Richard K. Guy, Unsolved Problems in Number Theory.
Springer-
525.
Verlag, 1981.
170 Inger Haland and Donald E. Knuth, \Polynomials involving the oor
514, 633.
function," submitted for publication, 1993.
171 Marshall Hall, Jr., The Theory of Groups. Macmillan, 1959.
553.
172 P. R. Halmos, \How to write mathematics," L'Enseignement mathema-
vi.
tique 16 (1970), 123{152. Reprinted in How to Write Mathematics,
American Mathematical Society, 1973, 19{48.

B BIBLIOGRAPHY 617
173 Paul R. Halmos, I Want to Be a Mathematician: An Automathography.
v.
Springer-Verlag, 1985. Reprinted by Mathematical Association of Amer-
ica, 1988.
174 G. H. Halphen, \Sur des suites de fractions analogues a la suite de Farey,"
305.
Bulletin de la Societe mathematique de France 5 (1876), 170{175. Re-
printed in his uvres, volume 2, 102{107.
175 Hans Hamburger, \Uber eine Erweiterung des Stieltjesschen Momenten-
591.
problems," Mathematische Annalen 81 (1920), 235{319; 82 (1921), 120{
164, 168{187.
176 J. M. Hammersley, \On the enfeeblement of mathematical skills by `Mod-
v.
ern Mathematics' and by similar soft intellectual trash in schools and
universities," Bulletin of the Institute of Mathematics and its Applica-
tions 4, 4 (October 1968), 66{85.
177 J. M. Hammersley, \An undergraduate exercise in manipulation," The
636.
Mathematical Scientist 14 (1989), 1{23.
178 Eldon R. Hansen, A Table of Series and Products. Prentice-Hall, 1975.
42.
179 G. H. Hardy, Orders of Innity: The `Innitarcalcul' of Paul du Bois-
442, 636.
Reymond. Cambridge University Press, 1910; second edition, 1924.
180 G. H. Hardy, \A mathematical theorem about golf," The Mathematical
636.
Gazette 29 (1944), 226{227. Reprinted in his Collected Papers, volume 7,
488.
181 G. H. Hardy and E. M. Wright, An Introduction to the Theory of Num-
111, 633.
bers. Clarendon Press, Oxford, 1938; fth edition, 1979.
182 Peter Henrici, Applied and Computational Complex Analysis. Wiley,
300, 332, 602, 636.
volume 1, 1974; volume 2, 1977; volume 3, 1986.
183 Peter Henrici, \De Branges' proof of the Bieberbach conjecture: A view
634.
from computational analysis," Sitzungsberichte der Berliner Mathema-
tischen Gesellschaft (1987), 105{121.
184 Charles Hermite, letter to C. W. Borchardt (8 September 1875), in Jour-
555.
nal fur die reine und angewandte Mathematik 81 (1876), 93{95. Re-
printed in his uvres, volume 3, 211{214.
185 Charles Hermite, Cours de M. Hermite. Faculte des Sciences de Paris,
634.
1882. Third edition, 1887; fourth edition, 1891.
186 Charles Hermite, letter to S. Pincherle (10 May 1900), in Annali di
538, 634.
Matematica pura ed applicata, series 3, 5 (1901), 57{60. Reprinted in
his uvres, volume 4, 529{531.

618 BIBLIOGRAPHY
187 I. N. Herstein and I. Kaplansky, Matters Mathematical. Harper & Row,
8.
1974.
188 A. P. Hillman and V. E. Hoggatt, Jr., \A proof of Gould's Pascal hexagon
634.
conjecture," Fibonacci Quarterly 10 (1972), 565{568, 598.
189 C. A. R. Hoare, \Quicksort," The Computer Journal 5 (1962), 10{15.
28.
190 L. C. Hsu, \Note on a combinatorial algebraic identity and its applica-
634.
tion," Fibonacci Quarterly 11 (1973), 480{484.
191 Kenneth E. Iverson, A Programming Language. Wiley, 1962.
24, 67, 633.
192 C. G. J. Jacobi, Fundamenta nova theori functionum ellipticarum.
64.
Konigsberg, Borntrager, 1829. Reprinted in his Gesammelte Werke, vol-
ume 1, 49{239.
193 Svante Janson, Donald E. Knuth, Tomasz  Luczak, and Boris Pittel, \The
202.
birth of the giant component," Random Structures and Algorithms 4
(1993), 233{358.
194 Dov Jarden and Theodor Motzkin, \The product of sequences with a
556.
common linear recursion formula of order 2," Riveon Lematematika 3
(1949), 25{27, 38 (Hebrew with English summary). English version re-
printed in Dov Jarden, Recurring Sequences, Jerusalem, 1958, 42{45;
second edition, 1966, 30{33.
195 Arne Jonassen and Donald E. Knuth, \A trivial algorithm whose analysis
535.
isn't," Journal of Computer and System Sciences 16 (1978), 301{322.
196 Bush Jones, \Note on internal merging," Software | Practice and Expe-
175.
rience 2 (1972), 241{243.
197 Flavius Josephus, ITOPIA IOAIKO OEMO PO P
-
8.
MAIO. English translation, History of the Jewish War against the
Romans, by H. St. J. Thackeray, in the Loeb Classical Library edition
of Josephus's works, volumes 2 and 3, Heinemann, London, 1927{1928.
(The \Josephus problem" may be based on an early manuscript now pre-
served only in the Slavonic version; see volume 2, page xi, and volume 3,
page 654.)
198 R. Jungen, \Sur les series de Taylor n'ayant que des singularites
635.
algebrico-logarithmiques sur leur cercle de convergence," Commentarii
Mathematici Helvetici 3 (1931), 266{306.
199 J. Karamata, \Theoremes sur la sommabilite exponentielle et d'autres
257.
sommabilites rattachant," Mathematica (Cluj) 9 (1935), 164{178.
200 I. Kaucky, \Problem E 2257: A harmonic identity," American Mathe-
635.
matical Monthly 78 (1971), 908.

B BIBLIOGRAPHY 619
201 J. B. Keiper, \Power series expansions of Riemann's Œæ function," Math-
601.
ematics of Computation 58 (1992), 765{773.
202 Murray S. Klamkin, International Mathematical Olympiads, 1978{1985,
633, 635.
and Forty Supplementary Problems. Mathematical Association of Amer-
ica, 1986.
203 R. Arthur Knoebel, \Exponentials reiterated," American Mathematical
202.
Monthly 88 (1981), 235{252.
204 Konrad Knopp, Theorie und Anwendung der unendlichen Reihen. Julius
636.
Springer, Berlin, 1922; second edition, 1924. Reprinted by Dover, 1945.
Fourth edition, 1947; fth edition, 1964. English translation, Theory and
Application of Innite Series, 1928; second edition, 1951.
205 Donald E. Knuth, \Euler's constant to 1271 places," Mathematics of
481.
Computation 16 (1962), 275{281.
206 Donald Knuth, \Transcendental numbers based on the Fibonacci se-
553.
quence," Fibonacci Quarterly 2 (1964), 43{44, 52.
207 Donald E. Knuth, The Art of Computer Programming, volume 1: Fun-
vi, 500, 514, 530,
573, 633, 634, 635,
636.
damental Algorithms. Addison-Wesley, 1968; second edition, 1973.
208 Donald E. Knuth, The Art of Computer Programming, volume 2: Semi-
110, 128, 500, 633,
635, 636.
numerical Algorithms. Addison-Wesley, 1969; second edition, 1981.
209 Donald E. Knuth, The Art of Computer Programming, volume 3: Sorting
267, 411, 501, 634,
635, 636.
and Searching. Addison-Wesley, 1973; second printing, 1975.
210 Donald E. Knuth, \Problem E 2492: Some sum," American Mathematical
634.
Monthly 82 (1975), 855.
211 Donald E. Knuth, Mariages stables et leurs relations avec d'autres
636.
problemes combinatoires. Les Presses de l'Universite de Montreal, 1976.
Revised and corrected edition, 1980.
212 Donald E. Knuth, The TEXbook. Addison-Wesley, 1984. Reprinted as
633.
volume A of Computers & Typesetting, 1986.
213 Donald E. Knuth, \An analysis of optimum caching," Journal of Algo-
564.
rithms 6 (1985), 181{199.
214 Donald E. Knuth, Computers & Typesetting, volume D: METAFONT:
633.
The Program. Addison-Wesley, 1986.
215 Donald E. Knuth, \Problem 1280: Floor function identity," Mathematics
633.
Magazine 61 (1988), 319{320.
216 Donald E. Knuth, \Problem E 3106: A new sum for n2," American Math-
634.
ematical Monthly 94 (1987), 795{797.

620 BIBLIOGRAPHY
217 Donald E. Knuth, \Fibonacci multiplication," Applied Mathematics Let-
635.
ters 1 (1988), 57{60.
218 Donald E. Knuth, \A Fibonacci-like sequence of composite numbers,"
562.
Mathematics Magazine 63 (1990), 21{25.
219 Donald E. Knuth, \Problem E 3309: A binomial coecient inequality,"
634.
American Mathematical Monthly 97 (1990), 614.
220 Donald E. Knuth, \Two notes on notation," American Mathematical
24, 162, 267.
Monthly 99 (1992), 403{422.
221 Donald E. Knuth, \Convolution polynomials," The Mathematica Journal
267, 566, 635.
2,4 (Fall 1992), 67{78.
222 Donald E. Knuth, \Johann Faulhaber and sums of powers," Mathematics
288.
of Computation 61 (1993), 277{294.
223 Donald E. Knuth, \Bracket notation for the coecient-of operator," in
197.
A Classical Mind, essays in honour of C. A. R. Hoare, edited by A. W.
Roscoe, Prentice-Hall, 1994, 247{258.
224 Donald E. Knuth and Thomas J. Buckholtz, \Computation of Tangent,
555.
Euler, and Bernoulli numbers," Mathematics of Computation 21 (1967),
663{688.
225 Donald E. Knuth and Ilan Vardi, \Problem 6581: The asymptotic ex-
636.
pansion of the middle binomial coecient," American Mathematical
Monthly 97 (1990), 626{630.
226 Donald E. Knuth and Herbert S. Wilf, \The power of a prime that divides
530, 635.
a generalized binomial coecient," Journal fur die reine und angewandte
Mathematik 396 (1989), 212{219.
227 Donald E. Knuth and Hermann Zapf, \AMS Euler | A new typeface for
viii.
mathematics," Scholarly Publishing 20 (1989), 131{157.
228 C. Kramp, Elemens d'arithmetique universelle. Cologne, 1808.
111.
229 E. E. Kummer, \Ueber die hypergeometrische Reihe
213, 634.
1 + Œ±Œ≤
1 . Œ≥ x + Œ±(Œ± + 1)Œ≤(Œ≤ + 1)
1 . 2 . Œ≥(Œ≥ + 1)
xx
+ Œ±(Œ± + 1)(Œ± + 2)Œ≤(Œ≤ + 1)(Œ≤ + 2)
1 . 2 . 3 . Œ≥(Œ≥ + 1)(Œ≥ + 2)
x3 + . . . ,"
Journal fur die reine und angewandte Mathematik 15 (1836), 39{83,
127{172. Reprinted in his Collected Papers, volume 2, 75{166.

B BIBLIOGRAPHY 621
230 E. E. Kummer, \Uber die Erganzungssatze zu den allgemeinen Re-
634.
ciprocitatsgesetzen," Journal fur die reine und angewandte Mathematik
44 (1852), 93{146. Reprinted in his Collected Papers, volume 1, 485{538.
231 R. P. Kurshan and B. Gopinath, \Recursively generated periodic se-
501.
quences," Canadian Journal of Mathematics 26 (1974), 1356{1371.
232 Thomas Fantet de Lagny, Analyse generale ou Methodes nouvelles pour
304.
resoudre les problemes de tous les genres et de tous les degres a l'inni.
Published as volume 11 of Memoires de l'Academie Royale des Sciences,
Paris, 1733.
233 de la Grange [Lagrange], \Demonstration d'un theoreme nouveau concer-
635.
nant les nombres premiers," Nouveaux Memoires de l'Academie royale
des Sciences et Belles-Lettres, Berlin (1771), 125{137. Reprinted in his
uvres, volume 3, 425{438.
234 de la Grange [Lagrange], \Sur une nouvelle espece de calcul relatif a
470.
la dierentiation & a l'integration des quantites variables," Nouveaux
Memoires de l'Academie royale des Sciences et Belles-Lettres, Berlin
(1772), 185{221. Reprinted in his uvres, volume 3, 441{476.
235 I. Lah, \Eine neue Art von Zahlen, ihre Eigenschaften und Anwendung
634.
in der mathematischen Statistik," Mitteilungsblatt fur Mathematische
Statistik 7 (1955), 203{212.
236 I. H. Lambert, \Observationes vari in Mathesin puram," Acta Hel-
201.
vetica 3 (1758), 128{168. Reprinted in his Opera Mathematica, volume 1,
16{51.
237 Lambert, \Observations analytiques," Nouveaux Memoires de l'Acad-
201.
emie royale des Sciences et Belles-Lettres, Berlin (1770), 225{244. Re-
printed in his Opera Mathematica, volume 2, 270{290.
238 Edmund Landau, Handbuch der Lehre von der Verteilung der Prim-
448, 636.
zahlen, two volumes. Teubner, Leipzig, 1909.
239 Edmund Landau, Vorlesungen uber Zahlentheorie, three volumes. Hirzel,
634.
Leipzig, 1927.
240 P. S. de la Place [Laplace], \Memoire sur les approximations des Formules
466.
qui sont fonctions de tres-grands nombres," Memoires de l'Academie
royale des Sciences de Paris (1782), 1{88. Reprinted in his uvres
Completes 10, 207{291.
241 Adrien-Marie Legendre, Essai sur la Theorie des Nombres. Paris, 1798;
633.
second edition, 1808. Third edition (retitled Theorie des Nombres, in two
volumes), 1830; fourth edition, Blanchard, 1955.

622 BIBLIOGRAPHY
242 D. H. Lehmer, \Tests for primality by the converse of Fermat's theorem,"
633.
Bulletin of the American Mathematical Society, series 2, 33 (1927), 327{
340. Reprinted in his Selected Papers, volume 1, 69{82.
243 D. H. Lehmer, \On Stern's diatomic series," American Mathematical
635.
Monthly 36 (1929), 59{67.
244 D. H. Lehmer, \On Euler's totient function," Bulletin of the American
526.
Mathematical Society, series 2, 38 (1932), 745{751. Reprinted in his
Selected Papers, volume 1, 319{325.
245 G. W. Leibniz, letter to Johann Bernoulli (May 1695), in Leibnizens
168.
mathematische Schriften, volume 3, 174{179.
246 C. G. Lekkerkerker, \Voorstelling van natuurlijke getallen door een som
295.
van getallen van Fibonacci," Simon Stevin 29 (1952), 190{195.
247 Tamas Lengyel, \A combinatorial identity and the world series," SIAM
167.
Review 35 (1993), 294{297.
248 Tamas Lengyel, \On some properties of the series P‚àû
k=0 knxk and the
635.
Stirling numbers of the second kind," submitted for publication, 1993.
249 Li Shan-Lan, Duo J B Lei [Sums of Piles Obtained Inductively]. In his
269.
Zegux Zha Suanxue [Classically inspired meditations on mathematics],
Nanjing, 1867.
250 Elliott H. Lieb, \Residual entropy of square ice," Physical Review 162
636.
(1967), 162{172.
251 J. Liouville, \Sur l'expression œï(n), qui marque combien la suite 1, 2,
136.
3, . . . , n contient de nombres premiers a n," Journal de Mathematiques
pures et appliquees, series 2, 2 (1857), 110{112.
252 B. F. Logan, \The recovery of orthogonal polynomials from a sum of
634.
squares," SIAM Journal on Mathematical Analysis 21 (1990), 1031{1050.
253 B. F. Logan, \Polynomials related to the Stirling numbers," AT&T Bell
635.
Laboratories internal technical memorandum, August 10, 1987.
254 Calvin T. Long and Verner E. Hoggatt, Jr., \Sets of binomial coecients
634.
with equal products," Fibonacci Quarterly 12 (1974), 71{79.
255 Shituo Lou and Qi Yao, \A Chebychev's type of prime number theorem
525.
in a short interval-II," Hardy-Ramanujan Journal 15 (1992), 1{33.
256 Sam Loyd, Cyclopedia of Puzzles. Franklin Bigelow Corporation, Morn-
560.
ingside Press, New York, 1914.
257 E. Lucas, \Sur les rapports qui existent entre la theorie des nombres
633, 634, 635.
et le Calcul integral," Comptes Rendus hebdomadaires des seances de
l'Academie des Sciences (Paris) 82 (1876), 1303{1305.

B BIBLIOGRAPHY 623
258 Edouard Lucas, \Sur les congruences des nombres euleriens et des coef-
634.
cients dierentiels des fonctions trigonometriques, suivant un module
premier," Bulletin de la Societe mathematique de France 6 (1878), 49{54.
259 Edouard Lucas, Theorie des Nombres, volume 1. Gauthier-Villars, Paris,
292, 634.
1891.
260 Edouard Lucas, Recreations mathematiques, four volumes.
Gauthier-
1.
Villars, Paris, 1891{1894. Reprinted by Albert Blanchard, Paris, 1960.
(The Tower of Hanoi is discussed in volume 3, pages 55{59.)
261 R. C. Lyness, \Cycles," The Mathematical Gazette 29 (1945), 231{233.
501.
262 R. C. Lyness, \Cycles," The Mathematical Gazette 45 (1961), 207{209.
501.
263 Colin Maclaurin, Collected Letters, edited by Stella Mills. Shiva Pub-
469.
lishing, Nantwich, Cheshire, 1982.
264 P. A. MacMahon, \Application of a theory of permutations in circular
140.
procession to the theory of numbers," Proceedings of the London Math-
ematical Society 23 (1892), 305{313.
265 J.-C. Martzlo, Histoire des Mathematiques Chinoises. Paris, 1988.
269.
266 √ÑIu. V. Mati√Ñasevich, \Diofantovost' perechislimykh mnozhestv," Doklady
294, 635.
Akademii Nauk SSSR 191 (1970), 279{282. English translation, with
amendments by the author, \Enumerable sets are diophantine," Soviet
Mathematics 11 (1970), 354{357.
267 Z. A. Melzak, Companion to Concrete Mathematics. Volume 1, Math-
vi.
ematical Techniques and Various Applications, Wiley, 1973; volume 2,
Mathematical Ideas, Modeling & Applications, Wiley, 1976.
268 N. S. Mendelsohn, \Problem E 2227: Divisors of binomial coecients,"
634.
American Mathematical Monthly 78 (1971), 201.
269 Marini Mersenni, Cogitata Physico-Mathematica. Paris, 1644.
109.
270 F. Mertens, \Ueber einige asymptotische Gesetze der Zahlentheorie,"
139.
Journal fur die reine und angewandte Mathematik 77 (1874), 289{338.
271 Mertens, \Ein Beitrag zur analytischen Zahlentheorie," Journal fur die
23.
reine und angewandte Mathematik 78 (1874), 46{62.
272 W. H. Mills, \A prime representing function," Bulletin of the American
634.
Mathematical Society, series 2, 53 (1947), 604.
273 A. F. Mobius, \Uber eine besondere Art von Umkehrung der Reihen,"
138.
Journal fur die reine und angewandte Mathematik 9 (1832), 105{123.
Reprinted in his Gesammelte Werke, volume 4, 589{612.

624 BIBLIOGRAPHY
274 A. Moessner, \Eine Bemerkung uber die Potenzen der naturlichen
636.
Zahlen," Sitzungsberichte der Mathematisch - Naturwissenschaftliche
Klasse der Bayerischen Akademie der Wissenschaften, 1951, Heft 3, 29.
275 Hugh L Montgomery, \Fluctuations in the mean of Euler's phi function,"
463.
Proceedings of the Indian Academy of Sciences, Mathematical Sciences,
97 (1987), 239{245.
276 Peter L. Montgomery, \Problem E 2686: LCM of binomial coecients,"
634.
American Mathematical Monthly 86 (1979), 131.
277 Leo Moser, \Problem B-6: Some reections," Fibonacci Quarterly 1, 4
291.
(1963), 75{76.
278 T. S. Motzkin and E. G. Straus, \Some combinatorial extremum prob-
564.
lems," Proceedings of the American Mathematical Society 7 (1956),
1014{1021.
279 B. R. Myers, \Problem 5795: The spanning trees of an n-wheel," Amer-
635.
ican Mathematical Monthly 79 (1972), 914{915.
280 Isaac Newton, letter to John Collins (18 February 1670), in The Corre-
277.
spondence of Isaac Newton, volume 1, 27. Excerpted in The Mathemat-
ical Papers of Isaac Newton, volume 3, 563.
281 Ivan Niven, Diophantine Approximations. Interscience, 1963.
633.
282 Ivan Niven, \Formal power series," American Mathematical Monthly 76
332.
(1969), 871{889.
283 Andrew M. Odlyzko and Herbert S. Wilf, \Functional iteration and the
81.
Josephus problem," Glasgow Mathematical Journal 33 (1991), 235{240.
284 Blaise Pascal, \De numeris multiplicibus," presented to Academie Parisi-
624, 633.
enne in 1654 and published with his Traite du triangle arithmetique [285].
Reprinted in uvres de Blaise Pascal, volume 3, 314{339.
285 Blaise Pascal, \Traite du triangle arithmetique," in his Traite du Triangle
155, 156.
Arithmetique, avec quelques autres petits traitez sur la mesme matiere,
Paris, 1665. Reprinted in uvres de Blaise Pascal (Hachette, 1904{1914),
volume 3, 445{503; Latin editions from 1654 in volume 11, 366{390.
286 G. P. Patil, \On the evaluation of the negative binomial distribution with
636.
examples," Technometrics 2 (1960), 501{505.
287 C. S. Peirce, letter to E. S. Holden (January 1901). In The New Elements
634.
of Mathematics, edited by Carolyn Eisele, Mouton, The Hague, 1976,
volume 1, 247{253. (See also page 211.)

B BIBLIOGRAPHY 625
288 C. S. Peirce, letter to Henry B. Fine (17 July 1903). In The New Elements
525.
of Mathematics, edited by Carolyn Eisele, Mouton, The Hague, 1976,
volume 3, 781{784.
(See also \Ordinals," an unpublished manuscript
from circa 1905, in Collected Papers of Charles Sanders Peirce, volume 4,
268{280.)
289 Walter Penney, \Problem 95: Penney-Ante," Journal of Recreational
408.
Mathematics 7 (1974), 321.
290 J. K. Percus, Combinatorial Methods. Springer-Verlag, 1971.
636.
291 Marko Petkovsek, \Hypergeometric solutions of linear recurrences with
229, 575, 634.
polynomial coecients," Journal of Symbolic Computation 14 (1992),
243{264.
292 J. F. Pfa, \Observationes analytic ad L. Euleri institutiones calculi
207, 214, 217, 634.
integralis, Vol. IV, Supplem. II & IV," Nova acta academi scientiarum
imperialis Petropolitan 11, Histoire section, 37{57.
(This volume,
printed in 1798, contains mostly proceedings from 1793, although Pfa's
memoir was actually received in 1797.)
293 L. Pochhammer, \Ueber hypergeometrische Functionen nter Ordnung,"
48.
Journal fur die reine und angewandte Mathematik 71 (1870), 316{352.
294 H. Poincare, \Sur les fonctions a espaces lacunaires," American Journal
636.
of Mathematics 14 (1892), 201{221.
295 S. D. Poisson, \Memoire sur le calcul numerique des integrales denies,"
471.
Memoires de l'Academie Royale des Sciences de l'Institut de France,
series 2, 6 (1823), 571{602.
296 G. Polya,\Kombinatorische Anzahlbestimmungen fur Gruppen, Graphen
635.
und chemische Verbindungen," Acta Mathematica 68 (1937), 145{254.
English translation, with commentary by Ronald C. Read, Combinatorial
Enumeration of Groups, Graphs, and Chemical Compounds, Springer-
Verlag, 1987.
297 George Polya, Induction and Analogy in Mathematics. Princeton Uni-
vi, 16, 508, 633.
versity Press, 1954.
298 G. Polya, \On picture-writing," American Mathematical Monthly 63
327, 635.
(1956), 689{697.
299 G. Polya and G. Szego, Aufgaben und Lehrsatze aus der Analysis, two
636.
volumes. Julius Springer, Berlin, 1925; fourth edition, 1970 and 1971.
English translation, Problems and Theorems in Analysis, 1972 and 1976.
300 R. Rado, \A note on the Bernoullian numbers," Journal of the London
635.
Mathematical Society 9 (1934), 88{90.

626 BIBLIOGRAPHY
301 Earl D. Rainville, \The contiguous function relations for pFq with appli-
529.
cations to Bateman's Ju,v
n
and Rice's Hn(Œ∂, p, v)," Bulletin of the Amer-
ican Mathematical Society, series 2, 51 (1945), 714{723.
302 George N. Raney, \Functional composition patterns and power series re-
359, 635.
version," Transactions of the American Mathematical Society 94 (1960),
441{451.
303 D. Rameswar Rao, \Problem E 2208: A divisibility problem," American
633.
Mathematical Monthly 78 (1971), 78{79.
304 John William Strutt, Third Baron Rayleigh, The Theory of Sound. First
77.
edition, 1877; second edition, 1894. (The cited material about irrational
spectra is from section 92a of the second edition.)
305 Robert Recorde, The Whetstone of Witte. London, 1557.
446.
306 Simeon Reich, \Problem 6056: Truncated exponential-type series,"
636.
American Mathematical Monthly 84 (1977), 494{495.
307 Georges de Rham, \Un peu de mathematiques a propos d'une courbe
635.
plane," Elemente der Mathematik 2 (1947), 73{76, 89{97. Reprinted in
his uvres Mathematiques, 678{689.
308 Paolo Ribenboim, 13 Lectures on Fermat's Last Theorem.
Springer-
555, 634.
Verlag, 1979.
309 Bernhard Riemann, \Ueber die Darstellbarkeit einer Function durch
633.
eine trigonometrische Reihe," Habilitationsschrift, Gottingen, 1854. Pub-
lished in Abhandlungen der mathematischen Classe der Koniglichen
Gesellschaft der Wissenschaften zu Gottingen 13 (1868), 87{132. Re-
printed in his Gesammelte Mathematische Werke, 227{264.
310 Samuel Roberts, \On the gures formed by the intercepts of a system of
633.
straight lines in a plane, and on analogous relations in space of three di-
mensions," Proceedings of the London Mathematical Society 19 (1889),
405{422.
311 ystein Rdseth, \Problem E 2273: Telescoping Vandermonde convolu-
634.
tions," American Mathematical Monthly 79 (1972), 88{89.
312 J. Barkley Rosser and Lowell Schoenfeld, \Approximate formulas for
111.
some functions of prime numbers," Illinois Journal of Mathematics 6
(1962), 64{94.
313 Gian-Carlo Rota, \On the foundations of combinatorial theory. I. The-
516.
ory of Mobius functions," Zeitschrift fur Wahrscheinlichkeitstheorie und
verwandte Gebiete 2 (1964), 340{368.
314 Ranjan Roy, \Binomial identities and hypergeometric series," American
634.
Mathematical Monthly 94 (1987), 36{46.

B BIBLIOGRAPHY 627
315 Louis Saalschutz, \Eine Summationsformel," Zeitschrift fur Mathematik
214.
und Physik 35 (1890), 186{188.
316 A. I. Saltykov, \O funktsii Elera," Vestnik Moskovskogo Universiteta,
463.
series 1, Matematika, Mekhanika (1960), number 6, 34{50.
317 A. Sarkozy, \On divisors of binomial coecients, I," Journal of Number
548.
Theory 20 (1985), 70{80.
318 W. W. Sawyer, Prelude to Mathematics. Baltimore, Penguin, 1955.
207.
319 O. Schlomilch, \Ein geometrisches Paradoxon," Zeitschrift fur Mathe-
293.
matik und Physik 13 (1868), 162.
320 Ernst Schroder, \Vier combinatorische Probleme," Zeitschrift fur Mathe-
635.
matik und Physik 15 (1870), 361{376.
321 Heinrich Schroter, \Ableitung der Partialbruch- und Produkt-Entwicke-
635.
lungen fur die trigonometrischen Funktionen," Zeitschrift fur Mathe-
matik und Physik 13 (1868), 254{259.
322 R. S. Scorer, P. M. Grundy, and C. A. B. Smith, \Some binary games,"
633.
The Mathematical Gazette 28 (1944), 96{103.
323 J. Sedlacek, \On the skeletons of a graph or digraph," in Combinatorial
635.
Structures and their Applications, Gordon and Breach, 1970, 387{391.
(This volume contains proceedings of the Calgary International Confer-
ence of Combinatorial Structures and their Applications, 1969.)
324 J. O. Shallit, \Problem 6450: Two series," American Mathematical
635.
Monthly 92 (1985), 513{514.
325 R. T. Sharp, \Problem 52: Overhanging dominoes," Pi Mu Epsilon Jour-
273.
nal 1, 10 (1954), 411{412.
326 W. Sierpinski, \Sur la valeur asymptotique d'une certaine somme," Bul-
87.
letin International Academie Polonaise des Sciences et des Lettres (Cra-
covie), series A (1910), 9{11.
327 W. Sierpinski, \Sur les nombres dont la somme de diviseurs est une
634.
puissance du nombre 2," Calcutta Mathematical Society Golden Jubilee
Commemorative Volume (1958{1959), part 1, 7{9.
328 Wac law Sierpinski, A Selection of Problems in the Theory of Numbers.
634.
Macmillan, 1964.
329 David L. Silverman, \Problematical Recreations 447: Numerical links,"
635.
Aviation Week & Space Technology 89, 10 (1 September 1968), 71. Re-
printed as Problem 147 in Second Book of Mathematical Baers, edited
by Angela Fox Dunn, Dover, 1983.

628 BIBLIOGRAPHY
330 N. J. A. Sloane, A Handbook of Integer Sequences. Academic Press, 1973.
42, 341, 464.
Sequel, The New Book of Integer Sequences, Springer, 1994.
331 A. D. Solov'ev, \Odno kombinatornoe tozhdestvo i ego primenenie k
408.
zadache o pervom nastuplenii redkogo sobyti√Ña," Teori√Ña vero√Ñatnoste
i ee primeneni√Ña 11 (1966), 313{320. English translation, \A combina-
torial identity and its application to the problem concerning the rst
occurrence of a rare event," Theory of Probability and its Applications
11 (1966), 276{282.
332 William G. Spohn, Jr., \Can mathematics be saved?" Notices of the
v.
American Mathematical Society 16 (1969), 890{894.
333 Richard P. Stanley, \Dierentiably nite power series," European Jour-
636.
nal of Combinatorics 1 (1980), 175{188.
334 Richard P. Stanley, \On dimer coverings of rectangles of xed width,"
636.
Discrete Applied Mathematics 12 (1985), 81{87.
335 Richard P. Stanley, Enumerative Combinatorics, volume 1. Wadsworth
534, 635, 636.
& Brooks/Cole, 1986.
336 K. G. C. von Staudt, \Beweis eines Lehrsatzes, die Bernoullischen
635.
Zahlen betreend," Journal fur die reine und angewandte Mathematik
21 (1840), 372{374.
337 Guy L. Steele Jr., Donald R. Woods, Raphael A. Finkel, Mark R. Crispin,
124.
Richard M. Stallman, and Georey S. Goodfellow, The Hacker's Dictio-
nary: A Guide to the World of Computer Wizards.
Harper & Row,
1983.
338 J. Steiner, \Einige Gesetze uber die Theilung der Ebene und des
5, 633.
Raumes," Journal fur die reine und angewandte Mathematik 1 (1826),
349{364. Reprinted in his Gesammelte Werke, volume 1, 77{94.
339 M. A. Stern, \Ueber eine zahlentheoretische Funktion," Journal fur die
116.
reine und angewandte Mathematik 55 (1858), 193{220.
340 L. Stickelberger, \Ueber eine Verallgemeinerung der Kreistheilung,"
633.
Mathematische Annalen 37 (1890), 321{367.
341 T. J. Stieltjes, letters to Hermite (June 1885), in Correspondance d'Her-
601.
mite et de Stieltjes, volume 1, 146{159.
342 T. J. Stieltjes, \Table des valeurs des sommes Sk = P‚àû
1 n‚àík," Acta
633.
Mathematica 10 (1887), 299{302. Reprinted in his uvres Completes,
volume 2, 100{103.
343 James Stirling, Methodus Dierentialis. London, 1730. English transla-
192, 258, 297.
tion, The Dierential Method, 1749.

B BIBLIOGRAPHY 629
344 Volker Strehl, \Binomial identities | combinatorial and algorithmic as-
549, 634.
pects," Discrete Mathematics, to appear in 1994.
345 Dura W. Sweeney, \On the computation of Euler's constant," Mathe-
481.
matics of Computation 17 (1963), 170{178.
346 J. J. Sylvester, \Problem 6919," Mathematical Questions with their So-
633.
lutions from the `Educational Times' 37 (1882), 42{43, 80.
347 J. J. Sylvester, \On the number of fractions contained in any `Farey se-
133.
ries' of which the limiting number is given," The London, Edinburgh
and Dublin Philosophical Magazine and Journal of Science, series 5, 15
(1883), 251{257. Reprinted in his Collected Mathematical Papers, vol-
ume 4, 101{109.
348 M. Szegedy, \The solution of Graham's greatest common divisor prob-
525.
lem," Combinatorica 6 (1986), 67{71.
349 S. Tanny, \A probabilistic interpretation of Eulerian numbers," Duke
635.
Mathematical Journal 40 (1973), 717{722.
350 L. Theisinger, \Bemerkung uber die harmonische Reihe," Monatshefte
634.
fur Mathematik und Physik 26 (1915), 132{134.
351 T. N. Thiele, The Theory of Observations.
Charles & Edwin Layton,
397, 398.
London, 1903. Reprinted in The Annals of Mathematical Statistics 2
(1931), 165{308.
352 E. C. Titchmarsh, The Theory of the Riemann Zeta-Function. Clarendon
636.
Press, Oxford, 1951; second edition, revised by D. R. Heath-Brown, 1986.
353 F. G. Tricomi and A. Erdelyi, \The asymptotic expansion of a ratio of
636.
gamma functions," Pacic Journal of Mathematics 1 (1951), 133{142.
354 Peter Ungar, \Problem E 3052: A sum involving Stirling numbers,"
280.
American Mathematical Monthly 94 (1987), 185{186.
355 J. V. Uspensky, \On a problem arising out of the theory of a certain
633.
game," American Mathematical Monthly 34 (1927), 516{521.
356 Alfred van der Poorten, \A proof that Euler missed . . . Apery's proof of
238.
the irrationality of Œ∂(3), an informal report," The Mathematical Intelli-
gencer 1 (1979), 195{203.
357 A. Vandermonde, \Memoire sur des irrationnelles de dierens ordres avec
169, 634.
une application au cercle," Histoire de l'Academie Royale des Sciences
(1772), part 1, 71{72; Memoires de Mathematique et de Physique, Tires
des Registres de l'Academie Royale des Sciences (1772), 489{498.
358 Ilan Vardi, \The error term in Golomb's sequence," Journal of Number
633, 636.
Theory 40 (1992), 1{11.

630 BIBLIOGRAPHY
359 J. Venn, \On the diagrammatic and mechanical representation of propo-
498, 633.
sitions and reasonings," The London, Edinburgh and Dublin Philosoph-
ical Magazine and Journal of Science, series 5, 9 (1880), 1{18.
360 John Wallis, A Treatise of Angular Sections. Oxford, 1684.
635.
361 Edward Waring, Meditationes Algebrac. Cambridge, 1770; third edi-
635.
tion, 1782.
362 William C. Waterhouse, \Problem E 3117: Even odder than we thought,"
635.
American Mathematical Monthly 94 (1987), 691{692.
363 Frederick V. Waugh and Margaret W. Maxeld, \Side-and-diagonal num-
635.
bers," Mathematics Magazine 40 (1967), 74{83.
364 Warren Weaver, \Lewis Carroll and a geometrical paradox," American
293.
Mathematical Monthly 45 (1938), 234{236.
365 H. Weber, \Leopold Kronecker," Jahresbericht der Deutschen Mathe-
521.
matiker-Vereinigung 2 (1892), 5{31. Reprinted in Mathematische An-
nalen 43 (1893), 1{25.
366 Louis Weisner, \Abstract theory of inversion of nite series," Transac-
516.
tions of the American Mathematical Society 38 (1935), 474{484.
367 Edgar M. E. Wermuth, \Die erste Fourierreihe," Mathematische Semes-
603.
terberichte 40 (1993), 133{145.
368 Hermann Weyl, \Uber die Gibbs'sche Erscheinung und verwandte Kon-
87.
vergenzphanomene," Rendiconti del Circolo Matematico di Palermo 30
(1910), 377{407.
369 F. J. W. Whipple, \Some transformations of generalized hypergeometric
634.
series," Proceedings of the London Mathematical Society, series 2, 26
(1927), 257{272.
370 Alfred North Whitehead, An Introduction to Mathematics. London and
503.
New York, 1911.
371 Alfred North Whitehead, \Technical education and its relation to science
91.
and literature," chapter 2 in The Organization of Thought, Educational
and Scientic, London and New York, 1917. Reprinted as chapter 4 of
The Aims of Education and Other Essays, New York, 1929.
372 Alfred North Whitehead, Science and the Modern World.
New York,
603.
1925. Chapter 2 reprinted in The World of Mathematics, edited by
James R. Newman, 1956, volume 1, 402{416.
373 Herbert S. Wilf, generatingfunctionology. Academic Press, 1990.
575, 634.

B BIBLIOGRAPHY 631
374 Herbert S. Wilf and Doron Zeilberger, \An algorithmic proof theory for
240, 241, 634.
hypergeometric (ordinary and `q') multisum/integral identities," Inven-
tiones Mathematicae 108 (1992), 575{633.
375 H. C. Williams and Harvey Dubner, \The primality of R1031," Mathe-
633.
matics of Computation 47 (1986), 703{711.
376 J. Wolstenholme, \On certain properties of prime numbers," Quarterly
635.
Journal of Pure and Applied Mathematics 5 (1862), 35{39.
377 Derick Wood, \The Towers of Brahma and Hanoi revisited," Journal of
633.
Recreational Mathematics 14 (1981), 17{24.
378 J. Worpitzky, \Studien uber dieBernoullischen undEulerschen Zahlen,"
269.
Journal fur die reine und angewandte Mathematik 94 (1883), 203{232.
379 E. M. Wright, \A prime-representing function," American Mathematical
633.
Monthly 58 (1951), 616{618; errata in 59 (1952), 99.
380 Derek A. Zave, \A series expansion involving the harmonic numbers,"
635.
Information Processing Letters 5 (1976), 75{77.
381 E. Zeckendorf, \Representation des nombres naturels par une somme de
295.
nombres de Fibonacci ou de nombres de Lucas," Bulletin de la Societe
Royale des Sciences de Liege 41 (1972), 179{182.
382 Doron Zeilberger, \A holonomic systems approach to special functions
564.
identities," Journal of Computational and Applied Mathematics 32
(1990), 321{368.
383 Doron Zeilberger, \The method of creative telescoping," Journal of Sym-
229.
bolic Computation 11 (1991), 195{204.

C
Credits for Exercises
THE EXERCISES in this book have been drawn from many sources. The
authors have tried to trace the origins of all the problems that have been
published before, except in cases where the exercise is so elementary that its
inventor would probably not think anything was being invented.
Many of the exercises come from examinations in Stanford's Concrete
Mathematics classes. The teaching assistants and instructors often devised
The TA sessions
were invaluable,
I mean really great.
Keep the same
instructor and the
same TAs next year.
Class notes very
good and useful.
I never \got" Stir-
ling numbers.
new problems for those exams, so it is appropriate to list their names here:
Year
Instructor
Teaching Assistant(s)
1970
Don Knuth
Vaughan Pratt
1971
Don Knuth
Leo Guibas
1973
Don Knuth
Henson Graves, Louis Jouaillec
1974
Don Knuth
Scot Drysdale, Tom Porter
1975
Don Knuth
Mark Brown, Luis Trabb Pardo
1976
Andy Yao
Mark Brown, Lyle Ramshaw
1977
Andy Yao
Yossi Shiloach
1978
Frances Yao
Yossi Shiloach
1979
Ron Graham
Frank Liang, Chris Tong, Mark Haiman
1980
Andy Yao
Andrei Broder, Jim McGrath
1981
Ron Graham
Oren Patashnik
1982
Ernst Mayr
Joan Feigenbaum, Dave Helmbold
1983
Ernst Mayr
Anna Karlin
1984
Don Knuth
Oren Patashnik, Alex Schaer
1985
Andrei Broder
Pang Chen, Stefan Sharkansky
1986
Don Knuth
Arif Merchant, Stefan Sharkansky
In addition, David Klarner (1971), Bob Sedgewick (1974), Leo Guibas (1975),
and Lyle Ramshaw (1979) each contributed to the class by giving six or more
guest lectures. Detailed lecture notes taken each year by the teaching assis-
tants and edited by the instructors have served as the basis of this book.
632

C CREDITS FOR EXERCISES 633
1.1
Polya [297, p. 120].
1.2
Scorer, Grundy, and Smith [322].
1.5
Venn [359].
1.6
Steiner [338]; Roberts [310].
1.8
Gauss [144].
1.9
Cauchy [53, note 2, theorem 17].
1.10
Atkinson [16].
1.11
Inspired by Wood [377].
1.14
Steiner [338]; Polya [297, chapter 3];
Brother Alfred [42].
1.17
Dudeney [87, puzzle 1].
1.21
Ball [20] credits B. A. Swinden.
1.22
Based on an idea of Peter Shor.*
1.23
Bjorn Poonen.*
1.25
Frame, Stewart, and Dunkel [130].
2.2
Iverson [191, p. 11].
2.3
[207, exercise 1.2.3{2].
2.5
[207, exercise 1.2.3{25].
2.22
Binet [30, ¬ß4].
2.23
1982 nal.
2.26
[207, exercise 1.2.3{26].
2.29
1979 midterm.
2.30
1973 midterm.
2.31
Stieltjes [342].
2.34
Riemann [309, ¬ß3].
2.35
Euler [106] gave a fallacious \proof"
using divergent series.
2.36
Golomb [150]; Vardi [358].
2.37
Leo Moser.*
3.6
Ernst Mayr, 1982 homework.
3.8
Dirichlet [80].
3.9
Chace [54]; Fibonacci [122, pp. 77{
83].
3.12
[207, exercise 1.2.4{48(a)].
3.13
Beatty [22]; Niven [281, theorem 3.7].
3.19
[207, exercise 1.2.4{34].
3.21
1975 midterm.
3.23
[207, exercise 1.2.4{41].
3.28
Brown [45].
3.30
Aho and Sloane [4].
3.31
Greitzer [165, problem 1972/3,
solution 2].
3.32
[160].
3.33
1984 midterm.
3.34
1970 midterm.
3.35
1975 midterm.
3.36
1976 midterm.
3.37
1986 midterm; [215].
3.38
1974 midterm.
3.39
1971 midterm.
3.40
1980 midterm.
3.41
Klamkin [202, problem 1978/3].
3.42
Uspensky [355].
3.45
Aho and Sloane [4].
3.46
Graham and Pollak [162].
3.48
Haland and Knuth [170].
3.49
R. L. Graham and D. R. Hofstadter.*
3.52
Fraenkel [128].
3.53
S. K. Stein.*.
4.4
[214, ¬ß526].
4.16
Sylvester [346].
4.19
[212, pp. 148{149].
4.20
Bertrand [27, p. 129]; Chebyshev [56];
Wright [379].
4.22
Brillhart [39]; Williams and Dub-
ner [375]; Dubner [86].
4.23
Crowe [68].
4.24
Legendre [241, second edition,
introduction].
4.26
[208, exercise 4.5.3{43].
4.31
Pascal [284].
4.36
Hardy and Wright [181, ¬ß14.5].
4.37
Aho and Sloane [4].
4.38
Lucas [257].
4.39
[159].
4.40
Stickelberger [340].
4.41
Legendre [241, ¬ß135]; Hardy and
Wright [181, theorem 82].
4.42
[208, exercise 4.5.1{6].
4.44
[208, exercise 4.5.3{39].
4.45
[208, exercise 4.3.2{13].
4.47
Lehmer [242].
4.48
Gauss [142, ¬ß78]; Crelle [67].
4.52
1974 midterm.
4.53
1973 midterm, inspired by Rao [303].
4.54
1974 midterm.

634 CREDITS FOR EXERCISES
4.56
Logan [252, eq. (6.15)].
4.57
A special case appears in [216].
4.58
Sierpinski [327].
4.59
Curtiss [70]; Erd}os [93].
4.60
Mills [272].
4.61
[207, exercise 1.3.2{19].
4.63
Barlow [21]; Abel [1].
4.64
Peirce [287].
4.66
Ribenboim [308]; Sierpinski [328,
problem P2
10].
4.67
[157].
4.69
Cramer [66].
4.70
Paul Erd}os.*
4.71
[95, p. 96].
4.72
[95, p. 103].
4.73
Landau [239, volume 2, eq. 648].
5.1
Forcadel [126].
5.3
Long and Hoggatt [254].
5.5
1983 in-class nal.
5.13
1975 midterm.
5.14
[207, exercise 1.2.6{20].
5.15
Dixon [81].
5.21
Euler [99].
5.25
Gauss [143, ¬ß7].
5.28
Euler [118].
5.29
Kummer [229, eq. 26.4].
5.31
Gosper [154].
5.34
Bailey [18, ¬ß10.4].
5.36
Kummer [230, p. 116].
5.37
Vandermonde [357].
5.38
[207, exercise 1.2.6{16].
5.40
Rdseth [311].
5.43
Pfa [292]; [207, exercise 1.2.6{31].
5.48
Ranjan Roy.*
5.49
Roy [314, eq. 3.13].
5.53
Gauss [143]; Richard Askey.*
5.58
Frazer and McKellar [133].
5.59
Stanford Computer Science Compre-
hensive Exam, Winter 1987.
5.60
[207, exercise 1.2.6{41].
5.61
Lucas [258].
5.62
1971 midterm.
5.63
1974 midterm.
5.64
1980 midterm.
5.65
1983 midterm.
5.66
1984 midterm.
5.67
1976 midterm.
5.68
1985 midterm.
5.69
Lyle Ramshaw, guest lecture in 1986.
5.70
Andrews [9, theorem 5.4].
5.71
Wilf [373, exercise 4.16].
5.72
Hermite [185].
5.74
1979 midterm.
5.75
1971 midterm.
5.76
[207, exercise 1.2.6{59 (corrected)].
5.77
1986 midterm.
5.78
[210].
5.79
Mendelsohn [268]; Montgomery [276].
5.81
1986 nal exam; [219].
5.82
Hillman and Hoggatt [188].
5.85
Hsu [190].
5.86
Good [153].
5.88
Hermite [186].
5.91
Whipple [369].
5.92
Clausen [60], [61].
5.93
Gosper [154].
5.95
Petkovsek [291, Corollary 3.1].
5.96
Petkovsek [291, Corollary 5.1].
5.98
Ira Gessel.*
5.102 H. S. Wilf.*
5.104 Volker Strehl.*
5.105 Henrici [183, p. 118].
5.108 Apery [14].
5.109 Gessel [146].
5.110 R. William Gosper, Jr.*
5.111 [95, p. 71].
5.112 [95, p. 71].
5.113 Wilf and Zeilberger [374].
5.114 Strehl [344] credits A. Schmidt.
6.6
Fibonacci [122, p. 283].
6.15
[209, exercise 5.1.3{2].
6.21
Theisinger [350].
6.25
Gardner [138] credits Denys Wilquin.
6.27
Lucas [257].
6.28
Lucas [259, chapter 18].
6.31
Lah [235]; R. W. Floyd.*

C CREDITS FOR EXERCISES 635
6.35
1977 midterm.
6.37
Shallit [324].
6.39
[207, exercise 1.2.7{15].
6.40
Klamkin [202, problem 1979/1].
6.41
1973 midterm.
6.43
Brooke and Wall [41].
6.44
Mati√Ñasevich [266].
6.46
Francesca [131]; Wallis [360, chap-
ter 4].
6.47
Lucas [257].
6.48
[208, exercise 4.5.3{9(c)].
6.49
Davison [73].
6.50
1985 midterm; Rham [307]; Dijk-
stra [79, pp. 230{232].
6.51
Waring [361]; Lagrange [233]; Wol-
stenholme [376].
6.52
Eswarathasan and Levine [97].
6.53
Kaucky [200] treats a special case.
6.54
Staudt [336]; Clausen [62]; Rado [300].
6.55
Andrews and Uchimura [13].
6.56
1986 midterm.
6.57
1984 midterm, suggested by R. W.
Floyd.*
6.58
[207, exercise 1.2.8{30]; 1982 midterm.
6.59
Burr [47].
6.61
1976 nal exam.
6.62
Borwein and Borwein [36, ¬ß3.7].
6.63
[207, section 1.2.10]; Stanley [335,
proposition 1.3.12].
6.65
Tanny [349].
6.66
[209, exercise 5.1.3{3].
6.67
Chung and Graham [59].
6.68
Logan [253].
6.69
[209, exercise 6.1{13].
6.72
Euler [110, part 2, chapter 8].
6.73
Euler [108, chapters 9 and 10];
Schroter [321].
6.75
Arnold [15].
6.76
Lengyel [248].
6.78
Logan [253].
6.79
Comic section, Boston Herald,
August 21, 1904.
6.80
Silverman and Dunn [329].
6.82
[217].
6.83
[156], modulo a numerical error.
6.85
Burr [47].
6.86
[226.
6.87
[208, exercises 4.5.3{2 and 3].
6.88
Adams and Davison [3].
6.90
Lehmer [243].
6.92
Part (a) is from Eswarathasan and
Levine [97].
7.2
[207, exercise 1.2.9{1].
7.8
Zave [380].
7.9
[207, exercise 1.2.7{22].
7.11
1971 nal exam.
7.12
[209, pp. 63{64].
7.13
Raney [302].
7.15
Bell [24].
7.16
Polya [296, p. 149]; [207, exercise
2.3.4.4{1].
7.19
[221].
7.20
Jungen [198, p. 299] credits A.
Hurwitz.
7.22
Polya [298].
7.23
1983 homework.
7.24
Myers [279]; Sedlacek [323].
7.25
[208, Carlitz's proof of lemma 3.3.3B].
7.26
[207, exercise 1.2.8{12].
7.32
[95, pp. 25{26] credits L. Mirsky and
M. Newman.
7.33
1971 nal exam.
7.34
Tomas Feder.*
7.36
1974 nal exam.
7.37
Euler [109, ¬ß50]; 1971 nal exam.
7.38
Carlitz [49].
7.39
[207, exercise 1.2.9{18].
7.41
Andre [8]; [209, exercise 5.1.4{22].
7.42
1974 nal exam.
7.44
Gross [166]; [209, exercise 5.3.1{3].
7.45
de Bruijn [75].
7.47
Waugh and Maxeld [363].
7.48
1984 nal exam.
7.49
Waterhouse [362].
7.50
Schroder [320]; [207, exercise 2.3.4.4{
31].

636 CREDITS FOR EXERCISES
7.51
Fisher [124]; Percus [290, pp. 89{123];
Stanley [334].
7.52
Hammersley [177].
7.53
Euler [114, part 2, section 2, chapter
6, ¬ß91].
7.54
Moessner [274].
7.55
Stanley [333].
7.56
Euler [113].
7.57
[95, p. 48] credits P. Erd}os and
P. Turan.
8.13
Thomas M. Cover.*
8.15
[207, exercise 1.2.10{17].
8.17
Patil [286].
8.24
John Knuth (age 4) and DEK; 1975
nal.
8.26
[207, exercise 1.3.3{18].
8.27
Fisher [125].
8.29
Guibas and Odlyzko [168].
8.32
1977 nal exam.
8.34
Hardy [180] has an incorrect analysis
leading to the opposite conclusion.
8.35
1981 nal exam.
8.36
Gardner [139] credits George Sicher-
man.
8.38
[208, exercise 3.3.2{10].
8.39
[211, exercise 4.3(a)].
8.41
Feller [120, exercise IX.33].
8.43
[207, sections 1.2.10 and 1.3.3].
8.44
1984 nal exam.
8.46
Feller [120] credits Hugo Steinhaus.
8.47
1974 nal, suggested by \fringe
analysis" of 2-3 trees.
8.48
1979 nal exam.
8.49
Blom [32]; 1984 nal exam.
8.50
1986 nal exam.
8.51
1986 nal exam.
8.53
Feller [120] credits S. N. Bernstein.
8.57
Lyle Ramshaw.*
8.58
Guibas and Odlyzko [168].
9.1
Hardy [179, 1.3(g)].
9.2
Part (c) is from Garfunkel [140].
9.3
[207, exercise 1.2.11.1{6].
9.6
[207, exercise 1.2.11.1{3].
9.8
Hardy [179, 1.2(iv)].
9.9
Landau [238, vol. 1, p. 60].
9.14
[207, exercise 1.2.11.3{6].
9.16
Knopp [204, edition  2, ¬ß64C].
9.18
Bender [25, ¬ß3.1].
9.20
1971 nal exam.
9.24
[164, ¬ß4.1.6].
9.27
Titchmarsh [352].
9.28
Glaisher [149].
9.29
de Bruijn [74, ¬ß3.7].
9.32
1976 nal exam.
9.34
1973 nal exam.
9.35
1975 nal exam.
9.36
1980 class notes.
9.37
[208, eq. 4.5.3{21].
9.38
1977 nal exam.
9.39
1975 nal exam, inspired by
Reich [306].
9.40
1977 nal exam.
9.41
1980 nal exam.
9.42
1979 nal exam.
9.44
Tricomi and Erdelyi [353].
9.46
de Bruijn [74, ¬ß6.3].
9.47
1980 homework; [209, eq. 5.3.1{34].
9.48
1980 nal exam.
9.49
1974 nal exam.
9.50
1984 nal exam.
9.51
[164, ¬ß4.2.1].
9.52
Poincare [294]; Borel [35, p. 27].
9.53
Polya and Szeg}o [299, part 1, problem
140].
9.57
Andrew M. Odlyzko.*
9.58
Henrici [182, exercise 4.9.8].
9.60
[225].
9.62
Caneld [48].
9.63
Vardi [358].
9.65
Comtet [64, chapter 5, exercise 24].
9.66
M. P. Schutzenberger.*
9.67
Lieb [250]; Stanley [335, exercise
4.37(c)].
9.68
Boas and Wrench [33].
* Unpublished personal communication.

INDEX
Index
WHEN AN INDEX ENTRY refers to a page containing a relevant exercise, the
answer to that exercise (in Appendix A) might divulge further information; an
(Grati have been
indexed too.)
answer page is not indexed here unless it refers to a topic that isn't included in
the statement of the relevant exercise. Some notations not indexed here (like
xn, ‚åäx‚åã, and
¬≠n
m
¬Æ
) are listed on pages x and xi, just before the table of contents.
00, 162
‚àö
2 (‚âà1.41421), 100
‚àö
3 (‚âà1.73205), 378
=: imaginary part, 64
L: logarithmico-exponential functions, 442{443
<: real part, 64, 212, 451
Œ≥ (‚âà0.57722), see Euler's constant
Œì, see Gamma function
Œ¥, 47{56
‚àÜ: dierence operator, 47{55, 241, 470{471
œµp(n): largest power of p dividing n, 112{114,
146
Œ∂, see zeta function
œë, 219{221, 310, 347
Œò: Big Theta notation, 448
Œ∫m, see cumulants
¬µ, see Mobius function
ŒΩ, see nu function
œÄ (‚âà3.14159), 26, 70, 146, 244, 485, 564, 596
œÄ(x), see pi function
œÉ: standard deviation, 388; see also Stirling's
constant
œÉn(x), see Stirling polynomials
œÜ (‚âà1.61803): golden ratio, 70, 97, 299{301,
310, 553
œï, see phi function
Œ¶: sum of œï, 137{139, 462{463
‚Ñ¶: Big Omega notation, 448
P-notation, 22{25, 245
Q-notation, 64, 106
V-notation, 65
‚áê‚áí: if and only if, 68
=‚áí: implies, 71
n: divides, 102
nn: exactly divides, 146
‚ä•: is relatively prime to, 115
‚â∫: grows slower than, 440{443
‚âª: grows faster than, 440{443
‚âç: grows as fast as, 442{443
‚àº: is asymptotic to, 8, 428{429
‚âà: approximates, 23
‚â°: is congruent to, 123{126
#: cardinality, 39
!: factorial, 111{115
<: subfactorial, 194{200
. . : interval notation, 73{74
. . . : ellipsis, 21, 50, 108, . . .
Aaronson, Bette Jane, ix
Abel, Niels Henrik, 604, 634
Abramowitz, Milton, 42, 604
absolute convergence, 60{62, 64
absolute error, 452, 455
absolute value of complex number, 64
absorption identities, 157{158, 261
Acton, John Emerich Edward Dalberg, Baron,
66
Adams, William Wells, 604, 635
Addison-Wesley, ix
637

638 INDEX
addition formula for
ƒÖn
k
ƒá
, 158{159
analog for
≈ãn
k
≈ë
, 268
analogs for
¬©n
k
¬™
and
ƒç n
k
ƒè
, 259, 261
dual, 530
Aho, Alfred Vaino, 604, 633
Ahrens, Wilhelm Ernst Martin Georg, 8, 604
Akhiezer, Naum Il'ich, 604
Alfred [Brousseau], Brother Ulbertus, 607, 633
algebraic integers, 106, 147
algorithms, analysis of, 138, 413{426
divide and conquer, 79
Euclid's, 103, 123, 303{304
Fibonacci's, 95, 101
Gosper's, 224{227
Gosper-Zeilberger, 229{241, 254{255
greedy, 101, 295
self-certifying, 104
Alice, 31, 408{410, 430
Allardice, Robert Edgar, 2, 604
ambiguous notation, 245
American Mathematical Society, viii
AMS Euler, ix, 657
analysis of algorithms, 138, 413{426
analytic functions, 196
ancestor, 117, 291
Andre, Antoine Desire, 604, 635
Andrews, George W. Eyre, 215, 330, 530, 575,
605, 634, 635
answers, notes on, 497, 637, viii
anti-derivative operator, 48, 470{471
anti-dierence operator, 48, 54, 470{471
Apery, Roger, 238, 605, 629, 634
numbers, 238{239, 255
approximation, see asymptotics
of sums by integrals, 45, 276{277, 469{475
Archibald, Raymond Clare, 608
argument of hypergeometric, 205
arithmetic progression, 30, 376
oored, 89{94
sum of, 6, 26, 30{31
Armageddon, 85
Armstrong, Daniel Louis (= Satchmo), 80
Arnol'd, Vladimir Igorevich, 605, 635
art and science, 234
ascents, 267{268, 270
Askey, Richard Allen, 634
associative law, 30, 61, 64
asymptotics, 439{496
from convergent series, 451
of Bernoulli numbers, 286, 452
of binomial coecients, 248, 251, 495, 598
of discrepancies, 492, 495
of factorials, 112, 452, 481{482, 491
of harmonic numbers, 276{278, 452, 480{481,
491
of hashing, 426
of nth prime, 110{111, 456{457, 490
of Stirling numbers, 495, 602
of sums, using Euler's summation formula,
469{489
of sums, using tail-exchange, 466{469,
486{489
of sums of powers, 491
of wheel winners, 76, 453{454
table of expansions, 452
usefulness of, 76, 439
Atkinson, Michael David, 605, 633
Austin, Alan Keith, 607
automaton, 405
automorphic numbers, 520
average, 384
of a reciprocal, 432
variance, 423{425
Bn, see Bernoulli numbers
Bachmann, Paul Gustav Heinrich, 443, 462, 605
Bailey, Wilfrid Norman, 223, 548, 605, 634
Ball, Walter William Rouse, 605, 633
Banach, Stefan, 433
Barlow, Peter, 605, 634
Barton, David Elliott, 602, 609
base term, 240
baseball, 73, 148, 195, 519, 648, 653
BASIC, 173, 446
basic fractions, 134, 138
basis of induction, 3, 10{11, 320{321
Bateman, Harry, 626
Baum, Lyman Frank, 581
Beatty, Samuel, 605, 633
bee trees, 291
Beeton, Barbara Ann Neuhaus Friend Smith,
viii
Bell, Eric Temple, 332, 605, 635
numbers, 373, 493, 603
Bender, Edward Anton, 606, 636

INDEX 639
Bernoulli, Jakob (= Jacobi = Jacques = James),
283, 470, 606
numbers, see Bernoulli numbers
polynomials, 367{368, 470{475
polynomials, graphs of, 473
trials, 402; see also coins, ipping
Bernoulli, Johann (= Jean), 622
Bernoulli numbers, 283{290
asymptotics of, 286, 452
calculation of, 288, 620
denominators of, 315
generalized, see Stirling polynomials
generating function for, 285, 351, 365
relation to tangent numbers, 287
table of, 284, 620
Bernshten (= Bernstein), Serge Natanovich,
636
Bertrand, Joseph Louis Francois, 145, 606, 633
postulate, 145, 500, 550
Bessel, Friedrich Wilhelm, functions, 206, 527
Beyer, William Hyman, 606
biased coin, 401
bicycles, 260, 500
Bieberbach, Ludwig, 617
Bienayme, Irenee Jules, 606
Big Ell notation, 444
Big Oh notation, 76, 443{449
Big Omega notation, 448
Big Theta notation, 448
bijection, 39
Bill, 408{410, 430
binary logarithm, 70
binary notation (radix 2), 11{13, 15{16, 70,
113{114
binary partitions, 377
binary search, 121, 183
binary trees, 117
Binet, Jacques Philippe Marie, 299, 303,
606, 633
binomial coecients, 153{242
addition formula, 158{159
asymptotics of, 248, 251, 495, 598
combinatorial interpretation, 153, 158, 160,
169{170
denition, 154, 211
dual, 530
generalized, 211, 318, 530
indices of, 154
middle, 187, 255{256, 495
reciprocal of, 188{189, 246, 254
top ten identities of, 174
wraparound, 250 (exercise 75), 315
binomial convolution, 365, 367
binomial distribution, 401{402, 415, 428, 432
negative, 402{403, 428
binomial number system, 245
binomial series, generalized, 200{204, 243,
252, 363
binomial theorem, 162{163
as hypergeometric series, 206, 221
discovered mechanically, 230{233
for factorial powers, 245
special cases, 163, 199
Blom, Gunnar, 606, 636
bloopergeometric series, 243
Boas, Ralph Philip, Jr., 600, 606, 636, viii
Boggs, Wade Anthony, 195
Bohl, Piers Paul Felix [= Bol', Pirs Georgievich],
87, 606
Bois-Reymond, Paul David Gustav du, 440, 610,
617
Boncompagni, Prince Baldassarre, 613
bootstrapping, 463{466
to estimate nth prime, 456{457
Borchardt, Carl Wilhelm, 617
Borel, Emile Felix Edouard Justin, 606, 636
Borwein, Jonathan Michael, 606, 635
Borwein, Peter Benjamin, 606, 635
bound variables, 22
boundary conditions on sums,
can be dicult, 75, 86
made easier, 24{25, 159
bowling, 6
box principle, 95, 130, 512
bracket notation,
for coecients, 197, 331
for true/false values, 24{25
Brahma, Tower of, 1, 4, 278
Branges, Louis de, 617
Brent, Richard Peirce, 306, 525, 564, 606
bricks, 313, 374
Brillhart, John David, 606, 633
Brocot, Achille, 116, 607
Broder, Andrei Zary, 632, ix
Brooke, Maxey, 607, 635
Brousseau, Brother Alfred, 607, 633
Brown, Mark Robbin, 632
Brown, Morton, 501, 607

640 INDEX
Brown, Roy Howard, ix
Brown, Thomas Craig, 607, 633
Brown, Trivial, 607
Brown, William Gordon, 607
Brown University, ix
Browning, Elizabeth Barrett, 320
Bruijn, Nicolaas Govert de, 444, 447, 500, 609,
635, 636
cycle, 500
bubblesort, 448
Buckholtz, Thomas Joel, 620
Bulwer-Lytton, Edward George Earle Lytton,
Baron, v
Burma-Shave, 541
Burr, Stefan Andrus, 607, 635
calculators, 67, 77, 459
failure of, 344
calculus, vi, 33
nite and innite, 47{56
candy, 36
Caneld, Earl Rodney, 602, 607, 636
cards,
shuing, 437
stacking, 273{274, 280, 309
Carlitz, Leonard, 607, 635
Carroll, Lewis (= Dodgson, Rev. Charles
Lutwidge), 31, 293, 607, 608, 630
carries,
across the decimal point, 70
in divisibility of
ƒÖm+n
m
ƒá
, 245, 536
in Fibonacci number system, 297, 561
Cassini, Jean Dominique, 292, 607
identity, 292{293, 300
identity, converse, 314
identity, generalized, 303, 310
Catalan, Eugene Charles, 203, 361, 607
Catalan numbers, 203
combinatorial interpretations, 358{360,
565, 568
generalized, 361
in sums, 181, 203, 317
table of, 203
Cauchy, Augustin Louis, 607, 633
Cech, Eduard, vi
ceiling function, 67{69
converted to oor, 68, 96
graph of, 68
center of gravity, 273{274, 309
certicate of correctness, 104
Chace, Arnold Buum, 608, 633
Chaimovich, Mark, 608
chain rule, 54, 483
change, 327{330, 374
large amounts of, 344{346, 492
changing the index of summation, 30{31, 39
changing the tails of a sum, 466{469
cheating, viii, 195, 388, 401
not, 158, 323
Chebyshev, Pafnuti L'vovich, 38, 145, 608, 633
inequality, 390{391, 428, 430
monotonic inequalities, 38, 576
cheese slicing, 19
Chen, Pang-Chieh, 632
Chinese Remainder Theorem, 126, 146
Chu Shih-Chieh [= Zhu Shjie], 169
Chung, Fan-Rong King, ix, 608, 635
Clausen, Thomas, 608, 634, 635
product identities, 253
clearly, claried, 417{418, 581
cliches, 166, 324, 357
closed form, 3, 7, 321
for generating functions, 317
not, 108, 573
pretty good, 346
closed interval, 73{74
Cobb, Tyrus Raymond, 195
coecient extraction, 197, 331
Cohen, Henri Jose, 238
coins, 327{330
biased, 401
fair, 401, 430
ipping, 401{410, 430{432, 437{438
spinning, 401
Collingwood, Stuart Dodgson, 608
Collins, John, 624
Colombo, Cristoforo (= Columbus, Christo-
pher), 74
coloring, 496
Columbia University, ix
combinations, 153
common logarithm, 449
commutative law, 30, 61, 64
failure of, 322, 502, 551
relaxed, 31
complete graph, 368
complex factorial powers, 211
complex numbers, 64
roots of unity, 149, 204, 375, 553, 574, 598

INDEX 641
composite numbers, 105, 518
composition of generating functions, 428
computer algebra, 42, 268, 501, 539
Comtet, Louis, 609, 636
Concrete Math Club, 74
concrete mathematics, dened, vi
conditional convergence, 59
conditional probability, 416{419, 424{425
conuent hypergeometric series, 206, 245
congruences, 123{126
Connection Machine, 131
contiguous hypergeometrics, 529
continuants, 301{309, 501
and matrices, 318{319
Euler's identity for, 303, 312
zero parameters in, 314
continued fractions, 301, 304{309, 319
large partial quotients of, 553, 563, 564, 602
convergence,
absolute, 60{62, 64
conditional, 59
of power series, 206, 331, 451, 532
convex regions, 5, 20, 497
convolution, 197, 246, 333, 353{364
binomial, 365, 367
identities for, 202, 272, 373
polynomials, 373
Stirling, 272, 290
Vandermonde, see Vandermonde convolution
Conway, John Horton, 410, 609
cotangent function, 286, 317
counting,
combinations, 153
cycle arrangements, 259{262
derangements, 193{196, 199{200
integers in intervals, 73{74
necklaces, 139{141
parenthesized formulas, 357{359
permutations, 111
permutations by ascents, 267{268
permutations by cycles, 262
set partitions, 258{259
spanning trees, 348{350, 356, 368{369, 374
with generating functions, 320{330
coupon collecting, 583
Cover, Thomas Merrill, 636
Coxeter, Harold Scott Macdonald, 605
Cramer, Carl Harald, 525, 609, 634
Cray X-MP, 109
Crelle, August Leopold, 609, 633
cribbage, 65
Crispin, Mark Reed, 628
Crowe, Donald Warren, 609, 633
crudication, 447
Csirik, Janos Andras, 590, 609
cubes, sum of consecutive, 51, 63, 283, 289, 367
cumulants, 397{401
innite, 576
of binomial distribution, 432
of discrete distribution, 438
of Poisson distribution, 428{429
third and fourth, 429, 579, 589
CUNY (= City University of New York), ix
Curtiss, David Raymond, 609, 634
cycles,
de Bruijn, 500
of beads, 139{140
of permutations, 259{262
cyclic shift, 12
cyclotomic polynomials, 149
D, see derivative operator
Dating Game, 506
David, Florence Nightingale, 602, 609
Davis, Philip Jacob, 609
Davison, John Leslie, 307, 604, 609, 635
de Branges, Louis, 617
de Bruijn, Nicolaas Govert, 444, 447, 500, 609,
635, 636
cycle, 500
de Finetti, Bruno, 24, 613
de Lagny, Thomas Fantet, 304, 621
de Moivre, Abraham, 297, 481, 609
Dedekind, Julius Wilhelm Richard, 136{137, 609
denite sums, analogous to denite integrals,
49{50
deg, 226, 232
degenerate hypergeometric series, 209{210, 216,
222, 247
derangements, 194{196
generating function, 199{200
derivative operator, 47{49
converting between D and ‚àÜ, 470{471
converting between D and œë, 310
with generating functions, 33, 333, 364{365
with hypergeometric series, 219{221
descents, see ascents
dgf: Dirichlet generating function, 370

642 INDEX
dice, 381{384
fair, 382, 417, 429
loaded, 382, 429, 431
nonstandard, 431
pgf for, 399{400
probability of doubles, 427
supposedly fair, 392
Dickson, Leonard Eugene, 510, 609
Dieudonne, Jean Alexandre, 523
dierence operator, 47{55, 241
converting between D and ‚àÜ, 470{471
nth dierence, 187{192, 280{281
nth dierence of product, 571
dierentiably nite power series, 374, 380
dierential operators, see derivative operator,
theta operator
diculty measure for summation, 181
Dijkstra, Edsger Wybe, 173, 609, 635
dimers and dimes, 320, see dominoes and
change
diphages, 434, 438
Dirichlet, Peter Gustav Lejeune, 370, 610, 633
box principle, 95, 130, 512
generating functions, 370{371, 373, 432, 451
probability generating functions, 432
discrepancy, 88{89, 97
and continued fractions, 319, 492, 602
asymptotics of, 492, 495
discrete probability, 381{438
dened, 381
disease, 333
distribution,
of fractional parts, 87
of primes, 111
of probabilities, see probability distributions
of things into groups, 83{85
distributive law, 30, 35, 60, 64
for gcd and lcm, 145
for mod, 83
divergent sums, 57, 60
considered useful, 346{348, 451
illegitimate, 504, 532
divide and conquer, 79
divides exactly, 146
in binomial coecients, 245
in factorials, 112{114, 146
divisibility, 102{105
by 3, 147
of polynomials, 225
Dixon, Alfred Cardew, 610, 634
formula, 214
DNA, Martian, 377
Dodgson, Charles Lutwidge, see Carroll
domino tilings, 320{327, 371, 379
ordered pairs of, 375
Dorothy Gale, 581
double generating functions, see super generat-
ing functions
double sums, 34{41, 246, 249
considered useful, 46, 183{185
faulty use of, 63, 65
innite, 61
over divisors, 105
telescoping, 255
doubloons, 436{437
doubly exponential recurrences, 97, 100,
101, 109
doubly innite sums, 59, 98, 482{483
Dougall, John, 171, 610
downward generalization, 2, 95, 320{321
Doyle, Sir Arthur Conan, 162, 228{229, 405, 610
drones, 291
Drysdale, Robert Lewis (Scot), III, 632
du Bois-Reymond, Paul David Gustav, 440, 610,
617
duality, 69
between
ƒÖn
k
ƒá
and 1/n
ƒÖn‚àí1
k
ƒá
, 530
between factorial and Gamma functions, 211
between oors and ceilings, 68{69, 96
between gcd and lcm, 107
between rising and falling powers, 63
between Stirling numbers of dierent kinds,
267
Dubner, Harvey, 610, 631, 633
Dudeney, Henry Ernest, 610, 633
Dunkel, Otto, 614, 633
Dunn, Angela Fox, 627, 635
Dunnington, Guy Waldo, 610
duplication formulas, 186, 244
Dupre, Lyn Oppenheim, ix
Durst, Lincoln Kearney, viii
Dyson, Freeman John, 172, 239, 610, 615
e (‚âà2.71828),
as canonical constant, 70, 596
representations of, 122, 150
en, see Euclid numbers
E: expected value, 385{386
E: shift operator, 55, 188, 191

INDEX 643
En, see Euler numbers
Edwards, Anthony William Fairbank, 610
eeny-meeny-miny-mo, see Josephus problem
eciency, dierent notions of, 24, 133
egf: exponential generating function, 364
eggs, 158
Egyptian mathematics, 95, 150
bibliography of, 608
Einstein, Albert, 72, 307
Eisele, Carolyn, 624{625
Eisenstein, Ferdinand Gotthold Max, 202, 610
Ekhad, Shalosh B, 546
elementary events, 381{382
Elkies, Noam David, 131, 610
ellipsis (¬∑ ¬∑ ¬∑), 21
advantage of, 21, 25, 50
disadvantage of, 25
elimination of, 108
empirical estimates, 391{393, 427
empty case,
for spanning trees, 349, 565
for Stirling numbers, 258
for tilings, 320{321
for Tower of Hanoi, 2
empty product, 48, 106, 111
empty sum, 24, 48
entier function, see oor function
equality, one-way, 446{447, 489{490
equivalence relation, 124
Eratosthenes, sieve of, 111
Erdelyi, Arthur, 629, 636
Erd}os, Pal (= Paul), 418, 525, 548, 575,
610{611, 634, 636
error function, 166
errors, absolute versus relative, 452, 455
errors, locating our own, 183
Eswarathasan, Arulappah, 611, 635
Euclid (= E ,œÖŒ∫ŒªœµŒπŒ¥Œ∑œÇ), 107{108, 147, 611
algorithm, 103{104, 123, 303{304
numbers, 108{109, 145, 147, 150, 151
Euler, Leonhard, i, vii, ix, 6, 48, 122, 132{134,
202, 205, 207, 210, 267, 277, 278, 286, 299,
301{303, 469, 471, 513, 529, 575, 603, 605,
609, 611{613, 629, 633{636
constant (‚âà0.57722), 278, 306{307, 319,
481, 596
disproved conjecture, 131
identity for continuants, 303, 312
identity for hypergeometrics, 244
numbers, 559, 570, 620; see also Eulerian
numbers
polynomials, 574
pronunciation of name, 147
summation formula, 469{475
theorem, 133, 142, 147
totient function, see phi function
triangle, 268, 316
Eulerian numbers, 267{271, 310, 316, 378, 574
combinatorial interpretations, 267{268, 557
generalized, 313
generating function for, 351
second-order, 270{271
table of, 268
event, 382
eventually positive function, 442
exact cover, 376
exactly divides, 146
in binomial coecients, 245
in factorials, 112{114, 146
excedances, 316
exercises, levels of, viii, 72{73, 95, 511
exp: exponential function, 455
expectation, see expected value
expected value, 385{387
using a pgf, 395
exponential function, discrete analog of, 54
exponential generating functions, 364{369,
421{422
exponential series, generalized, 200{202, 242,
364, 369
exponents, laws of, 52, 63
F, see hypergeometric functions
Fn, see Fibonacci numbers
factorial expansion of binomial coecients, 156,
211
factorial function, 111{115, 346{348
approximation to, see Stirling's approxima-
tion
duplication formula, 244
generalized to nonintegers, 192, 210{211,
213{214, 316
factorial powers, see falling factorial powers,
rising factorial powers
factorization into primes, 106{107, 110
factorization of summation conditions, 36
fair coins, 401, 430
fair dice, 382, 417

644 INDEX
falling factorial powers, 47
binomial theorem for, 245
complex, 211
dierence of, 48, 53, 188
negative, 52, 63, 188
related to ordinary powers, 51, 262{263, 598
related to rising powers, 63, 312
summation of, 50{53
fans, ix, 193, 348
Farey, John, series, 118{119, 617
consecutive elements of, 118{119, 150
distribution of, 152
enumeration of, 134, 137{139, 462{463
Faulhaber, Johann, 288, 613, 620
Feder, Tomas, 635
Feigenbaum, Joan, 632
Feller, William, 381, 613, 636
Fermat, Pierre de, 130, 131, 613
numbers, 131{132, 145, 525
Fermat's Last Theorem, 130{131, 150, 524, 555
Fermat's theorem (= Fermat's Little Theorem),
131{133, 141{143, 149
converse of, 132, 148
Fibonacci, Leonardo, 95, 292, 549, 613, 633, 634
addition, 296{297, 317
algorithm, 95, 101
factorial, 492
multiplication, 561
number system, 296{297, 301, 307, 310, 318
odd and even, 307{308
Fibonacci numbers, 290{301, 575
and continuants, 302
and sunowers, 291
closed forms for, 299{300, 331
combinatorial interpretations of, 291{292,
302, 321, 549
egf for, 570
ordinary generating functions for, 297{300,
337{340, 351
second-order, 375
table of, 290, 293
Fibonomial coecients, 318, 556
Fine, Henry Burchard, 625
Fine, Nathan Jacob, 603
Finetti, Bruno de, 24, 613
nite calculus, 47{56
nite state language, 405
Finkel, Raphael Ari, 628
Fisher, Michael Ellis, 613, 636
Fisher, Sir Ronald Aylmer, 613, 636
xed points, 12, 393{394
pgf for, 400{401, 428
ipping coins, 401{410, 430{432, 437{438
oor function, 67{69
converted to ceiling, 68, 96
graph of, 68
Floyd, Robert W, 634, 635
food, see candy, cheese, eggs, pizza, sherry
football, 182
football victory problem, 193{196, 199{200, 428
generalized, 429
mean and variance, 393{394, 400{401
Forcadel, Pierre, 613, 634
formal power series, 206, 331, 348, 532
FORTRAN, 446
Fourier, Jean Baptiste Joseph, 22, 613
series, 495
fractional parts, 70
in Euler's summation formula, 470
in polynomials, 100
related to mod, 83
uniformly distributed, 87
fractions, 116{123
basic, 134, 138
continued, 301, 304{309, 319, 564
partial, see partial fraction expansions
unit, 95, 150
unreduced, 134{135, 151
Fraenkel, Aviezri S, 515, 563, 613{614, 633
Frame, James Sutherland, 614, 633
Francesca, Piero della, 614, 635
Franel, Jerome, 614
number, 549
Fraser, Alexander Yule, 2, 604
Frazer, William Donald, 614, 634
Fredman, Michael Lawrence, 513, 614
free variables, 22
Freman, Grigori Abelevich, 608
friendly monster, 545
frisbees, 434{435, 437
Frye, Roger Edward, 131
Fundamental Theorem of Algebra, 207
Fundamental Theorem of Arithmetic, 106{107
Fundamental Theorem of Calculus, 48
Fuss, Nicola Ivanovich, 361, 614
Fuss{Catalan numbers, 361
Fuss, Paul Heinrich von [= Fus, Pavel Nikolae-
ich], 611{612

INDEX 645
Gale, Dorothy, 581
games, see bowling, cards, cribbage, dice,
Penny ante, sports
Gamma function, 210{214, 609
duplication formula for, 528
Stirling's approximation for, 482
gaps between primes, 150{151, 525
Gardner, Martin, 614, 634, 636
Garfunkel, Jack, 614, 636
Gasper, George, Jr., 223, 614
Gau (= Gauss), Karl (= Carl) Friedrich, vii,
6, 7, 123, 205, 207, 212, 501, 510, 529, 610,
615, 633, 634
hypergeometric series, 207
identity for hypergeometrics, 222, 247, 539
trick, 6, 30, 112, 313
gcd, 103, see greatest common divisor
generalization, 11, 13, 16
downward, 2, 95, 320{321
generalized binomial coecients, 211, 318, 530
generalized binomial series, 200{204, 243,
252, 363
generalized exponential series, 200{202, 242,
364, 369
generalized factorial function, 192, 210{211,
213{214, 316
generalized harmonic numbers, 277, 283, 286, 370
generalized Stirling numbers, 271{272, 311, 316,
319, 598
generating functions, 196{204, 297{300, 320{380
composition of, 428
Dirichlet, 370{371, 373, 432, 451
exponential, 364{369, 421{422
for Bernoulli numbers, 285, 351, 365
for convolutions, 197, 333{334, 353{364,
369, 421
for Eulerian numbers, 351, 353
for Fibonacci numbers, 297{300, 337{340,
351, 570
for harmonic numbers, 351{352
for minima, 377
for probabilities, 394{401
for simple sequences, 335
for special numbers, 351{353
for spectra, 307, 319
for Stirling numbers, 351{352, 559
Newtonian, 378
of generating functions, 351, 353, 421
super, 353, 421
table of manipulations, 334
Genocchi, Angelo, 615
numbers, 551, 574
geometric progression, 32
oored, 114
generalized, 205{206
sum of, 32{33, 54
Gessel, Ira Martin, 270, 615, 634
Gibbs, Josiah Willard, 630
Gilbert, William Schwenck, 444
Ginsburg, Jekuthiel, 615
Glaisher, James Whitbread Lee, 615, 636
constant (‚âà1.28243), 595
God, 1, 307, 521
Goldbach, Christian, 611{612
theorem, 66
golden ratio, 299, see phi
golf, 431
Golomb, Solomon Wolf, 460, 507, 615, 629, 633
digit-count sum, 460{462, 490 (exercise 22),
494
self-describing sequence, 66, 495
Good, Irving John, 615, 634
Goodfellow, Georey Scott, 628
Gopinath, Bhaskarpillai, 501, 621
Gordon, Peter Stuart, ix
Gosper, Ralph William, Jr., 224, 564, 615, 634
algorithm, 224{227
algorithm, examples, 227{229, 245, 247{248,
253{254, 534
Gosper-Zeilberger algorithm, 229{241, 319
examples, 254{255, 547
summary, 233
goto, considered harmful, 173
Gottschalk, Walter Helbig, vii
grati, vii, ix, 59, 637
Graham, Cheryl, ix
Graham, Ronald Lewis, iii, iv, vi, ix, 102, 506,
608{609, 611, 615{616, 629, 632, 633, 635
Grandi, Luigi Guido, 58, 616
Granville, Andrew James, 548
graph theory, see spanning trees
graphs of functions,
1/x, 262{263
e‚àíx2/10, 483
Bernoulli polynomials, 473
oor and ceiling, 68
hyperbola, 440
partial sums of a sequence, 345{346
Graves, William Henson, 632

646 INDEX
gravity, center of, 273{274, 309
Gray, Frank, code, 497
greatest common divisor, 92, 103{104, 107, 145
greatest integer function, see oor function
greatest lower bound, 65
greed, 74, 387{388; see also rewards
greedy algorithm, 101, 295
Green, Research Sink, 607
Greene, Daniel Hill, 616
Greitzer, Samuel Louis, 616, 633
Gross, Oliver Alfred, 616, 635
Grunbaum, Branko, 498, 616
Grundy, Patrick Michael, 627, 633
Guibas, Leonidas Ioannis (= Leo John), 590,
616, 632, 636
Guy, Richard Kenneth, 523, 525, 616
Hn, see harmonic numbers
Haar, Alfred, vii
Hacker's Dictionary, 124, 628
Haiman, Mark, 632
Haland, Inger Johanne, 616, 633
half-open interval, 73{74
Hall, Marshall, Jr., 616
Halmos, Paul Richard, v, vi, 616{617
Halphen, Georges Henri, 305, 617
halving, 79, 186{187
Hamburger, Hans Ludwig, 591, 617
Hammersley, John Michael, v, 617, 636
Hanoi, Tower of, 1{4, 26{27, 109, 146
variations on, 17{20
Hansen, Eldon Robert, 42, 617
Hardy, Godfrey Harold, 111, 442{443, 617,
633, 636
harmonic numbers, 29, 272{282
analogous to logarithms, 53
asymptotics of, 276{278, 452, 480{481, 491
complex, 311, 316
divisibility of, 311, 314, 319
generalized, 277, 283, 286, 370
generating function for, 351{352
second-order, 277, 280, 311, 550{552
sums of, 41, 313, 316, 354{355
sums using summation by parts, 56, 279{282,
312
table of, 273
harmonic series, divergence of, 62, 275{276
Harry, Matthew Arnold, double sum, 249
hashing, 411{426, 430
hats, see football victory problem
hcf, 103, see greatest common divisor
Heath-Brown, David Rodney, 629
Heiberg, Johan Ludvig, 611
Heisenberg, Werner Karl, 481
Helmbold, David Paul, 632
Henrici, Peter Karl Eugen, 332, 545, 602, 617,
634, 636
Hermite, Charles, 538, 555, 617, 628, 634
herring, red, 497
Herstein, Israel Nathan, 8, 618
hexagon property, 155{156, 242, 251
highest common factor, see greatest common
divisor
Hillman, Abraham P, 618, 634
Hoare, Charles Antony Richard, 28, 73, 618, 620
Hofstadter, Douglas Richard, 633
Hoggatt, Verner Emil, Jr., 618, 622, 634
Holden, Edward Singleton, 624
Holmboe, Berndt Michael, 604
Holmes, Thomas Sherlock Scott, 162, 228{229
holomorphic functions, 196
homogeneous linear equations, 239, 543
horses, 17, 18, 468, 503
Hsu, Lee-Tsch (= Lietz = Leetch) Ching-Siur,
618, 634
Hurwitz, Adolf, 635
hyperbola, 440
hyperbolic functions, 285{286
hyperfactorial, 243, 491
hypergeometric series, 204{223
conuent, 206, 245
contiguous, 529
degenerate, 209{210, 216, 222, 247
dierential equation for, 219{221
Gaussian, 207
partial sums of, 165{166, 223{230, 224, 245
transformations of, 216{223, 247, 253
hypergeometric terms, 224, 243, 245, 527, 575
similar, 541
i, 22
implicit recurrences, 136{139, 193{195, 284
indenite summation, 48{49
by parts, 54{56
of binomial coecients, 161, 223{224, 246,
248, 313
of hypergeometric terms, 224{229

INDEX 647
independent random variables, 384, 427
pairwise, 437
products of, 386
sums of, 386, 396{398
index set, 22, 30, 61
index variable, 22, 34, 60
induction, 3, 7, 10{11, 43
backwards, 18
basis of, 3, 320{321
failure of, 17, 575
important lesson about, 508, 549
inductive leap, 4, 43
innite sums, 56{62, 64
doubly, 59, 98, 482{483
information retrieval, 411{413
INT function, 67
insurance agents, 391
integer part, 70
integration, 45{46, 48
by parts, 54, 472
of generating functions, 333, 365
interchanging the order of summation, 34{41,
105, 136, 183, 185, 546
interpolation, 191{192
intervals, 73{74
invariant relation, 117
inverse modulo m, 125, 132, 147
inversion formulas, 193
for binomial coecients, 192{196
for Stirling numbers, 264, 310
for sums over divisors, 136{139
irrational numbers, 238
continued fraction representations, 306
rational approximations to, 122{123
spectra of, 77, 96, 514
Stern{Brocot representations, 122{123
Iverson, Kenneth Eugene, 24, 67, 618, 633
convention, 24{25, 31, 34, 68, 75
Jacobi, Carl Gustav Jacob, 64, 618
polynomials, 543, 605
Janson, Carl Svante, 618
Jarden, Dov, 556, 618
Jeopardy, 361
joint distribution, 384
Jonassen, Arne Tormod, 618
Jones, Bush, 618
Josephus, Flavius, 8, 12, 19{20, 618
numbers, 81, 97, 100
problem, 8{17, 79{81, 95, 100, 144
recurrence, generalized, 13{16, 79{81, 498
subset, 20
Jouaillec, Louis Maurice, 632
Jungen, Reinwald, 618, 635
K, see continuants
Kafkaesque scenario, 274
Kaplansky, Irving, 8, 618
Karamata, Jovan, 257, 618
Karlin, Anna Rochelle, 632
Kaucky, Josef, 618, 635
Keiper, Jerry Bruce, 619
Kellogg, Oliver Dimon, 609
Kent, Clark (= Kal-El), 372
kernel functions, 370
Ketcham, Henry King, 148
kilometers, 301, 310, 550
Kilroy, James Joseph, vii
Kipling, Joseph Rudyard, 260
Kissinger, Henry Alfred, 379
Klamkin, Murray Seymour, 619, 633, 635
Klarner, David Anthony, 632
knockout tournament, 432{433
Knoebel, Robert Arthur, 619
Knopp, Konrad, 619, 636
Knuth, Donald Ervin, iii{vi, viii, ix, 102, 267,
411, 506, 553, 616, 618{620, 632, 633,
636, 657
numbers, 78, 97, 100
Knuth, John Martin, 636
Knuth, Nancy Jill Carter, ix
Kramp, Christian, 111, 620
Kronecker, Leopold, 521
delta notation, 24
Kruk, John Martin, 519
Kummer, Ernst Eduard, 206, 529, 620{621, 634
formula for hypergeometrics, 213, 217, 535
Kurshan, Robert Paul, 501, 621
Ln, see Lucas numbers
Lagny, Thomas Fantet de, 304, 621
Lagrange (= de la Grange), Joseph Louis,
comte, 470, 621, 635
identity, 64
Lah, Ivo, 621, 634
Lambert, Johann Heinrich, 201, 363, 613, 621
Landau, Edmund Georg Hermann, 443, 448,
621, 634, 636
Laplace, Pierre Simon, marquis de, 466, 606, 621
last but not least, 132, 469

648 INDEX
Law of Large Numbers, 391
lcm, 103, see least common multiple
leading coecient, 235
least common multiple, 103, 107, 145
of f1, . . . , ng, 251, 319, 500
least integer function, see ceiling function
least upper bound, 57, 61
LeChire, Mark Well, 148
left-to-right maxima, 316
Legendre, Adrien Marie, 621, 633
polynomials, 543, 573, 575
Lehmer, Derrick Henry, 526, 622, 633, 635
Leibniz, Gottfried Wilhelm, Freiherr von, vii,
168, 616, 622
Lekkerkerker, Cornelius Gerrit, 622
Lengyel, Tamas Lorant, 622, 635
levels of problems, viii, 72{73, 95, 511
Levine, Eugene, 611, 635
lexicographic order, 441
lg: binary logarithm, 70
L'Hospital, Guillaume Francois Antoine de,
marquis de Sainte Mesme, rule, 340,
396, 542
L Shanlan Renshu [= Qiuren], 269, 622
Liang, Franklin Mark, 632
Lieb, Elliott Hershel, 622, 636
lies, and statistics, 195
Lincoln, Abraham, 401
linear dierence operators, 240
lines in the plane, 4{8, 17, 19
Liouville, Joseph, 136{137, 622
little oh notation, 448
considered harmful, 448{449
Littlewood, John Edensor, 239
ln: natural logarithm, 276
discrete analog of, 53{54
sum of, 481{482
log: common logarithm, 449
Logan, Benjamin Franklin (= Tex), Jr., 287,
622, 634{635
logarithmico-exponential functions, 442{443
logarithms, 449
binary, 70
discrete analog of, 53{54
in O-notation, 449
natural, 276
Long, Calvin Thomas, 622, 634
lottery, 387{388, 436{437
Lou Shtuo, 622
lower index of binomial coecient, 154
complex valued, 211
lower parameters of hypergeometric series, 205
Loyd, Samuel, 560, 622
Lucas, Francois Edouard Anatole, 1, 292,
622{623, 633{635
numbers, 312, 316, 556
 Luczak, Tomasz Jan, 618
Lyness, Robert Cranston, 501, 623
Maclaurin, Colin, 469, 623
MacMahon, Maj. Percy Alexander, 140, 623
magic tricks, 293
Mallows, Colin Lingwood, 506
Markov, Andre Andreevich (the elder), pro-
cesses, 405
Martian DNA, 377
Martzlo, Jean-Claude, 623
mathematical induction, 3, 7, 10{11, 43
backwards, 18
basis of, 3, 320{321
failure of, 17, 575
important lesson about, 508, 549
Mathews, Edwin Lee (= 41), 8, 21, 94, 105,
106, 343
Mati√Ñasevich (= Matijasevich), √ÑIuri (= Yuri)
Vladimirovich, 294, 623, 635
Mauldin, Richard Daniel, 611
Maxeld, Margaret Waugh, 630, 635
Mayr, Ernst, ix, 632, 633
McEliece, Robert James, 71
McGrath, James Patrick, 632
McKellar, Archie Charles, 614, 634
mean (average) of a probability distribution,
384{399
median, 384, 385, 437
mediant, 116
Melzak, Zdzislaw Alexander, vi, 623
Mendelsohn, Nathan Saul, 623, 634
Merchant, Arif Abdulhussein, 632
merging, 79, 175
Mersenne, Marin, 109{110, 131, 613, 623
numbers, 109{110, 151, 292
primes, 109{110, 127, 522{523
Mertens, Franz Carl Joseph, 139, 623
constant, 23
miles, 301, 310, 550
Mills, Stella, 623
Mills, William Harold, 623, 634
minimum, 65, 249, 377

INDEX 649
Mirsky, Leon, 635
mixture of probability distributions, 428
mnemonics, 74, 164
Mobius, August Ferdinand, 136, 138, 623
function, 136{139, 145, 149, 370{371, 462{463
mod: binary operation, 81{85
mod: congruence relation, 123{126
mod 0, 82{83, 515
mode, 384, 385, 437
modular arithmetic, 123{129
modulus, 82
Moessner, Alfred, 624, 636
Moivre, Abraham de, 297, 481, 609
moments, 398{399
Montgomery, Hugh Lowell, 463, 624
Montgomery, Peter Lawrence, 624, 634
Moriarty, James, 162
Morse, Samuel Finley Breese, code, 302{303,
324, 551
Moser, Leo, 624, 633
Motzkin, Theodor Samuel, 556, 564, 618, 624
mountain ranges, 359, 565
mu function, see Mobius function
multinomial coecients, 168, 171{172, 569
recurrence for, 252
multinomial theorem, 149, 168
multiple of a number, 102
multiple sums, 34{41, 61; see also double sums
multiple-precision numbers, 127
multiplicative functions, 134{136, 144, 371
multisets, 77, 270
mumble function, 83, 84, 88, 507, 513
Murdock, Phoebe James, viii
Murphy's Law, 74
Myers, Basil Roland, 624, 635
name and conquer, 2, 32, 88, 139
National Science Foundation, ix
natural logarithm, 53{54, 276, 481{482
Naval Research, ix
Navel research, 299
nearest integer, 95
rounding to, 195, 300, 344, 491
unbiased, 507
necessary and sucient conditions, 72
necklaces, 139{141, 259
negating the upper index, 164{165
negative binomial distribution, 402{403, 428
negative factorial powers, 52, 63, 188
Newman, James Roy, 630
Newman, Morris, 635
Newton, Sir Isaac, 189, 277, 624
series, 189{192
Newtonian generating function, 378
Niven, Ivan Morton, 332, 624, 633
nonprime numbers, 105, 518
nontransitive paradox, 410
normal distribution, 438
notation, x{xi, 2, 637
extension of, 49, 52, 154, 210{211, 266, 271,
311, 319
ghastly, 67, 175
need for new, 83, 115, 267
nu function: sum of digits,
binary (radix 2), 12, 114, 250, 525, 557
other radices, 146, 525, 552
null case,
for spanning trees, 349, 565
for Stirling numbers, 258
for tilings, 320{321
for Tower of Hanoi, 2
number system, 107, 119
binomial, 245
Fibonacci, 296{297, 301, 307, 310, 318
prime-exponent, 107, 116
radix, see radix notation
residue, 126{129, 144
Stern{Brocot, see Stern{Brocot number
system
number theory, 102{152
o, considered harmful, 448{449
O-notation, 76, 443{449
abuse of, 447{448, 489
one-way equalities with, 446{447, 489{490
obvious, claried, 417, 526
odds, 410
Odlyzko, Andrew Michael, 81, 564, 590, 616,
624, 636
Oce of Naval Research, ix
one-way equalities, 446{447, 489{490
open interval, 73{74, 96
operators, 47
anti-derivative (
R
), 48
anti-dierence (P), 48
derivative (D), 47, 310
dierence (‚àÜ), 47
equations of, 188, 191, 241, 310, 471
shift (E, K, N), 55, 240
theta (œë), 219, 310

650 INDEX
optical illusions, 292, 293, 560
organ-pipe order, 524
Oz, Wizard of, 581
Pacioli, Luca, 614
Palais, Richard Sheldon, viii
paradoxes,
chessboard, 293, 317
coin ipping, 408{410
pair of boxes, 531, 535, 539
paradoxical sums, 57
parallel summation, 159, 174, 208{210
parentheses, 357{359
parenthesis conventions, xi
partial fraction expansions, 298{299, 338{341
for easy summation and dierentiation, 64,
376, 476, 504, 586
not always easiest, 374
of 1/x
ƒÖx+n
n
ƒá
, 189
of 1/(zn ‚àí1), 558
powers of, 246, 376
partial quotients, 306
and discrepancies, 319, 598{599, 602
large, 553, 563, 564, 602
partial sums, see indenite summation
required to be positive, 359{362
partition into nearly equal parts, 83{85
partitions, of the integers, 77{78, 96, 99, 101
of a number, 330, 377
of a set, 258{259, 373
Pascal, Blaise, 155, 156, 624, 633
Pascal's triangle, 155
extended upward, 164
hexagon property, 155{156, 242, 251
row lcms, 251
row products, 243
row sums, 163, 165{166
variant of, 250
Patashnik, Amy Markowitz, ix
Patashnik, Oren, iii, iv, vi, ix, 102, 506, 616, 632
Patil, Ganapati Parashuram, 624, 636
Paule, Peter, 537, 546
Peirce, Charles Santiago Sanders, 525, 624{625,
634
sequence, 151
Penney, Walter Francis, 408, 625
Penney ante, 408{410, 430, 437, 438
pentagon, 314 (exercise 46), 430, 434
pentagonal numbers, 380
Percus, Jerome Kenneth, 625, 636
perfect powers, 66
periodic recurrences, 20, 179, 498
permutations, 111{112
ascents in, 267{268, 270
cycles in, 259{262
excedances in, 314
xed points in, 193{196, 393{394, 400{401,
418
left-to-right maxima in, 314
random, 393{394, 400{401, 428
up-down, 377
without xed points, see derangements
personal computer, 109
perspiration, 234{235
perturbation method, 32{33, 43{44, 64, 179,
284{285
Petkovsek, Marko, 229, 575, 625, 634
Pfa, Johann Friedrich, 207, 214, 217, 529, 625,
634
reection law, 217, 247, 539
pgf: probability generating function, 394
phages, 434, 438
phi (‚âà1.61803), 299{301
as canonical constant, 70
continued fraction for, 310
in fth roots of unity, 553
in solutions to recurrences, 97, 99, 285{286
Stern{Brocot representation of, 550
phi function, 133{135
dgf for, 371
divisibility by, 151
Phi function: sum of œÜ, 137{139, 462{463
Phidias, 299
philosophy, vii, 11, 16, 46, 71, 72, 75, 91, 170,
181, 194, 331, 467, 503, 508, 603
phyllotaxis, 291
pi (‚âà3.14159, 26, 286
as canonical constant, 70, 416, 423
large partial quotients of, 564
Stern{Brocot representation of, 146
pi function, 110{111, 452, 593
preposterous expressions for, 516
Pig, Porky, 496
pigeonhole principle, 130
Pincherle, Salvatore, 617
Pisano, Leonardo, 613, see Fibonacci
Pittel, Boris Gershon, 576, 618
pizza, 4, 423
planes, cutting, 19

INDEX 651
pneumathics, 164
Pochhammer, Leo, 48, 625
symbol, 48
pocket calculators, 67, 77, 459
failure of, 344
Poincare, Jules Henri, 625, 636
Poisson, Simeon Denis, 471, 625
distribution, 428{429, 579
summation formula, 602
Pollak, Henry Otto, 616, 633
Polya, George (= Gyorgy), vi, 16, 327, 508, 625,
633, 635, 636
polygons,
dissection of, 379
triangulation of, 374
Venn diagrams with, 20
polynomial argument, 158, 163
for rational functions, 527
opposite of, 210
polynomially recursive sequence, 374
polynomials, 189
Bernoulli, 367{368, 470{475
continuant, 301{309
convolution, 373
cyclotomic, 149
degree of, 158, 226
divisibility of, 225
Euler, 574
Jacobi, 543, 605
Legendre, 543, 573, 575
Newton series for, 189{191
reected, 339
Stirling, 271{272, 290, 311, 317, 352
Poonen, Bjorn, 501, 633
Porter, Thomas K, 632
Portland cement, see concrete (in another book)
power series, 196, see generating functions
formal, 206, 331, 348, 532
Pr, 381{382
Pratt, Vaughan Ronald, 632
preferential arrangements, 378 (exercise 44)
primality testing, 110, 148
impractical method, 133
prime algebraic integers, 106, 147
prime numbers, 105{111
gaps between, 150{151, 525
largest known, 109{110
Mersenne, 109{110, 127, 522
size of nth, 110{111, 456{457
sum of reciprocals, 22{25
prime to, 115
prime-exponent representation, 107, 116
Princeton University, ix, 427
probabilistic analysis of an algorithm, 413{426
probability, 195, 381{438
conditional, 416{419, 424{425
discrete, 381{438
generating functions, 394{401
spaces, 381
probability distributions, 367
binomial, 401{402, 415, 428, 432
composition or mixture of, 428
joint, 384
negative binomial, 402{403, 428
normal, 438
Poisson, 428{429, 579
uniform, 395{396, 420{421
problems, levels of, viii, 72{73, 95, 511
product notation, 64, 106
product of consecutive odd numbers, 186, 270
progression, see arithmetic progression, geomet-
ric progression
proof, 4, 7
proper terms, 239{241, 255{256
properties, 23, 34, 72{73
prove or disprove, 71{72
psi function, 551
pulling out the large part, 453, 458
puns, ix, 220
Pythagoras of Samos, theorem, 510
quadratic domain, 147
quicksort, 28{29, 54
quotation marks, xi
quotient, 81
rabbits, 310
radix notation, 11{13, 15{16, 109, 195, 526
length of, 70, 460
related to prime factors, 113{114, 146{148,
245
Rado, Richard, 625, 635
Rahman, Mizanur, 223, 614
Rainville, Earl David, 529, 626
Ramanujan Aiya_ngar, Srnivasa, 330
Ramare, Olivier, 548
Ramshaw, Lyle Harold, 73, 632, 634, 636
random constant, 399
random variables, 383{386; see also independent
random variables

652 INDEX
Raney, George Neal, 359, 362, 626, 635
lemma, 359{360
lemma, generalized, 362, 372
sequences, 360{361
Rao, Dekkata Rameswar, 626, 633
rational functions, 207{208, 224{226, 338, 527
rational generating functions, 338{346
expansion theorems for, 340{341
Rayleigh, John William Strutt, 3rd Baron,
77, 626
Read, Ronald Cedric, 625
real part, 64, 212, 451
reciprocity law, 94
Recorde, Robert, 446, 626
recurrences, 1{20
and sums, 25{29
doubly exponential, 97, 100, 101, 109
oor/ceiling, 78{81
implicit, 136{138, 193{194, 284
periodic, 20, 179, 498
solving, 337{350
unfolding, 6, 100, 159{160, 312
unfolding asymptotically, 456
referee, 175
reference books, 42, 223, 616, 619
reected light rays, 291{292
reected polynomials, 339
reection law for hypergeometrics, 217, 247, 539
regions, 4{8, 17, 19
Reich, Simeon, 626, 636
Reingold, Edward Martin, 70
relative error, 452, 455
relatively prime integers, 108, 115{123
remainder after division, 81{82
remainder in Euler's summation formula, 471,
474{475, 479{480
Renz, Peter Lewis, viii
repertoire method, 14{15, 19, 250
for Fibonacci-like recurrences, 312, 314, 372
for sums, 26, 44{45, 63
replicative function, 100
repunit primes, 516
residue calculus, 495
residue number system, 126{129, 144
retrieving information, 411{413
rewards, monetary, ix, 256, 497, 525, 575
Rham, Georges de, 626, 635
Ribenboim, Paolo, 555, 626, 634
Rice, Stephan Oswald, 626
Rice University, ix
Riemann, Georg Friedrich Bernhard, 205, 626,
633
hypothesis, 526
Riemann's zeta function, 65, 595
as generalized harmonic number, 277{278, 286
as innite product, 371
as power series, 601
dgf's involving, 370{371, 373, 463, 566, 569
evaluated at integers, 238, 286, 571, 595, 597
rising factorial powers, 48
binomial theorem for, 245
complex, 211
negative, 63
related to falling powers, 63, 312
related to ordinary powers, 263, 598
Roberts, Samuel, 626, 633
rocky road, 36, 37
Rdseth, ystein Johan, 626, 634
Rolletschek, Heinrich Franz, 514
roots of unity, 149, 204, 375, 574, 598
fth, 553
modulo m, 128{129
Roscoe, Andrew William, 620
Rosser, John Barkley, 111, 626
Rota, Gian-Carlo, 516, 626
roulette wheel, 74{76, 453
rounding to nearest integer, 95, 195, 300,
344, 491
unbiased, 507
Roy, Ranjan, 626, 634
rubber band, 274{275, 278, 312, 493
ruler function, 113, 146, 148
running time, 413, 425{426
O-notation for, abused, 447{448
Ruzsa, Imre Zoltan, 611
Saalschutz, Louis, 214, 627, 634
identity, 214{215, 234{235, 529, 531
Saltykov, Al'bert Ivanovich, 463, 627
sample mean and variance, 391{393, 427
sample third cumulant, 429
samplesort, 354
sandwiching, 157, 165
Sarkozy, Andras, 548, 627
Sawyer, Walter Warwick, 207, 627
Schaer, Alejandro Alberto, 632
Schinzel, Andrzej, 525
Schlomilch, Oscar Xaver, 627
Schmidt, Asmus Lorenzen, 634

INDEX 653
Schoenfeld, Lowell, 111, 626
Schonheim, Johanen, 608
Schroder, Ernst, 627, 635
Schrodinger, Erwin, 430
Schroter, Heinrich Eduard, 627, 635
Schutzenberger, Marcel Paul, 636
science and art, 234
Scorer, Richard Segar, 627, 633
searching a table, 411{413
Seaver, George Thomas (= 41), 8, 21, 94, 105,
106, 343
secant numbers, 317, 559, 570, 620
second-order Eulerian numbers, 270{271
second-order Fibonacci numbers, 375
second-order harmonic numbers, 277, 280, 311,
550{552
Sedgewick, Robert, 632
Sedlacek, Jir, 627, 635
self-certifying algorithms, 104
self-describing sequence, 66, 495
self reference, 59, 95, 531{540, 616, 653
set inclusion in O-notation, 446{447, 490
Shallit, Jerey Outlaw, 627, 635
Sharkansky, Stefan Michael, 632
Sharp, Robert Thomas, 273, 627
sherry, 433
shift operator, 55, 240
binomial theorems for, 188, 191
Shiloach, Joseph (= Yossi), 632
Shor, Peter Williston, 633
Sicherman, George Leprechaun, 636
sideways addition, 12, 114, 146, 250, 552
Sierpinski, Wac law, 87, 627, 634
sieve of Eratosthenes, 111
Sigma-notation, 22{25
ambiguity of, 245
signum function, 502
Silverman, David L, 627, 635
similar hypergeometric terms, 541
skepticism, 71
Skiena, Steven Sol, 548
Sloane, Neil James Alexander, 42, 341, 464, 604,
628, 633
Slowinski, David Allen, 109
small cases, 2, 5, 9, 155, 320{321; see also
empty case
Smith, Cedric Austen Bardell, 627, 633
Snowwalker, Luke, 435
Solov'ev, Aleksandr Danilovitch, 408, 628
solution, 3, 337
sorting,
asymptotic eciency of, 447{449
bubblesort, 448
merge sort, 79, 175
possible outcomes, 378
quicksort, 28{29, 54
samplesort, 354
spanning trees,
of complete graphs, 368{369
of fans, 348{350, 356
of wheels, 374
Spec, see spectra
special numbers, 257{319
spectra, 77{78, 96, 97, 99, 101
generating functions for, 307, 319
spinning coins, 401
spiral function, 99
Spohn, William Gideon, Jr., 628
Sports, see baseball, football, frisbees, golf,
tennis
Sprugnoli, Renzo, 564
square pyramidal numbers, 42
square root,
of 1 (mod m), 128{129
of 2, 100
of 3, 378
of ‚àí1, 22
squarefree, 145, 151, 373, 525, 548
squares, sum of consecutive, 41{46, 51, 180, 245,
269, 284, 288, 367, 444, 470
stack size, 360{361
stacking bricks, 313, 374
stacking cards, 273{274, 278, 309
Stallman, Richard Matthew, 628
standard deviation, 388, 390{394
Stanford University, v, vii, ix, 427, 458, 632,
634, 657
Stanley, Richard Peter, 270, 534, 615, 628,
635, 636
Staudt, Karl Georg Christian von, 628, 635
Steele, Guy Lewis, Jr., 628
Stegun, Irene Anne, 42, 604
Stein, Sherman Kopald, 633
Steiner, Jacob, 5, 628, 633
Steinhaus, Hugo Dyonizy, 636
Stengel, Charles Dillon (= Casey), 42
step functions, 87
Stern, Moriz Abraham, 116, 628

654 INDEX
Stern{Brocot number system, 119{123
related to continued fractions, 306
representation of
‚àö
3, 572
representation of Œ≥, 306
representation of œÄ, 146
representation of œÜ, 550
representation of e, 122, 150
simplest rational approximations from,
122{123, 146, 519
Stern{Brocot tree, 116{123, 148, 525
largest denominators in, 319
related to continued fractions, 305{306
Stern{Brocot wreath, 515
Stewart, Bonnie Madison, 614, 633
Stickelberger, Ludwig, 628, 633
Stieltjes, Thomas Jan, 617, 628, 633
constants, 595, 601
Stirling, James, 192, 195, 210, 257, 258, 297,
481, 628
approximation, 112, 452, 481{482, 491, 496
approximation, perturbed, 454{455
constant, 481, 485{489
polynomials, 271{272, 290, 311, 317, 352
triangles, 258, 259, 267
Stirling numbers, 257{267
as sums of products, 570
asymptotics of, 495, 602
combinatorial interpretations, 258{262
convolution formulas, 272, 290
duality of, 267
generalized, 271{272, 311, 316, 319, 598
generating functions for, 351{352, 559
identities for, 264{265, 269, 272, 290, 311,
317, 378
inversion formulas for, 310
of the rst kind, 259
of the second kind, 258
related to Bernoulli numbers, 289{290,
317 (exercise 76)
table of, 258, 259, 267
Stone, Marshall Harvey, vi
Straus, Ernst Gabor, 564, 611, 624
Strehl, Karl Ernst Volker, 549, 629, 634
subfactorial, 194{196, 250
summand, 22
summation, 21{66
asymptotic, 87{89, 466{496
by parts, 54{56, 63, 279
changing the index of, 30{31, 39
denite, 49{50, 229{241
diculty measure for, 181
factors, 27{29, 64, 236, 248, 275, 543
in hypergeometric terms, 224{229
indenite, see indenite summation
innite, 56{62, 64
interchanging the order of, 34{41, 105, 136,
183, 185, 546
mechanical, 229{241
on the upper index, 160{161, 175{176
over divisors, 104{105, 135{137, 141, 370
over triangular arrays, 36{41
parallel, 159, 174, 208{210
sums, 21{66; see also summation
absolutely convergent, 60{62, 64
and recurrences, 25{29
approximation of, by integrals, 45, 276{277,
469{475
divergent, see divergent sums
double, see double sums
doubly innite, 59, 98, 482{483
empty, 24, 48
oor/ceiling, 86{94
formal, 321; see also formal power series
hypergeometric, see hypergeometric series
innite, 56{62, 64
multiple, 34{41, 61; see also double sums
notations for, 21{25
of consecutive cubes, 51, 63, 283, 289, 367
of consecutive integers, 6, 44, 65
of consecutive mth powers, 42, 283{285,
288{290, 366{368
of consecutive squares, 41{46, 51, 180, 245,
269, 284, 288, 367, 444, 470
of harmonic numbers, 41, 56, 279{282,
312{313, 316, 354{355
paradoxical, 57
tails of, 466{469, 488{489, 492
Sun Tsu [= Sunz, Master Sun], 126
sunower, 291
super generating functions, 353, 421
superfactorials, 149, 243
Swanson, Ellen Esther, viii
Sweeney, Dura Warren, 629
Swinden, Benjamin Alfred, 633
Sylvester, James Joseph, 133, 629, 633
symmetry identities,
for binomial coecients, 156{157, 183
for continuants, 303
for Eulerian numbers, 268

INDEX 655
Szegedy, Mario, 525, 608, 629
Szeg}o, Gabor, 625, 636
Tn, see tangent numbers
tail exchange, 466{469, 486{489
tail inequalities, 428, 430
tail of a sum, 452{455
tale of a sum, see squares
tangent function, 287, 317
tangent numbers, 287, 312, 317, 620
Tanny, Stephen Michael, 629, 635
Tartaglia, Nicolo, triangle, 155
Taylor, Brook, series, 163, 191, 287, 396,
470{471
telescoping, 50, 232, 236, 255
tennis, 432{433
term, 21
hypergeometric, 224, 243, 245, 527, 575
term ratio, 207{209, 211{212, 224{225
TEX, 219, 432, 657
Thackeray, Henry St. John, 618
Theisinger, Ludwig, 629, 634
theory of numbers, 102{152
theory of probability, 381{438
theta functions, 483, 524
theta operator, 219{221, 347
converting between D and œë, 310
Thiele, Thorvald Nicolai, 397, 398, 629
thinking, 503
big, 2, 441, 458, 483, 486
not at all, 56, 230, 503
small, see downward generalization, small
cases
three-dots (¬∑ ¬∑ ¬∑) notation, 21
advantage of, 21, 25, 50
disadvantage of, 25
elimination of, 108
tilings, see domino tilings
Titchmarsh, Edward Charles, 629, 636
Todd, Horace, 501
Toledo, Ohio, 73
Tong, Christopher Hing, 632
totient function, 133{135
dgf for, 371
divisibility by, 151
summation of, 137{144, 150, 462{463
Toto, 581
tournament, 432{433
Tower of Brahma, 1, 4, 278
Tower of Hanoi, 1{4, 26{27, 109, 146
variations on, 17{20
Trabb Pardo, Luis Isidoro, 632
transitive law, 124
failure of, 410
traps, 154, 157, 183, 222, 542
trees,
2-3 trees, 636
binary, 117
of bees, 291
spanning, 348{350, 356, 368{369, 374
Stern{Brocot, see Stern{Brocot tree
triangular array, summation over, 36{41
triangular numbers, 6, 155, 195{196, 260, 380
triangulation, 374
Tricomi, Francesco Giacomo Filippo, 629, 636
tridiagonal matrix, 319
trigonometric functions,
related to Bernoulli numbers, 286{287, 317
related to probabilities, 435, 437
related to tilings, 379
trinomial coecients, 168, 171, 255, 571
middle, 490
trinomial theorem, 168
triphages, 434
trivial, claried, 129, 417{418, 618
Turan, Paul, 636
typefaces, viii{ix, 657
Uchimura, Keisuke, 605, 635
unbiased estimate, 392, 429
unbiased rounding, 507
uncertainty principle, 481
undetermined coecients, 529
unexpected sum, 167, 215{216, 236, 247
unfolding a recurrence, 6, 100, 159{160, 312
asymptotically, 456
Ungar, Peter, 629
uniform distribution, 395{396, 418{419
uniformity, deviation from, 152; see also
discrepancy
unique factorization, 106{107, 147
unit, 147
unit fractions, 95, 101, 150
unwinding a recurrence, see unfolding a
recurrence
up-down permutations, 377
upper index of binomial coecient, 154
upper negation, 164{165
upper parameters of hypergeometric series, 205

656 INDEX
upper summation, 160{161, 176
useless identity, 223, 254
Uspensky, James Victor, 615, 629, 633
V: variance, 387{398, 419{425
van der Poorten, Alfred Jacobus, 629
Vandermonde, Alexandre Theophile, 169, 629, 634
Vandermonde's convolution, 169{170
as a hypergeometric series, 211{213
combinatorial interpretation, 169{170
derived mechanically, 234
derived from generating functions, 198
generalized, 201{202, 218{219, 248
with half-integers, 187
vanilla, 36
Vardi, Ilan, 525, 548, 603, 620, 629, 633, 636
variance of a probability distribution, 387{398,
419{425
innite, 428, 587
Veech, William Austin, 514
Venn, John, 498, 630, 633
diagram, 17, 20
venture capitalists, 493{494
violin string, 29
vocabulary, 75
Voltaire, de (= Arouet, Francois Marie), 450
von Staudt, Karl Georg Christian, 628, 635
Vyssotsky, Victor Alexander, 548
Wall, Charles Robert, 607, 635
Wallis, John, 630, 635
Wapner, Joseph Albert, 43
war, 8, 16, 85, 434
Waring, Edward, 630, 635
Waterhouse, William Charles, 630, 635
Watson, John Hamish, 229, 405
Waugh, Frederick Vail, 630, 635
Weaver, Warren, 630
Weber, Heinrich, 630
Weisner, Louis, 516, 630
Wermuth, Edgar Martin Emil, 603, 630
Weyl, Claus Hugo Hermann, 87, 630
Wham-O, 435, 443
wheel, 74, 374
big, 75
of Fortune, 453
Whidden, Samuel Blackwell, viii
Whipple, Francis John Welsh, 630, 634
identity, 253
Whitehead, Alfred North, 91, 503, 603, 630
Wiles, Andrew John, 131
Wilf, Herbert Saul, 81, 240, 241, 514, 549, 575,
620, 624, 630{631, 634
Williams, Hugh Cowie, 631, 633
Wilquin, Denys, 634
Wilson, Sir John, theorem, 132{133, 148, 516,
609
Wilson, Martha, 148
wine, 433
Witty, Carl Roger, 509
Wolstenholme, Joseph, 631, 635
theorem, 554
Wood, Derick, 631, 633
Woods, Donald Roy, 628
Woolf, William Blauvelt, viii
worm,
and apple, 430
on rubber band, 274{275, 278, 312, 493
Worpitzky, Julius Daniel Theodor, 631
identity, 269
wreath, 515
Wrench, John William, Jr., 600, 606, 636
Wright, Sir Edward Maitland, 111, 617, 631, 633
Wytho (= Wijtho), Willem Abraham, 614
Yao, Andrew Chi-Chih, ix, 632
Yao, Foong Frances, ix, 632
Yao, Q, 622
Youngman, Henry (= Henny), 175
zag, see zig
Zagier, Don Bernard, 238
Zapf, Hermann, viii, 620, 657
Zave, Derek Alan, 631, 635
Zeckendorf, Edouard, 631
theorem, 295{296, 563
Zeilberger, Doron, ix, 229{231, 238, 240, 241,
631, 634
zero, not considered harmful, 24{25, 159
strongly, 24{25
zeta function, 65, 595
and the Riemann hypothesis, 526
as generalized harmonic number, 277{278, 286
as innite product, 371
as power series, 601
dgf's involving, 370{371, 373, 463, 566, 569
evaluated at integers, 238, 286, 571, 595, 597
Zhu Shijie, see Chu Shih-Chieh
zig, 7{8, 19
zig-zag, 19
Zipf, George Kingsley, law, 419

List of Tables
Sums and dierences
55
Pascal's triangle
155
Pascal's triangle extended upward
164
Sums of products of binomial coecients
169
The top ten binomial coecient identities
174
General convolution identities
202
Stirling's triangle for subsets
258
Stirling's triangle for cycles
259
Basic Stirling number identities
264
Additional Stirling number identities
265
Stirling's triangles in tandem
267
Euler's triangle
268
Second-order Eulerian triangle
270
Stirling convolution formulas
272
Generating function manipulations
334
Simple sequences and their generating functions
335
Generating functions for special numbers
351
Asymptotic approximations
452
THIS BOOK was composed at Stanford University using the TEX system for
technical text developed by D. E. Knuth. The mathematics is set in a new
typeface called AMS Euler (Version 2.1), designed by Hermann Zapf for the
American Mathematical Society.
The text is set in a new typeface called
Concrete Roman and Italic, a special version of Knuth's Computer Modern
family with weights designed to blend with AMS Euler. The paper is 50-
lb.-basis Cleareld Opaque, which has a neutral pH and a life expectancy of
several hundred years. The oset printing and notch binding were done by
Halliday Lithograph Corporation in Hanover, Massachusetts.
657

Errata, 1994-1997
THIS IS A LIST of all corrections made to the second edition of Concrete
\And if you happen
in reading to nde
any more faultes
not here mentioned,
as peraduenture you
may, . . . I trust
you will therefore
impute no blame
either vnto me
or to the Printer,
but gently amend
and correct them,
accepting our good
minde, which was to
haue had the booke
passed to your han-
des vtterly without
fault, as touching
the Printing."
|from the rst
English edition
of Euclid [98]
Mathematics by Graham, Knuth, and Patashnik, after the rst appearance of
that book in February 1994 until the nal updates to the hardcover version
made at the beginning of 1998. All subsequent updates are posted on Internet
page http://www-cs-faculty.stanford.edu/~knuth/gkp.html, where you
can also nd additional material such as exam questions and answers that
were prepared after the book was published.
Minor changes in typographic layout are not listed here; neither are
changes to the index that were precipitated by changes to the text. With
these modications, the book should be perfect.
But you may disagree. To claim a reward for any anomalies you spot
that aren't shown here, please send your comments to D. E. Knuth, Com-
puter Science Department, Stanford University, Stanford CA 94305-9045, or
by email to knuth-bug@cs.stanford.edu, as soon as possible. Please use
email only to report errors, not to ask questions.
All of the items dated before February 1995, and a few items dated after
that, were corrected in the second printing.
Page 20, line 16
(10 Jan 95)
whose solution is periodic regardless of the initial values X0, . . . , Xk‚àí1.
Page 76, line 8 from the bottom
(18 Dec 96)
1,000,000,000
1500000.0
1502497
0.166
659

660 ERRATA, 1994-1997
Page 87, lines 11 to 14 from the bottom
(13 May 95)
for all irrational Œ± and all bounded functions f that are continuous almost
everywhere. For example, the average value of fnŒ±g can be found by setting
f(x) = x; we get 1
2. (That's exactly what we might expect; but it's nice to
know that it is really, provably true, no matter how irrational Œ± is.)
Page 88, last two lines and top line of page 89
(31 Jan 95)
The quantity jŒ±‚Ä≤ will be an integer only when j = 0, since Œ± (hence Œ±‚Ä≤) is
irrational; and jŒ±‚Ä≤ ‚àív‚Ä≤ will be an integer for at most one value of j. So we
can change the ceiling terms to oors:
Page 89, line 14
(31 Jan 95)
Here œµ is a positive error less than vŒ±‚àí1. Exercise 18 proves that S is, simi-
Page 89, line 18 [the rst printing was correct]
(26 Sep 95)
D(Œ±, n)  D(Œ±‚Ä≤, ‚åäŒ±n‚åã) + Œ±‚àí1 + 2 .
(3.31)
Page 89, lines 11 and 12 from the bottom
(26 Sep 95)
suciently large. Hence theorem (3.28) is true; however, convergence to the
limit is not always very fast. (See exercises 9.45 and 9.61.)
Page 97, line 7 from the bottom [rst printing was correct]
(26 Sep 95)
D(Œ±, n)  D
¬°
Œ±‚Ä≤, ‚åäŒ±n‚åã
¬¢
‚àíŒ±‚àí1 ‚àí2 .
Page 109, line 23
(13 Jan 95)
out, its 65,050 decimal digits require 78 cents U.S. postage to mail rst class.

ERRATA, 1994-1997 661
Page 109, line 7 from the bottom
(31 Dec 97)
seventeenth century [269]. The Mersenne primes known prior to 1998 occur
Page 109, line 4 from the bottom
(31 Dec 97)
110503, 132049, 216091, 756839, 859433, 1257787, 1398269, and 2976221.
Page 110, lines 8 and following
(4 Jan 94)
been a Mersenne prime, although only a few dozen Mersenne primes are
known. Many people are trying . . .
Page 116, line 19
(31 Dec 95)
independently by Moritz Stern [339], a German mathematician, and Achille
Page 122, new grato for middle of page
(15 Apr 96)
Hermann Minkowski
illustrated this
remarkable binary
representation
at the Interna-
tional Congress of
Mathematicians in
Heidelberg, 1904.
Page 123, lines 2{4
(26 Sep 95)
example, 878
323 ‚âà2.718266 ‚âà.999994e; we obtained this fraction from the rst
16 letters of e's Stern{Brocot representation, and the accuracy is about what
we would get with 16 bits of e's binary representation.
Page 126, line 21
(28 Mar 97)
discovered by Sun Tzu in China, about a.d. 350.
Page 130, line 4 from the bottom in second printing
(1 Mar 95)
ception of one that became the most famous of all, because it baed the

662 ERRATA, 1994-1997
Page 131, lines 1{4
(1 Mar 95)
for all positive integers a, b, c, and n, when n > 2. (Of course there are lots
of solutions to the equations a + b = c and a2 + b2 = c2.) Andrew Wiles
has apparently settled the question at long last; his intricate, epoch-making
proof of (4.46) appears in Annals of Mathematics 142 (1995), 443{551.
Page 146, lines 2{4 from the bottom
(24 May 96)
m1, . . . , mr be positive integers with mj ‚ä•mk for 1  j < k  r; let
m = m1 . . . mr; and let a1, . . . , ar, A be integers. Then there is exactly
one integer a such that
Page 149, lines 1 and 2
(25 Apr 95)
49
Let R(N) be the number of pairs of integers (m, n) such that 1  m  N,
1  n  N, and m ‚ä•n.
Page 149, line 7 from the bottom
(24 May 96)
53
Find all positive integers n such that n
¬≤ ¬ß
(n ‚àí1)!/(n + 1)
¬®
.
Page 171, line 7 from the bottom
(9 April 96)
This follows from a ve-parameter identity discovered by John Dougall [82]
early in the twentieth century.
Page 172, line 9
(13 May 95)
several people shortly thereafter. Exercise 86 gives a \simple" proof of (5.31).
Page 177, line 6 from the bottom
(24 May 96)
seen so far. And we're faced with a sum of 21000000 +1 terms, so we can't just

ERRATA, 1994-1997 663
Page 200, line 4 from the bottom
(1 Dec 94)
We will prove in Section 7.5 that these functions satisfy the identities
Page 201, addendum to the grato
(12 May 95)
Exercise 84 explains
how to derive (5.61)
from (5.60).
Page 202, line 8 from the bottom
(20 Jun 96)
E(z) =
X
k0
(k + 1)k‚àí1 zk
k! = 1 + z + 3
2z2 + 8
3z3 + 125
24 z4 + ¬∑ ¬∑ ¬∑ ,
(5.66)
Page 206, new grato about 10 lines from the bottom
(6 Jun 96)
We didn't discuss
convergence of
(5.56), (5.57),
(5.58), . . . either.
Page 211, addendum to the grato in middle of page
(7 Nov 94)
The value is innite
when z is a neg-
ative integer and
w is not an integer.
Page 215, line 4
(13 May 95)
F
¬µ n+1, m‚àín, 1, 1
2
1
2m+1, 1
2m+ 1
2, 2
¬Ø¬Ø¬Ø 1
¬∂
= m
n ,
integer n  m > 0,
Page 215, line 6
(13 May 95)
new. But it really isn't; the left-hand side can be replaced by a multiple of
Page 215, line 11 from the bottom
(13 May 95)
F
¬µ
1
3r, 1
3r+ 1
3, 1
3r+ 2
3, ‚àín, ‚àín‚àí1
2s, ‚àín‚àí1
2s+ 1
2
1
2r+ 1
2, 1
2r+1, ‚àín‚àí1
3s, ‚àín‚àí1
3s+ 1
3, ‚àín‚àí1
3s+ 2
3
¬Ø¬Ø¬Ø 1
¬∂

664 ERRATA, 1994-1997
Page 215, line 8 from the bottom
(13 May 95)
quantities (r, s, n) are replaced respectively by (1, m ‚àí2n ‚àí1, n ‚àím).
Page 222, line 10
(12 Aug 96)
whenever both innite sums converge.
And in fact both sums always do
converge, except in the degenerate case when a+b+ 1
2 is a nonpositive integer.
Page 232, line 2 in rst printing
(11 Apr 95)
deg(R) = 1 (assuming that z Ã∏= ¬±1), we have d = deg(^p) ‚àídeg(Q) = 0 and
Page 233, line 11
(1 Jun 94)
algorithm can be formulated as follows, when t(n, k) is given:
Page 237, line 2 from the bottom
(26 Sep 95)
And
¬°
1
n+1
¬¢
zn+1 =
¬°0
n
¬¢
zn+1 = T(n, n + 1) for all n  0, so we obtain
Page 241, line 4 from the bottom
(13 Jan 95)
Exercises 98{108 provide additional examples of the Gosper-Zeilberger
Page 244, lines 2 and 3
(24 May 96)
denition, by showing that the limit in (5.83) is 1/m! when z = m is a
positive integer.
Page 245, line 14
(24 May 96)
when c is a nonnegative integer. (See (5.115).) Use this idea to evaluate

ERRATA, 1994-1997 665
Page 253, line 3 from the bottom
(26 Sep 95)
94
Find P ¬°a
k
¬¢¬° ‚àía
n‚àík
¬¢
Œ¥k when n is a positive integer.
Page 254, line 2 of exercise 99
(26 Sep 95)
when t(n, k) = (n + a + b + c + k)!/(n + k)! (c + k)! (b ‚àík)! (a ‚àík)! k!,
Page 272, equations (6.50), (6.51), (6.53)
(4 Jun 95)
change
X
n0
to
X
n
Page 289, lines 6 and 7
(4 Jun 95)
S6(n) = n(n‚àí1
2)(n‚àí1)(n‚àí1
2 + Œ±)(n‚àí1
2 ‚àíŒ±)(n‚àí1
2 + Œ±)(n‚àí1
2 ‚àíŒ±)/7 ,
where Œ± = 2‚àí3/2 3‚àí1/4¬°q‚àö
31 +
‚àö
27 + i
q‚àö
31 ‚àí
‚àö
27
¬¢
.
Page 289, line 10 from the bottom
(4 Jun 95)
X
j0
¬Øm
j
¬∞¬∑j + 1
k
¬∏(‚àí1)j+1‚àík
j + 1
=
1
m+1
¬µm+1
k
¬∂
Bm+1‚àík ,
k > 0. (6.99)
Page 290, line 8
(4 Jun 95)
X
k
¬Øn
k
¬∞¬∑ k
m
¬∏(‚àí1)k‚àím
k
= 1
n
¬µn
m
¬∂
Bn‚àím + [m = n‚àí1] ,
m > 0. (6.100)
Page 292, line 13 from the bottom
(27 Oct 97)
the Italian astronomer Gian Domenico Cassini in 1680 [51], is the identity
Page 292, lines 10 and 11 from the bottom
(27 May 94)
When n = 6, for example, Cassini's identity correctly claims that 13¬∑5 ‚àí82
equals 1. (Johannes Kepler knew this law already in 1608 [202].)

666 ERRATA, 1994-1997
Page 301, lines 19{24
(9 Jul 95)
of miles per n kilometers for all n  100, except in the cases n = 4, 12, 54, 62,
75, 83, 91, 96, and 99, when it is o by less than 2/3 mile. And the shift-up
rule gives either the correctly rounded number of kilometers for n miles, or
1 km too many, for all n  113. (The only really embarrassing case is n = 4,
where the individual rounding errors for n = 3+1 both go the same direction
instead of cancelling each other out.)
Page 316, line 4 from the bottom
(9 Jul 95)
Y
k1
¬≥
1 + z
k
¬¥
e‚àíz/k = e‚àíŒ≥z
z!
,
Page 317, line 4
(4 Jun 95)
z
2n cot z
2n ‚àíz
2n tan z
2n +
2n‚àí1‚àí1
X
k=1
z
2n
¬µ
cot z + kœÄ
2n
+ cot z ‚àíkœÄ
2n
¬∂
,
Page 317, lines 6{9 from the bottom
(21 Jun 94)
77
When m and n are integers, n  0, the value of œÉn(m) is given by (6.48)
if m < 0, by (6.49) if m > n, and by (6.101) if m = 0. Show that in the
remaining cases we have
œÉn(m) = (‚àí1)m+n‚àí1
m! (n ‚àím)!
m‚àí1
X
k=0
¬∑
m
m ‚àík
¬∏Bn‚àík
n ‚àík ,
integer n  m > 0.
Page 319, line 14 from the bottom
(1 Nov 94)
a
Are there innitely many n with pnan, for some xed prime p?
Page 353, line 6
(4 Jun 95)
ew ‚àíez
wez ‚àízew =
X
m,n0
¬øm + n + 1
m
√Ä
wmzn
(m + n + 1)! .
(7.60)

ERRATA, 1994-1997 667
Page 361, line 20 and following
(13 May 95)
sequences ‚ü®a0, . . . , amn‚ü©arise uniquely in this way, if n > 0: The last term
amn must be (1 ‚àím). The partial sums . . .
Page 379, line 2 from the bottom
(17 May 94)
have the form pn(y) = Pn
m=0
¬Ø¬Øn
m
¬Ø¬Øym, where
¬Ø¬Øn
m
¬Ø¬Ø is a positive integer for
Page 391, line 5
(12 May 95)
between 6.975 million and 7.025 million.
Page 393, line 1
(12 May 95)
We estimate the average spot sum of these dice to be 7.4¬±2.1/
‚àö
10 ‚âà7.4¬±0.7,
Page 419, line 4
(4 Jun 95)
Once again we have gained the desired speedup factor of 1/m. If m ‚âàn/ln n
Page 419, lines 8 and 9
(4 Jun 95)
this distribution is called \Zipf's law." Then Mean(S) = n/Hn ‚àí1, Var(S) =
1
2n(n + 1)/Hn ‚àín2/H2
n. The average number of probes for m ‚âàn/ln n as
Page 425, line 18
(24 May 96)
must set a NEXT entry to n + 1. These two cases may take dierent amounts
Page 426, bottom three lines
(4 Jun 95)
m = n/ln n + O(1) and n ‚Üí‚àûthe corresponding results are
Mean(GT) = Œ≤ ln n + Œ± + O
¬°
(log n)2/n
¬¢
;
Var(GT) = Œ≤2 ln n + O
¬°
(log n)2/n
¬¢
.

668 ERRATA, 1994-1997
Page 433, second grato should be in French
(8 May 96)
\Une rapide opera-
tion arithmetique
montre que, gr^ace
a cette ingenieuse
cascade, les xeres
ont toujours au
moins trois ans.
Pousser plus loin
le calcul de leur ^age
donne le vertige."
|Revue du vin de
France (Nov 1984)
Page 457, line 4 from the bottom
(9 Jul 95)
For example, when n = 106 this estimate comes to 15631363.6 + O(n/log n);
Page 466, line 5
(26 Sep 95)
O
¬µ X
0<k<n
(log n)2
k(n ‚àík)
¬∂
= O
¬µ(log n)3
n
¬∂
,
Page 474, line 3
(9 Jul 95)
negative multiple of cos(2œÄx ‚àí1
2œÄm), with error O
¬°
2‚àím maxx Bm
¬°
fxg
¬¢¬¢
.
Page 475, line 11
(9 Jul 95)
R2m = Œ∏m
B2m+2
(2m + 2)!f(2m+1)(x)
¬Ø¬Øb
a ,
for some 0  Œ∏m  1;
(9.80)
Page 477, line 14 from the bottom
(9 Jul 95)
So R4(n) is actually equal to
89
128 ‚àíln 2 + O(n‚àí5), but Euler's summation
Page 480, line 4 from the bottom
(9 Jul 95)
Hn = ln n + Œ≥ + 1
2n ‚àí
m
X
k=1
B2k
2kn2k ‚àíŒ∏m,n
B2m+2
(2m + 2)n2m+2 ,
(9.88)
Page 481, line 5
(27 May 94)
the value of Œ≥ correct to 1271 decimal places, beginning thus:

ERRATA, 1994-1997 669
Page 500, lines 15{18
(31 Jan 95)
1.19
Not when n > 5. A bent line whose half-lines run at angles Œ∏ and
Œ∏ + 30‚ó¶from its apex can intersect four times with another whose half-lines
run at angles œÜ and œÜ + 30‚ó¶only if 30‚ó¶< jŒ∏ ‚àíœÜj < 150‚ó¶. We can't choose
more than 5 angles this far apart from each other. (It is possible to choose 5.)
Page 501, lines 5 and following
(20 Feb 95)
1.24
The only known examples are: Xn = 2i sin œÄr + 1/Xn‚àí1, where r is
rational and 0  r < 1
2 (all period lengths  2 occur as r varies); Gauss's . . .
Page 509, lines 5 and 6
(26 Sep 95)
3.29
D
¬°
Œ±‚Ä≤, ‚åäŒ±n‚åã
¬¢
is at most the maximum of the absolute value of
s
¬°
Œ±‚Ä≤, ‚åänŒ±‚åã, v‚Ä≤¬¢
= ‚àís(Œ±, n, v) ‚àíS + œµ + f0 or 1g + v‚Ä≤ ‚àíf0 or 1g .
Page 512, line 5 from the bottom
(8 May 96)
(‚àí1)[x(n)<y(n)].
Page 520, lines 4{6 from the bottom
(25 Apr 95)
4.49
(a) Either m < n (Œ¶(N) ‚àí1 cases) or m = n (one case) or m > n
(Œ¶(N) ‚àí1 again). Hence R(N) = 2Œ¶(N) ‚àí1. (b) From (4.62) we get
2Œ¶(N) ‚àí1 = ‚àí1 +
X
d1
¬µ(d)‚åäN/d‚åã‚åä1 + N/d‚åã;
Page 521, bottom line
(24 May 96)
¬ß
(n ‚àí1)!/(n + 1)
¬®
=
¬°
(n ‚àí1)! + n
¬¢
/(n + 1) ;
Page 525, line 4 of answer 4.69
(20 Jun 96)
in exercise 60 are the best that were known in 1994 [255].
Exercise 68

670 ERRATA, 1994-1997
Page 530, line 15
(6 Jun 96)
for all m > 0 and n > 0, by induction on m + n.
Page 531, line 5 from the bottom
(4 Jun 95)
¬µn + a ‚àí1
n
¬∂
F
¬µa, b, ‚àín
c, a
¬Ø¬Ø¬Ø 1
¬∂
= an
n!
(c ‚àíb)n
cn
Page 532, new grato for top of page
(13 Jan 95)
Term limits?
Page 540, line 7 from the bottom
(26 Sep 95)
quently, when m  0 is an integer less than n, we have
Page 547, correction to rst line of grato
(21 Jan 95)
Notice that 1/nk
Page 551, lines 5{8 from the bottom
(9 Jul 95)
valid for k = n ‚àí1 if we write it in the form
Km+n(x1, . . . , xm+n) Kn‚àí1(xm+n‚àí1, . . . , xm+1)
= Km+n‚àí1(x1, . . . , xm+n‚àí1) Kn(xm+n, . . . , xm+1)
‚àí(‚àí1)nKm‚àí1(x1, . . . , xm‚àí1) .
[Also delete `k = 2,' where it appears on the bottom line.]
Page 555, line 2
(1 Nov 94)
16735, and 102728. See the answer to exercise 92.)

ERRATA, 1994-1997 671
Page 564, lines 13 and 14
(14 Jun 94)
¬©n
m
¬™
= P
k
¬°m
k
¬¢
kn(‚àí1)m‚àík/m! for integer m  0 and arbitrary n  0; then
(6.3) holds for all n  1.
Page 564, lines 15 and 16
(1 Nov 94)
6.92
(a) David Boyd has shown that there are only nitely many solutions
for all p < 500, except perhaps p = 83, 127, 397. (b) The behavior of bn is
quite . . .
Page 568, new grato for the answer to 7.23
(15 Aug 94)
\Curiously, a2n is
equal to U2
2n , the
square of the num-
ber of ways to tile
a 3 √ó 2n rectangle
with dominoes; and
a2n+1 = 2V2
2n+1 ."
|I. Kaplansky
Page 578, lines 3 and 4 of answer 22
(13 May 96)
¬°
E
¬°
E(XjY)
¬¢¬¢2.
But E
¬°
E(XjY)
¬¢
= P
y Pr(Y = y)E(Xjy) = P
x,y Pr(Y = y) √ó
Pr
¬°
(Xjy) = x
¬¢
x = EX and E
¬°
E(X2jY)
¬¢
= E(X2), so the result is just VX.
Page 581, correction to the grato
(18 Aug 96)
\Toto, I've a
feeling we're
not in Kansas
anymore."
|Dorothy
Page 594, line 2
(9 Jul 95)
‚àí5.5/(ln n)2 + O(log log n/log n)3; then we estimate P1000000 ‚âà15480992.8.)
Page 597, line 4 of answer 9.40
(20 Jun 96)
n/2
X
k=1
Hm‚àí1
2k
k
=
n/2
X
k=1
(ln 2eŒ≥k)m‚àí1+O(k‚àí1(log k)m‚àí2)
k

672 ERRATA, 1994-1997
Page 599, lines 1 and 2
(26 Sep 95)
for all m. Divide by n and let n ‚Üí‚àû; the limit points are bounded above by
Œ±1 . . . Œ±m for all m. Finally we have
Page 603, new grato for answer 9.63
(31 Dec 97)
Additional progress
on this problem has
been made by Jean-
Luc Remy, Journal
of Number Theory,
vol.66 (1997), 1{28.
Page 605, lines 16{20
(29 Mar 97)
15
M. D. Atkinson, \The cyclic towers of Hanoi," Information Processing
633.
Letters 13 (1981), 118{119.
16
M. D. Atkinson, \How to compute the series expansions of sec x and
635.
tan x," American Mathematical Monthly 93 (1986), 387{389. [See also
A. J. Kempner, \On the shape of polynomial curves," T^ohoku Math. J.
37 (1933), 347{362; R. C. Entringer, \A combinatorial interpretation of
the Euler and Bernoulli numbers," Nieuw Archief voor Wiskunde 14
(1966), 241{246.]
Page 608, lines 22 and 23
(1 Feb 96)
59
F. R. K. Chung and R. L. Graham, \On the cover polynomial of a di-
graph," Journal of Combinatorial Theory, series B, 65 (1995), 273{290.
Page 612, line 10
(31 Dec 95)
lated into French, 1786; German, 1788; Russian, 1936; English, 1988.
Page 612, line 16 and following
(31 Dec 95)
Analysi Finitorum ac Doctrina Serierum.
St. Petersburg, Academi
Imperialis . . .

ERRATA, 1994-1997 673
Page 614, line 8
(1 Nov 96)
132 J. Franel, Solutions to questions 42 and 170, in L'Intermediaire des
Page 614, line 11
(31 Dec 95)
minimal storage tree sorting," Journal of the Association for Computing
Machinery 27 (1970), 496{507.
Page 615, line 12
(24 May 96)
145 Angelo Genocchi, \Intorno all'espressione generale de'numeri Bernul-
liani,"
Page 616, lines 5 and 6 from the bottom
(12 Feb 96)
170 Inger Johanne Haland and Donald E. Knuth, \Polynomials involving the
oor function," Mathematica Scandinavica 76 (1995), 194{200.
Page 619, after line 2
(27 May 94)
202 Johannes Kepler, letter to Joachim Tancke (12 May 1608), in his Gesam-
melte Werke, volume 16, 154{165.
[Items previously numbered 202, 203, and 204 are now numbered 203, 204,
205; the item previously numbered 205 has been dropped.]
Page 620, line 5 from the bottom
(31 Dec 95)
229 E. E. Kummer, \Uber die hypergeometrische Reihe
Page 622, lines 16 and 17
(11 Apr 96)
Stirling numbers of the second kind," Discrete Mathematics 150 (1996),
281{292.

674 ERRATA, 1994-1997
Page 622, lines 18 and 19
(28 Mar 97)
249 Li Shan-Lan, Duo J B Lei [Sums of Piles Obtained Inductively]. In his
Zegux Zha Suanxue [Classically Inspired Meditations on Mathematics],
Page 623, line 6
(10 Oct 97)
premier," Bulletin de la Societe mathematique de France 6 (1877), 49{54.
Page 624, line 5
(31 Dec 95)
Zahlen," Sitzungsberichte der Mathematisch-Naturwissenschaftlichen
Page 626, line 18
(3 Aug 95)
308 Paulo Ribenboim, 13 Lectures on Fermat's Last Theorem.
Springer-
Page 626, line 5 from the bottom
(6 Mar 96)
313 Gian-Carlo Rota, \On the foundations of combinatorial theory. I. The-
Page 627, line 20
(31 Dec 95)
ence on Combinatorial Structures and their Applications, 1969.)
Page 627, lines 10 and 11 from the bottom
(1 Nov 96)
letin International de l'Academie Polonaise des Sciences et des Lettres
(Cracovie), series A (1910), 9{11.
Page 627, line 6 from the bottom
(31 Dec 95)
328 Wac law Sierpinski, A Selection of Problems in the Theory of Numbers.

ERRATA, 1994-1997 675
Page 628, lines 1 and 2
(1 Nov 94)
330 N. J. A. Sloane, A Handbook of Integer Sequences. Academic Press, 1973.
Sequel, with Simon Ploue, The Encyclopedia of Integer Sequences, Aca-
demic Press, 1995.
Page 628, lines 4 and 5
(4 Mar 96)
331 A. D. Solov'ev, \Odno kombinatornoe tozhdestvo i ego primenenie k za-
dache o pervom nastuplenii redkogo sobyti√Ña," Teori√Ña vero√Ñatnoste
Page 629, lines 1 and 2
(21 Jan 95)
344 Volker Strehl, \Binomial identities | combinatorial and algorithmic as-
pects," Discrete Mathematics 136 (1994), 309{346.
Page 630, bottom line
(21 Jan 95)
373 Herbert S. Wilf, generatingfunctionology. Academic Press, 1990; second
edition, 1994.
Page 633, left column
(26 Sep 96)
1.10
Atkinson [15].
Page 635, left column
(26 Sep 96)
6.75
Atkinson [16].
Page 635, left column
(2 Oct 97)
6.76
[209, answer 5.1.3{3]; Lengyel [248].

676 ERRATA, 1994-1997
Page 635, right column
(13 Jan 95)
6.86
[226].
Page 636, missing entry
(8 May 96)
8.45
1985 nal exam.
Page 638, left column
(26 Sep 96)
[remove the reference to V. I. Arnol'd]
Page 638, right column
(26 Sep 96)
Atkinson, Michael David, 605, 633, 635.
Page 639, right column
(7 Jul 97)
Blom, Carl Gunnar, 606, 636
Page 639, right column
(23 Jan 95)
Boyd, David William, 564
Page 640, left column
(27 Oct 97)
Cassini, Gian (= Giovanni = Jean) Domenico (= Dominique), 292, 607
Page 641, left column
(18 Dec 96)
Concrete Math Club, 74, 453

ERRATA, 1994-1997 677
Page 642, left column
(1 Oct 94)
Dirichlet, Johann Peter Gustav Lejeune, 370, 610, 633
Page 643, left column
(28 Dec 96)
Entringer, Roger Charles, 605
Page 645, left column
(1 Oct 94)
Gau (= Gauss), Johann Friedrich Carl (= Carl Friedrich), vii, 6, 7, . . .
Page 647, right column
(29 Mar 97)
Kempner, Aubrey John, 605
Page 648, left column
(28 Mar 97)
L Shanlan Renshu (= Qiuren), 269, 622
Page 648, right column
(15 Apr 96)
Minkowski, Hermann, 122
Page 650, right column
(29 Aug 96)
Phi function: sum of œï, 137{139, 462{463
Page 651, right column
(1 Sep 94)
Ramanujan Iyengar, Srinivasa, 330

678 ERRATA, 1994-1997
Page 652, left column
(31 Dec 97)
Remy, Jean-Luc, 603
Page 652, left column
(3 Aug 95)
Ribenboim, Paulo, 555, 626, 634
Page 653, right column
(31 Dec 95)
Stern, Moritz Abraham, 116, 628
Page 654, right column
(28 Mar 97)
Sun Tzu (= Sunz, Master Sun), 126
Page 655, right column
(15 Dec 96)
umop-apsdn function, 193.
Page 656, right column in second printing
(1 Mar 95)
Wiles, Andrew John, 131
Finally, on the back cover, line 7
(5 Feb 96)
change `indispensible' to `indispensable'.


